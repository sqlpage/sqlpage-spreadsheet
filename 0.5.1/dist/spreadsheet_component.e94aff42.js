function e(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},r={},n={},i=t.parcelRequire94c2;null==i&&((i=function(e){if(e in r)return r[e].exports;if(e in n){var t=n[e];delete n[e];var i={id:e,exports:{}};return r[e]=i,t.call(i.exports,i,i.exports),i.exports}var s=Error("Cannot find module '"+e+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(e,t){n[e]=t},t.parcelRequire94c2=i);var s=i.register;s("6wcuN",function(t,r){e(t.exports,"register",function(){return n},function(e){return n=e}),e(t.exports,"resolve",function(){return i},function(e){return i=e});var n,i,s=new Map;n=function(e,t){for(var r=0;r<t.length-1;r+=2)s.set(t[r],{baseUrl:e,path:t[r+1]})},i=function(e){var t=s.get(e);if(null==t)throw Error("Could not resolve bundle with id "+e);return new URL(t.path,t.baseUrl).toString()}}),s("7yNYd",function(r,n){let s,a,o,l,u,c,h,d,m,g,f,p,C,_,y,E,b,R,N,I,A,v,S,T,O,M,w,x,U,D,V,L,P,j,F,k,B,$,H,W,G,Y,z,q,X,K,Q,Z,J,ee,et,er,en,ei,es,ea,eo,el,eu,ec,eh,ed,em,eg,ef,ep,eC,e_,ey,eE,eb,eR,eN,eI,eA,ev,eS,eT,eO,eM,ew,ex,eU,eD,eV,eL,eP,ej,eF,ek,eB,e$,eH,eW,eG,eY,ez,eq;e(r.exports,"debounce",function(){return rV}),e(r.exports,"mergeWith",function(){return rF}),e(r.exports,"remove",function(){return r6}),e(r.exports,"isBooleanString",function(){return r9}),e(r.exports,"DOCS_NORMAL_EDITOR_UNIT_ID_KEY",function(){return r8}),e(r.exports,"DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY",function(){return ne}),e(r.exports,"DOCS_ZEN_EDITOR_UNIT_ID_KEY",function(){return nt}),e(r.exports,"DEFAULT_EMPTY_DOCUMENT_VALUE",function(){return nr}),e(r.exports,"IS_ROW_STYLE_PRECEDE_COLUMN_STYLE",function(){return nn}),e(r.exports,"createInternalEditorID",function(){return ni}),e(r.exports,"isInternalEditorID",function(){return ns}),e(r.exports,"isClassDependencyItem",function(){return nl}),e(r.exports,"Quantity",function(){return le}),e(r.exports,"createIdentifier",function(){return nA}),e(r.exports,"Optional",function(){return nw}),e(r.exports,"Inject",function(){return nx}),e(r.exports,"Injector",function(){return n1}),e(r.exports,"useInjector",function(){return ir}),e(r.exports,"useDependency",function(){return ii}),e(r.exports,"connectInjector",function(){return ia}),e(r.exports,"useObservable",function(){return iu}),e(r.exports,"registerDependencies",function(){return ic}),e(r.exports,"touchDependencies",function(){return ih}),e(r.exports,"CustomCommandExecutionError",function(){return id}),e(r.exports,"InterceptorEffectEnum",function(){return im}),e(r.exports,"createInterceptorKey",function(){return ig}),e(r.exports,"composeInterceptors",function(){return ip}),e(r.exports,"InterceptorManager",function(){return iC}),e(r.exports,"MemoryCursor",function(){return i_}),e(r.exports,"FBase",function(){return iE}),e(r.exports,"toDisposable",function(){return iM}),e(r.exports,"DisposableCollection",function(){return iw}),e(r.exports,"Disposable",function(){return ix}),e(r.exports,"RxDisposable",function(){return iU}),e(r.exports,"IContextService",function(){return iD}),e(r.exports,"LogLevel",function(){return iL}),e(r.exports,"ILogService",function(){return iP}),e(r.exports,"CommandType",function(){return i$}),e(r.exports,"ICommandService",function(){return iH}),e(r.exports,"NilCommand",function(){return iG}),e(r.exports,"sequenceExecute",function(){return iq}),e(r.exports,"sequenceExecuteAsync",function(){return iX}),e(r.exports,"searchArray",function(){return iK}),e(r.exports,"MOVE_BUFFER_VALUE",function(){return iQ}),e(r.exports,"BorderStyleTypes",function(){return iJ}),e(r.exports,"BorderType",function(){return i0}),e(r.exports,"Dimension",function(){return i6}),e(r.exports,"Direction",function(){return i9}),e(r.exports,"getReverseDirection",function(){return i7}),e(r.exports,"LocaleType",function(){return st}),e(r.exports,"TextDirection",function(){return sc}),e(r.exports,"TextDecoration",function(){return sh}),e(r.exports,"HorizontalAlign",function(){return sd}),e(r.exports,"VerticalAlign",function(){return sm}),e(r.exports,"WrapStrategy",function(){return sg}),e(r.exports,"FontItalic",function(){return sf}),e(r.exports,"FontWeight",function(){return sp}),e(r.exports,"BaselineOffset",function(){return sC}),e(r.exports,"BooleanNumber",function(){return s_}),e(r.exports,"CellValueType",function(){return sy}),e(r.exports,"Tools",function(){return sU}),e(r.exports,"generateRandomId",function(){return sD}),e(r.exports,"composeStyles",function(){return sV}),e(r.exports,"isNodeEnv",function(){return sL}),e(r.exports,"convertBodyToHtml",function(){return sj}),e(r.exports,"COLORS",function(){return sq}),e(r.exports,"ColorKit",function(){return sX}),e(r.exports,"isWhiteColor",function(){return at}),e(r.exports,"UpdateDocsAttributeType",function(){return ar}),e(r.exports,"isICellData",function(){return an}),e(r.exports,"getCellValueType",function(){return ai}),e(r.exports,"isNullCell",function(){return as}),e(r.exports,"isCellV",function(){return aa}),e(r.exports,"RANGE_TYPE",function(){return ao}),e(r.exports,"AbsoluteRefType",function(){return al}),e(r.exports,"selectionToArray",function(){return au}),e(r.exports,"RANGE_DIRECTION",function(){return ac}),e(r.exports,"DOC_RANGE_TYPE",function(){return ah}),e(r.exports,"getCellInfoInMergeData",function(){return ad}),e(r.exports,"convertCellToRange",function(){return am}),e(r.exports,"isCellCoverable",function(){return ag}),e(r.exports,"getColorStyle",function(){return af}),e(r.exports,"isFormulaString",function(){return ap}),e(r.exports,"isFormulaId",function(){return aC}),e(r.exports,"handleStyleToString",function(){return a_}),e(r.exports,"getBorderStyleType",function(){return aE}),e(r.exports,"isValidRange",function(){return ab}),e(r.exports,"cellToRange",function(){return aR}),e(r.exports,"checkForSubstrings",function(){return aN}),e(r.exports,"horizontalLineSegmentsSubtraction",function(){return a$}),e(r.exports,"checkParagraphHasIndentByStyle",function(){return aH}),e(r.exports,"insertTextToContent",function(){return aW}),e(r.exports,"deleteContent",function(){return aG}),e(r.exports,"isRealNum",function(){return az}),e(r.exports,"hashAlgorithm",function(){return aq}),e(r.exports,"LRUMap",function(){return a1}),e(r.exports,"numfmt",function(){return a3}),e(r.exports,"getArrayLength",function(){return a4}),e(r.exports,"insertMatrixArray",function(){return a6}),e(r.exports,"spliceArray",function(){return a9}),e(r.exports,"concatMatrixArray",function(){return a7}),e(r.exports,"sliceMatrixArray",function(){return a8}),e(r.exports,"moveMatrixArray",function(){return oe}),e(r.exports,"ObjectMatrix",function(){return ot}),e(r.exports,"DEFAULT_STYLES",function(){return or}),e(r.exports,"SHEET_EDITOR_UNITS",function(){return oi}),e(r.exports,"Range",function(){return ol}),e(r.exports,"moveRangeByOffset",function(){return ou}),e(r.exports,"splitIntoGrid",function(){return oh}),e(r.exports,"Rectangle",function(){return op}),e(r.exports,"getIntersectRange",function(){return od}),e(r.exports,"queryObjectMatrix",function(){return oC}),e(r.exports,"createRowColIter",function(){return o_}),e(r.exports,"numberToABC",function(){return oy}),e(r.exports,"numberToListABC",function(){return oE}),e(r.exports,"sortRules",function(){return ob}),e(r.exports,"sortRulesByDesc",function(){return oR}),e(r.exports,"sortRulesFactory",function(){return oN}),e(r.exports,"UniverInstanceType",function(){return oI}),e(r.exports,"TextXActionType",function(){return ld}),e(r.exports,"normalizeTextRuns",function(){return lm}),e(r.exports,"GlyphType",function(){return lw}),e(r.exports,"BulletAlignment",function(){return lx}),e(r.exports,"CustomRangeType",function(){return lU}),e(r.exports,"CustomDecorationType",function(){return lD}),e(r.exports,"DocumentFlavor",function(){return lL}),e(r.exports,"GridType",function(){return lP}),e(r.exports,"SectionType",function(){return lj}),e(r.exports,"ColumnSeparatorType",function(){return lF}),e(r.exports,"WrapTextType",function(){return l$}),e(r.exports,"PositionedObjectLayoutType",function(){return lH}),e(r.exports,"SpacingRule",function(){return lG}),e(r.exports,"TableSizeType",function(){return lq}),e(r.exports,"TableAlignmentType",function(){return lX}),e(r.exports,"TableTextWrapType",function(){return lQ}),e(r.exports,"TableRowHeightRule",function(){return lZ}),e(r.exports,"VerticalAlignmentType",function(){return lJ}),e(r.exports,"FontStyleType",function(){return l0}),e(r.exports,"ObjectRelativeFromH",function(){return l1}),e(r.exports,"ObjectRelativeFromV",function(){return l2}),e(r.exports,"NumberUnitType",function(){return l5}),e(r.exports,"AlignTypeH",function(){return l3}),e(r.exports,"AlignTypeV",function(){return l4}),e(r.exports,"PageOrientType",function(){return l9}),e(r.exports,"PresetListType",function(){return ui}),e(r.exports,"PRESET_LIST_TYPE",function(){return uu}),e(r.exports,"QuickListTypeMap",function(){return uh}),e(r.exports,"SliceBodyType",function(){return um}),e(r.exports,"getBodySlice",function(){return ug}),e(r.exports,"normalizeBody",function(){return uf}),e(r.exports,"TextX",function(){return ub}),e(r.exports,"JSONX",function(){return uN}),e(r.exports,"DocumentDataModel",function(){return uv}),e(r.exports,"DataStreamTreeNodeType",function(){return uM}),e(r.exports,"DataStreamTreeTokenType",function(){return uw}),e(r.exports,"BuildTextUtils",function(){return uD}),e(r.exports,"addLinkToDocumentModel",function(){return uF}),e(r.exports,"DEFAULT_WORKSHEET_ROW_HEIGHT",function(){return uW}),e(r.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY",function(){return uG}),e(r.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH",function(){return uY}),e(r.exports,"mergeWorksheetSnapshotWithDefault",function(){return uz}),e(r.exports,"extractPureTextFromCell",function(){return uZ}),e(r.exports,"Workbook",function(){return u1}),e(r.exports,"SlideDataModel",function(){return u2}),e(r.exports,"FOCUSING_SHEET",function(){return u3}),e(r.exports,"FOCUSING_DOC",function(){return u4}),e(r.exports,"FOCUSING_EDITOR_BUT_HIDDEN",function(){return u9}),e(r.exports,"EDITOR_ACTIVATED",function(){return u7}),e(r.exports,"FOCUSING_EDITOR_INPUT_FORMULA",function(){return u8}),e(r.exports,"FOCUSING_FX_BAR_EDITOR",function(){return ce}),e(r.exports,"FOCUSING_UNIVER_EDITOR",function(){return ct}),e(r.exports,"FOCUSING_EDITOR_STANDALONE",function(){return cr}),e(r.exports,"FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",function(){return cn}),e(r.exports,"FOCUSING_COMMON_DRAWINGS",function(){return ci}),e(r.exports,"FORMULA_EDITOR_ACTIVATED",function(){return cs}),e(r.exports,"IUniverInstanceService",function(){return cu}),e(r.exports,"LifecycleStages",function(){return ch}),e(r.exports,"LifecycleService",function(){return cf}),e(r.exports,"IUndoRedoService",function(){return cE}),e(r.exports,"RedoCommandId",function(){return cR}),e(r.exports,"UndoCommandId",function(){return cN}),e(r.exports,"UndoCommand",function(){return cI}),e(r.exports,"RedoCommand",function(){return cA}),e(r.exports,"IResourceManagerService",function(){return cS}),e(r.exports,"UserManagerService",function(){return cw}),e(r.exports,"IAuthzIoService",function(){return cL}),e(r.exports,"IConfigService",function(){return cP}),e(r.exports,"ErrorService",function(){return cF}),e(r.exports,"LocaleService",function(){return ck}),e(r.exports,"PermissionStatus",function(){return cG}),e(r.exports,"IPermissionService",function(){return cY}),e(r.exports,"Plugin",function(){return cX}),e(r.exports,"DependentOn",function(){return c2}),e(r.exports,"mergeOverrideWithDependencies",function(){return c4}),e(r.exports,"IResourceLoaderService",function(){return he}),e(r.exports,"ThemeService",function(){return hr}),e(r.exports,"Univer",function(){return hn}),e(r.exports,"FHooks",function(){return ho}),e(r.exports,"FUniver",function(){return hh}),e(r.exports,"isSafeNumeric",function(){return hd}),e(r.exports,"Registry",function(){return hm}),e(r.exports,"requestImmediateMacroTask",function(){return hg}),e(r.exports,"EventSubject",function(){return hp}),e(r.exports,"fromEventSubject",function(){return hC}),e(r.exports,"ILocalStorageService",function(){return h_}),e(r.exports,"nameCharacterCheck",function(){return hy}),e(r.exports,"awaitTime",function(){return hE}),e(r.exports,"skipParseTagNames",function(){return hb}),e(r.exports,"RTree",function(){return hY});var eX,eK,eQ,eZ=i("5LPkb"),eJ=i("5K4WI");i("bXJOC");var e0=i("arCqp"),e1=i("lMvMU"),e2=i("hciHF"),e5=i("i54iF"),e3=i("1O3Nt"),e4=i("3yupB");i("3rvNF");var e6=i("9GqS8"),e9=i("1mjSk");i("9z4na"),i("b7wVW"),i("aMpZj"),i("bXJOC");var e1=i("lMvMU");i("bDEN0");var e2=i("hciHF"),e7=i("5gqvu"),e8=i("8L69c"),te=Object.defineProperty,tt=(e,t,r)=>t in e?te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tr=(e,t,r)=>tt(e,"symbol"!=typeof t?t+"":t,r);let tn="u">typeof t?t:"u">typeof self?self:window;var ti="object"==typeof t&&t&&t.Object===Object&&t,ts="object"==typeof self&&self&&self.Object===Object&&self,ta=ti||ts||Function("return this")(),to=ta.Symbol,tl=Object.prototype,tu=tl.hasOwnProperty,tc=tl.toString,th=to?to.toStringTag:void 0,td=Object.prototype.toString,tm=to?to.toStringTag:void 0;function tg(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":tm&&tm in Object(e)?function(e){var t=tu.call(e,th),r=e[th];try{e[th]=void 0;var n=!0}catch{}var i=tc.call(e);return n&&(t?e[th]=r:delete e[th]),i}(e):td.call(e)}function tf(e){return null!=e&&"object"==typeof e}var tp=Array.isArray,tC=to?to.prototype:void 0;tC&&tC.toString;var t_=/\s/,ty=/^\s+/;function tE(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var tb=NaN,tR=/^[-+]0x[0-9a-f]+$/i,tN=/^0b[01]+$/i,tI=/^0o[0-7]+$/i,tA=parseInt;function tv(e){if("number"==typeof e)return e;if("symbol"==typeof(t=e)||tf(t)&&"[object Symbol]"==tg(t))return tb;if(tE(e)){var t,r,n="function"==typeof e.valueOf?e.valueOf():e;e=tE(n)?n+"":n}if("string"!=typeof e)return 0===e?e:+e;e=(r=e)&&r.slice(0,function(e){for(var t=e.length;t--&&t_.test(e.charAt(t)););return t}(r)+1).replace(ty,"");var i=tN.test(e);return i||tI.test(e)?tA(e.slice(2),i?2:8):tR.test(e)?tb:+e}function tS(e){return e}function tT(e){if(!tE(e))return!1;var t=tg(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var tO=ta["__core-js_shared__"],tM=(oL=/[^.]+$/.exec(tO&&tO.keys&&tO.keys.IE_PROTO||""))?"Symbol(src)_1."+oL:"",tw=Function.prototype.toString,tx=/^\[object .+?Constructor\]$/,tU=Object.prototype,tD=Function.prototype.toString,tV=tU.hasOwnProperty,tL=RegExp("^"+tD.call(tV).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function tP(e,t){var r=null==e?void 0:e[t];return tE(r)&&(!tM||!(tM in r))&&(tT(r)?tL:tx).test(function(e){if(null!=e){try{return tw.call(e)}catch{}try{return e+""}catch{}}return""}(r))?r:void 0}var tj=Object.create,tF=/* @__PURE__ */function(){function e(){}return function(t){if(!tE(t))return{};if(tj)return tj(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),tk=Date.now,tB=function(){try{var e=tP(Object,"defineProperty");return e({},"",{}),e}catch{}}(),t$=(oP=tB?function(e,t){return tB(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:tS,oj=0,oF=0,function(){var e=tk(),t=16-(e-oF);if(oF=e,t>0){if(++oj>=800)return arguments[0]}else oj=0;return oP.apply(void 0,arguments)}),tH=/^(?:0|[1-9]\d*)$/;function tW(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&tH.test(e))&&e>-1&&e%1==0&&e<t}function tG(e,t,r){"__proto__"==t&&tB?tB(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function tY(e,t){return e===t||e!=e&&t!=t}var tz=Object.prototype.hasOwnProperty,tq=Math.max;function tX(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function tK(e){return null!=e&&tX(e.length)&&!tT(e)}function tQ(e){var t,r,n;return t$((r=t=function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,a&&function(e,t,r){if(!tE(r))return!1;var n=typeof t;return("number"==n?!!(tK(r)&&tW(t,r.length)):"string"==n&&t in r)&&tY(r[t],e)}(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var o=r[n];o&&e(t,o,n,s)}return t},n=tq((n=void 0,r.length-1),0),function(){for(var e=arguments,t=-1,i=tq(e.length-n,0),s=Array(i);++t<i;)s[t]=e[n+t];t=-1;for(var a=Array(n+1);++t<n;)a[t]=e[t];return a[n]=s,function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(r,this,a)}),t+"")}var tZ=Object.prototype;function tJ(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||tZ)}function t0(e){return tf(e)&&"[object Arguments]"==tg(e)}var t1=Object.prototype,t2=t1.hasOwnProperty,t5=t1.propertyIsEnumerable,t3=t0(/* @__PURE__ */function(){return arguments}())?t0:function(e){return tf(e)&&t2.call(e,"callee")&&!t5.call(e,"callee")},t4=n&&!n.nodeType&&n,t6=t4&&r&&!r.nodeType&&r,t9=t6&&t6.exports===t4?ta.Buffer:void 0,t7=(t9?t9.isBuffer:void 0)||function(){return!1},t8={};t8["[object Float32Array]"]=t8["[object Float64Array]"]=t8["[object Int8Array]"]=t8["[object Int16Array]"]=t8["[object Int32Array]"]=t8["[object Uint8Array]"]=t8["[object Uint8ClampedArray]"]=t8["[object Uint16Array]"]=t8["[object Uint32Array]"]=!0,t8["[object Arguments]"]=t8["[object Array]"]=t8["[object ArrayBuffer]"]=t8["[object Boolean]"]=t8["[object DataView]"]=t8["[object Date]"]=t8["[object Error]"]=t8["[object Function]"]=t8["[object Map]"]=t8["[object Number]"]=t8["[object Object]"]=t8["[object RegExp]"]=t8["[object Set]"]=t8["[object String]"]=t8["[object WeakMap]"]=!1;var re=n&&!n.nodeType&&n,rt=re&&r&&!r.nodeType&&r,rr=rt&&rt.exports===re&&ti.process,rn=function(){try{return rt&&rt.require&&rt.require("util").types||rr&&rr.binding&&rr.binding("util")}catch{}}(),ri=rn&&rn.isTypedArray,rs=ri?function(e){return ri(e)}:function(e){return tf(e)&&tX(e.length)&&!!t8[tg(e)]},ra=Object.prototype.hasOwnProperty;function ro(e){return tK(e)?function(e,t){var r=tp(e),n=!r&&t3(e),i=!r&&!n&&t7(e),s=!r&&!n&&!i&&rs(e),a=r||n||i||s,o=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=o.length;for(var u in e)a&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||tW(u,l))||o.push(u);return o}(e):function(e){if(!tE(e))return function(e){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}(e);var t=tJ(e),r=[];for(var n in e)"constructor"==n&&(t||!ra.call(e,n))||r.push(n);return r}(e)}var rl=tP(Object,"create"),ru=Object.prototype.hasOwnProperty,rc=Object.prototype.hasOwnProperty;function rh(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function rd(e,t){for(var r=e.length;r--;)if(tY(e[r][0],t))return r;return -1}rh.prototype.clear=function(){this.__data__=rl?rl(null):{},this.size=0},rh.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},rh.prototype.get=function(e){var t=this.__data__;if(rl){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return ru.call(t,e)?t[e]:void 0},rh.prototype.has=function(e){var t=this.__data__;return rl?void 0!==t[e]:rc.call(t,e)},rh.prototype.set=function(e,t){var r=this.__data__;return this.size+=this.has(e)?0:1,r[e]=rl&&void 0===t?"__lodash_hash_undefined__":t,this};var rm=Array.prototype.splice;function rg(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}rg.prototype.clear=function(){this.__data__=[],this.size=0},rg.prototype.delete=function(e){var t=this.__data__,r=rd(t,e);return!(r<0)&&(r==t.length-1?t.pop():rm.call(t,r,1),--this.size,!0)},rg.prototype.get=function(e){var t=this.__data__,r=rd(t,e);return r<0?void 0:t[r][1]},rg.prototype.has=function(e){return rd(this.__data__,e)>-1},rg.prototype.set=function(e,t){var r=this.__data__,n=rd(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var rf=tP(ta,"Map");function rp(e,t){var r,n=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?n["string"==typeof t?"string":"hash"]:n.map}function rC(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function r_(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var a=e.apply(this,n);return r.cache=s.set(i,a)||s,a};return r.cache=new(r_.Cache||rC),r}rC.prototype.clear=function(){this.size=0,this.__data__={hash:new rh,map:new(rf||rg),string:new rh}},rC.prototype.delete=function(e){var t=rp(this,e).delete(e);return this.size-=t?1:0,t},rC.prototype.get=function(e){return rp(this,e).get(e)},rC.prototype.has=function(e){return rp(this,e).has(e)},rC.prototype.set=function(e,t){var r=rp(this,e),n=r.size;return r.set(e,t),this.size+=r.size==n?0:1,this},r_.Cache=rC;var ry=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,rE=/\\(\\)?/g;ok=r_(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ry,function(e,r,n,i){t.push(n?i.replace(rE,"$1"):r||e)}),t},function(e){return 500===ok.size&&ok.clear(),e}).cache;var rb=(oB=Object.getPrototypeOf,o$=Object,function(e){return oB(o$(e))}),rR=Object.prototype,rN=Function.prototype.toString,rI=rR.hasOwnProperty,rA=rN.call(Object);function rv(e){var t=this.__data__=new rg(e);this.size=t.size}rv.prototype.clear=function(){this.__data__=new rg,this.size=0},rv.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},rv.prototype.get=function(e){return this.__data__.get(e)},rv.prototype.has=function(e){return this.__data__.has(e)},rv.prototype.set=function(e,t){var r=this.__data__;if(r instanceof rg){var n=r.__data__;if(!rf||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new rC(n)}return r.set(e,t),this.size=r.size,this};var rS=n&&!n.nodeType&&n,rT=rS&&r&&!r.nodeType&&r,rO=rT&&rT.exports===rS?ta.Buffer:void 0;rO&&rO.allocUnsafe;var rM=ta.Uint8Array,rw=function(e,t,r){for(var n=-1,i=Object(e),s=r(e),a=s.length;a--;){var o=s[++n];if(!1===t(i[o],o,i))break}return e},rx=function(){return ta.Date.now()},rU=Math.max,rD=Math.min;function rV(e,t,r){var n,i,s,a,o,l,u=0,c=!1,h=!1,d=!0;if("function"!=typeof e)throw TypeError("Expected a function");function m(t){var r=n,s=i;return n=i=void 0,u=t,a=e.apply(s,r)}function g(e){var r=e-l,n=e-u;return void 0===l||r>=t||r<0||h&&n>=s}function f(){var e,r,n,i=rx();if(g(i))return p(i);o=setTimeout(f,(e=i-l,r=i-u,n=t-e,h?rD(n,s-r):n))}function p(e){return o=void 0,d&&n?m(e):(n=i=void 0,a)}function C(){var e,r=rx(),s=g(r);if(n=arguments,i=this,l=r,s){if(void 0===o)return u=e=l,o=setTimeout(f,t),c?m(e):a;if(h)return clearTimeout(o),o=setTimeout(f,t),m(l)}return void 0===o&&(o=setTimeout(f,t)),a}return t=tv(t)||0,tE(r)&&(c=!!r.leading,s=(h="maxWait"in r)?rU(tv(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d),C.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=l=i=o=void 0},C.flush=function(){return void 0===o?a:p(rx())},C}function rL(e,t,r){(void 0===r||tY(e[t],r))&&(void 0!==r||t in e)||tG(e,t,r)}function rP(e,t){if(!("constructor"===t&&"function"==typeof e[t])&&"__proto__"!=t)return e[t]}function rj(e,t,r,n,i){e!==t&&rw(t,function(s,a){if(i||(i=new rv),tE(s))!function(e,t,r,n,i,s,a){var o=rP(e,r),l=rP(t,r),u=a.get(l);if(u){rL(e,r,u);return}var c=s?s(o,l,r+"",e,t,a):void 0,h=void 0===c;if(h){var d,m,g=tp(l),f=!g&&t7(l),p=!g&&!f&&rs(l);c=l,g||f||p?tp(o)?c=o:tf(o)&&tK(o)?c=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(o):f?(h=!1,c=l.slice()):p?(h=!1,new rM(m=new(d=l.buffer).constructor(d.byteLength)).set(new rM(d)),c=new l.constructor(m,l.byteOffset,l.length)):c=[]:function(e){if(!tf(e)||"[object Object]"!=tg(e))return!1;var t=rb(e);if(null===t)return!0;var r=rI.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&rN.call(r)==rA}(l)||t3(l)?(c=o,t3(o)?c=function(e,t,r,n){var i=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=void 0;void 0===l&&(l=e[o]),i?tG(r,o,l):function(e,t,r){var n=e[t];tz.call(e,t)&&tY(n,r)&&(void 0!==r||t in e)||tG(e,t,r)}(r,o,l)}return r}(o,ro(o)):(!tE(o)||tT(o))&&(c="function"!=typeof l.constructor||tJ(l)?{}:tF(rb(l)))):h=!1}h&&(a.set(l,c),i(c,l,n,s,a),a.delete(l)),rL(e,r,c)}(e,t,a,r,rj,n,i);else{var o=n?n(rP(e,a),s,a+"",e,t,i):void 0;void 0===o&&(o=s),rL(e,a,o)}},ro)}var rF=tQ(function(e,t,r,n){rj(e,t,r,n)});tQ(function(e,t,r){rj(e,t,r)});var rk="u">typeof globalThis?globalThis:"u">typeof window?window:"u">typeof t?t:"u">typeof self?self:{};function rB(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function r$(e,t,r,n,i){if(e===t)return e?[[0,e]]:[];if(null!=r){var s=function(e,t,r){var n="number"==typeof r?{index:r,length:0}:r.oldRange,i="number"==typeof r?null:r.newRange,s=e.length,a=t.length;if(0===n.length&&(null===i||0===i.length)){var o=n.index,l=e.slice(0,o),u=e.slice(o),c=i?i.index:null;e:{var h=o+a-s;if(null!==c&&c!==h||h<0||h>a)break e;var d=t.slice(0,h),m=t.slice(h);if(m!==u)break e;var g=Math.min(o,h),f=l.slice(0,g),p=d.slice(0,g);if(f!==p)break e;var C=l.slice(g),_=d.slice(g);return r5(f,C,_,u)}e:if(null===c||c===o){var d=t.slice(0,o),m=t.slice(o);if(d!==l)break e;var y=Math.min(s-o,a-o),E=u.slice(u.length-y),b=m.slice(m.length-y);if(E!==b)break e;var C=u.slice(0,u.length-y),_=m.slice(0,m.length-y);return r5(l,C,_,E)}}if(n.length>0&&i&&0===i.length)e:{var f=e.slice(0,n.index),E=e.slice(n.index+n.length),g=f.length,y=E.length;if(a<g+y)break e;var p=t.slice(0,g),b=t.slice(a-y);if(f!==p||E!==b)break e;var C=e.slice(g,s-y),_=t.slice(g,a-y);return r5(f,C,_,E)}return null}(e,t,r);if(s)return s}var a=rW(e,t),o=e.substring(0,a);a=rY(e=e.substring(a),t=t.substring(a));var l=e.substring(e.length-a),u=function(e,t){if(!e)return[[1,t]];if(!t)return[[-1,e]];var r,n=e.length>t.length?e:t,i=e.length>t.length?t:e,s=n.indexOf(i);if(-1!==s)return r=[[1,n.substring(0,s)],[0,i],[1,n.substring(s+i.length)]],e.length>t.length&&(r[0][0]=r[2][0]=-1),r;if(1===i.length)return[[-1,e],[1,t]];var a=function(e,t){var r,n,i,s,a=e.length>t.length?e:t,o=e.length>t.length?t:e;if(a.length<4||2*o.length<a.length)return null;function l(e,t,r){for(var n,i,s,a,o=e.substring(r,r+Math.floor(e.length/4)),l=-1,u="";-1!==(l=t.indexOf(o,l+1));){var c=rW(e.substring(r),t.substring(l)),h=rY(e.substring(0,r),t.substring(0,l));u.length<h+c&&(u=t.substring(l-h,l)+t.substring(l,l+c),n=e.substring(0,r-h),i=e.substring(r+c),s=t.substring(0,l-h),a=t.substring(l+c))}return 2*u.length>=e.length?[n,i,s,a,u]:null}var u,c=l(a,o,Math.ceil(a.length/4)),h=l(a,o,Math.ceil(a.length/2));return c||h?(u=h?c&&c[4].length>h[4].length?c:h:c,e.length>t.length?(r=u[0],n=u[1],i=u[2],s=u[3]):(i=u[0],s=u[1],r=u[2],n=u[3]),[r,n,i,s,u[4]]):null}(e,t);if(a){var o=a[0],l=a[1],u=a[2],c=a[3],h=a[4],d=r$(o,u),m=r$(l,c);return d.concat([[0,h]],m)}return function(e,t){for(var r=e.length,n=t.length,i=Math.ceil((r+n)/2),s=2*i,a=Array(s),o=Array(s),l=0;l<s;l++)a[l]=-1,o[l]=-1;a[i+1]=0,o[i+1]=0;for(var u=r-n,c=u%2!=0,h=0,d=0,m=0,g=0,f=0;f<i;f++){for(var p=-f+h;p<=f-d;p+=2){var C,_=i+p;C=p===-f||p!==f&&a[_-1]<a[_+1]?a[_+1]:a[_-1]+1;for(var y=C-p;C<r&&y<n&&e.charAt(C)===t.charAt(y);)C++,y++;if(a[_]=C,C>r)d+=2;else if(y>n)h+=2;else if(c){var E=i+u-p;if(E>=0&&E<s&&-1!==o[E]){var b=r-o[E];if(C>=b)return rH(e,t,C,y)}}}for(var R=-f+m;R<=f-g;R+=2){var b,E=i+R;b=R===-f||R!==f&&o[E-1]<o[E+1]?o[E+1]:o[E-1]+1;for(var N=b-R;b<r&&N<n&&e.charAt(r-b-1)===t.charAt(n-N-1);)b++,N++;if(o[E]=b,b>r)g+=2;else if(N>n)m+=2;else if(!c){var _=i+u-R;if(_>=0&&_<s&&-1!==a[_]){var C=a[_],y=i+C-_;if(C>=(b=r-b))return rH(e,t,C,y)}}}}return[[-1,e],[1,t]]}(e,t)}(e=e.substring(0,e.length-a),t=t.substring(0,t.length-a));return o&&u.unshift([0,o]),l&&u.push([0,l]),rZ(u,i),n&&function(e){for(var t=!1,r=[],n=0,i=null,s=0,a=0,o=0,l=0,u=0;s<e.length;)0==e[s][0]?(r[n++]=s,a=l,o=u,l=0,u=0,i=e[s][1]):(1==e[s][0]?l+=e[s][1].length:u+=e[s][1].length,i&&i.length<=Math.max(a,o)&&i.length<=Math.max(l,u)&&(e.splice(r[n-1],0,[-1,i]),e[r[n-1]+1][0]=1,n--,s=--n>0?r[n-1]:-1,a=0,o=0,l=0,u=0,i=null,t=!0)),s++;for(t&&rZ(e),function(e){function t(e,t){if(!e||!t)return 6;var r=e.charAt(e.length-1),n=t.charAt(0),i=r.match(rz),s=n.match(rz),a=i&&r.match(rq),o=s&&n.match(rq),l=a&&r.match(rX),u=o&&n.match(rX),c=l&&e.match(rK),h=u&&t.match(rQ);return c||h?5:l||u?4:i&&!a&&o?3:a||o?2:i||s?1:0}for(var r=1;r<e.length-1;){if(0==e[r-1][0]&&0==e[r+1][0]){var n=e[r-1][1],i=e[r][1],s=e[r+1][1],a=rY(n,i);if(a){var o=i.substring(i.length-a);n=n.substring(0,n.length-a),i=o+i.substring(0,i.length-a),s=o+s}for(var l=n,u=i,c=s,h=t(n,i)+t(i,s);i.charAt(0)===s.charAt(0);){n+=i.charAt(0),i=i.substring(1)+s.charAt(0),s=s.substring(1);var d=t(n,i)+t(i,s);d>=h&&(h=d,l=n,u=i,c=s)}e[r-1][1]!=l&&(l?e[r-1][1]=l:(e.splice(r-1,1),r--),e[r][1]=u,c?e[r+1][1]=c:(e.splice(r+1,1),r--))}r++}}(e),s=1;s<e.length;){if(-1==e[s-1][0]&&1==e[s][0]){var c=e[s-1][1],h=e[s][1],d=rG(c,h),m=rG(h,c);d>=m?(d>=c.length/2||d>=h.length/2)&&(e.splice(s,0,[0,h.substring(0,d)]),e[s-1][1]=c.substring(0,c.length-d),e[s+1][1]=h.substring(d),s++):(m>=c.length/2||m>=h.length/2)&&(e.splice(s,0,[0,c.substring(0,m)]),e[s-1][0]=1,e[s-1][1]=h.substring(0,h.length-m),e[s+1][0]=-1,e[s+1][1]=c.substring(m),s++),s++}s++}}(u),u}function rH(e,t,r,n){var i=e.substring(0,r),s=t.substring(0,n),a=e.substring(r),o=t.substring(n),l=r$(i,s),u=r$(a,o);return l.concat(u)}function rW(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(s,i)==t.substring(s,i)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return rJ(e.charCodeAt(i-1))&&i--,i}function rG(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var s=0,a=1;;){var o=e.substring(i-a),l=t.indexOf(o);if(-1==l)return s;a+=l,(0==l||e.substring(i-a)==t.substring(0,a))&&(s=a,a++)}}function rY(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return r0(e.charCodeAt(e.length-i))&&i--,i}var rz=/[^a-zA-Z0-9]/,rq=/\s/,rX=/[\r\n]/,rK=/\n\r?\n$/,rQ=/^\r?\n\r?\n/;function rZ(e,t){e.push([0,""]);for(var r,n=0,i=0,s=0,a="",o="";n<e.length;){if(n<e.length-1&&!e[n][1]){e.splice(n,1);continue}switch(e[n][0]){case 1:s++,o+=e[n][1],n++;break;case -1:i++,a+=e[n][1],n++;break;case 0:var l=n-s-i-1;if(t){if(l>=0&&r2(e[l][1])){var u=e[l][1].slice(-1);if(e[l][1]=e[l][1].slice(0,-1),a=u+a,o=u+o,!e[l][1]){e.splice(l,1),n--;var c=l-1;e[c]&&1===e[c][0]&&(s++,o=e[c][1]+o,c--),e[c]&&-1===e[c][0]&&(i++,a=e[c][1]+a,c--),l=c}}if(r1(e[n][1])){var u=e[n][1].charAt(0);e[n][1]=e[n][1].slice(1),a+=u,o+=u}}if(n<e.length-1&&!e[n][1]){e.splice(n,1);break}if(a.length>0||o.length>0){a.length>0&&o.length>0&&(0!==(r=rW(o,a))&&(l>=0?e[l][1]+=o.substring(0,r):(e.splice(0,0,[0,o.substring(0,r)]),n++),o=o.substring(r),a=a.substring(r)),0!==(r=rY(o,a))&&(e[n][1]=o.substring(o.length-r)+e[n][1],o=o.substring(0,o.length-r),a=a.substring(0,a.length-r)));var h=s+i;0===a.length&&0===o.length?(e.splice(n-h,h),n-=h):0===a.length?(e.splice(n-h,h,[1,o]),n=n-h+1):0===o.length?(e.splice(n-h,h,[-1,a]),n=n-h+1):(e.splice(n-h,h,[-1,a],[1,o]),n=n-h+2)}0!==n&&0===e[n-1][0]?(e[n-1][1]+=e[n][1],e.splice(n,1)):n++,s=0,i=0,a="",o=""}}""===e[e.length-1][1]&&e.pop();var d=!1;for(n=1;n<e.length-1;)0===e[n-1][0]&&0===e[n+1][0]&&(e[n][1].substring(e[n][1].length-e[n-1][1].length)===e[n-1][1]?(e[n][1]=e[n-1][1]+e[n][1].substring(0,e[n][1].length-e[n-1][1].length),e[n+1][1]=e[n-1][1]+e[n+1][1],e.splice(n-1,1),d=!0):e[n][1].substring(0,e[n+1][1].length)==e[n+1][1]&&(e[n-1][1]+=e[n+1][1],e[n][1]=e[n][1].substring(e[n+1][1].length)+e[n+1][1],e.splice(n+1,1),d=!0)),n++;d&&rZ(e,t)}function rJ(e){return e>=55296&&e<=56319}function r0(e){return e>=56320&&e<=57343}function r1(e){return r0(e.charCodeAt(0))}function r2(e){return rJ(e.charCodeAt(e.length-1))}function r5(e,t,r,n){return r2(e)||r1(n)?null:function(e){for(var t=[],r=0;r<e.length;r++)e[r][1].length>0&&t.push(e[r]);return t}([[0,e],[-1,t],[1,r],[0,n]])}function r3(e,t,r,n){return r$(e,t,r,n,!0)}r3.INSERT=1,r3.DELETE=-1,r3.EQUAL=0;let r4=/* @__PURE__ */rB(r3);function r6(e,t){let r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)}function r9(e){return["true","false"].includes(e.toLowerCase())}let r7="__INTERNAL_EDITOR__",r8=`${r7}DOCS_NORMAL`,ne=`${r7}DOCS_FORMULA_BAR`,nt=`${r7}ZEN_EDITOR`,nr=`\r
`,nn="isRowStylePrecedeColumnStyle";function ni(e){return`${r7}${e}`}function ns(e){return e.startsWith(r7)}var na=Symbol("$$IDENTIFIER_DECORATOR");function no(e){return"function"==typeof e}function nl(e){return!!(e&&"u">typeof e.useClass)}function nu(e){return!!(e&&"u">typeof e.useFactory)}function nc(e){return!!(e&&"u">typeof e.useValue)}function nh(e){return!!(e&&"u">typeof e.useAsync)}var nd=Symbol("AsyncHook");function nm(e){return!!(e&&e.__symbol===nd)}function ng(e){return typeof e>"u"?"undefined":no(e)&&!e[na]?e.name:e.toString()}(oH=le||(le={})).MANY="many",oH.OPTIONAL="optional",oH.REQUIRED="required",(oW=lt||(lt={})).SELF="self",oW.SKIP_SELF="skipSelf";var nf=(oG=function(e,t){return(oG=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oG(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),np=function(e){function t(t){return e.call(this,"[redi]: ".concat(t))||this}return nf(t,e),t}(Error),nC=(oY=function(e,t){return(oY=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oY(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n_=Symbol("$$TARGET"),ny=Symbol("$$DEPENDENCIES"),nE=function(e){function t(t,r){var n="Could not find dependency registered on the ".concat(t,' (indexed) parameter of the constructor of "').concat(ng(r),'".');return e.call(this,n)||this}return nC(t,e),t}(np),nb=function(e){function t(t,r){var n='It seems that you register "undefined" as dependency on the '.concat(r+1,' parameter of "').concat(ng(t),'". Please make sure that there is not cyclic dependency among your TypeScript files, or consider using "forwardRef". For more info please visit our website https://redi.wendell.fun/docs/debug#could-not-find-dependency-registered-on');return e.call(this,n)||this}return nC(t,e),t}(np);function nR(e,t){var r=(e[ny]||[]).find(function(e){return e.paramIndex===t});if(!r)throw new nE(t,e);return r}function nN(e,t,r,n,i){void 0===n&&(n=le.REQUIRED);var s={paramIndex:r,identifier:t,quantity:n,lookUp:i,withNew:!1};if(typeof t>"u")throw new nb(e,r);e[n_]===e?e[ny].push(s):(e[ny]=[s],e[n_]=e)}var nI=/* @__PURE__ */new Set;function nA(e){if(nI.has(e))throw new np('Identifier "'.concat(e,'" already exists.'));nI.add(e);var t=function(e,r,n){nN(e,t,n)};return t.toString=function(){return e},t[na]=!0,t}var nv=(oz=function(e,t){return(oz=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oz(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),nS=function(e){function t(t,r,n){var i='Expect "'.concat(r,'" dependency items for id "').concat(ng(t),'" but get ').concat(n,".");return e.call(this,i)||this}return nv(t,e),t}(np);function nT(e,t,r){if(t===le.OPTIONAL&&r>1||t===le.REQUIRED&&1!==r)throw new nS(e,t,r)}function nO(e){return function t(r){return this instanceof t?this:function(t,n,i){if(r)nN(t,r,i,e);else{if(e===le.REQUIRED)throw new nb(t,i);nR(t,i).quantity=e}}}}var nM=nO(le.MANY),nw=nO(le.OPTIONAL),nx=nO(le.REQUIRED);function nU(e){return!!e&&"function"==typeof e.dispose}var nD=(oq=function(e,t){return(oq=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oq(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),nV=[],nL=function(e){function t(t,r,n){var i='Cannot find "'.concat(ng(r),'" registered by any injector. It is the ').concat(n,'th param of "').concat(t&&!0===t[na]?ng(t):t.name,'".');return e.call(this,i)||this}return nD(t,e),t}(np),nP=function(e){function t(t){var r=this,n='Cannot find "'.concat(ng(t),'" registered by any injector. The stack of dependencies is: "').concat(nV.map(function(e){return ng(e)}).join(" -> "),'".');return r=e.call(this,n)||this,nV.length=0,r}return nD(t,e),t}(np),nj=function(){function e(e){var t=this;this.dependencyMap=/* @__PURE__ */new Map,this.normalizeDependencies(e).map(function(e){return t.add(e[0],e[1])})}return e.prototype.add=function(e,t){typeof t>"u"&&(t={useClass:e,lazy:!1});var r=this.dependencyMap.get(e);typeof r>"u"&&(r=[],this.dependencyMap.set(e,r)),r.push(t)},e.prototype.delete=function(e){this.dependencyMap.delete(e)},e.prototype.get=function(e,t){void 0===t&&(t=le.REQUIRED);var r=this.dependencyMap.get(e);return nT(e,t,r.length),t===le.MANY?r:r[0]},e.prototype.has=function(e){return this.dependencyMap.has(e)},e.prototype.append=function(e){var t=this;this.normalizeDependencies(e).forEach(function(e){return t.add(e[0],e[1])})},e.prototype.dispose=function(){this.dependencyMap.clear()},e.prototype.normalizeDependencies=function(e){return e.map(function(e){return[e[0],1===e.length?{useClass:e[0],lazy:!1}:e[1]]})},e}(),nF=function(){function e(){this.resolvedDependencies=/* @__PURE__ */new Map}return e.prototype.add=function(e,t){var r=this.resolvedDependencies.get(e);typeof r>"u"&&(r=[],this.resolvedDependencies.set(e,r)),r.push(t)},e.prototype.has=function(e){return this.resolvedDependencies.has(e)},e.prototype.delete=function(e){this.resolvedDependencies.has(e)&&(this.resolvedDependencies.get(e).forEach(function(e){return nU(e)?e.dispose():void 0}),this.resolvedDependencies.delete(e))},e.prototype.get=function(e,t){void 0===t&&(t=le.REQUIRED);var r=this.resolvedDependencies.get(e);if(!r)throw new nP(e);return nT(e,t,r.length),t===le.MANY?r:r[0]},e.prototype.dispose=function(){Array.from(this.resolvedDependencies.values()).forEach(function(e){e.forEach(function(e){return nU(e)?e.dispose():void 0})}),this.resolvedDependencies.clear()},e}();function nk(e){return function t(){return this instanceof t?this:function(t,r,n){nR(t,n).lookUp=e}}}var nB=nk(lt.SKIP_SELF),n$=nk(lt.SELF),nH=function e(){return this instanceof e?this:function(e,t,r){nR(e,r).withNew=!0}};!function(){if("u">typeof requestIdleCallback&&"u">typeof cancelIdleCallback)lr=function(e,t){var r=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0),n=!1;return function(){n||(n=!0,cancelIdleCallback(r))}};else{var e=Object.freeze({didTimeout:!0,timeRemaining:function(){return 15}});lr=function(t){var r=setTimeout(function(){return t(e)}),n=!1;return function(){n||(n=!0,clearTimeout(r))}}}}();var nW=function(){function e(e){var t=this;this.didRun=!1,this.selfExecutor=function(){try{t.value=e()}catch(e){t.error=e}finally{t.didRun=!0}},this.disposeCallback=lr(function(){return t.selfExecutor()})}return e.prototype.hasRun=function(){return this.didRun},e.prototype.dispose=function(){this.disposeCallback()},e.prototype.getValue=function(){if(this.didRun||(this.dispose(),this.selfExecutor()),this.error)throw this.error;return this.value},e}(),nG=(oX=function(e,t){return(oX=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oX(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),nY=function(){return(nY=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},nz=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},nq=Symbol("$$NOT_INSTANTIATED_SYMBOL"),nX=function(e){function t(t){return e.call(this,'Detecting cyclic dependency. The last identifier is "'.concat(ng(t),'".'))||this}return nG(t,e),t}(np),nK=function(e){function t(){return e.call(this,"Injector cannot be accessed after it was disposed.")||this}return nG(t,e),t}(np),nQ=function(e){function t(t){return e.call(this,'Async item "'.concat(ng(t),'" returns another async item.'))||this}return nG(t,e),t}(np),nZ=function(e){function t(t){return e.call(this,'Cannot get async item "'.concat(ng(t),'" from sync api.'))||this}return nG(t,e),t}(np),nJ=function(e){function t(t){return e.call(this,'Cannot add dependency "'.concat(ng(t),'" after it is already resolved.'))||this}return nG(t,e),t}(np),n0=function(e){function t(t){return e.call(this,'Cannot dependency dependency "'.concat(ng(t),'" after it is already resolved.'))||this}return nG(t,e),t}(np),n1=function(){function e(e,t){void 0===t&&(t=null),this.parent=t,this.children=[],this.resolutionOngoing=0,this.disposed=!1,this.dependencyCollection=new nj(e||[]),this.resolvedDependencyCollection=new nF,t&&t.children.push(this)}return e.prototype.createChild=function(t){return this._ensureInjectorNotDisposed(),new e(t,this)},e.prototype.dispose=function(){this.children.forEach(function(e){return e.dispose()}),this.children.length=0,this.dependencyCollection.dispose(),this.resolvedDependencyCollection.dispose(),this.deleteSelfFromParent(),this.disposed=!0},e.prototype.deleteSelfFromParent=function(){if(this.parent){var e=this.parent.children.indexOf(this);e>-1&&this.parent.children.splice(e,1)}},e.prototype.add=function(e){this._ensureInjectorNotDisposed();var t=e[0],r=e[1];if(this.resolvedDependencyCollection.has(t))throw new nJ(t);typeof r>"u"?this.dependencyCollection.add(t):nh(r)||nl(r)||nc(r)||nu(r)?this.dependencyCollection.add(t,r):this.resolvedDependencyCollection.add(t,r)},e.prototype.replace=function(e){this._ensureInjectorNotDisposed();var t=e[0];if(this.resolvedDependencyCollection.has(t))throw new nJ(t);this.dependencyCollection.delete(t),1===e.length?this.dependencyCollection.add(t):this.dependencyCollection.add(t,e[1])},e.prototype.delete=function(e){if(this._ensureInjectorNotDisposed(),this.resolvedDependencyCollection.has(e))throw new n0(e);this.dependencyCollection.delete(e)},e.prototype.invoke=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return this._ensureInjectorNotDisposed(),e.apply(void 0,nz([{get:function(e,r,n){return t._get(e,r,n)},has:function(e){return t.has(e)}}],r,!1))},e.prototype.has=function(e){var t;return this.dependencyCollection.has(e)||(null===(t=this.parent)||void 0===t?void 0:t.has(e))||!1},e.prototype.get=function(e,t,r){this._ensureInjectorNotDisposed();var n=this._get(e,t,r);if(Array.isArray(n)&&n.some(function(e){return nm(e)})||nm(n))throw new nZ(e);return n},e.prototype._get=function(e,t,r,n){var i=le.REQUIRED;if(t===le.REQUIRED||t===le.OPTIONAL||t===le.MANY?i=t:r=t,!n){var s=this.getValue(e,i,r);if(s!==nq)return s}return this.createDependency(e,i,r,!n)},e.prototype.getAsync=function(e){this._ensureInjectorNotDisposed();var t=this.getValue(e,le.REQUIRED);if(t!==nq)return Promise.resolve(t);var r=this.createDependency(e,le.REQUIRED);return nm(r)?r.whenReady():Promise.resolve(r)},e.prototype.createInstance=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this._ensureInjectorNotDisposed(),this._resolveClassImpl.apply(this,nz([{useClass:e}],t,!1))},e.prototype._resolveDependency=function(e,t,r){var n;void 0===r&&(r=!0),nV.push(e);try{n=nc(t)?this._resolveValueDependency(e,t):nu(t)?this._resolveFactory(e,t,r):nl(t)?this._resolveClass(e,t,r):t&&"u">typeof t.useExisting?this._resolveExisting(e,t):this._resolveAsync(e,t),nV.pop()}catch(e){throw nV.pop(),e}return n},e.prototype._resolveExisting=function(e,t){var r=this.get(t.useExisting);return this.resolvedDependencyCollection.add(e,r),r},e.prototype._resolveValueDependency=function(e,t){var r=t.useValue;return this.resolvedDependencyCollection.add(e,r),r},e.prototype._resolveClass=function(e,t,r){var n,i=this;if(void 0===r&&(r=!0),t.lazy){var s=new nW(function(){return i._ensureInjectorNotDisposed(),i._resolveClassImpl(t)});n=new Proxy(/* @__PURE__ */Object.create(null),{get:function(e,t){if(t in e)return e[t];if("whenReady"!==t){var r=s.getValue(),n=r[t];return"function"!=typeof n||(n=n.bind(r),e[t]=n),n}},set:function(e,t,r){return s.getValue()[t]=r,!0}})}else n=this._resolveClassImpl(t);return e&&r&&this.resolvedDependencyCollection.add(e,n),n},e.prototype._resolveClassImpl=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=e.useClass;this.markNewResolution(i);for(var s=(i[ny]||[]).sort(function(e,t){return e.paramIndex-t.paramIndex}).map(function(e){var t,r;return nY(nY({},e),{identifier:(r=t=e.identifier)&&"function"==typeof r.unwrap?t.unwrap():t})}),a=[],o=0;o<s.length;o++){var l=s[o];try{var u=this._get(l.identifier,l.quantity,l.lookUp,l.withNew);a.push(u)}catch(e){throw e instanceof nP?new nL(i,l.identifier,l.paramIndex):e}}var c=nz([],r,!0),h=s.length>0?s[0].paramIndex:c.length;if(c.length!==h){console.warn("[redi]: Expect ".concat(h," custom parameter(s) of ").concat(ng(i)," but get ").concat(c.length,"."));var d=h-c.length;c=d>0?nz(nz([],c,!0),Array(d).fill(void 0),!0):c.slice(0,h)}var m=new(i.bind.apply(i,nz(nz([void 0],c,!1),a,!1)));return null===(t=null==e?void 0:e.onInstantiation)||void 0===t||t.call(e,m),this.markResolutionCompleted(),m},e.prototype._resolveFactory=function(e,t,r){this.markNewResolution(e);for(var n,i,s,a=(n=t.deps,void 0===i&&(i=0),n?n.map(function(e,t){if(t+=i,!Array.isArray(e))return{paramIndex:t,identifier:e,quantity:le.REQUIRED,withNew:!1};var r=e.slice(0,e.length-1),n=e[e.length-1],s=void 0,a=le.REQUIRED,o=!1;return r.forEach(function(e){if(e instanceof n$)s=lt.SELF;else if(e instanceof nB)s=lt.SKIP_SELF;else if(e instanceof nw)a=le.OPTIONAL;else if(e instanceof nM)a=le.MANY;else if(e instanceof nH)o=!0;else throw new np("unknown dep modifier ".concat(e,"."))}),{paramIndex:t,identifier:n,quantity:a,lookUp:s,withNew:o}}):[]),o=[],l=0;l<a.length;l++){var u=a[l];try{var c=this._get(u.identifier,u.quantity,u.lookUp,u.withNew);o.push(c)}catch(t){throw t instanceof nP?new nL(e,u.identifier,u.paramIndex):t}}var h=t.useFactory.apply(null,o);return r&&this.resolvedDependencyCollection.add(e,h),this.markResolutionCompleted(),null===(s=null==t?void 0:t.onInstantiation)||void 0===s||s.call(t,h),h},e.prototype._resolveAsync=function(e,t){var r=this;return{__symbol:nd,whenReady:function(){return r._resolveAsyncImpl(e,t)}}},e.prototype._resolveAsyncImpl=function(e,t){var r=this;return t.useAsync().then(function(n){var i,s=r.getValue(e);if(s!==nq)return s;if(Array.isArray(n)){var a=n[1];if(nh(a))throw new nQ(e);i=r._resolveDependency(e,a)}else i=no(n)?r._resolveClassImpl({useClass:n,onInstantiation:t.onInstantiation}):n;return r.resolvedDependencyCollection.add(e,i),i})},e.prototype.getValue=function(e,t,r){var n=this;void 0===t&&(t=le.REQUIRED);var i=function(){return n.parent?n.parent.getValue(e,t):nq};return r===lt.SKIP_SELF?i():r===lt.SELF||this.resolvedDependencyCollection.has(e)||this.dependencyCollection.has(e)?n.dependencyCollection.has(e)&&!n.resolvedDependencyCollection.has(e)?nq:n.resolvedDependencyCollection.get(e,t):i()},e.prototype.createDependency=function(t,r,n,i){var s,a,o=this;void 0===r&&(r=le.REQUIRED),void 0===i&&(i=!0);var l=function(){if(o.parent)return o.parent.createDependency(t,r,void 0,i);if(r===le.OPTIONAL)return null;throw nV.push(t),new nP(t)};return n===lt.SKIP_SELF?l():t===e?this:this.dependencyCollection.has(t)?(s=o.dependencyCollection.get(t,r),a=null,Array.isArray(s)?a=s.map(function(e){return o._resolveDependency(t,e,i)}):s&&(a=o._resolveDependency(t,s,i)),a):l()},e.prototype.markNewResolution=function(e){if(this.resolutionOngoing+=1,this.resolutionOngoing>=300)throw new nX(e)},e.prototype.markResolutionCompleted=function(){this.resolutionOngoing-=1},e.prototype._ensureInjectorNotDisposed=function(){if(this.disposed)throw new nK},e}(),n2="u">typeof globalThis&&globalThis||"u">typeof window&&window||"u">typeof t&&t,n5="REDI_GLOBAL_LOCK",n3="u">typeof e8&&null!=e8.versions&&null!=e8.versions.node;n2[n5]?n3||console.error(`[redi]: You are loading scripts of redi more than once! This may cause undesired behavior in your application.
Maybe your dependencies added redi as its dependency and bundled redi to its dist files. Or you import different versions of redi.
For more info please visit our website: https://redi.wendell.fun/en-US/docs/debug#import-scripts-of-redi-more-than-once`):n2[n5]=!0;var n4="REDI_CONTEXT_LOCK",n6="u">typeof e8&&null!=e8.versions&&null!=e8.versions.node,n9="u">typeof globalThis&&globalThis||"u">typeof window&&window||"u">typeof t&&t;n9[n4]?n6||console.error('[redi]: "RediContext" is already created. You may import "RediContext" from different paths. Use "import { RediContext } from \'@wendellhu/redi/react-bindings\'; instead."'):n9[n4]=!0;var n7=e7.createContext({injector:null});n7.displayName="RediContext";var n8=n7.Provider,ie=(n7.Consumer,oK=function(e,t){return(oK=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oK(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),it=function(e){function t(){return e.call(this,"Using dependency injection outside of a RediContext.")||this}return ie(t,e),t}(np);function ir(){var e=e7.useContext(n7);if(!e.injector)throw new it;return e.injector}function ii(e,t,r){var n=ir();return e7.useMemo(function(){return n.get(e,t,r)},[e,t,r])}var is=function(){return(is=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function ia(e,t){return function(r){return e7.createElement(n8,{value:{injector:t}},e7.createElement(e,is({},r)))}}(oQ=function(e,t){return(oQ=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}oQ(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(function(e){return oD.call(this,'You should make "RediContext" as '.concat(e.constructor.name,"'s default context type. ")+"If you want to use multiple context, please check this on React doc site. https://reactjs.org/docs/context.html#classcontexttype")||this},oD=np);var io=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))};function il(e){return"function"==typeof e?e():e}function iu(e,t,r,n){if("function"==typeof e&&!n)throw new np("Expected deps to be provided when observable is a function!");var i,s=(0,e7.useRef)(null),a=(0,e7.useRef)(!1),o=(0,e7.useMemo)(function(){return e},io([],"u">typeof n?n:[e],!0)),l=(0,e7.useState)(0);l[0];var u=l[1],c=(0,e7.useRef)((o&&il(o).subscribe(function(e){a.current=!0,i=e}).unsubscribe(),null!=i?i:t));if((0,e7.useEffect)(function(){var e=null;return o&&(s.current=il(o),e=s.current.subscribe(function(e){c.current=e,u(function(e){return e+1})})),function(){return null==e?void 0:e.unsubscribe()}},[o]),r&&!a.current)throw Error("Expect `shouldHaveSyncValue` but not getting a sync value!");return c.current}function ic(e,t){t.forEach(t=>e.add(t))}function ih(e,t){t.forEach(([t])=>{e.has(t)&&e.get(t)})}class id extends Error{constructor(e){super(e),this.name="CustomCommandExecutionError"}}var im=((s=im||{})[s.Style=1]="Style",s[s.Value=2]="Value",s);function ig(e){return`sheet_interceptor_${e}`}let ip=e=>function(t,r){let n=-1,i=t;for(let t=0;t<=e.length;t++){if(t<=n)throw Error("[SheetInterceptorService]: next() called multiple times!");if(n=t,t===e.length)break;let s=e[t],a=!1;if(i=s.handler(i,r,e=>(a=!0,e)),!a)break}return i};class iC{constructor(e){tr(this,"_interceptorsByName",/* @__PURE__ */new Map),tr(this,"_interceptorPoints"),this._interceptorPoints=e}fetchThroughInterceptors(e){return ip(this._interceptorsByName.get(e)||[])}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);return r.push(t),this._interceptorsByName.set(e,r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)})),()=>r6(this._interceptorsByName.get(e),t)}getInterceptPoints(){return this._interceptorPoints}dispose(){this._interceptorsByName.clear()}}class i_{constructor(){tr(this,"cursor",0)}reset(){return this.cursor=0,this}moveCursor(e){this.cursor+=e}moveCursorTo(e){this.cursor=e}}let iy=class e{constructor(){let t=this;e._constructorQueue.forEach(function(e){e.apply(t)})}_initialize(){}static extend(t){Object.getOwnPropertyNames(t.prototype).forEach(r=>{"_initialize"===r?e._constructorQueue.push(t.prototype._initialize):"constructor"!==r&&(this.prototype[r]=t.prototype[r])}),Object.getOwnPropertyNames(t).forEach(e=>{"prototype"!==e&&"name"!==e&&"length"!==e&&(this[e]=t[e])})}};tr(iy,"_constructorQueue",[]);let iE=iy;async function ib(e){for(let[t,r]of e.entries())try{if(!await r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}function iR(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function iN(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a}function iI(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function iA(e){return"function"==typeof e}var iv=((oV=function(e){Error.call(e),e.stack=Error().stack},oZ=function(e){oV(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(e,t){return t+1+") "+e.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}).prototype=Object.create(Error.prototype),oZ.prototype.constructor=oZ,oZ);function iS(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}var iT=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){var e,t,r,n,i;if(!this.closed){this.closed=!0;var s=this._parentage;if(s){if(this._parentage=null,Array.isArray(s))try{for(var a=iR(s),o=a.next();!o.done;o=a.next())o.value.remove(this)}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}else s.remove(this)}var l=this.initialTeardown;if(iA(l))try{l()}catch(e){i=e instanceof iv?e.errors:[e]}var u=this._finalizers;if(u){this._finalizers=null;try{for(var c=iR(u),h=c.next();!h.done;h=c.next()){var d=h.value;try{iO(d)}catch(e){i=null!=i?i:[],e instanceof iv?i=iI(iI([],iN(i)),iN(e.errors)):i.push(e)}}}catch(e){r={error:e}}finally{try{h&&!h.done&&(n=c.return)&&n.call(c)}finally{if(r)throw r.error}}}if(i)throw new iv(i)}},t.prototype.add=function(e){var r;if(e&&e!==this){if(this.closed)iO(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&iS(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&iS(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}();function iO(e){iA(e)?e():e.unsubscribe()}function iM(e){let t=!1;return e?e instanceof iT||e&&"closed"in e&&iA(e.remove)&&iA(e.add)&&iA(e.unsubscribe)?{dispose:()=>e.unsubscribe()}:"function"==typeof e?{dispose:()=>{t||(t=!0,e())}}:e:iM(()=>{})}iT.EMPTY;class iw{constructor(){tr(this,"_disposables",/* @__PURE__ */new Set)}add(e){let t=iM(e);return this._disposables.add(t),{dispose:()=>{t.dispose(),this._disposables.delete(t)}}}dispose(){this._disposables.forEach(e=>{e.dispose()}),this._disposables.clear()}}class ix{constructor(){tr(this,"_disposed",!1),tr(this,"_collection",new iw)}disposeWithMe(e){return this._collection.add(e)}ensureNotDisposed(){if(this._disposed)throw Error("[Disposable]: object is disposed!")}dispose(){this._disposed||(this._disposed=!0,this._collection.dispose())}}class iU extends ix{constructor(){super(...arguments),tr(this,"dispose$",new e9.Subject)}dispose(){super.dispose(),this.dispose$.next(),this.dispose$.complete()}}let iD=nA("univer.context-service");class iV extends ix{constructor(){super(...arguments),tr(this,"_contextChanged$",new e9.Subject),tr(this,"contextChanged$",this._contextChanged$.asObservable()),tr(this,"_contextMap",/* @__PURE__ */new Map)}dispose(){super.dispose(),this._contextChanged$.complete()}getContextValue(e){var t;return null!=(t=this._contextMap.get(e))&&t}setContextValue(e,t){this._contextMap.set(e,t),this._contextChanged$.next({[e]:t})}subscribeContextValue$(e){return new e3.Observable(t=>{let r=this._contextChanged$.pipe((0,e1.filter)(t=>"u">typeof t[e])).subscribe(r=>t.next(r[e]));return this._contextMap.has(e)&&t.next(this._contextMap.get(e)),()=>r.unsubscribe()})}}var iL=((a=iL||{})[a.SILENT=0]="SILENT",a[a.ERROR=1]="ERROR",a[a.WARN=2]="WARN",a[a.INFO=3]="INFO",a[a.VERBOSE=4]="VERBOSE",a);let iP=nA("univer.log");class ij extends ix{constructor(){super(...arguments),tr(this,"_logLevel",3)}debug(...e){this._logLevel>=4&&this._log(console.debug,...e)}log(...e){this._logLevel>=3&&this._log(console.log,...e)}warn(...e){this._logLevel>=2&&this._log(console.warn,...e)}error(...e){this._logLevel>=1&&this._log(console.error,...e)}setLogLevel(e){this._logLevel=e}_log(e,...t){let r=t[0];/^\[(.*?)\]/g.test(r)?e(`\x1b[97;104m${r}\x1b[0m`,...t.slice(1)):e(...t)}}var iF=Object.defineProperty,ik=Object.getOwnPropertyDescriptor,iB=(e,t)=>(r,n)=>t(r,n,e),i$=((o=i$||{})[o.COMMAND=0]="COMMAND",o[o.OPERATION=1]="OPERATION",o[o.MUTATION=2]="MUTATION",o);let iH=nA("anywhere.command-service");class iW{constructor(){tr(this,"_commands",/* @__PURE__ */new Map),tr(this,"_commandTypes",/* @__PURE__ */new Map)}registerCommand(e){if(this._commands.has(e.id))throw Error(`[CommandRegistry]: command "${e.id}" has been registered before.`);return this._commands.set(e.id,e),this._commandTypes.set(e.id,e.type),iM(()=>{this._commands.delete(e.id),this._commandTypes.delete(e.id)})}hasCommand(e){return this._commands.has(e)}getCommand(e){return this._commands.has(e)?[this._commands.get(e)]:null}getCommandType(e){return this._commandTypes.get(e)}}let iG={id:"nil",type:0,handler:()=>!0},iY=class extends ix{constructor(e,t){super(),tr(this,"_commandRegistry"),tr(this,"_beforeCommandExecutionListeners",[]),tr(this,"_commandExecutedListeners",[]),tr(this,"_multiCommandDisposables",/* @__PURE__ */new Map),tr(this,"_commandExecutingLevel",0),tr(this,"_commandExecutionStack",[]),this._injector=e,this._logService=t,this._commandRegistry=new iW,this._registerCommand(iG)}dispose(){super.dispose(),this._commandExecutedListeners.length=0,this._beforeCommandExecutionListeners.length=0}hasCommand(e){return this._commandRegistry.hasCommand(e)}registerCommand(e){return this._registerCommand(e)}registerMultipleCommand(e){return this._registerMultiCommand(e)}beforeCommandExecuted(e){if(-1===this._beforeCommandExecutionListeners.indexOf(e))return this._beforeCommandExecutionListeners.push(e),iM(()=>{let t=this._beforeCommandExecutionListeners.indexOf(e);this._beforeCommandExecutionListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}onCommandExecuted(e){if(-1===this._commandExecutedListeners.indexOf(e))return this._commandExecutedListeners.push(e),iM(()=>{let t=this._commandExecutedListeners.indexOf(e);this._commandExecutedListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}async executeCommand(e,t,r){try{let n=this._commandRegistry.getCommand(e);if(n){let[e]=n,i={id:e.id,type:e.type,params:t},s=this._pushCommandExecutionStack(i);this._beforeCommandExecutionListeners.forEach(e=>e(i,r));let a=await this._execute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(i,r)),s.dispose(),a}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof id)return!1;throw e}}syncExecuteCommand(e,t,r){var n;try{let i=this._commandRegistry.getCommand(e);if(i){let[e]=i,s={id:e.id,type:e.type,params:t};if(2===e.type){let e=function(e,t){for(let r=e.length-1;r>-1;r--){let n=e[r];if(t(n,r))return n}return null}(this._commandExecutionStack,e=>0===e.type);e&&(s.params=null!=(n=s.params)?n:{},s.params.trigger=e.id)}let a=this._pushCommandExecutionStack(s);this._beforeCommandExecutionListeners.forEach(e=>e(s,r));let o=this._syncExecute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(s,r)),a.dispose(),o}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof id)return!1;throw e}}_pushCommandExecutionStack(e){return this._commandExecutionStack.push(e),iM(()=>r6(this._commandExecutionStack,e))}_registerCommand(e){return this._commandRegistry.registerCommand(e)}_registerMultiCommand(e){let t;let r=this._commandRegistry.getCommand(e.id);if(r){if(!0!==r[0].multi)throw Error("Command has registered as a single command.");t=r[0]}else{let r=new iw;t=new iz(e.id),r.add(this._commandRegistry.registerCommand(t)),r.add(iM(()=>{this._multiCommandDisposables.delete(e.id)})),this._multiCommandDisposables.set(e.id,r)}let n=t.registerImplementation(e);return iM(()=>{var r;n.dispose(),t.hasImplementations()||null==(r=this._multiCommandDisposables.get(e.id))||r.dispose()})}async _execute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(this._commandExecutingLevel,0))}executing command "${e.id}"`),this._commandExecutingLevel++;try{n=await this._injector.invoke(e.handler,t,r),this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}_syncExecute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(0,this._commandExecutingLevel))}executing command "${e.id}".`),this._commandExecutingLevel++;try{if((n=this._injector.invoke(e.handler,t,r))instanceof Promise)throw TypeError("[CommandService]: Command handler should not return a promise.");this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}};iY=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ik(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iF(t,r,s),s})([iB(0,nx(n1)),iB(1,iP)],iY);class iz{constructor(e){tr(this,"name"),tr(this,"multi",!0),tr(this,"type",0),tr(this,"priority",0),tr(this,"_implementations",[]),tr(this,"handler",async(e,t)=>{if(!this._implementations.length)return!1;let r=e.get(iP),n=e.get(iD),i=e.get(n1);for(let e of this._implementations){let s=e.command.preconditions;if((!s||s&&s(n))&&(r.debug("[MultiCommand]",`executing implementation "${e.command.name}".`),await i.invoke(e.command.handler,t)))return!0}return!1}),this.id=e,this.name=e}registerImplementation(e){let t={command:e};return this._implementations.push(t),this._implementations.sort((e,t)=>t.command.priority-e.command.priority),iM(()=>{let e=this._implementations.indexOf(t);this._implementations.splice(e,1)})}hasImplementations(){return this._implementations.length>0}}function iq(e,t,r){return function(e){for(let[t,r]of e.entries())try{if(!r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}(e.map(e=>()=>t.syncExecuteCommand(e.id,e.params,r)))}function iX(e,t,r){return ib(e.map(e=>()=>t.executeCommand(e.id,e.params,r)))}function iK(e,t,r=!1){let n=e.length-1;if(t<0||t<e[0])return 0;if(n=e.length<40||t<=e[20]||t>=e[n-20]?function(e,t){let r=0,n=e.length-1;if(t<e[0])return 0;if(t>=e[e.length-1])return e.length-1;for(;r<=n;){if(e[r]===t){for(;r<e.length&&e[r]===t;)r++;return r}if(t>e[r]&&t<e[r+1])return r+1;if(e[n]===t){for(;n<e.length&&e[n]===t;)n++;return n}if(t>e[n-1]&&t<e[n])return n;r++,n--}return -1}(e,t):function(e,t){let r=0,n=e.length;for(;r<n;){let i=Math.floor((r+n)/2);e[i]<=t?r=i+1:n=i}return r<e.length?r:e.length-1}(e,t),r){let t=e[n];return e.indexOf(t)}return n}let iQ=2;var iZ=((l=iZ||{})[l.DEFAULT_SERIES=0]="DEFAULT_SERIES",l[l.ALTERNATE_SERIES=1]="ALTERNATE_SERIES",l),iJ=((u=iJ||{})[u.NONE=0]="NONE",u[u.THIN=1]="THIN",u[u.HAIR=2]="HAIR",u[u.DOTTED=3]="DOTTED",u[u.DASHED=4]="DASHED",u[u.DASH_DOT=5]="DASH_DOT",u[u.DASH_DOT_DOT=6]="DASH_DOT_DOT",u[u.DOUBLE=7]="DOUBLE",u[u.MEDIUM=8]="MEDIUM",u[u.MEDIUM_DASHED=9]="MEDIUM_DASHED",u[u.MEDIUM_DASH_DOT=10]="MEDIUM_DASH_DOT",u[u.MEDIUM_DASH_DOT_DOT=11]="MEDIUM_DASH_DOT_DOT",u[u.SLANT_DASH_DOT=12]="SLANT_DASH_DOT",u[u.THICK=13]="THICK",u),i0=((c=i0||{}).TOP="top",c.BOTTOM="bottom",c.LEFT="left",c.RIGHT="right",c.NONE="none",c.ALL="all",c.OUTSIDE="outside",c.INSIDE="inside",c.HORIZONTAL="horizontal",c.VERTICAL="vertical",c.TLBR="tlbr",c.TLBC_TLMR="tlbc_tlmr",c.TLBR_TLBC_TLMR="tlbr_tlbc_tlmr",c.BLTR="bl_tr",c.MLTR_BCTR="mltr_bctr",c),i1=((h=i1||{})[h.UNSUPPORTED=0]="UNSUPPORTED",h[h.RGB=1]="RGB",h[h.HEX=2]="HEX",h[h.THEME=3]="THEME",h),i2=((d=i2||{})[d.ON=0]="ON",d[d.OFF=1]="OFF",d),i5=((m=i5||{})[m.PASTE_NORMAL=0]="PASTE_NORMAL",m[m.PASTE_NO_BORDERS=1]="PASTE_NO_BORDERS",m[m.PASTE_FORMAT=2]="PASTE_FORMAT",m[m.PASTE_FORMULA=3]="PASTE_FORMULA",m[m.PASTE_DATA_VALIDATION=4]="PASTE_DATA_VALIDATION",m[m.PASTE_VALUES=5]="PASTE_VALUES",m[m.PASTE_CONDITIONAL_FORMATTING=6]="PASTE_CONDITIONAL_FORMATTING",m[m.PASTE_COLUMN_WIDTHS=7]="PASTE_COLUMN_WIDTHS",m),i3=((g=i3||{})[g.LEFT=0]="LEFT",g[g.RIGHT=1]="RIGHT",g),i4=((f=i4||{})[f.DOCUMENT=0]="DOCUMENT",f[f.PROJECT=1]="PROJECT",f),i6=((p=i6||{})[p.COLUMNS=0]="COLUMNS",p[p.ROWS=1]="ROWS",p),i9=((C=i9||{})[C.UP=0]="UP",C[C.RIGHT=1]="RIGHT",C[C.DOWN=2]="DOWN",C[C.LEFT=3]="LEFT",C);function i7(e){switch(e){case 3:return 1;case 1:return 3;case 0:return 2;case 2:return 0}}var i8=((_=i8||{})[_.NUMBER_FORMAT_TYPE_UNSPECIFIED=0]="NUMBER_FORMAT_TYPE_UNSPECIFIED",_[_.TEXT=1]="TEXT",_[_.NUMBER=2]="NUMBER",_[_.PERCENT=3]="PERCENT",_[_.CURRENCY=4]="CURRENCY",_[_.DATE=5]="DATE",_[_.TIME=6]="TIME",_[_.DATE_TIME=7]="DATE_TIME",_[_.SCIENTIFIC=8]="SCIENTIFIC",_),se=((y=se||{})[y.INTERPOLATION_POINT_TYPE_UNSPECIFIED=0]="INTERPOLATION_POINT_TYPE_UNSPECIFIED",y[y.MIN=1]="MIN",y[y.MAX=2]="MAX",y[y.NUMBER=3]="NUMBER",y[y.PERCENT=4]="PERCENT",y[y.PERCENTILE=5]="PERCENTILE",y),st=((E=st||{}).EN_US="enUS",E.ZH_CN="zhCN",E.RU_RU="ruRU",E.ZH_TW="zhTW",E.VI_VN="viVN",E.FA_IR="faIR",E),sr=((b=sr||{})[b.PERSON=0]="PERSON",b[b.FILE=1]="FILE",b[b.DATE=2]="DATE",b[b.LOCATION=3]="LOCATION",b[b.EVENT=4]="EVENT",b),sn=((R=sn||{})[R.RANGE=0]="RANGE",R[R.SHEET=1]="SHEET",R),si=((N=si||{}).Line="line",N.LineInv="lineInv",N.Triangle="triangle",N.RtTriangle="rtTriangle",N.Rect="rect",N.Diamond="diamond",N.Parallelogram="parallelogram",N.Trapezoid="trapezoid",N.NonIsocelesTrapezoid="nonIsocelesTrapezoid",N.Pentagon="pentagon",N.Hexagon="hexagon",N.Heptagon="heptagon",N.Octagon="octagon",N.Decagon="decagon",N.Dodecagon="dodecagon",N.Star4="star4",N.Star5="star5",N.Star6="star6",N.Star7="star7",N.Star8="star8",N.Star10="star10",N.Star12="star12",N.Star16="star16",N.Star24="star24",N.Star32="star32",N.RoundRect="roundRect",N.Round1Rect="round1Rect",N.Round2SameRect="round2SameRect",N.Round2DiagRect="round2DiagRect",N.Ellipse="ellipse",N),ss=((I=ss||{}).RightArrow="rightArrow",I.LeftArrow="leftArrow",I.UpArrow="upArrow",I.DownArrow="downArrow",I.LeftRightArrow="leftRightArrow",I.UpDownArrow="upDownArrow",I.QuadArrow="quadArrow",I.LeftRightUpArrow="leftRightUpArrow",I.BentArrow="bentArrow",I.UturnArrow="uturnArrow",I.CircularArrow="circularArrow",I.NotchedRightArrow="notchedRightArrow",I.HomePlate="homePlate",I.Chevron="chevron",I.LeftCircularArrow="leftCircularArrow",I.LeftRightCircularArrow="leftRightCircularArrow",I),sa=((A=sa||{}).Plaque="plaque",A.Can="can",A.Cube="cube",A.Bevel="bevel",A.Donut="donut",A.NoSmoking="noSmoking",A.BlockArc="blockArc",A.FoldedCorner="foldedCorner",A),so=((v=so||{}).SmileyFace="smileyFace",v.Heart="heart",v.LightningBolt="lightningBolt",v.Sun="sun",v.Moon="moon",v.Cloud="cloud",v.Arc="arc",v.Backpack="backpack",v.Frame="frame",v.HalfFrame="halfFrame",v.Corner="corner",v.Chord="chord",v.Pie="pie",v.Teardrop="teardrop",v.WedgeRectCallout="wedgeRectCallout",v.WedgeRRectCallout="wedgeRRectCallout",v.WedgeEllipseCallout="wedgeEllipseCallout",v.CloudCallout="cloudCallout",v.BorderCallout1="borderCallout1",v.BorderCallout2="borderCallout2",v.BorderCallout3="borderCallout3",v.AccentCallout1="accentCallout1",v.AccentCallout2="accentCallout2",v.AccentCallout3="accentCallout3",v.Callout1="callout1",v.Callout2="callout2",v.Callout3="callout3",v.ActionButtonBackPrevious="actionButtonBackPrevious",v.ActionButtonEnd="actionButtonEnd",v.ActionButtonForwardNext="actionButtonForwardNext",v.ActionButtonHelp="actionButtonHelp",v.ActionButtonHome="actionButtonHome",v.ActionButtonInformation="actionButtonInformation",v.ActionButtonMovie="actionButtonMovie",v.ActionButtonReturn="actionButtonReturn",v.ActionButtonSound="actionButtonSound",v),sl=((S=sl||{})[S.RELATIVE_DATE_UNSPECIFIED=0]="RELATIVE_DATE_UNSPECIFIED",S[S.PAST_YEAR=1]="PAST_YEAR",S[S.PAST_MONTH=2]="PAST_MONTH",S[S.PAST_WEEK=3]="PAST_WEEK",S[S.YESTERDAY=4]="YESTERDAY",S[S.TODAY=5]="TODAY",S[S.TOMORROW=6]="TOMORROW",S),su=((T=su||{})[T.GRID=0]="GRID",T[T.KANBAN=1]="KANBAN",T[T.GANTT=2]="GANTT",T),sc=((O=sc||{})[O.UNSPECIFIED=0]="UNSPECIFIED",O[O.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",O[O.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT",O),sh=((M=sh||{})[M.DASH=0]="DASH",M[M.DASH_DOT_DOT_HEAVY=1]="DASH_DOT_DOT_HEAVY",M[M.DASH_DOT_HEAVY=2]="DASH_DOT_HEAVY",M[M.DASHED_HEAVY=3]="DASHED_HEAVY",M[M.DASH_LONG=4]="DASH_LONG",M[M.DASH_LONG_HEAVY=5]="DASH_LONG_HEAVY",M[M.DOT_DASH=6]="DOT_DASH",M[M.DOT_DOT_DASH=7]="DOT_DOT_DASH",M[M.DOTTED=8]="DOTTED",M[M.DOTTED_HEAVY=9]="DOTTED_HEAVY",M[M.DOUBLE=10]="DOUBLE",M[M.NONE=11]="NONE",M[M.SINGLE=12]="SINGLE",M[M.THICK=13]="THICK",M[M.WAVE=14]="WAVE",M[M.WAVY_DOUBLE=15]="WAVY_DOUBLE",M[M.WAVY_HEAVY=16]="WAVY_HEAVY",M[M.WORDS=17]="WORDS",M),sd=((w=sd||{})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.LEFT=1]="LEFT",w[w.CENTER=2]="CENTER",w[w.RIGHT=3]="RIGHT",w[w.JUSTIFIED=4]="JUSTIFIED",w[w.BOTH=5]="BOTH",w[w.DISTRIBUTED=6]="DISTRIBUTED",w),sm=((x=sm||{})[x.UNSPECIFIED=0]="UNSPECIFIED",x[x.TOP=1]="TOP",x[x.MIDDLE=2]="MIDDLE",x[x.BOTTOM=3]="BOTTOM",x),sg=((U=sg||{})[U.UNSPECIFIED=0]="UNSPECIFIED",U[U.OVERFLOW=1]="OVERFLOW",U[U.CLIP=2]="CLIP",U[U.WRAP=3]="WRAP",U),sf=((D=sf||{})[D.NORMAL=0]="NORMAL",D[D.ITALIC=1]="ITALIC",D),sp=((V=sp||{})[V.NORMAL=0]="NORMAL",V[V.BOLD=1]="BOLD",V),sC=((L=sC||{})[L.NORMAL=1]="NORMAL",L[L.SUBSCRIPT=2]="SUBSCRIPT",L[L.SUPERSCRIPT=3]="SUPERSCRIPT",L),s_=((P=s_||{})[P.FALSE=0]="FALSE",P[P.TRUE=1]="TRUE",P),sy=((j=sy||{})[j.STRING=1]="STRING",j[j.NUMBER=2]="NUMBER",j[j.BOOLEAN=3]="BOOLEAN",j[j.FORCE_STRING=4]="FORCE_STRING",j),sE=((F=sE||{})[F.DARK1=0]="DARK1",F[F.LIGHT1=1]="LIGHT1",F[F.DARK2=2]="DARK2",F[F.LIGHT2=3]="LIGHT2",F[F.ACCENT1=4]="ACCENT1",F[F.ACCENT2=5]="ACCENT2",F[F.ACCENT3=6]="ACCENT3",F[F.ACCENT4=7]="ACCENT4",F[F.ACCENT5=8]="ACCENT5",F[F.ACCENT6=9]="ACCENT6",F[F.HYPERLINK=10]="HYPERLINK",F[F.FOLLOWED_HYPERLINK=11]="FOLLOWED_HYPERLINK",F),sb=((k=sb||{}).OFFICE="Office",k.OFFICE_2007_2010="Office 2007-2010",k.GRAYSCALE="Grayscale",k.BLUE_WARM="Blue Warm",k.BLUE="Blue",k.BLUE_II="Blue II",k.BLUE_GREEN="Blue Green",k.GREEN="Green",k.GREEN_YELLOW="Green Yellow",k.YELLOW="Yellow",k.YELLOW_ORANGE="Yellow Orange",k.ORANGE="Orange",k.ORANGE_RED="Orange Red",k.RED_ORANGE="Red Orange",k.RED="Red",k.RED_VIOLET="Red Violet",k.VIOLET="Violet",k.VIOLET_II="Violet II",k.MEDIAN="Median",k.PAPER="Paper",k.MARQUEE="Marquee",k.SLIPSTREAM="Slipstream",k.Aspect="Aspect",k);let sR=e=>crypto.getRandomValues(new Uint8Array(e)),sN=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return (s=t)=>{let a="";for(;;){let t=r(i),o=i;for(;o--;)if((a+=e[t[o]&n]||"").length===s)return a}}},sI=(e,t=21)=>sN(e,t,sR),sA=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t},sv=/* @__PURE__ */new Set(["ac","ad","ae","aero","af","ag","ai","al","am","ao","aq","ar","arpa","as","asia","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","biz","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cat","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","com","coop","cr","cu","cv","cw","cx","cy","cz","de","dj","dk","dm","do","dz","ec","edu","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gov","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","info","int","io","iq","ir","is","it","je","jm","jo","jobs","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mil","mk","ml","mm","mn","mo","mobi","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","nc","ne","net","nf","ng","ni","nl","no","np","nr","nu","nz","om","onion","org","pa","pe","pf","pg","ph","pk","pl","pm","pn","post","pr","pro","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tel","tf","tg","th","tj","tk","tl","tm","tn","to","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","yt","za","zm","zw"]),sS=RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");function sT(e){return/^[a-zA-Z]+:\/\//.test(e)}function sO(e){return sT(e)?e:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e)?`mailto://${e}`:`https://${e}`}let sM=/^-ms-/,sw=/-([a-z])/g,sx=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];class sU{static stringAt(e){let t="",r=e;for(;r>=sx.length;)r/=sx.length,r-=1,t+=sx[r%sx.length];let n=e%sx.length;return t+sx[n]}static indexAt(e){let t=0;for(let r=0;r<e.length-1;r+=1){let n=e.charCodeAt(r)-65,i=e.length-1-r;t+=sx.length**i+sx.length*n}return t+(e.charCodeAt(e.length-1)-65)}static deleteBlank(e){return sU.isString(e)?e.replace(/\s/g,""):e}static getSystemType(){let e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,r="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(r)return"Mac";if("X11"===navigator.platform&&!t&&!r)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Windows 2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"Windows XP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Windows 2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"Windows Vista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Windows 7";if(e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1)return"Windows 10";if(e.indexOf("Windows NT 11")>-1||e.indexOf("Windows 11")>-1)return"Windows 11"}return"Unknown system"}static getBrowserType(){let e=navigator.userAgent,t=e.indexOf("Opera")>-1,r=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t,n=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1,i=e.indexOf("Edge")>-1,s=e.indexOf("Firefox")>-1,a=e.indexOf("Safari")>-1&&-1===e.indexOf("Chrome"),o=e.indexOf("Chrome")>-1&&e.indexOf("Safari")>-1;if(r){RegExp("MSIE (\\d+\\.\\d+);").test(e);let t=Number.parseFloat(RegExp.$1);return 7===t?"IE7":8===t?"IE8":9===t?"IE9":10===t?"IE10":"0"}return s?"FF":t?"Opera":a?"Safari":o?"Chrome":i?"Edge":n?"IE11":"Unknown browser"}static generateRandomId(e=21,t){return sD(e,t)}static getClassName(e){return e.constructor.name}static deepMerge(e,...t){function r(e,t){e.forEach((e,i)=>{var s,a;if(sU.isArray(e)){let n=null!=(s=t[i])?s:[];t[i]=n,r(e,n);return}if(sU.isObject(e)){let r=null!=(a=t[i])?a:{};t[i]=r,n(e,r);return}t[i]=e})}function n(e,t){Object.keys(e).forEach(i=>{var s,a;let o=e[i];if(sU.isObject(o)){let e=null!=(s=t[i])?s:{};t[i]=e,n(o,e);return}if(sU.isArray(o)){let e=null!=(a=t[i])?a:[];t[i]=e,r(o,e);return}t[i]=o})}return t.forEach(t=>t&&function(t){Object.keys(t).forEach(i=>{var s,a;let o=t[i];if(sU.isArray(o)){let t=null!=(s=e[i])?s:[];e[i]=t,r(o,t);return}if(sU.isObject(o)){let t=null!=(a=e[i])?a:{};e[i]=t,n(o,t);return}e[i]=o})}(t)),e}static numberFixed(e,t){return Number(Number(e).toFixed(t))}static diffValue(e,t){return function e(t,r){return sU.getValueType(t)===sU.getValueType(r)&&(sU.isArray(t)?function(t,r){if(t.length!==r.length)return!1;for(let n=0,i=t.length;n<i;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):sU.isObject(t)?function(t,r){let n=Object.keys(t),i=Object.keys(r);if(n.length!==i.length)return!1;for(let s of n)if(!i.includes(s)||!e(t[s],r[s]))return!1;return!0}(t,r):sU.isDate(t)?t.getTime()===r.getTime():sU.isRegExp(t)?t.toString()===r.toString():t===r)}(e,t)}static deepClone(e){if(!this.isDefine(e))return e;if(this.isRegExp(e))return new RegExp(e);if(this.isDate(e))return new Date(e);if(this.isArray(e)){let t=[];return e.forEach((e,r)=>{t[r]=sU.deepClone(e)}),t}if(this.isObject(e)){let t={};return Object.keys(e).forEach(r=>{let n=e[r];t[r]=sU.deepClone(n)}),Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}static getLanguage(){return globalThis.navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||"en-US"}static getValueType(e){return Object.prototype.toString.apply(e)}static isDefine(e){return null!=e}static isBlank(e){return!this.isDefine(e)||!!this.isString(e)&&""===e.trim()}static isBoolean(e){return"[object Boolean]"===this.getValueType(e)}static isPlainObject(e){return!!this.isDefine(e)&&Object.getPrototypeOf(e)===Object.getPrototypeOf({})}static isFunction(e){return"[object Function]"===this.getValueType(e)}static isDate(e){return"[object Date]"===this.getValueType(e)}static isRegExp(e){return"[object RegExp]"===this.getValueType(e)}static isArray(e){return"[object Array]"===this.getValueType(e)}static isString(e){return"[object String]"===this.getValueType(e)}static isNumber(e){return"[object Number]"===this.getValueType(e)}static isStringNumber(e){return!isNaN(Number.parseFloat(e))&&isFinite(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isEmptyObject(e){for(let t in e)return!1;return!0}static isMobile(){let e=0,t=0;return document.body.clientWidth&&(e=document.body.clientWidth),document.body.clientHeight&&(t=document.body.clientHeight),this.isAndroid()||this.isIPhone()||this.isTablet()||e<350&&t<500}static isTablet(){return/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase())}static isWeChat(){return"micromessenger"===String(navigator.userAgent.toLowerCase().match(/MicroMessenger/i))}static isAndroid(){let e=navigator.userAgent;return e.indexOf("Android")>-1||e.indexOf("Linux")>-1}static isIPhone(){return/iPhone/i.test(navigator.userAgent)}static isLegalUrl(e){return function(e){if(!Number.isNaN(+e))return!1;if(e.startsWith("http://localhost:3002")||e.startsWith("localhost:3002"))return!0;if(sS.test(e)){if(sT(e))return!0;try{let t=new URL(sO(e)).hostname.split(".").pop();if(t&&sv.has(t))return!0}catch{}}return!1}(e)}static normalizeUrl(e){return sO(e)}static topLevelDomainCombiningString(){return[...sv].join("|")}static itCount(e){return t=>{for(let r=0;r<e;r++)t&&t()}}static hasLength(e,t){return!!sU.isDefine(e)&&(sU.isDefine(t)?e.length===t:e.length>0)}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static fCamelCase(e,t){return t.toUpperCase()}static camelCase(e){return e.replace(sM,"ms-").replace(sw,this.fCamelCase)}static removeNull(e){return this.isObject(e)&&Object.keys(e).forEach(t=>{let r=e[t];null==r?delete e[t]:sU.removeNull(r)}),e}static fillTwoDimensionalArray(e,t,r){return Array(e).fill(r).map(e=>Array(t).fill(r))}static numToWord(e){let t="";for(;e>0;){let r=e%26;t=String.fromCharCode(96+(r=0===r?r=26:r))+t,e=(e-r)/26}return t.toLocaleUpperCase()}static ABCatNum(e){if(null==e||0===e.length)return Number.NaN;let t=e.toLowerCase().split(""),r=t.length,n=0;for(let e=0;e<r;e++)n+=(t[e].charCodeAt(0)-96)*26**(r-e-1);return 0===n?Number.NaN:n-1}static chatAtABC(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}static randSort(e){for(let t=0,r=e.length;t<r;t++){let n=Number.parseInt((Math.random()*r).toString()),i=e[n];e[n]=e[t],e[t]=i}return e}static commonExtend(e,t){let r={};for(let t in e)r[t]=e[t];for(let e in t)null!=t[e]&&(r[e]=t[e]);return r}static commonExtend1(e,t){for(let r in e)null==t[r]&&(t[r]=e[r]);return t}static arrayToObject(e){let t={};return e.forEach((e,r)=>{t[r]={},e.forEach((e,n)=>{t[r][n]=e})}),t}static hasIntersectionBetweenTwoRanges(e,t,r,n){return t>=r&&n>=e}static isStartValidPosition(e){return/^[A-Za-z_]/.test(e)}static isValidParameter(e){let t=/[~!@#$%^&*()+=\-{}\[\]\|:;"'<>,?\/ ]+/.test(e),r=e.length<=255;return!t&&r}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static now(){return performance&&performance.now?performance.now():Date.now()}}function sD(e=21,t){return t?sI(t,e)():sA(e)}function sV(...e){let t={},r=e.length;for(let n=r-1;n>=0;n--){let r=e[n];if(r)for(let e of Object.keys(r))void 0===t[e]&&(t[e]=r[e])}return t}let sL=()=>"u">typeof e8&&null!=e8.versions&&null!=e8.versions.node;function sP(e,t,r){let{dataStream:n,textRuns:i=[]}=e,s=t,a=[];for(let e of i){let{st:i,ed:o}=e;sU.hasIntersectionBetweenTwoRanges(t,r,i,o)&&(i>s?(a.push(n.slice(s,i)),a.push(sF(n,{...e,ed:Math.min(o,r)}))):a.push(sF(n,{...e,st:s,ed:Math.min(o,r)}))),s=Math.max(t,Math.min(o,r))}return s!==r&&a.push(n.slice(s,r)),a.join("")}function sj(e,t=!0){var r;if(!t||null==(r=e.paragraphs)||!r.length)return sP(e,0,e.dataStream.length);{let{dataStream:t,paragraphs:r=[]}=e,n="",i=-1;for(let t of r){let{startIndex:r,paragraphStyle:s={}}=t,{spaceAbove:a,spaceBelow:o,lineSpacing:l}=s,u=[];null!=a&&("number"==typeof a?u.push(`margin-top: ${a}px`):u.push(`margin-top: ${a.v}px`)),null!=o&&("number"==typeof o?u.push(`margin-bottom: ${o}px`):u.push(`margin-bottom: ${o.v}px`)),null!=l&&u.push(`line-height: ${l}`),r>i+1?n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}>${sP(e,i+1,r)}</p>`:n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}></p>`,i=r}return i!==t.length&&(n+=sP(e,i,t.length)),n}}function sF(e,t){let{st:r,ed:n,ts:i={}}=t,{ff:s,fs:a,it:o,bl:l,ul:u,st:c,ol:h,bg:d,cl:m,va:g}=i,f=e.slice(r,n),p=[];return o===s_.TRUE&&(f=`<i>${f}</i>`),g===sC.SUPERSCRIPT?f=`<sup>${f}</sup>`:g===sC.SUBSCRIPT&&(f=`<sub>${f}</sub>`),(null==u?void 0:u.s)===s_.TRUE&&(f=`<u>${f}</u>`),(null==c?void 0:c.s)===s_.TRUE&&(f=`<s>${f}</s>`),l===s_.TRUE&&(f=`<strong>${f}</strong>`),s&&p.push(`font-family: ${s}`),m&&p.push(`color: ${m.rgb}`),a&&p.push(`font-size: ${a}pt`),h&&p.push("text-decoration: overline"),d&&p.push(`background: ${d.rgb}`),p.length?`<span style="${p.join("; ")};">${f}</span>`:f}let sk={[sb.OFFICE]:{[sE.ACCENT1]:"#4472C4",[sE.ACCENT2]:"#ED7D31",[sE.ACCENT3]:"#A5A5A5",[sE.ACCENT4]:"#70AD47",[sE.ACCENT5]:"#5B9BD5",[sE.ACCENT6]:"#70AD47",[sE.DARK1]:"#000000",[sE.DARK2]:"#44546A",[sE.LIGHT1]:"#FFFFFF",[sE.LIGHT2]:"#E7E6E6",[sE.HYPERLINK]:"#0563C1",[sE.FOLLOWED_HYPERLINK]:"#954F72"}};class sB{constructor(){tr(this,"_themeValue",sE.LIGHT1),tr(this,"_themeColors"),tr(this,"_themeTint"),tr(this,"_rgbValue",""),tr(this,"_colorType"),this._colorType=i1.UNSUPPORTED,this._themeColors=sb.OFFICE,this._themeTint=0}asRgbColor(){return new sG(this._rgbValue,this)}asThemeColor(){return new sz(this._themeValue,this._themeTint,this._themeColors,this)}build(){switch(this._colorType){case i1.THEME:return this.asThemeColor();case i1.RGB:return this.asRgbColor();case i1.UNSUPPORTED:throw Error("unsupported color type")}}setRgbColor(e){return this._colorType=i1.RGB,this._rgbValue=e,this}setThemeColors(e){this._colorType=i1.THEME,this._themeColors=e}setThemeTint(e){this._colorType=i1.THEME,this._themeTint=e}setThemeColor(e){return this._colorType=i1.THEME,this._themeValue=e,this}getColorType(){return this._colorType}}class s${constructor(e){tr(this,"_builder"),this._builder=e}static rgbColorToHexValue(e){return`#${(0x1000000+(e.getRed()<<16)+(e.getGreen()<<8)+e.getBlue()).toString(16).slice(1)}`}static hexValueToRgbColor(e){e?e.indexOf("#")>-1&&(e=e.substring(1)):e="#000000";let t=+`0x${e[0]}${e[1]}`,r=+`0x${e[2]}${e[3]}`,n=+`0x${e[4]}${e[5]}`;return new sB().setRgbColor(`rgb(${t},${r},${n})`).asRgbColor()}static hexToRgbString(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,r,n)=>t+t+r+r+n+n);let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=null;if(t){let e=Number.parseInt(t[1],16),n=Number.parseInt(t[2],16),i=Number.parseInt(t[3],16);r=`rgba(${e},${n},${i})`}return r}asRgbColor(){return this._builder.asRgbColor()}asThemeColor(){return this._builder.asThemeColor()}getColorType(){return this._builder.getColorType()}clone(){return new s$(this._builder)}equals(e){return!1}}class sH{constructor(e){tr(this,"_saturation",0),tr(this,"_hue",0),tr(this,"_lightness",0),tr(this,"_alpha",0);let t=e.getRed()/255,r=e.getGreen()/255,n=e.getBlue()/255,i=e.getAlpha()/255,s=Math.min(t,Math.min(r,n)),a=Math.max(t,Math.max(r,n)),o=a-s;if(a===s){this._hue=0,this._saturation=0,this._lightness=a;return}this._lightness=(s+a)/2,this._lightness<.5?this._saturation=o/(a+s):this._saturation=o/(2-a-s),t===a&&(this._hue=(r-n)/o),r===a&&(this._hue=2+(n-t)/o),n===a&&(this._hue=4+(t-r)/o),this._hue*=60,this._hue<0&&(this._hue+=360),this._alpha=i}asRgbColor(){let e;let t=new sB;if(0===this._saturation)return t.setRgbColor(`rgba(${255*this._lightness},${255*this._lightness},${255*this._lightness},${255*this._alpha})`),t.asRgbColor();e=this._lightness<.5?this._lightness*(1+this._saturation):this._lightness+this._saturation-this._lightness*this._saturation;let r=2*this._lightness-e,n=this._hue/360,i=this.setColor(e,r,n+1/3),s=this.setColor(e,r,n),a=this.setColor(e,r,n-1/3);return t.setRgbColor(`rgba(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*a)},${255*this._alpha})`),t.asRgbColor()}getLightness(){return this._lightness}getHue(){return this._hue}getSaturation(){return this._saturation}getAlpha(){return this._alpha}setColor(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+(e-t)*6*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}setLightness(e){this._lightness=e}}let sW=class e extends s${constructor(t,r){super(r),tr(this,"_cssString"),tr(this,"_red"),tr(this,"_green"),tr(this,"_blue"),tr(this,"_alpha");let n=t.match(e.RGBA_EXTRACT);if(n){let e=+n[1],r=+n[2],i=+n[3],s=+n[4];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=s;return}if(n=t.match(e.RGB_EXTRACT)){let e=+n[1],r=+n[2],i=+n[3];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=1;return}throw Error("Invalid rgba or rgb color")}asHexString(){return s$.rgbColorToHexValue(this)}getRed(){let t=this._red+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getGreen(){let t=this._green+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getBlue(){let t=this._blue+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getAlpha(){return this._alpha}getColorType(){return i1.RGB}clone(){return new e(this._cssString,this._builder)}asThemeColor(){throw Error("rgb color not support to themeColor")}equals(t){return t instanceof e&&t._red===this._red&&t._blue===this._blue&&t._green===this._green&&t._alpha===this._alpha}getCssString(){return this._cssString}};tr(sW,"RGB_COLOR_AMT",0),tr(sW,"RGBA_EXTRACT",RegExp("\\s*rgba\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d.\\d|\\d\\s*)\\)\\s*")),tr(sW,"RGB_EXTRACT",RegExp("\\s*rgb\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*)\\)\\s*"));let sG=sW,sY=class e extends s${constructor(e,t,r,n){super(n),tr(this,"_themeColorType"),tr(this,"_themeTint"),tr(this,"_themeColors"),this._themeColorType=e,this._themeTint=t,this._themeColors=r}lumValue(e,t){return null==e?t:e<0?t*(1+e):t*(1-e)+(255-255*(1-e))}asRgbColor(){let t;let r=sk[this._themeColors];if(null==r)throw Error("not find themeColors type");let n=r[this._themeColorType];if(null==n)throw Error("not find themeColors value");if(e._cacheThemeColor.has(this._themeColors)){if((t=e._cacheThemeColor.get(this._themeColors)).has(this._themeColorType))return t.get(this._themeColorType)}else t=/* @__PURE__ */new Map,e._cacheThemeColor.set(this._themeColors,t);let i=new sH(s$.hexValueToRgbColor(n));i.setLightness(this.lumValue(this._themeTint,255*i.getLightness())/255);let s=i.asRgbColor();return t.set(this._themeColorType,s),s}clone(){return new e(this._themeColorType,this._themeTint,this._themeColors,this._builder)}equals(t){return t instanceof e&&t._themeColorType===this._themeColorType}getColorType(){return i1.THEME}getThemeColorType(){return this._themeColorType}};tr(sY,"_cacheThemeColor",/* @__PURE__ */new Map);let sz=sY,sq={aliceBlue:[240,248,255],antiqueWhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blancheAlmond:[255,235,205],blue:[0,0,255],blueViolet:[138,43,226],brown:[165,42,42],burlyWood:[222,184,135],cadetBlue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornFlowerBlue:[100,149,237],cornSilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkCyan:[0,139,139],darkGoldenrod:[184,132,11],darkGray:[169,169,169],darkGreen:[0,100,0],darkGrey:[169,169,169],darkKhaki:[189,183,107],darkMagenta:[139,0,139],darkOliveGreen:[85,107,47],darkOrange:[255,140,0],darkOrchid:[153,50,204],darkRed:[139,0,0],darkSalmon:[233,150,122],darkSeaGreen:[143,188,143],darkSlateBlue:[72,61,139],darkSlateGray:[47,79,79],darkSlateGrey:[47,79,79],darkTurquoise:[0,206,209],darkViolet:[148,0,211],deepPink:[255,20,147],deepSkyBlue:[0,191,255],dimGray:[105,105,105],dimGrey:[105,105,105],dodgerBlue:[30,144,255],firebrick:[178,34,34],floralWhite:[255,255,240],forestGreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostWhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenYellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotPink:[255,105,180],indianRed:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderBlush:[255,240,245],lawnGreen:[124,252,0],lemonChiffon:[255,250,205],lightblue:[173,216,230],lightCoral:[240,128,128],lightCyan:[224,255,255],lightGoldenrodYellow:[250,250,210],lightGray:[211,211,211],lightGreen:[144,238,144],lightGrey:[211,211,211],lightPink:[255,182,193],lightSalmon:[255,160,122],lightSeaGreen:[32,178,170],lightSkyBlue:[135,206,250],lightSlateGray:[119,136,153],lightSlateGrey:[119,136,153],lightSteelBlue:[176,196,222],lightYellow:[255,255,224],lime:[0,255,0],limeGreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumAquamarine:[102,205,170],mediumBlue:[0,0,205],mediumOrchid:[186,85,211],mediumPurple:[147,112,219],mediumSeaGreen:[60,179,113],mediumSlateBlue:[123,104,238],mediumSpringGreen:[0,250,154],mediumTurquoise:[72,209,204],mediumVioletRed:[199,21,133],midBightBlue:[25,25,112],mintCream:[245,255,250],mistyRose:[255,228,225],moccasin:[255,228,181],navajoWhite:[255,222,173],navy:[0,0,128],oldLace:[253,245,230],olive:[128,128,0],oliveDrab:[107,142,35],orange:[255,165,0],orangeRed:[255,69,0],orchid:[218,112,214],paleGoldenrod:[238,232,170],paleGreen:[152,251,152],paleTurquoise:[175,238,238],paleVioletRed:[219,112,147],papayaWhip:[255,239,213],peachPuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderBlue:[176,224,230],purple:[128,0,128],rebeccaPurple:[102,51,153],red:[255,0,0],rosyBrown:[188,143,143],royalBlue:[65,105,225],saddleBrown:[139,69,19],salmon:[250,128,114],sandyBrown:[244,164,96],seaGreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyBlue:[135,206,235],slateBlue:[106,90,205],slateGray:[119,128,144],slateGrey:[119,128,144],snow:[255,255,250],springGreen:[0,255,127],steelBlue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whiteSmoke:[245,245,245],yellow:[255,255,0],yellowGreen:[154,205,5]};class sX{constructor(e){if(tr(this,"_color"),tr(this,"_rgbColor"),tr(this,"_isValid",!1),null==e){this._setNullColor();return}if(e instanceof sX){this._color={...e._color},this._rgbColor={...e._rgbColor};return}let t=sZ(e);if(null==t){this._setNullColor();return}this._color=t;let r=s5(this._color);if(null==r){this._setNullColor();return}this._rgbColor=r,this._isValid=!0}static mix(e,t,r){var n,i;r=Math.min(1,Math.max(0,r));let s=new sX(e).toRgb(),a=new sX(t).toRgb(),o=null!=(n=s.a)?n:1,l=null!=(i=a.a)?i:1;return new sX({r:(a.r-s.r)*r+s.r,g:(a.g-s.g)*r+s.g,b:(a.b-s.b)*r+s.b,a:(l-o)*r+o})}static getContrastRatio(e,t){let r=new sX(e).getLuminance(),n=new sX(t).getLuminance();return(Math.max(r,n)+.05)/(Math.min(r,n)+.05)}get isValid(){return this._isValid}toRgb(){return this._rgbColor}toRgbString(){let{r:e,g:t,b:r,a:n=1}=this.toRgb(),i=n<1;return`rgb${i?"a":""}(${e},${t},${r}${i?`,${n}`:""})`}toString(){return this.toRgbString()}toHexString(e){let{r:t,g:r,b:n,a:i=1}=this.toRgb(),s=i<1,a=[sK(Math.round(t).toString(16)),sK(Math.round(r).toString(16)),sK(Math.round(n).toString(16)),sK(Math.round(255*i).toString(16))];return e&&a[0][0]===a[0][1]&&a[1][0]===a[1][1]&&a[2][0]===a[2][1]&&a[3][0]===a[3][1]?s?`#${a[0][0]}${a[1][0]}${a[2][0]}${a[3][0]}`:`#${a[0][0]}${a[1][0]}${a[2][0]}`:s?`#${a[0]}${a[1]}${a[2]}${a[3]}`:`#${a[0]}${a[1]}${a[2]}`}toHsv(){return s7(this.toRgb())}toHsl(){return s9(this.toRgb())}lighten(e=10){let t=this.toHsl();return t.l+=e,t.l=Math.min(Math.max(t.l,0),100),new sX(t)}darken(e=10){let t=this.toHsl();return t.l-=e,t.l=Math.min(Math.max(t.l,0),100),new sX(t)}setAlpha(e){return new sX({...this._rgbColor,a:e})}getLuminance(){let{r:e,g:t,b:r}=this.toRgb();return Number((.2126*(e=sQ(e))+.7152*(t=sQ(t))+.0722*(r=sQ(r))).toFixed(3))}getBrightness(){let{r:e,g:t,b:r}=this.toRgb();return(299*e+587*t+114*r)/1e3}getAlpha(){var e;return null!=(e=this._color.a)?e:1}isDark(){return 128>this.getBrightness()}isLight(){return!this.isDark()}_setNullColor(){this._isValid=!1,this._color={r:0,g:0,b:0,a:0},this._rgbColor={r:0,g:0,b:0,a:0}}}let sK=e=>1===e.length?`0${e}`:e,sQ=e=>(e/=255)<=.03928?e/12.92:((e+.055)/1.055)**2.4,sZ=e=>{if(ae(e)){if("r"in e){let t={r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)};return void 0!==e.a&&(t.a=e.a),t}if("l"in e){let t={h:Math.round(e.h),s:e.s,l:e.l};return void 0!==e.a&&(t.a=e.a),t}let t={h:Math.round(e.h),s:e.s,v:e.v};return void 0!==e.a&&(t.a=e.a),t}let t=e.trim();if(sq[t]){let e=sq[t],r={r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])};return r.a=e[3]||1,r}return t.startsWith("#")?sJ(t):t.startsWith("rgb")?s0(t):t.startsWith("hsl")?s1(t):t.startsWith("hsv")?s2(t):void 0},sJ=e=>{let t=e.substring(1),r=RegExp(`.{1,${t.length>=6?2:1}}`,"g"),n=t.match(r);if(!n||n.length<3)throw Error(`The color '${e}' is illegal hex color`);1===n[0].length&&(n=n.map(e=>e+e));let i={r:Number.parseInt(n[0],16),g:Number.parseInt(n[1],16),b:Number.parseInt(n[2],16)};return n.length>3&&(i.a=Number.parseInt(n[3],16)/255),i},s0=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal rgb color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal rgb color`);let n={r:Number.parseInt(r[0],10),g:Number.parseInt(r[1],10),b:Number.parseInt(r[2],10)};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},s1=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsl color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsl color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),l:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},s2=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsv color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsv color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),v:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},s5=e=>{let t=sZ(e);if(null!=t)return"r"in t?t:"l"in t?s4(t):s6(t)},s3=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e),s4=e=>{let{h:t,s:r,l:n}=e;t/=360,r/=100,n/=100;let i=0,s=0,a=0;if(0===r)i=s=a=n;else{let e=n<.5?n*(1+r):n+r-n*r,o=2*n-e;i=s3(o,e,t+1/3),s=s3(o,e,t),a=s3(o,e,t-1/3)}let o={r:Math.round(255*i),g:Math.round(255*s),b:Math.round(255*a)};return void 0!==e.a&&(o.a=e.a),o},s6=e=>{let{h:t,s:r,v:n}=e;t=t/360*6,r/=100,n/=100;let i=Math.floor(t),s=t-i,a=n*(1-r),o=n*(1-s*r),l=n*(1-(1-s)*r),u=i%6,c={r:255*[n,o,a,a,l,n][u],g:255*[l,n,n,o,a,a][u],b:255*[a,a,l,n,n,o][u]};return void 0!==e.a&&(c.a=e.a),c},s9=e=>{let t,r,{r:n,g:i,b:s}=e,a=Math.max(n/=255,i/=255,s/=255),o=Math.min(n,i,s),l=(a+o)/2;if(a===o)t=r=0;else{let e=a-o;switch(r=l>.5?e/(2-a-o):e/(a+o),a){case n:t=(i-s)/e+(i<s?6:0);break;case i:t=(s-n)/e+2;break;default:t=(n-i)/e+4}t/=6}let u={h:Math.round(360*t),s:Math.round(100*r),l:Math.round(100*l)};return void 0!==e.a&&(u.a=e.a),u},s7=e=>{let t,{r:r,g:n,b:i}=e,s=Math.max(r/=255,n/=255,i/=255),a=Math.min(r,n,i),o=s-a;if(s===a)t=0;else{switch(s){case r:t=(n-i)/o+(n<i?6:0);break;case n:t=(i-r)/o+2;break;default:t=(r-n)/o+4}t/=6}let l={h:Math.round(360*t),s:Math.round(100*(0===s?0:o/s)),v:Math.round(100*s)};return void 0!==e.a&&(l.a=e.a),l},s8=e=>null==e,ae=e=>!s8(e)&&"object"==typeof e;function at(e){return!!(/^#(?:[Ff]{3}|[Ff]{6})\b/.test(e)||/^rgb\s*\(\s*255\s*,\s*255\s*,\s*255\s*\)$/.test(e)||/^rgba\s*\(\s*255\s*,\s*255\s*,\s*255\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e)||/^hsl\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*\)$/.test(e)||/^hsla\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e))}var ar=((B=ar||{})[B.COVER=0]="COVER",B[B.REPLACE=1]="REPLACE",B);function an(e){return e&&(void 0!==e.s||void 0!==e.p||void 0!==e.v||void 0!==e.t||void 0!==e.f||void 0!==e.si||void 0!==e.custom)}function ai(e){return void 0!==e.t?e.t:"string"==typeof e.v?sy.STRING:"number"==typeof e.v?sy.NUMBER:"boolean"==typeof e.v?sy.BOOLEAN:void 0}function as(e){if(null==e)return!0;let{v:t,f:r,si:n,p:i,s:s,custom:a}=e;return!(!(null==t||"string"==typeof t&&0===t.length)||null!=r&&r.length>0||null!=n&&n.length>0||null!=i||null!=a)}function aa(e){return null!=e&&("string"==typeof e||"number"==typeof e||"boolean"==typeof e)}var ao=(($=ao||{})[$.NORMAL=0]="NORMAL",$[$.ROW=1]="ROW",$[$.COLUMN=2]="COLUMN",$[$.ALL=3]="ALL",$),al=((H=al||{})[H.NONE=0]="NONE",H[H.ROW=1]="ROW",H[H.COLUMN=2]="COLUMN",H[H.ALL=3]="ALL",H);function au(e){return[e.startRow,e.startColumn,e.endRow,e.endColumn]}var ac=((W=ac||{}).NONE="none",W.BACKWARD="backward",W.FORWARD="forward",W),ah=((G=ah||{}).RECT="RECT",G.TEXT="TEXT",G);function ad(e,t,r){let n=!1,i=!1,s=e,a=t,o=e,l=t;if(null==r)return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l};for(let u=0;u<r.length;u++){let{startRow:c,endRow:h,startColumn:d,endColumn:m}=r[u];if(e===c&&t===d){s=h,a=m,o=c,l=d,i=!0;break}if(e>=c&&e<=h&&t>=d&&t<=m){s=h,a=m,o=c,l=d,n=!0;break}}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}function am(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,mergeInfo:s}=e,{startY:a,endY:o,startX:l,endX:u}=e,c=t,h=r,d=t,m=r;if(n&&s){let{startRow:e,startColumn:t,endRow:r,endColumn:n,startY:i,endY:g,startX:f,endX:p}=s;c=e,h=t,d=r,m=n,a=i,o=g,l=f,u=p}return i&&(a=s.startY,o=s.endY,l=s.startX,u=s.endX,d=s.endRow,m=s.endColumn),{startRow:c,startColumn:h,endRow:d,endColumn:m,startY:a,endY:o,startX:l,endX:u}}function ag(e){var t;return(!e||0===((null==(t=null==e?void 0:e.v)?void 0:t.toString())||"").length&&!e.p)&&(null==e?void 0:e.coverable)!==!1}function af(e){if(e){if(e.rgb)return e.rgb;if(e.th)return new sB().setThemeColor(e.th).asThemeColor().asRgbColor().getCssString()}return null}function ap(e){return sU.isString(e)&&"="===e.substring(0,1)&&e.length>1}function aC(e){return sU.isString(e)&&e.length>0}function a_(e,t=!1){var r;let n="",i=/* @__PURE__ */new Map([["ff",()=>{e.ff&&(n+=`font-family: ${e.ff}; `)}],["fs",()=>{if(e.fs){let t=e.fs;e.va&&(t/=2),n+=`font-size: ${t}pt; `}}],["it",()=>{e.it&&(n+="font-style: italic; ")}],["bl",()=>{e.bl&&(n+="font-weight: bold; ")}],["ul",()=>{var t;null!=(t=e.ul)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} underline`):n+="text-decoration: underline; ",e.ul.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${af(e.ul.cl)}; `),e.ul.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ul.t} `))}],["st",()=>{var t;null!=(t=e.st)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} line-through`):n+="text-decoration-line: line-through; ",e.st.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${af(e.st.cl)}; `),e.st.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.st.t} `))}],["ol",()=>{var t;null!=(t=e.ol)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} overline`):n+="text-decoration-line: overline; ",e.ol.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${af(e.ol.cl)}; `),e.ol.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ol.t} `))}],["bg",()=>{e.bg&&(n+=`background: ${af(e.bg)}; `)}],["bd",()=>{var t,r,i,s,a,o,l,u,c,h,d,m;null!=(t=e.bd)&&t.b&&(n+=`border-bottom: ${ay(null==(r=e.bd)?void 0:r.b.s)} ${null!=(i=af(e.bd.b.cl))?i:""}; `),null!=(s=e.bd)&&s.t&&(n+=`border-top: ${ay(null==(a=e.bd)?void 0:a.t.s)} ${null!=(o=af(e.bd.t.cl))?o:""}; `),null!=(l=e.bd)&&l.r&&(n+=`border-right: ${ay(null==(u=e.bd)?void 0:u.r.s)} ${null!=(c=af(e.bd.r.cl))?c:""}; `),null!=(h=e.bd)&&h.l&&(n+=`border-left: ${ay(null==(d=e.bd)?void 0:d.l.s)} ${null!=(m=af(e.bd.l.cl))?m:""}; `)}],["cl",()=>{e.cl&&(n+=`color: ${af(e.cl)}; `)}],["va",()=>{e.va===sC.SUBSCRIPT?n+="vertical-align: sub; ":e.va===sC.SUPERSCRIPT&&(n+="vertical-align: super; ")}],["td",()=>{e.td===sc.LEFT_TO_RIGHT?n+="direction: ltr; ":e.td===sc.RIGHT_TO_LEFT&&(n+="direction: rtl; ")}],["tr",()=>{var t,r,i;e.tr&&(n+=`--data-rotate: (${null==(t=e.tr)?void 0:t.a}deg${null!=(r=e.tr)&&r.v?` ,${null==(i=e.tr)?void 0:i.v}`:""});`)}],["ht",()=>{e.ht===sd.LEFT?n+="text-align: left; ":e.ht===sd.RIGHT?n+="text-align: right; ":e.ht===sd.CENTER?n+="text-align: center; ":e.ht===sd.JUSTIFIED&&(n+="text-align: justify; ")}],["vt",()=>{e.vt===sm.BOTTOM?n+="vertical-align: bottom; ":e.vt===sm.TOP?n+="vertical-align: top; ":e.vt===sm.MIDDLE&&(n+="vertical-align: middle; ")}],["tb",()=>{e.tb===sg.CLIP?n+="white-space: nowrap; overflow-x: hidden; ":e.tb===sg.WRAP&&(n+="white-space: normal;")}],["pd",()=>{var t,r,i,s,a,o,l,u;let c=`${null==(t=e.pd)?void 0:t.b}pt`,h=`${null==(r=e.pd)?void 0:r.t}pt`,d=`${null==(i=e.pd)?void 0:i.l}pt`,m=`${null==(s=e.pd)?void 0:s.r}pt`;null!=(a=e.pd)&&a.b&&(n+=`padding-bottom: ${c}; `),null!=(o=e.pd)&&o.t&&(n+=`padding-top: ${h}; `),null!=(l=e.pd)&&l.l&&(n+=`padding-left: ${d}; `),null!=(u=e.pd)&&u.r&&(n+=`padding-right: ${m}; `)}]]),s=["bd","tr","tb"];for(let n in e)t&&s.includes(n)||null==(r=i.get(n))||r();return n}function ay(e){let t="";return e===iJ.NONE?t="none":e===iJ.THIN?t="0.5pt solid":e===iJ.HAIR?t="0.5pt double":e===iJ.DOTTED?t="0.5pt dotted":e===iJ.DASHED||e===iJ.DASH_DOT?t="0.5pt dashed":e===iJ.DASH_DOT_DOT?t="0.5pt dotted":e===iJ.DOUBLE?t="0.5pt double":e===iJ.MEDIUM?t="1pt solid":e===iJ.MEDIUM_DASHED||e===iJ.MEDIUM_DASH_DOT?t="1pt dashed":e===iJ.MEDIUM_DASH_DOT_DOT?t="1pt dotted":e===iJ.SLANT_DASH_DOT?t="0.5pt dashed":e===iJ.THICK&&(t="1.5pt solid"),t}function aE(e){let t=0;if("none"===(e=e.trim()))t=iJ.NONE;else if("0.5pt solid"===e)t=iJ.THIN;else if("0.5pt double"===e)t=iJ.HAIR;else if("0.5pt dotted"===e)t=iJ.DOTTED;else if("0.5pt dashed"===e)t=iJ.DASHED;else if("1pt solid"===e)t=iJ.MEDIUM;else if("1pt dashed"===e)t=iJ.MEDIUM_DASHED;else if("1pt dotted"===e)t=iJ.MEDIUM_DASH_DOT_DOT;else if("1.5pt solid"===e)t=iJ.THICK;else{if(e.includes("none"))return iJ.NONE;t=iJ.THIN}return t}function ab(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s,rangeType:a}=e;if(r<0||i<0||n<0||s<0||!(Number.isNaN(r)&&Number.isNaN(n))&&a===ao.COLUMN||!(Number.isNaN(i)&&Number.isNaN(s))&&a===ao.ROW||a!==ao.ROW&&a!==ao.COLUMN&&(Number.isNaN(i)||Number.isNaN(r)||Number.isNaN(s)||Number.isNaN(n)))return!1;if(t){let e=t.getRowCount(),r=t.getColumnCount();if(n>=e||s>=r)return!1}return!0}function aR(e,t){return{startRow:e,endRow:e,startColumn:t,endColumn:t}}function aN(e,t){return t.some(t=>e.indexOf(t)>-1)}var aI={exports:{}};oJ=function(){var e="millisecond",t="second",r="minute",n="hour",i="week",s="month",a="quarter",o="year",l="date",u="Invalid Date",c=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,h=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,d=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},m="en",g={};g[m]={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||"th")+"]"}};var f="$isDayjsObject",p=function(e){return e instanceof E||!(!e||!e[f])},C=function e(t,r,n){var i;if(!t)return m;if("string"==typeof t){var s=t.toLowerCase();g[s]&&(i=s),r&&(g[s]=r,i=s);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var o=t.name;g[o]=t,i=o}return!n&&i&&(m=i),i||!n&&m},_=function(e,t){if(p(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new E(r)},y={s:d,z:function(e){var t=-e.utcOffset(),r=Math.abs(t);return(t<=0?"+":"-")+d(Math.floor(r/60),2,"0")+":"+d(r%60,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,s),a=r-i<0,o=t.clone().add(n+(a?-1:1),s);return+(-(n+(r-i)/(a?i-o:o-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(u){return({M:s,y:o,w:i,d:"day",D:l,h:n,m:r,s:t,ms:e,Q:a})[u]||String(u||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}};y.l=C,y.i=p,y.w=function(e,t){return _(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var E=function(){function d(e){this.$L=C(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[f]=!0}var m=d.prototype;return m.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return /* @__PURE__ */new Date(NaN);if(y.u(t))return /* @__PURE__ */new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(c);if(n){var i=n[2]-1||0,s=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(t)}(e),this.init()},m.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},m.$utils=function(){return y},m.isValid=function(){return this.$d.toString()!==u},m.isSame=function(e,t){var r=_(e);return this.startOf(t)<=r&&r<=this.endOf(t)},m.isAfter=function(e,t){return _(e)<this.startOf(t)},m.isBefore=function(e,t){return this.endOf(t)<_(e)},m.$g=function(e,t,r){return y.u(e)?this[t]:this.set(r,e)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(e,a){var u=this,c=!!y.u(a)||a,h=y.p(e),d=function(e,t){var r=y.w(u.$u?Date.UTC(u.$y,t,e):new Date(u.$y,t,e),u);return c?r:r.endOf("day")},m=function(e,t){return y.w(u.toDate()[e].apply(u.toDate("s"),(c?[0,0,0,0]:[23,59,59,999]).slice(t)),u)},g=this.$W,f=this.$M,p=this.$D,C="set"+(this.$u?"UTC":"");switch(h){case o:return c?d(1,0):d(31,11);case s:return c?d(1,f):d(0,f+1);case i:var _=this.$locale().weekStart||0,E=(g<_?g+7:g)-_;return d(c?p-E:p+(6-E),f);case"day":case l:return m(C+"Hours",0);case n:return m(C+"Minutes",1);case r:return m(C+"Seconds",2);case t:return m(C+"Milliseconds",3);default:return this.clone()}},m.endOf=function(e){return this.startOf(e,!1)},m.$set=function(i,a){var u,c=y.p(i),h="set"+(this.$u?"UTC":""),d=((u={}).day=h+"Date",u[l]=h+"Date",u[s]=h+"Month",u[o]=h+"FullYear",u[n]=h+"Hours",u[r]=h+"Minutes",u[t]=h+"Seconds",u[e]=h+"Milliseconds",u)[c],m="day"===c?this.$D+(a-this.$W):a;if(c===s||c===o){var g=this.clone().set(l,1);g.$d[d](m),g.init(),this.$d=g.set(l,Math.min(this.$D,g.daysInMonth())).$d}else d&&this.$d[d](m);return this.init(),this},m.set=function(e,t){return this.clone().$set(e,t)},m.get=function(e){return this[y.p(e)]()},m.add=function(e,a){var l,u=this;e=Number(e);var c=y.p(a),h=function(t){var r=_(u);return y.w(r.date(r.date()+Math.round(t*e)),u)};if(c===s)return this.set(s,this.$M+e);if(c===o)return this.set(o,this.$y+e);if("day"===c)return h(1);if(c===i)return h(7);var d=((l={})[r]=6e4,l[n]=36e5,l[t]=1e3,l)[c]||1,m=this.$d.getTime()+e*d;return y.w(m,this)},m.subtract=function(e,t){return this.add(-1*e,t)},m.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||u;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=y.z(this),s=this.$H,a=this.$m,o=this.$M,l=r.weekdays,c=r.months,d=r.meridiem,m=function(e,r,i,s){return e&&(e[r]||e(t,n))||i[r].slice(0,s)},g=function(e){return y.s(s%12||12,e,"0")},f=d||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(h,function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return y.s(t.$y,4,"0");case"M":return o+1;case"MM":return y.s(o+1,2,"0");case"MMM":return m(r.monthsShort,o,c,3);case"MMMM":return m(c,o);case"D":return t.$D;case"DD":return y.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return m(r.weekdaysMin,t.$W,l,2);case"ddd":return m(r.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(s);case"HH":return y.s(s,2,"0");case"h":return g(1);case"hh":return g(2);case"a":return f(s,a,!0);case"A":return f(s,a,!1);case"m":return String(a);case"mm":return y.s(a,2,"0");case"s":return String(t.$s);case"ss":return y.s(t.$s,2,"0");case"SSS":return y.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")})},m.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},m.diff=function(e,l,u){var c,h=this,d=y.p(l),m=_(e),g=(m.utcOffset()-this.utcOffset())*6e4,f=this-m,p=function(){return y.m(h,m)};switch(d){case o:c=p()/12;break;case s:c=p();break;case a:c=p()/3;break;case i:c=(f-g)/6048e5;break;case"day":c=(f-g)/864e5;break;case n:c=f/36e5;break;case r:c=f/6e4;break;case t:c=f/1e3;break;default:c=f}return u?c:y.a(c)},m.daysInMonth=function(){return this.endOf(s).$D},m.$locale=function(){return g[this.$L]},m.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=C(e,t,!0);return n&&(r.$L=n),r},m.clone=function(){return y.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},d}(),b=E.prototype;return _.prototype=b,[["$ms",e],["$s",t],["$m",r],["$H",n],["$W","day"],["$M",s],["$y",o],["$D",l]].forEach(function(e){b[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),_.extend=function(e,t){return e.$i||(e(t,E,_),e.$i=!0),_},_.locale=C,_.isDayjs=p,_.unix=function(e){return _(1e3*e)},_.en=g[m],_.Ls=g,_.p={},_},aI.exports=oJ();let aA=/* @__PURE__ */rB(aI.exports);var av={exports:{}};o0=function(){return function(e,t){var r=t.prototype,n=r.format;r.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return n.bind(this)(e);var i=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return r.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return r.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}});return n.bind(this)(s)}}},av.exports=o0();let aS=/* @__PURE__ */rB(av.exports);var aT={exports:{}};o1=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},t=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,r=/\d/,n=/\d\d/,i=/\d\d?/,s=/\d*[^-_:/,()\s\d]+/,a={},o=function(e){return(e=+e)+(e>68?1900:2e3)},l=function(e){return function(t){this[e]=+t}},u=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e||"Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),r=60*t[1]+(+t[2]||0);return 0===r?0:"+"===t[0]?-r:r}(e)}],c=function(e){var t=a[e];return t&&(t.indexOf?t:t.s.concat(t.f))},h=function(e,t){var r,n=a.meridiem;if(n){for(var i=1;i<=24;i+=1)if(e.indexOf(n(i,0,t))>-1){r=i>12;break}}else r=e===(t?"pm":"PM");return r},d={A:[s,function(e){this.afternoon=h(e,!1)}],a:[s,function(e){this.afternoon=h(e,!0)}],Q:[r,function(e){this.month=3*(e-1)+1}],S:[r,function(e){this.milliseconds=100*+e}],SS:[n,function(e){this.milliseconds=10*+e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[i,l("seconds")],ss:[i,l("seconds")],m:[i,l("minutes")],mm:[i,l("minutes")],H:[i,l("hours")],h:[i,l("hours")],HH:[i,l("hours")],hh:[i,l("hours")],D:[i,l("day")],DD:[n,l("day")],Do:[s,function(e){var t=a.ordinal,r=e.match(/\d+/);if(this.day=r[0],t)for(var n=1;n<=31;n+=1)t(n).replace(/\[|\]/g,"")===e&&(this.day=n)}],w:[i,l("week")],ww:[n,l("week")],M:[i,l("month")],MM:[n,l("month")],MMM:[s,function(e){var t=c("months"),r=(c("monthsShort")||t.map(function(e){return e.slice(0,3)})).indexOf(e)+1;if(r<1)throw Error();this.month=r%12||r}],MMMM:[s,function(e){var t=c("months").indexOf(e)+1;if(t<1)throw Error();this.month=t%12||t}],Y:[/[+-]?\d+/,l("year")],YY:[n,function(e){this.year=o(e)}],YYYY:[/\d{4}/,l("year")],Z:u,ZZ:u};return function(r,n,i){i.p.customParseFormat=!0,r&&r.parseTwoDigitYear&&(o=r.parseTwoDigitYear);var s=n.prototype,l=s.parse;s.parse=function(r){var n=r.date,s=r.utc,o=r.args;this.$u=s;var u=o[1];if("string"==typeof u){var c=!0===o[2],h=!0===o[3],m=o[2];h&&(m=o[2]),a=this.$locale(),!c&&m&&(a=i.Ls[m]),this.$d=function(r,n,i,s){try{if(["x","X"].indexOf(n)>-1)return new Date(("X"===n?1e3:1)*r);var o=(function(r){var n,i;n=r,i=a&&a.formats;for(var s=(r=n.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(t,r,n){var s=n&&n.toUpperCase();return r||i[n]||e[n]||i[s].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})})).match(t),o=s.length,l=0;l<o;l+=1){var u=s[l],c=d[u],h=c&&c[0],m=c&&c[1];s[l]=m?{regex:h,parser:m}:u.replace(/^\[|\]$/g,"")}return function(e){for(var t={},r=0,n=0;r<o;r+=1){var i=s[r];if("string"==typeof i)n+=i.length;else{var a=i.regex,l=i.parser,u=e.slice(n),c=a.exec(u)[0];l.call(t,c),e=e.replace(c,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var r=e.hours;t?r<12&&(e.hours+=12):12===r&&(e.hours=0),delete e.afternoon}}(t),t}})(n)(r),l=o.year,u=o.month,c=o.day,h=o.hours,m=o.minutes,g=o.seconds,f=o.milliseconds,p=o.zone,C=o.week,_=/* @__PURE__ */new Date,y=c||(l||u?1:_.getDate()),E=l||_.getFullYear(),b=0;l&&!u||(b=u>0?u-1:_.getMonth());var R,N=h||0,I=m||0,A=g||0,v=f||0;return p?new Date(Date.UTC(E,b,y,N,I,A,v+60*p.offset*1e3)):i?new Date(Date.UTC(E,b,y,N,I,A,v)):(R=new Date(E,b,y,N,I,A,v),C&&(R=s(R).week(C).toDate()),R)}catch{return /* @__PURE__ */new Date("")}}(n,u,s,i),this.init(),m&&!0!==m&&(this.$L=this.locale(m).$L),(c||h)&&n!=this.format(u)&&(this.$d=/* @__PURE__ */new Date("")),a={}}else if(u instanceof Array)for(var g=u.length,f=1;f<=g;f+=1){o[1]=u[f-1];var p=i.apply(this,o);if(p.isValid()){this.$d=p.$d,this.$L=p.$L,this.init();break}f===g&&(this.$d=/* @__PURE__ */new Date(""))}else l.call(this,r)}}},aT.exports=o1();let aO=/* @__PURE__ */rB(aT.exports);var aM={exports:{}};o2=function(){return function(e,t,r){var n=t.prototype,i=function(e){return e&&(e.indexOf?e:e.s)},s=function(e,t,r,n,s){var a=e.name?e:e.$locale(),o=i(a[t]),l=i(a[r]),u=o||l.map(function(e){return e.slice(0,n)});if(!s)return u;var c=a.weekStart;return u.map(function(e,t){return u[(t+(c||0))%7]})},a=function(){return r.Ls[r.locale()]},o=function(e,t){return e.formats[t]||e.formats[t.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})},l=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):s(e,"months")},monthsShort:function(t){return t?t.format("MMM"):s(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):s(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):s(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):s(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return o(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};n.localeData=function(){return l.bind(this)()},r.localeData=function(){var e=a();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return r.weekdays()},weekdaysShort:function(){return r.weekdaysShort()},weekdaysMin:function(){return r.weekdaysMin()},months:function(){return r.months()},monthsShort:function(){return r.monthsShort()},longDateFormat:function(t){return o(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},r.months=function(){return s(a(),"months")},r.monthsShort=function(){return s(a(),"monthsShort","months",3)},r.weekdays=function(e){return s(a(),"weekdays",null,null,e)},r.weekdaysShort=function(e){return s(a(),"weekdaysShort","weekdays",3,e)},r.weekdaysMin=function(e){return s(a(),"weekdaysMin","weekdays",2,e)}}},aM.exports=o2();let aw=/* @__PURE__ */rB(aM.exports);var ax={exports:{}};o5=function(){var e={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(t,r,n){var i=r.prototype,s=i.format;n.en.formats=e,i.format=function(t){void 0===t&&(t="YYYY-MM-DDTHH:mm:ssZ");var r,n,i=this.$locale().formats,a=(r=t,n=void 0===i?{}:i,r.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(t,r,i){var s=i&&i.toUpperCase();return r||n[i]||e[i]||n[s].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})}));return s.call(this,a)}}},ax.exports=o5();let aU=/* @__PURE__ */rB(ax.exports);var aD={exports:{}};o3=function(){var e="minute",t=/[+-]\d\d(?::?\d\d)?/g,r=/([+-]|\d\d)/g;return function(n,i,s){var a=i.prototype;s.utc=function(e){var t={date:e,utc:!0,args:arguments};return new i(t)},a.utc=function(t){var r=s(this.toDate(),{locale:this.$L,utc:!0});return t?r.add(this.utcOffset(),e):r},a.local=function(){return s(this.toDate(),{locale:this.$L,utc:!1})};var o=a.parse;a.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),o.call(this,e)};var l=a.init;a.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else l.call(this)};var u=a.utcOffset;a.utcOffset=function(n,i){var s=this.$utils().u;if(s(n))return this.$u?0:s(this.$offset)?u.call(this):this.$offset;if("string"==typeof n&&null===(n=function(e){void 0===e&&(e="");var n=e.match(t);if(!n)return null;var i=(""+n[0]).match(r)||["-",0,0],s=i[0],a=60*+i[1]+ +i[2];return 0===a?0:"+"===s?a:-a}(n)))return this;var a=16>=Math.abs(n)?60*n:n,o=this;if(i)return o.$offset=a,o.$u=0===n,o;if(0!==n){var l=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(o=this.local().add(a+l,e)).$offset=a,o.$x.$localOffset=l}else o=this.utc();return o};var c=a.format;a.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return c.call(this,t)},a.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},a.isUTC=function(){return!!this.$u},a.toISOString=function(){return this.toDate().toISOString()},a.toString=function(){return this.toDate().toUTCString()};var h=a.toDate;a.toDate=function(e){return"s"===e&&this.$offset?s(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():h.call(this)};var d=a.diff;a.diff=function(e,t,r){if(e&&this.$u===e.$u)return d.call(this,e,t,r);var n=this.local(),i=s(e).local();return d.call(n,i,t,r)}}},aD.exports=o3();let aV=/* @__PURE__ */rB(aD.exports);var aL={exports:{}};o4=function(){return function(e,t){t.prototype.weekday=function(e){var t=this.$locale().weekStart||0,r=this.$W,n=(r<t?r+7:r)-t;return this.$utils().u(e)?n:this.subtract(n,"day").add(e,"day")}}},aL.exports=o4();let aP=/* @__PURE__ */rB(aL.exports);var aj={exports:{}};o6=function(){var e="week",t="year";return function(r,n,i){var s=n.prototype;s.week=function(r){if(void 0===r&&(r=null),null!==r)return this.add(7*(r-this.week()),"day");var n=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var s=i(this).startOf(t).add(1,t).date(n),a=i(this).endOf(e);if(s.isBefore(a))return 1}var o=i(this).startOf(t).date(n).startOf(e).subtract(1,"millisecond"),l=this.diff(o,e,!0);return l<0?i(this).startOf("week").week():Math.ceil(l)},s.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}},aj.exports=o6();let aF=/* @__PURE__ */rB(aj.exports);var ak={exports:{}};o9=function(){return function(e,t){t.prototype.weekYear=function(){var e=this.month(),t=this.week(),r=this.year();return 1===t&&11===e?r+1:0===e&&t>=52?r-1:r}}},ak.exports=o9();let aB=/* @__PURE__ */rB(ak.exports);function a$(e,t,r,n){if(e>t)throw Error("a1 should be less than a2");if(r>n)throw Error("b1 should be less than b2");if(t<r||n<e)return[e,t];if(r<=e&&n>=t)return[];let i=n-r+1;return e<r&&t>n?[e,t-i]:r<=e&&n<t?[n+1-i,t-i]:r>e&&n>=t?[e,r-1]:[e,t]}function aH(e){var t;return!(null==e||(null==e.indentStart||0===e.indentStart.v)&&null==e.hanging||(null==(t=e.hanging)?void 0:t.v)===0)}function aW(e,t,r){return e.slice(0,t)+r+e.slice(t)}function aG(e,t,r){return t>r?e:e.slice(0,t)+e.slice(r)}aA.extend(aO),aA.extend(aS),aA.extend(aP),aA.extend(aw),aA.extend(aF),aA.extend(aB),aA.extend(aV),aA.extend(aU);let aY=/\s/g;function az(e){return null!==e&&""!==e.toString().replace(aY,"")&&"boolean"!=typeof e&&!isNaN(e)}function aq(e){let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+(t<<6)+(t<<16)-t;return t>>>0}let aX=Symbol("newer"),aK=Symbol("older");class aQ{constructor(e){tr(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[aX],{done:!1,value:e.key}):{done:!0,value:void 0}}}class aZ{constructor(e){tr(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[aX],{done:!1,value:e.value}):{done:!0,value:void 0}}}class aJ{constructor(e){tr(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[aX],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}}}class a0{constructor(e,t){tr(this,"key"),tr(this,"value"),tr(this,aX),tr(this,aK),this.key=e,this.value=t,this[aX]=void 0,this[aK]=void 0}toJSON(){return{key:this.key,value:this.value}}}class a1{constructor(...e){if(tr(this,"_keymap"),tr(this,"size",0),tr(this,"limit"),tr(this,"oldest"),tr(this,"newest"),tr(this,"_onShiftListeners",[]),a2.hasLength(e,1)){if(a2.isNumber(e[0])){let t=e[0];this._initialize(t,void 0);return}if(a2.isIterable(e[0])){let t=e[0];this._initialize(0,t)}return}if(a2.hasLength(e,2)){let t=e[0],r=e[1];this._initialize(t,r)}}onShift(e){if(-1===this._onShiftListeners.indexOf(e))return this._onShiftListeners.push(e),iM(()=>r6(this._onShiftListeners,e));throw Error("[LRUMap]: the listener has been registered!")}_initialize(e,t){this.oldest=void 0,this.newest=void 0,this.size=0,this.limit=e,this._keymap=/* @__PURE__ */new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[aX]&&(e===this.oldest&&(this.oldest=e[aX]),e[aX][aK]=e[aK]),e[aK]&&(e[aK][aX]=e[aX]),e[aX]=void 0,e[aK]=this.newest,this.newest&&(this.newest[aX]=e),this.newest=e)}assign(e){let t,r=this.limit||Number.MAX_VALUE;this._keymap.clear();let n=e[Symbol.iterator]();for(let e=n.next();!e.done;e=n.next()){let n=new a0(e.value[0],e.value[1]);if(this._keymap.set(n.key,n),t?(t[aX]=n,n[aK]=t):this.oldest=n,t=n,0==r--)throw Error("overflow")}this.newest=t,this.size=this._keymap.size}set(e,t){let r=this._keymap.get(e);return r?(r.value=t,this._markEntryAsUsed(r)):(this._keymap.set(e,r=new a0(e,t)),this.newest?(this.newest[aX]=r,r[aK]=this.newest):this.oldest=r,this.newest=r,++this.size,this.size>this.limit&&this.shift()),this}shift(){let e=this.oldest;if(e)return this.oldest&&this.oldest[aX]?(this.oldest=this.oldest[aX],this.oldest[aK]=void 0):(this.oldest=void 0,this.newest=void 0),e[aX]=e[aK]=void 0,this._keymap.delete(e.key),--this.size,this._onShiftListeners.forEach(t=>t(e)),[e.key,e.value]}get(e){let t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}has(e){return this._keymap.has(e)}find(e){let t=this._keymap.get(e);return t?t.value:void 0}delete(e){let t=this._keymap.get(e);if(t)return this._keymap.delete(t.key),t[aX]&&t[aK]?(t[aK][aX]=t[aX],t[aX][aK]=t[aK]):t[aX]?(t[aX][aK]=void 0,this.oldest=t[aX]):t[aK]?(t[aK][aX]=void 0,this.newest=t[aK]):this.oldest=this.newest=void 0,this.size--,t.value}clear(){this.oldest=void 0,this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return new aQ(this.oldest)}values(){return new aZ(this.oldest)}entries(){return this[Symbol.iterator]()}[Symbol.iterator](){return new aJ(this.oldest)}forEach(e,t){"object"!=typeof t&&(t=this);let r=this.oldest;for(;r;)e.call(t,r.value,r.key,this),r=r[aX]}toJSON(){let e=Array(this.size),t=0,r=this.oldest;for(;r;)e[t++]={key:r.key,value:r.value},r=r[aX];return e}toString(){let e="",t=this.oldest;for(;t;)e+=`${String(t.key)}:${t.value}`,(t=t[aX])&&(e+=" < ");return e}}class a2{static hasLength(e,t){return e.length===t}static getValueType(e){return Object.prototype.toString.apply(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isIterable(e){return null!=e[Symbol.iterator]}static isNumber(e){return"[object Number]"===this.getValueType(e)}}var a5={exports:{}};"u">typeof self&&self,o7=function(){return function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return es}});var r={1078:"af",1052:"sq",1118:"am",5121:"ar_DZ",15361:"ar_BH",3073:"ar_EG",2049:"ar_IQ",11265:"ar_JO",13313:"ar_KW",12289:"ar_LB",4097:"ar_LY",6145:"ar_MA",8193:"ar_OM",16385:"ar_QA",1025:"ar_SA",10241:"ar_SY",7169:"ar_TN",14337:"ar_AE",9217:"ar_YE",1067:"hy",1101:"as",2092:"az_AZ",1068:"az_AZ",1069:"eu",1059:"be",2117:"bn",1093:"bn_IN",5146:"bs",1026:"bg",1109:"my",1027:"ca",2052:"zh_CN",3076:"zh_HK",5124:"zh_MO",4100:"zh_SG",1028:"zh_TW",1050:"hr",1029:"cs",1030:"da",1125:"dv",2067:"nl_BE",1043:"nl_NL",1126:"bin",3081:"en_AU",10249:"en_BZ",4105:"en_CA",9225:"en_CB",2057:"en_GB",16393:"en_IN",6153:"en_IE",8201:"en_JM",5129:"en_NZ",13321:"en_PH",7177:"en_ZA",11273:"en_TT",1033:"en_US",12297:"en_ZW",1061:"et",1071:"mk",1080:"fo",1065:"fa",1124:"fil",1035:"fi",2060:"fr_BE",11276:"fr_CM",3084:"fr_CA",9228:"fr_CG",12300:"fr_CI",1036:"fr_FR",5132:"fr_LU",13324:"fr_ML",6156:"fr_MC",14348:"fr_MA",10252:"fr_SN",4108:"fr_CH",7180:"fr",1122:"fy_NL",2108:"gd_IE",1084:"gd",1110:"gl",1079:"ka",3079:"de_AT",1031:"de_DE",5127:"de_LI",4103:"de_LU",2055:"de_CH",1032:"el",1140:"gn",1095:"gu",1279:"en",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig_NG",1057:"id",1040:"it_IT",2064:"it_CH",1041:"ja",1099:"kn",1120:"ks",1087:"kk",1107:"km",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1142:"la",1062:"lv",1063:"lt",2110:"ms_BN",1086:"ms_MY",1100:"ml",1082:"mt",1112:"mni",1153:"mi",1102:"mr",1104:"mn",2128:"mn",1121:"ne",1044:"no_NO",2068:"no_NO",1096:"or",1045:"pl",1046:"pt_BR",2070:"pt_PT",1094:"pa",1047:"rm",2072:"ro_MO",1048:"ro_RO",1049:"ru",2073:"ru_MO",1083:"se",1103:"sa",3098:"sr_SP",2074:"sr_SP",1072:"st",1074:"tn",1113:"sd",1115:"si",1051:"sk",1060:"sl",1143:"so",1070:"sb",11274:"es_AR",16394:"es_BO",13322:"es_CL",9226:"es_CO",5130:"es_CR",7178:"es_DO",12298:"es_EC",17418:"es_SV",4106:"es_GT",18442:"es_HN",2058:"es_MX",19466:"es_NI",6154:"es_PA",15370:"es_PY",10250:"es_PE",20490:"es_PR",1034:"es_ES",14346:"es_UY",8202:"es_VE",1089:"sw",2077:"sv_FI",1053:"sv_SE",1114:"syc",1064:"tg",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1073:"ts",1055:"tr",1090:"tk",1058:"uk",1056:"ur",2115:"uz_UZ",1091:"uz_UZ",1075:"ve",1066:"vi",1106:"cy",1076:"xh",1085:"yi",1077:"zu"};let n=/^([a-z\d]+)(?:[_-]([a-z\d]+))?(?:\.([a-z\d]+))?(?:@([a-z\d]+))?$/i,i={},s={group:"",decimal:".",positive:"+",negative:"-",percent:"%",exponent:"E",nan:"NaN",infinity:"",ampm:["AM","PM"],mmmm6:["Muharram","Safar","Rabi I","Rabi II","Jumada I","Jumada II","Rajab","Shaban","Ramadan","Shawwal","Dhul-Qidah","Dhul-Hijjah"],mmm6:["Muh.","Saf.","Rab. I","Rab. II","Jum. I","Jum. II","Raj.","Sha.","Ram.","Shaw.","Dhul-Q.","Dhul-H."],mmmm:["January","February","March","April","May","June","July","August","September","October","November","December"],mmm:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dddd:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ddd:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function a(e){let t=n.exec(e);if(!t)throw SyntaxError("Malformed locale: ".concat(e));return{lang:t[1]+(t[2]?"_"+t[2]:""),language:t[1],territory:t[2]||"",codeset:t[3]||"",modifier:t[4]||""}}function o(e){if("number"==typeof e)return r[65535&e]||null;let t=parseInt(e,16);return isFinite(t)&&r[65535&t]?r[65535&t]||null:n.test(e)?e:null}function l(e){let t=o(e),r=null;if(t){let e=a(t);r=i[e.lang]||i[e.language]||null}return r}function u(e){return Object.assign({},s,e)}function c(e,t){let r="object"==typeof t?t:a(t);return i[r.lang]=u(e),r.language===r.lang||i[r.language]||(i[r.language]=u(e)),i[r.lang]}let h=u({group:","});function d(e,t){if("number"!=typeof e)return e;if(e<0)return-d(-e,t);if(t){let r=10**(t||0)||1;return d(e*r,0)/r}return Math.round(e)}function m(e,t,r){let n=e<0?-1:1,i=10**(t||2),s=10**(r||2),a,o,l=Math.abs(e),u=0,c=0,h=0,d=1;if((e=l)%1==0)o=[e*n,1];else if(e<1e-19)o=[n,1e19];else if(e>1e19)o=[1e19*n,1];else{do if(l=1/(l-Math.floor(l)),a=d,d=d*Math.floor(l)+u,u=a,c=h,(h=Math.floor(e*d+.5))>=i||d>=s)return[n*c,u];while(Math.abs(e-h/d)>=1e-10&&l!==Math.floor(l))o=[n*h,d]}return o}h.isDefault=!0,c({group:",",ampm:["",""],mmmm:["","","","","","","","","","","",""],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"zh_CN"),c({group:",",nan:"",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"zh_TW"),c({group:",",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ja"),c({group:",",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ko"),c({group:",",ampm:["",""],mmmm:["","","","","","","","","","","",""],mmm:["..","..","..","..","..","..","..","..","..","..","..",".."],dddd:["","","","","","",""],ddd:[".",".",".",".",".",".","."]},"th"),c({decimal:",",ampm:["dop.","odp."],mmmm:["ledna","nora","bezna","dubna","kvtna","ervna","ervence","srpna","z","jna","listopadu","prosince"],mmm:["led","no","be","dub","kv","vn","vc","srp","z","j","lis","pro"],dddd:["nedle","pondl","ter","steda","tvrtek","ptek","sobota"],ddd:["ne","po","t","st","t","p","so"]},"cs"),c({group:".",decimal:",",mmmm:["januar","februar","marts","april","maj","juni","juli","august","september","oktober","november","december"],mmm:["jan.","feb.","mar.","apr.","maj","jun.","jul.","aug.","sep.","okt.","nov.","dec."],dddd:["sndag","mandag","tirsdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn.","man.","tir.","ons.","tor.","fre.","lr."]},"da"),c({group:".",decimal:",",ampm:["a.m.","p.m."],mmmm:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],mmm:["jan.","feb.","mrt.","apr.","mei","jun.","jul.","aug.","sep.","okt.","nov.","dec."],dddd:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],ddd:["zo","ma","di","wo","do","vr","za"]},"nl"),c({group:","},"en"),c({decimal:",",nan:"epluku",ampm:["ap.","ip."],mmmm:["tammikuuta","helmikuuta","maaliskuuta","huhtikuuta","toukokuuta","keskuuta","heinkuuta","elokuuta","syyskuuta","lokakuuta","marraskuuta","joulukuuta"],mmm:["tammik.","helmik.","maalisk.","huhtik.","toukok.","kesk.","heink.","elok.","syysk.","lokak.","marrask.","jouluk."],dddd:["sunnuntaina","maanantaina","tiistaina","keskiviikkona","torstaina","perjantaina","lauantaina"],ddd:["su","ma","ti","ke","to","pe","la"]},"fi"),c({group:"",decimal:",",mmmm:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"],mmm:["janv.","fvr.","mars","avr.","mai","juin","juil.","aot","sept.","oct.","nov.","dc."],dddd:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],ddd:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."]},"fr"),c({group:".",decimal:",",mmmm:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],mmm:["Jan.","Feb.","Mrz","Apr.","Mai","Juni","Juli","Aug.","Sept.","Okt.","Nov.","Dez."],dddd:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],ddd:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."]},"de"),c({group:".",decimal:",",ampm:["..",".."],mmmm:["","","","","","","","","","","",""],mmm:["","","","","","","","","","","",""],dddd:["","","","","","",""],ddd:["","","","","","",""]},"el"),c({decimal:",",ampm:["de.","du."],mmmm:["janur","februr","mrcius","prilis","mjus","jnius","jlius","augusztus","szeptember","oktber","november","december"],mmm:["jan.","febr.","mrc.","pr.","mj.","jn.","jl.","aug.","szept.","okt.","nov.","dec."],dddd:["vasrnap","htf","kedd","szerda","cstrtk","pntek","szombat"],ddd:["V","H","K","Sze","Cs","P","Szo"]},"hu"),c({group:".",decimal:",",ampm:["f.h.","e.h."],mmmm:["janar","febrar","mars","aprl","ma","jn","jl","gst","september","oktber","nvember","desember"],mmm:["jan.","feb.","mar.","apr.","ma","jn.","jl.","g.","sep.","okt.","nv.","des."],dddd:["sunnudagur","mnudagur","rijudagur","mivikudagur","fimmtudagur","fstudagur","laugardagur"],ddd:["sun.","mn.","ri.","mi.","fim.","fs.","lau."]},"is"),c({group:".",decimal:",",mmmm:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],mmm:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],dddd:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],ddd:["Min","Sen","Sel","Rab","Kam","Jum","Sab"]},"id"),c({group:".",decimal:",",mmmm:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],mmm:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],dddd:["domenica","luned","marted","mercoled","gioved","venerd","sabato"],ddd:["dom","lun","mar","mer","gio","ven","sab"]},"it"),c({decimal:",",ampm:["a.m.","p.m."],mmmm:["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],mmm:["jan.","feb.","mar.","apr.","mai","jun.","jul.","aug.","sep.","okt.","nov.","des."],dddd:["sndag","mandag","tirsdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn.","man.","tir.","ons.","tor.","fre.","lr."]},"nb"),c({decimal:",",mmmm:["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","wrzenia","padziernika","listopada","grudnia"],mmm:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","pa","lis","gru"],dddd:["niedziela","poniedziaek","wtorek","roda","czwartek","pitek","sobota"],ddd:["niedz.","pon.","wt.","r.","czw.","pt.","sob."]},"pl"),c({group:".",decimal:",",mmmm:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],mmm:["jan.","fev.","mar.","abr.","mai.","jun.","jul.","ago.","set.","out.","nov.","dez."],dddd:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"],ddd:["dom.","seg.","ter.","qua.","qui.","sex.","sb."]},"pt"),c({decimal:",",nan:"",mmmm:["","","","","","","","","","","",""],mmm:[".",".",".",".","",".",".",".",".",".",".","."],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ru"),c({decimal:",",mmmm:["janura","februra","marca","aprla","mja","jna","jla","augusta","septembra","oktbra","novembra","decembra"],mmm:["jan","feb","mar","apr","mj","jn","jl","aug","sep","okt","nov","dec"],dddd:["nedea","pondelok","utorok","streda","tvrtok","piatok","sobota"],ddd:["ne","po","ut","st","t","pi","so"]},"sk"),c({group:".",decimal:",",ampm:["a.m.","p.m."],mmmm:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],mmm:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],dddd:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"],ddd:["dom.","lun.","mar.","mi.","jue.","vie.","sb."]},"es"),c({decimal:",",ampm:["fm","em"],mmmm:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],mmm:["jan.","feb.","mars","apr.","maj","juni","juli","aug.","sep.","okt.","nov.","dec."],dddd:["sndag","mndag","tisdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn","mn","tis","ons","tors","fre","lr"]},"sv"),c({group:".",decimal:",",ampm:["","S"],mmmm:["Ocak","ubat","Mart","Nisan","Mays","Haziran","Temmuz","Austos","Eyll","Ekim","Kasm","Aralk"],mmm:["Oca","ub","Mar","Nis","May","Haz","Tem","Au","Eyl","Eki","Kas","Ara"],dddd:["Pazar","Pazartesi","Sal","aramba","Perembe","Cuma","Cumartesi"],ddd:["Paz","Pzt","Sal","ar","Per","Cum","Cmt"]},"tr");let g={overflow:"######",dateErrorThrows:!1,dateErrorNumber:!0,dateSpanLarge:!0,leap1900:!0,nbsp:!0,throws:!0,invalid:"######",locale:"",ignoreTimezone:!1},f=Object.assign({},g);function p(e){if(null===e&&(e=g),e){for(let t in e)if(t in g){let r=e[t];f[t]=null==r?g[t]:r}}return{...f}}let C={"#":"",0:"0","?":""},_={"@":"text","-":"minus","+":"plus"},y=["#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#800","#080","#008","#880","#808","#088","#CCC","#888","#99F","#936","#FFC","#CFF","#606","#F88","#06C","#CCF","#008","#F0F","#FF0","#0FF","#808","#800","#088","#00F","#0CF","#CFF","#CFC","#FF9","#9CF","#F9C","#C9F","#FC9","#36F","#3CC","#9C0","#FC0"],E=["","$","","","","","","","","","","","","","","","","","","","","","","","","",""],b=RegExp("["+E.join("")+"]");function R(e,t,r){return t[r+"_max"]=e.length,t[r+"_min"]=e.replace(/#/g,"").length,t}let N={};function I(e){if(!(e in N)){let t=[],r=e.replace(/^[#,]+/,"").replace(/[1-9]\d*/g,e=>"?".repeat(e.length));for(let e=0;e<r.length;e++){let n=r.charAt(e);t[e]=n in C?C[n]:n}N[e]=t.join("")}return N[e]}function A(e,t){"string"==typeof e&&(e={type:"string",value:e=e.replace(/ /g,C["?"])}),t.push(e)}function v(e){let t=[],r={scale:1,percent:!1,text:!1,date:0,date_eval:!1,date_system:1,sec_decimals:0,general:!1,clock:24,int_pattern:[],frac_pattern:[],man_pattern:[],den_pattern:[],num_pattern:[],tokens:t},n=e+"",i="int",s=!1,a=null,l=[],u,c,h=!1;for(;n&&!s;){if(u=/^General/i.exec(n))r.general=!0,A({type:"general"},t);else if("int"===i&&(u=/^[#?0]+(?:,[#?0]+)*/.exec(n))||"den"===i&&(u=/^[#?\d]+/.exec(n))||(u=/^[#?0]+/.exec(n)))r[i+"_pattern"].push(u[0]),A(a={type:i,num:u[0]},t);else if((u=/^\//.exec(n))&&r[i+"_pattern"].length){if(!a)throw SyntaxError("Missing a numerator in pattern ".concat(e));r.fractions=!0,r.num_pattern.push(r[i+"_pattern"].pop()),a.type="num",i="den",A({type:"div"},t)}else if(u=/^,+/.exec(n)){let e=n.charAt(1)in C;c.slice(-1)in C&&(u[0].length>1||!e)?r.scale=.001**u[0].length:r.dec_fractions||A(u[0],t)}else{if(u=/^;/.exec(n)){s=!0;break}if(u=/^[@+-]/.exec(n))"@"===u[0]&&(r.text=!0),A({type:_[u[0]]},t);else if(u=/^(?:\[(h+|m+|s+)\])/i.exec(n)){let e=u[1].toLowerCase(),n=e[0],i={type:"",size:0,date:1,raw:u[0],pad:e.length};"h"===n?(i.size=16,i.type="hour-elap"):"m"===n?(i.size=32,i.type="min-elap"):(i.size=64,i.type="sec-elap"),r.date=r.date|i.size,l.push(i),A(i,t)}else if(u=/^(?:B2)/i.exec(n))h||(r.date_system=6);else if(u=/^(?:B1)/i.exec(n))h||(r.date_system=1);else if(u=/^(?:([hHmMsSyYbBdDegG])\1*)/.exec(n)){let e={type:"",size:0,date:1,raw:u[0]},n=u[0].toLowerCase(),i=n[0];if("y"===n||"yy"===n)e.size=2,e.type="year-short";else if("y"===i||"e"===i)e.size=2,e.type="year";else if("b"===n||"bb"===n)e.size=2,e.type="b-year-short";else if("b"===i)e.size=2,e.type="b-year";else if("d"===n||"dd"===n)e.size=8,e.type="day",e.pad=/dd/.test(n);else if("ddd"===n)e.size=8,e.type="weekday-short";else if("d"===i)e.size=8,e.type="weekday";else if("h"===i)e.size=16,e.type="hour",e.pad=/hh/i.test(n);else if("m"===i){3===n.length?(e.size=4,e.type="monthname-short"):5===n.length?(e.size=4,e.type="monthname-single"):n.length>=4&&(e.size=4,e.type="monthname");let t=l[l.length-1];!e.type&&t&&!t.used&&80&t.size&&(t.used=!0,e.size=32,e.type="min",e.pad=/mm/.test(n)),e.type||(e.size=4,e.type="month",e.pad=/mm/.test(n),e.indeterminate=!0)}else if("s"===i){e.size=64,e.type="sec",e.pad=/ss/.test(n);let t=l[l.length-1];t&&32&t.size?e.used=!0:t&&t.indeterminate&&(delete t.indeterminate,t.size=32,t.type="min",e.used=!0)}r.date=r.date|e.size,r.date_eval=!0,l.push(e),A(e,t)}else if(u=/^(?:AM\/PM|am\/pm|A\/P)/.exec(n))r.clock=12,r.date=16|r.date,r.date_eval=!0,A({type:"am",short:"A/P"===u[0]},t);else if(r.date&&(u=/^\.0{1,3}/i.exec(n))){let e=u[0].length-1,n=[64,128,256,512][e];r.date=r.date|n,r.date_eval=!0,r.sec_decimals=Math.max(r.sec_decimals,e),A({type:"subsec",size:n,decimals:e,date:1,raw:u[0]},t)}else if((u=/^\\(.)/.exec(n))||(u=/^"([^"]*?)"/.exec(n)))A(u[1],t);else if(u=/^\[(<[=>]?|>=?|=)\s*(-?[.\d]+)\]/.exec(n))r.condition=[u[1],parseFloat(u[2],10)];else if(u=/^\[\$([^\]]+)\]/.exec(n)){let e=u[1].split("-"),n=e.length<2?"":e[e.length-1],i=e[0];i&&A(i,t);let s=o(n);s&&(r.locale=s);let a=parseInt(n,16);isFinite(a)&&0xff0000&a&&(a>>16&255)==6&&(r.date_system=6),h=!0}else if(u=/^\[(black|blue|cyan|green|magenta|red|white|yellow|color\s*(\d+))\]/i.exec(n))r.color=u[2]?y[parseInt(u[2],10)]||"#000":u[1].toLowerCase();else if(!(u=/^\[(DBNum1|ENG|HIJ|JPN|TWN)\]/i.exec(n))){if(u=/^%/.exec(n))r.scale=100,r.percent=!0,A("%",t);else if(u=/^_(\\.|.)/.exec(n))A(" ",t);else if(u=/^\./.exec(n))A({type:"point",value:u[0]},t),r.dec_fractions=!0,i="frac";else if(u=/^[Ee]([+-]?|(?=[0#?]))/.exec(n))r.exponential=!0,r.exp_plus="+"===u[1],i="man",A({type:"exp",plus:"+"===u[1]},t);else if(!(u=/^\*(\\.|.)/.exec(n))){if(u=/^[BENn[]/.exec(n))throw SyntaxError("Unexpected char ".concat(n.charAt(0)," in pattern ").concat(e));"("===n[0]&&(r.parens=!0),A((u=[n[0]])[0],t)}}}c=u[0],n=n.slice(u?u[0].length:1)}if(r.pattern=e.slice(0,e.length-n.length),/^((?:\[[^\]]+\])+)(;|$)/.test(r.pattern)&&!/^\[(?:h+|m+|s+)\]/.test(r.pattern)&&A({type:"text"},t),r.fractions&&r.dec_fractions||r.fractions&&r.exponential)throw SyntaxError("Invalid pattern: ".concat(r.pattern));let d=r.int_pattern.join("");if(r.grouping=d.indexOf(",")>=0,r.grouping){let e=d.split(","),t=e.length;2===t?(r.group_pri=e[1].length,r.group_sec=r.group_pri):t>2&&(r.group_pri=e[t-1].length,r.group_sec=e[t-2].length)}else r.group_pri=0,r.group_sec=0;R(d.replace(/[,]/g,""),r,"int"),R(r.frac_pattern.join(""),r,"frac"),R(r.man_pattern.join(""),r,"man");let m=r.num_pattern.join(""),g=r.den_pattern.join(""),f=/\?/.test(g)||/\?/.test(m);return g=g.replace(/\d/g,f?"?":"#"),f&&(g=g.replace(/#$/g,"?")),R(m,r,"num"),R(g,r,"den"),f&&(m=m.replace(/#$/g,"?")),r.int_padding=I(r.int_pattern.join("")),r.man_padding=I(r.man_pattern.join("")),r.num_padding=I(m),r.den_padding=I(g),r.den_pattern.length&&(r.denominator=parseInt(r.den_pattern.join("").replace(/\D/g,""),10)),r.integer=!!r.int_pattern.join("").length,r.fractions&&t.forEach((e,r)=>{let n=t[r+1];"string"===e.type&&n&&("num"===n.type?e.rule="num+int":"div"===n.type?e.rule="num":"den"===n.type&&(e.rule="den"))}),r}let S=e=>{let t=e.condition;t&&t[1]<0&&("<"===t[0]||"<="===t[0]||"="===t[0])||e.tokens.unshift({type:"minus",volatile:!0})};function T(e){let t=[],r,n=!1,i=null,s=e,a=0,l=!1,u=0,c=0;do{if(((l=v(s)).date||l.general)&&(l.int_pattern.length||l.frac_pattern.length||1!==l.scale||l.text))throw Error("Illegal format");if(l.condition&&(c++,n=!0),l.text){if(i)throw Error("Unexpected partition");i=l}l.locale&&(r=o(l.locale)),t.push(l),a=";"===s.charAt(l.pattern.length)?1:0,s=s.slice(l.pattern.length+a),u++}while(a&&u<4&&c<3)if(a)throw Error("Unexpected partition");if(c>2)throw Error("Unexpected condition");let h=t[3];if(h&&(h.int_pattern.length||h.frac_pattern.length||h.date))throw Error("Unexpected partition");if(n){let e=t.length;if(1===e&&(t[1]=v("General"),t[1].generated=!0),e<3){let e=t[0],r=t[1];if(S(e),r.condition)S(r);else{let t=e.condition;("="===t[0]||t[1]>=0&&(">"===t[0]||">="===t[0]))&&r.tokens.unshift({type:"minus",volatile:!0})}}else t.forEach(S)}else{if(t.length<4&&i)for(let e=0,r=t.length;e<r;e++)t[e]===i&&t.splice(e,1);if(t.length<1&&i&&(t[0]=v("General"),t[0].generated=!0),t.length<2){let e=v(t[0].pattern);e.tokens.unshift({type:"minus",volatile:!0}),e.generated=!0,t.push(e)}if(t.length<3){let e=v(t[0].pattern);e.generated=!0,t.push(e)}if(t.length<4){if(i)t.push(i);else{let e=v("@");e.generated=!0,t.push(e)}}t[0].condition=[">",0],t[1].condition=["<",0],t[2].condition=null}return{pattern:e,partitions:t,locale:r}}let O=Math.floor;function M(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e>=0){if(0===e)return[1900,1,0];if(60===e)return[1900,2,29];if(e<60)return[1900,e<32?1:2,(e-1)%31+1]}let t=e+68569+2415019,r=O(4*t/146097);t-=O((146097*r+3)/4);let n=O(4e3*(t+1)/1461001);t=t-O(1461*n/4)+31;let i=O(80*t/2447),s=t-O(2447*i/80);t=O(i/11);let a=i+2-12*t;return[0|100*(r-49)+n+t,0|a,0|s]}function w(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=O(e);return 6===t?function(e){if(60===e)throw Error("#VALUE!");if(e<=1)return[1317,8,29];if(e<60)return[1317,e<32?9:10,1+(e-2)%30];let t=10631/30,r=e+466935,n=O(r/10631),i=O(((r-=10631*n)-.1335)/t);r-=O(i*t+.1335);let s=O((r+28.5001)/29.5);return 13===s?[30*n+i,12,30]:[30*n+i,s,r-O(29.5001*s-29)]}(n):-1===t?M(n+1462):M(n,r)}let x=Math.floor;function U(e,t){let r=null;if(Array.isArray(e)){let[t,n,i,s,a,o]=e;r=Date.UTC(t,null==n?0:n-1,null!=i?i:1,s||0,a||0,o||0)}else if(e instanceof Date&&(r=1*e,!t||!t.ignoreTimezone)){let t=/* @__PURE__ */new Date;t.setUTCFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setUTCHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),r=1*t}if(null!=r&&isFinite(r)){let e=r/864e5;return e-(e<=-25509?-25568:-25569)}return e}function D(e,t){let r=0|e,n=86400*(e-r),i=x(n);n-i>.9999&&86400===(i+=1)&&(i=0,r+=1);let s=i<0?86400+i:i,[a,o,l]=w(e,0,t&&t.leap1900),u=x(s/60/60)%60,c=x(s/60)%60,h=x(s)%60;if(t&&t.nativeDate){let e=/* @__PURE__ */new Date(0);return e.setUTCFullYear(a,o-1,l),e.setUTCHours(u,c,h),e}return[a,o,l,u,c,h]}let V={text:15,datetime:10.8,date:10.8,time:10.8,percent:10.6,currency:10.4,grouped:10.2,scientific:6,number:4,fraction:2,general:0,error:0},L=[["DMY",1],["DM",2],["MY",3],["MDY",4],["MD",5],["hmsa",6],["hma",7],["hms",8],["hm",9]],P={total:1,sign:0,period:0,int:1,frac:0},j=(e,t)=>e.replace(/\./,t.decimal);function F(e,t,r,n){let i=0|r;if("string"==typeof r)e.push(r);else if(r===i)e.push(Math.abs(i));else{let t=Math.abs(r),i=t?Math.floor(Math.log10(t)):0,s=i<0?t*10**-i:t/10**i;10===s&&(s=1,i++);let a=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Math.abs(e);if(!r)return P;let n=t&&e<0?1:0,i=Math.floor(r),s=Math.floor(Math.log10(r)+1),a=0,o=0;if(i!==r){a=1;let e=String(d(s<0?r*10**-s:r/10**s,15)),t=e.length,n=!0,i=0;for(;i<=e.length;){if("."===e[i]){t--;break}"0"===e[i]&&n?t--:n=!1,i++}(o=t-s)<0&&(o=0,a=0)}return{total:n+Math.max(s,1)+a+o,digits:Math.max(s,0)+o,sign:n,period:a,int:Math.max(s,1),frac:o}}(t),o=()=>{let t;let r=Math.abs(i);t=1===s?s:d(s,5),e.push(j(t+"",n),n.exponent,i<0?n.negative:n.positive,r<10?"0":"",r)};if(i>=-4&&i<=-1){let r=t.toPrecision(10+i).replace(/\.?0+$/,"");e.push(j(r,n))}else if(10===i){let r=t.toFixed(10).slice(0,12).replace(/\.$/,"");e.push(j(r,n))}else if(9>=Math.abs(i)){if(a.total<=11){let r=d(t,9).toFixed(a.frac);e.push(j(r,n))}else 9===i?e.push(Math.floor(t)):i>=0&&i<9?e.push(d(t,9-i)):o()}else a.total>=12?o():Math.floor(t)===t?e.push(Math.floor(t)):e.push(j(d(t,9).toFixed(a.frac),n))}return e}let k={int:"integer",frac:"fraction",man:"mantissa",num:"numerator",den:"denominator"},B=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.floor(Math.log10(e));return t>1?Math.floor(r/t)*t:r};function $(e,t,r,n){var i,s;let a="",o="",l="",u="",c="",g=0,f=0|e,p=0,_=0,y=1,E=0,b=0,R=0,N=0,I=0,A=0,v=n||h;if(!t.text&&isFinite(t.scale)&&1!==t.scale&&(e=function(e){if(0===e)return e;let t=Math.ceil(Math.log10(e<0?-e:e)),r=10**(16-Math.floor(t));return Math.round(e*r)/r}(e*t.scale)),t.exponential){let r=Math.abs(e);if(r){let e=10**-B(r,t.int_max);g=B(d(r*e,t.frac_max)/e,t.int_max)}r/=10**g,e=e<0?-r:r,a+=Math.abs(g)}if(t.integer){let r=Math.abs(d(e,t.fractions?1:t.frac_max));c+=r<1?"":Math.floor(r)}if(t.grouping){let e="",r=c.length;for(r>t.group_pri&&(r-=t.group_pri,e=v.group+c.slice(r,r+t.group_pri)+e);r>t.group_sec;)r-=t.group_sec,e=v.group+c.slice(r,r+t.group_sec)+e;c=r?c.slice(0,r)+e:e}t.dec_fractions&&(u=String(d(e,t.frac_max)).split(".")[1]||"");let S=!1;if(t.fractions){let r=Math.abs(t.integer?e%1:e);if(r){if(S=!0,isFinite(t.denominator))l+=t.denominator,"0"===(o+=d(r*t.denominator))&&(o="",l="",S=!1,c||(c="0"));else{let e=m(r,t.integer?t.num_max:1/0,t.den_max);o+=e[0],l+=e[1],t.integer&&"0"===o&&(c||(c="0"),o="",l="",S=!1)}}}if(t.date){f=Math.trunc(e);let n=86400*(e-f);if(p=Math.floor(n),1e-6>Math.abs(A=n-p)?A=0:A>.9999&&(A=0,86400===(p+=1)&&(p=0,f+=1)),A){let e=512&t.date||256&t.date||128&t.date;(512===e&&A>.9995||256===e&&A>.995||128===e&&A>.95||!e&&A>=.5)&&(p++,A=0)}if(f||t.date_system){let n=w(e,t.date_system,r.leap1900);_=n[0],y=n[1],E=n[2]}if(p){let e=p<0?86400+p:p;I=Math.floor(e)%60,N=Math.floor(e/60)%60,R=Math.floor(e/60/60)%60}if(b=(6+f)%7,t.date_eval&&(i=e,s=f+p/86400,r.dateSpanLarge?i<-694324||s>=0x222ba13:i<0||s>=2958466)){if(r.dateErrorThrows)throw Error("Date out of bounds");return r.dateErrorNumber?F(e<0?[v.negative]:[],0,e,v).join(""):r.overflow}}if(t.int_padding&&(c=1===t.int_padding.length?c||t.int_padding:t.int_padding.substring(0,t.int_padding.length-c.length)+c),t.num_padding&&(o=1===t.num_padding.length?o||t.num_padding:t.num_padding.substring(0,t.num_padding.length-o.length)+o),t.den_padding&&(l=1===t.den_padding.length?l||t.den_padding:l+t.den_padding.slice(l.length)),t.man_padding){let e=t.exp_plus?"+":"";a=1===t.man_padding.length?(g<0?"-":e)+(a||t.man_padding):(g<0?"-":e)+t.man_padding.slice(0,t.man_padding.length-a.length)+a}let T=[],O=0,M={int:0,frac:0,man:0,num:0,den:0};for(let i=0,s=t.tokens.length;i<s;i++){let s=t.tokens[i],h=s.num?s.num.length:0;if("string"===s.type)s.rule?"num"===s.rule?S?T.push(s.value):(t.num_min>0||t.den_min>0)&&T.push(s.value.replace(/./g,C["?"])):"num+int"===s.rule?S&&c?T.push(s.value):t.den_min>0&&(c||t.num_min)&&T.push(s.value.replace(/./g,C["?"])):"den"===s.rule&&(S?T.push(s.value):(t.den_min>0||t.den_min>0)&&T.push(s.value.replace(/./g,C["?"]))):T.push(s.value);else if("error"===s.type)T.push(r.invalid);else if("point"===s.type)T.push(t.date?s.value:v.decimal);else if("general"===s.type)F(T,0,e,v);else if("exp"===s.type)T.push(v.exponent);else if("minus"===s.type)s.volatile&&t.date||s.volatile&&(e>=0||"number"!=typeof e)||(s.volatile&&!t.fractions&&(t.integer||t.dec_fractions)?(e<0&&c&&"0"!==c||u)&&T.push(v.negative):T.push(v.negative));else if("plus"===s.type)T.push(v.positive);else if("text"===s.type)T.push(e);else if("div"===s.type)S?T.push("/"):t.num_min>0||t.den_min>0?T.push(C["?"]):T.push(C["#"]);else if("int"===s.type){if(1===t.int_pattern.length)T.push(c);else{let e=O?t.int_pattern.join("").length-M.int:1/0,r=O===t.int_pattern.length-1?0:t.int_pattern.join("").length-(M.int+s.num.length);T.push(c.substring(c.length-e,c.length-r)),O++,M.int+=s.num.length}}else if("frac"===s.type){let e=M.frac;for(let t=0;t<h;t++)T.push(u[t+e]||C[s.num[t]]);M.frac+=h}else if(s.type in k)1===t[s.type+"_pattern"].length?("int"===s.type&&T.push(c),"frac"===s.type&&T.push(u),"man"===s.type&&T.push(a),"num"===s.type&&T.push(o),"den"===s.type&&T.push(l)):(T.push(k[s.type].slice(M[s.type],M[s.type]+h)),M[s.type]+=h);else if("year"===s.type)_<0&&T.push(v.negative),T.push(String(Math.abs(_)).padStart(4,"0"));else if("year-short"===s.type){let e=_%100;T.push(e<10?"0":"",e)}else if("month"===s.type)T.push(s.pad&&y<10?"0":"",y);else if("monthname-single"===s.type)6===t.date_system?T.push(v.mmmm6[y-1].charAt(0)):T.push(v.mmmm[y-1].charAt(0));else if("monthname-short"===s.type)6===t.date_system?T.push(v.mmm6[y-1]):T.push(v.mmm[y-1]);else if("monthname"===s.type)6===t.date_system?T.push(v.mmmm6[y-1]):T.push(v.mmmm[y-1]);else if("weekday-short"===s.type)T.push(v.ddd[b]);else if("weekday"===s.type)T.push(v.dddd[b]);else if("day"===s.type)T.push(s.pad&&E<10?"0":"",E);else if("hour"===s.type){let e=R%t.clock||(t.clock<24?t.clock:0);T.push(s.pad&&e<10?"0":"",e)}else if("min"===s.type)T.push(s.pad&&N<10?"0":"",N);else if("sec"===s.type)T.push(s.pad&&I<10?"0":"",I);else if("subsec"===s.type){T.push(v.decimal);let e=A.toFixed(t.sec_decimals);T.push(e.slice(2,2+s.decimals))}else if("am"===s.type){let e=R<12?0:1;s.short&&!n?T.push("AP"[e]):T.push(v.ampm[e])}else if("hour-elap"===s.type){e<0&&T.push(v.negative);let t=24*f+Math.floor(Math.abs(p)/3600);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("min-elap"===s.type){e<0&&T.push(v.negative);let t=1440*f+Math.floor(Math.abs(p)/60);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("sec-elap"===s.type){e<0&&T.push(v.negative);let t=86400*f+Math.abs(p);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("b-year"===s.type)T.push(_+543);else if("b-year-short"===s.type){let e=(_+543)%100;T.push(e<10?"0":"",e)}}return r.nbsp?T.join(""):T.join("").replace(/\u00a0/g," ")}function H(e,t){for(let r=0;r<3;r++){let n=t[r];if(n){let t;if(n.condition){let r=n.condition[0],i=n.condition[1];"="===r?t=e===i:">"===r?t=e>i:"<"===r?t=e<i:">="===r?t=e>=i:"<="===r?t=e<=i:"<>"===r&&(t=e!==i)}else t=!0;if(t)return n}}}let W=v("@"),G="black",Y={};function z(e,t){if(e){let r=e[0];t[r]=t[r]||{},z(e.slice(1),t[r])}else t.$=!0}["d-F-y","d-F-Y","d-M-y","d-M-Y","F-d-y","F-d-Y","F-j-y","F-j-Y","j-F-y","j-F-Y","j-M-y","j-M-Y","M-d-y","M-d-Y","M-j-y","M-j-Y","m-d-y","m-d-Y","m-j-y","m-j-Y","n-d-y","n-d-Y","n-j-y","n-j-Y","y-F-d","y-F-j","y-M-d","y-M-j","Y-F-d","Y-F-j","Y-M-d","Y-m-d","Y-M-j","Y-m-j","Y-n-d","Y-n-j","j-F","j-M","d-F","d-M","n-d","n-j","n-Y","m-d","m-j","m-Y","M-Y","M-y","F-y","F-Y","Y-M","Y-n","Y-m","Y-F","Y-M"].forEach(e=>{z(e,Y),z(e+" x",Y),z(e+" l",Y),z(e+" l x",Y),z("l "+e,Y),z("l "+e+" x",Y),z(e+" D",Y),z(e+" D x",Y),z("D "+e,Y),z("D "+e+" x",Y)});let q={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},X={january:1,february:2,march:3,april:4,june:6,july:7,august:8,september:9,october:10,november:11,december:12},K={sunday:"l",monday:"l",tuesday:"l",wednesday:"l",thursday:"l",friday:"l",saturday:"l",sun:"D",mon:"D",tue:"D",wed:"D",thu:"D",fri:"D",sat:"D"},Q=/* @__PURE__ */new Date().getUTCFullYear();function Z(e){let t=RegExp("^([\\s+%"+E.join("")+"(-]*)(((?:(?:\\d[\\d,]*)(?:\\.\\d*)?|(?:\\.\\d+)))([eE][+-]?\\d+)?)([\\s%"+E.join("")+")]*)$").exec(e);if(t){let[,e,r,n,i,s]=t,a=1,o="",l=!1,u=!1,c=!1,h=!1,d=!1,m=null,g=!1,f=parseFloat(r.replace(/,/g,""));if(!isFinite(f))return null;for(let t=0;t<e.length;t++){let r=e[t];if("-"===r){if(l||u)return null;l=!0,a=-1}else if(b.test(r)){if(d)return null;d=!0,m=r}else if("("===r){if(u||l)return null;u=!0,a=-1}else if("%"===r){if(h)return null;h=!0}}for(let e=0;e<s.length;e++){let t=s[e];if(b.test(t)){if(d)return null;d=!0,m=t,g=!0}else if(")"===t){if(c||!u)return null;c=!0}else if("%"===t){if(h)return null;h=!0}}if(i){if(h||d)return null;o="0.00E+00"}else if(h){if(d)return null;o=n.includes(".")?"0.00%":"0%",f*=.01}else if(d){let e=n.includes(".")?"#,##0.00":"#,##0";o=g?e+m:m+e}else n.includes(",")&&(o=n.includes(".")?"#,##0.00":"#,##0");let p={v:f*a};return o&&(p.z=o),p}}let J=(e,t,r)=>{let n=r.path||"",i=Object.keys(t);for(let s=0;s<i.length;s++){let a;let o=i[s];if(t[o]){if("$"===o||""===o)e||(a=r);else if("-"===o){let i=/^(\s*([./-]|,\s)\s*|\s+)/.exec(e);if(i){let s="-"===i[1]||"/"===i[1]||"."===i[1]?i[1]:" ";if(!r.sep||r.sep===s){let l=i[0].replace(/\s+/g," ");a=J(e.slice(i[0].length),t[o],{...r,sep:s,path:n+l})}}}else if(" "===o){let i=/^[,.]?\s+/.exec(e);if(i){let s=i[0].replace(/\s+/g," ");a=J(e.slice(i[0].length),t[o],{...r,path:n+s})}}else if("j"===o||"d"===o){let i=/^(0?[1-9]|1\d|2\d|3[01])\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,day:i[0],path:n+o}))}else if("n"===o||"m"===o){let i=/^(0?[1-9]|1[012])\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,month:+i[0],_mon:i[0],path:n+o}))}else if("F"===o||"M"===o){let i=/^([a-z]{3,9})\b/i.exec(e),s=i&&("F"===o?X:q)[i[0].toLowerCase()];s&&(a=J(e.slice(i[0].length),t[o],{...r,month:s,_mon:i[0],path:n+o}))}else if("l"===o||"D"===o){let i=/^([a-z]{3,9})\b/i.exec(e);(i&&K[i[0].toLowerCase()])===o&&(a=J(e.slice(i[0].length),t[o],{...r,path:n+o}))}else if("y"===o){let i=/^\d\d\b/.exec(e);if(i){let s=+i[0]>=30?+i[0]+1900:+i[0]+2e3;a=J(e.slice(i[0].length),t[o],{...r,year:s,path:n+o})}}else if("Y"===o){let i=/^\d\d\d\d\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,year:+i[0],path:n+o}))}else{if("x"!==o)throw Error('Unknown date token "'.concat(o,'"'));{let i=et(e);i&&(a=J("",t[o],{...r,time:i.v,tf:i.z,path:n+o}))}}if(a)return a}}};function ee(e,t){let r=J(e.trim(),Y,{path:""});if(r){var n;if("."===r.sep&&3===r.path.length)return null;let e=+(null!==(n=r.year)&&void 0!==n?n:Q);if(r.day||(r.day=1),!function(e,t,r){if(r<1||t<1||t>12)return!1;if(2===t){if(r>(e%4==0&&e%100!=0||e%400==0||1900===e?29:28))return!1}else if((4===t||6===t||9===t||11===t)&&r>30||(1===t||3===t||5===t||7===t||8===t||10===t||12===t)&&r>31)return!1;return!0}(e,r.month,r.day))return null;let i=-1/0;if(e<1900)return null;e<=1900&&r.month<=2?i=25568:e<1e4&&(i=25569);let s=Date.UTC(e,r.month-1,r.day)/864e5+i+(r.time||0);if(s>=0&&s<=2958465){let e="0"===r._mon[0]||"0"===r.day[0]||2===r._mon.length&&2===r.day.length,n=r.path.replace(/[jdlDnmMFyYx-]/g,t=>"j"===t||"d"===t?e?"dd":"d":"D"===t?"ddd":"l"===t?"dddd":"n"===t||"m"===t?e?"mm":"m":"M"===t?"mmm":"F"===t?"mmmm":"y"===t?"yy":"x"===t?r.tf||"":"Y"===t?"yyyy":t);return t&&t.nativeDate?{v:D(s,t),z:n}:{v:s,z:n}}}return null}function et(e){let t=/^\s*([10]?\d|2[0-4])(?::([0-5]\d|\d))?(?::([0-5]\d|\d))?(\.\d{1,10})?(?:\s*([AP])M?)?\s*$/i.exec(e);if(t){let[,e,r,n,i,s]=t;if(i&&!n||!s&&!r&&!n)return null;let a=1*(e||0);if(s){if(a>=13)return null;"p"!==s[0]&&"P"!==s[0]||(a+=12)}return{v:(60*a*60+1*(r||0)*60+1*(n||0)+1*(i||0))/86400,z:(2===e.length?"hh":"h")+":mm"+(n?":ss":"")+(s?" AM/PM":"")}}return null}function er(e){return/^\s*true\s*$/i.test(e)?{v:!0}:/^\s*false\s*$/i.test(e)?{v:!1}:null}let en={};function ei(e,t){e||(e="General");let r=null;return en[e]?r=en[e]:(r=Object.assign({},p(),t).throws?T(e):function(e){try{return T(e)}catch(r){let t={tokens:[{type:"error"}],error:r.message};return{pattern:e,partitions:[t,t,t,t],error:r.message,locale:null}}}(e)).error||(en[e]=r),function(e,t){let{pattern:r,partitions:n,locale:i}=e,s=e=>{let r=Object.assign({},p(),t,e);return i&&(r.locale=i),r},a=(e,t)=>{let r=s(t);return function(e,t,r){let n=l(r.locale),i=t[3]?t[3]:W;if("boolean"==typeof e&&(e=e?"TRUE":"FALSE"),null==e)return"";if("number"!=typeof e)return $(e,i,r,n);if(!isFinite(e)){let t=n||h;return isNaN(e)?t.nan:(e<0?t.negative:"")+t.infinity}let s=H(e,t);return s?$(e,s,r,n):r.overflow}(U(e,r),n,r)};a.color=(e,t)=>(function(e,t){if("number"!=typeof e||!isFinite(e))return(t[3]?t[3].color:W.color)||G;let r=H(e,t);return r&&r.color||G})(U(e,s(t)),n);let o=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,[n,i]=e,s=n.frac_max,a={type:"general",isDate:!!(e[0]&&e[0].date||e[1]&&e[1].date||e[2]&&e[2].date||e[3]&&e[3].date),isText:function(e){let[t,r,n,i]=e;return!(t&&!t.generated||r&&!r.generated||n&&!n.generated||!i||!i.text||i.generated)}(e),isPercent:!!(e[0]&&e[0].percent||e[1]&&e[1].percent||e[2]&&e[2].percent||e[3]&&e[3].percent),maxDecimals:n.general?9:s,scale:null!==(t=n.scale)&&void 0!==t?t:1,color:0,parentheses:0,grouped:n.grouping?1:0,_partitions:e},o=!a.isDate&&!a.isText&&!n.error&&n.tokens.some(e=>"string"===e.type&&(r?e.value===r:b.test(e.value))),l="G",u=s>=0?Math.min(15,s):"",c="",h="";if(i&&i.color&&(h="-",a.color=1),n.parens&&(c="()",a.parentheses=1),o)l="C",a.type="currency";else if(n.error)a.type="error",a.maxDecimals=0;else if(a.isDate){let e=0,t=0,r="";n.tokens.forEach(n=>{let i=n.type;/^(b-)?year/.test(i)?(r+="Y",t++):i.startsWith("month")?(r+="M",t++):/^(week)?day/.test(i)?(r+="D",t++):"hour"!==i&&"min"!==i&&"sec"!==i&&"am"!==i||(r+=i[0],e++)}),a.type="date",t&&e?a.type="datetime":!t&&e&&(a.type="time");let i=L.find(e=>r.startsWith(e[0]));l=i?"D":"G",u=i?i[1]:""}else a.isText?(l="G",a.type="text",u="",a.maxDecimals=0):n.general?(l="G",a.type="general",u=""):n.fractions?(l="G",a.type="fraction",u=""):n.exponential?(l="S",a.type="scientific"):a.isPercent?(l="P",a.type="percent"):n.grouping?(l=",",a.type="grouped"):(n.int_max||s)&&(l="F",a.type="number");return a.code=l+u+h+c,a.level=V[a.type],Object.freeze(a)}(n,(t||{}).currency)||SyntaxError();return a.info=o,a.dateInfo=function(e){let[t]=e;return{year:!!(2&t.date),month:!!(4&t.date),day:!!(8&t.date),hours:!!(16&t.date),minutes:!!(32&t.date),seconds:!!(64&t.date),clockType:12===t.clock?12:24}}(n),a.isPercent=()=>!!o.isPercent,a.isDate=()=>!!o.isDate,a.isText=()=>!!o.isText,a.pattern=r,e.error&&(a.error=e.error),a.options=s,a.locale=i||t&&t.locale||"",Object.freeze(a)}(r,t)}ei.isDate=e=>ei(e,{throws:!1}).isDate(),ei.isPercent=e=>ei(e,{throws:!1}).isPercent(),ei.isText=e=>ei(e,{throws:!1}).isText(),ei.getInfo=(e,t)=>ei(e,{...t,throws:!1}).info,ei.getDateInfo=(e,t)=>ei(e,{...t,throws:!1}).dateInfo,ei.dateToSerial=U,ei.dateFromSerial=D,ei.options=p,ei.dec2frac=m,ei.round=d,ei.codeToLocale=r,ei.parseLocale=a,ei.getLocale=l,ei.addLocale=(e,t)=>{let r=a(t);return delete en[r.lang],delete en[r.language],c(e,r)},ei.format=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=r&&"object"==typeof r?r:{locale:r,throws:!n};return ei(e,i)(U(t,i),i)},ei.is_date=ei.isDate,ei.parseNumber=Z,ei.parseDate=ee,ei.parseTime=et,ei.parseBool=er,ei.parseValue=function(e,t){var r,n,i;return null!==(r=null!==(n=null!==(i=Z(e))&&void 0!==i?i:ee(e,t))&&void 0!==n?n:et(e))&&void 0!==r?r:er(e)};var es=ei;return t.default}()},a5.exports=o7();let a3=/* @__PURE__ */rB(a5.exports);function a4(e){let t=0;for(let r of Object.keys(e))t=Math.max(t,Number(r));return t+1}function a6(e,t,r){let n=a4(r);for(let t=n-1;t>=e;t--)r[t+1]=r[t];r[e]=t}function a9(e,t,r){let n=Object.keys(r).reduce((e,t)=>Math.max(e,Number.parseInt(t)),0)+1;for(let i=e;i<n;i++)i<e+t?delete r[i]:void 0!==r[i]&&(r[i-t]=r[i],delete r[i])}function a7(e,t){let r=Object.keys(e),n=r.length,i=Object.keys(t),s=i.length,a={},o=0;for(let t=0;t<n;t++,o++){let n=r[t];a[o]=e[n]}for(let e=0;e<s;e++,o++){let r=i[e];a[o]=t[r]}return a}function a8(e,t,r){if(a4(r)>0){let n={},i=0;for(let s=e;s<=t;s++)r[s]&&(n[i]=r[s],i++);return n}return{}}function oe(e,t,r,n){let i=e>r;if(!i&&e+t>r)throw Error("Invalid move operation");i?function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e-1;i>=r;i--){let e=n[i];n[i+t]=e,void 0===e&&delete n[i+t]}i.forEach((e,t)=>{n[r+t]=e,void 0===e&&delete n[r+t]})}(e,t,r,n):function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e+t;i<r;i++){let e=n[i];n[i-t]=e,void 0===e&&delete n[i-t]}i.forEach((e,i)=>{n[r+i-t]=e,void 0===e&&delete n[r+i-t]})}(e,t,r,n)}class ot{constructor(e={}){tr(this,"_matrix"),this._setOriginValue(e)}static MakeObjectMatrixSize(e){return new ot({[e-1]:{}})}getMatrix(){return this._matrix}forEach(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,i))break}return this}forRow(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,Object.keys(i).map(e=>Number(e))))break}return this}forValue(e){let t=this._matrix;for(let r in t){let n=Number(r),i=t[n];if(i)for(let t in i){let r=Number(t),s=i[r];if(!1===e(n,r,s))return this}}return this}swapRow(e,t){let r=this._matrix[e],n=this._matrix[t];this._matrix[e]=n,this._matrix[t]=r}getRow(e){return this._matrix[e]}getRowOrCreate(e){let t=this.getRow(e);return null==t&&(t={},this._matrix[e]=t),t}reset(){this._setOriginValue({})}hasValue(){let e=this._matrix,t=Object.keys(e);if(0===t.length)return!1;for(let r of t)if(Object.keys(e[Number(r)]).length>0)return!0;return!1}getValue(e,t){var r,n;return null==(n=null==(r=this._matrix)?void 0:r[e])?void 0:n[t]}setValue(e,t,r){this.getRowOrCreate(e)[t]=r}deleteValue(e,t){var r,n;null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t]}realDeleteValue(e,t){var r,n,i;if(null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t],this.getRow(e)){let t=this.getRow(e);if(null==t)return;0===Object.keys(t).length&&(null==(i=this._matrix)||delete i[e])}}setRow(e,t){this._matrix[e]=t}moveRows(e,t,r){oe(e,t,r,this._matrix)}moveColumns(e,t,r){this.forEach((n,i)=>{oe(e,t,r,i)})}insertRows(e,t){for(let r=e;r<e+t;r++)a6(r,{},this._matrix)}insertColumns(e,t){for(let r=e;r<e+t;r++)this.forEach((e,t)=>{t&&a6(r,void 0,t)})}removeRows(e,t){a9(e,t,this._matrix)}removeColumns(e,t){this.forEach((r,n)=>{n&&a9(e,t,n)})}getFragment(e,t,r,n){let i=new ot,s=0;for(let a=e;a<=t;a++){let e={},t=0;for(let i=r;i<=n;i++){let r=this.getValue(a,i);e[t]=r,t++}i.setRow(s,e),s++}return i}getSlice(e,t,r,n){let i=new ot;for(let s=e;s<=t;s++)for(let e=r;e<=n;e++){let t=this.getValue(s,e);t&&i.setValue(s,e,sU.deepClone(t))}return i}getSizeOf(){return Object.keys(this._matrix).length}getLength(){return a4(this._matrix)}getRange(){let e=this.getLength()-1,t=0,r=this.getLength();for(let e=0;e<r;e++){let r=this.getRow(e);if(r){let e=a4(r)-1;t=e>t?e:t}}return{startRow:0,startColumn:0,endRow:e,endColumn:t}}toNativeArray(){let e=[];return this.forValue((t,r,n)=>{e.push(n)}),e}toArray(){let e=[];return this.forRow((t,r)=>{null==e[t]&&(e[t]=[]),r.forEach(r=>{e[t][r]=this.getValue(t,r)})}),e}toFullArray(){let{endColumn:e,endRow:t}=this.getRange(),r=[];for(let n=0;n<=t;n++){let t=Array(e+1).fill(void 0);r.push(t)}return this.forValue((e,t,n)=>{r[e][t]=n}),r}toJSON(){return this._matrix}clone(){return JSON.parse(JSON.stringify(this._matrix))}getData(){return JSON.parse(JSON.stringify(this._matrix))}getArrayData(){let e=0,t=0,r=!1,n=!1,i=new ot;return this.forEach((s,a)=>{r||(r=!0,e=s),Object.keys(a).forEach(r=>{let a=Number(r);n?a<t&&(t=a):(n=!0,t=a);let o=this.getValue(s,a);i.setValue(s-e,a-t,o)})}),i.getData()}getStartEndScope(){let e=1/0,t=-1/0,r=1/0,n=-1/0,i=Object.keys(this._matrix);for(let s of(i.length>0&&(e=+i[0],t=+i[i.length-1]),i)){let e=Object.keys(this._matrix[s]);e.length>0&&(r=Math.min(r,+e[0]),n=Math.max(n,+e[e.length-1]))}return{startRow:e,endRow:t,startColumn:r,endColumn:n}}getDataRange(){let e=0,t=0,r=0,n=-1,i=!1,s=!1;return this.forEach((a,o)=>{if(i||(i=!0,e=a),null==o)return;let l=a4(o)-1;l>r&&(r=l),Object.keys(o).forEach(e=>{let r=Number(e);s?r<t&&(t=r):(s=!0,t=r)}),a>n&&(n=a)}),{startRow:e,startColumn:t,endRow:n,endColumn:r}}getDiscreteRanges(){let e=[];return this.forEach((t,r)=>{Object.keys(r).forEach(r=>{let n=Number(r),i=!1;for(let r of e)if(t>=r.startRow&&t<=r.endRow+1&&n>=r.startColumn&&n<=r.endColumn+1){r.endRow=Math.max(t,r.endRow),r.endColumn=Math.max(n,r.endColumn),i=!0;break}i||e.push({startRow:t,endRow:t,startColumn:n,endColumn:n})})}),e}merge(e){this.forValue((t,r)=>{let n=e.getValue(t,r);null!=n&&this.setValue(t,r,n)})}_setOriginValue(e={}){this._matrix=e}}let or={ff:"Arial",fs:11,it:s_.FALSE,bl:s_.FALSE,ul:{s:s_.FALSE},st:{s:s_.FALSE},ol:{s:s_.FALSE},tr:{a:0,v:s_.FALSE},td:sc.UNSPECIFIED,cl:{rgb:"#000"},bg:{rgb:"#fff"},ht:sd.UNSPECIFIED,vt:sm.UNSPECIFIED,tb:sg.UNSPECIFIED,pd:{t:0,r:0,b:0,l:0},n:null},on={id:"default_slide",title:"defaultSlide",pageSize:{width:300,height:300}},oi=[r8,nt,ne];var os=((Y=os||{}).ARRAY_CONVERTOR="ARRAY_CONVERTOR",Y.MATRIX_CONVERTOR="MATRIX_CONVERTOR",Y);function oa(e,t){let{textRuns:r=[]}=t,n=0;for(let t of r){let{ts:r={},st:i,ed:s}=t;if(null==r[e])return s_.FALSE;switch(e){case"bl":case"it":if(r[e]===s_.FALSE)return s_.FALSE;break;case"ul":case"st":if(r[e].s===s_.FALSE)return s_.FALSE;break;default:throw Error(`unknown style key: ${e} in IStyleBase`)}n+=s-i}return t.dataStream.indexOf(`\r
`)===n?s_.TRUE:s_.FALSE}let oo=class e{constructor(e,t,r){tr(this,"_range"),tr(this,"_worksheet"),this._deps=r,this._range=t,this._worksheet=e}static foreach(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}getRangeData(){return this._range}getValue(){return this.getValues()[0][0]}getValues(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=[];for(let s=e;s<=t;s++){let e=[];for(let t=r;t<=n;t++)e.push(this.getMatrix().getValue(s,t)||null);i.push(e)}return i}getMatrix(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new ot;for(let a=e;a<=t;a++)for(let e=r;e<=n;e++)s.setValue(a,e,i.getValue(a,e)||null);return s}getMatrixObject(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new ot;for(let a=e;a<=t;a++)for(let t=r;t<=n;t++)s.setValue(a-e,t-r,i.getValue(a,t)||{});return s}getA1Notation(){let e,t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range;return i<s?(e=sU.numToWord(i+1)+(r+1),t=sU.numToWord(s+1)+(n+1)):(e=sU.numToWord(s+1)+(n+1),t=sU.numToWord(i+1)+(r+1)),e===t?`${e}`:`${e}:${t}`}getBackground(){return this.getBackgrounds()[0][0]}getBackgrounds(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.bg)?void 0:r.rgb)||or.bg.rgb}))}getCell(t,r){let{startRow:n,startColumn:i}=this._range;return new e(this._worksheet,{startRow:n+t,endRow:n+t,startColumn:i+r,endColumn:i+r},this._deps)}getColumn(){return this._range.startColumn}getObjectValue(e={}){return this.getObjectValues(e)[0][0]}getObjectValues(e={}){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range,a=this._worksheet.getCellMatrix().getFragment(r,n,i,s).getData();if(e.isIncludeStyle){let e=this._deps.getStyles();for(let o=0;o<=n-r;o++)for(let r=0;r<=s-i;r++){if(null==a||(null==(t=null==a?void 0:a[o])?void 0:t[r])==null)continue;let n=a[o][r].s;n&&(a[o][r].s=e.get(n))}}return a}getFontColor(){return this.getFontColors()[0][0]}getFontColors(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.cl)?void 0:r.rgb)||or.cl.rgb}))}getFontFamilies(){return this._getStyles("ff")}getFontFamily(){return this.getFontFamilies()[0][0]}getUnderlines(){return this._getStyles("ul")}getUnderline(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?oa("ul",r.body)===s_.TRUE?{s:s_.TRUE}:{s:s_.FALSE}:this.getUnderlines()[0][0]}getOverlines(){return this._getStyles("ol")}getOverline(){return this.getOverlines()[0][0]}getStrikeThrough(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?oa("st",r.body)===s_.TRUE?{s:s_.TRUE}:{s:s_.FALSE}:this.getStrikeThroughs()[0][0]}getStrikeThroughs(){return this._getStyles("st")}getFontSize(){var e,t;let r=(null==(e=this.getValue())?void 0:e.p)||{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0&&r.body.textRuns.some(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)!=null})?Math.max(...r.body.textRuns.map(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)||0})):this.getFontSizes()[0][0]}getFontSizes(){return this._getStyles("fs")}getBorder(){return this.getBorders()[0][0]}getBorders(){return this._getStyles("bd")}getFontStyle(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?oa("it",r.body)===s_.TRUE?sf.ITALIC:sf.NORMAL:this._getFontStyles()[0][0]}_getFontStyles(){return this._getStyles("it")}getFontWeight(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?oa("bl",r.body)===s_.TRUE?sp.BOLD:sp.NORMAL:this._getFontWeights()[0][0]}_getFontWeights(){return this._getStyles("bl")}getGridId(){return this._worksheet.getSheetId()}getHeight(){let{_range:e,_worksheet:t}=this,{startRow:r,endRow:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getRowHeight(e);return i}getHorizontalAlignment(){return this.getHorizontalAlignments()[0][0]}getHorizontalAlignments(){return this._getStyles("ht")}getLastColumn(){return this._range.endColumn}getLastRow(){return this._range.endRow}getNumColumns(){let{startColumn:e,endColumn:t}=this._range;return t-e+1}getNumRows(){let{startRow:e,endRow:t}=this._range;return t-e+1}getRichTextValue(){return this.getRichTextValues()[0][0]}getRichTextValues(){return this.getValues().map(e=>e.map(e=>(null==e?void 0:e.p)||""))}getRowIndex(){return this._range.startRow}getSheet(){return this._worksheet}getTextDirection(){return this.getTextDirections()[0][0]}getTextDirections(){return this._getStyles("td")}getTextRotation(){return this.getTextRotations()[0][0]}getTextRotations(){return this._getStyles("tr")}getTextStyle(){return this.getTextStyles()[0][0]}getTextStyles(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>e.getStyleByCell(t)))}getVerticalAlignment(){return this.getVerticalAlignments()[0][0]}getVerticalAlignments(){return this._getStyles("vt")}getWidth(){let{_range:e,_worksheet:t}=this,{startColumn:r,endColumn:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getColumnWidth(e);return i}getWrap(){return this.getWrapStrategy()===sg.WRAP?s_.TRUE:s_.FALSE}getWrapStrategies(){return this._getStyles("tb")}getWrapStrategy(){return this.getWrapStrategies()[0][0]}forEach(t){e.foreach(this._range,t)}_getStyles(e){let t=this._deps.getStyles();return this.getValues().map(r=>r.map(r=>{let n=t&&t.getStyleByCell(r);return n&&n[e]||or[e]}))}};tr(oo,"transformRange",(e,t)=>{let r=t.getMaxColumns()-1,n=t.getMaxRows()-1;return e.rangeType===ao.ALL?{startColumn:0,startRow:0,endColumn:r,endRow:n}:e.rangeType===ao.COLUMN?{startRow:0,endRow:n,startColumn:e.startColumn,endColumn:e.endColumn}:e.rangeType===ao.ROW?{startColumn:0,endColumn:r,startRow:e.startRow,endRow:e.endRow}:{startColumn:e.startColumn,endColumn:Math.min(e.endColumn,r),startRow:e.startRow,endRow:Math.min(e.endRow,n)}});let ol=oo;function ou(e,t,r,n=!1){if(0===t&&0===r)return e;let i={...e},s=i.startAbsoluteRefType||al.NONE,a=i.endAbsoluteRefType||al.NONE,o=i.rangeType||ao.NORMAL;if(!n&&s===al.ALL&&a===al.ALL)return i;let l=oc(i.startRow,r,i.startColumn,t,o),u=oc(i.endRow,r,i.endColumn,t,o);return n||s===al.NONE&&a===al.NONE?i={...i,startRow:l.row,startColumn:l.column,endRow:u.row,endColumn:u.column}:(s===al.NONE?i={...i,startRow:l.row,startColumn:l.column}:s===al.COLUMN?i={...i,startRow:l.row}:s===al.ROW&&(i={...i,startColumn:l.column}),a===al.NONE?i={...i,endRow:u.row,endColumn:u.column}:a===al.COLUMN?i={...i,endRow:u.row}:a===al.ROW&&(i={...i,endColumn:u.column}),i)}function oc(e,t,r,n,i){return i===ao.NORMAL?{row:e+t,column:r+n}:i===ao.ROW?{row:e+t,column:r}:i===ao.COLUMN?{row:e,column:r+n}:{row:e,column:r}}function oh(e){let t=/* @__PURE__ */new Set,r=/* @__PURE__ */new Set;for(let n of e)t.add(n.startColumn),t.add(n.endColumn+1),r.add(n.startRow),r.add(n.endRow+1);let n=Array.from(t).sort((e,t)=>e-t),i=Array.from(r).sort((e,t)=>e-t);e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let s=[];for(let t=0;t<i.length-1;t++)for(let r=0;r<n.length-1;r++){let a=n[r],o=n[r+1]-1,l=i[t],u=i[t+1]-1;for(let t of e){if(t.startRow>u)break;if(t.startRow<=l&&t.endRow>=u&&t.startColumn<=a&&t.endColumn>=o){s.push({startColumn:a,endColumn:o,startRow:l,endRow:u});break}}}return s}function od(e,t){let r=om(e.startRow,e.endRow,t.startRow,t.endRow),n=om(e.startColumn,e.endColumn,t.startColumn,t.endColumn);if(!r||!n)return null;let[i,s]=r,[a,o]=n,l=function(e,t,r,n,i,s){let a=void 0!==e?e:og(r,n,i,s),o=void 0!==t?t:og(r,n,i,s);return a===ao.ALL||o===ao.ALL?a===o?a:a===ao.ALL?o:a:a===o?a:(a===ao.NORMAL||ao.NORMAL,ao.NORMAL)}(e.rangeType,t.rangeType,i,s,a,o);return{startRow:i,endRow:s,startColumn:a,endColumn:o,rangeType:l}}function om(e,t,r,n){let i=isNaN(e)?-1/0:e,s=isNaN(t)?1/0:t,a=isNaN(r)?-1/0:r,o=isNaN(n)?1/0:n,l=Math.max(i,a),u=Math.min(s,o);return l<=u?[l===-1/0?Number.NaN:l,u===1/0?Number.NaN:u]:null}function og(e,t,r,n){let i=!isNaN(e)&&!isNaN(t),s=!isNaN(r)&&!isNaN(n);return i&&s?ao.NORMAL:i?ao.ROW:s?ao.COLUMN:ao.ALL}let of=class e{static clone(e){return void 0!==e.rangeType?{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn,rangeType:e.rangeType}:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}static equals(e,t){return null!=e&&null!=t&&e.endRow===t.endRow&&e.endColumn===t.endColumn&&e.startRow===t.startRow&&e.startColumn===t.startColumn&&(e.rangeType===t.rangeType||void 0===e.rangeType&&t.rangeType===ao.NORMAL||void 0===t.rangeType&&e.rangeType===ao.NORMAL)}static simpleRangesIntersect(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s}=e,{startRow:a,endRow:o,startColumn:l,endColumn:u}=t;return r<=o&&n>=a&&i<=u&&s>=l}static intersects(e,t){if(e.rangeType===ao.ROW&&t.rangeType===ao.COLUMN||e.rangeType===ao.COLUMN&&t.rangeType===ao.ROW)return!0;if(e.rangeType===ao.ROW&&t.rangeType===ao.ROW)return e.startRow<=t.endRow&&e.endRow>=t.startRow;if(e.rangeType===ao.COLUMN&&t.rangeType===ao.COLUMN)return e.startColumn<=t.endColumn&&e.endColumn>=t.startColumn;let r=Math.floor(Number.MAX_SAFE_INTEGER/10),n=Number.isNaN(e.startRow)?0:e.startRow,i=Number.isNaN(e.endRow)?r:e.endRow,s=Number.isNaN(e.startColumn)?0:e.startColumn,a=Number.isNaN(e.endColumn)?r:e.endColumn,o=Number.isNaN(t.startRow)?0:t.startRow,l=Number.isNaN(t.endRow)?r:t.endRow,u=Number.isNaN(t.startColumn)?0:t.startColumn,c=Number.isNaN(t.endColumn)?r:t.endColumn,h=Math.abs(n+i-o-l),d=Math.abs(n-i)+Math.abs(o-l);return Math.abs(s+a-u-c)<=Math.abs(s-a)+Math.abs(u-c)&&h<=d}static getIntersects(e,t){let r,n,i;let s=e.startRow,a=e.endRow,o=e.startColumn,l=e.endColumn,u=t.startRow,c=t.endRow,h=t.startColumn,d=t.endColumn;return u<=a&&(n=u>=s?u:s,c>=s&&(i=c>=a?a:c,h<=l&&(r=h>o?h:o,d>=o)))?{startRow:n,endRow:i,startColumn:r,endColumn:d>=l?l:d,rangeType:ao.NORMAL}:null}static contains(e,t){return e.startRow<=t.startRow&&e.endRow>=t.endRow&&e.startColumn<=t.startColumn&&e.endColumn>=t.endColumn}static realContain(t,r){return e.contains(t,r)&&(t.startRow<r.startRow||t.endRow>r.endRow||t.startColumn<r.startColumn||t.endColumn>r.endColumn)}static union(...e){return e.reduce((e,t)=>({startRow:Math.min(e.startRow,t.startRow),startColumn:Math.min(e.startColumn,t.startColumn),endRow:Math.max(e.endRow,t.endRow),endColumn:Math.max(e.endColumn,t.endColumn),rangeType:ao.NORMAL}),e[0])}static realUnion(...t){let r=t.some(e=>e.rangeType===ao.COLUMN),n=t.some(e=>e.rangeType===ao.ROW),i=e.union(...t);return{startColumn:n?Number.NaN:i.startColumn,endColumn:n?Number.NaN:i.endColumn,startRow:r?Number.NaN:i.startRow,endRow:r?Number.NaN:i.endRow,rangeType:n?ao.ROW:r?ao.COLUMN:ao.NORMAL}}static subtract(e,t){if(t.startRow>e.endRow||t.endRow<e.startRow||t.startColumn>e.endColumn||t.endColumn<e.startColumn)return[e];let r=[];t.startRow>=e.startRow&&r.push({startRow:e.startRow,startColumn:e.startColumn,endRow:t.startRow-1,endColumn:e.endColumn}),t.endRow<=e.endRow&&r.push({startRow:t.endRow+1,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn});let n=Math.max(e.startRow,t.startRow),i=Math.min(e.endRow,t.endRow);return t.startColumn>=e.startColumn&&r.push({startRow:n,startColumn:e.startColumn,endRow:i,endColumn:t.startColumn-1}),t.endColumn<=e.endColumn&&r.push({startRow:n,startColumn:t.endColumn+1,endRow:i,endColumn:e.endColumn}),r.filter(e=>e.startRow<=e.endRow&&e.startColumn<=e.endColumn)}static mergeRanges(e){return function(e){e.sort((e,t)=>e.startColumn-t.startColumn||e.startRow-t.startRow);let t={};for(let r of e)t[r.startColumn]||(t[r.startColumn]=[]),t[r.startColumn].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startRow-t.startRow);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startRow<=i.endRow+1&&t.startColumn===i.startColumn&&t.endColumn===i.endColumn?i.endRow=Math.max(i.endRow,t.endRow):(r.push(i),i=t)}r.push(i)}return r}(function(e){e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let t={};for(let r of e)t[r.startRow]||(t[r.startRow]=[]),t[r.startRow].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startColumn-t.startColumn);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startColumn<=i.endColumn+1&&t.startRow===i.startRow&&t.endRow===i.endRow?i.endColumn=Math.max(i.endColumn,t.endColumn):(r.push(i),i=t)}r.push(i)}return r}(oh(e)))}static splitIntoGrid(e){return oh(e)}static subtractMulti(e,t){if(!t.length)return e;let r=e;return t.forEach(e=>{r=function(e,t){let r=[];return e.forEach(e=>{r.push(...op.subtract(e,t))}),op.mergeRanges(r)}(r,e)}),r}static hasIntersectionBetweenTwoRect(e,t){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}static getIntersectionBetweenTwoRect(e,t){let r=Math.max(e.left,t.left),n=Math.min(e.right,t.right),i=Math.max(e.top,t.top),s=Math.min(e.bottom,t.bottom);return n<=r||s<=i?null:{left:r,right:n,top:i,bottom:s,width:n-r,height:s-i}}static sort(e){return e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn)}};tr(of,"getRelativeRange",(e,t)=>({startRow:e.startRow-t.startRow,endRow:e.endRow-e.startRow,startColumn:e.startColumn-t.startColumn,endColumn:e.endColumn-e.startColumn})),tr(of,"getPositionRange",(e,t,r)=>({...r||{},startRow:r&&[al.ROW,al.ALL].includes(r.startAbsoluteRefType||0)?r.startRow:e.startRow+t.startRow,endRow:r&&[al.ROW,al.ALL].includes(r.endAbsoluteRefType||0)?r.endRow:e.endRow+e.startRow+t.startRow,startColumn:r&&[al.COLUMN,al.ALL].includes(r.startAbsoluteRefType||0)?r.startColumn:e.startColumn+t.startColumn,endColumn:r&&[al.COLUMN,al.ALL].includes(r.endAbsoluteRefType||0)?r.endColumn:e.endColumn+e.startColumn+t.startColumn})),tr(of,"moveHorizontal",(e,t=0,r=0)=>({...e,startColumn:e.startColumn+t,endColumn:e.endColumn+t+r})),tr(of,"moveVertical",(e,t=0,r=0)=>({...e,startRow:e.startRow+t,endRow:e.endRow+t+r})),tr(of,"moveOffset",(e,t,r)=>({...e,startRow:e.startRow+r,endRow:e.endRow+r,startColumn:e.startColumn+t,endColumn:e.endColumn+t}));let op=of;function oC(e,t){let r=e.toFullArray(),n=[];for(;;){let e=function(e,t){if(0===e.length||0===e[0].length)return null;let r=Array(e[0].length).fill(0),n=0,i=null;for(let s=0;s<e.length;s++){for(let n=0;n<e[0].length;n++)r[n]=t(e[s][n])?r[n]+1:0;let a=function(e){let t=[],r=0,n={area:0,height:0,start:0,end:0},i=0;for(;i<e.length;)if(0===t.length||e[i]>=e[t[t.length-1]])t.push(i++);else{let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}for(;t.length>0;){let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}return n}(r);a.area>n&&(n=a.area,i={startColumn:a.start,startRow:s-a.height+1,endColumn:a.end,endRow:s})}return i}(r,t);if(!e)break;n.push(e),function(e,t){ol.foreach(t,(t,r)=>{e[t][r]=void 0})}(r,e)}return n}function o_(e,t,r,n){return{forEach(i){for(let s=e;s<=t;s++)for(let e=r;e<=n;e++)i(s,e)}}}function oy(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}function oE(e,t=!1){let r=97;return t&&(r=65),function(e,t){let r="";for(;t>0;)r+=e,t--;return r}(String.fromCharCode(e%26+r),Math.floor(e/26)+1)}function ob(e,t){return e.zIndex>t.zIndex?1:e.zIndex===t.zIndex?0:-1}function oR(e,t){return e.zIndex>t.zIndex?-1:e.zIndex===t.zIndex?0:1}function oN(e="index",t=1){return(r,n)=>r[e]>n[e]?t:r[e]===n[e]?0:-t}var oI=((z=oI||{})[z.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",z[z.UNIVER_DOC=1]="UNIVER_DOC",z[z.UNIVER_SHEET=2]="UNIVER_SHEET",z[z.UNIVER_SLIDE=3]="UNIVER_SLIDE",z[z.UNIVER_PROJECT=4]="UNIVER_PROJECT",z[z.UNRECOGNIZED=-1]="UNRECOGNIZED",z),oA=((q=oA||{})[q.Reader=0]="Reader",q[q.Editor=1]="Editor",q[q.Owner=2]="Owner",q[q.UNRECOGNIZED=-1]="UNRECOGNIZED",q),ov=((X=ov||{})[X.SomeCollaborator=0]="SomeCollaborator",X[X.AllCollaborator=1]="AllCollaborator",X[X.OneSelf=2]="OneSelf",X[X.UNRECOGNIZED=-1]="UNRECOGNIZED",X);class oS extends ix{}var oT={},oO={},oM={};Object.defineProperty(oM,"__esModule",{value:!0}),oM.default=function e(t,r){return t===r||null!==t&&null!==r&&"object"==typeof t&&"object"==typeof r&&(Array.isArray(t)?function(t,r){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):function(t,r){if(Array.isArray(r))return!1;for(let n in t)if(!e(t[n],r[n]))return!1;for(let e in r)if(void 0===t[e])return!1;return!0}(t,r))};var ow={};Object.defineProperty(ow,"__esModule",{value:!0}),ow.default=function e(t){if(null===t)return null;if(Array.isArray(t))return t.map(e);if("object"!=typeof t)return t;{let r={};for(let n in t)r[n]=e(t[n]);return r}};var ox={};!function(e){function t(e,t){if(!e)throw Error(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.eachChildOf=e.advancer=e.readCursor=e.writeCursor=e.WriteCursor=e.ReadCursor=e.isValidPathItem=void 0;let r=e=>null!=e&&"object"==typeof e&&!Array.isArray(e),n=(e,t)=>typeof e==typeof t?e>t:"string"==typeof e&&"number"==typeof t;function i(e,t){for(let r in e)t.write(r,e[r])}e.isValidPathItem=e=>"number"==typeof e||"string"==typeof e&&"__proto__"!==e;class s{constructor(e=null){this.parents=[],this.indexes=[],this.lcIdx=-1,this.idx=-1,this.container=e}ascend(){t(this.parents.length===this.indexes.length/2),0===this.idx?this.parents.length?(this.lcIdx=this.indexes.pop(),this.container=this.parents.pop(),this.idx=this.indexes.pop()):(this.lcIdx=0,this.idx=-1):(t(this.idx>0),this.idx--,r(this.container[this.idx])&&this.idx--)}getPath(){let e=[],t=this.container,n=this.parents.length-1,i=this.idx;for(;i>=0;)e.unshift(t[i]),0===i?(i=this.indexes[2*n],t=this.parents[n--]):i-=r(t[i-1])?2:1;return e}}class a extends s{get(){return this.container?this.container.slice(this.idx+1):null}getKey(){return t(null!=this.container,"Invalid call to getKey before cursor descended"),this.container[this.idx]}getComponent(){let e;return this.container&&this.container.length>this.idx+1&&r(e=this.container[this.idx+1])?e:null}descendFirst(){let e=this.idx+1;if(!this.container||e>=this.container.length||r(this.container[e])&&e+1>=this.container.length)return!1;r(this.container[e])&&e++;let t=this.container[e];return Array.isArray(t)?(this.indexes.push(this.idx),this.parents.push(this.container),this.indexes.push(e),this.idx=0,this.container=t):this.idx=e,!0}nextSibling(){if(t(this.parents.length===this.indexes.length/2),this.idx>0||0===this.parents.length)return!1;let e=this.indexes[this.indexes.length-1]+1,r=this.parents[this.parents.length-1];return!(e>=r.length)&&(t(!isNaN(e)),this.indexes[this.indexes.length-1]=e,this.container=r[e],!0)}_init(e,t,r,n){this.container=e,this.idx=t,this.parents=r.slice(),this.indexes=n.slice()}clone(){let e=new a;return e._init(this.container,this.idx,this.parents,this.indexes),e}*[Symbol.iterator](){if(this.descendFirst()){do yield this.getKey();while(this.nextSibling())this.ascend()}}traverse(e,t){let r=this.getComponent();for(let n of(r&&t(r,e),this))e&&e.descend(n),this.traverse(e,t),e&&e.ascend()}eachPick(e,t){this.traverse(e,(e,r)=>{null!=e.p&&t(e.p,r)})}eachDrop(e,t){this.traverse(e,(e,r)=>{null!=e.d&&t(e.d,r)})}}e.ReadCursor=a;class o extends s{constructor(e=null){super(e),this.pendingDescent=[],this._op=e}flushDescent(){t(this.parents.length===this.indexes.length/2),null===this.container&&(this._op=this.container=[]);for(let e=0;e<this.pendingDescent.length;e++){let i=this.pendingDescent[e],s=this.idx+1;if(s<this.container.length&&r(this.container[s])&&s++,t(s===this.container.length||!r(this.container[s])),s===this.container.length)this.container.push(i),this.idx=s;else if(this.container[s]===i)this.idx=s;else{if(!Array.isArray(this.container[s])){let e=this.container.splice(s,this.container.length-s);this.container.push(e),this.lcIdx>-1&&(this.lcIdx=s)}for(this.indexes.push(this.idx),this.parents.push(this.container),-1!==this.lcIdx&&(t(n(i,this.container[this.lcIdx][0])),s=this.lcIdx+1,this.lcIdx=-1);s<this.container.length&&n(i,this.container[s][0]);)s++;if(this.indexes.push(s),this.idx=0,s<this.container.length&&this.container[s][0]===i)this.container=this.container[s];else{let e=[i];this.container.splice(s,0,e),this.container=e}}}this.pendingDescent.length=0}reset(){this.lcIdx=-1}getComponent(){this.flushDescent();let e=this.idx+1;if(e<this.container.length&&r(this.container[e]))return this.container[e];{let t={};return this.container.splice(e,0,t),t}}write(e,r){let n=this.getComponent();t(null==n[e]||n[e]===r,"Internal consistency error: Overwritten component. File a bug"),n[e]=r}get(){return this._op}descend(t){if(!e.isValidPathItem(t))throw Error("Invalid JSON key");this.pendingDescent.push(t)}descendPath(e){return this.pendingDescent.push(...e),this}ascend(){this.pendingDescent.length?this.pendingDescent.pop():super.ascend()}mergeTree(e,r=i){if(null===e)return;if(t(Array.isArray(e)),e===this._op)throw Error("Cannot merge into my own tree");let n=this.lcIdx,s=this.parents.length,a=0;for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n||"number"==typeof n?(a++,this.descend(n)):Array.isArray(n)?this.mergeTree(n,r):"object"==typeof n&&r(n,this)}for(;a--;)this.ascend();this.lcIdx=this.parents.length===s?n:-1}at(e,t){this.descendPath(e),t(this);for(let t=0;t<e.length;t++)this.ascend();return this}writeAtPath(e,t,r){return this.at(e,()=>this.write(t,r)),this.reset(),this}writeMove(e,t,r=0){return this.writeAtPath(e,"p",r).writeAtPath(t,"d",r)}getPath(){let e=super.getPath();return e.push(...this.pendingDescent),e}}e.WriteCursor=o,e.writeCursor=()=>new o,e.readCursor=e=>new a(e),e.advancer=function(e,t,r){let i,s;function a(i){let a;for(;s;){let o=a=e.getKey();if(null!=i){let r=!1;if(t&&"number"==typeof o&&(a=t(o,e.getComponent()))<0&&(a=~a,r=!0),n(a,i))return null;if(a===i&&!r)return e}r&&"number"==typeof a&&r(a,e.getComponent()),s=e.nextSibling()}return null}return s=i=!!e&&e.descendFirst(),a.end=()=>{i&&e.ascend()},a},e.eachChildOf=function(e,t,r){let i,s,a,o;for(i=s=e&&e.descendFirst(),a=o=t&&t.descendFirst();i||a;){let s=i?e.getKey():null,o=a?t.getKey():null;null!==s&&null!==o&&(n(o,s)?o=null:s!==o&&(s=null)),r(null==s?o:s,null!=s?e:null,null!=o?t:null),null!=s&&i&&(i=e.nextSibling()),null!=o&&a&&(a=t.nextSibling())}s&&e.ascend(),o&&t.ascend()}}(ox);var oU={};Object.defineProperty(oU,"__esModule",{value:!0}),oU.ConflictType=void 0,(o8=oU.ConflictType||(oU.ConflictType={}))[o8.RM_UNEXPECTED_CONTENT=1]="RM_UNEXPECTED_CONTENT",o8[o8.DROP_COLLISION=2]="DROP_COLLISION",o8[o8.BLACKHOLE=3]="BLACKHOLE";var oD,oV,oL,oP,oj,oF,ok,oB,o$,oH,oW,oG,oY,oz,oq,oX,oK,oQ,oZ,oJ,o0,o1,o2,o5,o3,o4,o6,o9,o7,o8,le,lt,lr,ln,li={},ls={};function la(){return ln||(ln=1,Object.defineProperty(ls,"__esModule",{value:!0}),ls.uniToStrPos=ls.strPosToUni=void 0,ls.strPosToUni=(e,t=e.length)=>{let r=0,n=0;for(;n<t;n++){let t=e.charCodeAt(n);t>=55296&&t<=57343&&(r++,n++)}if(n!==t)throw Error("Invalid offset - splits unicode bytes");return n-r},ls.uniToStrPos=(e,t)=>{let r=0;for(;t>0;t--){let t=e.charCodeAt(r);r+=t>=55296&&t<=57343?2:1}return r}),ls}var lo,ll={};function lu(){return lo||(lo=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uniSlice=e.dlen=e.eachOp=void 0;let t=la(),r=t=>{if(!Array.isArray(t))throw Error("Op must be an array of components");let r=null;for(let n=0;n<t.length;n++){let i=t[n];switch(typeof i){case"object":if("number"!=typeof i.d&&"string"!=typeof i.d)throw Error("Delete must be number or string");if(0>=e.dlen(i.d))throw Error("Deletes must not be empty");break;case"string":if(!(i.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(i>0))throw Error("Skip components must be >0");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}r=i}if("number"==typeof r)throw Error("Op has a trailing skip")};function n(r,n){let i=0,s=0;for(let a=0;a<r.length;a++){let o=r[a];switch(n(o,i,s),typeof o){case"object":i+=e.dlen(o.d);break;case"string":s+=t.strPosToUni(o);break;case"number":i+=o,s+=o}}}function i(e,t){let r=[],i=o(r);return n(e,(e,r,n)=>{i(t(e,r,n))}),h(r)}e.eachOp=n;let s=e=>e,a=e=>i(e,s);e.dlen=e=>"number"==typeof e?e:t.strPosToUni(e);let o=t=>r=>{if(!(!r||0===r.d||""===r.d)){if(0===t.length)t.push(r);else if(typeof r==typeof t[t.length-1]){if("object"==typeof r){let n=t[t.length-1];n.d="string"==typeof n.d&&"string"==typeof r.d?n.d+r.d:e.dlen(n.d)+e.dlen(r.d)}else t[t.length-1]+=r}else t.push(r)}},l=e=>"number"==typeof e?e:"string"==typeof e?t.strPosToUni(e):"number"==typeof e.d?e.d:t.strPosToUni(e.d);e.uniSlice=(e,r,n)=>{let i=t.uniToStrPos(e,r),s=null==n?1/0:t.uniToStrPos(e,n);return e.slice(i,s)};let u=(t,r,n)=>"number"==typeof t?null==n?t-r:Math.min(t,n)-r:e.uniSlice(t,r,n),c=r=>{let n=0,i=0;return{take:(s,a)=>{let o;if(n===r.length)return -1===s?null:s;let l=r[n];if("number"==typeof l)return -1===s||l-i<=s?(o=l-i,++n,i=0,o):(i+=s,s);if("string"==typeof l){if(-1===s||"i"===a||t.strPosToUni(l.slice(i))<=s)return o=l.slice(i),++n,i=0,o;{let e=i+t.uniToStrPos(l.slice(i),s);return o=l.slice(i,e),i=e,o}}if(-1===s||"d"===a||e.dlen(l.d)-i<=s)return o={d:u(l.d,i)},++n,i=0,o;{let e=u(l.d,i,i+s);return i+=s,{d:e}}},peek:()=>r[n]}},h=e=>(e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e);function d(n,i,s){let a;if("left"!==s&&"right"!==s)throw Error("side ("+s+") must be 'left' or 'right'");r(n),r(i);let u=[],d=o(u),{take:m,peek:g}=c(n);for(let r=0;r<i.length;r++){let n,a;let o=i[r];switch(typeof o){case"number":for(n=o;n>0;)d(a=m(n,"i")),"string"!=typeof a&&(n-=l(a));break;case"string":"left"===s&&"string"==typeof g()&&d(m(-1)),d(t.strPosToUni(o));break;case"object":for(n=e.dlen(o.d);n>0;)switch(typeof(a=m(n,"i"))){case"number":n-=a;break;case"string":d(a);break;case"object":n-=e.dlen(a.d)}}}for(;a=m(-1);)d(a);return h(u)}function m(n,i){let s;r(n),r(i);let a=[],d=o(a),{take:m}=c(n);for(let r=0;r<i.length;r++){let n,s;let a=i[r];switch(typeof a){case"number":for(n=a;n>0;)d(s=m(n,"d")),"object"!=typeof s&&(n-=l(s));break;case"string":d(a);break;case"object":n=e.dlen(a.d);let o=0;for(;o<n;)switch(typeof(s=m(n-o,"d"))){case"number":d({d:u(a.d,o,o+s)}),o+=s;break;case"string":o+=t.strPosToUni(s);break;case"object":d(s)}}}for(;s=m(-1);)d(s);return h(a)}let g=(r,n)=>{let i=0;for(let s=0;s<n.length&&r>i;s++){let a=n[s];switch(typeof a){case"number":i+=a;break;case"string":let o=t.strPosToUni(a);i+=o,r+=o;break;case"object":r-=Math.min(e.dlen(a.d),r-i)}}return r},f=(e,t)=>"number"==typeof e?g(e,t):e.map(e=>g(e,t));function p(e,t,r){return i(e,(e,n)=>"object"==typeof e&&"number"==typeof e.d?{d:r.slice(t,n,n+e.d)}:e)}function C(e){return i(e,e=>{switch(typeof e){case"object":if("number"==typeof e.d)throw Error("Cannot invert text op: Deleted characters missing from operation. makeInvertible must be called first.");return e.d;case"string":return{d:e};case"number":return e}})}function _(e){return i(e,e=>"object"==typeof e&&"string"==typeof e.d?{d:t.strPosToUni(e.d)}:e)}function y(e){let t=!0;return n(e,e=>{"object"==typeof e&&"number"==typeof e.d&&(t=!1)}),t}e.default=function(t){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:h,normalize:a,checkOp:r,create(e=""){if("string"!=typeof e)throw Error("Initial data must be a string");return t.create(e)},apply(n,i){r(i);let s=t.builder(n);for(let t=0;t<i.length;t++){let r=i[t];switch(typeof r){case"number":s.skip(r);break;case"string":s.append(r);break;case"object":s.del(e.dlen(r.d))}}return s.build()},transform:d,compose:m,transformPosition:g,transformSelection:f,isInvertible:y,makeInvertible:(e,r)=>p(e,r,t),stripInvertible:_,invert:C,invertWithDoc:(e,r)=>C(p(e,r,t)),isNoop:e=>0===e.length}}}(ll)),ll}var lc,lh={};(function(e){var t=rk&&rk.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.editOp=e.replaceOp=e.insertOp=e.moveOp=e.removeOp=e.type=void 0;let r=t(oM),n=t(ow);function i(e,t){if(!e)throw Error(t)}e.type={name:"json1",uri:"http://sharejs.org/types/JSONv1",readCursor:ox.readCursor,writeCursor:ox.writeCursor,create:e=>e,isNoop:e=>null==e,setDebug(e){},registerSubtype:f,checkValidOp:N,normalize:I,apply:function(e,t){if(N(t),null===t)return e;let r=[];return function e(t,n){let s=t,a=0,l={root:t},u=0,c=l,g="root";function f(){for(;u<a;u++){let e=n[u];"object"!=typeof e&&(i(d(c,g)),c=c[g]=o(c[g]),g=e)}}for(;a<n.length;a++){let t=n[a];if(Array.isArray(t)){let r=e(s,t);r!==s&&void 0!==r&&(f(),s=c[g]=r)}else if("object"==typeof t){null!=t.d?(f(),s=h(c,g,r[t.d])):void 0!==t.i&&(f(),s=h(c,g,t.i));let e=_(t);if(e)f(),s=c[g]=e.apply(s,y(t));else if(void 0!==t.e)throw Error("Subtype "+t.et+" undefined")}else s=m(s,t)}return l.root}(e=function e(t,n){var s,a;let u=[],h=0;for(;h<n.length;h++){let e=n[h];if(Array.isArray(e))break;"object"!=typeof e&&(u.push(t),t=m(t,e))}for(let r=n.length-1;r>=h;r--)t=e(t,n[r]);for(--h;h>=0;h--){let e=n[h];if("object"!=typeof e){let r=u.pop();t=t===m(r,e)?r:void 0===t?c(r,e):(a=t,(s=o(s=r))[e]=a,s)}else l(e)&&(i(void 0!==t,"Cannot pick up or remove undefined"),null!=e.p&&(r[e.p]=t),t=void 0)}return t}(e,t),t)},transformPosition:function(e,t){e=e.slice(),N(t);let r=ox.readCursor(t),n,i,a=!1,o=[];for(let t=0;;t++){let s=e[t],u=r.getComponent();if(u&&(void 0!==u.r?a=!0:null!=u.p&&(a=!1,n=u.p,i=t)),t>=e.length)break;let c=0,h=ox.advancer(r,void 0,(e,t)=>{l(t)&&c++});o.unshift(h);let d=h(s);if("number"==typeof s&&(e[t]-=c),!d)break}if(o.forEach(e=>e.end()),a)return null;let c=()=>{let t=0;if(null!=n){let n=r.getPath();t=n.length,e=n.concat(e.slice(i))}for(;t<e.length;t++){let n=e[t],i=s(r),a=_(i);if(a){let r=y(i);a.transformPosition&&(e[t]=a.transformPosition(e[t],r));break}let o=0,l=ox.advancer(r,(e,t)=>u(t)?~(e-o):e-o,(e,t)=>{u(t)&&o++})(n);if("number"==typeof n&&(e[t]+=o),!l)break}};return null!=n?r.eachDrop(null,e=>{e===n&&c()}):c(),e},compose:A,tryTransform:M,transform:function(e,t,r){let n=M(e,t,r);if(n.ok)return n.result;w(n.conflict)},makeInvertible:T,invert:v,invertWithDoc:function(e,t){return v(T(e,t))},RM_UNEXPECTED_CONTENT:oU.ConflictType.RM_UNEXPECTED_CONTENT,DROP_COLLISION:oU.ConflictType.DROP_COLLISION,BLACKHOLE:oU.ConflictType.BLACKHOLE,transformNoConflict:(e,t,r)=>D(()=>!0,e,t,r),typeAllowingConflictsPred:t=>Object.assign(Object.assign({},e.type),{transform:(e,r,n)=>D(t,e,r,n)})};let s=e=>e?e.getComponent():null;function a(e){return e&&"object"==typeof e&&!Array.isArray(e)}let o=e=>Array.isArray(e)?e.slice():null!==e&&"object"==typeof e?Object.assign({},e):e,l=e=>e&&(null!=e.p||void 0!==e.r),u=e=>e&&(null!=e.d||void 0!==e.i);function c(e,t){return i(null!=e),"number"==typeof t?(i(Array.isArray(e),"Invalid key - child is not an array"),(e=e.slice()).splice(t,1)):(i(a(e),"Invalid key - child is not an object"),delete(e=Object.assign({},e))[t]),e}function h(e,t,r){return"number"==typeof t?(i(null!=e,"Container is missing for key"),i(Array.isArray(e),"Cannot use numerical key for object container"),i(e.length>=t,"Cannot insert into out of bounds index"),e.splice(t,0,r)):(i(a(e),"Cannot insert into missing item"),i(void 0===e[t],"Trying to overwrite value at key. Your op needs to remove it first"),e[t]=r),r}e.removeOp=(e,t=!0)=>ox.writeCursor().writeAtPath(e,"r",t).get(),e.moveOp=(e,t)=>ox.writeCursor().writeMove(e,t).get(),e.insertOp=(e,t)=>ox.writeCursor().writeAtPath(e,"i",t).get(),e.replaceOp=(e,t,r)=>ox.writeCursor().at(e,e=>{e.write("r",t),e.write("i",r)}).get(),e.editOp=(e,t,r,n=!1)=>ox.writeCursor().at(e,e=>E(e,t,r,n)).get();let d=(e,t)=>null!=e&&("number"==typeof t?Array.isArray(e):"object"==typeof e),m=(e,t)=>d(e,t)?e[t]:void 0,g={};function f(e){let t=e.type?e.type:e;t.name&&(g[t.name]=t),t.uri&&(g[t.uri]=t)}let p=e=>{let t=g[e];if(t)return t;throw Error("Missing type: "+e)};f((eQ||(eQ=1,function(e){var t=rk&&rk.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=rk&&rk.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=rk&&rk.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&t(n,e,i);return r(n,e),n},i=rk&&rk.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.type=e.remove=e.insert=void 0;let s=la(),a=n(lu()),o=i(function(){if(lc)return lh;lc=1,Object.defineProperty(lh,"__esModule",{value:!0});let e=lu(),t=la();function r(r,n){return{get:r,getLength:()=>r().length,insert:(e,i,s)=>n([t.strPosToUni(r(),e),i],s),remove:(e,i,s)=>n([t.strPosToUni(r(),e),{d:i}],s),_onOp(t){e.eachOp(t,(t,r,n)=>{switch(typeof t){case"string":this.onInsert&&this.onInsert(n,t);break;case"object":let i=e.dlen(t.d);this.onRemove&&this.onRemove(n,i)}})},onInsert:null,onRemove:null}}return lh.default=r,r.provides={text:!0},lh}()),l={create:e=>e,toString:e=>e,builder(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);let t=[];return{skip(r){let n=s.uniToStrPos(e,r);if(n>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,n)),e=e.slice(n)},append(e){t.push(e)},del(t){e=e.slice(s.uniToStrPos(e,t))},build:()=>t.join("")+e}},slice:a.uniSlice},u=Object.assign(Object.assign({},a.default(l)),{api:o.default});e.type=u,e.insert=(e,t)=>0===t.length?[]:0===e?[t]:[e,t],e.remove=(e,t)=>0===a.dlen(t)?[]:0===e?[{d:t}]:[e,{d:t}];var c=lu();Object.defineProperty(e,"makeType",{enumerable:!0,get:function(){return c.default}})}(li)),li));let C=(e,t)=>e+t;f({name:"number",apply:C,compose:C,invert:e=>-e,transform:e=>e});let _=e=>null==e?null:e.et?p(e.et):e.es?g["text-unicode"]:null!=e.ena?g.number:null,y=e=>e.es?e.es:null!=e.ena?e.ena:e.e,E=(e,t,r,n=!1)=>{let[i,s]="string"==typeof t?[p(t),t]:[t,t.name];!n&&i.isNoop&&i.isNoop(r)||("number"===s?e.write("ena",r):"text-unicode"===s?e.write("es",r):(e.write("et",s),e.write("e",r)))};function b(e){i("number"==typeof e),i(e>=0),i(e===(0|e))}function R(e){"number"==typeof e?b(e):i("string"==typeof e)}function N(e){if(null===e)return;let t=/* @__PURE__ */new Set,r=/* @__PURE__ */new Set,n=e=>{let n=!0,s=!1;for(let a in e){let o=e[a];if(n=!1,i("p"===a||"r"===a||"d"===a||"i"===a||"e"===a||"es"===a||"ena"===a||"et"===a,"Invalid component item '"+a+"'"),"p"===a)b(o),i(!t.has(o)),t.add(o),i(void 0===e.r);else if("d"===a)b(o),i(!r.has(o)),r.add(o),i(void 0===e.i);else if("e"===a||"es"===a||"ena"===a){i(!s),s=!0;let t=_(e);i(t,"Missing type in edit"),t.checkValidOp&&t.checkValidOp(y(e))}}i(!n)},s=(e,t,r)=>{if(!Array.isArray(e))throw Error("Op must be null or a list");if(0===e.length)throw Error("Empty descent");t||R(e[0]);let a=1,o=0,l=0;for(let t=0;t<e.length;t++){let r=e[t];if(i(null!=r),Array.isArray(r)){let e=s(r,!1);if(o){let t=typeof l,r=typeof e;t===r?i(l<e,"descent keys are not in order"):i("number"===t&&"string"===r)}l=e,o++,a=3}else"object"==typeof r?(i(1===a,`Prev not scalar - instead ${a}`),n(r),a=2):(i(3!==a),R(r),i(ox.isValidPathItem(r),"Invalid path key"),a=1)}return i(1!==o,"Operation makes multiple descents. Remove some []"),i(2===a||3===a),e[0]};s(e,!0),i(t.size===r.size,"Mismatched picks and drops in op");for(let e=0;e<t.size;e++)i(t.has(e)),i(r.has(e))}function I(e){let t=0,r=[],n=ox.writeCursor();return n.mergeTree(e,(e,n)=>{var i;let s=_(e);if(s){let t=y(e);E(n,s,s.normalize?s.normalize(t):t)}for(let s of["r","p","i","d"])if(void 0!==e[s]){let a="p"===s||"d"===s?(null==r[i=e[s]]&&(r[i]=t++),r[i]):e[s];n.write(s,a)}}),n.get()}function A(e,t){if(N(e),N(t),null==e)return t;if(null==t)return e;let r=0,n=ox.readCursor(e),a=ox.readCursor(t),o=ox.writeCursor(),c=[],h=[],d=[],m=[],g=[],f=[],p=/* @__PURE__ */new Set;n.traverse(null,e=>{null!=e.p&&(d[e.p]=n.clone())}),a.traverse(null,e=>{null!=e.d&&(m[e.d]=a.clone())});let C=ox.writeCursor();return function e(t,n,a,o,C,b,R,N){let I;i(n||a);let A=s(n),v=s(a),S=!!v&&void 0!==v.r,T=!!A&&void 0!==A.i,O=A?A.d:null,M=v?v.p:null,w=(b||S)&&null==M;if(null!=M)o=m[M],R=h[M]=new ox.WriteCursor;else if(v&&void 0!==v.r)o=null;else{let e=s(o);e&&null!=e.d&&(o=null)}let x=s(o);if(null!=O){if(t=d[O],N=c[O]=new ox.WriteCursor,w)b&&!S&&N.write("r",!0);else{let e=g[O]=r++;R.write("d",e)}}else if(A&&void 0!==A.i)t=null;else{let e=s(t);e&&null!=e.p&&(t=null)}T?(i(void 0===C),I=A.i):I=C;let U=(null==M?!T||b||S:void 0===I)?null:R.getComponent();if(null!=M){if(!(void 0!==C||T)){let e=null!=O?g[O]:r++;f[M]=e,N.write("p",e)}}else S&&(T||void 0!==C||(v.r,N.write("r",v.r)));let D=w?null:_(A),V=_(x);if((D||V)&&(D&&D.name,V&&V.name),D&&V){i(D===V);let e=y(A),t=y(x),r=D.compose(e,t);E(R,D,r),p.add(x)}else D?E(R,D,y(A)):V&&(E(R,V,y(x)),p.add(x));let L="object"==typeof I&&null!=I,P=!1,j=0,F=0,k=0,B=0,$=0,H=ox.advancer(o,(e,t)=>u(t)?B-e-1:e-B,(e,t)=>{u(t)&&B++}),W=ox.advancer(t,(e,t)=>l(t)?j-e-1:e-j,(e,t)=>{l(t)&&j++});if(ox.eachChildOf(n,a,(t,r,n)=>{var a,o;let c,h,d=t,m=t,g=t;if("number"==typeof t){let e=t+k;h=H(e),m=e+B;let a=t+F;c=W(a),u(s(h))&&(c=null),d=a+j,g=t+$,i(d>=0,"p1PickKey is negative"),i(m>=0,"p2DropKey is negative");let o=u(s(r)),f=l(s(n));(o||f&&!w)&&$--,o&&F--,f&&k--}else c=W(t),h=H(t);N.descend(d),R.descend(m);let f=L&&!u(s(r))?I[g]:void 0,p=e(c,r,n,h,f,w,R,N);L&&!w?f!==p&&(P||(I=Array.isArray(I)?I.slice():Object.assign({},I),P=!0),a=I,"number"==typeof(o=g)?(i(Array.isArray(a)),i(o<a.length)):(i(!Array.isArray(a)),i(void 0!==a[o])),void 0===p?"number"==typeof o?a.splice(o,1):delete a[o]:a[o]=p):i(void 0===p),R.ascend(),N.ascend()}),W.end(),H.end(),null!=U)U.i=I;else if(!b&&!S&&null==M)return I}(n,n.clone(),a,a.clone(),void 0,!1,o,C),o.reset(),o.mergeTree(C.get()),o.reset(),o.get(),c.map(e=>e.get()),h.map(e=>e.get()),n.traverse(o,(e,t)=>{let r=e.p;if(null!=r){let e=g[r];null!=e&&t.write("p",e);let n=c[r];n&&n.get(),n&&t.mergeTree(n.get())}else void 0!==e.r&&t.write("r",e.r)}),o.reset(),o.get(),a.traverse(o,(e,t)=>{let r=e.d;if(null!=r){let e=f[r];null!=e&&t.write("d",e);let n=h[r];n&&t.mergeTree(n.get())}else void 0!==e.i&&t.write("i",e.i);let n=_(e);n&&!p.has(e)&&E(t,n,y(e))}),o.get()}function v(e){let t;if(null==e)return null;let r=new ox.ReadCursor(e),n=new ox.WriteCursor,i=[],s=[];return function e(r,n,s){let a=r.getComponent(),l,c=!1;if(a){null!=a.p&&(n.write("d",a.p),i[a.p]=r.clone()),void 0!==a.r&&n.write("i",a.r),null!=a.d&&(n.write("p",a.d),s=void 0),void 0!==a.i&&(s=l=a.i);let e=_(a);e&&(void 0===s?(t||(t=/* @__PURE__ */new Set),t.add(a)):(y(a),s=e.apply(s,y(a)),c=!0))}let h=0;for(let t of r){n.descend(t);let i="number"==typeof t?t-h:t,a=m(s,i);u(r.getComponent())&&h++;let l=e(r,n,a);if(void 0!==s&&void 0!==l){if(c||(c=!0,s=o(s)),!d(s,i))throw Error("Cannot modify child - invalid operation");s[i]=l}n.ascend()}if(void 0===l)return c?s:void 0;n.write("r",s)}(r,n,void 0),t&&(n.reset(),function e(r,n,a){let o=n.getComponent();if(o){let e=o.d;if(null!=e&&(r=i[e],a=s[e]=ox.writeCursor()),t.has(o)){let e=_(o);if(!e.invert)throw Error(`Cannot invert subtype ${e.name}`);E(a,e,e.invert(y(o)))}}let c=0,h=0,d=ox.advancer(r,(e,t)=>l(t)?c-e-1:e-c,(e,t)=>{l(t)&&c++});for(let t of n)if("number"==typeof t){let r=t-h,i=d(r),s=r+c;a.descend(s),e(i,n,a),u(n.getComponent())&&h++,a.ascend()}else a.descend(t),e(d(t),n,a),a.ascend();d.end()}(r.clone(),r,n),s.length&&(n.reset(),r.traverse(n,(e,t)=>{let r=e.p;if(null!=r){let e=s[r];e&&e.get(),e&&t.mergeTree(e.get())}}))),n.get()}let S=(e,t)=>e.some(e=>"object"==typeof e&&(Array.isArray(e)?S(e,t):t(e)));function T(e,t){if(null==e||!S(e,e=>{var t;return void 0!==e.r||(null===(t=_(e))||void 0===t?void 0:t.makeInvertible)!=null}))return e;let r=new ox.ReadCursor(e),s=new ox.WriteCursor,a=!1,h=[],d=[],g=(e,t,r)=>{let s=e.getComponent(),l=!1;if(s){null!=s.d&&t.write("d",s.d),void 0!==s.i&&t.write("i",s.i);let n=s.p;if(null!=n&&(h[n]=e.clone(),i(void 0!==r,"Operation picks up at an invalid key"),d[n]=r,t.write("p",s.p)),void 0!==s.r&&void 0===r)throw Error("Invalid doc / op in makeInvertible: removed item missing from doc");let o=_(s);o&&(o.makeInvertible?a=!0:E(t,o,y(s),!0))}let u=0;for(let n of e){t.descend(n);let i="number"==typeof n?n-u:n,s=m(r,i),a=g(e,t,s);s!==a&&(l||(l=!0,r=o(r)),void 0===a?(r=c(r,i),"number"==typeof n&&u++):r[i]=a),t.ascend()}return s&&(void 0!==s.r?(t.write("r",n.default(r)),r=void 0):null!=s.p&&(r=void 0)),r};return g(r,s,t),s.get(),a&&(s.reset(),function e(t,r,n,i,s){let a=r.getComponent();if(a){void 0!==a.i?(i=a.i,s=!0):null!=a.d&&(i=d[a.d],t=h[a.d],s=!1,a.d);let e=_(a);if(e&&e.makeInvertible){let t=y(a);E(n,e,e.makeInvertible(t,i),!0)}}let o=0,c=0,g=ox.advancer(t,(e,t)=>l(t)?o-e-1:e-o,(e,t)=>{l(t)&&o++});for(let t of r)if("number"==typeof t){let a=t-c,l=g(a),h=a+o,d=m(i,s?a:h);n.descend(t),e(l,r,n,d,s),u(r.getComponent())&&c++,n.ascend()}else{let a=m(i,t);n.descend(t),e(g(t),r,n,a,s),n.ascend()}g.end()}(r.clone(),r,s,t,!1)),s.get()}let O=e=>{if(null==e)return null;let t=e.slice();for(let r=0;r<e.length;r++){let e=t[r];Array.isArray(e)&&(t[r]=O(e))}return t};function M(t,a,o){i("left"===o||"right"===o,"Direction must be left or right");let c="left"===o?0:1;if(null==a)return{ok:!0,result:t};N(t),N(a);let h=null,d=[],m=[],g=[],f=[],p=[],C=[],b=[],R=[],I=[],A=[],v=[],S=[],T=[],M=[],w=[],x=0,U=ox.readCursor(t),D=ox.readCursor(a),V=ox.writeCursor();if(function e(t,r=null,n){let i;let a=s(r);a&&(void 0!==a.r?n=r.clone():null!=a.p&&(n=null,C[a.p]=t.clone()));let o=t.getComponent();o&&null!=(i=o.p)&&(p[i]=r?r.clone():null,g[i]=t.clone(),n&&(A[i]=!0,I[i]=n),a&&null!=a.p&&(M[i]=a.p));let l=ox.advancer(r);for(let r of t)e(t,l(r),n);l.end()}(D,U,null),function t(r,n,i,a,o){let u=i.getComponent(),d,m=!1;u&&(null!=(d=u.d)?(f[d]=i.clone(),null!=a&&(null==w[a]&&(w[a]=[]),w[a].push(d)),r=p[d]||null,n=g[d]||null,A[d]?(o&&(v[d]=!0),o=I[d]||null):o&&(1===c||null==M[d])&&null==h&&(h={type:oU.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(o.getPath()),op2:e.moveOp(n.getPath(),i.getPath())}),m=!0):void 0!==u.i&&(r=n=null,m=!0,o&&null==h&&(h={type:oU.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(o.getPath()),op2:e.insertOp(i.getPath(),u.i)})));let C=s(r);C&&(void 0!==C.r?o=r.clone():null!=C.p&&(C.p,a=C.p,o=null));let E=_(u);E&&o&&null==h&&(h={type:oU.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(o.getPath()),op2:e.editOp(i.getPath(),E,y(u),!0)});let b=0,R=0,N=ox.advancer(n,(e,t)=>l(t)?b-e-1:e-b,(e,t)=>{l(t)&&b++}),S=ox.advancer(r);for(let e of i)if("number"==typeof e){let r=e-R,n=N(r);R+=+t(S(r+b),n,i,a,o)}else{let r=N(e);t(S(e),r,i,a,o)}return N.end(),S.end(),m}(U,D,D.clone(),null,null),f.map(e=>e&&e.get()),h)return{ok:!1,conflict:h};v.map(e=>!!e);let L=[],P=null;(function e(t,r,n,a,o){let h=!1,m=s(r);if(l(m)){let e=m.p;null!=e?(n=f[e],a=S[e]=ox.writeCursor(),h=!0,o=null):(n=null,o=r.clone())}else u(s(n))&&(n=null);let g=t.getComponent();if(g){let e=g.p;null!=e?(o&&(R[e]=o),L[e]=o||1===c&&h?null:a.getComponent(),d[e]=t.clone(),n&&(b[e]=n.clone())):void 0!==g.r&&(o||a.write("r",!0),(o||h)&&(null==P&&(P=/* @__PURE__ */new Set),P.add(g)))}let p=0,C=0,_=ox.advancer(r,void 0,(e,t)=>{l(t)&&p++}),y=ox.advancer(n,(e,t)=>u(t)?~(e-C):e-C,(e,t)=>{u(t)&&C++});if(t)for(let r of t)if("string"==typeof r){let n=_(r),i=y(r);a.descend(r),e(t,n,i,a,o),a.ascend()}else{let n=_(r),u=r-p,c=l(s(n))?null:y(u),h=u+C;i(h>=0),a.descend(h),e(t,n,c,a,o),a.ascend()}_.end(),y.end()})(U,D,D.clone(),V,null),V.reset();let j=[];if(function t(a,p,N,I,v,S){i(p);let O=p.getComponent(),w=s(I),U=!1,D=(t,r,n)=>t?e.moveOp(t.getPath(),r.getPath()):e.insertOp(r.getPath(),n.i);if(u(O)){let t=O.d;null!=t&&(m[t]=p.clone());let i=null!=t?L[t]:null,s=!1;if(void 0!==O.i||null!=t&&i){let a;w&&(void 0!==w.i||null!=(a=w.d)&&!A[a])&&((s=null!=a?null!=t&&t===M[a]:r.default(w.i,O.i))||null!=a&&1!==c&&null!=M[a]||null==h&&(h={type:oU.ConflictType.DROP_COLLISION,op1:D(null!=t?d[t]:null,p,O),op2:D(null!=a?g[a]:null,I,w)})),s||(S?null==h&&(h={type:oU.ConflictType.RM_UNEXPECTED_CONTENT,op1:D(null!=t?d[t]:null,p,O),op2:e.removeOp(S.getPath())}):(null!=t?(j[x]=t,v.write("d",i.p=x++)):v.write("i",n.default(O.i)),U=!0))}else if(null!=t&&!i){let e=R[t];e&&(S=e.clone())}null!=t?(a=d[t],N=C[t],I=b[t]):void 0!==O.i&&(a=N=null,s||(I=null))}else l(s(a))&&(a=N=I=null);let V=s(a),F=s(N);if(l(F)){let e=F.p;void 0!==F.r&&(!V||void 0===V.r)||A[e]?(I=null,S=N.clone()):null!=e&&(I=f[e],1!==c&&null!=M[e]||((v=T[e])||(v=T[e]=ox.writeCursor()),v.reset(),S=null))}else!u(O)&&u(w)&&(I=null);w=null!=I?I.getComponent():null;let k=_(O);if(k){let t=y(O);if(S)null==h&&(h={type:oU.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.editOp(p.getPath(),k,t,!0),op2:e.removeOp(S.getPath())});else{let e;let r=_(w);if(r){if(k!==r)throw Error("Transforming incompatible types");let n=y(w);e=k.transform(t,n,o)}else e=n.default(t);E(v,k,e)}}let B=0,$=0,H=0,W=0,G=0,Y=0,z=null!=a&&a.descendFirst(),q=z,X=ox.advancer(N,void 0,(e,t)=>{l(t)&&H++}),K=null!=I&&I.descendFirst(),Q=K;for(let e of p)if("number"==typeof e){let r;let n=u(p.getComponent()),o=e-$;{let e;for(;z&&"number"==typeof(e=a.getKey());){e+=B;let t=a.getComponent(),r=l(t);if(e>o||e===o&&(!r||0===c&&n))break;if(r){B--;let e=t.p;M.includes(e),t.d,s(T[t.d]),l(s(T[t.d])),(void 0===t.r||P&&P.has(t))&&(null==e||!L[e]||1!==c&&M.includes(e))||G--}z=a.nextSibling()}r=z&&e===o?a:null}let h=o-B,d=X(h),m=h-H,g=null;{let e,t;for(;K&&"number"==typeof(e=I.getKey());){t=e-W;let r=I.getComponent(),i=u(r);if(t>m)break;if(t===m){if(!i){g=I;break}{if(0===c&&n){g=I;break}let e=d&&l(d.getComponent());if(0===c&&e)break}}if(i){let e=r.d;M[e],void 0===r.i&&(A[e]||null!=M[e]&&1!==c)?(A[e]||null!=M[e]&&0===c)&&(W++,Y--):W++}K=I.nextSibling()}}let f=m+W+G+Y;i(f>=0,"trying to descend to a negative index"),v.descend(f),n&&(r=d=g=null,$++),t(r,p,d,g,v,S)&&Y++,v.ascend()}else{let r,n;for(;z&&("string"!=typeof(r=a.getKey())||!(r>e||r===e));)z=a.nextSibling();let i=z&&r===e?a:null,s=X(e);for(;K&&("string"!=typeof(n=I.getKey())||!(n>e||n===e));)K=I.nextSibling();let o=K&&n===e?I:null;v.descend(e),t(i,p,s,o,v,S),v.ascend()}return X.end(),q&&a.ascend(),Q&&I.ascend(),U}(U,U.clone(),D,D.clone(),V,null),h)return{ok:!1,conflict:h};V.reset();let F=(e,t,r)=>e.traverse(t,(t,n)=>{null!=t.d&&r(t.d,e,n)});(A.length||S.length)&&(F(D,V,(e,t,r)=>{A[e]&&!v[e]&&r.write("r",!0),S[e]&&r.mergeTree(S[e].get())}),V.reset());let k=[],B=[];if((T.length||A.length)&&!h){let e=ox.readCursor(O(V.get()));if(F(e,null,(e,t)=>{k[e]=t.clone()}),T.forEach(e=>{e&&F(ox.readCursor(e.get()),null,(e,t)=>{k[e]=t.clone()})}),function e(t,r,n,i,a,o){let c=s(r);if(c&&l(c)){if(null!=c.p){let e=c.p;k[e].getPath(),n=k[e],i=B[e]=ox.writeCursor()}else void 0!==c.r&&(n=null)}else u(s(n))&&(n=null);let h=t.getComponent();if(h){let e;if(null!=(e=h.d)){let t=T[e];t&&(t.get(),i.mergeTree(t.get()),n=ox.readCursor(t.get()))}}let d=0,m=0,g=ox.advancer(r,void 0,(e,t)=>{l(t)&&d--}),f=ox.advancer(n,(e,t)=>u(t)?-(e-m)-1:e-m,(e,t)=>{u(t)&&m++});for(let r of t)if("number"==typeof r){let n=g(r),s=r+d,a=f(s),o=s+m;i.descend(o),e(t,n,a,i),i.ascend()}else i.descend(r),e(t,g(r),f(r),i),i.ascend();g.end(),f.end()}(D,e,e.clone(),V),V.reset(),h)return{ok:!1,conflict:h};if(V.get(),B.length){let e=B.map(e=>e?e.get():null);if(F(ox.readCursor(O(V.get())),V,(t,r,n)=>{let i=e[t];i&&(n.mergeTree(i),e[t]=null)}),e.find(e=>e)){let t=ox.writeCursor(),r=ox.writeCursor(),n=0,i=0;e.forEach(e=>{null!=e&&F(ox.readCursor(e),null,e=>{let s=j[e];t.writeMove(d[s].getPath(),m[s].getPath(),n++);let a=w[s];a&&a.forEach(e=>{A[e]||1!==c&&null!=M[e]||r.writeMove(g[e].getPath(),f[e].getPath(),i++)})})}),h={type:oU.ConflictType.BLACKHOLE,op1:t.get(),op2:r.get()}}}}return h?{ok:!1,conflict:h}:{ok:!0,result:V.get()}}let w=e=>{let t=Error("Transform detected write conflict");throw t.conflict=e,t.type=t.name="writeConflict",t},x=e=>{let t=ox.writeCursor();return ox.readCursor(e).traverse(t,(e,t)=>{(u(e)||_(e))&&t.write("r",!0)}),t.get()},U=(e,t)=>{let{type:r,op1:n,op2:i}=e;switch(r){case oU.ConflictType.DROP_COLLISION:return"left"===t?[null,x(i)]:[x(n),null];case oU.ConflictType.RM_UNEXPECTED_CONTENT:let s=!1;return ox.readCursor(n).traverse(null,e=>{void 0!==e.r&&(s=!0)}),s?[null,x(i)]:[x(n),null];case oU.ConflictType.BLACKHOLE:return[x(n),x(i)];default:throw Error("Unrecognised conflict: "+r)}};function D(e,t,r,n){let i=null;for(;;){let s=M(t,r,n);if(s.ok)return A(i,s.result);{let{conflict:a}=s;e(a)||w(a);let[o,l]=U(a,n);t=A(I(t),o),r=A(I(r),l),i=A(i,l)}}}})(oO),eX=rk&&rk.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),eK=rk&&rk.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||eX(t,e,r)},Object.defineProperty(oT,"__esModule",{value:!0}),eK(oO,oT),Object.defineProperty(oT,"ReadCursor",{enumerable:!0,get:function(){return ox.ReadCursor}}),Object.defineProperty(oT,"WriteCursor",{enumerable:!0,get:function(){return ox.WriteCursor}}),Object.defineProperty(oT,"ConflictType",{enumerable:!0,get:function(){return oU.ConflictType}});var ld=((K=ld||{}).RETAIN="r",K.INSERT="i",K.DELETE="d",K);function lm(e,t=!1){let r=[];for(let n of e){let{st:e,ed:i,ts:s}=n;if(void 0===n.sId&&delete n.sId,e===i||!t&&sU.isEmptyObject(s)&&null==n.sId)continue;if(0===r.length){r.push(n);continue}let a=r.pop();(function(e,t){let r=e.ts||{},n=t.ts||{};return e.sId===t.sId&&function e(t,r){return Object.prototype.toString.call(t)===Object.prototype.toString.call(r)&&("[object Object]"===Object.prototype.toString.call(t)||"[object Array]"===Object.prototype.toString.call(t)?Object.keys(t).length===Object.keys(r).length&&Object.keys(t).every(n=>e(t[n],r[n])):t===r)}(r,n)})(n,a)&&sU.hasIntersectionBetweenTwoRanges(a.st,a.ed,n.st,n.ed)?r.push({...n,st:a.st,ed:i}):r.push(a,n)}return r}function lg(e,t,r,n){var i;let{textRuns:s}=e;if(null==s)return;let a=[],o=s.length,l=!1,u=null!=(i=t.textRuns)?i:[];if(u.length)for(let e of u)e.st+=n,e.ed+=n;for(let e=0;e<o;e++){let t=s[e],{st:i,ed:o}=t;if(o<=n)a.push(t);else if(n>i&&n<o){l=!0;let e={...t,ed:n};a.push(e),u.length&&a.push(...u);let i={...t,st:n+r,ed:o+r};a.push(i)}else t.st+=r,t.ed+=r,l||(l=!0,a.push(...u)),a.push(t)}l||(l=!0,a.push(...u)),e.textRuns=lm(a)}function lf(e,t,r,n){let{paragraphs:i}=e;if(null==i)return;let{paragraphs:s}=t,a=[];for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r),a.push(t.startIndex)}let o=-1;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n;let r=t.startIndex;o=a.indexOf(r)}-1!==o&&i.splice(o,1),i.push(...s),i.sort(oN("startIndex"))}}function lp(e,t,r,n){let{sectionBreaks:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.sectionBreaks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(oN("startIndex"))}}function lC(e,t,r,n){let{customBlocks:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.customBlocks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(oN("startIndex"))}}function l_(e,t,r,n){let{tables:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s,endIndex:a}=t;s>n?(t.startIndex+=r,t.endIndex+=r):a>n&&(t.endIndex+=r)}let s=t.tables;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n,t.endIndex+=n}i.push(...s),i.sort(oN("startIndex"))}}let ly=e=>e.split("$")[0];function lE(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};r.rangeId=ly(r.rangeId);for(let n=1;n<e.length;n++){let i=e[n];i.rangeId=ly(i.rangeId),i.rangeId===r.rangeId&&function(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;let i=Object.prototype.hasOwnProperty.bind(t);for(let n=0;n<r.length;n++){let s=r[n];if(!i(s)||e[s]!==t[s])return!1}return!0}(r.properties,i.properties)&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}t.push(r);let n=/* @__PURE__ */Object.create(null);for(let e=0,r=t.length;e<r;e++){let r=t[e],i=r.rangeId;n[i]?(r.rangeId=`${i}$${n[i]}`,n[i]=n[i]+1):n[i]=1}return t}function lb(e,t){let r=e.findIndex(e=>e.startIndex<t&&e.endIndex>=t),n=e[r];n&&e.splice(r,1,{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:n.startIndex,endIndex:t-1,properties:{...n.properties}},{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:t,endIndex:n.endIndex,properties:{...n.properties}})}function lR(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};for(let n=1;n<e.length;n++){let i=e[n];i.id===r.id&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}return t.push(r),t}function lN(e,t){e.filter(e=>e.startIndex<t&&e.endIndex>=t).forEach(r=>{let n=e.indexOf(r);e.splice(n,1,{id:r.id,type:r.type,startIndex:r.startIndex,endIndex:t-1},{id:r.id,type:r.type,startIndex:t,endIndex:r.endIndex})})}function lI(e,t,r){let{textRuns:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{st:l,ed:u}=o;if(r<=l&&i>=u){s.push({...o,st:l-r,ed:u-r});continue}l<=r&&u>=i?(s.push({...o,st:r-r,ed:i-r}),o.ed-=t):r>=l&&r<u?(s.push({...o,st:r-r,ed:u-r}),o.ed=r):i>l&&i<=u?(s.push({...o,st:l-r,ed:i-r}),o.st=i-t,o.ed-=t):l>=i&&(o.st-=t,o.ed-=t),a.push(o)}e.textRuns=a}return 0===s.length&&s.push({st:0,ed:t,ts:{}}),s}function lA(e,t,r){let{paragraphs:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<i){s.push({...o,startIndex:l-r});continue}l>=i&&(o.startIndex-=t),a.push(o)}e.paragraphs=a}return s}function lv(e,t,r){let{sectionBreaks:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.sectionBreaks=a}return s}function lS(e,t,r){let{customBlocks:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.customBlocks=a}return s}function lT(e,t,r){let{tables:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(r<=l&&i>=u){s.push({...o,startIndex:l-r,endIndex:u-r});continue}if(l<=r&&u>=i){let e=a$(l,u,r,i);if(0===e.length||(o.startIndex=e[0],o.endIndex=e[1],o.startIndex===o.endIndex))continue}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.tables=a}return s}var lO=((Q=lO||{})[Q.character=0]="character",Q[Q.paragraph=1]="paragraph",Q[Q.table=2]="table",Q[Q.numbering=3]="numbering",Q),lM=((Z=lM||{})[Z.TAB=0]="TAB",Z[Z.SPACE=1]="SPACE",Z[Z.NOTHING=2]="NOTHING",Z),lw=((J=lw||{})[J.BULLET=0]="BULLET",J[J.NONE=1]="NONE",J[J.DECIMAL=2]="DECIMAL",J[J.DECIMAL_ZERO=3]="DECIMAL_ZERO",J[J.UPPER_LETTER=4]="UPPER_LETTER",J[J.LOWER_LETTER=5]="LOWER_LETTER",J[J.UPPER_ROMAN=6]="UPPER_ROMAN",J[J.LOWER_ROMAN=7]="LOWER_ROMAN",J[J.ORDINAL=8]="ORDINAL",J[J.CARDINAL_TEXT=9]="CARDINAL_TEXT",J[J.ORDINAL_TEXT=10]="ORDINAL_TEXT",J[J.HEX=11]="HEX",J[J.CHICAGO=12]="CHICAGO",J[J.IDEOGRAPH_DIGITAL=13]="IDEOGRAPH_DIGITAL",J[J.JAPANESE_COUNTING=14]="JAPANESE_COUNTING",J[J.AIUEO=15]="AIUEO",J[J.IROHA=16]="IROHA",J[J.DECIMAL_FULL_WIDTH=17]="DECIMAL_FULL_WIDTH",J[J.DECIMAL_HALF_WIDTH=18]="DECIMAL_HALF_WIDTH",J[J.JAPANESE_LEGAL=19]="JAPANESE_LEGAL",J[J.JAPANESE_DIGITAL_TEN_THOUSAND=20]="JAPANESE_DIGITAL_TEN_THOUSAND",J[J.DECIMAL_ENCLOSED_CIRCLE=21]="DECIMAL_ENCLOSED_CIRCLE",J[J.DECIMAL_FULL_WIDTH2=22]="DECIMAL_FULL_WIDTH2",J[J.AIUEO_FULL_WIDTH=23]="AIUEO_FULL_WIDTH",J[J.IROHA_FULL_WIDTH=24]="IROHA_FULL_WIDTH",J[J.GANADA=25]="GANADA",J[J.CHOSUNG=26]="CHOSUNG",J[J.DECIMAL_ENCLOSED_FULLSTOP=27]="DECIMAL_ENCLOSED_FULLSTOP",J[J.DECIMAL_ENCLOSED_PAREN=28]="DECIMAL_ENCLOSED_PAREN",J[J.DECIMAL_ENCLOSED_CIRCLE_CHINESE=29]="DECIMAL_ENCLOSED_CIRCLE_CHINESE",J[J.IDEOGRAPH_ENCLOSED_CIRCLE=30]="IDEOGRAPH_ENCLOSED_CIRCLE",J[J.IDEOGRAPH_TRADITIONAL=31]="IDEOGRAPH_TRADITIONAL",J[J.IDEOGRAPH_ZODIAC=32]="IDEOGRAPH_ZODIAC",J[J.IDEOGRAPH_ZODIAC_TRADITIONAL=33]="IDEOGRAPH_ZODIAC_TRADITIONAL",J[J.TAIWANESE_COUNTING=34]="TAIWANESE_COUNTING",J[J.IDEOGRAPH_LEGAL_TRADITIONAL=35]="IDEOGRAPH_LEGAL_TRADITIONAL",J[J.TAIWANESE_COUNTING_THOUSAND=36]="TAIWANESE_COUNTING_THOUSAND",J[J.TAIWANESE_DIGITAL=37]="TAIWANESE_DIGITAL",J[J.CHINESE_COUNTING=38]="CHINESE_COUNTING",J[J.CHINESE_LEGAL_SIMPLIFIED=39]="CHINESE_LEGAL_SIMPLIFIED",J[J.CHINESE_COUNTING_THOUSAND=40]="CHINESE_COUNTING_THOUSAND",J[J.KOREAN_DIGITAL=41]="KOREAN_DIGITAL",J[J.KOREAN_COUNTING=42]="KOREAN_COUNTING",J[J.KOREAN_LEGAL=43]="KOREAN_LEGAL",J[J.KOREAN_DIGITAL2=44]="KOREAN_DIGITAL2",J[J.VIETNAMESE_COUNTING=45]="VIETNAMESE_COUNTING",J[J.RUSSIAN_LOWER=46]="RUSSIAN_LOWER",J[J.RUSSIAN_UPPER=47]="RUSSIAN_UPPER",J[J.NUMBER_IN_DASH=48]="NUMBER_IN_DASH",J[J.HEBREW1=49]="HEBREW1",J[J.HEBREW2=50]="HEBREW2",J[J.ARABIC_ALPHA=51]="ARABIC_ALPHA",J[J.ARABIC_ABJAD=52]="ARABIC_ABJAD",J[J.HINDI_VOWELS=53]="HINDI_VOWELS",J[J.HINDI_CONSONANTS=54]="HINDI_CONSONANTS",J[J.HINDI_NUMBERS=55]="HINDI_NUMBERS",J[J.HINDI_COUNTING=56]="HINDI_COUNTING",J[J.THAI_LETTERS=57]="THAI_LETTERS",J[J.THAI_NUMBERS=58]="THAI_NUMBERS",J[J.THAI_COUNTING=59]="THAI_COUNTING",J[J.CUSTOM=60]="CUSTOM",J),lx=((ee=lx||{})[ee.BULLET_ALIGNMENT_UNSPECIFIED=0]="BULLET_ALIGNMENT_UNSPECIFIED",ee[ee.START=1]="START",ee[ee.CENTER=2]="CENTER",ee[ee.END=3]="END",ee[ee.BOTH=4]="BOTH",ee),lU=((et=lU||{})[et.HYPERLINK=0]="HYPERLINK",et[et.FIELD=1]="FIELD",et[et.SDT=2]="SDT",et[et.BOOKMARK=3]="BOOKMARK",et[et.COMMENT=4]="COMMENT",et[et.CUSTOM=5]="CUSTOM",et[et.MENTION=6]="MENTION",et[et.UNI_FORMULA=7]="UNI_FORMULA",et[et.DELTED=9999]="DELTED",et),lD=((er=lD||{})[er.COMMENT=0]="COMMENT",er[er.DELETED=9999]="DELETED",er),lV=((en=lV||{})[en.DRAWING=0]="DRAWING",en[en.CUSTOM=1]="CUSTOM",en),lL=((ei=lL||{})[ei.UNSPECIFIED=0]="UNSPECIFIED",ei[ei.TRADITIONAL=1]="TRADITIONAL",ei[ei.MODERN=2]="MODERN",ei),lP=((es=lP||{})[es.DEFAULT=0]="DEFAULT",es[es.LINES=1]="LINES",es[es.LINES_AND_CHARS=2]="LINES_AND_CHARS",es[es.SNAP_TO_CHARS=3]="SNAP_TO_CHARS",es),lj=((ea=lj||{})[ea.SECTION_TYPE_UNSPECIFIED=0]="SECTION_TYPE_UNSPECIFIED",ea[ea.CONTINUOUS=1]="CONTINUOUS",ea[ea.NEXT_PAGE=2]="NEXT_PAGE",ea[ea.EVEN_PAGE=3]="EVEN_PAGE",ea[ea.ODD_PAGE=4]="ODD_PAGE",ea),lF=((eo=lF||{})[eo.COLUMN_SEPARATOR_STYLE_UNSPECIFIED=0]="COLUMN_SEPARATOR_STYLE_UNSPECIFIED",eo[eo.NONE=1]="NONE",eo[eo.BETWEEN_EACH_COLUMN=2]="BETWEEN_EACH_COLUMN",eo),lk=((el=lk||{})[el.NORMAL=0]="NORMAL",el[el.TBRL=1]="TBRL",el[el.LRTBV=2]="LRTBV",el),lB=((eu=lB||{})[eu.TEXT_RUN=0]="TEXT_RUN",eu[eu.AUTO_TEXT=1]="AUTO_TEXT",eu[eu.PAGE_BREAK=2]="PAGE_BREAK",eu[eu.COLUMN_BREAK=3]="COLUMN_BREAK",eu[eu.FOOT_NOTE_REFERENCE=4]="FOOT_NOTE_REFERENCE",eu[eu.HORIZONTAL_RULE=5]="HORIZONTAL_RULE",eu[eu.EQUATION=6]="EQUATION",eu[eu.DRAWING=7]="DRAWING",eu[eu.PERSON=8]="PERSON",eu[eu.RICH_LINK=9]="RICH_LINK",eu),l$=((ec=l$||{})[ec.BOTH_SIDES=0]="BOTH_SIDES",ec[ec.LEFT=1]="LEFT",ec[ec.RIGHT=2]="RIGHT",ec[ec.LARGEST=3]="LARGEST",ec),lH=((eh=lH||{})[eh.INLINE=0]="INLINE",eh[eh.WRAP_NONE=1]="WRAP_NONE",eh[eh.WRAP_POLYGON=2]="WRAP_POLYGON",eh[eh.WRAP_SQUARE=3]="WRAP_SQUARE",eh[eh.WRAP_THROUGH=4]="WRAP_THROUGH",eh[eh.WRAP_TIGHT=5]="WRAP_TIGHT",eh[eh.WRAP_TOP_AND_BOTTOM=6]="WRAP_TOP_AND_BOTTOM",eh),lW=((ed=lW||{})[ed.NAMED_STYLE_TYPE_UNSPECIFIED=0]="NAMED_STYLE_TYPE_UNSPECIFIED",ed[ed.NORMAL_TEXT=1]="NORMAL_TEXT",ed[ed.TITLE=2]="TITLE",ed[ed.SUBTITLE=3]="SUBTITLE",ed[ed.HEADING_1=4]="HEADING_1",ed[ed.HEADING_2=5]="HEADING_2",ed[ed.HEADING_3=6]="HEADING_3",ed[ed.HEADING_4=7]="HEADING_4",ed[ed.HEADING_5=8]="HEADING_5",ed[ed.HEADING_6=9]="HEADING_6",ed),lG=((em=lG||{})[em.AUTO=0]="AUTO",em[em.AT_LEAST=1]="AT_LEAST",em[em.EXACT=2]="EXACT",em),lY=((eg=lY||{})[eg.DASH_STYLE_UNSPECIFIED=0]="DASH_STYLE_UNSPECIFIED",eg[eg.SOLID=1]="SOLID",eg[eg.DOT=2]="DOT",eg[eg.DASH=3]="DASH",eg),lz=((ef=lz||{})[ef.TAB_STOP_ALIGNMENT_UNSPECIFIED=0]="TAB_STOP_ALIGNMENT_UNSPECIFIED",ef[ef.START=1]="START",ef[ef.CENTER=2]="CENTER",ef[ef.END=3]="END",ef),lq=((ep=lq||{})[ep.UNSPECIFIED=0]="UNSPECIFIED",ep[ep.SPECIFIED=1]="SPECIFIED",ep),lX=((eC=lX||{})[eC.START=0]="START",eC[eC.CENTER=1]="CENTER",eC[eC.END=2]="END",eC),lK=((e_=lK||{})[e_.AUTO_FIT=0]="AUTO_FIT",e_[e_.FIXED=1]="FIXED",e_),lQ=((ey=lQ||{})[ey.NONE=0]="NONE",ey[ey.WRAP=1]="WRAP",ey),lZ=((eE=lZ||{})[eE.AUTO=0]="AUTO",eE[eE.AT_LEAST=1]="AT_LEAST",eE[eE.EXACT=2]="EXACT",eE),lJ=((eb=lJ||{})[eb.CONTENT_ALIGNMENT_UNSPECIFIED=0]="CONTENT_ALIGNMENT_UNSPECIFIED",eb[eb.BOTH=1]="BOTH",eb[eb.TOP=2]="TOP",eb[eb.CENTER=3]="CENTER",eb[eb.BOTTOM=4]="BOTTOM",eb),l0=((eR=l0||{}).NORMAL="normal",eR.BOLD="bold",eR.ITALIC="italic",eR),l1=((eN=l1||{})[eN.PAGE=0]="PAGE",eN[eN.COLUMN=1]="COLUMN",eN[eN.CHARACTER=2]="CHARACTER",eN[eN.MARGIN=3]="MARGIN",eN[eN.INSIDE_MARGIN=4]="INSIDE_MARGIN",eN[eN.OUTSIDE_MARGIN=5]="OUTSIDE_MARGIN",eN[eN.LEFT_MARGIN=6]="LEFT_MARGIN",eN[eN.RIGHT_MARGIN=7]="RIGHT_MARGIN",eN),l2=((eI=l2||{})[eI.PAGE=0]="PAGE",eI[eI.PARAGRAPH=1]="PARAGRAPH",eI[eI.LINE=2]="LINE",eI[eI.MARGIN=3]="MARGIN",eI[eI.TOP_MARGIN=4]="TOP_MARGIN",eI[eI.BOTTOM_MARGIN=5]="BOTTOM_MARGIN",eI[eI.INSIDE_MARGIN=6]="INSIDE_MARGIN",eI[eI.OUTSIDE_MARGIN=7]="OUTSIDE_MARGIN",eI),l5=((eA=l5||{})[eA.POINT=0]="POINT",eA[eA.LINE=1]="LINE",eA[eA.CHARACTER=2]="CHARACTER",eA[eA.PIXEL=3]="PIXEL",eA[eA.PERCENT=4]="PERCENT",eA),l3=((ev=l3||{})[ev.CENTER=0]="CENTER",ev[ev.INSIDE=1]="INSIDE",ev[ev.LEFT=2]="LEFT",ev[ev.OUTSIDE=3]="OUTSIDE",ev[ev.RIGHT=4]="RIGHT",ev[ev.BOTH=5]="BOTH",ev[ev.DISTRIBUTE=6]="DISTRIBUTE",ev),l4=((eS=l4||{})[eS.BOTTOM=0]="BOTTOM",eS[eS.CENTER=1]="CENTER",eS[eS.INSIDE=2]="INSIDE",eS[eS.OUTSIDE=3]="OUTSIDE",eS[eS.TOP=4]="TOP",eS),l6=((eT=l6||{})[eT.compressPunctuation=0]="compressPunctuation",eT[eT.compressPunctuationAndJapaneseKana=1]="compressPunctuationAndJapaneseKana",eT[eT.doNotCompress=2]="doNotCompress",eT),l9=((eO=l9||{})[eO.PORTRAIT=0]="PORTRAIT",eO[eO.LANDSCAPE=1]="LANDSCAPE",eO),l7=((eM=l7||{})[eM.forward=0]="forward",eM[eM.backward=1]="backward",eM[eM.front=2]="front",eM[eM.back=3]="back",eM),l8=((ew=l8||{})[ew.UNRECOGNIZED=-1]="UNRECOGNIZED",ew[ew.DRAWING_IMAGE=0]="DRAWING_IMAGE",ew[ew.DRAWING_SHAPE=1]="DRAWING_SHAPE",ew[ew.DRAWING_CHART=2]="DRAWING_CHART",ew[ew.DRAWING_TABLE=3]="DRAWING_TABLE",ew[ew.DRAWING_SMART_ART=4]="DRAWING_SMART_ART",ew[ew.DRAWING_VIDEO=5]="DRAWING_VIDEO",ew[ew.DRAWING_GROUP=6]="DRAWING_GROUP",ew[ew.DRAWING_UNIT=7]="DRAWING_UNIT",ew[ew.DRAWING_DOM=8]="DRAWING_DOM",ew),ue=((ex=ue||{})[ex.SLIDE=0]="SLIDE",ex[ex.MASTER=1]="MASTER",ex[ex.LAYOUT=2]="LAYOUT",ex[ex.HANDOUT_MASTER=3]="HANDOUT_MASTER",ex[ex.NOTES_MASTER=4]="NOTES_MASTER",ex),ut=((eU=ut||{})[eU.SHAPE=0]="SHAPE",eU[eU.IMAGE=1]="IMAGE",eU[eU.TEXT=2]="TEXT",eU[eU.SPREADSHEET=3]="SPREADSHEET",eU[eU.DOCUMENT=4]="DOCUMENT",eU[eU.SLIDE=5]="SLIDE",eU),ur=((eD=ur||{})[eD.RELATIVE_SLIDE_LINK_UNSPECIFIED=0]="RELATIVE_SLIDE_LINK_UNSPECIFIED",eD[eD.NEXT_SLIDE=1]="NEXT_SLIDE",eD[eD.PREVIOUS_SLIDE=2]="PREVIOUS_SLIDE",eD[eD.FIRST_SLIDE=3]="FIRST_SLIDE",eD[eD.LAST_SLIDE=4]="LAST_SLIDE",eD),un=((eV=un||{}).ORDER_LIST_QUICK_1="1.",eV.ORDER_LIST_QUICK_2="a)",eV.ORDER_LIST_QUICK_3="a.",eV.ORDER_LIST_QUICK_4="i.",eV.ORDER_LIST_QUICK_5="A.",eV.ORDER_LIST_QUICK_6="I.",eV.ORDER_LIST_QUICK_7="01.",eV),ui=((eL=ui||{}).BULLET_LIST="BULLET_LIST",eL.BULLET_LIST_1="BULLET_LIST_1",eL.BULLET_LIST_2="BULLET_LIST_2",eL.BULLET_LIST_3="BULLET_LIST_3",eL.BULLET_LIST_4="BULLET_LIST_4",eL.BULLET_LIST_5="BULLET_LIST_5",eL.ORDER_LIST="ORDER_LIST",eL.ORDER_LIST_1="ORDER_LIST_1",eL.ORDER_LIST_2="ORDER_LIST_2",eL.ORDER_LIST_3="ORDER_LIST_3",eL.ORDER_LIST_4="ORDER_LIST_4",eL.ORDER_LIST_5="ORDER_LIST_5",eL.ORDER_LIST_QUICK_2="ORDER_LIST_QUICK_2",eL.ORDER_LIST_QUICK_3="ORDER_LIST_QUICK_3",eL.ORDER_LIST_QUICK_4="ORDER_LIST_QUICK_4",eL.ORDER_LIST_QUICK_5="ORDER_LIST_QUICK_5",eL.ORDER_LIST_QUICK_6="ORDER_LIST_QUICK_6",eL.CHECK_LIST="CHECK_LIST",eL.CHECK_LIST_CHECKED="CHECK_LIST_CHECKED",eL);let us={"a)":{glyphFormat:"%1)",glyphType:lw.DECIMAL},"1.":{glyphFormat:"%1.",glyphType:lw.DECIMAL},"a.":{glyphFormat:"%1.",glyphType:lw.LOWER_LETTER},"A.":{glyphFormat:"%1.",glyphType:lw.UPPER_LETTER},"i.":{glyphFormat:"%1.",glyphType:lw.LOWER_ROMAN},"I.":{glyphFormat:"%1.",glyphType:lw.UPPER_LETTER}},ua=e=>[...e,...e,...e].map((e,t)=>({glyphFormat:` %${t+1}`,glyphSymbol:e,bulletAlignment:lx.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),uo=e=>e.map((e,t)=>({...e,bulletAlignment:lx.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),ul=(e,t)=>Array(9).fill(0).map((r,n)=>({glyphFormat:` %${n+1}`,glyphSymbol:e,bulletAlignment:lx.START,textStyle:{fs:16},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*n},textStyle:t}})),uu={BULLET_LIST:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},BULLET_LIST_1:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},BULLET_LIST_2:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},BULLET_LIST_3:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},BULLET_LIST_4:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},BULLET_LIST_5:{listType:"BULLET_LIST",nestingLevel:ua(["","",""])},ORDER_LIST:{listType:"ORDER_LIST",nestingLevel:uo([{glyphFormat:"%1.",glyphType:lw.DECIMAL},{glyphFormat:"%2.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%3.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:lw.DECIMAL},{glyphFormat:"%5.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%6.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:lw.DECIMAL},{glyphFormat:"%8.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%9.",glyphType:lw.LOWER_ROMAN}])},ORDER_LIST_1:{listType:"ORDER_LIST",nestingLevel:uo([{glyphFormat:"%1)",glyphType:lw.DECIMAL},{glyphFormat:"%2)",glyphType:lw.LOWER_LETTER},{glyphFormat:"%3)",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%4)",glyphType:lw.DECIMAL},{glyphFormat:"%5)",glyphType:lw.LOWER_LETTER},{glyphFormat:"%6)",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%7)",glyphType:lw.DECIMAL},{glyphFormat:"%8)",glyphType:lw.LOWER_LETTER},{glyphFormat:"%9)",glyphType:lw.LOWER_ROMAN}])},ORDER_LIST_2:{listType:"ORDER_LIST",nestingLevel:uo(["%1.","%1.%2.","%1.%2.%3.","%1.%2.%3.%4.","%1.%2.%3.%4.%5.","%1.%2.%3.%4.%5.%6.","%1.%2.%3.%4.%5.%6.%7."].map(e=>({glyphFormat:e,glyphType:lw.DECIMAL})))},ORDER_LIST_3:{listType:"ORDER_LIST",nestingLevel:uo([{glyphFormat:"%1.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%2.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%3.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%5.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%6.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%8.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%9.",glyphType:lw.LOWER_ROMAN}])},ORDER_LIST_4:{listType:"ORDER_LIST",nestingLevel:uo([{glyphFormat:"%1.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%2.",glyphType:lw.DECIMAL},{glyphFormat:"%3.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%5.",glyphType:lw.DECIMAL},{glyphFormat:"%6.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:lw.UPPER_LETTER},{glyphFormat:"%8.",glyphType:lw.DECIMAL},{glyphFormat:"%9.",glyphType:lw.LOWER_ROMAN}])},ORDER_LIST_5:{listType:"ORDER_LIST",nestingLevel:uo([{glyphFormat:"%1.",glyphType:lw.DECIMAL_ZERO},{glyphFormat:"%2.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%3.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:lw.DECIMAL_ZERO},{glyphFormat:"%5.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%6.",glyphType:lw.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:lw.DECIMAL_ZERO},{glyphFormat:"%8.",glyphType:lw.LOWER_LETTER},{glyphFormat:"%9.",glyphType:lw.LOWER_ROMAN}])},CHECK_LIST:{listType:"CHECK_LIST",nestingLevel:ul("")},CHECK_LIST_CHECKED:{listType:"CHECK_LIST_CHECKED",nestingLevel:ul("",{st:{s:s_.TRUE}})}},uc=e=>{let{glyphFormat:t,glyphType:r}=e,n=sU.deepClone(uu.ORDER_LIST);return n.nestingLevel[0].glyphFormat=t,n.nestingLevel[0].glyphType=r,n};Object.assign(uu,{ORDER_LIST_QUICK_2:uc(us["a)"]),ORDER_LIST_QUICK_3:uc(us["a."]),ORDER_LIST_QUICK_4:uc(us["i."]),ORDER_LIST_QUICK_6:uc(us["I."])});let uh={"1.":"ORDER_LIST","a)":"ORDER_LIST_QUICK_2","a.":"ORDER_LIST_QUICK_3","i.":"ORDER_LIST_QUICK_4","A.":"ORDER_LIST_3","I.":"ORDER_LIST_QUICK_6","01.":"ORDER_LIST_5"};function ud(e,t,r){if(0===t.length)return e;e=sU.deepClone(e),t=sU.deepClone(t);let n=[],i=e.length,s=t.length,a=0,o=0,l=null;function u(){return!!l&&(n.push(l),l=null,!0)}for(;a<i&&o<s;){let i;let{st:s,ed:c,ts:h}=e[a],{st:d,ed:m,ts:g,sId:f}=t[o];if(i=r===ar.COVER?{...g,...h}:{...h},c<d)u()||n.push(e[a]),a++;else if(m<s)u()||n.push(t[o]),o++;else{let r={st:Math.min(s,d),ed:Math.max(s,d),ts:s<d?{...h}:{...g},sId:s<d?void 0:f};r.ed>r.st&&n.push(r),n.push({st:Math.max(s,d),ed:Math.min(c,m),ts:i,sId:f}),c<m?(a++,t[o].st=c,t[o].st===t[o].ed&&o++):(o++,e[a].st=m,e[a].st===e[a].ed&&a++);let u={st:Math.min(c,m),ed:Math.max(c,m),ts:c<m?{...g}:{...h},sId:c<m?f:void 0};l=u.ed>u.st?u:null}}u();let c=n[n.length-1],h=e[i-1],d=t[s-1];return c&&c.ed!==Math.max(h.ed,d.ed)&&(h.ed>d.ed?n.push(h):n.push(d)),lm(n)}var um=((eP=um||{})[eP.copy=0]="copy",eP[eP.cut=1]="cut",eP);function ug(e,t,r,n=!0,i=1){let{dataStream:s,textRuns:a,paragraphs:o=[],customBlocks:l=[],tables:u=[],sectionBreaks:c=[]}=e,h={dataStream:s.slice(t,r)};if(a){let e=[];for(let n of a){let i=sU.deepClone(n),{st:s,ed:a}=i;sU.hasIntersectionBetweenTwoRanges(s,a,t,r)&&(t>=s&&t<=a?e.push({...i,st:t,ed:Math.min(r,a)}):r>=s&&r<=a?e.push({...i,st:Math.max(t,s),ed:r}):e.push(i))}h.textRuns=lm(e.map(e=>{let{st:r,ed:n}=e;return{...e,st:r-t,ed:n-t}}))}else n&&(h.textRuns=[{st:0,ed:r-t,ts:{}}]);let d=[];for(let e of u){let n=sU.deepClone(e),{startIndex:i,endIndex:s}=n;i>=t&&s<=r&&d.push({...n,startIndex:i-t,endIndex:s-t})}d.length&&(h.tables=d);let m=[];for(let e of o){let{startIndex:n}=e;n>=t&&n<r&&m.push(sU.deepClone(e))}m.length&&(h.paragraphs=m.map(e=>({...e,startIndex:e.startIndex-t})));let g=[];for(let e of c){let{startIndex:n}=e;n>=t&&n<=r&&g.push(sU.deepClone(e))}if(g.length&&(h.sectionBreaks=g.map(e=>({...e,startIndex:e.startIndex-t}))),1===i){let i=function(e,t,r){if(null==e.customDecorations)return;let{customDecorations:n=[]}=e,i=[];return n.forEach(e=>{if(Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)){let n=sU.deepClone(e);i.push({...n,startIndex:Math.max(n.startIndex-t,0),endIndex:Math.min(n.endIndex,r-1)-t})}}),i}(e,t,r);i?h.customDecorations=i:n&&(h.customDecorations=[])}let{customRanges:f}=function(e,t,r){if(null==e.customRanges)return{};let{customRanges:n}=e;return{customRanges:n.filter(e=>Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)).map(e=>({...e,startIndex:Math.max(e.startIndex,t),endIndex:Math.min(e.endIndex,r-1)})).map(e=>({...e,startIndex:e.startIndex-t,endIndex:e.endIndex-t})),leftOffset:0,rightOffset:0}}(e,t,r);f?h.customRanges=f:n&&(h.customRanges=[]);let p=[];for(let e of l){let{startIndex:n}=e;n>=t&&n<=r&&p.push(sU.deepClone(e))}return p.length&&(h.customBlocks=p.map(e=>({...e,startIndex:e.startIndex-t}))),h}function uf(e){let{dataStream:t,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}=e,o=0,l=0;null==i||i.forEach(e=>{e.startIndex<0&&(o=Math.max(o,-e.startIndex)),e.endIndex>t.length-1&&(l=Math.max(l,e.endIndex-t.length+1))});let u=`${t}`;return r&&(r[0]&&(r[0].st=r[0].st-o),r[r.length-1]&&(r[r.length-1].ed=r[r.length-1].ed+l)),null==r||r.forEach(e=>{e.st+=o,e.ed+=o}),null==n||n.forEach(e=>{e.startIndex+=o}),null==i||i.forEach(e=>{e.startIndex+=o,e.endIndex+=o}),null==s||s.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),null==a||a.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),{...e,dataStream:u,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}}function up(e,t,r=ar.COVER){if(""!==t.dataStream)throw Error("Cannot compose other body with non-empty dataStream");let n={dataStream:e.dataStream},{textRuns:i,paragraphs:s=[],customRanges:a,customDecorations:o=[]}=e,{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h=[]}=t;n.textRuns=null==l||null==i?null!=l?l:i:ud(l,i,r),n.customRanges=function(e,t,r){if(null==e||null==t)return null!=e?e:t;if(0===t.length||0===e.length)return e;if(t.length>1||e.length>1)throw Error("Cannot cover multiple customRanges");return r===ar.REPLACE?[{...e[0]}]:[{...t[0],...e[0]}]}(c,a,r);let d=0===o.length||0===h.length||r===ar.REPLACE?h:[...h,...o.filter(e=>!h.some(t=>e.id===t.id))];d.length&&(n.customDecorations=d);let m=[],g=0,f=0;for(;g<s.length&&f<u.length;){let e=s[g],t=u[f],{startIndex:r}=e,{startIndex:n}=t;r===n?(m.push(sU.deepMerge(e,t)),g++,f++):r<n?(m.push(sU.deepClone(e)),g++):(m.push(sU.deepClone(t)),f++)}return g<s.length&&m.push(...s.slice(g)),f<u.length&&m.push(...u.slice(f)),m.length&&(n.paragraphs=m),n}class uC{constructor(e){tr(this,"_index",0),tr(this,"_offset",0),this._actions=e}hasNext(){return this.peekLength()<Number.POSITIVE_INFINITY}next(e){e||(e=Number.POSITIVE_INFINITY);let t=this._actions[this._index];if(!t)return{t:ld.RETAIN,len:Number.POSITIVE_INFINITY};{let r=this._offset,n=t.len;return e>=n-r?(e=n-r,this._index+=1,this._offset=0):this._offset+=e,t.t===ld.DELETE||t.t===ld.RETAIN&&null==t.body?sU.deepClone({...t,len:e}):sU.deepClone({...t,len:e,body:ug(t.body,r,r+e,!1)})}}peek(){return this._actions[this._index]}peekLength(){return this._actions[this._index]?this._actions[this._index].len-this._offset:Number.POSITIVE_INFINITY}peekType(){let e=this._actions[this._index];return e?e.t:ld.RETAIN}rest(){if(!this.hasNext())return[];if(0===this._offset)return this._actions.slice(this._index);{let e=this._offset,t=this._index,r=this.next(),n=this._actions.slice(this._index);return this._offset=e,this._index=t,[r].concat(n)}}}function u_(e,t,r,n,i){let s={startIndex:t.startIndex};if(t.paragraphStyle&&(s.paragraphStyle=sU.deepClone(t.paragraphStyle),e.paragraphStyle)){if(r===ar.REPLACE){if(n===ar.REPLACE)1===i&&(s.paragraphStyle={...e.paragraphStyle});else if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t])}else if(n===ar.REPLACE){if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t])}else if(1===i)for(let t of Object.keys(e.paragraphStyle))s.paragraphStyle[t]&&delete s.paragraphStyle[t]}return r===ar.REPLACE&&n===ar.REPLACE?s.bullet=1===i?sU.deepClone(e.bullet):sU.deepClone(t.bullet):void 0===e.bullet?s.bullet=sU.deepClone(t.bullet):r===ar.REPLACE||n===ar.REPLACE?s.bullet=0===i&&t.bullet?sU.deepClone(t.bullet):sU.deepClone(e.bullet):0===i&&void 0!==t.bullet&&(s.bullet=sU.deepClone(t.bullet)),s}function uy(e){return 1===Object.keys(e).length}let uE=class e{constructor(){tr(this,"_actions",[])}static apply(e,t){return function(e,t){let r=new i_;return r.reset(),t.forEach(t=>{var n,i;let s=sU.deepClone(t);switch(s.t){case ld.RETAIN:{let{coverType:t,body:n,len:i}=s;null!=n&&function(e,t,r,n,i=ar.COVER){(function(e,t,r,n,i){let{textRuns:s}=e,{textRuns:a}=t;if(null==s||null==a)return;let o=lI(e,r,n);if(i!==ar.REPLACE){let e=ud(a,o,i);t.textRuns=e}lg(e,t,r,n)})(e,t,r,n,i),function(e,t,r,n,i){let{paragraphs:s}=e,{paragraphs:a}=t;if(null==s||null==a)return;let o=lA(e,r,n);if(i!==ar.REPLACE){let e=[];for(let t of a){let{startIndex:r,paragraphStyle:n,bullet:s}=t,a=[];for(let e of o){let t,o;let{startIndex:l,paragraphStyle:u,bullet:c}=e;if(i===ar.COVER?(t={...u,...n},o={listId:"",listType:ui.BULLET_LIST,nestingLevel:0,textStyle:{},...c,...s}):(t={...n,...u},o={listId:"",listType:ui.BULLET_LIST,nestingLevel:0,textStyle:{},...s,...c}),r===l){a.push({startIndex:r,paragraphStyle:t,bullet:o});break}}e.push(...a),a=[]}t.paragraphs=e}lf(e,t,r,n)}(e,t,r,n,i),function(e,t,r,n,i){let{sectionBreaks:s}=e,{sectionBreaks:a}=t;if(null==s||null==a)return;let o=lv(e,r,n);if(i!==ar.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===ar.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.sectionBreaks=e}lp(e,t,r,n)}(e,t,r,n,i),function(e,t,r,n,i){let{customBlocks:s}=e,{customBlocks:a}=t;if(null==s||null==a)return;let o=lS(e,r,n);if(i!==ar.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===ar.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.customBlocks=e}lC(e,t,r,n)}(e,t,r,n,i),function(e,t,r,n,i){let{tables:s}=e,{tables:a}=t;if(null==s||null==a)return;let o=lT(e,r,n);if(i!==ar.REPLACE){let e=[];for(let t of a){let{startIndex:r,endIndex:n}=t,s=[];for(let e of o){let{startIndex:a,endIndex:o}=e;if(a>=r&&o<=n){i===ar.COVER?s.push({...e,...t}):s.push({...t,...e});break}}e.push(...s),s=[]}t.tables=e}l_(e,t,r,n)}(e,t,r,n,i),function(e,t,r,n,i){e.customRanges||(e.customRanges=[]),lb(e.customRanges,n),lb(e.customRanges,n+r);let s=n+r-1,{customRanges:a}=t,o=[],l=/* @__PURE__ */new Map;e.customRanges.forEach(e=>{let{startIndex:t,endIndex:r}=e;t>=n&&r<=s?l.set(e.rangeId,e):o.push(e)}),a&&(a.forEach(e=>{let{startIndex:t,endIndex:r}=e;o.push({...e,startIndex:t+n,endIndex:r+n})}),e.customRanges=lE(o))}(e,t,r,n),function(e,t,r,n,i){e.customDecorations||(e.customDecorations=[]),lN(e.customDecorations,n),lN(e.customDecorations,n+r);let s=[],{customDecorations:a}=e,{customDecorations:o=[]}=t;if(i===ar.REPLACE){for(let e=0;e<a.length;e++){let t=a[e],{startIndex:i,endIndex:o}=t;i>=n&&o<=n+r-1&&s.push(t)}o.forEach(e=>{let{startIndex:t,endIndex:r}=e;a.push({...e,startIndex:t+n,endIndex:r+n})})}else for(let e of o){let{id:t}=e;if(e.type===lD.DELETED){let e=a.filter(e=>e.id===t);e.length&&s.push(...e)}else a.push({...e,startIndex:e.startIndex+n,endIndex:e.endIndex+n})}for(let e of s){let{id:t}=e,r=a.findIndex(e=>e.id===t);-1!==r&&a.splice(r,1)}e.customDecorations=lR(a)}(e,t,r,n,i)}(e,n,i,r.cursor,t),r.moveCursor(i);break}case ld.INSERT:{let{body:t,len:i}=s;n=r.cursor,0!==i&&(e.dataStream=aW(e.dataStream,n,t.dataStream),lg(e,t,i,n),lf(e,t,i,n),lp(e,t,i,n),lC(e,t,i,n),l_(e,t,i,n),function(e,t,r,n){e.customRanges||(e.customRanges=[]);let{customRanges:i}=e;lb(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customRanges){for(let e=0,r=t.customRanges.length;e<r;e++){let r=t.customRanges[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customRanges=lE(i)}(e,t,i,n),function(e,t,r,n){e.customDecorations||(e.customDecorations=[]);let{customDecorations:i}=e;lN(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customDecorations){for(let e=0,r=t.customDecorations.length;e<r;e++){let r=t.customDecorations[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customDecorations=lR(i)}(e,t,i,n)),r.moveCursor(i);break}case ld.DELETE:{let{len:t}=s;i=r.cursor,t<=0||function(e,t,r){let{dataStream:n}=e,i=r+t;lI(e,t,r),lA(e,t,r),lv(e,t,r),lS(e,t,r),lT(e,t,r),function(e,t,r){let{customRanges:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(l>=r&&u<=i){s.push(o);continue}if(Math.max(r,l)<=Math.min(i,u)){let e=a$(l,u,r,i);if(0===e.length)continue;o.startIndex=e[0],o.endIndex=e[1]}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.customRanges=lE(a)}}(e,t,r),function(e,t,r,n=!0){let{customDecorations:i}=e,s=r+t-1,a=[];if(i){let o=[];for(let e=0,l=i.length;e<l;e++){let l=i[e],{startIndex:u,endIndex:c}=l;if(u>=r&&c<=s){a.push(l);continue}if(Math.max(r,u)<=Math.min(s,c)){let e=a$(u,c,r,s);if(0===e.length)continue;l.startIndex=e[0],l.endIndex=e[1]}else s<u&&n&&(l.startIndex-=t,l.endIndex-=t);o.push(l)}e.customDecorations=o}}(e,t,r);n&&(e.dataStream=aG(n,r,i),n.slice(r,i))}(e,t,i);break}default:throw Error(`Unknown action type for action: ${s}.`)}}),e}(e,t)}static compose(t,r){let n=new uC(t),i=new uC(r),s=new e;for(;n.hasNext()||i.hasNext();)if(i.peekType()===ld.INSERT)s.push(i.next());else if(n.peekType()===ld.DELETE)s.push(n.next());else{let e=Math.min(n.peekLength(),i.peekLength()),t=n.next(e),r=i.next(e);if(t.t===ld.INSERT&&r.t===ld.RETAIN)null==r.body?s.push(t):s.push({...t,body:up(t.body,r.body,r.coverType)});else if(t.t===ld.RETAIN&&r.t===ld.RETAIN){if(null==t.body&&null==r.body)s.push(t.len!==Number.POSITIVE_INFINITY?t:r);else if(t.body&&r.body){let e=t.coverType===ar.REPLACE||r.coverType===ar.REPLACE?ar.REPLACE:ar.COVER;s.push({...t,t:ld.RETAIN,coverType:e,body:up(t.body,r.body,r.coverType)})}else s.push(t.body?t:r)}else t.t===ld.RETAIN&&r.t===ld.DELETE?s.push(r):t.t===ld.INSERT&&(r.t,ld.DELETE)}return s.trimEndUselessRetainAction(),s.serialize()}static transform(e,t,r="right"){return this._transform(t,e,"left"===r?"right":"left")}static _transform(t,r,n="right"){let i=new uC(t),s=new uC(r),a=new e;for(;i.hasNext()||s.hasNext();)if(i.peekType()===ld.INSERT&&("left"===n||s.peekType()!==ld.INSERT)){let e=i.next();a.retain(e.len)}else if(s.peekType()===ld.INSERT)a.push(s.next());else{let e=Math.min(i.peekLength(),s.peekLength()),t=i.next(e),r=s.next(e);if(t.t===ld.DELETE)continue;if(r.t===ld.DELETE){a.push(r);continue}if(null==t.body||null==r.body)a.push(r);else{let{coverType:e,body:i}=function(e,t,r=!1){let{body:n,coverType:i=ar.COVER}=e,{body:s,coverType:a=ar.COVER}=t;if(null==n||""!==n.dataStream||null==s||""!==s.dataStream)throw Error("Data stream is not supported in retain transform.");let o={dataStream:""},{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h}=n,{textRuns:d,paragraphs:m=[],customRanges:g,customDecorations:f}=s,p=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];t=sU.deepClone(t),e=sU.deepClone(e);let s=[],a=t.length,o=e.length,l=0,u=0,c=null;function h(){return!!c&&(s.push(c),c=null,!0)}for(;l<a&&u<o;){let{st:a,ed:o,ts:d}=t[l],{st:m,ed:g,ts:f,sId:p}=e[u],C={};if(0===i)C={...d},r===ar.COVER&&n===ar.REPLACE&&f&&(C=Object.assign({},f,C));else if(C={...d},r===ar.REPLACE){if(n===ar.REPLACE)C={...f};else if(d&&f)for(let e of Object.keys(d))f[e]&&delete C[e]}else if(n===ar.REPLACE){if(f)for(let e of Object.keys(f))void 0!==f[e]&&(C[e]=f[e])}else if(f)for(let e of Object.keys(f))void 0!==C[e]&&delete C[e];if(o<m)h()||s.push(t[l]),l++;else if(g<a)h()||s.push(e[u]),u++;else{let r={st:Math.min(a,m),ed:Math.max(a,m),ts:a<m?{...d}:{...f},sId:a<m?void 0:p};r.ed>r.st&&s.push(),s.push({st:Math.max(a,m),ed:Math.min(o,g),ts:C,sId:p}),o<g?(l++,e[u].st=o,e[u].st===e[u].ed&&u++):(u++,t[l].st=g,t[l].st===t[l].ed&&l++);let n={st:Math.min(o,g),ed:Math.max(o,g),ts:o<g?{...f}:{...d},sId:o<g?p:void 0};c=n.ed>n.st?n:null}}h();let d=s[s.length-1],m=t[a-1],g=e[o-1];return d.ed!==Math.max(m.ed,g.ed)&&(m.ed>g.ed?s.push(m):s.push(g)),lm(s,!0)}(l,d,i,a,r?1:0);p&&(o.textRuns=p);let C=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];if(e.length>1||t.length>1)throw Error("CustomRanges is only supported transform for length one now.");let s=e[0],a=t[0];if(r===ar.REPLACE)return 1===i?[sU.deepClone(s)]:[sU.deepClone(a)];if(n===ar.REPLACE){let e=sU.deepClone(a);return 1===i&&Object.assign(e,sU.deepClone(s)),[e]}{let e=sU.deepClone(a);return 1===i&&Object.assign(e,sU.deepClone(s)),[e]}}(c,g,i,a,r?1:0);C&&(o.customRanges=C);let _=function(e,t){if(null==e||null==t)return t;if(0===e.length||0===t.length)return sU.deepClone(t);let r=[];for(let n of t){let{id:t,type:i}=n,s=!1;for(let a of e)if(a.id===t){(a.type===lD.DELETED||i===lD.DELETED)&&(s=!0,r.push({...n,type:lD.DELETED}));break}s||r.push(n)}return r}(h,f);_&&(o.customDecorations=_);let y=[],E=0,b=0;for(;E<u.length&&b<m.length;){let e=u[E],t=m[b],{startIndex:n}=e,{startIndex:s}=t;if(n===s){let s={startIndex:n};s=r?u_(e,t,i,a,1):u_(e,t,i,a,0),y.push(s),E++,b++}else n<s?E++:(y.push(sU.deepClone(t)),b++)}return b<m.length&&y.push(...m.slice(b)),y.length&&(o.paragraphs=y),{coverType:a,body:o}}(t,r,"left"===n);a.push({...r,t:ld.RETAIN,coverType:e,body:i})}}return a.trimEndUselessRetainAction(),a.serialize()}static transformPosition(e,t,r=!1){let n=new uC(e),i=0;for(;n.hasNext()&&i<=t;){let e=n.peekLength(),s=n.peekType();if(n.next(),s===ld.DELETE){t-=Math.min(e,t-i);continue}s===ld.INSERT&&(i<t||!r)&&(t+=e),i+=e}return t}static isNoop(e){return 0===e.length}static invert(e){let t=[];for(let r of e)if(r.t===ld.INSERT)t.push({t:ld.DELETE,len:r.len,body:r.body});else if(r.t===ld.DELETE){if(null==r.body)throw Error("Can not invert DELETE action without body property, makeInvertible must be called first.");t.push({t:ld.INSERT,body:r.body,len:r.len})}else if(null!=r.body){if(null==r.oldBody)throw Error("Can not invert RETAIN action without oldBody property, makeInvertible must be called first.");t.push({t:ld.RETAIN,body:r.oldBody,oldBody:r.body,len:r.len,coverType:ar.REPLACE})}else t.push(r);return t}static makeInvertible(e,t){let r=[],n=0;for(let i of e){if(i.t===ld.DELETE&&(null==i.body||i.body&&i.body.dataStream.length!==i.len)){let e=ug(t,n,n+i.len,!1);i.len=e.dataStream.length,i.body=e}if(i.t===ld.RETAIN&&null!=i.body){let e=ug(t,n,n+i.len,!0);i.oldBody={...e,dataStream:""},i.len=e.dataStream.length}r.push(i),i.t!==ld.INSERT&&(n+=i.len)}return r}insert(e,t){let r={t:ld.INSERT,body:t,len:e};return this.push(r),this}retain(e,t,r){let n={t:ld.RETAIN,len:e};return null!=t&&(n.body=t),null!=r&&(n.coverType=r),this.push(n),this}delete(e){let t={t:ld.DELETE,len:e};return this.push(t),this}empty(){return this._actions=[],this}serialize(){return this._actions}push(...e){if(e.length>1){for(let t of e)this.push(t);return this}let t=this._actions.length,r=this._actions[t-1],n=sU.deepClone(e[0]);if(n.t===ld.RETAIN&&0===n.len&&null==n.body)return this;if("object"==typeof r){if(r.t===ld.DELETE&&n.t===ld.DELETE)return r.len+=n.len,this;if(r.t===ld.DELETE&&n.t===ld.INSERT&&(t-=1,null==(r=this._actions[t-1])))return this._actions.unshift(n),this;if(r.t===ld.RETAIN&&n.t===ld.RETAIN&&null==r.body&&null==n.body)return r.len+=n.len,this;if(r.t===ld.INSERT&&uy(r.body)&&n.t===ld.INSERT&&uy(n.body))return r.len+=n.len,r.body.dataStream+=n.body.dataStream,this}return t===this._actions.length?this._actions.push(n):this._actions.splice(t,0,n),this}trimEndUselessRetainAction(){let e=this._actions[this._actions.length-1];for(;e&&e.t===ld.RETAIN&&function(e){let{body:t}=e;if(null==t)return!0;let{textRuns:r,paragraphs:n,customRanges:i,customBlocks:s,customDecorations:a,tables:o}=t;return null==r&&null==n&&null==i&&null==s&&null==a&&null==o}(e);)this._actions.pop(),e=this._actions[this._actions.length-1];return this}};tr(uE,"id","text-x"),tr(uE,"uri","https://github.com/dream-num/univer#text-x");let ub=uE;Object.defineProperty(ub,"name",{value:"text-x"});let uR=class e{static registerSubtype(e){var t;null==e||this._subTypes.has(e.name)&&(null==(t=this._subTypes.get(e.name))?void 0:t.id)!==ub.id||(this._subTypes.set(e.name,e),oT.type.registerSubtype(e))}static apply(e,t){if(!oT.type.isNoop(t))return oT.type.apply(e,t)}static compose(e,t){return oT.type.compose(e,t)}static transform(e,t,r){return oT.type.transform(e,t,r)}static transformPosition(e,t,r="right"){return e&&2===e.length&&"body"===e[0]&&e[1].et===ub.name?ub.transformPosition(e[1].e,t,"left"===r):t}static invertWithDoc(e,t){return oT.type.invertWithDoc(e,t)}static isNoop(e){return oT.type.isNoop(e)}static getInstance(){return null==this._instance&&(this._instance=new e),this._instance}removeOp(e,t){return oT.removeOp(e,t)}moveOp(e,t){return oT.moveOp(e,t)}insertOp(e,t){return oT.insertOp(e,t)}replaceOp(e,t,r){return oT.replaceOp(e,t,r)}editOp(e,t=["body"]){return oT.editOp(t,ub.name,e)}};tr(uR,"uri","https://github.com/dream-num/univer#json-x"),tr(uR,"_subTypes",/* @__PURE__ */new Map),tr(uR,"_instance",null);let uN=uR;uN.registerSubtype(ub);let uI={id:"default_doc",documentStyle:{}};class uA extends oS{constructor(e){var t;super(),tr(this,"type",oI.UNIVER_DOC),tr(this,"_name$",new eZ.BehaviorSubject("")),tr(this,"name$",this._name$.asObservable()),tr(this,"snapshot"),this.snapshot={...uI,...e},this._name$.next(null!=(t=this.snapshot.title)?t:"No Title")}getUnitId(){throw Error("Method not implemented.")}getRev(){var e;return null!=(e=this.snapshot.rev)?e:1}incrementRev(){this.snapshot.rev=this.getRev()+1}setRev(e){this.snapshot.rev=e}setName(e){this.snapshot.title=e,this._name$.next(e)}get drawings(){return this.snapshot.drawings}get documentStyle(){return this.snapshot.documentStyle}get lists(){return this.snapshot.lists}get zoomRatio(){var e;return(null==(e=this.snapshot.settings)?void 0:e.zoomRatio)||1}resetDrawing(e,t){this.snapshot.drawings=e,this.snapshot.drawingsOrder=t}getBody(){return this.snapshot.body}getSnapshot(){return this.snapshot}getBulletPresetList(){var e;let t=null!=(e=this.snapshot.lists)?e:{};return{...uu,...t}}updateDocumentId(e){this.snapshot.id=e}updateDocumentRenderConfig(e){let{documentStyle:t}=this.snapshot;null==t.renderConfig?t.renderConfig=e:t.renderConfig={...t.renderConfig,...e}}updateDocumentStyle(e){null==this.snapshot.documentStyle?this.snapshot.documentStyle=e:this.snapshot.documentStyle={...this.snapshot.documentStyle,...e}}updateDocumentDataMargin(e){let{t:t,l:r,b:n,r:i}=e,{documentStyle:s}=this.snapshot;null!=t&&(s.marginTop=t),null!=r&&(s.marginLeft=r),null!=n&&(s.marginBottom=n),null!=i&&(s.marginRight=i)}updateDocumentDataPageSize(e,t){let{documentStyle:r}=this.snapshot;if(!r.pageSize){e=null!=e?e:Number.POSITIVE_INFINITY,t=null!=t?t:Number.POSITIVE_INFINITY,r.pageSize={width:e,height:t};return}void 0!==e&&(r.pageSize.width=e),void 0!==t&&(r.pageSize.height=t)}updateDrawing(e,t){let{drawings:r}=this,{width:n,height:i,left:s,top:a}=t,o=null==r?void 0:r[e];if(!o)return;let l=o.docTransform;l.size.width=n,l.size.height=i,l.positionH.posOffset=s,l.positionV.posOffset=a}setZoomRatio(e=1){null==this.snapshot.settings?this.snapshot.settings={zoomRatio:e}:this.snapshot.settings.zoomRatio=1}}class uv extends uA{constructor(e){var t,r;super(sU.isEmptyObject(e)?function(e=sU.generateRandomId(6),t=st.EN_US,r=""){return{id:e,locale:t,title:r,body:{dataStream:`\r
`,textRuns:[],paragraphs:[{startIndex:0,paragraphStyle:{spaceAbove:{v:5},lineSpacing:1,spaceBelow:{v:0}}}],sectionBreaks:[{startIndex:1}]},documentStyle:{pageSize:{width:793.3333333333334,height:1122.6666666666667},marginTop:50,marginBottom:50,marginRight:40,marginLeft:40,renderConfig:{vertexAngle:0,centerAngle:0}},settings:{}}}():e),tr(this,"_unitId"),tr(this,"headerModelMap",/* @__PURE__ */new Map),tr(this,"footerModelMap",/* @__PURE__ */new Map),this._unitId=null!=(t=this.snapshot.id)?t:sU.generateRandomId(6),this._initializeHeaderFooterModel(),this._name$.next(null!=(r=this.snapshot.title)?r:"")}dispose(){super.dispose(),this.headerModelMap.forEach(e=>{e.dispose()}),this.footerModelMap.forEach(e=>{e.dispose()}),this._name$.complete()}getDrawings(){return this.snapshot.drawings}getDrawingsOrder(){return this.snapshot.drawingsOrder}getCustomRanges(){var e;return null==(e=this.snapshot.body)?void 0:e.customRanges}getCustomDecorations(){var e;return null==(e=this.snapshot.body)?void 0:e.customDecorations}getSettings(){return this.snapshot.settings}reset(e){if(e.id&&e.id!==this._unitId)throw Error("Cannot reset a document model with a different unit id!");this.snapshot={...uI,...e},this._initializeHeaderFooterModel()}getSelfOrHeaderFooterModel(e){if(null!=e){if(this.headerModelMap.has(e))return this.headerModelMap.get(e);if(this.footerModelMap.has(e))return this.footerModelMap.get(e)}return this}getUnitId(){return this._unitId}apply(e){if(!uN.isNoop(e))return this.snapshot=uN.apply(this.snapshot,e),null!=e&&e.some(e=>Array.isArray(e)&&((null==e?void 0:e[0])==="headers"||(null==e?void 0:e[0])==="footers"))&&(this.headerModelMap.clear(),this.footerModelMap.clear(),this._initializeHeaderFooterModel()),this.snapshot}sliceBody(e,t,r=um.copy){let n=this.getBody();if(null!=n)return ug(n,e,t,!1,r)}_initializeHeaderFooterModel(){let{headers:e,footers:t}=this.getSnapshot();if(e)for(let t in e){let r=e[t];this.headerModelMap.set(t,new uv(r)),this.headerModelMap.get(t).updateDocumentId(this.getUnitId())}if(t)for(let e in t){let r=t[e];this.footerModelMap.set(e,new uv(r)),this.footerModelMap.get(e).updateDocumentId(this.getUnitId())}}updateDocumentId(e){super.updateDocumentId(e),this._unitId=e}}class uS{constructor(e={}){tr(this,"_styles"),tr(this,"_cacheMap",new a1(1e5)),this._styles=e,this._generateCacheMap()}each(e){return Object.entries(this._styles).forEach(e),this}search(e,t){return this._cacheMap.has(t)?this._cacheMap.get(t):this._getExistingStyleId(e)||"-1"}get(e){return"string"!=typeof e?e:(e=String(e),this._styles[e])}add(e,t){let r=sU.generateRandomId(6);return this._styles[r]=e,this._cacheMap.set(t,r),r}setValue(e){if(null==e)return;let t=JSON.stringify(e),r=this.search(e,t);return"-1"!==r?r:this.add(e,t)}toJSON(){return this._styles}getStyleByCell(e){let t;t=e&&sU.isObject(e.s)?e.s:(null==e?void 0:e.s)&&this.get(e.s);let r=null==e?void 0:e.interceptorStyle;return r?{...t,...r}:t}_generateCacheMap(){let{_styles:e,_cacheMap:t}=this;for(let r in e){let n=JSON.stringify(e[r]);t.set(n,r)}}_getExistingStyleId(e){let{_styles:t}=this;for(let r in t)if(sU.diffValue(t[r],e))return r;return null}}function uT(e,t,r,n){return e<=r&&t>=r||e>=r&&e<=n}function uO(e,t,r,n){let i=[];for(let s=0,a=r.length;s<a;s++){let a=r[s];if((void 0===n||a.rangeType===n)&&Math.max(a.startIndex,e)<=Math.min(a.endIndex,t)&&i.push({...a}),a.startIndex>t)break}return i}var uM=((ej=uM||{}).PARAGRAPH="PARAGRAPH",ej.SECTION_BREAK="SECTION_BREAK",ej.TABLE="TABLE",ej.TABLE_ROW="TABLE_ROW",ej.TABLE_CELL="TABLE_CELL",ej.CUSTOM_BLOCK="CUSTOM_BLOCK",ej),uw=((eF=uw||{}).PARAGRAPH="\r",eF.SECTION_BREAK=`
`,eF.TABLE_START="\x1a",eF.TABLE_ROW_START="\x1b",eF.TABLE_CELL_START="\x1c",eF.TABLE_CELL_END="\x1d",eF.TABLE_ROW_END="\x0e",eF.TABLE_END="\x0f",eF.CUSTOM_RANGE_START="\x1f",eF.CUSTOM_RANGE_END="\x1e",eF.COLUMN_BREAK="\v",eF.PAGE_BREAK="\f",eF.DOCS_END="\0",eF.TAB="	",eF.CUSTOM_BLOCK="\b",eF.LETTER="",eF.SPACE=" ",eF);let ux=[uw.TABLE_START,uw.TABLE_ROW_START,uw.TABLE_CELL_START,uw.TABLE_CELL_END,uw.TABLE_ROW_END,uw.TABLE_END,uw.CUSTOM_BLOCK],uU=e=>{let t=e.endsWith(`\r
`)?e.slice(0,-2):e;return ux.reduce((e,t)=>e.replaceAll(t,""),t)};class uD{}tr(uD,"customRange",{add:function(e){let{ranges:t,rangeId:r,rangeType:n,wholeEntity:i,properties:s,body:a}=e,o=0,l=new ub,u=!1;return t.forEach(e=>{var t,c,h;let d=function(e,t){var r,n,i,s,a;let o=uO(e.startOffset,e.collapsed?e.startOffset:e.endOffset-1,null!=(r=t.customRanges)?r:[]),l=Math.min(e.startOffset,null!=(i=null==(n=o[0])?void 0:n.startIndex)?i:1/0),u=Math.max(e.endOffset,(null!=(a=null==(s=o[o.length-1])?void 0:s.endIndex)?a:-1/0)+1);return{startOffset:l,endOffset:u,collapsed:l===u}}(e,a);if(!d||!a)return!1;let{startOffset:m,endOffset:g}=d,f=null!=(t=a.customRanges)?t:[],p=(e,t,a)=>{var u,c,h,d;let m=uO(e,t,f,n),g=Math.min(null!=(c=null==(u=m[0])?void 0:u.startIndex)?c:1/0,e),p=Math.max(null!=(d=null==(h=m[m.length-1])?void 0:h.endIndex)?d:-1/0,t),C={rangeId:a?`${r}$${a}`:r,rangeType:n,startIndex:0,endIndex:p-g,wholeEntity:i,properties:{...s}};l.push({t:ld.RETAIN,len:g-o}),l.push({t:ld.RETAIN,len:p-g+1,body:{dataStream:"",customRanges:[C]},coverType:ar.COVER}),o=p+1},C=(null!=(c=a.paragraphs)?c:[]).filter(e=>e.startIndex<g&&e.startIndex>m),_=(null!=(h=a.customBlocks)?h:[]).filter(e=>e.startIndex<g&&e.startIndex>m);(function(e,t){let r=[],n=e[0];for(let i of t)i<e[0]||i>e[1]||(n<i&&r.push([n,i-1]),n=i+1);return n<=e[1]&&r.push([n,e[1]]),r})([m,g-1],[...C.map(e=>e.startIndex),..._.map(e=>e.startIndex)]).forEach(([e,t],r)=>p(e,t,r)),u=!0,l.selections=[{startOffset:d.endOffset,endOffset:d.endOffset,collapsed:!0}]}),!!u&&l},delete:function(e,t){var r,n,i;let{rangeId:s,segmentId:a,documentDataModel:o,insert:l}=t,u=null==(n=null==(r=o.getSelfOrHeaderFooterModel(a).getBody())?void 0:r.customRanges)?void 0:n.find(e=>e.rangeId===s);if(!u)return!1;let{startIndex:c,endIndex:h}=u,d=new ub;d.push({t:ld.RETAIN,len:c}),d.push({t:ld.RETAIN,len:h-c+1,body:{dataStream:"",customRanges:[]}}),l&&d.push({t:ld.INSERT,body:l,len:l.dataStream.length});let m=h+1+(null!=(i=null==l?void 0:l.dataStream.length)?i:0);return d.selections=[{startOffset:m,endOffset:m,collapsed:!0}],d},copyCustomRange:function(e){return{...sU.deepClone(e),rangeId:sD()}},getCustomRangesInterestsWithSelection:function(e,t){let r=[];for(let n=0,i=t.length;n<i;n++){let i=t[n];e.collapsed?i.startIndex<e.startOffset&&e.startOffset<=i.endIndex&&r.push(i):uT(e.startOffset,e.endOffset-1,i.startIndex,i.endIndex)&&r.push(i)}return r},isIntersecting:uT}),tr(uD,"customDecoration",{add:function(e){let{ranges:t,id:r,type:n}=e,i=new ub,s=0;for(let e=0;e<t.length;e++){let{startOffset:a,endOffset:o}=t[e];a>0&&i.push({t:ld.RETAIN,len:a-s}),i.push({t:ld.RETAIN,body:{dataStream:"",customDecorations:[{id:r,type:n,startIndex:0,endIndex:o-a-1}]},len:o-a}),s=o}return i},delete:function(e){var t,r,n;let{id:i,segmentId:s,documentDataModel:a}=e,o=null==a?void 0:a.getBody();if(!a||!o)return!1;let l=null==(n=null==(r=null==(t=a.getSelfOrHeaderFooterModel(s))?void 0:t.getBody())?void 0:r.customDecorations)?void 0:n.find(e=>e.id===i);if(!l)return!1;let u=new ub,{startIndex:c,endIndex:h}=l,d=h-c+1;return u.push({t:ld.RETAIN,len:c}),u.push({t:ld.RETAIN,len:d,body:{dataStream:"",customDecorations:[{startIndex:0,endIndex:d-1,id:i,type:lD.DELETED}]}}),u}}),tr(uD,"selection",{replace:e=>{var t;let{selection:r,body:n,doc:i}=e,s=r.segmentId,a=null==(t=i.getSelfOrHeaderFooterModel(s))?void 0:t.getBody();if(!a)return!1;let o=r.collapsed?null:ug(a,r.startOffset,r.endOffset),l=r4(o?o.dataStream:"",n.dataStream),u=0,c=l.map(([e,t])=>{switch(e){case 0:{let e={t:ld.RETAIN,body:{...ug(n,u,u+t.length,!1),dataStream:""},len:t.length};return u+=t.length,e}case 1:{let e={t:ld.INSERT,body:ug(n,u,u+t.length),len:t.length};return u+=t.length,e}default:return{t:ld.DELETE,len:t.length}}}),h=new ub;return h.push({t:ld.RETAIN,len:r.startOffset}),h.push(...c),h},makeSelection:function(e,t){if(typeof t>"u")return{startOffset:e,endOffset:e,collapsed:!0};if(t<e)throw Error(`Cannot make a doc selection when endOffset ${t} is less than startOffset ${e}.`);return{startOffset:e,endOffset:t,collapsed:e===t}},normalizeSelection:function(e){let{startOffset:t,endOffset:r,collapsed:n}=e;return{startOffset:Math.min(t,r),endOffset:Math.max(t,r),collapsed:n}},delete:function(e,t,r=0,n=null,i=!0){e.sort((e,t)=>e.startOffset-t.startOffset);let s=[],{paragraphs:a=[]}=t,o=null==a?void 0:a.find(t=>t.startIndex>=e[0].startOffset&&t.startIndex<e[0].endOffset),l=r;if(e.forEach(e=>{let{startOffset:t,endOffset:r}=e;t>l&&(s.push({t:ld.RETAIN,len:t-l}),l=t),l<r&&(s.push({t:ld.DELETE,len:r-l}),l=r)}),n&&s.push({t:ld.INSERT,body:n,len:n.dataStream.length}),o&&i){let t=a.find(t=>t.startIndex-r>=e[e.length-1].endOffset-1);t&&(t.startIndex>l&&(s.push({t:ld.RETAIN,len:t.startIndex-l}),l=t.startIndex),s.push({t:ld.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...t,startIndex:0,bullet:null==o?void 0:o.bullet}]},coverType:ar.REPLACE}))}return s}}),tr(uD,"range",{isIntersects:function(e,t,r,n){return Math.max(e,r)<=Math.min(t,n)}}),tr(uD,"transform",{getPlainText:uU,fromPlainText:e=>{let t=e.replace(/\n/g,"\r"),r=[],n=[],i=0,s="",a=(a,o=!0)=>{let l=t.slice(i,a);if(sU.isLegalUrl(l)){let t=sD(),u=`${l}`,c={startIndex:i,endIndex:i+u.length-1,rangeId:t,rangeType:lU.HYPERLINK,properties:{url:e}};n.push(c),s+=u,i=a+1,o&&(s+="\r",r.push({startIndex:a}))}else s+=t.slice(i,a+1),i=a+1,o&&r.push({startIndex:a})},o=0;for(let e=0;e<t.length;e++)"\r"===t[e]&&(a(e),o=e);return o!==t.length-1&&a(t.length,!1),{dataStream:s,paragraphs:r,customRanges:n}},isEmptyDocument:e=>!e||""===uU(e).replaceAll("\r","")}),tr(uD,"paragraph",{bullet:{set:e=>{var t,r;let{paragraphs:n,listType:i,segmentId:s,document:a}=e;if((null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)==null)return!1;let o=sU.generateRandomId(6),l=new i_;l.reset();let u=new ub;for(let e of n){let{startIndex:t,paragraphStyle:n={},bullet:s}=e;u.push({t:ld.RETAIN,len:t-l.cursor}),u.push({t:ld.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:n,bullet:{nestingLevel:null!=(r=null==s?void 0:s.nestingLevel)?r:0,textStyle:(null==s?void 0:s.listType)===i?s.textStyle:{fs:20},listType:i,listId:o}}]},coverType:ar.REPLACE}),l.moveCursorTo(t+1)}return u},switch:e=>{var t,r,n;let{paragraphs:i,segmentId:s,document:a}=e,o=e.listType,l=null!=(r=null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)?r:[],u=i.every(e=>{var t;return(null==(t=e.bullet)?void 0:t.listType.indexOf(o))===0}),c=sU.generateRandomId(6);if(1===i.length){let e=l.indexOf(i[0]),t=l[e-1],r=l[e+1];t&&t.bullet&&0===t.bullet.listType.indexOf(o)?(c=t.bullet.listId,o!==ui.CHECK_LIST&&(o=t.bullet.listType)):r&&r.bullet&&0===r.bullet.listType.indexOf(o)&&(c=r.bullet.listId,o!==ui.CHECK_LIST&&(o=r.bullet.listType))}let h=new i_;h.reset();let d=new ub;for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:i}=e;d.push({t:ld.RETAIN,len:t-h.cursor}),d.push({t:ld.RETAIN,len:1,body:{dataStream:"",paragraphs:[u?{paragraphStyle:r,startIndex:0}:{startIndex:0,paragraphStyle:{...r},bullet:{nestingLevel:null!=(n=null==i?void 0:i.nestingLevel)?n:0,textStyle:{fs:20},listType:o,listId:c}}]},coverType:ar.REPLACE}),h.moveCursorTo(t+1)}return d},toggleChecklist:e=>{var t;let{paragraphIndex:r,segmentId:n,document:i}=e,s=null==(t=i.getSelfOrHeaderFooterModel(n).getBody())?void 0:t.paragraphs;if(null==s)return!1;let a=s.find(e=>e.startIndex===r);if(!(null!=a&&a.bullet)||-1===a.bullet.listType.indexOf(ui.CHECK_LIST))return!1;let o=new i_;o.reset();let l=new ub,{startIndex:u,paragraphStyle:c={}}=a,h=a.bullet.listType===ui.CHECK_LIST?ui.CHECK_LIST_CHECKED:ui.CHECK_LIST;return l.push({t:ld.RETAIN,len:u-o.cursor}),l.push({t:ld.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...a,paragraphStyle:c,startIndex:0,bullet:{...a.bullet,listType:h}}]},coverType:ar.REPLACE}),o.moveCursorTo(u+1),l},changeNestLevel:e=>{var t,r,n;let{paragraphs:i,segmentId:s,document:a,type:o}=e,l=new i_;l.reset();let u=new ub,c=null!=(t=a.getSnapshot().lists)?t:{},h=null!=(n=null==(r=a.getBody())?void 0:r.tables)?n:[],d={...uu,...c};for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:n}=e,i=function(e,t){return t.some(t=>e.startIndex>t.startIndex&&e.startIndex<t.endIndex)}(e,h);if(u.push({t:ld.RETAIN,len:t-l.cursor}),n){let e=d[n.listType].nestingLevel.length-1;i&&(e=Math.min(e,2)),u.push({t:ld.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:{...r},bullet:{...n,nestingLevel:Math.max(Math.min(n.nestingLevel+o,e),0)}}]},coverType:ar.REPLACE})}else u.push({t:ld.RETAIN,len:1});l.moveCursorTo(t+1)}return u}}});let uV={t:0,b:2,l:2,r:2},uL=e=>({sbr:.6,sbo:e,spr:.6,spo:e});function uP(e,t,r={}){let n=e.length,{textRotation:i,paddingData:s,horizontalAlign:a=sd.UNSPECIFIED,verticalAlign:o=sm.UNSPECIFIED,wrapStrategy:l=sg.UNSPECIFIED,cellValueType:u}=r,{t:c,r:h,b:d,l:m}=s||uV,{vertexAngle:g,centerAngle:f}=uB(i);return new uv({id:"d",body:{dataStream:`${e}${nr}`,textRuns:[{ts:t,st:0,ed:n}],paragraphs:[{startIndex:n,paragraphStyle:{horizontalAlign:a}}],sectionBreaks:[{startIndex:n+1}]},documentStyle:{pageSize:{width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},marginTop:c,marginBottom:d,marginRight:h,marginLeft:m,renderConfig:{horizontalAlign:a,verticalAlign:o,centerAngle:f,vertexAngle:g,wrapStrategy:l,cellValueType:u}},drawings:{},drawingsOrder:[]})}function uj(e){if(!e)return{};let{ff:t,fs:r,it:n,bl:i,ul:s,st:a,ol:o,cl:l}=e,u={};return t&&(u.ff=t),r&&(u.fs=r),n&&(u.it=n),i&&(u.bl=i),s&&(u.ul=s),a&&(u.st=a),o&&(u.ol=o),l&&(u.cl=l),u}function uF(e,t,r){var n;let i=e.getBody();if(null!=(n=i.customRanges)&&n.some(e=>e.rangeType===lU.HYPERLINK))return;let s=uD.customRange.add({ranges:[{startOffset:0,endOffset:i.dataStream.length-1,collapsed:!1}],rangeId:r,rangeType:lU.HYPERLINK,body:i,properties:{url:t,refId:r}});s&&ub.apply(i,s.serialize())}function uk(e){let t=or.ff,r=or.fs;if(!e){let e=`${r}pt  ${t}`;return{fontCache:e,fontString:e,fontSize:r,originFontSize:r,fontFamily:t}}let n=l0.ITALIC;(0===e.it||void 0===e.it)&&(n=l0.NORMAL);let i=l0.BOLD;(0===e.bl||void 0===e.bl)&&(i=l0.NORMAL);let s=r;e.fs&&(s=Math.ceil(e.fs));let a=t;if(e.ff){let r=e.ff;(r=r.replace(/"/g,"").replace(/'/g,"")).indexOf(" ")>-1&&(r=`"${r}"`),null==r&&(r=t),a=r}let{va:o}=e,l=s;if(o===sC.SUBSCRIPT||o===sC.SUPERSCRIPT){let{sbr:e,spr:t}=uL(l);l*=o===sC.SUBSCRIPT?e:t}let u=`${n} ${i} ${l}pt ${a}`,c=`${u}, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif `;return{fontCache:u,fontString:c,fontSize:l,originFontSize:s,fontFamily:a}}function uB(e){let{a:t=0,v:r=s_.FALSE}=e||{a:0,v:s_.FALSE},n=0,i=t;return r===s_.TRUE&&(n=90,i=90),{centerAngle:n,vertexAngle:i}}class u${constructor(e,t){tr(this,"_columnData",{}),this._config=e,this._columnData=t}getColumnData(){return this._columnData}getColVisible(e){let{_columnData:t}=this,r=t[e];return!r||r.hd!==s_.TRUE}getColumnStyle(e){var t;return null==(t=this._columnData[e])?void 0:t.s}setColumnStyle(e,t){this.getColumnOrCreate(e).s=t}getHiddenCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&e?(n=!1,r.push({rangeType:ao.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):n||e||(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:ao.COLUMN}),r}getVisibleCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&!e?(n=!1,r.push({rangeType:ao.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:ao.COLUMN}),r}getColumnDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getColumnOrCreate(i);r[n]=e,n++}return r}getSize(){return a4(this._columnData)}getColumnWidth(e){let{_columnData:t}=this,r=this._config;return(t[e]||{hd:s_.FALSE,w:r.defaultColumnWidth}).w||r.defaultColumnWidth}getColumn(e){let t=this._columnData[e];if(t)return t}removeColumn(e){delete this._columnData[e]}getColumnOrCreate(e){let{_columnData:t}=this,r=t[e];if(r)return r;let n={};return this._columnData[e]=n,n}}class uH{constructor(e,t,r){tr(this,"_rowData"),this._config=e,this._viewModel=t,this._rowData=r}getRowData(){return this._rowData}getRowStyle(e){var t;return null==(t=this._rowData[e])?void 0:t.s}setRowStyle(e,t){this.getRowOrCreate(e).s=t}getRowDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getRowOrCreate(i);r[n]=e,n++}return r}getRowHeight(e,t=1){let{_rowData:r}=this,n=this._config,i=0;for(let s=0;s<t;s++){let{ia:t,ah:a,h:o=n.defaultRowHeight}=r[s+e]||{hd:s_.FALSE,h:n.defaultRowHeight};i+=(null==t||t===s_.TRUE)&&"number"==typeof a?a:o}return i}getRow(e){return this._rowData[e]}removeRow(e){delete this._rowData[e]}getRowOrCreate(e){let{_rowData:t}=this,r=t[e];if(r)return r;let n={};return t[e]=n,n}getHiddenRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:ao.ROW})):n||e||(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:ao.ROW}),r}getVisibleRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&!e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:ao.ROW})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:ao.ROW}),r}getRowRawVisible(e){let t=this.getRow(e);return!t||t.hd!==s_.TRUE}getSize(){return a4(this._rowData)}}let uW=24,uG="DEFAULT_WORKSHEET_COLUMN_WIDTH",uY=88;function uz(e){let t={name:"Sheet1",id:"sheet-01",tabColor:"",hidden:s_.FALSE,rowCount:1e3,columnCount:20,zoomRatio:1,freeze:{xSplit:0,ySplit:0,startRow:-1,startColumn:-1},scrollTop:0,scrollLeft:0,defaultColumnWidth:uY,defaultRowHeight:uW,mergeData:[],cellData:{},rowData:{},columnData:{},showGridlines:s_.TRUE,rowHeader:{width:46,hidden:s_.FALSE},columnHeader:{height:20,hidden:s_.FALSE},rightToLeft:s_.FALSE};return Object.keys(t).forEach(r=>{typeof e[r]>"u"&&(e[r]=t[r])}),e}class uq extends ix{constructor(e){super(),tr(this,"_cellCache",/* @__PURE__ */new Map),tr(this,"_rowCache",/* @__PURE__ */new Map),tr(this,"_columnCache",/* @__PURE__ */new Map),tr(this,"_hasRow",!1),tr(this,"_hasColumn",!1),tr(this,"_hasAll",!1),tr(this,"_allIndex",-1),tr(this,"_mergeData"),tr(this,"_rangeMap",new a1(5e4)),tr(this,"_skeletonCache",new a1(5e4)),this._init(e.concat())}_init(e){this._mergeData=e,this._createCache(e)}_clearCache(){this._cellCache.clear(),this._rowCache.clear(),this._columnCache.clear(),this._hasAll=!1,this._allIndex=-1,this._rangeMap.clear(),this._skeletonCache.clear(),this._hasColumn=!1,this._hasRow=!1}_createCache(e){let t=0;for(let r of e){let{rangeType:e}=r;e===ao.ROW?this._createRowCache(r,t):e===ao.COLUMN?this._createColumnCache(r,t):e===ao.ALL?this._createCellAllCache(t):this._createCellCache(r,t),t++}}rebuild(e){this._clearCache(),this._init(e.concat())}_createRowCache(e,t){let{startRow:r,endRow:n}=e;for(let e=r;e<=n;e++)this._rowCache.set(e,t),this._hasRow=!0}_createColumnCache(e,t){let{startColumn:r,endColumn:n}=e;for(let e=r;e<=n;e++)this._columnCache.set(e,t),this._hasColumn=!0}_createCellAllCache(e){this._hasAll=!0,this._allIndex=e}_createCellCache(e,t){for(let r=e.startRow;r<=e.endRow;r++){let n=this._cellCache.get(r);null==n&&(n=/* @__PURE__ */new Map,this._cellCache.set(r,n));for(let r=e.startColumn;r<=e.endColumn;r++)n.set(r,t)}}add(e){this._mergeData.push(e),this._clearCache(),this._createCache(this._mergeData)}remove(e,t){let r=this._getMergeDataIndex(e,t);-1!==r&&(this._mergeData.splice(r,1),this._clearCache(),this._createCache(this._mergeData))}getMergedCell(e,t){let r=this._getMergeDataIndex(e,t);return -1!==r?this._mergeData[r]:null}getMergeDataIndex(e,t){return this._getMergeDataIndex(e,t)}isRowContainsMergedCell(e){return!!this._hasAll||!sU.isEmptyObject(this._columnCache)||this._mergeData.some(t=>t.startRow<=e&&e<=t.endRow)}isColumnContainsMergedCell(e){return!!this._hasAll||!sU.isEmptyObject(this._rowCache)||this._mergeData.some(t=>t.startColumn<=e&&e<=t.endColumn)}getMergedCellRange(e,t,r,n){let i=[],s=`${e}-${t}-${r}-${n}`;if(this._rangeMap.has(s))return this._getRangeFromCache(s);let a=0,o=[];for(let s of this._mergeData||[])op.intersects(s,{startRow:e,endRow:r,startColumn:t,endColumn:n})&&(i.push({...s}),o.push(a)),a++;return this._rangeMap.set(s,o),i}getMergedCellRangeForSkeleton(e,t,r,n){let i=[],s=this._mergeData,a=`${e}-${t}-${r}-${n}`;if(this._skeletonCache.has(a))return this._getSkeletonRangeFromCache(a);let o=[];for(let a=0;a<s.length;a++){let{startRow:l,endRow:u,startColumn:c,endColumn:h}=s[a];for(let s=e;s<=r;s++){let e=!1;for(let r=t;r<=n;r++)if(s>=l&&s<=u&&r>=c&&r<=h){i.push({startRow:l,endRow:u,startColumn:c,endColumn:h}),o.push(a),e=!0;break}if(e)break}}return this._skeletonCache.set(a,o),i}_getRangeFromCache(e){let t=this._rangeMap.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getSkeletonRangeFromCache(e){let t=this._skeletonCache.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getMergeDataIndex(e,t){var r;if(this._hasAll)return this._allIndex;if(this._hasRow){let t=this._rowCache.get(e);if(void 0!==t)return t}if(this._hasColumn){let e=this._columnCache.get(t);if(void 0!==e)return e}let n=null==(r=this._cellCache.get(e))?void 0:r.get(t);return void 0!==n?n:-1}getMergeDataSnapshot(){return this._mergeData}dispose(){this._clearCache(),this._mergeData=[]}}class uX extends ix{constructor(e){super(),tr(this,"_cellContentInterceptor",null),tr(this,"_rowFilteredInterceptor",null),this.getRawCell=e}dispose(){super.dispose(),this._cellContentInterceptor=null,this._rowFilteredInterceptor=null}getCell(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,im.Value|im.Style):this.getRawCell(e,t)}getCellValueOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,im.Value):this.getRawCell(e,t)}getCellStyleOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,im.Style):this.getRawCell(e,t)}getRowFiltered(e){var t,r;return null!=(r=null==(t=this._rowFilteredInterceptor)?void 0:t.getRowFiltered(e))&&r}registerCellContentInterceptor(e){if(this._cellContentInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._cellContentInterceptor=e,iM(()=>this._cellContentInterceptor=null)}registerRowFilteredInterceptor(e){if(this._rowFilteredInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._rowFilteredInterceptor=e,iM(()=>this._rowFilteredInterceptor=null)}}let uK={isDeepClone:!1,displayRawFormula:!1,ignoreTextRotation:!1};class uQ{constructor(e,t,r){var n;tr(this,"_sheetId"),tr(this,"_snapshot"),tr(this,"_cellData"),tr(this,"_rowManager"),tr(this,"_columnManager"),tr(this,"_viewModel"),tr(this,"_spanModel"),this.unitId=e,this._styles=r,this._snapshot=uz(t);let{columnData:i,rowData:s,cellData:a}=this._snapshot;this._sheetId=null!=(n=this._snapshot.id)?n:sU.generateRandomId(6),this._cellData=new ot(a),this._viewModel=new uX((e,t)=>this.getCellRaw(e,t)),this._rowManager=new uH(this._snapshot,this._viewModel,s),this._columnManager=new u$(this._snapshot,i),this._spanModel=new uq(this._snapshot.mergeData)}__interceptViewModel(e){e(this._viewModel)}getSnapshot(){return this._snapshot}setMergeData(e){this._snapshot.mergeData=e,this.getSpanModel().rebuild(e)}getSpanModel(){return this._spanModel}getColumnStyle(e,t=!1){return t?this._columnManager.getColumnStyle(e):this._styles.get(this._columnManager.getColumnStyle(e))}setColumnStyle(e,t){this._columnManager.setColumnStyle(e,t)}getRowStyle(e,t=!1){return t?this._rowManager.getRowStyle(e):this._styles.get(this._rowManager.getRowStyle(e))}setRowStyle(e,t){this._rowManager.setRowStyle(e,t)}mixinDefaultStyleToCellRaw(e,t,r,n){let i=this.getColumnStyle(t),s=this.getRowStyle(e),a=this.getDefaultCellStyleInternal();if(a||i||s){let e=null==r?void 0:r.s;"string"==typeof e&&(e=this._styles.get(e));let t=n?sV(a,i,s,e):sV(a,s,i,e);r||(r={}),r.s=t}}getDefaultCellStyle(){return this._snapshot.defaultStyle}getDefaultCellStyleInternal(){let e=this._snapshot.defaultStyle;return this._styles.get(e)}setDefaultCellStyle(e){this._snapshot.defaultStyle=e}getCellMatrix(){return this._cellData}getCellMatrixPrintRange(){let e=this.getCellMatrix(),t=this.getMergeData(),r=-1,n=-1,i=-1,s=-1,a=!1,o=!1;return e.forEach((t,l)=>{Object.keys(l).forEach(l=>{let u=+l,c=e.getValue(t,u),h=null!=c&&c.s?this._styles.get(c.s):null,d=(null==h?void 0:h.bd)&&(h.bd.b||h.bd.l||h.bd.r||h.bd.t||h.bd.bc_tr||h.bd.bl_tr||h.bd.ml_tr||h.bd.tl_bc||h.bd.tl_br||h.bd.tl_mr);(c&&(c.v||c.p)||null!=h&&h.bg||d)&&(a?r=Math.min(r,t):(r=t,a=!0),n=Math.max(n,t),o?i=Math.min(i,u):(o=!0,i=u),s=Math.max(s,u))})}),t.forEach(e=>{a?r=Math.min(r,e.startRow):(r=e.startRow,a=!0),n=Math.max(n,e.endRow),o?i=Math.min(i,e.startColumn):(i=e.startColumn,a=!0),s=Math.max(s,e.endColumn)}),a&&o?{startColumn:i,startRow:r,endColumn:s,endRow:n}:null}getRowManager(){return this._rowManager}getUnitId(){return this.unitId}getSheetId(){return this._sheetId}getColumnManager(){return this._columnManager}getName(){return this._snapshot.name}clone(){let{_snapshot:e}=this,t=sU.deepClone(e);return new uQ(this.unitId,t,this._styles)}getMergeData(){return this._spanModel.getMergeDataSnapshot()}getMergedCell(e,t){return this._spanModel.getMergedCell(e,t)}getMergedCellRange(e,t,r,n){return this._spanModel.getMergedCellRange(e,t,r,n)}isRowContainsMergedCell(e){return this._spanModel.isRowContainsMergedCell(e)}isColumnContainsMergedCell(e){return this._spanModel.isColumnContainsMergedCell(e)}getCellInfoInMergeData(e,t){let r=this.getMergedCell(e,t),n=!1,i=!1,s=e,a=t,o=e,l=t;if(r){let{startRow:u,endRow:c,startColumn:h,endColumn:d}=r;e===u&&t===h?(s=c,a=d,o=u,l=h,i=!0):e>=u&&e<=c&&t>=h&&t<=d&&(s=c,a=d,o=u,l=h,n=!0)}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}getCell(e,t){return e<0||t<0?null:this._viewModel.getCell(e,t)}getCellValueOnly(e,t){return e<0||t<0?null:this._viewModel.getCellValueOnly(e,t)}getCellStyleOnly(e,t){return e<0||t<0?null:this._viewModel.getCellStyleOnly(e,t)}getCellRaw(e,t){return this.getCellMatrix().getValue(e,t)}getRowFiltered(e){return this._viewModel.getRowFiltered(e)}getMatrixWithMergedCells(e,t,r,n,i=!1){let s=this.getCellMatrix(),a=this._spanModel.getMergedCellRange(e,t,r,n),o=new ot;return o_(e,r,t,n).forEach((e,t)=>{let r=i?this.getCellRaw(e,t):this.getCell(e,t);r&&o.setValue(e,t,r)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;o_(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),rowSpan:i-r+1,colSpan:n-t+1}),(e!==r||a!==t)&&o.realDeleteValue(e,a)})}),o}getRange(e,t,r,n){return"object"==typeof e?new ol(this,e,{getStyles:()=>this._styles}):new ol(this,{startRow:e,startColumn:t,endColumn:n||t,endRow:r||e},{getStyles:()=>this._styles})}getScrollLeftTopFromSnapshot(){return{scrollLeft:this._snapshot.scrollLeft,scrollTop:this._snapshot.scrollTop}}getZoomRatio(){return this._snapshot.zoomRatio||1}getConfig(){return this._snapshot}getFreeze(){return this._snapshot.freeze}getMaxColumns(){let{_snapshot:e}=this,{columnCount:t}=e;return t}getMaxRows(){let{_snapshot:e}=this,{rowCount:t}=e;return t}getRowCount(){return this._snapshot.rowCount}setRowCount(e){this._snapshot.rowCount=e}getColumnCount(){return this._snapshot.columnCount}setColumnCount(e){this._snapshot.columnCount=e}isSheetHidden(){return this._snapshot.hidden}hasHiddenGridlines(){let{_snapshot:e}=this,{showGridlines:t}=e;return 0===t}getTabColor(){let{_snapshot:e}=this,{tabColor:t}=e;return t}getColumnWidth(e){return this.getColumnManager().getColumnWidth(e)}getRowHeight(e){return this._viewModel.getRowFiltered(e)?0:this.getRowManager().getRowHeight(e)}isRowFiltered(e){return this._viewModel.getRowFiltered(e)}getRowVisible(e){return!this.isRowFiltered(e)&&this.getRowRawVisible(e)}getRowRawVisible(e){return this.getRowManager().getRowRawVisible(e)}getHiddenRows(e,t){let r=this.getMaxColumns()-1,n=this._rowManager.getHiddenRows(e,t);return n.forEach(e=>e.endColumn=r),n}getColVisible(e){return this._columnManager.getColVisible(e)}getHiddenCols(e,t){let r=this.getMaxRows()-1,n=this._columnManager.getHiddenCols(e,t);return n.forEach(e=>e.endRow=r),n}getVisibleRows(){let e=this.getRowCount();return this._rowManager.getVisibleRows(0,e-1)}getVisibleCols(){let e=this.getColumnCount();return this._columnManager.getVisibleCols(0,e-1)}isRightToLeft(){let{_snapshot:e}=this,{rightToLeft:t}=e;return t}getLastRowWithContent(){return this._cellData.getLength()-1}getLastColumnWithContent(){return this._cellData.getRange().endColumn}cellHasValue(e){return e&&(void 0!==e.v||void 0!==e.f||void 0!==e.p)}iterateByRow(e,t=!0){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e,a=this;return{[Symbol.iterator]:()=>{let e=r,o=n;return{next(){for(;;){if(o>s&&(e+=1,o=n),e>i)return{done:!0,value:void 0};let r=a.getCell(e,o),l=!r,u=a.getMergedCell(e,o);if(u){if(e!==u.startRow||o!==u.startColumn||l&&t){o=u.endColumn+1;continue}let n={row:e,col:o,value:r};return n.colSpan=u.endColumn-u.startColumn+1,n.rowSpan=u.endRow-u.startRow+1,o=u.endColumn+1,{done:!1,value:n}}if(l&&t)o+=1;else{let t={row:e,col:o,value:r};return o+=1,{done:!1,value:t}}}}}}}}iterateByColumn(e,t=!0,r=!0){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e,o=this;return{[Symbol.iterator]:()=>{let e=n,l=i;return{next(){for(;;){if(e>s&&(l+=1,e=n),l>a)return{done:!0,value:void 0};let i=o.getMergedCell(e,l);if(i){let n=e!==i.startRow,s=n||l!==i.startColumn;if(r&&s||!r&&n){e=i.endRow+1;continue}let a=o.getCell(i.startRow,i.startColumn);if(!a&&t){e=i.endRow+1;continue}let u={row:e,col:i.startColumn,value:a};return u.colSpan=i.endColumn-i.startColumn+1,u.rowSpan=i.endRow-i.startRow+1,e=i.endRow+1,{done:!1,value:u}}let u=o.getCell(e,l);if(!u&&t)e+=1;else{let t={row:e,col:l,value:u};return e+=1,{done:!1,value:t}}}}}}}}_getCellDocumentModel(e,t=uK){var r;let{isDeepClone:n,displayRawFormula:i,ignoreTextRotation:s}={...uK,...t},a=this._styles.getStyleByCell(e);if(!e)return;let o,l="document",u=function(e){if(!e)return{};let{tr:t,td:r,ht:n,vt:i,tb:s,pd:a}=e;return{textRotation:t,textDirection:r,horizontalAlign:n,verticalAlign:i,wrapStrategy:s,paddingData:a}}(a),c=s?or.tr:u.textRotation||or.tr,h=u.horizontalAlign||or.ht,d=u.verticalAlign||or.vt,m=u.wrapStrategy||or.tb,g=u.paddingData||uV;if(e.f&&i)o=uP(e.f.toString(),{},{verticalAlign:d}),h=or.ht;else if(e.p){let{centerAngle:t,vertexAngle:r}=uB(c);o=this._updateConfigAndGetDocumentModel(n?sU.deepClone(e.p):e.p,h,g,{horizontalAlign:h,verticalAlign:d,centerAngle:t,vertexAngle:r,wrapStrategy:m})}else if(null!=e.v){let t=uj(a);l=uk(t).fontCache;let r=uZ(e);e.t===sy.FORCE_STRING&&i&&(r=`'${r}`),o=uP(r,t,{...u,textRotation:c,cellValueType:e.t})}return o&&e.linkUrl&&e.linkId&&uF(o,e.linkUrl,e.linkId),{documentModel:o,fontString:l,textRotation:c,wrapStrategy:m,verticalAlign:d,horizontalAlign:h,paddingData:g,fill:null==(r=null==a?void 0:a.bg)?void 0:r.rgb}}_updateConfigAndGetDocumentModel(e,t,r,n){var i,s,a,o,l;if(n&&null!=(i=e.body)&&i.dataStream){for(let i of(e.documentStyle||(e.documentStyle={}),e.documentStyle.marginTop=null!=(s=r.t)?s:0,e.documentStyle.marginBottom=null!=(a=r.b)?a:2,e.documentStyle.marginLeft=null!=(o=r.l)?o:2,e.documentStyle.marginRight=null!=(l=r.r)?l:2,e.documentStyle.pageSize={width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},e.documentStyle.renderConfig=n,e.body.paragraphs||[]))i.paragraphStyle||(i.paragraphStyle={}),i.paragraphStyle.horizontalAlign=t;return new uv(e)}}getBlankCellDocumentModel(e){let t=this._getCellDocumentModel(e,{ignoreTextRotation:!0}),r=uj(this._styles.getStyleByCell(e));if(null!=t)return null==t.documentModel&&(t.documentModel=uP("",r)),t;let n="document",i=or.tr,s=or.ht,a=or.vt,o=or.tb;return n=uk({}).fontCache,{documentModel:uP("",r),fontString:n,textRotation:i,wrapStrategy:o,verticalAlign:a,horizontalAlign:s,paddingData:uV}}getCellDocumentModelWithFormula(e){return this._getCellDocumentModel(e,{isDeepClone:!0,displayRawFormula:!0,ignoreTextRotation:!0})}}function uZ(e){var t,r;if(!e)return"";let n=null==(r=null==(t=e.p)?void 0:t.body)?void 0:r.dataStream;if(n)return uD.transform.getPlainText(n);let i=e.v;return"string"==typeof i?e.t===sy.BOOLEAN?i.toUpperCase():i.replace(/[\r\n]/g,""):"number"==typeof i?e.t===sy.BOOLEAN?i?"TRUE":"FALSE":i.toString():"boolean"==typeof i?i?"TRUE":"FALSE":""}var uJ=Object.defineProperty,u0=Object.getOwnPropertyDescriptor;let u1=class extends oS{constructor(e={},t){super(),tr(this,"type",oI.UNIVER_SHEET),tr(this,"_sheetCreated$",new e9.Subject),tr(this,"sheetCreated$",this._sheetCreated$.asObservable()),tr(this,"_sheetDisposed$",new e9.Subject),tr(this,"sheetDisposed$",this._sheetDisposed$.asObservable()),tr(this,"_activeSheet$",new eZ.BehaviorSubject(null)),tr(this,"activeSheet$",this._activeSheet$.asObservable()),tr(this,"_worksheets"),tr(this,"_styles"),tr(this,"_snapshot"),tr(this,"_unitId"),tr(this,"_count"),tr(this,"_name$"),tr(this,"name$"),this._logService=t;let r=function(e="",t=st.ZH_CN,r=""){return{id:e,sheetOrder:[],name:r,appVersion:"0.5.0",locale:t,styles:{},sheets:{},resources:[]}}();sU.isEmptyObject(e)?this._snapshot=r:this._snapshot=sU.commonExtend(r,e);let{styles:n}=this._snapshot;(null==this._snapshot.id||0===this._snapshot.id.length)&&(this._snapshot.id=sU.generateRandomId(6)),this._unitId=this._snapshot.id,this._styles=new uS(n),this._count=1,this._worksheets=/* @__PURE__ */new Map,this._name$=new eZ.BehaviorSubject(e.name||""),this.name$=this._name$.asObservable(),this._parseWorksheetSnapshots()}get _activeSheet(){return this._activeSheet$.getValue()}get name(){return this._name$.getValue()}static isIRangeType(e){return"string"==typeof e||"startRow"in e||"row"in e}dispose(){super.dispose(),this._sheetCreated$.complete(),this._sheetDisposed$.complete(),this._activeSheet$.complete(),this._name$.complete()}save(){return sU.deepClone(this._snapshot)}getSnapshot(){return this._snapshot}getName(){return this._snapshot.name}setName(e){this._name$.next(e),this._snapshot.name=e}getUnitId(){return this._unitId}getRev(){var e;return null!=(e=this._snapshot.rev)?e:1}incrementRev(){this._snapshot.rev=this.getRev()+1}setRev(e){this._snapshot.rev=e}addWorksheet(e,t,r){let{sheets:n,sheetOrder:i}=this._snapshot;if(n[e])return!1;n[e]=r,i.splice(t,0,e);let s=new uQ(this._unitId,r,this._styles);return this._worksheets.set(e,s),this._sheetCreated$.next(s),!0}getSheetOrders(){return this._snapshot.sheetOrder}getWorksheets(){return this._worksheets}getActiveSpreadsheet(){return this}getStyles(){return this._styles}getConfig(){return this._snapshot}getIndexBySheetId(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>t===e)}getActiveSheet(e){if(!this._activeSheet&&typeof e>"u")throw Error(`[Workbook]: no active Worksheet on Workbook ${this._unitId}!`);return this._activeSheet}ensureActiveSheet(){let e=this._activeSheet;if(e)return e;let t=this._snapshot.sheetOrder;for(let e=0,r=t.length;e<r;e++){let r=this._worksheets.get(t[e]);if(r&&r.isSheetHidden()!==s_.TRUE)return this.setActiveSheet(r),r}let r=this._worksheets.get(t[0]);return this.setActiveSheet(r),r}setActiveSheet(e){this._activeSheet$.next(e)}removeSheet(e){let t=this._worksheets.get(e);return!!t&&(this._worksheets.delete(e),this._snapshot.sheetOrder.splice(this._snapshot.sheetOrder.indexOf(e),1),delete this._snapshot.sheets[e],this._sheetDisposed$.next(t),!0)}getActiveSheetIndex(){let{sheetOrder:e}=this._snapshot;return e.findIndex(e=>this._worksheets.get(e)===this._activeSheet)}getSheetSize(){return this._snapshot.sheetOrder.length}getSheets(){let{sheetOrder:e}=this._snapshot;return e.map(e=>this._worksheets.get(e))}getSheetsName(){let{sheetOrder:e}=this._snapshot,t=[];return e.forEach(e=>{let r=this._worksheets.get(e);r&&t.push(r.getName())}),t}getSheetIndex(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>e.getSheetId()===t)}getSheetBySheetName(e){let{sheetOrder:t}=this._snapshot,r=t.find(t=>this._worksheets.get(t).getName()===e);return this._worksheets.get(r)}getSheetBySheetId(e){return this._worksheets.get(e)}getSheetByIndex(e){let{sheetOrder:t}=this._snapshot;return this._worksheets.get(t[e])}getHiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden===s_.TRUE).map(e=>e.getConfig().id)}getUnhiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden!==s_.TRUE).map(e=>e.getConfig().id)}load(e){this._snapshot=e}checkSheetName(e){return this.getSheetsName().includes(e)}uniqueSheetName(e="Sheet1"){let t=e;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}generateNewSheetName(e){let t=e+this._count;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}_parseWorksheetSnapshots(){let{_snapshot:e,_worksheets:t}=this,{sheets:r,sheetOrder:n}=e;if(sU.isEmptyObject(r)){let e=sU.generateRandomId();r[e]={id:e}}for(let e in r){let i=r[e],{name:s}=i;i.name=this.uniqueSheetName(s),i.name!==s&&this._logService.debug("[Workbook]",`The worksheet name ${s} is duplicated, we changed it to ${i.name}. Please fix the problem in your snapshot.`);let a=new uQ(this._unitId,i,this._styles);t.set(e,a),n.includes(e)||n.push(e)}this.ensureActiveSheet()}};u1=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?u0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&uJ(t,r,s),s})([(e,t)=>iP(e,t,1)],u1);class u2 extends oS{constructor(e){var t;super(),tr(this,"type",oI.UNIVER_SLIDE),tr(this,"_activePage$",new eZ.BehaviorSubject(null)),tr(this,"activePage$",this._activePage$.asObservable()),tr(this,"_name$"),tr(this,"name$"),tr(this,"_snapshot"),tr(this,"_unitId"),this._snapshot={...on,...e},this._unitId=null!=(t=this._snapshot.id)?t:sU.generateRandomId(6),this._name$=new eZ.BehaviorSubject(this._snapshot.title),this.name$=this._name$.asObservable()}get _activePage(){var e,t;let r=this._activePage$.getValue();if(!r){let r=null==(e=this.getPageOrder())?void 0:e[0];return r?null==(t=this.getPages())?void 0:t[r]:null}return r}setName(e){var t;this._snapshot.title=e,this._name$.next(e),this._unitId=null!=(t=this._snapshot.id)?t:sD(6)}getRev(){return 0}incrementRev(){}setRev(e){}getSnapshot(){return this._snapshot}getUnitId(){return this._unitId}getPages(){var e;return null==(e=this._snapshot.body)?void 0:e.pages}getPageOrder(){var e;return null==(e=this._snapshot.body)?void 0:e.pageOrder}getPage(e){let t=this.getPages();return null==t?void 0:t[e]}getElementsByPage(e){var t;return null==(t=this.getPage(e))?void 0:t.pageElements}getElement(e,t){var r;return null==(r=this.getElementsByPage(e))?void 0:r[t]}getPageSize(){return this._snapshot.pageSize}getBlankPage(){let e=sD(6);return{id:e,pageType:ue.SLIDE,zIndex:10,title:e,description:"",pageBackgroundFill:{rgb:"rgb(255,255,255)"},pageElements:{}}}setActivePage(e){this._activePage$.next(e)}getActivePage(){return this._activePage}updatePage(e,t){this._snapshot.body&&(this._snapshot.body.pages[e]=t)}appendPage(e){var t;if(!this._snapshot.body)return;this._snapshot.body.pages[e.id]=e;let r=this._activePage,n=this._snapshot.body.pageOrder.indexOf(null!=(t=null==r?void 0:r.id)?t:"");this._snapshot.body.pageOrder.splice(n+1,0,e.id)}}let u5="FOCUSING_UNIT",u3="FOCUSING_SHEET",u4="FOCUSING_DOC",u6="FOCUSING_SLIDE",u9="FOCUSING_EDITOR_BUT_HIDDEN",u7="EDITOR_ACTIVATED",u8="FOCUSING_EDITOR_INPUT_FORMULA",ce="FOCUSING_FX_BAR_EDITOR",ct="FOCUSING_UNIVER_EDITOR",cr="FOCUSING_EDITOR_INPUT_FORMULA",cn="FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",ci="FOCUSING_COMMON_DRAWINGS",cs="FORMULA_EDITOR_ACTIVATED";var ca=Object.defineProperty,co=Object.getOwnPropertyDescriptor,cl=(e,t)=>(r,n)=>t(r,n,e);let cu=nA("univer.current"),cc=class extends ix{constructor(e,t){super(),tr(this,"_unitsByType",/* @__PURE__ */new Map),tr(this,"_createHandler"),tr(this,"_ctorByType",/* @__PURE__ */new Map),tr(this,"_currentUnits",/* @__PURE__ */new Map),tr(this,"_currentUnits$",new eZ.BehaviorSubject(this._currentUnits)),tr(this,"currentUnits$",this._currentUnits$.asObservable()),tr(this,"_unitAdded$",new e9.Subject),tr(this,"unitAdded$",this._unitAdded$.asObservable()),tr(this,"_unitDisposed$",new e9.Subject),tr(this,"unitDisposed$",this._unitDisposed$.asObservable()),tr(this,"_focused$",new eZ.BehaviorSubject(null)),tr(this,"focused$",this._focused$.asObservable()),this._injector=e,this._contextService=t}dispose(){super.dispose(),this._focused$.complete()}__setCreateHandler(e){this._createHandler=e}createUnit(e,t,r){return this._createHandler(e,t,this._ctorByType.get(e),r)}registerCtorForType(e,t){return this._ctorByType.set(e,t),{dispose:()=>{this._ctorByType.delete(e)}}}getCurrentTypeOfUnit$(e){return this.currentUnits$.pipe((0,e2.map)(t=>{var r;return null!=(r=t.get(e))?r:null}),(0,e0.distinctUntilChanged)())}getCurrentUnitForType(e){return this._currentUnits.get(e)}setCurrentUnitForType(e){let t=this._getUnitById(e);if(!t)throw Error(`[UniverInstanceService]: no document with unitId ${e}!`);this._currentUnits.set(t[1],t[0]),this._currentUnits$.next(this._currentUnits)}getTypeOfUnitAdded$(e){return this._unitAdded$.pipe((0,e1.filter)(t=>t.type===e))}__addUnit(e,t){var r;let n=e.type;this._unitsByType.has(n)||this._unitsByType.set(n,[]);let i=this._unitsByType.get(n),s=e.getUnitId();if(-1!==i.findIndex(e=>e.getUnitId()===s))throw Error(`[UniverInstanceService]: cannot create a unit with the same unit id: ${s}.`);i.push(e),this._unitAdded$.next(e),(null==(r=null==t?void 0:t.makeCurrent)||r)&&this.setCurrentUnitForType(e.getUnitId())}getTypeOfUnitDisposed$(e){return this.unitDisposed$.pipe((0,e1.filter)(t=>t.type===e))}getUnit(e,t){var r;let n=null==(r=this._getUnitById(e))?void 0:r[0];return t&&(null==n?void 0:n.type)!==t?null:n}getCurrentUniverDocInstance(){return this.getCurrentUnitForType(oI.UNIVER_DOC)}getUniverDocInstance(e){return this.getUnit(e,oI.UNIVER_DOC)}getUniverSheetInstance(e){return this.getUnit(e,oI.UNIVER_SHEET)}getAllUnitsForType(e){var t;return null!=(t=this._unitsByType.get(e))?t:[]}changeDoc(e,t){let r=this.getAllUnitsForType(oI.UNIVER_DOC),n=r.find(t=>t.getUnitId()===e);if(null!=n){let e=r.indexOf(n);r.splice(e,1)}this.__addUnit(t)}get focused(){var e;let t=this._focused$.getValue();return t?null==(e=this._getUnitById(t))?void 0:e[0]:null}focusUnit(e){this._focused$.next(e),this.focused instanceof u1?(this._contextService.setContextValue(u5,!0),this._contextService.setContextValue(u4,!1),this._contextService.setContextValue(u3,!0),this._contextService.setContextValue(u6,!1),this.setCurrentUnitForType(e)):this.focused instanceof uv?(this._contextService.setContextValue(u5,!0),this._contextService.setContextValue(u4,!0),this._contextService.setContextValue(u3,!1),this._contextService.setContextValue(u6,!1),this.setCurrentUnitForType(e)):this.focused instanceof u2?(this._contextService.setContextValue(u5,!0),this._contextService.setContextValue(u4,!1),this._contextService.setContextValue(u3,!1),this._contextService.setContextValue(u6,!0),this.setCurrentUnitForType(e)):(this._contextService.setContextValue(u5,!1),this._contextService.setContextValue(u4,!1),this._contextService.setContextValue(u3,!1),this._contextService.setContextValue(u6,!1))}getFocusedUnit(){return this.focused}getUnitType(e){let t=this._getUnitById(e);return t?t[1]:oI.UNRECOGNIZED}disposeUnit(e){let t=this._getUnitById(e);if(!t)return!1;let[r,n]=t,i=this._unitsByType.get(n),s=i.indexOf(r);return i.splice(s,1),this._tryRemoveCurrentUnitForType(e,n),this._tryBlurUnitOnRemoval(e),this._unitDisposed$.next(r),!0}_tryRemoveCurrentUnitForType(e,t){let r=this.getCurrentUnitForType(t);(null==r?void 0:r.getUnitId())===e&&(this._currentUnits.set(t,null),this._currentUnits$.next(this._currentUnits))}_tryBlurUnitOnRemoval(e){var t;(null==(t=this.focused)?void 0:t.getUnitId())===e&&this._focused$.next(null)}_getUnitById(e){for(let[t,r]of this._unitsByType){let n=r.find(t=>t.getUnitId()===e);if(n)return[n,t]}}};cc=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?co(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&ca(t,r,s),s})([cl(0,nx(n1)),cl(1,iD)],cc);var ch=((ek=ch||{})[ek.Starting=0]="Starting",ek[ek.Ready=1]="Ready",ek[ek.Rendered=2]="Rendered",ek[ek.Steady=3]="Steady",ek);let cd={0:"Starting",1:"Ready",2:"Rendered",3:"Steady"};var cm=Object.defineProperty,cg=Object.getOwnPropertyDescriptor;let cf=class extends ix{constructor(e){super(),tr(this,"_lifecycle$",new eZ.BehaviorSubject(ch.Starting)),tr(this,"lifecycle$",this._lifecycle$.asObservable()),tr(this,"_lock",!1),this._logService=e,this._reportProgress(ch.Starting)}get stage(){return this._lifecycle$.getValue()}set stage(e){if(this._lock)throw Error("[LifecycleService]: cannot set new stage when related logic is all handled!");if(e<this.stage)throw Error("[LifecycleService]: lifecycle stage cannot go backward!");e!==this.stage&&(this._lock=!0,this._reportProgress(e),this._lifecycle$.next(e),this._lock=!1)}dispose(){this._lifecycle$.complete(),super.dispose()}subscribeWithPrevious(){var e;return(0,e5.merge)(cp(this.stage),this._lifecycle$.pipe((0,e6.skip)(1))).pipe((e=e=>e===ch.Steady,function(t){return new e3.Observable(r=>(t.subscribe({next:t=>{r.next(t),e(t)&&r.complete()},complete:()=>r.complete(),error:e=>r.error(e)}),()=>r.unsubscribe()))}))}_reportProgress(e){this._logService.debug("[LifecycleService]",`lifecycle progressed to "${cd[e]}".`)}};function cp(e){switch(e){case ch.Starting:return(0,e4.of)(ch.Starting);case ch.Ready:return(0,e4.of)(ch.Starting,ch.Ready);case ch.Rendered:return(0,e4.of)(ch.Starting,ch.Ready,ch.Rendered);default:return(0,e4.of)(ch.Starting,ch.Ready,ch.Rendered,ch.Steady)}}cf=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?cg(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cm(t,r,s),s})([(e,t)=>iP(e,t,0)],cf);var cC=Object.defineProperty,c_=Object.getOwnPropertyDescriptor,cy=(e,t)=>(r,n)=>t(r,n,e);let cE=nA("univer.undo-redo.service");class cb{dispose(){}async dispatchToHandlers(){return!1}}let cR="univer.command.redo",cN="univer.command.undo",cI=new class extends cb{constructor(){super(...arguments),tr(this,"type",i$.COMMAND),tr(this,"id",cN)}async handler(e){let t=e.get(cE),r=t.pitchTopUndoElement();if(!r)return!1;let n=e.get(iH);return!!iq(r.undoMutations,n)&&(t.popUndoToRedo(),!0)}},cA=new class extends cb{constructor(){super(...arguments),tr(this,"type",i$.COMMAND),tr(this,"id",cR)}async handler(e){let t=e.get(cE),r=t.pitchTopRedoElement();if(!r)return!1;let n=e.get(iH);return!!iq(r.redoMutations,n)&&(t.popRedoToUndo(),!0)}},cv=class extends ix{constructor(e,t,r){super(),tr(this,"undoRedoStatus$"),tr(this,"_undoRedoStatus$",new eZ.BehaviorSubject({undos:0,redos:0})),tr(this,"_undoStacks",/* @__PURE__ */new Map),tr(this,"_redoStacks",/* @__PURE__ */new Map),tr(this,"_batchingStatus",/* @__PURE__ */new Map),this._univerInstanceService=e,this._commandService=t,this._contextService=r,this.undoRedoStatus$=this._undoRedoStatus$.asObservable(),this.disposeWithMe(this._commandService.registerCommand(cI)),this.disposeWithMe(this._commandService.registerCommand(cA)),this.disposeWithMe(iM(()=>this._undoRedoStatus$.complete())),this.disposeWithMe(iM(this._univerInstanceService.focused$.subscribe(()=>this._updateStatus())))}pushUndoRedo(e){let{unitID:t}=e,r=this._getRedoStack(t,!0),n=this._getUndoStack(t,!0);if(r.length=0,this._batchingStatus.has(e.unitID)){let t=this._batchingStatus.get(e.unitID),r=this._pitchUndoElement(e.unitID);0!==t&&r?this._tryBatchingElements(r,e):(i(e),this._batchingStatus.set(e.unitID,1))}else i(e);function i(e){n.push(e),n.length>20&&n.splice(0,1)}this._updateStatus()}clearUndoRedo(e){let t=this._getRedoStack(e);t&&(t.length=0);let r=this._getUndoStack(e);r&&(r.length=0),this._updateStatus()}pitchTopUndoElement(){let e=this._getFocusedUnitId();return this._pitchUndoElement(e)}pitchTopRedoElement(){let e=this._getFocusedUnitId();return this._pitchRedoElement(e)}_pitchUndoElement(e){let t=this._getUndoStack(e);return null!=t&&t.length?t[t.length-1]:null}_pitchRedoElement(e){let t=this._getRedoStack(e);return null!=t&&t.length?t[t.length-1]:null}popUndoToRedo(){let e=this._getUndoStackForFocused().pop();e&&(this._getRedoStackForFocused().push(e),this._updateStatus())}popRedoToUndo(){let e=this._getRedoStackForFocused().pop();e&&(this._getUndoStackForFocused().push(e),this._updateStatus())}__tempBatchingUndoRedo(e){if(this._batchingStatus.has(e))throw Error("[LocalUndoRedoService]: cannot batching undo redo twice at the same time!");return this._batchingStatus.set(e,0),iM(()=>this._batchingStatus.delete(e))}_updateStatus(){var e,t;let r=this._getFocusedUnitId(),n=r&&(null==(e=this._undoStacks.get(r))?void 0:e.length)||0,i=r&&(null==(t=this._redoStacks.get(r))?void 0:t.length)||0;this._undoRedoStatus$.next({undos:n,redos:i})}_getUndoStack(e,t=!1){let r=this._undoStacks.get(e);return!r&&t&&(r=[],this._undoStacks.set(e,r)),r||null}_getRedoStack(e,t=!1){let r=this._redoStacks.get(e);return!r&&t&&(r=[],this._redoStacks.set(e,r)),r||null}_getUndoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getUndoStack(e,!0)}_getRedoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getRedoStack(e,!0)}_tryBatchingElements(e,t){e.redoMutations.push(...t.redoMutations),e.undoMutations.push(...t.undoMutations)}_getFocusedUnitId(){var e,t,r,n;let i=this._contextService.getContextValue(u3),s=this._contextService.getContextValue(ce),a=this._contextService.getContextValue(u7);return i?s?ne:a?r8:null!=(t=null==(e=this._univerInstanceService.getFocusedUnit())?void 0:e.getUnitId())?t:"":null!=(n=null==(r=this._univerInstanceService.getFocusedUnit())?void 0:r.getUnitId())?n:""}};cv=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?c_(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cC(t,r,s),s})([cy(0,cu),cy(1,iH),cy(2,iD)],cv);let cS=nA("core.resource-manager.service"),cT={[oA.Editor]:"Editor",[oA.Owner]:"Owner",[oA.Reader]:"Reader",[oA.UNRECOGNIZED]:"UNRECOGNIZED"},cO=e=>e?{userID:`${cT[e]}_${sU.generateRandomId(8)}`,name:cT[e],avatar:""}:{userID:"",name:"",avatar:"",anonymous:!0,canBindAnonymous:!1},cM=(e,t)=>e.startsWith(cT[t]);class cw{constructor(){tr(this,"_model",/* @__PURE__ */new Map),tr(this,"_userChange$",new e9.Subject),tr(this,"userChange$",this._userChange$.asObservable()),tr(this,"_currentUser$",new eZ.BehaviorSubject(cO())),tr(this,"currentUser$",this._currentUser$.asObservable())}getCurrentUser(){return this._currentUser$.getValue()}setCurrentUser(e){this.addUser(e),this._currentUser$.next(e)}addUser(e){this._model.set(e.userID,e),this._userChange$.next({type:"add",user:e})}getUser(e,t){let r=this._model.get(e);if(r)return r;t&&t()}delete(e){let t=this.getUser(e);this._model.delete(e),t&&this._userChange$.next({type:"delete",user:t})}clear(){this._model.clear(),this._userChange$.next({type:"clear"})}list(){return Array.from(this._model.values())}}var cx=Object.defineProperty,cU=Object.getOwnPropertyDescriptor,cD=(e,t)=>(r,n)=>t(r,n,e);let cV=class{constructor(e,t){tr(this,"_permissionMap",/* @__PURE__ */new Map([])),this._resourceManagerService=e,this._userManagerService=t,this._initSnapshot(),this._initDefaultUser()}_initDefaultUser(){let e=this._userManagerService.getCurrentUser();e&&e.userID||this._userManagerService.setCurrentUser(cO(oA.Owner))}_getRole(e){let t=this._userManagerService.getCurrentUser();return!!t&&cM(t.userID,e)}_initSnapshot(){this._resourceManagerService.registerPluginResource({toJson:e=>JSON.stringify([...this._permissionMap.keys()].reduce((e,t)=>{let r=this._permissionMap.get(t);return e[t]=r,e},{})),parseJson:e=>JSON.parse(e),pluginName:"SHEET_AuthzIoMockService_PLUGIN",businesses:[oI.UNIVER_SHEET,oI.UNIVER_DOC,oI.UNIVER_SLIDE],onLoad:(e,t)=>{for(let e in t)this._permissionMap.set(e,t[e])},onUnLoad:()=>{this._permissionMap.clear()}})}async create(e){return sD(8)}async allowed(e){return Promise.resolve([])}async batchAllowed(e){return Promise.resolve([])}async list(e){let t=[];return e.objectIDs.forEach(r=>{let n=this._permissionMap.get(r);if(n){let i={objectID:r,unitID:e.unitID,objectType:n.objectType,name:n.name,shareOn:!1,shareRole:oA.Owner,shareScope:-1,scope:{read:ov.AllCollaborator,edit:ov.AllCollaborator},creator:cO(oA.Owner),strategies:[{action:6,role:1},{action:16,role:1},{action:17,role:1},{action:18,role:1},{action:19,role:1},{action:33,role:1},{action:34,role:1},{action:35,role:1},{action:36,role:1},{action:37,role:1},{action:38,role:1},{action:39,role:1},{action:40,role:1}],actions:e.actions.map(e=>({action:e,allowed:this._getRole(oA.Owner)||this._getRole(oA.Editor)}))};t.push(i)}}),t}async listCollaborators(){return[]}async listRoles(){return{roles:[],actions:[]}}async deleteCollaborator(){}async update(e){}async updateCollaborator(){}async createCollaborator(){}async putCollaborators(e){}};cV=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?cU(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cx(t,r,s),s})([cD(0,cS),cD(1,nx(cw))],cV);let cL=nA("IAuthzIoIoService"),cP=nA("univer.config-service");class cj{constructor(){tr(this,"_configChanged$",new e9.Subject),tr(this,"configChanged$",this._configChanged$.asObservable()),tr(this,"_config",/* @__PURE__ */new Map)}dispose(){this._configChanged$.complete()}getConfig(e){return this._config.get(e)}setConfig(e,t,r){var n;let{merge:i=!1}=r||{},s=null!=(n=this._config.get(e))?n:{};s=i?sU.deepMerge(s,t):t,this._config.set(e,s),this._configChanged$.next({[e]:s})}deleteConfig(e){return this._config.delete(e)}subscribeConfigValue$(e){return new e3.Observable(t=>{Object.prototype.hasOwnProperty.call(this._config,e)&&t.next(this._config.get(e));let r=this.configChanged$.pipe((0,e1.filter)(t=>Object.prototype.hasOwnProperty.call(t,e))).subscribe(r=>t.next(r[e]));return()=>r.unsubscribe()})}}class cF extends ix{constructor(){super(...arguments),tr(this,"_error$",new e9.Subject),tr(this,"error$",this._error$.asObservable())}dispose(){this._error$.complete()}emit(e){this._error$.next({errorKey:e})}}class ck extends ix{constructor(){super(),tr(this,"_currentLocale$",new eZ.BehaviorSubject(st.ZH_CN)),tr(this,"currentLocale$",this._currentLocale$.asObservable()),tr(this,"_locales",null),tr(this,"localeChanged$",new e9.Subject),tr(this,"t",(e,...t)=>{if(!this._locales)throw Error("[LocaleService]: Locale not initialized");let r=e.split("."),n=this.resolveKeyPath(this._locales[this._currentLocale],r);if("string"!=typeof n)return e;{let e=n;return t.forEach((t,r)=>{e=e.replace(`{${r}}`,t)}),e}}),this.disposeWithMe(iM(()=>this.localeChanged$.complete()))}get _currentLocale(){return this._currentLocale$.value}load(e){var t;this._locales=sU.deepMerge(null!=(t=this._locales)?t:{},e)}setLocale(e){this._currentLocale$.next(e),this.localeChanged$.next()}getLocales(){var e;return null==(e=this._locales)?void 0:e[this._currentLocale]}getCurrentLocale(){return this._currentLocale}resolveKeyPath(e,t){let r=t.shift();if(r&&e&&r in e){let n=e[r];return t.length>0&&("object"==typeof n||Array.isArray(n))?this.resolveKeyPath(n,t):n}return null}}var cB=Object.defineProperty,c$=Object.getOwnPropertyDescriptor;let cH=class{constructor(e){this._userManagerService=e}async list(e){return{list:[{type:sr.PERSON,mentions:[{objectType:sr.PERSON,objectId:this._userManagerService.getCurrentUser().userID,label:this._userManagerService.getCurrentUser().name,metadata:{icon:this._userManagerService.getCurrentUser().avatar}}],metadata:{},title:"PEOPLE"}],page:e.page,size:e.size,total:1}}};cH=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?c$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cB(t,r,s),s})([(eB=nx(cw),(e,t)=>eB(e,t,0))],cH);let cW=nA("univer.service.mention-io");var cG=((e$=cG||{}).INIT="init",e$.FETCHING="fetching",e$.DONE="done",e$);let cY=nA("univer.permission-service");class cz extends ix{constructor(){super(...arguments),tr(this,"_permissionPointMap",/* @__PURE__ */new Map),tr(this,"_permissionPointUpdate$",new e9.Subject),tr(this,"permissionPointUpdate$",this._permissionPointUpdate$.asObservable()),tr(this,"_showComponents",!0)}setShowComponents(e){this._showComponents=e}getShowComponents(){return this._showComponents}deletePermissionPoint(e){let t=this._permissionPointMap.get(e);t&&(t.complete(),this._permissionPointMap.delete(e))}addPermissionPoint(e){let t=e instanceof eZ.BehaviorSubject,r=t?e.getValue():e;if(!r.id)return!1;if(this._permissionPointMap.get(r.id))throw Error(`${r.id} PermissionPoint already exists`);return this._permissionPointMap.set(r.id,t?e:new eZ.BehaviorSubject(r)),this._permissionPointUpdate$.next(r),!0}updatePermissionPoint(e,t){let r=this._permissionPointMap.get(e);if(!r)return;let n=r.getValue();n.value=t,n.status=cG.DONE,r.next(n),this._permissionPointUpdate$.next(n)}clearPermissionMap(){this._permissionPointMap.clear()}getPermissionPoint(e){let t=this._permissionPointMap.get(e);if(t)return t.getValue()}getPermissionPoint$(e){let t=this._permissionPointMap.get(e);if(t)return t}composePermission$(e){let t=e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.asObservable()});return(0,eJ.combineLatest)(t).pipe((0,e2.map)(e=>e))}composePermission(e){return e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.getValue()})}getAllPermissionPoint(){let e=/* @__PURE__ */new Map;return this._permissionPointMap.forEach((t,r)=>{e.set(r,t)}),e}}let cq=Symbol("DependentOn");class cX extends ix{onStarting(){}onReady(){}onRendered(){}onSteady(){}getUniverInstanceType(){return this.constructor.type}getPluginName(){return this.constructor.pluginName}}tr(cX,"pluginName"),tr(cX,"type",oI.UNIVER_UNKNOWN);class cK{constructor(){tr(this,"_plugins",[])}addPlugin(e){this._plugins.push(e)}removePlugins(){let e=this._plugins.slice();return this._plugins.length=0,e}forEachPlugin(e){this._plugins.forEach(e)}}class cQ{constructor(){tr(this,"_pluginsRegistered",[])}registerPlugin(e,t){this._pluginsRegistered.push({plugin:e,options:t})}getRegisterPlugins(){return this._pluginsRegistered.slice()}removePlugins(){this._pluginsRegistered=[]}}var cZ=Object.defineProperty,cJ=Object.getOwnPropertyDescriptor,c0=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?cJ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&cZ(t,r,s),s},c1=(e,t)=>(r,n)=>t(r,n,e);function c2(...e){return function(t){t[cq]=e}}let c5=class{constructor(e){tr(this,"_pluginHolderForUniver"),tr(this,"_pluginHoldersForTypes",/* @__PURE__ */new Map),tr(this,"_seenPlugins",/* @__PURE__ */new Set),tr(this,"_flushTimer"),this._injector=e,this._pluginHolderForUniver=this._injector.createInstance(c3,this._checkPluginSeen.bind(this),this._immediateInitPlugin.bind(this)),this._pluginHoldersForTypes.set(oI.UNIVER_UNKNOWN,this._pluginHolderForUniver),this._pluginHolderForUniver.start()}dispose(){for(let e of(this._clearFlushTimer(),this._pluginHoldersForTypes.values()))e.dispose();this._pluginHolderForUniver.dispose()}registerPlugin(e,t){this._assertPluginValid(e),this._scheduleInitPlugin();let{type:r}=e;r===oI.UNIVER_UNKNOWN?(this._pluginHolderForUniver.register(e,t),this._pluginHolderForUniver.flush()):this._ensurePluginHolderForType(r).register(e,t)}startPluginForType(e){this._ensurePluginHolderForType(e).start()}_ensurePluginHolderForType(e){if(!this._pluginHoldersForTypes.has(e)){let t=this._injector.createInstance(c3,this._checkPluginSeen.bind(this),this._immediateInitPlugin.bind(this));return this._pluginHoldersForTypes.set(e,t),t}return this._pluginHoldersForTypes.get(e)}_immediateInitPlugin(e){this._seenPlugins.add(e.pluginName),this._ensurePluginHolderForType(e.type).immediateInitPlugin(e)}_checkPluginSeen(e){return this._seenPlugins.has(e.pluginName)}_assertPluginValid(e){let{type:t,pluginName:r}=e;if(t===oI.UNRECOGNIZED)throw Error(`[PluginService]: invalid plugin type for ${e.name}. Please assign a "type" to your plugin.`);if(!r)throw Error(`[PluginService]: no plugin name for ${e.name}. Please assign a "pluginName" to your plugin.`);if(this._seenPlugins.has(r))throw Error(`[PluginService]: duplicated plugin name for "${r}". Maybe a plugin that dependents on "${r} has already registered it. In that case please register "${r}" before the that plugin.`);this._seenPlugins.add(e.pluginName)}_scheduleInitPlugin(){void 0===this._flushTimer&&(this._flushTimer=setTimeout(()=>{this._pluginHolderForUniver.started||this._pluginHolderForUniver.start(),this._flushPlugins(),this._clearFlushTimer()},4))}_clearFlushTimer(){this._flushTimer&&(clearTimeout(this._flushTimer),this._flushTimer=void 0)}_flushPlugins(){for(let[e,t]of(this._pluginHolderForUniver.flush(),this._pluginHoldersForTypes))t.started&&t.flush()}};c5=c0([c1(0,nx(n1))],c5);let c3=class extends ix{constructor(e,t,r,n,i){super(),tr(this,"_started",!1),tr(this,"_warnedAboutOnStartingDeprecation",!1),tr(this,"_pluginRegistry",new cQ),tr(this,"_pluginStore",new cK),tr(this,"_pluginsInBatches",[]),this._checkPluginRegistered=e,this._registerPlugin=t,this._logService=r,this._injector=n,this._lifecycleService=i,this.disposeWithMe(this._lifecycleService.lifecycle$.pipe((0,e6.skip)(1)).subscribe(e=>{this._pluginsInBatches.forEach(t=>this._runStage(t,e))}))}get started(){return this._started}dispose(){super.dispose(),this._pluginStore.forEachPlugin(e=>e.dispose()),this._pluginStore.removePlugins(),this._pluginRegistry.removePlugins(),this._pluginsInBatches.length=0}register(e,t){this._pluginRegistry.registerPlugin(e,t)}immediateInitPlugin(e){let t=this._initPlugin(e,void 0);this._pluginsRunLifecycle([t])}start(){this._started||(this._started=!0,this.flush())}flush(){if(!this._started)return;let e=this._pluginRegistry.getRegisterPlugins().map(({plugin:e,options:t})=>this._initPlugin(e,t));e.length&&(this._pluginsRunLifecycle(e),this._pluginRegistry.removePlugins())}_initPlugin(e,t){let r=e[cq];if(r){let t=()=>{let t=r.find(e=>!this._checkPluginRegistered(e));return!!t&&(this._logService.debug("[PluginService]",`Plugin "${e.pluginName}" depends on "${t.pluginName}" which is not registered. Univer will automatically register it with default configuration.`),this._registerPlugin(t,void 0),!0)};for(;t(););}let n=this._injector.createInstance(e,t);return this._pluginStore.addPlugin(n),this._logService.debug("[PluginService]",`Plugin "${n.getPluginName()}" registered.`),n}_pluginsRunLifecycle(e){cp(this._lifecycleService.stage).subscribe(t=>this._runStage(e,t)),this._pluginsInBatches.push(e)}_runStage(e,t){e.forEach(e=>{switch(t){case ch.Starting:e.onStarting();break;case ch.Ready:e.onReady();break;case ch.Rendered:e.onRendered();break;case ch.Steady:e.onSteady()}})}};function c4(e,t){if(!t)return e;let r=[];for(let n of e){let e=t.find(([e])=>e===n[0]);if(e){if(null===e[1])continue;r.push([n[0],e[1]])}else r.push(n)}return r}c3=c0([c1(2,iP),c1(3,nx(n1)),c1(4,nx(cf))],c3);var c6=Object.defineProperty,c9=Object.getOwnPropertyDescriptor,c7=(e,t)=>(r,n)=>t(r,n,e);let c8=class extends ix{constructor(e,t){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._init()}_init(){let e=e=>{e.businesses.forEach(t=>{switch(t){case oI.UNRECOGNIZED:case oI.UNIVER_UNKNOWN:case oI.UNIVER_SLIDE:case oI.UNIVER_DOC:this._univerInstanceService.getAllUnitsForType(oI.UNIVER_DOC).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Document{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}});break;case oI.UNIVER_SHEET:this._univerInstanceService.getAllUnitsForType(oI.UNIVER_SHEET).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Workbook{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}})}})};this._resourceManagerService.getAllResourceHooks().forEach(t=>e(t)),this.disposeWithMe(this._resourceManagerService.register$.subscribe(t=>e(t))),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(oI.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(oI.UNIVER_DOC).subscribe(e=>{ns(e.getUnitId())||this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(oI.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(oI.UNIVER_DOC).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())}))}saveUnit(e){let t=this._univerInstanceService.getUnit(e);if(!t)return null;let r=this._resourceManagerService.getResources(e,t.type),n=sU.deepClone(t.getSnapshot());return n.resources=r,n}};c8=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?c9(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&c6(t,r,s),s})([c7(0,nx(cS)),c7(1,nx(cu))],c8);let he=nA("resource-loader-service");class ht extends ix{constructor(){super(...arguments),tr(this,"_resourceMap",/* @__PURE__ */new Map),tr(this,"_register$",new e9.Subject),tr(this,"register$",this._register$.asObservable())}getAllResourceHooks(){return[...this._resourceMap.values()]}getResources(e,t){return t?this.getResourcesByType(e,t):this.getAllResourceHooks().map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}getResourcesByType(e,t){return this.getAllResourceHooks().filter(e=>e.businesses.includes(t)).map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}registerPluginResource(e){let t=e.pluginName;if(this._resourceMap.has(t))throw Error(`the pluginName is registered {${t}}`);return this._resourceMap.set(t,e),this._register$.next(e),iM(()=>this._resourceMap.delete(t))}disposePluginResource(e){this._resourceMap.delete(e)}loadResources(e,t){this.getAllResourceHooks().forEach(r=>{var n;let i=null==(n=null==t?void 0:t.find(e=>e.name===r.pluginName))?void 0:n.data;if(i)try{let t=r.parseJson(i);r.onLoad(e,t)}catch{console.error("LoadResources Error!")}})}unloadResources(e){this.getAllResourceHooks().forEach(t=>{t.onUnLoad(e)})}dispose(){this._register$.complete(),this._resourceMap.clear()}}class hr extends ix{constructor(){super(),tr(this,"_currentTheme"),tr(this,"_currentTheme$",new eZ.BehaviorSubject({})),tr(this,"currentTheme$",this._currentTheme$.asObservable()),this.disposeWithMe(iM(()=>this._currentTheme$.complete()))}getCurrentTheme(){if(!this._currentTheme)throw Error("[ThemeService]: current theme is not set!");return this._currentTheme}setTheme(e){this._currentTheme=e,this._currentTheme$.next(e)}}class hn{constructor(e={},t){tr(this,"_startedTypes",/* @__PURE__ */new Set),tr(this,"_injector");let r=this._injector=function(e,t){let r=c4([[cF],[ck],[hr],[cf],[c5],[cw],[cu,{useClass:cc}],[cY,{useClass:cz}],[iP,{useClass:ij,lazy:!0}],[iH,{useClass:iY}],[cE,{useClass:cv,lazy:!0}],[cP,{useClass:cj}],[iD,{useClass:iV}],[cS,{useClass:ht,lazy:!0}],[he,{useClass:c8,lazy:!0}],[cL,{useClass:cV,lazy:!0}],[cW,{useClass:cH,lazy:!0}]],t),n=e?e.createChild(r):new n1(r);return ih(n,[[cw],[he]]),n}(t,null==e?void 0:e.override),{theme:n,locale:i,locales:s,logLevel:a}=e;n&&this._injector.get(hr).setTheme(n),s&&this._injector.get(ck).load(s),i&&this._injector.get(ck).setLocale(i),a&&this._injector.get(iP).setLogLevel(a),this._init(r)}get _univerInstanceService(){return this._injector.get(cu)}get _pluginService(){return this._injector.get(c5)}__getInjector(){return this._injector}dispose(){this._injector.dispose()}setLocale(e){this._injector.get(ck).setLocale(e)}createUnit(e,t){return this._univerInstanceService.createUnit(e,t)}createUniverSheet(e){return this._injector.get(iP).warn("[Univer]: Univer.createUniverSheet is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(oI.UNIVER_SHEET,e)}createUniverDoc(e){return this._injector.get(iP).warn("[Univer]: Univer.createUniverDoc is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(oI.UNIVER_DOC,e)}createUniverSlide(e){return this._injector.get(iP).warn("[Univer]: Univer.createUniverSlide is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(oI.UNIVER_SLIDE,e)}_init(e){this._univerInstanceService.registerCtorForType(oI.UNIVER_SHEET,u1),this._univerInstanceService.registerCtorForType(oI.UNIVER_DOC,uv),this._univerInstanceService.registerCtorForType(oI.UNIVER_SLIDE,u2);let t=e.get(cu);t.__setCreateHandler((r,n,i,s)=>{if(!this._startedTypes.has(r)){this._pluginService.startPluginForType(r),this._startedTypes.add(r);let a=e.createInstance(i,n);return t.__addUnit(a,s),this._tryProgressToReady(),a}let a=e.createInstance(i,n);return t.__addUnit(a,s),a})}_tryProgressToReady(){this._injector.get(cf).stage<ch.Ready&&(this._injector.get(cf).stage=ch.Ready)}registerPlugin(e,t){this._pluginService.registerPlugin(e,t)}}var hi=Object.defineProperty,hs=Object.getOwnPropertyDescriptor,ha=(e,t)=>(r,n)=>t(r,n,e);let ho=class extends iE{constructor(e,t){super(),this._injector=e,this._lifecycleService=t}onStarting(e){return iM(this._lifecycleService.lifecycle$.pipe((0,e1.filter)(e=>e===ch.Starting)).subscribe(e))}onReady(e){return iM(this._lifecycleService.lifecycle$.pipe((0,e1.filter)(e=>e===ch.Ready)).subscribe(e))}onRendered(e){return iM(this._lifecycleService.lifecycle$.pipe((0,e1.filter)(e=>e===ch.Rendered)).subscribe(e))}onSteady(e){return iM(this._lifecycleService.lifecycle$.pipe((0,e1.filter)(e=>e===ch.Steady)).subscribe(e))}onBeforeUndo(e){return this._injector.get(iH).beforeCommandExecuted(t=>{if(t.id===cI.id){let t=this._injector.get(cE).pitchTopUndoElement();t&&e(t)}})}onUndo(e){return this._injector.get(iH).onCommandExecuted(t=>{if(t.id===cI.id){let t=this._injector.get(cE).pitchTopUndoElement();t&&e(t)}})}onBeforeRedo(e){return this._injector.get(iH).beforeCommandExecuted(t=>{if(t.id===cA.id){let t=this._injector.get(cE).pitchTopRedoElement();t&&e(t)}})}onRedo(e){return this._injector.get(iH).onCommandExecuted(t=>{if(t.id===cA.id){let t=this._injector.get(cE).pitchTopRedoElement();t&&e(t)}})}};ho=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?hs(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&hi(t,r,s),s})([ha(0,nx(n1)),ha(1,nx(cf))],ho);var hl=Object.defineProperty,hu=Object.getOwnPropertyDescriptor,hc=(e,t)=>(r,n)=>t(r,n,e);let hh=class extends iE{constructor(e,t,r){super(),this._injector=e,this._commandService=t,this._univerInstanceService=r}static newAPI(e){return(e instanceof hn?e.__getInjector():e).createInstance(hh)}disposeUnit(e){return this._univerInstanceService.disposeUnit(e)}getCurrentLifecycleStage(){return this._injector.get(cf).stage}undo(){return this._commandService.executeCommand(cI.id)}redo(){return this._commandService.executeCommand(cA.id)}onBeforeCommandExecute(e){return this._commandService.beforeCommandExecuted((t,r)=>{e(t,r)})}onCommandExecuted(e){return this._commandService.onCommandExecuted((t,r)=>{e(t,r)})}executeCommand(e,t,r){return this._commandService.executeCommand(e,t,r)}syncExecuteCommand(e,t,r){return this._commandService.syncExecuteCommand(e,t,r)}getHooks(){return this._injector.createInstance(ho)}};function hd(e){return!!/^-?\d+(\.\d+)?$/.test(e)&&Number(e)<=Number.MAX_SAFE_INTEGER}hh=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?hu(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&hl(t,r,s),s})([hc(0,nx(n1)),hc(1,iH),hc(2,cu)],hh);class hm{constructor(){tr(this,"_data",[])}static create(){return new hm}add(e){this._data.indexOf(e)>-1||this._data.push(e)}delete(e){let t=this._data.indexOf(e);this._data.splice(t,1)}getData(){return this._data}}function hg(e){let t=new MessageChannel,r=!1;return t.port1.onmessage=()=>{r||e()},t.port2.postMessage(null),()=>{r=!0,t.port1.close(),t.port2.close()}}class hf{constructor(){tr(this,"skipNextObservers",!1),tr(this,"lastReturnValue"),tr(this,"isStopPropagation",!1)}stopPropagation(){this.isStopPropagation=!0}}class hp extends e9.Subject{constructor(){super(...arguments),tr(this,"_sortedObservers",[])}subscribe(){throw Error("[EventSubject]: please use `subscribeEvent` instead of `subscribe` method for `EventSubject`.")}next(){throw Error("[EventSubject]: please use `emitEvent` instead of `next` method for `EventSubject`.")}unsubscribe(){super.unsubscribe(),this._sortedObservers.length=0}complete(){super.complete(),this._sortedObservers.length=0}subscribeEvent(e){let t;t="function"==typeof e?{next:([t,r])=>e(t,r)}:e;let r=super.subscribe(t);return this._sortedObservers.push(t),this._sortedObservers.sort((e,t)=>{var r,n;return(null!=(r=e.priority)?r:0)-(null!=(n=t.priority)?n:0)}),r.add(()=>this._sortedObservers=this._sortedObservers.filter(e=>e!==t)),r}clearObservers(){this._sortedObservers.forEach(e=>{var t;return null==(t=e.complete)?void 0:t.call(e)}),this._sortedObservers.length=0}emitEvent(e){var t;if(!this.closed){let r=new hf;for(let n of(r.lastReturnValue=e,this._sortedObservers)){let i=null==(t=n.next)?void 0:t.call(n,[e,r]);if(r.lastReturnValue=i,r.skipNextObservers)return{handled:!0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}return{handled:this._sortedObservers.length>0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}throw Error("[EventSubject]: cannot emit event on a closed subject.")}}function hC(e){return new e3.Observable(t=>{let r=e.subscribeEvent(e=>{t.next(e)});return()=>r.unsubscribe()})}let h_=nA("ILocalStorageService");function hy(e){return!(0===e.length||e.length>31||e.startsWith("'")||e.endsWith("'")||/[:\\\/\?\*\[\]]/.test(e))}function hE(e){return new Promise(t=>setTimeout(t,e))}let hb=["script","style","meta","comment","link"];var hR=((eH=hR||{})[eH.INFO=0]="INFO",eH[eH.STOP=1]="STOP",eH[eH.WARNING=2]="WARNING",eH),hN=((eW=hN||{})[eW.DISABLED=0]="DISABLED",eW[eW.FULL_ALPHA=1]="FULL_ALPHA",eW[eW.FULL_HANGUL=2]="FULL_HANGUL",eW[eW.FULL_KATAKANA=3]="FULL_KATAKANA",eW[eW.HALF_ALPHA=4]="HALF_ALPHA",eW[eW.HALF_HANGUL=5]="HALF_HANGUL",eW[eW.HALF_KATAKANA=6]="HALF_KATAKANA",eW[eW.HIRAGANA=7]="HIRAGANA",eW[eW.NO_CONTROL=8]="NO_CONTROL",eW[eW.OFF=9]="OFF",eW[eW.ON=10]="ON",eW),hI=((eG=hI||{}).BETWEEN="between",eG.EQUAL="equal",eG.GREATER_THAN="greaterThan",eG.GREATER_THAN_OR_EQUAL="greaterThanOrEqual",eG.LESS_THAN="lessThan",eG.LESS_THAN_OR_EQUAL="lessThanOrEqual",eG.NOT_BETWEEN="notBetween",eG.NOT_EQUAL="notEqual",eG),hA=((eY=hA||{})[eY.TEXT=0]="TEXT",eY[eY.ARROW=1]="ARROW",eY[eY.CUSTOM=2]="CUSTOM",eY),hv=((ez=hv||{}).VALID="valid",ez.INVALID="invalid",ez.VALIDATING="validating",ez),hS=((eq=hS||{}).CUSTOM="custom",eq.LIST="list",eq.LIST_MULTIPLE="listMultiple",eq.NONE="none",eq.TEXT_LENGTH="textLength",eq.DATE="date",eq.TIME="time",eq.WHOLE="whole",eq.DECIMAL="decimal",eq.CHECKBOX="checkbox",eq.ANY="any",eq);let hT=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class hO{static from(e){if(!(e instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[t,r]=new Uint8Array(e,0,2);if(219!==t)throw Error("Data does not appear to be in a KDBush format.");let n=r>>4;if(1!==n)throw Error(`Got v${n} data when expected v1.`);let i=hT[15&r];if(!i)throw Error("Unrecognized array type.");let[s]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new hO(a,s,i,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let i=hT.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(i<0)throw Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){let r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,n,i,s,a){if(s-i<=n)return;let o=i+s>>1;(function e(t,r,n,i,s,a){for(;s>i;){if(s-i>600){let o=s-i+1,l=n-i+1,u=Math.log(o),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(o-c)/o)*(l-o/2<0?-1:1),d=Math.max(i,Math.floor(n-l*c/o+h)),m=Math.min(s,Math.floor(n+(o-l)*c/o+h));e(t,r,n,d,m,a)}let o=r[2*n+a],l=i,u=s;for(hM(t,r,i,n),r[2*s+a]>o&&hM(t,r,i,s);l<u;){for(hM(t,r,l,u),l++,u--;r[2*l+a]<o;)l++;for(;r[2*u+a]>o;)u--}r[2*i+a]===o?hM(t,r,i,u):hM(t,r,++u,s),u<=n&&(i=u+1),n<=u&&(s=u-1)}})(t,r,o,i,s,a),e(t,r,n,i,o-1,1-a),e(t,r,n,o+1,s,1-a)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:i,coords:s,nodeSize:a}=this,o=[0,i.length-1,0],l=[];for(;o.length;){let u=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=a){for(let a=h;a<=c;a++){let o=s[2*a],u=s[2*a+1];o>=e&&o<=r&&u>=t&&u<=n&&l.push(i[a])}continue}let d=h+c>>1,m=s[2*d],g=s[2*d+1];m>=e&&m<=r&&g>=t&&g<=n&&l.push(i[d]),(0===u?e<=m:t<=g)&&(o.push(h),o.push(d-1),o.push(1-u)),(0===u?r>=m:n>=g)&&(o.push(d+1),o.push(c),o.push(1-u))}return l}within(e,t,r){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:n,coords:i,nodeSize:s}=this,a=[0,n.length-1,0],o=[],l=r*r;for(;a.length;){let u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=s){for(let r=h;r<=c;r++)hx(i[2*r],i[2*r+1],e,t)<=l&&o.push(n[r]);continue}let d=h+c>>1,m=i[2*d],g=i[2*d+1];hx(m,g,e,t)<=l&&o.push(n[d]),(0===u?e-r<=m:t-r<=g)&&(a.push(h),a.push(d-1),a.push(1-u)),(0===u?e+r>=m:t+r>=g)&&(a.push(d+1),a.push(c),a.push(1-u))}return o}}function hM(e,t,r,n){hw(e,r,n),hw(t,2*r,2*n),hw(t,2*r+1,2*n+1)}function hw(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function hx(e,t,r,n){let i=e-r,s=t-n;return i*i+s*s}function hU(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}class hD{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,r=[];if(!hH(e,t))return r;let n=this.toBBox,i=[];for(;t;){for(let s=0;s<t.children.length;s++){let a=t.children[s],o=t.leaf?n(a):a;hH(e,o)&&(t.leaf?r.push(a):h$(e,o)?this._all(a,r):i.push(a))}t=i.pop()}return r}collides(e){let t=this.data;if(!hH(e,t))return!1;let r=[];for(;t;){for(let n=0;n<t.children.length;n++){let i=t.children[n],s=t.leaf?this.toBBox(i):i;if(hH(e,s)){if(t.leaf||h$(e,s))return!0;r.push(i)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length){if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=hW([]),this}remove(e,t){let r,n,i;if(!e)return this;let s=this.data,a=this.toBBox(e),o=[],l=[];for(;s||o.length;){if(s||(s=o.pop(),n=o[o.length-1],r=l.pop(),i=!0),s.leaf){let r=function(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return -1}(e,s.children,t);if(-1!==r)return s.children.splice(r,1),o.push(s),this._condense(o),this}!i&&!s.leaf&&h$(s,a)?(o.push(s),l.push(r),r=0,n=s,s=s.children[0]):n?(r++,s=n.children[r],i=!1):s=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){let i=r-t+1,s=this._maxEntries,a;if(i<=s)return hV(a=hW(e.slice(t,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),(a=hW([])).leaf=!1,a.height=n;let o=Math.ceil(i/s),l=o*Math.ceil(Math.sqrt(s));hG(e,t,r,l,this.compareMinX);for(let i=t;i<=r;i+=l){let t=Math.min(i+l-1,r);hG(e,i,t,o,this.compareMinY);for(let r=i;r<=t;r+=o){let i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return hV(a,this.toBBox),a}_chooseSubtree(e,t,r,n){for(;n.push(t),!(t.leaf||n.length-1===r);){let r=1/0,n=1/0,i;for(let s=0;s<t.children.length;s++){let a=t.children[s],o=hk(a),l=(Math.max(a.maxX,e.maxX)-Math.min(a.minX,e.minX))*(Math.max(a.maxY,e.maxY)-Math.min(a.minY,e.minY))-o;l<n?(n=l,r=o<r?o:r,i=a):l===n&&o<r&&(r=o,i=a)}t=i||t.children[0]}return t}_insert(e,t,r){let n=r?e:this.toBBox(e),i=[],s=this._chooseSubtree(n,this.data,t,i);for(s.children.push(e),hP(s,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(e,t){let r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);let s=this._chooseSplitIndex(r,i,n),a=hW(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,hV(r,this.toBBox),hV(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=hW([e,t]),this.data.height=e.height+1,this.data.leaf=!1,hV(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,i=1/0,s=1/0;for(let a=t;a<=r-t;a++){let t=hL(e,0,a,this.toBBox),o=hL(e,a,r,this.toBBox),l=function(e,t){let r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-r)*Math.max(0,Math.min(e.maxY,t.maxY)-n)}(t,o),u=hk(t)+hk(o);l<i?(i=l,n=a,s=u<s?u:s):l===i&&u<s&&(s=u,n=a)}return n||r-t}_chooseSplitAxis(e,t,r){let n=e.leaf?this.compareMinX:hj,i=e.leaf?this.compareMinY:hF;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);let i=this.toBBox,s=hL(e,0,t,i),a=hL(e,r-t,r,i),o=hB(s)+hB(a);for(let n=t;n<r-t;n++){let t=e.children[n];hP(s,e.leaf?i(t):t),o+=hB(s)}for(let n=r-t-1;n>=t;n--){let t=e.children[n];hP(a,e.leaf?i(t):t),o+=hB(a)}return o}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)hP(t[n],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():hV(e[t],this.toBBox)}}function hV(e,t){hL(e,0,e.children.length,t,e)}function hL(e,t,r,n,i){i||(i=hW(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<r;s++){let t=e.children[s];hP(i,e.leaf?n(t):t)}return i}function hP(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function hj(e,t){return e.minX-t.minX}function hF(e,t){return e.minY-t.minY}function hk(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function hB(e){return e.maxX-e.minX+(e.maxY-e.minY)}function h$(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function hH(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function hW(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hG(e,t,r,n,i){let s=[t,r];for(;s.length;){if((r=s.pop())-(t=s.pop())<=n)continue;let a=t+Math.ceil((r-t)/n/2)*n;(function e(t,r,n=0,i=t.length-1,s=function(e,t){return e<t?-1:e>t?1:0}){for(;i>n;){if(i-n>600){let a=i-n+1,o=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(o-a/2<0?-1:1),h=Math.max(n,Math.floor(r-o*u/a+c)),d=Math.min(i,Math.floor(r+(a-o)*u/a+c));e(t,r,h,d,s)}let a=t[r],o=n,l=i;for(hU(t,n,r),s(t[i],a)>0&&hU(t,n,i);o<l;){for(hU(t,o,l),o++,l--;0>s(t[o],a);)o++;for(;s(t[l],a)>0;)l--}0===s(t[n],a)?hU(t,n,l):hU(t,++l,i),l<=r&&(n=l+1),r<=l&&(i=l-1)}})(e,a,t,r,i),s.push(t,a,a,r)}}class hY{constructor(e=!1){tr(this,"_tree",/* @__PURE__ */new Map),tr(this,"_oneCellCache",/* @__PURE__ */new Map),tr(this,"_kdTree",/* @__PURE__ */new Map),this._enableOneCellCache=e}dispose(){this.clear()}getTree(e,t){return this._tree.has(e)||this._tree.set(e,/* @__PURE__ */new Map),this._tree.get(e).has(t)||this._tree.get(e).set(t,new hD),this._tree.get(e).get(t)}_getOneCellCache(e,t,r,n){return this._oneCellCache.has(e)||this._oneCellCache.set(e,/* @__PURE__ */new Map),this._oneCellCache.get(e).has(t)||this._oneCellCache.get(e).set(t,/* @__PURE__ */new Map),this._oneCellCache.get(e).get(t).has(r)||this._oneCellCache.get(e).get(t).set(r,/* @__PURE__ */new Map),this._oneCellCache.get(e).get(t).get(r).has(n)||this._oneCellCache.get(e).get(t).get(r).set(n,/* @__PURE__ */new Set),this._oneCellCache.get(e).get(t).get(r).get(n)}_removeOneCellCache(e,t,r,n,i){let s=this._oneCellCache.get(e);if(!s)return;let a=s.get(t);if(!a)return;let o=a.get(r);if(!o)return;let l=o.get(n);l&&l.delete(i)}_removeCellCacheByRange(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this._oneCellCache.get(t);if(!s)return;let a=s.get(r);if(!a)return;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=n;for(let e=o;e<=u;e++){let t=a.get(e);if(t)for(let e=l;e<=c;e++){let r=t.get(e);r&&r.delete(i)}}}_insertOneCellCache(e,t,r,n,i){this._getOneCellCache(e,t,r,n).add(i)}_getRdTreeItems(e){let t=[];for(let[r,n]of e)for(let[e,i]of n)t.push({x:e,y:r,ids:i});return t}_searchByOneCellCache(e){var t;let{unitId:r,sheetId:n,range:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=i,u=null==(t=this._kdTree.get(r))?void 0:t.get(n);if(!u)return[];let{tree:c,items:h}=u,d=c.range(a,s,l,o),m=[];for(let e of d){let t=h[e];m.push(...Array.from(t.ids))}return m}openKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of(this._kdTree.has(t)||this._kdTree.set(t,/* @__PURE__ */new Map),r)){let r=this._getRdTreeItems(i),s=new hO(r.length);for(let i of(null==(e=this._kdTree.get(t))||e.set(n,{tree:s,items:r}),r))s.add(i.x,i.y);s.finish()}}closeKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of r)null==(e=this._kdTree.get(t))||e.set(n,void 0)}insert(e){let{unitId:t,sheetId:r,range:n,id:i}=e;if(!t||0===t.length)return;let{startRow:s,endRow:a,startColumn:o,endColumn:l}=n;if(this._enableOneCellCache&&s===a&&o===l){this._insertOneCellCache(t,r,s,o,i);return}let u=this.getTree(t,r);Number.isNaN(s)&&(s=0),Number.isNaN(o)&&(o=0),Number.isNaN(a)&&(a=Number.POSITIVE_INFINITY),Number.isNaN(l)&&(l=Number.POSITIVE_INFINITY),u.insert({minX:o,minY:s,maxX:l,maxY:a,id:i})}bulkInsert(e){for(let t of e)this.insert(t)}*searchGenerator(e){var t;let{unitId:r,sheetId:n,range:i}=e;if(this._enableOneCellCache)for(let t of this._searchByOneCellCache(e))yield t;let s=null==(t=this._tree.get(r))?void 0:t.get(n);if(s)for(let e of s.search({minX:i.startColumn,minY:i.startRow,maxX:i.endColumn,maxY:i.endRow}))yield e.id}bulkSearch(e,t){let r=/* @__PURE__ */new Set;for(let n of e)for(let e of this.searchGenerator(n))(null==t?void 0:t.has(e))!==!0&&r.add(e);return r}removeById(e,t){var r,n;t?(null==(r=this._tree.get(e))||r.delete(t),null==(n=this._oneCellCache.get(e))||n.delete(t)):(this._tree.delete(e),this._oneCellCache.delete(e))}_removeRTreeItem(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this.getTree(t,r),a=s.search({minX:n.startColumn,minY:n.startRow,maxX:n.endColumn,maxY:n.endRow});for(let e=0;e<a.length;e++)a[e].id===i&&s.remove(a[e])}remove(e){let{unitId:t,sheetId:r,range:n,id:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=n;this._enableOneCellCache?s===o&&a===l?this._removeOneCellCache(t,r,n.startRow,n.startColumn,i):(this._removeCellCacheByRange(e),this._removeRTreeItem(e)):this._removeRTreeItem(e)}bulkRemove(e){for(let t of e)this.remove(t)}clear(){this._tree.clear(),this._oneCellCache.clear()}toJSON(){let e={};return this._tree.forEach((t,r)=>{e[r]={},t.forEach((t,n)=>{e[r][n]=t.toJSON()})}),e}fromJSON(e){for(let t in this._tree.clear(),e)for(let r in this._tree.set(t,/* @__PURE__ */new Map),e[t]){let n=new hD;n.fromJSON(e[t][r]),this._tree.get(t).set(r,n)}}}"function"!=typeof tn.requestIdleCallback&&(tn.requestIdleCallback=function(e){let t=Date.now();return setTimeout(function(){let r=Math.max(0,50-(Date.now()-t));e({didTimeout:0===r,timeRemaining:()=>r})},1)}),"function"!=typeof tn.cancelIdleCallback&&(tn.cancelIdleCallback=function(e){clearTimeout(e)})}),s("5LPkb",function(t,r){e(t.exports,"BehaviorSubject",function(){return s});var n=i("1a7ft"),s=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return(0,n.__extends)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r.closed||t.next(this._value),r},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i("1mjSk").Subject)}),s("1a7ft",function(t,r){e(t.exports,"__extends",function(){return i}),e(t.exports,"__awaiter",function(){return s}),e(t.exports,"__generator",function(){return a}),e(t.exports,"__values",function(){return o}),e(t.exports,"__read",function(){return l}),e(t.exports,"__spreadArray",function(){return u}),e(t.exports,"__await",function(){return c}),e(t.exports,"__asyncGenerator",function(){return h}),e(t.exports,"__asyncValues",function(){return d});/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var n=function(e,t){return(n=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function i(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function s(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})}function a(e,t){var r,n,i,s,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function o(s){return function(o){return function(s){if(r)throw TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&s[0]?n.return:s[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,s[1])).done)return i;switch(n=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){a=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){a.label=s[1];break}if(6===s[0]&&a.label<i[1]){a.label=i[1],i=s;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(s);break}i[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,o])}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a}function u(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||t)}function c(e){return this instanceof c?(this.v=e,this):new c(e)}function h(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(e){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{var r;(r=i[e](t)).value instanceof c?Promise.resolve(r.value.v).then(l,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function h(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function d(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=o(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){(function(e,t,r,n){Promise.resolve(n).then(function(t){e({value:t,done:r})},t)})(n,i,(t=e[r](t)).done,t.value)})}}}}),s("1mjSk",function(t,r){e(t.exports,"Subject",function(){return c});var n=i("1a7ft"),s=i("1O3Nt"),a=i("e1VZ5"),o=i("c6P6i"),l=i("hFN8R"),u=i("dIjnd"),c=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,n.__extends)(t,e),t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new o.ObjectUnsubscribedError},t.prototype.next=function(e){var t=this;(0,u.errorContext)(function(){var r,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var s=(0,n.__values)(t.currentObservers),a=s.next();!a.done;a=s.next())a.value.next(e)}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}}})},t.prototype.error=function(e){var t=this;(0,u.errorContext)(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;(0,u.errorContext)(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null===(e=this.observers)||void 0===e?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?a.EMPTY_SUBSCRIPTION:(this.currentObservers=null,i.push(e),new a.Subscription(function(){t.currentObservers=null,(0,l.arrRemove)(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},t.prototype.asObservable=function(){var e=new s.Observable;return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(s.Observable),h=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return(0,n.__extends)(t,e),t.prototype.next=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===r||r.call(t,e)},t.prototype.error=function(e){var t,r;null===(r=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===r||r.call(t,e)},t.prototype.complete=function(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!==(r=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==r?r:a.EMPTY_SUBSCRIPTION},t}(c)}),s("1O3Nt",function(t,r){e(t.exports,"Observable",function(){return h});var n=i("lftZl"),s=i("e1VZ5"),a=i("eDMxo"),o=i("1hKfX"),l=i("laEi0"),u=i("3IQI0"),c=i("dIjnd"),h=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,r){var i,a=this,o=(i=e)&&i instanceof n.Subscriber||i&&(0,u.isFunction)(i.next)&&(0,u.isFunction)(i.error)&&(0,u.isFunction)(i.complete)&&(0,s.isSubscription)(i)?e:new n.SafeSubscriber(e,t,r);return(0,c.errorContext)(function(){var e=a.operator,t=a.source;o.add(e?e.call(o,t):t?a._subscribe(o):a._trySubscribe(o))}),o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var r=this;return new(t=d(t))(function(t,i){var s=new n.SafeSubscriber({next:function(t){try{e(t)}catch(e){i(e),s.unsubscribe()}},error:i,complete:t});r.subscribe(s)})},e.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},e.prototype[a.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,o.pipeFromArray)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=d(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function d(e){var t;return null!==(t=null!=e?e:l.config.Promise)&&void 0!==t?t:Promise}}),s("lftZl",function(t,r){e(t.exports,"Subscriber",function(){return m}),e(t.exports,"SafeSubscriber",function(){return C});var n=i("1a7ft"),s=i("3IQI0"),a=i("e1VZ5"),o=i("laEi0"),l=i("ghA1h"),u=i("f1euv"),c=i("6x7Ga"),h=i("caYEJ"),d=i("dIjnd"),m=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,(0,a.isSubscription)(t)&&t.add(r)):r.destination=E,r}return(0,n.__extends)(t,e),t.create=function(e,t,r){return new C(e,t,r)},t.prototype.next=function(e){this.isStopped?y((0,c.nextNotification)(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?y((0,c.errorNotification)(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?y(c.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(a.Subscription),g=Function.prototype.bind;function f(e,t){return g.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){_(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){_(e)}else _(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){_(e)}},e}(),C=function(e){function t(t,r,n){var i,a,l=e.call(this)||this;return(0,s.isFunction)(t)||!t?i={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=n?n:void 0}:l&&o.config.useDeprecatedNextContext?((a=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},i={next:t.next&&f(t.next,a),error:t.error&&f(t.error,a),complete:t.complete&&f(t.complete,a)}):i=t,l.destination=new p(i),l}return(0,n.__extends)(t,e),t}(m);function _(e){o.config.useDeprecatedSynchronousErrorHandling?(0,d.captureError)(e):(0,l.reportUnhandledError)(e)}function y(e,t){var r=o.config.onStoppedNotification;r&&(0,h.timeoutProvider).setTimeout(function(){return r(e,t)})}var E={closed:!0,next:u.noop,error:function(e){throw e},complete:u.noop}}),s("3IQI0",function(t,r){e(t.exports,"isFunction",function(){return n});function n(e){return"function"==typeof e}}),s("e1VZ5",function(t,r){e(t.exports,"Subscription",function(){return l}),e(t.exports,"EMPTY_SUBSCRIPTION",function(){return u}),e(t.exports,"isSubscription",function(){return c});var n=i("1a7ft"),s=i("3IQI0"),a=i("iftTV"),o=i("hFN8R"),l=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,r,i,o,l=this._parentage;if(l){if(this._parentage=null,Array.isArray(l))try{for(var u=(0,n.__values)(l),c=u.next();!c.done;c=u.next())c.value.remove(this)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else l.remove(this)}var d=this.initialTeardown;if((0,s.isFunction)(d))try{d()}catch(e){o=e instanceof a.UnsubscriptionError?e.errors:[e]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var g=(0,n.__values)(m),f=g.next();!f.done;f=g.next()){var p=f.value;try{h(p)}catch(e){o=null!=o?o:[],e instanceof a.UnsubscriptionError?o=(0,n.__spreadArray)((0,n.__spreadArray)([],(0,n.__read)(o)),(0,n.__read)(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{f&&!f.done&&(i=g.return)&&i.call(g)}finally{if(r)throw r.error}}}if(o)throw new a.UnsubscriptionError(o)}},t.prototype.add=function(e){var r;if(e&&e!==this){if(this.closed)h(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(r=this._finalizers)&&void 0!==r?r:[]).push(e)}}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&(0,o.arrRemove)(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&(0,o.arrRemove)(r,e),e instanceof t&&e._removeParent(this)},t.EMPTY=((e=new t).closed=!0,e),t}(),u=l.EMPTY;function c(e){return e instanceof l||e&&"closed"in e&&(0,s.isFunction)(e.remove)&&(0,s.isFunction)(e.add)&&(0,s.isFunction)(e.unsubscribe)}function h(e){(0,s.isFunction)(e)?e():e.unsubscribe()}}),s("iftTV",function(t,r){e(t.exports,"UnsubscriptionError",function(){return n});var n=(0,i("bfFMS").createErrorClass)(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}})}),s("bfFMS",function(t,r){e(t.exports,"createErrorClass",function(){return n});function n(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}}),s("hFN8R",function(t,r){e(t.exports,"arrRemove",function(){return n});function n(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}}),s("laEi0",function(t,r){e(t.exports,"config",function(){return n});var n={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}}),s("ghA1h",function(t,r){e(t.exports,"reportUnhandledError",function(){return a});var n=i("laEi0"),s=i("caYEJ");function a(e){(0,s.timeoutProvider).setTimeout(function(){var t=n.config.onUnhandledError;if(t)t(e);else throw e})}}),s("caYEJ",function(t,r){e(t.exports,"timeoutProvider",function(){return s});var n=i("1a7ft"),s={setTimeout:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=s.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,n.__spreadArray)([e,t],(0,n.__read)(r))):setTimeout.apply(void 0,(0,n.__spreadArray)([e,t],(0,n.__read)(r)))},clearTimeout:function(e){var t=s.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}}),s("f1euv",function(t,r){e(t.exports,"noop",function(){return n});function n(){}}),s("6x7Ga",function(t,r){e(t.exports,"COMPLETE_NOTIFICATION",function(){return n}),e(t.exports,"errorNotification",function(){return i}),e(t.exports,"nextNotification",function(){return s});var n=a("C",void 0,void 0);function i(e){return a("E",void 0,e)}function s(e){return a("N",e,void 0)}function a(e,t,r){return{kind:e,value:t,error:r}}}),s("dIjnd",function(t,r){e(t.exports,"errorContext",function(){return a}),e(t.exports,"captureError",function(){return o});var n=i("laEi0"),s=null;function a(e){if(n.config.useDeprecatedSynchronousErrorHandling){var t=!s;if(t&&(s={errorThrown:!1,error:null}),e(),t){var r=s,i=r.errorThrown,a=r.error;if(s=null,i)throw a}}else e()}function o(e){n.config.useDeprecatedSynchronousErrorHandling&&s&&(s.errorThrown=!0,s.error=e)}}),s("eDMxo",function(t,r){e(t.exports,"observable",function(){return n});var n="function"==typeof Symbol&&Symbol.observable||"@@observable"}),s("1hKfX",function(t,r){e(t.exports,"pipe",function(){return s}),e(t.exports,"pipeFromArray",function(){return a});var n=i("2N6l4");function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return a(e)}function a(e){return 0===e.length?n.identity:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}}),s("2N6l4",function(t,r){e(t.exports,"identity",function(){return n});function n(e){return e}}),s("c6P6i",function(t,r){e(t.exports,"ObjectUnsubscribedError",function(){return n});var n=(0,i("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})}),s("5K4WI",function(t,r){e(t.exports,"combineLatest",function(){return m}),e(t.exports,"combineLatestInit",function(){return g});var n=i("1O3Nt"),s=i("6obID"),a=i("fz1T5"),o=i("2N6l4"),l=i("h319C"),u=i("4xvfD"),c=i("TccoZ"),h=i("iNetn"),d=i("99A8K");function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,u.popScheduler)(e),i=(0,u.popResultSelector)(e),h=(0,s.argsArgArrayOrObject)(e),d=h.args,m=h.keys;if(0===d.length)return(0,a.from)([],r);var f=new n.Observable(g(d,r,m?function(e){return(0,c.createObject)(m,e)}:o.identity));return i?f.pipe((0,l.mapOneOrManyArgs)(i)):f}function g(e,t,r){return void 0===r&&(r=o.identity),function(n){f(t,function(){for(var i=e.length,s=Array(i),o=i,l=i,u=function(i){f(t,function(){var u=(0,a.from)(e[i],t),c=!1;u.subscribe((0,h.createOperatorSubscriber)(n,function(e){s[i]=e,!c&&(c=!0,l--),l||n.next(r(s.slice()))},function(){--o||n.complete()}))},n)},c=0;c<i;c++)u(c)},n)}}function f(e,t,r){e?(0,d.executeSchedule)(r,e,t):t()}}),s("6obID",function(t,r){e(t.exports,"argsArgArrayOrObject",function(){return o});var n=Array.isArray,i=Object.getPrototypeOf,s=Object.prototype,a=Object.keys;function o(e){if(1===e.length){var t=e[0];if(n(t))return{args:t,keys:null};if(t&&"object"==typeof t&&i(t)===s){var r=a(t);return{args:r.map(function(e){return t[e]}),keys:r}}}return{args:e,keys:null}}}),s("fz1T5",function(t,r){e(t.exports,"from",function(){return a});var n=i("3ESKv"),s=i("b7gpN");function a(e,t){return t?(0,n.scheduled)(e,t):(0,s.innerFrom)(e)}}),s("3ESKv",function(t,r){e(t.exports,"scheduled",function(){return C});var n=i("HWDtl"),s=i("kx7NJ"),a=i("61w6q"),o=i("3kNl0"),l=i("1jutQ"),u=i("5BIEa"),c=i("jWdZ8"),h=i("bLVFn"),d=i("6woc9"),m=i("aewtS"),g=i("729in"),f=i("fdiCB"),p=i("dvjJq");function C(e,t){if(null!=e){if((0,u.isInteropObservable)(e))return(0,n.scheduleObservable)(e,t);if((0,h.isArrayLike)(e))return(0,a.scheduleArray)(e,t);if((0,c.isPromise)(e))return(0,s.schedulePromise)(e,t);if((0,m.isAsyncIterable)(e))return(0,l.scheduleAsyncIterable)(e,t);if((0,d.isIterable)(e))return(0,o.scheduleIterable)(e,t);if((0,f.isReadableStreamLike)(e))return(0,p.scheduleReadableStreamLike)(e,t)}throw(0,g.createInvalidObservableTypeError)(e)}}),s("HWDtl",function(t,r){e(t.exports,"scheduleObservable",function(){return o});var n=i("b7gpN"),s=i("jHEit"),a=i("bQ23s");function o(e,t){return(0,n.innerFrom)(e).pipe((0,a.subscribeOn)(t),(0,s.observeOn)(t))}}),s("b7gpN",function(t,r){e(t.exports,"innerFrom",function(){return p});var n=i("1a7ft"),s=i("bLVFn"),a=i("jWdZ8"),o=i("1O3Nt"),l=i("5BIEa"),u=i("aewtS"),c=i("729in"),h=i("6woc9"),d=i("fdiCB"),m=i("3IQI0"),g=i("ghA1h"),f=i("eDMxo");function p(e){if(e instanceof o.Observable)return e;if(null!=e){if((0,l.isInteropObservable)(e))return new o.Observable(function(t){var r=e[0,f.observable]();if((0,m.isFunction)(r.subscribe))return r.subscribe(t);throw TypeError("Provided object does not correctly implement Symbol.observable")});if((0,s.isArrayLike)(e))return new o.Observable(function(t){for(var r=0;r<e.length&&!t.closed;r++)t.next(e[r]);t.complete()});if((0,a.isPromise)(e))return new o.Observable(function(t){e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,g.reportUnhandledError)});if((0,u.isAsyncIterable)(e))return C(e);if((0,h.isIterable)(e))return new o.Observable(function(t){var r,i;try{for(var s=(0,n.__values)(e),a=s.next();!a.done;a=s.next()){var o=a.value;if(t.next(o),t.closed)return}}catch(e){r={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(r)throw r.error}}t.complete()});if((0,d.isReadableStreamLike)(e))return C((0,d.readableStreamLikeToAsyncGenerator)(e))}throw(0,c.createInvalidObservableTypeError)(e)}function C(e){return new o.Observable(function(t){(function(e,t){var r,i,s,a;return(0,n.__awaiter)(this,void 0,void 0,function(){var o;return(0,n.__generator)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),r=(0,n.__asyncValues)(e),l.label=1;case 1:return[4,r.next()];case 2:if((i=l.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s={error:l.sent()},[3,11];case 6:if(l.trys.push([6,,9,10]),!(i&&!i.done&&(a=r.return)))return[3,8];return[4,a.call(r)];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}}),s("bLVFn",function(t,r){e(t.exports,"isArrayLike",function(){return n});var n=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}}),s("jWdZ8",function(t,r){e(t.exports,"isPromise",function(){return s});var n=i("3IQI0");function s(e){return(0,n.isFunction)(null==e?void 0:e.then)}}),s("5BIEa",function(t,r){e(t.exports,"isInteropObservable",function(){return a});var n=i("eDMxo"),s=i("3IQI0");function a(e){return(0,s.isFunction)(e[n.observable])}}),s("aewtS",function(t,r){e(t.exports,"isAsyncIterable",function(){return s});var n=i("3IQI0");function s(e){return Symbol.asyncIterator&&(0,n.isFunction)(null==e?void 0:e[Symbol.asyncIterator])}}),s("729in",function(t,r){e(t.exports,"createInvalidObservableTypeError",function(){return n});function n(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}}),s("6woc9",function(t,r){e(t.exports,"isIterable",function(){return a});var n=i("kZq5V"),s=i("3IQI0");function a(e){return(0,s.isFunction)(null==e?void 0:e[n.iterator])}}),s("kZq5V",function(t,r){e(t.exports,"iterator",function(){return n});var n="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}),s("fdiCB",function(t,r){e(t.exports,"readableStreamLikeToAsyncGenerator",function(){return a}),e(t.exports,"isReadableStreamLike",function(){return o});var n=i("1a7ft"),s=i("3IQI0");function a(e){return(0,n.__asyncGenerator)(this,arguments,function(){var t,r,i;return(0,n.__generator)(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,(0,n.__await)(t.read())];case 3:if(i=(r=s.sent()).value,!r.done)return[3,5];return[4,(0,n.__await)(void 0)];case 4:return[2,s.sent()];case 5:return[4,(0,n.__await)(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function o(e){return(0,s.isFunction)(null==e?void 0:e.getReader)}}),s("jHEit",function(t,r){e(t.exports,"observeOn",function(){return o});var n=i("99A8K"),s=i("jSzwf"),a=i("iNetn");function o(e,t){return void 0===t&&(t=0),(0,s.operate)(function(r,i){r.subscribe((0,a.createOperatorSubscriber)(i,function(r){return(0,n.executeSchedule)(i,e,function(){return i.next(r)},t)},function(){return(0,n.executeSchedule)(i,e,function(){return i.complete()},t)},function(r){return(0,n.executeSchedule)(i,e,function(){return i.error(r)},t)}))})}}),s("99A8K",function(t,r){e(t.exports,"executeSchedule",function(){return n});function n(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}}),s("jSzwf",function(t,r){e(t.exports,"operate",function(){return s});var n=i("3IQI0");function s(e){return function(t){if((0,n.isFunction)(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}}),s("iNetn",function(t,r){e(t.exports,"createOperatorSubscriber",function(){return s});var n=i("1a7ft");function s(e,t,r,n,i){return new a(e,t,r,n,i)}var a=function(e){function t(t,r,n,i,s,a){var o=e.call(this,t)||this;return o.onFinalize=s,o.shouldUnsubscribe=a,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return(0,n.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),r||null===(t=this.onFinalize)||void 0===t||t.call(this)}},t}(i("lftZl").Subscriber)}),s("bQ23s",function(t,r){e(t.exports,"subscribeOn",function(){return s});var n=i("jSzwf");function s(e,t){return void 0===t&&(t=0),(0,n.operate)(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}}),s("kx7NJ",function(t,r){e(t.exports,"schedulePromise",function(){return o});var n=i("b7gpN"),s=i("jHEit"),a=i("bQ23s");function o(e,t){return(0,n.innerFrom)(e).pipe((0,a.subscribeOn)(t),(0,s.observeOn)(t))}}),s("61w6q",function(t,r){e(t.exports,"scheduleArray",function(){return s});var n=i("1O3Nt");function s(e,t){return new n.Observable(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}}),s("3kNl0",function(t,r){e(t.exports,"scheduleIterable",function(){return l});var n=i("1O3Nt"),s=i("kZq5V"),a=i("3IQI0"),o=i("99A8K");function l(e,t){return new n.Observable(function(r){var n;return(0,o.executeSchedule)(r,t,function(){n=e[0,s.iterator](),(0,o.executeSchedule)(r,t,function(){var e,t,i;try{t=(e=n.next()).value,i=e.done}catch(e){r.error(e);return}i?r.complete():r.next(t)},0,!0)}),function(){return(0,a.isFunction)(null==n?void 0:n.return)&&n.return()}})}}),s("1jutQ",function(t,r){e(t.exports,"scheduleAsyncIterable",function(){return a});var n=i("1O3Nt"),s=i("99A8K");function a(e,t){if(!e)throw Error("Iterable cannot be null");return new n.Observable(function(r){(0,s.executeSchedule)(r,t,function(){var n=e[Symbol.asyncIterator]();(0,s.executeSchedule)(r,t,function(){n.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}}),s("dvjJq",function(t,r){e(t.exports,"scheduleReadableStreamLike",function(){return a});var n=i("1jutQ"),s=i("fdiCB");function a(e,t){return(0,n.scheduleAsyncIterable)((0,s.readableStreamLikeToAsyncGenerator)(e),t)}}),s("h319C",function(t,r){e(t.exports,"mapOneOrManyArgs",function(){return o});var n=i("1a7ft"),s=i("hciHF"),a=Array.isArray;function o(e){return(0,s.map)(function(t){return a(t)?e.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(t))):e(t)})}}),s("hciHF",function(t,r){e(t.exports,"map",function(){return a});var n=i("jSzwf"),s=i("iNetn");function a(e,t){return(0,n.operate)(function(r,n){var i=0;r.subscribe((0,s.createOperatorSubscriber)(n,function(r){n.next(e.call(t,r,i++))}))})}}),s("4xvfD",function(t,r){e(t.exports,"popResultSelector",function(){return o}),e(t.exports,"popScheduler",function(){return l}),e(t.exports,"popNumber",function(){return u});var n=i("3IQI0"),s=i("4tjBj");function a(e){return e[e.length-1]}function o(e){return(0,n.isFunction)(a(e))?e.pop():void 0}function l(e){return(0,s.isScheduler)(a(e))?e.pop():void 0}function u(e,t){return"number"==typeof a(e)?e.pop():t}}),s("4tjBj",function(t,r){e(t.exports,"isScheduler",function(){return s});var n=i("3IQI0");function s(e){return e&&(0,n.isFunction)(e.schedule)}}),s("TccoZ",function(t,r){e(t.exports,"createObject",function(){return n});function n(e,t){return e.reduce(function(e,r,n){return e[r]=t[n],e},{})}}),s("bXJOC",function(t,r){e(t.exports,"debounceTime",function(){return o});var n=i("jaZjQ"),s=i("jSzwf"),a=i("iNetn");function o(e,t){return void 0===t&&(t=n.asyncScheduler),(0,s.operate)(function(r,n){var i=null,s=null,o=null,l=function(){if(i){i.unsubscribe(),i=null;var e=s;s=null,n.next(e)}};function u(){var r=o+e,s=t.now();if(s<r){i=this.schedule(void 0,r-s),n.add(i);return}l()}r.subscribe((0,a.createOperatorSubscriber)(n,function(r){s=r,o=t.now(),i||(i=t.schedule(u,e),n.add(i))},function(){l(),n.complete()},void 0,function(){s=i=null}))})}}),s("jaZjQ",function(t,r){e(t.exports,"asyncScheduler",function(){return s}),e(t.exports,"async",function(){return a});var n=i("aTfYm"),s=new(i("7GTYN")).AsyncScheduler(n.AsyncAction),a=s}),s("aTfYm",function(t,r){e(t.exports,"AsyncAction",function(){return l});var n=i("1a7ft"),s=i("iSRzt"),a=i("ic7D4"),o=i("hFN8R"),l=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return(0,n.__extends)(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r,n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!==(r=this.id)&&void 0!==r?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),(0,a.intervalProvider).setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&(0,a.intervalProvider).clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,(0,o.arrRemove)(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(s.Action)}),s("iSRzt",function(t,r){e(t.exports,"Action",function(){return s});var n=i("1a7ft"),s=function(e){function t(t,r){return e.call(this)||this}return(0,n.__extends)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(i("e1VZ5").Subscription)}),s("ic7D4",function(t,r){e(t.exports,"intervalProvider",function(){return s});var n=i("1a7ft"),s={setInterval:function(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=s.delegate;return(null==a?void 0:a.setInterval)?a.setInterval.apply(a,(0,n.__spreadArray)([e,t],(0,n.__read)(r))):setInterval.apply(void 0,(0,n.__spreadArray)([e,t],(0,n.__read)(r)))},clearInterval:function(e){var t=s.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0}}),s("7GTYN",function(t,r){e(t.exports,"AsyncScheduler",function(){return a});var n=i("1a7ft"),s=i("gDW7u"),a=function(e){function t(t,r){void 0===r&&(r=s.Scheduler.now);var n=e.call(this,t,r)||this;return n.actions=[],n._active=!1,n}return(0,n.__extends)(t,e),t.prototype.flush=function(e){var t,r=this.actions;if(this._active){r.push(e);return}this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=r.shift())if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}},t}(s.Scheduler)}),s("gDW7u",function(t,r){e(t.exports,"Scheduler",function(){return s});var n=i("O2Flc"),s=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=n.dateTimestampProvider.now,e}()}),s("O2Flc",function(t,r){e(t.exports,"dateTimestampProvider",function(){return n});var n={now:function(){return(n.delegate||Date).now()},delegate:void 0}}),s("arCqp",function(t,r){e(t.exports,"distinctUntilChanged",function(){return o});var n=i("2N6l4"),s=i("jSzwf"),a=i("iNetn");function o(e,t){return void 0===t&&(t=n.identity),e=null!=e?e:l,(0,s.operate)(function(r,n){var i,s=!0;r.subscribe((0,a.createOperatorSubscriber)(n,function(r){var a=t(r);(s||!e(i,a))&&(s=!1,i=a,n.next(r))}))})}function l(e,t){return e===t}}),s("lMvMU",function(t,r){e(t.exports,"filter",function(){return a});var n=i("jSzwf"),s=i("iNetn");function a(e,t){return(0,n.operate)(function(r,n){var i=0;r.subscribe((0,s.createOperatorSubscriber)(n,function(r){return e.call(t,r,i++)&&n.next(r)}))})}}),s("i54iF",function(t,r){e(t.exports,"merge",function(){return u});var n=i("gpa4f"),s=i("b7gpN"),a=i("gL4uk"),o=i("4xvfD"),l=i("fz1T5");function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,o.popScheduler)(e),i=(0,o.popNumber)(e,1/0);return e.length?1===e.length?(0,s.innerFrom)(e[0]):(0,n.mergeAll)(i)((0,l.from)(e,r)):a.EMPTY}}),s("gpa4f",function(t,r){e(t.exports,"mergeAll",function(){return a});var n=i("97m73"),s=i("2N6l4");function a(e){return void 0===e&&(e=1/0),(0,n.mergeMap)(s.identity,e)}}),s("97m73",function(t,r){e(t.exports,"mergeMap",function(){return function e(t,r,i){return(void 0===i&&(i=1/0),(0,l.isFunction)(r))?e(function(e,i){return(0,n.map)(function(t,n){return r(e,t,i,n)})((0,s.innerFrom)(t(e,i)))},i):("number"==typeof r&&(i=r),(0,a.operate)(function(e,r){return(0,o.mergeInternals)(e,r,t,i)}))}});var n=i("hciHF"),s=i("b7gpN"),a=i("jSzwf"),o=i("c8eGQ"),l=i("3IQI0")}),s("c8eGQ",function(t,r){e(t.exports,"mergeInternals",function(){return o});var n=i("b7gpN"),s=i("99A8K"),a=i("iNetn");function o(e,t,r,i,o,l,u,c){var h=[],d=0,m=0,g=!1,f=function(){!g||h.length||d||t.complete()},p=function(e){return d<i?C(e):h.push(e)},C=function(e){l&&t.next(e),d++;var c=!1;(0,n.innerFrom)(r(e,m++)).subscribe((0,a.createOperatorSubscriber)(t,function(e){null==o||o(e),l?p(e):t.next(e)},function(){c=!0},void 0,function(){if(c)try{for(d--;h.length&&d<i;)!function(){var e=h.shift();u?(0,s.executeSchedule)(t,u,function(){return C(e)}):C(e)}();f()}catch(e){t.error(e)}}))};return e.subscribe((0,a.createOperatorSubscriber)(t,p,function(){g=!0,f()})),function(){null==c||c()}}}),s("gL4uk",function(t,r){e(t.exports,"EMPTY",function(){return n});var n=new(i("1O3Nt")).Observable(function(e){return e.complete()})}),s("3yupB",function(t,r){e(t.exports,"of",function(){return a});var n=i("4xvfD"),s=i("fz1T5");function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=(0,n.popScheduler)(e);return(0,s.from)(e,r)}}),s("3rvNF",function(t,r){e(t.exports,"ReplaySubject",function(){return o});var n=i("1a7ft"),s=i("1mjSk"),a=i("O2Flc"),o=function(e){function t(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=a.dateTimestampProvider);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return(0,n.__extends)(t,e),t.prototype.next=function(t){var r=this.isStopped,n=this._buffer,i=this._infiniteTimeWindow,s=this._timestampProvider,a=this._windowTime;!r&&(n.push(t),i||n.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,n=this._infiniteTimeWindow,i=(n?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!n){for(var s=t.now(),a=0,o=1;o<r.length&&r[o]<=s;o+=2)a=o;a&&r.splice(0,a+1)}},t}(s.Subject)}),s("9GqS8",function(t,r){e(t.exports,"skip",function(){return s});var n=i("lMvMU");function s(e){return(0,n.filter)(function(t,r){return e<=r})}}),s("9z4na",function(t,r){e(t.exports,"take",function(){return o});var n=i("gL4uk"),s=i("jSzwf"),a=i("iNetn");function o(e){return e<=0?function(){return n.EMPTY}:(0,s.operate)(function(t,r){var n=0;t.subscribe((0,a.createOperatorSubscriber)(r,function(t){++n<=e&&(r.next(t),e<=n&&r.complete())}))})}}),s("b7wVW",function(t,r){e(t.exports,"tap",function(){return l});var n=i("3IQI0"),s=i("jSzwf"),a=i("iNetn"),o=i("2N6l4");function l(e,t,r){var i=(0,n.isFunction)(e)||t||r?{next:e,error:t,complete:r}:e;return i?(0,s.operate)(function(e,t){null===(r=i.subscribe)||void 0===r||r.call(i);var r,n=!0;e.subscribe((0,a.createOperatorSubscriber)(t,function(e){var r;null===(r=i.next)||void 0===r||r.call(i,e),t.next(e)},function(){var e;n=!1,null===(e=i.complete)||void 0===e||e.call(i),t.complete()},function(e){var r;n=!1,null===(r=i.error)||void 0===r||r.call(i,e),t.error(e)},function(){var e,t;n&&(null===(e=i.unsubscribe)||void 0===e||e.call(i)),null===(t=i.finalize)||void 0===t||t.call(i)}))}):o.identity}}),s("aMpZj",function(t,r){e(t.exports,"timer",function(){return l});var n=i("1O3Nt"),s=i("jaZjQ"),a=i("4tjBj"),o=i("hdn9Z");function l(e,t,r){void 0===e&&(e=0),void 0===r&&(r=s.async);var i=-1;return null!=t&&((0,a.isScheduler)(t)?r=t:i=t),new n.Observable(function(t){var n=(0,o.isValidDate)(e)?+e-r.now():e;n<0&&(n=0);var s=0;return r.schedule(function(){t.closed||(t.next(s++),0<=i?this.schedule(void 0,i):t.complete())},n)})}}),s("hdn9Z",function(t,r){e(t.exports,"isValidDate",function(){return n});function n(e){return e instanceof Date&&!isNaN(e)}}),s("bDEN0",function(t,r){e(t.exports,"first",function(){return c});var n=i("aXqMV"),s=i("lMvMU"),a=i("9z4na"),o=i("gSl4p"),l=i("aRjCl"),u=i("2N6l4");function c(e,t){var r=arguments.length>=2;return function(i){return i.pipe(e?(0,s.filter)(function(t,r){return e(t,r,i)}):u.identity,(0,a.take)(1),r?(0,o.defaultIfEmpty)(t):(0,l.throwIfEmpty)(function(){return new n.EmptyError}))}}}),s("aXqMV",function(t,r){e(t.exports,"EmptyError",function(){return n});var n=(0,i("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})}),s("gSl4p",function(t,r){e(t.exports,"defaultIfEmpty",function(){return a});var n=i("jSzwf"),s=i("iNetn");function a(e){return(0,n.operate)(function(t,r){var n=!1;t.subscribe((0,s.createOperatorSubscriber)(r,function(e){n=!0,r.next(e)},function(){n||r.next(e),r.complete()}))})}}),s("aRjCl",function(t,r){e(t.exports,"throwIfEmpty",function(){return o});var n=i("aXqMV"),s=i("jSzwf"),a=i("iNetn");function o(e){return void 0===e&&(e=l),(0,s.operate)(function(t,r){var n=!1;t.subscribe((0,a.createOperatorSubscriber)(r,function(e){n=!0,r.next(e)},function(){return n?r.complete():r.error(e())}))})}function l(){return new n.EmptyError}}),s("5gqvu",function(e,t){e.exports=i("9fdc7")}),s("9fdc7",function(t,r){e(t.exports,"Children",function(){return n},function(e){return n=e}),e(t.exports,"Component",function(){return i},function(e){return i=e}),e(t.exports,"Fragment",function(){return s},function(e){return s=e}),e(t.exports,"Profiler",function(){return a},function(e){return a=e}),e(t.exports,"PureComponent",function(){return o},function(e){return o=e}),e(t.exports,"StrictMode",function(){return l},function(e){return l=e}),e(t.exports,"Suspense",function(){return u},function(e){return u=e}),e(t.exports,"__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED",function(){return c},function(e){return c=e}),e(t.exports,"act",function(){return h},function(e){return h=e}),e(t.exports,"cloneElement",function(){return d},function(e){return d=e}),e(t.exports,"createContext",function(){return m},function(e){return m=e}),e(t.exports,"createElement",function(){return g},function(e){return g=e}),e(t.exports,"createFactory",function(){return f},function(e){return f=e}),e(t.exports,"createRef",function(){return p},function(e){return p=e}),e(t.exports,"forwardRef",function(){return C},function(e){return C=e}),e(t.exports,"isValidElement",function(){return _},function(e){return _=e}),e(t.exports,"lazy",function(){return y},function(e){return y=e}),e(t.exports,"memo",function(){return E},function(e){return E=e}),e(t.exports,"startTransition",function(){return b},function(e){return b=e}),e(t.exports,"unstable_act",function(){return R},function(e){return R=e}),e(t.exports,"useCallback",function(){return N},function(e){return N=e}),e(t.exports,"useContext",function(){return I},function(e){return I=e}),e(t.exports,"useDebugValue",function(){return A},function(e){return A=e}),e(t.exports,"useDeferredValue",function(){return v},function(e){return v=e}),e(t.exports,"useEffect",function(){return S},function(e){return S=e}),e(t.exports,"useId",function(){return T},function(e){return T=e}),e(t.exports,"useImperativeHandle",function(){return O},function(e){return O=e}),e(t.exports,"useInsertionEffect",function(){return M},function(e){return M=e}),e(t.exports,"useLayoutEffect",function(){return w},function(e){return w=e}),e(t.exports,"useMemo",function(){return x},function(e){return x=e}),e(t.exports,"useReducer",function(){return U},function(e){return U=e}),e(t.exports,"useRef",function(){return D},function(e){return D=e}),e(t.exports,"useState",function(){return V},function(e){return V=e}),e(t.exports,"useSyncExternalStore",function(){return L},function(e){return L=e}),e(t.exports,"useTransition",function(){return P},function(e){return P=e}),e(t.exports,"version",function(){return j},function(e){return j=e});var n,i,s,a,o,l,u,c,h,d,m,g,f,p,C,_,y,E,b,R,N,I,A,v,S,T,O,M,w,x,U,D,V,L,P,j,F=Symbol.for("react.element"),k=Symbol.for("react.portal"),B=Symbol.for("react.fragment"),$=Symbol.for("react.strict_mode"),H=Symbol.for("react.profiler"),W=Symbol.for("react.provider"),G=Symbol.for("react.context"),Y=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),q=Symbol.for("react.memo"),X=Symbol.for("react.lazy"),K=Symbol.iterator,Q={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Z=Object.assign,J={};function ee(e,t,r){this.props=e,this.context=t,this.refs=J,this.updater=r||Q}function et(){}function er(e,t,r){this.props=e,this.context=t,this.refs=J,this.updater=r||Q}ee.prototype.isReactComponent={},ee.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},ee.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},et.prototype=ee.prototype;var en=er.prototype=new et;en.constructor=er,Z(en,ee.prototype),en.isPureReactComponent=!0;var ei=Array.isArray,es=Object.prototype.hasOwnProperty,ea={current:null},eo={key:!0,ref:!0,__self:!0,__source:!0};function el(e,t,r){var n,i={},s=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)es.call(t,n)&&!eo.hasOwnProperty(n)&&(i[n]=t[n]);var o=arguments.length-2;if(1===o)i.children=r;else if(1<o){for(var l=Array(o),u=0;u<o;u++)l[u]=arguments[u+2];i.children=l}if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===i[n]&&(i[n]=o[n]);return{$$typeof:F,type:e,key:s,ref:a,props:i,_owner:ea.current}}function eu(e){return"object"==typeof e&&null!==e&&e.$$typeof===F}var ec=/\/+/g;function eh(e,t){var r,n;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36)}function ed(e,t,r){if(null==e)return e;var n=[],i=0;return function e(t,r,n,i,s){var a,o,l,u=typeof t;("undefined"===u||"boolean"===u)&&(t=null);var c=!1;if(null===t)c=!0;else switch(u){case"string":case"number":c=!0;break;case"object":switch(t.$$typeof){case F:case k:c=!0}}if(c)return s=s(c=t),t=""===i?"."+eh(c,0):i,ei(s)?(n="",null!=t&&(n=t.replace(ec,"$&/")+"/"),e(s,r,n,"",function(e){return e})):null!=s&&(eu(s)&&(a=s,o=n+(!s.key||c&&c.key===s.key?"":(""+s.key).replace(ec,"$&/")+"/")+t,s={$$typeof:F,type:a.type,key:o,ref:a.ref,props:a.props,_owner:a._owner}),r.push(s)),1;if(c=0,i=""===i?".":i+":",ei(t))for(var h=0;h<t.length;h++){var d=i+eh(u=t[h],h);c+=e(u,r,n,d,s)}else if("function"==typeof(d=null===(l=t)||"object"!=typeof l?null:"function"==typeof(l=K&&l[K]||l["@@iterator"])?l:null))for(t=d.call(t),h=0;!(u=t.next()).done;)d=i+eh(u=u.value,h++),c+=e(u,r,n,d,s);else if("object"===u)throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(r=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return c}(e,n,"","",function(e){return t.call(r,e,i++)}),n}function em(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var eg={current:null},ef={transition:null};function ep(){throw Error("act(...) is not supported in production builds of React.")}n={map:ed,forEach:function(e,t,r){ed(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return ed(e,function(){t++}),t},toArray:function(e){return ed(e,function(e){return e})||[]},only:function(e){if(!eu(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},i=ee,s=B,a=H,o=er,l=$,u=z,c={ReactCurrentDispatcher:eg,ReactCurrentBatchConfig:ef,ReactCurrentOwner:ea},h=ep,d=function(e,t,r){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var n=Z({},e.props),i=e.key,s=e.ref,a=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,a=ea.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(l in t)es.call(t,l)&&!eo.hasOwnProperty(l)&&(n[l]=void 0===t[l]&&void 0!==o?o[l]:t[l])}var l=arguments.length-2;if(1===l)n.children=r;else if(1<l){o=Array(l);for(var u=0;u<l;u++)o[u]=arguments[u+2];n.children=o}return{$$typeof:F,type:e.type,key:i,ref:s,props:n,_owner:a}},m=function(e){return(e={$$typeof:G,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:W,_context:e},e.Consumer=e},g=el,f=function(e){var t=el.bind(null,e);return t.type=e,t},p=function(){return{current:null}},C=function(e){return{$$typeof:Y,render:e}},_=eu,y=function(e){return{$$typeof:X,_payload:{_status:-1,_result:e},_init:em}},E=function(e,t){return{$$typeof:q,type:e,compare:void 0===t?null:t}},b=function(e){var t=ef.transition;ef.transition={};try{e()}finally{ef.transition=t}},R=ep,N=function(e,t){return eg.current.useCallback(e,t)},I=function(e){return eg.current.useContext(e)},A=function(){},v=function(e){return eg.current.useDeferredValue(e)},S=function(e,t){return eg.current.useEffect(e,t)},T=function(){return eg.current.useId()},O=function(e,t,r){return eg.current.useImperativeHandle(e,t,r)},M=function(e,t){return eg.current.useInsertionEffect(e,t)},w=function(e,t){return eg.current.useLayoutEffect(e,t)},x=function(e,t){return eg.current.useMemo(e,t)},U=function(e,t,r){return eg.current.useReducer(e,t,r)},D=function(e){return eg.current.useRef(e)},V=function(e){return eg.current.useState(e)},L=function(e,t,r){return eg.current.useSyncExternalStore(e,t,r)},P=function(){return eg.current.useTransition()},j="18.3.1"}),s("8L69c",function(e,t){var r,n,i,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u=[],c=!1,h=-1;function d(){c&&i&&(c=!1,i.length?u=i.concat(u):h=-1,u.length&&m())}function m(){if(!c){var e=l(d);c=!0;for(var t=u.length;t;){for(i=u,u=[];++h<t;)i&&i[h].run();h=-1,t=u.length}i=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new g(e,t)),1!==u.length||c||l(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),s("ejawP",function(t,r){let n,s,a,o,l,u,c,h,d,m,g,f;e(t.exports,"ViewStateEnum",function(){return U}),e(t.exports,"EditStateEnum",function(){return D}),e(t.exports,"RangeProtectionRuleModel",function(){return V}),e(t.exports,"AddRangeProtectionMutation",function(){return P}),e(t.exports,"DeleteRangeProtectionMutation",function(){return L}),e(t.exports,"AddRangeProtectionCommand",function(){return j}),e(t.exports,"WorksheetProtectionRuleModel",function(){return F}),e(t.exports,"AddWorksheetProtectionMutation",function(){return k}),e(t.exports,"DeleteWorksheetProtectionMutation",function(){return B}),e(t.exports,"AddWorksheetProtectionCommand",function(){return $}),e(t.exports,"SelectionMoveType",function(){return H}),e(t.exports,"SheetsSelectionsService",function(){return z}),e(t.exports,"DISABLE_NORMAL_SELECTIONS",function(){return q}),e(t.exports,"INTERCEPTOR_POINT",function(){return X}),e(t.exports,"InterceptCellContentPriority",function(){return K}),e(t.exports,"BEFORE_CELL_EDIT",function(){return J}),e(t.exports,"AFTER_CELL_EDIT",function(){return ee}),e(t.exports,"SheetInterceptorService",function(){return er}),e(t.exports,"SetRangeValuesUndoMutationFactory",function(){return eu}),e(t.exports,"SetRangeValuesMutation",function(){return ec}),e(t.exports,"generateNullCellValue",function(){return eg}),e(t.exports,"ClearSelectionAllCommand",function(){return ef}),e(t.exports,"ClearSelectionContentCommand",function(){return ep}),e(t.exports,"ClearSelectionFormatCommand",function(){return eC}),e(t.exports,"InsertSheetMutation",function(){return ey}),e(t.exports,"getSheetCommandTarget",function(){return eE}),e(t.exports,"RemoveSheetMutation",function(){return eN}),e(t.exports,"CopySheetCommand",function(){return eI}),e(t.exports,"MoveRangeMutation",function(){return eA}),e(t.exports,"IRefSelectionsService",function(){return eT}),e(t.exports,"RefSelectionsService",function(){return eO}),e(t.exports,"getSelectionsService",function(){return eM}),e(t.exports,"SetSelectionsOperation",function(){return ew}),e(t.exports,"alignToMergedCellsBorders",function(){return ex}),e(t.exports,"getCellAtRowCol",function(){return eU}),e(t.exports,"setEndForRange",function(){return eD}),e(t.exports,"getPrimaryForRange",function(){return eV}),e(t.exports,"copyRangeStyles",function(){return eP}),e(t.exports,"MoveRangeCommand",function(){return eF}),e(t.exports,"UnitAction",function(){return e$}),e(t.exports,"UnitObject",function(){return eH}),e(t.exports,"RangeProtectionPermissionEditPoint",function(){return eW}),e(t.exports,"RangeProtectionPermissionViewPoint",function(){return eG}),e(t.exports,"WorkbookCopyPermission",function(){return ez}),e(t.exports,"WorkbookCreateProtectPermission",function(){return eX}),e(t.exports,"WorkbookCreateSheetPermission",function(){return eK}),e(t.exports,"WorkbookDeleteSheetPermission",function(){return eQ}),e(t.exports,"WorkbookEditablePermission",function(){return eJ}),e(t.exports,"WorkbookHideSheetPermission",function(){return e1}),e(t.exports,"WorkbookManageCollaboratorPermission",function(){return e2}),e(t.exports,"WorkbookMoveSheetPermission",function(){return e5}),e(t.exports,"WorkbookRenameSheetPermission",function(){return e6}),e(t.exports,"WorksheetCopyPermission",function(){return te}),e(t.exports,"WorksheetDeleteColumnPermission",function(){return tt}),e(t.exports,"WorksheetDeleteProtectionPermission",function(){return tr}),e(t.exports,"WorksheetDeleteRowPermission",function(){return tn}),e(t.exports,"WorksheetEditPermission",function(){return ti}),e(t.exports,"WorksheetInsertColumnPermission",function(){return to}),e(t.exports,"WorksheetInsertRowPermission",function(){return tu}),e(t.exports,"WorksheetManageCollaboratorPermission",function(){return tc}),e(t.exports,"WorksheetSetCellStylePermission",function(){return td}),e(t.exports,"WorksheetSetCellValuePermission",function(){return tm}),e(t.exports,"WorksheetSetColumnStylePermission",function(){return tg}),e(t.exports,"WorksheetSetRowStylePermission",function(){return tf}),e(t.exports,"WorksheetViewPermission",function(){return tC}),e(t.exports,"SetRangeValuesCommand",function(){return t_}),e(t.exports,"DeleteRangeMoveLeftCommand",function(){return tR}),e(t.exports,"DeleteRangeMoveUpCommand",function(){return tI}),e(t.exports,"DeleteRangeProtectionCommand",function(){return tA}),e(t.exports,"DeleteWorksheetProtectionCommand",function(){return tv}),e(t.exports,"InsertDefinedNameCommand",function(){return tS}),e(t.exports,"InsertRowMutation",function(){return tO}),e(t.exports,"InsertColMutation",function(){return tw}),e(t.exports,"RemoveRowMutation",function(){return tU}),e(t.exports,"RemoveColMutation",function(){return tV}),e(t.exports,"InsertRangeMoveDownCommand",function(){return tL}),e(t.exports,"InsertRangeMoveRightCommand",function(){return tj}),e(t.exports,"InsertRowCommand",function(){return tk}),e(t.exports,"InsertRowBeforeCommand",function(){return tB}),e(t.exports,"InsertRowAfterCommand",function(){return t$}),e(t.exports,"InsertColCommand",function(){return tW}),e(t.exports,"InsertColBeforeCommand",function(){return tG}),e(t.exports,"InsertColAfterCommand",function(){return tY}),e(t.exports,"InsertSheetCommand",function(){return tz}),e(t.exports,"MoveRowsMutation",function(){return tq}),e(t.exports,"MoveColsMutation",function(){return tX}),e(t.exports,"MoveRowsCommand",function(){return tQ}),e(t.exports,"MoveColsCommand",function(){return tJ}),e(t.exports,"RemoveDefinedNameCommand",function(){return t1}),e(t.exports,"RemoveRowCommand",function(){return t5}),e(t.exports,"RemoveColCommand",function(){return t4}),e(t.exports,"RemoveSheetCommand",function(){return t6}),e(t.exports,"AddMergeUndoMutationFactory",function(){return t9}),e(t.exports,"AddWorksheetMergeMutation",function(){return t7}),e(t.exports,"RemoveMergeUndoMutationFactory",function(){return t8}),e(t.exports,"RemoveWorksheetMergeMutation",function(){return re}),e(t.exports,"RemoveWorksheetMergeCommand",function(){return rt}),e(t.exports,"ReorderRangeMutation",function(){return rn}),e(t.exports,"BorderStyleManagerService",function(){return ra}),e(t.exports,"SetBorderCommand",function(){return rm}),e(t.exports,"SetBorderBasicCommand",function(){return rC}),e(t.exports,"SetColDataCommand",function(){return rE}),e(t.exports,"SetColHiddenMutation",function(){return rR}),e(t.exports,"SetColVisibleMutation",function(){return rI}),e(t.exports,"SetSpecificColsVisibleCommand",function(){return rA}),e(t.exports,"SetSelectedColsVisibleCommand",function(){return rv}),e(t.exports,"SetColHiddenCommand",function(){return rS}),e(t.exports,"SetDefinedNameCommand",function(){return rO}),e(t.exports,"SetFrozenMutationFactory",function(){return rM}),e(t.exports,"SetFrozenMutation",function(){return rw}),e(t.exports,"SetFrozenCommand",function(){return rx}),e(t.exports,"CancelFrozenCommand",function(){return rU}),e(t.exports,"SetRangeProtectionMutation",function(){return rD}),e(t.exports,"SetProtectionCommand",function(){return rL}),e(t.exports,"SetRowDataCommand",function(){return rF}),e(t.exports,"SetRowVisibleMutation",function(){return rB}),e(t.exports,"SetRowHiddenMutation",function(){return rH}),e(t.exports,"SetSpecificRowsVisibleCommand",function(){return rW}),e(t.exports,"SetSelectedRowsVisibleCommand",function(){return rG}),e(t.exports,"SetRowHiddenCommand",function(){return rY}),e(t.exports,"SetStyleCommand",function(){return rq}),e(t.exports,"SetBoldCommand",function(){return rX}),e(t.exports,"SetItalicCommand",function(){return rK}),e(t.exports,"SetUnderlineCommand",function(){return rQ}),e(t.exports,"SetStrikeThroughCommand",function(){return rZ}),e(t.exports,"SetFontFamilyCommand",function(){return rJ}),e(t.exports,"SetFontSizeCommand",function(){return r0}),e(t.exports,"SetTextColorCommand",function(){return r1}),e(t.exports,"ResetTextColorCommand",function(){return r2}),e(t.exports,"SetBackgroundColorCommand",function(){return r5}),e(t.exports,"ResetBackgroundColorCommand",function(){return r3}),e(t.exports,"SetVerticalTextAlignCommand",function(){return r4}),e(t.exports,"SetHorizontalTextAlignCommand",function(){return r6}),e(t.exports,"SetTextWrapCommand",function(){return r9}),e(t.exports,"SetTextRotationCommand",function(){return r7}),e(t.exports,"SetTabColorMutation",function(){return ne}),e(t.exports,"SetTabColorCommand",function(){return nt}),e(t.exports,"SetWorksheetActiveOperation",function(){return ni}),e(t.exports,"SetWorksheetActivateCommand",function(){return ns}),e(t.exports,"SetWorksheetColWidthMutation",function(){return no}),e(t.exports,"DeltaColumnWidthCommand",function(){return nl}),e(t.exports,"SetColWidthCommand",function(){return nu}),e(t.exports,"SetWorksheetDefaultStyleMutation",function(){return nh}),e(t.exports,"SetWorksheetHideMutation",function(){return nf}),e(t.exports,"SetWorksheetHideCommand",function(){return np}),e(t.exports,"SetWorksheetNameMutation",function(){return n_}),e(t.exports,"SetWorksheetNameCommand",function(){return ny}),e(t.exports,"SetWorksheetOrderMutation",function(){return nb}),e(t.exports,"SetWorksheetOrderCommand",function(){return nR}),e(t.exports,"getAllRangePermissionPoint",function(){return nA}),e(t.exports,"baseProtectionActions",function(){return nv}),e(t.exports,"getAllWorkbookPermissionPoint",function(){return nS}),e(t.exports,"defaultWorkbookPermissionPoints",function(){return nT}),e(t.exports,"getAllWorksheetPermissionPoint",function(){return nO}),e(t.exports,"getAllWorksheetPermissionPointByPointPanel",function(){return nM}),e(t.exports,"defaultWorksheetPermissionPoint",function(){return nw}),e(t.exports,"WorksheetProtectionPointModel",function(){return nx}),e(t.exports,"SetWorksheetPermissionPointsMutation",function(){return nP}),e(t.exports,"SetWorksheetPermissionPointsCommand",function(){return nj}),e(t.exports,"SetWorksheetRowAutoHeightMutationFactory",function(){return n$}),e(t.exports,"SetWorksheetRowHeightMutation",function(){return nH}),e(t.exports,"SetWorksheetRowIsAutoHeightMutation",function(){return nW}),e(t.exports,"SetWorksheetRowAutoHeightMutation",function(){return nG}),e(t.exports,"DeltaRowHeightCommand",function(){return nY}),e(t.exports,"SetRowHeightCommand",function(){return nz}),e(t.exports,"SetWorksheetRowIsAutoHeightCommand",function(){return nq}),e(t.exports,"SetWorksheetShowCommand",function(){return nX}),e(t.exports,"ToggleCellCheckboxCommand",function(){return nK}),e(t.exports,"ToggleGridlinesMutation",function(){return nQ}),e(t.exports,"ToggleGridlinesCommand",function(){return nZ}),e(t.exports,"rangeMerge",function(){return n3}),e(t.exports,"INumfmtService",function(){return n4}),e(t.exports,"factorySetNumfmtUndoMutation",function(){return n6}),e(t.exports,"transformCellsToRange",function(){return ie}),e(t.exports,"SetNumfmtMutation",function(){return n9}),e(t.exports,"RemoveNumfmtMutation",function(){return n7}),e(t.exports,"factoryRemoveNumfmtUndoMutation",function(){return n8}),e(t.exports,"ScrollToCellOperation",function(){return it}),e(t.exports,"MAX_CELL_PER_SHEET_KEY",function(){return ii}),e(t.exports,"EffectRefRangId",function(){return iy}),e(t.exports,"handleMoveRows",function(){return iA}),e(t.exports,"handleMoveCols",function(){return iT}),e(t.exports,"handleMoveRange",function(){return iM}),e(t.exports,"handleIRemoveCol",function(){return iU}),e(t.exports,"handleIRemoveRow",function(){return iD}),e(t.exports,"handleInsertRow",function(){return iP}),e(t.exports,"handleInsertCol",function(){return ij}),e(t.exports,"handleInsertRangeMoveDown",function(){return iF}),e(t.exports,"handleInsertRangeMoveRight",function(){return iB}),e(t.exports,"handleDeleteRangeMoveLeft",function(){return iH}),e(t.exports,"handleDeleteRangeMoveUp",function(){return iG}),e(t.exports,"runRefRangeMutations",function(){return iK}),e(t.exports,"handleDefaultRangeChangeWithEffectRefCommands",function(){return iQ}),e(t.exports,"handleCommonDefaultRangeChangeWithEffectRefCommands",function(){return iZ}),e(t.exports,"getSeparateEffectedRangesOnCommand",function(){return iJ}),e(t.exports,"RefRangeService",function(){return i9}),e(t.exports,"getAddMergeMutationRangeByType",function(){return sa}),e(t.exports,"MERGE_CELL_INTERCEPTOR_CHECK",function(){return so}),e(t.exports,"MergeCellController",function(){return sl}),e(t.exports,"RangeProtectionCache",function(){return sC}),e(t.exports,"IExclusiveRangeService",function(){return sR}),e(t.exports,"UniverSheetsPlugin",function(){return sz}),e(t.exports,"COMMAND_LISTENER_SKELETON_CHANGE",function(){return sq}),e(t.exports,"COMMAND_LISTENER_VALUE_CHANGE",function(){return sX}),e(t.exports,"SELECTION_CONTROL_BORDER_BUFFER_WIDTH",function(){return sK}),e(t.exports,"SELECTION_CONTROL_BORDER_BUFFER_COLOR",function(){return sQ}),e(t.exports,"convertSelectionDataToRange",function(){return sZ}),e(t.exports,"AddMergeRedoSelectionsOperationFactory",function(){return sJ}),e(t.exports,"AddMergeUndoSelectionsOperationFactory",function(){return s0}),e(t.exports,"expandToContinuousRange",function(){return s5}),e(t.exports,"AddWorksheetMergeCommand",function(){return s3}),e(t.exports,"AddWorksheetMergeAllCommand",function(){return s4}),e(t.exports,"AddWorksheetMergeVerticalCommand",function(){return s6}),e(t.exports,"AddWorksheetMergeHorizontalCommand",function(){return s9}),e(t.exports,"addMergeCellsUtil",function(){return s7});var p=i("7yNYd"),C=i("86b1c"),_=i("k2g5B"),y=i("5LPkb"),E=i("lMvMU"),b=i("bDEN0"),R=i("hciHF"),N=i("i54iF"),I=i("3yupB"),A=i("c3hg1"),v=i("1mjSk"),S=i("23cfA"),T=i("2jrJe"),O=i("2BOVU"),E=i("lMvMU"),R=i("hciHF"),T=i("2jrJe"),M=Object.defineProperty,w=(e,t,r)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,x=(e,t,r)=>w(e,"symbol"!=typeof t?t+"":t,r),U=((n=U||{}).OthersCanView="othersCanView",n.NoOneElseCanView="noOneElseCanView",n),D=((s=D||{}).DesignedUserCanEdit="designedUserCanEdit",s.OnlyMe="onlyMe",s);class V{constructor(){x(this,"_model",/* @__PURE__ */new Map),x(this,"_ruleChange",new v.Subject),x(this,"ruleChange$",this._ruleChange.asObservable()),x(this,"_ruleRefresh",new v.Subject),x(this,"ruleRefresh$",this._ruleRefresh.asObservable()),x(this,"_rangeRuleInitStateChange",new y.BehaviorSubject(!1)),x(this,"rangeRuleInitStateChange$",this._rangeRuleInitStateChange.asObservable())}ruleRefresh(e){this._ruleRefresh.next(e)}getRangeRuleInitState(){return this._rangeRuleInitStateChange.value}changeRuleInitState(e){this._rangeRuleInitStateChange.next(e)}addRule(e,t,r){this._ensureRuleMap(e,t).set(r.id,r),this._ruleChange.next({unitId:e,subUnitId:t,rule:r,type:"add"})}deleteRule(e,t,r){var n,i,s,a;let o=null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r);o&&(null==(a=null==(s=this._model.get(e))?void 0:s.get(t))||a.delete(r),this._ruleChange.next({unitId:e,subUnitId:t,rule:o,type:"delete"}))}setRule(e,t,r,n){var i,s;let a=this.getRule(e,t,r);a&&(null==(s=null==(i=this._model.get(e))?void 0:i.get(t))||s.set(r,n),this._ruleChange.next({unitId:e,subUnitId:t,oldRule:a,rule:n,type:"set"}))}getRule(e,t,r){var n,i;return null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r)}getSubunitRuleList(e,t){var r;return[...((null==(r=this._model.get(e))?void 0:r.get(t))||/* @__PURE__ */new Map).values()]}getSubunitRuleListLength(e,t){var r;let n=null==(r=this._model.get(e))?void 0:r.get(t);return n?n.size:0}_ensureRuleMap(e,t){let r=this._model.get(e);r||(r=/* @__PURE__ */new Map,this._model.set(e,r));let n=r.get(t);return n||(n=/* @__PURE__ */new Map,r.set(t,n)),n}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t),n=[...r.keys()];e[t]={},n.forEach(n=>{let i=r.get(n);e[t][n]=[...i.values()]})}),e}fromObject(e){let t=/* @__PURE__ */new Map;Object.keys(e).forEach(r=>{let n=e[r],i=/* @__PURE__ */new Map;Object.keys(n).forEach(e=>{let t=n[e].reduce((e,t)=>(e.set(t.id,t),e),/* @__PURE__ */new Map);i.set(e,t)}),t.set(r,i)}),this._model=t}deleteUnitModel(e){this._model.delete(e)}createRuleId(e,t){let r=(0,p.Tools).generateRandomId(4),n=this._ensureRuleMap(e,t);for(;n.has(r);)r=(0,p.Tools).generateRandomId(4);return r}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)for(let r of i.values())if(r.permissionId===t)return[e,n];return null}}let L={id:"sheet.mutation.delete-range-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,ruleIds:i}=t,s=e.get(V);return i.forEach(e=>{s.deleteRule(r,n,e)}),!0}},P={id:"sheet.mutation.add-range-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rules:i}=t,s=e.get(V);return i.forEach(e=>{s.addRule(r,n,e)}),!0}},j={type:p.CommandType.COMMAND,id:"sheet.command.add-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=e.get(V),{rule:s,permissionId:a}=t,{unitId:o,subUnitId:l,ranges:u,description:c,viewState:h,editState:d}=s,m=[{ranges:u,permissionId:a,id:i.createRuleId(o,l),description:c,unitType:s.unitType,unitId:o,subUnitId:l,viewState:h,editState:d}];if(await r.executeCommand(P.id,{unitId:o,subUnitId:l,rules:m})){let e=[{id:P.id,params:{unitId:o,subUnitId:l,rules:m}}],t=[{id:L.id,params:{unitId:o,subUnitId:l,ruleIds:m.map(e=>e.id)}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}};class F{constructor(){x(this,"_model",/* @__PURE__ */new Map),x(this,"_ruleChange",new v.Subject),x(this,"_ruleRefresh",new v.Subject),x(this,"_resetOrder",new v.Subject),x(this,"ruleChange$",this._ruleChange.asObservable()),x(this,"ruleRefresh$",this._ruleRefresh.asObservable()),x(this,"resetOrder$",this._resetOrder.asObservable()),x(this,"_worksheetRuleInitStateChange",new y.BehaviorSubject(!1)),x(this,"worksheetRuleInitStateChange$",this._worksheetRuleInitStateChange.asObservable())}changeRuleInitState(e){this._worksheetRuleInitStateChange.next(e)}getSheetRuleInitState(){return this._worksheetRuleInitStateChange.value}addRule(e,t){this._ensureSubUnitMap(e).set(t.subUnitId,t),this._ruleChange.next({unitId:e,rule:t,type:"add",subUnitId:t.subUnitId})}deleteRule(e,t){var r,n,i;let s=null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t);s&&(null==(i=this._model.get(e))||i.delete(t),this._ruleChange.next({unitId:e,rule:s,type:"delete",subUnitId:t}))}setRule(e,t,r){var n,i;let s=this.getRule(e,t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.set(t,r),this._ruleChange.next({unitId:e,oldRule:s,rule:r,type:"set",subUnitId:t}))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=/* @__PURE__ */new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=/* @__PURE__ */new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=/* @__PURE__ */new Map,this._model.set(e,t)),t}ruleRefresh(e){this._ruleRefresh.next(e)}resetOrder(){this._resetOrder.next(Math.random())}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}let k={id:"sheet.mutation.add-worksheet-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,rule:n}=t;return e.get(F).addRule(r,n),!0}},B={id:"sheet.mutation.delete-worksheet-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n}=t;return e.get(F).deleteRule(r,n),!0}},$={type:p.CommandType.COMMAND,id:"sheet.command.add-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),{rule:i,unitId:s}=t,a=i.subUnitId;if(await r.executeCommand(k.id,{unitId:s,rule:i,subUnitId:i.subUnitId})){let e=[{id:k.id,params:{unitId:s,rule:i,subUnitId:i.subUnitId}}],t=[{id:B.id,params:{unitId:s,subUnitId:a}}];n.pushUndoRedo({unitID:s,redoMutations:e,undoMutations:t})}return!0}};var H=((a=H||{})[a.MOVE_START=0]="MOVE_START",a[a.MOVING=1]="MOVING",a[a.MOVE_END=2]="MOVE_END",a[a.ONLY_SET=3]="ONLY_SET",a);class W extends p.Disposable{constructor(e){super(),x(this,"_worksheetSelections",/* @__PURE__ */new Map),x(this,"_selectionMoveStart$",new v.Subject),x(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable()),x(this,"_selectionMoving$",new v.Subject),x(this,"selectionMoving$",this._selectionMoving$.asObservable()),x(this,"_selectionMoveEnd$",new y.BehaviorSubject([])),x(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable()),x(this,"_selectionSet$",new y.BehaviorSubject([])),x(this,"selectionSet$",this._selectionSet$.asObservable()),x(this,"_beforeSelectionMoveEnd$",new y.BehaviorSubject([])),x(this,"beforeSelectionMoveEnd$",this._beforeSelectionMoveEnd$.asObservable()),this._workbook=e}dispose(){super.dispose(),this._beforeSelectionMoveEnd$.complete(),this._selectionMoveEnd$.complete(),this._selectionMoving$.complete(),this._selectionMoveStart$.complete(),this._selectionSet$.complete()}clear(){this._worksheetSelections.clear(),this._emitOnEnd([])}addSelections(e,t){let r=this.getSelectionsOfWorksheet(e);r.push(...t),this._emitOnEnd(r)}setSelections(e,t=[],r){switch(this.deleteSheetSelection(e),this.getSelectionsOfWorksheet(e).push(...t),r){case H.MOVE_START:this._selectionMoveStart$.next(t);break;case H.MOVING:this._selectionMoving$.next(t);break;case H.MOVE_END:this._beforeSelectionMoveEnd$.next(t),this._selectionMoveEnd$.next(t);break;case H.ONLY_SET:this._selectionSet$.next(t);break;default:this._emitOnEnd(t)}}getCurrentSelections(){return this._getCurrentSelections()}getSelectionOfWorksheet(e){return this.getSelectionsOfWorksheet(e)}getSelectionsOfWorksheet(e){return this._worksheetSelections.has(e)||this._worksheetSelections.set(e,[]),this._worksheetSelections.get(e)}_getCurrentSelections(){return this.getSelectionsOfWorksheet(this._workbook.getActiveSheet().getSheetId())}getCurrentLastSelection(){let e=this._getCurrentSelections();return e[e.length-1]}_ensureSheetSelection(e){return this._worksheetSelections.get(e)||this._worksheetSelections.set(e,[]),this._worksheetSelections.get(e)}deleteSheetSelection(e){this._worksheetSelections.set(e,[])}_emitOnEnd(e){this._selectionSet$.next(e)}}var G=Object.defineProperty,Y=Object.getOwnPropertyDescriptor;let z=class extends p.RxDisposable{constructor(e){super(),x(this,"selectionMoveStart$"),x(this,"selectionMoving$"),x(this,"selectionMoveEnd$"),x(this,"_workbookSelections",/* @__PURE__ */new Map),this._instanceSrv=e,this._init()}get _currentSelectionPos(){let e=this._instanceSrv.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!e)return null;let t=e.getActiveSheet();return{unitId:e.getUnitId(),sheetId:t.getSheetId()}}get currentSelectionParam(){return this._currentSelectionPos}_init(){let e=this._instanceSrv.getCurrentTypeOfUnit$(p.UniverInstanceType.UNIVER_SHEET).pipe((0,A.shareReplay)(1),(0,T.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,S.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveStart$:(0,I.of)())),this.selectionMoving$=e.pipe((0,S.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoving$:(0,I.of)())),this.selectionMoveEnd$=e.pipe((0,S.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveEnd$:(0,I.of)([]))),this._instanceSrv.getTypeOfUnitDisposed$(p.UniverInstanceType.UNIVER_SHEET).pipe((0,T.takeUntil)(this.dispose$)).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId())})}clear(){this._workbookSelections.forEach(e=>e.clear())}getCurrentSelections(){return this._getCurrentSelections()}getCurrentLastSelection(){let e=this._getCurrentSelections();return null==e?void 0:e[e.length-1]}addSelections(e,t,r){if("string"==typeof e){this._ensureWorkbookSelection(e).addSelections(t,r);return}let n=this._currentSelectionPos;if(!n)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:i,sheetId:s}=n;this._ensureWorkbookSelection(i).addSelections(s,e)}setSelections(e,t,r,n){if("string"==typeof e&&"string"==typeof t){this._ensureWorkbookSelection(e).setSelections(t,r,null!=n?n:H.MOVE_END);return}let i=this._currentSelectionPos;if(!i)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:s,sheetId:a}=i;if("object"==typeof e){let n=null!=t?t:H.ONLY_SET;this._ensureWorkbookSelection(s).setSelections(a,null!=e?e:r,n)}}clearCurrentSelections(){this._getCurrentSelections().splice(0)}isOverlapping(){let e=this.getCurrentSelections();return null!=e&&e.some(({range:t},r)=>e.some(({range:e},n)=>r!==n&&t.startRow<=e.endRow&&t.endRow>=e.startRow&&t.startColumn<=e.endColumn&&t.endColumn>=e.startColumn))}_getCurrentSelections(){let e=this._currentSelectionPos;if(!e)return[];let{unitId:t,sheetId:r}=e;return this._ensureWorkbookSelection(t).getSelectionsOfWorksheet(r)}getWorkbookSelections(e){return this._ensureWorkbookSelection(e)}_ensureWorkbookSelection(e){let t=this._workbookSelections.get(e);if(!t){let r=this._instanceSrv.getUnit(e);if(!r)throw Error(`[SheetsSelectionsService]: cannot resolve unit with id "${e}"!`);t=new W(r),this._workbookSelections.set(e,t)}return t}_removeWorkbookSelection(e){this._workbookSelections.delete(e)}};z=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?Y(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&G(t,r,s),s})([(o=p.IUniverInstanceService,(e,t)=>o(e,t,0))],z);let q="DISABLE_NORMAL_SELECTIONS",X={CELL_CONTENT:(0,p.createInterceptorKey)("CELL_CONTENT"),ROW_FILTERED:(0,p.createInterceptorKey)("ROW_FILTERED")};var K=((l=K||{})[l.DATA_VALIDATION=9]="DATA_VALIDATION",l[l.NUMFMT=10]="NUMFMT",l),Q=Object.defineProperty,Z=Object.getOwnPropertyDescriptor;let J=(0,p.createInterceptorKey)("BEFORE_CELL_EDIT"),ee=(0,p.createInterceptorKey)("AFTER_CELL_EDIT"),et=(0,p.createInterceptorKey)("AFTER_CELL_EDIT_ASYNC"),er=class extends p.Disposable{constructor(e){super(),x(this,"_interceptorsByName",/* @__PURE__ */new Map),x(this,"_commandInterceptors",[]),x(this,"_rangeInterceptors",[]),x(this,"_beforeCommandInterceptor",[]),x(this,"_workbookDisposables",/* @__PURE__ */new Map),x(this,"_worksheetDisposables",/* @__PURE__ */new Map),x(this,"writeCellInterceptor",new p.InterceptorManager({BEFORE_CELL_EDIT:J,AFTER_CELL_EDIT:ee,AFTER_CELL_EDIT_ASYNC:et})),this._univerInstanceService=e,this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(p.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._interceptWorkbook(e)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(p.UniverInstanceType.UNIVER_SHEET).subscribe(e=>this._disposeWorkbookInterceptor(e))),this.intercept(X.CELL_CONTENT,{priority:-1,effect:p.InterceptorEffectEnum.Style|p.InterceptorEffectEnum.Value,handler(e,t){let r=t.worksheet.getCellRaw(t.row,t.col);return e?{...r,...e}:r}}),this.disposeWithMe(this.writeCellInterceptor.intercept(ee,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(J,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(et,{priority:-1,handler:e=>e}))}dispose(){super.dispose(),this._workbookDisposables.forEach(e=>e.dispose()),this._workbookDisposables.clear(),this._worksheetDisposables.clear()}interceptCommand(e){if(this._commandInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._commandInterceptors.push(e),this._commandInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,p.toDisposable)(()=>(0,p.remove)(this._commandInterceptors,e)))}onCommandExecute(e){let t=this._commandInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}interceptBeforeCommand(e){if(this._beforeCommandInterceptor.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._beforeCommandInterceptor.push(e),this._beforeCommandInterceptor.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,p.toDisposable)(()=>(0,p.remove)(this._beforeCommandInterceptor,e)))}async beforeCommandExecute(e){return(await Promise.all(this._beforeCommandInterceptor.map(t=>t.performCheck(e)))).every(e=>e)}interceptRanges(e){if(this._rangeInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._rangeInterceptors.push(e),this._rangeInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,p.toDisposable)(()=>(0,p.remove)(this._rangeInterceptors,e)))}generateMutationsByRanges(e){let t=this._rangeInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}async onWriteCell(e,t,r,n,i){let s={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:r,col:n,origin:(0,p.Tools).deepClone(i)},a=this.writeCellInterceptor.fetchThroughInterceptors(ee)(i,s);return await this.writeCellInterceptor.fetchThroughInterceptors(et)(Promise.resolve(a),s)}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);r.push(t);let n=r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)});if(e===X.CELL_CONTENT){this._interceptorsByName.set(`${e}-${p.InterceptorEffectEnum.Style|p.InterceptorEffectEnum.Value}`,n);let t=p.InterceptorEffectEnum.Style|p.InterceptorEffectEnum.Value;this._interceptorsByName.set(`${e}-${p.InterceptorEffectEnum.Style}`,n.filter(e=>((e.effect||t)&p.InterceptorEffectEnum.Style)>0)),this._interceptorsByName.set(`${e}-${p.InterceptorEffectEnum.Value}`,n.filter(e=>((e.effect||t)&p.InterceptorEffectEnum.Value)>0))}else this._interceptorsByName.set(e,n);return this.disposeWithMe((0,p.toDisposable)(()=>(0,p.remove)(this._interceptorsByName.get(e),t)))}fetchThroughInterceptors(e,t){let r=void 0===t?e:`${e}-${t}`,n=this._interceptorsByName.get(r);return(0,p.composeInterceptors)(n||[])}_interceptWorkbook(e){let t=new p.DisposableCollection,r=e.getUnitId(),n=this,i=t=>{let i=t.getSheetId();t.__interceptViewModel(s=>{let a=new p.DisposableCollection;n._worksheetDisposables.set(en(r,t),a),a.add(s.registerCellContentInterceptor({getCell(s,a,o){let l=t.getCellRaw(s,a);return n.fetchThroughInterceptors(X.CELL_CONTENT,o)(l,{unitId:r,subUnitId:i,row:s,col:a,worksheet:t,workbook:e,rawData:l})}})),a.add(s.registerRowFilteredInterceptor({getRowFiltered:s=>!!n.fetchThroughInterceptors(X.ROW_FILTERED)(!1,{unitId:r,subUnitId:i,row:s,workbook:e,worksheet:t})}))})};e.getSheets().forEach(e=>i(e)),t.add(e.sheetCreated$.subscribe(e=>i(e))),t.add((0,p.toDisposable)(()=>e.getSheets().forEach(e=>this._disposeSheetInterceptor(r,e)))),t.add(e.sheetDisposed$.subscribe(e=>this._disposeSheetInterceptor(r,e))),this._workbookDisposables.set(r,t)}_disposeWorkbookInterceptor(e){let t=e.getUnitId(),r=this._workbookDisposables.get(t);r&&(r.dispose(),this._workbookDisposables.delete(t))}_disposeSheetInterceptor(e,t){let r=en(e,t),n=this._worksheetDisposables.get(r);n&&(n.dispose(),this._worksheetDisposables.delete(r))}};function en(e,t){return`${e}|${t.getSheetId()}`}function ei(e,t,r=!1){if(null===t)return t;if(void 0===t)return e;let n=(0,p.Tools).deepClone(e)||{};for(let e in t)r&&["bd","tr","td","ht","vt","tb","pd","bg"].includes(e)||(e in n&&"bd"===e?n[e]=Object.assign(n[e],t[e]):n[e]=t[e]);return"cl"in n&&("ul"in n&&n.ul&&(n.ul.cl=n.cl),"ol"in n&&n.ol&&(n.ol.cl=n.cl),"st"in n&&n.st&&(n.st.cl=n.cl)),n}function es(e,t){return void 0!==e.v?eo(e.v,e.t):eo(t.v,t.t)}function ea(e){var t;return(null==(t=null==e?void 0:e.n)?void 0:t.pattern)===O.DEFAULT_TEXT_FORMAT}function eo(e,t){return null===e?null:"string"==typeof e?(0,p.isRealNum)(e)?(0==+e||1==+e)&&t===p.CellValueType.BOOLEAN?p.CellValueType.BOOLEAN:p.CellValueType.NUMBER:(0,p.isBooleanString)(e)?p.CellValueType.BOOLEAN:p.CellValueType.STRING:"number"==typeof e?(0===e||1===e)&&t===p.CellValueType.BOOLEAN?p.CellValueType.BOOLEAN:p.CellValueType.NUMBER:"boolean"==typeof e?p.CellValueType.BOOLEAN:p.CellValueType.FORCE_STRING}function el(e,t){return e===p.CellValueType.NUMBER?Number(t.v):e===p.CellValueType.BOOLEAN?!function(e){if("string"==typeof e){if("TRUE"===e.toUpperCase())return!0;if("FALSE"===e.toUpperCase())return!1;if((0,p.isSafeNumeric)(e)){if(0===Number(e))return!1;if(1===Number(e))return!0}}if("number"==typeof e){if(0===e)return!1;if(1===e)return!0}return"boolean"==typeof e?e:null}(t.v)?0:1:e===p.CellValueType.STRING||e===p.CellValueType.FORCE_STRING?`${t.v}`:t.v}er=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?Z(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&Q(t,r,s),s})([(u=p.IUniverInstanceService,(e,t)=>u(e,t,0))],er);let eu=(e,t)=>{let{unitId:r,subUnitId:n,cellValue:i}=t,s=e.get(p.IUniverInstanceService).getUniverSheetInstance(r);if(null==s)throw Error("workbook is null error!");let a=s.getSheetBySheetId(n);if(null==a)throw Error("worksheet is null error!");let o=a.getCellMatrix(),l=s.getStyles(),u=new p.ObjectMatrix;return new(0,p.ObjectMatrix)(i).forValue((e,t,r)=>{let n=(0,p.Tools).deepClone(null==o?void 0:o.getValue(e,t))||{},i=l.getStyleByCell(n),s=l.getStyleByCell(r);n.s=function(e,t){if(!t||!Object.keys(t).length)return e;let r=e||{};for(let e in t)"bd"===e?r[e]=function(e,t){if(!t||!Object.keys(t).length)return e;for(let r in t)r in e||(e[r]=null);return e}(r[e]||{},t[e]):e in r||(r[e]=null);return r}(i,s),u.setValue(e,t,null==n?null:(void 0===n.f&&(n.f=null),void 0===n.si&&(n.si=null),void 0===n.p&&(n.p=null),void 0===n.v&&(n.v=null),void 0===n.t&&(n.t=null),void 0===n.s&&(n.s=null),void 0===n.custom&&(n.custom=null),n))}),{...t,options:{},cellValue:u.getMatrix()}},ec={id:"sheet.mutation.set-range-values",type:p.CommandType.MUTATION,handler:(e,t)=>{let{cellValue:r,subUnitId:n,unitId:i}=t,s=e.get(p.IUniverInstanceService).getUnit(i);if(!s)return!1;let a=s.getSheetBySheetId(n);if(!a)return!1;let o=a.getCellMatrix(),l=s.getStyles();return new(0,p.ObjectMatrix)(r).forValue((e,t,r)=>{if(r){let n=o.getValue(e,t)||{},i=function(e,t,r){var n;if(t.t)return t.t;if(null===t.v)return null;let i=e.getStyleByCell(t),s=e.getStyleByCell(r);if(r.t===p.CellValueType.FORCE_STRING){if(!ea(s)&&void 0!==t.v){if((0,p.isRealNum)(t.v))return p.CellValueType.NUMBER;if((0,p.isBooleanString)(`${t.v}`))return p.CellValueType.BOOLEAN}return p.CellValueType.FORCE_STRING}return null!=(n=null==i?void 0:i.n)&&n.pattern?ea(i)?p.CellValueType.STRING:es(t,r):ea(s)?p.CellValueType.STRING:es(t,r)}(l,r,n);void 0!==r.f&&(n.f=r.f),void 0!==r.si&&(n.si=r.si),void 0!==r.p&&(n.p=r.p),void 0!==r.v&&(n.v=el(i,r)),void 0!==n.v&&(n.t=i,n.v=el(i,n)),void 0!==r.s&&function(e,t,r){var n;let i=e.getStyleByCell(t);null==i&&delete t.s,"string"==typeof r.s&&(r.s=e.get(r.s));let s=ei(i,r.s?r.s:null);s&&(0,p.Tools).removeNull(s),(0,p.Tools).isEmptyObject(s)?delete t.s:t.s=e.setValue(s);let a=r.v?`${r.v}\r
`:"";!r.p&&t.p&&(a&&a!==(null==(n=t.p.body)?void 0:n.dataStream)?delete t.p:function(e,t){var r;if(null==e.body)return;Array.isArray(e.body.textRuns)||(e.body.textRuns=[]);let n=0,i=[],s=(null==(r=e.body)?void 0:r.paragraphs)||[];for(let r of e.body.textRuns){let{st:e,ed:a,ts:o={}}=r;if(n<e){let r={st:n,ed:e},s=ei({},t,!0);s&&(0,p.Tools).removeNull(s),(0,p.Tools).isEmptyObject(s)||(r.ts=s),i.push(r)}let l=ei(o,t,!0);l&&(0,p.Tools).removeNull(l),(0,p.Tools).isEmptyObject(l)?delete r.ts:r.ts=l,i.push(r),n=function e(t,r){return t.some(e=>e.startIndex===r)?e(t,r+1):r}(s,a)}let a=e.body.dataStream.endsWith(`\r
`)?e.body.dataStream.length-2:e.body.dataStream.length;if(n<a){let e={st:n,ed:a},r=ei({},t,!0);r&&(0,p.Tools).removeNull(r),(0,p.Tools).isEmptyObject(r)||(e.ts=r),i.push(e)}e.body.textRuns=(0,p.normalizeTextRuns)(i)}(t.p,r.s?r.s:null))}(l,n,r),void 0!==r.custom&&(n.custom=r.custom),o.setValue(e,t,(0,p.Tools).removeNull(n))}else null==o||o.setValue(e,t,{})}),!0}},eh=(e,t,r="")=>e.reduce((e,n)=>{let i=n&&n[t];return"string"!=typeof i?console.warn(n,`${t} is not string`):i?(e[i]||(e[i]=[]),e[i].push(n)):e[r].push(n),e},{}),ed=(e=0)=>{let t=e;return function(){return t++}};function em(e){let t=new p.ObjectMatrix;return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,null)}),t.clone()}function eg(e){let t=new p.ObjectMatrix;return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{v:null,p:null,f:null,si:null,custom:null})}),t.clone()}let ef={id:"sheet.command.clear-selection-all",type:p.CommandType.COMMAND,handler:async e=>{var t;let r=e.get(p.IUniverInstanceService),n=e.get(p.ICommandService),i=e.get(z),s=e.get(p.IUndoRedoService),a=e.get(er),o=r.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getUnitId(),u=o.getActiveSheet();if(!u)return!1;let c=u.getSheetId(),h=null==(t=i.getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d=[],m=[],g={subUnitId:c,unitId:l,cellValue:em(h)},f=eu(e,g);d.push({id:ec.id,params:g}),m.push({id:ec.id,params:f});let C=a.onCommandExecute({id:ef.id});return d.push(...C.redos),m.unshift(...C.undos),!!(0,p.sequenceExecute)(d,n)&&(s.pushUndoRedo({unitID:l,undoMutations:m,redoMutations:d}),!0)}},ep={id:"sheet.command.clear-selection-content",type:p.CommandType.COMMAND,handler:async e=>{var t;let r=e.get(p.IUniverInstanceService),n=e.get(p.ICommandService),i=e.get(z),s=e.get(p.IUndoRedoService),a=e.get(er),o=r.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getUnitId(),u=o.getActiveSheet();if(!u)return!1;let c=u.getSheetId(),h=null==(t=i.getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d={subUnitId:c,unitId:l,cellValue:eg(h)},m=eu(e,d),g=a.onCommandExecute({id:ep.id}),f=[{id:ec.id,params:d},...g.redos],C=[...g.undos,{id:ec.id,params:m}];return!!(0,p.sequenceExecute)(f,n).result&&(s.pushUndoRedo({unitID:l,undoMutations:C,redoMutations:f}),!0)}},eC={id:"sheet.command.clear-selection-format",type:p.CommandType.COMMAND,handler:async e=>{var t;let r=e.get(p.IUniverInstanceService),n=e.get(p.ICommandService),i=e.get(z),s=e.get(p.IUndoRedoService),a=e.get(er),o=r.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getUnitId(),u=o.getActiveSheet();if(!u)return!1;let c=u.getSheetId(),h=null==(t=i.getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d=[],m=[],g={subUnitId:c,unitId:l,cellValue:function(e){let t=new p.ObjectMatrix;return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{s:null})}),t.clone()}(h)},f=eu(e,g);d.push({id:ec.id,params:g}),m.push({id:ec.id,params:f});let C=a.onCommandExecute({id:eC.id});return d.push(...C.redos),m.unshift(...C.undos),!!(0,p.sequenceExecute)(d,n)&&(s.pushUndoRedo({unitID:l,undoMutations:m,redoMutations:d}),!0)}},e_=(e,t)=>({subUnitId:t.sheet.id,unitId:t.unitId,subUnitName:t.sheet.name}),ey={id:"sheet.mutation.insert-sheet",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService),{sheet:n,index:i,unitId:s}=t,a=r.getUniverSheetInstance(s);return!!a&&a.addWorksheet(n.id,i,n)}};function eE(e,t={}){let{unitId:r,subUnitId:n}=t,i=r?e.getUniverSheetInstance(r):e.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!i)return null;let s=n?i.getSheetBySheetId(n):i.getActiveSheet(!0);return s?{worksheet:s,workbook:i,unitId:i.getUnitId(),subUnitId:s.getSheetId()}:null}function eb(e,t){let{unitId:r,subUnitId:n}=t,i=e.getUniverSheetInstance(r);if(!i)return null;let s=i.getSheetBySheetId(n);return s?{worksheet:s,workbook:i}:null}let eR=(e,t)=>{let r=e.get(p.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=eb(r,t);if(!s)throw Error("[RemoveSheetUndoMutationFactory]: Worksheet is null error!");let{workbook:a,worksheet:o}=s,l=o.getConfig();return{index:a.getConfig().sheetOrder.findIndex(e=>e===n),sheet:l,unitId:i}},eN={id:"sheet.mutation.remove-sheet",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=r.getUniverSheetInstance(i);return!!s&&s.removeSheet(n)}},eI={type:p.CommandType.COMMAND,id:"sheet.command.copy-sheet",handler:async(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService),o=e.get(er),l=e.get(p.LocaleService),u=eE(a,t);if(!u)return!1;let{workbook:c,worksheet:h,unitId:d,subUnitId:m}=u,g=(0,p.Tools).deepClone(h.getConfig());g.name=function(e,t,r){let n=r+t.t("sheets.tabs.sheetCopy",""),i=2;for(;e.checkSheetName(n);)n=r+t.t("sheets.tabs.sheetCopy",`${i}`),i++;return n}(c,l,g.name),g.id=(0,p.Tools).generateRandomId();let f={index:c.getSheetIndex(h)+1,sheet:g,unitId:d},C=e_(e,f),_=o.onCommandExecute({id:eI.id,params:{unitId:d,subUnitId:m,targetSubUnitId:g.id}}),y=[...null!=(r=_.preRedos)?r:[],{id:ey.id,params:f},..._.redos],E=[...null!=(n=_.preUndos)?n:[],{id:eN.id,params:C},..._.undos];return!!(0,p.sequenceExecute)(y,i).result&&(s.pushUndoRedo({unitID:d,undoMutations:E,redoMutations:y}),!0)}},eA={id:"sheet.mutation.move-range",type:p.CommandType.MUTATION,handler:(e,t)=>{let{from:r,to:n}=t;if(!r||!n)return!1;let i=e.get(p.IUniverInstanceService).getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getSheetBySheetId(t.from.subUnitId),a=i.getSheetBySheetId(t.to.subUnitId);if(!s||!a)return!1;let o=s.getCellMatrix(),l=a.getCellMatrix();return new(0,p.ObjectMatrix)(r.value).forValue((e,t,r)=>{o.setValue(e,t,r)}),new(0,p.ObjectMatrix)(n.value).forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}};var ev=Object.defineProperty,eS=Object.getOwnPropertyDescriptor;let eT=(0,p.createIdentifier)("sheets-formula.ref-selections.service"),eO=class extends z{constructor(e){super(e)}_init(){let e=this._getAliveWorkbooks$().pipe((0,T.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,S.switchMap)(e=>(0,N.merge)(...e.map(e=>e.selectionMoveStart$)))),this.selectionMoving$=e.pipe((0,S.switchMap)(e=>(0,N.merge)(...e.map(e=>e.selectionMoving$)))),this.selectionMoveEnd$=e.pipe((0,S.switchMap)(e=>(0,N.merge)(...e.map(e=>e.selectionMoveEnd$))))}_getAliveWorkbooks$(){let e=this._instanceSrv.getAllUnitsForType(p.UniverInstanceType.UNIVER_SHEET);e.forEach(e=>this._ensureWorkbookSelection(e.getUnitId()));let t=new y.BehaviorSubject(e);return this.disposeWithMe(this._instanceSrv.getTypeOfUnitAdded$(p.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._ensureWorkbookSelection(e.getUnitId()),t.next([...t.getValue(),e])})),this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(p.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId()),t.next(t.getValue().filter(t=>t!==e))})),t.pipe((0,R.map)(e=>e.map(e=>this._ensureWorkbookSelection(e.getUnitId()))))}};function eM(e){let t=e.get(p.IContextService).getContextValue(q);return e.get(t?eT:z)}eO=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?eS(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&ev(t,r,s),s})([(c=p.IUniverInstanceService,(e,t)=>c(e,t,0))],eO);let ew={id:"sheet.operation.set-selections",type:p.CommandType.OPERATION,handler:(e,t)=>{if(!t)return!1;let{selections:r,type:n,unitId:i,subUnitId:s}=t;return eM(e).setSelections(i,s,[...r],n),!0}};function ex(e,t,r=!0){let n=t.getMatrixWithMergedCells(...(0,p.selectionToArray)(e)),i=[];if(n.forValue((t,r,n)=>{if(void 0!==n.colSpan&&void 0!==n.rowSpan){let s={startRow:t,startColumn:r,endRow:t+n.rowSpan-1,endColumn:r+n.colSpan-1};(0,p.Rectangle).contains(e,s)||i.push(s)}}),0===i.length)return e;let s=(0,p.Rectangle).union(e,...i);return r?ex(s,t,r):s}function eU(e,t,r){let n=null;return r.getMatrixWithMergedCells(e,t,e,t).forValue((e,t,r)=>(n={actualRow:e,actualColumn:t,startRow:e,startColumn:t,isMerged:void 0!==r.rowSpan||void 0!==r.colSpan,isMergedMainCell:void 0!==r.rowSpan&&void 0!==r.colSpan,endRow:e+(void 0!==r.rowSpan?r.rowSpan-1:0),endColumn:t+(void 0!==r.colSpan?r.colSpan-1:0),rangeType:p.RANGE_TYPE.NORMAL},!1)),n||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:p.RANGE_TYPE.NORMAL}}function eD(e,t,r){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return Number.isNaN(n)&&(e.startRow=0),Number.isNaN(s)&&(e.endRow=t-1),Number.isNaN(i)&&(e.startColumn=0),Number.isNaN(a)&&(e.endColumn=r-1),e}function eV(e,t){let r=Number.isNaN(e.startRow)?0:e.startRow,n=Number.isNaN(e.startColumn)?0:e.startColumn,i=t.getMergedCell(r,n);return i?{...i,actualRow:r,actualColumn:n,rangeType:p.RANGE_TYPE.NORMAL,isMerged:!0,isMergedMainCell:!0}:{startRow:r,startColumn:n,endRow:e.startRow,endColumn:e.startColumn,actualRow:r,actualColumn:n,rangeType:p.RANGE_TYPE.NORMAL,isMerged:!1,isMergedMainCell:!1}}let eL=(e,t,r)=>({id:ew.id,params:{unitId:t.getUnitId(),subUnitId:r.getSheetId(),reveal:!0,selections:[{range:e,primary:eV(e,r)}]}});function eP(e,t,r,n,i,s,a){let o={};for(let l=t;l<=r;l++)for(let t=n;t<=i;t++){let r=s?e.getCell(a,t):e.getCell(l,a);r&&r.s&&(o[l]||(o[l]={}),o[l][t]={s:r.s})}return o}let ej="sheet.command.move-range",eF={type:p.CommandType.COMMAND,id:ej,handler:async(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService),o=e.get(p.ErrorService),l=e.get(p.LocaleService),u=e.get(er),c=eE(a);if(!c||!await u.beforeCommandExecute({id:eF.id,params:t}))return!1;let{worksheet:h,subUnitId:d,unitId:m}=c,g=ek(e,{unitId:m,subUnitId:d,range:t.fromRange},{unitId:m,subUnitId:d,range:t.toRange});if(null===g)return o.emit(l.t("sheets.info.acrossMergedCell")),!1;let f=u.onCommandExecute({id:eF.id,params:{...t}}),C=[...null!=(r=f.preRedos)?r:[],...g.redos,...f.redos,{id:ew.id,params:{unitId:m,subUnitId:d,selections:[{range:t.toRange,primary:eV(t.toRange,h)}]}}],_=[...null!=(n=f.preUndos)?n:[],...g.undos,...f.undos,{id:ew.id,params:{unitId:m,subUnitId:d,selections:[{range:t.fromRange,primary:eV(t.fromRange,h)}]}}];return!!(0,p.sequenceExecute)(C,i).result&&(s.pushUndoRedo({unitID:m,undoMutations:_,redoMutations:C}),!0)}};function ek(e,t,r,n=!1){let i=[],s=[],{range:a,subUnitId:o,unitId:l}=t,{range:u,subUnitId:c}=r,h=e.get(p.IUniverInstanceService).getUniverSheetInstance(l),d=null==h?void 0:h.getSheetBySheetId(c),m=null==h?void 0:h.getSheetBySheetId(o),g=null==d?void 0:d.getCellMatrix(),f=null==m?void 0:m.getCellMatrix();if(d&&m&&g&&f){let e=ex(u,d,!1);if(!(0,p.Rectangle).equals(u,e)&&!n)return null;let m=new p.ObjectMatrix,C=new p.ObjectMatrix,_=new p.ObjectMatrix;(0,p.Range).foreach(a,(e,t)=>{let r=f.getValue(e,t);if(m.setValue(e,t,(0,p.Tools).deepClone(r)),r){let n=null==h?void 0:h.getStyles().get(r.s);_.setValue(e,t,(0,p.Tools).deepClone(n))}C.setValue(e,t,null)});let y=new p.ObjectMatrix,E=new p.ObjectMatrix;(0,p.Range).foreach(u,(e,t)=>{y.setValue(e,t,(0,p.Tools).deepClone(g.getValue(e,t)))}),(0,p.Range).foreach(a,(e,t)=>{let r=(0,p.cellToRange)(e,t),n=(0,p.Rectangle).getRelativeRange(r,a),i=(0,p.Rectangle).getPositionRange(n,u),s=(0,p.Tools).deepClone(_.getValue(e,t)),o=(0,p.Tools).deepClone(m.getValue(e,t));o&&s&&(o.s=s),E.setValue(i.startRow,i.startColumn,o)});let b={fromRange:t.range,toRange:r.range,from:{value:C.getMatrix(),subUnitId:o},to:{value:E.getMatrix(),subUnitId:c},unitId:l},R={fromRange:r.range,toRange:t.range,from:{value:m.getMatrix(),subUnitId:o},to:{value:y.getMatrix(),subUnitId:c},unitId:l};i.push({id:eA.id,params:b}),s.push({id:eA.id,params:R})}return{redos:i,undos:s}}var eB=((h=eB||{})[h.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",h[h.UNIVER_DOC=1]="UNIVER_DOC",h[h.UNIVER_SHEET=2]="UNIVER_SHEET",h[h.UNIVER_SLIDE=3]="UNIVER_SLIDE",h[h.UNIVER_PROJECT=4]="UNIVER_PROJECT",h[h.UNRECOGNIZED=-1]="UNRECOGNIZED",h),e$=((d=e$||{})[d.View=0]="View",d[d.Edit=1]="Edit",d[d.ManageCollaborator=2]="ManageCollaborator",d[d.Print=3]="Print",d[d.Duplicate=4]="Duplicate",d[d.Comment=5]="Comment",d[d.Copy=6]="Copy",d[d.Share=7]="Share",d[d.Export=8]="Export",d[d.MoveWorksheet=9]="MoveWorksheet",d[d.DeleteWorksheet=10]="DeleteWorksheet",d[d.HideWorksheet=11]="HideWorksheet",d[d.RenameWorksheet=12]="RenameWorksheet",d[d.CreateWorksheet=13]="CreateWorksheet",d[d.SetWorksheetStyle=14]="SetWorksheetStyle",d[d.EditWorksheetCell=15]="EditWorksheetCell",d[d.InsertHyperlink=16]="InsertHyperlink",d[d.Sort=17]="Sort",d[d.Filter=18]="Filter",d[d.PivotTable=19]="PivotTable",d[d.FloatImg=20]="FloatImg",d[d.History=21]="History",d[d.RwHgtClWdt=22]="RwHgtClWdt",d[d.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",d[d.ViewFilter=24]="ViewFilter",d[d.MoveSheet=25]="MoveSheet",d[d.DeleteSheet=26]="DeleteSheet",d[d.HideSheet=27]="HideSheet",d[d.CopySheet=28]="CopySheet",d[d.RenameSheet=29]="RenameSheet",d[d.CreateSheet=30]="CreateSheet",d[d.SelectProtectedCells=31]="SelectProtectedCells",d[d.SelectUnProtectedCells=32]="SelectUnProtectedCells",d[d.SetCellStyle=33]="SetCellStyle",d[d.SetCellValue=34]="SetCellValue",d[d.SetRowStyle=35]="SetRowStyle",d[d.SetColumnStyle=36]="SetColumnStyle",d[d.InsertRow=37]="InsertRow",d[d.InsertColumn=38]="InsertColumn",d[d.DeleteRow=39]="DeleteRow",d[d.DeleteColumn=40]="DeleteColumn",d[d.EditExtraObject=41]="EditExtraObject",d[d.Delete=42]="Delete",d[d.RecoverHistory=43]="RecoverHistory",d[d.ViewHistory=44]="ViewHistory",d[d.CreatePermissionObject=45]="CreatePermissionObject",d[d.UNRECOGNIZED=-1]="UNRECOGNIZED",d),eH=((m=eH||{})[m.Unkonwn=0]="Unkonwn",m[m.Workbook=1]="Workbook",m[m.Worksheet=2]="Worksheet",m[m.SelectRange=3]="SelectRange",m[m.Document=4]="Document",m[m.Slide=5]="Slide",m[m.UNRECOGNIZED=-1]="UNRECOGNIZED",m);class eW{constructor(e,t,r){x(this,"type",eH.SelectRange),x(this,"subType",e$.Edit),x(this,"status",p.PermissionStatus.INIT),x(this,"value",!0),x(this,"id"),x(this,"unitId"),x(this,"subUnitId"),x(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${eH.SelectRange}.${e$.Edit}.${r}`}}class eG{constructor(e,t,r){x(this,"type",eH.SelectRange),x(this,"subType",e$.View),x(this,"status",p.PermissionStatus.INIT),x(this,"value",!0),x(this,"id"),x(this,"unitId"),x(this,"subUnitId"),x(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${eH.SelectRange}.${e$.View}.${r}`}}class eY{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Comment),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Comment}_${e}`}}class ez{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Copy),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Copy}_${e}`}}class eq{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"subType",e$.CopySheet),x(this,"status",p.PermissionStatus.INIT),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.CopySheet}_${e}`}}class eX{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.CreatePermissionObject),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.CreatePermissionObject}_${e}`}}class eK{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.CreateSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.CreateSheet}_${e}`}}class eQ{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.DeleteSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.DeleteSheet}_${e}`}}class eZ{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Duplicate),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Duplicate}_${e}`}}class eJ{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Edit),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Edit}_${e}`}}class e0{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Export),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Export}_${e}`}}class e1{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.HideSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.HideSheet}_${e}`}}class e2{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.ManageCollaborator),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.ManageCollaborator}_${e}`}}class e5{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.MoveSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.MoveSheet}_${e}`}}class e3{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Print),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Print}_${e}`}}class e4{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.RecoverHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.RecoverHistory}_${e}`}}class e6{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.RenameSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.RenameSheet}_${e}`}}class e9{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.Share),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.Share}_${e}`}}class e7{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.View),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.View}_${e}`}}class e8{constructor(e){x(this,"id"),x(this,"value",!0),x(this,"type",eH.Workbook),x(this,"status",p.PermissionStatus.INIT),x(this,"subType",e$.ViewHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${e$.ViewHistory}_${e}`}}class te{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.Copy),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.Copy}_${e}_${t}`}}class tt{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.DeleteColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.DeleteColumn}_${e}_${t}`}}class tr{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.Delete),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.Delete}_${e}_${t}`}}class tn{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.DeleteRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.DeleteRow}_${e}_${t}`}}class ti{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.Edit),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.Edit}_${e}_${t}`}}class ts{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.EditExtraObject),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.EditExtraObject}_${e}_${t}`}}class ta{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.Filter),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.Filter}_${e}_${t}`}}class to{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.InsertColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.InsertColumn}_${e}_${t}`}}class tl{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.InsertHyperlink),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.InsertHyperlink}_${e}_${t}`}}class tu{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.InsertRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.InsertRow}_${e}_${t}`}}class tc{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.ManageCollaborator),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.ManageCollaborator}_${e}_${t}`}}class th{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.PivotTable),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.PivotTable}_${e}_${t}`}}class td{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.SetCellStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.SetCellStyle}_${e}_${t}`}}class tm{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.SetCellValue),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.SetCellValue}_${e}_${t}`}}class tg{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.SetColumnStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.SetColumnStyle}_${e}_${t}`}}class tf{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.SetRowStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.SetRowStyle}_${e}_${t}`}}class tp{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.Sort),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.Sort}_${e}_${t}`}}class tC{constructor(e,t){x(this,"value",!0),x(this,"type",eH.Worksheet),x(this,"status",p.PermissionStatus.INIT),x(this,"id"),x(this,"subType",e$.View),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${e$.View}_${e}_${t}`}}let t_={id:"sheet.command.set-range-values",type:p.CommandType.COMMAND,handler:(e,t)=>{var r;let n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService),o=e.get(z),l=e.get(er),u=e.get(p.IPermissionService),c=eE(a,t);if(!c)return!1;let{subUnitId:h,unitId:d,workbook:m,worksheet:g}=c,{value:f,range:C}=t,_=C?[C]:null==(r=o.getCurrentSelections())?void 0:r.map(e=>e.range);if(!_||!_.length||!u.getPermissionPoint(new ti(d,h).id))return!1;let y=new p.ObjectMatrix;if((0,p.Tools).isArray(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=0;e<=n-t;e++)for(let n=0;n<=i-r;n++)y.setValue(e+t,n+r,f[e][n])}else if((0,p.isICellData)(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)y.setValue(e,t,f)}else n=f;let E={subUnitId:h,unitId:d,cellValue:null!=n?n:y.getMatrix()},b=eu(e,E);if(!i.syncExecuteCommand(ec.id,E))return!1;let{undos:R,redos:N}=l.onCommandExecute({id:t_.id,params:{...E,range:_}});if((0,p.sequenceExecute)([...N],i).result){let e=eL(null!=C?C:y.getRange(),m,g);return s.pushUndoRedo({unitID:d,undoMutations:[{id:ec.id,params:b},...R,e],redoMutations:[{id:ec.id,params:E},...N,(0,p.Tools).deepClone(e)]}),!0}return!1}};function ty(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o,cellValue:l={}}=t,u=e.get(p.IUniverInstanceService),c=e.get(er),h=u.getUniverSheetInstance(i),d=null==h?void 0:h.getSheetBySheetId(s);if(d){let t=d.getCellMatrix(),u=t.getDataRange();if(a.startColumn<=u.endColumn||a.startRow<=u.endRow){let l,c;if(o===p.Dimension.COLUMNS){let e=Math.min(a.endRow,u.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,p.getArrayLength)(e)-1:0)}l={startRow:a.startRow,startColumn:a.startColumn,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:l.startColumn+n,endRow:e,endColumn:l.endColumn+n}}else{let e=Math.min(a.endColumn,u.endColumn),t=u.endRow;l={startRow:a.startRow,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:l.startRow+r,startColumn:a.startColumn,endRow:l.endRow+r,endColumn:e}}let h=ek(e,{unitId:i,subUnitId:s,range:l},{unitId:i,subUnitId:s,range:c},!0);h&&(r.push(...h.redos),n.push(...h.undos))}if(0===Object.entries(l).length)for(let e=a.startRow;e<=a.endRow;e++){l[e]||(l[e]={});for(let t=a.startColumn;t<=a.endColumn;t++)l[e][t]=null}let h={subUnitId:s,unitId:i,cellValue:l},m=eu(e,h),{undos:g,redos:f}=c.onCommandExecute({id:t_.id,params:{...h,range:a}});r.push({id:ec.id,params:h},...f),n.push({id:ec.id,params:m},...g)}return{redo:r,undo:n}}function tE(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o}=t,l=e.get(p.IUniverInstanceService),u=e.get(er),c=l.getUniverSheetInstance(i),h=null==c?void 0:c.getSheetBySheetId(s);if(h){let t=h.getCellMatrix(),l=t.getDataRange(),c={subUnitId:s,unitId:i,cellValue:em([a])},d=eu(e,c),m=u.onCommandExecute({id:t_.id,params:c});if(r.push({id:ec.id,params:c},...m.redos),n.push(...m.undos,{id:ec.id,params:d}),a.startColumn<=l.endColumn||a.startRow<=l.endRow){let u=null,c=null;if(o===p.Dimension.COLUMNS&&a.endColumn<l.endColumn){let e=Math.min(a.endRow,l.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,p.getArrayLength)(e)-1:0)}u={startRow:a.startRow,startColumn:a.endColumn+1,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:u.startColumn-n,endRow:e,endColumn:u.endColumn-n}}if(o===p.Dimension.ROWS&&a.endRow<l.endRow){let e=Math.min(a.endColumn,l.endColumn),t=l.endRow;u={startRow:a.endRow+1,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:u.startRow-r,startColumn:a.startColumn,endRow:u.endRow-r,endColumn:e}}if(u&&c){let t=ek(e,{unitId:i,subUnitId:s,range:u},{unitId:i,subUnitId:s,range:c},!0);t&&(r.push(...t.redos),n.push(...t.undos))}}}return{redo:r,undo:n}}let tb="sheet.command.delete-range-move-left",tR={type:p.CommandType.COMMAND,id:tb,handler:async(e,t)=>{var r,n,i;let s=e.get(p.ICommandService),a=e.get(p.IUndoRedoService),o=e.get(p.IUniverInstanceService),l=e.get(z),u=e.get(er),c=eE(o);if(!c)return!1;let{worksheet:h,workbook:d,subUnitId:m,unitId:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let C={range:f,subUnitId:m,unitId:g,shiftDimension:p.Dimension.COLUMNS},_=u.onCommandExecute({id:tR.id,params:{range:f}}),{redo:y,undo:E}=tE(e,C),b=[...null!=(n=_.preRedos)?n:[],...y],R=[..._.undos,...E];return b.push(..._.redos),b.push(eL(f,d,h)),R.push(...null!=(i=_.preUndos)?i:[]),!!(0,p.sequenceExecute)(b,s).result&&(a.pushUndoRedo({unitID:g,undoMutations:R.reverse(),redoMutations:b}),!0)}},tN="sheet.command.delete-range-move-up",tI={type:p.CommandType.COMMAND,id:tN,handler:async(e,t)=>{var r,n,i;let s=e.get(p.ICommandService),a=e.get(p.IUndoRedoService),o=e.get(p.IUniverInstanceService),l=e.get(z),u=e.get(er),c=eE(o);if(!c)return!1;let{unitId:h,subUnitId:d,workbook:m,worksheet:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let C={range:f,subUnitId:d,unitId:h,shiftDimension:p.Dimension.ROWS},_=u.onCommandExecute({id:tI.id,params:{range:f}}),{redo:y,undo:E}=tE(e,C),b=[...null!=(n=_.preRedos)?n:[],...y],R=[..._.undos,...E];return b.push(..._.redos),b.push(eL(f,m,g)),R.push(...null!=(i=_.preUndos)?i:[]),!!(0,p.sequenceExecute)(b,s).result&&(a.pushUndoRedo({unitID:h,undoMutations:R.reverse(),redoMutations:b}),!0)}},tA={type:p.CommandType.COMMAND,id:"sheet.command.delete-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),{unitId:i,subUnitId:s,rule:a}=t,o={unitId:i,subUnitId:s,ruleIds:[a.id]};return await r.executeCommand(L.id,o)&&n.pushUndoRedo({unitID:i,redoMutations:[{id:L.id,params:o}],undoMutations:[{id:P.id,params:{unitId:i,subUnitId:s,rules:[a]}}]}),!0}},tv={type:p.CommandType.COMMAND,id:"sheet.command.delete-worksheet-protection",handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),{rule:i,unitId:s,subUnitId:a}=t;r.executeCommand(B.id,{unitId:s,subUnitId:a});let o=[{id:B.id,params:{unitId:s,subUnitId:a}}],l=[{id:k.id,params:{unitId:s,rule:i,subUnitId:a}}];return n.pushUndoRedo({unitID:s,redoMutations:o,undoMutations:l}),!0}},tS={id:"sheet.command.insert-defined-name",type:p.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService);if(!t)return!1;let i={...t};return!!r.syncExecuteCommand(C.SetDefinedNameMutation.id,i)&&(n.pushUndoRedo({unitID:t.unitId,undoMutations:[{id:C.RemoveDefinedNameMutation.id,params:i}],redoMutations:[{id:C.SetDefinedNameMutation.id,params:i}]}),!0)}},tT=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},tO={id:"sheet.mutation.insert-row",type:p.CommandType.MUTATION,handler:(e,t)=>{var r;let{unitId:n,subUnitId:i,range:s,rowInfo:a}=t,o=e.get(p.IUniverInstanceService).getUniverSheetInstance(n);if(null==o)throw Error("universheet is null error!");let l=o.getSheetBySheetId(i);if(null==l)throw Error("worksheet is null error!");let u=l.getRowManager().getRowData(),c={h:l.getConfig().defaultRowHeight,hd:0},h=s.startRow,d=s.endRow-s.startRow+1;for(let e=h;e<h+d;e++)a?(0,p.insertMatrixArray)(e,null!=(r=a[e-s.startRow])?r:c,u):(0,p.insertMatrixArray)(e,c,u);return l.setRowCount(l.getRowCount()+s.endRow-s.startRow+1),l.getCellMatrix().insertRows(s.startRow,d),!0}},tM=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},tw={id:"sheet.mutation.insert-col",type:p.CommandType.MUTATION,handler:(e,t)=>{var r;let n=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==n)throw Error("universheet is null error!");let i=n.getSheetBySheetId(t.subUnitId);if(!i)return!1;let s=i.getColumnManager(),{range:a,colInfo:o}=t,l=s.getColumnData(),u=a.startColumn,c=a.endColumn-a.startColumn+1,h=i.getConfig().defaultColumnWidth;for(let e=u;e<u+c;e++){let t={w:h,hd:0};o?(0,p.insertMatrixArray)(e,null!=(r=o[e-a.startColumn])?r:t,l):(0,p.insertMatrixArray)(e,t,l)}return i.setColumnCount(i.getColumnCount()+a.endColumn-a.startColumn+1),i.getCellMatrix().insertColumns(a.startColumn,c),!0}},tx=(e,t)=>{let r=t.getRowManager().getRowData(),n=e.range,i=(0,p.sliceMatrixArray)(n.startRow,n.endRow,r),s=(0,p.concatMatrixArray)({},i);return{unitId:e.unitId,subUnitId:e.subUnitId,range:e.range,rowInfo:s}},tU={id:"sheet.mutation.remove-rows",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getRowManager().getRowData();for(let e=i.startRow;e<=i.endRow;e++)n.getRowFiltered(e);let a=i.endRow-i.startRow+1;return(0,p.spliceArray)(i.startRow,a,s),n.getCellMatrix().removeRows(i.startRow,a),n.setRowCount(n.getRowCount()-a),!0}},tD=(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getColumnManager().getColumnData(),s=t.range,a=(0,p.sliceMatrixArray)(s.startColumn,s.endColumn,i),o=(0,p.concatMatrixArray)({},a);return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,colInfo:o}},tV={id:"sheet.mutation.remove-col",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getColumnManager().getColumnData(),a=i.endColumn-i.startColumn+1;return(0,p.spliceArray)(i.startColumn,a,s),n.setColumnCount(n.getColumnCount()-a),n.getCellMatrix().removeColumns(i.startColumn,a),!0}},tL={type:p.CommandType.COMMAND,id:"sheet.command.insert-range-move-down",handler:async(e,t)=>{var r,n,i;let s=e.get(p.ICommandService),a=e.get(p.IUndoRedoService),o=e.get(p.IUniverInstanceService),l=e.get(z),u=e.get(er),c=e.get(p.ErrorService),h=e.get(p.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=eE(o);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f,workbook:C}=d,_=null==t?void 0:t.range;if(_||(_=null==(r=l.getCurrentLastSelection())?void 0:r.range),!_)return!1;let y=[],E=[],b=f.getCellMatrix(),R=b.getDataRange(),N=Math.max(b.getSlice(R.startRow,R.endRow,_.startColumn,_.endColumn).getDataRange().endRow+(_.endRow-_.startRow+1)-R.endRow,0);if(N>0){let t=_.startRow-1,r=f.getRowHeight(t),n={unitId:m,subUnitId:g,range:{startRow:R.endRow+1,endRow:R.endRow+N,startColumn:R.startColumn,endColumn:R.endColumn},rowInfo:Array(N).fill(void 0).map(()=>({h:r,hd:p.BooleanNumber.FALSE}))};y.push({id:tO.id,params:n});let i=tT(e,n);E.push({id:tU.id,params:i})}let I={};(0,p.Range).foreach(_,(e,t)=>{let r=f.getCell(e,t);r&&(I[e]||(I[e]={}),I[e][t]={s:r.s})});let{redo:A,undo:v}=ty(e,{range:_,subUnitId:g,unitId:m,shiftDimension:p.Dimension.ROWS,cellValue:I});y.push(...A),E.push(...v);let S=u.onCommandExecute({id:tL.id,params:{range:_}});return y.push(...S.redos),y.push(eL(_,C,f)),E.push(...null!=(n=S.preUndos)?n:[]),y.unshift(...null!=(i=S.preRedos)?i:[]),E.unshift(...S.undos),!!(0,p.sequenceExecute)(y,s)&&(a.pushUndoRedo({unitID:m,undoMutations:E.reverse(),redoMutations:y}),!0)}},tP="sheet.command.insert-range-move-right",tj={type:p.CommandType.COMMAND,id:tP,handler:async(e,t)=>{var r,n,i;let s=e.get(p.ICommandService),a=e.get(p.IUndoRedoService),o=e.get(p.IUniverInstanceService),l=e.get(z),u=e.get(er),c=e.get(p.ErrorService),h=e.get(p.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=eE(o);if(!d)return!1;let{workbook:m,worksheet:g,unitId:f,subUnitId:C}=d,_=null==t?void 0:t.range;if(_||(_=null==(r=l.getCurrentLastSelection())?void 0:r.range),!_)return!1;let y=[],E=[],b=g.getCellMatrix(),R=b.getDataRange(),N=Math.max(b.getSlice(_.startRow,_.endRow,R.startColumn,R.endColumn).getDataRange().endColumn+(_.endColumn-_.startColumn+1)-R.endColumn,0);if(N>0){let t=_.startColumn-1,r=g.getColumnWidth(t),n={unitId:f,subUnitId:C,range:{startRow:R.startRow+1,endRow:R.endRow,startColumn:R.endColumn+1,endColumn:R.endColumn+N},colInfo:Array(N).fill(void 0).map(()=>({w:r,hd:p.BooleanNumber.FALSE}))};y.push({id:tw.id,params:n});let i=tM(e,n);E.push({id:tV.id,params:i})}let I={};(0,p.Range).foreach(_,(e,t)=>{let r=g.getCell(e,t);r&&r.s&&(I[e]||(I[e]={}),I[e][t]={s:r.s})});let{redo:A,undo:v}=ty(e,{range:_,subUnitId:C,unitId:f,shiftDimension:p.Dimension.COLUMNS,cellValue:I});y.push(...A),E.push(...v);let S=u.onCommandExecute({id:tj.id,params:{range:_}});return y.push(...S.redos),y.push(eL(_,m,g)),E.push(...null!=(n=S.preUndos)?n:[]),y.unshift(...null!=(i=S.preRedos)?i:[]),E.unshift(...S.undos),!!(0,p.sequenceExecute)(y,s).result&&(a.pushUndoRedo({unitID:f,undoMutations:E.reverse(),redoMutations:y}),!0)}},tF="sheet.command.insert-row",tk={type:p.CommandType.COMMAND,id:tF,handler:async(e,t)=>{var r,n,i,s;let a=e.get(p.ICommandService),o=e.get(p.IUndoRedoService),l=e.get(p.IUniverInstanceService),u=e.get(er),c=eE(l,t);if(!c)return!1;let{workbook:h,worksheet:d}=c,{range:m,direction:g,unitId:f,subUnitId:C,cellValue:_}=t,{startRow:y,endRow:E}=m;m.rangeType=p.RANGE_TYPE.ROW;let b=g===p.Direction.UP?y:y-1,R=d.getRowHeight(b),N={unitId:f,subUnitId:C,range:m,rowInfo:Array(E-y+1).fill(void 0).map(()=>({h:R,hd:p.BooleanNumber.FALSE}))},I=tT(e,N);if(!await u.beforeCommandExecute({id:tk.id,params:N}))return!1;let A=[{id:tO.id,params:N}],v=[{id:tU.id,params:I}];_&&A.push({id:ec.id,params:{unitId:f,subUnitId:C,cellValue:_}});let S=u.onCommandExecute({id:tk.id,params:t});return A.unshift(...null!=(r=S.preRedos)?r:[]),A.push(...null!=(n=S.redos)?n:[]),A.push(eL(m,h,d)),v.unshift(...null!=(i=S.preUndos)?i:[]),v.push(...null!=(s=S.undos)?s:[]),!!(0,p.sequenceExecute)(A,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:v,redoMutations:A}),!0)}},tB={type:p.CommandType.COMMAND,id:"sheet.command.insert-row-before",handler:async e=>{var t;let r;let n=null==(t=e.get(z).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=eE(e.get(p.IUniverInstanceService));if(!i)return!1;let{worksheet:s,subUnitId:a,unitId:o}=i,{startRow:l,endRow:u}=r,c=s.getColumnCount()-1,h={unitId:o,subUnitId:a,direction:p.Direction.UP,range:{startRow:l,endRow:u,startColumn:0,endColumn:c},cellValue:eP(s,l,u,0,c,!0,l-1)};return e.get(p.ICommandService).executeCommand(tk.id,h)}},t$={type:p.CommandType.COMMAND,id:"sheet.command.insert-row-after",handler:async e=>{var t;let r;let n=null==(t=e.get(z).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=eE(e.get(p.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=r.endRow-r.startRow+1,u=r.endRow+1,c=r.endRow+l,h=s.getColumnCount()-1,d={unitId:a,subUnitId:o,direction:p.Direction.DOWN,range:{startRow:u,endRow:c,startColumn:0,endColumn:h,rangeType:p.RANGE_TYPE.ROW},cellValue:eP(s,u,c,0,h,!0,r.endRow)};return e.get(p.ICommandService).executeCommand(tk.id,d)}},tH="sheet.command.insert-col",tW={type:p.CommandType.COMMAND,id:tH,handler:async(e,t)=>{var r,n,i,s;let a=e.get(p.ICommandService),o=e.get(p.IUndoRedoService),l=e.get(p.IUniverInstanceService),u=e.get(er),{range:c,direction:h,subUnitId:d,unitId:m,cellValue:g}=t,{startColumn:f,endColumn:C}=t.range;c.rangeType=p.RANGE_TYPE.COLUMN;let _=l.getUniverSheetInstance(t.unitId),y=_.getSheetBySheetId(t.subUnitId),E=h===p.Direction.LEFT?f:f-1,b=y.getColumnWidth(E),R={unitId:m,subUnitId:d,range:c,colInfo:Array(C-f+1).fill(void 0).map(()=>({w:b,hd:p.BooleanNumber.FALSE}))},N=tM(e,R);if(!await u.beforeCommandExecute({id:tW.id,params:R}))return!1;let I=[{id:tw.id,params:R}],A=[{id:tV.id,params:N}];g&&I.push({id:ec.id,params:{unitId:m,subUnitId:d,cellValue:g}});let v=u.onCommandExecute({id:tW.id,params:t});return I.unshift(...null!=(r=v.preRedos)?r:[]),I.push(...null!=(n=v.redos)?n:[]),I.push(eL(c,_,y)),A.unshift(...null!=(i=v.preUndos)?i:[]),A.push(...null!=(s=v.undos)?s:[]),!!(0,p.sequenceExecute)(I,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:A.filter(Boolean),redoMutations:I.filter(Boolean)}),!0)}},tG={type:p.CommandType.COMMAND,id:"sheet.command.insert-col-before",handler:async e=>{let t;let r=e.get(z).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=eE(e.get(p.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,{startColumn:o,endColumn:l}=t,u=i.getRowCount()-1,c={unitId:s,subUnitId:a,direction:p.Direction.LEFT,range:{startColumn:o,endColumn:l,startRow:0,endRow:u,rangeType:p.RANGE_TYPE.COLUMN},cellValue:eP(i,0,u,o,l,!1,o-1)};return e.get(p.ICommandService).executeCommand(tW.id,c)}},tY={type:p.CommandType.COMMAND,id:"sheet.command.insert-col-after",handler:async e=>{let t;let r=e.get(z).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=eE(e.get(p.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,o=t.endColumn-t.startColumn+1,l=t.endColumn+1,u=t.endColumn+o,c=i.getRowCount()-1,h={unitId:s,subUnitId:a,direction:p.Direction.RIGHT,range:{startColumn:l,endColumn:u,startRow:0,endRow:c},cellValue:eP(i,0,c,l,u,!1,t.endColumn)};return e.get(p.ICommandService).executeCommand(tW.id,h)}},tz={id:"sheet.command.insert-sheet",type:p.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(p.ICommandService),i=e.get(p.IUndoRedoService),s=e.get(p.IUniverInstanceService),a=e.get(p.LocaleService),o=function(e,t){let{unitId:r}=t,n=r?e.getUniverSheetInstance(r):e.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);return n?{workbook:n,unitId:n.getUnitId()}:null}(s,{unitId:null==t?void 0:t.unitId});if(!o)return!1;let{unitId:l,workbook:u}=o,c=u.getSheets().length,h=null==t?void 0:t.sheet,d=null==h?void 0:h.id,m=(0,p.mergeWorksheetSnapshotWithDefault)(h||{});t?(c=null!=(r=t.index)?r:c,m.id=d||(0,p.Tools).generateRandomId(),m.name=(null==h?void 0:h.name)||u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`)):(m.id=(0,p.Tools).generateRandomId(),m.name=u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`));let g={index:c,sheet:m,unitId:l},f=e_(e,g);return!!n.syncExecuteCommand(ey.id,g)&&(i.pushUndoRedo({unitID:l,undoMutations:[{id:eN.id,params:f}],redoMutations:[{id:ey.id,params:g}]}),!0)}},tq={id:"sheet.mutation.move-rows",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(p.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveRowMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveRowMutation] worksheet is null!");let l=i.startRow,u=i.endRow-i.startRow+1,c=s.startRow,h=o.getRowManager().getRowData();return(0,p.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveRows(l,u,c),!0}},tX={id:"sheet.mutation.move-columns",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(p.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveColumnMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveColumnMutation] worksheet is null!");let l=i.startColumn,u=i.endColumn-i.startColumn+1,c=s.startColumn,h=o.getColumnManager().getColumnData();return(0,p.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveColumns(l,u,c),!0}},tK="sheet.command.move-rows",tQ={id:tK,type:p.CommandType.COMMAND,handler:async(e,t)=>{var r,n;let i=e.get(z),{fromRange:{startRow:s},toRange:{startRow:a},range:o}=t,l=o?[t0(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===p.RANGE_TYPE.ROW&&e.range.startRow<=s&&s<=e.range.endRow);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(er),h=eE(e.get(p.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),C=e.get(p.ErrorService),_=e.get(p.LocaleService),y=u[0].range,E=u[0].primary,b=ex(y,m,!1);if(!(0,p.Rectangle).equals(y,b))return C.emit(_.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startRow<a&&a<=e.endRow))return C.emit(_.t("sheets.info.acrossMergedCell")),!1;let R={...y,startRow:a,endRow:a+y.endRow-y.startRow},N={unitId:g,subUnitId:f,sourceRange:y,targetRange:R},I=function(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startRow>s.startRow,o=i.endRow-i.startRow+1;return a?{unitId:r,subUnitId:n,sourceRange:(0,p.Rectangle).clone(s),targetRange:{...i,endRow:i.endRow+o,startRow:i.startRow+o}}:{unitId:r,subUnitId:n,targetRange:(0,p.Rectangle).clone(i),sourceRange:{...s,endRow:s.endRow-o,startRow:s.startRow-o}}}(0,N),A=e.get(p.ICommandService),v=c.onCommandExecute({id:tQ.id,params:t}),S=[...null!=(r=v.preRedos)?r:[],{id:tq.id,params:N}],T=[...null!=(n=v.preUndos)?n:[],{id:tq.id,params:I}];if(E){let e=y.endRow-y.startRow+1,t=a-s<0?R:{...R,startRow:R.startRow-e,endRow:R.endRow-e},r={unitId:g,subUnitId:f,selections:[{range:t,primary:eV(t,m),style:null}]};S.push({id:ew.id,params:r}),T.push({id:ew.id,params:{unitId:g,subUnitId:f,selections:[{range:y,primary:E,style:null}]}})}return S.push(...v.redos),T.push(...v.undos),!!(0,p.sequenceExecute)(S,A).result&&(e.get(p.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:S}),!0)}},tZ="sheet.command.move-cols",tJ={id:tZ,type:p.CommandType.COMMAND,handler:async(e,t)=>{var r,n;let i=e.get(z),{fromRange:{startColumn:s},toRange:{startColumn:a},range:o}=t,l=o?[t0(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===p.RANGE_TYPE.COLUMN&&e.range.startColumn<=s&&s<=e.range.endColumn);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(er),h=eE(e.get(p.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),C=e.get(p.ErrorService),_=e.get(p.LocaleService),y=u[0].range,E=u[0].primary,b=ex(y,m,!1);if(!(0,p.Rectangle).equals(y,b))return C.emit(_.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startColumn<a&&a<=e.endColumn))return C.emit(_.t("sheets.info.acrossMergedCell")),!1;let R={...y,startColumn:a,endColumn:a+y.endColumn-y.startColumn},N={unitId:g,subUnitId:f,sourceRange:y,targetRange:R},I=function(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startColumn>s.startColumn,o=i.endColumn-i.startColumn+1;return a?{unitId:r,subUnitId:n,sourceRange:(0,p.Rectangle).clone(s),targetRange:{...i,endColumn:i.endColumn+o,startColumn:i.startColumn+o}}:{unitId:r,subUnitId:n,targetRange:(0,p.Rectangle).clone(i),sourceRange:{...s,startColumn:s.startColumn-o,endColumn:s.endColumn-o}}}(0,N),A=e.get(p.ICommandService),v=c.onCommandExecute({id:tJ.id,params:t}),S=[...null!=(r=v.preRedos)?r:[],{id:tX.id,params:N}],T=[...null!=(n=v.preUndos)?n:[],{id:tX.id,params:I}];if(E){let e=y.endColumn-y.startColumn+1,t=a-s<0?R:{...R,startColumn:R.startColumn-e,endColumn:R.endColumn-e},r={unitId:g,subUnitId:f,selections:[{range:t,primary:eV(t,m),style:null}]};S.push({id:ew.id,params:r}),T.push({id:ew.id,params:{unitId:g,subUnitId:f,selections:[{range:y,primary:E,style:null}]}})}return S.push(...v.redos),T.push(...v.undos),(0,p.sequenceExecute)(S,A).result&&e.get(p.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:S}),!0}};function t0(e){return{range:e,primary:null,style:null}}let t1={id:"sheet.command.remove-defined-name",type:p.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(er);if(!t)return!1;let o={...t},l=a.onCommandExecute({id:t1.id,params:t}),u=[...null!=(r=l.preRedos)?r:[],{id:C.RemoveDefinedNameMutation.id,params:o},...l.redos],c=[...null!=(n=l.preUndos)?n:[],{id:C.SetDefinedNameMutation.id,params:o},...l.undos];return!!(0,p.sequenceExecute)(u,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:c.filter(Boolean),redoMutations:u.filter(Boolean)}),!0)}},t2="sheet.command.remove-row",t5={type:p.CommandType.COMMAND,id:t2,handler:async(e,t)=>{var r,n,i,s;let a=e.get(z),o=e.get(er),l=null==t?void 0:t.range;if(l||(l=null==(r=a.getCurrentLastSelection())?void 0:r.range),!l)return!1;let u=eE(e.get(p.IUniverInstanceService));if(!u)return!1;let{workbook:c,worksheet:h,subUnitId:d,unitId:m}=u;l={...l,startColumn:0,endColumn:Math.max(h.getMaxColumns()-1,0)};let g=[];for(let e=l.startRow;e<=l.endRow;e++)h.getRowFiltered(e)&&g.push(e);let f=[];if(g.length){let e=[l.startRow,...g.map(e=>e+1)],t=[...g.map(e=>e-1),l.endRow];for(let r=e.length-1;r>=0;r--)e[r]<=t[r]&&f.push({startRow:e[r],endRow:t[r],startColumn:l.startColumn,endColumn:l.endColumn})}else f.push(l);if(!await o.beforeCommandExecute({id:t5.id,params:{range:l,ranges:f}}))return!1;let C=[],_=[];f.forEach(e=>{let t={unitId:m,subUnitId:d,range:e},r={unitId:m,subUnitId:d,cellValue:h.getCellMatrix().getSlice(e.startRow,e.endRow,0,h.getColumnCount()-1).getMatrix()},n=tx(t,h);C.push({id:tU.id,params:t}),_.unshift({id:tO.id,params:n},{id:ec.id,params:r})});let y=o.onCommandExecute({id:t5.id,params:{range:l,ranges:f}}),E=e.get(p.ICommandService);return!!(0,p.sequenceExecute)([...null!=(n=y.preRedos)?n:[],...C,...y.redos,eL(l,c,h)],E).result&&(e.get(p.IUndoRedoService).pushUndoRedo({unitID:m,undoMutations:[...null!=(i=y.preUndos)?i:[],..._,...y.undos],redoMutations:[...null!=(s=y.preRedos)?s:[],...C,...y.redos]}),!0)}},t3="sheet.command.remove-col",t4={type:p.CommandType.COMMAND,id:t3,handler:async(e,t)=>{var r,n,i,s;let a=e.get(z),o=e.get(er),l=null==t?void 0:t.range;if(l||(l=null==(r=a.getCurrentLastSelection())?void 0:r.range),!l)return!1;let u=eE(e.get(p.IUniverInstanceService));if(!u)return!1;let{workbook:c,worksheet:h,subUnitId:d,unitId:m}=u,g={unitId:m,subUnitId:d,range:l={...l,startRow:0,endRow:Math.max(h.getMaxRows()-1,0)}},f=tD(e,g),C={unitId:m,subUnitId:d,cellValue:h.getCellMatrix().getSlice(0,h.getRowCount()-1,l.startColumn,l.endColumn).getMatrix()};if(!await o.beforeCommandExecute({id:t4.id,params:{range:l}}))return!1;let _=o.onCommandExecute({id:t4.id,params:{range:l}}),y=e.get(p.ICommandService);return!!(0,p.sequenceExecute)([...null!=(n=_.preRedos)?n:[],{id:tV.id,params:g},..._.redos,eL(l,c,h)],y).result&&(e.get(p.IUndoRedoService).pushUndoRedo({unitID:m,undoMutations:[...null!=(i=_.preUndos)?i:[],{id:tw.id,params:f},{id:ec.id,params:C},..._.undos],redoMutations:[...null!=(s=_.preRedos)?s:[],{id:tV.id,params:g},..._.redos]}),!0)}},t6={id:"sheet.command.remove-sheet",type:p.CommandType.COMMAND,handler:async(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService),o=e.get(er),l=eE(a,t);if(!l)return!1;let{unitId:u,subUnitId:c,workbook:h,worksheet:d}=l;if(h.getSheets().length<=1)return!1;let m={subUnitId:c,unitId:u,subUnitName:d.getName()},g=eR(e,m),f=o.onCommandExecute({id:t6.id,params:{unitId:u,subUnitId:c}}),C=[...null!=(r=f.preRedos)?r:[],{id:eN.id,params:m},...f.redos],_=[...null!=(n=f.preUndos)?n:[],{id:ey.id,params:g},...f.undos];return!!(0,p.sequenceExecute)(C,i).result&&(s.pushUndoRedo({unitID:u,undoMutations:_,redoMutations:C}),!0)}},t9=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:(0,p.Tools).deepClone(t.ranges)}},t7={id:"sheet.mutation.add-worksheet-merge",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)i.push(s[e]);return n.getSpanModel().rebuild(i),!0}},t8=(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().mergeData,s=t.ranges,a=[];for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];(0,p.Rectangle).intersects(r,n)&&a.push(i[t])}return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:a}},re={id:"sheet.mutation.remove-worksheet-merge",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];(0,p.Rectangle).intersects(r,n)&&i.splice(t,1)}return n.getSpanModel().rebuild(i),!0}},rt={type:p.CommandType.COMMAND,id:"sheet.command.remove-worksheet-merge",handler:async(e,t)=>{var r;let n=e.get(z),i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService),o=(null==t?void 0:t.ranges)||(null==(r=n.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=o&&o.length))return!1;let l=eE(a);if(!l)return!1;let{subUnitId:u,unitId:c,worksheet:h}=l,d=h.getConfig().mergeData.filter(e=>o.some(t=>(0,p.Rectangle).intersects(t,e)));if(!d.length)return!1;let m=t8(e,{unitId:c,subUnitId:u,ranges:o}),g=n.getCurrentSelections();if(!(null!=g&&g.length))return!1;let f=(0,p.Tools).deepClone(g),C=(0,p.Tools).deepClone(g),_=C[C.length-1],{startRow:y,startColumn:E}=_.range;_.primary={startRow:y,startColumn:E,endRow:y,endColumn:E,actualRow:y,actualColumn:E,isMerged:!1,isMergedMainCell:!1};let b=function(e,t){let r=new p.ObjectMatrix,n=new p.ObjectMatrix;return t.forEach(t=>{let{startRow:i,startColumn:s,endColumn:a,endRow:o}=t,l=e.getCellMatrix().getValue(i,s);if(null!=l&&l.s)for(let e=i;e<=o;e++)for(let t=s;t<=a;t++)(e!==i||t!==s)&&(r.setValue(e,t,{s:l.s}),n.setValue(e,t,null))}),{redoParams:r,undoParams:n}}(h,d),R={unitId:c,subUnitId:u,cellValue:b.redoParams.getMatrix()},N={unitId:c,subUnitId:u,cellValue:b.undoParams.getMatrix()},I=[{id:re.id,params:m},{id:ec.id,params:R},{id:ew.id,params:{selections:C}}],A=[{id:t7.id,params:m},{id:ec.id,params:N},{id:ew.id,params:{selections:f}}];return!!(0,p.sequenceExecute)(I,i)&&(s.pushUndoRedo({unitID:c,undoMutations:A,redoMutations:I}),!0)}},rr=e=>{let{order:t}=e,r={};return Object.keys(t).forEach(e=>{r[t[Number(e)]]=Number(e)}),{...e,order:r}},rn={id:"sheet.mutation.reorder-range",type:p.CommandType.MUTATION,handler:(e,t)=>{let{subUnitId:r,unitId:n,range:i,order:s}=t,a=e.get(p.IUniverInstanceService).getUnit(n).getSheetBySheetId(r);if(!a)return!1;let o=new p.ObjectMatrix;(0,p.Range).foreach(i,(e,t)=>{if(s.hasOwnProperty(e)){let r=s[e],n=(0,p.Tools).deepClone(a.getCellRaw(r,t));o.setValue(e,t,n)}});let l=a.getCellMatrix();return o.forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}},ri="sheet.command.reorder-range",rs={id:ri,type:p.CommandType.COMMAND,handler:(e,t)=>{var r,n;let{subUnitId:i,unitId:s,range:a,order:o}=t,l=e.get(p.ICommandService),u={id:rn.id,params:{unitId:s,subUnitId:i,order:o,range:a}},c={id:rn.id,params:rr(u.params)},h=e.get(er).onCommandExecute({id:rs.id,params:t}),d=[...null!=(r=h.preRedos)?r:[],u,...h.redos],m=[...null!=(n=h.preUndos)?n:[],c,...h.undos];return!!(0,p.sequenceExecute)(d,l).result&&(e.get(p.IUndoRedoService).pushUndoRedo({unitID:s,undoMutations:m,redoMutations:d}),!0)}};class ra{constructor(){x(this,"_borderInfo",{type:p.BorderType.ALL,color:"#000000",style:p.BorderStyleTypes.THIN,activeBorderType:!1}),x(this,"_borderInfo$",new y.BehaviorSubject(this._borderInfo)),x(this,"borderInfo$",this._borderInfo$.asObservable())}dispose(){this._borderInfo$.complete()}setType(e){this._borderInfo.type=e,this.setActiveBorderType(!0),this._refresh()}setColor(e){this._borderInfo.color=e,this._refresh()}setStyle(e){this._borderInfo.style=e,this._refresh()}setActiveBorderType(e){this._borderInfo.activeBorderType=e}getBorderInfo(){return this._borderInfo}_refresh(){this._borderInfo$.next(this._borderInfo)}}function ro(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}let rl=(e,t,r,n)=>{let{mr:i,worksheet:s}=e;t.startRow<0||t.startColumn<0||ro(t,(e,t)=>{var a,o;let l=s.getMergedCell(e,t),u=r;if(l&&(r.bc_tr||r.ml_tr||r.bl_tr||r.tl_mr||r.tl_bc||r.tl_br)){if(n){let e=(0,p.Tools).deepClone(null==(a=i.getValue(l.startRow,l.startColumn))?void 0:a.s);u=null!=e&&e.bd?Object.assign(e.bd,r):r}i.setValue(l.startRow,l.startColumn,{s:{bd:u}})}else{if(n){let n=(0,p.Tools).deepClone(null==(o=i.getValue(e,t))?void 0:o.s);u=null!=n&&n.bd?Object.assign(n.bd,r):r}i.setValue(e,t,{s:{bd:u}})}})},ru=e=>{let t={startRow:e.startRow-1,startColumn:e.startColumn,endRow:e.startRow-1,endColumn:e.endColumn},r={startRow:e.startRow,startColumn:e.startColumn-1,endRow:e.endRow,endColumn:e.startColumn-1},n={startRow:e.endRow+1,startColumn:e.startColumn,endRow:e.endRow+1,endColumn:e.endColumn},i={startRow:e.startRow,startColumn:e.endColumn+1,endRow:e.endRow,endColumn:e.endColumn+1},s={startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow,endColumn:e.endColumn};return{topRangeOut:t,leftRangeOut:r,bottomRangeOut:n,rightRangeOut:i,topRange:s,leftRange:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.startColumn},bottomRange:{startRow:e.endRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn},rightRange:{startRow:e.startRow,startColumn:e.endColumn,endRow:e.endRow,endColumn:e.endColumn}}},rc=e=>{let{range:t,mr:r,borderStyle:n,vertical:i,horizontal:s,worksheet:a}=e;i&&ro(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startColumn!==t.startColumn&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{l:(0,p.Tools).deepClone(n)}):{l:(0,p.Tools).deepClone(n)}}})}else{if(i!==t.endColumn){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:(0,p.Tools).deepClone(n)}):{r:(0,p.Tools).deepClone(n)}}})}if(i!==t.startColumn){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:(0,p.Tools).deepClone(n)}):{l:(0,p.Tools).deepClone(n)}}})}}}),s&&ro(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startRow!==t.startRow&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{t:(0,p.Tools).deepClone(n)}):{t:(0,p.Tools).deepClone(n)}}})}else{if(e!==t.endRow){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:(0,p.Tools).deepClone(n)}):{b:(0,p.Tools).deepClone(n)}}})}if(e!==t.startRow){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:(0,p.Tools).deepClone(n)}):{t:(0,p.Tools).deepClone(n)}}})}}})},rh=e=>{let{top:t,left:r,right:n,bottom:i,borderStyle:s,bottomRange:a,topRange:o,leftRange:l,rightRange:u,bottomRangeOut:c,topRangeOut:h,leftRangeOut:d,rightRangeOut:m}=e,g=(t,r,n)=>{rl(e,t,r,n)};t&&(g(h,{b:null}),g(o,{t:(0,p.Tools).deepClone(s)},!0)),i&&(g(c,{t:null}),g(a,{b:(0,p.Tools).deepClone(s)},!0)),r&&(g(d,{r:null}),g(l,{l:(0,p.Tools).deepClone(s)},!0)),n&&(g(m,{l:null}),g(u,{r:(0,p.Tools).deepClone(s)},!0))},rd=e=>{let{range:t,worksheet:r,mr:n,top:i,bottom:s,left:a,right:o,vertical:l,horizontal:u,tl_br:c,tl_bc:h,tl_mr:d,bl_tr:m,ml_tr:g,bc_tr:f,topRange:p,bottomRange:C,leftRange:_,rightRange:y,topRangeOut:E,bottomRangeOut:b,leftRangeOut:R,rightRangeOut:N}=e,I=(t,r,n)=>{rl(e,t,r,n)};i||s||a||o||l||u||c||h||d||m||g||f||(ro(t,(e,i)=>{var s,a,o,l,u,c,h,d;let m=r.getMergedCell(e,i);if(m){if(m.endColumn!==t.endColumn){let t=null==(s=n.getValue(m.startRow,m.startColumn))?void 0:s.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(m.startColumn!==t.startColumn){let t=null==(a=n.getValue(m.startRow,m.startColumn))?void 0:a.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(m.endRow!==t.endRow){let t=null==(o=n.getValue(m.startRow,m.startColumn))?void 0:o.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(m.startRow!==t.startRow){let t=null==(l=n.getValue(m.startRow,m.startColumn))?void 0:l.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}else{if(i!==t.endColumn){let t=null==(u=n.getValue(e,i))?void 0:u.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(i!==t.startColumn){let t=null==(c=n.getValue(e,i))?void 0:c.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(e!==t.endRow){let t=null==(h=n.getValue(e,i))?void 0:h.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(e!==t.startRow){let t=null==(d=n.getValue(e,i))?void 0:d.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}}),I(E,{b:null}),I(p,{t:null},!0),I(b,{t:null}),I(C,{b:null},!0),I(R,{r:null}),I(_,{l:null},!0),I(N,{l:null}),I(y,{r:null},!0),I(t,{tl_br:null},!0),I(t,{tl_bc:null},!0),I(t,{tl_mr:null},!0),I(t,{bl_tr:null},!0),I(t,{ml_tr:null},!0),I(t,{bc_tr:null},!0))},rm={id:"sheet.command.set-border",type:p.CommandType.COMMAND,handler:async(e,t)=>{var r;let n=e.get(p.ICommandService),i=e.get(p.IUndoRedoService),s=e.get(p.IUniverInstanceService),a=e.get(z),o=e.get(ra),l=eE(s,t);if(!l)return!1;let u=null==(r=a.getCurrentSelections())?void 0:r.map(e=>e.range);if(!(null!=u&&u.length))return!1;let{activeBorderType:c}=o.getBorderInfo();if(!c)return!1;let h=function(e,t,r){let{style:n,color:i,type:s}=e.getBorderInfo(),a=s===p.BorderType.TOP||s===p.BorderType.ALL||s===p.BorderType.OUTSIDE,o=s===p.BorderType.LEFT||s===p.BorderType.ALL||s===p.BorderType.OUTSIDE,l=s===p.BorderType.BOTTOM||s===p.BorderType.ALL||s===p.BorderType.OUTSIDE,u=s===p.BorderType.RIGHT||s===p.BorderType.ALL||s===p.BorderType.OUTSIDE,c=s===p.BorderType.VERTICAL||s===p.BorderType.ALL||s===p.BorderType.INSIDE,h=s===p.BorderType.HORIZONTAL||s===p.BorderType.ALL||s===p.BorderType.INSIDE,d=s.indexOf("tlbr")>-1,m=s.indexOf("tlbc")>-1,g=s.indexOf("tlmr")>-1,f=s.indexOf("bltr")>-1,C=s.indexOf("mltr")>-1,_=s.indexOf("bctr")>-1,y=r[0],{topRangeOut:E,leftRangeOut:b,bottomRangeOut:R,rightRangeOut:N,topRange:I,leftRange:A,bottomRange:v,rightRange:S}=ru(y),T=new p.ObjectMatrix,{worksheet:O,unitId:M,subUnitId:w}=t;return{worksheet:O,unitId:M,subUnitId:w,style:n,color:i,type:s,top:a,left:o,right:u,bottom:l,vertical:c,horizontal:h,tl_br:d,tl_bc:m,tl_mr:g,bl_tr:f,ml_tr:C,bc_tr:_,topRangeOut:E,leftRangeOut:b,bottomRangeOut:R,rightRangeOut:N,topRange:I,leftRange:A,bottomRange:v,rightRange:S,range:y,mr:T,borderStyle:{s:n,cl:{rgb:i}}}}(o,l,u);rc(h),rh(h),function(e){let{borderStyle:t,tl_br:r,tl_bc:n,tl_mr:i,bl_tr:s,ml_tr:a,bc_tr:o}=e,l=(t,r,n)=>{rl(e,t,r,n)};r&&l(e.range,{tl_br:(0,p.Tools).deepClone(t)},!0),n&&l(e.range,{tl_bc:(0,p.Tools).deepClone(t)},!0),i&&l(e.range,{tl_mr:(0,p.Tools).deepClone(t)},!0),s&&l(e.range,{bl_tr:(0,p.Tools).deepClone(t)},!0),a&&l(e.range,{ml_tr:(0,p.Tools).deepClone(t)},!0),o&&l(e.range,{bc_tr:(0,p.Tools).deepClone(t)},!0)}(h),rd(h);let{unitId:d,subUnitId:m,mr:g}=h,f={unitId:d,subUnitId:m,cellValue:g.getData()},C=eu(e,f);return!!n.syncExecuteCommand(ec.id,f)&&(i.pushUndoRedo({unitID:d,undoMutations:[{id:ec.id,params:C}],redoMutations:[{id:ec.id,params:f}]}),!0)}},rg={id:"sheet.command.set-border-position",type:p.CommandType.COMMAND,handler:async(e,t)=>{if(!t.value)return!1;let r=e.get(p.ICommandService);return e.get(ra).setType(t.value),r.executeCommand(rm.id)}},rf={id:"sheet.command.set-border-style",type:p.CommandType.COMMAND,handler:async(e,t)=>{let r=e.get(p.ICommandService);return e.get(ra).setStyle(t.value),r.executeCommand(rm.id)}},rp={id:"sheet.command.set-border-color",type:p.CommandType.COMMAND,handler:async(e,t)=>{let r=e.get(p.ICommandService);return e.get(ra).setColor(t.value),r.executeCommand(rm.id)}},rC={id:"sheet.command.set-border-basic",type:p.CommandType.COMMAND,handler:async(e,t)=>{let{unitId:r,subUnitId:n,value:i}=t,{type:s,color:a,style:o}=i,l=e.get(p.ICommandService),u=e.get(ra);return u.setType(s),a&&u.setColor(a),u.setStyle(o),l.executeCommand(rm.id,{unitId:r,subUnitId:n})}},r_=(e,t)=>{let{unitId:r,subUnitId:n,columnData:i}=e,s={},a=t.getColumnManager();for(let e in i){let t=i[e],r=a.getColumn(Number(e));s[e]=function(e,t){if(null==e)return e;let r=(0,p.Tools).deepClone(e);if(null==t)return r;let n={};return"w"in t&&(n.w=r.w),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,columnData:s}},ry={id:"sheet.mutation.set-col-data",type:p.CommandType.MUTATION,handler:(e,t)=>{let{columnData:r}=t,n=eE(e.get(p.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getColumnManager();for(let e in r){let t=r[e];if(null==t){s.removeColumn(Number(e));continue}Object.assign(s.getColumnOrCreate(Number(e)),t)}return!0}},rE={type:p.CommandType.COMMAND,id:"sheet.command.set-col-data",handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService),t);if(!i)return!1;let{columnData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,columnData:s},c=r_(u,l);return!!r.syncExecuteCommand(ry.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:ry.id,params:c}],redoMutations:[{id:ry.id,params:u}]}),!0)}},rb=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},rR={id:"sheet.mutation.set-col-hidden",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=p.BooleanNumber.TRUE)}}return!0}},rN=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},rI={id:"sheet.mutation.set-col-visible",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=p.BooleanNumber.FALSE)}}return!0}},rA={type:p.CommandType.COMMAND,id:"sheet.command.set-col-visible-on-cols",handler:async(e,t)=>{var r,n;let{unitId:i,subUnitId:s,ranges:a}=t,o=e.get(er),l=e.get(p.ICommandService),u=eE(e.get(p.IUniverInstanceService),{unitId:i,subUnitId:s});if(!u)return!1;let{worksheet:c}=u,h={unitId:i,subUnitId:s,ranges:a},d={unitId:i,subUnitId:s,reveal:!0,selections:a.map(e=>({range:e,primary:eV(e,c),style:null}))},m=rN(e,h),g={unitId:i,subUnitId:s,selections:rT(a).map(e=>({range:e,primary:eV(e,c),style:null}))},f=(0,p.sequenceExecute)([{id:rI.id,params:h},{id:ew.id,params:d}],l),C=o.onCommandExecute({id:rA.id,params:t}),_=(0,p.sequenceExecute)([...C.redos],l);return f.result&&_.result&&e.get(p.IUndoRedoService).pushUndoRedo({unitID:i,undoMutations:[{id:rR.id,params:m},{id:ew.id,params:g},...null!=(r=C.undos)?r:[]],redoMutations:[...null!=(n=C.preRedos)?n:[],{id:rI.id,params:h},{id:ew.id,params:d},...C.redos]}),!0}},rv={type:p.CommandType.COMMAND,id:"sheet.command.set-selected-cols-visible",handler:async e=>{var t;let r=e.get(z),n=e.get(p.ICommandService),i=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===p.RANGE_TYPE.COLUMN);if(!(null!=i&&i.length))return!1;let s=eE(e.get(p.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=i.map(e=>a.getHiddenCols(e.startColumn,e.endColumn)).flat();return n.executeCommand(rA.id,{unitId:o,subUnitId:l,ranges:u})}},rS={type:p.CommandType.COMMAND,id:"sheet.command.set-col-hidden",handler:async(e,t)=>{var r,n,i,s;let a=e.get(z),o=e.get(er),l=e.get(p.IUniverInstanceService),u=e.get(p.ICommandService),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===p.RANGE_TYPE.COLUMN);if(!(null!=c&&c.length))return!1;let h=eE(l,t);if(!h)return!1;let{worksheet:d,unitId:m,subUnitId:g}=h,f={unitId:m,subUnitId:g,ranges:c=function(e,t){let r=e.getRowCount()-1,n=e.getHiddenCols(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startColumn>=e.startColumn&&t.endColumn<=e.endColumn);if(t.length){let n=e.startColumn;t.forEach(e=>{e.startColumn>n&&(i.push({startColumn:n,endColumn:e.startColumn-1,startRow:0,endRow:r}),n=e.endColumn+1)}),n<=e.endColumn&&i.push({startColumn:n,endColumn:e.endColumn,startRow:0,endRow:r})}else i.push(e)}),i}(h.worksheet,c)},C={unitId:m,subUnitId:g,selections:rT(c).map(e=>({range:e,primary:eV(e,d),style:null}))},_=rb(e,f),y={unitId:m,subUnitId:g,reveal:!0,selections:c.map(e=>({range:e,primary:eV(e,d),style:null}))},E=(0,p.sequenceExecute)([{id:rR.id,params:f},{id:ew.id,params:C}],u),b=o.onCommandExecute({id:rS.id,params:f}),R=(0,p.sequenceExecute)([...b.redos],u);return!!E.result&&!!R.result&&(e.get(p.IUndoRedoService).pushUndoRedo({unitID:m,undoMutations:[{id:rI.id,params:_},{id:ew.id,params:y},...null!=(i=b.undos)?i:[]],redoMutations:[...null!=(s=b.preRedos)?s:[],{id:rR.id,params:f},{id:ew.id,params:C},...b.redos]}),!0)}};function rT(e){return(function(e){let t;let r=[];return e.sort((e,t)=>e.startColumn-t.startColumn).forEach(e=>{if(!t){t=e;return}t.endColumn===e.startColumn-1?t.endColumn=e.endColumn:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startColumn?e.endColumn+1:e.startColumn-1;return{...e,startColumn:t,endColumn:t}})}let rO={id:"sheet.command.set-defined-name",type:p.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(er);if(!t)return!1;let o={...t},l=(0,C.SetDefinedNameMutationFactory)(e,t),u=a.onCommandExecute({id:rO.id,params:t}),c=[...null!=(r=u.preRedos)?r:[],{id:C.RemoveDefinedNameMutation.id,params:l},{id:C.SetDefinedNameMutation.id,params:o},...u.redos],h=[...null!=(n=u.preUndos)?n:[],{id:C.RemoveDefinedNameMutation.id,params:o},{id:C.SetDefinedNameMutation.id,params:l},...u.undos];return!!(0,p.sequenceExecute)(c,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:h.filter(Boolean),redoMutations:c.filter(Boolean)}),!0)}},rM=(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().freeze;return{unitId:t.unitId,subUnitId:t.subUnitId,...i}},rw={id:"sheet.mutation.set-frozen",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig(),{startRow:s,startColumn:a,ySplit:o,xSplit:l}=t;return i.freeze={startRow:s,startColumn:a,ySplit:o,xSplit:l},!0}},rx={type:p.CommandType.COMMAND,id:"sheet.command.set-frozen",handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService),{unitId:t.unitId,subUnitId:t.subUnitId});if(!i)return!1;let{unitId:s,subUnitId:a,worksheet:o}=i,{startColumn:l,startRow:u,xSplit:c,ySplit:h}=t;if(u>=o.getRowCount()||l>=o.getColumnCount()||c>=o.getColumnCount()||h>=o.getRowCount())return!1;let d={unitId:s,subUnitId:a,...t},m=rM(e,d);return!!r.syncExecuteCommand(rw.id,d)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:rw.id,params:m}],redoMutations:[{id:rw.id,params:d}]}),!0)}},rU={type:p.CommandType.COMMAND,id:"sheet.command.cancel-frozen",handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUniverInstanceService),i=e.get(p.IUndoRedoService),s=eE(n,{unitId:null==t?void 0:t.unitId,subUnitId:null==t?void 0:t.subUnitId});if(!s)return!1;let{unitId:a,subUnitId:o}=s,l={unitId:a,subUnitId:o,startRow:-1,startColumn:-1,xSplit:0,ySplit:0},u=rM(e,l);return r.syncExecuteCommand(rw.id,l)&&i.pushUndoRedo({unitID:a,undoMutations:[{id:rw.id,params:u}],redoMutations:[{id:rw.id,params:l}]}),!0}},rD={id:"sheet.mutation.set-range-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i,ruleId:s}=t;return e.get(V).setRule(r,n,s,i),!0}},rV={id:"sheet.mutation.set-worksheet-protection",type:p.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i}=t;return e.get(F).setRule(r,n,i),!0}},rL={type:p.CommandType.COMMAND,id:"sheet.command.set-protection",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=e.get(V),{rule:s,oldRule:a}=t,{unitId:o,subUnitId:l}=s,u=[],c=[];return(null==a?void 0:a.unitType)===s.unitType?s.unitType===eH.Worksheet?(u.push({id:rV.id,params:{unitId:o,subUnitId:l,rule:s}}),c.push({id:rV.id,params:{unitId:o,subUnitId:l,rule:a}})):(u.push({id:rD.id,params:{unitId:o,subUnitId:l,rule:s,ruleId:s.id}}),c.push({id:rD.id,params:{unitId:o,subUnitId:l,ruleId:a.id,rule:a}})):(a&&(a.unitType===eH.Worksheet?(u.push({id:B.id,params:{unitId:o,subUnitId:l}}),c.push({id:k.id,params:{unitId:o,rule:a,subUnitId:a.subUnitId}})):a.unitType===eH.SelectRange&&(u.push({id:L.id,params:{unitId:o,subUnitId:l,ruleIds:[a.id]}}),c.push({id:P.id,params:{unitId:o,subUnitId:l,rules:[a]}}))),s.unitType===eH.Worksheet?(u.push({id:k.id,params:{unitId:o,rule:s,subUnitId:s.subUnitId}}),c.unshift({id:B.id,params:{unitId:o,subUnitId:l}})):s.unitType===eH.SelectRange&&(s.id=i.createRuleId(o,l),u.push({id:P.id,params:{unitId:o,subUnitId:l,rules:[s]}}),c.unshift({id:L.id,params:{unitId:o,subUnitId:l,ruleIds:[s.id]}}))),(0,p.sequenceExecute)(u,r)&&n.pushUndoRedo({unitID:o,undoMutations:c,redoMutations:u}),!0}},rP=(e,t)=>{let{unitId:r,subUnitId:n,rowData:i}=e,s={},a=t.getRowManager();for(let e in i){let t=i[e],r=a.getRow(Number(e));s[e]=function(e,t){if(null==e)return e;let r=(0,p.Tools).deepClone(e);if(null==t)return r;let n={};return"h"in t&&(n.h=r.h),"ia"in t&&(n.ia=r.ia),"ah"in t&&(n.ah=r.ah),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,rowData:s}},rj={id:"sheet.mutation.set-row-data",type:p.CommandType.MUTATION,handler:(e,t)=>{let{rowData:r}=t,n=eE(e.get(p.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getRowManager();for(let e in r){let t=r[e];if(null==t){s.removeRow(Number(e));continue}Object.assign(s.getRowOrCreate(Number(e)),t)}return!0}},rF={type:p.CommandType.COMMAND,id:"sheet.command.set-row-data",handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService),t);if(!i)return!1;let{rowData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,rowData:s},c=rP(u,l);return!!r.syncExecuteCommand(rj.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:rj.id,params:c}],redoMutations:[{id:rj.id,params:u}]}),!0)}},rk=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},rB={id:"sheet.mutation.set-row-visible",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=0)}}return!0}},r$=(e,t)=>{if(null==e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},rH={id:"sheet.mutation.set-row-hidden",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=1)}}return!0}},rW={type:p.CommandType.COMMAND,id:"sheet.command.set-specific-rows-visible",handler:async(e,t)=>{var r,n,i;let{unitId:s,subUnitId:a,ranges:o}=t,l=e.get(p.ICommandService),u=e.get(p.IUndoRedoService),c=e.get(er),h=eE(e.get(p.IUniverInstanceService),{unitId:s,subUnitId:a});if(!h)return!1;let{worksheet:d}=h,m={unitId:s,subUnitId:a,ranges:o},g={unitId:s,subUnitId:a,reveal:!0,selections:o.map(e=>({range:e,primary:eV(e,d),style:null}))},f=rk(e,m),C={unitId:s,subUnitId:a,selections:rz(o).map(e=>({range:e,primary:eV(e,d),style:null}))},_=(0,p.sequenceExecute)([{id:rB.id,params:m},{id:ew.id,params:g}],l),y=c.onCommandExecute({id:rW.id,params:t}),E=(0,p.sequenceExecute)([...y.redos],l);return _.result&&E.result&&u.pushUndoRedo({unitID:s,undoMutations:[...null!=(r=y.preUndos)?r:[],{id:rH.id,params:f},{id:ew.id,params:C},...null!=(n=y.undos)?n:[]],redoMutations:[...null!=(i=y.preRedos)?i:[],{id:rB.id,params:m},{id:ew.id,params:g},...y.redos]}),!0}},rG={type:p.CommandType.COMMAND,id:"sheet.command.set-selected-rows-visible",handler:async e=>{var t;let r=e.get(z),n=e.get(p.IUniverInstanceService),i=e.get(p.ICommandService),s=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===p.RANGE_TYPE.ROW);if(!(null!=s&&s.length))return!1;let a=eE(n);if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,c=s.map(e=>o.getHiddenRows(e.startRow,e.endRow)).flat();return i.executeCommand(rW.id,{unitId:l,subUnitId:u,ranges:c})}},rY={type:p.CommandType.COMMAND,id:"sheet.command.set-rows-hidden",handler:async(e,t)=>{var r,n,i,s,a,o;let l=e.get(z),u=e.get(p.ICommandService),c=e.get(p.IUndoRedoService),h=e.get(p.IUniverInstanceService),d=e.get(er),m=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=l.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===p.RANGE_TYPE.ROW);if(!(null!=m&&m.length))return!1;let g=eE(h,t);if(!g)return!1;m=function(e,t){let r=e.getMaxColumns()-1,n=e.getHiddenRows(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startRow>=e.startRow&&t.endRow<=e.endRow);if(t.length){let n=e.startRow;t.forEach(e=>{e.startRow>n&&(i.push({startRow:n,endRow:e.startRow-1,startColumn:0,endColumn:r}),n=e.endRow+1)}),n<=e.endRow&&i.push({startRow:n,endRow:e.endRow,startColumn:0,endColumn:r})}else i.push(e)}),i}(g.worksheet,m);let{unitId:f,subUnitId:C,worksheet:_}=g,y={unitId:f,subUnitId:C,ranges:m},E={unitId:f,subUnitId:C,selections:rz(m).map(e=>({range:e,primary:eV(e,_),style:null}))},b=r$(e,y),R={unitId:f,subUnitId:C,reveal:!0,selections:m.map(e=>({range:e,primary:eV(e,_),style:null}))},N=d.onCommandExecute({id:rY.id,params:y});return(0,p.sequenceExecute)([...null!=(i=N.preRedos)?i:[],{id:rH.id,params:y},{id:ew.id,params:E},...N.redos],u).result&&c.pushUndoRedo({unitID:f,undoMutations:[...null!=(s=N.preUndos)?s:[],{id:rB.id,params:b},{id:ew.id,params:R},...null!=(a=N.undos)?a:[]],redoMutations:[...null!=(o=N.preRedos)?o:[],{id:rH.id,params:y},{id:ew.id,params:E},...N.redos]}),!0}};function rz(e){return(function(e){let t;let r=[];return e.sort((e,t)=>e.startRow-t.startRow).forEach(e=>{if(!t){t=e;return}e.startRow===t.endRow+1?t.endRow=e.endRow:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startRow?e.endRow+1:e.startRow-1;return{...e,startRow:t,endRow:t}})}let rq={type:p.CommandType.COMMAND,id:"sheet.command.set-style",handler:async(e,t)=>{var r;let n=eE(e.get(p.IUniverInstanceService),t);if(!n)return!1;let{unitId:i,subUnitId:s,worksheet:a}=n,{range:o,style:l}=t,u=e.get(p.ICommandService),c=e.get(p.IUndoRedoService),h=e.get(z),d=o?[o]:null==(r=h.getCurrentSelections())?void 0:r.map(e=>e.range);if(!(null!=d&&d.length))return!1;let m=new p.ObjectMatrix,g={forOperableEach:function(e,t){!function(e){for(let r=e.startRow;r<=e.endRow;r++)if(!a.getRowFiltered(r))for(let n=e.startColumn;n<=e.endColumn;n++)t(r,n,e)}(e)}};if((0,p.Tools).isArray(l.value))for(let e=0;e<d.length;e++)g.forOperableEach(d[e],(e,t,r)=>{m.setValue(e,t,{s:{[l.type]:l.value[e-r.startRow][t-r.startColumn]}})});else for(let e=0;e<d.length;e++){let t={s:{[l.type]:l.value}};g.forOperableEach(d[e],(e,r)=>m.setValue(e,r,t))}let f={subUnitId:s,unitId:i,cellValue:m.getMatrix()},C=eu(e,f),_=u.syncExecuteCommand(ec.id,f),{undos:y,redos:E}=e.get(er).onCommandExecute({id:rq.id,params:t}),b=(0,p.sequenceExecute)([...E],u);return!!_&&!!b.result&&(c.pushUndoRedo({unitID:f.unitId,undoMutations:[{id:ec.id,params:C},...y],redoMutations:[{id:ec.id,params:f},...E]}),!0)}},rX={type:p.CommandType.COMMAND,id:"sheet.command.set-bold",handler:async e=>{let t=e.get(z).getCurrentLastSelection();if(!t)return!1;let r=eE(e.get(p.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,{actualRow:i,actualColumn:s}=t.primary,a={style:{type:"bl",value:n.getRange(i,s).getFontWeight()===p.FontWeight.BOLD?p.BooleanNumber.FALSE:p.BooleanNumber.TRUE}};return e.get(p.ICommandService).executeCommand(rq.id,a)}},rK={type:p.CommandType.COMMAND,id:"sheet.command.set-italic",handler:async e=>{let t=e.get(z).getCurrentLastSelection();if(!t)return!1;let r=eE(e.get(p.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;if(t.primary){let{startRow:e,startColumn:r}=t.primary;i=n.getRange(e,r).getFontStyle()===p.FontItalic.ITALIC}let s={style:{type:"it",value:i?p.BooleanNumber.FALSE:p.BooleanNumber.TRUE}};return e.get(p.ICommandService).executeCommand(rq.id,s)}},rQ={type:p.CommandType.COMMAND,id:"sheet.command.set-underline",handler:async e=>{let t=e.get(z).getCurrentLastSelection();if(!t)return!1;let r=eE(e.get(p.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.startRow,t.primary.startColumn).getUnderline().s);let s={style:{type:"ul",value:{s:i?p.BooleanNumber.FALSE:p.BooleanNumber.TRUE}}};return e.get(p.ICommandService).executeCommand(rq.id,s)}},rZ={type:p.CommandType.COMMAND,id:"sheet.command.set-stroke",handler:async e=>{let t=e.get(z).getCurrentLastSelection();if(!t)return!1;let r=eE(e.get(p.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.actualRow,t.primary.actualColumn).getStrikeThrough().s);let s={style:{type:"st",value:{s:i?p.BooleanNumber.FALSE:p.BooleanNumber.TRUE}}};return e.get(p.ICommandService).executeCommand(rq.id,s)}},rJ=(p.CommandType.COMMAND,{type:p.CommandType.COMMAND,id:"sheet.command.set-font-family",handler:async(e,t)=>{if(!t)return!1;let r=e.get(p.ICommandService),n={style:{type:"ff",value:t.value}};return r.executeCommand(rq.id,n)}}),r0={type:p.CommandType.COMMAND,id:"sheet.command.set-font-size",handler:async(e,t)=>{if(!t)return!1;let r=e.get(p.ICommandService),n={style:{type:"fs",value:t.value}};return r.executeCommand(rq.id,n)}},r1={type:p.CommandType.COMMAND,id:"sheet.command.set-text-color",handler:async(e,t)=>{if(!t||!t.value)return!1;let r=e.get(p.ICommandService),n={style:{type:"cl",value:{rgb:t.value}}};return r.executeCommand(rq.id,n)}},r2={type:p.CommandType.COMMAND,id:"sheet.command.reset-text-color",handler:async e=>e.get(p.ICommandService).executeCommand(rq.id,{style:{type:"cl",value:{rgb:null}}})},r5={type:p.CommandType.COMMAND,id:"sheet.command.set-background-color",handler:async(e,t)=>{if(!t||!t.value)return!1;let r=e.get(p.ICommandService),n={style:{type:"bg",value:{rgb:t.value}}};return r.executeCommand(rq.id,n)}},r3={type:p.CommandType.COMMAND,id:"sheet.command.reset-background-color",handler:async e=>e.get(p.ICommandService).executeCommand(rq.id,{style:{type:"bg",value:{rgb:null}}})},r4={type:p.CommandType.COMMAND,id:"sheet.command.set-vertical-text-align",handler:async(e,t)=>{if(!t)return!1;let r=e.get(p.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"vt",value:t.value}};return r.executeCommand(rq.id,n)}},r6={type:p.CommandType.COMMAND,id:"sheet.command.set-horizontal-text-align",handler:async(e,t)=>{if(!t)return!1;let r=e.get(p.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"ht",value:t.value}};return r.executeCommand(rq.id,n)}},r9={type:p.CommandType.COMMAND,id:"sheet.command.set-text-wrap",handler:async(e,t)=>{if(!t)return!1;let r=e.get(p.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tb",value:t.value}};return r.executeCommand(rq.id,n)}},r7={type:p.CommandType.COMMAND,id:"sheet.command.set-text-rotation",handler:async(e,t)=>{if(!t)return!1;let r="number"==typeof t.value?{a:t.value}:{a:0,v:p.BooleanNumber.TRUE};return e.get(p.ICommandService).executeCommand(rq.id,{style:{type:"tr",value:r}})}},r8=(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().tabColor;return{...(0,p.Tools).deepClone(t),color:r}},ne={id:"sheet.mutation.set-tab-color",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().tabColor=t.color,!0)}},nt={type:p.CommandType.COMMAND,id:"sheet.command.set-tab-color",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService));if(!i)return!1;let{unitId:s,subUnitId:a}=i,o={color:t.value,unitId:s,subUnitId:a},l=r8(e,o);return!!r.syncExecuteCommand(ne.id,o)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:ne.id,params:l}],redoMutations:[{id:ne.id,params:o}]}),!0)}},nr={id:"sheet.mutation.set-workbook-name",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUnit(t.unitId,p.UniverInstanceType.UNIVER_SHEET);return!!r&&(r.setName(t.name),!0)}},nn={type:p.CommandType.COMMAND,id:"sheet.command.set-workbook-name",handler:async(e,t)=>{var r;if(!e.get(p.IUniverInstanceService).getUnit(t.unitId,p.UniverInstanceType.UNIVER_SHEET))return!1;let n=e.get(er).onCommandExecute({id:nn.id,params:t}),i={name:t.name,unitId:t.unitId},s=[...null!=(r=n.preRedos)?r:[],{id:nr.id,params:i},...n.redos],a=e.get(p.ICommandService);return(0,p.sequenceExecute)(s,a).result}},ni={id:"sheet.operation.set-worksheet-active",type:p.CommandType.OPERATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;for(let[,e]of r.getWorksheets())if(e.getSheetId()===t.subUnitId)return r.setActiveSheet(e),!0;return!1}},ns={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-activate",handler:(e,t,r)=>{let n=e.get(p.ICommandService),i=eE(e.get(p.IUniverInstanceService),t);if(!i)return!1;let{unitId:s,subUnitId:a}=i;return new Promise(e=>{setTimeout(()=>{e(n.syncExecuteCommand(ni.id,{unitId:s,subUnitId:a},r))},4)})}},na=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getColumnManager();for(let e=0;e<i.length;e++){let t=i[e];for(let e=t.startColumn;e<t.endColumn+1;e++){let t=a.getColumnOrCreate(e);s[e]=t.w}}return{unitId:r,subUnitId:n,ranges:i,colWidth:s}},no={id:"sheet.mutation.set-worksheet-col-width",type:p.CommandType.MUTATION,handler:(e,t)=>{var r;let n=eE(e.get(p.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getConfig().defaultColumnWidth,a=i.getColumnManager(),o=t.ranges;for(let e=0;e<o.length;e++){let n=o[e];for(let e=n.startColumn;e<n.endColumn+1;e++){if(!i.getColVisible(e))continue;let n=a.getColumnOrCreate(e);"number"==typeof t.colWidth?n.w=t.colWidth:n.w=null!=(r=t.colWidth[e])?r:s}}return!0}},nl={type:p.CommandType.COMMAND,id:"sheet.command.delta-column-width",handler:async(e,t)=>{let r;let n=e.get(z).getCurrentSelections();if(!(null!=n&&n.length))return!1;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=eE(e.get(p.IUniverInstanceService));if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,{anchorCol:c,deltaX:h}=t,d=o.getColumnWidth(c)+h,m=1===n.length&&n[0].range.rangeType===p.RANGE_TYPE.ALL,g=n.filter(e=>e.range.rangeType===p.RANGE_TYPE.COLUMN),f=m?p.RANGE_TYPE.ALL:g.some(({range:e})=>{let{startColumn:t,endColumn:r}=e;return t<=c&&c<=r})?p.RANGE_TYPE.COLUMN:p.RANGE_TYPE.NORMAL;if(f===p.RANGE_TYPE.ALL){let e=o.getRowCount();r={subUnitId:u,unitId:l,colWidth:d,ranges:Array(o.getColumnCount()).fill(void 0).map((t,r)=>({startRow:0,endRow:e-1,startColumn:r,endColumn:r}))}}else r=f===p.RANGE_TYPE.COLUMN?{subUnitId:u,unitId:l,ranges:g.map(e=>(0,p.Rectangle).clone(e.range)),colWidth:d}:{subUnitId:u,unitId:l,colWidth:d,ranges:[{startRow:0,endRow:o.getMaxRows()-1,startColumn:c,endColumn:c}]};let{undos:C,redos:_}=e.get(er).onCommandExecute({id:nl.id,params:r}),y=na(r,o),E=i.syncExecuteCommand(no.id,r),b=(0,p.sequenceExecute)([..._],i);return E&&b.result&&s.pushUndoRedo({unitID:l,undoMutations:[{id:no.id,params:y},...C],redoMutations:[{id:no.id,params:r},..._]}),!0}},nu={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-col-width",handler:async(e,t)=>{var r,n,i,s;let a=e.get(z),o=e.get(p.ICommandService),l=e.get(p.IUndoRedoService),u=e.get(er),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=c&&c.length))return!1;let h=eE(e.get(p.IUniverInstanceService),t);if(!h)return!1;let{subUnitId:d,unitId:m,worksheet:g}=h,f={subUnitId:d,unitId:m,ranges:c,colWidth:t.value},C=na(f,g),_=o.syncExecuteCommand(no.id,f),{undos:y,redos:E}=e.get(er).onCommandExecute({id:nu.id,params:f}),b=u.onCommandExecute({id:nu.id,params:f}),R=(0,p.sequenceExecute)([...E,...b.redos],o);return!!_&&!!R.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=b.preUndos)?i:[],{id:no.id,params:C},...y],redoMutations:[...null!=(s=b.preRedos)?s:[],{id:no.id,params:f},...E]}),!0)}},nc={type:p.CommandType.COMMAND,id:"sheet.command.set-col-is-auto-width",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=e.get(z),s=eE(e.get(p.IUniverInstanceService),t);if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=[];if(null!=t&&t.ranges)l=[...t.ranges];else{let e=i.getCurrentSelections();for(let t=0;t<e.length;t++)l.push(e[t].range)}if(!(null!=l&&l.length))return!1;let u={unitId:a,subUnitId:o,ranges:l},{undos:c,redos:h}=e.get(er).onCommandExecute({id:nc.id,params:u});return!!(0,p.sequenceExecute)([...h],r).result&&(n.pushUndoRedo({unitID:a,undoMutations:[...c],redoMutations:[...h]}),!0)}},nh={id:"sheet.mutation.set-worksheet-default-style",type:p.CommandType.MUTATION,handler:(e,t)=>{let{defaultStyle:r}=t,n=eE(e.get(p.IUniverInstanceService));if(!n)return!1;let{worksheet:i}=n;return!!i&&(i.setDefaultCellStyle(r),!0)}},nd=(e,t)=>{let r=eb(e.get(p.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetDefaultStyleMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),defaultStyle:n.getDefaultCellStyle()}},nm={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-default-style",handler:(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),{unitId:i}=t,s=nd(e,t);return!!r.syncExecuteCommand(nh.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:nh.id,params:s}],redoMutations:[{id:nh.id,params:t}]}),!0)}},ng=(e,t)=>{let r=eb(e.get(p.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetHideMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{hidden:n.isSheetHidden(),unitId:t.unitId,subUnitId:n.getSheetId()}},nf={id:"sheet.mutation.set-worksheet-hidden",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().hidden=t.hidden,!0)}},np={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-hidden",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=e.get(p.ErrorService),s=e.get(p.LocaleService),a=eE(e.get(p.IUniverInstanceService),t);if(!a)return!1;let{workbook:o,worksheet:l,unitId:u,subUnitId:c}=a;if(l.getConfig().hidden===p.BooleanNumber.TRUE)return!1;let h={unitId:u,subUnitId:c,hidden:p.BooleanNumber.TRUE},d=ng(e,h);return 1===o.getSheets().filter(e=>e.getConfig().hidden===p.BooleanNumber.FALSE).length?(i.emit(s.t("sheets.info.hideSheet")),!1):!!r.syncExecuteCommand(nf.id,h)&&(n.pushUndoRedo({unitID:u,undoMutations:[{id:nf.id,params:d}],redoMutations:[{id:nf.id,params:h}]}),!0)}},nC=(e,t)=>{let r=eb(e.get(p.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetNameMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,name:n.getName(),subUnitId:n.getSheetId()}},n_={id:"sheet.mutation.set-worksheet-name",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().name=t.name,!0)}},ny={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-name",handler:async(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(er),o=eE(e.get(p.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u}=o,c={subUnitId:u,name:t.name,unitId:l},h=nC(e,c),d=a.onCommandExecute({id:ny.id,params:t}),m=[...null!=(r=d.preRedos)?r:[],{id:n_.id,params:c},...d.redos],g=[...null!=(n=d.preUndos)?n:[],{id:n_.id,params:h},...d.undos];return!!await (0,p.sequenceExecute)(m,i).result&&(s.pushUndoRedo({unitID:l,undoMutations:g,redoMutations:m}),!0)}},nE=(e,t)=>({...(0,p.Tools).deepClone(t),toOrder:t.fromOrder,fromOrder:t.toOrder}),nb={id:"sheet.mutation.set-worksheet-order",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getConfig();return n.sheetOrder.splice(t.fromOrder,1),n.sheetOrder.splice(t.toOrder,0,t.subUnitId),!0}},nR={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-order",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService),t);if(!i)return!1;let{workbook:s,unitId:a,subUnitId:o}=i,l={fromOrder:s.getConfig().sheetOrder.indexOf(o),toOrder:t.order,unitId:a,subUnitId:o},u=nE(e,l);return!!r.syncExecuteCommand(nb.id,l)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:nb.id,params:u}],redoMutations:[{id:nb.id,params:l}]}),!0)}};class nN{constructor(e,t,r){x(this,"type",eH.SelectRange),x(this,"subType",e$.Delete),x(this,"status",p.PermissionStatus.INIT),x(this,"value",!0),x(this,"id"),x(this,"unitId"),x(this,"subUnitId"),x(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${eH.SelectRange}.${e$.Delete}.${r}`}}class nI{constructor(e,t,r){x(this,"type",eH.SelectRange),x(this,"subType",e$.ManageCollaborator),x(this,"status",p.PermissionStatus.INIT),x(this,"value",!0),x(this,"id"),x(this,"unitId"),x(this,"subUnitId"),x(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${eH.SelectRange}.${e$.ManageCollaborator}.${r}`}}let nA=()=>[eG,eW,nI,nN],nv=[e$.Edit,e$.View,e$.ManageCollaborator,e$.Delete],nS=()=>[eJ,e3,eY,e7,ez,e0,e2,eK,eQ,e6,e1,eZ,e9,e5,eq,e8,e4,eX],nT=[e$.Edit,e$.Print,e$.Comment,e$.View,e$.Copy,e$.Export,e$.ManageCollaborator,e$.CreateSheet,e$.DeleteSheet,e$.RenameSheet,e$.HideSheet,e$.Duplicate,e$.Share,e$.MoveSheet,e$.CopySheet,e$.RecoverHistory,e$.ViewHistory,e$.CreatePermissionObject],nO=()=>[ti,tC,tc,tr],nM=()=>[te,tt,tn,ts,ta,to,tu,tl,th,td,tm,tg,tf,tp],nw=[e$.Copy,e$.DeleteColumn,e$.DeleteRow,e$.EditExtraObject,e$.Filter,e$.InsertColumn,e$.InsertRow,e$.InsertHyperlink,e$.PivotTable,e$.SetCellStyle,e$.SetCellValue,e$.SetColumnStyle,e$.SetRowStyle,e$.Sort];class nx{constructor(){x(this,"_model",/* @__PURE__ */new Map),x(this,"_pointChange",new v.Subject),x(this,"pointChange$",this._pointChange.asObservable())}addRule(e){this._ensureSubUnitMap(e.unitId).set(e.subUnitId,e),this._pointChange.next(e)}deleteRule(e,t){var r,n,i;let s=null==(r=this._model.get(e))?void 0:r.get(t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.delete(t),this._pointChange.next(s))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=/* @__PURE__ */new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=/* @__PURE__ */new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=/* @__PURE__ */new Map,this._model.set(e,t)),t}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}var nU=Object.defineProperty,nD=Object.getOwnPropertyDescriptor,nV=(e,t)=>(r,n)=>t(r,n,e);let nL=class extends p.RxDisposable{constructor(e,t,r,n,i,s,a,o){super(),this._permissionService=e,this._univerInstanceService=t,this._injector=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointRuleModel=i,this._resourceManagerService=s,this._rangeProtectionRuleModel=a,this._logService=o,this._init(),this._initRuleChange(),this._initRuleSnapshot(),this._initPointSnapshot()}_init(){let e=e=>{let t=e.getUnitId(),r=e=>{let r=e.getSheetId();[...nO(),...nM()].forEach(e=>{let n=new e(t,r);this._permissionService.addPermissionPoint(n)}),this._logService.log("[WorksheetPermissionService]","Initialization completed",t,r)};e.getSheets().forEach(e=>{r(e)}),e.sheetCreated$.subscribe(e=>{r(e)}),e.sheetDisposed$.subscribe(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...nA()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...nO(),...nM()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})})};this._univerInstanceService.getAllUnitsForType(p.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this._univerInstanceService.getTypeOfUnitAdded$(p.UniverInstanceType.UNIVER_SHEET).pipe((0,T.takeUntil)(this.dispose$)).subscribe(e),this._univerInstanceService.getTypeOfUnitDisposed$(p.UniverInstanceType.UNIVER_SHEET).pipe((0,T.takeUntil)(this.dispose$)).subscribe(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();nO().forEach(e=>{let t=new e(r,n);this._permissionService.deletePermissionPoint(t.id)})})})}_initRuleChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":break;case"delete":nO().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,!0)});break;case"set":nO().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,e.rule)})}}))}_initRuleSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:()=>JSON.stringify(this._worksheetProtectionRuleModel.toObject()),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_PLUGIN",businesses:[eB.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionRuleModel.fromObject(t),Object.keys(t).forEach(t=>{nO().forEach(r=>{let n=new r(e,t);n.value=!1,this._permissionService.addPermissionPoint(n)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)},onUnLoad:e=>{let t=this._univerInstanceService.getUnit(e);t&&(t.getSheets().forEach(t=>{let r=t.getSheetId();[...nO(),...nM()].forEach(t=>{let n=new t(e,r);this._permissionService.deletePermissionPoint(n.id)})}),nS().forEach(t=>{let r=new t(e);this._permissionService.deletePermissionPoint(r.id)})),this._worksheetProtectionRuleModel.deleteUnitModel(e)}}))}_initPointSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:()=>JSON.stringify(this._worksheetProtectionPointRuleModel.toObject()),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_POINT_PLUGIN",businesses:[eB.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionPointRuleModel.fromObject(t),Object.keys(t).forEach(t=>{nM().forEach(r=>{let n=new r(e,t);this._permissionService.addPermissionPoint(n)})})},onUnLoad:e=>{this._worksheetProtectionPointRuleModel.deleteUnitModel(e)}}))}};nL=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?nD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&nU(t,r,s),s})([nV(0,(0,p.Inject)(p.IPermissionService)),nV(1,(0,p.Inject)(p.IUniverInstanceService)),nV(2,(0,p.Inject)(p.Injector)),nV(3,(0,p.Inject)(F)),nV(4,(0,p.Inject)(nx)),nV(5,(0,p.Inject)(p.IResourceManagerService)),nV(6,(0,p.Inject)(V)),nV(7,(0,p.Inject)(p.ILogService))],nL);let nP={id:"sheet.mutation.set-worksheet-permission-points",type:p.CommandType.MUTATION,handler:(e,t)=>{let{rule:r}=t;return e.get(nx).addRule(r),!0}},nj={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-permission-points",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),{rule:n}=t;return r.executeCommand(nP.id,{rule:n,unitId:n.unitId,subUnitId:n.subUnitId}),!0}},nF={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),{rule:i,permissionId:s,oldRule:a}=t,{unitId:o,subUnitId:l}=i,u={...i,permissionId:s};if(await r.executeCommand(rV.id,{unitId:o,subUnitId:l,newRule:u})){let e=[{id:rV.id,params:{unitId:o,subUnitId:l,newRule:u}}],t=[{id:rV.id,params:{unitId:o,subUnitId:l,rule:a}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}},nk=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getRowManager();for(let{startRow:e,endRow:t}of i)for(let r=e;r<t+1;r++){let e=a.getRowOrCreate(r);s[r]=e.h}return{unitId:r,subUnitId:n,ranges:i,rowHeight:s}},nB=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getRowManager();for(let{startRow:e,endRow:t}of i)for(let r=e;r<=t;r++){let e=a.getRowOrCreate(r);s[r]=e.ia}return{unitId:r,subUnitId:n,ranges:i,autoHeightInfo:s}},n$=(e,t)=>{let{unitId:r,subUnitId:n,rowsAutoHeightInfo:i}=e,s=[],a=t.getRowManager();for(let e of i){let{row:t}=e,{ah:r}=a.getRowOrCreate(t);s.push({row:t,autoHeight:r})}return{unitId:r,subUnitId:n,rowsAutoHeightInfo:s}},nH={id:"sheet.mutation.set-worksheet-row-height",type:p.CommandType.MUTATION,handler:(e,t)=>{var r;let{ranges:n,rowHeight:i}=t,s=eE(e.get(p.IUniverInstanceService),t);if(!s)return!1;let{worksheet:a}=s,o=a.getRowManager(),l=a.getConfig().defaultRowHeight;for(let{startRow:e,endRow:t}of n)for(let n=e;n<=t;n++){let e=o.getRowOrCreate(n);"number"==typeof i?e.h=i:e.h=null!=(r=i[n])?r:l,e.h=Math.min(2e3,e.h)}return!0}},nW={id:"sheet.mutation.set-worksheet-row-is-auto-height",type:p.CommandType.MUTATION,handler:(e,t)=>{var r;let{ranges:n,autoHeightInfo:i}=t,s=eE(e.get(p.IUniverInstanceService),t);if(!s)return!1;let a=s.worksheet.getRowManager();for(let{startRow:e,endRow:t}of n)for(let n=e;n<=t;n++){let e=a.getRowOrCreate(n);"number"==typeof i?e.ia=i:e.ia=null!=(r=i[n])?r:void 0}return!0}},nG={id:"sheet.mutation.set-worksheet-row-auto-height",type:p.CommandType.MUTATION,handler:(e,t)=>{let{rowsAutoHeightInfo:r}=t,n=eE(e.get(p.IUniverInstanceService),t);if(!n)return!1;let i=n.worksheet.getRowManager();for(let{row:e,autoHeight:t}of r)i.getRowOrCreate(e).ah=t;return!0}},nY={type:p.CommandType.COMMAND,id:"sheet.command.delta-row-height",handler:async(e,t)=>{var r,n;let i;let s=e.get(z).getCurrentSelections(),a=e.get(er);if(!(null!=s&&s.length))return!1;let o=eE(e.get(p.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o,{anchorRow:h,deltaY:d}=t,m=l.getRowHeight(h)+d,g=1===s.length&&s[0].range.rangeType===p.RANGE_TYPE.ALL,f=s.filter(e=>e.range.rangeType===p.RANGE_TYPE.ROW),C=g?p.RANGE_TYPE.ALL:f.some(({range:e})=>{let{startRow:t,endRow:r}=e;return t<=h&&h<=r})?p.RANGE_TYPE.ROW:p.RANGE_TYPE.NORMAL;if(C===p.RANGE_TYPE.ALL){let e=l.getRowCount();i={subUnitId:u,unitId:c,rowHeight:m,ranges:Array(l.getColumnCount()).fill(void 0).map((t,r)=>({startRow:r,endRow:r,startColumn:0,endColumn:e-1}))}}else i=C===p.RANGE_TYPE.ROW?{subUnitId:u,unitId:c,ranges:f.map(e=>(0,p.Rectangle).clone(e.range)),rowHeight:m}:{subUnitId:u,unitId:c,rowHeight:m,ranges:[{startRow:h,endRow:h,startColumn:0,endColumn:l.getMaxColumns()-1}]};let _=nk(i,l),y={unitId:c,subUnitId:u,ranges:i.ranges,autoHeightInfo:p.BooleanNumber.FALSE},E=nB(y,l),b=e.get(p.ICommandService),R=e.get(p.IUndoRedoService),N=a.onCommandExecute({id:nY.id,params:i}),I=(0,p.sequenceExecute)([{id:nH.id,params:i},{id:nW.id,params:y}],b),A=(0,p.sequenceExecute)([...N.redos],b);return!!I.result&&!!A.result&&(R.pushUndoRedo({unitID:c,undoMutations:[...null!=(r=N.preUndos)?r:[],{id:nH.id,params:_},{id:nW.id,params:E},...N.undos],redoMutations:[...null!=(n=N.preRedos)?n:[],{id:nH.id,params:i},{id:nW.id,params:y},...N.redos]}),!0)}},nz={type:p.CommandType.COMMAND,id:"sheet.command.set-row-height",handler:(e,t)=>{var r,n,i,s;let a=e.get(z),o=e.get(p.ICommandService),l=e.get(p.IUndoRedoService),u=e.get(p.IUniverInstanceService),c=e.get(er),h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d=eE(u,t);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f}=d,C={subUnitId:g,unitId:m,ranges:h,rowHeight:t.value},_=nk(C,f),y={unitId:m,subUnitId:g,ranges:C.ranges,autoHeightInfo:p.BooleanNumber.FALSE},E=nB(y,f),b=(0,p.sequenceExecute)([{id:nH.id,params:C},{id:nW.id,params:y}],o),R=c.onCommandExecute({id:nz.id,params:C}),N=(0,p.sequenceExecute)([...R.redos],o);return!!b.result&&!!N.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=R.preRedos)?i:[],{id:nH.id,params:_},{id:nW.id,params:E},...R.undos],redoMutations:[...null!=(s=R.preRedos)?s:[],{id:nH.id,params:C},{id:nW.id,params:y},...R.redos]}),!0)}},nq={type:p.CommandType.COMMAND,id:"sheet.command.set-row-is-auto-height",handler:async(e,t)=>{var r,n;let i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(z),o=eE(e.get(p.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u,worksheet:c}=o,h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d={unitId:l,subUnitId:u,ranges:h,autoHeightInfo:p.BooleanNumber.TRUE},m=nB(d,c),g=i.syncExecuteCommand(nW.id,d),{undos:f,redos:C}=e.get(er).onCommandExecute({id:nq.id,params:d}),_=(0,p.sequenceExecute)([...C],i);return!!g&&!!_.result&&(s.pushUndoRedo({unitID:l,undoMutations:[{id:nW.id,params:m},...f],redoMutations:[{id:nW.id,params:d},...C]}),!0)}},nX={type:p.CommandType.COMMAND,id:"sheet.command.set-worksheet-show",handler:async(e,t)=>{let{unitId:r,subUnitId:n}=t,i=e.get(p.ICommandService),s=e.get(p.IUndoRedoService),a=e.get(p.IUniverInstanceService);if(!eE(e.get(p.IUniverInstanceService)))return!1;let o=a.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getSheetBySheetId(n);if(!l||l.getConfig().hidden===p.BooleanNumber.FALSE)return!1;let u={unitId:r,subUnitId:n,hidden:p.BooleanNumber.FALSE},c=ng(e,u),h=i.syncExecuteCommand(nf.id,u),d=i.syncExecuteCommand(ni.id,{unitId:r,subUnitId:n});return!!h&&!!d&&(s.pushUndoRedo({unitID:r,undoMutations:[{id:nf.id,params:c}],redoMutations:[{id:nf.id,params:u}]}),!0)}},nK={id:"sheet.command.toggle-cell-checkbox",type:p.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,row:i,col:s,paragraphIndex:a}=t,o=e.get(p.IUniverInstanceService).getUnit(r,p.UniverInstanceType.UNIVER_SHEET),l=null==o?void 0:o.getSheetBySheetId(n),u=e.get(p.IUndoRedoService),c=e.get(p.ICommandService);if(!l)return!1;let h=l.getCell(i,s);if(!(null!=h&&h.p))return!1;let d=(0,p.Tools).deepClone(h.p),m=new p.DocumentDataModel(d),g=(0,p.BuildTextUtils).paragraph.bullet.toggleChecklist({document:m,paragraphIndex:a});if(!g)return!1;(0,p.TextX).apply(m.getBody(),g.serialize());let f={unitId:r,subUnitId:n,cellValue:{[i]:{[s]:{p:d,t:p.CellValueType.STRING}}}},C={id:ec.id,params:f},_=eu(e,f),y={id:ec.id,params:_},E=[C];return u.pushUndoRedo({redoMutations:E,undoMutations:[y],unitID:r}),c.syncExecuteCommand(C.id,C.params)}},nQ={id:"sheet.mutation.toggle-gridlines",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=eE(e.get(p.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r;return n.getConfig().showGridlines=t.showGridlines,!0}},nZ={type:p.CommandType.COMMAND,id:"sheet.command.toggle-gridlines",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=eE(e.get(p.IUniverInstanceService));if(!i)return!1;let{worksheet:s}=i,a=s.getConfig().showGridlines;if(a===(null==t?void 0:t.showGridlines))return!1;let{unitId:o,subUnitId:l}=i,u={showGridlines:a===p.BooleanNumber.TRUE?p.BooleanNumber.FALSE:p.BooleanNumber.TRUE,unitId:o,subUnitId:l};return!!r.syncExecuteCommand(nQ.id,u)&&(n.pushUndoRedo({unitID:o,undoMutations:[{id:nQ.id,params:{showGridlines:a,unitId:o,subUnitId:l}}],redoMutations:[{id:nQ.id,params:u}]}),!0)}},nJ={id:"sheet.mutation.empty",type:p.CommandType.MUTATION,handler:()=>!0},n0=e=>{let t=new p.ObjectMatrix;return e.forEach(e=>{(0,p.Range).foreach(e,(e,r)=>{t.setValue(e,r,1)})}),t.forValue((e,r)=>{let n=t.getValue(e-1,r);n&&t.setValue(e,r,n+1)}),t},n1=e=>{let t={area:0},r=(e,r)=>t.area<e&&(t.area=e,t.range=r,!0);return e.forValue((t,n,i)=>{let s=1,a=i;r(1*a,{startRow:t-a+1,endRow:t,startColumn:n,endColumn:n});let o={startRow:t-a+1,endRow:t,startColumn:0,endColumn:n};for(let i=n-1;i>=0&&e.getValue(t,i);i--){let n=(a=Math.min(e.getValue(t,i)||0,a))*++s;o.startColumn=i,o.startRow=t-a+1,r(n,o)}}),t},n2=(e,t)=>{(0,p.Range).foreach(t,(t,r)=>{e.realDeleteValue(t,r)});for(let r=t.startColumn;r<=t.endColumn;r++){let n=t.endRow+1;if(e.getValue(n,r)>0){e.setValue(n,r,1);let t=n+1;for(;e.getValue(t,r)>0;)e.setValue(t,r,e.getValue(t-1,r)+1),t++}}return e},n5=e=>{let t=[],r=n1(e);for(;r.area>0;)r.range&&(t.push(r.range),n2(e,r.range)),r=n1(e);return t},n3=e=>n5(n0(e)),n4=(0,p.createIdentifier)("INumfmtService"),n6=(e,t)=>{let r=e.get(n4),{values:n,unitId:i,subUnitId:s}=t,a=[],o=[];Object.keys(n).forEach(e=>{n[e].ranges.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n?a.push({pattern:n.pattern,row:e,col:t}):o.push({startColumn:t,endColumn:t,startRow:e,endRow:e})})})});let l=[];if(a.length){let e=ie(i,s,a);Object.keys(e.values).forEach(t=>{let r=e.values[t];r.ranges=n3(r.ranges)}),l.push({id:n9.id,params:ie(i,s,a)})}return o.length&&l.push({id:n7.id,params:{unitId:i,subUnitId:s,ranges:o}}),l},n9={id:"sheet.mutation.set.numfmt",type:p.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{values:r,refMap:n}=t,i=e.get(n4),s=t.unitId,a=t.subUnitId,o=Object.keys(r).reduce((e,t)=>{let i=n[t],s=r[t].ranges;return i&&e.push({...i,ranges:s}),e},[]);return i.setValues(s,a,o),!0}},n7={id:"sheet.mutation.remove.numfmt",type:p.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,ranges:i}=t;return e.get(n4).deleteValues(r,n,i),!0}},n8=(e,t)=>{let r=e.get(n4),{ranges:n,unitId:i,subUnitId:s}=t,a=[];if(n.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n&&a.push({pattern:n.pattern,row:e,col:t})})}),!a.length)return[];let o=ie(i,s,a);return Object.keys(o.values).forEach(e=>{let t=o.values[e];t.ranges=n3(t.ranges)}),[{id:n9.id,params:o}]},ie=(e,t,r)=>{let n=eh(r,"pattern"),i={},s={},a=ed();return Object.keys(n).forEach(e=>{let t=n[e],r=a();i[r]={pattern:e},t.forEach(e=>{s[r]||(s[r]={ranges:[]}),s[r].ranges.push((0,p.cellToRange)(e.row,e.col))})}),{unitId:e,subUnitId:t,refMap:i,values:s}},it={id:"sheet.operation.scroll-to-cell",type:p.CommandType.OPERATION,handler:()=>!0},ir="ONLY_REGISTER_FORMULA_RELATED_MUTATIONS_KEY",ii="maxCellsPerSheet";var is=Object.defineProperty,ia=Object.getOwnPropertyDescriptor,io=(e,t)=>(r,n)=>t(r,n,e);let il=class extends p.Disposable{constructor(e,t,r){var n;super(),this._commandService=e,this._configService=t,this._dataSyncPrimaryController=r,[ec,tw,tO,ey,eA,tq,tX,tV,tU,eN,re,n7,t7,nr,n_,n9,rn,nJ].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)}),null!=(n=this._configService.getConfig(ir))&&n||[ef,ep,eC,eI,tR,tI,nl,nY,tY,tG,tW,tL,tj,t$,tB,tk,tz,tJ,eF,tQ,t4,t5,t6,rs,rt,r3,r2,r5,rC,rp,rm,rg,rf,rS,rR,rI,nu,rE,ry,rx,rw,rU,r6,t_,nz,rY,rH,rB,rF,rj,rv,rG,rA,rW,rq,nt,ne,r1,r7,r9,r4,nn,ns,ni,np,nf,ny,nR,nb,nG,nH,nq,nW,no,ew,it,tS,t1,rO,nX,nZ,nQ,nj,k,rV,B,nP,j,rL,tA,$,tv,nF,P,L,rD,nK,nh,nm].forEach(e=>this.disposeWithMe(this._commandService.registerCommand(e))),this._configService.setConfig(ii,3e6)}};il=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ia(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&is(t,r,s),s})([io(0,p.ICommandService),io(1,p.IConfigService),io(2,(0,p.Optional)(_.DataSyncPrimaryController))],il);var iu=Object.defineProperty,ic=Object.getOwnPropertyDescriptor,ih=(e,t)=>(r,n)=>t(r,n,e);let id=class extends p.Disposable{constructor(e,t){super(),this._univerInstanceService=e,this._commandService=t,this._initialize()}_initialize(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id!==C.SetFormulaCalculationResultMutation.id)return;let{unitData:t}=e.params,r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];if(null==s)continue;let a=Object.keys(s);for(let e=0;e<a.length;e++){let t=a[e],r=s[t];if(null==r)continue;let o=this._getMergedCellData(i,t,r),l={subUnitId:t,unitId:i,cellValue:o};n.push({id:ec.id,params:l})}}return n.every(e=>this._commandService.executeCommand(e.id,e.params,{onlyLocal:!0}))}))}_getMergedCellData(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e),i=null==n?void 0:n.getStyles(),s=null==n?void 0:n.getSheetBySheetId(t),a=null==s?void 0:s.getCellMatrix(),o=new p.ObjectMatrix(r);return o.forValue((e,t,r)=>{let n=null==a?void 0:a.getValue(e,t),s=(0,C.handleNumfmtInCell)(n,r,i);o.setValue(e,t,s)}),o.getMatrix()}};id=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ic(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iu(t,r,s),s})([ih(0,(0,p.Inject)(p.IUniverInstanceService)),ih(1,p.ICommandService)],id);let im={};var ig=Object.defineProperty,ip=Object.getOwnPropertyDescriptor,iC=(e,t)=>(r,n)=>t(r,n,e);let i_=class extends p.Disposable{constructor(e,t){super(),this._definedNamesService=e,this._resourceManagerService=t,this._initialize()}_initialize(){this._initSnapshot()}_initSnapshot(){let e=e=>{let t=this._definedNamesService.getDefinedNameMap(e);return t?JSON.stringify(t):""},t=e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({pluginName:"SHEET_DEFINED_NAME_PLUGIN",businesses:[p.UniverInstanceType.UNIVER_SHEET],toJson:t=>e(t),parseJson:e=>t(e),onUnLoad:e=>{this._definedNamesService.removeUnitDefinedName(e)},onLoad:(e,t)=>{this._definedNamesService.registerDefinedNames(e,t)}}))}};i_=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ip(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&ig(t,r,s),s})([iC(0,C.IDefinedNamesService),iC(1,p.IResourceManagerService)],i_);let iy={MoveRangeCommandId:ej,InsertRowCommandId:tF,InsertColCommandId:tH,RemoveColCommandId:t3,RemoveRowCommandId:t2,DeleteRangeMoveLeftCommandId:tb,DeleteRangeMoveUpCommandId:tN,InsertRangeMoveDownCommandId:"sheet.command.insert-range-move-down",InsertRangeMoveRightCommandId:tP,MoveColsCommandId:tZ,MoveRowsCommandId:tK,ReorderRangeCommandId:ri};var iE=((g=iE||{})[g.Set=0]="Set",g[g.Delete=1]="Delete",g[g.HorizontalMove=2]="HorizontalMove",g[g.VerticalMove=3]="VerticalMove",g[g.Unknown=4]="Unknown",g);let ib=Number.MAX_SAFE_INTEGER,iR=e=>{let t={...e},r=Number.isNaN(t.startRow)&&Number.isNaN(t.endRow)&&!Number.isNaN(t.startColumn)&&!Number.isNaN(t.endColumn),n=Number.isNaN(t.startColumn)&&Number.isNaN(t.endColumn)&&!Number.isNaN(t.startRow)&&!Number.isNaN(t.endRow);return(t.rangeType===p.RANGE_TYPE.COLUMN||r)&&(t.startRow=0,t.endRow=ib),(t.rangeType===p.RANGE_TYPE.ROW||n)&&(t.startColumn=0,t.endColumn=ib),t.rangeType===p.RANGE_TYPE.ALL&&(t.startColumn=0,t.endColumn=ib,t.startRow=0,t.endRow=ib),t},iN=e=>{let t=e.rangeType;return e.rangeType===p.RANGE_TYPE.COLUMN?t=p.RANGE_TYPE.ROW:e.rangeType===p.RANGE_TYPE.ROW&&(t=p.RANGE_TYPE.COLUMN),{startRow:e.startColumn,endRow:e.endColumn,startColumn:e.startRow,endColumn:e.endRow,rangeType:t}},iI=(e,t,r)=>{let n={...r},i={...t},s=(e,t)=>{let r=Math.max(e.start,t.start),n=Math.min(e.end,t.end);return n<r?null:{start:r,end:n}},a=t.start>e.start;if(a){let r=Math.min(e.end,t.start)-e.start+1;i.start-=r,i.end-=r}let o=e.end-e.start+1,l=s(e,n),u=l&&l.end-l.start+1>=n.end-n.start+1;if(e.end<n.start)n.start-=o,n.end-=o;else if(l){let t=l.end-l.start+1;if(u){let t;let r=(t={start:n.start-e.start,end:n.start-e.start+n.end-n.start},{start:i.start+t.start,end:i.start+t.start+t.end-t.start});n.start=r.start,n.end=r.end}else l.start>e.start?a?(n.end-=t+o,n.start-=o):n.end-=t:a?n.end-=t:n.start>e.start&&n.end>e.end?(n.start-=o,n.end-=o+t):n.end-=t}let c=s(i,n);return u||(i.start<=n.start?(n.start+=o,n.end+=o):c&&(a?i.end<=n.start||i.start<=n.start&&i.end>=n.start?(n.start+=o,n.end+=o):i.start>=n.start&&i.start<=n.end&&(n.end+=o):n.start<i.start&&n.end>i.start?n.end+=o:(n.start>=i.end||n.start>=i.start&&n.start<=i.end)&&(n.end+=o,n.start+=o))),{step:n.start-r.start,length:n.end-n.start+1-(r.end-r.start+1)}},iA=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=iR(r),s=iR(n),a=iR(t),o=iI({start:i.startRow,end:i.endRow},{start:s.startRow,end:s.endRow},{start:a.startRow,end:a.endRow});return null===o?[{type:iE.Delete}]:[{type:iE.VerticalMove,step:o.step||0,length:o.length||0}]},iv=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startRow,s=r.endRow-r.startRow+1,a=n.startRow,o=new p.ObjectMatrix;return(0,p.Range).foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveRows(i,s,a),(0,p.queryObjectMatrix)(o,e=>1===e)},iS=(e,t)=>{let{range:r,order:n}=e.params||{};if(!r||!n)return[t];let i=new p.ObjectMatrix;(0,p.Range).foreach(t,(e,t)=>{i.setValue(e,t,1)});let s=new p.ObjectMatrix;return(0,p.Range).foreach(r,(e,t)=>{var r;if(n.hasOwnProperty(e)){let a=n[e],o=null!=(r=i.getValue(a,t))?r:0;s.setValue(e,t,o)}}),s.forValue((e,t,r)=>{i.setValue(e,t,r)}),(0,p.queryObjectMatrix)(i,e=>1===e)},iT=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=iR(r),s=iR(n),a=iR(t),o=iI({start:i.startColumn,end:i.endColumn},{start:s.startColumn,end:s.endColumn},{start:a.startColumn,end:a.endColumn});return null===o?[{type:iE.Delete}]:[{type:iE.HorizontalMove,step:o.step||0,length:o.length||0}]},iO=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startColumn,s=r.endColumn-r.startColumn+1,a=n.startColumn,o=new p.ObjectMatrix;return(0,p.Range).foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveColumns(i,s,a),(0,p.queryObjectMatrix)(o,e=>1===e)},iM=(e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s)return[];let a=[];if((0,p.Rectangle).contains(i,t)&&a.push({type:iE.Delete}),(0,p.Rectangle).contains(s,t)){a.push({type:iE.Delete});let e=(0,p.Rectangle).getRelativeRange(t,s),r=(0,p.Rectangle).getPositionRange(e,i);return[{type:iE.Set,range:r}]}return a},iw=(e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s||!(0,p.Rectangle).intersects(s,t)&&!(0,p.Rectangle).intersects(i,t))return[t];if((0,p.Rectangle).contains(s,t)){let e=(0,p.Rectangle).getRelativeRange(t,s);return[(0,p.Rectangle).getPositionRange(e,i)]}let a=new p.ObjectMatrix;(0,p.Range).foreach(t,(e,t)=>{a.setValue(e,t,1)});let o=new p.ObjectMatrix,l=(0,p.Rectangle).getIntersects(s,t);l&&(0,p.Range).foreach(l,(e,t)=>{a.getValue(e,t)&&(a.setValue(e,t,void 0),o.setValue(e,t,1))});let u=i.startColumn-s.startColumn,c=i.startRow-s.startRow,h={startColumn:i.startColumn-u,endColumn:i.endColumn-u,startRow:i.startRow-c,endRow:i.endRow-c};return h&&(0,p.Range).foreach(h,(e,t)=>{var r;let n=e+c,i=t+u;a.setValue(n,i,null!=(r=o.getValue(e,t))?r:0)}),(0,p.queryObjectMatrix)(a,e=>1===e)},ix=(e,t)=>{let r=iR(e),n=iR(t);if(r.startRow<=n.startRow&&r.endRow>=n.endRow){if(n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn){let e=(0,p.Rectangle).getIntersects(n,r);if(e)return{step:0,length:-(e.endColumn-e.startColumn+1)}}if(n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn&&r.endRow-r.startRow+1>=n.endRow-n.startRow+1)return null;if(n.startColumn>=r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn){let e=(0,p.Rectangle).getIntersects(n,r);if(e){let t=-(e.endColumn-e.startColumn+1);return{step:-(r.endColumn-r.startColumn+1-(e.endColumn-e.startColumn+1)),length:t}}}if(n.startColumn>r.endColumn)return{step:-(r.endColumn-r.startColumn+1),length:0}}return{step:0,length:0}},iU=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=ix(n,t);if(s){let{step:e,length:t}=s;i.push({type:iE.HorizontalMove,step:e,length:t})}else i.push({type:iE.Delete});return i},iD=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=ix(iN(n),iN(t));if(s){let{step:e,length:t}=s;i.push({type:iE.VerticalMove,step:e,length:t})}else i.push({type:iE.Delete});return i},iV=(e,t)=>{let{range:r,order:n}=e.params||{};if(!r||!n)return[];if((0,p.Rectangle).contains(r,t)&&t.endRow===t.startRow){let e=[],r=t.startRow;for(let t in n)if(n[t]===r){let n=Number(t);return e.push({type:iE.VerticalMove,step:n-r,length:0}),e}}return[]},iL=(e,t)=>{let r=iR(e),n=iR(t);if(r.startRow<=n.startRow&&r.endRow>=n.endRow){if(n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn)return{step:0,length:r.endColumn-r.startColumn+1};if(n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn>r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn||n.startColumn>=r.endColumn)return{step:r.endColumn-r.startColumn+1,length:0}}return{step:0,length:0}},iP=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=iL(iN(n),iN(t));return i.push({type:iE.VerticalMove,step:s,length:a}),i},ij=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=iL(n,t);return i.push({type:iE.HorizontalMove,step:s,length:a}),i},iF=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=iL(iN(n),iN(t));return i.push({type:iE.VerticalMove,step:s,length:a}),i},ik=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endRow-n.startRow+1,s={...n,startRow:n.startRow,endRow:Number.POSITIVE_INFINITY},a=(0,p.Rectangle).subtract(t,s),o=(0,p.Rectangle).getIntersects(s,t);if(!o)return[t];let l=new p.ObjectMatrix;return a.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&(0,p.Range).foreach(o,(e,t)=>{l.setValue(e+i,t,1)}),(0,p.queryObjectMatrix)(l,e=>1===e)},iB=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=iL(n,t);return i.push({type:iE.HorizontalMove,step:s,length:a}),i},i$=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endColumn-n.startColumn+1,s={...n,startColumn:n.startColumn,endColumn:Number.POSITIVE_INFINITY},a=(0,p.Rectangle).subtract(t,s),o=(0,p.Rectangle).getIntersects(s,t);if(!o)return[t];let l=new p.ObjectMatrix;return a.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&(0,p.Range).foreach(o,(e,t)=>{l.setValue(e,t+i,1)}),(0,p.queryObjectMatrix)(l,e=>1===e)},iH=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=ix(n,t);if(s){let{step:e,length:t}=s;i.push({type:iE.HorizontalMove,step:e,length:t})}else i.push({type:iE.Delete});return i},iW=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={startRow:n.startRow,endRow:n.endRow,startColumn:n.startColumn,endColumn:Number.POSITIVE_INFINITY},s=n.endColumn-n.startColumn+1,a=(0,p.Rectangle).getIntersects(n,t),o=(0,p.Rectangle).subtract(t,i),l=(0,p.Rectangle).getIntersects(i,t);if(!a&&!l)return[t];let u=new p.ObjectMatrix;return l&&(0,p.Range).foreach(l,(e,t)=>{u.setValue(e,t-s,1)}),a&&(0,p.Range).foreach(a,(e,t)=>{u.setValue(e,t-s,0)}),o.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,p.queryObjectMatrix)(u,e=>1===e)},iG=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=ix(iN(n),iN(t));if(s){let{step:e,length:t}=s;i.push({type:iE.VerticalMove,step:e,length:t})}else i.push({type:iE.Delete});return i},iY=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={...n,startRow:n.startRow,endRow:Number.POSITIVE_INFINITY},s=n.endRow-n.startRow+1,a=(0,p.Rectangle).getIntersects(n,t),o=(0,p.Rectangle).subtract(t,i),l=(0,p.Rectangle).getIntersects(i,t);if(!a&&!l)return[t];let u=new p.ObjectMatrix;return l&&(0,p.Range).foreach(l,(e,t)=>{u.setValue(e-s,t,1)}),a&&(0,p.Range).foreach(a,(e,t)=>{u.setValue(e-s,t,0)}),o.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,p.queryObjectMatrix)(u,e=>1===e)},iz=(e,t)=>{var r;let n=null!=(r=e.ranges)?r:[e.range],i=new p.ObjectMatrix;return(0,p.Range).foreach(t,(e,t)=>{i.setValue(e,t,1)}),n.forEach(e=>{let t=e.startRow,r=e.endRow-t+1;i.removeRows(t,r)}),(0,p.queryObjectMatrix)(i,e=>1===e)},iq=(e,t)=>{let r=e.params,n=r.range.startRow,i=r.range.endRow-r.range.startRow+1,s=r.direction;return s===p.Direction.UP&&n===t.startRow||s===p.Direction.DOWN&&n-1===t.endRow?[{startRow:t.startRow,endRow:t.endRow+i,startColumn:t.startColumn,endColumn:t.endColumn}]:t.startRow>=n?[{startRow:t.startRow+i,endRow:t.endRow+i,startColumn:t.startColumn,endColumn:t.endColumn}]:t.endRow<=n?[t]:[{startRow:t.startRow,endRow:t.endRow+i,startColumn:t.startColumn,endColumn:t.endColumn}]},iX=(e,t)=>{let r=e.params,n=r.range.startColumn,i=r.range.endColumn-r.range.startColumn+1,s=r.direction;return s===p.Direction.LEFT&&n===t.startColumn||s===p.Direction.RIGHT&&n-1===t.endColumn?[{startRow:t.startRow,endRow:t.endRow,startColumn:t.startColumn,endColumn:t.endColumn+i}]:t.startColumn>=n?[{startRow:t.startRow,endRow:t.endRow,startColumn:t.startColumn+i,endColumn:t.endColumn+i}]:t.endColumn<=n?[t]:[{startRow:t.startRow,endRow:t.endRow,startColumn:t.startColumn,endColumn:t.endColumn+i}]},iK=(e,t)=>{let r={...t};return e.forEach(e=>{switch(e.type){case iE.Delete:r=null;break;case iE.HorizontalMove:if(!r)return;r.startColumn+=e.step,r.endColumn+=e.step+(e.length||0);break;case iE.VerticalMove:if(!r)return;r.startRow+=e.step,r.endRow+=e.step+(e.length||0);break;case iE.Set:r=e.range}}),r&&(r.endColumn<r.startColumn||r.endRow<r.startRow)?null:r},iQ=(e,t)=>{let r=[];switch(t.id){case iy.DeleteRangeMoveLeftCommandId:r=iH(t,e);break;case iy.DeleteRangeMoveUpCommandId:r=iG(t,e);break;case iy.InsertColCommandId:r=ij(t,e);break;case iy.InsertRangeMoveDownCommandId:r=iF(t,e);break;case iy.InsertRangeMoveRightCommandId:r=iB(t,e);break;case iy.InsertRowCommandId:r=iP(t,e);break;case iy.MoveColsCommandId:r=iT(t,e);break;case iy.MoveRangeCommandId:r=iM(t,e);break;case iy.MoveRowsCommandId:r=iA(t,e);break;case iy.RemoveColCommandId:r=iU(t,e);break;case iy.RemoveRowCommandId:r=iD(t,e);break;case iy.ReorderRangeCommandId:r=iV(t,e)}return iK(r,e)},iZ=(e,t)=>{let r=[];switch(t.id){case iy.DeleteRangeMoveLeftCommandId:return iW(t,e);case iy.DeleteRangeMoveUpCommandId:return iY(t,e);case iy.InsertRangeMoveDownCommandId:return ik(t,e);case iy.InsertRangeMoveRightCommandId:return i$(t,e);case iy.InsertColCommandId:return iX(t,e);case iy.InsertRowCommandId:return iq(t,e);case iy.MoveColsCommandId:return iO(t,e);case iy.MoveRangeCommandId:return iw(t,e);case iy.MoveRowsCommandId:return iv(t,e);case iy.ReorderRangeCommandId:return iS(t,e);case iy.RemoveColCommandId:r=iU(t,e);break;case iy.RemoveRowCommandId:return iz(t.params,e)}let n=iK(r,e);return n?[n]:[]};function iJ(e,t){var r,n,i,s,a,o;let l=e.get(p.IUniverInstanceService),u=e.get(z);switch(t.id){case iy.MoveColsCommandId:{let e=t.params,r=eE(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startColumn:e.fromRange.startColumn<e.toRange.startColumn?e.fromRange.endColumn+1:e.toRange.startColumn,endColumn:e.fromRange.startColumn<e.toRange.startColumn?e.toRange.endColumn-1:e.fromRange.startColumn-1}]}}case iy.MoveRowsCommandId:{let e=t.params,r=eE(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startRow:e.fromRange.startRow<e.toRange.startRow?e.fromRange.endRow+1:e.toRange.startRow,endRow:e.fromRange.startRow<e.toRange.startRow?e.toRange.endRow-1:e.fromRange.startRow-1}]}}case iy.MoveRangeCommandId:{let e=t.params,r=eE(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,e.toRange]}}case iy.InsertRowCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startRow>0?[{...r,startRow:r.startRow-1,endRow:r.endRow-1}]:[],{...r,startRow:r.startRow,endRow:Number.MAX_SAFE_INTEGER}]}}case iy.InsertColCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startColumn>0?[{...r,startColumn:r.startColumn-1,endColumn:r.endColumn-1}]:[],{...r,startColumn:r.startColumn,endColumn:Number.MAX_SAFE_INTEGER}]}}case iy.RemoveRowCommandId:{let e=t.params.range,r=eE(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startRow:e.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}}case iy.RemoveColCommandId:{let e=t.params.range,r=eE(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}}case iy.DeleteRangeMoveUpCommandId:case iy.InsertRangeMoveDownCommandId:{let e=eE(l),s=(null==(r=t.params)?void 0:r.range)||(null==(i=null==(n=u.getCurrentSelections())?void 0:n.map(e=>e.range))?void 0:i[0]);return s?{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[s,{...s,startRow:s.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}:{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[]}}case iy.DeleteRangeMoveLeftCommandId:case iy.InsertRangeMoveRightCommandId:{let e=(null==(s=t.params)?void 0:s.range)||(null==(o=null==(a=u.getCurrentSelections())?void 0:a.map(e=>e.range))?void 0:o[0]),r=eE(l);return e?{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}:{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[]}}case iy.ReorderRangeCommandId:{let{range:e,order:r}=t.params,n=[];for(let t=e.startRow;t<=e.endRow;t++)t in r&&n.push({startRow:t,endRow:t,startColumn:e.startColumn,endColumn:e.endColumn});let i=eE(l);return{unitId:i.unitId,subUnitId:i.subUnitId,ranges:n}}}}var i0=Object.defineProperty,i1=Object.getOwnPropertyDescriptor,i2=(e,t)=>(r,n)=>t(r,n,e);let i5=(0,p.createInterceptorKey)("MERGE_REDO"),i3=(0,p.createInterceptorKey)("MERGE_UNDO"),i4=Math.floor(Number.MAX_SAFE_INTEGER/10);class i6 extends p.Disposable{constructor(e,t,r,n,i=!1){super(),this._unitId=e,this._subUnitId=t,this._range=r,this._callback=n,this._skipIntersects=i}onMutation(e){var t,r;if((null==(t=e.params)?void 0:t.unitId)!==this._unitId)return;if(e.id===eA.id){let t=e.params;if(t.from.subUnitId!==this._subUnitId||t.to.subUnitId!==this._subUnitId)return}else if((null==(r=e.params)?void 0:r.subUnitId)!==this._subUnitId)return;if(!this._range)return;if(this._skipIntersects){if(e.id===eN.id)return;let t=function(e){switch(e.id){case tX.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startColumn:t.targetRange.startColumn-.5,endColumn:t.targetRange.startColumn-.5}]}case tq.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startRow:t.targetRange.startRow-.5,endRow:t.targetRange.startRow-.5}]}case eA.id:{let t=e.params;return[new(0,p.ObjectMatrix)(t.from.value).getRange(),new(0,p.ObjectMatrix)(t.to.value).getRange()]}case tw.id:{let t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.startColumn-.5}]}case tO.id:{let t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.startRow-.5}]}case tV.id:case tU.id:return[e.params.range]}}(e);if(null!=t&&t.some(e=>(0,p.Rectangle).intersects(e,this._range)))return}let n=function(e,t){let{id:r,params:n}=t,i={length:0,step:0,type:iE.Unknown};switch(r){case eN.id:i.type=iE.Delete;break;case tq.id:(i=iI({start:n.sourceRange.startRow,end:n.sourceRange.endRow},{start:n.targetRange.startRow,end:n.targetRange.endRow},{start:e.startRow,end:e.endRow})).type=iE.VerticalMove;break;case tX.id:(i=iI({start:n.sourceRange.startColumn,end:n.sourceRange.endColumn},{start:n.targetRange.startColumn,end:n.targetRange.endColumn},{start:e.startColumn,end:e.endColumn})).type=iE.HorizontalMove;break;case tV.id:(i=ix(n.range,e))?i.type=iE.HorizontalMove:i={step:0,length:0,type:iE.Delete};break;case tU.id:(i=ix(iN(n.range),iN(e)))?i.type=iE.VerticalMove:i={step:0,length:0,type:iE.Delete};break;case tO.id:(i=iL(iN(n.range),iN(e))).type=iE.VerticalMove;break;case tw.id:(i=iL(n.range,e)).type=iE.HorizontalMove;break;case eA.id:i=function(e,t,r){let n=[];if((0,p.Rectangle).contains(t,r)&&n.push({type:iE.Delete}),(0,p.Rectangle).contains(e,r)){n.push({type:iE.Delete});let i=(0,p.Rectangle).getRelativeRange(r,e),s=(0,p.Rectangle).getPositionRange(i,t);return[{type:iE.Set,range:s}]}return n}(n.fromRange||new(0,p.ObjectMatrix)(n.from).getRange(),n.toRange||new(0,p.ObjectMatrix)(n.to).getRange(),e)}return i?Array.isArray(i)?iK(i,e):iK([i],e):e}(this._range,e);if(n&&(0,p.Rectangle).equals(n,this._range))return!1;let i=this._range;this._range=n,this._callback(i,n)}}let i9=class extends p.Disposable{constructor(e,t,r,n){super(),x(this,"interceptor",new p.InterceptorManager({MERGE_REDO:i5,MERGE_UNDO:i3})),x(this,"_watchRanges",/* @__PURE__ */new Set),x(this,"_refRangeManagerMap",/* @__PURE__ */new Map),x(this,"_serializer",function(){let e=["startRow","startColumn","endRow","endColumn","rangeType"];return{deserialize:t=>{let r=e.reduce((e,t,r)=>(e[String(r)]=t,e),{});return t.split("_").reduce((e,t,n)=>{let i=String(n);return t&&r[i]&&(e[r[i]]=t),e},{})},serialize:t=>e.reduce((e,r,n)=>{let i=t[r];return void 0!==i?`${e}${n>0?"_":""}${i}`:`${e}`},"")}}()),x(this,"_onRefRangeChange",()=>{this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=this._univerInstanceService.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET).getActiveSheet(),r=i7(this._univerInstanceService),n=i8(this._univerInstanceService);if(!t||!r||!n)return{redos:[],undos:[],preRedos:[],preUndos:[]};let i=((()=>{switch(e.id){case iy.MoveColsCommandId:{let i=e.params,s=Math.min(i.fromRange.startColumn,i.toRange.startColumn);return this._checkRange([{...i.fromRange,startColumn:s,endColumn:t.getColumnCount()-1}],r,n)}case iy.MoveRowsCommandId:{let i=e.params,s=Math.min(i.fromRange.startRow,i.toRange.startRow);return this._checkRange([{...i.fromRange,startRow:s,endRow:t.getRowCount()-1}],r,n)}case iy.MoveRangeCommandId:return this._checkRange([e.params.fromRange,e.params.toRange],r,n);case iy.InsertRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:p.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case iy.InsertColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:p.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case iy.RemoveRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:p.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case iy.RemoveColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:p.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case iy.DeleteRangeMoveUpCommandId:case iy.InsertRangeMoveDownCommandId:{let t=e.params.range||se(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:t.endColumn,endRow:i4};return this._checkRange([i],r,n)}case iy.DeleteRangeMoveLeftCommandId:case iy.InsertRangeMoveRightCommandId:{let t=e.params.range||se(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:i4,endRow:t.endRow};return this._checkRange([i],r,n)}case iy.ReorderRangeCommandId:{let{range:t,order:i}=e.params,s=[];for(let e=t.startRow;e<=t.endRow;e++)e in i&&s.push({startRow:e,endRow:e,startColumn:t.startColumn,endColumn:t.endColumn});return this._checkRange(s,r,n)}}})()||[]).reduce((t,r)=>{let n=r(e);return t.push(n),t},[]).reduce((e,t)=>{var r,n;return e.redos.push(...t.redos),e.undos.push(...t.undos),e.preRedos.push(...null!=(r=t.preRedos)?r:[]),e.preUndos.push(...null!=(n=t.preUndos)?n:[]),e},{redos:[],undos:[],preUndos:[],preRedos:[]}),s=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.preRedos,null)||[],a=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.redos,null)||[],o=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.preUndos,null)||[];return{redos:a,undos:this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.undos,null)||[],preRedos:s,preUndos:o}}})}),x(this,"_checkRange",(e,t,r)=>{let n=`${t}_${r}`,i=this._refRangeManagerMap.get(n);if(i){let t=/* @__PURE__ */new Set;return[...i.keys()].forEach(r=>{let n=i.get(r),s=this._serializer.deserialize(r),a={...s,startRow:+s.startRow,endRow:+s.endRow,startColumn:+s.startColumn,endColumn:+s.endColumn,rangeType:s.rangeType&&+s.rangeType};e.some(e=>(0,p.Rectangle).intersects(e,a))&&n&&n.forEach(e=>{t.add(e)})}),[...t]}return[]}),x(this,"registerRefRange",(e,t,r,n)=>{let i=r||i7(this._univerInstanceService),s=n||i8(this._univerInstanceService);if(!i||!s)return(0,p.toDisposable)(()=>{});let a=`${i}_${s}`,o=this._serializer.serialize(e),l=this._refRangeManagerMap.get(a);l||(l=/* @__PURE__ */new Map,this._refRangeManagerMap.set(a,l));let u=l.get(o);return u?u.add(t):l.set(o,/* @__PURE__ */new Set([t])),(0,p.toDisposable)(()=>{let e=l.get(o);e&&(e.delete(t),e.size||(l.delete(o),l.size||this._refRangeManagerMap.delete(a)))})}),this._commandService=e,this._sheetInterceptorService=t,this._univerInstanceService=r,this._selectionManagerService=n,this._onRefRangeChange(),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_REDO,{priority:-1,handler:e=>e}),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_UNDO,{priority:-1,handler:e=>e})}watchRange(e,t,r,n,i){let s;0===this._watchRanges.size&&(s=this._commandService.onCommandExecuted(e=>{if(e.type!==p.CommandType.MUTATION)return!1;for(let t of this._watchRanges)t.onMutation(e)}));let a=new i6(e,t,r,n,i);this._watchRanges.add(a);let o=(0,p.toDisposable)(()=>{this._watchRanges.delete(a),0===this._watchRanges.size&&(null==s||s.dispose(),s=null)}),l=this.disposeWithMe(o);return(0,p.toDisposable)(()=>{l.dispose(),o.dispose()})}};function i7(e){return e.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET).getUnitId()}function i8(e){var t;return null==(t=e.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET).getActiveSheet())?void 0:t.getSheetId()}function se(e){var t;return(null==(t=e.getCurrentSelections())?void 0:t.map(e=>e.range))||[]}i9=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&i0(t,r,s),s})([i2(0,p.ICommandService),i2(1,(0,p.Inject)(er)),i2(2,(0,p.Inject)(p.IUniverInstanceService)),i2(3,(0,p.Inject)(z))],i9);var st=Object.defineProperty,sr=Object.getOwnPropertyDescriptor,sn=(e,t)=>(r,n)=>t(r,n,e);let si=[tw.id,tO.id,tV.id,tU.id],ss=[tq.id,tX.id];function sa(e,t){let r=e;if(void 0!==t){let e=[];for(let n=0;n<r.length;n++){let{startRow:i,endRow:s,startColumn:a,endColumn:o}=r[n];if(t===p.Dimension.ROWS)for(let t=i;t<=s;t++){let r={startRow:t,endRow:t,startColumn:a,endColumn:o};e.push(r)}else if(t===p.Dimension.COLUMNS)for(let t=a;t<=o;t++){let r={startRow:i,endRow:s,startColumn:t,endColumn:t};e.push(r)}}r=e}return r}let so=(0,p.createInterceptorKey)("mergeCellPermissionCheck"),sl=class extends p.Disposable{constructor(e,t,r,n,i,s){super(),x(this,"disposableCollection",new p.DisposableCollection),x(this,"interceptor",new p.InterceptorManager({MERGE_CELL_INTERCEPTOR_CHECK:so})),this._commandService=e,this._refRangeService=t,this._univerInstanceService=r,this._injector=n,this._sheetInterceptorService=i,this._selectionManagerService=s,this._onRefRangeChange(),this._initCommandInterceptor(),this._commandExecutedListener()}_initCommandInterceptor(){let e=this;this._sheetInterceptorService.interceptCommand({getMutations(t){var r;switch(t.id){case ef.id:case eC.id:{let t=e._univerInstanceService.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET),n=t.getUnitId(),i=null==t?void 0:t.getActiveSheet();if(!i)return{redos:[],undos:[]};let s=i.getSheetId(),a=i.getConfig().mergeData,o=null==(r=e._selectionManagerService.getCurrentSelections())?void 0:r.map(e=>e.range);if(o&&o.length>0&&o.some(e=>a.some(t=>(0,p.Rectangle).intersects(t,e)))){let t={unitId:n,subUnitId:s,ranges:o},r=t8(e._injector,t);return{redos:[{id:re.id,params:t}],undos:[{id:t7.id,params:r}]}}}}return{redos:[],undos:[]}}}),this._sheetInterceptorService.interceptRanges({getMutations:({unitId:e,subUnitId:t,ranges:r})=>{let n=[],i=[],s={redos:n,undos:i};if(!r||!r.length)return s;let a=eE(this._univerInstanceService,{unitId:e,subUnitId:t});if(!a)return s;let{worksheet:o}=a,l=o.getMergeData().filter(e=>r.some(t=>(0,p.Rectangle).intersects(e,t)));return l.length?(n.push({id:re.id,params:{unitId:e,subUnitId:t,ranges:l}}),i.push({id:t7.id,params:{unitId:e,subUnitId:t,ranges:l}}),{undos:i,redos:n}):s}})}refRangeHandle(e,t,r){switch(e.id){case iy.MoveColsCommandId:{let n=e.params;return this._handleMoveColsCommand(n,t,r)}case iy.MoveRowsCommandId:{let n=e.params;return this._handleMoveRowsCommand(n,t,r)}case tk.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertRowCommand(n,i,s)}case tW.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertColCommand(n,i,s)}case t4.id:{let n=e.params;return this._handleRemoveColCommand(n,t,r)}case t5.id:{let n=e.params;return this._handleRemoveRowCommand(n,t,r)}case eF.id:{let n=e.params;return this._handleMoveRangeCommand(n,t,r)}case tj.id:{let n=e.params;return this._handleInsertRangeMoveRightCommand(n,t,r)}case tL.id:{let n=e.params;return this._handleInsertRangeMoveDownCommand(n,t,r)}case tI.id:{let n=e.params;return this._handleDeleteRangeMoveUpCommand(n,t,r)}case tR.id:{let n=e.params;return this._handleDeleteRangeMoveLeftCommand(n,t,r)}}return{redos:[],undos:[]}}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getUniverSheetInstance(e);if(!r)return;let n=null==r?void 0:r.getSheetBySheetId(t);if(!n)return;this.disposableCollection.dispose();let i=n.getMergeData(),s=r=>this.refRangeHandle(r,e,t);i.forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,s,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===ni.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}if(t.id===t7.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(r.unitId,r.subUnitId)}})),this._univerInstanceService.getCurrentTypeOfUnit$(p.UniverInstanceType.UNIVER_SHEET).pipe((0,b.first)(e=>!!e)).subscribe(t=>{let r=t.getActiveSheet();r&&e(t.getUnitId(),r.getSheetId())})}_handleMoveRowsCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startRow:u,endRow:c}=l;if(s.forEach(t=>{if(u<=t.startRow&&c>=t.endRow){a.ranges.push(t);let r=iK(iA({id:iy.MoveRowsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=t8(this._injector,a),d=t9(this._injector,o);return{redos:[{id:re.id,params:a},{id:t7.id,params:o}],undos:[{id:re.id,params:d},{id:t7.id,params:h}]}}_handleMoveColsCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startColumn:u,endColumn:c}=l;if(s.forEach(t=>{if(u<=t.startColumn&&c>=t.endColumn){a.ranges.push(t);let r=iK(iT({id:iy.MoveColsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=t8(this._injector,a),d=t9(this._injector,o);return{redos:[{id:re.id,params:a},{id:t7.id,params:o}],undos:[{id:re.id,params:d},{id:t7.id,params:h}]}}_handleMoveRangeCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=i.getMergeData(),a=s.filter(t=>(0,p.Rectangle).intersects(t,e.fromRange)),o=s.filter(t=>(0,p.Rectangle).intersects(t,e.toRange)),l=sa(a.map(t=>(0,p.Rectangle).getRelativeRange(t,e.fromRange)).map(t=>(0,p.Rectangle).getPositionRange(t,e.toRange))).filter(e=>!s.some(t=>(0,p.Rectangle).equals(e,t)));return{redos:[{id:re.id,params:{unitId:t,subUnitId:r,ranges:a}},{id:re.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:t7.id,params:{unitId:t,subUnitId:r,ranges:l}}],undos:[{id:re.id,params:{unitId:t,subUnitId:r,ranges:l}},{id:t7.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:t7.id,params:{unitId:t,subUnitId:r,ranges:a}}]}}_handleInsertRowCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let{range:s}=e,{startRow:a,endRow:o}=s,l=(0,p.Tools).deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=(0,p.Tools).deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&(t.endRow+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d);return{redos:[{id:re.id,params:c},{id:t7.id,params:d}],undos:[{id:re.id,params:m},{id:t7.id,params:h}]}}_handleInsertColCommand(e,t,r){let{range:n}=e,i=su(this._univerInstanceService,t);if(!i)return this._handleNull();let s=sc(i,r);if(!s)return this._handleNull();let{startColumn:a,endColumn:o}=n,l=(0,p.Tools).deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=(0,p.Tools).deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&(t.endColumn+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d);return{redos:[{id:re.id,params:c},{id:t7.id,params:d}],undos:[{id:re.id,params:m},{id:t7.id,params:h}]}}_handleRemoveColCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let{range:s}=e,{startColumn:a,endColumn:o}=s,l=(0,p.Tools).deepClone(i.getMergeData()).reduce((e,t)=>((0,p.Rectangle).intersects(s,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=(0,p.Tools).deepClone(i.getMergeData()).reduce((e,t)=>{if((0,p.Rectangle).intersects(s,t)){if(a<=t.startColumn&&o>=t.endColumn)return e;a>=t.startColumn&&o<=t.endColumn?t.endColumn-=o-a+1:a<t.startColumn?(t.startColumn=a,t.endColumn-=o-a+1):o>t.endColumn&&(t.endColumn=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d),g=[{id:re.id,params:c}],f=[{id:t7.id,params:d}];return{preUndos:[{id:re.id,params:m}],undos:[{id:t7.id,params:h}],preRedos:g,redos:f}}_handleRemoveRowCommand(e,t,r){let{range:n}=e,i=su(this._univerInstanceService,t);if(!i)return this._handleNull();let s=sc(i,r);if(!s)return this._handleNull();let{startRow:a,endRow:o}=n,l=(0,p.Tools).deepClone(s.getMergeData()).reduce((e,t)=>((0,p.Rectangle).intersects(n,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=(0,p.Tools).deepClone(s.getMergeData()).reduce((e,t)=>{if((0,p.Rectangle).intersects(n,t)){if(a<=t.startRow&&o>=t.endRow)return e;a>=t.startRow&&o<=t.endRow?t.endRow-=o-a+1:a<t.startRow?(t.startRow=a,t.endRow-=o-a+1):o>t.endRow&&(t.endRow=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d),g=[{id:re.id,params:c}],f=[{id:t7.id,params:d}];return{preUndos:[{id:re.id,params:m}],undos:[{id:t7.id,params:h}],preRedos:g,redos:f}}_handleInsertRangeMoveRightCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if((0,p.Rectangle).intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),(0,p.Rectangle).contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn+t,endRow:e.endRow,endColumn:e.endColumn+t})}});let c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d);return{preRedos:[{id:re.id,params:c}],redos:[{id:t7.id,params:d}],preUndos:[{id:re.id,params:m}],undos:[{id:t7.id,params:h}]}}_handleInsertRangeMoveDownCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if((0,p.Rectangle).intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),(0,p.Rectangle).contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1;u.push({startRow:e.startRow+r,startColumn:e.startColumn,endRow:e.endRow+r,endColumn:e.endColumn})}});let c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d),g=[{id:re.id,params:c}],f=[{id:t7.id,params:d}],C=[{id:re.id,params:m}];return{redos:f,undos:[{id:t7.id,params:h}],preRedos:g,preUndos:C}}_handleDeleteRangeMoveUpCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if((0,p.Rectangle).intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),(0,p.Rectangle).contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1,n=(0,p.Rectangle).moveVertical(e,-r);u.push(n)}});let c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d),g=[{id:re.id,params:c}],f=[{id:t7.id,params:d}],C=[{id:re.id,params:m}];return{redos:f,undos:[{id:t7.id,params:h}],preRedos:g,preUndos:C}}_handleDeleteRangeMoveLeftCommand(e,t,r){let n=su(this._univerInstanceService,t);if(!n)return this._handleNull();let i=sc(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if((0,p.Rectangle).intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),(0,p.Rectangle).contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn-t,endRow:e.endRow,endColumn:e.endColumn-t})}});let c={unitId:t,subUnitId:r,ranges:l},h=t8(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=t9(this._injector,d);return{preRedos:[{id:re.id,params:c}],redos:[{id:t7.id,params:d}],undos:[{id:t7.id,params:h}],preUndos:[{id:re.id,params:m}]}}_checkIsMergeCell(e){return!(e.startRow===e.endRow&&e.startColumn===e.endColumn)}_handleNull(){return{redos:[],undos:[]}}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(ss.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn,u=r.getConfig().mergeData,c=[];u.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h}=e;(0,p.Rectangle).intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),e.startRow===e.endRow&&e.startColumn===e.endColumn||c.push({startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h})}),r.setMergeData(c),this.disposableCollection.dispose();let{unitId:h,subUnitId:d}=e.params,m=e=>this.refRangeHandle(e,h,d);c.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,m,h,d))})}if(si.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=r.getConfig().mergeData,i=e.params;if(!i)return;let{range:s}=i,a=e.id.includes("row"),o=e.id.includes("insert"),l=a?s.startRow:s.startColumn,u=a?s.endRow:s.endColumn,c=u-l+1,h=[];n.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s}=e;o?a?l<=t&&(t+=c,r+=c):l<=n&&(n+=c,i+=c):a?u<t&&(t-=c,r-=c):u<n&&(n-=c,i-=c),e.startRow===e.endRow&&e.startColumn===e.endColumn||h.push({startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s})}),r.setMergeData(h),this.disposableCollection.dispose();let{unitId:d,subUnitId:m}=e.params,g=e=>this.refRangeHandle(e,d,m);h.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,g,d,m))})}}))}};function su(e,t){return t?e.getUniverSheetInstance(t):e.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET)}function sc(e,t){return t?e.getSheetBySheetId(t):e.getActiveSheet()}sl=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sr(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&st(t,r,s),s})([sn(0,(0,p.Inject)(p.ICommandService)),sn(1,(0,p.Inject)(i9)),sn(2,(0,p.Inject)(p.IUniverInstanceService)),sn(3,(0,p.Inject)(p.Injector)),sn(4,(0,p.Inject)(er)),sn(5,(0,p.Inject)(z))],sl);var sh=Object.defineProperty,sd=Object.getOwnPropertyDescriptor;let sm=class extends p.Disposable{constructor(e){super(),this._sheetInterceptorService=e,this._initialize()}_initialize(){this._initInterceptorCellContent()}_initInterceptorCellContent(){this.disposeWithMe(this._sheetInterceptorService.intercept(X.CELL_CONTENT,{priority:11,effect:p.InterceptorEffectEnum.Value|p.InterceptorEffectEnum.Style,handler:(e,t,r)=>{var n;let i=t.workbook.getStyles().getStyleByCell(e);return r(null!=(n=null==i?void 0:i.n)&&n.pattern?{...e}:(null==e?void 0:e.t)===p.CellValueType.NUMBER&&"number"==typeof(null==e?void 0:e.v)?{...e,v:(0,C.stripErrorMargin)(e.v)}:{...e})}}))}};sm=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sd(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sh(t,r,s),s})([(f=(0,p.Inject)(er),(e,t)=>f(e,t,0))],sm);var sg=Object.defineProperty,sf=Object.getOwnPropertyDescriptor,sp=(e,t)=>(r,n)=>t(r,n,e);let sC=class extends p.Disposable{constructor(e,t,r){super(),x(this,"_cellRuleCache",/* @__PURE__ */new Map),x(this,"_permissionIdCache",/* @__PURE__ */new Map),x(this,"_cellInfoCache",/* @__PURE__ */new Map),x(this,"_rowInfoCache",/* @__PURE__ */new Map),x(this,"_colInfoCache",/* @__PURE__ */new Map),this._ruleModel=e,this._permissionService=t,this._univerInstanceService=r,this._initUpdateCellRuleCache(),this._initUpdateCellInfoCache(),this._initUpdateRowColInfoCache(),this._initCache()}_initCache(){this._univerInstanceService.getAllUnitsForType(p.UniverInstanceType.UNIVER_SHEET).forEach(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();this.reBuildCache(r,n)})})}_initUpdateCellInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,E.filter)(e=>e.type===eH.SelectRange),(0,R.map)(e=>e)).subscribe(e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureCellInfoMap(r,t);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;for(let e=t;e<=r;e++)for(let t=n;t<=i;t++)a.delete(`${e}-${t}`)})}),this._ruleModel.ruleChange$.subscribe(e=>{var t;let{unitId:r,subUnitId:n}=e,i=this._ensureCellInfoMap(r,n);e.rule.ranges.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{i.delete(`${e}-${t}`)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{this._cellInfoCache.delete(`${e}-${t}`)})}))})}_initUpdateCellRuleCache(){this._ruleModel.ruleChange$.subscribe(e=>{let{type:t}=e;"add"===t?this._addCellRuleCache(e):"delete"===t?this._deleteCellRuleCache(e):(this._deleteCellRuleCache({...e,rule:e.oldRule}),this._addCellRuleCache(e))})}_ensureRuleMap(e,t){let r=this._cellRuleCache.get(e);r||(r=/* @__PURE__ */new Map,this._cellRuleCache.set(e,r));let n=r.get(t);return n||(n=/* @__PURE__ */new Map,r.set(t,n)),n}_ensureCellInfoMap(e,t){let r=this._cellInfoCache.get(e);r||(r=/* @__PURE__ */new Map,this._cellInfoCache.set(e,r));let n=r.get(t);return n||(n=/* @__PURE__ */new Map,r.set(t,n)),n}_ensureRowColInfoMap(e,t,r){let n="row"===r?this._rowInfoCache.get(e):this._colInfoCache.get(e);n||(n=/* @__PURE__ */new Map,"row"===r?this._rowInfoCache.set(e,n):this._colInfoCache.set(e,n));let i=n.get(t);return i||(i=/* @__PURE__ */new Map,n.set(t,i)),i}_addCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:s,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=s;t<=a;t++)i.set(`${e}-${t}`,n.id)}),this._permissionIdCache.set(n.permissionId,n.id)}_deleteCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t),s=this._ensureCellInfoMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=n;t<=a;t++)i.delete(`${e}-${t}`),s.delete(`${e}-${t}`)}),this._permissionIdCache.delete(n.permissionId)}_getSelectionActions(e,t,r){var n,i,s,a,o,l,u,c;let h=null==(i=null==(n=this._permissionService.getPermissionPoint(new eW(e,t,r.permissionId).id))?void 0:n.value)||i,d=null==(a=null==(s=this._permissionService.getPermissionPoint(new eG(e,t,r.permissionId).id))?void 0:s.value)||a,m=null!=(l=null==(o=this._permissionService.getPermissionPoint(new nI(e,t,r.permissionId).id))?void 0:o.value)&&l,g=null!=(c=null==(u=this._permissionService.getPermissionPoint(new nN(e,t,r.permissionId).id))?void 0:u.value)&&c;return{[e$.Edit]:h,[e$.View]:d,[e$.ManageCollaborator]:m,[e$.Delete]:g}}reBuildCache(e,t){let r=this._ensureRuleMap(e,t),n=this._ensureCellInfoMap(e,t);r.clear(),n.clear();let i=this._ensureRowColInfoMap(e,t,"row"),s=this._ensureRowColInfoMap(e,t,"col");i.clear(),s.clear(),this._ruleModel.getSubunitRuleList(e,t).forEach(a=>{let o=this._getSelectionActions(e,t,a),l={...o,ruleId:a.id,ranges:a.ranges};a.ranges.forEach(e=>{let{startRow:t,endRow:u,startColumn:c,endColumn:h}=e;for(let e=t;e<=u;e++){let t=i.get(`${e}`);t?t.set(a.id,o):i.set(`${e}`,/* @__PURE__ */new Map([[a.id,o]]));for(let t=c;t<=h;t++){r.set(`${e}-${t}`,a.id),n.set(`${e}-${t}`,l);let i=s.get(`${t}`);i?i.set(a.id,o):s.set(`${t}`,/* @__PURE__ */new Map([[a.id,o]]))}}}),this._permissionIdCache.set(a.permissionId,a.id)})}getRowPermissionInfo(e,t,r,n){var i;let s=null==(i=this._rowInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}getColPermissionInfo(e,t,r,n){var i;let s=null==(i=this._colInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}_initUpdateRowColInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,E.filter)(e=>e.type===eH.SelectRange),(0,R.map)(e=>e)).subscribe({next:e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureRowColInfoMap(r,t,"row"),o=this._ensureRowColInfoMap(r,t,"col"),l=this._getSelectionActions(r,t,s);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:s}=e;for(let e=t;e<=r;e++){let t=a.get(`${e}`);t?t.set(i,l):a.set(`${e}`,/* @__PURE__ */new Map([[i,l]]));for(let e=n;e<=s;e++){let t=o.get(`${e}`);t?t.set(i,l):o.set(`${e}`,/* @__PURE__ */new Map([[i,l]]))}}})}}),this._ruleModel.ruleChange$.subscribe(e=>{if("delete"===e.type){let{unitId:t,subUnitId:r,rule:n}=e,i=this._ensureRowColInfoMap(t,r,"row"),s=this._ensureRowColInfoMap(t,r,"col");n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:a,endColumn:o}=e;for(let e=t;e<=r;e++){let t=i.get(`${e}`);null==t||t.delete(n.id);for(let e=a;e<=o;e++){let t=s.get(`${e}`);null==t||t.delete(n.id)}}})}})}getCellInfo(e,t,r,n){var i,s;let a=this._ensureCellInfoMap(e,t),o=a.get(`${r}-${n}`);if(o)return o;let l=null==(s=null==(i=this._cellRuleCache.get(e))?void 0:i.get(t))?void 0:s.get(`${r}-${n}`);if(!l)return;let u=this._ruleModel.getRule(e,t,l);if(u){let i={...this._getSelectionActions(e,t,u),ruleId:l,ranges:u.ranges};return a.set(`${r}-${n}`,i),i}}deleteUnit(e){this._cellRuleCache.delete(e),this._cellInfoCache.delete(e),this._rowInfoCache.delete(e),this._colInfoCache.delete(e);let t=this._univerInstanceService.getUnit(e);null==t||t.getSheets().forEach(t=>{let r=t.getSheetId();this._ruleModel.getSubunitRuleList(e,r).forEach(e=>{this._permissionIdCache.delete(e.permissionId)})})}};sC=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sf(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sg(t,r,s),s})([sp(0,(0,p.Inject)(V)),sp(1,(0,p.Inject)(p.IPermissionService)),sp(2,(0,p.Inject)(p.IUniverInstanceService))],sC);var s_=Object.defineProperty,sy=Object.getOwnPropertyDescriptor,sE=(e,t)=>(r,n)=>t(r,n,e);let sb=class{constructor(e,t){x(this,"_cache",new p.LRUMap(1e4)),this._selectionProtectionRuleModel=e,this._permissionService=t,this._init()}_init(){this._permissionService.permissionPointUpdate$.pipe((0,E.filter)(e=>e.type===eH.SelectRange),(0,E.filter)(e=>nA().some(t=>e instanceof t)),(0,R.map)(e=>e)).subscribe(e=>{for(let t of this._selectionProtectionRuleModel.getSubunitRuleList(e.unitId,e.subUnitId))t.permissionId===e.permissionId&&t.ranges.forEach(t=>{(0,p.Range).foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})})}),this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{var t;e.rule.ranges.forEach(t=>{(0,p.Range).foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(t=>{(0,p.Range).foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}))})}_createKey(e,t,r,n){return`${e}_${t}_${r}_${n}`}getCellInfo(e,t,r,n){let i=this._selectionProtectionRuleModel.getSubunitRuleList(e,t);if(!i||!i.length)return[];let s=this._createKey(e,t,r,n),a=this._cache.get(s);if(a)return a;let o=[];for(let s of i)if(s.ranges.some(e=>e.startRow<=r&&e.endRow>=r&&e.startColumn<=n&&e.endColumn>=n)){let r=nA().reduce((r,n)=>{var i;let a=new n(e,t,s.permissionId),o=this._permissionService.getPermissionPoint(a.id);return r[a.subType]=null!=(i=null==o?void 0:o.value)?i:a.value,r},{});o.push({...r,ruleId:s.id,ranges:s.ranges})}return this._cache.set(s,o),o}clear(){this._cache.clear()}};sb=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sy(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&s_(t,r,s),s})([sE(0,(0,p.Inject)(V)),sE(1,(0,p.Inject)(p.IPermissionService))],sb);let sR=(0,p.createIdentifier)("univer.exclusive-range-service");class sN extends p.Disposable{constructor(){super(...arguments),x(this,"_exclusiveRanges",/* @__PURE__ */new Map)}_ensureUnitMap(e){return this._exclusiveRanges.has(e)||this._exclusiveRanges.set(e,/* @__PURE__ */new Map),this._exclusiveRanges.get(e)}_ensureSubunitMap(e,t){let r=this._ensureUnitMap(e);return r.has(t)||r.set(t,/* @__PURE__ */new Map),r.get(t)}_ensureFeature(e,t,r){let n=this._ensureSubunitMap(e,t);return n.has(r)||n.set(r,[]),n.get(r)}addExclusiveRange(e,t,r,n){this._ensureFeature(e,t,r).push(...n)}getExclusiveRanges(e,t,r){var n,i;return null==(i=null==(n=this._exclusiveRanges.get(e))?void 0:n.get(t))?void 0:i.get(r)}clearExclusiveRanges(e,t,r){this._ensureFeature(e,t,r),this._exclusiveRanges.get(e).get(t).set(r,[])}clearExclusiveRangesByGroupId(e,t,r,n){let i=this.getExclusiveRanges(e,t,r);if(i){let s=i.filter(e=>e.groupId!==n);this._exclusiveRanges.get(e).get(t).set(r,s)}}getInterestGroupId(e){let t=[];return e.forEach(e=>{var r;let n=e.range,{unitId:i,sheetId:s}=n;if(!i||!s)return;let a=null==(r=this._exclusiveRanges.get(i))?void 0:r.get(s);if(a)for(let e of a.keys()){let r=a.get(e);if(r){for(let i of r)if((0,p.Rectangle).intersects(n,i.range)){t.push(e);break}}}}),t}}var sI=Object.defineProperty,sA=Object.getOwnPropertyDescriptor,sv=(e,t)=>(r,n)=>t(r,n,e);let sS=class extends p.Disposable{constructor(e,t,r){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._logService=r}getValue(e,t,r,n){let i=this._univerInstanceService.getUniverSheetInstance(e);if(!i)return;let s=null==i?void 0:i.getSheetBySheetId(t);if(!s)return;let a=i.getStyles(),o=s.getCellRaw(r,n);if(null!=o&&o.s){let e=a.get(o.s);if(null!=e&&e.n)return e.n}return null}deleteValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles();r.forEach(e=>{(0,p.Range).foreach(e,(e,t)=>{let r=i.getCellRaw(e,t);if(!r)return;let n=null==r?void 0:r.s,a={...n&&s.get(n)||{}};delete a.n;let o=s.setValue(a);r.s=o})})}setValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles(),a=i.getCellMatrix();r.forEach(e=>{e.ranges.forEach(t=>{(0,p.Range).foreach(t,(t,r)=>{let n=i.getCellRaw(t,r);if(n){let t={...s.getStyleByCell(n)||{},n:{pattern:e.pattern}},r=s.setValue(t);n.s=r,e.pattern===O.DEFAULT_TEXT_FORMAT&&(n.t=p.CellValueType.STRING)}else{let n={n:{pattern:e.pattern}},i=s.setValue(n);i&&a.setValue(t,r,{s:i})}})})})}};sS=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sA(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sI(t,r,s),s})([sv(0,p.IResourceManagerService),sv(1,p.IUniverInstanceService),sv(2,p.ILogService)],sS);var sT=Object.defineProperty,sO=Object.getOwnPropertyDescriptor,sM=(e,t)=>(r,n)=>t(r,n,e);let sw=[tw.id,tO.id,tV.id,tU.id],sx=[tq.id,tX.id],sU=class extends p.Disposable{constructor(e,t,r,n,i,s,a,o){super(),x(this,"disposableCollection",new p.DisposableCollection),this._selectionProtectionRuleModel=e,this._univerInstanceService=t,this._commandService=r,this._refRangeService=n,this._selectionProtectionRenderModel=i,this._rangeProtectionCache=s,this._sheetInterceptorService=a,this._rangeProtectionRuleModel=o,this._onRefRangeChange(),this._correctPermissionRange(),this._initReBuildCache(),this._initRemoveSheet()}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!r||!(null==r?void 0:r.getSheetBySheetId(t)))return;this.disposableCollection.dispose();let n=r=>this.refRangeHandle(r,e,t);this._selectionProtectionRuleModel.getSubunitRuleList(e,t).reduce((e,t)=>[...e,...t.ranges],[]).forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,n,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===ns.id||t.id===rD.id||t.id===P.id){let r=t.params,n=r.subUnitId,i=r.unitId;n&&i&&e(i,n)}}));let t=this._univerInstanceService.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(t){let r=t.getActiveSheet();if(!r)return;e(t.getUnitId(),r.getSheetId())}}refRangeHandle(e,t,r){switch(e.id){case tQ.id:return this._getRefRangeMutationsByMoveRows(e.params,t,r);case tJ.id:return this._getRefRangeMutationsByMoveCols(e.params,t,r);case tk.id:return this._getRefRangeMutationsByInsertRows(e.params,t,r);case tW.id:return this._getRefRangeMutationsByInsertCols(e.params,t,r);case t4.id:return this._getRefRangeMutationsByDeleteCols(e.params,t,r);case t5.id:return this._getRefRangeMutationsByDeleteRows(e.params,t,r)}return{redos:[],undos:[]}}_getRefRangeMutationsByDeleteCols(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>(0,p.Rectangle).intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=(0,p.Tools).deepClone(n),o=a.ranges.reduce((e,t)=>{if((0,p.Rectangle).intersects(t,i)){let r=(0,p.Tools).deepClone(t),{startColumn:n,endColumn:s}=i;if(n<=r.startColumn&&s>=r.endColumn)return e;n>=r.startColumn&&s<=r.endColumn?r.endColumn-=s-n+1:n<r.startColumn?(r.startColumn=n,r.endColumn-=s-n+1):s>r.endColumn&&(r.endColumn=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,a.ranges.length?(e.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})):(e.push({id:L.id,params:{unitId:t,subUnitId:r,ruleIds:[n.id]}}),s.push({id:P.id,params:{unitId:t,subUnitId:r,name:"",rules:[n]}}))}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByDeleteRows(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>(0,p.Rectangle).intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=(0,p.Tools).deepClone(n),o=a.ranges.reduce((e,t)=>{if((0,p.Rectangle).intersects(t,i)){let r=(0,p.Tools).deepClone(t),{startRow:n,endRow:s}=i;if(n<=r.startRow&&s>=r.endRow)return e;n>=r.startRow&&s<=r.endRow?r.endRow-=s-n+1:n<r.startRow?(r.startRow=n,r.endRow-=s-n+1):s>r.endRow&&(r.endRow=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,e.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertCols(e,t,r){let n=e.range.startColumn,i=e.range.endColumn-e.range.startColumn+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startColumn&&n<=e.endColumn));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=(0,p.Tools).deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startColumn&&n<=e.endColumn&&(e.endColumn+=i,l=!0)}),l&&(e.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertRows(e,t,r){let n=e.range.startRow,i=e.range.endRow-e.range.startRow+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startRow&&n<=e.endRow));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=(0,p.Tools).deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startRow&&n<=e.endRow&&(e.endRow+=i,l=!0)}),l&&(e.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveRows(e,t,r){let n=e.toRange,i=n.startRow,s=n.endRow-n.startRow+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startRow&&i<=e.endRow));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=(0,p.Tools).deepClone(a),u=e.fromRange.startRow,c=!1;l.ranges.forEach(e=>{i>e.startRow&&i<=e.endRow&&(u<e.startRow&&(e.startRow=e.startRow-s,e.endRow=e.endRow-s),e.endRow+=s,c=!0)}),c&&(n.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveCols(e,t,r){let n=e.toRange,i=n.startColumn,s=n.endColumn-n.startColumn+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startColumn&&i<=e.endColumn));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=(0,p.Tools).deepClone(a),u=e.fromRange.startColumn,c=!1;l.ranges.forEach(e=>{i>e.startColumn&&i<=e.endColumn&&(u<e.startColumn&&(e.startColumn=e.startColumn-s,e.endColumn=e.endColumn-s),e.endColumn+=s,c=!0)}),c&&(n.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:rD.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_correctPermissionRange(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(sx.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u}=e;(0,p.Rectangle).intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),this._checkIsRightRange({startRow:t,endRow:r,startColumn:i,endColumn:u})&&(e.startColumn=i,e.endColumn=u,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:u,subUnitId:c}=e.params,h=e=>this.refRangeHandle(e,u,c);this._selectionProtectionRuleModel.getSubunitRuleList(u,c).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,h,u,c))}),this._selectionProtectionRenderModel.clear()}if(sw.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=e.params;if(!n)return;let{range:i}=n,s=e.id.includes("row"),a=e.id.includes("insert"),o=s?i.startRow:i.startColumn,l=s?i.endRow:i.endColumn,u=l-o+1;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;a?s?o<=t&&(t+=u,r+=u):o<=n&&(n+=u,i+=u):s?l<t&&(t-=u,r-=u):l<n&&(n-=u,i-=u),this._checkIsRightRange({startRow:t,endRow:r,startColumn:n,endColumn:i})&&(e.startColumn=n,e.endColumn=i,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:c,subUnitId:h}=e.params,d=e=>this.refRangeHandle(e,c,h);this._selectionProtectionRuleModel.getSubunitRuleList(c,h).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,d,c,h))}),this._selectionProtectionRenderModel.clear()}}))}_checkIsRightRange(e){return e.startRow<=e.endRow&&e.startColumn<=e.endColumn}_initReBuildCache(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(sw.includes(e.id)||sx.includes(e.id)){let{unitId:t,subUnitId:r}=e.params;this._rangeProtectionCache.reBuildCache(t,r)}}))}_initRemoveSheet(){this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=[],r=[];if(e.id===t6.id){let n=e.params,i=[],s=[];this._rangeProtectionRuleModel.getSubunitRuleList(n.unitId,n.subUnitId).forEach(e=>{i.push(e.id),s.push(e)}),i.length&&s.length&&(r.push({id:L.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,ruleIds:i}}),t.push({id:P.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,name:"",rules:s}}))}return{redos:[],undos:t,preRedos:r,preUndos:[]}}})}};sU=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sO(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sT(t,r,s),s})([sM(0,(0,p.Inject)(V)),sM(1,(0,p.Inject)(p.IUniverInstanceService)),sM(2,p.ICommandService),sM(3,(0,p.Inject)(i9)),sM(4,(0,p.Inject)(sb)),sM(5,(0,p.Inject)(sC)),sM(6,(0,p.Inject)(er)),sM(7,(0,p.Inject)(V))],sU);var sD=Object.defineProperty,sV=Object.getOwnPropertyDescriptor,sL=(e,t)=>(r,n)=>t(r,n,e);let sP=class extends p.Disposable{constructor(e,t,r,n,i){super(),this._selectionProtectionRuleModel=e,this._permissionService=t,this._resourceManagerService=r,this._selectionProtectionCache=n,this._univerInstanceService=i,this._initSnapshot(),this._initRuleChange()}_initRuleChange(){this.disposeWithMe(this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":nA().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(r)});break;case"delete":nA().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.deletePermissionPoint(r.id)});break;case"set":e.oldRule.permissionId!==e.rule.permissionId&&nA().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.oldRule.permissionId);this._permissionService.deletePermissionPoint(r.id);let n=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(n)})}}))}_initSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e=>{let t=this._selectionProtectionRuleModel.toObject()[e];return t?JSON.stringify(t):""},parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_RANGE_PROTECTION_PLUGIN",businesses:[eB.UNIVER_SHEET],onLoad:(e,t)=>{let r=this._selectionProtectionRuleModel.toObject();r[e]=t,this._selectionProtectionRuleModel.fromObject(r);let n=[];Object.keys(t).forEach(r=>{let i=t[r];this._selectionProtectionRuleModel.getSubunitRuleList(e,r).forEach(t=>{n.push({objectID:t.permissionId,unitID:e,objectType:eH.SelectRange,actions:nv})}),i.forEach(t=>{nA().forEach(n=>{let i=new n(e,r,t.permissionId);i.value=!1,this._permissionService.addPermissionPoint(i)})}),this._selectionProtectionCache.reBuildCache(e,r)})},onUnLoad:e=>{this._selectionProtectionCache.deleteUnit(e)}}))}};sP=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sV(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sD(t,r,s),s})([sL(0,(0,p.Inject)(V)),sL(1,(0,p.Inject)(p.IPermissionService)),sL(2,(0,p.Inject)(p.IResourceManagerService)),sL(3,(0,p.Inject)(sC)),sL(4,(0,p.Inject)(p.IUniverInstanceService))],sP);var sj=Object.defineProperty,sF=Object.getOwnPropertyDescriptor,sk=(e,t)=>(r,n)=>t(r,n,e);let sB=class extends p.Disposable{constructor(e,t,r,n,i){super(),this._permissionService=e,this._univerInstanceService=t,this._rangeProtectionRuleModel=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointModel=i,this._init()}_init(){let e=e=>{let t=e.getUnitId();nS().forEach(e=>{let r=new e(t);this._permissionService.addPermissionPoint(r)})};this._univerInstanceService.getAllUnitsForType(p.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(p.UniverInstanceType.UNIVER_SHEET).subscribe(t=>{e(t)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(p.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{let t=e.getUnitId();e.getSheets().forEach(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...nA()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...nO(),...nM()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})}),nS().forEach(e=>{let r=new e(t);this._permissionService.deletePermissionPoint(r.id)}),this._rangeProtectionRuleModel.deleteUnitModel(t),this._worksheetProtectionPointModel.deleteUnitModel(t),this._worksheetProtectionRuleModel.deleteUnitModel(t)}))}};sB=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sF(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sj(t,r,s),s})([sk(0,(0,p.Inject)(p.IPermissionService)),sk(1,(0,p.Inject)(p.IUniverInstanceService)),sk(2,(0,p.Inject)(V)),sk(3,(0,p.Inject)(F)),sk(4,(0,p.Inject)(nx))],sB);var s$=Object.defineProperty,sH=Object.getOwnPropertyDescriptor,sW=(e,t,r)=>t in e?s$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,sG=(e,t)=>(r,n)=>t(r,n,e),sY=(e,t,r)=>sW(e,"symbol"!=typeof t?t+"":t,r);let sz=class extends p.Plugin{constructor(e=im,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=this._config;this._configService.setConfig("sheets.config",n),this._initConfig(),this._initDependencies()}_initConfig(){var e,t;null!=(e=this._config)&&e.onlyRegisterFormulaRelatedMutations&&this._configService.setConfig(ir,!0),null!=(t=this._config)&&t.isRowStylePrecedeColumnStyle&&this._configService.setConfig(p.IS_ROW_STYLE_PRECEDE_COLUMN_STYLE,!0)}_initDependencies(){var e;let t=[[ra],[z],[i9],[sB],[n4,{useClass:sS}],[er],[il],[sl],[sm],[i_],[nL],[F],[nx],[sb],[V],[sC],[sU],[sP],[sR,{useClass:sN,deps:[z]}]];null!=(e=this._config)&&e.notExecuteFormula||t.push([id]),(0,p.registerDependencies)(this._injector,(0,p.mergeOverrideWithDependencies)(t,this._config.override)),(0,p.touchDependencies)(this._injector,[[er],[sP],[sR]])}onStarting(){(0,p.touchDependencies)(this._injector,[[il],[sl],[sB],[nL]])}onRendered(){(0,p.touchDependencies)(this._injector,[[n4]])}onReady(){(0,p.touchDependencies)(this._injector,[[id],[i_],[sm],[sb],[sU],[i9]])}};sY(sz,"pluginName","SHEET_PLUGIN"),sY(sz,"type",p.UniverInstanceType.UNIVER_SHEET),sz=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sH(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&s$(t,r,s),s})([(0,p.DependentOn)(C.UniverFormulaEnginePlugin),sG(1,(0,p.Inject)(p.Injector)),sG(2,p.IConfigService)],sz);let sq=[nH.id,nW.id,nG.id,no.id,ni.id,tq.id,tX.id,rR.id,rI.id,rH.id,rB.id,tw.id,tO.id,tV.id,tU.id,nQ.id],sX=[ec.id,eA.id,re.id,t7.id,rn.id,nh.id,rj.id,ry.id],sK=1.5,sQ="rgba(255, 255, 255, 0.01)";function sZ(e){let{rangeWithCoord:t,primaryWithCoord:r,style:n}=e,i={range:{startRow:t.startRow,startColumn:t.startColumn,endRow:t.endRow,endColumn:t.endColumn,rangeType:t.rangeType,unitId:t.unitId,sheetId:t.sheetId},primary:null,style:n};return null!=r&&(i.primary=function(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=e.mergeInfo;return{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,startRow:s,startColumn:a,endRow:o,endColumn:l}}(r)),i}let sJ=(e,t,r)=>{let n=e.get(z).getCurrentSelections(),{value:i,selections:s,unitId:a,subUnitId:o}=t;if(n){let e=n[(null==n?void 0:n.length)-1].primary;if(e){let{actualColumn:t,actualRow:l}=e,{startRow:u,startColumn:c,endRow:h,endColumn:d}=s[s.length-1];if(i===p.Dimension.COLUMNS){let e=r.find(e=>e.startColumn===t&&e.endColumn===t&&l===e.startRow);e&&(d=e.endColumn,u=e.startRow,h=e.endRow)}else if(i===p.Dimension.ROWS){let e=r.find(e=>e.startRow===l&&e.endRow===l&&t===e.startColumn);e&&(h=e.endRow,c=e.startColumn,d=e.endColumn)}let m={startRow:u,startColumn:c,endRow:h,endColumn:d,actualRow:l,actualColumn:t,isMerged:!0,isMergedMainCell:u===l&&c===t},g=n.map((e,t,r)=>({range:e.range,style:null,primary:t===r.length-1?m:null}));return{id:ew.id,params:{unitId:a,subUnitId:o,selections:g}}}}return null},s0=(e,t)=>{let r=e.get(z).getCurrentSelections(),{unitId:n,subUnitId:i}=t;if(r&&r[(null==r?void 0:r.length)-1].primary){let e={unitId:n,subUnitId:i,selections:[...r]};return{id:ew.id,params:e}}return null};function s1(e){return null!=e&&(void 0!==e.v&&null!==e.v&&""!==e.v||void 0!==e.p)}function s2(e,t){return e&&e.spanAnchor?s1(t.getValue(e.spanAnchor.startRow,e.spanAnchor.startColumn)):s1(e)}function s5(e,t,r){let n=r.getMaxRows(),i=r.getMaxColumns(),s=function(e,t,r,n,i){let s=e.getCellMatrix(),a=e.getSpanModel().getMergedCellRange(0,0,n,i),o=new p.ObjectMatrix;return s.forValue((e,t)=>{let r=s.getValue(e,t);r&&o.setValue(e,t,r)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;(0,p.createRowColIter)(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}),(e!==r||a!==t)&&(o.realDeleteValue(e,a),o.setValue(e,a,{spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}))})}),o}(r,0,0,n-1,i-1),a=r.getSnapshot().mergeData.length>0,{left:o,right:l,up:u,down:c}=t,h=!0,d={...e},m=[];for(;h;){if(h=!1,u&&0!==d.startRow){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endColumn:a}=e,o=null,l=!1;for(let e=s;e<=a;e++){let r=t.getValue(i-1,e);if(l=l||s2(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startRow=e.startRow-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,0,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(c&&d.endRow!==n-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startColumn:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=s;e++){let r=t.getValue(a+1,e);if(l=l||s2(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endRow=e.endRow+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,0,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(o&&0!==d.startColumn){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s-1);if(l=l||s2(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startColumn=e.startColumn-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,0,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(l&&d.endColumn!==i-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s+1);if(l=l||s2(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endColumn=e.endColumn+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,0,a);if(r&&m.push(r),e){d=t,h=!0;continue}}}return m.length>0&&(d=(0,p.Rectangle).union(d,...m)),d}let s3={type:p.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge",handler:async(e,t)=>{let r=e.get(p.ICommandService),n=e.get(p.IUndoRedoService),i=e.get(p.IUniverInstanceService),s=t.unitId,a=t.subUnitId,o=sa(t.selections,t.value),l=i.getUniverSheetInstance(s).getSheetBySheetId(a),u=[],c=[],h=o.some(e=>(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i),o=!1;return a.forValue((t,i,s)=>{if(s&&(t!==r||i!==n)&&e.cellHasValue(s))return o=!0,!1}),o})(l,e)),d={unitId:s,subUnitId:a,ranges:o},m={unitId:s,subUnitId:a,ranges:o};u.push({id:re.id,params:d}),u.push({id:t7.id,params:m});let g=t8(e,d),f=t9(e,m);if(c.push({id:re.id,params:f}),c.push({id:t7.id,params:g}),h){let t=function(e,t,r,n){let i=[],s=[],a=r.getSheetId();return n.forEach(n=>{let o={unitId:t,subUnitId:a,cellValue:(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i,!0),o=new p.ObjectMatrix;return a.forValue((e,t,i)=>{i&&(e!==r||t!==n)&&o.setValue(e,t,null)}),o})(r,n).getData()},l=eu(e,o);i.push({id:ec.id,params:l}),s.push({id:ec.id,params:o})}),{undos:i,redos:s}}(e,s,l,o);u.unshift(...t.redos),c.push(...t.undos)}return!!(0,p.sequenceExecute)(u,r).result&&(n.pushUndoRedo({unitID:s,undoMutations:c,redoMutations:u}),!0)}},s4={type:p.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-all",handler:async e=>{var t;let r=e.get(p.ICommandService),n=null==(t=e.get(z).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(p.IUniverInstanceService).getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(s3.id,{selections:n,unitId:a,subUnitId:o})}},s6={type:p.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-vertical",handler:async e=>{var t;let r=e.get(p.ICommandService),n=null==(t=e.get(z).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(p.IUniverInstanceService).getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(s3.id,{value:p.Dimension.COLUMNS,selections:n,unitId:a,subUnitId:o})}},s9={type:p.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-horizontal",handler:async e=>{var t;let r=e.get(p.ICommandService),n=null==(t=e.get(z).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(p.IUniverInstanceService).getCurrentUnitForType(p.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(s3.id,{value:p.Dimension.ROWS,selections:n,unitId:a,subUnitId:o})}};async function s7(e,t,r,n){let i=eE(e.get(p.IUniverInstanceService),{unitId:t,subUnitId:r});if(!i)return;let{worksheet:s}=i;if(s.getMergeData().some(e=>n.some(t=>(0,p.Rectangle).intersects(t,e))))throw Error("The ranges to be merged overlap with the existing merged cells");await e.get(p.ICommandService).executeCommand(s3.id,{unitId:t,subUnitId:r,selections:n})}let s8=(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().rightToLeft;return{...(0,p.Tools).deepClone(t),rightToLeft:r}},ae={id:"sheet.mutation.set-worksheet-right-to-left",type:p.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(p.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().rightToLeft=t.rightToLeft,!0)}};p.CommandType.COMMAND,async(e,t)=>{var r;let n=e.get(p.ICommandService),i=e.get(p.IUndoRedoService),s=eE(e.get(p.IUniverInstanceService),t);if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=p.BooleanNumber.FALSE;t&&(l=null!=(r=t.rightToLeft)?r:p.BooleanNumber.FALSE);let u={rightToLeft:l,unitId:a,subUnitId:o},c=s8(e,u);return!!n.syncExecuteCommand(ae.id,u)&&(i.pushUndoRedo({unitID:a,undoMutations:[{id:ae.id,params:c}],redoMutations:[{id:ae.id,params:u}]}),!0)}}),s("86b1c",function(t,r){let n,s,a,o,l,u,c,h,d,m,g,f,p,C,_,y,E,b,R,N,I,A,v,S,T,O,M,w,x,U,D,V,L,P;e(t.exports,"ErrorType",function(){return X}),e(t.exports,"ERROR_TYPE_SET",function(){return K}),e(t.exports,"FunctionType",function(){return Z}),e(t.exports,"operatorToken",function(){return J}),e(t.exports,"compareToken",function(){return ee}),e(t.exports,"matchToken",function(){return ei}),e(t.exports,"normalizeSheetName",function(){return ec}),e(t.exports,"matchRefDrawToken",function(){return eh}),e(t.exports,"SetArrayFormulaDataMutation",function(){return eD}),e(t.exports,"getAbsoluteRefTypeWitString",function(){return ej}),e(t.exports,"serializeRange",function(){return ek}),e(t.exports,"serializeRangeWithSheet",function(){return eB}),e(t.exports,"serializeRangeWithSpreadsheet",function(){return e$}),e(t.exports,"serializeRangeToRefString",function(){return eH}),e(t.exports,"deserializeRangeWithSheet",function(){return eY}),e(t.exports,"isReferenceStringWithEffectiveColumn",function(){return eq}),e(t.exports,"getRangeWithRefsString",function(){return eK}),e(t.exports,"isReferenceStrings",function(){return eQ}),e(t.exports,"IDefinedNamesService",function(){return e2}),e(t.exports,"SetDefinedNameMutationFactory",function(){return e5}),e(t.exports,"SetDefinedNameMutation",function(){return e3}),e(t.exports,"RemoveDefinedNameMutation",function(){return e4}),e(t.exports,"SetFormulaCalculationStartMutation",function(){return e7}),e(t.exports,"SetFormulaCalculationStopMutation",function(){return e8}),e(t.exports,"SetFormulaCalculationNotificationMutation",function(){return te}),e(t.exports,"SetFormulaCalculationResultMutation",function(){return tt}),e(t.exports,"SetFormulaDataMutation",function(){return tr}),e(t.exports,"SetOtherFormulaMutation",function(){return tn}),e(t.exports,"RemoveOtherFormulaMutation",function(){return ti}),e(t.exports,"deserializeRangeWithSheetWithCache",function(){return tg}),e(t.exports,"sequenceNodeType",function(){return tf}),e(t.exports,"generateStringWithSequence",function(){return tp}),e(t.exports,"LexerTreeBuilder",function(){return tE}),e(t.exports,"FormulaDataModel",function(){return tI}),e(t.exports,"initSheetFormulaData",function(){return tA}),e(t.exports,"handleNumfmtInCell",function(){return tW}),e(t.exports,"stripErrorMargin",function(){return nM}),e(t.exports,"NullValueObject",function(){return nx}),e(t.exports,"FormulaExecuteStageType",function(){return it}),e(t.exports,"FormulaExecutedStateType",function(){return ir}),e(t.exports,"IFunctionService",function(){return im}),e(t.exports,"FUNCTION_NAMES_MATH",function(){return iW}),e(t.exports,"FUNCTION_NAMES_TEXT",function(){return iG}),e(t.exports,"FUNCTION_NAMES_ARRAY",function(){return sX}),e(t.exports,"functionArray",function(){return sK}),e(t.exports,"FUNCTION_NAMES_COMPATIBILITY",function(){return os}),e(t.exports,"functionCompatibility",function(){return oa}),e(t.exports,"functionCube",function(){return oo}),e(t.exports,"FUNCTION_NAMES_CUBE",function(){return ol}),e(t.exports,"CustomFunction",function(){return ou}),e(t.exports,"FUNCTION_NAMES_DATABASE",function(){return og}),e(t.exports,"functionDatabase",function(){return of}),e(t.exports,"FUNCTION_NAMES_DATE",function(){return ok}),e(t.exports,"functionDate",function(){return oB}),e(t.exports,"FUNCTION_NAMES_ENGINEERING",function(){return oH}),e(t.exports,"functionEngineering",function(){return oW}),e(t.exports,"FUNCTION_NAMES_FINANCIAL",function(){return oG}),e(t.exports,"functionFinancial",function(){return le}),e(t.exports,"FUNCTION_NAMES_INFORMATION",function(){return lt}),e(t.exports,"functionInformation",function(){return lr}),e(t.exports,"FUNCTION_NAMES_LOGICAL",function(){return ln}),e(t.exports,"functionLogical",function(){return ls}),e(t.exports,"FUNCTION_NAMES_LOOKUP",function(){return la}),e(t.exports,"functionLookup",function(){return lo}),e(t.exports,"functionMath",function(){return lc}),e(t.exports,"functionMeta",function(){return ld}),e(t.exports,"FUNCTION_NAMES_STATISTICAL",function(){return lg}),e(t.exports,"functionStatistical",function(){return lp}),e(t.exports,"functionText",function(){return lP}),e(t.exports,"functionUniver",function(){return lj}),e(t.exports,"FUNCTION_NAMES_WEB",function(){return lF}),e(t.exports,"functionWeb",function(){return lk}),e(t.exports,"IActiveDirtyManagerService",function(){return ue}),e(t.exports,"UniverFormulaEnginePlugin",function(){return ui}),e(t.exports,"FFormula",function(){return ul});var j,F,k=i("7yNYd"),B=i("1mjSk"),$=i("k2g5B"),H=Object.defineProperty,W=(e,t,r)=>t in e?H(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,G=(e,t,r)=>W(e,"symbol"!=typeof t?t+"":t,r),Y=((n=Y||{}).FALSE="FALSE",n.TRUE="TRUE",n),z=((s=z||{})[s.SUCCESS=0]="SUCCESS",s[s.ERROR=1]="ERROR",s),q=((a=q||{})[a.FRONT=0]="FRONT",a[a.BACK=1]="BACK",a),X=((o=X||{}).DIV_BY_ZERO="#DIV/0!",o.NAME="#NAME?",o.VALUE="#VALUE!",o.NUM="#NUM!",o.NA="#N/A",o.CYCLE="#CYCLE!",o.REF="#REF!",o.SPILL="#SPILL!",o.CALC="#CALC!",o.ERROR="#ERROR!",o.CONNECT="#GETTING_DATA",o.NULL="#NULL!",o);let K=new Set(Object.values(X)),Q=[...new Set(Object.values(X).map(e=>e.length))];var Z=((l=Z||{})[l.Financial=0]="Financial",l[l.Date=1]="Date",l[l.Math=2]="Math",l[l.Statistical=3]="Statistical",l[l.Lookup=4]="Lookup",l[l.Database=5]="Database",l[l.Text=6]="Text",l[l.Logical=7]="Logical",l[l.Information=8]="Information",l[l.Engineering=9]="Engineering",l[l.Cube=10]="Cube",l[l.Compatibility=11]="Compatibility",l[l.Web=12]="Web",l[l.Array=13]="Array",l[l.Univer=14]="Univer",l[l.User=15]="User",l[l.DefinedName=16]="DefinedName",l),J=((u=J||{}).PLUS="+",u.MINUS="-",u.MULTIPLY="*",u.DIVIDED="/",u.CONCATENATE="&",u.POWER="^",u.EQUALS="=",u.NOT_EQUAL="<>",u.GREATER_THAN=">",u.GREATER_THAN_OR_EQUAL=">=",u.LESS_THAN="<",u.LESS_THAN_OR_EQUAL="<=",u),ee=((c=ee||{}).EQUALS="=",c.NOT_EQUAL="<>",c.GREATER_THAN=">",c.GREATER_THAN_OR_EQUAL=">=",c.LESS_THAN="<",c.LESS_THAN_OR_EQUAL="<=",c);let et=/* @__PURE__ */new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),er=new Set(et.keys()),en=/* @__PURE__ */new Set(["=","<>",">",">=","<","<="]);var ei=((h=ei||{}).OPEN_BRACKET="(",h.CLOSE_BRACKET=")",h.COMMA=",",h.SINGLE_QUOTATION="'",h.DOUBLE_QUOTATION='"',h.OPEN_BRACES="{",h.CLOSE_BRACES="}",h.COLON=":",h.OPEN_SQUARE_BRACKET="[",h.CLOSE_SQUARE_BRACKET="]",h),es=((d=es||{}).PERCENTAGE="%",d.POUND="#",d);let ea=/* @__PURE__ */new Set(["%","#"]);var eo=((m=eo||{}).AT="@",m.MINUS="-",m.PLUS="+",m);let el=[...Object.values(ee),...Object.values(J),...Object.values(ei),...Object.values(es),...Object.values(eo)];function eu(e){return el.includes(e)}function ec(e){return"'"===e[0]&&"'"===e[e.length-1]?e.substring(1,e.length-1):e}function eh(e){return eu(e)&&e!==ei.CLOSE_BRACES&&e!==ei.CLOSE_BRACKET&&e!==ei.SINGLE_QUOTATION&&e!==ei.DOUBLE_QUOTATION||" "===e}let ed=/* @__PURE__ */new Set([J.PLUS,J.MINUS,J.MULTIPLY,J.DIVIDED,J.CONCATENATE,J.POWER,J.EQUALS,J.NOT_EQUAL,J.GREATER_THAN,J.GREATER_THAN_OR_EQUAL,J.LESS_THAN,J.LESS_THAN_OR_EQUAL,ei.OPEN_BRACKET,ei.COMMA,ei.COLON,ei.OPEN_BRACES,ei.OPEN_SQUARE_BRACKET]),em=/* @__PURE__ */new Set([J.PLUS,J.MINUS,J.MULTIPLY,J.DIVIDED,J.CONCATENATE,J.POWER,J.EQUALS,J.NOT_EQUAL,J.GREATER_THAN,J.GREATER_THAN_OR_EQUAL,J.LESS_THAN,J.LESS_THAN_OR_EQUAL,ei.OPEN_BRACKET,ei.COMMA,ei.COLON,ei.OPEN_BRACES,ei.OPEN_SQUARE_BRACKET,es.PERCENTAGE,es.POUND]),eg='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',ef=new RegExp(eg),ep="\\s*?:\\s*?",eC="[A-Za-z]+",e_="[1-9][0-9]*",ey=`'?(${eg})?(((?![\\[\\]\\/?*\\\\]).)*!)?'?`,eE=`\\$?${eC}\\$?${e_}`,eb=RegExp(`^(${eo.AT})?${ey}${eE}${ep}${eE}$`),eR=RegExp(`^${ey}\\s*?${eE}(${es.POUND})?$`),eN=RegExp(`^${ey}\\$?${e_}${ep}\\$?${e_}$`),eI=RegExp(`^${ey}\\$?${eC}${ep}\\$?${eC}$`),eA=RegExp(`^${ey}\\s*?\\$?${e_}$`),ev=RegExp(`^${ey}\\s*?\\$?${eC}$`),eS=RegExp("{.*?}","g");function eT(e){return eR.lastIndex=0,eR.test(e)}function eO(e){return eN.lastIndex=0,eN.test(e)}function eM(e){return eI.lastIndex=0,eI.test(e)}function ew(e){return eA.lastIndex=0,eA.test(e)}function ex(e){return ev.lastIndex=0,ev.test(e)}let eU={id:"formula.mutation.register-function",type:k.CommandType.MUTATION,handler:()=>!0},eD={id:"formula.mutation.set-array-formula-data",type:k.CommandType.MUTATION,handler:(e,t)=>!0},eV=/[^0-9]/g,eL=/[^A-Za-z]/g;function eP(e){let t="$"===e[0],r=e.substring(1),n=r.indexOf("$")>-1;return(0,k.Tools).isStringNumber(r)&&t&&!n&&(t=!1,n=!0),t&&n?k.AbsoluteRefType.ALL:t?k.AbsoluteRefType.COLUMN:n?k.AbsoluteRefType.ROW:k.AbsoluteRefType.NONE}function ej(e){let t=e.split("!");t.length>1&&(e=t[t.length-1]);let r=e.split(":");return r.length>1?{startAbsoluteRefType:eP(r[0]),endAbsoluteRefType:eP(r[1])}:{startAbsoluteRefType:eP(r[0])}}function eF(e=k.AbsoluteRefType.NONE){let t="",r="";return e===k.AbsoluteRefType.ROW?t="$":e===k.AbsoluteRefType.COLUMN?r="$":e===k.AbsoluteRefType.ALL&&(t="$",r="$"),{rowAbsoluteString:t,columnAbsoluteString:r}}function ek(e){let{startColumn:t,startRow:r,endColumn:n,endRow:i,startAbsoluteRefType:s,endAbsoluteRefType:a,rangeType:o=k.RANGE_TYPE.NORMAL}=e,l=eF(s),u=eF(a);if(o===k.RANGE_TYPE.ROW||o===k.RANGE_TYPE.ALL){let e=`${l.rowAbsoluteString}${r+1}`,t=`${u.rowAbsoluteString}${i+1}`;return`${e}:${t}`}if(o===k.RANGE_TYPE.COLUMN){let e=`${l.columnAbsoluteString}${(0,k.Tools).chatAtABC(t)}`,r=`${u.columnAbsoluteString}${(0,k.Tools).chatAtABC(n)}`;return`${e}:${r}`}let c=`${l.columnAbsoluteString}${(0,k.Tools).chatAtABC(t)}${l.rowAbsoluteString}${r+1}`,h=`${u.columnAbsoluteString}${(0,k.Tools).chatAtABC(n)}${u.rowAbsoluteString}${i+1}`;return c===h?c:`${c}:${h}`}function eB(e,t){return eZ(e)?`'${e}'!${ek(t)}`:`${e}!${ek(t)}`}function e$(e,t,r){return eZ(e)||eZ(t)?`'[${e}]${t}'!${ek(r)}`:`[${e}]${t}!${ek(r)}`}function eH(e){let{unitId:t,sheetName:r,range:n}=e;return null!=t&&t.length>0&&null!=r&&r.length>0?e$(t,r,n):null!=r&&r.length>0?eB(r,n):ek(n)}function eW(e){return{row:Number.parseInt(e.replace(eV,""))-1,column:(0,k.Tools).ABCatNum(e.replace(eL,"")),absoluteRefType:eP(e)}}function eG(e){let t=ef.exec(e),r="";null!=t&&(r=(r=t[0].trim()).slice(1,r.length-1),e=e.replace(ef,""));let n=e.indexOf("!"),i="",s="";return n>-1?("'"===(i=e.substring(0,n))[0]&&"'"===i[i.length-1]&&(i=i.substring(1,i.length-1)),s=e.substring(n+1)):s=e,{refBody:s,sheetName:i,unitId:r}}function eY(e){let{refBody:t,sheetName:r,unitId:n}=eG(e),i=t.indexOf(":");if(-1===i){let e=eW(t),i=e.row,s=e.column,a=e.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:i,startColumn:s,endRow:i,endColumn:s,startAbsoluteRefType:a,endAbsoluteRefType:a}}}let s=t.substring(0,i),a=t.substring(i+1),o=eW(s),l=eW(a),u=o.row>l.row?l.row:o.row,c=o.column>l.column?l.column:o.column,h=o.row>l.row?o.row:l.row,d=o.column>l.column?o.column:l.column,m=k.RANGE_TYPE.NORMAL;return Number.isNaN(u)&&Number.isNaN(h)?m=k.RANGE_TYPE.COLUMN:Number.isNaN(c)&&Number.isNaN(d)&&(m=k.RANGE_TYPE.ROW),{unitId:n,sheetName:r,range:{startRow:u,startColumn:c,endRow:h,endColumn:d,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:l.absoluteRefType,rangeType:m}}}let ez=["LOG10"];function eq(e){let t=eX(e);if(!(eT(t)||(eb.lastIndex=0,eb.test(t))||eO(t)||eM(t))||ez.includes(t.toUpperCase().trim()))return!1;let{range:r}=eY(t);return!(r.endColumn>=16384)}function eX(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(" "!==i||r){if(!r&&(i===eo.AT||i===eo.MINUS||i===eo.PLUS))continue;t.push(i),r=!0}else t.push(i)}return t.join("")}function eK(e,t){let r=(null==e?void 0:e.split(","))||[];return""===e||0===r.length?[]:eQ(e)?r.map(e=>{let r=eY(e);return{unitId:r.unitId,sheetId:t(r.sheetName),range:r.range,sheetName:r.sheetName}}):[]}function eQ(e){return((null==e?void 0:e.split(","))||[]).every(e=>eq(e.trim()))}function eZ(e){return 0!==e.length&&!!(function(e){for(let t of el)if(e.indexOf(t)>-1)return!0;return!1}(e)||function(e){let t=e.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(e)&&null!==t}(e)||/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(e)||!RegExp("^\\p{Letter}","u").test(e.charAt(0))||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?]/.test(e))}var eJ=Object.defineProperty,e0=Object.getOwnPropertyDescriptor;let e1=class extends k.Disposable{constructor(e){super(),G(this,"_definedNameMap",{}),G(this,"_update$",new B.Subject),G(this,"update$",this._update$.asObservable()),G(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),G(this,"_currentRange$",new B.Subject),G(this,"currentRange$",this._currentRange$.asObservable()),G(this,"_focusRange$",new B.Subject),G(this,"focusRange$",this._focusRange$.asObservable()),this._univerInstanceService=e}dispose(){this._definedNameMap={}}getWorksheetByRef(e,t){var r;let{sheetName:n}=eG(t);return null==(r=this._univerInstanceService.getUnit(e))?void 0:r.getSheetBySheetName(n)}focusRange(e,t){let r=this.getValueById(e,t);null!=r&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return ek(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._update()}registerDefinedName(e,t){null==this._definedNameMap[e]&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._update()}removeDefinedName(e,t){var r;null==(r=this._definedNameMap[e])||delete r[t],this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){var r;let n=this._definedNameMap[e];return null==n?null:null==(r=Array.from(Object.values(n)).filter(e=>e.name===t))?void 0:r[0]}getValueById(e,t){var r;return null==(r=this._definedNameMap[e])?void 0:r[t]}hasDefinedName(e){return null!=this._definedNameMap[e]&&0!==(Array.from(Object.values(this._definedNameMap[e])).length||0)}_update(){this._update$.next(null)}};e1=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?e0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&eJ(t,r,s),s})([(g=k.IUniverInstanceService,(e,t)=>g(e,t,0))],e1);let e2=(0,k.createIdentifier)("univer.formula.defined-names.service"),e5=(e,t)=>{let{unitId:r,id:n}=t;return{...e.get(e2).getValueById(r,n),unitId:r}},e3={id:"formula.mutation.set-defined-name",type:k.CommandType.MUTATION,handler:()=>!0},e4={id:"formula.mutation.remove-defined-name",type:k.CommandType.MUTATION,handler:()=>!0},e6={id:"formula.mutation.set-feature-calculation",type:k.CommandType.MUTATION,handler:()=>!0},e9={id:"formula.mutation.remove-feature-calculation",type:k.CommandType.MUTATION,handler:()=>!0},e7={id:"formula.mutation.set-formula-calculation-start",type:k.CommandType.MUTATION,handler:()=>!0},e8={id:"formula.mutation.set-formula-calculation-stop",type:k.CommandType.MUTATION,handler:()=>!0},te={id:"formula.mutation.set-formula-calculation-notification",type:k.CommandType.MUTATION,handler:()=>!0},tt={id:"formula.mutation.set-formula-calculation-result",type:k.CommandType.MUTATION,handler:()=>!0},tr={id:"formula.mutation.set-formula-data",type:k.CommandType.MUTATION,handler:(e,t)=>!0},tn={id:"formula.mutation.set-other-formula",type:k.CommandType.MUTATION,handler:()=>!0},ti={id:"formula.mutation.remove-other-formula",type:k.CommandType.MUTATION,handler:()=>!0},ts={id:"formula.mutation.set-super-table",type:k.CommandType.MUTATION,handler:()=>!0},ta={id:"formula.mutation.remove-super-table",type:k.CommandType.MUTATION,handler:()=>!0},to={id:"formula.mutation.set-super-table-option",type:k.CommandType.MUTATION,handler:()=>!0};class tl{constructor(e){G(this,"_cache"),this._cache=new k.LRUMap(e)}set(e,t){let r=this._hash(e);this._cache.set(r,t)}get(e){let t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}_hash(e){return e.length<=64?e:(0,k.hashAlgorithm)(e).toString()}}let tu="LR_1",tc="LO_1",th="LAMBDA",td=/* @__PURE__ */new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),tm=new tl(1e5);function tg(e){let t=tm.get(e);if(t)return t;let r=eY(e);return tm.set(e,r),eY(e)}var tf=((f=tf||{})[f.NORMAL=0]="NORMAL",f[f.NUMBER=1]="NUMBER",f[f.STRING=2]="STRING",f[f.FUNCTION=3]="FUNCTION",f[f.REFERENCE=4]="REFERENCE",f[f.ARRAY=5]="ARRAY",f[f.DEFINED_NAME=6]="DEFINED_NAME",f);function tp(e){let t="";for(let r of e)"string"==typeof r?t+=r:t+=r.token;return t}class tC{constructor(){G(this,"_parent"),G(this,"_token","R_1"),G(this,"_children",[]),G(this,"_lambdaId"),G(this,"_functionDefinitionPrivacyVar"),G(this,"_lambdaParameter",""),G(this,"_startIndex",-1),G(this,"_endIndex",-1),G(this,"_definedNames",[])}dispose(){var e;this._children.forEach(e=>{"string"!=typeof e&&e.dispose()}),null==(e=this._functionDefinitionPrivacyVar)||e.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){let r=this._getIndexInParent(e);null!=r&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){let t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){let t=this._getIndexInParent(e);null!=t&&this.getChildren().splice(t,1)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];n instanceof tC?r.push(n.serialize()):r.push(n)}return{token:e,st:this._startIndex,ed:this._endIndex,children:r}}_getIndexInParent(e){let t=this.getChildren(),r=t.length;for(let n=0;n<r;n++)if(t[n]===e)return n}}let t_=new tl(2e3),ty=new tl(2e3);class tE extends k.Disposable{constructor(){super(...arguments),G(this,"_currentLexerNode",new tC),G(this,"_upLevel",0),G(this,"_segment",""),G(this,"_bracketState",[]),G(this,"_squareBracketState",0),G(this,"_bracesState",0),G(this,"_singleQuotationState",0),G(this,"_doubleQuotationState",0),G(this,"_lambdaState",!1),G(this,"_colonState",!1),G(this,"_formulaErrorCount",0),G(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),t_.clear(),ty.clear()}getUpLevel(){return this._upLevel}isColonClose(){return!1===this._colonState}isColonOpen(){return!0===this._colonState}isDoubleQuotationClose(){return 0===this._doubleQuotationState}isLambdaOpen(){return!0===this._lambdaState}isLambdaClose(){return!1===this._lambdaState}isSingleQuotationClose(){return 0===this._singleQuotationState}isBracesClose(){return 0===this._bracesState}isBracketClose(){return 0===this._bracketState.length}isSquareBracketClose(){return 0===this._squareBracketState}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){let r=this._getCurrentParamIndex(e,t);if(null==r||r===X.VALUE)return;let n=r[0];if("string"==typeof n)return;let i=n.getParent(),s=n;for(;i;){let e=i.getToken();if("P_1"!==e&&!eu(e)&&-1!==i.getStartIndex())return{functionName:e,paramIndex:i.getChildren().indexOf(s)};s=i,i=i.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===ei.CLOSE_BRACKET||" "===n)&&r>=0;)n===ei.CLOSE_BRACKET&&t++,n=e[--r];let i=this._getCurrentParamIndex(e,e.length-2);if(null==i||i===X.VALUE)return 0;let s=i[0];if("string"==typeof s)return 0;let a=s.getParent(),o=0;for(i[1]===ei.OPEN_BRACKET&&o++;a;){let e=a.getToken();"P_1"!==e&&e!==ei.COLON&&-1!==a.getStartIndex()&&e.toUpperCase()!==th&&(0===t?o+=1:t--),a=a.getParent()}return o}sequenceNodesBuilder(e){let t=ty.get(e);if(t)return[...t];let r=this._getSequenceArray(e);if(0===r.length)return;let n=this.getSequenceNode(r);return ty.set(e,[...n]),n}convertRefersToAbsolute(e,t,r){let n=this.sequenceNodesBuilder(e);if(null==n)return e;let i="";e.substring(0,1)===J.EQUALS&&(i=J.EQUALS);for(let e=0,i=n.length;e<i;e++){let s=n[e];if("string"!=typeof s&&s.nodeType===tf.REFERENCE){let{token:a,endIndex:o}=s,l=tg(a);if(null==l)continue;let{range:u,sheetName:c,unitId:h}=l,d=eH({range:{...u,startAbsoluteRefType:t,endAbsoluteRefType:r},unitId:h,sheetName:c}),m=d.length-a.length;n[e]={...s,token:d,endIndex:o+m};for(let t=e+1;t<i;t++){let e=n[t];"string"!=typeof e&&(e.startIndex+=m,e.endIndex+=m)}}}return`${i}${tp(n)}`}moveFormulaRefOffset(e,t,r,n=!1){let i=this.sequenceNodesBuilder(e);if(null==i)return e;let s=[];for(let e=0,a=i.length;e<a;e++){let a=i[e];if("string"==typeof a||a.nodeType!==tf.REFERENCE){s.push(a);continue}let{token:o}=a,l=tg(o),{sheetName:u,unitId:c}=l,h=l.range;if(n||h.startAbsoluteRefType!==k.AbsoluteRefType.ALL||h.endAbsoluteRefType!==k.AbsoluteRefType.ALL)h=(0,k.moveRangeByOffset)(h,t,r,n);else{s.push(a);continue}let d="";d=(0,k.isValidRange)(h)?eH({range:h,unitId:c,sheetName:u}):X.REF,s.push({...a,token:d})}return`=${tp(s)}`}_formulaSpellCheck(){if(0===this._currentLexerNode.getChildren().length)return!0;let e=this._currentLexerNode.getChildren()[0];return!!(e instanceof tC||er.has(e)||ea.has(e)||e===eo.AT||e===ei.COMMA||e===ei.COLON||e===ei.OPEN_BRACKET)}getSequenceNode(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let s=e[n],a=e[n-1],{segment:o,currentString:l}=s;if(l===ei.DOUBLE_QUOTATION&&(r=!0),(""!==o||0===n)&&n!==i-1){t.push(l);continue}let u=(null==a?void 0:a.segment)||"",c=n-u.length,h=n-1,d=n-1;if(n===i-1&&this._isLastMergeString(l)&&(u+=l,h+=1),""===u||et.has(u)){t.push(l);continue}let m=u.trim(),g=eX(m);!0===r&&m[m.length-1]===ei.DOUBLE_QUOTATION&&m[0]!==ei.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,tf.STRING,u,c,h,d)):eT(g)&&eq(g)?this._processPushSequenceNode(t,tf.REFERENCE,u,c,h,d):(0,k.Tools).isStringNumber(m)?this._processPushSequenceNode(t,tf.NUMBER,u,c,h,d):m.length>0&&this._processPushSequenceNode(t,tf.FUNCTION,u,c,h,d),n===i-1&&this._isLastMergeString(l)||t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,i,s){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:i},s)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===ei.DOUBLE_QUOTATION||(0,k.Tools).isStringNumber(e)||!eu(e)}_mergeSequenceNodeReference(e){let t=[],r=e.length,n=0;for(;n<r;){let r=e[n];if("string"==typeof r){let i=e[n-1];if(r.trim()===ei.CLOSE_BRACES&&null!=i&&"string"!=typeof i&&i.nodeType===tf.FUNCTION&&i.token.trim().substring(0,1)===ei.OPEN_BRACES){i.nodeType=tf.ARRAY,i.token+=r,i.endIndex+=r.length,n++;continue}t.push(r)}else{let i=e[n+1],s=e[n+2];i===ei.COLON&&"string"!=typeof r&&null!=s&&"string"!=typeof s&&eq((r.token+i+s.token).trim())&&(r.nodeType=tf.REFERENCE,r.token+=i+s.token,r.endIndex=s.endIndex,n+=2),t.push(r)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){let t=[];for(let r of e){if("string"!=typeof r){let e=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(e){let n=e[1],i=e[3];if(eq(i.trim())){let e=n.length,s=r.startIndex,a=r.startIndex+e-1,o={nodeType:tf.NORMAL,token:n,startIndex:s,endIndex:a},l={nodeType:tf.REFERENCE,token:i,startIndex:a+1,endIndex:r.endIndex};t.push(o),t.push(l);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){let n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,n){if(!0===t){let t=t_.get(e),r=null==n?void 0:n(e);if(t&&!r)return t}this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1");let i=[],s=this._nodeMaker(e,i);if(s===X.VALUE||0===i.length)return s;let a=!1,o="",l=[];if(r){let{hasDefinedName:e,sequenceString:t,definedNames:n}=r(i);a=e,o=t,l=n}if(a&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1"),(s=this._nodeMaker(`=${o}`))===X.VALUE))return s;let u=this._getTopNode(this._currentLexerNode);if(u&&(this._currentLexerNode=u),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return X.VALUE;t_.set(e,this._currentLexerNode)}return a&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_suffixExpressionHandler(e){var t;let r=e.getChildren();if(!r)return!1;let n=r.length,i=[],s=[],a=!0;for(let e=0;e<n;e++){let n=r[e];if(n instanceof tC)a=this._suffixExpressionHandler(n),i.push(n);else{let a=n.trim();if(""===a)continue;if(er.has(a)){if(a===J.PLUS&&this._deletePlusForPreNode(r[e-1]))continue;if(a!==J.PLUS&&a!==J.MINUS&&this._deletePlusForPreNode(r[e-1]))return!1;for(;s.length>0;){let e=null==(t=s[s.length-1])?void 0:t.trim();if(!e||e===ei.OPEN_BRACKET)break;let r=et.get(e),n=et.get(a);if(!r||!n)break;if(n>=r)i.push(s.pop());else break}s.push(n)}else if(a===ei.OPEN_BRACKET)s.push(n);else if(a===ei.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(i,s,r,e);else{if(this._checkCloseBracket(r[e-1]))return!1;i.push(n)}}}return!!a&&this._processSuffixExpressionRemain(i,s,e)}_processSuffixExpressionRemain(e,t,r){let n=e.length,i=e[n-1];for(;t.length>0;){let r=t.pop();if(!(i instanceof tC)&&(r===ei.OPEN_BRACKET||r===ei.CLOSE_BRACKET))return!1;e.push(r)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var i;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){let r=null==(i=t[t.length-1])?void 0:i.trim();if(!r)break;if(r===ei.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===ei.CLOSE_BRACKET||e instanceof tC}_checkOpenBracket(e){return e===ei.OPEN_BRACKET}_checkOperator(e){return null!=e&&!(e instanceof tC)&&er.has(e)}_deletePlusForPreNode(e){if(null==e)return!0;if(!(e instanceof tC)){let t=e.trim();if(er.has(t)||t===ei.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new tC}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){let e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){let t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){let e=this._currentLexerNode.getChildren();if(e&&e.length>0){let t=e[e.length-1];if(t instanceof tC)return t}return!1}_getLastChildCurrent(){let e=this._currentLexerNode.getChildren();return!!e&&e.length>0&&e[e.length-1]}_setParentCurrentLexerNode(){let e=this._currentLexerNode.getParent();return!!e&&(this._currentLexerNode=e,!0)}_setAncestorCurrentLexerNode(){var e,t,r,n,i,s;let a=null==(e=this._currentLexerNode)?void 0:e.getParent(),o=!1;if(a&&"L_1"===a.getToken()){if(null!=(t=null==a?void 0:a.getParent())&&t.getParent()){let e=null==(n=null==(r=this._currentLexerNode.getParent())?void 0:r.getParent())?void 0:n.getParent();e&&(this._currentLexerNode=e),o=!0}}else if(null!=a&&a.getParent()){let e=null==(i=this._currentLexerNode.getParent())?void 0:i.getParent();e&&(this._currentLexerNode=e),o=!0}for(let e=0;e<this._upLevel;e++){let e=null==(s=this._currentLexerNode)?void 0:s.getParent();e&&(this._currentLexerNode=e),o=!!this._currentLexerNode}return o}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(""!==r){let e=this._currentLexerNode.getChildren();if(!(r instanceof tC)&&this.isColonOpen()){let e=new tC;e.setToken(r),e.setParent(this._currentLexerNode),r=e}t?e.unshift(r):e.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){let n=new tC;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){let r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&ed.has(r))return!0;if(ea.has(r)){let r=this._findSecondLastNonSpaceToken(e,t);if(null==r||em.has(r))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){let t=e[r];if(" "!==t&&2==++n)return t;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===ei.OPEN_BRACKET||e===ei.COMMA||e===J.EQUALS||""===e}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!er.has(e)}_getSequenceArray(e){let t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new tC,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==es.POUND)return!0;let i=r[++n];for(;" "===i;)i=r[++n];return!!eu(i)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<Q.length;r++){let n=Q[r],i=t.slice(e,e+n).join("").toUpperCase();if(K.has(i))return i}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$/,"").replace(/\r/g," ").replace(/\n/g," ");n.substring(0,1)===J.EQUALS&&(n=n.substring(1));let i=n.split(""),s=i.length,a=0;for(this._resetTemp(),this._formulaErrorLastTokenCheck(i,s-1)&&this._formalErrorOccurred();a<s;){let e=i[a];if(r===a)return[this._currentLexerNode,e];if(e===es.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(a,i)){let e=this._findErrorObject(a,i);if(null==e)return X.VALUE;this._pushNodeToChildren(e);for(let r=0;r<e.length;r++){let e=i[a];this._pushSegment(e),this._addSequenceArray(t,e,a),a++}this._resetSegment();continue}if(e===ei.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,a),this._resetSegment()),this._openBracket(1),this._closeLambda();let r=i[a+1];if(r&&r===ei.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return X.VALUE;this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,r,a),a++,this._closeBracket();continue}r&&this._newAndPushCurrentLexerNode("P_1",a)}else this._pushNodeToChildren(e),this._openBracket(0),this._resetSegment()}else if(e===ei.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();let t=this._getCurrentBracket();if(0===t)this._pushNodeToChildren(e);else{if(1!==t)return X.VALUE;let e=i[a+1];if(e&&e===ei.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return X.VALUE;this._newAndPushCurrentLexerNode("L_1",a,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&a!==s-1)return X.VALUE}this._closeBracket()}else if(e===ei.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(e),this._openBraces(),!this._formulaSpellCheck())return X.VALUE}else if(e===ei.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(e),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(e===ei.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(e),this._openSquareBracket();else if(e===ei.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(e),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(e);else if(e===ei.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{let e=i[a+1];e&&e===ei.DOUBLE_QUOTATION?a++:this._closeDoubleQuotation()}this._pushSegment(e)}else if(e===ei.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation();else{let e=i[a+1];e&&e===ei.SINGLE_QUOTATION?a++:this._closeSingleQuotation()}this._pushSegment(e)}else if(e===ei.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred();let e=this._getCurrentBracket();if(1===e||null==e){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&a!==s-1&&null!=e)return X.VALUE;this._newAndPushCurrentLexerNode("P_1",a)}else{let e=new tC;e.setToken("CUBE");let t=new tC;t.setToken("P_1"),t.changeToParent(e);let r=this._currentLexerNode.getParent();if(!r||r.getToken()!==ei.COLON)return X.VALUE;{let n=r.getParent();if(!n)return X.VALUE;r.changeToParent(t),n.setChildren([]),e.changeToParent(n)}this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=e,this._newAndPushCurrentLexerNode("P_1",a)}}else if(e===ei.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let t=new tC;t.setToken(e);let r=new tC;r.setToken("P_1"),r.setParent(t);let n=new tC;n.setToken("P_1"),n.setParent(t),t.getChildren().push(r,n);let i=t,s=0;if(this._segmentCount()>0){let e,n,a=0,o=this._segment.trim(),l=o[0],u=o[1];if(l===eo.MINUS&&((e=new tC).setToken(eo.MINUS),a++),(l===eo.AT||u===eo.AT)&&((n=new tC).setToken(eo.AT),e&&(e.addChildren(n),n.setParent(e)),a++),a>0&&(this._segment=o.slice(a)),s=a,n){if(n.addChildren(t),t.setParent(n),n.getParent()){let e=n.getParent();e&&(i=e)}else i=n}else e&&(i=e,e.addChildren(t),t.setParent(e));let c=new tC;c.setToken(this._segment),c.setParent(r),r.getChildren().push(c),this._resetSegment()}else{let e=this._getLastChildCurrentLexerNode();e&&e.changeToParent(r)}this._setCurrentLexerNode(i),this._currentLexerNode=n,this._openColon(s)}else if(ea.has(e)&&this._checkSimilarErrorToken(e,a,i)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);let t=new tC;t.setToken(e);let r=this._getLastChildCurrent();r instanceof tC?r.changeToParent(t):!1!==r&&(t.getChildren().push(r),this._removeLastChild()),this._pushNodeToChildren(t),t.setParent(this._currentLexerNode),this._resetSegment()}else if(er.has(e)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let r=this._segment.trim();if(e===J.MINUS&&""===r){let r=this._findPreviousToken(i,a-1)||"",n=this._findNextToken(i,a+1)||"";if(this._unexpectedEndingTokenExcludeOperator(r)&&this._isOperatorToken(n)){this._pushNodeToChildren("0"),this._pushNodeToChildren(J.MINUS),this._addSequenceArray(t,e,a),this._resetSegment(),a++;continue}if(this._unexpectedEndingToken(r)){if(n===J.PLUS){this._pushSegment(J.MINUS),this._addSequenceArray(t,e,a),this._addSequenceArray(t,J.PLUS,a+1),a+=2;continue}this._pushSegment(J.MINUS),this._addSequenceArray(t,e,a),a++;continue}}else if(this._segment.length>0&&this._isScientificNotation(i,a,e)){this._pushSegment(e),this._addSequenceArray(t,e,a),a++;continue}else this._segment.length>0&&""===r?r=this._segment:(this._pushNodeToChildren(this._segment),r="");if(e===J.LESS_THAN||e===J.GREATER_THAN){let n=i[a+1];if(n&&er.has(e+n)){this._pushNodeToChildren(r+e+n),this._resetSegment(),this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,n,a),a++;continue}this._pushNodeToChildren(r+e)}else this._pushNodeToChildren(r+e);this._resetSegment()}else this._pushSegment(e);this._addSequenceArray(t,e,a),a++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return X.VALUE}_isScientificNotation(e,t,r){let n=e[t-2];if(n&&Number.isNaN(Number(n))||!(r===J.MINUS||r===J.PLUS))return!1;let i=e[t+1];if(i&&Number.isNaN(Number(i)))return!1;let s=e[t-1];return s&&"E"===s.toUpperCase()}_addSequenceArray(e,t,r){null==e||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}}var tb=Object.defineProperty,tR=Object.getOwnPropertyDescriptor,tN=(e,t)=>(r,n)=>t(r,n,e);let tI=class extends k.Disposable{constructor(e,t){super(),G(this,"_formulaData",{}),G(this,"_arrayFormulaRange",{}),G(this,"_arrayFormulaCellData",{}),this._univerInstanceService=e,this._lexerTreeBuilder=t,this.initFormulaData()}dispose(){super.dispose(),this._formulaData={},this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{var n,i,s,a;let o=r[e],l=null==(i=null==(n=this._arrayFormulaRange)?void 0:n[t])?void 0:i[e];if(null==l)return!0;let u=new k.ObjectMatrix(l),c=new k.ObjectMatrix;(null==(s=this._arrayFormulaCellData[t])?void 0:s[e])!=null&&(c=new k.ObjectMatrix(null==(a=this._arrayFormulaCellData[t])?void 0:a[e])),o.forValue((e,t)=>{let r=u.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=r;for(let e=n;e<=s;e++)for(let t=i;t<=a;t++)c.setValue(e,t,null);u.realDeleteValue(e,t)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;null==this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t]={}),null==this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(e=>{var n,i;let s=r[e],a=new k.ObjectMatrix(null==(n=this._arrayFormulaRange[t])?void 0:n[e]),o=new k.ObjectMatrix(null==(i=this._arrayFormulaCellData[t])?void 0:i[e]);s.forValue((e,t)=>{let r=null==a?void 0:a.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:l}=r;for(let e=n;e<=s;e++)for(let t=i;t<=l;t++)o.setValue(e,t,null)}),s.forValue((e,t,r)=>{o.setValue(e,t,r)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=o.getData())})})}getFormulaData(){return this._formulaData}setFormulaData(e){this._formulaData=e}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(e=>{var n;let i=new k.ObjectMatrix(r[e]),s=new k.ObjectMatrix(null==(n=this._arrayFormulaRange[t])?void 0:n[e]);i.forValue((e,t,r)=>{s.setValue(e,t,r)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][e]=s.getData())})})}mergeFormulaData(e){Object.keys(e).forEach(t=>{let r=e[t];if(void 0!==r){if(null===r){delete this._formulaData[t];return}this._formulaData[t]||(this._formulaData[t]={}),Object.keys(r).forEach(e=>{var n,i;let s=r[e];if(void 0===s)return;if(null===s){null==(n=this._formulaData[t])||delete n[e];return}null!=(i=this._formulaData[t])&&i[e]||(this._formulaData[t][e]={});let a=new k.ObjectMatrix(s),o=new k.ObjectMatrix(this._formulaData[t][e]);a.forValue((e,t,r)=>{null==r?o.realDeleteValue(e,t):o.setValue(e,t,r)})})}})}deleteArrayFormulaRange(e,t,r,n){var i;let s=null==(i=this._arrayFormulaRange[e])?void 0:i[t];if(null==s)return;let a=new k.ObjectMatrix(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}initFormulaData(){if(0===this._univerInstanceService.getAllUnitsForType(k.UniverInstanceType.UNIVER_SHEET).length)return;let e=this._univerInstanceService.getCurrentUnitForType(k.UniverInstanceType.UNIVER_SHEET),t=e.getUnitId();this._formulaData[t]={},e.getSheets().forEach(e=>{let r=e.getCellMatrix(),n=e.getSheetId();tA(this._formulaData,t,n,r)})}getCalculateData(){let e=this._univerInstanceService.getAllUnitsForType(k.UniverInstanceType.UNIVER_SHEET),t={},r={};for(let n of e){let e=n.getUnitId(),i=n.getSheets(),s={},a={};for(let e of i){let t=e.getSheetId(),r=e.getConfig();s[t]={cellData:new k.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},a[e.getName()]=e.getSheetId()}t[e]=s,r[e]=a}return{allUnitData:t,unitSheetNameMap:r}}updateFormulaData(e,t,r){let n=new k.ObjectMatrix(r),i=this.getFormulaIdMap(e,t),s=/* @__PURE__ */new Map,a=this._formulaData;null==a[e]&&(a[e]={});let o=a[e];null==o[t]&&(o[t]={});let l=new k.ObjectMatrix(o[t]||{}),u=new k.ObjectMatrix;return n.forValue((e,t,r)=>{(function(e,t,r,n,i,s,a){let o=(null==a?void 0:a.f)||"",l=(null==a?void 0:a.si)||"",u=(0,k.isFormulaString)(o),c=(0,k.isFormulaId)(l),h=e.getValue(i,s),d=(null==h?void 0:h.f)||"",m=(null==h?void 0:h.si)||"";function g(){var e;if((0,k.isFormulaString)(d)&&(0,k.isFormulaId)(m)){let t=null==(e=r.get(m))?void 0:e.f;t?n.set(m,t):n.set(m,d)}}u&&c?(m!==l&&g(),e.setValue(i,s,{f:o,si:l}),r.set(l,{f:o,r:i,c:s}),t.setValue(i,s,{f:o,si:l})):u&&!c?(d!==o&&g(),e.setValue(i,s,{f:o}),t.setValue(i,s,{f:o})):!u&&c?(m!==l&&g(),e.setValue(i,s,{f:"",si:l})):!u&&!c&&e.getValue(i,s)&&(g(),e.realDeleteValue(i,s),t.setValue(i,s,null))})(l,u,i,s,e,t,r)}),l.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,k.isFormulaId)(a)){let o=i.get(a),c=s.get(a);if(o&&!(0,k.isFormulaString)(n)){let r=o.f,n=t-o.c,i=e-o.r;l.setValue(e,t,{f:r,si:a,x:n,y:i}),u.setValue(e,t,{f:r,si:a,x:n,y:i})}else if("string"==typeof c){let n=(null==r?void 0:r.x)||0,i=(null==r?void 0:r.y)||0,o=this._lexerTreeBuilder.moveFormulaRefOffset(c,n,i);s.set(a,{r:e,c:t,f:o}),l.setValue(e,t,{f:o,si:a}),u.setValue(e,t,{f:o,si:a})}else if("object"==typeof c){let r=t-c.c,n=e-c.r;l.setValue(e,t,{f:c.f,si:a,x:r,y:n}),u.setValue(e,t,{f:c.f,si:a,x:r,y:n})}}}),u.getMatrix()}updateArrayFormulaRange(e,t,r){var n;let i=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!i)return;let s=new k.ObjectMatrix(i);new(0,k.ObjectMatrix)(r).forValue((e,t,r)=>{s.realDeleteValue(e,t)})}updateArrayFormulaCellData(e,t,r){var n,i;let s=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!s)return;let a=new k.ObjectMatrix(s),o=null==(i=this._arrayFormulaCellData[e])?void 0:i[t];if(!o)return;let l=new k.ObjectMatrix(o);new(0,k.ObjectMatrix)(r).forValue((e,t,r)=>{!function(e,t,r,n){let i=null==e?void 0:e.getValue(r,n);if(null==i)return;let s=[];e.forValue((e,t,a)=>{e===r&&t===n||(0,k.Rectangle).intersects(a,i)&&s.push(a)});let{startRow:a,startColumn:o,endRow:l,endColumn:u}=i;for(let e=a;e<=l;e++)for(let r=o;r<=u;r++){let n=!1,i=(0,k.cellToRange)(e,r);s.some(e=>!!(0,k.Rectangle).contains(e,i)&&(n=!0,!0)),n||t.realDeleteValue(e,r)}}(a,l,e,t)})}getFormulaItemBySId(e,t,r){let n=this._formulaData;if(null==n[r])return null;let i=n[r];if((null==i?void 0:i[t])==null)return null;let s=new k.ObjectMatrix(i[t]||{}),a=null;return s.forValue((t,r,n)=>{if(null==n)return!0;let{f:i,si:s,x:o=0,y:l=0}=n;if(s===e&&i.length>0&&0===o&&0===l)return a=n,!1}),a}getFormulaDataItem(e,t,r,n){var i,s,a,o;return null==(o=null==(a=null==(s=null==(i=this._formulaData)?void 0:i[n])?void 0:s[r])?void 0:a[e])?void 0:o[t]}getFormulaIdMap(e,t){let r=/* @__PURE__ */new Map,n=this._formulaData;if(null==n[e])return r;let i=n[e];return(null==i?void 0:i[t])==null||new(0,k.ObjectMatrix)(i[t]||{}).forValue((e,t,n)=>{let i=(null==n?void 0:n.f)||"",s=(null==n?void 0:n.si)||"",a=(null==n?void 0:n.x)||0,o=(null==n?void 0:n.y)||0;(0,k.isFormulaString)(i)&&(0,k.isFormulaId)(s)&&0===a&&0===o&&r.set(s,{f:i,r:e,c:t})}),r}getFormulaStringByCell(e,t,r,n){let i=this.getFormulaDataItem(e,t,r,n);if(null==i)return null;let{f:s,si:a,x:o=0,y:l=0}=i;if(null!=a&&(0!==o||0!==l)){let e="";if(s.length>0)e=s;else{let t=this.getFormulaItemBySId(a,r,n);if(null==t||0===t.f.length)return null;e=t.f}return this._lexerTreeBuilder.moveFormulaRefOffset(e,o,l)}return(0,k.isFormulaString)(s)?s:null}getFormulaDirtyRanges(){let e=this._formulaData,t=[];for(let r in e){let n=e[r];if(!n)continue;let i=this._univerInstanceService.getUnit(r);if(i)for(let e in n){let s=n[e];if(!s)continue;let a=i.getSheetBySheetId(e);if(!a)continue;let o={};for(let e of Object.keys(s)){let t=Number(e);for(let e in s[t]){let r=Number(e),n=a.getCellRaw(t,r),i=(0,k.isFormulaString)(null==n?void 0:n.f)||(0,k.isFormulaId)(null==n?void 0:n.si),s=(null==n?void 0:n.v)===void 0;if(!(i&&s))continue;o[r]||(o[r]=[]);let l=o[r].slice(-1)[0];l&&l.endRow===t-1?l.endRow=t:o[r].push({startRow:t,endRow:t})}}for(let n in o){let i=o[n];for(let s=0;s<i.length;s++){let a=i[s];t.push({unitId:r,sheetId:e,range:{rangeType:k.RANGE_TYPE.NORMAL,startRow:a.startRow,endRow:a.endRow,startColumn:Number(n),endColumn:Number(n)}})}}}}return t}};function tA(e,t,r,n){e[t]||(e[t]={}),e[t][r]||(e[t][r]={});let i=/* @__PURE__ */new Map,s=new k.ObjectMatrix(e[t][r]);return n.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"",o=(0,k.isFormulaString)(n),l=(0,k.isFormulaId)(a);o&&l?(s.setValue(e,t,{f:n,si:a}),i.set(a,{f:n,r:e,c:t})):o&&!l?s.setValue(e,t,{f:n}):!o&&l&&s.setValue(e,t,{f:"",si:a})}),s.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,k.isFormulaId)(a)&&!(0,k.isFormulaString)(n)){let r=i.get(a);if(r){let n=r.f,i=t-r.c,o=e-r.r;s.setValue(e,t,{f:n,si:a,x:i,y:o})}else s.realDeleteValue(e,t)}}),{[t]:{[r]:s.getMatrix()}}}tI=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tR(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&tb(t,r,s),s})([tN(0,k.IUniverInstanceService),tN(1,(0,k.Inject)(tE))],tI);let tv=class e{constructor(e,t){this.low=e,this.high=t}clone(){return new e(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equal_to(e){return this.low===e.low&&this.high===e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(t){return new e(void 0===this.low?t.low:this.low<t.low?this.low:t.low,void 0===this.high?t.high:this.high>t.high?this.high:t.high)}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}};class tS{constructor(e,t,r=null,n=null,i=null,s=1){if(this.left=r,this.right=n,this.parent=i,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&2===e.length&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])){let[t,r]=e;t>r&&([t,r]=[r,t]),this.item.key=new tv(t,r)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&1===this.color}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value===e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){return(0,this.item.key.constructor.comparable_less_than)(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,r=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}}class tT{constructor(){this.root=null,this.nil_node=new tS}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return null==this.root||this.root===this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let r=new tS(e,t,this.nil_node,this.nil_node,null,0);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new tS(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new tS(e,t),n=this.tree_search(this.root,r);return n&&this.tree_delete(n),n}search(e,t=(e,t)=>e===t?t.output():e){let r=new tS(e),n=[];return this.tree_search_interval(this.root,r,n),n.map(e=>t(e.item.value,e.item.key))}intersect_any(e){let t=new tS(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new tT;return this.tree_walk(this.root,r=>t.insert(r.item.key,e(r.item.value,r.item.key))),t}*iterate(e,t=(e,t)=>e===t?t.output():e){let r;for(e?r=this.tree_search_nearest_forward(this.root,new tS(e)):this.root&&(r=this.local_minimum(this.root));r;)yield t(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(null==this.root||this.root===this.nil_node)this.root=e;else{for(;t!==this.nil_node;)r=t,t=e.less_than(t)?t.left:t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!==this.root&&0===t.parent.color;)t.parent===t.parent.parent.left?0===(r=t.parent.parent.right).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_right(t.parent.parent)):0===(r=t.parent.parent.left).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_left(t.parent.parent));this.root.color=1}tree_delete(e){let t,r;(r=(t=e.left===this.nil_node||e.right===this.nil_node?e:this.tree_successor(e)).left!==this.nil_node?t.left:t.right).parent=t.parent,t===this.root?this.root=r:(t===t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!==e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),1===t.color&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!==this.root&&null!=t.parent&&1===t.color;)t===t.parent.left?(0===(r=t.parent.right).color&&(r.color=1,t.parent.color=0,this.rotate_left(t.parent),r=t.parent.right),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.right.color&&(r.color=0,r.left.color=1,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=1,r.right.color=1,this.rotate_left(t.parent),t=this.root)):(0===(r=t.parent.left).color&&(r.color=1,t.parent.color=0,this.rotate_right(t.parent),r=t.parent.left),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.left.color&&(r.color=0,r.right.color=1,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=1,r.left.color=1,this.rotate_right(t.parent),t=this.root));t.color=1}tree_search(e,t){if(!(null==e||e===this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_nearest_forward(e,t){let r,n=e;for(;n&&n!==this.nil_node;)n.less_than(t)?n.intersect(t)?(r=n,n=n.left):n=n.right:((!r||n.less_than(r))&&(r=n),n=n.left);return r||null}tree_search_interval(e,t,r){null==e||e===this.nil_node||(e.left===this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right===this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return null==e||e===this.nil_node||(e.left===this.nil_node||e.not_intersect_left_subtree(t)||(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),r||e.right===this.nil_node||e.not_intersect_right_subtree(t)||(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;null!=t.left&&t.left!==this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!==this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,n;if(e.right!==this.nil_node)t=this.local_minimum(e.right);else{for(r=e,n=e.parent;null!=n&&n.right===r;)r=n,n=n.parent;t=n}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!==this.nil_node&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!==this.nil_node&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!==e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!==this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){0===t.color&&(1===t.left.color&&1===t.right.color||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0;if(1===e.color&&t++,(r=e.left!==this.nil_node?this.testBlackHeightProperty(e.left):1)!==(e.right!==this.nil_node?this.testBlackHeightProperty(e.right):1))throw Error("Red-black height property violated");return t+r}}let tO=new class{constructor(){G(this,"_cache",/* @__PURE__ */new Map),G(this,"_continueBuildingCache",/* @__PURE__ */new Map)}set(e,t,r,n,i){if(!this.shouldContinueBuildingCache(e,t,r,i))return;let s=this._cache.get(e);null==s&&(s=/* @__PURE__ */new Map,this._cache.set(e,s));let a=s.get(t);null==a&&(a=/* @__PURE__ */new Map,s.set(t,a));let o=a.get(r);null==o&&(o=/* @__PURE__ */new Map,a.set(r,o));let l=o.get(n);null==l&&(l=/* @__PURE__ */new Set,o.set(n,l)),l.add(i)}getCellValuePositions(e,t,r){var n,i;return null==(i=null==(n=this._cache.get(e))?void 0:n.get(t))?void 0:i.get(r)}getCellPositions(e,t,r,n,i){var s,a,o;let l=null==(o=null==(a=null==(s=this._cache.get(e))?void 0:s.get(t))?void 0:a.get(r))?void 0:o.get(n);return l&&[...l].filter(e=>i.some(([t,r])=>e>=t&&e<=r))}setContinueBuildingCache(e,t,r,n,i){if(-1===r||-1===n||-1===i)return;let s=this._continueBuildingCache.get(e);null==s&&(s=/* @__PURE__ */new Map,this._continueBuildingCache.set(e,s));let a=s.get(t);null==a&&(a=/* @__PURE__ */new Map,s.set(t,a));let o=a.get(r);if(null==o){(o=new tT).insert([n,i]),a.set(r,o);return}this._handleNewInterval(o,n,i)}shouldContinueBuildingCache(e,t,r,n){var i,s;if(-1===r||-1===n)return!1;let a=null==(s=null==(i=this._continueBuildingCache.get(e))?void 0:i.get(t))?void 0:s.get(r);return!a||0===a.search([n,n]).length}canUseCache(e,t,r,n,i){var s,a;let o=null==(a=null==(s=this._continueBuildingCache.get(e))?void 0:s.get(t))?void 0:a.get(r);if(-1===r||-1===n||-1===i||!o)return{rowsInCache:[],rowsNotInCache:[]};let l=o.search([n,i]);if(0===l.length)return{rowsInCache:[],rowsNotInCache:[]};l.sort((e,t)=>e[0]-t[0]);let u=[],c=[],h=n;for(let e=0;e<l.length;e++){let[t,r]=l[e];if(h>=t){if(i<=r){u.push([h,i]);break}u.push([h,r]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i])}else{if(i>r){u.push([t,r]),c.push([h,t-1]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i]);continue}u.push([t,i]),c.push([h,t-1])}}return{rowsInCache:u,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(e,t,r){let n=e.search([t,r]);if(0===n.length){let i=[t-1<0?0:t-1,r+1];if(0===(n=e.search(i)).length){e.insert([t,r]);return}}let i=t,s=r;for(let t of n)i=Math.min(i,t[0]),s=Math.max(s,t[1]),e.remove(t);e.insert([i,s])}},tM="engine-formula.config",tw={};var tx=Object.defineProperty,tU=Object.getOwnPropertyDescriptor,tD=(e,t)=>(r,n)=>t(r,n,e);let tV=class extends k.Disposable{constructor(e,t){super(),G(this,"_unitData",{}),G(this,"_unitStylesData",{}),G(this,"_arrayFormulaCellData",{}),G(this,"_arrayFormulaRange",{}),G(this,"_formulaData",{}),G(this,"_sheetNameMap",{}),G(this,"_forceCalculate",!1),G(this,"_clearDependencyTreeCache",{}),G(this,"_dirtyRanges",[]),G(this,"_dirtyNameMap",{}),G(this,"_dirtyDefinedNameMap",{}),G(this,"_dirtyUnitFeatureMap",{}),G(this,"_dirtyUnitOtherFormulaMap",{}),G(this,"_excludedCell"),G(this,"_sheetIdToNameMap",{}),G(this,"_executeUnitId",""),G(this,"_executeSubUnitId",""),this._univerInstanceService=e,this._localeService=t}dispose(){this._unitData={},this._unitStylesData={},this._formulaData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._sheetNameMap={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._excludedCell={},this._sheetIdToNameMap={},this._dirtyUnitOtherFormulaMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return null==this._sheetIdToNameMap[e]?"":this._sheetIdToNameMap[e][t]||""}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){let{id:e,sheetOrder:t}=this._univerInstanceService.getCurrentUnitForType(k.UniverInstanceType.UNIVER_SHEET).getSnapshot();return{sheetOrder:t,sheetNameMap:this._sheetIdToNameMap[e]}}getSheetRowColumnCount(e,t){let r=this._univerInstanceService.getUnit(e),n=null==r?void 0:r.getSheetBySheetId(t),i=null==n?void 0:n.getSnapshot();if(!i)return{rowCount:0,columnCount:0};let{rowCount:s,columnCount:a}=i;return{rowCount:s,columnCount:a}}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{let{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}this._formulaData=e.formulaData,this._arrayFormulaCellData=function(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];if(null==n)return!0;null==t[r]&&(t[r]={}),Object.keys(n).forEach(e=>{let i=n[e];t[r][e]=new k.ObjectMatrix(i)})}),t}(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{null==e[r]&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(r=>{null==this._sheetIdToNameMap[t]&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][e[t][r]]=r})})}_loadSheetData(){let e=this._univerInstanceService.getAllUnitsForType(k.UniverInstanceType.UNIVER_SHEET),t=this._univerInstanceService.getCurrentUnitForType(k.UniverInstanceType.UNIVER_SHEET),r=null==t?void 0:t.getActiveSheet();this._executeUnitId=null==t?void 0:t.getUnitId(),this._executeSubUnitId=null==r?void 0:r.getSheetId();let n={},i={},s={};for(let t of e){let e=t.getUnitId(),r=t.getSheets(),a={},o={};for(let e of r){let t=e.getSheetId(),r=e.getConfig();a[t]={cellData:new k.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},o[e.getName()]=e.getSheetId()}n[e]=a,i[e]=t.getStyles(),s[e]=o}return{allUnitData:n,unitStylesData:i,unitSheetNameMap:s}}};tV=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tU(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&tx(t,r,s),s})([tD(0,k.IUniverInstanceService),tD(1,(0,k.Inject)(k.LocaleService))],tV);let tL=(0,k.createIdentifier)("univer.formula.current-data.service");var tP=Object.defineProperty,tj=Object.getOwnPropertyDescriptor,tF=(e,t)=>(r,n)=>t(r,n,e);let tk=class extends k.Disposable{constructor(e,t,r){super(),this._definedNamesService=e,this._lexerTreeBuilder=t,this._formulaCurrentConfigService=r}treeBuilder(e,t=!0){return this._lexerTreeBuilder.treeBuilder(e,t,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++){let r=n[t];if(e.indexOf(r)>-1)return!0}}return!1}_checkDefinedNameDirty(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++)if(n[t]===e)return!0}return!1}_injectDefinedName(e){let t=this._formulaCurrentConfigService.getExecuteUnitId();if(null==t)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};let r=this._lexerTreeBuilder.getSequenceNode(e),n="",i=!1,s=[];for(let e=0,a=r.length;e<a;e++){let a=r[e];if("string"==typeof a){n+=a;continue}let{nodeType:o,token:l}=a;if(o===tf.REFERENCE||o===tf.FUNCTION){let e=this._definedNamesService.getValueByName(t,l);if(e){let t=e.formulaOrRefString;t.substring(0,1)===J.EQUALS&&(t=t.substring(1)),n+=t,s.push(e.name),i=!0}else this._checkDefinedNameDirty(l)?(n+=X.NAME,i=!0,s.push(l)):n+=l}else n+=l}return{sequenceString:n,hasDefinedName:i,definedNames:s}}};function tB(e,t,r,n,i){var s;for(let a of Object.keys(i)){let o=i[a],l=null==(s=null==o?void 0:o[n])?void 0:s[r];if(null==l)continue;let u=l.getValue(e,t);if(null!=u)return u}}tk=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tj(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&tP(t,r,s),s})([tF(0,e2),tF(1,(0,k.Inject)(tE)),tF(2,tL)],tk);let t$=["$","","","","","","","","","","","","","","","","","","","","","","","","","",""],tH={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function tW(e,t,r){var n,i;if(null==e||null==t)return t;let s=(null==r?void 0:r.getStyleByCell(e))||e.s,a=(null==r?void 0:r.getStyleByCell(t))||t.s;if(null==s||null==a||"object"!=typeof s||"object"!=typeof a)return t;let o=null==(n=null==s?void 0:s.n)?void 0:n.pattern,l=null==(i=null==a?void 0:a.n)?void 0:i.pattern;return null==o||null==l||(a.n.pattern=o||l),t}let tG=new tl(1e5);function tY(e){let t=tG.get(e);if(void 0!==t)return t;let r=t$.find(t=>e.includes(t))&&e.startsWith("_(")?3:tH[(0,k.numfmt).getInfo(e).type||"unknown"];return tG.set(e,r),r}function tz(e,t,r){if(""===e)return t;if(""===t)return e;let n=tY(e),i=tY(t);return r===J.PLUS||r===J.MINUS?4===n&&4===i||11===n&&11===i?"":t:r===J.MULTIPLY||r===J.DIVIDED?6===n&&6===i||7===n&&7===i||8===n&&8===i||9===n&&9===i?t:"":e||t}let tq=/* @__PURE__ */new Map([[k.LocaleType.EN_US,"$"],[k.LocaleType.RU_RU,""],[k.LocaleType.VI_VN,""],[k.LocaleType.ZH_CN,""],[k.LocaleType.ZH_TW,"NT$"]]);function tX(e){return tq.get(e)||"$"}function tK(e,t=2){let r=t;t>127&&(r=127);let n="";return r>0&&(n=`.${"0".repeat(r)}`),`"${tX(e)}"#,##0${n}_);[Red]("${tX(e)}"#,##0${n})`}let tQ=new tl(1e5);function tZ(e,t,r){return tQ.set(e,{value:t,pattern:r}),{isNumberPattern:!0,value:t,pattern:r}}class tJ{constructor(){G(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}}class t0 extends tJ{constructor(e){super(),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}sum(){return t2.create(X.VALUE)}max(){return t2.create(X.VALUE)}min(){return t2.create(X.VALUE)}count(){return t2.create(X.VALUE)}countA(){return t2.create(X.VALUE)}countBlank(){return t2.create(X.VALUE)}getNegative(){return t2.create(X.VALUE)}getReciprocal(){return t2.create(X.VALUE)}plus(e){return t2.create(X.VALUE)}minus(e){return t2.create(X.VALUE)}multiply(e){return t2.create(X.VALUE)}divided(e){return t2.create(X.VALUE)}mod(e){return t2.create(X.VALUE)}map(e){return t2.create(X.NAME)}mapValue(e){return t2.create(X.NAME)}compare(e,t,r=!1){return t2.create(X.NAME)}isEqual(e){return this.compare(e,ee.EQUALS)}isNotEqual(e){return this.compare(e,ee.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,ee.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,ee.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,ee.LESS_THAN)}isGreaterThan(e){return this.compare(e,ee.GREATER_THAN)}concatenateFront(e){return t2.create(X.NAME)}concatenateBack(e){return t2.create(X.NAME)}plusBy(e){return t2.create(X.VALUE)}minusBy(e){return t2.create(X.VALUE)}multiplyBy(e){return t2.create(X.VALUE)}dividedBy(e){return t2.create(X.VALUE)}modInverse(e){return t2.create(X.VALUE)}compareBy(e,t){return t2.create(X.NAME)}concatenate(e,t=q.FRONT){let r=this.getValue().toString();if("string"==typeof e)t===q.FRONT?r=e+r:r+=e;else if("number"==typeof e)t===q.FRONT?r=e.toString()+r:r+=e.toString();else if("boolean"==typeof e){let n=e?"TRUE":"FALSE";t===q.FRONT?r=n+r:r+=n}return r}pow(e){return t2.create(X.VALUE)}powInverse(e){return t2.create(X.VALUE)}sqrt(){return t2.create(X.VALUE)}cbrt(){return t2.create(X.VALUE)}cos(){return t2.create(X.VALUE)}cosh(){return t2.create(X.VALUE)}acos(){return t2.create(X.VALUE)}acosh(){return t2.create(X.VALUE)}sin(){return t2.create(X.VALUE)}sinh(){return t2.create(X.VALUE)}asin(){return t2.create(X.VALUE)}asinh(){return t2.create(X.VALUE)}tan(){return t2.create(X.VALUE)}tanh(){return t2.create(X.VALUE)}atan(){return t2.create(X.VALUE)}atan2(e){return t2.create(X.VALUE)}atan2Inverse(e){return t2.create(X.VALUE)}atanh(){return t2.create(X.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return t2.create(X.VALUE)}log10(){return t2.create(X.VALUE)}exp(){return t2.create(X.VALUE)}abs(){return t2.create(X.VALUE)}round(e){return t2.create(X.VALUE)}roundInverse(e){return t2.create(X.VALUE)}floor(e){return t2.create(X.VALUE)}floorInverse(e){return t2.create(X.VALUE)}ceil(e){return t2.create(X.VALUE)}ceilInverse(e){return t2.create(X.VALUE)}convertToNumberObjectValue(){return t2.create(X.VALUE)}convertToBooleanObjectValue(){return t2.create(X.VALUE)}}let t1=new tl(1e3);class t2 extends t0{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(e,t=""){let r=`${e}-${t}`,n=t1.get(r);if(n)return n;let i=new t2(e,t);return t1.set(r,i),i}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}}var t5=((p=t5||{})[p.MIN=0]="MIN",p[p.MAX=1]="MAX",p),t3=((C=t3||{})[C.NORMAL=0]="NORMAL",C[C.MIN=1]="MIN",C[C.MAX=2]="MAX",C);function t4(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(e,t)=>e.localeCompare(t)}function t6(e,t){let r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/~?[*?]/g,e=>e.startsWith("~")?`\\${e.substring(1)}`:"*"===e?".*":"?"===e?".":e);return RegExp(`^${r}$`).test(e)}function t9(e){return e.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function t7(e){switch(e){case 1:return 2;case 0:default:return 0;case -1:return 1}}function t8(e){return -2===e?1:0}function re(e){let t;switch(e){case ee.EQUALS:t=ee.EQUALS;break;case ee.GREATER_THAN:t=ee.LESS_THAN;break;case ee.GREATER_THAN_OR_EQUAL:t=ee.LESS_THAN_OR_EQUAL;break;case ee.LESS_THAN:t=ee.GREATER_THAN;break;case ee.LESS_THAN_OR_EQUAL:t=ee.GREATER_THAN_OR_EQUAL;break;case ee.NOT_EQUAL:t=ee.NOT_EQUAL}return t}/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var rt,rr,rn="0123456789abcdef",ri="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rs="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ra={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},ro=!0,rl="[DecimalError] ",ru=rl+"Invalid argument: ",rc=rl+"Precision limit exceeded",rh=rl+"crypto unavailable",rd="[object Decimal]",rm=Math.floor,rg=Math.pow,rf=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,rp=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rC=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,r_=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ry=ri.length-1,rE=rs.length-1,rb={toStringTag:rd};function rR(e){var t,r,n,i=e.length-1,s="",a=e[0];if(i>0){for(s+=a,t=1;t<i;t++)(r=7-(n=e[t]+"").length)&&(s+=rU(r)),s+=n;(r=7-(n=(a=e[t])+"").length)&&(s+=rU(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}function rN(e,t,r){if(e!==~~e||e<t||e>r)throw Error(ru+e)}function rI(e,t,r,n){var i,s,a,o;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=7,i=0):(i=Math.ceil((t+1)/7),t%=7),s=rg(10,7-t),o=e[i]%s|0,null==n?t<3?(0==t?o=o/100|0:1==t&&(o=o/10|0),a=r<4&&99999==o||r>3&&49999==o||5e4==o||0==o):a=(r<4&&o+1==s||r>3&&o+1==s/2)&&(e[i+1]/s/100|0)==rg(10,t-2)-1||(o==s/2||0==o)&&(e[i+1]/s/100|0)==0:t<4?(0==t?o=o/1e3|0:1==t?o=o/100|0:2==t&&(o=o/10|0),a=(n||r<4)&&9999==o||!n&&r>3&&4999==o):a=((n||r<4)&&o+1==s||!n&&r>3&&o+1==s/2)&&(e[i+1]/s/1e3|0)==rg(10,t-3)-1,a}function rA(e,t,r){for(var n,i,s=[0],a=0,o=e.length;a<o;){for(i=s.length;i--;)s[i]*=t;for(s[0]+=rn.indexOf(e.charAt(a++)),n=0;n<s.length;n++)s[n]>r-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}rb.absoluteValue=rb.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),rS(e)},rb.ceil=function(){return rS(new this.constructor(this),this.e+1,2)},rb.clampedTo=rb.clamp=function(e,t){var r=this.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(ru+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new r(this)},rb.comparedTo=rb.cmp=function(e){var t,r,n,i,s=this.d,a=(e=new this.constructor(e)).d,o=this.s,l=e.s;if(!s||!a)return o&&l?o!==l?o:s===a?0:!s^o<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?o:a[0]?-l:0;if(o!==l)return o;if(this.e!==e.e)return this.e>e.e^o<0?1:-1;for(n=s.length,i=a.length,t=0,r=n<i?n:i;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^o<0?1:-1;return n===i?0:n>i^o<0?1:-1},rb.cosine=rb.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n,i;if(t.isZero())return t;(n=t.d.length)<32?i=(1/r$(4,r=Math.ceil(n/3))).toString():(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=rB(e,1,t.times(i),new e(1));for(var s=r;s--;){var a=t.times(t);t=a.times(a).minus(a).times(8).plus(1)}return e.precision-=r,t}(n,rH(n,r)),n.precision=e,n.rounding=t,rS(2==rr||3==rr?r.neg():r,e,t,!0)):new n(1):new n(NaN)},rb.cubeRoot=rb.cbrt=function(){var e,t,r,n,i,s,a,o,l,u,c=this.constructor;if(!this.isFinite()||this.isZero())return new c(this);for(ro=!1,(s=this.s*rg(this.s*this,1/3))&&Math.abs(s)!=1/0?n=new c(s.toString()):(r=rR(this.d),(s=((e=this.e)-r.length+1)%3)&&(r+=1==s||-2==s?"0":"00"),s=rg(r,1/3),e=rm((e+1)/3)-(e%3==(e<0?-1:2)),(n=new c(r=s==1/0?"5e"+e:(r=s.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=this.s),a=(e=c.precision)+3;;)if(n=rv((u=(l=(o=n).times(o).times(o)).plus(this)).plus(this).times(o),u.plus(l),a+2,1),rR(o.d).slice(0,a)===(r=rR(n.d)).slice(0,a)){if("9999"!=(r=r.slice(a-3,a+1))&&(i||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(rS(n,e+1,1),t=!n.times(n).times(n).eq(this));break}if(!i&&(rS(o,e+1,0),o.times(o).times(o).eq(this))){n=o;break}a+=4,i=1}return ro=!0,rS(n,e,c.rounding,t)},rb.decimalPlaces=rb.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-rm(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},rb.dividedBy=rb.div=function(e){return rv(this,new this.constructor(e))},rb.dividedToIntegerBy=rb.divToInt=function(e){var t=this.constructor;return rS(rv(this,new t(e),0,1,1),t.precision,t.rounding)},rb.equals=rb.eq=function(e){return 0===this.cmp(e)},rb.floor=function(){return rS(new this.constructor(this),this.e+1,3)},rb.greaterThan=rb.gt=function(e){return this.cmp(e)>0},rb.greaterThanOrEqualTo=rb.gte=function(e){var t=this.cmp(e);return 1==t||0===t},rb.hyperbolicCosine=rb.cosh=function(){var e,t,r,n,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;r=a.precision,n=a.rounding,a.precision=r+Math.max(s.e,s.sd())+4,a.rounding=1,(i=s.d.length)<32?t=(1/r$(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),s=rB(a,1,s.times(t),new a(1),!0);for(var l,u=e,c=new a(8);u--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return rS(s,a.precision=r,a.rounding=n,!0)},rb.hyperbolicSine=rb.sinh=function(){var e,t,r,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(t=s.precision,r=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<3)i=rB(s,2,i,i,!0);else{e=(e=1.4*Math.sqrt(n))>16?16:0|e,i=rB(s,2,i=i.times(1/r$(5,e)),i,!0);for(var a,o=new s(5),l=new s(16),u=new s(20);e--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(u))))}return s.precision=t,s.rounding=r,rS(i,t,r,!0)},rb.hyperbolicTangent=rb.tanh=function(){var e,t,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,rv(this.sinh(),this.cosh(),r.precision=e,r.rounding=t)):new r(this.s)},rb.inverseCosine=rb.acos=function(){var e,t=this,r=t.constructor,n=t.abs().cmp(1),i=r.precision,s=r.rounding;return -1!==n?0===n?t.isNeg()?rw(r,i,s):new r(0):new r(NaN):t.isZero()?rw(r,i+4,s).times(.5):(r.precision=i+6,r.rounding=1,t=t.asin(),e=rw(r,i+4,s).times(.5),r.precision=i,r.rounding=s,e.minus(t))},rb.inverseHyperbolicCosine=rb.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,ro=!1,r=r.times(r).minus(1).sqrt().plus(r),ro=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)},rb.inverseHyperbolicSine=rb.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,ro=!1,r=r.times(r).plus(1).sqrt().plus(r),ro=!0,n.precision=e,n.rounding=t,r.ln())},rb.inverseHyperbolicTangent=rb.atanh=function(){var e,t,r,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,t=s.rounding,Math.max(n=i.sd(),e)<-(2*i.e)-1?rS(new s(i),e,t,!0):(s.precision=r=n-i.e,i=rv(i.plus(1),new s(1).minus(i),r+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=t,i.times(.5))):new s(NaN)},rb.inverseSine=rb.asin=function(){var e,t,r,n,i=this,s=i.constructor;return i.isZero()?new s(i):(t=i.abs().cmp(1),r=s.precision,n=s.rounding,-1!==t?0===t?((e=rw(s,r+4,n).times(.5)).s=i.s,e):new s(NaN):(s.precision=r+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=r,s.rounding=n,i.times(2)))},rb.inverseTangent=rb.atan=function(){var e,t,r,n,i,s,a,o,l,u=this,c=u.constructor,h=c.precision,d=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=rE)return(a=rw(c,h+4,d).times(.25)).s=u.s,a}else{if(!u.s)return new c(NaN);if(h+4<=rE)return(a=rw(c,h+4,d).times(.5)).s=u.s,a}for(c.precision=o=h+10,c.rounding=1,e=r=Math.min(28,o/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(ro=!1,t=Math.ceil(o/7),n=1,l=u.times(u),a=new c(u),i=u;-1!==e;)if(i=i.times(l),s=a.minus(i.div(n+=2)),i=i.times(l),void 0!==(a=s.plus(i.div(n+=2))).d[t])for(e=t;a.d[e]===s.d[e]&&e--;);return r&&(a=a.times(2<<r-1)),ro=!0,rS(a,c.precision=h,c.rounding=d,!0)},rb.isFinite=function(){return!!this.d},rb.isInteger=rb.isInt=function(){return!!this.d&&rm(this.e/7)>this.d.length-2},rb.isNaN=function(){return!this.s},rb.isNegative=rb.isNeg=function(){return this.s<0},rb.isPositive=rb.isPos=function(){return this.s>0},rb.isZero=function(){return!!this.d&&0===this.d[0]},rb.lessThan=rb.lt=function(e){return 0>this.cmp(e)},rb.lessThanOrEqualTo=rb.lte=function(e){return 1>this.cmp(e)},rb.logarithm=rb.log=function(e){var t,r,n,i,s,a,o,l=this.constructor,u=l.precision,c=l.rounding;if(null==e)e=new l(10),t=!0;else{if(r=(e=new l(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new l(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(t){if(r.length>1)i=!0;else{for(n=r[0];n%10==0;)n/=10;i=1!==n}}if(ro=!1,rI((o=rv(rj(this,a=u+5),t?rM(l,a+10):rj(e,a),a,1)).d,n=u,c))do if(a+=10,o=rv(rj(this,a),t?rM(l,a+10):rj(e,a),a,1),!i){+rR(o.d).slice(n+1,n+15)+1==1e14&&(o=rS(o,u+1,0));break}while(rI(o.d,n+=10,c))return ro=!0,rS(o,u,c)},rb.minus=rb.sub=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.constructor;if(e=new m(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new m(e.d||this.s!==e.s?this:NaN):e=new m(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(u=this.d,d=e.d,o=m.precision,l=m.rounding,!u[0]||!d[0]){if(d[0])e.s=-e.s;else{if(!u[0])return new m(3===l?-0:0);e=new m(this)}return ro?rS(e,o,l):e}if(r=rm(e.e/7),c=rm(this.e/7),u=u.slice(),s=c-r){for((h=s<0)?(t=u,s=-s,a=d.length):(t=d,r=c,a=u.length),s>(n=Math.max(Math.ceil(o/7),a)+2)&&(s=n,t.length=1),t.reverse(),n=s;n--;)t.push(0);t.reverse()}else{for((h=(n=u.length)<(a=d.length))&&(a=n),n=0;n<a;n++)if(u[n]!=d[n]){h=u[n]<d[n];break}s=0}for(h&&(t=u,u=d,d=t,e.s=-e.s),a=u.length,n=d.length-a;n>0;--n)u[a++]=0;for(n=d.length;n>s;){if(u[--n]<d[n]){for(i=n;i&&0===u[--i];)u[i]=1e7-1;--u[i],u[n]+=1e7}u[n]-=d[n]}for(;0===u[--a];)u.pop();for(;0===u[0];u.shift())--r;return u[0]?(e.d=u,e.e=rO(u,r),ro?rS(e,o,l):e):new m(3===l?-0:0)},rb.modulo=rb.mod=function(e){var t,r=this.constructor;return e=new r(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(ro=!1,9==r.modulo?(t=rv(this,e.abs(),0,3,1),t.s*=e.s):t=rv(this,e,0,r.modulo,1),t=t.times(e),ro=!0,this.minus(t)):rS(new r(this),r.precision,r.rounding):new r(NaN)},rb.naturalExponential=rb.exp=function(){return rP(this)},rb.naturalLogarithm=rb.ln=function(){return rj(this)},rb.negated=rb.neg=function(){var e=new this.constructor(this);return e.s=-e.s,rS(e)},rb.plus=rb.add=function(e){var t,r,n,i,s,a,o,l,u,c,h=this.constructor;if(e=new h(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new h(e.d||this.s===e.s?this:NaN)):e=new h(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(u=this.d,c=e.d,o=h.precision,l=h.rounding,!u[0]||!c[0])return c[0]||(e=new h(this)),ro?rS(e,o,l):e;if(s=rm(this.e/7),n=rm(e.e/7),u=u.slice(),i=s-n){for(i<0?(r=u,i=-i,a=c.length):(r=c,n=s,a=u.length),i>(a=(s=Math.ceil(o/7))>a?s+1:a+1)&&(i=a,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((a=u.length)-(i=c.length)<0&&(i=a,r=c,c=u,u=r),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/1e7|0,u[i]%=1e7;for(t&&(u.unshift(t),++n),a=u.length;0==u[--a];)u.pop();return e.d=u,e.e=rO(u,n),ro?rS(e,o,l):e},rb.precision=rb.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(ru+e);return this.d?(t=rx(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},rb.round=function(){var e=this.constructor;return rS(new e(this),this.e+1,e.rounding)},rb.sine=rb.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:rB(e,2,t,t);r=(r=1.4*Math.sqrt(n))>16?16:0|r,t=rB(e,2,t=t.times(1/r$(5,r)),t);for(var i,s=new e(5),a=new e(16),o=new e(20);r--;)i=t.times(t),t=t.times(s.plus(i.times(a.times(i).minus(o))));return t}(n,rH(n,r)),n.precision=e,n.rounding=t,rS(rr>2?r.neg():r,e,t,!0)):new n(NaN)},rb.squareRoot=rb.sqrt=function(){var e,t,r,n,i,s,a=this.d,o=this.e,l=this.s,u=this.constructor;if(1!==l||!a||!a[0])return new u(!l||l<0&&(!a||a[0])?NaN:a?this:1/0);for(ro=!1,0==(l=Math.sqrt(+this))||l==1/0?(((t=rR(a)).length+o)%2==0&&(t+="0"),l=Math.sqrt(t),o=rm((o+1)/2)-(o<0||o%2),n=new u(t=l==1/0?"5e"+o:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+o)):n=new u(l.toString()),r=(o=u.precision)+3;;)if(n=(s=n).plus(rv(this,s,r+2,1)).times(.5),rR(s.d).slice(0,r)===(t=rR(n.d)).slice(0,r)){if("9999"!=(t=t.slice(r-3,r+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(rS(n,o+1,1),e=!n.times(n).eq(this));break}if(!i&&(rS(s,o+1,0),s.times(s).eq(this))){n=s;break}r+=4,i=1}return ro=!0,rS(n,o,u.rounding,e)},rb.tangent=rb.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,(r=r.sin()).s=1,r=rv(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,rS(2==rr||4==rr?r.neg():r,e,t,!0)):new n(NaN)},rb.times=rb.mul=function(e){var t,r,n,i,s,a,o,l,u,c=this.constructor,h=this.d,d=(e=new c(e)).d;if(e.s*=this.s,!h||!h[0]||!d||!d[0])return new c(e.s&&(!h||h[0]||d)&&(!d||d[0]||h)?h&&d?0*e.s:e.s/0:NaN);for(r=rm(this.e/7)+rm(e.e/7),(l=h.length)<(u=d.length)&&(s=h,h=d,d=s,a=l,l=u,u=a),s=[],n=a=l+u;n--;)s.push(0);for(n=u;--n>=0;){for(t=0,i=l+n;i>n;)o=s[i]+d[n]*h[i-n-1]+t,s[i--]=o%1e7|0,t=o/1e7|0;s[i]=(s[i]+t)%1e7|0}for(;!s[--a];)s.pop();return t?++r:s.shift(),e.d=s,e.e=rO(s,r),ro?rS(e,c.precision,c.rounding):e},rb.toBinary=function(e,t){return rW(this,2,e,t)},rb.toDecimalPlaces=rb.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),void 0===e?r:(rN(e,0,1e9),void 0===t?t=n.rounding:rN(t,0,8),rS(r,e+r.e+1,t))},rb.toExponential=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rT(n,!0):(rN(e,0,1e9),void 0===t?t=i.rounding:rN(t,0,8),r=rT(n=rS(new i(n),e+1,t),!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r},rb.toFixed=function(e,t){var r,n,i=this.constructor;return void 0===e?r=rT(this):(rN(e,0,1e9),void 0===t?t=i.rounding:rN(t,0,8),r=rT(n=rS(new i(this),e+this.e+1,t),!1,e+n.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},rb.toFraction=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.d,g=this.constructor;if(!m)return new g(this);if(u=r=new g(1),n=l=new g(0),a=(s=(t=new g(n)).e=rx(m)-this.e-1)%7,t.d[0]=rg(10,a<0?7+a:a),null==e)e=s>0?t:u;else{if(!(o=new g(e)).isInt()||o.lt(u))throw Error(ru+o);e=o.gt(t)?s>0?t:u:o}for(ro=!1,o=new g(rR(m)),c=g.precision,g.precision=s=14*m.length;h=rv(o,t,0,1,1),1!=(i=r.plus(h.times(n))).cmp(e);)r=n,n=i,i=u,u=l.plus(h.times(i)),l=i,i=t,t=o.minus(h.times(i)),o=i;return i=rv(e.minus(r),n,0,1,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=this.s,d=1>rv(u,n,s,1).minus(this).abs().cmp(rv(l,r,s,1).minus(this).abs())?[u,n]:[l,r],g.precision=c,ro=!0,d},rb.toHexadecimal=rb.toHex=function(e,t){return rW(this,16,e,t)},rb.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),null==e){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),void 0===t?t=n.rounding:rN(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(ro=!1,r=rv(r,e,0,t,1).times(e),ro=!0,rS(r)):(e.s=r.s,r=e),r},rb.toNumber=function(){return+this},rb.toOctal=function(e,t){return rW(this,8,e,t)},rb.toPower=rb.pow=function(e){var t,r,n,i,s,a,o=this,l=o.constructor,u=+(e=new l(e));if(!o.d||!e.d||!o.d[0]||!e.d[0])return new l(rg(+o,u));if((o=new l(o)).eq(1))return o;if(n=l.precision,s=l.rounding,e.eq(1))return rS(o,n,s);if((t=rm(e.e/7))>=e.d.length-1&&(r=u<0?-u:u)<=0x1fffffffffffff)return i=rD(l,o,r,n),e.s<0?new l(1).div(i):rS(i,n,s);if((a=o.s)<0){if(t<e.d.length-1)return new l(NaN);if(1&e.d[t]||(a=1),0==o.e&&1==o.d[0]&&1==o.d.length)return o.s=a,o}return(t=0!=(r=rg(+o,u))&&isFinite(r)?new l(r+"").e:rm(u*(Math.log("0."+rR(o.d))/Math.LN10+o.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?a/0:0):(ro=!1,l.rounding=o.s=1,r=Math.min(12,(t+"").length),(i=rP(e.times(rj(o,n+r)),n)).d&&rI((i=rS(i,n+5,1)).d,n,s)&&(t=n+10,+rR((i=rS(rP(e.times(rj(o,t+r)),t),t+5,1)).d).slice(n+1,n+15)+1==1e14&&(i=rS(i,n+1,0))),i.s=a,ro=!0,l.rounding=s,rS(i,n,s))},rb.toPrecision=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rT(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(rN(e,1,1e9),void 0===t?t=i.rounding:rN(t,0,8),r=rT(n=rS(new i(n),e,t),e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r},rb.toSignificantDigits=rb.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(rN(e,1,1e9),void 0===t?t=r.rounding:rN(t,0,8)),rS(new r(this),e,t)},rb.toString=function(){var e=this.constructor,t=rT(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},rb.truncated=rb.trunc=function(){return rS(new this.constructor(this),this.e+1,1)},rb.valueOf=rb.toJSON=function(){var e=this.constructor,t=rT(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t};var rv=/* @__PURE__ */function(){function e(e,t,r){var n,i=0,s=e.length;for(e=e.slice();s--;)n=e[s]*t+i,e[s]=n%r|0,i=n/r|0;return i&&e.unshift(i),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=e[r]<t[r]?1:0,e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(n,i,s,a,o,l){var u,c,h,d,m,g,f,p,C,_,y,E,b,R,N,I,A,v,S,T,O=n.constructor,M=n.s==i.s?1:-1,w=n.d,x=i.d;if(!w||!w[0]||!x||!x[0])return new O(n.s&&i.s&&(w?!x||w[0]!=x[0]:x)?w&&0==w[0]||!x?0*M:M/0:NaN);for(l?(m=1,c=n.e-i.e):(l=1e7,m=7,c=rm(n.e/m)-rm(i.e/m)),S=x.length,A=w.length,_=(C=new O(M)).d=[],h=0;x[h]==(w[h]||0);h++);if(x[h]>(w[h]||0)&&c--,null==s?(R=s=O.precision,a=O.rounding):R=o?s+(n.e-i.e)+1:s,R<0)_.push(1),g=!0;else{if(R=R/m+2|0,h=0,1==S){for(d=0,x=x[0],R++;(h<A||d)&&R--;h++)N=d*l+(w[h]||0),_[h]=N/x|0,d=N%x|0;g=d||h<A}else{for((d=l/(x[0]+1)|0)>1&&(x=e(x,d,l),w=e(w,d,l),S=x.length,A=w.length),I=S,E=(y=w.slice(0,S)).length;E<S;)y[E++]=0;(T=x.slice()).unshift(0),v=x[0],x[1]>=l/2&&++v;do d=0,(u=t(x,y,S,E))<0?(b=y[0],S!=E&&(b=b*l+(y[1]||0)),(d=b/v|0)>1?(d>=l&&(d=l-1),p=(f=e(x,d,l)).length,E=y.length,1==(u=t(f,y,p,E))&&(d--,r(f,S<p?T:x,p,l))):(0==d&&(u=d=1),f=x.slice()),(p=f.length)<E&&f.unshift(0),r(y,f,E,l),-1==u&&(E=y.length,(u=t(x,y,S,E))<1&&(d++,r(y,S<E?T:x,E,l))),E=y.length):0===u&&(d++,y=[0]),_[h++]=d,u&&y[0]?y[E++]=w[I]||0:(y=[w[I]],E=1);while((I++<A||void 0!==y[0])&&R--)g=void 0!==y[0]}_[0]||_.shift()}if(1==m)C.e=c,rt=g;else{for(h=1,d=_[0];d>=10;d/=10)h++;C.e=h+c*m-1,rS(C,o?s+C.e+1:s,a,g)}return C}}();function rS(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor;e:if(null!=t){if(!(h=e.d))return e;for(i=1,o=h[0];o>=10;o/=10)i++;if((s=t-i)<0)s+=7,a=t,l=(c=h[d=0])/rg(10,i-a-1)%10|0;else if((d=Math.ceil((s+1)/7))>=(o=h.length)){if(n){for(;o++<=d;)h.push(0);c=l=0,i=1,s%=7,a=s-7+1}else break e}else{for(c=o=h[d],i=1;o>=10;o/=10)i++;s%=7,l=(a=s-7+i)<0?0:c/rg(10,i-a-1)%10|0}if(n=n||t<0||void 0!==h[d+1]||(a<0?c:c%rg(10,i-a-1)),u=r<4?(l||n)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||n||6==r&&(s>0?a>0?c/rg(10,i-a):0:h[d-1])%10&1||r==(e.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=e.e+1,h[0]=rg(10,(7-t%7)%7),e.e=-t||0):h[0]=e.e=0,e;if(0==s?(h.length=d,o=1,d--):(h.length=d+1,o=rg(10,7-s),h[d]=a>0?(c/rg(10,i-a)%rg(10,a)|0)*o:0),u)for(;;)if(0==d){for(s=1,a=h[0];a>=10;a/=10)s++;for(a=h[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(e.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[d]+=o,1e7!=h[d])break;h[d--]=0,o=1}for(s=h.length;0===h[--s];)h.pop()}return ro&&(e.e>m.maxE?(e.d=null,e.e=NaN):e.e<m.minE&&(e.e=0,e.d=[0])),e}function rT(e,t,r){if(!e.isFinite())return rF(e);var n,i=e.e,s=rR(e.d),a=s.length;return t?(r&&(n=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+rU(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+rU(-i-1)+s,r&&(n=r-a)>0&&(s+=rU(n))):i>=a?(s+=rU(i+1-a),r&&(n=r-i-1)>0&&(s=s+"."+rU(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),r&&(n=r-a)>0&&(i+1===a&&(s+="."),s+=rU(n))),s}function rO(e,t){var r=e[0];for(t*=7;r>=10;r/=10)t++;return t}function rM(e,t,r){if(t>ry)throw ro=!0,r&&(e.precision=r),Error(rc);return rS(new e(ri),t,1,!0)}function rw(e,t,r){if(t>rE)throw Error(rc);return rS(new e(rs),t,r,!0)}function rx(e){var t=e.length-1,r=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function rU(e){for(var t="";e--;)t+="0";return t}function rD(e,t,r,n){var i,s=new e(1),a=Math.ceil(n/7+4);for(ro=!1;;){if(r%2&&rG((s=s.times(t)).d,a)&&(i=!0),0===(r=rm(r/2))){r=s.d.length-1,i&&0===s.d[r]&&++s.d[r];break}rG((t=t.times(t)).d,a)}return ro=!0,s}function rV(e){return 1&e.d[e.d.length-1]}function rL(e,t,r){for(var n,i=new e(t[0]),s=0;++s<t.length;)if((n=new e(t[s])).s)i[r](n)&&(i=n);else{i=n;break}return i}function rP(e,t){var r,n,i,s,a,o,l,u=0,c=0,h=0,d=e.constructor,m=d.rounding,g=d.precision;if(!e.d||!e.d[0]||e.e>17)return new d(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(ro=!1,l=g):l=t,o=new d(.03125);e.e>-2;)e=e.times(o),h+=5;for(l+=n=Math.log(rg(2,h))/Math.LN10*2+5|0,r=s=a=new d(1),d.precision=l;;){if(s=rS(s.times(e),l,1),r=r.times(++c),rR((o=a.plus(rv(s,r,l,1))).d).slice(0,l)===rR(a.d).slice(0,l)){for(i=h;i--;)a=rS(a.times(a),l,1);if(null!=t)return d.precision=g,a;if(!(u<3&&rI(a.d,l-n,m,u)))return rS(a,d.precision=g,m,ro=!0);d.precision=l+=10,r=s=o=new d(1),c=0,u++}a=o}}function rj(e,t){var r,n,i,s,a,o,l,u,c,h,d,m=1,g=e,f=g.d,p=g.constructor,C=p.rounding,_=p.precision;if(g.s<0||!f||!f[0]||!g.e&&1==f[0]&&1==f.length)return new p(f&&!f[0]?-1/0:1!=g.s?NaN:f?0:g);if(null==t?(ro=!1,c=_):c=t,p.precision=c+=10,n=(r=rR(f)).charAt(0),!(15e14>Math.abs(s=g.e)))return u=rM(p,c+2,_).times(s+""),g=rj(new p(n+"."+r.slice(1)),c-10).plus(u),p.precision=_,null==t?rS(g,_,C,ro=!0):g;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=rR((g=g.times(e)).d)).charAt(0),m++;for(s=g.e,n>1?(g=new p("0."+r),s++):g=new p(n+"."+r.slice(1)),h=g,l=a=g=rv(g.minus(1),g.plus(1),c,1),d=rS(g.times(g),c,1),i=3;;){if(a=rS(a.times(d),c,1),rR((u=l.plus(rv(a,new p(i),c,1))).d).slice(0,c)===rR(l.d).slice(0,c)){if(l=l.times(2),0!==s&&(l=l.plus(rM(p,c+2,_).times(s+""))),l=rv(l,new p(m),c,1),null!=t)return p.precision=_,l;if(!rI(l.d,c-10,C,o))return rS(l,p.precision=_,C,ro=!0);p.precision=c+=10,u=a=g=rv(h.minus(1),h.plus(1),c,1),d=rS(g.times(g),c,1),i=o=1}l=u,i+=2}}function rF(e){return String(e.s*e.s/0)}function rk(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;48===t.charCodeAt(n);n++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(n,i)){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%7,r<0&&(n+=7),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=7;n<i;)e.d.push(+t.slice(n,n+=7));n=7-(t=t.slice(n)).length}else n-=i;for(;n--;)t+="0";e.d.push(+t),ro&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function rB(e,t,r,n,i){var s,a,o,l,u=e.precision,c=Math.ceil(u/7);for(ro=!1,l=r.times(r),o=new e(n);;){if(a=rv(o.times(l),new e(t++*t++),u,1),o=i?n.plus(a):n.minus(a),n=rv(a.times(l),new e(t++*t++),u,1),void 0!==(a=o.plus(n)).d[c]){for(s=c;a.d[s]===o.d[s]&&s--;);if(-1==s)break}s=o,o=n,n=a,a=s}return ro=!0,a.d.length=c+1,a}function r$(e,t){for(var r=e;--t;)r*=e;return r}function rH(e,t){var r,n=t.s<0,i=rw(e,e.precision,1),s=i.times(.5);if((t=t.abs()).lte(s))return rr=n?4:1,t;if((r=t.divToInt(i)).isZero())rr=n?3:2;else{if((t=t.minus(r.times(i))).lte(s))return rr=rV(r)?n?2:3:n?4:1,t;rr=rV(r)?n?1:4:n?3:2}return t.minus(i).abs()}function rW(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor,g=void 0!==r;if(g?(rN(r,1,1e9),void 0===n?n=m.rounding:rN(n,0,8)):(r=m.precision,n=m.rounding),e.isFinite()){for(a=(c=rT(e)).indexOf("."),g?(i=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):i=t,a>=0&&(c=c.replace(".",""),(d=new m(1)).e=c.length-a,d.d=rA(rT(d),10,i),d.e=d.d.length),s=l=(h=rA(c,10,i)).length;0==h[--l];)h.pop();if(h[0]){if(a<0?s--:((e=new m(e)).d=h,e.e=s,h=(e=rv(e,d,r,n,0,i)).d,s=e.e,u=rt),a=h[r],o=i/2,u=u||void 0!==h[r+1],u=n<4?(void 0!==a||u)&&(0===n||n===(e.s<0?3:2)):a>o||a===o&&(4===n||u||6===n&&1&h[r-1]||n===(e.s<0?8:7)),h.length=r,u)for(;++h[--r]>i-1;)h[r]=0,r||(++s,h.unshift(1));for(l=h.length;!h[l-1];--l);for(a=0,c="";a<l;a++)c+=rn.charAt(h[a]);if(g){if(l>1){if(16==t||8==t){for(a=16==t?4:3,--l;l%a;l++)c+="0";for(l=(h=rA(c,i,t)).length;!h[l-1];--l);for(a=1,c="1.";a<l;a++)c+=rn.charAt(h[a])}else c=c.charAt(0)+"."+c.slice(1)}c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}else c=g?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=rF(e);return e.s<0?"-"+c:c}function rG(e,t){if(e.length>t)return e.length=t,!0}function rY(e){return new this(e).abs()}function rz(e){return new this(e).acos()}function rq(e){return new this(e).acosh()}function rX(e,t){return new this(e).plus(t)}function rK(e){return new this(e).asin()}function rQ(e){return new this(e).asinh()}function rZ(e){return new this(e).atan()}function rJ(e){return new this(e).atanh()}function r0(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,s=n+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?rw(this,n,i):new this(0)).s=e.s:!e.d||t.isZero()?(r=rw(this,s,1).times(.5)).s=e.s:t.s<0?(this.precision=s,this.rounding=1,r=this.atan(rv(e,t,s,1)),t=rw(this,s,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(rv(e,t,s,1)):(r=rw(this,s,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function r1(e){return new this(e).cbrt()}function r2(e){return rS(e=new this(e),e.e+1,2)}function r5(e,t,r){return new this(e).clamp(t,r)}function r3(e){if(!e||"object"!=typeof e)throw Error(rl+"Object expected");var t,r,n,i=!0===e.defaults,s=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<s.length;t+=3)if(r=s[t],i&&(this[r]=ra[r]),void 0!==(n=e[r])){if(rm(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(ru+r+": "+n)}if(r="crypto",i&&(this[r]=ra[r]),void 0!==(n=e[r])){if(!0===n||!1===n||0===n||1===n){if(n){if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(rh)}else this[r]=!1}else throw Error(ru+r+": "+n)}return this}function r4(e){return new this(e).cos()}function r6(e){return new this(e).cosh()}function r9(e,t){return new this(e).div(t)}function r7(e){return new this(e).exp()}function r8(e){return rS(e=new this(e),e.e+1,3)}function ne(){var e,t,r=new this(0);for(ro=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return ro=!0,new this(1/0);r=t}return ro=!0,r.sqrt()}function nt(e){return e instanceof nR||e&&e.toStringTag===rd||!1}function nr(e){return new this(e).ln()}function nn(e,t){return new this(e).log(t)}function ni(e){return new this(e).log(2)}function ns(e){return new this(e).log(10)}function na(){return rL(this,arguments,"lt")}function no(){return rL(this,arguments,"gt")}function nl(e,t){return new this(e).mod(t)}function nu(e,t){return new this(e).mul(t)}function nc(e,t){return new this(e).pow(t)}function nh(e){var t,r,n,i,s=0,a=new this(1),o=[];if(void 0===e?e=this.precision:rN(e,1,1e9),n=Math.ceil(e/7),this.crypto){if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));s<n;)(i=t[s])>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);s<n;)(i=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((127&t[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,s):(o.push(i%1e7),s+=4);s=n/4}else throw Error(rh)}else for(;s<n;)o[s++]=1e7*Math.random()|0;for(n=o[--s],e%=7,n&&e&&(i=rg(10,7-e),o[s]=(n/i|0)*i);0===o[s];s--)o.pop();if(s<0)r=0,o=[0];else{for(r=-1;0===o[0];r-=7)o.shift();for(n=1,i=o[0];i>=10;i/=10)n++;n<7&&(r-=7-n)}return a.e=r,a.d=o,a}function nd(e){return rS(e=new this(e),e.e+1,this.rounding)}function nm(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function ng(e){return new this(e).sin()}function nf(e){return new this(e).sinh()}function np(e){return new this(e).sqrt()}function nC(e,t){return new this(e).sub(t)}function n_(){var e=0,t=arguments,r=new this(t[0]);for(ro=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return ro=!0,rS(r,this.precision,this.rounding)}function ny(e){return new this(e).tan()}function nE(e){return new this(e).tanh()}function nb(e){return rS(e=new this(e),e.e+1,1)}rb[Symbol.for("nodejs.util.inspect.custom")]=rb.toString,rb[Symbol.toStringTag]="Decimal";var nR=rb.constructor=function e(t){var r,n,i;function s(e){var t,r,n;if(!(this instanceof s))return new s(e);if(this.constructor=s,nt(e)){this.s=e.s,ro?!e.d||e.e>s.maxE?(this.e=NaN,this.d=null):e.e<s.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(n=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;ro?t>s.maxE?(this.e=NaN,this.d=null):t<s.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return rk(this,e.toString())}if("string"!==n)throw Error(ru+e);return 45===(r=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===r&&(e=e.slice(1)),this.s=1),r_.test(e)?rk(this,e):function(e,t){var r,n,i,s,a,o,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),r_.test(t))return rk(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(rp.test(t))r=16,t=t.toLowerCase();else if(rf.test(t))r=2;else if(rC.test(t))r=8;else throw Error(ru+t);for((s=t.search(/p/i))>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),a=(s=t.indexOf("."))>=0,n=e.constructor,a&&(s=(o=(t=t.replace(".","")).length)-s,i=rD(n,new n(r),s,2*s)),s=c=(u=rA(t,r,1e7)).length-1;0===u[s];--s)u.pop();return s<0?new n(0*e.s):(e.e=rO(u,c),e.d=u,ro=!1,a&&(e=rv(e,i,4*o)),l&&(e=e.times(54>Math.abs(l)?rg(2,l):nR.pow(2,l))),ro=!0,e)}(this,e)}if(s.prototype=rb,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=r3,s.clone=e,s.isDecimal=nt,s.abs=rY,s.acos=rz,s.acosh=rq,s.add=rX,s.asin=rK,s.asinh=rQ,s.atan=rZ,s.atanh=rJ,s.atan2=r0,s.cbrt=r1,s.ceil=r2,s.clamp=r5,s.cos=r4,s.cosh=r6,s.div=r9,s.exp=r7,s.floor=r8,s.hypot=ne,s.ln=nr,s.log=nn,s.log10=ns,s.log2=ni,s.max=na,s.min=no,s.mod=nl,s.mul=nu,s.pow=nc,s.random=nh,s.round=nd,s.sign=nm,s.sin=ng,s.sinh=nf,s.sqrt=np,s.sub=nC,s.sum=n_,s.tan=ny,s.tanh=nE,s.trunc=nb,void 0===t&&(t={}),t&&!0!==t.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<i.length;)t.hasOwnProperty(n=i[r++])||(t[n]=this[n]);return s.config(t),s}(ra);function nN(e,t){let r=e*t;return Number.isSafeInteger(r)?r:new nR(e).mul(t).toNumber()}function nI(e,t){let r=10**Math.trunc(t),n=nS(e,r);return Math.round(nN(e,r)+n)/r}function nA(e,t){let r=10**Math.trunc(t),n=nS(e,r);return Math.floor(nN(e,r)+n)/r}function nv(e,t){let r=10**Math.trunc(t),n=nS(e,r);return Math.ceil(nN(e,r)-n)/r}function nS(e,t){return Number.EPSILON*Math.max(1,Math.abs(nN(e,t)))}function nT(e,t){return e-t*Math.floor(e/t)}function nO(e,t=15){return Number.parseFloat(e.toPrecision(t))}function nM(e,t=12,r=1e-10){let n=nO(e,t);return!function(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}(e,n,r)?nO(e):n}ri=new nR(ri),rs=new nR(rs);let nw=class e extends t0{static create(){return this._instance=this._instance||new e(0),this._instance}isNull(){return!0}plus(e){return nV.create(0).plus(e)}minus(e){return nV.create(0).minus(e)}multiply(e){return nV.create(0).multiply(e)}divided(e){return nV.create(0).divided(e)}mod(e){return nV.create(0).mod(e)}compare(e,t){return e.isString()?nP.create("").compare(e,t):e.isBoolean()?nD.create(!1).compare(e,t):nV.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(nP.create("")):nP.create(this.concatenate(e.getValue(),q.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(nP.create("")):nP.create(this.concatenate(e.getValue(),q.BACK))}plusBy(e){return nV.create(0).plusBy(e)}minusBy(e){return nV.create(0).minusBy(e)}multiplyBy(e){return nV.create(0).multiplyBy(e)}dividedBy(e){return nV.create(0).dividedBy(e)}compareBy(e,t){return"string"==typeof e?nP.create("").compareBy(e,t):"boolean"==typeof e?nD.create(!1).compareBy(e,t):nV.create(0).compareBy(e,t)}pow(e){return nV.create(0).pow(e)}sqrt(){return nV.create(0).sqrt()}cbrt(){return nV.create(0).cbrt()}cos(){return nV.create(0).cos()}cosh(){return nV.create(0).cosh()}acos(){return nV.create(0).acos()}acosh(){return nV.create(0).acosh()}sin(){return nV.create(0).sin()}sinh(){return nV.create(0).sinh()}asin(){return nV.create(0).asin()}asinh(){return nV.create(0).asinh()}tan(){return nV.create(0).tan()}tanh(){return nV.create(0).tanh()}atan(){return nV.create(0).atan()}atan2(e){return nV.create(0).atan2(e)}atanh(){return nV.create(0).atanh()}log(){return t2.create(X.NUM)}log10(){return t2.create(X.NUM)}exp(){return nV.create(0).exp()}abs(){return nV.create(0).abs()}round(e){return nV.create(0).round(e)}floor(e){return nV.create(0).floor(e)}ceil(e){return nV.create(0).ceil(e)}convertToNumberObjectValue(){return nV.create(0)}convertToBooleanObjectValue(){return nD.create(!1)}};G(nw,"_instance");let nx=nw,nU=class e extends t0{constructor(e){super(e),G(this,"_value",!1),this._value=e}static create(t){return t?(this._instanceTrue=this._instanceTrue||new e(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new e(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){let e=this.getValue(),t=0;return e&&(t=1),nV.create(-t)}getReciprocal(){return this.getValue()?nV.create(1):t2.create(X.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,re(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(t,r){let n=!1;if("string"==typeof t||"number"==typeof t)n=this._compareString(r);else if("boolean"==typeof t){let e=nV.create(t?1:0);return this._convertToNumber().compare(e,r)}return e.create(n)}_compareString(e){switch(e){case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:return!0;case ee.EQUALS:case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:case ee.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){let e=this.getValue(),t=0;return e&&(t=1),nV.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return nF(this.getValue())}convertToBooleanObjectValue(){return this}};G(nU,"_instanceTrue"),G(nU,"_instanceFalse");let nD=nU;class nV extends t0{constructor(e){super(e),G(this,"_value",0),this._value=Number(e)}static create(e,t=""){let r=new nV(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return nV.create(0).minus(this)}getReciprocal(){return nV.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=this.plusBy(e.getValue());if(t.isError())return t;let r=tz(this.getPattern(),e.getPattern(),J.PLUS);return nV.create(Number(t.getValue()),r)}equalZero(){return 0===this._value}minus(e){if(e.isArray()){let t=e.getNegative();return t.isError()?t:t.plus(this)}let t=this.minusBy(e.getValue());if(t.isError())return t;let r=tz(this.getPattern(),e.getPattern(),J.MINUS);return nV.create(Number(t.getValue()),r)}multiply(e){if(e.isArray())return e.multiply(this);let t=this.multiplyBy(e.getValue());if(t.isError())return t;let r=tz(this.getPattern(),e.getPattern(),J.MULTIPLY);return nV.create(Number(t.getValue()),r)}divided(e){if(e.isArray()){let t=e.getReciprocal();return t.isError()?t:t.multiply(this)}let t=this.dividedBy(e.getValue());if(t.isError())return t;let r=tz(this.getPattern(),e.getPattern(),J.DIVIDED);return nV.create(Number(t.getValue()),r)}mod(e){if(e.isArray())return e.modInverse(this);let t=this.getValue(),r=e.getValue();if(e.isNull())return t2.create(X.DIV_BY_ZERO);if("string"==typeof r)return t2.create(X.VALUE);if("number"==typeof r){if(0===r)return t2.create(X.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||11259e8*Math.abs(r)<=Math.abs(t))return t2.create(X.NUM);let e=nT(t,r);return Number.isFinite(e)?nV.create(e):t2.create(X.NUM)}if("boolean"==typeof r){let e=r?1:0;return 0===e?t2.create(X.DIV_BY_ZERO):nV.create(nT(t,e))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nP.create(this.concatenate(e.getValue(),q.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nP.create(this.concatenate(e.getValue(),q.BACK))}compare(e,t){return e.isArray()?e.compare(this,re(t)):this.compareBy(e.getValue(),t)}plusBy(e){let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return t2.create(X.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let n=function(e,t){let r=e+t;return Number.isSafeInteger(r)?r:new nR(e).add(t).toNumber()}(t,r);return Number.isFinite(n)?nV.create(n):t2.create(X.NUM)}minusBy(e){let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return t2.create(X.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let n=function(e,t){let r=e-t;return Number.isSafeInteger(r)?r:new nR(e).sub(t).toNumber()}(t,r);return Number.isFinite(n)?nV.create(n):t2.create(X.NUM)}multiplyBy(e){let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return t2.create(X.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let n=nN(t,r);return Number.isFinite(n)?nV.create(n):t2.create(X.NUM)}dividedBy(e){let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return t2.create(X.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);if(0===r)return t2.create(X.DIV_BY_ZERO);let n=function(e,t){let r=e/t;return Number.isSafeInteger(r)?r:new nR(e).div(t).toNumber()}(t,r);return Number.isFinite(n)?nV.create(n):t2.create(X.NUM)}compareBy(e,t){let r=this.getValue(),n=!1;return"string"==typeof e?n=this._compareString(t):"number"==typeof e?n=this._compareNumber(r,e,t):"boolean"==typeof e&&(n=this._compareBoolean(t)),nD.create(n)}_compareString(e){switch(e){case ee.EQUALS:case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:return!1;case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:case ee.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return Number.isFinite(e)&&Number.isFinite(t)?this._compareFiniteNumber(e,t,r):this._compareInfinity(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case ee.EQUALS:return e===t;case ee.GREATER_THAN:return e>t;case ee.GREATER_THAN_OR_EQUAL:return e>=t;case ee.LESS_THAN:return e<t;case ee.LESS_THAN_OR_EQUAL:return e<=t;case ee.NOT_EQUAL:return e!==t}}_compareBoolean(e){switch(e){case ee.EQUALS:case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:return!1;case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:case ee.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;let t=this.getValue(),r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;let n=+r.getValue();if(Number.isNaN(n))return t2.create(X.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return t2.create(X.NUM);if(0===t)return n<0?t2.create(X.DIV_BY_ZERO):0===n?t2.create(X.NUM):nV.create(0);let i=t**n;return Number.isFinite(i)?nV.create(i):t2.create(X.NUM)}sqrt(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.sqrt(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}cbrt(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.cbrt(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}cos(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.cos(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}cosh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.cosh(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}acos(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.acos(e);return Number.isNaN(t)?t2.create(X.NUM):nV.create(t)}acosh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.acosh(e);return Number.isNaN(t)?t2.create(X.NUM):nV.create(t)}sin(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.sin(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}sinh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.sinh(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}asin(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.asin(e);return Number.isNaN(t)?t2.create(X.NUM):nV.create(t)}asinh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.asinh(e);return Number.isNaN(t)?t2.create(X.NUM):nV.create(t)}tan(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.tan(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}tanh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.tanh(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}atan(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.atan(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return t2.create(X.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);if(0===t&&0===r)return t2.create(X.DIV_BY_ZERO);let e=Math.atan2(t,r);return Number.isFinite(e)?nV.create(e):t2.create(X.NUM)}return"boolean"==typeof r?nV.create(Math.atan2(t,r?1:0)):this}atanh(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.atanh(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}log(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return t2.create(X.NUM);let t=Math.log(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}log10(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return t2.create(X.NUM);let t=Math.log10(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}exp(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.exp(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}abs(){let e=this.getValue();if(!Number.isFinite(e))return t2.create(X.NUM);let t=Math.abs(e);return Number.isFinite(t)?nV.create(t):t2.create(X.NUM)}round(e){if(e.isArray())return e.roundInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return t2.create(X.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let e=t<0?-nI(Math.abs(t),r):nI(t,r);return Number.isFinite(e)?nV.create(e):t2.create(X.NUM)}return"boolean"==typeof r?nV.create(nI(t,r?1:0)):this}floor(e){if(e.isArray())return e.floorInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return t2.create(X.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let e=t<0?-nA(Math.abs(t),r):nA(t,r);return Number.isFinite(e)?nV.create(e):t2.create(X.NUM)}return"boolean"==typeof r?nV.create(nA(t,r?1:0)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return t2.create(X.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return t2.create(X.NUM);let e=t<0?-nv(Math.abs(t),r):nv(t,r);return Number.isFinite(e)?nV.create(e):t2.create(X.NUM)}return"boolean"==typeof r?nV.create(nv(t,r?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return nj(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case ee.EQUALS:n=e===t;break;case ee.GREATER_THAN:n=e>t;break;case ee.GREATER_THAN_OR_EQUAL:n=e>=t;break;case ee.LESS_THAN:n=e<t;break;case ee.LESS_THAN_OR_EQUAL:n=e<=t;break;case ee.NOT_EQUAL:n=e!==t}return n}}let nL=new tl(1e5);class nP extends t0{constructor(e){super(e),G(this,"_value"),this._value=e}static create(e){let t=nL.get(e);if(t)return t;let r=new nP(e);return nL.set(e,r),r}getValue(){return this._value}isString(){return!0}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nP.create(this.concatenate(e.getValue(),q.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nP.create(this.concatenate(e.getValue(),q.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,re(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),i=!1;if("string"==typeof e){var s;let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),(s=a).indexOf("*")>-1||s.indexOf("?")>-1)return this._checkWildcard(a,t);i=this._compareString(n,a,t)}else"number"==typeof e?i=this._compareNumber(t):"boolean"==typeof e&&(i=this._compareBoolean(t));return nD.create(i)}_compareString(e,t,r){switch(r){case ee.EQUALS:return e===t;case ee.GREATER_THAN:return e>t;case ee.GREATER_THAN_OR_EQUAL:return e>=t;case ee.LESS_THAN:return e<t;case ee.LESS_THAN_OR_EQUAL:return e<=t;case ee.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case ee.NOT_EQUAL:case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:return!0;case ee.EQUALS:case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case ee.EQUALS:case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:return!1;case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:case ee.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return nF(this.getValue())}convertToBooleanObjectValue(){return nD.create(!0)}_checkWildcard(e,t){let r=function(e,t,r){let n=!1;switch(r){case ee.EQUALS:n=t6(e,t);break;case ee.NOT_EQUAL:n=!t6(e,t);break;case ee.GREATER_THAN:case ee.GREATER_THAN_OR_EQUAL:n=t6(e,t)||e>t9(t);break;case ee.LESS_THAN:case ee.LESS_THAN_OR_EQUAL:n=e<t9(t)}return n}(this.getValue().toLocaleLowerCase(),e,t);return nD.create(r)}}function nj(e){if("boolean"==typeof e)return nD.create(e);let t=!1;if("string"==typeof e){let r=e.toLocaleUpperCase();r===Y.TRUE?t=!0:r===Y.FALSE&&(t=!1)}else t=1===e;return nD.create(t)}function nF(e,t=""){if("boolean"==typeof e){let r=0;return e&&(r=1),nV.create(r,t)}return"number"==typeof e?Number.isFinite(e)?nV.create(e,t):t2.create(X.NUM):(0,k.isRealNum)(e)?nV.create(Number(e),t):t2.create(X.VALUE)}function nk(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];t[r][e]=n$.create(i)}}return t}class nB extends t0{constructor(e){super("string"==typeof e?e:""),G(this,"_values",[]),G(this,"_rowCount",-1),G(this,"_columnCount",-1),G(this,"_unitId",""),G(this,"_sheetId",""),G(this,"_currentRow",-1),G(this,"_currentColumn",-1),G(this,"_sliceCache",/* @__PURE__ */new Map),G(this,"_flattenCache"),G(this,"_defaultValue",null),G(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(e){return new nB(e)}static createByArray(e){return new nB({calculateValueList:nk(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1})}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return(null==(r=this._values[e])?void 0:r[t])||this._defaultValue}getRealValue(e,t){let r=this._values[e];if(null==r)return null;let n=r[t];return null==n?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){return{startRow:0,endRow:this.getRowCount()-1,startColumn:0,endColumn:this.getColumnCount()-1}}iterator(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=r;o<=n;o++)for(let r=i;r<=s;r++)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}iteratorReverse(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=n;o>=r;o--)for(let r=s;r>=i;r--)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nx.create()}getLastCell(){let{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nx.create()}pick(e){let t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){let t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[nx.create()]];let n=[];n[0]=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.get(i,t);if(!(null==r||r.isError())&&!0===r.getValue()){let e=this.get(i,t);n[0].push(e)}}return n}flatten(){if(null!=this._flattenCache)return this._flattenCache;let e=[];e[0]=[];for(let t=0;t<this._rowCount;t++)for(let r=0;r<this._columnCount;r++){let n=this.get(t,r);e[0].push(n)}let t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(null!=this._flattenPosition)return this._flattenPosition;let e=[],t=[],r=[],n=[],i=0;for(let s=0;s<this._rowCount;s++)for(let a=0;a<this._columnCount;a++){let o=this.get(s,a);if(null==o||o.isError()||o.isNull()){i++;continue}o.isString()?(e.push(o),r.push(i++)):(t.push(o),n.push(i++))}let s={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=s,s}slice(e,t){let r=0,n=this._rowCount,i=1,s=0,a=this._columnCount,o=1;if(null!=e&&(r=e[0]||0,n=e[1]||this._rowCount,i=e[2]||1),null!=t&&(s=t[0]||0,a=t[1]||this._columnCount,o=t[2]||1),r>=this._rowCount||s>=this._columnCount)return;let l=`${r}_${n}_${i}_${s}_${a}_${o}`,u=this._sliceCache.get(l);if(null!=u)return u;let c=[],h=this._values,d=0,m=0;for(let e=r;e<n;e+=i){m=0,null==c[d]&&(c[d]=[]);for(let t=s;t<a;t+=o){if(!h[e])return;let r=h[e][t]||this._defaultValue;null==r&&(r=nx.create()),c[d][m]=r,m++}d++}if(0===c.length||0===c[0].length)return;let g=i>1?-1:r+this._currentRow,f=o>1?-1:s+this._currentColumn,p=this._createNewArray(c,c.length,c[0].length,g,f);return p.setDefaultValue(this._defaultValue),this._sliceCache.set(l,p),p}sortByRow(e){let t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){let e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=t3.MIN,r=!1,n=!1){let i,s,a,o;let l=(r,l,u)=>{let c;return null==r||((null==(c=!0===n?r.compare(e,ee.EQUALS):r.isEqual(e))?void 0:c.getValue())===!0?(i=r,a={row:l,column:u},!1):void(t===t3.MAX?!0===r.isGreaterThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u}):t===t3.MIN&&!0===r.isLessThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u})))};return(r?this.iteratorReverse((e,t,r)=>l(e,t,r)):this.iterator((e,t,r)=>l(e,t,r)),null!=i)?a:null!=s?o:void 0}binarySearch(e,t=t5.MIN,r=t3.MIN){if(e.isError())return;let{stringArray:n,stringPosition:i,numberArray:s,numberPosition:a}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,i,t,r):this._binarySearch(e,s,a,t,r)}_binarySearch(e,t,r,n=t5.MIN,i=t3.MIN){let s=t4(),a=Number(e.getValue()),o=!Number.isNaN(a),l=0,u=t.length-1,c=-1,h=-1,d=-1;for(;l<=u;){let r;let i=Math.floor((l+u)/2),m=t[i];if(m.isNull())r=n===t5.MIN?1:-1;else{let t=m.getValue();if(o){let e=Number(t);r=Number.isNaN(e)?1:Math.sign(e-a)}else r=s(t.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===t5.MAX&&(r=-r),0===r){c=i;break}r<0?(h=i,l=i+1):(d=i,u=i-1)}return i===t3.NORMAL?-1!==c?r[c]:void 0:i===t3.MIN?-1!==c?r[c]:n===t5.MIN?r[h]:r[d]:i===t3.MAX?-1!==c?r[c]:n===t5.MIN?r[d]:r[h]:void 0}sum(){let e=nV.create(0);return this.iterator(t=>!!(null==t||t.isString()||t.isBoolean()||t.isNull())||(t.isError()?(e=t,!1):void(e=e.plus(t)))),e}max(){let e=nV.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isLessThan(t).getValue()&&(e=t)))),e}min(){let e=nV.create(Number.POSITIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isGreaterThan(t).getValue()&&(e=t)))),e}count(){let e=nV.create(0);return this.iterator(t=>{if(null==t||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=nV.create(0);return this.iterator(t=>{if(null==t||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=nV.create(0);return this.iterator(t=>{(null==t||t.isNull()||""===t.getValue())&&(e=e.plusBy(1))}),e}getNegative(){return nB.create("{0}").minus(this)}getReciprocal(){return nB.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){return this.mapValue((t,r,n)=>null==t?nx.create():t.isError()?t:e(t,r,n))}mapValue(e){var t;let r=this._rowCount,n=this._columnCount,i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=null==(t=this._values)?void 0:t[s];if(null==n)r[i]=t2.create(X.VALUE);else{let t=n[i]||this._defaultValue;t?r[i]=e(t,s,i):r[i]=nx.create()}}i.push(r)}return this._createNewArray(i,r,n)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){let t=this.sum(),r=this.count();return t.divided(0===e?r:r.minusBy(1))}median(){let e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||nx.create();if(t.sortByRow(0),r%2==0){let e=t.get(0,r/2)||nx.create(),n=t.get(0,r/2-1)||nx.create();return e.plus(n).divided(nV.create(2))}return t.get(0,(r-1)/2)||nx.create()}var(e=0){let t=this.mean(),r=[[]];this.iterator(e=>{if(null==e||e.isError()||e.isString()||e.isBoolean()||e.isNull())return;let n=e.minus(t).pow(nV.create(2));n.isError()||r[0].push(n)});let{_unitId:n,_sheetId:i,_currentRow:s,_currentColumn:a}=this;return nB.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:i,row:s,column:a}).mean(e)}std(e=0){let t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return function(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];null==i?t[r][e]=null:i.isError()?t[r][e]=i.getErrorType():t[r][e]=i.getValue()}}return t}(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){let t=t4();return(r,n)=>{let i=r[e],s=n[e];return null==i?1:null==s?-1:i.isError()&&i.isError()?0:i.isError()?1:s.isError()?-1:t(i.getValue(),s.getValue())}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_batchOperator(e,t,r,n){let i=[],s=this._rowCount,a=this._columnCount;if(e.isArray()){let o=e.getRowCount(),l=e.getColumnCount();if(s=Math.max(o,s),a=Math.max(l,a),1===o&&1===l){let t=e.getFirstCell();for(let e=0;e<a;e++)i.push(t)}else{if(1!==o||!(this._columnCount>1))return this._batchOperatorArray(e,t,r,n);let s=e.getArrayValue();for(let e=0;e<a;e++)i.push(s[0][e])}}else for(let t=0;t<a;t++)i.push(e);let o=[];for(let e=0;e<a;e++){let s=i[e];this._batchOperatorValue(s,e,o,t,r,n)}let l=this._createNewArray(o,s,a);return l.setDefaultValue(nD.create(!1)),l}_batchOperatorValue(e,t,r,n,i,s){let a=this._rowCount,o=this.getUnitId(),l=this.getSheetId(),u=this.getCurrentRow(),c=this.getCurrentColumn();if(5===n){let{rowsInCache:h,rowsNotInCache:d}=tO.canUseCache(o,l,t+c,u,u+a-1);if(h.length>0){if(i===ee.EQUALS){let n=tO.getCellPositions(o,l,t+c,e.getValue(),h);null!=n&&n.forEach(e=>{if(e<u||e>u+a-1)return;let n=e-u;null==r[n]&&(r[n]=[]),r[n][t]=nD.create(!0)})}else{let n=tO.getCellValuePositions(o,l,t+c);null!=n&&n.forEach((n,o)=>{let l,c=nx.create();K.has(o)?c=t2.create(o):"string"==typeof o?c=nP.create(o):"number"==typeof o?c=nV.create(o):"boolean"==typeof o&&(c=nD.create(o)),((l=c.isError()?c:e.isError()?e:c.compare(e,i,s)).isError()||!0===l.getValue())&&n.forEach(e=>{e>=u&&e<=u+a-1&&(null==r[e-u]&&(r[e-u]=[]),r[e-u][t]=l)})})}if(d.length>0)for(let a of d){let[h,d]=a;for(let a=h;a<=d;a++)this.__batchOperatorRowValue(e,t,r,n,a-u,o,l,u,c,i,s);tO.setContinueBuildingCache(o,l,t+c,h,d)}return}}for(let h=0;h<a;h++)this.__batchOperatorRowValue(e,t,r,n,h,o,l,u,c,i,s);tO.setContinueBuildingCache(o,l,t+c,u,u+a-1)}__batchOperatorRowValue(e,t,r,n,i,s,a,o,l,u,c){let h=this.getValueOrDefault(i,t);if(null==r[i]&&(r[i]=[]),h&&e){if(h.isError())r[i][t]=h;else if(e.isError())r[i][t]=e;else switch(n){case 1:r[i][t]=h.plus(e);break;case 0:r[i][t]=h.minus(e);break;case 2:r[i][t]=h.multiply(e);break;case 3:r[i][t]=h.divided(e);break;case 4:r[i][t]=h.mod(e);break;case 5:u?r[i][t]=h.compare(e,u,c):r[i][t]=t2.create(X.VALUE);break;case 6:r[i][t]=h.concatenateFront(e);break;case 7:r[i][t]=h.concatenateBack(e);break;case 8:r[i][t]=h.pow(e);break;case 9:r[i][t]=h.round(e);break;case 10:r[i][t]=h.floor(e);break;case 12:r[i][t]=h.atan2(e);break;case 11:r[i][t]=h.ceil(e)}}else r[i][t]=t2.create(X.NA);null!=h&&(h.isError()?tO.set(s,a,t+l,h.getErrorType(),i+o):tO.set(s,a,t+l,h.getValue(),i+o))}_batchOperatorArray(e,t,r,n){let i=e.getRowCount(),s=e.getColumnCount();i<this._rowCount&&(i=this._rowCount),s<this._columnCount&&(s=this._columnCount);let a=[],o=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let u=0;u<i;u++){let i=[];for(let a=0;a<s;a++){let s,c;if(s=3===o?this.getValueOrDefault(0,0):1===o?this.getValueOrDefault(0,a):2===o?this.getValueOrDefault(u,0):this.getValueOrDefault(u,a),c=3===l?e.getValueOrDefault(0,0):1===l?e.getValueOrDefault(0,a):2===l?e.getValueOrDefault(u,0):e.getValueOrDefault(u,a),s&&c){if(s.isError())i[a]=s;else if(c.isError())i[a]=c;else switch(t){case 1:i[a]=s.plus(c);break;case 0:i[a]=s.minus(c);break;case 2:i[a]=s.multiply(c);break;case 3:i[a]=s.divided(c);break;case 4:i[a]=s.mod(c);break;case 5:r?i[a]=s.compare(c,r,n):i[a]=t2.create(X.VALUE);break;case 6:i[a]=s.concatenateFront(c);break;case 7:i[a]=s.concatenateBack(c);break;case 8:i[a]=s.pow(c);break;case 9:i[a]=s.round(c);break;case 12:i[a]=s.atan2(c);break;case 10:i[a]=s.floor(c);break;case 11:i[a]=s.ceil(c)}}else i[a]=t2.create(X.NA)}a.push(i)}return this._createNewArray(a,i,s)}_checkArrayCalculateType(e){return 1===e.getRowCount()&&1===e.getColumnCount()?3:1===e.getRowCount()?1:1===e.getColumnCount()?2:0}_formatValue(e){if("string"!=typeof e)return this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;let t=(e=e.slice(1,-1)).split(";"),r=t.length,n=[],i=0;for(let e=0;e<r;e++){let r=t[e].split(","),s=r.length;i<s&&(i=s);let a=[];for(let e=0;e<s;e++){let t=r[e].trim();a.push(n$.create(t))}n.push(a)}return this._rowCount=r,this._columnCount=i,n}_createNewArray(e,t,r,n=-1,i=-1){(-1===this._currentColumn||-1===this._currentRow)&&(n=-1,i=-1);let s={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:i};return nB.create(s)}}class n${static create(e){if(null==e)return nx.create();if("boolean"==typeof e)return nD.create(e);if("string"==typeof e){let t;let r=e.toLocaleUpperCase().trim();if(K.has(r))return t2.create(r);if(r===Y.TRUE||r===Y.FALSE)return nj(e);if((0,k.isRealNum)(e))return nV.create(Number(e));let{isNumberPattern:n,value:i,pattern:s}=function(e){let t=e;t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let r=tQ.get(t);if(r)return{isNumberPattern:!0,value:r.value,pattern:r.pattern};let n=(0,k.numfmt).parseNumber(t);if(n)return tZ(t,n.v,n.z);let i=(0,k.numfmt).parseDate(t);if(i)return tZ(t,i.v,i.z);let s=(0,k.numfmt).parseTime(t);return s?tZ(t,s.v,s.z):{isNumberPattern:!1}}(e);if(n)return nV.create(i,s);let a=e.replace(/\n/g,"").replace(/\r/g,"");return!function(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')}(a)&&(eS.lastIndex=0,eS.test(a))?nB.create(a):('"'===(t=e.toString()).charAt(0)&&'"'===t.charAt(t.length-1)&&(t=(t=t.slice(1,-1)).replace(/""/g,'"')),nP.create(t))}return"number"==typeof e?nF(e):t2.create(X.VALUE)}}let nH=new tl(1e4);class nW extends tJ{constructor(e){super(),G(this,"_forcedSheetId",""),G(this,"_forcedSheetName",""),G(this,"_defaultSheetId",""),G(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),G(this,"_unitData",{}),G(this,"_unitStylesData",{}),G(this,"_defaultUnitId",""),G(this,"_forcedUnitId",""),G(this,"_runtimeData",{}),G(this,"_arrayFormulaCellData",{}),G(this,"_runtimeArrayFormulaCellData",{}),G(this,"_runtimeFeatureCellData",{}),G(this,"_refOffsetX",0),G(this,"_refOffsetY",0),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:n}=(0,k.moveRangeByOffset)(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(n)&&(n=this.getActiveSheetColumnCount()-1),{...this._rangeData,startRow:e,endRow:r,startColumn:t,endColumn:n}}isReferenceObject(){return!0}iterator(e){let{startRow:t,endRow:r,startColumn:n,endColumn:i}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(t2.create(X.VALUE),t,n);let s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId;for(let o=t;o<=r;o++)for(let r=n;r<=i;r++){if(o<0||r<0)return e(t2.create(X.REF),o,r);let i=this.getCellData(o,r);if((0,k.isNullCell)(i)){e(null,o,r);continue}let l=this.getCellValueObject(i);if(o===t&&r===n){let e=this.getCellPattern(s,a,o,r);if(e&&l.isNumber()){let t=Number(l.getValue());l=nV.create(t,e)}}if(!1===e(l,o,r))return}}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return nV.create(0);let n=this.getCellValueObject(r),i=this._forcedUnitId||this._defaultUnitId,s=this._forcedSheetId||this._defaultSheetId,a=this.getCellPattern(i,s,e,t);if(a&&n.isNumber()){let e=Number(n.getValue());n=nV.create(e,a)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=null==(t=e[this.getUnitId()])?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowData)||{}}getColumnData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return t2.create(X.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){let t=function(e){if(null===e)return 0;if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return 0;let r=t.dataStream;return(0,k.BuildTextUtils).transform.getPlainText(r)}return(null==e?void 0:e.v)||0}(e);return K.has(t)?t2.create(t):e.t===k.CellValueType.NUMBER?nF(t,this._getPatternByCell(e)):e.t===k.CellValueType.STRING||e.t===k.CellValueType.FORCE_STRING?nP.create(t.toString()):e.t===k.CellValueType.BOOLEAN?nj(t):n$.create(t)}_getPatternByCell(e){var t;let r=this._unitStylesData[this.getUnitId()];if(!r)return"";let n=r.getStyleByCell(e);return(null==(t=null==n?void 0:n.n)?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return null==(e=this._unitData[this.getUnitId()])?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return null==(t=null==(e=this._runtimeData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._arrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._runtimeArrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCellData(e,t){let r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),i=this.getCurrentActiveArrayFormulaCellData(),s=this.getCurrentRuntimeActiveArrayFormulaCellData();return(null==n?void 0:n.getValue(e,t))||(null==s?void 0:s.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(null==i?void 0:i.getValue(e,t))||(null==r?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return tB(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;r||(r=this._rangeData.startRow),n||(n=this._rangeData.startColumn);let i=this.getCellData(r,n);return i?this.getCellValueObject(i):t2.create(X.VALUE)}getCellPattern(e,t,r,n){var i,s,a,o;let l=this._unitStylesData[e];if(!l)return"";let u=null==(a=null==(s=null==(i=this._unitData[e])?void 0:i[t])?void 0:s.cellData)?void 0:a.getValue(r,n);if(!u)return"";let c=l.getStyleByCell(u);return(null==(o=null==c?void 0:c.n)?void 0:o.pattern)||""}toArrayValueObject(e=!0){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${r}_${n}_${i}_${s}`,o=nH.get(a);if(o&&e)return o;let l=n-r+1,u=s-i+1;if(l<0||u<0)return this._getBlankArrayValueObject();let c=Array(l);this.iterator((e,t,n)=>{let s=t-r,a=n-i;c[s]||(c[s]=Array(u)),null==e&&(e=nx.create()),c[s][a]=e});let h={calculateValueList:c,rowCount:c.length,columnCount:(null==(t=c[0])?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:i},d=nB.create(h);return e&&nH.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(null==this._forcedSheetId||0===this._forcedSheetId.length)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){let e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return nB.create(e)}}class nG extends tJ{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}}class nY extends tJ{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;let t=[];for(let e=0;e<this._promiseList.length;e++){let r=this._promiseList[e];null==t[e]&&(t[e]=[]);for(let n=0;n<r.length;n++){let i=r[n];i.isAsyncObject()?t[e][n]=await i.getValue():t[e][n]=i}}let r={calculateValueList:t,rowCount:t.length,columnCount:(null==(e=t[0])?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return nB.create(r)}}class nz extends nW{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}}class nq extends nW{constructor(e){super(e);let t=tg(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return t2.create(X.REF);let t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(e,t){let r=e.startRow,n=e.startColumn,i=t.startRow,s=t.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>i?(a.startRow=i,a.endRow=r):(a.startRow=r,a.endRow=i),n>s?(a.startColumn=s,a.endColumn=n):(a.startColumn=n,a.endColumn=s),e.startAbsoluteRefType&&(a.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(a.endAbsoluteRefType=t.startAbsoluteRefType),a}_createRange(e){let t=new nz(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());let{x:r,y:n}=this.getRefOffset();t.setRefOffset(r,n);let i=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),null!=i&&t.setForcedSheetIdDirect(i);let s=this.getForcedUnitId();return s&&t.setForcedUnitIdDirect(s),t}}class nX extends nW{constructor(e){super(e);let t=tg(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:t.range.startColumn,startRow:Number.NaN,endColumn:t.range.endColumn,endRow:Number.NaN,rangeType:k.RANGE_TYPE.COLUMN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return t2.create(X.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;let i=t.startColumn;return n>i?t.endColumn=n:(t.startColumn=n,t.endColumn=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=k.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${ei.COLON}${e.getToken()}`),this}}class nK extends nW{constructor(e){super(e);let t=tg(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:Number.NaN,startRow:t.range.startRow,endColumn:Number.NaN,endRow:t.range.endRow,rangeType:k.RANGE_TYPE.ROW};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return t2.create(X.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;let i=t.startRow;return n>i?t.endRow=n:(t.startRow=n,t.endRow=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=k.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${ei.COLON}${e.getToken()}`),this}}function nQ(e,t,r,n){let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1,a=[];for(let o=0;o<e;o++){let e=[];for(let a=0;a<t;a++){if(1===i&&1===s){let t=r.isArray()?r.get(0,0):r;e.push(t);continue}if(1===i&&a<s){let t=r.get(0,a);e.push(t);continue}if(1===s&&o<i){let t=r.get(o,0);e.push(t);continue}if(o>=i||a>=s){e.push(null!=n?n:nx.create());continue}let t=r.get(o,a);e.push(t)}a.push(e)}return nZ(a,e,t)}function nZ(e,t,r,n="",i=""){return nB.create({calculateValueList:e,rowCount:t,columnCount:r,unitId:n,sheetId:i,row:-1,column:-1})}function nJ(e){for(let t of[ee.EQUALS,ee.NOT_EQUAL,ee.GREATER_THAN_OR_EQUAL,ee.GREATER_THAN,ee.LESS_THAN_OR_EQUAL,ee.LESS_THAN])if(e.startsWith(t)){let r=e.substring(t.length);return[t,n$.create(r)]}return[ee.EQUALS,n$.create(e)]}function n0(e,t,r,n){if(!r){if(t.isString()){let[e,n]=nJ(`${t.getValue()}`);r=e,t=n}else r=ee.EQUALS}return e.compare(t,r,n)}function n1(e){return!!e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()||(e.isReferenceObject()?!!(e.isCell()||1===e.getRowCount()&&1===e.getColumnCount()):!!(e.isString()||e.isNumber()||e.isBoolean()||e.isError()||e.isNull()))}function n2(e){let t=null==e?void 0:e.getPattern(),r={};if(t&&(r={s:{n:{pattern:t}}}),null==e)return{v:null,...r};if(e.isError())return{v:e.getErrorType(),t:k.CellValueType.STRING,...r};if(e.isValueObject()){let t=e.getValue();return e.isNumber()?{v:t,t:k.CellValueType.NUMBER,...r}:e.isBoolean()?{v:t?1:0,t:k.CellValueType.BOOLEAN,...r}:e.isString()?{v:t,t:k.CellValueType.STRING,...r}:e.isNull()?{v:null,...r}:{v:t,t:k.CellValueType.STRING,...r}}}function n5(e){let t=0,r=0;return e.forEach((e,n)=>{n%2==1&&(e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1)))}),{maxRowLength:t,maxColumnLength:r}}function n3(e,t,r,n){let i=t.getRowCount(),s=t.getColumnCount();for(let t=0;t<e.length;t++){if(t%2==1)continue;let a=e[t],o=a.getRowCount(),l=a.getColumnCount();if(o!==i||l!==s)return nQ(r,n,t2.create(X.VALUE))}return null}function n4(e,t,r,n=!1){let i=[];for(let s=0;s<e.length;s++){if(s%2==1)continue;let a=e[s];nQ(t,r,e[s+1],t2.create(X.NA)).iterator((e,t,r)=>{if(!e)return;let s=n0(a,e),[,o]=nJ(`${e.getValue()}`);if(n&&(s=n6(s,a,o)),void 0===i[t]&&(i[t]=[]),void 0===i[t][r]){i[t][r]=s;return}i[t][r]=function(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t);return i.mapValue((e,t,r)=>{let n=s.get(t,r);return null!=e&&e.isError()?e:null!=n&&n.isError()?n:null!=e&&e.isBoolean()&&null!=n&&n.isBoolean()?nj(e.getValue()&&n.getValue()):nD.create(!1)})}(i[t][r],s)})}return i}function n6(e,t,r){return e.mapValue((e,n,i)=>{let s=t.get(n,i);return s&&function(e,t){if(e.isNumber()&&t.isNumber()||e.isBoolean()&&t.isBoolean())return!0;let r=e.isString()&&""===e.getValue(),n=t.isString()&&""===t.getValue();return!!((r||e.isNull())&&(n||t.isNull())||e.isString()&&!r&&t.isString()&&!n)}(s,r)?e:null!=s&&s.isError()&&r.isError()&&s.getValue()===r.getValue()?nD.create(!0):nD.create(!1)})}var n9=((_=n9||{})[_.CELL=0]="CELL",_[_.COLUMN=1]="COLUMN",_[_.ROW=2]="ROW",_);let n7=/* @__PURE__ */new Map;var n8=Object.defineProperty,ie=Object.getOwnPropertyDescriptor,it=((y=it||{})[y.IDLE=0]="IDLE",y[y.START=1]="START",y[y.START_DEPENDENCY=2]="START_DEPENDENCY",y[y.START_CALCULATION=3]="START_CALCULATION",y[y.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",y[y.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",y[y.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",y[y.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",y[y.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",y),ir=((E=ir||{})[E.INITIAL=0]="INITIAL",E[E.STOP_EXECUTION=1]="STOP_EXECUTION",E[E.NOT_EXECUTED=2]="NOT_EXECUTED",E[E.SUCCESS=3]="SUCCESS",E);let ii=class extends k.Disposable{constructor(e){super(),G(this,"_formulaExecuteStage",0),G(this,"_stopState",!1),G(this,"_currentRow",-1),G(this,"_currentColumn",-1),G(this,"_currentRowCount",Number.NEGATIVE_INFINITY),G(this,"_currentColumnCount",Number.NEGATIVE_INFINITY),G(this,"_currentSubUnitId",""),G(this,"_currentUnitId",""),G(this,"_runtimeData",{}),G(this,"_runtimeOtherData",{}),G(this,"_unitArrayFormulaRange",{}),G(this,"_runtimeArrayFormulaCellData",{}),G(this,"_runtimeClearArrayFormulaCellData",{}),G(this,"_runtimeFeatureRange",{}),G(this,"_runtimeFeatureCellData",{}),G(this,"_functionsExecutedState",0),G(this,"_functionDefinitionPrivacyVar",/* @__PURE__ */new Map),G(this,"_totalFormulasToCalculate",0),G(this,"_completedFormulasCount",0),G(this,"_totalArrayFormulasToCalculate",0),G(this,"_completedArrayFormulasCount",0),G(this,"_formulaCycleIndex",0),G(this,"_isCycleDependency",!1),this._currentConfigService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){tG.clear(),tQ.clear(),tm.clear(),n7.clear()}setCurrent(e,t,r,n,i,s){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=i,this._currentUnitId=s}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){let i=this._currentSubUnitId,s=this._currentUnitId;void 0===this._runtimeOtherData[s]&&(this._runtimeOtherData[s]={});let a=this._runtimeOtherData[s];(void 0===a[i]||null===a[i])&&(a[i]={});let o=a[i],l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){let{startRow:e,startColumn:t}=n.getRangePosition();n.iterator((r,n,i)=>{let s=n2(r),a=n-e;null==l[a]&&(l[a]=[]),l[a][i-t]=s})}else l=[[n2(n)]];(void 0===o[e]||null===o[e])&&(o[e]={}),(void 0===o[e][r]||null===o[e][r])&&(o[e][r]={}),o[e][r][t]=l}setRuntimeData(e){let t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,i=this.currentColumnCount,s=this._currentSubUnitId,a=this._currentUnitId;null==this._runtimeData[a]&&(this._runtimeData[a]={});let o=this._runtimeData[a];null==o[s]&&(o[s]=new k.ObjectMatrix),null==this._unitArrayFormulaRange[a]&&(this._unitArrayFormulaRange[a]={});let l=this._unitArrayFormulaRange[a];(null===l[s]||void 0===l[s])&&(l[s]={});let u=new k.ObjectMatrix(l[s]);void 0===this._runtimeArrayFormulaCellData[a]&&(this._runtimeArrayFormulaCellData[a]={});let c=this._runtimeArrayFormulaCellData[a];null==c[s]&&(c[s]=new k.ObjectMatrix),void 0===this._runtimeClearArrayFormulaCellData[a]&&(this._runtimeClearArrayFormulaCellData[a]={});let h=this._runtimeClearArrayFormulaCellData[a];null==h[s]&&(h[s]=new k.ObjectMatrix);let d=o[s],m=c[s],g=h[s];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){let{startRow:o,startColumn:l,endRow:c,endColumn:h}=e.getRangePosition();if(o===c&&l===h){let n=n2(e.getFirstCell());d.setValue(t,r,n),g.setValue(t,r,n);return}let f={startRow:t,startColumn:r,endRow:c-o+t,endColumn:h-l+r};if(u.setValue(t,r,f),this._checkIfArrayFormulaRangeHasData(a,s,t,r,f)||this._checkIfArrayFormulaExceeded(n,i,f)){let n=n2(t2.create(X.SPILL));d.setValue(t,r,n),g.setValue(t,r,n);let i=this._currentConfigService.getUnitData();e.iterator((e,u,c)=>{var h,d;let g=u-o+t,f=c-l+r,p=null==(d=null==(h=i[a])?void 0:h[s])?void 0:d.cellData.getValue(g,f);if(u===o&&c===l)m.setValue(t,r,n);else if(null!=p)null==p.v&&(p.v=""),m.setValue(g,f,p);else{if(this._isInOtherArrayFormulaRange(a,s,t,r,g,f))return!0;m.setValue(g,f,{v:""})}})}else{let n=t2.create(X.SPILL);e.iterator((e,i,s)=>{let a=n2(e);if(i===o&&s===l){if(null!=e&&e.isError()&&e.isEqualType(n))return g.setValue(t,r,{}),d.setValue(t,r,{...n2(n)}),!1;d.setValue(t,r,{...a})}let u=i-o+t,c=s-l+r;m.setValue(u,c,a)})}}else{let n=n2(e);d.setValue(t,r,n),g.setValue(t,r,n)}}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,n,i){var s,a,o,l,u,c,h,d,m,g,f;let{startRow:p,startColumn:C,endRow:_,endColumn:y}=i,E=this._currentConfigService.getUnitData(),b=this._currentConfigService.getArrayFormulaCellData();null==(o=null==(a=null==(s=this._unitArrayFormulaRange[e])?void 0:s[t])?void 0:a[r])||o[n];for(let i=p;i<=_;i++)for(let s=C;s<=y;s++){if(i===r&&n===s)continue;let a=null==(c=null==(u=null==(l=this._runtimeData)?void 0:l[e])?void 0:u[t])?void 0:c.getValue(i,s);null==(d=null==(h=null==b?void 0:b[e])?void 0:h[t])||d.getValue(i,s);let o=null==(f=null==(g=null==(m=null==E?void 0:E[e])?void 0:m[t])?void 0:g.cellData)?void 0:f.getValue(i,s),p=this._getRuntimeFeatureCellValue(i,s,t,e);if(!(0,k.isNullCell)(a)||this._isInOtherArrayFormulaRange(e,t,r,n,i,s)||!(0,k.isNullCell)(o)||!(0,k.isNullCell)(p))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return tB(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return null!=e&&void 0!==e.v}_isInOtherArrayFormulaRange(e,t,r,n,i,s){var a;let o=null==(a=this._currentConfigService.getArrayFormulaRange()[e])?void 0:a[t];if(null==o)return!1;let l=!1;return new(0,k.ObjectMatrix)(o).forValue((a,o,u)=>{var c,h;if(a===r&&o===n)return;let d=this._isInArrayFormulaRange(u,i,s),m=null==(h=null==(c=this._runtimeData[e])?void 0:c[t])?void 0:h.getValue(a,o);d&&(null==m?void 0:m.v)!==X.SPILL&&(l=!0)}),l}_isInArrayFormulaRange(e,t,r){if(null==e)return!1;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return t>=n&&t<=s&&r>=i&&r<=a}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){let i=this._currentConfigService.getDirtyRanges();return 0===i.length||function(e,t,r,n,i){for(let s=0,a=e.length;s<a;s++){let a=e[s];if(t!==a.unitId||r!==a.sheetId)continue;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=a.range;if(n>=o&&n<=u&&i>=l&&i<=c)return!0}return!1}(i,e,t,r,n)}};ii=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ie(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&n8(t,r,s),s})([(e,t)=>tL(e,t,0)],ii);let is=(0,k.createIdentifier)("univer.formula.runtime.service");var ia=((b=ia||{})[b.REFERENCE=1]="REFERENCE",b[b.VALUE=2]="VALUE",b[b.OPERATOR=3]="OPERATOR",b[b.FUNCTION=4]="FUNCTION",b[b.LAMBDA=5]="LAMBDA",b[b.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",b[b.ERROR=7]="ERROR",b[b.BASE=8]="BASE",b[b.ROOT=9]="ROOT",b[b.UNION=10]="UNION",b[b.PREFIX=11]="PREFIX",b[b.SUFFIX=12]="SUFFIX",b[b.NULL=13]="NULL",b);let io=/* @__PURE__ */new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class il{constructor(e){G(this,"_children",[]),G(this,"_definedNames"),G(this,"_parent"),G(this,"_valueObject"),G(this,"_calculateState",!1),G(this,"_async",!1),G(this,"_address",!1),G(this,"_isForcedCalculateFunction",!1),this._token=e}dispose(){var e;this._children.forEach(e=>{e.dispose()}),null==(e=this._valueObject)||e.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return ia.BASE}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}async executeAsync(){return Promise.resolve(z.SUCCESS)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];r.push(n.serialize())}let i={token:e,nodeType:this.nodeType};return n>0&&(i.children=r),i}hasDefinedName(e){var t;return(null==(t=this._definedNames)?void 0:t.includes(e))||!1}setDefinedNames(e){this._definedNames=e}getDefinedNames(){return this._definedNames}}class iu extends il{constructor(e){super(e),G(this,"_errorValueObject"),this._errorValueObject=t2.create(e)}get nodeType(){return ia.ERROR}static create(e){return new iu(e)}getValue(){return this._errorValueObject}}class ic{get zIndex(){return 0}dispose(){}create(e,t,r){return new il(e instanceof tC?e.getToken():e)}}class ih extends il{get nodeType(){return ia.ROOT}execute(){let e=this.getChildren();if(e.length>1){this.setValue(t2.create(X.VALUE));return}let t=e[0];null==t?this.setValue(t2.create(X.VALUE)):this.setValue(t.getValue())}}class id extends ic{get zIndex(){return io.get(ia.ROOT)||100}checkAndCreateNodeType(e){if(e instanceof tC&&"R_1"===e.getToken())return new ih("R_1")}}let im=(0,k.createIdentifier)("univer.formula-function.service");class ig extends k.Disposable{constructor(){super(...arguments),G(this,"_functionExecutors",/* @__PURE__ */new Map),G(this,"_functionDescriptions",/* @__PURE__ */new Map)}dispose(){this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.set(r.functionName,r)}return(0,k.toDisposable)(()=>{for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r)}}}var ip=((R=ip||{}).COMPARE="COMPARE",R.DIVIDED="DIVIDED",R.MINUS="MINUS",R.MULTIPLY="MULTIPLY",R.PLUS="PLUS",R.UNION="UNION",R.CUBE="CUBE",R),iC=Object.defineProperty,i_=Object.getOwnPropertyDescriptor,iy=(e,t)=>(r,n)=>t(r,n,e);class iE extends il{constructor(e,t,r){super(t),this._runtimeService=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return ia.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");this._operatorString===eo.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(nV.create(0),e)):t=this._operatorString===eo.AT?this._handlerAT(e):t2.create(X.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject()||e.isCell())return t2.create(X.VALUE);let t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,{startRow:i,startColumn:s,endRow:a,endColumn:o}=e.getRangePosition();return o!==s&&a!==i||i===a&&s===o?t2.create(X.VALUE):a===i&&n>=s&&n<=o?e.getCellByColumn(n):s===o&&r>=i&&r<=a?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):t2.create(X.VALUE)}}let ib=class extends ic{constructor(e,t){super(),this._functionService=e,this._runtimeService=t}get zIndex(){return io.get(ia.PREFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tC))return;let t=e.getToken(),r=t.trim();if('"'===r.charAt(0)&&'"'===r.charAt(r.length-1))return;let n="";if(r!==eo.MINUS)return r===eo.AT?new iE(this._runtimeService,r):void 0;n=ip.MINUS;let i=this._functionService.getExecutor(n);return i?new iE(this._runtimeService,r,i):(console.error(`No function ${t}`),iu.create(X.NAME))}};function iR(e,t,r){let n,i,s=e,a=s.slice(0,2),o=0;if(a[0]===eo.MINUS){let e=t.getExecutor(ip.MINUS);n=new iE(r,eo.MINUS,e),o++}return a[0]===eo.AT&&(i=new iE(r,eo.AT),n&&i.setParent(n),o++),o>0&&(s=s.slice(o)),{tokenTrim:s,minusPrefixNode:n,atPrefixNode:i}}ib=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i_(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iC(t,r,s),s})([iy(0,im),iy(1,is)],ib),RegExp(eo.MINUS,"g"),RegExp(eo.AT,"g");var iN=Object.defineProperty,iI=Object.getOwnPropertyDescriptor,iA=(e,t)=>(r,n)=>t(r,n,e);class iv extends il{constructor(e,t,r,n,i,s){super(""),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=n,this._definedNamesService=i,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return ia.FUNCTION}async executeAsync(){let e;let t=[],r=this.getChildren(),n=r.length;this._compatibility();for(let e=0;e<n;e++){let n=r[e].getValue();null!=n&&(n.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?t.push(n.toArrayValueObject()):t.push(n))}let i=this._calculate(t);return e=i.isAsyncObject()||i.isAsyncArrayObject()?await i.getValue():i,this._setRefData(e),this.setValue(e),Promise.resolve(z.SUCCESS)}execute(){let e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let n=0;n<r;n++){let r=t[n].getValue();null!=r&&(r.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(r.toArrayValueObject()):e.push(r))}let n=this._calculate(e);this._setRefData(n),this.setValue(n)}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){let e,t;let r=this.getChildren(),n=r.length;if(!this._functionExecutor.needsExpandParams||3!==n)return;let i=r[1].getValue(),s=r[2].getValue();if(!(null!=i&&i.isReferenceObject())&&!(null!=s&&s.isReferenceObject()))return;if(null!=i&&i.isReferenceObject()){let{startRow:r,startColumn:n,endRow:s,endColumn:a}=i.getRangeData();e=s-r+1,t=a-n+1}else e=null!=i&&i.isArray()?i.getRowCount():1,t=null!=i&&i.isArray()?i.getColumnCount():1;let a=s.getRangeData(),{startRow:o,startColumn:l,endRow:u,endColumn:c}=a,h=u-o+1,d=c-l+1;e!==h&&(a.endRow+=e-h),t!==d&&(a.endColumn+=t-d)}_calculate(e){var t;let r;let{minParams:n,maxParams:i}=this._functionExecutor;if(-1!==n&&-1!==i&&(e.length<n||e.length>i))return t2.create(X.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let n=this._functionExecutor.calculateCustom(...e.map(e=>e.isArray()?e.toValue():e.getValue()));if("object"!=typeof n||null==n)r=n$.create(n);else{let e=nk(n);r=nB.create({calculateValueList:e,rowCount:e.length,columnCount:(null==(t=e[0])?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}}else this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction(),r=this._functionExecutor.calculate(...e);return r}_setDefinedNamesForFunction(){let e=this._currentConfigService.getExecuteUnitId();if(null==e)return;let t=this._definedNamesService.getDefinedNameMap(e);null!=t&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){let{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:n}=this._runtimeService;if(this._functionExecutor.setRefInfo(e,t,r,n),this._functionExecutor.needsSheetRowColumnCount){let{rowCount:r,columnCount:n}=this._currentConfigService.getSheetRowColumnCount(e,t);this._functionExecutor.setSheetRowColumnCount(r,n)}}_setRefData(e){e.isReferenceObject()&&(e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData()))}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}}class iS extends il{constructor(e="Error"){super(e)}get nodeType(){return ia.FUNCTION}async executeAsync(){return this.setValue(t2.create(X.NAME)),Promise.resolve(z.SUCCESS)}execute(){this.setValue(t2.create(X.NAME))}}let iT=class extends ic{constructor(e,t,r,n,i,s){super(),this._functionService=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._injector=i,this._formulaDataModel=s}get zIndex(){return io.get(ia.FUNCTION)||100}create(e){let t=this._functionService.getExecutor(e);return t?new iv(e,t,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${e}`),iu.create(X.NAME))}checkAndCreateNodeType(e){if("string"==typeof e)return;let{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=iR(e.getToken().trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(e))return iu.create(X.VALUE);let i=t.toUpperCase();if(this._functionService.hasExecutor(i)){let e=this.create(i);return n?e.setParent(n):r&&e.setParent(r),e}}_isParentUnionNode(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken())===ei.COLON}};iT=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iI(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iN(t,r,s),s})([iA(0,im),iA(1,tL),iA(2,is),iA(3,e2),iA(4,(0,k.Inject)(k.Injector)),iA(5,(0,k.Inject)(tI))],iT);var iO=Object.defineProperty,iM=Object.getOwnPropertyDescriptor;let iw=class extends k.Disposable{constructor(e){super(),this._runtimeService=e}async executeAsync(e){if(!e||!e.node)return Promise.resolve(t2.create(X.VALUE));let t=e.node,r=e.refOffsetX,n=e.refOffsetY;await this._executeAsync(t,r,n);let i=t.getValue();return null==i?Promise.resolve(t2.create(X.VALUE)):Promise.resolve(i)}execute(e){if(!e||!e.node)return t2.create(X.VALUE);let t=e.node,r=e.refOffsetX,n=e.refOffsetY;this._execute(t,r,n);let i=t.getValue();return null==i?t2.create(X.VALUE):i}executePreCalculateNode(e){return e.execute(),e.getValue()}checkAsyncNode(e){if(null==e)return!1;let t=[];this._checkAsyncNode(e,t);for(let e=0,r=t.length;e<r;e++)if(!0===t[e])return!0;return!1}_checkAsyncNode(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];t.push(n.isAsync()),this._checkAsyncNode(n,t)}}async _executeAsync(e,t=0,r=0){if(this._runtimeService.isStopExecution())return Promise.resolve(z.ERROR);let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===th&&i.isEmptyParamFunction()){i.execute();continue}await this._executeAsync(i,t,r)}return e.nodeType===ia.REFERENCE&&e.setRefOffset(t,r),e.nodeType===ia.FUNCTION&&e.isAsync()?await e.executeAsync():e.execute(),Promise.resolve(z.SUCCESS)}_execute(e,t=0,r=0){if(this._runtimeService.isStopExecution())return z.ERROR;let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===th&&i.isEmptyParamFunction()){i.execute();continue}this._execute(i,t,r)}return e.nodeType===ia.REFERENCE&&e.setRefOffset(t,r),e.execute(),z.SUCCESS}};function ix(e){return e instanceof tC&&"L_1"===e.getToken()}function iU(e,t,r){let n=e.getChildren(),i=n.length,s=n[0];for(let e=0;e<i;e++){let i=n[e];if(!(ix(s)&&0!==e)){if(i instanceof tC)iU(i,t,r);else{let s=i.trim();if(r.has(s)){let i=new tC;i.setToken(tu),i.setLambdaId(t),i.setLambdaPrivacyVar(r),i.setLambdaParameter(s),n[e]=i}}}}}function iD(e,t=0,r=0){return{node:e,refOffsetX:t,refOffsetY:r}}iw=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iM(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iO(t,r,s),s})([(e,t)=>is(e,t,0)],iw);class iV extends t0{constructor(e,t,r){super(0),G(this,"_lambdaPrivacyValueMap",/* @__PURE__ */new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new iV(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=/* @__PURE__ */new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){let t;let r=this._lambdaPrivacyVarKeys.length;if(e.length!==r||!this._interpreter||!this._lambdaNode)return t2.create(X.VALUE);if(this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1),this._interpreter.checkAsyncNode(this._lambdaNode))t=new nG(this._interpreter.executeAsync(iD(this._lambdaNode)));else{let e=this._interpreter.execute(iD(this._lambdaNode));t=e.isReferenceObject()?e.toArrayValueObject():e}return this._lambdaNode.setNotEmpty(!0),t}_setLambdaNodeValue(e){if(!e)return;let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken()===tu){let e=r.getLambdaParameter(),t=this._lambdaPrivacyValueMap.get(e);if(t)r.setValue(t);else{let t=function e(t){if(!t)return;if(t.getToken()!==tu)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(!r)return;let i=r.get(n);return null==i&&t.getValue()?t:e(i)}(r.getCurrentLambdaPrivacyVar().get(e));null!=t&&r.setValue(t.getValue())}continue}this._setLambdaNodeValue(r)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){let r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var iL=Object.defineProperty,iP=Object.getOwnPropertyDescriptor,ij=(e,t)=>(r,n)=>t(r,n,e);class iF extends il{constructor(e,t,r,n){super(e),G(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n}get nodeType(){return ia.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return null===this._lambdaId}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(iV.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{let e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}}let ik=class extends ic{constructor(e,t){super(),this._runtimeService=e,this._interpreter=t}get zIndex(){return io.get(ia.LAMBDA)||100}create(e){let t=e.getChildren(),r=t[0],n=t.slice(1,-1),i=t[t.length-1];if(!(r instanceof tC&&i instanceof tC))return iu.create(X.NAME);if("L_1"===r.getToken()){let e=r.getChildren();if(n.length!==e.length)return iu.create(X.VALUE)}else n=t.slice(0,-1);let s=(0,k.Tools).generateRandomId(8),a=/* @__PURE__ */new Map;for(let e=0;e<n.length;e++){let t=n[e];if(!(t instanceof tC))return iu.create(X.VALUE);{let e=t.getChildren()[0];t.setToken(tc),a.set(e.trim(),void 0)}}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(i,s,a),new iF(e.getToken(),s,this._interpreter,[...a.keys()])}checkAndCreateNodeType(e){if(!(!(e instanceof tC)||e.getToken().trim().toUpperCase()!==th))return this.create(e)}_updateLambdaStatement(e,t,r){iU(e,t,r)}};ik=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iP(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iL(t,r,s),s})([ij(0,is),ij(1,(0,k.Inject)(iw))],ik);class iB extends il{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return ia.LAMBDA_PARAMETER}execute(){let e=function e(t){if(!t)return;if(t.getToken()!==tu)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(r)return e(r.get(n))}(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{let e=this.getValue();(null==e||e.isError())&&this.setValue(t2.create(X.NAME))}}}class i$ extends ic{get zIndex(){return io.get(ia.LAMBDA_PARAMETER)||100}create(e){let t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new iB(e.getToken(),r,t):new iu(X.NAME)}checkAndCreateNodeType(e){if(!(!(e instanceof tC)||e.getToken().trim()!==tu))return this.create(e)}}class iH extends il{constructor(e){super(e),this._operatorString=e}get nodeType(){return ia.NULL}execute(){this.setValue(nx.create())}}var iW=((N=iW||{}).ABS="ABS",N.ACOS="ACOS",N.ACOSH="ACOSH",N.ACOT="ACOT",N.ACOTH="ACOTH",N.AGGREGATE="AGGREGATE",N.ARABIC="ARABIC",N.ASIN="ASIN",N.ASINH="ASINH",N.ATAN="ATAN",N.ATAN2="ATAN2",N.ATANH="ATANH",N.BASE="BASE",N.CEILING="CEILING",N.CEILING_MATH="CEILING.MATH",N.CEILING_PRECISE="CEILING.PRECISE",N.COMBIN="COMBIN",N.COMBINA="COMBINA",N.COS="COS",N.COSH="COSH",N.COT="COT",N.COTH="COTH",N.CSC="CSC",N.CSCH="CSCH",N.DECIMAL="DECIMAL",N.DEGREES="DEGREES",N.EVEN="EVEN",N.EXP="EXP",N.FACT="FACT",N.FACTDOUBLE="FACTDOUBLE",N.FLOOR="FLOOR",N.FLOOR_MATH="FLOOR.MATH",N.FLOOR_PRECISE="FLOOR.PRECISE",N.GCD="GCD",N.INT="INT",N.ISO_CEILING="ISO.CEILING",N.LCM="LCM",N.LET="LET",N.LN="LN",N.LOG="LOG",N.LOG10="LOG10",N.MDETERM="MDETERM",N.MINVERSE="MINVERSE",N.MMULT="MMULT",N.MOD="MOD",N.MROUND="MROUND",N.MULTINOMIAL="MULTINOMIAL",N.MUNIT="MUNIT",N.ODD="ODD",N.PI="PI",N.POWER="POWER",N.PRODUCT="PRODUCT",N.QUOTIENT="QUOTIENT",N.RADIANS="RADIANS",N.RAND="RAND",N.RANDARRAY="RANDARRAY",N.RANDBETWEEN="RANDBETWEEN",N.ROMAN="ROMAN",N.ROUND="ROUND",N.ROUNDBANK="ROUNDBANK",N.ROUNDDOWN="ROUNDDOWN",N.ROUNDUP="ROUNDUP",N.SEC="SEC",N.SECH="SECH",N.SERIESSUM="SERIESSUM",N.SEQUENCE="SEQUENCE",N.SIGN="SIGN",N.SIN="SIN",N.SINH="SINH",N.SQRT="SQRT",N.SQRTPI="SQRTPI",N.SUBTOTAL="SUBTOTAL",N.SUM="SUM",N.SUMIF="SUMIF",N.SUMIFS="SUMIFS",N.SUMPRODUCT="SUMPRODUCT",N.SUMSQ="SUMSQ",N.SUMX2MY2="SUMX2MY2",N.SUMX2PY2="SUMX2PY2",N.SUMXMY2="SUMXMY2",N.TAN="TAN",N.TANH="TANH",N.TRUNC="TRUNC",N),iG=((I=iG||{}).ASC="ASC",I.ARRAYTOTEXT="ARRAYTOTEXT",I.BAHTTEXT="BAHTTEXT",I.CHAR="CHAR",I.CLEAN="CLEAN",I.CODE="CODE",I.CONCAT="CONCAT",I.CONCATENATE="CONCATENATE",I.DBCS="DBCS",I.DOLLAR="DOLLAR",I.EXACT="EXACT",I.FIND="FIND",I.FINDB="FINDB",I.FIXED="FIXED",I.LEFT="LEFT",I.LEFTB="LEFTB",I.LEN="LEN",I.LENB="LENB",I.LOWER="LOWER",I.MID="MID",I.MIDB="MIDB",I.NUMBERVALUE="NUMBERVALUE",I.PHONETIC="PHONETIC",I.PROPER="PROPER",I.REGEXEXTRACT="REGEXEXTRACT",I.REGEXMATCH="REGEXMATCH",I.REGEXREPLACE="REGEXREPLACE",I.REPLACE="REPLACE",I.REPLACEB="REPLACEB",I.REPT="REPT",I.RIGHT="RIGHT",I.RIGHTB="RIGHTB",I.SEARCH="SEARCH",I.SEARCHB="SEARCHB",I.SUBSTITUTE="SUBSTITUTE",I.T="T",I.TEXT="TEXT",I.TEXTAFTER="TEXTAFTER",I.TEXTBEFORE="TEXTBEFORE",I.TEXTJOIN="TEXTJOIN",I.TEXTSPLIT="TEXTSPLIT",I.TRIM="TRIM",I.UNICHAR="UNICHAR",I.UNICODE="UNICODE",I.UPPER="UPPER",I.VALUE="VALUE",I.VALUETOTEXT="VALUETOTEXT",I.CALL="CALL",I.EUROCONVERT="EUROCONVERT",I.REGISTER_ID="REGISTER.ID",I),iY=Object.defineProperty,iz=Object.getOwnPropertyDescriptor;class iq extends il{constructor(e,t){super(e),this._functionExecutor=t}get nodeType(){return ia.OPERATOR}execute(){let e=this.getChildren();this._functionExecutor.name===ip.COMPARE&&this._functionExecutor.setCompareType(this.getToken());let t=e[0],r=e[1],n=null==t?void 0:t.getValue(),i=null==r?void 0:r.getValue(),s=this.getToken();if((null==n||null==i)&&s!==J.MINUS&&s!==J.PLUS){this.setValue(t2.create(X.VALUE));return}null==n&&(n=nx.create()),null==i&&(i=nx.create()),n.isReferenceObject()&&(n=n.toArrayValueObject()),i.isReferenceObject()&&(i=i.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(n,i))}}let iX=class extends ic{constructor(e){super(),this._functionService=e}get zIndex(){return io.get(ia.OPERATOR)||100}create(e){let t="";e===J.PLUS?t=ip.PLUS:e===J.MINUS?t=ip.MINUS:e===J.MULTIPLY?t=ip.MULTIPLY:e===J.DIVIDED?t=ip.DIVIDED:e===J.CONCATENATE?t=iG.CONCATENATE:e===J.POWER?t=iW.POWER:en.has(e)&&(t=ip.COMPARE);let r=this._functionService.getExecutor(t);return r?new iq(e,r):(console.error(`No function ${e}`),iu.create(X.NAME))}checkAndCreateNodeType(e){if(e instanceof tC)return;let t=e.trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&er.has(t))return this.create(t)}};iX=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iz(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iY(t,r,s),s})([(e,t)=>im(e,t,0)],iX);var iK=Object.defineProperty,iQ=Object.getOwnPropertyDescriptor,iZ=(e,t)=>(r,n)=>t(r,n,e);class iJ extends il{constructor(e,t,r,n,i=!1){super(r),G(this,"_refOffsetX",0),G(this,"_refOffsetY",0),this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=i}get nodeType(){return ia.REFERENCE}execute(){let e=this._currentConfigService,t=this._runtimeService,r=function(e,t){let r;let n=n7.get(e);if(n)return n;switch(t){case 0:r=new nq(e);break;case 1:r=new nX(e);break;case 2:r=new nK(e);break;default:throw Error("Unknown reference object type")}return n7.set(e,r),r}(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());let{x:n,y:i}=this.getRefOffset();r.setRefOffset(n,i),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(t2.create(X.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}let i0=class extends ic{constructor(e,t,r){super(),this._currentConfigService=e,this._formulaRuntimeService=t,this._functionService=r}get zIndex(){return io.get(ia.REFERENCE)||100}checkAndCreateNodeType(e){var t,r;let n;let i=!1,s,a=!1;e instanceof tC?(i=!0,s=e.getToken().trim(),(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ei.COLON&&(a=!0)):s=e.trim();let o=this._currentConfigService,l=this._formulaRuntimeService,{tokenTrim:u,minusPrefixNode:c,atPrefixNode:h}=iR(s,this._functionService,l);if((i||'"'!==u.charAt(0)||'"'!==u.charAt(u.length-1))&&(eT(u)?n=new iJ(o,l,u,n9.CELL,a):i&&this._checkParentIsUnionOperator(e)&&(ew(u)?n=new iJ(o,l,u,n9.ROW,a):ex(u)&&(n=new iJ(o,l,u,n9.COLUMN,a))),n))return h?n.setParent(h):c&&n.setParent(c),n}_checkParentIsUnionOperator(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ei.COLON}};i0=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iQ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&iK(t,r,s),s})([iZ(0,tL),iZ(1,is),iZ(2,im)],i0);var i1=Object.defineProperty,i2=Object.getOwnPropertyDescriptor,i5=(e,t)=>(r,n)=>t(r,n,e);class i3 extends il{constructor(e,t,r,n){super(r),this._currentConfigService=e,this._lexer=t,this._operatorString=r,this._functionExecutor=n}get nodeType(){return ia.SUFFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");if(this._operatorString===es.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),(t=this._functionExecutor.calculate(e,nV.create(100))).isNumber()){let e=Number(t.getValue());t=nV.create(e,"0.00%")}}else t=this._operatorString===es.POUND?this._handlerPound(e):t2.create(X.VALUE);this.setValue(t)}_handlerPound(e){var t,r,n,i;if(!e.isReferenceObject()||!e.isCell())return t2.create(X.VALUE);let s=e.getRangePosition(),a=e.getUnitId(),o=e.getSheetId(),l=this._currentConfigService.getFormulaData(),u=null==(i=null==(n=null==(r=null==(t=null==l?void 0:l[a])?void 0:t[o])?void 0:r[s.startRow])?void 0:n[s.startColumn])?void 0:i.f;return u&&this._lexer.treeBuilder(u),t2.create(X.VALUE)}}let i4=class extends ic{constructor(e,t,r){super(),this._functionService=e,this._lexer=t,this._currentConfigService=r}get zIndex(){return io.get(ia.SUFFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tC))return;let t=e.getToken().trim();if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return;let r="";if(t!==es.PERCENTAGE)return t===es.POUND?new i3(this._currentConfigService,this._lexer,t):void 0;r=ip.DIVIDED;let n=this._functionService.getExecutor(r);return n?new i3(this._currentConfigService,this._lexer,t,n):(console.error(`No function ${e}`),iu.create(X.NAME))}};i4=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i2(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&i1(t,r,s),s})([i5(0,im),i5(1,(0,k.Inject)(tk)),i5(2,tL)],i4);var i6=Object.defineProperty,i9=Object.getOwnPropertyDescriptor;class i7 extends il{constructor(e){super(e)}get nodeType(){return ia.UNION}execute(){let e;let t=this.getChildren(),r=t[0],n=t[1],i=r.getValue(),s=n.getValue();if(null==i||null==s)throw Error("leftNode and rightNode");e=this.getToken()===ei.COLON?this._unionFunction(i,s):t2.create(X.NAME),this.setValue(e)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?t2.create(X.REF):function(e,t){let r=`${e.getToken()}:${t.getToken()}`,n=n7.get(r);if(n){let{x:t,y:r}=e.getRefOffset();return n.setRefOffset(t,r),n}let i=t2.create(X.NAME);return(e.isCell()&&t.isCell()||e.isRow()&&t.isRow()||e.isColumn()&&t.isColumn())&&(i=e.unionBy(t),n7.set(r,i)),i}(e,t)}}let i8=class extends ic{constructor(e){super(),this._functionService=e}get zIndex(){return io.get(ia.UNION)||100}create(e){return new i7(e)}checkAndCreateNodeType(e){if(!(e instanceof tC))return;let t=e.getToken().trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&t===ei.COLON)return this.create(t)}};i8=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i9(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&i6(t,r,s),s})([(e,t)=>im(e,t,0)],i8);class se extends il{constructor(e){super(e)}get nodeType(){return ia.VALUE}execute(){this.setValue(n$.create(this.getToken()))}}class st extends ic{get zIndex(){return io.get(ia.VALUE)||100}_checkValueNode(e){if(!Number.isNaN(Number(e)))return this.create(e);{let t=e.trim(),r=t.charAt(0),n=t.charAt(t.length-1);if(K.has(t)||'"'===r&&'"'===n||"{"===r&&"}"===n)return this.create(t);let i=t.toUpperCase();if(i===Y.TRUE||i===Y.FALSE)return this.create(i)}}create(e){return new se(e)}checkAndCreateNodeType(e){if(!(e instanceof tC))return this._checkValueNode(e)}}var sr=Object.defineProperty,sn=Object.getOwnPropertyDescriptor,si=(e,t)=>(r,n)=>t(r,n,e);let ss=class extends k.Disposable{constructor(e,t,r,n,i,s,a,o,l,u,c){super(),G(this,"_astNodeFactoryList",[]),this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=i,this._operatorNodeFactory=s,this._prefixNodeFactory=a,this._referenceNodeFactory=o,this._suffixNodeFactory=l,this._unionNodeFactory=u,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){let t=new ih("R_1"),r=this._parse(e,t);return e.hasDefinedNames()&&(null==r||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(null==t.getLambdaId)return iu.create(X.VALUE);let r=t.getLambdaId(),n=new ih("R_1"),i=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!i)return!1;let s=[...i.keys()],a=e.getChildren(),o=a.length;for(let e=0;e<o;e++){let t=a[e];if(!(t instanceof tC))return!1;{iU(t,r,i),this._parse(t,n);let a=n.getChildren()[e];null!=a&&i.set(s[e],a)}}return n.setParent(t),t}_changeLetToLambda(e){let t=e.getChildren(),r=t.length;if(r%2!=1||0===r)return;let n=new tC;n.setToken(th);let i=new tC;i.setToken("L_1");let s=[...t];for(let e=0;e<r;e++){let t=s[e];if(!(t instanceof tC))return;e%2==0?t.changeToParent(n):t.changeToParent(i)}n.addChildrenFirst(i),i.setParent(n);let a=e.getParent();return null==a||a.replaceChild(e,n),n}_parse(e,t){let r=e.getChildren(),n=r.length,i=[],s=null,a=e.getToken().trim().toUpperCase();if("LET"===a){let r=this._changeLetToLambda(e);return null!=r?this._parse(r,t):iu.create(X.ERROR)}if("P_1"===a){if(s=t,0===n)return new iH("R_1").setParent(t),s}else{if("L_1"===a){let r=this._lambdaParameterHandler(e,t);return!1===r&&(r=iu.create(X.ERROR)),r}if(null==(s=this._checkAstNode(e)))return iu.create(X.NAME)}let o=r[0];for(let e=0;e<n;e++){let t=r[e];if(ix(o)){if(0!==e&&e!==n-1)continue}else if(t instanceof tC&&t.getToken()===tc&&e!==n-1)continue;let a=null;if(t instanceof tC){if((a=this._parse(t,s))===s)continue}else a=this._checkAstNode(t);if(null==a)return iu.create(X.NAME);if(null==(a=function(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}(a)))return;switch(a.nodeType){case ia.FUNCTION:{let e=a.getToken().trim().toUpperCase();td.has(e)&&a.setForcedCalculateFunction(),i.push(a);break}case ia.LAMBDA:case ia.LAMBDA_PARAMETER:i.push(a);break;case ia.OPERATOR:{let e=i.pop(),t=i.pop();t&&t.setParent(a),e&&e.setParent(a),i.push(a);break}case ia.REFERENCE:case ia.ROOT:case ia.UNION:case ia.VALUE:case ia.PREFIX:case ia.SUFFIX:i.push(a)}}let l=i.length;for(let e=0;e<l;e++)i[e].setParent(s);return s}_checkAstNode(e){let t=null,r=this._astNodeFactoryList.length;for(let n=0;n<r&&null==(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e));n++);return null==t?new iS:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(k.sortRules)}};ss=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sn(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sr(t,r,s),s})([si(0,is),si(1,(0,k.Inject)(id)),si(2,(0,k.Inject)(iT)),si(3,(0,k.Inject)(ik)),si(4,(0,k.Inject)(i$)),si(5,(0,k.Inject)(iX)),si(6,(0,k.Inject)(ib)),si(7,(0,k.Inject)(i0)),si(8,(0,k.Inject)(i4)),si(9,(0,k.Inject)(i8)),si(10,(0,k.Inject)(st))],ss);class sa extends k.Disposable{constructor(){super(...arguments),G(this,"_otherFormulaData",/* @__PURE__ */new Map),G(this,"_featureFormulaData",/* @__PURE__ */new Map),G(this,"_formulaData",/* @__PURE__ */new Map),G(this,"_definedNameMap",/* @__PURE__ */new Map),G(this,"_otherFormulaDataMainData",/* @__PURE__ */new Set),G(this,"_dependencyRTreeCache",new k.RTree),G(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw Error("Method not implemented.")}getTreeById(e){throw Error("Method not implemented.")}getAllTree(){throw Error("Method not implemented.")}reset(){throw Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw Error("Method not implemented.")}addFormulaDependency(e,t,r,n,i){throw Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}clearFormulaDependency(e,t){throw Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._otherFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._featureFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}getFormulaDependency(e,t,r,n){var i,s;return null==(s=null==(i=this._formulaData.get(e))?void 0:i.get(t))?void 0:s.getValue(r,n)}addDependencyRTreeCache(e){let t=[];for(let r=0;r<e.rangeList.length;r++){let{unitId:n,sheetId:i,range:s}=e.rangeList[r];t.push({unitId:n,sheetId:i,range:s,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){let e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,/* @__PURE__ */new Map);let n=this._definedNameMap.get(e);n.has(t)||n.set(t,/* @__PURE__ */new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){let r=e.treeId;for(let n of(null==t?void 0:t.getDefinedNames())||[])this._addDefinedName(e.unitId,n,r)}}class so extends sa{constructor(){super(...arguments),G(this,"_allTreeMap",/* @__PURE__ */new Map)}dispose(){this.reset()}buildDependencyTree(e,t=[]){let r=this.getAllTree();return 0===e.length?this._buildReverseDependency(r,t):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e)),r}_buildDependencyTree(e,t){let r=/* @__PURE__ */new Map;for(let e=0;e<t.length;e++){let n=t[e];r.set(n.treeId,n)}for(let t=0;t<e.length;t++){let n=e[t],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}_buildReverseDependency(e,t){let r=/* @__PURE__ */new Map;for(let t=0;t<e.length;t++){let n=e[t];r.set(n.treeId,n)}for(let e=0;e<t.length;e++){let n=t[e],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}getAllTree(){let e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId(),this._otherFormulaDataMainData.clear()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,/* @__PURE__ */new Map);let i=this._otherFormulaData.get(e);i.has(t)||i.set(t,/* @__PURE__ */new Map);let s=i.get(t);s.has(r)||s.set(r,new k.ObjectMatrix),s.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){let n=this._otherFormulaData.get(e);if(n&&n.has(t)){let i=n.get(t);r.forEach(e=>{let t=i.get(e);null!=t&&(t.forValue((e,t,r)=>{this._removeDependencyRTreeCache(r),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),i.delete(e),this._otherFormulaDataMainData.delete(e))}),0===i.size&&n.delete(t),0===n.size&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){let r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}n.clear()}else if(r){for(let t of r.keys()){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,/* @__PURE__ */new Map);let i=this._featureFormulaData.get(e);i.has(t)||i.set(t,/* @__PURE__ */new Map),i.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){let n=this._featureFormulaData.get(e);if(n&&n.has(t)){let e=n.get(t);r.forEach(t=>{let r=e.get(t);null!=r&&(this._removeDependencyRTreeCache(r),e.delete(t),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r))})}}clearFeatureFormulaDependency(e,t){let r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))}),n.clear()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,i){this._formulaData.has(e)||this._formulaData.set(e,/* @__PURE__ */new Map);let s=this._formulaData.get(e);s.has(t)||s.set(t,new k.ObjectMatrix),s.get(t).setValue(r,n,i.treeId),this._addAllTreeMap(i)}removeFormulaDependency(e,t,r,n){let i=this._formulaData.get(e);if(i&&i.has(t)){let e=i.get(t),s=e.getValue(r,n);if(null==s)return;this._removeDependencyRTreeCache(s),e.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s)}}clearFormulaDependency(e,t){let r=this._formulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),n.reset()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(null==e)return;let t=e.parents,r=e.children,n=this._allTreeMap;for(let r of t){let t=n.get(r);null==t||t.children.delete(e.treeId)}for(let t of r){let r=n.get(t);null==r||r.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(null==e)return;let t=this._allTreeMap.get(e);if(t){let r=[];for(let n=0;n<t.rangeList.length;n++){let{unitId:i,sheetId:s,range:a}=t.rangeList[n];r.push({unitId:i,sheetId:s,range:a,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){let r=this._definedNameMap.get(e);if(r){let e=r.get(t);if(e){for(let t of e)this._removeDependencyRTreeCache(t),this.clearDependencyForTree(this._allTreeMap.get(t)),this._removeAllTreeMap(t);e.clear()}}}_removeAllTreeMap(e){null!=e&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}let sl=(0,k.createIdentifier)("univer.formula.dependency-manager.service");class su extends k.Disposable{constructor(){super(...arguments),G(this,"_referenceExecutorMap",/* @__PURE__ */new Map),G(this,"_onChanged$",new B.Subject),G(this,"onChanged$",this._onChanged$.asObservable())}dispose(){this._referenceExecutorMap.clear()}remove(e,t,r){r.forEach(r=>{var n,i;null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))||i.delete(r)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,i;return null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))?void 0:i.get(r)}has(e,t,r){var n,i;return!!(null!=(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))&&i.has(r))}register(e,t,r,n){let i=this._referenceExecutorMap.get(e);i||(i=/* @__PURE__ */new Map,this._referenceExecutorMap.set(e,i));let s=i.get(t);s||(s=/* @__PURE__ */new Map,i.set(t,s)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),s.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}let sc=(0,k.createIdentifier)("univer.formula.feature-calculation-manager.service");class sh extends k.Disposable{constructor(){super(...arguments),G(this,"_otherFormulaData",{})}dispose(){this._otherFormulaData={}}remove(e){var t,r,n;let{unitId:i,subUnitId:s,formulaId:a}=e;null==(n=null==(r=null==(t=this._otherFormulaData)?void 0:t[i])?void 0:r[s])||delete n[a]}get(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s]}has(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return(null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s])!=null}register(e){let{unitId:t,subUnitId:r,formulaId:n,item:i}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=i}batchRegister(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{let i=n[r];if(null==i)return!0;this.register({unitId:t,subUnitId:e,formulaId:r,item:i})})})})}batchRemove(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{this.remove({unitId:t,subUnitId:e,formulaId:r})})})})}getOtherFormulaData(){return this._otherFormulaData}}let sd=(0,k.createIdentifier)("univer.formula.other-formula-manager.service"),sm=new tl(5e3);function sg(e,t,r,n,i){let s=sm.get(`${e}${t}`);if(s&&!sf(s,i))return s;let a=r.treeBuilder(t);if(K.has(a))return iu.create(a);if(null==(s=n.parse(a)))throw Error("astNode is null");return sm.set(`${e}${t}`,s),s}function sf(e,t){let r=t.getDirtyDefinedNameMap(),n=t.getExecuteUnitId();if(null!=n&&null!=r[n]){let t=Object.keys(r[n]);for(let r=0,n=t.length;r<n;r++){let n=t[r];if(e.hasDefinedName(n))return!0}}return!1}var sp=((A=sp||{})[A.NORMAL_FORMULA=0]="NORMAL_FORMULA",A[A.OTHER_FORMULA=1]="OTHER_FORMULA",A[A.FEATURE_FORMULA=2]="FEATURE_FORMULA",A);class sC{constructor(){G(this,"_state",0),G(this,"treeId"),G(this,"children",/* @__PURE__ */new Set),G(this,"parents",/* @__PURE__ */new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return 1===this._state}setSkip(){this._state=2}isSkip(){return 2===this._state}pushChildren(e){this.children.add(e.treeId),e._pushParent(this)}hasChildren(e){return this.children.has(e)}_pushParent(e){this.parents.add(e.treeId)}}class s_ extends sC{constructor(){super(...arguments),G(this,"refTree"),G(this,"refOffsetX",-1),G(this,"refOffsetY",-1),G(this,"isCache",!1),G(this,"isDirty",!1),G(this,"getDirtyData"),G(this,"featureId")}get isVirtual(){return!0}get row(){return null==this.refTree?-1:this.refTree.row+this.refOffsetY}get column(){return null==this.refTree?-1:this.refTree.column+this.refOffsetX}get rowCount(){return null==this.refTree?0:this.refTree.rowCount}get columnCount(){return null==this.refTree?0:this.refTree.columnCount}get unitId(){return null==this.refTree?"":this.refTree.unitId}get subUnitId(){return null==this.refTree?"":this.refTree.subUnitId}get formula(){var e,t;return null!=(t=null==(e=this.refTree)?void 0:e.formula)?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return null==(e=this.refTree)?void 0:e.node}dispose(){this.refTree=null}get rangeList(){let e=[];if(null==this.refTree)return[];for(let t=0;t<this.refTree.rangeList.length;t++){let r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:(0,k.moveRangeByOffset)(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){return null!=this.refTree&&this.refTree.dependencySheetName(e)}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=Number.POSITIVE_INFINITY),Number.isNaN(h)&&(h=Number.POSITIVE_INFINITY);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}get formulaId(){return null==this.refTree?"":this.refTree.formulaId}}class sy extends sC{constructor(e){super(),G(this,"isCache",!1),G(this,"featureId"),G(this,"featureDirtyRanges",[]),G(this,"refOffsetX",0),G(this,"refOffsetY",0),G(this,"type",0),G(this,"formulaId"),G(this,"subUnitId",""),G(this,"unitId",""),G(this,"rangeList",[]),G(this,"formula",""),G(this,"row",-1),G(this,"column",-1),G(this,"rowCount",Number.NEGATIVE_INFINITY),G(this,"columnCount",Number.NEGATIVE_INFINITY),G(this,"isDirty",!1),G(this,"node"),G(this,"getDirtyData"),this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.getDirtyData=null}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){var t;let r=this.rangeList;if(0===r.length||null==e)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s}=r[n];if((null==(t=e[i])?void 0:t[s])!=null)return!0}return!1}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=Number.POSITIVE_INFINITY),Number.isNaN(h)&&(h=Number.POSITIVE_INFINITY);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return 0===this.rangeList.length&&2!==this.type}toRTreeItem(){if(null!=this.featureId)return this.featureDirtyRanges;let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var sE=Object.defineProperty,sb=Object.getOwnPropertyDescriptor,sR=(e,t)=>(r,n)=>t(r,n,e);function sN(e){return e.getLastTreeId()||0}let sI=(0,k.createIdentifier)("engine-formula.dependency-generator"),sA=class extends k.Disposable{constructor(e,t,r,n,i,s,a,o){super(),G(this,"_updateRangeFlattenCache",/* @__PURE__ */new Map),this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=i,this._astTreeBuilder=s,this._lexer=a,this._dependencyManagerService=o}dispose(){this._updateRangeFlattenCache.clear()}async generate(){this._updateRangeFlatten();let e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();null!=r&&Object.keys(r).forEach(e=>{null!=e&&Object.keys(r[e]).forEach(t=>{null!=t&&(this._dependencyManagerService.clearOtherFormulaDependency(e,t),this._dependencyManagerService.clearFeatureFormulaDependency(e,t),this._dependencyManagerService.clearFormulaDependency(e,t))})});let n=this._currentConfigService.getUnitData(),i=await this._generateTreeList(e,t,n),s=this._getUpdateTreeListAndMakeDependency(i),a=this._calculateRunList(s);return this._dependencyFeatureCalculation(a)&&(a.forEach(e=>{e.resetState()}),a=this._calculateRunList(a)),this._checkIsCycleDependency(a)&&this._runtimeService.enableCycleDependency(),Promise.resolve(a)}_dependencyFeatureCalculation(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();if(0===t.size)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((t,n)=>{t.forEach((t,n)=>{t.forEach((t,n)=>{let{unitId:i,subUnitId:s,getDirtyData:a}=t,o=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),l=this._convertDirtyRangesToUnitRange(o.dirtyRanges),u=this._intersectFeatureCalculation(l,e,{unitId:i,subUnitId:s,featureId:n});if(u.length>0){let a=this._getExistTreeList({unitId:i,subUnitId:s,featureId:n},e);null==a&&(a=this._getFeatureFormulaTree(n,sN(this._dependencyManagerService),t),e.push(a)),a.parents=/* @__PURE__ */new Set,u.forEach(e=>{e.hasChildren(a.treeId)||e.pushChildren(a)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(e=>{var r,n,i,s;let a=/* @__PURE__ */new Set;for(let i of e.children){let s=this._dependencyManagerService.getTreeById(i);s&&(s.featureId&&null!=(n=null==(r=t.get(e.unitId))?void 0:r.get(e.subUnitId))&&n.has(s.featureId)||a.add(i))}e.children=a;let o=/* @__PURE__ */new Set;for(let r of e.parents){let n=this._dependencyManagerService.getTreeById(r);n&&(n.featureId&&null!=(s=null==(i=t.get(e.unitId))?void 0:i.get(e.subUnitId))&&s.has(n.featureId)||o.add(r))}e.parents=o})}_convertDirtyRangesToUnitRange(e){let t=[];for(let r in e){let n=e[r];for(let e in n)for(let i of n[e])t.push({unitId:r,sheetId:e,range:i})}return t}_intersectFeatureCalculation(e,t,r){let n=[],i=this._dependencyManagerService.searchDependency(e);for(let e=0,s=t.length;e<s;e++){let s=t[e];(s.unitId!==r.unitId||s.subUnitId!==r.subUnitId||s.featureId!==r.featureId)&&i.has(s.treeId)&&n.push(s)}return n}_getExistTreeList(e,t){let{unitId:r,subUnitId:n,featureId:i}=e;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s.unitId===r&&s.subUnitId===n&&s.featureId===i)return s}}_isCyclicUtil(e,t,r){let n=this._dependencyManagerService.getTreeById(e);if(null==n)return!1;if(!t.has(n.treeId)){for(let e of(t.add(n.treeId),r.add(n.treeId),n.children))if(!t.has(e)&&this._isCyclicUtil(e,t,r)||r.has(e))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){let t=/* @__PURE__ */new Set,r=/* @__PURE__ */new Set;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(!0===this._isCyclicUtil(i.treeId,t,r))return!0}return!1}async _generateTreeList(e,t,r){let n=Object.keys(e),i=Object.keys(t),s=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,s),this._registerOtherFormulas(t,i,s),this._registerFeatureFormulas(s);for(let e=0,t=s.length;e<t;e++){let t=s[e],r=t.node;if(null==r||(t.isDirty=this._includeTree(t,r),t.isVirtual))continue;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let n=await this._getRangeListByNode({node:r,refOffsetX:t.refOffsetX,refOffsetY:t.refOffsetY});t.pushRangeList(n)}for(let e=0,t=s.length;e<t;e++){let t=s[e];t.isCache||this._dependencyManagerService.addDependencyRTreeCache(t)}return s}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((t,r)=>{t.forEach((t,r)=>{t.forEach((t,r)=>{let n=this._dependencyManagerService.getFeatureFormulaDependency(t.unitId,t.subUnitId,r);e.push(this._getFeatureFormulaTree(r,n,t))})})})}_getFeatureFormulaTree(e,t,r){let{unitId:n,subUnitId:i,dependencyRanges:s,getDirtyData:a}=r,o=new sy(t||sN(this._dependencyManagerService));o.unitId=n,o.subUnitId=i,o.rangeList=s,o.getDirtyData=a;let l=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),u=this._convertDirtyRangesToUnitRange(l.dirtyRanges);return o.featureDirtyRanges=u,o.featureId=e,o.type=sp.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,i,e,o),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(o.isCache=!0),o}_registerOtherFormulas(e,t,r){for(let n of t){let t=e[n];if(null!=t)for(let e of Object.keys(t)){let i=t[e];if(null!=i)for(let t of Object.keys(i)){let s=this._dependencyManagerService.hasOtherFormulaDataMainData(t),{f:a,ranges:o}=i[t],l=!1;s&&(l=!0);let u=sg(n,a,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:c,firstColumn:h}=this._getFirstCellOfRange(o),d=this._dependencyManagerService.getOtherFormulaDependency(n,e,t),m=new sy((null==d?void 0:d.getValue(0,0))||sN(this._dependencyManagerService));for(let i=0;i<o.length;i++){let{startRow:s,startColumn:g,endRow:f,endColumn:p}=o[i];for(let i=s;i<=f;i++)for(let s=g;s<=p;s++){let o=s-h,g=i-c;if(0===o&&0===g){m.node=u,m.formula=a,m.unitId=n,m.subUnitId=e,m.formulaId=t,m.type=sp.OTHER_FORMULA,m.isCache=l,r.push(m),this._dependencyManagerService.addOtherFormulaDependency(n,e,t,m),this._dependencyManagerService.addFormulaDependencyByDefinedName(m);continue}let f=new s_;f.treeId=(null==d?void 0:d.getValue(o,g))||sN(this._dependencyManagerService),f.refTree=m,f.refOffsetX=o,f.refOffsetY=g,f.isCache=l,this._dependencyManagerService.addOtherFormulaDependency(n,e,t,f),this._dependencyManagerService.addFormulaDependencyByDefinedName(f),r.push(f)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(t)}}}}_getFirstCellOfRange(e){let t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(let i of e){let e=t[i];if(null!=e)for(let t of Object.keys(e)){let s=new k.ObjectMatrix(e[t]||{}),a=/* @__PURE__ */new Map;s.forValue((e,s,o)=>{if(null==o)return!0;let{x:l=0,y:u=0,si:c}=o;if(!(0===l&&0===u&&null!=c))return!0;let h=this._createFDtree(i,t,e,s,r,o),d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?h.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,h),this._dependencyManagerService.addFormulaDependencyByDefinedName(h)),a.set(c,h),n.push(h)}),s.forValue((e,s,o)=>{let l;if(null==o)return!0;let{x:u=0,y:c=0,si:h}=o;if(0===u&&0===c&&null!=h)return!0;if(h&&a.has(h)){let e=a.get(h);l=this._createVirtualFDtree(e,o)}else l=this._createFDtree(i,t,e,s,r,o);let d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?l.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,l),this._dependencyManagerService.addFormulaDependencyByDefinedName(l)),n.push(l)}),a.clear()}}}_createFDtree(e,t,r,n,i,s){let{f:a,x:o=0,y:l=0}=s,u=new sy(sN(this._dependencyManagerService)),c=i[e][t],h=sg(e,a,this._lexer,this._astTreeBuilder,this._currentConfigService);return u.node=h,u.formula=a,u.unitId=e,u.subUnitId=t,u.row=r,u.column=n,u.rowCount=c.rowCount,u.columnCount=c.columnCount,u}_createVirtualFDtree(e,t){let{x:r=0,y:n=0}=t,i=new s_;return i.treeId=sN(this._dependencyManagerService),i.refTree=e,i.refOffsetX=r,i.refOffsetY=n,i}_updateRangeFlatten(){let e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let e=0;e<t.length;e++){let r=t[e],n=r.range,i=r.sheetId,s=r.unitId;this._addFlattenCache(s,i,n)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);null==n&&(n=/* @__PURE__ */new Map,this._updateRangeFlattenCache.set(e,n));let i=n.get(t);null==i&&(i=[],n.set(t,i)),i.push(r)}_isPreCalculateNode(e){return e.nodeType===ia.UNION||e.nodeType===ia.PREFIX&&e.getToken()===eo.AT||e.nodeType===ia.SUFFIX&&e.getToken()===es.POUND}_nodeTraversalRef(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(this._isPreCalculateNode(n)){t.push(n);continue}n.nodeType===ia.REFERENCE&&t.push(n),this._nodeTraversalRef(n,t)}}_nodeTraversalReferenceFunction(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(n.nodeType===ia.FUNCTION&&n.isAddress()){t.push(n);continue}this._nodeTraversalReferenceFunction(n,t)}}async _executeNode(e,t=0,r=0){let n={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?await this._interpreter.executeAsync(n):this._interpreter.execute(n)}async _getRangeListByNode(e){let t=[],r=[],n=e.refOffsetX,i=e.refOffsetY,s=e.node;if(null==s)return[];this._nodeTraversalRef(s,t),this._nodeTraversalReferenceFunction(s,r);let a=[];for(let e=0,r=t.length;e<r;e++){let r=t[e],s=(await this._executeNode(r,n,i)).toUnitRange();a.push(s),r.setValue(null)}for(let e=0,t=r.length;e<t;e++){let t=r[e],s=(await this._executeNode(t,n,i)).toUnitRange();a.push(s),t.setValue(null)}return a}_getUpdateTreeListAndMakeDependency(e){let t=[],r=/* @__PURE__ */new Set,n=this._currentConfigService.isForceCalculate(),i=this._currentConfigService.getDirtyRanges(),s=this._dependencyManagerService.searchDependency(i);for(let i of this._dependencyManagerService.buildDependencyTree(e)){let e=i.treeId;(n||i.isDirty||i.dependencySheetName(this._currentConfigService.getDirtyNameMap())||s.has(e)&&!i.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(e)&&(t.push(i),r.add(e))}return t}_includeTreeFeature(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.featureId;if(null!=s){let e=this._currentConfigService.getDirtyUnitFeatureMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_includeOtherFormula(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.formulaId;if(null!=s){let e=this._currentConfigService.getDirtyUnitOtherFormulaMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return null!=t&&this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;let t=e.getChildren();for(let e=0,r=t.length;e<r;e++){let r=t[e];if(this._detectForcedRecalculationNodeRecursion(r))return!0}return!1}_includeTree(e,t){var r,n,i,s;let a=e.unitId,o=e.subUnitId;if(!0===this._detectForcedRecalculationNode(e,t)||!0===this._includeTreeFeature(e)||!0===this._includeOtherFormula(e)||!0==(s=this._currentConfigService,!!(null!=t&&sf(t,s))))return!0;let l=null==(n=null==(r=this._currentConfigService.getExcludedRange())?void 0:r[a])?void 0:n[o];if((null==l?void 0:l.getValue(e.row,e.column))!=null)return!1;if((null==(i=this._currentConfigService.getDirtyNameMap()[a])?void 0:i[o])!=null)return!0;if(!this._updateRangeFlattenCache.has(a))return!1;let u=this._updateRangeFlattenCache.get(a);if(!u.has(o))return!1;for(let t of u.get(o))if(e.inRangeData(t))return!0;return!1}_calculateRunList(e){let t=[],r=[];for(;e.length>0;){let n=e.pop();if(!(void 0===n||n.isSkip())){if(n.isAdded()){t.push(n),n.setSkip();continue}for(let e of(r.length=0,n.parents)){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||n.isSkip()||r.push(t)}0===r.length?(t.push(n),n.setSkip()):(n.setAdded(),e.push(n,...r))}}return t}};sA=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sb(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sE(t,r,s),s})([sR(0,tL),sR(1,is),sR(2,sd),sR(3,sc),sR(4,(0,k.Inject)(iw)),sR(5,(0,k.Inject)(ss)),sR(6,(0,k.Inject)(tk)),sR(7,sl)],sA);var sv=Object.defineProperty,sS=Object.getOwnPropertyDescriptor,sT=(e,t)=>(r,n)=>t(r,n,e);let sO=(0,k.createIdentifier)("engine-formula.calculate-formula.service"),sM=class extends k.Disposable{constructor(e,t,r,n,i,s,a){super(),G(this,"_executionInProgressListener$",new B.Subject),G(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),G(this,"_executionCompleteListener$",new B.Subject),G(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=i,this._interpreter=s,this._astTreeBuilder=a}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(it.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();let t=this._configService.getConfig("CYCLE_REFERENCE_COUNT")||1;for(let e=0;e<t&&(this._runtimeService.setFormulaCycleIndex(e),await this._execute(),nH.clear(),this._runtimeService.isCycleDependency());e++);this._runtimeService.setFormulaExecuteStage(it.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),tO.clear(),this._runtimeService.reset()}async _execute(){let e=await this._apply();if(null==e)return;let{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:i}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return null==n||0===n.length||(this._currentConfigService.loadDirtyRangesAndExcludedCell(n,i),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){let r=[],n={};return Object.keys(e).forEach(t=>{let i=e[t];if(null==i)return!0;Object.keys(i).forEach(e=>{let s=new k.ObjectMatrix(i[e]);if(null==s)return!0;let a=new k.ObjectMatrix;s.forValue((n,i,s)=>{a.setValue(n,i,!0),r.push({unitId:t,sheetId:e,range:s})}),null==n[t]&&(n[t]={}),n[t][e]=a})}),Object.keys(t).forEach(e=>{let n=t[e];Object.keys(n).forEach(e=>{let t=n[e];if(null==t)return!0;Object.keys(t).forEach(n=>{let i=t[n];if(null==i)return!0;for(let t of i)r.push({unitId:e,sheetId:n,range:t})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(it.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(it.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(it.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(it.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[],i=this._configService.getConfig(tM),s=(null==i?void 0:i.intervalCount)||500,a=t.length;for(let i=0;i<a;i++){let a;let o=t[i],l=o.nodeData,u=o.getDirtyData;if(i%s==0&&(await new Promise(e=>{let t=(0,k.requestImmediateMacroTask)(e);n.push(t)}),e?(this._runtimeService.setFormulaExecuteStage(it.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(i+1)):(this._runtimeService.setFormulaExecuteStage(it.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(i+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||null==l&&null==u)){this._runtimeService.setFormulaExecuteStage(it.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}if(this._runtimeService.setCurrent(o.row,o.column,o.rowCount,o.columnCount,o.subUnitId,o.unitId),null!=u&&null!=o.featureId){let{runtimeCellData:e,dirtyRanges:t}=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(o.featureId,e),this._runtimeService.setRuntimeFeatureRange(o.featureId,t)}else null!=l&&(a=r.checkAsyncNode(l.node)?await r.executeAsync(l):r.execute(l),null!=o.formulaId?this._runtimeService.setRuntimeOtherData(o.formulaId,o.refOffsetX,o.refOffsetY,a):this._runtimeService.setRuntimeData(a))}return n.forEach(e=>e()),n=[],a>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){let r=this._lexer.treeBuilder(e,t);if(Object.values(X).includes(r))return iu.create(r);let n=this._astTreeBuilder.parse(r);null==n||n.serialize()}};sM=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sS(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sv(t,r,s),s})([sT(0,k.IConfigService),sT(1,(0,k.Inject)(tk)),sT(2,tL),sT(3,is),sT(4,sI),sT(5,(0,k.Inject)(iw)),sT(6,(0,k.Inject)(ss))],sM);var sw=Object.defineProperty,sx=Object.getOwnPropertyDescriptor,sU=(e,t)=>(r,n)=>t(r,n,e);let sD=class extends k.Disposable{constructor(e,t,r){super(),this._commandService=e,this._calculateFormulaService=t,this._formulaDataModel=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===e8.id)this._calculateFormulaService.stopFormulaExecution();else if(e.id===tr.id){let t=e.params.formulaData;this._formulaDataModel.mergeFormulaData(t)}else if(e.id===e7.id){let t=e.params;this._calculate(t)}else if(e.id===eD.id){let t=e.params;if(null==t)return;let{arrayFormulaRange:r,arrayFormulaCellData:n}=t;this._formulaDataModel.setArrayFormulaRange(r),this._formulaDataModel.setArrayFormulaCellData(n)}}))}async _calculate(e){let{forceCalculation:t=!1,dirtyRanges:r=[],dirtyNameMap:n={},dirtyDefinedNameMap:i={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:o={}}=e,l=this._formulaDataModel.getFormulaData(),u=this._formulaDataModel.getArrayFormulaCellData(),c=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:l,arrayFormulaCellData:u,arrayFormulaRange:c,forceCalculate:t,dirtyRanges:r,dirtyNameMap:n,dirtyDefinedNameMap:i,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:o})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(e=>{let t=e.functionsExecutedState;switch(t){case ir.NOT_EXECUTED:case ir.STOP_EXECUTION:break;case ir.SUCCESS:this._applyResult(e);case ir.INITIAL:}this._commandService.executeCommand(te.id,{functionsExecutedState:t},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(e=>{this._commandService.executeCommand(te.id,{stageInfo:e},{onlyLocal:!0})})}async _applyResult(e){let{unitData:t,unitOtherData:r,arrayFormulaRange:n,arrayFormulaCellData:i,clearArrayFormulaCellData:s}=e;if(!t){console.error("No sheetData from Formula Engine!");return}n&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(i),this._formulaDataModel.mergeArrayFormulaRange(n),this._commandService.executeCommand(eD.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(tt.id,{unitData:function(e){let t={};for(let r in e){let n=e[r];if(null!=n)for(let e in null==t[r]&&(t[r]={}),n){let i=n[e],s={};i.forValue((e,t,r)=>{void 0===s[e]&&(s[e]={}),s[e][t]=r}),t[r][e]=s}}return t}(t),unitOtherData:r},{onlyLocal:!0})}};sD=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sx(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sw(t,r,s),s})([sU(0,k.ICommandService),sU(1,sO),sU(2,(0,k.Inject)(tI))],sD);var sV=Object.defineProperty,sL=Object.getOwnPropertyDescriptor,sP=(e,t)=>(r,n)=>t(r,n,e);let sj=class extends k.Disposable{constructor(e,t){super(),this._commandService=e,this._definedNamesService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===e3.id){let t=e.params;if(null==t)return;let{id:r,unitId:n,name:i,formulaOrRefString:s,comment:a,hidden:o,localSheetId:l}=t;this._definedNamesService.registerDefinedName(n,{id:r,name:i.trim(),formulaOrRefString:s.trim(),comment:null==a?void 0:a.trim(),hidden:o,localSheetId:l})}else if(e.id===e4.id){let t=e.params;if(null==t)return;let{unitId:r,id:n}=t;this._definedNamesService.removeDefinedName(r,n)}}))}};sj=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sL(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&sV(t,r,s),s})([sP(0,k.ICommandService),sP(1,e2)],sj);let sF=/[\[\]]/g;function sk(e,t){return sF.test(e)?t+Number(e.replace(sF,"")):Number(e)-1}function sB(e,t=0,r=0){let n=(e=e.toLocaleUpperCase()).split(/[RC]/),i=n[1],s=n[2];return{row:sk(i,t),column:sk(s,r),absoluteRefType:k.AbsoluteRefType.NONE}}function s$(e,t=k.AbsoluteRefType.ALL,r){switch(e+=1,t){case k.AbsoluteRefType.ALL:return`${e}`;case k.AbsoluteRefType.ROW:return r?`${e}`:`[${e}]`;case k.AbsoluteRefType.COLUMN:return r?`[${e}]`:`${e}`;case k.AbsoluteRefType.NONE:return`[${e}]`}}function sH(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return t2.create(X.VALUE);t=e.get(0,0)}return t.isError(),t}function sW(...e){for(let t=0;t<e.length;t++){let r=sH(e[t]);if(r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}function sG(...e){for(let t=0;t<e.length;t++){let r=sH(e[t]);if(r.isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sY(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return{isError:!0,errorObject:r};if(r.isNull())return{isError:!0,errorObject:t2.create(X.NA)};if((r=sH(e[t])).isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sz(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}class sq{constructor(e){G(this,"_unitId"),G(this,"_subUnitId"),G(this,"_row",-1),G(this,"_column",-1),G(this,"_definedNames"),G(this,"_locale"),G(this,"_sheetOrder"),G(this,"_sheetNameMap"),G(this,"_formulaDataModel"),G(this,"_rowCount",-1),G(this,"_columnCount",-1),G(this,"needsExpandParams",!1),G(this,"needsReferenceObject",!1),G(this,"needsLocale",!1),G(this,"needsSheetsInfo",!1),G(this,"needsFormulaDataModel",!1),G(this,"needsSheetRowColumnCount",!1),G(this,"minParams",-1),G(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(e){var t;let r=this._definedNames;return null==r?null:null==(t=Array.from(Object.values(r)).filter(t=>t.name===e))?void 0:t[0]}setDefinedNames(e){this._definedNames=e}getLocale(){return this._locale}setLocale(e){this._locale=e}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:e,sheetNameMap:t}){this._sheetOrder=e,this._sheetNameMap=t}setFormulaDataModel(e){this._formulaDataModel=e}setSheetRowColumnCount(e,t){this._rowCount=e,this._columnCount=t}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}setRefInfo(e,t,r,n){this._unitId=e,this._subUnitId=t,this._row=r,this._column=n}calculateCustom(...e){return null}calculate(...e){return t2.create(X.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return!1===r.getValue()?t2.create(X.VALUE):t;if(r.isString()){let e=Number(r.getValue());return Number.isNaN(e)?t2.create(X.REF):e}return r.isNumber()?r.getValue():t2.create(X.VALUE)}getZeroOrOneByOneDefault(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;e.isNumber()&&0===e.getValue()&&(t=0)}return t}getMatchTypeValue(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;if(e.isNumber()){let r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,n,i){let s;let a=t.binarySearch(e,n,i);return null==a?t2.create(X.NA):(s=1===r.getRowCount()?r.get(0,a)||nx.create():r.get(a,0)||nx.create()).isNull()?nV.create(0):s}_getOneFirstByRaw(e){return 0===e.length?t2.create(X.NA):e[0][0]||t2.create(X.NA)}_getOneLastByRaw(e){return 0===e.length?t2.create(X.NA):e[e.length-1][e[0].length-1]||t2.create(X.NA)}equalSearch(e,t,r,n=!0){let i=r.pickRaw(t.isEqual(e));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}fuzzySearch(e,t,r,n=!0){let i=r.pickRaw(t.compare(e,ee.EQUALS));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}orderSearch(e,t,r,n=t3.MIN,i=!1){let s=t.orderSearch(e,n,i);if(null==s)return t2.create(X.NA);let a=r.get(s.row,s.column)||nx.create();return a.isNull()?t2.create(X.NA):a}binarySearchExpand(e,t,r,n=0,i,s){let a=t.binarySearch(e,i,s);return null==a?t2.create(X.NA):0===n?r.slice([a,a+1]):r.slice(void 0,[a,a+1])}equalSearchExpand(e,t,r,n=!0,i=0){let s;let a=t.isEqual(e);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?t2.create(X.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}fuzzySearchExpand(e,t,r,n=!0,i=0){let s;let a=t.compare(e,ee.EQUALS);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?t2.create(X.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}orderSearchExpand(e,t,r,n=t3.MIN,i=!1,s=0){let a=t.orderSearch(e,n,i);return null==a?t2.create(X.NA):0===s?r.slice([a.row,a.row+1]):r.slice(void 0,[a.column,a.column+1])}flattenArray(e,t=!0){let r=[];r[0]=[];for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean()||i.isNull())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){let e;if(i.iterator(n=>!!(null==n||n.isNull()||t&&(n.isString()||n.isBoolean()))||((n=this._includingLogicalValuesAndText(n)).isError()?(e=n,!1):void r[0].push(n))),null!=e&&e.isError())return e}else r[0].push(i)}return nZ(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=function(e){let t=e.getValue(),r=0;return t&&(r=1),nV.create(r)}(e)),e.isString()){let t=Number(e.getValue());e=nV.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){let r;let n=e.getForcedUnitId(),i=e.getForcedSheetId()||"",s=eH({unitId:n,sheetName:e.getForcedSheetName(),range:t});return r=eT(s)?new nq(s):ew(s)?new nK(s):ex(s)?new nX(s):new nz(t,i,n),this._setReferenceDefault(e,r)}_setReferenceDefault(e,t){return null==this.unitId||null==this.subUnitId?t2.create(X.REF):(t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(e.getRuntimeArrayFormulaCellData()),t)}}var sX=((v=sX||{}).ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",v.FLATTEN="FLATTEN",v);let sK=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;let{isError:n,errorObject:i,variants:s}=sW(t,r);if(n)return i;let{isError:a,errorObject:o,variants:l}=sz(...s);if(a)return o;let[u,c]=l,h=Math.floor(+u.getValue()),d=Math.floor(+c.getValue());if(h<0||d<0)return t2.create(X.NUM);if(0===h||0===d)return t2.create(X.REF);let m=e.isArray()?e.getRowCount():1,g=e.isArray()?e.getColumnCount():1;return 1===m&&1===g?e.isArray()?e.get(0,0):e:e.slice([0,h>m?m:h],[0,d>g?g:d])}},sX.ARRAY_CONSTRAIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r],i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<i;e++)for(let r=0;r<s;r++){let i=n.isArray()?n.get(e,r):n;t.push([i])}}return nB.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},sX.FLATTEN]];function sQ(e){return/^[01]{1,10}$/.test(e)}function sZ(e){return/^[0-7]{1,10}$/.test(e)}function sJ(e){return/^[0-9A-Fa-f]{1,10}$/.test(e)}function s0(e){if(0===e)return 0;let t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-946595344482036e-18,366839497852761e-18,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],r=e,n=!1;r<0&&(r=-r,n=!0);let i=2/(2+r),s=4*i-2,a=0,o=0,l;for(let e=t.length-1;e>0;e--)l=a,a=s*a-o+t[e],o=l;let u=i*Math.exp(-r*r+.5*(t[0]+s*a)-o);return n?u-1:1-u}function s1(e,t=1){let r=Math.floor(e);if(e<0)return Number.NaN;let n=1;for(;r>1&&Number.isFinite(n);)n*=r,r-=t;return n}function s2(e,t){let r=Math.min(e-t,t),n=1;for(let t=1;t<=r&&Number.isFinite(n);t++)n*=e-t+1,n/=t;return n}function s5(e,t){let r=Math.floor(e),n=Math.floor(t);for(;0!==n;){let e=n;n=r%n,r=e}return r}function s3(e,t){let r=s5(e,t);return 0===r?0:Math.abs(e*t)/r}function s4(e){let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let r=0;for(let n=0;n<t;n++)r+=(n%2==0?1:-1)*e[0][n]*s4(s6(e,0,n));return r}function s6(e,t,r){return e.filter((e,r)=>r!==t).map(e=>e.filter((e,t)=>t!==r))}function s9(e,t){return e.map(e=>t[0].map((r,n)=>e.reduce((e,r,i)=>e+r*t[i][n],0)))}function s7(e){return e[0].map((t,r)=>e.map(e=>e[r]))}function s8(e,t,r){let n=[];for(let i=0;i<e;i++){n[i]=[];for(let e=0;e<t;e++)n[i].push(r)}return n}function ae(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0!==t?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}function at(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[a][n]*e[a][i];return s}function ar(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[n][a]*e[i][a];return s}(e=>{function t(e,t){let r=0;for(let n=0;n<e.length;++n)r=t*r+e[n];return r}function r(e,t,r,n,i){if(0===t)return r;if(1===t)return n;let s=2/e,a=r,o=n,l=n;for(let e=1;e<t;++e)l=o*e*s+i*a,a=o,o=l;return l}function n(e,t,n,i){return function(s,a){if(n){if(0===s)return 1===n?-1/0:1/0;if(s<0)return Number.NaN}if(0===a)return e(s);if(1===a)return t(s);if(a<0)return Number.NaN;let o=e(s),l=t(s);return r(s,0|a,o,l,i)}}e.besselj=/* @__PURE__ */(()=>{let e=[-184.9052456,77392.33017,-11214424.18,651619640.7,-0x31c78f292,0xd6759744e],n=[1,267.8532712,59272.64853,9494680.718,0x3d5d6d39,0xd675973ab],i=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],s=[-934935152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function a(r){let a=0,o=0,l=r*r;if(r<8)a=t(e,l)/t(n,l);else{let e=r-.785398164;a=Math.sqrt(.636619772/r)*(Math.cos(e)*t(i,l=64/l)-Math.sin(e)*t(s,l)*8/r)}return a}let o=[-30.16036606,15704.4826,-2972611.439,242396853.1,-0x1d6950b23,0x10d925ddd8],l=[1,376.9991397,99447.43394,18583304.74,0x891f618a,0x21b24bbb9a],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function h(e){let r=0,n=0,i=e*e,s=Math.abs(e)-2.356194491;return 8>Math.abs(e)?r=e*t(o,i)/t(l,i):(r=Math.sqrt(.636619772/Math.abs(e))*(Math.cos(s)*t(u,i=64/i)-Math.sin(s)*t(c,i)*8/Math.abs(e)),e<0&&(r=-r)),r}return function e(t,n){let i=Math.round(n);if(!Number.isFinite(t))return Number.isNaN(t)?t:0;if(i<0)return(i%2?-1:1)*e(t,-i);if(t<0)return(i%2?-1:1)*e(-t,i);if(0===i)return a(t);if(1===i)return h(t);if(0===t)return 0;let s=0;if(t>i)s=r(t,i,a(t),h(t),-1);else{let e=2*Math.floor((i+Math.floor(Math.sqrt(40*i)))/2),r=!1,n=0,a=0,o=1,l=0,u=2/t;for(let t=e;t>0;t--)if(l=t*u*o-n,n=o,Math.abs(o=l)>1e10&&(o*=1e-10,n*=1e-10,s*=1e-10,a*=1e-10),r&&(a+=o),r=!r,t===i&&(s=n),e-t>100&&0===s)return Number.NaN;s/=a=2*a-o}return s}})(),e.bessely=(()=>{let r=[228.4622733,-86327.92757,10879881.29,-512359803.6,0x1a4fa4b91,-0xb04cc5cd],i=[1,226.1030244,47447.2647,7189466.438,745249964.8,0x954bf890d],s=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],a=[-934945152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995],o=[8511.937935,-4237922.726,734926455.1,-0xbffb0414e,127527439e4,-4900604943e3],l=[1,354.9632885,102042.605,22459040.02,0xde8afbbf,0x62d2b66f40,249958057e5],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];return n(function(n){let o=0,l=n*n,u=n-.785398164;return n<8?t(r,l)/t(i,l)+.636619772*(0,e.besselj)(n,0)*Math.log(n):Math.sqrt(.636619772/n)*(Math.sin(u)*t(s,l=64/l)+Math.cos(u)*t(a,l)*8/n)},function(r){let n=0,i=r*r,s=r-2.356194491;return r<8?r*t(o,i)/t(l,i)+.636619772*((0,e.besselj)(r,1)*Math.log(r)-1/r):Math.sqrt(.636619772/r)*(Math.sin(s)*t(u,i=64/i)+Math.cos(s)*t(c,i)*8/r)},1,-1)})(),e.besseli=/* @__PURE__ */(()=>{let e=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],r=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228],n=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],i=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];return function s(a,o){let l=Math.round(o);if(0===l)return a<=3.75?t(e,a*a/14.0625):Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(r,3.75/Math.abs(a));if(1===l)return a<3.75?a*t(n,a*a/14.0625):(a<0?-1:1)*Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(i,3.75/Math.abs(a));if(l<0)return Number.NaN;if(0===Math.abs(a))return 0;if(a===1/0)return 1/0;let u=0,c,h=2/Math.abs(a),d=0,m=1,g=0,f=2*Math.round((l+Math.round(Math.sqrt(40*l)))/2);for(c=f;c>0;c--)if(g=c*h*m+d,d=m,Math.abs(m=g)>1e10&&(m*=1e-10,d*=1e-10,u*=1e-10),c===l&&(u=d),f-c>100&&0===u)return Number.NaN;return u*=s(a,0)/m,a<0&&l%2?-u:u}})(),e.besselk=(()=>{let r=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],i=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414],s=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],a=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];return n(function(n){return n<=2?-Math.log(n/2)*(0,e.besseli)(n,0)+t(r,n*n/4):Math.exp(-n)/Math.sqrt(n)*t(i,2/n)},function(r){return r<=2?Math.log(r/2)*(0,e.besseli)(r,1)+1/r*t(s,r*r/4):Math.exp(-r)/Math.sqrt(r)*t(a,2/r)},2,1)})()})(j||(j={}));let an=/* @__PURE__ */new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),ai=/* @__PURE__ */new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),as=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function aa(e,t,r){return e<=0?0:e>=1?1:al(e,t,r)}function ao(e,t,r){let n,i,s;if(e<=0)return 0;if(e>=1)return 1;if(t>=1&&r>=1){let i=Math.sqrt(-2*Math.log(e<.5?e:1-e));n=(2.30753+.27061*i)/(1+i*(.99229+.04481*i))-i,e<.5&&(n=-n);let s=(n*n-3)/6,a=2/(1/(2*t-1)+1/(2*r-1)),o=n*Math.sqrt(s+a)/a-(1/(2*r-1)-1/(2*t-1))*(s+5/6-2/(3*a));n=t/(t+r*Math.exp(2*o))}else{let i=Math.exp(t*Math.log(t/(t+r)))/t,s=i+Math.exp(r*Math.log(r/(t+r)))/r;n=e<i/s?(t*s*e)**(1/t):1-(r*s*(1-e))**(1/r)}let a=-ah(t,r);for(let o=0;o<10&&!(0===n||1===n||(s=(al(n,t,r)-e)/(i=Math.exp((t-1)*Math.log(n)+(r-1)*Math.log(1-n)+a)),(n-=i=s/(1-.5*Math.min(1,s*((t-1)/n-(r-1)/(1-n)))))<=0&&(n=.5*(n+i)),n>=1&&(n=.5*(n+i+1)),Math.abs(i)<1e-8*n&&o>0));o++);return n}function al(e,t,r){let n=0===e||1===e?0:Math.exp(aE(t+r)-aE(t)-aE(r)+t*Math.log(e)+r*Math.log(1-e));return e<(t+1)/(t+r+2)?n*au(e,t,r)/t:1-n*au(1-e,r,t)/r}function au(e,t,r){let n=1-(t+r)*e/(t+1);1e-8>Math.abs(n)&&(n=1e-8);let i=1,s=n=1/n;for(let a=1;a<=100;a++){let o=a*(r-a)*e/((t-1+2*a)*(t+2*a));if(1e-8>Math.abs(n=1+o*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n=1+(o=-(t+a)*(t+r+a)*e/((t+2*a)*(t+1+2*a)))*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n*i-1))break}return s}function ac(e,t){return e+t>170?Math.exp(ah(e,t)):ay(e)*ay(t)/ay(e+t)}function ah(e,t){return aE(e)+aE(t)-aE(e+t)}function ad(e,t,r){if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return Number.NaN;let n=0;for(let i=0;i<=e;i++)n+=am(i,t,r);return n}function am(e,t,r){return 0===r||1===r?t*r===e?1:0:s2(t,e)*r**e*(1-r)**(t-e)}function ag(e,t){return e<=0?0:ab(t/2,e/2)}function af(e,t){return e<=0?0:e>=1?1/0:2*aR(e,t/2)}function ap(e,t,r){return e<0?0:al(t*e/(t*e+r),t/2,r/2)}function aC(e,t,r){return e<=0?0:e>=1?1/0:r/(t*(1/ao(e,t/2,r/2)-1))}function a_(e,t,r){let n=t.length,i=0,s=0;for(let e=0;e<n;e++)i+=t[e],s+=r[e];let a=i/n,o=s/n,l=0,u=0;for(let e=0;e<n;e++)l+=(t[e]-a)*(r[e]-o),u+=(r[e]-o)**2;if(0===u)return 1/0;let c=l/u;return a-c*o+c*e}function ay(e){let t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],n=0,i=e;if(e>171.6243769536076)return 1/0;if(i<=0){let e=i%1+36e-17;if(!e)return 1/0;n=(1&i?-1:1)*Math.PI/Math.sin(Math.PI*e),i=1-i}let s=i,a=0,o;o=i<1?i++:(i-=a=(0|i)-1)-1;let l=0,u=0;for(let e=0;e<8;++e)l=(l+t[e])*o,u=u*o+r[e];let c=l/u+1;if(s<i)c/=s;else if(s>i)for(let e=0;e<a;++e)c*=i,i++;return n&&(c=n/c),c}function aE(e){let t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=e,n=e+5.5;n-=(e+.5)*Math.log(n);let i=1.000000000190015;for(let e=0;e<6;e++)i+=t[e]/++r;return-n+Math.log(2.5066282746310007*i/e)}function ab(e,t){if(t<0||e<=0)return Number.NaN;let r=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17),n=aE(e),i=Math.exp(-t+e*Math.log(t)-n),s=e,a=1/e,o=a;if(t<e+1){if(0===i)return 0;for(let e=1;e<=r&&(a+=o*=t/++s,!(Math.abs(o)<1e-30*Math.abs(a)));e++);return a*i}if(0===i)return 1;let l=t+1-e,u=9999999999999999e14,c=1/l,h=c;for(let t=1;t<=r;t++){let r=-t*(t-e);if(l+=2,1e-30>Math.abs(c=r*c+l)&&(c=1e-30),1e-30>Math.abs(u=l+r/u)&&(u=1e-30),h*=(c=1/c)*u,1e-30>Math.abs(c*u-1))break}return 1-h*i}function aR(e,t){let r,n,i;if(e<=0)return 0;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(t>1){let n=Math.sqrt(-2*Math.log(e<.5?e:1-e));r=(2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n,e<.5&&(r=-r),r=Math.max(.001,t*(1-1/(9*t)-r/(3*Math.sqrt(t)))**3)}else{let n=1-t*(.253+.12*t);r=e<n?(e/n)**(1/t):1-Math.log(1-(e-n)/(1-n))}let s=aE(t);for(let a=0;a<12;a++){if(r<=0)return 0;if(n=ab(t,r)-e,0!==(i=t>1?Math.exp((t-1)*(Math.log(t-1)-1)-s)*Math.exp(-(r-(t-1))+(t-1)*(Math.log(r)-Math.log(t-1))):Math.exp(-r+(t-1)*Math.log(r)-s))&&(i=n/i/(1-.5*Math.min(1,n/i*((t-1)/r-1)))),(r-=i)<=0&&(r=.5*(r+i)),Math.abs(i)<1e-8*r)break}return r}function aN(e,t,r,n){return t-e>n-r?0:s2(r,e)*s2(n-r,t-e)/s2(n,t)}function aI(e,t,r){return e<0?0:.5+.5*s0((Math.log(e)-t)/Math.sqrt(2*r*r))}function aA(e,t,r){return e<0?0:s2(e+t-1,t-1)*r**t*(1-r)**e}function av(e,t,r){return .5*(1+s0((e-t)/Math.sqrt(2*r*r)))}function aS(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-(e-t)**2/(2*r*r))}function aT(e,t,r){return -1.4142135623730951*r*function(e){if(e>=2)return -100;if(e<=0)return 100;let t=e<1?e:2-e,r=Math.sqrt(-2*Math.log(t/2)),n=-.70711*((2.30753+.27061*r)/(1+r*(.99229+.04481*r))-r);for(let e=0;e<2;e++){let e=1-s0(n)-t;n+=e/(1.1283791670955126*Math.exp(-n*n)-n*e)}return e<1?n:-n}(2*e)+t}function aO(e,t){return Math.exp(-t)*t**e/s1(e)}function aM(e,t){let r=.5*al(t/(e**2+t),t/2,.5);return e<0?r:1-r}function aw(e,t){let r=ao(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}function ax(e,t,r,n,i){let s=[],a=[],o=!0;for(let l=0;l<r;l++){let r=Math.floor(l/n),u=l%n,c=Math.floor(l/i),h=l%i,d=e.isArray()?e.get(r,u):e,m=t.isArray()?t.get(c,h):t;if(d.isError())return{isError:!0,errorObject:d,array1Values:s,array2Values:a,noCalculate:o};if(m.isError())return{isError:!0,errorObject:m,array1Values:s,array2Values:a,noCalculate:o};if(d.isNull()||m.isNull()||d.isBoolean()||m.isBoolean())continue;let g=d.getValue(),f=m.getValue();(0,k.isRealNum)(g)&&(0,k.isRealNum)(f)&&(s.push(+g),a.push(+f),o=!1)}return{isError:!1,errorObject:null,array1Values:s,array2Values:a,noCalculate:o}}function aU(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=n,a=i;if(t&&!t.isNull()&&(s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,1===n&&a!==i||1===i&&s!==n||1!==n&&1!==i&&(s!==n||a!==i)))return{isError:!0,errorObject:t2.create(X.REF)};if(r&&!r.isNull()){let e=r.isArray()?r.getRowCount():1,t=r.isArray()?r.getColumnCount():1;if(1===n&&s>1&&e!==s||1===i&&a>1&&t!==a)return{isError:!0,errorObject:t2.create(X.REF)}}return{isError:!1,errorObject:null}}function aD(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){n[i]=[];for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError()||r.isNull()||r.isBoolean()||r.isString())return t2.create(X.VALUE);n[i].push(+r.getValue())}}return n}function aV(e,t){let r=[],n=1;for(let i=0;i<e;i++){r[i]=[];for(let e=0;e<t;e++)r[i].push(n++)}return r}function aL(e,t,r,n){let i,s,a=t;return n&&(a=t.map(e=>Math.log(e))),r?{slope:i,intercept:s}=function(e,t){let r=t.length,n=0,i=0,s=0,a=0;for(let o=0;o<r;o++)n+=e[o],i+=t[o],s+=e[o]*e[o],a+=e[o]*t[o];let o=(r*a-n*i)/(r*s-n*n),l=1/r*i-1/r*o*n;return{slope:o,intercept:l}}(e,a):{slope:i,intercept:s}=function(e,t){let r=[[...e]],n=[...t],i=r.length,s=r[0].length,a=Math.min(i,s),o=Array(a).fill(0);for(let e=0;e<a;e++){let t=r[e],n=0;for(let e=0;e<s;e++)n+=t[e]**2;let a=t[e]<0?Math.sqrt(n):-Math.sqrt(n);if(o[e]=a,0!==a){t[e]-=a;for(let n=e+1;n<i;n++){let i=0;for(let a=e;a<s;a++)i-=r[n][a]*t[a];i/=a*t[e];for(let a=e;a<s;a++)r[n][a]-=i*t[a]}}}a=Math.min(i=r.length,s=r[0].length);let l=Array(i).fill(0);for(let e=0;e<a;e++){let t=r[e],i=0;for(let e=0;e<s;e++)i+=n[e]*t[e];i/=o[e]*t[e];for(let e=0;e<s;e++)n[e]+=i*t[e]}for(let e=o.length-1;e>=0;e--){n[e]/=o[e];let t=n[e],i=r[e];l[e]=t;for(let r=0;r<e;r++)n[r]-=t*i[r]}return{slope:l[0],intercept:0}}(e,a),n&&(i=Math.exp(i),s=Math.exp(s)),Number.isNaN(i)&&!r&&(i=0),{slope:i,intercept:s,Y:a}}function aP(e,t,r,n,i){let s=1===e.length&&e[0].length>1,a=e;i&&(a=e.map(e=>e.map(e=>Math.log(e))));let o=t,l=r;s&&(a=s7(a),o=s7(o),l=s7(l)),n&&(o=o.map(e=>[...e,1]));let u=s7(o),c=s9(u,o),h=s9(u,a),d=function(e){let{smallPivotDetected:t,luMatrix:r,permutation:n}=function(e){let t=s7(e),r=t.length,n=t[0].length,i=!0,s=!1,a=s8(r,n,0),o=Array(n).fill(0).map((e,t)=>t);for(let e=0;e<n;e++){for(let r=0;r<e;r++){let n=t[r][e];for(let t=0;t<r;t++)n-=a[r][t]*a[t][e];a[r][e]=n}let n=-1/0,l=e;for(let i=e;i<r;i++){let r=t[i][e];for(let t=0;t<e;t++)r-=a[i][t]*a[t][e];a[i][e]=r;let s=Math.abs(r);s>n&&(n=s,l=i)}if(1e-11>Math.abs(a[l][e])){s=!0;break}l!==e&&([a[e],a[l]]=[a[l],a[e]],[t[e],t[l]]=[t[l],t[e]],[o[e],o[l]]=[o[l],o[e]],i=!i);let u=a[e][e];for(let t=e+1;t<r;t++)a[t][e]/=u}return{rowSwap:i,smallPivotDetected:s,luMatrix:a,permutation:o}}(e);return t?null:function(e,t){let r=t.length,n=s8(r,r,0);for(let e=0;e<r;e++)n[e][e]=1;let i=s8(r,r,0);for(let e=0;e<r;e++){let s=t[e];for(let t=0;t<r;t++)i[e][t]=n[s][t]}for(let t=0;t<r;t++){let n=i[t];for(let s=t+1;s<r;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}for(let t=r-1;t>=0;t--){let n=i[t],s=e[t][t];for(let e=0;e<r;e++)n[e]/=s;for(let s=0;s<t;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}return i}(r,n)}(c);if(!d&&!(d=function(e){let t=function(e){let t=s7(e),r=t.length,n=t[0].length;if(r<n)return null;let i=Array(n).fill(0),s=Array(n).fill(0),a=Array.from({length:n},()=>Array(n).fill(0)),o=Number.EPSILON,l=0,u=0,c=0;for(let e=0;e<n;e++){if(i[e]=l,(u=at(t,e,r,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e]>=0&&(l=-l);let i=t[e][e]*l-u;t[e][e]-=l;for(let s=e+1;s<n;s++){u=at(t,e,r,e,s);for(let n=e;n<r;n++)t[n][s]+=u/i*t[n][e]}}if(s[e]=l,(u=ar(t,e+1,n,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e+1]>=0&&(l=-l);let s=t[e][e+1]*l-u;t[e][e+1]-=l;for(let r=e+1;r<n;r++)i[r]=t[e][r]/s;for(let s=e+1;s<r;s++){u=ar(t,e+1,n,s,e);for(let r=e+1;r<n;r++)t[s][r]+=u*i[r]}}let a=Math.abs(s[e])+Math.abs(i[e]);a>c&&(c=a)}let h=0;for(let e=n-1;e>=0;e--){if(0!==l){for(let r=h;r<n;r++)a[r][e]=t[e][r]/(l*t[e][e+1]);for(let r=h;r<n;r++){u=0;for(let i=h;i<n;i++)u+=t[e][i]*a[i][r];for(let t=h;t<n;t++)a[t][r]+=u*a[t][e]}}for(let t=h;t<n;t++)a[e][t]=0,a[t][e]=0;a[e][e]=1,l=i[e],h=e}for(let e=n-1;e>=0;e--){l=s[e];for(let r=e+1;r<n;r++)t[e][r]=0;if(0!==l){for(let i=e+1;i<n;i++){u=at(t,e+1,r,e,i);for(let n=e;n<r;n++)t[n][i]+=u/(t[e][e]*l)*t[n][e]}for(let n=e;n<r;n++)t[n][e]/=l}else for(let n=e;n<r;n++)t[n][e]=0;t[e][e]+=1}o*=c;let d=0,m=0,g=0;for(let e=n-1;e>=0;e--)for(let l=0;l<50;l++){let u=!1,c=e;for(;c>=0;c--){if(Math.abs(i[c])<=o){u=!0;break}if(Math.abs(s[c-1])<=o)break}if(!u){let n=0,a=1;for(let l=c;l<e+1&&(d=a*i[l],m=s[l],i[l]*=n,!(Math.abs(d)<=o));l++){g=ae(d,m),s[l]=g,n=m/g,a=-d/g;for(let e=0;e<r;e++){let r=t[e][c-1],i=t[e][l];t[e][c-1]=r*n+i*a,t[e][l]=-r*a+i*n}}}if(c===e){if(s[e]<0){s[e]=-s[e];for(let t=0;t<n;t++)a[t][e]=-a[t][e]}break}if(l>=49)return null;let h=s[c];g=ae(d=((s[e-1]-s[e])*(s[e-1]+s[e])+(i[e-1]-i[e])*(i[e-1]+i[e]))/(2*i[e]*s[e-1]),1),d=d<0?((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d-g)-i[e]))/h:((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d+g)-i[e]))/h;let f=1,p=1;for(let o=c+1;o<e+1;o++){let e=i[o],l=s[o];m=p*e,e*=f,g=ae(d,m),i[o-1]=g,d=h*(f=d/g)+e*(p=m/g),m=l*p,e=-h*p+e*f,l*=f;for(let e=0;e<n;e++){let t=a[e][o-1],r=a[e][o];a[e][o-1]=t*f+r*p,a[e][o]=-t*p+r*f}g=ae(d,m),s[o-1]=g,d=(f=d/g)*e+(p=m/g)*l,h=-p*e+f*l;for(let e=0;e<r;e++){let r=t[e][o-1],n=t[e][o];t[e][o-1]=r*f+n*p,t[e][o]=-r*p+n*f}}i[c]=0,i[e]=d,s[e]=h}for(let e=0;e<s.length;e++)s[e]<o&&(s[e]=0);for(let e=0;e<n;e++)for(let r=e-1;r>=0;r--)if(s[r]<s[e]){let n=s[r];s[r]=s[e],s[e]=n;for(let n=0;n<t.length;n++){let i=t[n][e];t[n][e]=t[n][r],t[n][r]=i}for(let t=0;t<a.length;t++){let n=a[t][e];a[t][e]=a[t][r],a[t][r]=n}e=r}return{matrixU:t,matrixS:s,matrixV:a}}(e);if(!t)return null;let{matrixU:r,matrixS:n,matrixV:i}=t,s=s7(r),a=Array.from({length:n.length},()=>Array(e[0].length).fill(0)),o=Math.max(e.length,e[0].length)*Number.EPSILON*n[0];for(let e=0;e<n.length;e++)Math.abs(n[e])>o&&(a[e][e]=1/n[e]);return s9(i,s9(a,s))}(c)))return t2.create(X.NA);let m=s9(d,h);n||m.push([0]);let g=(m=s7(m))[0].pop();if(m[0].reverse(),m[0].push(g),i)for(let e=0;e<m[0].length;e++)m[0][e]=Math.exp(m[0][e]);return{coefficients:m,Y:a,X:o,newX:l,XTXInverse:d}}class aj extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(1);s.isNull()&&(s=nV.create(0)),a.isNull()&&(a=nV.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<=0||m>=1||p>=C)return t2.create(X.NUM);let _=ao(m,g,f)*(C-p)+p;return nV.create(_)}}class aF extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||d>m||g<0||g>1?t2.create(X.NUM):(i=f?ad(d,m,g):am(d,m,g),nV.create(i))}}class ak extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=+o.getValue(),h=+l.getValue();if(u<0||c<=0||c>=1||h<=0||h>=1)return t2.create(X.NUM);let d=0;for(;d<=u&&!(ad(d,u,c)>=h);)d++;return nV.create(d)}}class aB extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return t2.create(X.NUM);let u=1-ag(o,l);return nV.create(u)}}class a$ extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return t2.create(X.NUM);let u=af(1-o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}}class aH extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?t2.create(X.VALUE):t2.create(X.NA);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h,r,n)}_getResult(e,t,r,n){let i=0;for(let r=0;r<e.length;r++){if(0===t[r])return t2.create(X.DIV_BY_ZERO);i+=(e[r]-t[r])**2/t[r]}let s=(r-1)*(n-1);1===r?s=n-1:1===n&&(s=r-1);let a=1-ag(i,s);return nV.create(a)}}class aW extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sz(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return t2.create(X.NUM);let p=Math.abs(aT(m/2,0,1)*g/Math.sqrt(f));return nV.create(p)});return 1===n&&1===i?l.get(0,0):l}}class aG extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return t2.create(X.VALUE);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return t2.create(X.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nV.create(o/r)}}class aY extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n;let{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=+l.getValue(),d=+u.getValue();return c<0||h<=0?t2.create(X.NUM):(n=d?c<0?0:1-Math.exp(-h*c):c<0?0:h*Math.exp(-h*c),nV.create(n))}}class az extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>1e10)return t2.create(X.NUM);let d=1-ap(u,c,h);return nV.create(d)}}class aq extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return t2.create(X.NUM);let d=aC(1-u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}}class aX extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variance:i,ns1:s}=this._getValues(e);if(r)return n;let{isError:a,errorObject:o,variance:l,ns1:u}=this._getValues(t);if(a)return o;let c=2*(1-ap(i/l,s,u));return c>1&&(c=2-c),nV.create(c)}_getValues(e){let t=0,r=0,n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(1===n&&1===i){let n=e.isArray()?e.get(0,0):e;return n.isError()?{isError:!0,errorObject:n,variance:t,ns1:r}:n.isNull()?{isError:!0,errorObject:t2.create(X.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),variance:t,ns1:r}}let s=[],a=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(o,n):e;if(i.isError())return{isError:!0,errorObject:i,variance:t,ns1:r};if(i.isNull()||i.isBoolean())continue;let l=i.getValue();(0,k.isRealNum)(l)&&(s.push(+l),a+=+l)}if(s.length<=1)return{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),variance:t,ns1:r};let o=a/s.length,l=0;for(let e=0;e<s.length;e++)l+=(s[e]-o)**2;return 0==(t=l/(r=s.length-1))?{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class aK extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<0||m<=0||g<=0?t2.create(X.NUM):(i=f?d<=0?0:ab(m,d/g):d<0?0:0===d&&1===m?1/g:Math.exp((m-1)*Math.log(d)-d/g-aE(m)-m*Math.log(g)),nV.create(i))}}class aQ extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<0||u>1||c<=0||h<=0)return t2.create(X.NUM);let d=u<=0?0:u>=1?1/0:h*aR(u,c);return Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}}class aZ extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return t2.create(X.NUM);let d=Math.exp(aT(u,c,h));return Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}}class aJ extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,k.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new t2(X.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return nV.create(r[0])}}class a0 extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return g<=0?t2.create(X.NUM):(i=f?av(d,m,g):aS(d,m,g),nV.create(i))}}class a1 extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return t2.create(X.NUM);let d=aT(u,c,h);return nV.create(d)}}class a2 extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0||s>=1)return t2.create(X.NUM);let a=aT(s,0,1);return nV.create(a)}}class a5 extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<0||a>1)return t2.create(X.NUM);let l=a*(o-1),u=Math.floor(l),c=l-u;if(0===c)return nV.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nV.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}}class a3 extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nV.create(3);i.isNull()&&(i=nV.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,t,t2.create(X.NA)),l=nQ(s,a,i,t2.create(X.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof t2)return e;let{isError:n,errorObject:i,variants:s}=sz(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return t2.create(X.NA);if(1===c)return l===e[0]?nV.create(1):t2.create(X.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=m/(c-1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+(l-e[m])/(e[m+1]-e[m]))/(c-1),d=!0),m++;return d?u<1?t2.create(X.NUM):(h=nA(h,u),nV.create(h)):t2.create(X.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}}class a4 extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n;let{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=Math.floor(+o.getValue()),h=+l.getValue(),d=+u.getValue();return c<0||h<0?t2.create(X.NUM):(n=d?function(e,t){let r=0;for(let n=0;n<=e;n++)r+=aO(n,t);return r}(c,h):aO(c,h),nV.create(n))}}class a6 extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>4)return t2.create(X.NUM);let o=a/4*(e.length-1),l=Math.floor(o),u=o-l;if(0===u)return nV.create(e[l]);let c=e[l]+u*(e[l+1]-e[l]);return nV.create(c)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}}class a9 extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std()}}class a7 extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class a8 extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return t2.create(X.NUM);let u=Math.abs(aw(o/2,l));return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}}class oe extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,array1Values:a,array2Values:o}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),u=this._getArrayValues(t),c=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),h=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),d=nQ(c,h,r,t2.create(X.NA)),m=nQ(c,h,n,t2.create(X.NA)),g=d.mapValue((r,n,c)=>{let h=m.get(n,c);if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(h.isError())return h;let{isError:d,errorObject:g,variants:f}=sz(r,h);if(d)return g;let[p,C]=f,_=Math.floor(+p.getValue()),y=Math.floor(+C.getValue());return[1,2].includes(_)&&[1,2,3].includes(y)?1===y&&i?s:1!==y&&l instanceof t2?l:1!==y&&u instanceof t2?u:this._handleSignleObject(1===y?a:l,1===y?o:u,_,y):t2.create(X.NUM)});return 1===c&&1===h?g.get(0,0):g}_handleSignleObject(e,t,r,n){if(e.length<2||t.length<2)return t2.create(X.DIV_BY_ZERO);let{isError:i,errorObject:s,x:a,degFreedom:o}=this._getTDistParamByArrayValues(e,t,n);if(i)return s;let l=aM(-a,o);return 2===r&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?t2.create(X.NUM):nV.create(l)}_getArrayValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let s=0;s<r;s++){let a=e.isArray()?e.get(i,s):e;if(a.isError())return a;if(a.isNull()){if(t*r==1)return t2.create(X.VALUE);continue}a.isBoolean()||a.isString()||n.push(+a.getValue())}return n}_handleArray1AndArray2(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,array1Values:[],array2Values:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,array1Values:[],array2Values:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:t2.create(X.VALUE),array1Values:[],array2Values:[]};if(r*n!=i*s)return{isError:!0,errorObject:t2.create(X.NA),array1Values:[],array2Values:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,array1Values:[],array2Values:[]}:d||c.length<2?{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:c,array2Values:h}}_getTDistParamByArrayValues(e,t,r){return 1===r?this._getTDistParamByType1(e,t):2===r?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){let r=e.length,n=0,i=0,s=0;for(let a=0;a<r;a++)n+=e[a],i+=t[a],s+=(e[a]-t[a])**2;let a=n-i,o=r*s-a**2,l=r-1;return 0===o?{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(a)*Math.sqrt(l/o),degFreedom:l}}_getTDistParamByType2(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=Math.sqrt(s-i**2/r+(o-a**2/n));if(0===l)return{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),x:0,degFreedom:0};let u=r-1+n-1,c=Math.sqrt(r*n*u/(r+n));return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/l*c,degFreedom:u}}_getTDistParamByType3(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=(s-i**2/r)/(r*(r-1)),u=(o-a**2/n)/(n*(n-1));if(l+u===0)return{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),x:0,degFreedom:0};let c=l/(l+u);return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/Math.sqrt(l+u),degFreedom:1/(c**2/(r-1)+(1-c)**2/(n-1))}}}class ot extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var()}}class or extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class on extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();if(d<0||m<=0||g<=0)return t2.create(X.NUM);let p=Math.exp(-((d/g)**m));return Number.isNaN(i=f?1-p:m/g**m*d**(m-1)*p)||!Number.isFinite(i)?t2.create(X.NUM):nV.create(i)}}class oi extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=this._getArrayValues(e),i=Math.max(t.isArray()?t.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(t.isArray()?t.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=nQ(i,s,t,t2.create(X.NA)),o=r?nQ(i,s,r,t2.create(X.NA)):void 0,l=a.mapValue((e,t,i)=>{if(n instanceof t2)return n;if(e.isError())return e;let s=r?o.get(t,i):void 0;return null!=s&&s.isError()?s:0===n.length?t2.create(X.NA):1===n.length?t2.create(X.DIV_BY_ZERO):this._handleSignleObject(n,e,s)});return 1===i&&1===s?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.length,u=0,c=0;for(let t=0;t<l;t++)u+=e[t],c+=e[t]**2;let h=0;if(void 0!==r){let{isError:e,errorObject:t,variants:n}=sz(r);if(e)return t;let[i]=n;h=+i.getValue()}else{let e=u/l;h=Math.sqrt((c-2*e*u+l*e**2)/(l-1))}if(h<=0)return t2.create(X.NUM);let d=1-av((u/l-o)/(h/Math.sqrt(l)),0,1);return Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}_getArrayValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;if(n.isNull()||n.isBoolean()||n.isString())continue;let s=n.getValue();(0,k.isRealNum)(s)&&t.push(+s)}return t}}var os=((S=os||{}).BETADIST="BETADIST",S.BETAINV="BETAINV",S.BINOMDIST="BINOMDIST",S.CHIDIST="CHIDIST",S.CHIINV="CHIINV",S.CHITEST="CHITEST",S.CONFIDENCE="CONFIDENCE",S.COVAR="COVAR",S.CRITBINOM="CRITBINOM",S.EXPONDIST="EXPONDIST",S.FDIST="FDIST",S.FINV="FINV",S.FTEST="FTEST",S.GAMMADIST="GAMMADIST",S.GAMMAINV="GAMMAINV",S.HYPGEOMDIST="HYPGEOMDIST",S.LOGINV="LOGINV",S.LOGNORMDIST="LOGNORMDIST",S.MODE="MODE",S.NEGBINOMDIST="NEGBINOMDIST",S.NORMDIST="NORMDIST",S.NORMINV="NORMINV",S.NORMSDIST="NORMSDIST",S.NORMSINV="NORMSINV",S.PERCENTILE="PERCENTILE",S.PERCENTRANK="PERCENTRANK",S.POISSON="POISSON",S.QUARTILE="QUARTILE",S.RANK="RANK",S.STDEV="STDEV",S.STDEVP="STDEVP",S.TDIST="TDIST",S.TINV="TINV",S.TTEST="TTEST",S.VAR="VAR",S.VARP="VARP",S.WEIBULL="WEIBULL",S.ZTEST="ZTEST",S);let oa=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(1);s.isNull()&&(s=nV.create(0)),a.isNull()&&(a=nV.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<p||m>C||p===C)return t2.create(X.NUM);let _=aa((m-p)/(C-p),g,f);return nV.create(_)}},os.BETADIST],[aj,os.BETAINV],[aF,os.BINOMDIST],[aB,os.CHIDIST],[a$,os.CHIINV],[aH,os.CHITEST],[aW,os.CONFIDENCE],[aG,os.COVAR],[ak,os.CRITBINOM],[aY,os.EXPONDIST],[az,os.FDIST],[aq,os.FINV],[aX,os.FTEST],[aK,os.GAMMADIST],[aQ,os.GAMMAINV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||h>d||h>m||h<d-g+m||d<=0||d>g||m<=0||m>g||g<=0)return t2.create(X.NUM);let f=aN(h,d,m,g);return Number.isNaN(f)&&(f=0),nV.create(f)}},os.HYPGEOMDIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||h<=0)return t2.create(X.NUM);let d=aI(u,c,h);return nV.create(d)}},os.LOGNORMDIST],[aZ,os.LOGINV],[aJ,os.MODE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue()),h=+l.getValue();if(u<0||c<1||h<=0||h>=1)return t2.create(X.NUM);let d=aA(u,c,h);return nV.create(d)}},os.NEGBINOMDIST],[a0,os.NORMDIST],[a1,os.NORMINV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=av(+i.getValue(),0,1);return nV.create(s)}},os.NORMSDIST],[a2,os.NORMSINV],[a5,os.PERCENTILE],[a3,os.PERCENTRANK],[a4,os.POISSON],[a6,os.QUARTILE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nV.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,n,t2.create(X.NA)),h=nQ(l,u,o,t2.create(X.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return t2.create(X.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return t2.create(X.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?t2.create(X.NA):nV.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=t2.create(X.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},os.RANK],[a7,os.STDEV],[a9,os.STDEVP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>2)return t2.create(X.NUM);let d=aM(-u,c);return 2===h&&(d*=2),Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}},os.TDIST],[a8,os.TINV],[oe,os.TTEST],[or,os.VAR],[ot,os.VARP],[on,os.WEIBULL],[oi,os.ZTEST]],oo=[];var ol=((T=ol||{}).CUBEKPIMEMBER="CUBEKPIMEMBER",T.CUBEMEMBER="CUBEMEMBER",T.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",T.CUBERANKEDMEMBER="CUBERANKEDMEMBER",T.CUBESET="CUBESET",T.CUBESETCOUNT="CUBESETCOUNT",T.CUBEVALUE="CUBEVALUE",T);class ou extends sq{isCustom(){return!0}}function oc(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,databaseValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:t2.create(X.VALUE),databaseValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()&&(s=s.toLocaleUpperCase()),n.isNumber()||(0,k.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,databaseValues:t}}function oh(e,t){let r=-1;if(e.isError())return{isError:!0,errorObject:e,fieldIndex:r};let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(n>1||i>1)return{isError:!0,errorObject:t2.create(X.VALUE),fieldIndex:r};let s=e.isArray()?e.get(0,0):e,a=`${s.getValue()}`;if(s.isNull()?a=0:s.isBoolean()?a=s.getValue()?1:0:(s.isNumber()||(0,k.isRealNum)(a))&&(a=Math.floor(+a)),"number"==typeof a){if(a<1||a>t[0].length)return{isError:!0,errorObject:t2.create(X.VALUE),fieldIndex:r};r=a-1}else if(-1===(r=t[0].findIndex(e=>null!==e&&`${e}`.toLocaleLowerCase()===a.toLocaleLowerCase())))return{isError:!0,errorObject:t2.create(X.VALUE),fieldIndex:r};return{isError:!1,errorObject:null,fieldIndex:r}}function od(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,criteriaValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:t2.create(X.VALUE),criteriaValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()){r.push(n.getValue()?1:0);continue}if(n.isNumber()||(0,k.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,criteriaValues:t}}function om(e,t,r){let n=e.length,i=e[0].length,s={},a=!1;for(let o=1;o<n;o++){let n=!0;for(let a=0;a<i;a++){let i=e[o][a];if(null===i)continue;let l=s[a];if(void 0===l){let r=e[0][a];l=t[0].findIndex(e=>null!==e&&null!==r&&`${e}`.toLocaleLowerCase()===`${r}`.toLocaleLowerCase()),s[a]=l}if(-1===l&&("string"==typeof i||0===i)){n=!1;break}if(l>-1){let e=t[r][l];if(null===e){n=!1;break}let[s,a]=nJ(`${i}`);if(!n$.create(`${e}`).compare(a,s).getValue()){n=!1;break}}}if(n){a=!0;break}}return a}var og=((O=og||{}).DAVERAGE="DAVERAGE",O.DCOUNT="DCOUNT",O.DCOUNTA="DCOUNTA",O.DGET="DGET",O.DMAX="DMAX",O.DMIN="DMIN",O.DPRODUCT="DPRODUCT",O.DSTDEV="DSTDEV",O.DSTDEVP="DSTDEVP",O.DSUM="DSUM",O.DVAR="DVAR",O.DVARP="DVARP",O);let of=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d+=t,m++)}return 0===m?t2.create(X.DIV_BY_ZERO):nV.create(d/m)}},og.DAVERAGE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)"number"==typeof s[e][l]&&om(h,s,e)&&d++;return nV.create(d)}},og.DCOUNT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&om(h,s,e)&&d++;return nV.create(d)}},og.DCOUNTA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&om(h,s,e)&&(d++,m=e);return 0===d?t2.create(X.VALUE):d>1?t2.create(X.NUM):e.get(m,l)}},og.DGET],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=-1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d=Math.max(d,t),m++)}return 0===m?nV.create(0):nV.create(d)}},og.DMAX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d=Math.min(d,t),m++)}return 0===m?nV.create(0):nV.create(d)}},og.DMIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=1,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d*=t,m++)}return 0===m?nV.create(0):nV.create(d)}},og.DPRODUCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return t2.create(X.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/(g-1));return nV.create(C)}},og.DSTDEV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return t2.create(X.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/g);return nV.create(C)}},og.DSTDEVP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d+=t)}return nV.create(d)}},og.DSUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return t2.create(X.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/(g-1);return nV.create(C)}},og.DVAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return t2.create(X.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/g;return nV.create(C)}},og.DVARP]],op="yyyy/mm/dd;@";function oC(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),i=(n-t.getTime())/864e5;return n>r.getTime()&&(i+=1),Math.floor(i)+1}function o_(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=(e.getTime()-t.getTime())/864e5;return e>r&&(n+=1),n+1}function oy(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Math.floor(e)-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),new Date(t.getTime()+864e5*n)}function oE(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=e-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),n<0&&(n=e),new Date(t.getTime()+864e5*n)}function ob(e){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let t=e.replace(/-/g,"/").replace(/T.+/,""),r=/* @__PURE__ */new Date(`${t}`);if(Number.isNaN(r.getTime()))return!1;let n=r.getFullYear(),i=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0"),a=`${n}-${i}-${s}`;return e.replace(/\//g,"-").split("-").map(e=>e.padStart(2,"0")).join("-")===a}function oR(e){return(0,k.numfmt).parseDate(e)}function oN(e){return(0,k.numfmt).parseValue(e)}function oI(e){return(0,k.numfmt).parseTime(e)}function oA(e){return(0,k.numfmt).isDate(e)}let ov={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function oS(e){return!!("string"==typeof e&&/^[0|1]{7}/.test(e)||ov[Number(e)])}function oT(e){if(!oS(e))return[];if("string"==typeof e&&/^[0|1]{7}/.test(e)){let t=[];for(let r=1;r<=e.length;r++)"1"==`${e[r-1]}`&&(r===e.length?t.push(0):t.push(r));return t}return ov[Number(e)]||[]}function oO(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=Math.floor(t),o=a>s?s:a,l=0,u=Math.abs(Math.floor(t)-Math.floor(e))+1;for(let e=0;e<u;e++){let t=o+e;if(n&&n.length>0&&n.some(e=>Math.floor(e)===t))continue;let r=ox(t);i.includes(r)||l++}return a>s?l:-l}function oM(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=s,o=Math.abs(t);for(let e=1;e<=o;e++){let r=t<0?s-e:s+e;if(r<0)return t2.create(X.NUM);if(n&&n.length>0&&n.some(e=>Math.floor(e)===r)){o++;continue}let l=ox(r);if(i.includes(l)){o++;continue}a=r}return a}function ow(e){if(e.isError())return e;let t=e.getValue();if(e.isString()){let e;if(oR(`${t}`))e=oR(`${t}`).v;else if(oI(`${t}`))e=oI(`${t}`).v;else{if(!(0,k.isRealNum)(t))return t2.create(X.VALUE);e=+t}return e instanceof Date&&(e=o_(e)),0>+e||+e>2958465?t2.create(X.NUM):+e}{let t=+e.getValue();return t<0||t>2958465?t2.create(X.NUM):t}}function ox(e){let t=60===Math.floor(e),r=oy(e),n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getTime(),i=new Date(Date.UTC(1900,1,28)).getTime();return!t&&n<=i&&(r=new Date(n-864e5)),new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getUTCDay()}function oU(e,t,r){switch(r){case 0:return function(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 2===i?oy(e+1).getUTCMonth()+1===3&&(s=30):31===s&&(s=30),31===u&&(s<30?(o=(a=oy(t+1)).getUTCFullYear(),l=a.getUTCMonth()+1,u=a.getUTCDate()):u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t);case 1:return function(e,t){let r,n;let i=oy(e),s=e>0?i.getUTCFullYear():1900,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=Math.abs(t-e),u=Math.abs(o-s)+1;if(o<s){let e=new Date(Date.UTC(o,0,1)),t=new Date(Date.UTC(s,11,31));r=oC(e),n=oC(t),1900===o&&(r+=1)}else{let e=new Date(Date.UTC(s,0,1)),t=new Date(Date.UTC(o,11,31));r=oC(e),n=oC(t),1900===s&&(r+=1)}return{days:l,yearDays:(n-r+1)/u}}(e,t);case 2:return{days:Math.abs(t-e),yearDays:360};case 3:default:return{days:Math.abs(t-e),yearDays:365};case 4:return function(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 31===s&&(s=30),31===u&&(u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t)}}let oD=[31,29,31,30,31,30,31,31,30,31,30,31],oV=[31,28,31,30,31,30,31,31,30,31,30,31];function oL(e,t){return e%4==0&&e%100!=0||e%400==0?oD[t]:oV[t]}function oP(e){return e%4==0&&e%100!=0||e%400==0||1900===e?366:365}function oj(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return oP(oy(e).getUTCFullYear());case 3:return 365;default:return -1}}function oF(e,t){let r=e.getUTCFullYear(),n=e.getUTCMonth(),i=e.getUTCDate();return oL(r,n)===i?(e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),r=e.getUTCFullYear(),n=e.getUTCMonth(),e.setUTCDate(oL(r,n))):e.setUTCMonth(e.getUTCMonth()+t),e}var ok=((M=ok||{}).DATE="DATE",M.DATEDIF="DATEDIF",M.DATEVALUE="DATEVALUE",M.DAY="DAY",M.DAYS="DAYS",M.DAYS360="DAYS360",M.EDATE="EDATE",M.EOMONTH="EOMONTH",M.EPOCHTODATE="EPOCHTODATE",M.HOUR="HOUR",M.ISOWEEKNUM="ISOWEEKNUM",M.MINUTE="MINUTE",M.MONTH="MONTH",M.NETWORKDAYS="NETWORKDAYS",M.NETWORKDAYS_INTL="NETWORKDAYS.INTL",M.NOW="NOW",M.SECOND="SECOND",M.TIME="TIME",M.TIMEVALUE="TIMEVALUE",M.TO_DATE="TO_DATE",M.TODAY="TODAY",M.WEEKDAY="WEEKDAY",M.WEEKNUM="WEEKNUM",M.WORKDAY="WORKDAY",M.WORKDAY_INTL="WORKDAY.INTL",M.YEAR="YEAR",M.YEARFRAC="YEARFRAC",M);let oB=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e),a=nQ(n,i,t),o=nQ(n,i,r);return s.map((e,t,r)=>{let n=a.get(t,r)||nx.create(),i=o.get(t,r)||nx.create();if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;if(e.isString()||n.isString()||i.isString())return t2.create(X.VALUE);let s=+e.getValue(),l=Math.floor(+n.getValue()),u=+i.getValue();if(s<0||s>9999)return t2.create(X.NUM);s>=0&&s<1899&&(s+=1900);let c=oC(new Date(s,l-1,u));return c<0?t2.create(X.NUM):nV.create(c,op)})}},ok.DATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t,s=r;if(n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),s.isArray()&&(s=s.get(0,0)),n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=ow(n);if("number"!=typeof a)return a;let o=ow(i);return"number"!=typeof o?o:o<a||!s.isString()?t2.create(X.NUM):this._getResultByUnit(a,o,s)}_getResultByUnit(e,t,r){let n=oy(e),i=n.getUTCFullYear(),s=n.getUTCMonth()+1,a=n.getUTCDate(),o=oy(t),l=o.getUTCFullYear(),u=o.getUTCMonth()+1,c=o.getUTCDate(),h=`${r.getValue()}`.toLocaleUpperCase(),d=0,m;switch(h){case"Y":d=l-i,(u<s||u===s&&c<a)&&(d-=1);break;case"M":d=(l-i)*12+u-s,c<a&&(d-=1);break;case"D":d=Math.floor(t)-Math.floor(e);break;case"MD":d=c-a,c<a&&(d+=oL((m=new Date(Date.UTC(l,u-1,0))).getUTCFullYear(),m.getUTCMonth()));break;case"YM":d=u-s,(u<s||u===s&&c<a)&&(d+=12),c<a&&(d-=1);break;case"YD":m=new Date(Date.UTC(i,u-1,c)),(u<s||u===s&&c<a)&&(m=new Date(Date.UTC(i+1,u-1,c))),d=Math.floor(oC(m))-Math.floor(e);break;default:return t2.create(X.NUM)}return nV.create(d)}},ok.DATEDIF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=oN(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&oA(r))return e instanceof Date&&(e=o_(e)),nV.create(Math.trunc(+e))}}return t2.create(X.VALUE)}},ok.DATEVALUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;let r=e.getValue();if(e.isString()){if(!ob(`${r}`))return t2.create(X.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return t2.create(X.NUM);if(0===r)return nV.create(0);t=oy(r)}let n=t.getDate();return nV.create(n)}},ok.DAY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let i=ow(e);if("number"!=typeof i)return i;let a=ow(n);if("number"!=typeof a)return a;let o=Math.floor(i)-Math.floor(a);return nV.create(o)});return 1===r&&1===n?a.get(0,0):a}},ok.DAYS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nD.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);if(e.isError())return e;let s=ow(e);if("number"!=typeof s)return s;if(n.isError())return n;let a=ow(n);if("number"!=typeof a)return a;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let{days:u}=oU(s,a,+i.getValue()?4:0);return nV.create(a>=s?u:-u)});return 1===i&&1===s?u.get(0,0):u}},ok.DAYS360],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t);return i.map((e,t,r)=>{let n=s.get(t,r)||nx.create();if(e.isError())return e;if(n.isError())return n;if(e.isString()||e.isBoolean()||n.isString()||n.isBoolean())return t2.create(X.VALUE);let i=+e.getValue();if(i<0)return t2.create(X.NUM);let a=Math.floor(+n.getValue()),o=oy(i),l=oC(new Date(Date.UTC(o.getUTCFullYear(),o.getUTCMonth()+a,o.getUTCDate())));return nV.create(l,op)})}},ok.EDATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);r=r.get(0,0)}if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;let i=ow(r);if("number"!=typeof i)return i;if(n.isBoolean())return t2.create(X.VALUE);let s=oy(i),a=i>0?s.getUTCFullYear():1900,o=i>0?s.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return t2.create(X.VALUE);let u=oC(new Date(Date.UTC(a,o+l+1,0)));return nV.create(u)}},ok.EOMONTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2),G(this,"needsReferenceObject",!0)}calculate(e,t){let r=null!=t?t:nV.create(1),{isError:n,errorObject:i,timestampIsReferenceObject:s,timestampObject:a,unitObject:o}=this._checkVariants(e,r);if(n)return i;if(a.isNull()||a.isBoolean()||a.isString()||!s&&a.isNumber()&&""!==a.getPattern())return t2.create(X.VALUE);let l=+a.getValue(),{isError:u,errorObject:c,variants:h}=sz(o);if(u)return c;let[d]=h,m=Math.floor(+d.getValue());if(l<0||m<1||m>3)return t2.create(X.NUM);1===m&&(l*=1e3),3===m&&(l/=1e3);let g=o_(new Date(Date.UTC(1970,0,1,0,0,0,0)+l));return nV.create(g,"yyyy-MM-dd hh:mm:ss AM/PM")}_checkVariants(e,t){let r=e.isReferenceObject(),n=t.isReferenceObject(),i=e;if(r&&(i=e.toArrayValueObject()),i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:t2.create(X.VALUE)};i=i.get(0,0)}if(i.isError())return{isError:!0,errorObject:i};let s=t;if(n&&(s=t.toArrayValueObject()),s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:t2.create(X.VALUE)};s=s.get(0,0)}return s.isError()?{isError:!0,errorObject:s}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:i,unitIsReferenceObject:n,unitObject:s}}},ok.EPOCHTODATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=ow(e);if("number"!=typeof t)return t;if(0===t)return nV.create(0);let r=oE(t).getUTCHours();return nV.create(r)}},ok.HOUR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=ow(e);if("number"!=typeof t)return t;let r=oy(t),n=t>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=oC(i),a=ox(s),o;t<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=oC(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));let l=Math.ceil((t-o+1)/7);return nV.create(l)}},ok.ISOWEEKNUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=ow(e);if("number"!=typeof t)return t;if(0===t)return nV.create(0);let r=oE(t).getUTCMinutes();return nV.create(r)}},ok.MINUTE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!ob(`${r}`))return t2.create(X.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return t2.create(X.NUM);if(0===r)return nV.create(1);t=oy(r)}let n=t.getUTCMonth()+1;return nV.create(n)}},ok.MONTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return t2.create(X.VALUE);let s=ow(n);if("number"!=typeof s)return s;let a=ow(i);if("number"!=typeof a)return a;if(r)return this._getResultByHolidays(s,a,r);let o=oO(s,a);return nV.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return t2.create(X.VALUE);let s=ow(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return t2.create(X.VALUE);let e=ow(r);if("number"!=typeof e)return e;n.push(e)}let i=oO(e,t,1,n);return nV.create(i)}},ok.NETWORKDAYS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=e,s=t;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);i=i.get(0,0)}if(i.isError())return i;if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);s=s.get(0,0)}if(s.isError())return s;let a=1;if(r){if(a=r.getValue(),r.isBoolean()&&(a=+a),r.isString()&&!oS(a))return t2.create(X.VALUE);if(!oS(a))return t2.create(X.NUM)}if(i.isBoolean()||s.isBoolean())return t2.create(X.VALUE);let o=ow(i);if("number"!=typeof o)return o;let l=ow(s);if("number"!=typeof l)return l;if(n)return this._getResultByHolidays(o,l,a,n);let u=oO(o,l,a);return nV.create(u)}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return t2.create(X.VALUE);let s=ow(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return t2.create(X.VALUE);let e=ow(n);if("number"!=typeof e)return e;i.push(e)}let s=oO(e,t,r,i);return nV.create(s)}},ok.NETWORKDAYS_INTL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){let e=/* @__PURE__ */new Date,t=o_(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())));return nV.create(t,"yyyy/mm/dd hh:mm")}},ok.NOW],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=ow(e);if("number"!=typeof t)return t;if(0===t)return nV.create(0);let r=oE(t).getUTCSeconds();return nV.create(r)}},ok.SECOND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e),a=nQ(n,i,t),o=nQ(n,i,r);return s.map((e,t,r)=>this._calculateTime(e,a,o,t,r))}_calculateTime(e,t,r,n,i){let s=e,a=t.get(n,i)||nx.create(),o=r.get(n,i)||nx.create();if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),(a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(o.isString()||o.isBoolean())&&(o=o.convertToNumberObjectValue()),s.isError())return s;if(a.isError())return a;if(o.isError())return o;let l=Math.floor(+s.getValue()),u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue());if(l<0||u<0||c<0||l>32767||u>32767||c>32767)return t2.create(X.NUM);u+=Math.floor(c/60),c%=60,l+=Math.floor(u/60);let h=(3600*(l%=24)+60*(u%=60)+c)/86400;return nV.create(h,"h:mm A/P")}},ok.TIME],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let r=oN(`${e.getValue()}`);if(r){let{v:e,z:n}=r;if(n&&oA(n)){var t;return e instanceof Date&&(e=o_(e)),nV.create((t=+e)-Math.trunc(t))}}}return t2.create(X.VALUE)}},ok.TIMEVALUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"needsReferenceObject",!0)}calculate(e){let t=e.isReferenceObject(),r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&""!==r.getPattern())return r;let n=+r.getValue();return nV.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}},ok.TO_DATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){let e=oC(/* @__PURE__ */new Date);return nV.create(e,op)}},ok.TODAY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2),G(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){let r=null!=t?t:nV.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r);return this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;let n=ow(e);if("number"!=typeof n)return n;if(r.isString()&&(r=r.convertToNumberObjectValue()).isError())return r;let i=Math.floor(+r.getValue());if(!this._returnTypeMap[i])return t2.create(X.NUM);let s=ox(n),a=this._returnTypeMap[i][s];return nV.create(a)}},ok.WEEKDAY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2),G(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=null!=t?t:nV.create(1);if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return t2.create(X.VALUE);let i=ow(r);if("number"!=typeof i)return i;if(n.isBoolean())return t2.create(X.VALUE);let s=Math.floor(+n.getValue());return Number.isNaN(s)?t2.create(X.VALUE):s in this._returnTypeMap?this._getResult(i,s):t2.create(X.NUM)}_getResult(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=oC(i),a=ox(s),o;if(21===t)e<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=oC(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));else{let e=this._returnTypeMap[t];o=a<e?s-(a+7-e):s-(a-e)}let l=Math.ceil((e-o+1)/7);return nV.create(l)}},ok.WEEKNUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return t2.create(X.VALUE);let s=ow(n);if("number"!=typeof s)return s;let a=+i.getValue();if(Number.isNaN(a))return t2.create(X.VALUE);if(r)return this._getResultByHolidays(s,a,r);let o=oM(s,a);return"number"!=typeof o?o:nV.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return t2.create(X.VALUE);let s=ow(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return t2.create(X.VALUE);let e=ow(r);if("number"!=typeof e)return e;n.push(e)}let i=oM(e,t,1,n);return"number"!=typeof i?i:nV.create(i)}},ok.WORKDAY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=null!=r?r:nV.create(1),s=this._checkArrayError(e);if(s.isError())return s;let a=this._checkArrayError(t);if(a.isError())return a;if(s.isBoolean()||a.isBoolean())return t2.create(X.VALUE);let o=ow(e);if("number"!=typeof o)return o;let l=+t.getValue();if(Number.isNaN(l))return t2.create(X.VALUE);let u=i.getValue();if(i.isBoolean()&&(u=+u),i.isString()&&(!oS(u)||"1111111"===u))return t2.create(X.VALUE);if(!oS(u))return t2.create(X.NUM);if(n)return this._getResultByHolidays(o,l,u,n);let c=oM(o,l,u);return"number"!=typeof c?c:nV.create(c)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return t2.create(X.VALUE);let s=ow(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return t2.create(X.VALUE);let e=ow(n);if("number"!=typeof e)return e;i.push(e)}let s=oM(e,t,r,i);return"number"!=typeof s?s:nV.create(s)}},ok.WORKDAY_INTL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!ob(`${r}`))return t2.create(X.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let e=+r;if(e<0)return t2.create(X.NUM);if(0===e)return nV.create(1900);t=oy(e)}let n=t.getUTCFullYear();return nV.create(n)}},ok.YEAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(0),i=sH(e);if(i.isError())return i;let s=sH(t);if(s.isError())return s;if((n=sH(n)).isError())return n;if(i.isBoolean()||s.isBoolean()||n.isBoolean())return t2.create(X.VALUE);let a=ow(i);if("number"!=typeof a)return a;let o=ow(s);if("number"!=typeof o)return o;let l=Math.floor(+n.getValue());if(Number.isNaN(l))return t2.create(X.VALUE);if(l<0||l>4)return t2.create(X.NUM);let{days:u,yearDays:c}=oU(a,o,l);return nV.create(u/c)}},ok.YEARFRAC]];nR.prototype.cos=function(){return new nR(Math.cos(this.toNumber()))};let o$=class e{constructor(e){if(G(this,"_inumber",""),G(this,"_realNum",0),G(this,"_iNum",0),G(this,"_suffix",""),G(this,"_isError",!1),""===`${e}`.trim()){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){let n;let i=new nR(e).toSignificantDigits(15).toNumber(),s=new nR(t).toSignificantDigits(15).toNumber(),a=""===r?"i":r;if(0===i&&0===s)n=0;else if(0===i)n=1===s?a:`${s}${a}`;else if(0===s)n=i;else{let e=1===s?a:`${s}${a}`;n=`${i}${s>0?"+":""}${e}`}return n}static createByComplexStr(t,r,n){let i=e.getComplex(t,r,n);return new e(i)}_getImReal(){if(0===this._inumber||"0"===this._inumber){this._realNum=0;return}let e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(0===this._inumber||"0"===this._inumber){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-+e.substring(r+1,e.length-1)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){let e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix="i"===t||"j"===t?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return e.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){let t=e.getSuffix();return""!==this._suffix&&""!==t&&this._suffix!==t}Abs(){return nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){let e=nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))),t=nR.acos(new nR(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return e.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){let t=nR.cos(this._realNum).mul(nR.cosh(this._iNum)).toNumber(),r=nR.sin(this._realNum).mul(nR.sinh(this._iNum)).negated().toNumber();return e.getComplex(t,r,this._suffix)}{let t=nR.cos(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nR.cosh(this._realNum).mul(nR.cos(this._iNum)).toNumber(),r=nR.sinh(this._realNum).mul(nR.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nR.cosh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cot(){if(this._iNum){let t=nR.cosh(2*this._iNum).sub(nR.cos(2*this._realNum)),r=nR.sin(2*this._realNum).div(t).toNumber(),n=nR.sinh(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.tan(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nR.cosh(2*this._realNum).sub(nR.cos(2*this._iNum)),r=nR.sinh(2*this._realNum).div(t).toNumber(),n=nR.sin(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.tanh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csc(){if(this._iNum){let t=nR.cosh(2*this._iNum).sub(nR.cos(2*this._realNum)),r=nR.sin(this._realNum).mul(nR.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nR.cos(this._realNum).mul(nR.sinh(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.sin(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nR.cosh(2*this._realNum).sub(nR.cos(2*this._iNum)),r=nR.sinh(this._realNum).mul(nR.cos(this._iNum)).mul(2).div(t).toNumber(),n=nR.cosh(this._realNum).mul(nR.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.sinh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Div(t){let r=new nR(this._realNum),n=new nR(this._iNum),i=new nR(t.getRealNum()),s=new nR(t.getINum()),a=i.mul(i).add(s.mul(s)),o=r.mul(i).add(n.mul(s)).div(a).toNumber(),l=n.mul(i).sub(r.mul(s)).div(a).toNumber(),u=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(o,l,u)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";let t=nR.exp(this._realNum).mul(nR.cos(this._iNum)).toNumber(),r=nR.exp(this._realNum).mul(nR.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}Ln(){let t=nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))),r=nR.ln(t).toNumber(),n=nR.acos(new nR(this._realNum).div(t)).toNumber();return e.getComplex(r,n,this._suffix)}Log(t){let r=nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))),n=nR.ln(r),i=nR.acos(new nR(this._realNum).div(r));this._iNum<0&&(i=i.negated());let s=nR.ln(t),a=new nR(0),o=s.mul(s).add(a.mul(a));if(o.eq(0))return this._isError=!0,"";let l=n.mul(s).add(i.mul(a)).div(o).toNumber(),u=i.mul(s).sub(n.mul(a)).div(o).toNumber();return e.getComplex(l,u,this._suffix)}Power(t){if(0===this._realNum&&0===this._iNum)return t>0?e.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let r=nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))),n=nR.acos(new nR(this._realNum).div(r));this._iNum<0&&(n=n.negated()),r=nR.pow(r,t),n=n.mul(t);let i=nR.cos(n).mul(r).toNumber(),s=nR.sin(n).mul(r).toNumber();return Number.isFinite(i)&&Number.isFinite(s)?e.getComplex(i,s,this._suffix):(this._isError=!0,"")}Product(t){let r=new nR(this._realNum),n=new nR(this._iNum),i=new nR(t.getRealNum()),s=new nR(t.getINum()),a=r.mul(i).sub(n.mul(s)).toNumber(),o=r.mul(s).add(n.mul(i)).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sec(){if(this._iNum){let t=nR.cosh(2*this._iNum).add(nR.cos(2*this._realNum)),r=nR.cos(this._realNum).mul(nR.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nR.sin(this._realNum).mul(nR.sinh(this._iNum)).mul(2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.cos(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(2*this._realNum))||!Number.isFinite(Math.cosh(2*this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nR.cosh(2*this._realNum).add(nR.cos(2*this._iNum)),r=nR.cosh(this._realNum).mul(nR.cos(this._iNum)).mul(2).div(t).toNumber(),n=nR.sinh(this._realNum).mul(nR.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nR(1).div(nR.cosh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sin(){if(this._iNum){let t=nR.sin(this._realNum).mul(nR.cosh(this._iNum)).toNumber(),r=nR.cos(this._realNum).mul(nR.sinh(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nR.sin(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nR.sinh(this._realNum).mul(nR.cos(this._iNum)).toNumber(),r=nR.cosh(this._realNum).mul(nR.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nR.sinh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sqrt(){let t=nR.sqrt(nR.pow(this._realNum,2).add(nR.pow(this._iNum,2))),r=nR.sqrt(t),n=nR.acos(new nR(this._realNum).div(t));this._iNum<0&&(n=n.negated());let i=r.mul(nR.cos(n.div(2).toNumber())).toNumber(),s=r.mul(nR.sin(n.div(2))).toNumber();return e.getComplex(i,s,this._suffix)}Sub(t){let r=new nR(this._realNum),n=new nR(this._iNum),i=new nR(t.getRealNum()),s=new nR(t.getINum()),a=r.sub(i).toNumber(),o=n.sub(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sum(t){let r=new nR(this._realNum),n=new nR(this._iNum),i=new nR(t.getRealNum()),s=new nR(t.getINum()),a=r.add(i).toNumber(),o=n.add(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Tan(){if(this._iNum){let t=nR.cos(2*this._realNum).add(nR.cosh(2*this._iNum)),r=nR.sin(2*this._realNum).div(t).toNumber(),n=nR.sinh(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nR.tan(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nR.cosh(2*this._realNum).add(nR.cos(2*this._iNum)),r=nR.sinh(2*this._realNum).div(t).toNumber(),n=nR.sin(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nR.tanh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}};var oH=((w=oH||{}).BESSELI="BESSELI",w.BESSELJ="BESSELJ",w.BESSELK="BESSELK",w.BESSELY="BESSELY",w.BIN2DEC="BIN2DEC",w.BIN2HEX="BIN2HEX",w.BIN2OCT="BIN2OCT",w.BITAND="BITAND",w.BITLSHIFT="BITLSHIFT",w.BITOR="BITOR",w.BITRSHIFT="BITRSHIFT",w.BITXOR="BITXOR",w.COMPLEX="COMPLEX",w.CONVERT="CONVERT",w.DEC2BIN="DEC2BIN",w.DEC2HEX="DEC2HEX",w.DEC2OCT="DEC2OCT",w.DELTA="DELTA",w.ERF="ERF",w.ERF_PRECISE="ERF.PRECISE",w.ERFC="ERFC",w.ERFC_PRECISE="ERFC.PRECISE",w.GESTEP="GESTEP",w.HEX2BIN="HEX2BIN",w.HEX2DEC="HEX2DEC",w.HEX2OCT="HEX2OCT",w.IMABS="IMABS",w.IMAGINARY="IMAGINARY",w.IMARGUMENT="IMARGUMENT",w.IMCONJUGATE="IMCONJUGATE",w.IMCOS="IMCOS",w.IMCOSH="IMCOSH",w.IMCOT="IMCOT",w.IMCOTH="IMCOTH",w.IMCSC="IMCSC",w.IMCSCH="IMCSCH",w.IMDIV="IMDIV",w.IMEXP="IMEXP",w.IMLN="IMLN",w.IMLOG="IMLOG",w.IMLOG10="IMLOG10",w.IMLOG2="IMLOG2",w.IMPOWER="IMPOWER",w.IMPRODUCT="IMPRODUCT",w.IMREAL="IMREAL",w.IMSEC="IMSEC",w.IMSECH="IMSECH",w.IMSIN="IMSIN",w.IMSINH="IMSINH",w.IMSQRT="IMSQRT",w.IMSUB="IMSUB",w.IMSUM="IMSUM",w.IMTAN="IMTAN",w.IMTANH="IMTANH",w.OCT2BIN="OCT2BIN",w.OCT2DEC="OCT2DEC",w.OCT2HEX="OCT2HEX",w);let oW=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);let u=j.besseli(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},oH.BESSELI],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);let u=j.besselj(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},oH.BESSELJ],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);let u=j.besselk(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},oH.BESSELK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);let u=j.bessely(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},oH.BESSELY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t;let{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=`${s.getValue()}`;return sQ(a)?(t=10===a.length&&"1"===a.substring(0,1)?Number.parseInt(a.substring(1),2)-512:Number.parseInt(a,2),nV.create(t)):t2.create(X.NUM)}},oH.BIN2DEC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return t2.create(X.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0xfffffffe00+Number.parseInt(l.substring(1),2)).toString(16);else if(r=Number.parseInt(l,2).toString(16),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r.toLocaleUpperCase())}},oH.BIN2HEX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return t2.create(X.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0x3ffffe00+Number.parseInt(l.substring(1),2)).toString(8);else if(r=Number.parseInt(l,2).toString(8),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.BIN2OCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?t2.create(X.NUM):nV.create(a&o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITAND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return t2.create(X.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)<<BigInt(o):BigInt(a)>>BigInt(-o));return l>0xffffffffffff?t2.create(X.NUM):nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITLSHIFT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff)return t2.create(X.NUM);let l=Number(BigInt(a)|BigInt(o));return nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITOR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return t2.create(X.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)>>BigInt(o):BigInt(a)<<BigInt(-o));return l>0xffffffffffff?t2.create(X.NUM):nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITRSHIFT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?t2.create(X.NUM):nV.create(a^o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITXOR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sG(e,t,null!=r?r:nP.create("i"));if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=`${l.getValue()}`;if(Number.isNaN(u)||Number.isNaN(c)||"i"!==h&&"j"!==h)return t2.create(X.VALUE);let d=o$.getComplex(u,c,h);return"number"==typeof d?nV.create(d):nP.create(d)}},oH.COMPLEX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3),G(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ngstrm","",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ngstrm","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,0x17a9e9bc0],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,0x219c7bf72246c0],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,0x11de784a],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestrke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ngstrm","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,0x1e187e0]]),G(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,0x10000000000,"Ti","tera"],Gi:["gibi",30,0x40000000,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),G(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){let n;let{isError:i,errorObject:s,variants:a}=sG(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=`${l.getValue()}`,d=`${u.getValue()}`;if(Number.isNaN(c))return t2.create(X.VALUE);let m,g=1,f,p=1,{_from:C,_to:_}=this._lookupFromAndToUnits(h,d);if(m=C,f=_,null===m){let{_from:e,_fromMultiplier:t}=this._lookupFromPrefix(h);m=e,g=t}if(null===f){let{_to:e,_toMultiplier:t}=this._lookupToPrefix(d);f=e,p=t}return null===m||null===f||m[3]!==f[3]?t2.create(X.NA):(n="temperature"===m[3]?+(n=this._getTemperatureConversion(c,m[1],f[1])).toFixed(2):c*m[6]*g/(f[6]*p),nV.create(n))}_lookupFromAndToUnits(e,t){let r=null,n=null,i;for(let s=0;s<this._units.length;s++)i=null===this._units[s][2]?[]:this._units[s][2],(this._units[s][1]===e||i.indexOf(e)>=0)&&(r=this._units[s]),(this._units[s][1]===t||i.indexOf(t)>=0)&&(n=this._units[s]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return 9*e/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return 4*e/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return 9*e/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return 5*e/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return 5*e/4;case"F":return 9*e/4+32;case"K":return 5*e/4+273.15;case"Rank":return 9*e/4+491.67;default:return e}}},oH.CONVERT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return t2.create(X.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${l}`)||l<-512||l>511)return t2.create(X.NUM);if(l<0){let e=(512+l).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=Number.parseInt(`${l}`,10).toString(2),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.DEC2BIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return t2.create(X.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${l}`)||l<-0x8000000000||l>0x7fffffffff)return t2.create(X.NUM);if(l<0)r=(0x10000000000+l).toString(16);else if(r=Number.parseInt(`${l}`,10).toString(16),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r.toLocaleUpperCase())}},oH.DEC2HEX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return t2.create(X.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${l}`)||l<-0x20000000||l>0x1fffffff)return t2.create(X.NUM);if(l<0)r=(0x40000000+l).toString(8);else if(r=Number.parseInt(`${l}`,10).toString(8),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.DEC2OCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,null!=t?t:nV.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?t2.create(X.VALUE):nV.create(o===l?1:0)}},oH.DELTA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(t){let{isError:n,errorObject:i,variants:s}=sG(e,t);if(n)return i;let[a,o]=s,l=+a.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return t2.create(X.VALUE);r=s0(u)-s0(l)}else{let{isError:t,errorObject:n,variants:i}=sG(e);if(t)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return t2.create(X.VALUE);r=s0(a)}return nV.create(r)}},oH.ERF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return t2.create(X.VALUE);let a=s0(s);return nV.create(a)}},oH.ERF_PRECISE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return t2.create(X.VALUE);let a=1-s0(s);return nV.create(a)}},oH.ERFC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return t2.create(X.VALUE);let a=1-s0(s);return nV.create(a)}},oH.ERFC_PRECISE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){if(e.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,null!=t?t:nV.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?t2.create(X.VALUE):nV.create(o>=l?1:0)}},oH.GESTEP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sJ(l))return t2.create(X.NUM);let u=10===l.length&&"F"===l.substring(0,1).toLocaleUpperCase(),c=u?Number.parseInt(l,16)-0x10000000000:Number.parseInt(l,16);if(c<-512||c>511)return t2.create(X.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.HEX2BIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sJ(s))return t2.create(X.NUM);let a=Number.parseInt(s,16);return a>=0x8000000000&&(a-=0x10000000000),nV.create(a)}},oH.HEX2DEC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sJ(l))return t2.create(X.NUM);let u=Number.parseInt(l,16);if(u>0x1fffffff&&u<0xffe0000000)return t2.create(X.NUM);if(u>=0xffe0000000)r=(u-0xffc0000000).toString(8);else if(r=u.toString(8),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.HEX2OCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Abs();return nV.create(a)}},oH.IMABS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.getINum();return nV.create(a)}},oH.IMAGINARY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);if(0===s.getRealNum()&&0===s.getINum())return t2.create(X.DIV_BY_ZERO);let a=s.Argument();return nV.create(a)}},oH.IMARGUMENT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Conjugate();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCONJUGATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Cos();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCOS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Cosh();return s.isError()?t2.create(X.NUM):"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCOSH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Cot();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCOT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Coth();return s.isError()?t2.create(X.NUM):"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCOTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Csc();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCSC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Csch();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMCSCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c)||0===c.getRealNum()&&0===c.getINum())return t2.create(X.NUM);let h=u.Div(c);return"number"==typeof h||(0,k.isRealNum)(h)?nV.create(+h):nP.create(h)}},oH.IMDIV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Exp();return s.isError()?t2.create(X.NUM):"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMEXP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Ln();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMLN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=null!=t?t:nV.create(10);if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);a=a.get(0,0)}let{isError:o,errorObject:l,variants:u}=sz(a);if(o)return l;let[c]=u,h=`${s.getValue()}`,d=+c.getValue(),m=new o$(h);if(m.isError()||0===m.getRealNum()&&0===m.getINum()||d<=0)return t2.create(X.NUM);let g=m.Log(d);return m.isError()?t2.create(X.NUM):"number"==typeof g||(0,k.isRealNum)(g)?nV.create(+g):nP.create(g)}},oH.IMLOG],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Log(10);return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMLOG10],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return t2.create(X.NUM);let a=s.Log(2);return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMLOG2],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=new o$(`${s.getValue()}`);if(o.isError())return t2.create(X.NUM);let l=+a.getValue();if(Number.isNaN(l))return t2.create(X.VALUE);let u=o.Power(l);return o.isError()?t2.create(X.NUM):"number"==typeof u||(0,k.isRealNum)(u)?nV.create(+u):nP.create(u)}},oH.IMPOWER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof t2)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof t2)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof t2?t:"number"==typeof t||(0,k.isRealNum)(t)?nV.create(+t):nP.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return t2.create(X.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return t2.create(X.NUM);if(e.isDifferentSuffixes(i))return t2.create(X.VALUE);r=e.Product(i)}else{let e=new o$(n);if(e.isError())return t2.create(X.NUM);r=e.toString()}return r}},oH.IMPRODUCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.getRealNum();return nV.create(a)}},oH.IMREAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Sec();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMSEC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Sech();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMSECH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Sin();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMSIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Sinh();return s.isError()?t2.create(X.NUM):"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMSINH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);if(0===s.getRealNum()&&0===s.getINum())return nV.create(0);let a=s.Sqrt();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMSQRT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c))return t2.create(X.NUM);let h=u.Sub(c);return"number"==typeof h||(0,k.isRealNum)(h)?nV.create(+h):nP.create(h)}},oH.IMSUB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof t2)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof t2)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof t2?t:"number"==typeof t||(0,k.isRealNum)(t)?nV.create(+t):nP.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return t2.create(X.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return t2.create(X.NUM);if(e.isDifferentSuffixes(i))return t2.create(X.VALUE);r=e.Sum(i)}else{let e=new o$(n);if(e.isError())return t2.create(X.NUM);r=e.toString()}return r}},oH.IMSUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Tan();return"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMTAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return t2.create(X.NUM);let a=s.Tanh();return s.isError()?t2.create(X.NUM):"number"==typeof a||(0,k.isRealNum)(a)?nV.create(+a):nP.create(a)}},oH.IMTANH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return t2.create(X.NUM);let u=10===l.length&&"7"===l.substring(0,1),c=u?Number.parseInt(l,8)-0x40000000:Number.parseInt(l,8);if(c<-512||c>511)return t2.create(X.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r)}},oH.OCT2BIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sZ(s))return t2.create(X.NUM);let a=Number.parseInt(s,8);return a>=0x20000000&&(a-=0x40000000),nV.create(a)}},oH.OCT2DEC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return t2.create(X.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return t2.create(X.VALUE);if(n<0||n>10)return t2.create(X.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return t2.create(X.NUM);let u=Number.parseInt(l,8);if(u>=0x20000000)r=`ff${(u+0xc0000000).toString(16)}`;else if(r=u.toString(16),t){if(n<r.length)return t2.create(X.NUM);r="0".repeat(n-r.length)+r}return nP.create(r.toLocaleUpperCase())}},oH.OCT2HEX]];var oG=((x=oG||{}).ACCRINT="ACCRINT",x.ACCRINTM="ACCRINTM",x.AMORDEGRC="AMORDEGRC",x.AMORLINC="AMORLINC",x.COUPDAYBS="COUPDAYBS",x.COUPDAYS="COUPDAYS",x.COUPDAYSNC="COUPDAYSNC",x.COUPNCD="COUPNCD",x.COUPNUM="COUPNUM",x.COUPPCD="COUPPCD",x.CUMIPMT="CUMIPMT",x.CUMPRINC="CUMPRINC",x.DB="DB",x.DDB="DDB",x.DISC="DISC",x.DOLLARDE="DOLLARDE",x.DOLLARFR="DOLLARFR",x.DURATION="DURATION",x.EFFECT="EFFECT",x.FV="FV",x.FVSCHEDULE="FVSCHEDULE",x.INTRATE="INTRATE",x.IPMT="IPMT",x.IRR="IRR",x.ISPMT="ISPMT",x.MDURATION="MDURATION",x.MIRR="MIRR",x.NOMINAL="NOMINAL",x.NPER="NPER",x.NPV="NPV",x.ODDFPRICE="ODDFPRICE",x.ODDFYIELD="ODDFYIELD",x.ODDLPRICE="ODDLPRICE",x.ODDLYIELD="ODDLYIELD",x.PDURATION="PDURATION",x.PMT="PMT",x.PPMT="PPMT",x.PRICE="PRICE",x.PRICEDISC="PRICEDISC",x.PRICEMAT="PRICEMAT",x.PV="PV",x.RATE="RATE",x.RECEIVED="RECEIVED",x.RRI="RRI",x.SLN="SLN",x.SYD="SYD",x.TBILLEQ="TBILLEQ",x.TBILLPRICE="TBILLPRICE",x.TBILLYIELD="TBILLYIELD",x.VDB="VDB",x.XIRR="XIRR",x.XNPV="XNPV",x.YIELD="YIELD",x.YIELDDISC="YIELDDISC",x.YIELDMAT="YIELDMAT",x);function oY(e,t,r,n){let{days:i}=oU(oK(e,t,r),e,n);return i}function oz(e,t,r,n){let i;if(1===n){let n=oK(e,t,r),s=oy(n),a=oC(s=oF(s,12/r));i=n<0&&1===r?365:a-n}else i=3===n?365/r:360/r;return i}function oq(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=oF(i,-12/r);return oC(i=oF(i,12/r))}function oX(e,t,r){let n=0,i=oy(e),s=oy(t);for(;s>i;)s=oF(s,-12/r),n++;return n}function oK(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=oF(i,-12/r);return oC(i)}function oQ(e,t,r,n,i,s){let a=oY(e,t,i,s),o=oz(e,t,i,s),l=oX(e,t,i),u=(o-a)/o-1,c=n/i+1,h=100*r/i,d=0,m=0;for(let e=1;e<=l;e++){let t=e+u,r=h/c**t;d+=t*r,m+=r}let g=l+u,f=100/c**g;return(d+=g*f)/(m+=f)/i}function oZ(e,t,r,n,i){let s;if(0===e)s=(r+n)/t;else{let a=(1+e)**t;s=1===i?(n*e/(a-1)+r*e/(1-1/a))/(1+e):n*e/(a-1)+r*e/(1-1/a)}return-s}function oJ(e,t,r,n,i){let s;if(0===e)s=n+r*t;else{if(-1===e&&0===t)return Number.NaN;let a=(1+e)**t;s=1===i?n*a+r*(1+e)*(a-1)/e:n*a+r*(a-1)/e}return-s}function o0(e,t,r,n,i,s){let a=oZ(e,r,n,i,s);return(1===t?1===s?0:-n:1===s?oJ(e,t-2,a,n,1)-a:oJ(e,t-1,a,n,0))*e}function o1(e,t){let r=0;for(let n=1;n<=t.length;n++)r+=t[n-1]/(1+e)**n;return r}function o2(e,t,r,n,i,s,a,o,l){let u=o5(r,n,l),c=oz(e,n,o,l);return u<c?function(e,t,r,n,i,s,a,o,l,u,c){let h=0,d=oX(e,t,o),m=o5(e,n,l);h+=a/(1+s/o)**(d-1+m/c)+100*i/o*u/c/(1+s/o)**(m/c);for(let e=2;e<=d;e++)h+=100*i/o/(1+s/o)**(e-1+m/c);return h-100*i/o*o5(r,e,l)/c}(e,t,r,n,i,s,a,o,l,u,c):function(e,t,r,n,i,s,a,o,l,u){let c,h=0,d=oX(n,t,o),m=function(e,t,r,n){let i=oy(e),s=oy(t),a=i.getUTCFullYear(),o=i.getUTCMonth(),l=i.getUTCDate(),u=s.getUTCFullYear(),c=s.getUTCMonth(),h=s.getUTCDate(),d=oL(a,o)===l,m=!d&&1!==o&&l>28&&l<oL(a,o)?oL(u,c)===h:d,g=o6(t,0,m),f=+n-0+ +(t<g),p=o6(g,r,m);for(;!(r>0?p>=t:p<=t);)p=o6(p,r,m),f++;return f}(n,e,12/o,!0);if(2===l||3===l){let t=oq(e,n,o);c=o5(e,t,l)}else{let{days:t}=oU(oK(e,n,o),e,l);c=u-t}h+=a/(1+s/o)**(d+m+c/u);let g=oX(r,n,o),f=n,p=0,C=0;for(let t=g;t>=1;t--){let n=o6(f,-12/o,!1),i=1===l?o5(n,f,l):u;p+=(t>1?i:o5(r,f,l))/i,C+=o5(r>n?r:n,e<f?e:f,l)/i,f=n}h+=100*i/o*p/(1+s/o)**(m+c/u);for(let e=1;e<=d;e++)h+=100*i/o/(1+s/o)**(e+m+c/u);return h-100*i/o*C}(e,t,r,n,i,s,a,o,l,c)}function o5(e,t,r){let{days:n}=oU(e,t,r);return e<t?n:0}function o3(e,t,r){let n=oy(e),i=n.getUTCFullYear(),s=n.getUTCMonth(),a=n.getUTCDate(),o=oL(i,s)===a,l=oy(t),u=l.getUTCFullYear(),c=l.getUTCMonth(),h=l.getUTCDate(),d=oL(u,c)===h;return!(a!==h&&!(o&&d)||Math.abs((u-i)*12+(c-s))%(12/r)!=0)}function o4(e,t,r){return oK(e,t,r)>=0}function o6(e,t,r){let n=oy(e);if(n=oF(n,t),r){let e=oL(n.getUTCFullYear(),n.getUTCMonth());n.setUTCDate(e)}return oC(n)}function o9(e,t){let r=1,n=0,i=e,s;for(;r>1e-7&&n<500;){let e=(t(i+1e-7)-t(i-1e-7))/2e-7;s=i-t(i)/e,n++,r=Math.abs(s-i),i=s}return Number.isNaN(i)||Math.abs(i)===1/0||500===n?function(e,t){let r,n;let i=Number.MAX_VALUE,s=e-.01<=-1?-1+1e-7:e-.01,a=e+.01>=i?i-1e-7:e+.01,o,l,u=0;if(e<=-1||e>=i)return t2.create(X.NUM);for(let e=0;e<60;e++){o=s<=-1?-1+1e-7:s,l=a>=i?i-1e-7:a;let r=t(o),n=t(l);if(r*n<=0)break;if(!(r*n>0)||(s=o+1.6*(o-l),a=l+1.6*(l-o),59===e))return t2.create(X.NUM)}let c=t(o),h=t(l);if(1e-7>Math.abs(c)||1e-7>Math.abs(h))return t2.create(X.NUM);do c*(r=t(n=o+(l-o)/2))<0?l=n:o=n,c=t(o),u++;while(Math.abs(r)>1e-7&&u<60)return n}(e,t):i}function o7(e,t,r,n,i,s,a){let o=oX(e,t,s),l=oz(e,t,s,a),u=oY(e,t,s,a);if(1===o)return(100*r/s+i)/(n/s*(l-u)/l+1)-100*r/s*u/l;let c=l-u,h=i/(1+n/s)**(o-1+c/l);for(let e=1;e<=o;e++)h+=100*r/s/(1+n/s)**(e-1+c/l);return h-100*r/s*u/l}function o8(e,t,r,n,i){let s=0,a=i/r;a>=1?(a=1,s=1===n?e:0):s=e*(1-a)**(n-1);let o=e*(1-a)**n,l=0;return(l=o<t?s-t:s-o)<0&&(l=0),l}let le=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=a?a:nV.create(0),u=null!=o?o:nD.create(!0),{isError:c,errorObject:h,variants:d}=sG(e,t,r,n,i,s,l);if(c)return h;let[m,g,f,p,C,_,y]=d,E=ow(m);if("number"!=typeof E)return E;let b=ow(g);if("number"!=typeof b)return b;let R=ow(f);if("number"!=typeof R)return R;let N=+p.getValue(),I=+C.getValue(),A=Math.floor(+_.getValue()),v=Math.floor(+y.getValue()),S=+u.getValue();return Number.isNaN(N)||Number.isNaN(I)||Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(S)?t2.create(X.VALUE):N<=0||I<=0||![1,2,4].includes(A)||v<0||v>4||Math.floor(E)>=Math.floor(R)?t2.create(X.NUM):this._getResult(E,b,R,N,I,A,v,S)}_getResult(e,t,r,n,i,s,a,o){let l=oK(e,t,s);if(l<=0)return nV.create(0);l=oK(r,t,s);let u=12/s,c=oy(t),h=c.getUTCFullYear(),d=c.getUTCMonth(),m=c.getUTCDate(),g=oL(h,d)===m,f=o6(t,-u,g);if(r>t&&o)for(f=t;f<r;)f=o6(f,u,g);let p=e>f?e:f,{days:C}=oU(p,r,a);if(l>=e){let{days:e}=oU(p,r,a?4:0);C=e}r<p&&(C=-C);let _=oz(f,t,s,a),y=C/_,E=f,b=e;for(;E>e;){b=E;let{days:t}=oU(p=e>(E=o6(E,-u,g))?e:E,b,a);if(0===a)C=b>=p||e<=E?t:-t,_=oz(E,b,s,a);else if(C=b<p?-t:t,3===a)_=365/s;else{let{days:e}=oU(E,b,a);_=b<E?-e:e}y+=e<=E?o?1:0:C/_}let R=i*n/s*y;return nV.create(R)}},oG.ACCRINT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nV.create(0));if(s)return a;let[l,u,c,h,d]=o,m=ow(l);if("number"!=typeof m)return m;let g=ow(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return t2.create(X.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>Math.floor(g))return t2.create(X.NUM);if(Math.floor(m)===Math.floor(g))return nV.create(0);let{days:_,yearDays:y}=oU(m,g,C);return nV.create(p*f*_/y)}},oG.ACCRINTM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,s,null!=a?a:nV.create(0));if(o)return l;let[c,h,d,m,g,f,p]=u,C=ow(h);if("number"!=typeof C)return C;let _=ow(d);if("number"!=typeof _)return _;let y=+c.getValue(),E=+m.getValue(),b=+g.getValue(),R=+f.getValue(),N=Math.floor(+p.getValue());return Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(R)||Number.isNaN(N)?t2.create(X.VALUE):y<=0||E<0||y<E||Math.floor(C)>Math.floor(_)||b<0||R<=0||![0,1,3,4].includes(N)?t2.create(X.NUM):(b=b>1?Math.floor(b):Math.ceil(b),this._getResult(y,C,_,E,b,R,N))}_getResult(e,t,r,n,i,s,a){let o=e-n,l=e*s,{days:u,yearDays:c}=oU(t,r,a),h=u/c,d=Math.ceil(o/l-h);if(d<0)return nV.create(0);let m=l;return 0===i?m=l*h:i===d?m=o-l*(h+i-1):i>d&&(m=0),nV.create(m)}},oG.AMORLINC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return t2.create(X.NUM);let f=oY(h,d,m,g);return nV.create(f)}},oG.COUPDAYBS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return t2.create(X.NUM);let f=oz(h,d,m,g);return nV.create(f)}},oG.COUPDAYS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return t2.create(X.NUM);let f=oy(h),p=oy(d);for(p.setUTCFullYear(f.getUTCFullYear()),p<f&&p.setUTCFullYear(p.getUTCFullYear()+1);p>f;)p.setUTCMonth(p.getUTCMonth()-12/m);p.setUTCMonth(p.getUTCMonth()+12/m);let{days:C}=oU(h,oC(p),g);return nV.create(C)}},oG.COUPDAYSNC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return t2.create(X.NUM);let f=oq(h,d,m);return nV.create(f)}},oG.COUPNCD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d)||0>oK(h,d,m))return t2.create(X.NUM);let f=oX(h,d,m);return nV.create(f)}},oG.COUPNUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nV.create(0));if(i)return s;let[o,l,u,c]=a,h=ow(o);if("number"!=typeof h)return h;let d=ow(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return t2.create(X.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return t2.create(X.NUM);let f=oK(h,d,m);return f<0&&(f=0),nV.create(f)}},oG.COUPPCD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)?t2.create(X.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||_>p||y>p||![0,1].includes(E)?t2.create(X.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nV.create(0):this._getResult(f,p,C,_,y,E)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(0===s&&(o=-r),l++);let u=!1;for(let t=l;t<=i;t++){let n=1===s?oJ(e,t-2,a,r,1):oJ(e,t-1,a,r,0);if(0===n){u=!0;break}o+=1===s?n-a:n}return((o*=e)<a*(i-n+1)||u)&&(o=a*(i-n+1)),nV.create(o)}},oG.CUMIPMT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)?t2.create(X.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||![0,1].includes(E)?t2.create(X.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nV.create(0):this._getResult(f,p,C,_,y,E)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(o=0===s?a+r*e:a,l++);for(let t=l;t<=i;t++)o+=1===s?a-(oJ(e,t-2,a,r,1)-a)*e:a-oJ(e,t-1,a,r,0)*e;return nV.create(o)}},oG.CUMPRINC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5),G(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nV.create(12);s.isNull()&&(s=nV.create(12));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=nQ(a,o,e,t2.create(X.NA)),u=nQ(a,o,t,t2.create(X.NA)),c=nQ(a,o,r,t2.create(X.NA)),h=nQ(a,o,n,t2.create(X.NA)),d=nQ(a,o,s,t2.create(X.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,c.get(t,r),h.get(t,r),d.get(t,r));if(i)return s;let[o,l,m,g,f]=a,p=+o.getValue(),C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),E=Math.floor(+f.getValue());return p<0||C<0||_<=0||y<=0||Math.floor(y)>Math.floor(_)||E<1||E>12?t2.create(X.NUM):(y<1&&(y=1),y=Math.floor(y),this._getResult(p,C,_,y,E,t,r))});return 1===a&&1===o?m.get(0,0):m}_getResult(e,t,r,n,i,s,a){let o;let l=+(1-(t/e)**(1/r)).toFixed(3),u=e*l*i/12,c=u,h=0,d=n===r?r-1:n;for(let t=2;t<=d;t++)h=(e-c)*l,c+=h;return Number.isNaN(o=1===n?u:n===r?(e-c)*l:h)||!Number.isFinite(o)?t2.create(X.NUM):0===s&&0===a?nV.create(o,tK(this.getLocale())):nV.create(o)}},oG.DB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5),G(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nV.create(2);s.isNull()&&(s=nV.create(2));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=nQ(a,o,e,t2.create(X.NA)),u=nQ(a,o,t,t2.create(X.NA)),c=nQ(a,o,r,t2.create(X.NA)),h=nQ(a,o,n,t2.create(X.NA)),d=nQ(a,o,s,t2.create(X.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,c.get(t,r),h.get(t,r),d.get(t,r));if(i)return s;let[o,l,m,g,f]=a,p=+o.getValue(),C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),E=+f.getValue();if(p<0||C<0||_<=0||y<=0||y>_||E<=0)return t2.create(X.NUM);let b=o8(p,C,_,y,E);return Number.isNaN(b)||!Number.isFinite(b)?t2.create(X.NUM):0===t&&0===r?nV.create(b,tK(this.getLocale())):nV.create(b)});return 1===a&&1===o?m.get(0,0):m}},oG.DDB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nV.create(0));if(s)return a;let[l,u,c,h,d]=o,m=ow(l);if("number"!=typeof m)return m;let g=ow(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return t2.create(X.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return t2.create(X.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nV.create((p-f)/p*(y/_))}},oG.DISC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);if(l>=0&&l<1)return t2.create(X.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);u+=o%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;let c=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return u=Math.round(u*c)/c,nV.create(u)}},oG.DOLLARDE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(l<0)return t2.create(X.NUM);if(l>=0&&l<1)return t2.create(X.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);return u+=o%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,nV.create(u)}},oG.DOLLARFR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nV.create(0);a.isNull()&&(a=nV.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=ow(c);if("number"!=typeof p)return p;let C=ow(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),E=Math.floor(+g.getValue()),b=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(b))return t2.create(X.VALUE);if(_<0||y<0||![1,2,4].includes(E)||b<0||b>4||Math.floor(p)>=Math.floor(C)||p<=0||C<=366)return t2.create(X.NUM);let R=oQ(p,C,_,y,E,b);return nV.create(R)}},oG.DURATION],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(o<=0||l<1)return t2.create(X.NUM);l=Number.parseInt(`${l}`,10);let u=(1+o/l)**l-1;return nV.create(u)}},oG.EFFECT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5),G(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,h.get(t,r),d.get(t,r),m.get(t,r));if(i)return s;let[o,l,u,g,f]=a,p=+o.getValue(),C=+l.getValue(),_=oJ(p,C,+u.getValue(),+g.getValue(),+f.getValue()?1:0);return Number.isNaN(_)||!Number.isFinite(_)?t2.create(X.NUM):0===t&&0===r?nV.create(_,tK(this.getLocale())):nV.create(_)});return 1===o&&1===l?g.get(0,0):g}},oG.FV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return t2.create(X.VALUE);let o=a;if(t.isArray()){let e=t.getArrayValue().flat();for(let t=0;t<e.length;t++){let r=e[t];if(r.isBoolean())return t2.create(X.VALUE);let n=+r.getValue();if(Number.isNaN(n))return t2.create(X.VALUE);o*=1+n}}else{if(t.isBoolean())return t2.create(X.VALUE);let e=+t.getValue();if(Number.isNaN(e))return t2.create(X.VALUE);o*=1+e}return nV.create(o)}},oG.FVSCHEDULE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nV.create(0));if(s)return a;let[l,u,c,h,d]=o,m=ow(l);if("number"!=typeof m)return m;let g=ow(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return t2.create(X.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return t2.create(X.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nV.create((p-f)/f*(y/_))}},oG.INTRATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",6),G(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nV.create(0),o=null!=s?s:nV.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,e,t2.create(X.NA)),h=nQ(l,u,t,t2.create(X.NA)),d=nQ(l,u,r,t2.create(X.NA)),m=nQ(l,u,n,t2.create(X.NA)),g=nQ(l,u,a,t2.create(X.NA)),f=nQ(l,u,o,t2.create(X.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,m.get(t,r),g.get(t,r),f.get(t,r));if(s)return a;let[l,u,c,p,C,_]=o,y=+l.getValue(),E=+u.getValue(),b=+c.getValue(),R=+p.getValue(),N=+C.getValue(),I=+_.getValue();if(E<1||Math.floor(E)>Math.ceil(b))return t2.create(X.NUM);let A=o0(y,E,b,R,N,I?1:0);return Number.isNaN(A)||!Number.isFinite(A)?t2.create(X.NUM):0===t&&0===r?nV.create(A,tK(this.getLocale())):nV.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.IPMT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(.1);return r.isNull()&&(r=nV.create(.1)),r.isArray()?r.map((t,r,n)=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return t2.create(X.VALUE);if(!e.isArray())return t2.create(X.NUM);let{_values:i,valuesHasError:s}=this._getValues(e);if(s)return t2.create(X.VALUE);let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()).isError())return a;let o=+a.getValue(),{positive:l,negative:u}=this._checkValues(i);if(!l||!u)return t2.create(X.NUM);let c=o9(o,e=>o1(e,i));return"number"!=typeof c?c:0===r&&0===n?nV.create(c,"0%"):nV.create(c)}_getValues(e){let t=[],r=!1;return e.iterator(e=>{if(e.isError())return r=!0,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;t.push(n)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}},oG.IRR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sz(e,o.get(t,r),l.get(t,r),u.get(t,r));if(n)return i;let[a,c,h,d]=s,m=+a.getValue(),g=+c.getValue(),f=+h.getValue(),p=+d.getValue();return 0===f?t2.create(X.DIV_BY_ZERO):nV.create(p*m*(g/f-1))});return 1===i&&1===s?c.get(0,0):c}},oG.ISPMT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nV.create(0);a.isNull()&&(a=nV.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=ow(c);if("number"!=typeof p)return p;let C=ow(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),E=Math.floor(+g.getValue()),b=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(b))return t2.create(X.VALUE);if(_<0||y<0||![1,2,4].includes(E)||b<0||b>4||Math.floor(p)>=Math.floor(C))return t2.create(X.NUM);let R=oQ(p,C,_,y,E,b);return R/=1+y/E,nV.create(R)}},oG.MDURATION],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{_values:n,numberValues:i,positive:s,negative:a}=this._getValues(e),o=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=nQ(o,l,t,t2.create(X.NA)),c=nQ(o,l,r,t2.create(X.NA)),h=u.map((t,r,o)=>{let l=c.get(r,o);if(e.isError())return e;if(l.isError())return l;if(n.isError())return n;if(!s||!a)return t2.create(X.DIV_BY_ZERO);let u=+t.getValue(),h=+l.getValue();if(Number.isNaN(u)||Number.isNaN(h))return t2.create(X.VALUE);if(-1===h)return t2.create(X.DIV_BY_ZERO);let d=this._getResult(i,u,h);return 0===r&&0===o?nV.create(d,"0%"):nV.create(d)});return 1===o&&1===l?h.get(0,0):h}_getValues(e){let t=e,r=[],n=!1,i=!1;if(!e.isError()){if(e.isNull())t=t2.create(X.VALUE);else if(e.isArray()){let{numberValues:s,valuesHasError:a,errorObject:o,positive:l,negative:u}=this._checkValues(e);a&&(t=o),r=s,n=l,i=u}else t=t2.create(X.DIV_BY_ZERO)}return{_values:t,numberValues:r,positive:n,negative:i}}_checkValues(e){let t=[],r=!1,n=t2.create(X.VALUE),i=!1,s=!1;return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return!0;let a=+e.getValue();if(Number.isNaN(a))return!0;a>0&&(i=!0),a<0&&(s=!0),t.push(a)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:i,negative:s}}_getResult(e,t,r){let n=e.length,i=[],s=[];for(let t=0;t<n;t++)e[t]>0?s.push(e[t]):e[t]<0&&i.push(e[t]);let a=this._npv(r,e,"positive"),o=this._npv(t,e,"negative"),l=-a*(1+r)**n,u=o*(1+t);return(l/u)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let i=1;i<=t.length;i++){let s=t[i-1];("positive"===r&&s>0||"negative"===r&&s<0)&&(n+=s/(1+e)**i)}return n}},oG.MIRR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(o<=0||l<1)return t2.create(X.NUM);l=Number.parseInt(`${l}`,10);let u=((o+1)**(1/l)-1)*l;return nV.create(u)}},oG.NOMINAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.map((e,t,r)=>{let n;let i=c.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,i,h.get(t,r),d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=+f.getValue(),b=+p.getValue();return(b=b?1:0,0===C&&0===_)?t2.create(X.DIV_BY_ZERO):Number.isNaN(n=0===C?-(y+E)/_:Math.log((_*(1+C*b)-E*C)/(y*C+_*(1+C*b)))/Math.log(1+C))||!Number.isFinite(n)?t2.create(X.NUM):nV.create(n)});return 1===o&&1===l?g.get(0,0):g}},oG.NPER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255),G(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;let{isError:r,errorObject:n,values:i}=this._getValues(t);return e.isArray()?e.map((e,t,s)=>this._handleSingleObject(e,r,n,i,t,s)):this._handleSingleObject(e,r,n,i)}_handleSingleObject(e,t,r,n,i=0,s=0){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(t)return r;let o=o1(+e.getValue(),n);return Number.isNaN(o)||Math.abs(o)===1/0?t2.create(X.DIV_BY_ZERO):0===i&&0===s?nV.create(o,tK(this.getLocale())):nV.create(o)}_getValues(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let e=!1,r=t2.create(X.VALUE);if(n.iterator(n=>{if(n.isError())return e=!0,r=n,!1;if(n.isNull()||n.isBoolean())return!0;let i=+n.getValue();if(Number.isNaN(i))return!0;t.push(i)}),e)return{isError:e,errorObject:r}}else{let e=+n.getValue();if(Number.isNaN(e))return{isError:!0,errorObject:t2.create(X.VALUE)};t.push(e)}}return{isError:!1,values:t}}},oG.NPV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",8),G(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nV.create(0);u.isNull()&&(u=nV.create(0));let{isError:c,errorObject:h,variants:d}=sY(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,E,b]=d,R=ow(m);if("number"!=typeof R)return R;let N=ow(g);if("number"!=typeof N)return N;let I=ow(f);if("number"!=typeof I)return I;let A=ow(p);if("number"!=typeof A)return A;let v=+C.getValue(),S=+_.getValue(),T=+y.getValue(),O=Math.floor(+E.getValue()),M=Math.floor(+b.getValue());if(Number.isNaN(v)||Number.isNaN(S)||Number.isNaN(T)||Number.isNaN(O)||Number.isNaN(M))return t2.create(X.VALUE);if(v<0||S<0||T<=0||![1,2,4].includes(O)||M<0||M>4||!this._validDate(N,A,R,I,O))return t2.create(X.NUM);let w=o2(R,N,I,A,v,S,T,O,M);return nV.create(w)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}},oG.ODDFPRICE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",8),G(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nV.create(0);u.isNull()&&(u=nV.create(0));let{isError:c,errorObject:h,variants:d}=sY(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,E,b]=d,R=ow(m);if("number"!=typeof R)return R;let N=ow(g);if("number"!=typeof N)return N;let I=ow(f);if("number"!=typeof I)return I;let A=ow(p);if("number"!=typeof A)return A;let v=+C.getValue(),S=+_.getValue(),T=+y.getValue(),O=Math.floor(+E.getValue()),M=Math.floor(+b.getValue());return Number.isNaN(v)||Number.isNaN(S)||Number.isNaN(T)||Number.isNaN(O)||Number.isNaN(M)?t2.create(X.VALUE):v<0||S<=0||T<=0||![1,2,4].includes(O)||M<0||M>4||!this._validDate(N,A,R,I,O)?t2.create(X.NUM):this._getResult(R,N,I,A,v,S,T,O,M)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,i,s,a,o,l){let{days:u}=oU(e,t,l),c=o9((i*u*100-(s-100))/((s-100)*.25*(1+2*u)+100*u),u=>s-o2(e,t,r,n,i,u,a,o,l));return"number"!=typeof c?c:nV.create(c)}},oG.ODDFYIELD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",7),G(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nV.create(0);l.isNull()&&(l=nV.create(0));let{isError:u,errorObject:c,variants:h}=sY(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,E=ow(d);if("number"!=typeof E)return E;let b=ow(m);if("number"!=typeof b)return b;let R=ow(g);if("number"!=typeof R)return R;let N=+f.getValue(),I=+p.getValue(),A=+C.getValue(),v=Math.floor(+_.getValue()),S=Math.floor(+y.getValue());if(Number.isNaN(N)||Number.isNaN(I)||Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(S))return t2.create(X.VALUE);if(N<0||I<0||A<=0||![1,2,4].includes(v)||S<0||S>4||!this._validDate(b,E,R,v))return t2.create(X.NUM);let T=this._getResult(E,b,R,N,I,A,v,S);return nV.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(s*a+100*n*(c-u*(1+i*h/a)))/(i*h+a)}_getCoupDate(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return oC(i)}_getFrac(e,t,r,n,i){let s=oy(e),a=oy(t),o=oy(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=oC(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=oC(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oy(u),m=oy(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=oC(d),u=oC(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLPRICE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",8),G(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nV.create(0);l.isNull()&&(l=nV.create(0));let{isError:u,errorObject:c,variants:h}=sY(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,E=ow(d);if("number"!=typeof E)return E;let b=ow(m);if("number"!=typeof b)return b;let R=ow(g);if("number"!=typeof R)return R;let N=+f.getValue(),I=+p.getValue(),A=+C.getValue(),v=Math.floor(+_.getValue()),S=Math.floor(+y.getValue());if(Number.isNaN(N)||Number.isNaN(I)||Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(S))return t2.create(X.VALUE);if(N<0||I<=0||A<=0||![1,2,4].includes(v)||S<0||S>4||!this._validDate(b,E,R,v))return t2.create(X.NUM);let T=this._getResult(E,b,R,N,I,A,v,S);return nV.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(a*(s-i)+100*n*(c-u))/(h*i+100*n*u*h/a)}_getCoupDate(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return oC(i)}_getFrac(e,t,r,n,i){let s=oy(e),a=oy(t),o=oy(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=oC(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=oC(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oy(u),m=oy(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=oC(d),u=oC(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLYIELD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sz(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=-1)return t2.create(X.NUM);let g=(Math.log(m)-Math.log(d))/Math.log(1+h);return Number.isNaN(g)||!Number.isFinite(g)?t2.create(X.NUM):nV.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.PDURATION],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5),G(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,h.get(t,r),d.get(t,r),m.get(t,r));if(i)return s;let[o,l,u,g,f]=a,p=+o.getValue(),C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=+f.getValue();if(p<=-1)return t2.create(X.NUM);let b=oZ(p,C,_,y,E?1:0);return Number.isNaN(b)||!Number.isFinite(b)?t2.create(X.NUM):0===t&&0===r?nV.create(b,tK(this.getLocale())):nV.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PMT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",6),G(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nV.create(0),o=null!=s?s:nV.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,e,t2.create(X.NA)),h=nQ(l,u,t,t2.create(X.NA)),d=nQ(l,u,r,t2.create(X.NA)),m=nQ(l,u,n,t2.create(X.NA)),g=nQ(l,u,a,t2.create(X.NA)),f=nQ(l,u,o,t2.create(X.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,m.get(t,r),g.get(t,r),f.get(t,r));if(s)return a;let[l,u,c,p,C,_]=o,y=+l.getValue(),E=+u.getValue(),b=+c.getValue(),R=+p.getValue(),N=+C.getValue(),I=+_.getValue();if(E<1||Math.floor(E)>Math.ceil(b)||E-b>=1)return t2.create(X.NUM);let A=oZ(y,b,R,N,I?1:0)-o0(y,E,b,R,N,I?1:0);return Number.isNaN(A)||!Number.isFinite(A)?t2.create(X.NUM):0===t&&0===r?nV.create(A,tK(this.getLocale())):nV.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.PPMT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nV.create(0);o.isNull()&&(o=nV.create(0));let{isError:l,errorObject:u,variants:c}=sY(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=ow(h);if("number"!=typeof _)return _;let y=ow(d);if("number"!=typeof y)return y;let E=+m.getValue(),b=+g.getValue(),R=+f.getValue(),N=Math.floor(+p.getValue()),I=Math.floor(+C.getValue());if(Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(I))return t2.create(X.VALUE);if(E<0||b<0||R<=0||![1,2,4].includes(N)||I<0||I>4||_>=y||!o4(_,y,N))return t2.create(X.NUM);let A=o7(_,y,E,b,R,N,I);return nV.create(A)}},oG.PRICE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nV.create(0);s.isNull()&&(s=nV.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=ow(u);if("number"!=typeof g)return g;let f=ow(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return t2.create(X.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return t2.create(X.NUM);let{days:y,yearDays:E}=oU(g,f,_);return nV.create(C-p*C*y/E)}},oG.PRICEDISC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nV.create(0);a.isNull()&&(a=nV.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=ow(c);if("number"!=typeof p)return p;let C=ow(h);if("number"!=typeof C)return C;let _=ow(d);if("number"!=typeof _)return _;let y=+m.getValue(),E=+g.getValue(),b=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(b))return t2.create(X.VALUE);let R=this._getDateCorrectOrder(C,p,_);if(y<0||E<0||b<0||b>4||!R)return t2.create(X.NUM);let N=oj(p,b),{days:I}=oU(p,C,b),{days:A}=oU(_,C,b),{days:v}=oU(_,p,b);return nV.create((100+A/N*y*100)/(1+I/N*E)-v/N*y*100)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.PRICEMAT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5),G(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nV.create(0),a=null!=i?i:nV.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,e,t2.create(X.NA)),c=nQ(o,l,t,t2.create(X.NA)),h=nQ(o,l,r,t2.create(X.NA)),d=nQ(o,l,s,t2.create(X.NA)),m=nQ(o,l,a,t2.create(X.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,h.get(t,r),d.get(t,r),m.get(t,r));if(i)return s;let[o,l,u,g,f]=a,p=+o.getValue(),C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=+f.getValue();E=E?1:0;let b=0===p?-_*C-y:((1-(1+p)**C)/p*_*(1+p*E)-y)/(1+p)**C;return Number.isNaN(b)||!Number.isFinite(b)?t2.create(X.NUM):0===t&&0===r?nV.create(b,tK(this.getLocale())):nV.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=n?n:nV.create(0),o=null!=i?i:nV.create(0),l=null!=s?s:nV.create(.1),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=nQ(u,c,e,t2.create(X.NA)),d=nQ(u,c,t,t2.create(X.NA)),m=nQ(u,c,r,t2.create(X.NA)),g=nQ(u,c,a,t2.create(X.NA)),f=nQ(u,c,o,t2.create(X.NA)),p=nQ(u,c,l,t2.create(X.NA)),C=h.map((e,t,r)=>{let n=d.get(t,r),i=m.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,g.get(t,r),f.get(t,r),p.get(t,r));if(s)return a;let[l,u,c,h,C,_]=o,y=+l.getValue(),E=+u.getValue(),b=+c.getValue(),R=+h.getValue(),N=+C.getValue(),I=+_.getValue();return N=N?1:0,y<=0||E>=0?t2.create(X.NUM):this._getResult(y,E,b,R,N,I,t,r)});return 1===u&&1===c?C.get(0,0):C}_getResult(e,t,r,n,i,s,a,o){let l=s;for(let s=0;s<20;s++){let s,a,o;if(l<=-1)return t2.create(X.NUM);if(1e-10>Math.abs(s=1e-10>Math.abs(l)?r*(1+e*l)+t*(1+l*i)*e+n:r*(a=(1+l)**e)+t*(1/l+i)*(a-1)+n))break;if(1e-10>Math.abs(l))o=r*e+t*i*e;else{a=(1+l)**e;let n=e*(1+l)**(e-1);o=r*n+t*(1/l+i)*n+-1/(l*l)*t*(a-1)}l-=s/o}return 0===a&&0===o?nV.create(l,"0%"):nV.create(l)}},oG.RATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nV.create(0);s.isNull()&&(s=nV.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=ow(u);if("number"!=typeof g)return g;let f=ow(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return t2.create(X.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return t2.create(X.NUM);let{days:y,yearDays:E}=oU(g,f,_),b=p/(1-C*y/E);return b<0?t2.create(X.NUM):nV.create(b)}},oG.RECEIVED],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",6)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sz(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=0)return t2.create(X.NUM);if(0===d&&0===m)return nV.create(0);let g=(m/d)**(1/h)-1;return Number.isNaN(g)||!Number.isFinite(g)||m/d<0?t2.create(X.NUM):nV.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.RRI],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3),G(this,"needsLocale",!0)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.map((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(n.isError())return n;if(i.isError())return i;let s=+e.getValue(),l=+n.getValue(),u=+i.getValue();if(Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(u))return t2.create(X.VALUE);if(0===u)return t2.create(X.DIV_BY_ZERO);let c=(s-l)/u;return 0===t&&0===r?nV.create(c,tK(this.getLocale())):nV.create(c)});return 1===n&&1===i?l.get(0,0):l}},oG.SLN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4),G(this,"needsLocale",!0)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=+e.getValue(),c=+n.getValue(),h=+i.getValue(),d=+s.getValue();if(Number.isNaN(a)||Number.isNaN(c)||Number.isNaN(h)||Number.isNaN(d))return t2.create(X.VALUE);if(c<0||h<=0||d>h)return t2.create(X.NUM);let m=(a-c)*(h-d+1)*2/(h*(h+1));return 0===t&&0===r?nV.create(m,tK(this.getLocale())):nV.create(m)});return 1===i&&1===s?c.get(0,0):c}},oG.SYD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=ow(a);if("number"!=typeof u)return u;let c=ow(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return t2.create(X.VALUE);if(h<=0||u>=c)return t2.create(X.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oy(u).getUTCFullYear()))return t2.create(X.NUM);let m=365*h/(360-h*d);if(d>182){let e=d/365;if(Number.isNaN(m=(-e+Math.sqrt(e*e-(2*e-1)*(1-100/(100*(1-h*d/360)))))/(e-.5)))return t2.create(X.NUM)}return m<0?t2.create(X.NUM):nV.create(m)}},oG.TBILLEQ],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3),G(this,"needsLocale",!0)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=ow(a);if("number"!=typeof u)return u;let c=ow(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return t2.create(X.VALUE);if(h<=0||u>=c)return t2.create(X.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oy(u).getUTCFullYear()))return t2.create(X.NUM);let m=100*(1-h*d/360);return m<0?t2.create(X.NUM):nV.create(m,tK(this.getLocale()))}},oG.TBILLPRICE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=ow(a);if("number"!=typeof u)return u;let c=ow(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return t2.create(X.VALUE);if(h<=0||u>=c)return t2.create(X.NUM);let d=Math.floor(c)-Math.floor(u);return d>oP(oy(u).getUTCFullYear())?t2.create(X.NUM):nV.create((100-h)/h*360/d)}},oG.TBILLYIELD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",7),G(this,"needsLocale",!0)}calculate(e,t,r,n,i,s,a){let o=null!=s?s:nV.create(2);o.isNull()&&(o=nV.create(2));let l=null!=a?a:nD.create(!1);l.isNull()&&(l=nD.create(!1));let u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=nQ(u,c,e,t2.create(X.NA)),d=nQ(u,c,t,t2.create(X.NA)),m=nQ(u,c,r,t2.create(X.NA)),g=nQ(u,c,n,t2.create(X.NA)),f=nQ(u,c,i,t2.create(X.NA)),p=nQ(u,c,o,t2.create(X.NA)),C=nQ(u,c,l,t2.create(X.NA));return this._getResultArray(h,d,m,g,f,p,C,u,c)}_getResultArray(e,t,r,n,i,s,a,o,l){let u=e.map((e,o,l)=>{let u=t.get(o,l),c=r.get(o,l),h=n.get(o,l),{isError:d,errorObject:m,variants:g}=sz(e,u,c,h,i.get(o,l),s.get(o,l),a.get(o,l));if(d)return m;let[f,p,C,_,y,E,b]=g,R=+f.getValue(),N=+p.getValue(),I=+C.getValue(),A=+_.getValue(),v=+y.getValue(),S=+E.getValue(),T=+b.getValue();if(R<0||N<0||I<0||A<0||v<0||v>I||A>v||S<0)return t2.create(X.NUM);if(0===I&&0===A&&0===v)return t2.create(X.DIV_BY_ZERO);let O=this._getResult(R,N,I,A,v,S,T);return 0===o&&0===l?nV.create(O,tK(this.getLocale())):nV.create(O)});return 1===o&&1===l?u.get(0,0):u}_getResult(e,t,r,n,i,s,a){let o=Math.floor(n),l=Math.ceil(i),u=0;if(e<t){if(n>=1||a)return u;let r=Math.abs(e-t);return-(u=r*(i-n)>r?r:r*(i-n))}if(a)for(let a=o+1;a<=l;a++){let c=o8(e,t,r,a,s);a===o+1?c*=Math.min(i,o+1)-n:a===l&&(c*=i+1-l),u+=c}else{let a=e-this._getVdb(e,t,r,r,n,s);u=this._getVdb(a,t,r,r-n,i-n,s)}return u}_getVdb(e,t,r,n,i,s){let a=Math.ceil(i),o=0,l=e-t,u=0,c=0,h=!1;for(let d=1;d<=a;d++){if(h)c=u;else{let i=o8(e,t,r,d,s);(u=l/(n-(d-1)))>i?(c=u,h=!0):(c=i,l-=i)}d===a&&(c*=i+1-a),o+=c}return o}},oG.VDB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return t2.create(X.NA);let{isError:n,errorObejct:i,_values:s,_dates:a}=this._checkErrors(e,t);if(n)return i;let o=null!=r?r:nV.create(.1);o.isNull()&&(o=nV.create(.1));let{isError:l,errorObject:u,variants:c}=sG(o);if(l)return u;let[h]=c,d=+h.getValue();if(Number.isNaN(d))return t2.create(X.VALUE);let{positive:m,negative:g}=this._checkValues(s);if(!m||!g||(null==s?void 0:s.length)!==(null==a?void 0:a.length)||d<0)return t2.create(X.NUM);let f=o9(d,e=>this._iterF(s,a,e));return"number"!=typeof f?f:nV.create(f)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isBoolean())return r=!0,n=t2.create(X.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=t2.create(X.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:t2.create(X.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,k.isRealNum)(t)?{isError:!0,errorObejct:t2.create(X.VALUE)}:{isError:!0,errorObejct:t2.create(X.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);return e.iterator(e=>{if(null!=e&&e.isError())return r=!0,n=e,!1;if(null!=e&&e.isBoolean())return r=!0,n=t2.create(X.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=t2.create(X.VALUE),!1):i<0?(r=!0,n=t2.create(X.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:t2.create(X.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,k.isRealNum)(t)?{isError:!0,errorObejct:t2.create(X.VALUE)}:0>+t?{isError:!0,errorObejct:t2.create(X.NUM)}:{isError:!0,errorObejct:t2.create(X.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((e,n,i)=>e+n/(1+r)**((t[i]-t[0])/365),0)}},oG.XIRR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return t2.create(X.NA);let{isError:n,errorObject:i,variants:s}=sG(e);if(n)return i;let[a]=s,o=+a.getValue();if(Number.isNaN(o))return t2.create(X.VALUE);let{isError:l,errorObejct:u,_values:c,_dates:h}=this._checkErrors(t,r);if(l)return u;if(o<0||c.length!==h.length)return t2.create(X.NUM);let d=0,m=h[0];for(let e=0;e<h.length;e++){let t=h[e];d+=c[e]/(1+o)**((t-m)/365)}return nV.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=t2.create(X.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=t2.create(X.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:t2.create(X.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,k.isRealNum)(t)?{isError:!0,errorObejct:t2.create(X.VALUE)}:{isError:!0,errorObejct:t2.create(X.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=t2.create(X.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=t2.create(X.VALUE),!1):i<0?(r=!0,n=t2.create(X.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:t2.create(X.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,k.isRealNum)(t)?{isError:!0,errorObejct:t2.create(X.VALUE)}:0>+t?{isError:!0,errorObejct:t2.create(X.NUM)}:{isError:!0,errorObejct:t2.create(X.NA)}}}},oG.XNPV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",6),G(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nV.create(0);o.isNull()&&(o=nV.create(0));let{isError:l,errorObject:u,variants:c}=sY(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=ow(h);if("number"!=typeof _)return _;let y=ow(d);if("number"!=typeof y)return y;let E=+m.getValue(),b=+g.getValue(),R=+f.getValue(),N=Math.floor(+p.getValue()),I=Math.floor(+C.getValue());if(Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(R)||Number.isNaN(N)||Number.isNaN(I))return t2.create(X.VALUE);if(E<0||b<=0||R<=0||![1,2,4].includes(N)||I<0||I>4||_>=y||!o4(_,y,N))return t2.create(X.NUM);let A=this._getResult(_,y,E,b,R,N,I);return nV.create(A)}_getResult(e,t,r,n,i,s,a){if(oX(e,t,s)>1){let o=r||.01,l=o7(e,t,r,o,i,s,a),u=l-n;for(let c=0;c<100&&Math.abs(u)>1e-7;c++)l=o7(e,t,r,1.01*o,i,s,a),o+=-u/(l-n-u)*o*.01,u=o7(e,t,r,o,i,s,a)-n;return o}let o=oY(e,t,s,a),l=oz(e,t,s,a),{days:u}=oU(e,t,a),c=n/100+o/l*r/s;return(i/100+r/s-c)/c*s*l/u}},oG.YIELD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nV.create(0);s.isNull()&&(s=nV.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=ow(u);if("number"!=typeof g)return g;let f=ow(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return t2.create(X.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return t2.create(X.NUM);let{days:y,yearDays:E}=oU(g,f,_);return nV.create((C/p-1)/(y/E))}},oG.YIELDDISC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nV.create(0);a.isNull()&&(a=nV.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=ow(c);if("number"!=typeof p)return p;let C=ow(h);if("number"!=typeof C)return C;let _=ow(d);if("number"!=typeof _)return _;let y=+m.getValue(),E=+g.getValue(),b=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(b))return t2.create(X.VALUE);let R=this._getDateCorrectOrder(C,p,_);if(y<0||E<=0||b<0||b>4||!R)return t2.create(X.NUM);let N=oj(p,b),{days:I}=oU(p,C,b),{days:A}=oU(_,C,b),{days:v}=oU(_,p,b);return nV.create(((1+A/N*y)/(E/100+v/N*y)-1)/(I/N))}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.YIELDMAT]];var lt=((U=lt||{}).CELL="CELL",U.ERROR_TYPE="ERROR.TYPE",U.INFO="INFO",U.ISBETWEEN="ISBETWEEN",U.ISBLANK="ISBLANK",U.ISDATE="ISDATE",U.ISEMAIL="ISEMAIL",U.ISERR="ISERR",U.ISERROR="ISERROR",U.ISEVEN="ISEVEN",U.ISFORMULA="ISFORMULA",U.ISLOGICAL="ISLOGICAL",U.ISNA="ISNA",U.ISNONTEXT="ISNONTEXT",U.ISNUMBER="ISNUMBER",U.ISODD="ISODD",U.ISOMITTED="ISOMITTED",U.ISREF="ISREF",U.ISTEXT="ISTEXT",U.ISURL="ISURL",U.N="N",U.NA="NA",U.SHEET="SHEET",U.SHEETS="SHEETS",U.TYPE="TYPE",U);let lr=[[class extends sq{constructor(){super(...arguments),G(this,"needsReferenceObject",!0),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),n=r.getColumnCount();if(1===e&&1===n){let e=r.get(0,0);return this._handleSingleObject(e,t)}return r.map(e=>e.isError()?e:this._handleSingleObject(e,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n,i=t;if(i.isError())return i;if(!i.isReferenceObject())return t2.create(X.NA);let{columnData:s,defaultColumnWidth:a}=i.getCurrentActiveSheetData(),o=(i=i.toArrayValueObject()).getCurrentRow(),l=i.getCurrentColumn();switch(i=i.getFirstCell(),`${e.getValue()}`.toLocaleLowerCase()){case"address":return nP.create(`$${(0,k.Tools).chatAtABC(l)}$${o+1}`);case"col":return nV.create(l+1);case"color":case"parentheses":return nV.create(0);case"contents":return i;case"filename":default:return t2.create(X.VALUE);case"format":return nP.create("G");case"prefix":return nP.create("");case"protect":return nV.create(1);case"row":return nV.create(o+1);case"type":return n="v",i.isNull()&&(n="b"),i.isString()&&(n="l"),nP.create(n);case"width":return this._getWidthResult(s,a,l,r)}}_getWidthResult(e,t,r,n){var i;let s=null==(i=e[r])?void 0:i.w;if(s||0===s||(s=t),n)return nV.create(s);let a=[[s,s===t]];return nB.createByArray(a)}},lt.CELL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"_errorTypeValueMap",/* @__PURE__ */new Map([[X.NULL,1],[X.DIV_BY_ZERO,2],[X.VALUE,3],[X.REF,4],[X.NAME,5],[X.NUM,6],[X.NA,7],[X.CONNECT,8],[X.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?nV.create(r):t2.create(X.NA)}},lt.ERROR_TYPE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sW(e,t,r,null!=n?n:nD.create(!0),null!=i?i:nD.create(!0));if(s)return a;let[l,u,c,h,d]=o;if(l.isString()||u.isString()||c.isString()||h.isString()||d.isString())return t2.create(X.VALUE);let m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();return g>f?t2.create(X.NUM):nD.create((p?m>=g:m>g)&&(C?m<=f:m<f))}},lt.ISBETWEEN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isNull()?nD.create(!0):e.isArray()?e.mapValue(e=>e.isNull()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISBLANK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&""!==t.getPattern()?nD.create(oA(t.getPattern())):t.isString()&&(oR(`${t.getValue()}`)||oI(`${t.getValue()}`))?nD.create(!0):nD.create(!1)}},lt.ISDATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nD.create(!1);let r=`${t.getValue()}`;if(r.length>254)return nD.create(!1);let n=(0,k.Tools).topLevelDomainCombiningString(),i=RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return nD.create(i.test(r))}},lt.ISEMAIL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.getValue()===X.NA?nD.create(!1):e.isError()?nD.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===X.NA?nD.create(!1):e.isError()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISERR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?nD.create(!0):e.isArray()?e.mapValue(e=>e.isError()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISERROR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return t2.create(X.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?t2.create(X.VALUE):nD.create(r%2==0)}},lt.ISEVEN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return t2.create(X.NA);let r=null==(t=e.getCurrentActiveSheetData())?void 0:t.cellData.getMatrix(),{startRow:n,startColumn:i}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((e,t,s)=>{var a;let o=null==(a=null==r?void 0:r[n+t])?void 0:a[i+s];return null!=o&&o.f||null!=o&&o.si?nD.create(!0):nD.create(!1)});return 1===s.getRowCount()&&1===s.getColumnCount()?a.get(0,0):a}},lt.ISFORMULA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isBoolean()?nD.create(!0):e.isArray()?e.mapValue(e=>e.isBoolean()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISLOGICAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.getValue()===X.NA?nD.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===X.NA?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISNA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()||e.isString()?e.isArray()?e.mapValue(e=>e.isString()?nD.create(!1):nD.create(!0)):nD.create(!1):nD.create(!0)}},lt.ISNONTEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isNumber()?nD.create(!0):e.isArray()?e.mapValue(e=>e.isNumber()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISNUMBER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return t2.create(X.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?t2.create(X.VALUE):nD.create(r%2!=0)}},lt.ISODD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nD.create(!0):nD.create(!1)}},lt.ISREF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isString()?nD.create(!0):e.isArray()?e.mapValue(e=>e.isString()?nD.create(!0):nD.create(!1)):nD.create(!1)}},lt.ISTEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nD.create(!1);let r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return nD.create(!1);let n=(0,k.Tools).topLevelDomainCombiningString(),i=RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return nD.create(i.test(r))}},lt.ISURL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return nV.create(0);let r=+t.getValue();return nV.create(r)}},lt.N],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){return t2.create(X.NA)}},lt.NA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",1),G(this,"needsReferenceObject",!0),G(this,"needsSheetsInfo",!0)}calculate(e){var t;if(null!=e&&e.isError())return e;let{sheetOrder:r,sheetNameMap:n}=this.getSheetsInfo();if(!e){let e=r.findIndex(e=>e===this.subUnitId);return nV.create(e+1)}if(e.isReferenceObject()){let t=e.getForcedSheetId(),n=e.getDefaultSheetId(),i=r.findIndex(e=>t?e===t:e===n);return nV.create(i+1)}if(e.isArray())return t2.create(X.NA);let i=`${e.getValue()}`.toLocaleLowerCase(),s=null==(t=Object.entries(n).find(([e,t])=>t.toLocaleLowerCase()===i))?void 0:t[0];if(!s)return t2.create(X.NA);let a=r.findIndex(e=>e===s);return nV.create(a+1)}},lt.SHEET],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0),G(this,"needsSheetsInfo",!0)}calculate(){let{sheetOrder:e}=this.getSheetsInfo();return nV.create(e.length)}},lt.SHEETS],[class extends sq{constructor(){super(...arguments),G(this,"needsReferenceObject",!0),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){let t=e.getRowCount(),r=e.getColumnCount();if(1!==t||1!==r)return nV.create(64);{let t=e.getFirstCell();if(t.isError())return nV.create(16);if(t.isBoolean())return nV.create(4);if(t.isString())return nV.create(2);if(t.isNumber()||t.isNull())return nV.create(1)}}else{if(e.isArray())return nV.create(64);if(e.isError())return nV.create(16);if(e.isBoolean())return nV.create(4);if(e.isString())return nV.create(2);if(e.isNumber()||e.isNull())return nV.create(1)}return nV.create(128)}},lt.TYPE]];var ln=((D=ln||{}).AND="AND",D.BYCOL="BYCOL",D.BYROW="BYROW",D.FALSE="FALSE",D.IF="IF",D.IFERROR="IFERROR",D.IFNA="IFNA",D.IFS="IFS",D.LAMBDA="LAMBDA",D.LET="LET",D.MAKEARRAY="MAKEARRAY",D.MAP="MAP",D.NOT="NOT",D.OR="OR",D.REDUCE="REDUCE",D.SCAN="SCAN",D.SWITCH="SWITCH",D.TRUE="TRUE",D.XOR="XOR",D);let li=class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255),G(this,"needsReferenceObject",!0)}calculate(...e){let t=[],r=null,n=0,i=0;for(let s=0;s<e.length;s++){let a=e[s],o=a;if(o.isReferenceObject()&&(o=a.toArrayValueObject()),o.isError())return o;if(s===e.length-1){if(!(a.isValueObject()&&a.isLambda()))return t2.create(X.VALUE);r=a}else t.push(a),n=Math.max(n,o.isArray()?o.getRowCount():1),i=Math.max(i,o.isArray()?o.getColumnCount():1)}let s=this._getResultArray(t,r,n,i);return s instanceof t2?s:1===n&&1===i?s[0][0]:nB.create({calculateValueList:s,rowCount:n,columnCount:i,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){let i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=[],a=!1;for(let t=0;t<e.length;t++){let o=e[t],l=null;if(o.isReferenceObject()&&(l=o,o=o.toArrayValueObject()),!o.isArray()){if(0===s&&0===i){n.push(l||o);continue}r.push(t2.create(X.NA)),a=!0;break}let u=o.get(s,i);if(!u){r.push(t2.create(X.NA)),a=!0;break}if(l){let{startRow:e,startColumn:t}=l.getRangePosition(),r={startRow:e+s,startColumn:t+i,endRow:e+s,endColumn:t+i};u=this.createReferenceObject(l,r)}n.push(u)}if(a||0===n.length)continue;let o=t.execute(...n);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return t2.create(X.CALC);o=o.get(0,0)}o.isNull()&&(o=nV.create(0)),r.push(o)}i.push(r)}return i}},ls=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t&&!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t&&!!i.getValue(),r=!1)}return r?t2.create(X.VALUE):nD.create(t)}},ln.AND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2),G(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return t2.create(X.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=nQ(i,s,r);let a=[[]];for(let e=0;e<s;e++){let s=[];for(let t=0;t<i;t++){let n=r.get(t,e);s.push([n])}let o=nB.create({calculateValueList:s,rowCount:i,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),s={startRow:t,startColumn:r+e,endRow:t+i-1,endColumn:r+e};o=this.createReferenceObject(n,s)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return t2.create(X.CALC);l=l.get(0,0)}l.isNull()&&(l=nV.create(0)),a[0].push(l)}return 1===s?a[0][0]:nB.create({calculateValueList:a,rowCount:1,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYCOL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2),G(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return t2.create(X.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=nQ(i,s,r);let a=[];for(let e=0;e<i;e++){let i=[[]];for(let t=0;t<s;t++){let n=r.get(e,t);i[0].push(n)}let o=nB.create({calculateValueList:i,rowCount:1,columnCount:s,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),i={startRow:t+e,startColumn:r,endRow:t+e,endColumn:r+s-1};o=this.createReferenceObject(n,i)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return t2.create(X.CALC);l=l.get(0,0)}l.isNull()&&(l=nV.create(0)),a.push([l])}return 1===i?a[0][0]:nB.create({calculateValueList:a,rowCount:i,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYROW],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){return nD.create(!1)}},ln.FALSE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r=nD.create(!1)){let n=this._getSingleValueObject(e);if(n.isError())return n;if(!n.isArray())return n.getValue()?t:r;let i=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=nQ(i,s,n),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA));return a.map((e,t,r)=>{if(e.isNull())return t2.create(X.NA);{let n=o.get(t,r)||nx.create(),i=l.get(t,r)||nx.create();return this._calculateSingleCell(e,n,i)}})}_getSingleValueObject(e){return e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?t2.create(X.NA):e.getValue()?t.isNull()?t2.create(X.NA):t:r.isNull()?t2.create(X.NA):r}},ln.IF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;if(!e.isArray())return e.isError()?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&i.set(t,r,s.get(t,r))}),i}},ln.IFERROR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==X.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===X.NA?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&e.getErrorType()===X.NA&&i.set(t,r,s.get(t,r))}),i}},ln.IFNA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255)}calculate(...e){if(e.length%2!=0)return t2.create(X.NA);for(let t=0;t<e.length;t++)if(e[t].isError())return e[t];let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),n=e.map(e=>nQ(t,r,e,t2.create(X.NA))),i=n[0].map((e,t,r)=>{for(let e=0;e<n.length;e+=2){let i=n[e].get(t,r)||nx.create(),s=n[e+1].get(t,r)||nx.create();if(i.isNull())continue;if(i.isError())return i;let a=i.getValue();if(i.isString()){if("TRUE"===`${a}`.toLocaleUpperCase())return s;if("FALSE"===`${a}`.toLocaleUpperCase())continue;return t2.create(X.VALUE)}if(+a)return s.isNull()?t2.create(X.NA):s}return t2.create(X.NA)});return 1===t&&1===r?i.get(0,0):i}},ln.IFS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){return t2.create(X.VALUE)}},ln.LAMBDA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(...e){return t2.create(X.VALUE)}},ln.LET],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(...e){let t=this.getIndexNumValue(e[0]);if("number"!=typeof t)return t;let r=this.getIndexNumValue(e[1]);if("number"!=typeof r)return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return t2.create(X.VALUE);let n=e[2],i=[];for(let e=0;e<t;e++){null==i[e]&&(i[e]=[]);for(let t=0;t<r;t++){let r=n.execute(nV.create(e+1),nV.create(t+1));r.isArray()&&(r=r.get(0,0)),i[e][t]=r}}return new nY(i)}isAsync(){return!0}},ln.MAKEARRAY],[li,ln.MAP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=+e.getValue();return Number.isNaN(t)?t2.create(X.VALUE):nD.create(!t)}},ln.NOT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t||!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t||!!i.getValue(),r=!1)}return r?new t2(X.VALUE):new nD(t)}},ln.OR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,i,s,a;return e.isReferenceObject()?(n=e.toArrayValueObject(),i=e):(n=e,i=null),t.isReferenceObject()?(s=t.toArrayValueObject(),a=t):(s=t,a=null),n.isArray()?n.mapValue(e=>this._handleSingleValueObject(e,s,r,i,a)):this._handleSingleValueObject(n,s,r,i,a)}_handleSingleValueObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return t2.create(X.VALUE);let s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,o=e;n&&(o=n);for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=t.isArray()?t.get(e,n):t;if(s.isError())return s;if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),a={startRow:t+e,startColumn:r+n,endRow:t+e,endColumn:r+n};s=this.createReferenceObject(i,a)}let a=r.execute(o,s);if(a.isError())return a;a.isNull()&&(a=nV.create(0)),o=a}return o.isReferenceObject()?o.toArrayValueObject():o}},ln.REDUCE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,i=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),i=e);let s=t,a=null;if(t.isReferenceObject()&&(s=t.toArrayValueObject(),a=t),n.isError())return n;if(s.isError())return s;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return t2.create(X.VALUE);if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.CALC);n=n.get(0,0)}return this._getResult(n,s,r,i,a)}_getResult(e,t,r,n,i){let s=[],a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,l=e;n&&(l=n);for(let e=0;e<a;e++){let n=[];for(let s=0;s<o;s++){if(l.isError()){n.push(l);continue}let a=t.isArray()?t.get(e,s):t;if(a.isError()){l=a,n.push(a);continue}if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),n={startRow:t+e,startColumn:r+s,endRow:t+e,endColumn:r+s};a=this.createReferenceObject(i,n)}let o=r.execute(l,a);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return t2.create(X.CALC);o=o.get(0,0)}o.isNull()&&(o=nV.create(0)),l=o,n.push(o)}s.push(n)}return 1===a&&1===o?s[0][0]:nB.create({calculateValueList:s,rowCount:a,columnCount:o,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.SCAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;let r=t.length%2!=0,n=r?t[t.length-1]:nx.create();return e.isArray()||t.some(e=>e.isArray())?this._handleArrayInputs(e,t,n,r):this._handleNonArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let r=0;r<t.length-(n?1:0);r+=2){let n=t[r],i=t[r+1];if(!n.isNull()){if(n.isError())return n;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return i.isNull()?t2.create(X.NA):i}}return r.isNull()?t2.create(X.NA):r}_handleArrayInputs(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,...t.map(e=>e.isArray()?e.getRowCount():1),r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,...t.map(e=>e.isArray()?e.getColumnCount():1),r.isArray()?r.getColumnCount():1),a=nQ(i,s,e),o=t.map(e=>nQ(i,s,e,t2.create(X.NA))),l=nQ(i,s,r,t2.create(X.NA));return a.map((e,t,r)=>{for(let i=0;i<o.length-(n?1:0);i+=2){let n=o[i].get(t,r)||nx.create(),s=o[i+1].get(t,r)||nx.create();if(!n.isNull()){if(n.isError()||e.isError())return n.isError()?n:e;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return s.isNull()?t2.create(X.NA):s}}let i=l.get(t,r)||nx.create();return i.isNull()?t2.create(X.NA):i})}},ln.SWITCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){return nD.create(!0)}},ln.TRUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(e.getValue()&&t++,r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(i.getValue()&&t++,r=!1)}return r?t2.create(X.VALUE):nD.create(t%2==1)}},ln.XOR]];var la=((V=la||{}).ADDRESS="ADDRESS",V.AREAS="AREAS",V.CHOOSE="CHOOSE",V.CHOOSECOLS="CHOOSECOLS",V.CHOOSEROWS="CHOOSEROWS",V.COLUMN="COLUMN",V.COLUMNS="COLUMNS",V.DROP="DROP",V.EXPAND="EXPAND",V.FILTER="FILTER",V.FORMULATEXT="FORMULATEXT",V.GETPIVOTDATA="GETPIVOTDATA",V.HLOOKUP="HLOOKUP",V.HSTACK="HSTACK",V.HYPERLINK="HYPERLINK",V.IMAGE="IMAGE",V.INDEX="INDEX",V.INDIRECT="INDIRECT",V.LOOKUP="LOOKUP",V.MATCH="MATCH",V.OFFSET="OFFSET",V.ROW="ROW",V.ROWS="ROWS",V.RTD="RTD",V.SORT="SORT",V.SORTBY="SORTBY",V.TAKE="TAKE",V.TOCOL="TOCOL",V.TOROW="TOROW",V.TRANSPOSE="TRANSPOSE",V.UNIQUE="UNIQUE",V.VLOOKUP="VLOOKUP",V.VSTACK="VSTACK",V.WRAPCOLS="WRAPCOLS",V.WRAPROWS="WRAPROWS",V.XLOOKUP="XLOOKUP",V.XMATCH="XMATCH",V);let lo=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",5)}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=r?r:nV.create(1),a=null!=n?n:nD.create(!0),o=null!=i?i:nP.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,e,t2.create(X.NA)),h=nQ(l,u,t,t2.create(X.NA)),d=nQ(l,u,s,t2.create(X.NA)),m=nQ(l,u,a,t2.create(X.NA)),g=nQ(l,u,o,t2.create(X.NA));return c.map((e,t,r)=>{let n=h.get(t,r)||t2.create(X.NA),i=d.get(t,r)||t2.create(X.NA),s=m.get(t,r)||t2.create(X.NA),a=g.get(t,r)||t2.create(X.NA);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._calculateSingleCell(e,n,i,s,a)})}_calculateSingleCell(e,t,r,n,i){let s=Number.parseInt(`${Number(e.getValue())-1}`),a=Number.parseInt(`${Number(t.getValue())-1}`),o=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(s)||Number.isNaN(a)||Number.isNaN(o)||o<1||o>4)return t2.create(X.VALUE);let l=function(e){switch(e){case 1:default:return k.AbsoluteRefType.ALL;case 2:return k.AbsoluteRefType.ROW;case 3:return k.AbsoluteRefType.COLUMN;case 4:return k.AbsoluteRefType.NONE}}(o),u=this.getZeroOrOneByOneDefault(n),c=`${i.getValue()}`,h=eZ(c)?`'${c}'`:c,d={startRow:s,startColumn:a,endRow:s,endColumn:a,startAbsoluteRefType:l,endAbsoluteRefType:l},m=n&&!u?function(e){let t=s$(e.startRow,e.startAbsoluteRefType,!0),r=s$(e.startColumn,e.startAbsoluteRefType,!1),n=s$(e.endRow,e.endAbsoluteRefType,!0),i=s$(e.endColumn,e.endAbsoluteRefType,!1);return t===n&&r===i?`R${t}C${r}`:`R${t}C${r}:R${n}C${i}`}(d):ek(d);return nP.create(""!==h?`${h}!${m}`:m)}},la.ADDRESS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nV.create(1):t2.create(X.VALUE)}},la.AREAS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255),G(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){let e=r.convertToNumberObjectValue();return e.isError()?e:t[Math.trunc(+e.getValue())-1]||t2.create(X.VALUE)}let n=r.isArray()?r.getRowCount():1,i=r.isArray()?r.getColumnCount():1;t.forEach((e,t)=>{e.isArray()?(n=Math.max(n,e.getRowCount()),i=Math.max(i,e.getColumnCount())):(n=Math.max(n,1),i=Math.max(i,1))});let s=nQ(n,i,r,t2.create(X.NA)),a=t.map(e=>{let t=e;return t.isReferenceObject()&&(t=t.toArrayValueObject()),nQ(n,i,t,t2.create(X.NA))});return s.map((e,t,r)=>{if(e.isError())return e;let n=e.convertToNumberObjectValue();if(n.isError())return n;let i=a[Math.trunc(+n.getValue())-1],s=(null==i?void 0:i.get(t,r))||t2.create(X.VALUE);return null!=s&&s.isNull()&&(s=nV.create(0)),s})}},la.CHOOSE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=Math.trunc(+a.getValue());if(0===o||Math.abs(o)>n)return t2.create(X.VALUE);let l=e;n>1&&(l=o<0?e.slice(void 0,[o+n,o+1+n]):e.slice(void 0,[o-1,o]));for(let t=0;t<r;t++)i[t]||(i[t]=[]),e.isArray()?i[t].push(l.get(t,0)):i[t].push(e)}return nB.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSECOLS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=[];for(let i=0;i<t.length;i++){let s=t[i];if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);s=s.get(0,0)}if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.trunc(+s.getValue());if(0===a||Math.abs(a)>r)return t2.create(X.VALUE);let o=e;r>1&&(o=a<0?e.slice([a+r,a+1+r]):e.slice([a-1,a])),e.isArray()?n.push(o.getArrayValue()[0]):n.push([e])}return nB.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSEROWS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",1)}calculate(e){if(null==e)return nV.create(this.column+1);if(e.isError())return e;if(!e.isArray())return t2.create(X.NA);let t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let e=0;e<r;e++)n.push(nV.create(t+e+1));let i={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(i)}},la.COLUMN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nV.create(1);if(!e.isArray())return t2.create(X.NA);let t=e.getColumnCount();return nV.create(t)}},la.COLUMNS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(0),i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nQ(a,o,t,t2.create(X.NA)),u=nQ(a,o,n,t2.create(X.NA));if(a>1||o>1)return l.mapValue((t,r,n)=>{let a=u.get(r,n);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,i,s);return o?l:e.isArray()?t2.create(X.VALUE):e});if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let c=t.isArray()?t.get(0,0):t,h=n.isArray()?n.get(0,0):n,{isError:d,errorObject:m,rowsValue:g,columnsValue:f}=this._checkRowsColumns(c,h,i,s);return d?m:this._getResultArray(e,g,f,i,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:t2.create(X.VALUE)}:Math.abs(i)>=r||Math.abs(s)>=n?{isError:!0,errorObject:t2.create(X.CALC)}:{isError:!1,rowsValue:i,columnsValue:s}}_getResultArray(e,t,r,n,i){let s;let a=t>=0?[t,n]:[0,n+t],o=r>=0?[r,i]:[0,i+r];return s=(s=0===t&&0===r?e:0===t?e.slice(void 0,o):0===r?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nV.create(0):e),n-t==1&&i-r==1?s.get(0,0):s}},la.DROP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",4)}calculate(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t,o=null!=r?r:nV.create(s),l=null!=n?n:t2.create(X.NA);t.isNull()&&(a=nV.create(i)),o.isNull()&&(o=nV.create(s));let u=Math.max(a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),c=Math.max(a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),h=nQ(u,c,a,t2.create(X.NA)),d=nQ(u,c,o,t2.create(X.NA));if(u>1||c>1)return h.mapValue((t,r,n)=>{let a=d.get(r,n);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let{isError:o,errorObject:u}=this._checkRowsColumnsPadWith(t,a,l,i,s);return o?u:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let m=a.isArray()?a.get(0,0):a,g=o.isArray()?o.get(0,0):o,{isError:f,errorObject:p,rowsValue:C,columnsValue:_,padWithObject:y}=this._checkRowsColumnsPadWith(m,g,l,i,s);return f?p:this._getResultArray(e,C,_,y,i,s)}_checkRowsColumnsPadWith(e,t,r,n,i){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());if(Number.isNaN(s)||Number.isNaN(a)||Math.abs(s)<n||Math.abs(a)<i)return{isError:!0,errorObject:t2.create(X.VALUE)};let o=r;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:t2.create(X.VALUE)};o=r.get(0,0)}return{isError:!1,rowsValue:s,columnsValue:a,padWithObject:o}}_getResultArray(e,t,r,n,i,s){let a=[];a=e.isArray()?e.map(e=>e.isNull()?nV.create(0):e).getArrayValue():[[e]];let o=Math.max(0,t-i),l=Math.max(0,r-s);for(let e=0;e<o;e++)a.push(Array(s).fill(n));for(let e=0;e<l;e++)a.forEach(e=>{e.push(n)});return 1===t&&1===r?a[0][0]:nB.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.EXPAND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:t2.create(X.CALC);if(e.isError())return e;if(t.isError())return t;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1;return a>1&&o>1||1===a&&o!==s||1===o&&a!==i?t2.create(X.VALUE):1===i&&1===s?this._getResultArrayByR1C1(e,t,n):1===a?o!==s?t2.create(X.VALUE):this._getResultArrayByR1(i,s,e,t,n):1===o?a!==i?t2.create(X.VALUE):this._getResultArrayByC1(i,s,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,i=t;return n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),i.isString()&&(i=i.convertToNumberObjectValue()),i.isError()?i:+i.getValue()?n:r}_getResultArrayByR1(e,t,r,n,i){let s=[];for(let i=0;i<t;i++){let t=n.get(0,i);if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;if(+t.getValue())for(let t=0;t<e;t++){s[t]||(s[t]=[]);let e=r.get(t,i);s[t].push(e)}}return 0===s.length?i:nB.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,i){let s=[];for(let i=0;i<e;i++){let e=n.get(i,0);if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return e;if(!+e.getValue())continue;let a=[];for(let e=0;e<t;e++){let t=r.get(i,e);a.push(t)}s.push(a)}return 0===s.length?i:nB.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.FILTER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1),G(this,"needsReferenceObject",!0),G(this,"needsFormulaDataModel",!0)}calculate(e){var t,r;if(!e.isReferenceObject())return t2.create(X.NA);let n=e.getUnitId(),i=e.getSheetId(),s=null==(r=null==(t=e.getUnitData()[n])?void 0:t[i])?void 0:r.cellData,{startRow:a,startColumn:o}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((e,t,r)=>{let l=s.getValue(a+t,o+r);if(null!=l&&l.f||null!=l&&l.si){let e=this._formulaDataModel.getFormulaStringByCell(a+t,o+r,i,n);return nP.create(e)}return t2.create(X.NA)});return 1===l.getRowCount()&&1===l.getColumnCount()?l.get(0,0):l}},la.FORMULATEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t2.create(X.REF);if(!t.isArray()||r.isError()||null!=n&&n.isError())return t2.create(X.NA);let i=this.getZeroOrOneByOneDefault(n);if(null==i)return t2.create(X.VALUE);let s=this.getIndexNumValue(r);if(s instanceof t2)return s;let a=t.slice([0,1]),o=t.slice([s-1,s]);return null==a||null==o?t2.create(X.REF):e.isArray()?e.map(e=>this._handleSingleObject(e,a,o,i)):this._handleSingleObject(e,a,o,i)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.HLOOKUP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<t;e++){r[e]||(r[e]=[]);for(let t=0;t<a;t++){let n=i;i.isArray()&&(n=i.get(e,t)),e>s-1||!n?r[e].push(t2.create(X.NA)):r[e].push(n)}}}return nB.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.HSTACK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4),G(this,"needsReferenceObject",!0)}calculate(e,t,r,n){let i,s;if(e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;let a=0,o=0;if(e.isValueObject())a=1,o=1;else{if(!e.isReferenceObject())return t2.create(X.VALUE);let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e.getRangePosition();a=r-t+1,o=i-n+1}1===a&&o>1&&null==r?(s=null!=t?t:nV.create(0),i=nV.create(0)):(i=null!=t?t:nV.create(0),s=null!=r?r:nV.create(0));let l=null!=n?n:nV.create(1);i.isReferenceObject()&&(i=i.toArrayValueObject()),s.isReferenceObject()&&(s=s.toArrayValueObject()),l.isReferenceObject()&&(l=l.toArrayValueObject());let u=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1);if(1===u&&1===c)return this._calculateSingleCell(e,i,s,l);{let t=nQ(u,c,i,t2.create(X.NA)),r=nQ(u,c,s,t2.create(X.NA)),n=nQ(u,c,l,t2.create(X.NA));return t.map((t,i,s)=>{let a=r.get(i,s)||nx.create(),o=n.get(i,s)||nx.create(),l=this._calculateSingleCell(e,t,a,o);return l.isReferenceObject()?l.toArrayValueObject().getFirstCell():l})}}_calculateSingleCell(e,t,r,n){if(t.isError())return t;let i=this._getNumberValue(t);if(void 0===i||i<0)return t2.create(X.VALUE);if(r.isError())return r;let s=this._getNumberValue(r);if(void 0===s||s<0)return t2.create(X.VALUE);if(n.isError())return n;let a=this._getAreaNumberValue(n);return void 0===a||a<1?t2.create(X.VALUE):e.isReferenceObject()?this._getReferenceObject(e,i,s,a):e.isValueObject()&&1===i&&1===s?e:t2.create(X.REF)}_getNumberValue(e){if(null==e)return 0;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getAreaNumberValue(e){if(null==e)return 1;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getReferenceObject(e,t,r,n){let{startRow:i,endRow:s,startColumn:a,endColumn:o}=e.getRangePosition(),l=0,u=0,c=0,h=0;if(0===t?(l=i,u=s):l=u=i+t-1,0===r?(c=a,h=o):c=h=a+r-1,l>s||c>o)return t2.create(X.REF);let d={startRow:l,startColumn:c,endRow:u,endColumn:h};return this.createReferenceObject(e,d)}},la.INDEX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);null==r&&(r=1);let n=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return e.map(()=>t2.create(X.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){let r=`${e.getValue()}`;if(""===r.trim())return t2.create(X.REF);let n=this._convertToDefinedName(r);if(0===t){let{range:e,sheetName:t,unitId:r}=function(e,t=0,r=0){let{refBody:n,sheetName:i,unitId:s}=eG(e),a=n.indexOf(":");if(-1===a){let e=sB(n,t,r),a=e.row,o=e.column,l=e.absoluteRefType;return{unitId:s,sheetName:i,range:{startRow:a,startColumn:o,endRow:a,endColumn:o,startAbsoluteRefType:l,endAbsoluteRefType:l}}}let o=n.substring(0,a),l=n.substring(a+1),u=sB(o,t,r),c=sB(l,t,r),h=u.row;return{unitId:s,sheetName:i,range:{startRow:h,startColumn:u.column,endRow:c.row,endColumn:c.column,startAbsoluteRefType:u.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}(n),i=new nz(e);return i.setForcedUnitIdDirect(r),i.setForcedSheetName(t),this._setDefault(i)}if(eT(n))return this._setDefault(new nq(n));if(eO(n))return this._setDefault(new nK(n));if(eM(n))return this._setDefault(new nX(n));let{range:i,sheetName:s,unitId:a}=tg(n);if(Number.isNaN(i.startRow)||i.endRow+1>1048576||Number.isNaN(i.startColumn)||i.endColumn+1>16384)return t2.create(X.REF);let o=new nz(i);return o.setForcedUnitIdDirect(a),o.setForcedSheetName(s),this._setDefault(o)}_setDefault(e){return null==this.unitId||null==this.subUnitId?t2.create(X.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){let t=this.getDefinedName(e);if(null==t)return e;let r=t.formulaOrRefString;return null==r?e:r.startsWith(J.EQUALS)?r.slice(1):r}},la.INDIRECT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?t2.create(X.REF):t.isArray()?null!=r&&r.isError()?r:1===t.getColumnCount()||1===t.getRowCount()?null==r||r.isArray()?this._handleVector(e,t,r):t2.create(X.REF):this._handleArray(e,t):t2.create(X.VALUE)}_handleVector(e,t,r){let n=r;if(null==n)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return t2.create(X.REF);return e.isArray()?e.map(e=>this.binarySearch(e,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){let r,n;let i=t.getRowCount(),s=t.getColumnCount();return s>i?(r=t.slice([0,1]),n=t.slice([i-1,i])):(r=t.slice(void 0,[0,1]),n=t.slice(void 0,[s-1,s])),null==r||null==n?t2.create(X.VALUE):e.isArray()?e.map(e=>this.binarySearch(e,r,n)):this.binarySearch(e,r,n)}},la.LOOKUP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t2.create(X.REF);if(!t.isArray())return t2.create(X.VALUE);let n=t.getRowCount(),i=t.getColumnCount();if(1!==n&&1!==i||null!=r&&r.isError())return t2.create(X.NA);let s=this.getMatchTypeValue(r);return null==s?t2.create(X.VALUE):e.isArray()?e.map(e=>this._handleSingleObject(e,t,s)):this._handleSingleObject(e,t,s)}_handleSingleObject(e,t,r){let n=this._getSearchModeValue(r),i=t.orderSearch(e,n);if(null==i)return t2.create(X.NA);if(i instanceof t2)return i;let s=1===t.getRowCount()?i.column+1:i.row+1;return nV.create(s)}_getSearchModeValue(e){switch(e){case 1:return t3.MIN;case 0:return t3.NORMAL;case -1:return t3.MAX}}},la.MATCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",5),G(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;if(!e.isReferenceObject())return t2.create(X.VALUE);let s=e.getRowCount(),a=e.getColumnCount(),o=t;o.isReferenceObject()&&(o=o.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let u=null!=n?n:nV.create(s);u.isReferenceObject()&&(u=u.toArrayValueObject()),u.isNull()&&(u=nV.create(s));let c=null!=i?i:nV.create(a);c.isReferenceObject()&&(c=c.toArrayValueObject()),c.isNull()&&(c=nV.create(a));let h=Math.max(o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(1===h&&1===d)return o=o.isArray()?o.get(0,0):o,l=l.isArray()?l.get(0,0):l,u=u.isArray()?u.get(0,0):u,c=c.isArray()?c.get(0,0):c,this._handleSingleObject(e,o,l,u,c);let m=nQ(h,d,o,t2.create(X.NA)),g=nQ(h,d,l,t2.create(X.NA)),f=nQ(h,d,u,t2.create(X.NA)),p=nQ(h,d,c,t2.create(X.NA));return m.mapValue((t,r,n)=>{let i=g.get(r,n),s=f.get(r,n),a=p.get(r,n);return t.isError()?t:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSingleObject(e,t,i,s,a,!0)})}_handleSingleObject(e,t,r,n,i,s=!1){let{startRow:a,startColumn:o}=e.getRangePosition(),l=t;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;let u=r;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+l.getValue(),h=+u.getValue();if("number"!=typeof c||"number"!=typeof h)return t2.create(X.VALUE);let d=a+c,m=o+h;if(d<0||m<0)return t2.create(X.REF);let g=this.getIndexNumValue(n),f=this.getIndexNumValue(i);if("number"!=typeof g||"number"!=typeof f)return t2.create(X.VALUE);if(0===g||0===f)return t2.create(X.REF);let p=g>0?d+g-1:d+g+1,C=f>0?m+f-1:m+f+1;return p<0||C<0?t2.create(X.REF):s?t2.create(X.VALUE):this.createReferenceObject(e,{startRow:d<p?d:p,startColumn:m<C?m:C,endRow:d>p?d:p,endColumn:m>C?m:C})}},la.OFFSET],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",1)}calculate(e){if(null==e)return nV.create(this.row+1);if(e.isError())return e;if(!e.isArray())return t2.create(X.NA);let t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let e=0;e<r;e++)n.push([nV.create(t+e+1)]);let i={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(i)}},la.ROW],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nV.create(1);if(!e.isArray())return t2.create(X.NA);let t=e.getRowCount();return nV.create(t)}},la.ROWS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=t?t:nV.create(1),s=null!=r?r:nV.create(1),a=null!=n?n:nD.create(!1);if(a.isArray()){let t=a.getRowCount(),r=a.getColumnCount();if(1===t&&1===r){let t=a.get(0,0);return this._handleSingleObject(e,i,s,t)}return a.map(t=>{let r=this._handleSingleObject(e,i,s,t);return r.isArray()?r.get(0,0):r})}return this._handleSingleObject(e,i,s,a)}_handleSingleObject(e,t,r,n){if(e.isError())return e;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=this._checkArrayError(t);if(a.isError())return a;let o=Math.floor(+a.getValue());if(o<1)return t2.create(X.VALUE);let l=this._checkArrayError(r);if(l.isError())return l;let u=Math.floor(+l.getValue());if(-1!==u&&1!==u)return t2.create(X.VALUE);let c=n;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!e.isArray()||1===i&&1===s)return e;let h=+c.getValue();return this._getResult(e,o,u,h,i,s)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,i,s){if(n){if(t>i)return t2.create(X.VALUE);let n=e.transpose().getArrayValue();return n.sort(this._sort(t-1,r)),nB.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}{if(t>s)return t2.create(X.VALUE);let n=e.getArrayValue();return n.sort(this._sort(t-1,r)),nB.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){let r=t4();return 1===t?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return 1;if(s.isError())return -1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?1:s.isBoolean()&&!0===o?-1:i.isBoolean()&&!1===a?1:s.isBoolean()&&!1===o?-1:i.isNumber()&&s.isNumber()?+a-+o:t(a,o)}}_sortDesc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return -1;if(s.isError())return 1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?-1:s.isBoolean()&&!0===o?1:i.isBoolean()&&!1===a?-1:s.isBoolean()&&!1===o?1:i.isNumber()&&s.isNumber()?+o-+a:t(o,a)}}},la.SORT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255)}calculate(e,...t){1===t.length&&t.push(nV.create(1));let r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:i}=n5(t);if(r.isError()){let e=nQ(n,i,r);return 1===n&&1===i?e.get(0,0):e}let s=t.map((e,t)=>t%2==0?e:nQ(n,i,e,t2.create(X.NA))),a=this._getResultArray(e,s,n,i);return 1===n&&1===i?a[0][0]:nB.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let e=0;e<t.length;e++){let r=t[e];if(r.isError())return r}if(t.length<2||t.length%2!=0)return t2.create(X.VALUE);let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t[0].isArray()?t[0].getRowCount():1,s=t[0].isArray()?t[0].getColumnCount():1;if((i>1||s>1)&&(i>1&&s>1||1===i&&s!==n||1===s&&i!==r))return t2.create(X.VALUE);for(let e=2;e<t.length;e++){if(e%2==1)continue;let r=t[e].isArray()?t[e].getRowCount():1,n=t[e].isArray()?t[e].getColumnCount():1;if(r!==i||n!==s)return t2.create(X.VALUE)}return nD.create(!0)}_getResultArray(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t[0].isArray()?t[0].getRowCount():1,o=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let u=0;u<r;u++){l[u]=[];for(let c=0;c<n;c++){let{isError:h,errorObject:d,byArrays:m,sortOrders:g}=this._getByArraysAndSortOrders(t,u,c,o);if(h){l[u].push(d);continue}if(!e.isArray()||1===i&&1===s){l[u].push(e);continue}let f=e.getArrayValue();1===a&&1===o||(1===a?(f=f.concat(m),(f=this._transposeArray(f)).sort(this._sort(i,g)),f=this._transposeArray(f).slice(0,i)):1===o&&(f=(f=this._transposeArray(f)).concat(m),(f=this._transposeArray(f)).sort(this._sort(s,g)),f=f.map(e=>e.slice(0,s))));let p=nB.create({calculateValueList:f,rowCount:f.length,columnCount:f[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[u].push(p.get(0,0));continue}l[u].push(p)}}return l}_getByArraysAndSortOrders(e,t,r,n){let i=[],s=[],a=!1,o=null;for(let l=0;l<e.length;l++){if(l%2==1)continue;let u=e[l],c=e[l+1].get(t,r);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()){a=!0,o=c;break}let h=Math.floor(+c.getValue());if(-1!==h&&1!==h){a=!0,o=t2.create(X.VALUE);break}if(s.push(h),u.isArray()){let e=u.getArrayValue();1===n&&(e=this._transposeArray(e)),i.push(e[0])}else i.push([u])}return{isError:a,errorObject:o,byArrays:i,sortOrders:s}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_sort(e,t){let r=t4();return(n,i)=>{let s=n[e],a=i[e],o=this._compare(s,a,t[0],r);if(0===o&&t.length>1)for(let l=1;l<t.length&&(s=n[e+l],a=i[e+l],0===(o=this._compare(s,a,t[l],r)));l++);return o}}_compare(e,t,r,n){return 1===r?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return -1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?1:t.isBoolean()&&!0===i?-1:e.isBoolean()&&!1===n?1:t.isBoolean()&&!1===i?-1:e.isNumber()&&t.isNumber()?+n-+i:r(n,i)}_desc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return -1;if(t.isError())return 1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?-1:t.isBoolean()&&!0===i?1:e.isBoolean()&&!1===n?-1:t.isBoolean()&&!1===i?1:e.isNumber()&&t.isNumber()?+i-+n:r(i,n)}},la.SORTBY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t,a=null!=r?r:nV.create(i);t.isNull()&&(s=nV.create(n)),a.isNull()&&(a=nV.create(i));let o=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nQ(o,l,s,t2.create(X.NA)),c=nQ(o,l,a,t2.create(X.NA));if(o>1||l>1)return u.mapValue((t,r,s)=>{let a=c.get(r,s);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,n,i);return o?l:e.isArray()?t2.create(X.VALUE):e});if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let h=s.isArray()?s.get(0,0):s,d=a.isArray()?a.get(0,0):a,{isError:m,errorObject:g,rowsValue:f,columnsValue:p}=this._checkRowsColumns(h,d,n,i);return m?g:this._getResultArray(e,f,p,n,i)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:t2.create(X.VALUE)}:0===Math.abs(i)||0===Math.abs(s)?{isError:!0,errorObject:t2.create(X.CALC)}:(i>r&&(i=r),s>n&&(s=n),{isError:!1,rowsValue:i,columnsValue:s})}_getResultArray(e,t,r,n,i){let s;if(!e.isArray())return e;let a=t>=0?[0,t]:[n+t,n],o=r>=0?[0,r]:[i+r,i];return s=(s=t===n&&r===i?e:t===n?e.slice(void 0,o):r===i?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nV.create(0):e),1===t&&1===r?s.get(0,0):s}},la.TAKE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nV.create(0),i=null!=r?r:nD.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,n,t2.create(X.NA)),l=nQ(s,a,i,t2.create(X.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u))return t2.create(X.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?t2.create(X.CALC):s>1||a>1||1===c.length?c[0]:nB.create({calculateValueList:c.map(e=>[e]),rowCount:c.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nV.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nV.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOCOL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nV.create(0),i=null!=r?r:nD.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,n,t2.create(X.NA)),l=nQ(s,a,i,t2.create(X.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u)||e.isNull())return t2.create(X.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?t2.create(X.CALC):s>1||a>1||1===c.length?c[0]:nB.create({calculateValueList:[c],rowCount:1,columnCount:c.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nV.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nV.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOROW],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return 1===t&&1===r?e.get(0,0):e.transpose()}return e}},la.TRANSPOSE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nD.create(!1),i=null!=r?r:nD.create(!1),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),u=nQ(o,l,n,t2.create(X.NA)),c=nQ(o,l,i,t2.create(X.NA)),h=u.map((t,r,n)=>{let i,u=t,h=c.get(r,n);if(e.isError())return e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let d=+u.getValue(),m=+h.getValue();return i=!d&&1===s||d&&1===a?e:this._getResult(e,d,m),(o>1||l>1)&&null!=i&&i.isArray()?i.get(0,0):i});return 1===o&&1===l?h.get(0,0):h}_getResult(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=e.getArrayValue(),a=n,o=i;t&&(s=this._transposeArray(s),a=i,o=n);let l=this._getRepeatRows(s,a,o);if(l.length>0){let e=[];l.forEach(t=>{t.forEach((t,n)=>{(0!==n||r)&&e.push(t)})}),s=s.filter((t,r)=>!e.includes(r))}return 0===s.length?t2.create(X.CALC):(t&&(s=this._transposeArray(s)),nB.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let i=0;i<r;i++)if(0===i){let r=Array(t).fill(null).map((t,r)=>({r:r,valueObject:e[r][i]}));n=this._getRepeatRowsByObjects(r)}else{if(0===n.length)break;let t=[];n.forEach(r=>{let n=r.map(t=>({r:t,valueObject:e[t][i]})),s=this._getRepeatRowsByObjects(n);t=t.concat(s)}),n=t}return n}_getRepeatRowsByObjects(e){let t=/* @__PURE__ */new Map;return e.forEach(e=>{let r=e.r,n=e.valueObject,i=n.getValue();if(n.isNull()?i=null:n.isString()&&(0,k.isRealNum)(i)&&(i=+i),t.has(i)){let e=t.get(i);e.push(r),t.set(i,e)}else t.set(i,[r])}),Array.from(t.values()).filter(e=>e.length>1)}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}},la.UNIQUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return t2.create(X.VALUE);if(r.isError())return r;if(null!=n&&n.isError())return n;let i=null!=n?n:nD.create(!0);return n1(e)&&n1(i)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,i):this._handleNonArrayColIndexNum(e,t,r,i)}_handleArrayColIndexNum(e,t,r,n){let i;let s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(null==a)return t2.create(X.VALUE);let o=[];return r.iterator((e,r,n)=>{if(null==e)return i=t2.create(X.VALUE),!1;let l=this._handleTableArray(s,t,e,a);if(l.isError())return i=l,!1;void 0===o[r]&&(o[r]=[]),o[r][n]=l}),i||nZ(o,o.length,o[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e),o=nQ(i,s,n);return a.map((e,n,i)=>{if(e.isError())return e;let s=o.get(n,i);if(null==s)return t2.create(X.VALUE);if(s.isError())return s;let a=this.getZeroOrOneByOneDefault(s);return null==a?t2.create(X.VALUE):this._handleTableArray(e,t,r,a)})}_handleTableArray(e,t,r,n){let i=this.getIndexNumValue(r);if(i instanceof t2)return i;if((i=Math.floor(i))<1)return t2.create(X.VALUE);let s=t.slice(void 0,[0,1]);if(null==s)return t2.create(X.VALUE);let a=t.slice(void 0,[i-1,i]);return null==a?t2.create(X.REF):this._handleSingleObject(e,s,a,n)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.VLOOKUP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++){let n=[];for(let r=0;r<t;r++){let t=i;i.isArray()&&(t=i.get(e,r)),r>a-1||!t?n.push(t2.create(X.NA)):n.push(t)}r.push(n)}}return nB.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.VSTACK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:t2.create(X.NA);n.isNull()&&(n=t2.create(X.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nQ(a,o,t,t2.create(X.NA)),u=nQ(a,o,n,t2.create(X.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return t2.create(X.VALUE);if(c<1)return t2.create(X.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:nB.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++)for(let n=0;n<i;n++){s[n]||(s[n]=[]);let a=t*i+n;a<e.length?s[n].push(e[a].isNull()?nV.create(0):e[a]):s[n].push(r)}return s}},la.WRAPCOLS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:t2.create(X.NA);n.isNull()&&(n=t2.create(X.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nQ(a,o,t,t2.create(X.NA)),u=nQ(a,o,n,t2.create(X.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return t2.create(X.VALUE);if(c<1)return t2.create(X.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:nB.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++){let n=[];for(let s=0;s<i;s++){let a=t*i+s;a<e.length?n.push(e[a].isNull()?nV.create(0):e[a]):n.push(r)}s.push(n)}return s}},la.WRAPROWS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){if(e.isError())return e;if(t.isError()||r.isError())return t2.create(X.REF);if(!t.isArray()||!r.isArray())return t2.create(X.VALUE);let a=t.getRowCount(),o=t.getColumnCount(),l=r.getRowCount(),u=r.getColumnCount();if(1!==a&&1!==o||1===a&&o>1&&o!==u||1===o&&a>1&&a!==l)return t2.create(X.VALUE);if(null!=n&&n.isError()||null!=i&&i.isError()||null!=s&&s.isError())return t2.create(X.NA);let c=null!=n?n:t2.create(X.NA),h=this.getIndexNumValue(i||nV.create(0));if(h instanceof t2)return h;let d=this.getIndexNumValue(s||nV.create(1));return d instanceof t2?d:this._getResult(e,t,r,c,h,d,a,o,l,u)}_getResult(e,t,r,n,i,s,a,o,l,u){let c=e.isArray()?e.getRowCount():1,h=e.isArray()?e.getColumnCount():1;if(c>1||h>1){let o;return null==(o=1===a?r.slice([0,1]):r.slice(void 0,[0,1]))?t2.create(X.NA):e.map(e=>{let r=this._checkErrorCombination(i,s);if(r)return r;let a=this._handleSingleObject(e,t,o,i,s);return a.isError()?n:a})}let d=e.isArray()?e.get(0,0):e;if(o===u&&a===l){let e=this._checkErrorCombination(i,s);if(e)return e;let a=this._handleSingleObject(d,t,r,i,s);return a.isError()?n:a}let m=0;o===u&&(m=1);let g=this._handleExpandObject(d,t,r,i,s,m);return null==g?t2.create(X.NA):g}_handleExpandObject(e,t,r,n,i,s=0){if((2===i||-2===i)&&2!==n){let a=t8(i),o=t7(n);return this.binarySearchExpand(e,t,r,s,a,o)}return 2===n?this.fuzzySearchExpand(e,t,r,-1!==i,s):-1===n||1===n?this.orderSearchExpand(e,t,r,1===n?t3.MAX:t3.MIN,-1===i,s):this.equalSearchExpand(e,t,r,-1!==i,s)}_handleSingleObject(e,t,r,n,i){if((2===i||-2===i)&&2!==n){let s=t8(i),a=t7(n);return this.binarySearch(e,t,r,s,a)}return 2===n?this.fuzzySearch(e,t,r,-1!==i):-1===n||1===n?this.orderSearch(e,t,r,1===n?t3.MAX:t3.MIN,-1===i):this.equalSearch(e,t,r,-1!==i)}_checkErrorCombination(e,t){return 2===e&&(-2===t||2===t)?t2.create(X.VALUE):null}},la.XLOOKUP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t2.create(X.REF);if(!t.isArray())return t2.create(X.VALUE);let i=t.getRowCount(),s=t.getColumnCount();if(1!==i&&1!==s)return t2.create(X.VALUE);if(null!=r&&r.isError()||null!=n&&n.isError())return t2.create(X.NA);let a=this.getIndexNumValue(r||nV.create(0));if(a instanceof t2)return a;let o=this.getIndexNumValue(n||nV.create(1));return o instanceof t2?o:e.isArray()?e.map(e=>this._handleSingleObject(e,t,a,o)):this._handleSingleObject(e,t,a,o)}_handleSingleObject(e,t,r,n){let i;if((2===n||-2===n)&&2!==r){let s=t8(n),a=t7(r);i=t.binarySearch(e,s,a)}else if(2===r){let r;let s=t.compare(e,ee.EQUALS);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return t2.create(X.NA);i=1===t.getRowCount()?r.column:r.row}else if(-1===r||1===r){let s=t.orderSearch(e,1===r?t3.MAX:t3.MIN,-1===n);if(null==s)return t2.create(X.NA);if(s instanceof t2)return s;i=1===t.getRowCount()?s.column:s.row}else{let r;let s=t.isEqual(e);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return t2.create(X.NA);i=1===t.getRowCount()?r.column:r.row}return null==i?t2.create(X.NA):nV.create(i+1)}},la.XMATCH]];function ll(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return t2.create(X.VALUE);let r=Math.atan(1/(t=Number(t)));return t<0&&(r+=Math.PI),Number.isNaN(r)?t2.create(X.VALUE):nV.create(r)}function lu(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return t2.create(X.VALUE);if(1>=Math.abs(t=Number(t)))return t2.create(X.NUM);let r=.5*Math.log((t+1)/(t-1));return Number.isNaN(r)?t2.create(X.VALUE):nV.create(r)}let lc=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}},iW.ABS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}},iW.ACOS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}},iW.ACOSH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:ll(e)):ll(t)}},iW.ACOT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:lu(e)):lu(t)}},iW.ACOTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nV.create(0);if(e.isBoolean()||e.isNumber())return t2.create(X.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return t2.create(X.VALUE);let r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let e=0;e<t.length;e++){let r=an.get(t[e])||0,i=an.get(t[e+1])||0,s=an.get(t[e+2])||0,a=an.get(t[e+3])||0;if(!r||s>=i&&s>r||r===i&&r===s&&r===a||r===i/2)return t2.create(X.VALUE);r<i?n-=r:n+=r}return nV.create(r?-n:n)}},iW.ARABIC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}},iW.ASIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}},iW.ASINH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}},iW.ATAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}},iW.ATAN2],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}},iW.ATANH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return this._handleSingleObject(e,n,i)});return 1===u.getRowCount()&&1===u.getColumnCount()?u.getArrayValue()[0][0]:u}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=t;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=r;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue()),l=Math.floor(+s.getValue());if(a<0||a>=0x20000000000000||o<2||o>36||l<0)return t2.create(X.NUM);let u=a.toString(o);return u.length<l&&(u=Array(l-u.length+1).join("0")+u),nP.create(u.toLocaleUpperCase())}},iW.BASE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a>0&&o<0)return t2.create(X.NUM);if(0===a||0===o)return nV.create(0);let l=nv(a/o,0)*o;return nV.create(l)});return 1===a.getRowCount()&&1===a.getColumnCount()?a.getArrayValue()[0][0]:a}},iW.CEILING],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nV.create(1),i=null!=r?r:nV.create(0);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,n,t2.create(X.NA)),u=nQ(s,a,i,t2.create(X.NA)),c=o.map((e,t,r)=>{let n=e,i=l.get(t,r),s=u.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=+n.getValue(),o=+i.getValue(),c=+s.getValue();return 0===a||0===o?nV.create(0):this._getResult(a,o,c)});return 1===s&&1===a?c.get(0,0):c}_getResult(e,t,r){let n;return n=e<0&&0!==r?(t<0?nv(Math.abs(e)/Math.abs(t),0):-nv(Math.abs(e)/t,0))*t:(t<0?-nv(e/Math.abs(t),0):nv(e/t,0))*t,nV.create(n)}},iW.CEILING_MATH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nV.create(0);let l=(o<0?-nv(s/Math.abs(o),0):nv(s/o,0))*o;return nV.create(l)});return 1===n&&1===i?o.get(0,0):o}},iW.CEILING_PRECISE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||a<o)return t2.create(X.NUM);let l=s2(a,o);return Number.isNaN(l)||!Number.isFinite(l)?t2.create(X.NUM):nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},iW.COMBIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||0===a&&a<o)return t2.create(X.NUM);let l=s2(a+o-1,a-1);return Number.isNaN(l)||!Number.isFinite(l)?t2.create(X.NUM):nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},iW.COMBINA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}},iW.COS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}},iW.COSH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?t2.create(X.NUM):0===r?t2.create(X.DIV_BY_ZERO):t.tan().getReciprocal()}},iW.COT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:0==+t.getValue()?t2.create(X.DIV_BY_ZERO):t.tanh().getReciprocal()}},iW.COTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?t2.create(X.NUM):0===r?t2.create(X.DIV_BY_ZERO):t.sin().getReciprocal()}},iW.CSC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return 0===r?t2.create(X.DIV_BY_ZERO):Number.isNaN(r)||Number.isFinite(Math.sinh(r))?t.sinh().getReciprocal():nV.create(0)}},iW.CSCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=`${e.getValue()}`,a=Math.floor(+n.getValue());if((0,k.isRealNum)(i)&&(0>+i||+i>=0x20000000000000||!Number.isInteger(+i))||"true"===i.toLocaleLowerCase()||"false"===i.toLocaleLowerCase()||a<2||a>36)return t2.create(X.NUM);if(""===i.replace(/\s/g,""))return nV.create(0);if(!this._isValidCharForRadix(i,a))return t2.create(X.NUM);let o=Number.parseInt(i,a);return Number.isNaN(o)?t2.create(X.NUM):nV.create(o)});return 1===r&&1===n?a.get(0,0):a}_isValidCharForRadix(e,t){for(let r of e){let e=r.toUpperCase().charCodeAt(0);if(t<=10&&!(e>=48&&e<48+t)||t>10&&!(e>=48&&e<58||e>=65&&e<65+t-10))return!1}return!0}},iW.DECIMAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return t2.create(X.VALUE);let n=180/Math.PI*r;return Number.isNaN(n)?t2.create(X.VALUE):nV.create(n)}},iW.DEGREES],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return t2.create(X.VALUE);let n=(r<0?-nv(Math.abs(r)/2,0):nv(r/2,0))*2;return Number.isNaN(n)?t2.create(X.VALUE):0===n?nV.create(0):nV.create(n)}},iW.EVEN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}},iW.EXP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s1(Math.floor(+t.getValue()));return Number.isNaN(r)||!Number.isFinite(r)?t2.create(X.NUM):nV.create(r)}},iW.FACT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return t2.create(X.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s1(Math.floor(+t.getValue()),2);return Number.isNaN(r)||!Number.isFinite(r)?t2.create(X.NUM):nV.create(r)}},iW.FACTDOUBLE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=+i.getValue(),o=+n.getValue();if(a>0&&o<0)return t2.create(X.NUM);if(0===a)return nV.create(0);if(0===o)return t2.create(X.DIV_BY_ZERO);let l=nA(a/o,0)*o;return nV.create(l)});return 1===r&&1===n?a.get(0,0):a}},iW.FLOOR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nV.create(1),i=null!=r?r:nV.create(0),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,n,t2.create(X.NA)),u=nQ(s,a,i,t2.create(X.NA)),c=o.map((e,t,r)=>{let n,i=e,s=l.get(t,r),a=u.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=+i.getValue(),c=+s.getValue(),h=+a.getValue();return 0===o||0===c?nV.create(0):(n=o<0&&0!==h?(c<0?nA(Math.abs(o)/Math.abs(c),0):-nA(Math.abs(o)/c,0))*c:(c<0?-nA(o/Math.abs(c),0):nA(o/c,0))*c,nV.create(n))});return 1===s&&1===a?c.get(0,0):c}},iW.FLOOR_MATH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nV.create(0);let l=(o<0?-nA(s/Math.abs(o),0):nA(s/o,0))*o;return nV.create(l)});return 1===n&&1===i?o.get(0,0):o}},iW.FLOOR_PRECISE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if(n.isArray()){let e=!1,r=t2.create(X.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:a}=this._handleSingleObject(n);if(i)return e=!0,r=s,!1;t=s5(t,a)}),e)return r}else{let{isError:e,errorObject:r,number:i}=this._handleSingleObject(n);if(e)return r;t=s5(t,i)}}}return nV.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0||r>=0x20000000000000?{isError:!0,errorObject:t2.create(X.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},iW.GCD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());return nV.create(r)}},iW.INT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull()){if(i.isArray()){let e=!1,n=t2.create(X.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);if(s)return e=!0,n=a,!1;t=s3(t,o),r=!1}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;t=s3(t,s),r=!1}}}return r?nV.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=0x20000000000000?t2.create(X.VALUE):nV.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:t2.create(X.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},iW.LCM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}},iW.LN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(10);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(s<=0||o<=0)return t2.create(X.NUM);let l=Math.log(o);if(0===l)return t2.create(X.DIV_BY_ZERO);let u=Math.log(s)/l;return nV.create(u)});return 1===n&&1===i?o.get(0,0):o}},iW.LOG],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}},iW.LOG10],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return t2.create(X.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return t2.create(X.VALUE);let i=s4(n);return nV.create(i)}},iW.MDETERM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return t2.create(X.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return t2.create(X.VALUE);let i=function(e){let t=s4(e);return 0===t?null:1===e.length?[[1/t]]:(function(e){let t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let n=0;n<t;n++)for(let i=0;i<t;i++){let t=(n+i)%2==0?1:-1;r[i][n]=t*s4(s6(e,n,i))}return r})(e).map(e=>e.map(e=>e/t))}(n);return null===i?t2.create(X.NUM):nB.createByArray(i)}},iW.MINVERSE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(n!==i)return t2.create(X.VALUE);let a=this._getMatrix(e,r,n),o=this._getMatrix(t,i,s);if(a instanceof t2)return a;if(o instanceof t2)return o;let l=s9(a,o);return nB.createByArray(l)}_getMatrix(e,t,r){let n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return t2.create(X.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}return n}},iW.MMULT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}},iW.MOD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return t2.create(X.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return t2.create(X.VALUE);if(0===s)return nV.create(0);if(i>0&&s<0||i<0&&s>0)return t2.create(X.NUM);let a=nI(i/s,0)*s;return nV.create(a)}},iW.MROUND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull()){if(i.isArray()){let e=!1,n=t2.create(X.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);return s?(e=!0,n=a,!1):(t+=o)>170?(e=!0,n=t2.create(X.NUM),!1):void(r*=s1(o))}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;if((t+=s)>170)return t2.create(X.NUM);r*=s1(s)}}}let n=s1(t)/r;return nV.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:t2.create(X.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},iW.MULTINOMIAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(e=>{let n=this._handleSingleObject(e);return n.isError()?n:t>1||r>1?n.get(0,0):n});return 1===t&&1===r?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());if(r<=0)return t2.create(X.VALUE);let n=[];for(let e=0;e<r;e++){n[e]=[];for(let t=0;t<r;t++)n[e][t]=e===t?1:0}return nB.createByArray(n)}},iW.MUNIT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return t2.create(X.VALUE);let n=r<0?-nv(Math.abs(r),0):nv(r,0);return Number.isNaN(n)?t2.create(X.VALUE):(Math.abs(n)%2==0&&(r<0?n--:n++),nV.create(n))}},iW.ODD],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){return nV.create(Math.PI)}},iW.PI],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}},iW.POWER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(1);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=this._multiplyArray(n)),n.isError())return n;if((t=t.multiply(n)).isError())break}}return t}_multiplyArray(e){let t=nV.create(1);return e.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.multiply(e)))),t}},iW.PRODUCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();if(Number.isNaN(o)||Number.isNaN(l))return t2.create(X.VALUE);if(0===l)return t2.create(X.DIV_BY_ZERO);let u=Math.trunc(o/l);return nV.create(u)}},iW.QUOTIENT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return t2.create(X.VALUE);let n=Math.PI/180*r;return Number.isNaN(n)?t2.create(X.VALUE):nV.create(n)}},iW.RADIANS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",0)}calculate(){return nV.create(Math.random())}},iW.RAND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",0),G(this,"maxParams",5),G(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,i){if(null!=e&&e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=e?e:nV.create(1),a=null!=t?t:nV.create(1),o=null!=r?r:nV.create(0),l=null!=n?n:nV.create(1),u=null!=i?i:nV.create(0);return this._calculateResult(s,a,o,l,u)}_calculateResult(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1);if(1===s&&1===a)return this._calculateSingleCell(e,t,r,n,i);let o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,t,t2.create(X.NA)),u=nQ(s,a,r,t2.create(X.NA)),c=nQ(s,a,n,t2.create(X.NA)),h=nQ(s,a,i,t2.create(X.NA));return o.map((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r),o=this._handleError(e,n,i,s,a);if(o.errorObject)return o.errorObject;let{minValue:d,maxValue:m,wholeNumberValue:g}=o,f;return g?(d=Math.ceil(d),f=Math.floor(Math.random()*((m=Math.floor(m))-d+1))+d):f=Math.random()*(m-d)+d,f<d||f>m?t2.create(X.VALUE):nV.create(f)})}_calculateSingleCell(e,t,r,n,i){let s=e;s.isArray()&&(s=s.get(0,0));let a=t;a.isArray()&&(a=a.get(0,0));let o=r;o.isArray()&&(o=o.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let u=i;u.isArray()&&(u=u.get(0,0));let c=this._handleError(s,a,o,l,u);if(c.errorObject)return c.errorObject;let{rowsValue:h,columnsValue:d,minValue:m,maxValue:g,wholeNumberValue:f}=c;if(f&&(m=Math.ceil(m))>(g=Math.floor(g)))return t2.create(X.VALUE);let p=[];for(let e=0;e<h;e++){let e=[];for(let t=0;t<d;t++)f?e.push(Math.floor(Math.random()*(g-m+1))+m):e.push(Math.random()*(g-m)+m);p.push(e)}return 1===h&&1===d?nV.create(p[0][0]):nB.createByArray(p)}_handleError(e,t,r,n,i){let s=e;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return{errorObject:s};let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let o=r;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return{errorObject:o};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let u=i;return u.isString()&&(u=u.convertToNumberObjectValue()),u.isError()?{errorObject:u}:this._getValue(s,a,o,l,u)}_getValue(e,t,r,n,i){let s=Math.floor(+e.getValue()),a=Math.floor(+t.getValue());if(0===s||0===a)return{errorObject:t2.create(X.CALC)};let o=this._rowCount-this.row,l=this._columnCount-this.column;if(s<0||a<0||s*a>1e7)return{errorObject:t2.create(X.VALUE)};if(s>o||a>l)return{errorObject:t2.create(X.REF)};let u=+r.getValue(),c=+n.getValue(),h=+i.getValue();return u>c?{errorObject:t2.create(X.VALUE)}:!h||Number.isInteger(u)&&Number.isInteger(c)?{rowsValue:s,columnsValue:a,minValue:u,maxValue:c,wholeNumberValue:h}:{errorObject:t2.create(X.VALUE)}}},iW.RANDARRAY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return t2.create(X.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return t2.create(X.VALUE);if(i>s)return t2.create(X.NUM);i=Math.ceil(i);let a=Math.floor(Math.random()*((s=Math.floor(s))-i+1))+i;return nV.create(a)}},iW.RANDBETWEEN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e);if(r)return n;let[s]=i,a=Math.floor(+s.getValue()),o=t;if(o.isString()&&(o=o.convertToNumberObjectValue()).isError())return o;let l=Math.floor(+o.getValue());if(o.isBoolean()&&(l=o.getValue()?0:4),a<0||a>3999||l<0||l>4)return t2.create(X.VALUE);let u=as[l],c=u.length-1,h="";for(;a>0;){c=this._binarySearch(a,0,c,u);let e=u[c];a-=e,h+=ai.get(e)}return nP.create(h)}_binarySearch(e,t,r,n){let i=t,s=r;for(;s-i>1;){let t=Math.floor((i+s)/2),r=n[t];if(r===e)return t;r>e?s=t:i=t}return i!==s&&n[s]<=e?s:i}},iW.ROMAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}},iW.ROUND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=+l.getValue(),h=Math.trunc(+u.getValue()),d=this._roundBank(c,h);return nV.create(d)});return 1===r&&1===n?a.get(0,0):a}_roundBank(e,t){let r=10**t,n=+(e*r).toFixed(8),i=Math.floor(n),s=n-i,a=Math.round(n);return s>.5-1e-8&&s<.5+1e-8&&(a=i%2==0?i:i+1),t?a/r:a}},iW.ROUNDBANK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}},iW.ROUNDDOWN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}},iW.ROUNDUP],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())?t:Math.abs(+t.getValue())>=0x8000000?t2.create(X.NUM):t.cos().getReciprocal()}},iW.SEC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=0x8000000?t2.create(X.NUM):t.cosh().getReciprocal():nV.create(0)}},iW.SECH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return t2.create(X.NA);let{isError:i,errorObject:s,variants:a}=sG(e,t,r);if(i)return s;let{isError:o,errorObject:l,variants:u}=sz(...a);if(o)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=+d.getValue(),p=[];if(n.isArray()){let e=!1,t=t2.create(X.VALUE);if(n.iterator(r=>{let{isError:n,errorObject:i,coefficientsObject:s}=this._handleSingleObject(r);if(n)return e=!0,t=i,!1;let a=+s.getValue();p.push(a)}),e)return t}else{let{isError:e,errorObject:t,coefficientsObject:r}=this._handleSingleObject(n);if(e)return t;let i=+r.getValue();p.push(i)}let C=0;for(let e=0;e<p.length;e++)C+=p[e]*m**(g+e*f);return Number.isNaN(C)||!Number.isFinite(C)?t2.create(X.NUM):nV.create(C)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(null!=e&&e.isBoolean())return{isError:!0,errorObject:t2.create(X.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}},iW.SERIESSUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4),G(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let i=e,s=null!=t?t:nV.create(1),a=null!=r?r:nV.create(1),o=null!=n?n:nV.create(1);i.isNull()&&(i=nV.create(1)),s.isNull()&&(s=nV.create(1)),a.isNull()&&(a=nV.create(1)),o.isNull()&&(o=nV.create(1));let l=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,i,t2.create(X.NA)),h=nQ(l,u,s,t2.create(X.NA)),d=nQ(l,u,a,t2.create(X.NA)),m=nQ(l,u,o,t2.create(X.NA)),g=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._getResult(e,n,i,s,l,u)});return 1===l&&1===u?g.get(0,0):g}_getResult(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sz(e,t,r,n);if(a)return o;let[u,c,h,d]=l,m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue(),p=+d.getValue();if(m<0||g<0||m*g>1e7)return t2.create(X.VALUE);if(0===m||0===g)return t2.create(X.CALC);let C=this._rowCount-this.row,_=this._columnCount-this.column;if(m>C||g>_)return t2.create(X.REF);let y=[];for(let e=0;e<m;e++){y[e]=[];for(let t=0;t<g;t++)y[e][t]=f+(e*g+t)*p}return i>1||s>1?nV.create(y[0][0]):nB.createByArray(y)}},iW.SEQUENCE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();return s>0?nV.create(1):s<0?nV.create(-1):nV.create(0)}},iW.SIGN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}},iW.SIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}},iW.SINH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}},iW.SQRT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return t2.create(X.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(r<0)return t2.create(X.NUM);let n=Math.sqrt(r*Math.PI);return nV.create(n)}},iW.SQRTPI],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255),G(this,"needsReferenceObject",!0)}calculate(e,...t){if(e.isError())return e;if(e.isReferenceObject()){let r=[];return e.iterator((e,n,i)=>{null==r[n]&&(r[n]=[]),r[n][i]=this._handleSingleObject(e,...t)}),nZ(r,r.length,r[0].length)}return this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){let r;let n=this._getIndexNumValue(e);if(n instanceof t2)return n;switch(n){case 1:r=this._average(!1,...t);break;case 2:r=this._count(!1,...t);break;case 3:r=this._counta(!1,...t);break;case 4:r=this._max(!1,...t);break;case 5:r=this._min(!1,...t);break;case 6:r=this._product(!1,...t);break;case 7:r=this._stdev(!1,...t);break;case 8:r=this._stdevp(!1,...t);break;case 9:r=this._sum(!1,...t);break;case 10:r=this._var(!1,...t);break;case 11:r=this._varp(!1,...t);break;case 101:r=this._average(!0,...t);break;case 102:r=this._count(!0,...t);break;case 103:r=this._counta(!0,...t);break;case 104:r=this._max(!0,...t);break;case 105:r=this._min(!0,...t);break;case 106:r=this._product(!0,...t);break;case 107:r=this._stdev(!0,...t);break;case 108:r=this._stdevp(!0,...t);break;case 109:r=this._sum(!0,...t);break;case 110:r=this._var(!0,...t);break;case 111:r=this._varp(!0,...t);break;default:r=t2.create(X.VALUE)}return r}_getIndexNumValue(e){let t=e?Number(e.getValue()):0;if(Number.isNaN(t))return t2.create(X.VALUE);let r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:t2.create(X.VALUE)}_average(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=nV.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return t2.create(X.VALUE);let s=i.getRowData();i.iterator((t,n)=>{if(e&&this._isRowHidden(s,n))return!0;null!=t&&t.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=nV.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return t2.create(X.VALUE);let s=i.getRowData();i.iterator((t,n)=>{if(e&&this._isRowHidden(s,n)||null==t||t.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nV.create(0):r.max()}_min(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nV.create(0):r.min()}_product(e,...t){let r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return nV.create(0);let n=nV.create(1);return r.iterator(e=>{n=n.multiply(e)}),n}_stdev(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?t2.create(X.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?t2.create(X.DIV_BY_ZERO):r.std()}_sum(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?t2.create(X.DIV_BY_ZERO):r.var(1)}_varp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?t2.create(X.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){let r=[];r[0]=[];for(let n=0;n<t.length;n++){let i;let s=t[n];if(s.isError())return s;if(!s.isReferenceObject())return t2.create(X.VALUE);let a=s.getRowData();if(s.iterator((t,n)=>!!(e&&this._isRowHidden(a,n)||null==t||t.isNull()||t.isString()||t.isBoolean())||(t.isError()?(i=t,!1):void r[0].push(t))),null!=i&&i.isError())return i}return nZ(r,1,r[0].length)}_isRowHidden(e,t){let r=e[t];return!!r&&r.hd===k.BooleanNumber.TRUE}_isBlankArrayObject(e){return 0===e.getArrayValue()[0].length}},iW.SUBTOTAL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if((t=t.plus(n)).isError())break}return t}},iW.SUM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){let t=n.mapValue(t=>this._handleSingleObject(e,t,r));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(!e.isReferenceObject()||r&&!r.isReferenceObject())return t2.create(X.VALUE);let n=e.toArrayValueObject(),i=n0(n,t),[,s]=nJ(`${t.getValue()}`);i=n6(i,n,s);let a=n.getRowCount(),o=n.getColumnCount(),l=n;if(r){let e=(l=r.toArrayValueObject()).getRowCount(),t=l.getColumnCount();if(a!==e||o!==t){let e=r.getRangeData();e.endRow=e.startRow+a-1,e.endColumn=e.startColumn+o-1,r.setRangeData(e),l=r.toArrayValueObject()}}return l.pick(i).sum()}},iW.SUMIF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return t2.create(X.VALUE);let{maxRowLength:r,maxColumnLength:n}=n5(t),i=n3(t,e,r,n);if(i)return i;let s=n4(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>e.pick(t).sum())),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(n)}},iW.SUMIFS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=this._initArray1(e);if(!(t.length>0))return r.sum();{let e=r.getRowCount(),n=r.getColumnCount(),i=this._getResultArrayByArray1(e,n,r);if(i instanceof t2)return i;for(let r=0;r<t.length;r++){if(t[r].isError())return t[r];let s=1,a=1;if(t[r].isArray()&&(s=t[r].getRowCount(),a=t[r].getColumnCount()),s!==e||a!==n)return t2.create(X.VALUE);for(let s=0;s<e;s++){let e=[];for(let a=0;a<n;a++){let n=t[r];if(t[r].isArray()&&(n=t[r].get(s,a)),n.isError())return n;let o=n.getValue();o&&(0,k.isRealNum)(o)?e.push(+o*i[s][a]):e.push(0)}i[s]=e}}let s=i.reduce((e,t)=>e.concat(t)).reduce((e,t)=>e+t,0);return nV.create(s)}}_initArray1(e){let t=e;return t.isArray()||(t=nB.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){let n=[];for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.get(i,n);if(t.isError())return t;let s=t.getValue();s&&(0,k.isRealNum)(s)?e.push(+s):e.push(0)}n.push(e)}return n}},iW.SUMPRODUCT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0),r=nV.create(2);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()?i.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.plus(e.pow(r))))):t=t.plus(i.pow(r)),t.isError())break}return t}},iW.SUMSQ],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return t2.create(X.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nx.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2-c**2}),i.isError()?i:0===s.length||0===a.length?t2.create(X.DIV_BY_ZERO):nV.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return t2.create(X.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,k.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,k.isRealNum)(s)||n.isBoolean())return t2.create(X.DIV_BY_ZERO);let a=i**2-s**2;return nV.create(a)}},iW.SUMX2MY2],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return t2.create(X.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nx.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2+c**2}),i.isError()?i:0===s.length||0===a.length?t2.create(X.DIV_BY_ZERO):nV.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return t2.create(X.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,k.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,k.isRealNum)(s)||n.isBoolean())return t2.create(X.DIV_BY_ZERO);let a=i**2+s**2;return nV.create(a)}},iW.SUMX2PY2],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return t2.create(X.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nx.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=(u-c)**2}),i.isError()?i:0===s.length||0===a.length?t2.create(X.DIV_BY_ZERO):nV.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return t2.create(X.VALUE);let i=+r.getValue(),s=+n.getValue();return r.isString()&&!(0,k.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,k.isRealNum)(s)||n.isBoolean()?t2.create(X.DIV_BY_ZERO):nV.create((i-s)**2)}},iW.SUMXMY2],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}},iW.TAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}},iW.TANH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue(),l=10**Math.trunc(o),u=nS(s,l),c=Math.trunc(nN(s,l)+u)/l;return nV.create(c)});return 1===n&&1===i?o.get(0,0):o}},iW.TRUNC]];class lh extends t0{constructor(e){super(""),G(this,"_values",[]),this._values=e}static create(e){return new lh(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}sum(){let e=nV.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=nV.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=nV.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){let e=nV.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){let e=nV.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){let e=nV.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}let ld=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2),G(this,"_compareType",ee.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}},ip.COMPARE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:t.isArray()||0!==t.getValue()?e.divided(t):t2.create(X.DIV_BY_ZERO)}},ip.DIVIDED],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}},ip.MINUS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}},ip.MULTIPLY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}},ip.PLUS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return n;if(!n.isArray())return t2.create(X.VALUE);t.push(n)}return lh.create(t)}},ip.CUBE]];class lm extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=r.isArray()?r.getRowCount():1,a=r.isArray()?r.getColumnCount():1,o=t;t.isArray()&&1===n&&1===i&&(o=t.get(0,0));let l=r;return r.isArray()&&1===s&&1===a&&(l=r.get(0,0)),e.isArray()?e.mapValue(e=>this._handleSignleObject(e,o,l,n,i,s,a)):this._handleSignleObject(e,o,l,n,i,s,a)}_handleSignleObject(e,t,r,n,i,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let o=e;if(e.isString()&&(o=e.convertToNumberObjectValue()),o.isError())return o;let l=+o.getValue();if((n*i==1||s*a==1)&&(t.isNull()||r.isNull()))return t2.create(X.VALUE);if(n*i!=s*a)return t2.create(X.NA);let{isError:u,errorObject:c,array1Values:h,array2Values:d,noCalculate:m}=ax(t,r,n*i,i,a);if(u)return c;if(m)return t2.create(X.DIV_BY_ZERO);let g=a_(l,h,d);return Number.isFinite(g)?nV.create(g):t2.create(X.DIV_BY_ZERO)}}var lg=((L=lg||{}).AVEDEV="AVEDEV",L.AVERAGE="AVERAGE",L.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",L.AVERAGEA="AVERAGEA",L.AVERAGEIF="AVERAGEIF",L.AVERAGEIFS="AVERAGEIFS",L.BETA_DIST="BETA.DIST",L.BETA_INV="BETA.INV",L.BINOM_DIST="BINOM.DIST",L.BINOM_DIST_RANGE="BINOM.DIST.RANGE",L.BINOM_INV="BINOM.INV",L.CHISQ_DIST="CHISQ.DIST",L.CHISQ_DIST_RT="CHISQ.DIST.RT",L.CHISQ_INV="CHISQ.INV",L.CHISQ_INV_RT="CHISQ.INV.RT",L.CHISQ_TEST="CHISQ.TEST",L.CONFIDENCE_NORM="CONFIDENCE.NORM",L.CONFIDENCE_T="CONFIDENCE.T",L.CORREL="CORREL",L.COUNT="COUNT",L.COUNTA="COUNTA",L.COUNTBLANK="COUNTBLANK",L.COUNTIF="COUNTIF",L.COUNTIFS="COUNTIFS",L.COVARIANCE_P="COVARIANCE.P",L.COVARIANCE_S="COVARIANCE.S",L.DEVSQ="DEVSQ",L.EXPON_DIST="EXPON.DIST",L.F_DIST="F.DIST",L.F_DIST_RT="F.DIST.RT",L.F_INV="F.INV",L.F_INV_RT="F.INV.RT",L.F_TEST="F.TEST",L.FISHER="FISHER",L.FISHERINV="FISHERINV",L.FORECAST="FORECAST",L.FORECAST_ETS="FORECAST.ETS",L.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",L.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",L.FORECAST_ETS_STAT="FORECAST.ETS.STAT",L.FORECAST_LINEAR="FORECAST.LINEAR",L.FREQUENCY="FREQUENCY",L.GAMMA="GAMMA",L.GAMMA_DIST="GAMMA.DIST",L.GAMMA_INV="GAMMA.INV",L.GAMMALN="GAMMALN",L.GAMMALN_PRECISE="GAMMALN.PRECISE",L.GAUSS="GAUSS",L.GEOMEAN="GEOMEAN",L.GROWTH="GROWTH",L.HARMEAN="HARMEAN",L.HYPGEOM_DIST="HYPGEOM.DIST",L.INTERCEPT="INTERCEPT",L.KURT="KURT",L.LARGE="LARGE",L.LINEST="LINEST",L.LOGEST="LOGEST",L.LOGNORM_DIST="LOGNORM.DIST",L.LOGNORM_INV="LOGNORM.INV",L.MARGINOFERROR="MARGINOFERROR",L.MAX="MAX",L.MAXA="MAXA",L.MAXIFS="MAXIFS",L.MEDIAN="MEDIAN",L.MIN="MIN",L.MINA="MINA",L.MINIFS="MINIFS",L.MODE_MULT="MODE.MULT",L.MODE_SNGL="MODE.SNGL",L.NEGBINOM_DIST="NEGBINOM.DIST",L.NORM_DIST="NORM.DIST",L.NORM_INV="NORM.INV",L.NORM_S_DIST="NORM.S.DIST",L.NORM_S_INV="NORM.S.INV",L.PEARSON="PEARSON",L.PERCENTILE_EXC="PERCENTILE.EXC",L.PERCENTILE_INC="PERCENTILE.INC",L.PERCENTRANK_EXC="PERCENTRANK.EXC",L.PERCENTRANK_INC="PERCENTRANK.INC",L.PERMUT="PERMUT",L.PERMUTATIONA="PERMUTATIONA",L.PHI="PHI",L.POISSON_DIST="POISSON.DIST",L.PROB="PROB",L.QUARTILE_EXC="QUARTILE.EXC",L.QUARTILE_INC="QUARTILE.INC",L.RANK_AVG="RANK.AVG",L.RANK_EQ="RANK.EQ",L.RSQ="RSQ",L.SKEW="SKEW",L.SKEW_P="SKEW.P",L.SLOPE="SLOPE",L.SMALL="SMALL",L.STANDARDIZE="STANDARDIZE",L.STDEV_P="STDEV.P",L.STDEV_S="STDEV.S",L.STDEVA="STDEVA",L.STDEVPA="STDEVPA",L.STEYX="STEYX",L.T_DIST="T.DIST",L.T_DIST_2T="T.DIST.2T",L.T_DIST_RT="T.DIST.RT",L.T_INV="T.INV",L.T_INV_2T="T.INV.2T",L.T_TEST="T.TEST",L.TREND="TREND",L.TRIMMEAN="TRIMMEAN",L.VAR_P="VAR.P",L.VAR_S="VAR.S",L.VARA="VARA",L.VARPA="VARPA",L.WEIBULL_DIST="WEIBULL.DIST",L.Z_TEST="Z.TEST",L);class lf extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0)return t2.create(X.NUM);let a=aE(s);return 1e-15>Math.abs(a)?nV.create(0):nV.create(a)}}let lp=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0),r=nV.create(0);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((i=function(e){let t=[];t[0]=[];let r=null;return e.iterator((e,n,i)=>{if(null!=e&&e.isError())return r=e,!1;null!=e&&e.isNumber()&&t[0].push(e)}),r||nZ(t,1,t[0].length)}(i)).isError())return i;if(e[n]=i,(t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nV.create(1)))}if(0===r.getValue())return t2.create(X.NUM);let n=t.divided(r);if(n.isError())return n;let i=nV.create(0);for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;if(r.isArray()){if((i=i.plus(r.minus(n).abs().sum())).isError())return i}else r.isNull()||(i=i.plus(r.minus(n).abs()))}return i.divided(r)}},lg.AVEDEV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0),r=nV.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nV.create(1)))}return t.divided(r)}},lg.AVERAGE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!=0&&(t=!0,r=t2.create(X.NA));let n=[],i=[];for(let s=0;s<e.length;s+=2){let a=e[s],o=a.isArray()?a.getRowCount():1,l=a.isArray()?a.getColumnCount():1;for(let e=0;e<o;e++)for(let i=0;i<l;i++){let s=a.isArray()?a.get(e,i):a;if(s.isError())return s;if(!t){if(s.isNull()||s.isBoolean()||s.isString()){t=!0,r=t2.create(X.VALUE);continue}n.push(+s.getValue())}}if(s+1>=e.length)continue;let u=e[s+1],c=u.isArray()?u.getRowCount():1,h=u.isArray()?u.getColumnCount():1;(c!==o||h!==l)&&(t=!0,r=t2.create(X.VALUE));for(let e=0;e<c;e++)for(let n=0;n<h;n++){let s=u.isArray()?u.get(e,n):u;if(s.isError())return s;if(t)continue;if(s.isNull()||s.isBoolean()||s.isString()){t=!0,r=t2.create(X.VALUE);continue}let a=+s.getValue();if(a<0){t=!0,r=t2.create(X.VALUE);continue}i.push(a)}}return t?r:this._getResult(n,i)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s]*t[s],i+=t[s];let s=n/i;return nV.create(s)}},lg.AVERAGE_WEIGHTED],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0),r=nV.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null==e||e.isNull())return!0;let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()).isError()&&(n=nV.create(0)),n.isBoolean()&&(n=n.convertToNumberObjectValue()),n.isError())return t=n,!1;t=t.plus(n),r=r.plus(nV.create(1))}),t.isError())return t}else i.isNull()||(t=t.plus(i),r=r.plus(nV.create(1)))}return t.divided(r)}},lg.AVERAGEA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject()),n.isArray()||(n=nZ([[n]],1,1));let i=t;return i.isReferenceObject()&&(i=i.toArrayValueObject()),r&&!(null!=r&&r.isReferenceObject())?t2.create(X.NA):i.isArray()?i.map(e=>this._handleSingleObject(n,e,r)):this._handleSingleObject(n,i,r)}_handleSingleObject(e,t,r){let n=n0(e,t),[,i]=nJ(`${t.getValue()}`);n=n6(n,e,i);let s=r?this._createRangeReferenceObject(r,e):e;if(!s)return t2.create(X.VALUE);if(s.isError())return s;s.isReferenceObject()&&(s=s.toArrayValueObject());let a=s.pick(n),o=a.sum(),l=a.count();return o.divided(l)}_createRangeReferenceObject(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(r===i&&n===s)return e;let{startRow:a,startColumn:o}=e.getRangePosition();return this.createReferenceObject(e,{startRow:a,startColumn:o,endRow:a+i-1,endColumn:o+s-1})}},lg.AVERAGEIF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return t2.create(X.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return t2.create(X.VALUE);let{maxRowLength:r,maxColumnLength:n}=n5(t),i=n3(t,e,r,n);if(i)return i;let s=n4(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t),n=r.sum(),i=r.count();return n.divided(i)})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(n)}},lg.AVERAGEIFS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=i?i:nV.create(0),o=null!=s?s:nV.create(1);a.isNull()&&(a=nV.create(0)),o.isNull()&&(o=nV.create(1));let l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,e,t2.create(X.NA)),h=nQ(l,u,t,t2.create(X.NA)),d=nQ(l,u,r,t2.create(X.NA)),m=nQ(l,u,n,t2.create(X.NA)),g=nQ(l,u,a,t2.create(X.NA)),f=nQ(l,u,o,t2.create(X.NA)),p=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),a=g.get(t,r),o=f.get(t,r);return this._handleSignleObject(e,n,i,s,a,o)});return 1===l&&1===u?p.get(0,0):p}_handleSignleObject(e,t,r,n,i,s){var a;let o;if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let{isError:l,errorObject:u,variants:c}=sz(e,t,r,n,i,s);if(l)return u;let[h,d,m,g,f,p]=c,C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue(),b=+f.getValue(),R=+p.getValue();return _<=0||y<=0||C<b||C>R||b===R?t2.create(X.NUM):(o=E?aa((C-b)/(R-b),_,y):((a=(C-b)/(R-b))<=0||a>=1?0:1===_&&1===y?1:_<512&&y<512?a**(_-1)*(1-a)**(y-1)/ac(_,y):Math.exp((_-1)*Math.log(a)+(y-1)*Math.log(1-a)-ah(_,y)))/(R-b),nV.create(o))}},lg.BETA_DIST],[aj,lg.BETA_INV],[aF,lg.BINOM_DIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=n?n:r;i.isNull()&&(i=r);let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,t,t2.create(X.NA)),u=nQ(s,a,r,t2.create(X.NA)),c=nQ(s,a,i,t2.create(X.NA)),h=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===s&&1===a?h.get(0,0):h}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||d<0||d>1||m<0||m>h||g<0||g<m||g>h)return t2.create(X.NUM);let f=0;for(let e=m;e<=g;e++)f+=am(e,h,d);return nV.create(f)}},lg.BINOM_DIST_RANGE],[ak,lg.BINOM_INV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n;let{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return c<0||h<1||h>1e10?t2.create(X.NUM):(n=d?ag(c,h):c<0?0:0===c&&2===h?.5:Math.exp((h/2-1)*Math.log(c)-c/2-h/2*Math.log(2)-aE(h/2)),nV.create(n))}},lg.CHISQ_DIST],[aB,lg.CHISQ_DIST_RT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return t2.create(X.NUM);let u=af(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},lg.CHISQ_INV],[a$,lg.CHISQ_INV_RT],[aH,lg.CHISQ_TEST],[aW,lg.CONFIDENCE_NORM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sz(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return t2.create(X.NUM);if(1===f)return t2.create(X.DIV_BY_ZERO);let p=Math.abs(aw(m/2,f-1)*g/Math.sqrt(f));return nV.create(p)});return 1===n&&1===i?l.get(0,0):l}},lg.CONFIDENCE_T],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?t2.create(X.VALUE):t2.create(X.DIV_BY_ZERO);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++){let r=e[n]-s,i=t[n]-a;o+=r*i,l+=r**2,u+=i**2}let c=Math.sqrt(l*u);return 0===c?t2.create(X.DIV_BY_ZERO):nV.create(o/c)}},lg.CORREL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0);for(let r=0;r<e.length;r++){let n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(nV.create(1))):n.isNull()||(t=t.plus(nV.create(1))))}return t}},lg.COUNT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(nV.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(nV.create(1)))}return t}},lg.COUNTA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isError()?e:""===e.getValue()||e.isNull()?nV.create(1):e.isArray()?e.countBlank():nV.create(0)}},lg.COUNTBLANK],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?t2.create(X.NA):e.isArray()?t.isArray()?t.mapValue(t=>this._handleSingleObject(e,t)):this._handleSingleObject(e,t):t2.create(X.VALUE)}_handleSingleObject(e,t){let r=n0(e,t),[,n]=nJ(`${t.getValue()}`);r=n6(r,e,n);let i=e.pick(r);return this._countA(i)}_countA(e){let t=nV.create(0);return e.iterator(e=>{if(null==e)return!0;t=t.plusBy(1)}),t}},lg.COUNTIF],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",255)}calculate(...e){if(e.length%2!=0||e.some((e,t)=>t%2==0&&!e.isArray()))return t2.create(X.VALUE);let{maxRowLength:t,maxColumnLength:r}=n5(e),n=n3(e,e[0],t,r);if(n)return n;let i=n4(e,t,r,!0);return this._aggregateResults(i)}_aggregateResults(e){let t=e.map(e=>e.map(e=>{let t;return t=0,e.iterator(e=>{null!=e&&e.isBoolean()&&!0===e.getValue()&&t++}),nV.create(t)})),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(r)}},lg.COUNTIFS],[aG,lg.COVARIANCE_P],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return t2.create(X.VALUE);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(e.length<=1)return t2.create(X.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nV.create(o/(r-1))}},lg.COVARIANCE_S],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[],r=0,n=!0;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=t2.create(X.VALUE);if(s.iterator(s=>{let a=this._handleSingleObject(s);if(a.isError())return e=!0,i=a,!1;if(a.isNull())return!0;let o=a.getValue();t.push(o),r+=o,n=!1}),e)return i}else{let e=this._handleSingleObject(s);if(e.isError())return e;if(e.isNull())continue;let i=e.getValue();t.push(i),r+=i,n=!1}}if(n)return t2.create(X.NUM);let i=r/t.length,s=0;for(let e=0;e<t.length;e++)s+=(t[e]-i)**2;return nV.create(s)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return nx.create();let t=e.getValue();return(0,k.isRealNum)(t)?nV.create(+t):nx.create()}},lg.DEVSQ],[aY,lg.EXPON_DIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue();return d<0||m<1||m>1e10||g<1||g>1e10?t2.create(X.NUM):Number.isNaN(i=f?ap(d,m,g):function(e,t,r){if(e<0)return 0;if(0===e&&t<2)return 1/0;if(0===e&&2===t)return 1;let n=1/ac(t/2,r/2);return(t/r)**(t/2)*e**(t/2-1)*(1+t/r*e)**(-(t+r)/2)*n}(d,m,g))||!Number.isFinite(i)?t2.create(X.NUM):nV.create(i)}},lg.F_DIST],[az,lg.F_DIST_RT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return t2.create(X.NUM);let d=aC(u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?t2.create(X.NUM):nV.create(d)}},lg.F_INV],[aq,lg.F_INV_RT],[aX,lg.F_TEST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=i.getValue();if(s<=-1||s>=1)return t2.create(X.NUM);let a=Math.log((1+s)/(1-s))/2;return nV.create(a)}},lg.FISHER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(2*s)-1,o=Math.exp(2*s)+1;return!Number.isFinite(a)&&a>0&&!Number.isFinite(o)&&o>0?nV.create(1):nV.create(a/o)}},lg.FISHERINV],[lm,lg.FORECAST],[lm,lg.FORECAST_LINEAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,values:i}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return t2.create(X.VALUE);let{values:s}=this._getValues(t,!0);0===s.length&&(s=[0]);let a=this._getNewBinsArrayValues(s),o=Array(a.length).fill(0);for(let e=0;e<i.length;e++){let t=i[e],r=a.findIndex(e=>t>e.start&&t<=e.end);o[r]++}return nB.createByArray(o.map(e=>[e]))}_getValues(e,t=!1){let r=[],n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;for(let s=0;s<n;s++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(s,n):e;if(i.isError()){if(!t)return{isError:!0,errorObject:i,values:r};continue}if(i.isNull()||i.isBoolean())continue;let a=i.getValue();(0,k.isRealNum)(a)&&r.push(+a)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){let t=e.map((e,t)=>({value:e,index:t})).sort((e,t)=>e.value-t.value),r=[];for(let e=0;e<t.length;e++){let n=t[e].index;if(0===e){r[n]={start:-1/0,end:t[e].value};continue}r[n]={start:t[e-1].value,end:t[e].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}},lg.FREQUENCY],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(0===s||s<0&&s%1==0)return t2.create(X.NUM);let a=ay(s);return Number.isNaN(a)||!Number.isFinite(a)?t2.create(X.NUM):nV.create(a)}},lg.GAMMA],[aK,lg.GAMMA_DIST],[aQ,lg.GAMMA_INV],[lf,lg.GAMMALN],[lf,lg.GAMMALN_PRECISE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=av(+i.getValue(),0,1)-.5;return nV.create(s)}},lg.GAUSS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=t2.create(X.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,k.isRealNum)(a))return!0;0>=+a&&(n=!0),t*=+a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,k.isRealNum)(e))continue;0>=+e&&(n=!0),t*=+e,r++}}if(0===r||n)return t2.create(X.NUM);let i=t**(1/r);return nV.create(i)}},lg.GEOMEAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t,r);if(i)return s;let a=aD(e);if(a instanceof t2)return a;let o=this._getKnownXsValues(a,t);if(o instanceof t2)return o;let l=this._getNewXsValues(o,r);if(l instanceof t2)return l;let u=null!=n?n:nD.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?t2.create(X.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aP(e,t,r,n,!0);if(s instanceof t2)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t*=a[0][l-2-r]**o[e][r];c[e].push(t)}return i&&(c=s7(c)),nB.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aL(t.flat(),i,n,!0),o=r.map(e=>e.map(e=>a*s**e));return nB.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aD(t)}},lg.GROWTH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=t2.create(X.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,k.isRealNum)(a))return!0;0>=+a&&(n=!0),t+=1/+a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,k.isRealNum)(e))continue;0>=+e&&(n=!0),t+=1/+e,r++}}if(0===r)return t2.create(X.NA);if(n)return t2.create(X.NUM);let i=r/t;return nV.create(i)}},lg.HARMEAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",5),G(this,"maxParams",5)}calculate(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,t,t2.create(X.NA)),u=nQ(s,a,r,t2.create(X.NA)),c=nQ(s,a,n,t2.create(X.NA)),h=nQ(s,a,i,t2.create(X.NA)),d=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSignleObject(e,n,i,s,a)});return 1===s&&1===a?d.get(0,0):d}_handleSignleObject(e,t,r,n,i){let s;let{isError:a,errorObject:o,variants:l}=sz(e,t,r,n,i);if(a)return o;let[u,c,h,d,m]=l,g=Math.floor(+u.getValue()),f=Math.floor(+c.getValue()),p=Math.floor(+h.getValue()),C=Math.floor(+d.getValue()),_=+m.getValue();return g<0||g>f||g>p||g<f-C+p||f<=0||f>C||p<=0||p>C||C<=0?t2.create(X.NUM):(Number.isNaN(s=_?function(e,t,r,n){let i=0;for(let s=0;s<=e;s++)i+=aN(s,t,r,n);return i}(g,f,p,C):aN(g,f,p,C))&&(s=0),nV.create(s))}},lg.HYPGEOM_DIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?t2.create(X.VALUE):t2.create(X.DIV_BY_ZERO);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=a_(0,e,t);return Number.isFinite(r)?nV.create(r):t2.create(X.DIV_BY_ZERO)}},lg.INTERCEPT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,k.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=3?t2.create(X.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return t2.create(X.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**4;let o=r*(r+1)/((r-1)*(r-2)*(r-3))*a-3*(r-1)**2/((r-2)*(r-3));return nV.create(o)}},lg.KURT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?t2.create(X.NUM):(a=Math.ceil(a),nV.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>t-e)}},lg.LARGE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t);if(i)return s;let a=aD(e);if(a instanceof t2)return a;let o=this._getKnownXsValues(a,t);if(o instanceof t2)return o;let l=null!=r?r:nD.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nD.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sz(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?t2.create(X.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aP(e,t,t,r,!1);if(i instanceof t2)return i;let{coefficients:s,X:a,XTXInverse:o}=i,l=[];if(n){let t=e.flat(),n=t.length,i=r?t.reduce((e,t)=>e+t,0)/n:0,u=o.length,c=n-u,h=s[0].length,d=Array(h-2).fill(X.NA),m=s[0][h-1],g=[];for(let e=0;e<a.length;e++){let t=m;for(let r=h-2;r>=0;r--)t+=s[0][h-2-r]*a[e][r];g.push(t)}let f=0,p=0;for(let e=0;e<n;e++)f+=(t[e]-i)**2,p+=(t[e]-g[e])**2;let C=f-p,_=0===f?0:C/f,y=[];for(let e=u-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*o[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(X.NA);let E=c>0?Math.sqrt(p/c):0,b=c>0?C/(h-1)/(p/c):X.NUM;l=[s[0],[...y],[_,E,...d],[b,c,...d],[C,p,...d]]}else l=[s[0]];return nB.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o}=aL(s,i,r,!1);if(Number.isNaN(a))return t2.create(X.NA);let l=[];if(n){let t=e.length,n=0,u=0,c=t-1;if(r){let e=0,r=0;for(let n=0;n<t;n++)e+=i[n],r+=s[n];n=e/t,u=r/t,c=t-2}let h=0,d=0,m=0;for(let e=0;e<t;e++)h+=(i[e]-n)**2,d+=(i[e]-(a*s[e]+o))**2,m+=(s[e]-u)**2;let g=h-d,f=0===h?0:g/h,p=0,C=0,_=0,y=0;c>0&&(m>0&&(p=Math.sqrt(d/c/m),C=Math.sqrt(d/c*(1/t+u**2/m))),_=Math.sqrt(d/c),y=g/1/(d/c)),r||(C=X.NA),l=[[a,o],[p,C],[f,_],[y,c],[g,d]]}else l=[[a,o]];return nB.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}},lg.LINEST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t);if(i)return s;let a=aD(e);if(a instanceof t2)return a;let o=this._getKnownXsValues(a,t);if(o instanceof t2)return o;let l=null!=r?r:nD.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nD.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sz(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?t2.create(X.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aP(e,t,t,r,!0);if(i instanceof t2)return i;let{coefficients:s,Y:a,X:o,XTXInverse:l}=i,u=[];if(n){let e=a.flat(),t=e.length,n=r?e.reduce((e,t)=>e+t,0)/t:0,i=l.length,c=t-i,h=s[0].length,d=Array(h-2).fill(X.NA),m=s[0][h-1],g=[];for(let e=0;e<o.length;e++){let t=m;for(let r=h-2;r>=0;r--)t*=s[0][h-2-r]**o[e][r];g.push(Math.log(t))}let f=0,p=0;for(let i=0;i<t;i++)f+=(e[i]-n)**2,(r||Number.isFinite(g[i]))&&(p+=(e[i]-g[i])**2);Number.isFinite(p)||(p=0);let C=f-p,_=0===f?0:C/f,y=[];for(let e=i-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*l[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(X.NA);let E=c>0?Math.sqrt(p/c):0,b=c>0?C/(h-1)/(p/c):X.NUM;u=[s[0],[...y],[_,E,...d],[b,c,...d],[C,p,...d]]}else u=[s[0]];return nB.createByArray(u)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o,Y:l}=aL(s,i,r,!0);if(Number.isNaN(a))return t2.create(X.NA);let u=[];if(n){let e=l.length,t=0,n=0,i=e-1;if(r){let r=0,a=0;for(let t=0;t<e;t++)r+=l[t],a+=s[t];t=r/e,n=a/e,i=e-2}let c=0,h=0,d=0;for(let r=0;r<e;r++)c+=(l[r]-t)**2,h+=(l[r]-Math.log(o*a**s[r]))**2,d+=(s[r]-n)**2;let m=c-h,g=0===c?0:m/c,f=0,p=0,C=0,_=0;i>0&&(d>0&&(f=Math.sqrt(h/i/d),p=Math.sqrt(h/i*(1/e+n**2/d))),C=Math.sqrt(h/i),_=m/1/(h/i)),r||(p=X.NA),u=[[a,o],[f,p],[g,C],[_,i],[m,h]]}else u=[[a,o]];return nB.createByArray(u)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}},lg.LOGEST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<=0||g<=0?t2.create(X.NUM):(i=f?aI(d,m,g):d<=0?0:Math.exp(-Math.log(d)-.5*Math.log(2*Math.PI)-Math.log(g)-(Math.log(d)-m)**2/(2*g*g)),nV.create(i))}},lg.LOGNORM_DIST],[aZ,lg.LOGNORM_INV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getRangeValues(e);if(r instanceof t2)return r;let n=sH(t);if(n.isError())return n;let{isError:i,errorObject:s,variants:a}=sz(n);if(i)return s;let[o]=a,l=+o.getValue();if(l<=0||l>=1)return t2.create(X.NUM);if(r.length<2)return t2.create(X.DIV_BY_ZERO);let u=r.length,c=r.reduce((e,t)=>e+t,0)/u,h=Math.sqrt(r.reduce((e,t)=>e+(t-c)**2,0)/(u-1));if(h<=0)return t2.create(X.NUM);let d=Math.abs(aw((1-l)/2,u-1)*h/Math.sqrt(u));return nV.create(d)}_getRangeValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;n.isNull()||n.isBoolean()||n.isString()||t.push(+n.getValue())}return t}},lg.MARGINOFERROR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?nV.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nV.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?nV.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAXA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return t2.create(X.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return t2.create(X.VALUE);let{maxRowLength:r,maxColumnLength:n}=n5(t),i=n3(t,e,r,n);if(i)return i;let s=n4(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?nB.create("0"):r.max()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(n)}},lg.MAXIFS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isArray()){let e=!1,r=t2.create(X.VALUE);if(n.iterator(n=>{if(null!=n&&n.isError())return e=!0,r=n,!1;if(null!=n&&n.isNull()||null!=n&&n.isBoolean())return!0;let i=n.getValue();if(!(0,k.isRealNum)(i))return!0;t.push(+i)}),e)return r}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){let e=n.convertToNumberObjectValue();if(e.isError())return e}let e=n.getValue();if(!(0,k.isRealNum)(e))continue;t.push(+e)}}return 0===t.length?t2.create(X.NUM):this._getResult(t.sort((e,t)=>e-t))}_getResult(e){let t;let r=e.length;if(r%2==0){let n=r/2;t=(e[n-1]+e[n])/2}else t=e[Math.floor(r/2)];return nV.create(t)}},lg.MEDIAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?nV.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=nV.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nV.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?nV.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MINA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(e,...t){if(e.isError())return t2.create(X.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return t2.create(X.VALUE);let{maxRowLength:r,maxColumnLength:n}=n5(t),i=n3(t,e,r,n);if(i)return i;let s=n4(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?nB.create("0"):r.min()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nB.create(n)}},lg.MINIFS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,k.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new t2(X.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return 1===r.length?nV.create(r[0]):nB.createByArray(r.map(e=>[e]))}},lg.MODE_MULT],[aJ,lg.MODE_SNGL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||m<1||g<=0||g>=1?t2.create(X.NUM):(i=f?function(e,t,r){if(e<0)return 0;let n=0;for(let i=0;i<=e;i++)n+=aA(i,t,r);return n}(d,m,g):aA(d,m,g),nV.create(i))}},lg.NEGBINOM_DIST],[a0,lg.NORM_DIST],[a1,lg.NORM_INV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let r;let{isError:n,errorObject:i,variants:s}=sz(e,t);if(n)return i;let[a,o]=s,l=+a.getValue();return r=+o.getValue()?av(l,0,1):aS(l,0,1),nV.create(r)}},lg.NORM_S_DIST],[a2,lg.NORM_S_INV],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?t2.create(X.VALUE):t2.create(X.DIV_BY_ZERO);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return t2.create(X.DIV_BY_ZERO);let c=o/Math.sqrt(l*u);return nV.create(c)}},lg.PEARSON],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<1/(o+1)||a>1-1/(o+1))return t2.create(X.NUM);let l=a*(o+1)-1,u=Math.floor(l),c=l-u;if(0===c)return nV.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nV.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}},lg.PERCENTILE_EXC],[a5,lg.PERCENTILE_INC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nV.create(3);i.isNull()&&(i=nV.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,t,t2.create(X.NA)),l=nQ(s,a,i,t2.create(X.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof t2)return e;let{isError:n,errorObject:i,variants:s}=sz(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return t2.create(X.NA);if(1===c)return l===e[0]?nV.create(1):t2.create(X.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=(m+1)/(c+1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+1+(l-e[m])/(e[m+1]-e[m]))/(c+1),d=!0),m++;return d?u<1?t2.create(X.NUM):(h=nA(h,u),nV.create(h)):t2.create(X.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}},lg.PERCENTRANK_EXC],[a3,lg.PERCENTRANK_INC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0||c<h)return t2.create(X.NUM);let d=1;for(let e=c-h+1;e<=c;e++)d*=e;return Number.isFinite(d)?nV.create(d):t2.create(X.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0)return t2.create(X.NUM);if(0===c)return 0===h?nV.create(1):nV.create(0);let d=c**h;return Number.isFinite(d)?nV.create(d):t2.create(X.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUTATIONA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(-.5*s*s)/Math.sqrt(2*Math.PI);return nV.create(a)}},lg.PHI],[a4,lg.POISSON_DIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,xRangeValues:a,probRangeValues:o}=this._handleXRangeAndProbRange(e,t),l=null!=n?n:r;null!=n&&n.isNull()&&(l=r);let u=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=nQ(u,c,r,t2.create(X.NA)),d=nQ(u,c,l,t2.create(X.NA)),m=h.mapValue((r,n,l)=>{let u=d.get(n,l);return e.isError()?e:t.isError()?t:r.isError()?r:u.isError()?u:i?s:this._handleSignleObject(a,o,r,u)});return 1===u&&1===c?m.get(0,0):m}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(r,n);if(i)return s;let[o,l]=a,u=+o.getValue(),c=+l.getValue();if(1!==t.reduce((e,t)=>e+t,0))return t2.create(X.NUM);let h=0;for(let r=0;r<e.length;r++)e[r]>=u&&e[r]<=c&&(h+=t[r]);return nV.create(h)}_handleXRangeAndProbRange(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,xRangeValues:[],probRangeValues:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,xRangeValues:[],probRangeValues:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:t2.create(X.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!=i*s)return{isError:!0,errorObject:t2.create(X.NA),xRangeValues:[],probRangeValues:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,xRangeValues:[],probRangeValues:[]}:d?{isError:!0,errorObject:t2.create(X.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:c,probRangeValues:h}}},lg.PROB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<=0||a>=4)return t2.create(X.NUM);let o=a/4,l=e.length;if(o<1/(l+1)||o>1-1/(l+1))return t2.create(X.NUM);let u=o*(l+1)-1,c=Math.floor(u),h=u-c;if(0===h)return nV.create(e[c]);let d=e[c]+h*(e[c+1]-e[c]);return nV.create(d)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}},lg.QUARTILE_EXC],[a6,lg.QUARTILE_INC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nV.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,n,t2.create(X.NA)),h=nQ(l,u,o,t2.create(X.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return t2.create(X.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();return Number.isNaN(l)||Number.isNaN(u)?t2.create(X.VALUE):this._getResult(l,u,a)});return 1===l&&1===u?d.get(0,0):d}_getResult(e,t,r){let n=r.sort((e,r)=>t?e-r:r-e),i=n.indexOf(e),s=[];for(;i>=0;){let t=i+1;s.push(t),i=n.indexOf(e,t)}if(0===s.length)return t2.create(X.NA);let a=s.reduce((e,t)=>e+t,0)/s.length;return nV.create(a)}_checkRefReferenceObject(e){let t=!1,r=t2.create(X.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_AVG],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3),G(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nV.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=nQ(l,u,n,t2.create(X.NA)),h=nQ(l,u,o,t2.create(X.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return t2.create(X.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return t2.create(X.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?t2.create(X.NA):nV.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=t2.create(X.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_EQ],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return t2.create(X.VALUE);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return t2.create(X.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return t2.create(X.DIV_BY_ZERO);let c=(o/Math.sqrt(l*u))**2;return nV.create(c)}},lg.RSQ],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,k.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?t2.create(X.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return t2.create(X.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=r/((r-1)*(r-2))*a;return nV.create(o)}},lg.SKEW],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,k.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?t2.create(X.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/r);if(0===s)return t2.create(X.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=a/r;return nV.create(o)}},lg.SKEW_P],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?t2.create(X.VALUE):t2.create(X.DIV_BY_ZERO);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(t[n]-a)**2;if(0===l)return t2.create(X.DIV_BY_ZERO);let u=o/l;return nV.create(u)}},lg.SLOPE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?t2.create(X.NUM):(a=Math.floor(a),nV.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}},lg.SMALL],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();return h<=0?t2.create(X.NUM):nV.create((u-c)/h)}},lg.STANDARDIZE],[a9,lg.STDEV_P],[a7,lg.STDEV_S],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}},lg.STDEVA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std()}},lg.STDEVPA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return t2.create(X.VALUE);if(r*n!=i*s)return t2.create(X.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?t2.create(X.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length;if(r<=2)return t2.create(X.DIV_BY_ZERO);let n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===u)return t2.create(X.DIV_BY_ZERO);let c=Math.sqrt((l-o**2/u)/(r-2));return Number.isNaN(c)||!Number.isFinite(c)?t2.create(X.NUM):nV.create(c)}},lg.STEYX],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n;let{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return h<1?t2.create(X.NUM):Number.isNaN(n=d?aM(c,h):1/(Math.sqrt(h)*ac(.5,h/2))*(1+c**2/h)**(-(h+1)/2))||!Number.isFinite(n)?t2.create(X.NUM):nV.create(n)}},lg.T_DIST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return t2.create(X.NUM);let u=2*aM(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},lg.T_DIST_2T],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(l<1||l>1e10)return t2.create(X.NUM);let u=aM(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},lg.T_DIST_RT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return t2.create(X.NUM);let u=aw(o,l);return Number.isNaN(u)||!Number.isFinite(u)?t2.create(X.NUM):nV.create(u)}},lg.T_INV],[a8,lg.T_INV_2T],[oe,lg.T_TEST],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t,r);if(i)return s;let a=aD(e);if(a instanceof t2)return a;let o=this._getKnownXsValues(a,t);if(o instanceof t2)return o;let l=this._getNewXsValues(o,r);if(l instanceof t2)return l;let u=null!=n?n:nD.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?t2.create(X.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aP(e,t,r,n,!1);if(s instanceof t2)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t+=a[0][l-2-r]*o[e][r];c[e].push(t)}return i&&(c=s7(c)),nB.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aL(t.flat(),i,n,!1),o=r.map(e=>e.map(e=>s*e+a));return nB.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aD(t)}},lg.TREND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof t2)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();if(a<0||a>=1)return t2.create(X.NUM);let o=2*nA(e.length*a/2,0),l=e.slice(o/2,e.length-o/2),u=l.reduce((e,t)=>e+t,0)/l.length;return nV.create(u)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,k.isRealNum)(s)&&n.push(+s)}return 0===n.length?t2.create(X.NUM):n.sort((e,t)=>e-t)}},lg.TRIMMEAN],[ot,lg.VAR_P],[or,lg.VAR_S],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}},lg.VARA],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var()}},lg.VARPA],[on,lg.WEIBULL_DIST],[oi,lg.Z_TEST]],lC=Object.values(k.DataStreamTreeTokenType).filter(e=>[(0,k.DataStreamTreeTokenType).TABLE_START,(0,k.DataStreamTreeTokenType).TABLE_ROW_START,(0,k.DataStreamTreeTokenType).TABLE_CELL_START,(0,k.DataStreamTreeTokenType).TABLE_CELL_END,(0,k.DataStreamTreeTokenType).TABLE_ROW_END,(0,k.DataStreamTreeTokenType).TABLE_END,(0,k.DataStreamTreeTokenType).CUSTOM_BLOCK].includes(e)),l_=(e,t)=>(0,k.numfmt).format(e,t,{throws:!1}),ly=e=>{let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),e.isNumber()&&(t=""!==e.getPattern()?l_(e.getPattern(),+e.getValue()):`${nM(+e.getValue())}`),t};function lE(e){let t=0;for(let r=0;r<e.length;r++)t+=lb(e,r);return t}function lb(e,t,r="ltr"){return function(e,t,r="ltr"){let n=e.charCodeAt(t);if("ltr"===r&&lR(n)&&t+1<e.length){let r=e.charCodeAt(t+1);if(lN(r))return lI(n,r)}if("rtl"===r&&lN(n)&&t-1>=0){let r=e.charCodeAt(t-1);if(lR(r))return lI(r,n)}return n}(e,t,r)>255?2:1}function lR(e){return e>=55296&&e<=56319}function lN(e){return e>=56320&&e<=57343}function lI(e,t){return((1023&e)<<10)+(1023&t)+65536}let lA=()=>[{type:4,from:48,to:57}],lv=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],lS=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],lT=()=>({type:3,set:lv(),not:!1}),lO=()=>({type:3,set:lv(),not:!0}),lM=()=>({type:3,set:lA(),not:!1}),lw=()=>({type:3,set:lA(),not:!0}),lx=()=>({type:3,set:lS(),not:!1}),lU=()=>({type:3,set:lS(),not:!0}),lD=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function lV(e,t){if(/\(\?<=.*?\)/g.test(e)&&!/\[.*?(\?<=.*?)\]/g.test(e)||/\(\?<!.*?\)/g.test(e)&&!/\[.*?(\?<!.*?)\]/g.test(e))return{isError:!0,regExp:null};try{let r=new RegExp(e,t?"ug":"u");return!function(e,t){let r,n;"[object RegExp]"===Object.prototype.toString.call(e)?r=e.source:e&&"string"!=typeof e&&(r=`${e}`);try{n=function(e){let t={type:0,stack:[]},r=t,n=t.stack,i=[],s=[],a=0,o=t=>{throw SyntaxError(`Invalid regular expression: /${e}/: Nothing to repeat at column ${t-1}`)},l=e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(e,t,r,n,i,s,a)=>{if(r)return e;let o=String.fromCharCode(t?8:n?Number.parseInt(n,16):i?Number.parseInt(i,16):s?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):({0:0,t:9,n:10,v:11,f:12,r:13})[a]);return/[[\]{}^$.|?*+()]/.test(o)?`\\${o}`:o}),u=0,c;for(;u<l.length;)switch(c=l[u++]){case"\\":if(u===l.length)throw SyntaxError(`Invalid regular expression: /${e}/: \\ at end of pattern`);switch(c=l[u++]){case"b":n.push({type:2,value:"b"});break;case"B":n.push({type:2,value:"B"});break;case"w":n.push(lT());break;case"W":n.push(lO());break;case"d":n.push(lM());break;case"D":n.push(lw());break;case"s":n.push(lx());break;case"S":n.push(lU());break;default:if(/\d/.test(c)){for(;/\d/.test(l[u])&&u<l.length;)c+=l[u++];let e=Number.parseInt(c,10);n.push({type:6,value:e}),s.push({reference:{type:6,value:e},stack:n,index:n.length-1})}else n.push({type:7,value:c.charCodeAt(0)})}break;case"^":n.push({type:2,value:"^"});break;case"$":n.push({type:2,value:"$"});break;case"[":{let t="^"===l[u];t&&u++;let r=function(e,t){let r;let n=[],i=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;null!==(r=i.exec(e));){let e=null,[,t,s,a,o,l,u,c,h,d,m]=r;if(t||s||a||o||l||u?e=(()=>{let e={type:3,set:[],not:!1};return t?e=lT():s?e=lM():a?e=lx():o?e=lO():l?e=lw():u&&(e=lU()),e})():c&&m?e={type:4,from:(h||d).charCodeAt(0),to:m.charCodeAt(m.length-1)}:r[16]&&(e={type:7,value:r[16].charCodeAt(0)}),!e)return[n,i.lastIndex];n.push(e)}throw SyntaxError(`Invalid regular expression: /${t}/: Unterminated character class`)}(l.slice(u),e);u+=r[1],n.push({type:3,set:r[0],not:t});break}case".":n.push(lD());break;case"(":{let t={type:1,stack:[],remember:!0};if("?"===l[u]){let r=l[u+1];if(u+=2,"="===r)t.followedBy=!0;else if("!"===r)t.notFollowedBy=!0;else if(":"!==r)throw SyntaxError(`Invalid regular expression: /${e}/: Invalid group, character '${r}' after '?' at column ${u-1}`);t.remember=!1}else a+=1;n.push(t),i.push(r),r=t,n=t.stack;break}case")":if(0===i.length)throw SyntaxError(`Invalid regular expression: /${e}/: Unmatched ) at column ${u-1}`);n=(r=i.pop()).options?r.options[r.options.length-1]:r.stack;break;case"|":{r.options||(r.options=[r.stack],delete r.stack);let e=[];r.options.push(e),n=e;break}case"{":{let e=/^(\d+)(,(\d+)?)?\}/.exec(l.slice(u));if(e){0===n.length&&o(u);let t=Number.parseInt(e[1],10),r=e[2]?e[3]?Number.parseInt(e[3],10):1/0:t;u+=e[0].length,n.push({type:5,min:t,max:r,value:n.pop()})}else n.push({type:7,value:123});break}case"?":0===n.length&&o(u),n.push({type:5,min:0,max:1,value:n.pop()});break;case"+":0===n.length&&o(u),n.push({type:5,min:1,max:1/0,value:n.pop()});break;case"*":0===n.length&&o(u),n.push({type:5,min:0,max:1/0,value:n.pop()});break;default:n.push({type:7,value:c.charCodeAt(0)})}if(i.length>0)throw SyntaxError(`Invalid regular expression: /${e}/: Unterminated group`);return function(e,t){for(let r of e.reverse()){let e=r.reference.value;if(t<e){r.reference.type=7;let t=e.toString();if(r.reference.value=Number.parseInt(t,8),!/^[0-7]+$/.test(t)){let e=0;for(;"8"!==t[e]&&"9"!==t[e]&&e<t.length;)e+=1;if(0===e?(r.reference.value=t.charCodeAt(0),e+=1):r.reference.value=Number.parseInt(t.slice(0,e),8),t.length>e){let n=r.stack.splice(r.index+1);for(let n of t.slice(e))r.stack.push({type:7,value:n.charCodeAt(0)});r.stack.push(...n)}}}}}(s,a),t}(r)}catch{return!1}let i=0,s=(e,t)=>{let r=t;if(5===e.type&&(r++,i++,r>1||i>25))return!1;if(e.options){for(let t of e.options)if(!s({stack:t},r))return!1}let n=e.stack||e.value&&e.value.stack;if(!n)return!0;for(let e of n)if(!s(e,r))return!1;return!0};return s(n,0)}(r)?{isError:!0,regExp:null}:{isError:!1,regExp:r}}catch{return{isError:!0,regExp:null}}}let lL=Object.values(k.DataStreamTreeTokenType).filter(e=>[(0,k.DataStreamTreeTokenType).TABLE_START,(0,k.DataStreamTreeTokenType).TABLE_ROW_START,(0,k.DataStreamTreeTokenType).TABLE_CELL_START,(0,k.DataStreamTreeTokenType).TABLE_CELL_END,(0,k.DataStreamTreeTokenType).TABLE_ROW_END,(0,k.DataStreamTreeTokenType).TABLE_END,(0,k.DataStreamTreeTokenType).CUSTOM_BLOCK].includes(e)),lP=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString(),r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);12288===n?n=32:n>=65281&&n<=65374&&(n-=65248),r+=String.fromCharCode(n)}return nP.create(r)}},iG.ASC],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(0);if(null!=t&&t.isNull()&&(r=nV.create(0)),r.isArray()){let t=r.mapValue(t=>this._handleSingleObject(e,t));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){let r=this._checkArray(e);if(r.isError())return r;let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,c="";for(let t=0;t<l;t++)for(let r=0;r<u;r++){let n=e.isArray()?e.get(t,r):e,i=`${n.getValue()}`;n.isNull()&&(i=""),n.isBoolean()&&(i=i.toLocaleUpperCase()),n.isString()&&o?c+=`"${i}"`:c+=i,t===l-1&&r===u-1||(o?r===u-1?c+=";":c+=",":c+=", ")}return o&&(c=`{${c}}`),c.length>32767?t2.create(X.CALC):nP.create(c)}_checkArray(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}},iG.ARRAYTOTEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.abs(Number.parseInt(s.toString(),10)),o=Number.parseFloat((Math.abs(s)-a).toFixed(2)),l="";return l=0===a?0!==o?`${s<0?"":""}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`:"":0===o?`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}\u{E16}\u{E49}\u{E27}\u{E19}`:`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`,nP.create(l)}_convertNumberToThaiText(e){let t=["","","","","","",""],r=["","","","","","","","","",""],n=e.toString(),i=n.length,s="";for(let e=i;e>0;e--){let a=Number.parseInt(n.charAt(i-e),10),o=r[a],l=e>1?(e-1)%6:6;if(1===l&&2===a&&(o=""),1===a)switch(l){case 0:case 6:s+=e<i?"":o;break;case 1:break;default:s+=o}else if(0===a){0===l&&(s+=t[l]);continue}else s+=o;s+=t[l]}return s}},iG.BAHTTEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<=0)return t2.create(X.VALUE);let a=String.fromCharCode(s);return lC.some(e=>e===a)&&(a="\x01"),nP.create(a)}},iG.CHAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return nP.create("");let t=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return nP.create(t)}},iG.CLEAN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),""===t)return t2.create(X.VALUE);let r=t.charCodeAt(0);return nV.create(r)}},iG.CODE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t="",r=null;for(let n of e)if(n.isArray()){if(n.iterator(e=>!!(null==e||e.isNull())||(e.isError()?(r=e,!1):void(e.isBoolean()?t+=`${e.getValue()}`.toLocaleUpperCase():(e.isString()||e.isNumber())&&(t+=e.getValue())))),r)return r}else n.isError()||n.isNull()||(t+=n.getValue());return nP.create(t)}},iG.CONCAT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(e=>{e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1))});let n=null;for(let i of e)n=nQ(t,r,i,t2.create(X.NA)).mapValue((e,t,r)=>{let i=n&&n.get(t,r);if(null!=i&&i.isError())return i;if(e.isError())return e;let s=null==i?void 0:i.getValue(),a=null==e?void 0:e.getValue();null!=i&&i.isBoolean()&&(s=`${s}`.toLocaleUpperCase()),null!=e&&e.isBoolean()&&(a=`${a}`.toLocaleUpperCase());let o=null!=i&&i.isNull()?"":null!=s?s:"",l=null!=e&&e.isNull()?"":null!=a?a:"";return nP.create(`${o}${l}`)});return n||t2.create(X.VALUE)}},iG.CONCATENATE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nP.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);n>=33&&n<=126?r+=String.fromCharCode(n+65248):32===n?r+="":r+=t.charAt(e)}return nP.create(r)}},iG.DBCS],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2),G(this,"needsLocale",!0)}calculate(e,t){let r=null!=t?t:nV.create(2);r.isNull()&&(r=nV.create(2));let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.trunc(+a.getValue());if(l>127)return t2.create(X.VALUE);l<0&&(o=`${o}`.length<Math.abs(l)?0:o<0?-nI(Math.abs(o),l):nI(o,l),l=0);let u=function(e,t,r=2){return(0,k.numfmt).format(tK(e,r),t)}(this.getLocale(),o,l);return nP.create(u)}},iG.DOLLAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,nx.create()),s=nQ(r,n,t,nx.create()),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){let r=e.isNull()&&t.isNull();return nD.create(r)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());let i=r===n;return nD.create(i)}},iG.EXACT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return t2.create(X.VALUE);if(e.isNull()||0===n.length)return nV.create(u);let c=i.indexOf(n,u-1);return -1===c?t2.create(X.VALUE):nV.create(c+1)}},iG.FIND],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return t2.create(X.VALUE);if(e.isNull()||0===n.length)return nV.create(u);let c=i.indexOf(n,u-1);if(-1===c)return t2.create(X.VALUE);let h=lE(i.substring(0,c))+1;return nV.create(h)}},iG.FINDB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nV.create(2);n.isNull()&&(n=nV.create(2));let i=null!=r?r:nD.create(!1);i.isNull()&&(i=nD.create(!1));let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=nQ(s,a,e,t2.create(X.NA)),l=nQ(s,a,n,t2.create(X.NA)),u=nQ(s,a,i,t2.create(X.NA)),c=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===s&&1===a?c.get(0,0):c}_handleSingleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.trunc(+o.getValue()),h=+l.getValue();if(c>127)return t2.create(X.VALUE);c<0&&(u=`${u}`.length<Math.abs(c)?0:u<0?-nI(Math.abs(u),c):nI(u,c),c=0);let d=h?"###0":"#,##0";c>0&&(d+=`.${"0".repeat(c)}`);let m=l_(d,u);return nP.create(m)}},iG.FIXED],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return t2.create(X.VALUE);if(e.isNull()||0===o)return nP.create("");if(o>=r.length)return nP.create(r);let l=r.substring(0,o);return nP.create(l)}},iG.LEFT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,nx.create()),a=nQ(n,i,r,nx.create()),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return t2.create(X.VALUE);if(e.isNull()||0===o)return nP.create("");let l=0,u=0,c="";for(;u<o&&l<r.length;)u+=lb(r,l),c+=r.charAt(l),l++;return nP.create(c)}},iG.LEFTB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=ly(e);return nV.create(t.length)}},iG.LEN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=lE(ly(e));return nV.create(t)}},iG.LENB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nP.create("");let t=`${e.getValue()}`.toLocaleLowerCase();return nP.create(t)}},iG.LOWER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return t2.create(X.VALUE);if(e.isNull()||u>n.length||0===c)return nP.create("");let h=n.substring(u-1,u-1+c);return nP.create(h)}},iG.MID],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,t,t2.create(X.NA)),o=nQ(n,i,r,t2.create(X.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return t2.create(X.VALUE);if(e.isNull()||u>n.length||0===c)return nP.create("");n=n.substring(u-1);let h=0,d=0,m="";for(;d<c&&h<n.length;)d+=lb(n,h),m+=n.charAt(h),h++;return nP.create(m)}},iG.MIDB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nP.create("."),i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,n,t2.create(X.NA)),l=r?nQ(i,s,r,t2.create(X.NA)):void 0,u=a.mapValue((e,t,n)=>{let i=o.get(t,n),s=r?l.get(t,n):void 0;return e.isError()?e:i.isError()?i:null!=s&&s.isError()?s:i.isNull()||null!=s&&s.isNull()?t2.create(X.VALUE):e.isNull()?nV.create(0):this._handleSingleObject(e,i,s)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n,i=`${e.getValue()}`;i=i.replace(/\s+/g,"");let s=`${t.getValue()}`;if(t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0),r&&(n=`${r.getValue()}`,r.isBoolean()&&(n=n.toLocaleUpperCase()),s===(n=n.charAt(0))))return t2.create(X.VALUE);if(""===i.trim())return nV.create(0);if(!i.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return t2.create(X.VALUE);let a=i.split(s);if(a.length>2)return t2.create(X.VALUE);let o=a[0].replace(/,/g,"");r&&(o=o.split(n).join(""));let l=0;if(1===a.length){","===s&&(o=o.replace(/\./g,""));let e=0;for(;o.endsWith("%");)o=o.slice(0,-1),e++;l=e>0?+o/100**e:+o}else{if(!(0,k.isRealNum)(o))return t2.create(X.VALUE);let e=a[1],t=0;for(;e.endsWith("%");)e=e.slice(0,-1),t++;let r=`${o}.${e}`;if(!(0,k.isRealNum)(r))return t2.create(X.VALUE);l=t>0?+r/100**t:+r}return Number.isNaN(l)?t2.create(X.VALUE):nV.create(l)}},iG.NUMBERVALUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lV(l=`${l}`,!1);if(u)return t2.create(X.REF);let h=o.match(c);if(null===h)return t2.create(X.NA);if(h.length>1){let e=h.slice(1).map(e=>nP.create(e));return e.length>1?nB.create({calculateValueList:[e],rowCount:1,columnCount:e.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):e[0]}return nP.create(h[0])}},iG.REGEXEXTRACT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lV(l=`${l}`,!1);return u?t2.create(X.REF):null===o.match(c)?nD.create(!1):nD.create(!0)}},iG.REGEXMATCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sW(e,t,r);if(n)return i;let[a,o,l]=s,u=a.getValue();a.isNull()&&(u=""),a.isBoolean()&&(u=u?"TRUE":"FALSE"),u=`${u}`;let c=o.getValue();o.isNull()&&(c=""),o.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let h=l.getValue();l.isNull()&&(h=""),l.isBoolean()&&(h=h?"TRUE":"FALSE"),h=`${h}`;let{isError:d,regExp:m}=lV(c,!0);if(d)return t2.create(X.REF);let g=u.replace(m,h);return nP.create(g)}},iG.REGEXREPLACE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,e=>e.toLocaleUpperCase());return nP.create(t)}},iG.PROPER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return t2.create(X.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1)+d+h.substring(u-1+c);return nP.create(m)}},iG.REPLACE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",4),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=nQ(i,s,n,t2.create(X.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return t2.create(X.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1);h=h.substring(u-1);let g=0,f=0;for(;f<c&&g<h.length;)f+=lb(h,g),g++;return m+=d+h.substring(g),nP.create(m)}},iG.REPLACEB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e,t2.create(X.NA)),s=nQ(r,n,t,t2.create(X.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;let i=e.getValue();if(e.isNull()&&(i=""),e.isBoolean()&&(i=i?"TRUE":"FALSE"),i+="",n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=Math.floor(+n.getValue());if(a<0||a>32767/i.length)return t2.create(X.VALUE);let o=i.repeat(a);return nP.create(o)});return 1===r&&1===n?a.get(0,0):a}},iG.REPT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return t2.create(X.VALUE);if(e.isNull()||0===o)return nP.create("");if(o>=r.length)return nP.create(r);let l=r.substring(r.length-o);return nP.create(l)}},iG.RIGHT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return t2.create(X.VALUE);if(e.isNull()||0===o)return nP.create("");let l=r.length-1,u=0,c="";for(;u<o&&l>=0;)u+=lb(r,l,"rtl"),c=r.charAt(l)+c,l--;return nP.create(c)}},iG.RIGHTB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return t2.create(X.VALUE);if(e.isNull()||0===n.length)return nV.create(u);let c=i.indexOf(n,u-1);return -1===c?t2.create(X.VALUE):nV.create(c+1)}},iG.SEARCH],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nV.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,n,t2.create(X.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return t2.create(X.VALUE);if(e.isNull()||0===n.length)return nV.create(u);let c=i.indexOf(n,u-1);if(-1===c)return t2.create(X.VALUE);let h=lE(i.substring(0,c))+1;return nV.create(h)}},iG.SEARCHB],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,null!=n&&n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,null!=n&&n.isArray()?n.getColumnCount():1),a=nQ(i,s,e,t2.create(X.NA)),o=nQ(i,s,t,t2.create(X.NA)),l=nQ(i,s,r,t2.create(X.NA)),u=n?nQ(i,s,n,t2.create(X.NA)):void 0,c=a.mapValue((e,t,r)=>{let i=o.get(t,r),s=l.get(t,r),a=n?u.get(t,r):void 0;return e.isError()?e:i.isError()?i:s.isError()?s:null!=a&&a.isError()?a:null!=a&&a.isNull()||null!=a&&a.isBoolean()?t2.create(X.VALUE):(null!=a&&a.isString()&&(a=a.convertToNumberObjectValue()),null!=a&&a.isError()?a:this._handleSingleObject(e,i,s,a))});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let i=this._getObjectString(e),s=this._getObjectString(t),a=this._getObjectString(r),o=n?Math.floor(+n.getValue()):void 0;if(n&&o<=0)return t2.create(X.VALUE);if(""===s)return nP.create(i);let l="",u=0;for(let e=0;e<i.length;e++){let t=i.substr(e,s.length);if(t===s||t.length===s.length&&t.trim()===s.trim()){if(++u===o){l=i.substr(0,e)+a+i.substr(e+s.length);break}void 0===o&&(l+=a),e+=s.length-1}else void 0===o&&(l+=i[e])}return o&&u<o&&(l=i),nP.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}},iG.SUBSTITUTE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){let t=e;return e.isArray()&&(t=e.get(0,0)),t.isError()?t:t.isNull()||t.isBoolean()||t.isNumber()?nP.create(""):t}},iG.T],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=nQ(r,n,e),s=nQ(r,n,t);return i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r)||nP.create(" ");if(n.isError())return n;if(n.isBoolean())return t2.create(X.VALUE);if(e.isBoolean())return e;let i=e.getValue();if(e.isNull()&&(i=0),e.isString()){if(!(0,k.isRealNum)(i))return e;i=Number(i)}n.isNull()&&(n=nP.create(" "));let a=`${n.getValue()}`,o=l_(a,i);return nP.create(" "===a?o.trimEnd():o)})}},iG.TEXT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nV.create(1);o.isNull()&&(a=!0,o=nV.create(1));let l=null!=n?n:nV.create(0),u=null!=i?i:nV.create(0),c=null!=s?s:t2.create(X.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=nQ(h,d,e,t2.create(X.NA)),g=nQ(h,d,o,t2.create(X.NA)),f=nQ(h,d,l,t2.create(X.NA)),p=nQ(h,d,u,t2.create(X.NA)),C=nQ(h,d,c,t2.create(X.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof t2)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof t2)return C;let[_,y,E]=C;return 0===_||y<0||y>1||E<0||E>1?t2.create(X.VALUE):p.includes("")?_>0?nP.create(f):nP.create(""):!a&&Math.abs(_)>f.length?t2.create(X.VALUE):p.every(e=>e.length>f.length)?t2.create(X.NA):this._getResult(f,p,_,y,E,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nD.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),h=e.length,c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return t2.create(X.NA);if(!c||c<Math.abs(r))return i?r>0?nP.create(""):nP.create(e):s;let d=e.substr(u+h);return nP.create(d)}},iG.TEXTAFTER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nV.create(1);o.isNull()&&(a=!0,o=nV.create(1));let l=null!=n?n:nV.create(0),u=null!=i?i:nV.create(0),c=null!=s?s:t2.create(X.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=nQ(h,d,e,t2.create(X.NA)),g=nQ(h,d,o,t2.create(X.NA)),f=nQ(h,d,l,t2.create(X.NA)),p=nQ(h,d,u,t2.create(X.NA)),C=nQ(h,d,c,t2.create(X.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof t2)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof t2)return C;let[_,y,E]=C;return 0===_||y<0||y>1||E<0||E>1?t2.create(X.VALUE):p.includes("")?_>0?nP.create(""):nP.create(f):!a&&Math.abs(_)>f.length?t2.create(X.VALUE):p.every(e=>e.length>f.length)?t2.create(X.NA):this._getResult(f,p,_,y,E,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nD.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=t2.create(X.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return t2.create(X.NA);if(!c||c<Math.abs(r))return i?r>0?nP.create(e):nP.create(""):s;let d=e.substr(0,u);return nP.create(d)}},iG.TEXTBEFORE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",3),G(this,"maxParams",255)}calculate(e,t,...r){let n=this._getDelimiterValues(e),i=this._getTextValues(r);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(n,e,i));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}if(t.isString()){let e=`${t.getValue()}`.toLocaleUpperCase();if("TRUE"===e)return this._handleSingleObject(n,nD.create(!0),i);if("FALSE"===e)return this._handleSingleObject(n,nD.create(!1),i)}return this._handleSingleObject(n,t,i)}_handleSingleObject(e,t,r){if(e instanceof t2)return e;let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;if(r instanceof t2)return r;let[a]=s,o=+a.getValue(),l=r;o&&(l=r.filter(e=>null!==e));let u="";for(let t=0;t<l.length;t++)null!==l[t]&&(u+=l[t]),t<l.length-1&&(u+=e[t%e.length]);return nP.create(u)}_getDelimiterValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;let s=`${n.getValue()}`;n.isNull()&&(s=""),n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}return t}_getTextValues(e){let t=[];for(let r of e){let e=r.isArray()?r.getRowCount():1,n=r.isArray()?r.getColumnCount():1;for(let i=0;i<e;i++)for(let e=0;e<n;e++){let n=r.isArray()?r.get(i,e):r;if(n.isError())return n;if(n.isNull()){t.push(null);continue}let s=`${n.getValue()}`;n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}}return t}},iG.TEXTJOIN],[class extends sq{constructor(){super(...arguments),G(this,"minParams",2),G(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=r?r:nP.create("\\s"),o=null!=n?n:nV.create(0),l=null!=i?i:nV.create(0),u=null!=s?s:nP.create(X.NA),{_variant:c,values:h}=this._getStringValues(t),{_variant:d,values:m}=this._getStringValues(a,!1);a=d;let g=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),p=nQ(g,f,e,t2.create(X.NA)),C=nQ(g,f,o,t2.create(X.NA)),_=nQ(g,f,l,t2.create(X.NA)),y=this._getResultArray(p,c,a,C,_,u,h,m);return 1===g&&1===f?y.get(0,0):y.map(e=>e.get(0,0))}_getStringValues(e,t=!0){let r=e,n=[];if(r.isArray())r.iterator(e=>{if(null!=e&&e.isError())return r=e,!1;if(null!=e&&e.isNull()&&t)return r=t2.create(X.VALUE),!1;let i=this._getRegExpStringValue(e);if(""===i)return r=t2.create(X.VALUE),!1;n.push(i)});else{r.isNull()&&t&&(r=t2.create(X.VALUE));let e=this._getRegExpStringValue(r);""===e&&(r=t2.create(X.VALUE)),n.push(e)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=n.get(l,u),h=i.get(l,u),d=this._checkVariantsError(e,t,r,c,h);if(d.isError())return d;if(e.isNull())return t2.create(X.VALUE);let m=s;if(m.isArray()){let e=m.getRowCount(),t=m.getColumnCount();if(e>1||t>1)return t2.create(X.VALUE);m=m.get(0,0)}let g=`${e.getValue()}`;if(e.isBoolean()&&(g=g.toLocaleUpperCase()),c.isString()&&(c=c.convertToNumberObjectValue()).isError())return c;let f=Math.floor(+c.getValue());if(h.isString()&&(h=h.convertToNumberObjectValue()).isError())return h;let p=Math.floor(+h.getValue());if(p<0||p>1)return t2.create(X.VALUE);let C=`${m.getValue()}`;return m.isBoolean()&&(C=C.toLocaleUpperCase()),this._getResult(g,a,o,f,p,C)})}_getResult(e,t,r,n,i,s){let a=RegExp(r.join("|"),`g${i?"i":""}`),o=RegExp(t.join("|"),`g${i?"i":""}`),l=e.split(a),u=1,c=l.map(e=>{let t=e.split(o);return n&&(t=t.filter(e=>""!==e)),u=Math.max(u,t.length),t});return c=c.map(e=>{let t=e;return t.length<u&&(t=t.concat(Array(u-t.length).fill(s))),t}),nB.createByArray(c)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nD.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},iG.TEXTSPLIT],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nP.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),nP.create(t)}},iG.TRIM],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<1||s>1114111)return t2.create(X.VALUE);if(1114111===s||1114110===s)return t2.create(X.NA);let a=String.fromCharCode(s);return lL.some(e=>e===a)&&(a="\x01"),nP.create(a)}},iG.UNICHAR],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return t2.create(X.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());let r=t.charCodeAt(0);return nV.create(r)}},iG.UNICODE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nP.create("");let t=`${e.getValue()}`.toLocaleUpperCase();return nP.create(t)}},iG.UPPER],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return t2.create(X.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()).isError())return t;let r=+t.getValue();return nV.create(r)}},iG.VALUE],[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nV.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nQ(n,i,e,t2.create(X.NA)),a=nQ(n,i,r,t2.create(X.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>1)return t2.create(X.VALUE);if(e.isNull())return nP.create("");if(e.isBoolean())return e;if(e.isNumber())return nV.create(e.getValue());let o=a?`"${e.getValue()}"`:`${e.getValue()}`;return nP.create(o)}},iG.VALUETOTEXT]],lj=[];var lF=((P=lF||{}).ENCODEURL="ENCODEURL",P.FILTERXML="FILTERXML",P.WEBSERVICE="WEBSERVICE",P);let lk=[[class extends sq{constructor(){super(...arguments),G(this,"minParams",1),G(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=encodeURIComponent(ly(e)).replace(/[!~'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return nP.create(t)}},lF.ENCODEURL]];var lB=Object.defineProperty,l$=Object.getOwnPropertyDescriptor,lH=(e,t)=>(r,n)=>t(r,n,e);let lW=class extends k.Disposable{constructor(e,t,r,n){super(),this._commandService=e,this._functionService=t,this._configService=r,this._dataSyncPrimaryController=n,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[tr,eD,e7,e8,te,tt,e3,e4,e6,e9,tn,ti,ts,ta,to,eU].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)})}_registerFunctions(){var e;let t=this._configService.getConfig(tM),r=[...sK,...oa,...oo,...of,...oB,...oW,...le,...lr,...ls,...lo,...lc,...ld,...lp,...lP,...lj,...lk].concat(null!=(e=null==t?void 0:t.function)?e:[]).map(e=>new e[0](e[1]));this._functionService.registerExecutors(...r)}};lW=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&lB(t,r,s),s})([lH(0,k.ICommandService),lH(1,im),lH(2,k.IConfigService),lH(3,(0,k.Optional)($.DataSyncPrimaryController))],lW);var lG=Object.defineProperty,lY=Object.getOwnPropertyDescriptor,lz=(e,t)=>(r,n)=>t(r,n,e);let lq=class extends k.Disposable{constructor(e,t,r){super(),this._commandService=e,this._dependencyManagerService=t,this._featureCalculationManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(e=>{let{unitId:t,subUnitId:r,featureIds:n}=e;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,n)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===e9.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._dependencyManagerService.removeFeatureFormulaDependency(n,i,r)}else if(e.id===e6.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._dependencyManagerService.removeFeatureFormulaDependency(i,s,[r])}else if(e.id===ti.id){let t=e.params;if(null==t)return;this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,t.formulaIdList)}else if(e.id===tn.id){let t=e.params;if(null==t)return;let r=t.formulaMap,n=[];Object.keys(r).forEach(e=>{n.push(e)}),this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,n)}else if(e.id===tr.id){let t=e.params.formulaData;Object.keys(t).forEach(e=>{let r=t[e];if(void 0!==r){if(null===r){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(r).forEach(t=>{let n=r[t];if(void 0!==n){if(null===n)return this._dependencyManagerService.clearFormulaDependency(e,t),!0;new(0,k.ObjectMatrix)(n).forValue((r,n)=>{this._dependencyManagerService.removeFormulaDependency(e,t,r,n)})}})}})}else e.id===e3.id&&this._handleSetDefinedName(e)}))}_handleSetDefinedName(e){let t=e.params;if(null==t)return;let{unitId:r,name:n}=t;this._dependencyManagerService.removeFormulaDependencyByDefinedName(r,n)}};lq=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?lY(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&lG(t,r,s),s})([lz(0,k.ICommandService),lz(1,sc),lz(1,sl),lz(2,sc)],lq);var lX=Object.defineProperty,lK=Object.getOwnPropertyDescriptor,lQ=(e,t)=>(r,n)=>t(r,n,e);let lZ=class extends k.Disposable{constructor(e,t){super(),this._commandService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===e6.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._featureCalculationManagerService.register(i,s,r,n)}else if(e.id===e9.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._featureCalculationManagerService.remove(n,i,r)}}))}};lZ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?lK(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&lX(t,r,s),s})([lQ(0,k.ICommandService),lQ(1,sc)],lZ);var lJ=Object.defineProperty,l0=Object.getOwnPropertyDescriptor,l1=(e,t)=>(r,n)=>t(r,n,e);let l2=class extends k.Disposable{constructor(e,t,r){super(),this._commandService=e,this._otherFormulaManagerService=t,this._dependencyManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tn.id){let t=e.params;if(null==t)return;let r={[t.unitId]:{[t.subUnitId]:t.formulaMap}};this._otherFormulaManagerService.batchRegister(r)}else if(e.id===ti.id){let t=e.params;if(null==t)return;let r={};t.formulaIdList.forEach(e=>r[e]=!0);let n={[t.unitId]:{[t.subUnitId]:r}};this._otherFormulaManagerService.batchRemove(n)}}))}};l2=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&lJ(t,r,s),s})([l1(0,k.ICommandService),l1(1,sd),l1(2,sl)],l2);class l5 extends k.Disposable{constructor(){super(...arguments),G(this,"_tableMap",/* @__PURE__ */new Map),G(this,"_tableOptionMap",/* @__PURE__ */new Map)}dispose(){this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;null==(r=this._tableMap.get(e))||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;null==this._tableMap.get(e)&&this._tableMap.set(e,/* @__PURE__ */new Map),null==(n=this._tableMap.get(e))||n.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}}let l3=(0,k.createIdentifier)("univer.formula.super-table.service");var l4=Object.defineProperty,l6=Object.getOwnPropertyDescriptor,l9=(e,t)=>(r,n)=>t(r,n,e);let l7=class extends k.Disposable{constructor(e,t){super(),this._commandService=e,this._superTableService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===e3.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n,reference:i}=t;this._superTableService.registerTable(r,n,i)}else if(e.id===e4.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n}=t;this._superTableService.remove(r,n)}else if(e.id===to.id){let t=e.params;if(null==t)return;let{tableOption:r,tableOptionType:n}=t;this._superTableService.registerTableOptionMap(r,n)}}))}};l7=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l6(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&l4(t,r,s),s})([l9(0,k.ICommandService),l9(1,l3)],l7);class l8 extends k.Disposable{constructor(){super(...arguments),G(this,"_dirtyConversionMap",/* @__PURE__ */new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}let ue=(0,k.createIdentifier)("univer.formula.active-dirty-manager.service");var ut=Object.defineProperty,ur=Object.getOwnPropertyDescriptor,un=(e,t)=>(r,n)=>t(r,n,e);let ui=(G(F=class extends k.Plugin{constructor(e=tw,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=this._config;this._configService.setConfig(tM,n)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var e;(0,k.touchDependencies)(this._injector,[[lW],[sj],[l7]]),null!=(e=this._config)&&e.notExecuteFormula||(0,k.touchDependencies)(this._injector,[[l2],[lZ],[lq],[sD]])}onRendered(){var e;null!=(e=this._config)&&e.notExecuteFormula||(0,k.touchDependencies)(this._injector,[[sO],[sI]])}_initialize(){var e;let t=[[im,{useClass:ig}],[e2,{useClass:e1}],[ue,{useClass:l8}],[l3,{useClass:l5}],[tI],[tE],[lW],[sj],[l7]];null!=(e=this._config)&&e.notExecuteFormula||t.push([sd,{useClass:sh}],[is,{useClass:ii}],[tL,{useClass:tV}],[sc,{useClass:su}],[sD],[l2],[lq],[lZ],[iw],[ss],[tk],[id],[iT],[ik],[i$],[iX],[ib],[i0],[i4],[i8],[st]),t.forEach(e=>this._injector.add(e))}_initializeWithOverride(){var e;null!=(e=this._config)&&e.notExecuteFormula||[[sO,{useClass:sM}],[sl,{useClass:so}],[sI,{useClass:sA}]].forEach(e=>this._injector.add(e))}},"pluginName","UNIVER_ENGINE_FORMULA_PLUGIN"),F);ui=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ur(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&ut(t,r,s),s})([un(1,(0,k.Inject)(k.Injector)),un(2,k.IConfigService)],ui);var us=Object.defineProperty,ua=Object.getOwnPropertyDescriptor,uo=(e,t)=>(r,n)=>t(r,n,e);let ul=class extends k.FBase{constructor(e,t){super(),this._commandService=e,this._injector=t}executeCalculation(){this._commandService.executeCommand(e7.id,{commands:[],forceCalculation:!0},{onlyLocal:!0})}stopCalculation(){this._commandService.executeCommand(e8.id,{})}calculationStart(e){return this._commandService.onCommandExecuted(t=>{t.id===e7.id&&e(t.params.forceCalculation)})}calculationEnd(e){return this._commandService.onCommandExecuted(t=>{if(t.id!==te.id)return;let r=t.params;void 0!==r.functionsExecutedState&&e(r.functionsExecutedState)})}onCalculationEnd(){return new Promise((e,t)=>{let r=setTimeout(()=>{t(Error("Calculation end timeout"))},3e4),n=this.calculationEnd(()=>{clearTimeout(r),n.dispose(),e()})})}calculationProcessing(e){return this._commandService.onCommandExecuted(t=>{if(t.id!==te.id)return;let r=t.params;void 0!==r.stageInfo&&e(r.stageInfo)})}};ul=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ua(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&us(t,r,s),s})([uo(0,(0,k.Inject)(k.ICommandService)),uo(1,(0,k.Inject)(k.Injector))],ul)}),s("k2g5B",function(t,r){e(t.exports,"fromModule",function(){return M}),e(t.exports,"toModule",function(){return w}),e(t.exports,"IRPCChannelService",function(){return D}),e(t.exports,"DataSyncPrimaryController",function(){return F}),e(t.exports,"UniverRPCMainThreadPlugin",function(){return X});var n,s=i("7yNYd"),a=i("lMvMU"),o=i("9z4na"),l=i("2jrJe"),u=i("5LPkb"),c=i("dBx9C"),h=i("hRiv7"),d=i("1O3Nt"),m=i("3yupB"),g=i("c3hg1"),f=Object.defineProperty,p=(e,t,r)=>t in e?f(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,C=(e,t,r)=>p(e,"symbol"!=typeof t?t+"":t,r);let _={},y={};var E=Object.defineProperty,b=Object.getOwnPropertyDescriptor,R=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?b(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&E(t,r,s),s},N=(e,t)=>(r,n)=>t(r,n,e);let I="rpc.remote-sync.service",A=(0,s.createIdentifier)(I),v=class{constructor(e){this._commandService=e}async syncMutation(e){return this._commandService.syncExecuteCommand(e.mutationInfo.id,e.mutationInfo.params,{onlyLocal:!0,fromSync:!0})}};v=R([N(0,s.ICommandService)],v);let S="univer.remote-instance-service",T=(0,s.createIdentifier)(S),O=class{constructor(e,t,r){this._univerInstanceService=e,this._commandService=t,this._logService=r}whenReady(){return Promise.resolve(!0)}async syncMutation(e){return this._applyMutation(e.mutationInfo)}async createInstance(e){let{type:t,snapshot:r}=e;try{if(t===s.UniverInstanceType.UNIVER_SHEET)return this._univerInstanceService.createUnit(s.UniverInstanceType.UNIVER_SHEET,r),!0;throw Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${t}.`)}catch(e){throw e instanceof Error?e:TypeError(`${e}`)}}async disposeInstance(e){return this._univerInstanceService.disposeUnit(e.unitID)}_applyMutation(e){let{id:t,params:r}=e;return this._commandService.syncExecuteCommand(t,r,{onlyLocal:!0,fromSync:!0})}};function M(e){return new class{call(t,r){let n=e[t];if("function"==typeof n){let t=n.apply(e,[r]);return t instanceof Promise||(t=Promise.resolve(t)),t}throw Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){let n=e[t];if("function"==typeof n){let t=n.apply(e,r);return(0,h.isObservable)(t)?t:(0,m.of)(t)}throw Error(`[RPC]: observable method not found for ${t}!`)}}}function w(e){return new Proxy({},{get(t,r){if("dispose"!==r)return function(...t){return r.endsWith("$")?e.subscribe(r,t[0]):e.call(r,t[0])}}})}O=R([N(0,s.IUniverInstanceService),N(1,s.ICommandService),N(2,s.ILogService)],O);class x extends s.RxDisposable{constructor(e){super(),C(this,"_initialized",new u.BehaviorSubject(!1)),C(this,"_lastRequestCounter",0),C(this,"_pendingRequests",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onMessage(e))}dispose(){this._pendingRequests.clear()}getChannel(e){let t=this;return{call:(r,n)=>t._disposed?Promise.reject():t._remoteCall(e,r,n),subscribe(r,n){if(t._disposed)throw Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,n)}}}_whenReady(){return(0,c.firstValueFrom)(this._initialized.pipe((0,a.filter)(e=>e),(0,o.take)(1)))}async _remoteCall(e,t,r){await this._whenReady();let n=++this._lastRequestCounter,i={seq:n,type:100,channelName:e,method:t,args:r},s=this;return new Promise((e,t)=>{this._pendingRequests.set(n,{handle(r){switch(r.type){case 201:s._pendingRequests.delete(n),e(r.data);break;case 202:s._pendingRequests.delete(n),t(r.data);break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(i)})}_remoteSubscribe(e,t,r){return new d.Observable(n=>{let i=-1;return this._whenReady().then(()=>{let s={seq:i=++this._lastRequestCounter,type:101,channelName:e,method:t,args:r};this._pendingRequests.set(i,{handle(e){switch(e.type){case 300:n.next(e.data);break;case 301:n.error(e.data);break;case 302:n.complete();break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(s)}),()=>{if(-1===i)return;let r={type:102,seq:i,channelName:e,method:t};this._sendRequest(r)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;switch(e.type){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:null==(t=this._pendingRequests.get(e.seq))||t.handle(e)}}}class U extends s.RxDisposable{constructor(e){super(),C(this,"_channels",/* @__PURE__ */new Map),C(this,"_subscriptions",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onRequest(e)),this._sendResponse({seq:-1,type:0})}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e)}}_onMethodCall(e){let t;let{channelName:r,method:n,args:i}=e,s=this._channels.get(r);try{if(!s)throw Error(`[ChannelServer]: Channel ${r} not found!`);t=s.call(n,i)}catch(e){t=Promise.reject(e)}t.then(t=>{this._sendResponse({seq:e.seq,type:201,data:t})}).catch(t=>{t instanceof Error?this._sendResponse({seq:e.seq,type:202,data:t.message}):this._sendResponse({seq:e.seq,type:202,data:String(t)})})}_onSubscribe(e){let{channelName:t,seq:r}=e,n=this._channels.get(t);try{if(!n)throw Error(`[ChannelServer]: Channel ${t} not found!`);let i=n.subscribe(e.method,e.args).subscribe({next:e=>{this._sendResponse({seq:r,type:300,data:e})},error:e=>{this._sendResponse({seq:r,type:301,data:e.message}),this._sendResponse({seq:r,type:302})},complete:()=>{this._sendResponse({seq:r,type:302})}});this._subscriptions.set(e.seq,i)}catch(t){t instanceof Error?this._sendResponse({seq:e.seq,type:301,data:t.message}):this._sendResponse({seq:e.seq,type:301,data:String(t)})}}_onUnsubscribe(e){let t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}}let D=(0,s.createIdentifier)("IRPCChannelService");class V{constructor(e){C(this,"_client"),C(this,"_server"),this._client=new x(e),this._server=new U(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}}var L=Object.defineProperty,P=Object.getOwnPropertyDescriptor,j=(e,t)=>(r,n)=>t(r,n,e);let F=class extends s.RxDisposable{constructor(e,t,r,n,i){super(),C(this,"_remoteInstanceService"),C(this,"_syncingUnits",/* @__PURE__ */new Set),C(this,"_syncingMutations",/* @__PURE__ */new Set),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._rpcChannelService=n,this._remoteSyncService=i,this._initRPCChannels(),this._init()}registerSyncingMutations(e){this._syncingMutations.add(e.id)}syncUnit(e){return this._syncingUnits.add(e),(0,s.toDisposable)(()=>this._syncingUnits.delete(e))}_initRPCChannels(){this._rpcChannelService.registerChannel(I,M(this._remoteSyncService)),this._injector.add([T,{useFactory:()=>w(this._rpcChannelService.requestChannel(S))}]),this._remoteInstanceService=this._injector.get(T)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(s.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.add(e.getUnitId()),this._remoteInstanceService.createInstance({unitID:e.getUnitId(),type:s.UniverInstanceType.UNIVER_SHEET,snapshot:e.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(s.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.delete(e.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:e.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{let{type:r,params:n,id:i}=e,a=(null==n?void 0:n.unitId)||"";r===s.CommandType.MUTATION&&(!a||this._syncingUnits.has(a))&&!(null!=t&&t.fromSync)&&this._syncingMutations.has(i)&&this._remoteInstanceService.syncMutation({mutationInfo:e})}))}};F=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?P(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&L(t,r,s),s})([j(0,(0,s.Inject)(s.Injector)),j(1,s.ICommandService),j(2,s.IUniverInstanceService),j(3,D),j(4,A)],F);var k=Object.defineProperty,B=Object.getOwnPropertyDescriptor,$=(e,t)=>(r,n)=>t(r,n,e);let H=class extends s.Disposable{constructor(e,t,r,n){super(),C(this,"_remoteSyncService"),this._injector=e,this._remoteInstanceService=t,this._commandService=r,this._rpcChannelService=n,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(S,M(this._remoteInstanceService)),this._injector.add([A,{useFactory:()=>w(this._rpcChannelService.requestChannel(I))}]),this._remoteSyncService=this._injector.get(A)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{e.type!==s.CommandType.MUTATION||null!=t&&t.fromSync||this._remoteSyncService.syncMutation({mutationInfo:e})}))}};H=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?B(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&k(t,r,s),s})([$(0,(0,s.Inject)(s.Injector)),$(1,T),$(2,s.ICommandService),$(3,D)],H);var W,G=Object.defineProperty,Y=Object.getOwnPropertyDescriptor,z=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?Y(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=(n?i(t,r,s):i(s))||s);return n&&s&&G(t,r,s),s},q=(e,t)=>(r,n)=>t(r,n,e);let X=(W=class extends s.Plugin{constructor(e=_,t,r){super(),C(this,"_internalWorker",null),this._config=e,this._injector=t,this._configService=r;let{...n}=this._config;this._configService.setConfig("rpc.main-thread.config",n)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){let{workerURL:e}=this._config;if(!e)throw Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");let t=e instanceof Worker?e:new Worker(e);this._internalWorker=e instanceof Worker?null:t;let r={send(e){t.postMessage(e)},onMessage:new(0,d.Observable)(e=>{let r=t=>{e.next(t.data)};return t.addEventListener("message",r),()=>t.removeEventListener("message",r)}).pipe((0,g.shareReplay)(1))};[[D,{useFactory:()=>new V(r)}],[F],[A,{useClass:v}]].forEach(e=>this._injector.add(e)),this._injector.get(F)}},C(W,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),W);X=z([q(1,(0,s.Inject)(s.Injector)),q(2,s.IConfigService)],X);let K=(C(n=class extends s.Plugin{constructor(e=y,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=this._config;this._configService.setConfig("rpc.worker-thread.config",n)}onStarting(){[[H],[D,{useFactory:()=>new V({send(e){postMessage(e)},onMessage:new(0,d.Observable)(e=>{let t=t=>{e.next(t.data)};return addEventListener("message",t),()=>removeEventListener("message",t)}).pipe((0,g.shareReplay)(1))})}],[T,{useClass:O}]].forEach(e=>this._injector.add(e)),this._injector.get(H)}},"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),n);z([q(1,(0,s.Inject)(s.Injector)),q(2,s.IConfigService)],K)}),s("2jrJe",function(t,r){e(t.exports,"takeUntil",function(){return l});var n=i("jSzwf"),s=i("iNetn"),a=i("b7gpN"),o=i("f1euv");function l(e){return(0,n.operate)(function(t,r){(0,a.innerFrom)(e).subscribe((0,s.createOperatorSubscriber)(r,function(){return r.complete()},o.noop)),r.closed||t.subscribe(r)})}}),s("dBx9C",function(t,r){e(t.exports,"firstValueFrom",function(){return a});var n=i("aXqMV"),s=i("lftZl");function a(e,t){var r="object"==typeof t;return new Promise(function(i,a){var o=new s.SafeSubscriber({next:function(e){i(e),o.unsubscribe()},error:a,complete:function(){r?i(t.defaultValue):a(new n.EmptyError)}});e.subscribe(o)})}}),s("hRiv7",function(t,r){e(t.exports,"isObservable",function(){return a});var n=i("1O3Nt"),s=i("3IQI0");function a(e){return!!e&&(e instanceof n.Observable||(0,s.isFunction)(e.lift)&&(0,s.isFunction)(e.subscribe))}}),s("c3hg1",function(t,r){e(t.exports,"shareReplay",function(){return a});var n=i("3rvNF"),s=i("8LCGH");function a(e,t,r){var i,a,o,l,u=!1;return e&&"object"==typeof e?(l=void 0===(i=e.bufferSize)?1/0:i,t=void 0===(a=e.windowTime)?1/0:a,u=void 0!==(o=e.refCount)&&o,r=e.scheduler):l=null!=e?e:1/0,(0,s.share)({connector:function(){return new n.ReplaySubject(l,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:u})}}),s("8LCGH",function(t,r){e(t.exports,"share",function(){return u});var n=i("1a7ft"),s=i("b7gpN"),a=i("1mjSk"),o=i("lftZl"),l=i("jSzwf");function u(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new a.Subject}:t,n=e.resetOnError,i=void 0===n||n,u=e.resetOnComplete,h=void 0===u||u,d=e.resetOnRefCountZero,m=void 0===d||d;return function(e){var t,n,a,u=0,d=!1,g=!1,f=function(){null==n||n.unsubscribe(),n=void 0},p=function(){f(),t=a=void 0,d=g=!1},C=function(){var e=t;p(),null==e||e.unsubscribe()};return(0,l.operate)(function(e,l){u++,g||d||f();var _=a=null!=a?a:r();l.add(function(){0!=--u||g||d||(n=c(C,m))}),_.subscribe(l),!t&&u>0&&(t=new o.SafeSubscriber({next:function(e){return _.next(e)},error:function(e){g=!0,f(),n=c(p,i,e),_.error(e)},complete:function(){d=!0,f(),n=c(p,h),_.complete()}}),(0,s.innerFrom)(e).subscribe(t))})(e)}}function c(e,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(!0===t){e();return}if(!1!==t){var a=new o.SafeSubscriber({next:function(){a.unsubscribe(),e()}});return(0,s.innerFrom)(t.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(r)))).subscribe(a)}}}),s("23cfA",function(t,r){e(t.exports,"switchMap",function(){return o});var n=i("b7gpN"),s=i("jSzwf"),a=i("iNetn");function o(e,t){return(0,s.operate)(function(r,i){var s=null,o=0,l=!1,u=function(){return l&&!s&&i.complete()};r.subscribe((0,a.createOperatorSubscriber)(i,function(r){null==s||s.unsubscribe();var l=0,c=o++;(0,n.innerFrom)(e(r,c)).subscribe(s=(0,a.createOperatorSubscriber)(i,function(e){return i.next(t?t(r,e,c,l++):e)},function(){s=null,u()}))},function(){l=!0,u()}))})}}),s("2BOVU",function(t,r){e(t.exports,"DEFAULT_TEXT_FORMAT",function(){return n});let n="@@@"}),s("kYtkX",function(e,t){var r=i("1XeGV");e.exports=Promise.all([r("1L490"),r("fd2QQ")]).then(()=>i("61myN"))}),s("1XeGV",function(e,t){e.exports=function(e){return import(i("6wcuN").resolve(e))}}),s("caaaG",function(e,t){var r=i("1XeGV");e.exports=Promise.all([r("1L490"),r("1BRsM")]).then(()=>i("bzE9m"))}),s("hDUMm",function(e,t){var r=i("1XeGV");e.exports=r("1LVG9").then(()=>i("jF4AZ"))}),s("252tF",function(e,t){var r=i("1XeGV");e.exports=r("buFfU").then(()=>i("5DAFn"))}),i("6wcuN").register(new URL("",import.meta.url).toString(),JSON.parse('["gBQDZ","spreadsheet_component.e94aff42.js","fd2QQ","es.87164878.js","1L490","es.4ebad13e.js","1BRsM","preset-sheets-core.f0303f8b.js","fBi3N","vue.runtime.esm-bundler.ea84564c.js","1LVG9","en-US.4a445c30.js","buFfU","zod.d17fcf66.js"]'));var a=i("7yNYd"),o=i("ejawP");const l=i("kYtkX"),u=i("caaaG"),c=i("hDUMm"),h=i("252tF"),d=window?.location?.search?.includes("_debug_spreadsheet");class m{static{this.MAX_COLS=1e9}insert(e,t,r){let n=e*m.MAX_COLS+t;this.ids[n]=r}get(e,t){let r=e*m.MAX_COLS+t;return this.ids[r]}constructor(){this.ids=[]}}async function g(e,t){let{cellData:r,rowCount:n,columnCount:i,cellIdMap:s}=await f(e);return{worksheet:{id:"sqlpage",name:t.sheet_name,defaultColumnWidth:t.column_width,defaultRowHeight:t.row_height,showGridlines:+t.show_grid,freeze:{startRow:t.freeze_y,startColumn:t.freeze_x,xSplit:t.freeze_x,ySplit:t.freeze_y},rowCount:n,columnCount:i,cellData:r},cellIdMap:s}}async function f(e){let t={},r=new m,n=1e3,i=26,s=R(await h);for(let o of e){let[e,l,u,...c]=s.parse(o),h={v:u};if(c.length){let{s:t,customId:n}=function(e){let t;let r={};for(let n=0;n<e.length;n++){let i=e[n];if(1===i)r.bl=1;else if(2===i)r.it=1;else if(3===i){let t=e[++n].toString(),i=_.getPropertyValue(`--tblr-${t}`)||t;r.bg={rgb:i}}else if(4===i)r.ht=a.HorizontalAlign.CENTER;else if(5===i)r.ht=a.HorizontalAlign.RIGHT;else if(6===i)r.ht=a.HorizontalAlign.JUSTIFIED;else if(7===i)r.ht=a.HorizontalAlign.DISTRIBUTED;else if(8===i){let t=e[++n].toString();r.n={pattern:t}}else if(9===i)t=e[++n].toString();else if(10===i)r.ff=e[++n].toString();else if(11===i)r.fs=Number(e[++n]);else if(12===i)r.ul={s:1};else if(13===i)r.st={s:1};else if(14===i){let t=e[++n].toString(),i=_.getPropertyValue(`--tblr-${t}`)||t;r.cl={rgb:i}}else 15===i?r.vt=a.VerticalAlign.TOP:16===i?r.vt=a.VerticalAlign.MIDDLE:17===i?r.vt=a.VerticalAlign.BOTTOM:18===i?r.tb=a.WrapStrategy.OVERFLOW:19===i?r.tb=a.WrapStrategy.CLIP:20===i?r.tb=a.WrapStrategy.WRAP:21===i&&(r.td=a.TextDirection.RIGHT_TO_LEFT)}return{s:r,customId:t}}(c);h.s=t,n&&r.insert(l,e,n)}"number"==typeof u&&(h.t=2);let d=t[l];d?d[e]=h:t[l]={[e]:h},n=Math.max(n,l),i=Math.max(i,e)}return{cellData:t,rowCount:n,columnCount:i,cellIdMap:r}}async function p(e){let{LocaleType:t,createUniver:r,defaultTheme:n}=await l,{UniverSheetsCorePreset:i}=await u,{default:s}=await c,{univerAPI:a}=r({locale:t.EN_US,locales:{[t.EN_US]:s},logLevel:d?3:0,theme:n,presets:[i({container:e})]});return e.className="sqlpage_spreadsheet",a}async function C(e,t,r,n,i,s){if(!e)return;let a=new URL(e,window.location.href);a.searchParams.append("_sqlpage_embed","");let o=new URLSearchParams;o.append("x",t.toString()),o.append("y",r.toString()),null!=n&&o.append("value",n.toString()),null!=i&&o.append("id",i);let l=await fetch(a,{method:"POST",body:o}),u=await l.text();200===l.status||u||(u=l.statusText),u&&(s.resp_modal_body.innerHTML=u,new s.Modal(s.resp_modal).show())}const _=getComputedStyle(document.documentElement);async function y(e,t,r){let n=e.querySelector(".modal");if(!(n instanceof HTMLElement))throw Error("modal not found");let i=function(e){if(!e)throw Error("errorModal not found");let t=e.querySelector(".modal-body");if(!t)throw Error("errorModal not found");let r=window?.bootstrap?.Modal;if(!r)throw Error("bootstrap.Modal not found");return{resp_modal:e,resp_modal_body:t,Modal:r}}(n),{worksheet:s,cellIdMap:a}=await g(r,t),l=await p(e),u={sheetOrder:["sqlpage"],name:"sqlpage",appVersion:"0.2.14",sheets:{sqlpage:s}};d&&console.log("sqlpage-spreadsheet: creating sheet",u),l.createUniverSheet(u);let{update_link:c}=t;l.onCommandExecuted(({id:e,params:t})=>{c&&e===o.SetRangeValuesMutation.id&&function(e,t,r,n){let{cellValue:i}=e;if(i)for(let e in i){let s=i[e];for(let i in s){let a=s[i];if(!a)continue;let o=a.v;null==o&&a.p&&(o=a.p.body?.dataStream?.trimEnd());let l=Number.parseInt(e),u=Number.parseInt(i),c=n.get(l,u);C(t,u,l,o,c,r)}}}(t,c,i,a)})}const E=e=>e.object({update_link:e.string().optional(),sheet_name:e.string().default("SQLPage Data"),freeze_x:e.number().int().nonnegative().default(0),freeze_y:e.number().int().nonnegative().default(0),column_width:e.number().int().nonnegative().optional(),row_height:e.number().int().nonnegative().optional(),show_grid:e.boolean().default(!0)}),b=e=>e.union([e.string(),e.number()]),R=e=>e.tuple([e.number().int().nonnegative(),e.number().int().nonnegative(),e.union([e.string(),e.number(),e.null()])]).rest(b(e));async function N(e){try{let t=e.dataset;if(!t)throw Error("Props not found");let r=JSON.parse(t?.cells||"[]");if(!Array.isArray(r))throw Error(`Invalid cells${t?.cells}`);let n=E(await h).parse(JSON.parse(t?.props||"{}"));y(e,n,r)}catch(e){alert(`Invalid properties passed to the spreadsheet component: ${e}`)}}const I=document.getElementsByClassName("sqlpage_spreadsheet"),A=I[I.length-1];if(!(A instanceof HTMLElement))throw Error("No spreadsheet elements found");N(A);
//# sourceMappingURL=spreadsheet_component.e94aff42.js.map
