let e,t;var r,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function i(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function s(e){return import(a+(e=u.i?.[e]||e))}var a="./",o={},l={},u=n.parcelRequire26fc;null==u&&((u=function(e){if(e in o)return o[e].exports;if(e in l){var t=l[e];delete l[e];var r={id:e,exports:{}};return o[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){l[e]=t},n.parcelRequire26fc=u);var c=u.register;c("7yNYd",function(e,t){let r,s,a,o,l,c,h,d,m,g,f,p,C,_,y,R,E,b,I,N,S,A,v,T,w,M,O,x,U,D,V,L,P,k,F,j,B,$,H,W,G,Y,z,X,q,K,Q,Z,J,ee,et,er,en,ei,es,ea,eo,el,eu,ec,eh,ed,em,eg,ef,ep,eC,e_,ey,eR,eE,eb,eI,eN,eS,eA,ev,eT,ew,eM,eO,ex,eU,eD,eV,eL,eP,ek,eF,ej,eB,e$,eH,eW,eG,eY,ez,eX,eq,eK,eQ,eZ;i(e.exports,"remove",function(){return tp}),i(e.exports,"dedupe",function(){return tC}),i(e.exports,"dedupeBy",function(){return t_}),i(e.exports,"rotate",function(){return ty}),i(e.exports,"groupBy",function(){return tR}),i(e.exports,"makeArray",function(){return tE}),i(e.exports,"AsyncLock",function(){return tI}),i(e.exports,"isBooleanString",function(){return tS}),i(e.exports,"DOCS_NORMAL_EDITOR_UNIT_ID_KEY",function(){return tv}),i(e.exports,"DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY",function(){return tT}),i(e.exports,"DOCS_ZEN_EDITOR_UNIT_ID_KEY",function(){return tw}),i(e.exports,"DEFAULT_EMPTY_DOCUMENT_VALUE",function(){return tM}),i(e.exports,"IS_ROW_STYLE_PRECEDE_COLUMN_STYLE",function(){return tO}),i(e.exports,"AUTO_HEIGHT_FOR_MERGED_CELLS",function(){return tx}),i(e.exports,"createInternalEditorID",function(){return tU}),i(e.exports,"isInternalEditorID",function(){return tD}),i(e.exports,"registerDependencies",function(){return tV}),i(e.exports,"touchDependencies",function(){return tL}),i(e.exports,"shallowEqual",function(){return tP}),i(e.exports,"CustomCommandExecutionError",function(){return tk}),i(e.exports,"CanceledError",function(){return tF}),i(e.exports,"throttle",function(){return tj}),i(e.exports,"InterceptorEffectEnum",function(){return tB}),i(e.exports,"createInterceptorKey",function(){return t$}),i(e.exports,"composeInterceptors",function(){return tH}),i(e.exports,"InterceptorManager",function(){return tW}),i(e.exports,"createAsyncInterceptorKey",function(){return tG}),i(e.exports,"AsyncInterceptorManager",function(){return tY}),i(e.exports,"invertColorByHSL",function(){return tJ}),i(e.exports,"invertColorByMatrix",function(){return t1}),i(e.exports,"get",function(){return nC}),i(e.exports,"debounce",function(){return nx}),i(e.exports,"mergeWith",function(){return nL}),i(e.exports,"merge",function(){return nP}),i(e.exports,"set",function(){return nk}),i(e.exports,"MemoryCursor",function(){return nF}),i(e.exports,"mixinClass",function(){return nj}),i(e.exports,"isNumeric",function(){return nB}),i(e.exports,"isSafeNumeric",function(){return n$}),i(e.exports,"willLoseNumericPrecision",function(){return nH}),i(e.exports,"Registry",function(){return nW}),i(e.exports,"RegistryAsMap",function(){return nG}),i(e.exports,"requestImmediateMacroTask",function(){return nY}),i(e.exports,"sequenceAsync",function(){return nz}),i(e.exports,"sequence",function(){return nX}),i(e.exports,"mergeSets",function(){return nq}),i(e.exports,"toDisposable",function(){return nK}),i(e.exports,"fromObservable",function(){return nQ}),i(e.exports,"DisposableCollection",function(){return nZ}),i(e.exports,"Disposable",function(){return nJ}),i(e.exports,"RxDisposable",function(){return n0}),i(e.exports,"RCDisposable",function(){return n1}),i(e.exports,"UniverInstanceType",function(){return n2}),i(e.exports,"UnitModel",function(){return n4}),i(e.exports,"Tools",function(){return ir}),i(e.exports,"generateRandomId",function(){return ii}),i(e.exports,"composeStyles",function(){return is}),i(e.exports,"isNodeEnv",function(){return ia}),i(e.exports,"AutoFillSeries",function(){return io}),i(e.exports,"BorderStyleTypes",function(){return il}),i(e.exports,"BorderType",function(){return iu}),i(e.exports,"ColorType",function(){return ic}),i(e.exports,"CommonHideTypes",function(){return ih}),i(e.exports,"CopyPasteType",function(){return id}),i(e.exports,"DeleteDirection",function(){return im}),i(e.exports,"DeveloperMetadataVisibility",function(){return ig}),i(e.exports,"Dimension",function(){return ip}),i(e.exports,"Direction",function(){return iC}),i(e.exports,"getReverseDirection",function(){return i_}),i(e.exports,"InterpolationPointType",function(){return iy}),i(e.exports,"LocaleType",function(){return iR}),i(e.exports,"MentionType",function(){return iE}),i(e.exports,"ProtectionType",function(){return ib}),i(e.exports,"BasicShapes",function(){return iI}),i(e.exports,"ArrowsAndMarkersShapes",function(){return iN}),i(e.exports,"OtherShapes",function(){return iS}),i(e.exports,"SpecialShapes",function(){return iA}),i(e.exports,"RelativeDate",function(){return iv}),i(e.exports,"SheetTypes",function(){return iT}),i(e.exports,"TextDirection",function(){return iw}),i(e.exports,"TextDecoration",function(){return iM}),i(e.exports,"HorizontalAlign",function(){return iO}),i(e.exports,"VerticalAlign",function(){return ix}),i(e.exports,"WrapStrategy",function(){return iU}),i(e.exports,"FontItalic",function(){return iD}),i(e.exports,"FontWeight",function(){return iV}),i(e.exports,"BaselineOffset",function(){return iL}),i(e.exports,"BooleanNumber",function(){return iP}),i(e.exports,"CellValueType",function(){return ik}),i(e.exports,"ThemeColorType",function(){return iF}),i(e.exports,"ThemeColors",function(){return ij}),i(e.exports,"DocStyleType",function(){return iB}),i(e.exports,"FollowNumberWithType",function(){return i$}),i(e.exports,"ListGlyphType",function(){return iH}),i(e.exports,"BulletAlignment",function(){return iW}),i(e.exports,"CustomRangeType",function(){return iG}),i(e.exports,"CustomDecorationType",function(){return iY}),i(e.exports,"BlockType",function(){return iz}),i(e.exports,"DocumentFlavor",function(){return iX}),i(e.exports,"GridType",function(){return iq}),i(e.exports,"SectionType",function(){return iK}),i(e.exports,"ColumnSeparatorType",function(){return iQ}),i(e.exports,"TextDirectionType",function(){return iZ}),i(e.exports,"ParagraphElementType",function(){return iJ}),i(e.exports,"WrapTextType",function(){return i0}),i(e.exports,"PositionedObjectLayoutType",function(){return i1}),i(e.exports,"NamedStyleType",function(){return i2}),i(e.exports,"SpacingRule",function(){return i5}),i(e.exports,"DashStyleType",function(){return i3}),i(e.exports,"TabStopAlignment",function(){return i4}),i(e.exports,"TableSizeType",function(){return i6}),i(e.exports,"TableAlignmentType",function(){return i9}),i(e.exports,"TableLayoutType",function(){return i8}),i(e.exports,"TableTextWrapType",function(){return i7}),i(e.exports,"TableRowHeightRule",function(){return se}),i(e.exports,"VerticalAlignmentType",function(){return st}),i(e.exports,"FontStyleType",function(){return sr}),i(e.exports,"ObjectRelativeFromH",function(){return sn}),i(e.exports,"ObjectRelativeFromV",function(){return si}),i(e.exports,"NumberUnitType",function(){return ss}),i(e.exports,"AlignTypeH",function(){return sa}),i(e.exports,"AlignTypeV",function(){return so}),i(e.exports,"characterSpacingControlType",function(){return sl}),i(e.exports,"PageOrientType",function(){return su}),i(e.exports,"PaperType",function(){return sc}),i(e.exports,"PAPER_TYPES",function(){return sh}),i(e.exports,"ArrangeTypeEnum",function(){return sv}),i(e.exports,"DrawingTypeEnum",function(){return sT}),i(e.exports,"PageType",function(){return sw}),i(e.exports,"PageElementType",function(){return sM}),i(e.exports,"RelativeSlideLink",function(){return sO}),i(e.exports,"JSON1",function(){return sQ}),i(e.exports,"UpdateDocsAttributeType",function(){return sZ}),i(e.exports,"TextXActionType",function(){return sJ}),i(e.exports,"IContextService",function(){return s0}),i(e.exports,"ContextService",function(){return s1}),i(e.exports,"LogLevel",function(){return s2}),i(e.exports,"ILogService",function(){return s5}),i(e.exports,"DesktopLogService",function(){return s3}),i(e.exports,"CommandType",function(){return s9}),i(e.exports,"ICommandService",function(){return s8}),i(e.exports,"NilCommand",function(){return ae}),i(e.exports,"CommandService",function(){return at}),i(e.exports,"sequenceExecute",function(){return an}),i(e.exports,"sequenceExecuteAsync",function(){return ai}),i(e.exports,"fromCallback",function(){return as}),i(e.exports,"takeAfter",function(){return aa}),i(e.exports,"bufferDebounceTime",function(){return ao}),i(e.exports,"afterTime",function(){return al}),i(e.exports,"convertObservableToBehaviorSubject",function(){return au}),i(e.exports,"afterInitApply",function(){return ac}),i(e.exports,"searchInOrderedArray",function(){return ah}),i(e.exports,"binarySearchArray",function(){return ad}),i(e.exports,"binSearchFirstGreaterThanTarget",function(){return am}),i(e.exports,"searchArray",function(){return ag}),i(e.exports,"codeToBlob",function(){return af}),i(e.exports,"MOVE_BUFFER_VALUE",function(){return ap}),i(e.exports,"ROTATE_BUFFER_VALUE",function(){return aC}),i(e.exports,"checkIfMove",function(){return a_}),i(e.exports,"getBodySliceHtml",function(){return ay}),i(e.exports,"covertTextRunToHtml",function(){return aE}),i(e.exports,"convertBodyToHtml",function(){return aR}),i(e.exports,"THEME_COLORS",function(){return ab}),i(e.exports,"ColorBuilder",function(){return aI}),i(e.exports,"RgbColor",function(){return av}),i(e.exports,"ThemeColor",function(){return aw}),i(e.exports,"Color",function(){return aN}),i(e.exports,"HLSColor",function(){return aS}),i(e.exports,"RGB_PAREN",function(){return aM}),i(e.exports,"RGBA_PAREN",function(){return aO}),i(e.exports,"COLORS",function(){return ax}),i(e.exports,"ColorKit",function(){return aU}),i(e.exports,"isBlackColor",function(){return aX}),i(e.exports,"isWhiteColor",function(){return aq}),i(e.exports,"isICellData",function(){return aK}),i(e.exports,"getCellValueType",function(){return aQ}),i(e.exports,"isNullCell",function(){return aZ}),i(e.exports,"isCellV",function(){return aJ}),i(e.exports,"RANGE_TYPE",function(){return a0}),i(e.exports,"AbsoluteRefType",function(){return a1}),i(e.exports,"selectionToArray",function(){return a2}),i(e.exports,"RANGE_DIRECTION",function(){return a5}),i(e.exports,"DOC_RANGE_TYPE",function(){return a3}),i(e.exports,"getCellInfoInMergeData",function(){return a4}),i(e.exports,"CellModeEnum",function(){return a6}),i(e.exports,"mapObjectMatrix",function(){return a9}),i(e.exports,"getArrayLength",function(){return a8}),i(e.exports,"insertMatrixArray",function(){return a7}),i(e.exports,"spliceArray",function(){return oe}),i(e.exports,"concatMatrixArray",function(){return ot}),i(e.exports,"sliceMatrixArray",function(){return or}),i(e.exports,"moveMatrixArray",function(){return on}),i(e.exports,"ObjectMatrix",function(){return oi}),i(e.exports,"convertCellToRange",function(){return os}),i(e.exports,"makeCellToSelection",function(){return oa}),i(e.exports,"makeCellRangeToRangeData",function(){return oo}),i(e.exports,"isEmptyCell",function(){return ol}),i(e.exports,"isCellCoverable",function(){return ou}),i(e.exports,"getColorStyle",function(){return oc}),i(e.exports,"isFormulaString",function(){return oh}),i(e.exports,"isFormulaId",function(){return od}),i(e.exports,"handleStyleToString",function(){return om}),i(e.exports,"getBorderStyleType",function(){return of}),i(e.exports,"getDocsUpdateBody",function(){return op}),i(e.exports,"isValidRange",function(){return oC}),i(e.exports,"cellToRange",function(){return o_}),i(e.exports,"covertCellValue",function(){return oy}),i(e.exports,"covertCellValues",function(){return oR}),i(e.exports,"deepCompare",function(){return oE}),i(e.exports,"isSameStyleTextRun",function(){return ob}),i(e.exports,"checkForSubstrings",function(){return oI}),i(e.exports,"dayjs",function(){return oU}),i(e.exports,"horizontalLineSegmentsSubtraction",function(){return lV}),i(e.exports,"checkParagraphHasBullet",function(){return lL}),i(e.exports,"checkParagraphHasIndent",function(){return lP}),i(e.exports,"checkParagraphHasIndentByStyle",function(){return lk}),i(e.exports,"insertTextToContent",function(){return lF}),i(e.exports,"deleteContent",function(){return lj}),i(e.exports,"isRealNum",function(){return lB}),i(e.exports,"hashAlgorithm",function(){return l$}),i(e.exports,"mergeLocales",function(){return lH}),i(e.exports,"LRUMap",function(){return lK}),i(e.exports,"LRUHelper",function(){return lQ}),i(e.exports,"numfmt",function(){return cD}),i(e.exports,"DEFAULT_TEXT_FORMAT",function(){return cV}),i(e.exports,"DEFAULT_TEXT_FORMAT_EXCEL",function(){return cL}),i(e.exports,"DEFAULT_NUMBER_FORMAT",function(){return cP}),i(e.exports,"isTextFormat",function(){return ck}),i(e.exports,"isDefaultFormat",function(){return cF}),i(e.exports,"isPatternEqualWithoutDecimal",function(){return cj}),i(e.exports,"DEFAULT_RANGE_ARRAY",function(){return cB}),i(e.exports,"DEFAULT_RANGE",function(){return c$}),i(e.exports,"DEFAULT_SELECTION",function(){return cH}),i(e.exports,"DEFAULT_CELL",function(){return cW}),i(e.exports,"DEFAULT_STYLES",function(){return cG}),i(e.exports,"DEFAULT_SLIDE",function(){return cY}),i(e.exports,"SHEET_EDITOR_UNITS",function(){return cz}),i(e.exports,"NAMED_STYLE_MAP",function(){return cX}),i(e.exports,"NAMED_STYLE_SPACE_MAP",function(){return cq}),i(e.exports,"PRINT_CHART_COMPONENT_KEY",function(){return cK}),i(e.exports,"DOC_DRAWING_PRINTING_COMPONENT_KEY",function(){return cQ}),i(e.exports,"EXTENSION_NAMES",function(){return cZ}),i(e.exports,"PAGE_SIZE",function(){return cJ}),i(e.exports,"Range",function(){return c2}),i(e.exports,"RBush",function(){return c3}),i(e.exports,"moveRangeByOffset",function(){return ha}),i(e.exports,"splitIntoGrid",function(){return hl}),i(e.exports,"Rectangle",function(){return hm}),i(e.exports,"getIntersectRange",function(){return hu}),i(e.exports,"queryObjectMatrix",function(){return hg}),i(e.exports,"RefAlias",function(){return hf}),i(e.exports,"createRowColIter",function(){return hp}),i(e.exports,"ABCToNumber",function(){return hC}),i(e.exports,"numberToABC",function(){return h_}),i(e.exports,"repeatStringNumTimes",function(){return hy}),i(e.exports,"numberToListABC",function(){return hR}),i(e.exports,"sortRules",function(){return hE}),i(e.exports,"sortRulesByDesc",function(){return hb}),i(e.exports,"sortRulesFactory",function(){return hI}),i(e.exports,"normalizeTextRuns",function(){return hN}),i(e.exports,"QuickListType",function(){return hj}),i(e.exports,"PresetListType",function(){return hB}),i(e.exports,"PRESET_LIST_TYPE",function(){return hY}),i(e.exports,"QuickListTypeMap",function(){return hX}),i(e.exports,"SliceBodyType",function(){return hK}),i(e.exports,"getTextRunSlice",function(){return hQ}),i(e.exports,"getTableSlice",function(){return hZ}),i(e.exports,"getParagraphsSlice",function(){return hJ}),i(e.exports,"getSectionBreakSlice",function(){return h0}),i(e.exports,"getCustomBlockSlice",function(){return h1}),i(e.exports,"getBodySlice",function(){return h2}),i(e.exports,"getCustomDecorationSlice",function(){return h4}),i(e.exports,"getCustomRangeSlice",function(){return h3}),i(e.exports,"normalizeBody",function(){return h5}),i(e.exports,"composeBody",function(){return h6}),i(e.exports,"ActionIterator",function(){return h9}),i(e.exports,"updateAttributeByDelete",function(){return h8}),i(e.exports,"updateAttributeByInsert",function(){return h7}),i(e.exports,"TextX",function(){return dn}),i(e.exports,"JSONX",function(){return ds}),i(e.exports,"DataStreamTreeNodeType",function(){return da}),i(e.exports,"DataStreamTreeTokenType",function(){return dl}),i(e.exports,"makeCustomRangeStream",function(){return du}),i(e.exports,"getPlainText",function(){return dh}),i(e.exports,"DEFAULT_DOC",function(){return dd}),i(e.exports,"DocumentDataModel",function(){return dg}),i(e.exports,"textDiff",function(){return dC}),i(e.exports,"BuildTextUtils",function(){return dI}),i(e.exports,"replaceInDocumentBody",function(){return dN}),i(e.exports,"TextStyleValue",function(){return dA}),i(e.exports,"TextDecorationBuilder",function(){return dT}),i(e.exports,"TextStyleBuilder",function(){return dv}),i(e.exports,"ParagraphStyleValue",function(){return dw}),i(e.exports,"ParagraphStyleBuilder",function(){return dM}),i(e.exports,"RichTextValue",function(){return dO}),i(e.exports,"RichTextBuilder",function(){return dx}),i(e.exports,"DEFAULT_DOCUMENT_SUB_COMPONENT_ID",function(){return dU}),i(e.exports,"EventState",function(){return dD}),i(e.exports,"EventSubject",function(){return dV}),i(e.exports,"fromEventSubject",function(){return dL}),i(e.exports,"IResourceManagerService",function(){return dP}),i(e.exports,"createDefaultUser",function(){return dF}),i(e.exports,"UserManagerService",function(){return dj}),i(e.exports,"AuthzIoLocalService",function(){return dH}),i(e.exports,"IAuthzIoService",function(){return dW}),i(e.exports,"IConfigService",function(){return dG}),i(e.exports,"ConfigService",function(){return dY}),i(e.exports,"FOCUSING_UNIT",function(){return dz}),i(e.exports,"FOCUSING_SHEET",function(){return dX}),i(e.exports,"FOCUSING_DOC",function(){return dq}),i(e.exports,"FOCUSING_SLIDE",function(){return dK}),i(e.exports,"FOCUSING_EDITOR_BUT_HIDDEN",function(){return dQ}),i(e.exports,"EDITOR_ACTIVATED",function(){return dZ}),i(e.exports,"FOCUSING_EDITOR_INPUT_FORMULA",function(){return dJ}),i(e.exports,"FOCUSING_FX_BAR_EDITOR",function(){return d0}),i(e.exports,"FOCUSING_UNIVER_EDITOR",function(){return d1}),i(e.exports,"FOCUSING_EDITOR_STANDALONE",function(){return d2}),i(e.exports,"FOCUSING_PANEL_EDITOR",function(){return d5}),i(e.exports,"FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",function(){return d3}),i(e.exports,"FOCUSING_COMMON_DRAWINGS",function(){return d4}),i(e.exports,"FORMULA_EDITOR_ACTIVATED",function(){return d6}),i(e.exports,"ErrorService",function(){return d9}),i(e.exports,"ImageSourceType",function(){return d8}),i(e.exports,"ImageUploadStatusType",function(){return d7}),i(e.exports,"IImageIoService",function(){return me}),i(e.exports,"Styles",function(){return mt}),i(e.exports,"isRangesEqual",function(){return mr}),i(e.exports,"isUnitRangesEqual",function(){return mn}),i(e.exports,"createDocumentModelWithStyle",function(){return ms}),i(e.exports,"addLinkToDocumentModel",function(){return mo}),i(e.exports,"isNotNullOrUndefined",function(){return ml}),i(e.exports,"DEFAULT_WORKSHEET_ROW_COUNT_KEY",function(){return mm}),i(e.exports,"DEFAULT_WORKSHEET_ROW_COUNT",function(){return mg}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_COUNT_KEY",function(){return mf}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_COUNT",function(){return mp}),i(e.exports,"DEFAULT_WORKSHEET_ROW_HEIGHT_KEY",function(){return mC}),i(e.exports,"DEFAULT_WORKSHEET_ROW_HEIGHT",function(){return m_}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY",function(){return my}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH",function(){return mR}),i(e.exports,"DEFAULT_WORKSHEET_ROW_TITLE_WIDTH_KEY",function(){return mE}),i(e.exports,"DEFAULT_WORKSHEET_ROW_TITLE_WIDTH",function(){return mb}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT_KEY",function(){return mI}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT",function(){return mN}),i(e.exports,"mergeWorksheetSnapshotWithDefault",function(){return mS}),i(e.exports,"SheetViewModel",function(){return mv}),i(e.exports,"Worksheet",function(){return mw}),i(e.exports,"extractPureTextFromCell",function(){return mM}),i(e.exports,"getOriginCellValue",function(){return mO}),i(e.exports,"getWorksheetUID",function(){return mU}),i(e.exports,"Workbook",function(){return mD}),i(e.exports,"SlideDataModel",function(){return mV}),i(e.exports,"IUniverInstanceService",function(){return mk}),i(e.exports,"UniverInstanceService",function(){return mF}),i(e.exports,"LifecycleStages",function(){return mj}),i(e.exports,"LifecycleUnreachableError",function(){return mH}),i(e.exports,"LifecycleService",function(){return mW}),i(e.exports,"ILocalStorageService",function(){return mY}),i(e.exports,"LocaleService",function(){return mz}),i(e.exports,"MentionIOLocalService",function(){return mq}),i(e.exports,"IMentionIOService",function(){return mK}),i(e.exports,"PermissionStatus",function(){return mQ}),i(e.exports,"IPermissionService",function(){return mZ}),i(e.exports,"PermissionService",function(){return mJ}),i(e.exports,"mergeOverrideWithDependencies",function(){return m0}),i(e.exports,"Plugin",function(){return m3}),i(e.exports,"DependentOn",function(){return m6}),i(e.exports,"PluginService",function(){return m9}),i(e.exports,"IResourceLoaderService",function(){return m8}),i(e.exports,"ResourceManagerService",function(){return ge}),i(e.exports,"ThemeService",function(){return gt}),i(e.exports,"IUndoRedoService",function(){return gi}),i(e.exports,"RedoCommandId",function(){return ga}),i(e.exports,"UndoCommandId",function(){return go}),i(e.exports,"UndoCommand",function(){return gl}),i(e.exports,"RedoCommand",function(){return gu}),i(e.exports,"LocalUndoRedoService",function(){return gc}),i(e.exports,"ImageCacheMap",function(){return gh}),i(e.exports,"nameCharacterCheck",function(){return gd}),i(e.exports,"customNameCharacterCheck",function(){return gm}),i(e.exports,"RTree",function(){return gy}),i(e.exports,"awaitTime",function(){return gR}),i(e.exports,"delayAnimationFrame",function(){return gE}),i(e.exports,"Skeleton",function(){return gI}),i(e.exports,"SheetSkeleton",function(){return gA}),i(e.exports,"getCellWithCoordByIndexCore",function(){return gw}),i(e.exports,"getTransformOffsetY",function(){return gO}),i(e.exports,"getTransformOffsetX",function(){return gM}),i(e.exports,"getCellCoordByIndexSimple",function(){return gv}),i(e.exports,"getCellPositionByIndexSimple",function(){return gT}),i(e.exports,"skipParseTagNames",function(){return gx}),i(e.exports,"DataValidationErrorStyle",function(){return gU}),i(e.exports,"DataValidationImeMode",function(){return gD}),i(e.exports,"DataValidationOperator",function(){return gV}),i(e.exports,"DataValidationRenderMode",function(){return gL}),i(e.exports,"DataValidationStatus",function(){return gP}),i(e.exports,"DataValidationType",function(){return gk}),i(e.exports,"Univer",function(){return g$});var eJ,e0,e1,e2=u("dqRu2"),e5=u("5LPkb"),e3=u("5K4WI"),e4=u("bXJOC"),e6=u("arCqp"),e9=u("lMvMU"),e8=u("dBx9C"),e7=u("hciHF"),te=u("i54iF"),tt=u("1O3Nt"),tr=u("3yupB"),tn=u("3rvNF"),ti=u("9GqS8"),ts=u("1mjSk"),ta=u("e1VZ5"),to=u("9z4na"),tl=u("b7wVW"),tu=u("aMpZj"),e4=u("bXJOC"),e9=u("lMvMU"),tc=u("bDEN0"),e7=u("hciHF"),th=u("hBGpS"),td=u("8L69c"),tm=Object.defineProperty,tg=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?tm(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r};let tf="u">typeof n?n:"u">typeof self?self:window;function tp(e,t){let r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)}function tC(e){let t=new Set,r=[];for(let n of e)t.has(n)||(t.add(n),r.push(n));return r}function t_(e,t){let r=new Set,n=[];for(let i of e){let e=t(i);r.has(e)||(r.add(e),n.push(i))}return n}function ty(e,t){if(0===e.length)return e;let r=t%e.length;return e.slice(r).concat(e.slice(0,r))}function tR(e,t){let r=new Map;return e.forEach(e=>{let n=t(e),i=r.get(n);r.has(n)||(i=[],r.set(n,i)),i.push(e)}),r}function tE(e){return Array.isArray(e)?e:[e]}function tb(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}let tI=tb((sI||(sI=1,sb=function(){if(sE)return sR;sE=1;var e=function(t){if(t=t||{},this.Promise=t.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=t.domainReentrant||!1,this.domainReentrant)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.timeout=t.timeout||e.DEFAULT_TIMEOUT,this.maxOccupationTime=t.maxOccupationTime||e.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=t.maxExecutionTime||e.DEFAULT_MAX_EXECUTION_TIME,t.maxPending===1/0||Number.isInteger(t.maxPending)&&t.maxPending>=0?this.maxPending=t.maxPending:this.maxPending=e.DEFAULT_MAX_PENDING};return e.DEFAULT_TIMEOUT=0,e.DEFAULT_MAX_OCCUPATION_TIME=0,e.DEFAULT_MAX_EXECUTION_TIME=0,e.DEFAULT_MAX_PENDING=1e3,e.prototype.acquire=function(e,t,r,n){if(Array.isArray(e))return this._acquireBatch(e,t,r,n);if("function"!=typeof t)throw Error("You must pass a function to execute");var i=null,s=null,a=null;"function"!=typeof r&&(n=r,r=null,a=new this.Promise(function(e,t){i=e,s=t})),n=n||{};var o=!1,l=null,u=null,c=null,h=this,d=function(t,n,l){u&&(clearTimeout(u),u=null),c&&(clearTimeout(c),c=null),t&&(h.queues[e]&&0===h.queues[e].length&&delete h.queues[e],h.domainReentrant&&delete h.domains[e]),o||(a?n?s(n):i(l):"function"==typeof r&&r(n,l),o=!0),t&&h.queues[e]&&h.queues[e].length>0&&h.queues[e].shift()()},m=function(r){if(o)return d(r);l&&(clearTimeout(l),l=null),h.domainReentrant&&r&&(h.domains[e]=td.domain);var i=n.maxExecutionTime||h.maxExecutionTime;if(i&&(c=setTimeout(function(){h.queues[e]&&d(r,Error("Maximum execution time is exceeded "+e))},i)),1===t.length){var s=!1;try{t(function(e,t){s||(s=!0,d(r,e,t))})}catch(e){s||(s=!0,d(r,e))}}else h._promiseTry(function(){return t()}).then(function(e){d(r,void 0,e)},function(e){d(r,e)})};h.domainReentrant&&td.domain&&(m=td.domain.bind(m));var g=n.maxPending||h.maxPending;if(h.queues[e])if(h.domainReentrant&&td.domain&&td.domain===h.domains[e])m(!1);else if(h.queues[e].length>=g)d(!1,Error("Too many pending tasks in queue "+e));else{var f=function(){m(!0)};n.skipQueue?h.queues[e].unshift(f):h.queues[e].push(f);var p=n.timeout||h.timeout;p&&(l=setTimeout(function(){l=null,d(!1,Error("async-lock timed out in queue "+e))},p))}else h.queues[e]=[],m(!0);var C=n.maxOccupationTime||h.maxOccupationTime;if(C&&(u=setTimeout(function(){h.queues[e]&&d(!1,Error("Maximum occupation time is exceeded in queue "+e))},C)),a)return a},e.prototype._acquireBatch=function(e,t,r,n){"function"!=typeof r&&(n=r,r=null);var i=this,s=e.reduceRight(function(e,t){return function(r){i.acquire(t,e,r,n)}},t);if("function"!=typeof r)return new this.Promise(function(e,t){1===s.length?s(function(r,n){r?t(r):e(n)}):e(s())});s(r)},e.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},e.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},sR=e}()),sb)),tN=new Set(["true","false"]);function tS(e){return tN.has(e.toLowerCase())}let tA="__INTERNAL_EDITOR__",tv=`${tA}DOCS_NORMAL`,tT=`${tA}DOCS_FORMULA_BAR`,tw=`${tA}ZEN_EDITOR`,tM=`\r
`,tO="isRowStylePrecedeColumnStyle",tx=Symbol("AUTO_HEIGHT_FOR_MERGED_CELLS");function tU(e){return`${tA}${e}`}function tD(e){return e.startsWith(tA)}function tV(e,t){t.forEach(t=>e.add(t))}function tL(e,t){t.forEach(([t])=>{e.has(t)&&e.get(t)})}function tP(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;let i=Object.prototype.hasOwnProperty.bind(t);for(let n=0;n<r.length;n++){let s=r[n];if(!i(s)||e[s]!==t[s])return!1}return!0}class tk extends Error{constructor(e){super(e),this.name="CustomCommandExecutionError"}}class tF extends tk{constructor(){super("Canceled by facade"),this.name="CanceledError"}}function tj(e,t=16){let r=0,n=null;return function(...i){let s=Date.now();s-r<t?(n&&clearTimeout(n),n=setTimeout(()=>{r=s,e.apply(this,i)},t)):(r=s,e.apply(this,i))}}var tB=((r=tB||{})[r.Style=1]="Style",r[r.Value=2]="Value",r);function t$(e){return`sheet_interceptor_${e}`}let tH=e=>function(t,r){let n=-1,i=t;for(let t=0;t<=e.length;t++){if(t<=n)throw Error("[SheetInterceptorService]: next() called multiple times!");if(n=t,t===e.length)break;let s=e[t],a=!1;if(i=s.handler(i,r,e=>(a=!0,e)),!a)break}return i};class tW{constructor(e){tg(this,"_interceptorsByName",new Map),tg(this,"_interceptorPoints"),this._interceptorPoints=e}fetchThroughInterceptors(e,t){let r=this._interceptorsByName.get(e);return t&&(r=r.filter(t)),tH(r||[])}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);return r.push(t),this._interceptorsByName.set(e,r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)})),()=>tp(this._interceptorsByName.get(e),t)}getInterceptPoints(){return this._interceptorPoints}dispose(){this._interceptorsByName.clear()}}function tG(e){return`sheet_async_interceptor_${e}`}class tY{constructor(e){tg(this,"_asyncInterceptorsByName",new Map),tg(this,"_asyncInterceptorPoints"),this._asyncInterceptorPoints=e}fetchThroughAsyncInterceptors(e,t){let r,n=this._asyncInterceptorsByName.get(e);return t&&(n=n.filter(t)),r=n||[],async function(e,t){let n=-1,i=e;for(let e=0;e<=r.length;e++){if(e<=n)throw Error("[SheetInterceptorService]: next() called multiple times!");if(n=e,e===r.length)break;let s=r[e],a=!1;if(i=await s.handler(i,t,async e=>(a=!0,e)),!a)break}return i}}async interceptAsync(e,t){this._asyncInterceptorsByName.has(e)||this._asyncInterceptorsByName.set(e,[]);let r=this._asyncInterceptorsByName.get(e);return r.push(t),this._asyncInterceptorsByName.set(e,r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)})),()=>tp(this._asyncInterceptorsByName.get(e),t)}getInterceptPoints(){return this._asyncInterceptorPoints}dispose(){this._asyncInterceptorsByName.clear()}}function tz(e){return e.map(e=>e/255)}function tX(e){return e.map(e=>Math.round(255*e))}function tq(e,t,r){let n=[e,t,r].map(e=>e<=.03928?e/12.92:((e+.055)/1.055)**2.4);return .2126*n[0]+.7152*n[1]+.0722*n[2]}function tK(e,t){return(Math.max(e,t)+.05)/(Math.min(e,t)+.05)}let tQ=tq(1,1,1),tZ=tq(0,0,0);function tJ(e){return tX(function(e){let t=tK(tQ,tq(e[0],e[1],e[2])),r=function([e,t,r]){let n=Math.max(e,t,r),i=Math.min(e,t,r),s=(n+i)/2,a=0,o=0;if(n!==i){let l=n-i;switch(o=s>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+6*(t<r);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return[a,o,s]}(e),n=1-r[2],i,s;do s=tK(tq((i=function(e,t,r){let n,i,s;if(0===t)n=i=s=r;else{let a=(e,t,r)=>{let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<.16666666666666666?e+(t-e)*6*n:n<.5?t:n<.6666666666666666?e+(t-e)*(.6666666666666666-n)*6:e},o=r<.5?r*(1+t):r+t-r*t,l=2*r-o;n=a(l,o,e+1/3),i=a(l,o,e),s=a(l,o,e-1/3)}return[n,i,s]}(r[0],r[1],n))[0],i[1],i[2]),tZ),n+=.01;while(n<=1&&n>=0&&.01>Math.abs(s-t))return i}(tz(e)))}let t0=[[.333,-.667,-.667,0,1],[-.667,.333,-.667,0,1],[-.667,-.667,.333,0,1],[0,0,0,1,0]];function t1(e){return tX(function(e){let t=e[0],r=e[1],n=e[2];return[t0[0][0]*t+t0[0][1]*r+t0[0][2]*n+t0[0][4],t0[1][0]*t+t0[1][1]*r+t0[1][2]*n+t0[1][4],t0[2][0]*t+t0[2][1]*r+t0[2][2]*n+t0[2][4]].map(e=>e>1?1:e<0?0:e)}(tz(e)))}var t2="object"==typeof n&&n&&n.Object===Object&&n,t5="object"==typeof self&&self&&self.Object===Object&&self,t3=t2||t5||Function("return this")(),t4=t3.Symbol,t6=Object.prototype,t9=t6.hasOwnProperty,t8=t6.toString,t7=t4?t4.toStringTag:void 0,re=Object.prototype.toString,rt=t4?t4.toStringTag:void 0;function rr(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":rt&&rt in Object(e)?function(e){var t=t9.call(e,t7),r=e[t7];try{e[t7]=void 0;var n=!0}catch{}var i=t8.call(e);return n&&(t?e[t7]=r:delete e[t7]),i}(e):re.call(e)}function rn(e){return null!=e&&"object"==typeof e}function ri(e){return"symbol"==typeof e||rn(e)&&"[object Symbol]"==rr(e)}var rs=Array.isArray,ra=t4?t4.prototype:void 0,ro=ra?ra.toString:void 0,rl=/\s/,ru=/^\s+/;function rc(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var rh=NaN,rd=/^[-+]0x[0-9a-f]+$/i,rm=/^0b[01]+$/i,rg=/^0o[0-7]+$/i,rf=parseInt;function rp(e){if("number"==typeof e)return e;if(ri(e))return rh;if(rc(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=rc(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=(t=e)&&t.slice(0,function(e){for(var t=e.length;t--&&rl.test(e.charAt(t)););return t}(t)+1).replace(ru,"");var n=rm.test(e);return n||rg.test(e)?rf(e.slice(2),n?2:8):rd.test(e)?rh:+e}function rC(e){return e}function r_(e){if(!rc(e))return!1;var t=rr(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var ry=t3["__core-js_shared__"],rR=(sd=/[^.]+$/.exec(ry&&ry.keys&&ry.keys.IE_PROTO||""))?"Symbol(src)_1."+sd:"",rE=Function.prototype.toString,rb=/^\[object .+?Constructor\]$/,rI=Object.prototype,rN=Function.prototype.toString,rS=rI.hasOwnProperty,rA=RegExp("^"+rN.call(rS).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function rv(e,t){var r=null==e?void 0:e[t];return rc(r)&&(!rR||!(rR in r))&&(r_(r)?rA:rb).test(function(e){if(null!=e){try{return rE.call(e)}catch{}try{return e+""}catch{}}return""}(r))?r:void 0}var rT=Object.create,rw=function(){function e(){}return function(t){if(!rc(t))return{};if(rT)return rT(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),rM=Date.now,rO=function(){try{var e=rv(Object,"defineProperty");return e({},"",{}),e}catch{}}(),rx=(sm=rO?function(e,t){return rO(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:rC,sg=0,sf=0,function(){var e=rM(),t=16-(e-sf);if(sf=e,t>0){if(++sg>=800)return arguments[0]}else sg=0;return sm.apply(void 0,arguments)}),rU=/^(?:0|[1-9]\d*)$/;function rD(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&rU.test(e))&&e>-1&&e%1==0&&e<t}function rV(e,t,r){"__proto__"==t&&rO?rO(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function rL(e,t){return e===t||e!=e&&t!=t}var rP=Object.prototype.hasOwnProperty;function rk(e,t,r){var n=e[t];rP.call(e,t)&&rL(n,r)&&(void 0!==r||t in e)||rV(e,t,r)}var rF=Math.max;function rj(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function rB(e){return null!=e&&rj(e.length)&&!r_(e)}function r$(e){var t,r,n;return rx((r=t=function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,a&&function(e,t,r){if(!rc(r))return!1;var n=typeof t;return("number"==n?!!(rB(r)&&rD(t,r.length)):"string"==n&&t in r)&&rL(r[t],e)}(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var o=r[n];o&&e(t,o,n,s)}return t},n=rF((n=void 0,r.length-1),0),function(){for(var e=arguments,t=-1,i=rF(e.length-n,0),s=Array(i);++t<i;)s[t]=e[n+t];t=-1;for(var a=Array(n+1);++t<n;)a[t]=e[t];return a[n]=rC(s),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(r,this,a)}),t+"")}var rH=Object.prototype;function rW(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||rH)}function rG(e){return rn(e)&&"[object Arguments]"==rr(e)}var rY=Object.prototype,rz=rY.hasOwnProperty,rX=rY.propertyIsEnumerable,rq=rG(function(){return arguments}())?rG:function(e){return rn(e)&&rz.call(e,"callee")&&!rX.call(e,"callee")},rK=t&&!t.nodeType&&t,rQ=rK&&e&&!e.nodeType&&e,rZ=rQ&&rQ.exports===rK?t3.Buffer:void 0,rJ=(rZ?rZ.isBuffer:void 0)||function(){return!1},r0={};r0["[object Float32Array]"]=r0["[object Float64Array]"]=r0["[object Int8Array]"]=r0["[object Int16Array]"]=r0["[object Int32Array]"]=r0["[object Uint8Array]"]=r0["[object Uint8ClampedArray]"]=r0["[object Uint16Array]"]=r0["[object Uint32Array]"]=!0,r0["[object Arguments]"]=r0["[object Array]"]=r0["[object ArrayBuffer]"]=r0["[object Boolean]"]=r0["[object DataView]"]=r0["[object Date]"]=r0["[object Error]"]=r0["[object Function]"]=r0["[object Map]"]=r0["[object Number]"]=r0["[object Object]"]=r0["[object RegExp]"]=r0["[object Set]"]=r0["[object String]"]=r0["[object WeakMap]"]=!1;var r1=t&&!t.nodeType&&t,r2=r1&&e&&!e.nodeType&&e,r5=r2&&r2.exports===r1&&t2.process,r3=function(){try{return r2&&r2.require&&r2.require("util").types||r5&&r5.binding&&r5.binding("util")}catch{}}(),r4=r3&&r3.isTypedArray,r6=r4?function(e){return r4(e)}:function(e){return rn(e)&&rj(e.length)&&!!r0[rr(e)]},r9=Object.prototype.hasOwnProperty;function r8(e){return rB(e)?function(e,t){var r=rs(e),n=!r&&rq(e),i=!r&&!n&&rJ(e),s=!r&&!n&&!i&&r6(e),a=r||n||i||s,o=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=o.length;for(var u in e)a&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||rD(u,l))||o.push(u);return o}(e):function(e){if(!rc(e)){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var n=rW(e),i=[];for(var s in e)"constructor"==s&&(n||!r9.call(e,s))||i.push(s);return i}(e)}var r7=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ne=/^\w*$/,nt=rv(Object,"create"),nr=Object.prototype.hasOwnProperty,nn=Object.prototype.hasOwnProperty;function ni(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ns(e,t){for(var r=e.length;r--;)if(rL(e[r][0],t))return r;return -1}ni.prototype.clear=function(){this.__data__=nt?nt(null):{},this.size=0},ni.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t},ni.prototype.get=function(e){var t=this.__data__;if(nt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return nr.call(t,e)?t[e]:void 0},ni.prototype.has=function(e){var t=this.__data__;return nt?void 0!==t[e]:nn.call(t,e)},ni.prototype.set=function(e,t){var r=this.__data__;return this.size+=+!this.has(e),r[e]=nt&&void 0===t?"__lodash_hash_undefined__":t,this};var na=Array.prototype.splice;function no(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}no.prototype.clear=function(){this.__data__=[],this.size=0},no.prototype.delete=function(e){var t=this.__data__,r=ns(t,e);return!(r<0)&&(r==t.length-1?t.pop():na.call(t,r,1),--this.size,!0)},no.prototype.get=function(e){var t=this.__data__,r=ns(t,e);return r<0?void 0:t[r][1]},no.prototype.has=function(e){return ns(this.__data__,e)>-1},no.prototype.set=function(e,t){var r=this.__data__,n=ns(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var nl=rv(t3,"Map");function nu(e,t){var r,n=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?n["string"==typeof t?"string":"hash"]:n.map}function nc(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function nh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var a=e.apply(this,n);return r.cache=s.set(i,a)||s,a};return r.cache=new(nh.Cache||nc),r}nc.prototype.clear=function(){this.size=0,this.__data__={hash:new ni,map:new(nl||no),string:new ni}},nc.prototype.delete=function(e){var t=nu(this,e).delete(e);return this.size-=!!t,t},nc.prototype.get=function(e){return nu(this,e).get(e)},nc.prototype.has=function(e){return nu(this,e).has(e)},nc.prototype.set=function(e,t){var r=nu(this,e),n=r.size;return r.set(e,t),this.size+=+(r.size!=n),this},nh.Cache=nc;var nd=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,nm=/\\(\\)?/g,ng=(sC=(sp=nh(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(nd,function(e,r,n,i){t.push(n?i.replace(nm,"$1"):r||e)}),t},function(e){return 500===sC.size&&sC.clear(),e})).cache,sp);function nf(e,t){return rs(e)?e:!function(e,t){if(rs(e))return!1;var r=typeof e;return!!("number"==r||"symbol"==r||"boolean"==r||null==e||ri(e))||ne.test(e)||!r7.test(e)||null!=t&&e in Object(t)}(e,t)?ng(null==e?"":function e(t){if("string"==typeof t)return t;if(rs(t))return function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(t,e)+"";if(ri(t))return ro?ro.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}(e)):[e]}function np(e){if("string"==typeof e||ri(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function nC(e,t,r){var n=null==e?void 0:function(e,t){t=nf(t,e);for(var r=0,n=t.length;null!=e&&r<n;)e=e[np(t[r++])];return r&&r==n?e:void 0}(e,t);return void 0===n?r:n}var n_=(s_=Object.getPrototypeOf,sy=Object,function(e){return s_(sy(e))}),ny=Object.prototype,nR=Function.prototype.toString,nE=ny.hasOwnProperty,nb=nR.call(Object);function nI(e){var t=this.__data__=new no(e);this.size=t.size}nI.prototype.clear=function(){this.__data__=new no,this.size=0},nI.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},nI.prototype.get=function(e){return this.__data__.get(e)},nI.prototype.has=function(e){return this.__data__.has(e)},nI.prototype.set=function(e,t){var r=this.__data__;if(r instanceof no){var n=r.__data__;if(!nl||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new nc(n)}return r.set(e,t),this.size=r.size,this};var nN=t&&!t.nodeType&&t,nS=nN&&e&&!e.nodeType&&e,nA=nS&&nS.exports===nN?t3.Buffer:void 0;nA&&nA.allocUnsafe;var nv=t3.Uint8Array,nT=function(e,t,r){for(var n=-1,i=Object(e),s=r(e),a=s.length;a--;){var o=s[++n];if(!1===t(i[o],o,i))break}return e},nw=function(){return t3.Date.now()},nM=Math.max,nO=Math.min;function nx(e,t,r){var n,i,s,a,o,l,u=0,c=!1,h=!1,d=!0;if("function"!=typeof e)throw TypeError("Expected a function");function m(t){var r=n,s=i;return n=i=void 0,u=t,a=e.apply(s,r)}function g(e){var r=e-l,n=e-u;return void 0===l||r>=t||r<0||h&&n>=s}function f(){var e,r,n,i=nw();if(g(i))return p(i);o=setTimeout(f,(e=i-l,r=i-u,n=t-e,h?nO(n,s-r):n))}function p(e){return o=void 0,d&&n?m(e):(n=i=void 0,a)}function C(){var e,r=nw(),s=g(r);if(n=arguments,i=this,l=r,s){if(void 0===o)return u=e=l,o=setTimeout(f,t),c?m(e):a;if(h)return clearTimeout(o),o=setTimeout(f,t),m(l)}return void 0===o&&(o=setTimeout(f,t)),a}return t=rp(t)||0,rc(r)&&(c=!!r.leading,s=(h="maxWait"in r)?nM(rp(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d),C.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=l=i=o=void 0},C.flush=function(){return void 0===o?a:p(nw())},C}function nU(e,t,r){(void 0===r||rL(e[t],r))&&(void 0!==r||t in e)||rV(e,t,r)}function nD(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function nV(e,t,r,n,i){e!==t&&nT(t,function(s,a){if(i||(i=new nI),rc(s))!function(e,t,r,n,i,s,a){var o=nD(e,r),l=nD(t,r),u=a.get(l);if(u)return nU(e,r,u);var c=s?s(o,l,r+"",e,t,a):void 0,h=void 0===c;if(h){var d,m,g=rs(l),f=!g&&rJ(l),p=!g&&!f&&r6(l);c=l,g||f||p?rs(o)?c=o:rn(o)&&rB(o)?c=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(o):f?(h=!1,c=l.slice()):p?(h=!1,new nv(m=new(d=l.buffer).constructor(d.byteLength)).set(new nv(d)),c=new l.constructor(m,l.byteOffset,l.length)):c=[]:function(e){if(!rn(e)||"[object Object]"!=rr(e))return!1;var t=n_(e);if(null===t)return!0;var r=nE.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&nR.call(r)==nb}(l)||rq(l)?(c=o,rq(o)?c=function(e,t,r,n){var i=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=void 0;void 0===l&&(l=e[o]),i?rV(r,o,l):rk(r,o,l)}return r}(o,r8(o)):(!rc(o)||r_(o))&&(c="function"!=typeof l.constructor||rW(l)?{}:rw(n_(l)))):h=!1}h&&(a.set(l,c),i(c,l,n,s,a),a.delete(l)),nU(e,r,c)}(e,t,a,r,nV,n,i);else{var o=n?n(nD(e,a),s,a+"",e,t,i):void 0;void 0===o&&(o=s),nU(e,a,o)}},r8)}var nL=r$(function(e,t,r,n){nV(e,t,r,n)}),nP=r$(function(e,t,r){nV(e,t,r)});function nk(e,t,r){return null==e?e:function(e,t,r,n){if(!rc(e))return e;t=nf(t,e);for(var i=-1,s=t.length,a=s-1,o=e;null!=o&&++i<s;){var l=np(t[i]),u=r;if("__proto__"===l||"constructor"===l||"prototype"===l)break;if(i!=a){var c=o[l];u=void 0,u=rc(c)?c:rD(t[i+1])?[]:{}}rk(o,l,u),o=o[l]}return e}(e,t,r)}class nF{constructor(){tg(this,"cursor",0)}reset(){return this.cursor=0,this}moveCursor(e){this.cursor+=e}moveCursorTo(e){this.cursor=e}}function nj(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function nB(e){return/^-?\d+(\.\d+)?$/.test(e)}function n$(e){return!!nB(e)&&Number(e)<=Number.MAX_SAFE_INTEGER}function nH(e){return Number(e)>Number.MAX_SAFE_INTEGER||e.length>=18}class nW{constructor(){tg(this,"_data",[])}static create(){return new nW}add(e){this._data.indexOf(e)>-1||this._data.push(e)}delete(e){let t=this._data.indexOf(e);this._data.splice(t,1)}getData(){return this._data}}class nG{constructor(){tg(this,"_data",new Map)}static create(){return new nG}add(e,t){this._data.has(e)||this._data.set(e,t)}delete(e){this._data.delete(e)}getData(){return this._data}}function nY(e){let t=new MessageChannel,r=!1;return t.port1.onmessage=()=>{r||e()},t.port2.postMessage(null),()=>{r=!0,t.port1.onmessage=null,t.port1.close(),t.port2.close()}}async function nz(e){for(let[t,r]of e.entries())try{if(!await r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}function nX(e){for(let[t,r]of e.entries())try{if(!r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}function nq(e,t){return t.forEach(t=>e.add(t)),e}function nK(e){let t=!1;return e?e instanceof ta.Subscription||e instanceof ts.Subject||e&&"closed"in e&&"u">typeof e.unsubscribe?{dispose:()=>e.unsubscribe()}:"function"==typeof e?{dispose:()=>{t||(t=!0,e())}}:e:nK(()=>{})}function nQ(e){return nK(()=>{e.unsubscribe()})}class nZ{constructor(){tg(this,"_disposables",new Set)}add(e){let t=nK(e);return this._disposables.add(t),{dispose:(e=!1)=>{e||t.dispose(),this._disposables.delete(t)}}}dispose(){this._disposables.forEach(e=>{e.dispose()}),this._disposables.clear()}}class nJ{constructor(){tg(this,"_disposed",!1),tg(this,"_collection",new nZ)}disposeWithMe(e){return this._collection.add(e)}ensureNotDisposed(){if(this._disposed)throw Error("[Disposable]: object is disposed!")}dispose(){this._disposed||(this._disposed=!0,this._collection.dispose())}}class n0 extends nJ{constructor(){super(...arguments),tg(this,"dispose$",new(0,ts.Subject))}dispose(){super.dispose(),this.dispose$.next(),this.dispose$.complete()}}class n1 extends nJ{constructor(e){super(),tg(this,"_ref",0),this._rootDisposable=e}inc(){if(this._disposed)throw Error("[RCDisposable]: should not ref to a disposed.");this._ref+=1}dec(){this._ref-=1,0===this._ref&&(this._rootDisposable.dispose(),this.dispose())}}var n2=((s=n2||{})[s.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",s[s.UNIVER_DOC=1]="UNIVER_DOC",s[s.UNIVER_SHEET=2]="UNIVER_SHEET",s[s.UNIVER_SLIDE=3]="UNIVER_SLIDE",s[s.UNIVER_PROJECT=4]="UNIVER_PROJECT",s[s.UNRECOGNIZED=-1]="UNRECOGNIZED",s),n5=((a=n5||{})[a.Reader=0]="Reader",a[a.Editor=1]="Editor",a[a.Owner=2]="Owner",a[a.UNRECOGNIZED=-1]="UNRECOGNIZED",a),n3=((o=n3||{})[o.SomeCollaborator=0]="SomeCollaborator",o[o.AllCollaborator=1]="AllCollaborator",o[o.OneSelf=2]="OneSelf",o[o.UNRECOGNIZED=-1]="UNRECOGNIZED",o);class n4 extends nJ{}let n6=e=>crypto.getRandomValues(new Uint8Array(e)),n9=new Set(["ac","ad","ae","aero","af","ag","ai","al","am","ao","aq","ar","arpa","as","asia","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","biz","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cat","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","com","coop","cr","cu","cv","cw","cx","cy","cz","de","dj","dk","dm","do","dz","ec","edu","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gov","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","info","int","io","iq","ir","is","it","je","jm","jo","jobs","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mil","mk","ml","mm","mn","mo","mobi","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","nc","ne","net","nf","ng","ni","nl","no","np","nr","nu","nz","om","onion","org","pa","pe","pf","pg","ph","pk","pl","pm","pn","post","pr","pro","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tel","tf","tg","th","tj","tk","tl","tm","tn","to","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","yt","za","zm","zw"]),n8=RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");function n7(e){return/^[a-zA-Z]+:\/\//.test(e)}function ie(e){return n7(e)?e:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e)?`mailto://${e}`:`https://${e}`}let it=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];class ir{static deleteNull(e){for(let t in e)(null===e[t]||void 0===e[t])&&delete e[t];return e}static stringAt(e){let t="",r=e;for(;r>=it.length;)r/=it.length,r-=1,t+=it[r%it.length];let n=e%it.length;return t+it[n]}static indexAt(e){let t=0;for(let r=0;r<e.length-1;r+=1){let n=e.charCodeAt(r)-65,i=e.length-1-r;t+=it.length**i+it.length*n}return t+(e.charCodeAt(e.length-1)-65)}static deleteBlank(e){return ir.isString(e)?e.replace(/\s/g,""):e}static getSystemType(){let e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,r="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(r)return"Mac";if("X11"===navigator.platform&&!t&&!r)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Windows 2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"Windows XP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Windows 2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"Windows Vista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Windows 7";if(e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1)return"Windows 10";if(e.indexOf("Windows NT 11")>-1||e.indexOf("Windows 11")>-1)return"Windows 11"}return"Unknown system"}static getBrowserType(){let e=navigator.userAgent,t=e.indexOf("Opera")>-1,r=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t,n=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1,i=e.indexOf("Edge")>-1,s=e.indexOf("Firefox")>-1,a=e.indexOf("Safari")>-1&&-1===e.indexOf("Chrome"),o=e.indexOf("Chrome")>-1&&e.indexOf("Safari")>-1;if(r){RegExp("MSIE (\\d+\\.\\d+);").test(e);let t=Number.parseFloat(RegExp.$1);return 7===t?"IE7":8===t?"IE8":9===t?"IE9":10===t?"IE10":"0"}return s?"FF":t?"Opera":a?"Safari":o?"Chrome":i?"Edge":n?"IE11":"Unknown browser"}static getClassName(e){return e.constructor.name}static deepMerge(e,...t){function r(e,t){e.forEach((e,i)=>{var s,a;if(ir.isArray(e)){let n=null!=(s=t[i])?s:[];t[i]=n,r(e,n);return}if(ir.isObject(e)){let r=null!=(a=t[i])?a:{};t[i]=r,n(e,r);return}t[i]=e})}function n(e,t){Object.keys(e).forEach(i=>{var s,a;let o=e[i];if(ir.isObject(o)){let e=null!=(s=t[i])?s:{};t[i]=e,n(o,e);return}if(ir.isArray(o)){let e=null!=(a=t[i])?a:[];t[i]=e,r(o,e);return}t[i]=o})}return t.forEach(t=>{var i;return t&&void Object.keys(i=t).forEach(t=>{var s,a;let o=i[t];if(ir.isArray(o)){let n=null!=(s=e[t])?s:[];e[t]=n,r(o,n);return}if(ir.isObject(o)){let r=null!=(a=e[t])?a:{};e[t]=r,n(o,r);return}e[t]=o})}),e}static numberFixed(e,t){return Number(Number(e).toFixed(t))}static diffValue(e,t){return function e(t,r){return ir.getValueType(t)===ir.getValueType(r)&&(ir.isArray(t)?function(t,r){if(t.length!==r.length)return!1;for(let n=0,i=t.length;n<i;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):ir.isObject(t)?function(t,r){let n=Object.keys(t),i=Object.keys(r);if(n.length!==i.length)return!1;for(let s of n)if(!i.includes(s)||!e(t[s],r[s]))return!1;return!0}(t,r):ir.isDate(t)?t.getTime()===r.getTime():ir.isRegExp(t)?t.toString()===r.toString():t===r)}(e,t)}static deepClone(e){if(!this.isDefine(e))return e;if(this.isRegExp(e))return new RegExp(e);if(this.isDate(e))return new Date(e);if(this.isArray(e)){let t=[];return e.forEach((e,r)=>{t[r]=ir.deepClone(e)}),t}if(this.isObject(e)){let t={};return Object.keys(e).forEach(r=>{let n=e[r];t[r]=ir.deepClone(n)}),Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}static getLanguage(){return globalThis.navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||"en-US"}static getValueType(e){return Object.prototype.toString.apply(e)}static isDefine(e){return null!=e}static isBlank(e){return!this.isDefine(e)||!!this.isString(e)&&""===e.trim()}static isPlainObject(e){return!!this.isDefine(e)&&Object.getPrototypeOf(e)===Object.getPrototypeOf({})}static isDate(e){return"[object Date]"===this.getValueType(e)}static isRegExp(e){return"[object RegExp]"===this.getValueType(e)}static isArray(e){return"[object Array]"===this.getValueType(e)}static isString(e){return"[object String]"===this.getValueType(e)}static isNumber(e){return"[object Number]"===this.getValueType(e)}static isStringNumber(e){return!isNaN(Number.parseFloat(e))&&isFinite(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isEmptyObject(e){for(let t in e)return!1;return!0}static isTablet(){return/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase())}static isIPhone(){return/iPhone/i.test(navigator.userAgent)}static isLegalUrl(e){if(!Number.isNaN(+e))return!1;if(e.startsWith("http://localhost:3002")||e.startsWith("localhost:3002"))return!0;if(n8.test(e)){if(n7(e))return!0;try{let t=new URL(ie(e)).hostname.split(".").pop();if(t&&n9.has(t))return!0}catch{}}return!1}static normalizeUrl(e){return ie(e)}static topLevelDomainCombiningString(){return[...n9].join("|")}static removeNull(e){return this.isObject(e)&&Object.keys(e).forEach(t=>{let r=e[t];null==r?delete e[t]:ir.removeNull(r)}),e}static fillTwoDimensionalArray(e,t,r){return Array(e).fill(r).map(e=>Array(t).fill(r))}static numToWord(e){let t="";for(;e>0;){let r=e%26;t=String.fromCharCode(96+(r=0===r?r=26:r))+t,e=(e-r)/26}return t.toLocaleUpperCase()}static ABCatNum(e){if(null==e||0===e.length)return NaN;let t=e.toLowerCase().split(""),r=t.length,n=0;for(let e=0;e<r;e++)n+=(t[e].charCodeAt(0)-96)*26**(r-e-1);return 0===n?NaN:n-1}static chatAtABC(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}static commonExtend(e,t){let r={};for(let t in e)r[t]=e[t];for(let e in t)null!=t[e]&&(r[e]=t[e]);return r}static hasIntersectionBetweenTwoRanges(e,t,r,n){return t>=r&&n>=e}static isStartValidPosition(e){return/^[A-Za-z_]/.test(e)}static isValidParameter(e){let t=/[~!@#$%^&*()+=\-{}\[\]\|:;"'<>,?\/ ]+/.test(e),r=e.length<=255;return!t&&r}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static now(){return performance&&performance.now?performance.now():Date.now()}}function ii(e=21,t){return t?((e,t=21)=>{var r;let n,i;return r=0|t,i=-~(1.6*(n=(2<<Math.log2(e.length-1))-1)*r/e.length),(t=r)=>{let s="";for(;;){let r=n6(i),a=0|i;for(;a--;)if((s+=e[r[a]&n]||"").length>=t)return s}}})(t,e)():((e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t})(e)}function is(...e){let t={},r=e.length;for(let n=r-1;n>=0;n--){let r=e[n];if(r)for(let e of Object.keys(r))void 0===t[e]&&(t[e]=r[e])}return t}let ia=()=>!1;var io=((l=io||{})[l.DEFAULT_SERIES=0]="DEFAULT_SERIES",l[l.ALTERNATE_SERIES=1]="ALTERNATE_SERIES",l),il=((c=il||{})[c.NONE=0]="NONE",c[c.THIN=1]="THIN",c[c.HAIR=2]="HAIR",c[c.DOTTED=3]="DOTTED",c[c.DASHED=4]="DASHED",c[c.DASH_DOT=5]="DASH_DOT",c[c.DASH_DOT_DOT=6]="DASH_DOT_DOT",c[c.DOUBLE=7]="DOUBLE",c[c.MEDIUM=8]="MEDIUM",c[c.MEDIUM_DASHED=9]="MEDIUM_DASHED",c[c.MEDIUM_DASH_DOT=10]="MEDIUM_DASH_DOT",c[c.MEDIUM_DASH_DOT_DOT=11]="MEDIUM_DASH_DOT_DOT",c[c.SLANT_DASH_DOT=12]="SLANT_DASH_DOT",c[c.THICK=13]="THICK",c),iu=((h=iu||{}).TOP="top",h.BOTTOM="bottom",h.LEFT="left",h.RIGHT="right",h.NONE="none",h.ALL="all",h.OUTSIDE="outside",h.INSIDE="inside",h.HORIZONTAL="horizontal",h.VERTICAL="vertical",h.TLBR="tlbr",h.TLBC_TLMR="tlbc_tlmr",h.TLBR_TLBC_TLMR="tlbr_tlbc_tlmr",h.BLTR="bl_tr",h.MLTR_BCTR="mltr_bctr",h),ic=((d=ic||{})[d.UNSUPPORTED=0]="UNSUPPORTED",d[d.RGB=1]="RGB",d[d.HEX=2]="HEX",d[d.THEME=3]="THEME",d),ih=((m=ih||{})[m.ON=0]="ON",m[m.OFF=1]="OFF",m),id=((g=id||{})[g.PASTE_NORMAL=0]="PASTE_NORMAL",g[g.PASTE_NO_BORDERS=1]="PASTE_NO_BORDERS",g[g.PASTE_FORMAT=2]="PASTE_FORMAT",g[g.PASTE_FORMULA=3]="PASTE_FORMULA",g[g.PASTE_DATA_VALIDATION=4]="PASTE_DATA_VALIDATION",g[g.PASTE_VALUES=5]="PASTE_VALUES",g[g.PASTE_CONDITIONAL_FORMATTING=6]="PASTE_CONDITIONAL_FORMATTING",g[g.PASTE_COLUMN_WIDTHS=7]="PASTE_COLUMN_WIDTHS",g),im=((f=im||{})[f.LEFT=0]="LEFT",f[f.RIGHT=1]="RIGHT",f),ig=((p=ig||{})[p.DOCUMENT=0]="DOCUMENT",p[p.PROJECT=1]="PROJECT",p),ip=((C=ip||{})[C.COLUMNS=0]="COLUMNS",C[C.ROWS=1]="ROWS",C),iC=((_=iC||{})[_.UP=0]="UP",_[_.RIGHT=1]="RIGHT",_[_.DOWN=2]="DOWN",_[_.LEFT=3]="LEFT",_);function i_(e){switch(e){case 3:return 1;case 1:return 3;case 0:return 2;case 2:return 0}}var iy=((y=iy||{})[y.INTERPOLATION_POINT_TYPE_UNSPECIFIED=0]="INTERPOLATION_POINT_TYPE_UNSPECIFIED",y[y.MIN=1]="MIN",y[y.MAX=2]="MAX",y[y.NUMBER=3]="NUMBER",y[y.PERCENT=4]="PERCENT",y[y.PERCENTILE=5]="PERCENTILE",y),iR=((R=iR||{}).EN_US="enUS",R.FR_FR="frFR",R.ZH_CN="zhCN",R.RU_RU="ruRU",R.ZH_TW="zhTW",R.VI_VN="viVN",R.FA_IR="faIR",R.KO_KR="koKR",R.ES_ES="esES",R.CA_ES="caES",R),iE=((E=iE||{})[E.PERSON=0]="PERSON",E[E.FILE=1]="FILE",E[E.DATE=2]="DATE",E[E.LOCATION=3]="LOCATION",E[E.EVENT=4]="EVENT",E),ib=((b=ib||{})[b.RANGE=0]="RANGE",b[b.SHEET=1]="SHEET",b),iI=((I=iI||{}).Line="line",I.LineInv="lineInv",I.Triangle="triangle",I.RtTriangle="rtTriangle",I.Rect="rect",I.Diamond="diamond",I.Parallelogram="parallelogram",I.Trapezoid="trapezoid",I.NonIsocelesTrapezoid="nonIsocelesTrapezoid",I.Pentagon="pentagon",I.Hexagon="hexagon",I.Heptagon="heptagon",I.Octagon="octagon",I.Decagon="decagon",I.Dodecagon="dodecagon",I.Star4="star4",I.Star5="star5",I.Star6="star6",I.Star7="star7",I.Star8="star8",I.Star10="star10",I.Star12="star12",I.Star16="star16",I.Star24="star24",I.Star32="star32",I.RoundRect="roundRect",I.Round1Rect="round1Rect",I.Round2SameRect="round2SameRect",I.Round2DiagRect="round2DiagRect",I.Ellipse="ellipse",I),iN=((N=iN||{}).RightArrow="rightArrow",N.LeftArrow="leftArrow",N.UpArrow="upArrow",N.DownArrow="downArrow",N.LeftRightArrow="leftRightArrow",N.UpDownArrow="upDownArrow",N.QuadArrow="quadArrow",N.LeftRightUpArrow="leftRightUpArrow",N.BentArrow="bentArrow",N.UturnArrow="uturnArrow",N.CircularArrow="circularArrow",N.NotchedRightArrow="notchedRightArrow",N.HomePlate="homePlate",N.Chevron="chevron",N.LeftCircularArrow="leftCircularArrow",N.LeftRightCircularArrow="leftRightCircularArrow",N),iS=((S=iS||{}).Plaque="plaque",S.Can="can",S.Cube="cube",S.Bevel="bevel",S.Donut="donut",S.NoSmoking="noSmoking",S.BlockArc="blockArc",S.FoldedCorner="foldedCorner",S),iA=((A=iA||{}).SmileyFace="smileyFace",A.Heart="heart",A.LightningBolt="lightningBolt",A.Sun="sun",A.Moon="moon",A.Cloud="cloud",A.Arc="arc",A.Backpack="backpack",A.Frame="frame",A.HalfFrame="halfFrame",A.Corner="corner",A.Chord="chord",A.Pie="pie",A.Teardrop="teardrop",A.WedgeRectCallout="wedgeRectCallout",A.WedgeRRectCallout="wedgeRRectCallout",A.WedgeEllipseCallout="wedgeEllipseCallout",A.CloudCallout="cloudCallout",A.BorderCallout1="borderCallout1",A.BorderCallout2="borderCallout2",A.BorderCallout3="borderCallout3",A.AccentCallout1="accentCallout1",A.AccentCallout2="accentCallout2",A.AccentCallout3="accentCallout3",A.Callout1="callout1",A.Callout2="callout2",A.Callout3="callout3",A.ActionButtonBackPrevious="actionButtonBackPrevious",A.ActionButtonEnd="actionButtonEnd",A.ActionButtonForwardNext="actionButtonForwardNext",A.ActionButtonHelp="actionButtonHelp",A.ActionButtonHome="actionButtonHome",A.ActionButtonInformation="actionButtonInformation",A.ActionButtonMovie="actionButtonMovie",A.ActionButtonReturn="actionButtonReturn",A.ActionButtonSound="actionButtonSound",A),iv=((v=iv||{})[v.RELATIVE_DATE_UNSPECIFIED=0]="RELATIVE_DATE_UNSPECIFIED",v[v.PAST_YEAR=1]="PAST_YEAR",v[v.PAST_MONTH=2]="PAST_MONTH",v[v.PAST_WEEK=3]="PAST_WEEK",v[v.YESTERDAY=4]="YESTERDAY",v[v.TODAY=5]="TODAY",v[v.TOMORROW=6]="TOMORROW",v),iT=((T=iT||{})[T.GRID=0]="GRID",T[T.KANBAN=1]="KANBAN",T[T.GANTT=2]="GANTT",T),iw=((w=iw||{})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",w[w.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT",w),iM=((M=iM||{})[M.DASH=0]="DASH",M[M.DASH_DOT_DOT_HEAVY=1]="DASH_DOT_DOT_HEAVY",M[M.DASH_DOT_HEAVY=2]="DASH_DOT_HEAVY",M[M.DASHED_HEAVY=3]="DASHED_HEAVY",M[M.DASH_LONG=4]="DASH_LONG",M[M.DASH_LONG_HEAVY=5]="DASH_LONG_HEAVY",M[M.DOT_DASH=6]="DOT_DASH",M[M.DOT_DOT_DASH=7]="DOT_DOT_DASH",M[M.DOTTED=8]="DOTTED",M[M.DOTTED_HEAVY=9]="DOTTED_HEAVY",M[M.DOUBLE=10]="DOUBLE",M[M.NONE=11]="NONE",M[M.SINGLE=12]="SINGLE",M[M.THICK=13]="THICK",M[M.WAVE=14]="WAVE",M[M.WAVY_DOUBLE=15]="WAVY_DOUBLE",M[M.WAVY_HEAVY=16]="WAVY_HEAVY",M[M.WORDS=17]="WORDS",M),iO=((O=iO||{})[O.UNSPECIFIED=0]="UNSPECIFIED",O[O.LEFT=1]="LEFT",O[O.CENTER=2]="CENTER",O[O.RIGHT=3]="RIGHT",O[O.JUSTIFIED=4]="JUSTIFIED",O[O.BOTH=5]="BOTH",O[O.DISTRIBUTED=6]="DISTRIBUTED",O),ix=((x=ix||{})[x.UNSPECIFIED=0]="UNSPECIFIED",x[x.TOP=1]="TOP",x[x.MIDDLE=2]="MIDDLE",x[x.BOTTOM=3]="BOTTOM",x),iU=((U=iU||{})[U.UNSPECIFIED=0]="UNSPECIFIED",U[U.OVERFLOW=1]="OVERFLOW",U[U.CLIP=2]="CLIP",U[U.WRAP=3]="WRAP",U),iD=((D=iD||{})[D.NORMAL=0]="NORMAL",D[D.ITALIC=1]="ITALIC",D),iV=((V=iV||{})[V.NORMAL=0]="NORMAL",V[V.BOLD=1]="BOLD",V),iL=((L=iL||{})[L.NORMAL=1]="NORMAL",L[L.SUBSCRIPT=2]="SUBSCRIPT",L[L.SUPERSCRIPT=3]="SUPERSCRIPT",L),iP=((P=iP||{})[P.FALSE=0]="FALSE",P[P.TRUE=1]="TRUE",P),ik=((k=ik||{})[k.STRING=1]="STRING",k[k.NUMBER=2]="NUMBER",k[k.BOOLEAN=3]="BOOLEAN",k[k.FORCE_STRING=4]="FORCE_STRING",k),iF=((F=iF||{})[F.DARK1=0]="DARK1",F[F.LIGHT1=1]="LIGHT1",F[F.DARK2=2]="DARK2",F[F.LIGHT2=3]="LIGHT2",F[F.ACCENT1=4]="ACCENT1",F[F.ACCENT2=5]="ACCENT2",F[F.ACCENT3=6]="ACCENT3",F[F.ACCENT4=7]="ACCENT4",F[F.ACCENT5=8]="ACCENT5",F[F.ACCENT6=9]="ACCENT6",F[F.HYPERLINK=10]="HYPERLINK",F[F.FOLLOWED_HYPERLINK=11]="FOLLOWED_HYPERLINK",F),ij=((j=ij||{}).OFFICE="Office",j.OFFICE_2007_2010="Office 2007-2010",j.GRAYSCALE="Grayscale",j.BLUE_WARM="Blue Warm",j.BLUE="Blue",j.BLUE_II="Blue II",j.BLUE_GREEN="Blue Green",j.GREEN="Green",j.GREEN_YELLOW="Green Yellow",j.YELLOW="Yellow",j.YELLOW_ORANGE="Yellow Orange",j.ORANGE="Orange",j.ORANGE_RED="Orange Red",j.RED_ORANGE="Red Orange",j.RED="Red",j.RED_VIOLET="Red Violet",j.VIOLET="Violet",j.VIOLET_II="Violet II",j.MEDIAN="Median",j.PAPER="Paper",j.MARQUEE="Marquee",j.SLIPSTREAM="Slipstream",j.Aspect="Aspect",j),iB=((B=iB||{})[B.character=0]="character",B[B.paragraph=1]="paragraph",B[B.table=2]="table",B[B.numbering=3]="numbering",B),i$=(($=i$||{})[$.TAB=0]="TAB",$[$.SPACE=1]="SPACE",$[$.NOTHING=2]="NOTHING",$),iH=((H=iH||{})[H.BULLET=0]="BULLET",H[H.NONE=1]="NONE",H[H.DECIMAL=2]="DECIMAL",H[H.DECIMAL_ZERO=3]="DECIMAL_ZERO",H[H.UPPER_LETTER=4]="UPPER_LETTER",H[H.LOWER_LETTER=5]="LOWER_LETTER",H[H.UPPER_ROMAN=6]="UPPER_ROMAN",H[H.LOWER_ROMAN=7]="LOWER_ROMAN",H[H.ORDINAL=8]="ORDINAL",H[H.CARDINAL_TEXT=9]="CARDINAL_TEXT",H[H.ORDINAL_TEXT=10]="ORDINAL_TEXT",H[H.HEX=11]="HEX",H[H.CHICAGO=12]="CHICAGO",H[H.IDEOGRAPH_DIGITAL=13]="IDEOGRAPH_DIGITAL",H[H.JAPANESE_COUNTING=14]="JAPANESE_COUNTING",H[H.AIUEO=15]="AIUEO",H[H.IROHA=16]="IROHA",H[H.DECIMAL_FULL_WIDTH=17]="DECIMAL_FULL_WIDTH",H[H.DECIMAL_HALF_WIDTH=18]="DECIMAL_HALF_WIDTH",H[H.JAPANESE_LEGAL=19]="JAPANESE_LEGAL",H[H.JAPANESE_DIGITAL_TEN_THOUSAND=20]="JAPANESE_DIGITAL_TEN_THOUSAND",H[H.DECIMAL_ENCLOSED_CIRCLE=21]="DECIMAL_ENCLOSED_CIRCLE",H[H.DECIMAL_FULL_WIDTH2=22]="DECIMAL_FULL_WIDTH2",H[H.AIUEO_FULL_WIDTH=23]="AIUEO_FULL_WIDTH",H[H.IROHA_FULL_WIDTH=24]="IROHA_FULL_WIDTH",H[H.GANADA=25]="GANADA",H[H.CHOSUNG=26]="CHOSUNG",H[H.DECIMAL_ENCLOSED_FULLSTOP=27]="DECIMAL_ENCLOSED_FULLSTOP",H[H.DECIMAL_ENCLOSED_PAREN=28]="DECIMAL_ENCLOSED_PAREN",H[H.DECIMAL_ENCLOSED_CIRCLE_CHINESE=29]="DECIMAL_ENCLOSED_CIRCLE_CHINESE",H[H.IDEOGRAPH_ENCLOSED_CIRCLE=30]="IDEOGRAPH_ENCLOSED_CIRCLE",H[H.IDEOGRAPH_TRADITIONAL=31]="IDEOGRAPH_TRADITIONAL",H[H.IDEOGRAPH_ZODIAC=32]="IDEOGRAPH_ZODIAC",H[H.IDEOGRAPH_ZODIAC_TRADITIONAL=33]="IDEOGRAPH_ZODIAC_TRADITIONAL",H[H.TAIWANESE_COUNTING=34]="TAIWANESE_COUNTING",H[H.IDEOGRAPH_LEGAL_TRADITIONAL=35]="IDEOGRAPH_LEGAL_TRADITIONAL",H[H.TAIWANESE_COUNTING_THOUSAND=36]="TAIWANESE_COUNTING_THOUSAND",H[H.TAIWANESE_DIGITAL=37]="TAIWANESE_DIGITAL",H[H.CHINESE_COUNTING=38]="CHINESE_COUNTING",H[H.CHINESE_LEGAL_SIMPLIFIED=39]="CHINESE_LEGAL_SIMPLIFIED",H[H.CHINESE_COUNTING_THOUSAND=40]="CHINESE_COUNTING_THOUSAND",H[H.KOREAN_DIGITAL=41]="KOREAN_DIGITAL",H[H.KOREAN_COUNTING=42]="KOREAN_COUNTING",H[H.KOREAN_LEGAL=43]="KOREAN_LEGAL",H[H.KOREAN_DIGITAL2=44]="KOREAN_DIGITAL2",H[H.VIETNAMESE_COUNTING=45]="VIETNAMESE_COUNTING",H[H.RUSSIAN_LOWER=46]="RUSSIAN_LOWER",H[H.RUSSIAN_UPPER=47]="RUSSIAN_UPPER",H[H.NUMBER_IN_DASH=48]="NUMBER_IN_DASH",H[H.HEBREW1=49]="HEBREW1",H[H.HEBREW2=50]="HEBREW2",H[H.ARABIC_ALPHA=51]="ARABIC_ALPHA",H[H.ARABIC_ABJAD=52]="ARABIC_ABJAD",H[H.HINDI_VOWELS=53]="HINDI_VOWELS",H[H.HINDI_CONSONANTS=54]="HINDI_CONSONANTS",H[H.HINDI_NUMBERS=55]="HINDI_NUMBERS",H[H.HINDI_COUNTING=56]="HINDI_COUNTING",H[H.THAI_LETTERS=57]="THAI_LETTERS",H[H.THAI_NUMBERS=58]="THAI_NUMBERS",H[H.THAI_COUNTING=59]="THAI_COUNTING",H[H.CUSTOM=60]="CUSTOM",H),iW=((W=iW||{})[W.BULLET_ALIGNMENT_UNSPECIFIED=0]="BULLET_ALIGNMENT_UNSPECIFIED",W[W.START=1]="START",W[W.CENTER=2]="CENTER",W[W.END=3]="END",W[W.BOTH=4]="BOTH",W),iG=((G=iG||{})[G.HYPERLINK=0]="HYPERLINK",G[G.FIELD=1]="FIELD",G[G.SDT=2]="SDT",G[G.BOOKMARK=3]="BOOKMARK",G[G.COMMENT=4]="COMMENT",G[G.CUSTOM=5]="CUSTOM",G[G.MENTION=6]="MENTION",G[G.UNI_FORMULA=7]="UNI_FORMULA",G[G.DELTED=9999]="DELTED",G),iY=((Y=iY||{})[Y.COMMENT=0]="COMMENT",Y[Y.DELETED=9999]="DELETED",Y),iz=((z=iz||{})[z.DRAWING=0]="DRAWING",z[z.CUSTOM=1]="CUSTOM",z),iX=((X=iX||{})[X.UNSPECIFIED=0]="UNSPECIFIED",X[X.TRADITIONAL=1]="TRADITIONAL",X[X.MODERN=2]="MODERN",X),iq=((q=iq||{})[q.DEFAULT=0]="DEFAULT",q[q.LINES=1]="LINES",q[q.LINES_AND_CHARS=2]="LINES_AND_CHARS",q[q.SNAP_TO_CHARS=3]="SNAP_TO_CHARS",q),iK=((K=iK||{})[K.SECTION_TYPE_UNSPECIFIED=0]="SECTION_TYPE_UNSPECIFIED",K[K.CONTINUOUS=1]="CONTINUOUS",K[K.NEXT_PAGE=2]="NEXT_PAGE",K[K.EVEN_PAGE=3]="EVEN_PAGE",K[K.ODD_PAGE=4]="ODD_PAGE",K),iQ=((Q=iQ||{})[Q.COLUMN_SEPARATOR_STYLE_UNSPECIFIED=0]="COLUMN_SEPARATOR_STYLE_UNSPECIFIED",Q[Q.NONE=1]="NONE",Q[Q.BETWEEN_EACH_COLUMN=2]="BETWEEN_EACH_COLUMN",Q),iZ=((Z=iZ||{})[Z.NORMAL=0]="NORMAL",Z[Z.TBRL=1]="TBRL",Z[Z.LRTBV=2]="LRTBV",Z),iJ=((J=iJ||{})[J.TEXT_RUN=0]="TEXT_RUN",J[J.AUTO_TEXT=1]="AUTO_TEXT",J[J.PAGE_BREAK=2]="PAGE_BREAK",J[J.COLUMN_BREAK=3]="COLUMN_BREAK",J[J.FOOT_NOTE_REFERENCE=4]="FOOT_NOTE_REFERENCE",J[J.HORIZONTAL_RULE=5]="HORIZONTAL_RULE",J[J.EQUATION=6]="EQUATION",J[J.DRAWING=7]="DRAWING",J[J.PERSON=8]="PERSON",J[J.RICH_LINK=9]="RICH_LINK",J),i0=((ee=i0||{})[ee.BOTH_SIDES=0]="BOTH_SIDES",ee[ee.LEFT=1]="LEFT",ee[ee.RIGHT=2]="RIGHT",ee[ee.LARGEST=3]="LARGEST",ee),i1=((et=i1||{})[et.INLINE=0]="INLINE",et[et.WRAP_NONE=1]="WRAP_NONE",et[et.WRAP_POLYGON=2]="WRAP_POLYGON",et[et.WRAP_SQUARE=3]="WRAP_SQUARE",et[et.WRAP_THROUGH=4]="WRAP_THROUGH",et[et.WRAP_TIGHT=5]="WRAP_TIGHT",et[et.WRAP_TOP_AND_BOTTOM=6]="WRAP_TOP_AND_BOTTOM",et),i2=((er=i2||{})[er.NAMED_STYLE_TYPE_UNSPECIFIED=0]="NAMED_STYLE_TYPE_UNSPECIFIED",er[er.NORMAL_TEXT=1]="NORMAL_TEXT",er[er.TITLE=2]="TITLE",er[er.SUBTITLE=3]="SUBTITLE",er[er.HEADING_1=4]="HEADING_1",er[er.HEADING_2=5]="HEADING_2",er[er.HEADING_3=6]="HEADING_3",er[er.HEADING_4=7]="HEADING_4",er[er.HEADING_5=8]="HEADING_5",er),i5=((en=i5||{})[en.AUTO=0]="AUTO",en[en.AT_LEAST=1]="AT_LEAST",en[en.EXACT=2]="EXACT",en),i3=((ei=i3||{})[ei.DASH_STYLE_UNSPECIFIED=0]="DASH_STYLE_UNSPECIFIED",ei[ei.SOLID=1]="SOLID",ei[ei.DOT=2]="DOT",ei[ei.DASH=3]="DASH",ei),i4=((es=i4||{})[es.TAB_STOP_ALIGNMENT_UNSPECIFIED=0]="TAB_STOP_ALIGNMENT_UNSPECIFIED",es[es.START=1]="START",es[es.CENTER=2]="CENTER",es[es.END=3]="END",es),i6=((ea=i6||{})[ea.UNSPECIFIED=0]="UNSPECIFIED",ea[ea.SPECIFIED=1]="SPECIFIED",ea),i9=((eo=i9||{})[eo.START=0]="START",eo[eo.CENTER=1]="CENTER",eo[eo.END=2]="END",eo),i8=((el=i8||{})[el.AUTO_FIT=0]="AUTO_FIT",el[el.FIXED=1]="FIXED",el),i7=((eu=i7||{})[eu.NONE=0]="NONE",eu[eu.WRAP=1]="WRAP",eu),se=((ec=se||{})[ec.AUTO=0]="AUTO",ec[ec.AT_LEAST=1]="AT_LEAST",ec[ec.EXACT=2]="EXACT",ec),st=((eh=st||{})[eh.CONTENT_ALIGNMENT_UNSPECIFIED=0]="CONTENT_ALIGNMENT_UNSPECIFIED",eh[eh.BOTH=1]="BOTH",eh[eh.TOP=2]="TOP",eh[eh.CENTER=3]="CENTER",eh[eh.BOTTOM=4]="BOTTOM",eh),sr=((ed=sr||{}).NORMAL="normal",ed.BOLD="bold",ed.ITALIC="italic",ed),sn=((em=sn||{})[em.PAGE=0]="PAGE",em[em.COLUMN=1]="COLUMN",em[em.CHARACTER=2]="CHARACTER",em[em.MARGIN=3]="MARGIN",em[em.INSIDE_MARGIN=4]="INSIDE_MARGIN",em[em.OUTSIDE_MARGIN=5]="OUTSIDE_MARGIN",em[em.LEFT_MARGIN=6]="LEFT_MARGIN",em[em.RIGHT_MARGIN=7]="RIGHT_MARGIN",em),si=((eg=si||{})[eg.PAGE=0]="PAGE",eg[eg.PARAGRAPH=1]="PARAGRAPH",eg[eg.LINE=2]="LINE",eg[eg.MARGIN=3]="MARGIN",eg[eg.TOP_MARGIN=4]="TOP_MARGIN",eg[eg.BOTTOM_MARGIN=5]="BOTTOM_MARGIN",eg[eg.INSIDE_MARGIN=6]="INSIDE_MARGIN",eg[eg.OUTSIDE_MARGIN=7]="OUTSIDE_MARGIN",eg),ss=((ef=ss||{})[ef.POINT=0]="POINT",ef[ef.LINE=1]="LINE",ef[ef.CHARACTER=2]="CHARACTER",ef[ef.PIXEL=3]="PIXEL",ef[ef.PERCENT=4]="PERCENT",ef),sa=((ep=sa||{})[ep.CENTER=0]="CENTER",ep[ep.INSIDE=1]="INSIDE",ep[ep.LEFT=2]="LEFT",ep[ep.OUTSIDE=3]="OUTSIDE",ep[ep.RIGHT=4]="RIGHT",ep[ep.BOTH=5]="BOTH",ep[ep.DISTRIBUTE=6]="DISTRIBUTE",ep),so=((eC=so||{})[eC.BOTTOM=0]="BOTTOM",eC[eC.CENTER=1]="CENTER",eC[eC.INSIDE=2]="INSIDE",eC[eC.OUTSIDE=3]="OUTSIDE",eC[eC.TOP=4]="TOP",eC),sl=((e_=sl||{})[e_.compressPunctuation=0]="compressPunctuation",e_[e_.compressPunctuationAndJapaneseKana=1]="compressPunctuationAndJapaneseKana",e_[e_.doNotCompress=2]="doNotCompress",e_),su=((ey=su||{})[ey.PORTRAIT=0]="PORTRAIT",ey[ey.LANDSCAPE=1]="LANDSCAPE",ey),sc=((eR=sc||{}).Letter="Letter",eR.Tabloid="Tabloid",eR.Legal="Legal",eR.Statement="Statement",eR.Executive="Executive",eR.Folio="Folio",eR.A3="A3",eR.A4="A4",eR.A5="A5",eR.B4="B4",eR.B5="B5",eR);let sh=["A3","A4","A5","B4","B5","Letter","Tabloid","Legal","Statement","Executive","Folio"];var sd,sm,sg,sf,sp,sC,s_,sy,sR,sE,sb,sI,sN,sS,sA,sv=((eE=sv||{})[eE.forward=0]="forward",eE[eE.backward=1]="backward",eE[eE.front=2]="front",eE[eE.back=3]="back",eE),sT=((eb=sT||{})[eb.UNRECOGNIZED=-1]="UNRECOGNIZED",eb[eb.DRAWING_IMAGE=0]="DRAWING_IMAGE",eb[eb.DRAWING_SHAPE=1]="DRAWING_SHAPE",eb[eb.DRAWING_CHART=2]="DRAWING_CHART",eb[eb.DRAWING_TABLE=3]="DRAWING_TABLE",eb[eb.DRAWING_SMART_ART=4]="DRAWING_SMART_ART",eb[eb.DRAWING_VIDEO=5]="DRAWING_VIDEO",eb[eb.DRAWING_GROUP=6]="DRAWING_GROUP",eb[eb.DRAWING_UNIT=7]="DRAWING_UNIT",eb[eb.DRAWING_DOM=8]="DRAWING_DOM",eb),sw=((eI=sw||{})[eI.SLIDE=0]="SLIDE",eI[eI.MASTER=1]="MASTER",eI[eI.LAYOUT=2]="LAYOUT",eI[eI.HANDOUT_MASTER=3]="HANDOUT_MASTER",eI[eI.NOTES_MASTER=4]="NOTES_MASTER",eI),sM=((eN=sM||{})[eN.SHAPE=0]="SHAPE",eN[eN.IMAGE=1]="IMAGE",eN[eN.TEXT=2]="TEXT",eN[eN.SPREADSHEET=3]="SPREADSHEET",eN[eN.DOCUMENT=4]="DOCUMENT",eN[eN.SLIDE=5]="SLIDE",eN),sO=((eS=sO||{})[eS.RELATIVE_SLIDE_LINK_UNSPECIFIED=0]="RELATIVE_SLIDE_LINK_UNSPECIFIED",eS[eS.NEXT_SLIDE=1]="NEXT_SLIDE",eS[eS.PREVIOUS_SLIDE=2]="PREVIOUS_SLIDE",eS[eS.FIRST_SLIDE=3]="FIRST_SLIDE",eS[eS.LAST_SLIDE=4]="LAST_SLIDE",eS),sx={},sU={},sD={},sV={},sL={};function sP(){return sA||(sA=1,function(e){function t(e,t){if(!e)throw Error(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.eachChildOf=e.advancer=e.readCursor=e.writeCursor=e.WriteCursor=e.ReadCursor=e.isValidPathItem=void 0;let r=e=>null!=e&&"object"==typeof e&&!Array.isArray(e),n=(e,t)=>typeof e==typeof t?e>t:"string"==typeof e&&"number"==typeof t;function i(e,t){for(let r in e)t.write(r,e[r])}e.isValidPathItem=e=>"number"==typeof e||"string"==typeof e&&"__proto__"!==e;class s{constructor(e=null){this.parents=[],this.indexes=[],this.lcIdx=-1,this.idx=-1,this.container=e}ascend(){t(this.parents.length===this.indexes.length/2),0===this.idx?this.parents.length?(this.lcIdx=this.indexes.pop(),this.container=this.parents.pop(),this.idx=this.indexes.pop()):(this.lcIdx=0,this.idx=-1):(t(this.idx>0),this.idx--,r(this.container[this.idx])&&this.idx--)}getPath(){let e=[],t=this.container,n=this.parents.length-1,i=this.idx;for(;i>=0;)e.unshift(t[i]),0===i?(i=this.indexes[2*n],t=this.parents[n--]):i-=r(t[i-1])?2:1;return e}}class a extends s{get(){return this.container?this.container.slice(this.idx+1):null}getKey(){return t(null!=this.container,"Invalid call to getKey before cursor descended"),this.container[this.idx]}getComponent(){let e;return this.container&&this.container.length>this.idx+1&&r(e=this.container[this.idx+1])?e:null}descendFirst(){let e=this.idx+1;if(!this.container||e>=this.container.length||r(this.container[e])&&e+1>=this.container.length)return!1;r(this.container[e])&&e++;let t=this.container[e];return Array.isArray(t)?(this.indexes.push(this.idx),this.parents.push(this.container),this.indexes.push(e),this.idx=0,this.container=t):this.idx=e,!0}nextSibling(){if(t(this.parents.length===this.indexes.length/2),this.idx>0||0===this.parents.length)return!1;let e=this.indexes[this.indexes.length-1]+1,r=this.parents[this.parents.length-1];return!(e>=r.length)&&(t(!isNaN(e)),this.indexes[this.indexes.length-1]=e,this.container=r[e],!0)}_init(e,t,r,n){this.container=e,this.idx=t,this.parents=r.slice(),this.indexes=n.slice()}clone(){let e=new a;return e._init(this.container,this.idx,this.parents,this.indexes),e}*[Symbol.iterator](){if(this.descendFirst()){do yield this.getKey();while(this.nextSibling())this.ascend()}}traverse(e,t){let r=this.getComponent();for(let n of(r&&t(r,e),this))e&&e.descend(n),this.traverse(e,t),e&&e.ascend()}eachPick(e,t){this.traverse(e,(e,r)=>{null!=e.p&&t(e.p,r)})}eachDrop(e,t){this.traverse(e,(e,r)=>{null!=e.d&&t(e.d,r)})}}e.ReadCursor=a;class o extends s{constructor(e=null){super(e),this.pendingDescent=[],this._op=e}flushDescent(){t(this.parents.length===this.indexes.length/2),null===this.container&&(this._op=this.container=[]);for(let e=0;e<this.pendingDescent.length;e++){let i=this.pendingDescent[e],s=this.idx+1;if(s<this.container.length&&r(this.container[s])&&s++,t(s===this.container.length||!r(this.container[s])),s===this.container.length)this.container.push(i),this.idx=s;else if(this.container[s]===i)this.idx=s;else{if(!Array.isArray(this.container[s])){let e=this.container.splice(s,this.container.length-s);this.container.push(e),this.lcIdx>-1&&(this.lcIdx=s)}for(this.indexes.push(this.idx),this.parents.push(this.container),-1!==this.lcIdx&&(t(n(i,this.container[this.lcIdx][0])),s=this.lcIdx+1,this.lcIdx=-1);s<this.container.length&&n(i,this.container[s][0]);)s++;if(this.indexes.push(s),this.idx=0,s<this.container.length&&this.container[s][0]===i)this.container=this.container[s];else{let e=[i];this.container.splice(s,0,e),this.container=e}}}this.pendingDescent.length=0}reset(){this.lcIdx=-1}getComponent(){this.flushDescent();let e=this.idx+1;if(e<this.container.length&&r(this.container[e]))return this.container[e];{let t={};return this.container.splice(e,0,t),t}}write(e,r){let n=this.getComponent();t(null==n[e]||n[e]===r,"Internal consistency error: Overwritten component. File a bug"),n[e]=r}get(){return this._op}descend(t){if(!e.isValidPathItem(t))throw Error("Invalid JSON key");this.pendingDescent.push(t)}descendPath(e){return this.pendingDescent.push(...e),this}ascend(){this.pendingDescent.length?this.pendingDescent.pop():super.ascend()}mergeTree(e,r=i){if(null===e)return;if(t(Array.isArray(e)),e===this._op)throw Error("Cannot merge into my own tree");let n=this.lcIdx,s=this.parents.length,a=0;for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n||"number"==typeof n?(a++,this.descend(n)):Array.isArray(n)?this.mergeTree(n,r):"object"==typeof n&&r(n,this)}for(;a--;)this.ascend();this.lcIdx=this.parents.length===s?n:-1}at(e,t){this.descendPath(e),t(this);for(let t=0;t<e.length;t++)this.ascend();return this}writeAtPath(e,t,r){return this.at(e,()=>this.write(t,r)),this.reset(),this}writeMove(e,t,r=0){return this.writeAtPath(e,"p",r).writeAtPath(t,"d",r)}getPath(){let e=super.getPath();return e.push(...this.pendingDescent),e}}e.WriteCursor=o,e.writeCursor=()=>new o,e.readCursor=e=>new a(e),e.advancer=function(e,t,r){let i,s;function a(i){let a;for(;s;){let o=a=e.getKey();if(null!=i){let r=!1;if(t&&"number"==typeof o&&(a=t(o,e.getComponent()))<0&&(a=~a,r=!0),n(a,i))return null;if(a===i&&!r)return e}r&&"number"==typeof a&&r(a,e.getComponent()),s=e.nextSibling()}return null}return s=i=!!e&&e.descendFirst(),a.end=()=>{i&&e.ascend()},a},e.eachChildOf=function(e,t,r){let i,s,a,o;for(i=s=e&&e.descendFirst(),a=o=t&&t.descendFirst();i||a;){let s=i?e.getKey():null,o=a?t.getKey():null;null!==s&&null!==o&&(n(o,s)?o=null:s!==o&&(s=null)),r(null==s?o:s,null!=s?e:null,null!=o?t:null),null!=s&&i&&(i=e.nextSibling()),null!=o&&a&&(a=t.nextSibling())}s&&e.ascend(),o&&t.ascend()}}(sL)),sL}var sk,sF={};function sj(){var e;return sk||(sk=1,Object.defineProperty(sF,"__esModule",{value:!0}),sF.ConflictType=void 0,(e=sF.ConflictType||(sF.ConflictType={}))[e.RM_UNEXPECTED_CONTENT=1]="RM_UNEXPECTED_CONTENT",e[e.DROP_COLLISION=2]="DROP_COLLISION",e[e.BLACKHOLE=3]="BLACKHOLE"),sF}var sB,s$={},sH={};function sW(){return sB||(sB=1,Object.defineProperty(sH,"__esModule",{value:!0}),sH.uniToStrPos=sH.strPosToUni=void 0,sH.strPosToUni=(e,t=e.length)=>{let r=0,n=0;for(;n<t;n++){let t=e.charCodeAt(n);t>=55296&&t<=57343&&(r++,n++)}if(n!==t)throw Error("Invalid offset - splits unicode bytes");return n-r},sH.uniToStrPos=(e,t)=>{let r=0;for(;t>0;t--){let t=e.charCodeAt(r);r+=t>=55296&&t<=57343?2:1}return r}),sH}var sG,sY={};function sz(){return sG||(sG=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uniSlice=e.dlen=e.eachOp=void 0;let t=sW(),r=t=>{if(!Array.isArray(t))throw Error("Op must be an array of components");let r=null;for(let n=0;n<t.length;n++){let i=t[n];switch(typeof i){case"object":if("number"!=typeof i.d&&"string"!=typeof i.d)throw Error("Delete must be number or string");if(0>=e.dlen(i.d))throw Error("Deletes must not be empty");break;case"string":if(!(i.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(i>0))throw Error("Skip components must be >0");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}r=i}if("number"==typeof r)throw Error("Op has a trailing skip")};function n(r,n){let i=0,s=0;for(let a=0;a<r.length;a++){let o=r[a];switch(n(o,i,s),typeof o){case"object":i+=e.dlen(o.d);break;case"string":s+=t.strPosToUni(o);break;case"number":i+=o,s+=o}}}function i(e,t){let r=[],i=o(r);return n(e,(e,r,n)=>{i(t(e,r,n))}),h(r)}e.eachOp=n;let s=e=>e,a=e=>i(e,s);e.dlen=e=>"number"==typeof e?e:t.strPosToUni(e);let o=t=>r=>{if(!(!r||0===r.d||""===r.d))if(0===t.length)t.push(r);else if(typeof r==typeof t[t.length-1])if("object"==typeof r){let n=t[t.length-1];n.d="string"==typeof n.d&&"string"==typeof r.d?n.d+r.d:e.dlen(n.d)+e.dlen(r.d)}else t[t.length-1]+=r;else t.push(r)},l=e=>"number"==typeof e?e:"string"==typeof e?t.strPosToUni(e):"number"==typeof e.d?e.d:t.strPosToUni(e.d);e.uniSlice=(e,r,n)=>{let i=t.uniToStrPos(e,r),s=null==n?1/0:t.uniToStrPos(e,n);return e.slice(i,s)};let u=(t,r,n)=>"number"==typeof t?null==n?t-r:Math.min(t,n)-r:e.uniSlice(t,r,n),c=r=>{let n=0,i=0;return{take:(s,a)=>{let o;if(n===r.length)return -1===s?null:s;let l=r[n];if("number"==typeof l)return -1===s||l-i<=s?(o=l-i,++n,i=0,o):(i+=s,s);if("string"==typeof l){if(-1===s||"i"===a||t.strPosToUni(l.slice(i))<=s)return o=l.slice(i),++n,i=0,o;{let e=i+t.uniToStrPos(l.slice(i),s);return o=l.slice(i,e),i=e,o}}if(-1===s||"d"===a||e.dlen(l.d)-i<=s)return o={d:u(l.d,i)},++n,i=0,o;{let e=u(l.d,i,i+s);return i+=s,{d:e}}},peek:()=>r[n]}},h=e=>(e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e);function d(n,i,s){let a;if("left"!==s&&"right"!==s)throw Error("side ("+s+") must be 'left' or 'right'");r(n),r(i);let u=[],d=o(u),{take:m,peek:g}=c(n);for(let r=0;r<i.length;r++){let n,a,o=i[r];switch(typeof o){case"number":for(n=o;n>0;)d(a=m(n,"i")),"string"!=typeof a&&(n-=l(a));break;case"string":"left"===s&&"string"==typeof g()&&d(m(-1)),d(t.strPosToUni(o));break;case"object":for(n=e.dlen(o.d);n>0;)switch(typeof(a=m(n,"i"))){case"number":n-=a;break;case"string":d(a);break;case"object":n-=e.dlen(a.d)}}}for(;a=m(-1);)d(a);return h(u)}function m(n,i){let s;r(n),r(i);let a=[],d=o(a),{take:m}=c(n);for(let r=0;r<i.length;r++){let n,s,a=i[r];switch(typeof a){case"number":for(n=a;n>0;)d(s=m(n,"d")),"object"!=typeof s&&(n-=l(s));break;case"string":d(a);break;case"object":n=e.dlen(a.d);let o=0;for(;o<n;)switch(typeof(s=m(n-o,"d"))){case"number":d({d:u(a.d,o,o+s)}),o+=s;break;case"string":o+=t.strPosToUni(s);break;case"object":d(s)}}}for(;s=m(-1);)d(s);return h(a)}let g=(r,n)=>{let i=0;for(let s=0;s<n.length&&r>i;s++){let a=n[s];switch(typeof a){case"number":i+=a;break;case"string":let o=t.strPosToUni(a);i+=o,r+=o;break;case"object":r-=Math.min(e.dlen(a.d),r-i)}}return r},f=(e,t)=>"number"==typeof e?g(e,t):e.map(e=>g(e,t));function p(e,t,r){return i(e,(e,n)=>"object"==typeof e&&"number"==typeof e.d?{d:r.slice(t,n,n+e.d)}:e)}function C(e){return i(e,e=>{switch(typeof e){case"object":if("number"==typeof e.d)throw Error("Cannot invert text op: Deleted characters missing from operation. makeInvertible must be called first.");return e.d;case"string":return{d:e};case"number":return e}})}function _(e){return i(e,e=>"object"==typeof e&&"string"==typeof e.d?{d:t.strPosToUni(e.d)}:e)}function y(e){let t=!0;return n(e,e=>{"object"==typeof e&&"number"==typeof e.d&&(t=!1)}),t}e.default=function(t){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:h,normalize:a,checkOp:r,create(e=""){if("string"!=typeof e)throw Error("Initial data must be a string");return t.create(e)},apply(n,i){r(i);let s=t.builder(n);for(let t=0;t<i.length;t++){let r=i[t];switch(typeof r){case"number":s.skip(r);break;case"string":s.append(r);break;case"object":s.del(e.dlen(r.d))}}return s.build()},transform:d,compose:m,transformPosition:g,transformSelection:f,isInvertible:y,makeInvertible:(e,r)=>p(e,r,t),stripInvertible:_,invert:C,invertWithDoc:(e,r)=>C(p(e,r,t)),isNoop:e=>0===e.length}}}(sY)),sY}var sX,sq={},sK=(oM||(oM=1,oN=sx&&sx.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),oS=sx&&sx.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||oN(t,e,r)},Object.defineProperty(sx,"__esModule",{value:!0}),oS((ow||(ow=1,function(e){var t=sU&&sU.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.editOp=e.replaceOp=e.insertOp=e.moveOp=e.removeOp=e.type=void 0;let r=t(sN?sD:(sN=1,Object.defineProperty(sD,"__esModule",{value:!0}),sD.default=function e(t,r){return t===r||null!==t&&null!==r&&"object"==typeof t&&"object"==typeof r&&(Array.isArray(t)?function(t,r){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):function(t,r){if(Array.isArray(r))return!1;for(let n in t)if(!e(t[n],r[n]))return!1;for(let e in r)if(void 0===t[e])return!1;return!0}(t,r))},sD)),n=t((sS||(sS=1,Object.defineProperty(sV,"__esModule",{value:!0}),sV.default=function e(t){if(null===t)return null;if(Array.isArray(t))return t.map(e);if("object"!=typeof t)return t;{let r={};for(let n in t)r[n]=e(t[n]);return r}}),sV)),i=sP(),s=sj();function a(e,t){if(!e)throw Error(t)}e.type={name:"json1",uri:"http://sharejs.org/types/JSONv1",readCursor:i.readCursor,writeCursor:i.writeCursor,create:e=>e,isNoop:e=>null==e,setDebug(e){},registerSubtype:C,checkValidOp:S,normalize:A,apply:function(e,t){if(S(t),null===t)return e;let r=[];return function e(t,n){let i=t,s=0,o={root:t},l=0,c=o,h="root";function d(){for(;l<s;l++){let e=n[l];"object"!=typeof e&&(a(g(c,h)),c=c[h]=u(c[h]),h=e)}}for(;s<n.length;s++){let t=n[s];if(Array.isArray(t)){let r=e(i,t);r!==i&&void 0!==r&&(d(),i=c[h]=r)}else if("object"==typeof t){null!=t.d?(d(),i=m(c,h,r[t.d])):void 0!==t.i&&(d(),i=m(c,h,t.i));let e=R(t);if(e)d(),i=c[h]=e.apply(i,E(t));else if(void 0!==t.e)throw Error("Subtype "+t.et+" undefined")}else i=f(i,t)}return o.root}(e=function e(t,n){var i,s;let o=[],l=0;for(;l<n.length;l++){let e=n[l];if(Array.isArray(e))break;"object"!=typeof e&&(o.push(t),t=f(t,e))}for(let r=n.length-1;r>=l;r--)t=e(t,n[r]);for(--l;l>=0;l--){let e=n[l];if("object"!=typeof e){let r=o.pop();t=t===f(r,e)?r:void 0===t?d(r,e):(s=t,(i=u(i=r))[e]=s,i)}else c(e)&&(a(void 0!==t,"Cannot pick up or remove undefined"),null!=e.p&&(r[e.p]=t),t=void 0)}return t}(e,t),t)},transformPosition:function(e,t){e=e.slice(),S(t);let r=i.readCursor(t),n,s,a=!1,l=[];for(let t=0;;t++){let o=e[t],u=r.getComponent();if(u&&(void 0!==u.r?a=!0:null!=u.p&&(a=!1,n=u.p,s=t)),t>=e.length)break;let h=0,d=i.advancer(r,void 0,(e,t)=>{c(t)&&h++});l.unshift(d);let m=d(o);if("number"==typeof o&&(e[t]-=h),!m)break}if(l.forEach(e=>e.end()),a)return null;let u=()=>{let t=0;if(null!=n){let n=r.getPath();t=n.length,e=n.concat(e.slice(s))}for(;t<e.length;t++){let n=e[t],s=o(r),a=R(s);if(a){let r=E(s);a.transformPosition&&(e[t]=a.transformPosition(e[t],r));break}let l=0,u=i.advancer(r,(e,t)=>h(t)?~(e-l):e-l,(e,t)=>{h(t)&&l++})(n);if("number"==typeof n&&(e[t]+=l),!u)break}};return null!=n?r.eachDrop(null,e=>{e===n&&u()}):u(),e},compose:v,tryTransform:x,transform:function(e,t,r){let n=x(e,t,r);if(n.ok)return n.result;U(n.conflict)},makeInvertible:M,invert:T,invertWithDoc:function(e,t){return T(M(e,t))},RM_UNEXPECTED_CONTENT:s.ConflictType.RM_UNEXPECTED_CONTENT,DROP_COLLISION:s.ConflictType.DROP_COLLISION,BLACKHOLE:s.ConflictType.BLACKHOLE,transformNoConflict:(e,t,r)=>L(()=>!0,e,t,r),typeAllowingConflictsPred:t=>Object.assign(Object.assign({},e.type),{transform:(e,r,n)=>L(t,e,r,n)})};let o=e=>e?e.getComponent():null;function l(e){return e&&"object"==typeof e&&!Array.isArray(e)}let u=e=>Array.isArray(e)?e.slice():null!==e&&"object"==typeof e?Object.assign({},e):e,c=e=>e&&(null!=e.p||void 0!==e.r),h=e=>e&&(null!=e.d||void 0!==e.i);function d(e,t){return a(null!=e),"number"==typeof t?(a(Array.isArray(e),"Invalid key - child is not an array"),(e=e.slice()).splice(t,1)):(a(l(e),"Invalid key - child is not an object"),delete(e=Object.assign({},e))[t]),e}function m(e,t,r){return"number"==typeof t?(a(null!=e,"Container is missing for key"),a(Array.isArray(e),"Cannot use numerical key for object container"),a(e.length>=t,"Cannot insert into out of bounds index"),e.splice(t,0,r)):(a(l(e),"Cannot insert into missing item"),a(void 0===e[t],"Trying to overwrite value at key. Your op needs to remove it first"),e[t]=r),r}e.removeOp=(e,t=!0)=>i.writeCursor().writeAtPath(e,"r",t).get(),e.moveOp=(e,t)=>i.writeCursor().writeMove(e,t).get(),e.insertOp=(e,t)=>i.writeCursor().writeAtPath(e,"i",t).get(),e.replaceOp=(e,t,r)=>i.writeCursor().at(e,e=>{e.write("r",t),e.write("i",r)}).get(),e.editOp=(e,t,r,n=!1)=>i.writeCursor().at(e,e=>b(e,t,r,n)).get();let g=(e,t)=>null!=e&&("number"==typeof t?Array.isArray(e):"object"==typeof e),f=(e,t)=>g(e,t)?e[t]:void 0,p={};function C(e){let t=e.type?e.type:e;t.name&&(p[t.name]=t),t.uri&&(p[t.uri]=t)}let _=e=>{let t=p[e];if(t)return t;throw Error("Missing type: "+e)};C((oT||(oT=1,function(e){var t=s$&&s$.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=s$&&s$.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=s$&&s$.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&t(n,e,i);return r(n,e),n},i=s$&&s$.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.type=e.remove=e.insert=void 0;let s=sW(),a=n(sz()),o=i(function(){if(sX)return sq;sX=1,Object.defineProperty(sq,"__esModule",{value:!0});let e=sz(),t=sW();function r(r,n){return{get:r,getLength:()=>r().length,insert:(e,i,s)=>n([t.strPosToUni(r(),e),i],s),remove:(e,i,s)=>n([t.strPosToUni(r(),e),{d:i}],s),_onOp(t){e.eachOp(t,(t,r,n)=>{switch(typeof t){case"string":this.onInsert&&this.onInsert(n,t);break;case"object":let i=e.dlen(t.d);this.onRemove&&this.onRemove(n,i)}})},onInsert:null,onRemove:null}}return sq.default=r,r.provides={text:!0},sq}()),l={create:e=>e,toString:e=>e,builder(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);let t=[];return{skip(r){let n=s.uniToStrPos(e,r);if(n>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,n)),e=e.slice(n)},append(e){t.push(e)},del(t){e=e.slice(s.uniToStrPos(e,t))},build:()=>t.join("")+e}},slice:a.uniSlice};e.type=Object.assign(Object.assign({},a.default(l)),{api:o.default}),e.insert=(e,t)=>0===t.length?[]:0===e?[t]:[e,t],e.remove=(e,t)=>0===a.dlen(t)?[]:0===e?[{d:t}]:[e,{d:t}];var u=sz();Object.defineProperty(e,"makeType",{enumerable:!0,get:function(){return u.default}})}(s$)),s$));let y=(e,t)=>e+t;C({name:"number",apply:y,compose:y,invert:e=>-e,transform:e=>e});let R=e=>null==e?null:e.et?_(e.et):e.es?p["text-unicode"]:null!=e.ena?p.number:null,E=e=>e.es?e.es:null!=e.ena?e.ena:e.e,b=(e,t,r,n=!1)=>{let[i,s]="string"==typeof t?[_(t),t]:[t,t.name];!n&&i.isNoop&&i.isNoop(r)||("number"===s?e.write("ena",r):"text-unicode"===s?e.write("es",r):(e.write("et",s),e.write("e",r)))};function I(e){a("number"==typeof e),a(e>=0),a(e===(0|e))}function N(e){"number"==typeof e?I(e):a("string"==typeof e)}function S(e){if(null===e)return;let t=new Set,r=new Set,n=e=>{let n=!0,i=!1;for(let s in e){let o=e[s];if(n=!1,a("p"===s||"r"===s||"d"===s||"i"===s||"e"===s||"es"===s||"ena"===s||"et"===s,"Invalid component item '"+s+"'"),"p"===s)I(o),a(!t.has(o)),t.add(o),a(void 0===e.r);else if("d"===s)I(o),a(!r.has(o)),r.add(o),a(void 0===e.i);else if("e"===s||"es"===s||"ena"===s){a(!i),i=!0;let t=R(e);a(t,"Missing type in edit"),t.checkValidOp&&t.checkValidOp(E(e))}}a(!n)},s=(e,t,r)=>{if(!Array.isArray(e))throw Error("Op must be null or a list");if(0===e.length)throw Error("Empty descent");t||N(e[0]);let o=1,l=0,u=0;for(let t=0;t<e.length;t++){let r=e[t];if(a(null!=r),Array.isArray(r)){let e=s(r,!1);if(l){let t=typeof u,r=typeof e;t===r?a(u<e,"descent keys are not in order"):a("number"===t&&"string"===r)}u=e,l++,o=3}else"object"==typeof r?(a(1===o,`Prev not scalar - instead ${o}`),n(r),o=2):(a(3!==o),N(r),a(i.isValidPathItem(r),"Invalid path key"),o=1)}return a(1!==l,"Operation makes multiple descents. Remove some []"),a(2===o||3===o),e[0]};s(e,!0),a(t.size===r.size,"Mismatched picks and drops in op");for(let e=0;e<t.size;e++)a(t.has(e)),a(r.has(e))}function A(e){let t=0,r=[],n=i.writeCursor();return n.mergeTree(e,(e,n)=>{var i;let s=R(e);if(s){let t=E(e);b(n,s,s.normalize?s.normalize(t):t)}for(let s of["r","p","i","d"])if(void 0!==e[s]){let a="p"===s||"d"===s?(null==r[i=e[s]]&&(r[i]=t++),r[i]):e[s];n.write(s,a)}}),n.get()}function v(e,t){if(S(e),S(t),null==e)return t;if(null==t)return e;let r=0,n=i.readCursor(e),s=i.readCursor(t),l=i.writeCursor(),u=[],d=[],m=[],g=[],f=[],p=[],C=new Set;n.traverse(null,e=>{null!=e.p&&(m[e.p]=n.clone())}),s.traverse(null,e=>{null!=e.d&&(g[e.d]=s.clone())});let _=i.writeCursor();return function e(t,n,s,l,_,y,I,N){let S;a(n||s);let A=o(n),v=o(s),T=!!v&&void 0!==v.r,w=!!A&&void 0!==A.i,M=A?A.d:null,O=v?v.p:null,x=(y||T)&&null==O;if(null!=O)l=g[O],I=d[O]=new i.WriteCursor;else if(v&&void 0!==v.r)l=null;else{let e=o(l);e&&null!=e.d&&(l=null)}let U=o(l);if(null!=M)if(t=m[M],N=u[M]=new i.WriteCursor,x)y&&!T&&N.write("r",!0);else{let e=f[M]=r++;I.write("d",e)}else if(A&&void 0!==A.i)t=null;else{let e=o(t);e&&null!=e.p&&(t=null)}w?(a(void 0===_),S=A.i):S=_;let D=(null==O?!w||y||T:void 0===S)?null:I.getComponent();if(null!=O){if(!(void 0!==_||w)){let e=null!=M?f[M]:r++;p[O]=e,N.write("p",e)}}else T&&(w||void 0!==_||(v.r,N.write("r",v.r)));let V=x?null:R(A),L=R(U);if((V||L)&&(V&&V.name,L&&L.name),V&&L){a(V===L);let e=E(A),t=E(U),r=V.compose(e,t);b(I,V,r),C.add(U)}else V?b(I,V,E(A)):L&&(b(I,L,E(U)),C.add(U));let P="object"==typeof S&&null!=S,k=!1,F=0,j=0,B=0,$=0,H=0,W=i.advancer(l,(e,t)=>h(t)?$-e-1:e-$,(e,t)=>{h(t)&&$++}),G=i.advancer(t,(e,t)=>c(t)?F-e-1:e-F,(e,t)=>{c(t)&&F++});if(i.eachChildOf(n,s,(t,r,n)=>{var i,s;let l,u,d=t,m=t,g=t;if("number"==typeof t){let e=t+B;u=W(e),m=e+$;let i=t+j;l=G(i),h(o(u))&&(l=null),d=i+F,g=t+H,a(d>=0,"p1PickKey is negative"),a(m>=0,"p2DropKey is negative");let s=h(o(r)),f=c(o(n));(s||f&&!x)&&H--,s&&j--,f&&B--}else l=G(t),u=W(t);N.descend(d),I.descend(m);let f=P&&!h(o(r))?S[g]:void 0,p=e(l,r,n,u,f,x,I,N);P&&!x?f!==p&&(k||(S=Array.isArray(S)?S.slice():Object.assign({},S),k=!0),i=S,"number"==typeof(s=g)?(a(Array.isArray(i)),a(s<i.length)):(a(!Array.isArray(i)),a(void 0!==i[s])),void 0===p?"number"==typeof s?i.splice(s,1):delete i[s]:i[s]=p):a(void 0===p),I.ascend(),N.ascend()}),G.end(),W.end(),null!=D)D.i=S;else if(!y&&!T&&null==O)return S}(n,n.clone(),s,s.clone(),void 0,!1,l,_),l.reset(),l.mergeTree(_.get()),l.reset(),l.get(),u.map(e=>e.get()),d.map(e=>e.get()),n.traverse(l,(e,t)=>{let r=e.p;if(null!=r){let e=f[r];null!=e&&t.write("p",e);let n=u[r];n&&n.get(),n&&t.mergeTree(n.get())}else void 0!==e.r&&t.write("r",e.r)}),l.reset(),l.get(),s.traverse(l,(e,t)=>{let r=e.d;if(null!=r){let e=p[r];null!=e&&t.write("d",e);let n=d[r];n&&t.mergeTree(n.get())}else void 0!==e.i&&t.write("i",e.i);let n=R(e);n&&!C.has(e)&&b(t,n,E(e))}),l.get()}function T(e){let t;if(null==e)return null;let r=new i.ReadCursor(e),n=new i.WriteCursor,s=[],a=[];return function e(r,n,i){let a=r.getComponent(),o,l=!1;if(a){null!=a.p&&(n.write("d",a.p),s[a.p]=r.clone()),void 0!==a.r&&n.write("i",a.r),null!=a.d&&(n.write("p",a.d),i=void 0),void 0!==a.i&&(i=o=a.i);let e=R(a);e&&(void 0===i?(t||(t=new Set),t.add(a)):(E(a),i=e.apply(i,E(a)),l=!0))}let c=0;for(let t of r){n.descend(t);let s="number"==typeof t?t-c:t,a=f(i,s);h(r.getComponent())&&c++;let o=e(r,n,a);if(void 0!==i&&void 0!==o){if(l||(l=!0,i=u(i)),!g(i,s))throw Error("Cannot modify child - invalid operation");i[s]=o}n.ascend()}if(void 0===o)return l?i:void 0;n.write("r",i)}(r,n,void 0),t&&(n.reset(),function e(r,n,o){let l=n.getComponent();if(l){let e=l.d;if(null!=e&&(r=s[e],o=a[e]=i.writeCursor()),t.has(l)){let e=R(l);if(!e.invert)throw Error(`Cannot invert subtype ${e.name}`);b(o,e,e.invert(E(l)))}}let u=0,d=0,m=i.advancer(r,(e,t)=>c(t)?u-e-1:e-u,(e,t)=>{c(t)&&u++});for(let t of n)if("number"==typeof t){let r=t-d,i=m(r),s=r+u;o.descend(s),e(i,n,o),h(n.getComponent())&&d++,o.ascend()}else o.descend(t),e(m(t),n,o),o.ascend();m.end()}(r.clone(),r,n),a.length&&(n.reset(),r.traverse(n,(e,t)=>{let r=e.p;if(null!=r){let e=a[r];e&&e.get(),e&&t.mergeTree(e.get())}}))),n.get()}let w=(e,t)=>e.some(e=>"object"==typeof e&&(Array.isArray(e)?w(e,t):t(e)));function M(e,t){if(null==e||!w(e,e=>{var t;return void 0!==e.r||(null==(t=R(e))?void 0:t.makeInvertible)!=null}))return e;let r=new i.ReadCursor(e),s=new i.WriteCursor,o=!1,l=[],m=[],g=(e,t,r)=>{let i=e.getComponent(),s=!1;if(i){null!=i.d&&t.write("d",i.d),void 0!==i.i&&t.write("i",i.i);let n=i.p;if(null!=n&&(l[n]=e.clone(),a(void 0!==r,"Operation picks up at an invalid key"),m[n]=r,t.write("p",i.p)),void 0!==i.r&&void 0===r)throw Error("Invalid doc / op in makeInvertible: removed item missing from doc");let s=R(i);s&&(s.makeInvertible?o=!0:b(t,s,E(i),!0))}let c=0;for(let n of e){t.descend(n);let i="number"==typeof n?n-c:n,a=f(r,i),o=g(e,t,a);a!==o&&(s||(s=!0,r=u(r)),void 0===o?(r=d(r,i),"number"==typeof n&&c++):r[i]=o),t.ascend()}return i&&(void 0!==i.r?(t.write("r",n.default(r)),r=void 0):null!=i.p&&(r=void 0)),r};return g(r,s,t),s.get(),o&&(s.reset(),function e(t,r,n,s,a){let o=r.getComponent();if(o){void 0!==o.i?(s=o.i,a=!0):null!=o.d&&(s=m[o.d],t=l[o.d],a=!1,o.d);let e=R(o);if(e&&e.makeInvertible){let t=E(o);b(n,e,e.makeInvertible(t,s),!0)}}let u=0,d=0,g=i.advancer(t,(e,t)=>c(t)?u-e-1:e-u,(e,t)=>{c(t)&&u++});for(let t of r)if("number"==typeof t){let i=t-d,o=g(i),l=i+u,c=f(s,a?i:l);n.descend(t),e(o,r,n,c,a),h(r.getComponent())&&d++,n.ascend()}else{let i=f(s,t);n.descend(t),e(g(t),r,n,i,a),n.ascend()}g.end()}(r.clone(),r,s,t,!1)),s.get()}let O=e=>{if(null==e)return null;let t=e.slice();for(let r=0;r<e.length;r++){let e=t[r];Array.isArray(e)&&(t[r]=O(e))}return t};function x(t,l,u){a("left"===u||"right"===u,"Direction must be left or right");let d=+("left"!==u);if(null==l)return{ok:!0,result:t};S(t),S(l);let m=null,g=[],f=[],p=[],C=[],_=[],y=[],I=[],N=[],A=[],v=[],T=[],w=[],M=[],x=[],U=[],D=0,V=i.readCursor(t),L=i.readCursor(l),P=i.writeCursor();if(function e(t,r=null,n){let s,a=o(r);a&&(void 0!==a.r?n=r.clone():null!=a.p&&(n=null,y[a.p]=t.clone()));let l=t.getComponent();l&&null!=(s=l.p)&&(_[s]=r?r.clone():null,p[s]=t.clone(),n&&(v[s]=!0,A[s]=n),a&&null!=a.p&&(x[s]=a.p));let u=i.advancer(r);for(let r of t)e(t,u(r),n);u.end()}(L,V,null),function t(r,n,a,l,u){let h=a.getComponent(),g,f=!1;h&&(null!=(g=h.d)?(C[g]=a.clone(),null!=l&&(null==U[l]&&(U[l]=[]),U[l].push(g)),v[g],r=_[g]||null,n=p[g]||null,v[g]?(u&&(T[g]=!0),u=A[g]||null):u&&(1===d||null==x[g])&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.moveOp(n.getPath(),a.getPath())}),f=!0):void 0!==h.i&&(r=n=null,f=!0,u&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.insertOp(a.getPath(),h.i)})));let y=o(r);y&&(void 0!==y.r?u=r.clone():null!=y.p&&(y.p,l=y.p,u=null));let b=R(h);b&&u&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.editOp(a.getPath(),b,E(h),!0)});let I=0,N=0,S=i.advancer(n,(e,t)=>c(t)?I-e-1:e-I,(e,t)=>{c(t)&&I++}),w=i.advancer(r);for(let e of a)if("number"==typeof e){let r=e-N,n=S(r);N+=+t(w(r+I),n,a,l,u)}else{let r=S(e);t(w(e),r,a,l,u)}return S.end(),w.end(),f}(V,L,L.clone(),null,null),C.map(e=>e&&e.get()),m)return{ok:!1,conflict:m};T.map(e=>!!e);let k=[],F=null;(function e(t,r,n,s,l){let u=!1,m=o(r);if(c(m)){let e=m.p;null!=e?(n=C[e],s=w[e]=i.writeCursor(),u=!0,l=null):(n=null,l=r.clone())}else h(o(n))&&(n=null);let f=t.getComponent();if(f){let e=f.p;null!=e?(l&&(N[e]=l),k[e]=l||1===d&&u?null:s.getComponent(),g[e]=t.clone(),n&&(I[e]=n.clone())):void 0!==f.r&&(l||s.write("r",!0),(l||u)&&(null==F&&(F=new Set),F.add(f)))}let p=0,_=0,y=i.advancer(r,void 0,(e,t)=>{c(t)&&p++}),R=i.advancer(n,(e,t)=>h(t)?~(e-_):e-_,(e,t)=>{h(t)&&_++});if(t)for(let r of t)if("string"==typeof r){let n=y(r),i=R(r);s.descend(r),e(t,n,i,s,l),s.ascend()}else{let n=y(r),i=r-p,u=c(o(n))?null:R(i),h=i+_;a(h>=0),s.descend(h),e(t,n,u,s,l),s.ascend()}y.end(),R.end()})(V,L,L.clone(),P,null),P.reset();let j=[];if(function t(l,_,S,A,T,w){a(_);let O=_.getComponent(),U=o(A),V=!1,L=(t,r,n)=>t?e.moveOp(t.getPath(),r.getPath()):e.insertOp(r.getPath(),n.i);if(h(O)){let t=O.d;null!=t&&(f[t]=_.clone());let i=null!=t?k[t]:null,a=!1;if(void 0!==O.i||null!=t&&i){let o;U&&(void 0!==U.i||null!=(o=U.d)&&!v[o])&&((a=null!=o?null!=t&&t===x[o]:r.default(U.i,O.i))||null!=o&&1!==d&&null!=x[o]||null==m&&(m={type:s.ConflictType.DROP_COLLISION,op1:L(null!=t?g[t]:null,_,O),op2:L(null!=o?p[o]:null,A,U)})),a||(w?null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:L(null!=t?g[t]:null,_,O),op2:e.removeOp(w.getPath())}):(null!=t?(j[D]=t,T.write("d",i.p=D++)):T.write("i",n.default(O.i)),V=!0))}else if(null!=t&&!i){let e=N[t];e&&(w=e.clone())}null!=t?(l=g[t],S=y[t],A=I[t]):void 0!==O.i&&(l=S=null,a||(A=null))}else c(o(l))&&(l=S=A=null);let P=o(l),B=o(S);if(c(B)){let e=B.p;void 0!==B.r&&(!P||void 0===P.r)||v[e]?(A=null,w=S.clone()):null!=e&&(A=C[e],1!==d&&null!=x[e]||((T=M[e])||(T=M[e]=i.writeCursor()),T.reset(),w=null))}else!h(O)&&h(U)&&(A=null);U=null!=A?A.getComponent():null;let $=R(O);if($){let t=E(O);if(w)null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.editOp(_.getPath(),$,t,!0),op2:e.removeOp(w.getPath())});else{let e,r=R(U);if(r){if($!==r)throw Error("Transforming incompatible types");let n=E(U);e=$.transform(t,n,u)}else e=n.default(t);b(T,$,e)}}let H=0,W=0,G=0,Y=0,z=0,X=0,q=null!=l&&l.descendFirst(),K=q,Q=i.advancer(S,void 0,(e,t)=>{c(t)&&G++}),Z=null!=A&&A.descendFirst(),J=Z;for(let e of _)if("number"==typeof e){let r,n=h(_.getComponent()),i=e-W;{let e;for(;q&&"number"==typeof(e=l.getKey());){e+=H;let t=l.getComponent(),r=c(t);if(e>i||e===i&&(!r||0===d&&n))break;if(r){H--;let e=t.p;x.includes(e),t.d,o(M[t.d]),c(o(M[t.d])),(void 0===t.r||F&&F.has(t))&&(null==e||!k[e]||1!==d&&x.includes(e))||z--}q=l.nextSibling()}r=q&&e===i?l:null}let s=i-H,u=Q(s),m=s-G,g=null;{let e,t;for(;Z&&"number"==typeof(e=A.getKey());){t=e-Y;let r=A.getComponent(),i=h(r);if(t>m)break;if(t===m){if(!i){g=A;break}{if(0===d&&n){g=A;break}let e=u&&c(u.getComponent());if(0===d&&e)break}}if(i){let e=r.d;v[e],x[e],void 0===r.i&&(v[e]||null!=x[e]&&1!==d)?(v[e]||null!=x[e]&&0===d)&&(Y++,X--):Y++}Z=A.nextSibling()}}let f=m+Y+z+X;a(f>=0,"trying to descend to a negative index"),T.descend(f),n&&(r=u=g=null,W++),t(r,_,u,g,T,w)&&X++,T.ascend()}else{let r,n;for(;q&&("string"!=typeof(r=l.getKey())||!(r>e||r===e));)q=l.nextSibling();let i=q&&r===e?l:null,s=Q(e);for(;Z&&("string"!=typeof(n=A.getKey())||!(n>e||n===e));)Z=A.nextSibling();let a=Z&&n===e?A:null;T.descend(e),t(i,_,s,a,T,w),T.ascend()}return Q.end(),K&&l.ascend(),J&&A.ascend(),V}(V,V.clone(),L,L.clone(),P,null),m)return{ok:!1,conflict:m};P.reset();let B=(e,t,r)=>e.traverse(t,(t,n)=>{null!=t.d&&r(t.d,e,n)});(v.length||w.length)&&(B(L,P,(e,t,r)=>{v[e]&&!T[e]&&r.write("r",!0),w[e]&&r.mergeTree(w[e].get())}),P.reset());let $=[],H=[];if((M.length||v.length)&&!m){let e=i.readCursor(O(P.get()));if(B(e,null,(e,t)=>{$[e]=t.clone()}),M.forEach(e=>{e&&B(i.readCursor(e.get()),null,(e,t)=>{$[e]=t.clone()})}),function e(t,r,n,s,a,l){let u=o(r);if(u&&c(u))if(null!=u.p){let e=u.p;$[e].getPath(),n=$[e],s=H[e]=i.writeCursor()}else void 0!==u.r&&(n=null);else h(o(n))&&(n=null);let d=t.getComponent();if(d){let e;if(null!=(e=d.d)){let t=M[e];t&&(t.get(),s.mergeTree(t.get()),n=i.readCursor(t.get()))}}let m=0,g=0,f=i.advancer(r,void 0,(e,t)=>{c(t)&&m--}),p=i.advancer(n,(e,t)=>h(t)?-(e-g)-1:e-g,(e,t)=>{h(t)&&g++});for(let r of t)if("number"==typeof r){let n=f(r),i=r+m,a=p(i),o=i+g;s.descend(o),e(t,n,a,s),s.ascend()}else s.descend(r),e(t,f(r),p(r),s),s.ascend();f.end(),p.end()}(L,e,e.clone(),P),P.reset(),m)return{ok:!1,conflict:m};if(P.get(),H.length){let e=H.map(e=>e?e.get():null);if(B(i.readCursor(O(P.get())),P,(t,r,n)=>{let i=e[t];i&&(n.mergeTree(i),e[t]=null)}),e.find(e=>e)){let t=i.writeCursor(),r=i.writeCursor(),n=0,a=0;e.forEach(e=>{null!=e&&B(i.readCursor(e),null,e=>{let i=j[e];t.writeMove(g[i].getPath(),f[i].getPath(),n++);let s=U[i];s&&s.forEach(e=>{v[e]||1!==d&&null!=x[e]||r.writeMove(p[e].getPath(),C[e].getPath(),a++)})})}),m={type:s.ConflictType.BLACKHOLE,op1:t.get(),op2:r.get()}}}}return m?{ok:!1,conflict:m}:{ok:!0,result:P.get()}}let U=e=>{let t=Error("Transform detected write conflict");throw t.conflict=e,t.type=t.name="writeConflict",t},D=e=>{let t=i.writeCursor();return i.readCursor(e).traverse(t,(e,t)=>{(h(e)||R(e))&&t.write("r",!0)}),t.get()},V=(e,t)=>{let{type:r,op1:n,op2:a}=e;switch(r){case s.ConflictType.DROP_COLLISION:return"left"===t?[null,D(a)]:[D(n),null];case s.ConflictType.RM_UNEXPECTED_CONTENT:let o=!1;return i.readCursor(n).traverse(null,e=>{void 0!==e.r&&(o=!0)}),o?[null,D(a)]:[D(n),null];case s.ConflictType.BLACKHOLE:return[D(n),D(a)];default:throw Error("Unrecognised conflict: "+r)}};function L(e,t,r,n){let i=null;for(;;){let s=x(t,r,n);if(s.ok)return v(i,s.result);{let{conflict:a}=s;e(a)||U(a);let[o,l]=V(a,n);t=v(A(t),o),r=v(A(r),l),i=v(i,l)}}}}(sU)),sU),sx),oA=sP(),Object.defineProperty(sx,"ReadCursor",{enumerable:!0,get:function(){return oA.ReadCursor}}),Object.defineProperty(sx,"WriteCursor",{enumerable:!0,get:function(){return oA.WriteCursor}}),ov=sj(),Object.defineProperty(sx,"ConflictType",{enumerable:!0,get:function(){return ov.ConflictType}})),sx);let sQ=function(e,t){for(var r=0;r<t.length;r++){let n=t[r];if("string"!=typeof n&&!Array.isArray(n)){for(let t in n)if("default"!==t&&!(t in e)){let r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}({__proto__:null,default:tb(sK)},[sK]);var sZ=((eA=sZ||{})[eA.COVER=0]="COVER",eA[eA.REPLACE=1]="REPLACE",eA),sJ=((ev=sJ||{}).RETAIN="r",ev.INSERT="i",ev.DELETE="d",ev);let s0=(0,e2.createIdentifier)("univer.context-service");class s1 extends nJ{constructor(){super(...arguments),tg(this,"_contextChanged$",new(0,ts.Subject)),tg(this,"contextChanged$",this._contextChanged$.asObservable()),tg(this,"_contextMap",new Map)}dispose(){super.dispose(),this._contextChanged$.complete(),this._contextMap.clear()}getContextValue(e){var t;return null!=(t=this._contextMap.get(e))&&t}setContextValue(e,t){this._contextMap.set(e,t),this._contextChanged$.next({[e]:t})}subscribeContextValue$(e){return new(0,tt.Observable)(t=>{let r=this._contextChanged$.pipe((0,e9.filter)(t=>"u">typeof t[e])).subscribe(r=>t.next(r[e]));return this._contextMap.has(e)&&t.next(this._contextMap.get(e)),()=>r.unsubscribe()})}}var s2=((eT=s2||{})[eT.SILENT=0]="SILENT",eT[eT.ERROR=1]="ERROR",eT[eT.WARN=2]="WARN",eT[eT.INFO=3]="INFO",eT[eT.VERBOSE=4]="VERBOSE",eT);let s5=(0,e2.createIdentifier)("univer.log");class s3 extends nJ{constructor(){super(...arguments),tg(this,"_logLevel",3),tg(this,"_deduction",new Set)}dispose(){super.dispose(),this._logLevel=3,this._deduction.clear()}debug(...e){this._logLevel>=4&&this._log(console.debug,...e)}log(...e){this._logLevel>=3&&this._log(console.log,...e)}warn(...e){this._logLevel>=2&&this._log(console.warn,...e)}error(...e){this._logLevel>=1&&this._log(console.error,...e)}deprecate(...e){this._logLevel>=2&&this._logWithDeduplication(console.error,...e)}setLogLevel(e){this._logLevel=e}_log(e,...t){let r=t[0];/^\[(.*?)\]/g.test(r)?e(`\x1b[97;104m${r}\x1b[0m`,...t.slice(1)):e(...t)}_logWithDeduplication(e,...t){let r=function(...e){return e.map(e=>JSON.stringify(e)).join("")}(...t);this._deduction.has(r)||(this._deduction.add(r),this._log(e,...t))}}var s4=Object.getOwnPropertyDescriptor,s6=(e,t)=>(r,n)=>t(r,n,e),s9=((ew=s9||{})[ew.COMMAND=0]="COMMAND",ew[ew.OPERATION=1]="OPERATION",ew[ew.MUTATION=2]="MUTATION",ew);let s8=(0,e2.createIdentifier)("univer.core.command-service");class s7{constructor(){tg(this,"_commands",new Map),tg(this,"_commandTypes",new Map)}registerCommand(e){if(this._commands.has(e.id))throw Error(`[CommandRegistry]: command "${e.id}" has been registered before.`);return this._commands.set(e.id,e),this._commandTypes.set(e.id,e.type),nK(()=>{this.unregisterCommand(e.id)})}unregisterCommand(e){this._commands.delete(e),this._commandTypes.delete(e)}hasCommand(e){return this._commands.has(e)}getCommand(e){return this._commands.has(e)?[this._commands.get(e)]:null}getCommandType(e){return this._commandTypes.get(e)}}let ae={id:"nil",type:0,handler:()=>!0},at=class extends nJ{constructor(e,t){super(),tg(this,"_commandRegistry"),tg(this,"_beforeCommandExecutionListeners",[]),tg(this,"_commandExecutedListeners",[]),tg(this,"_multiCommandDisposables",new Map),tg(this,"_commandExecutingLevel",0),tg(this,"_commandExecutionStack",[]),this._injector=e,this._logService=t,this._commandRegistry=new s7,this.registerCommand(ae)}dispose(){super.dispose(),this._commandExecutedListeners.length=0,this._beforeCommandExecutionListeners.length=0}hasCommand(e){return this._commandRegistry.hasCommand(e)}registerCommand(e){return this._commandRegistry.registerCommand(e)}unregisterCommand(e){var t;this._commandRegistry.unregisterCommand(e),null==(t=this._multiCommandDisposables.get(e))||t.dispose()}registerMultipleCommand(e){return this._registerMultiCommand(e)}beforeCommandExecuted(e){if(-1===this._beforeCommandExecutionListeners.indexOf(e))return this._beforeCommandExecutionListeners.push(e),nK(()=>{let t=this._beforeCommandExecutionListeners.indexOf(e);this._beforeCommandExecutionListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}onCommandExecuted(e){if(-1===this._commandExecutedListeners.indexOf(e))return this._commandExecutedListeners.push(e),nK(()=>{let t=this._commandExecutedListeners.indexOf(e);this._commandExecutedListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}async executeCommand(e,t,r){try{let n=this._commandRegistry.getCommand(e);if(n){let[e]=n,i={id:e.id,type:e.type,params:t},s=this._pushCommandExecutionStack(i);this._beforeCommandExecutionListeners.forEach(e=>e(i,r));let a=await this._execute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(i,r)),s.dispose(),a}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof tk)return!1;throw e}}syncExecuteCommand(e,t,r){var n;try{let i=this._commandRegistry.getCommand(e);if(i){let[e]=i,s={id:e.id,type:e.type,params:t};if(2===e.type){let e=function(e,t){for(let r=e.length-1;r>-1;r--){let n=e[r];if(t(n,r))return n}return null}(this._commandExecutionStack,e=>0===e.type);e&&(s.params=null!=(n=s.params)?n:{},s.params.trigger=e.id)}let a=this._pushCommandExecutionStack(s);this._beforeCommandExecutionListeners.forEach(e=>e(s,r));let o=this._syncExecute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(s,r)),a.dispose(),o}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof tk)return!1;throw e}}_pushCommandExecutionStack(e){return this._commandExecutionStack.push(e),nK(()=>tp(this._commandExecutionStack,e))}_registerMultiCommand(e){let t,r=this._commandRegistry.getCommand(e.id);if(r){if(!0!==r[0].multi)throw Error("Command has registered as a single command.");t=r[0]}else{t=new ar(e.id);let r=new nZ;r.add(this._commandRegistry.registerCommand(t)),r.add(nK(()=>{this._multiCommandDisposables.delete(e.id)})),this._multiCommandDisposables.set(e.id,r)}let n=t.registerImplementation(e);return nK(()=>{var r;n.dispose(),t.hasImplementations()||null==(r=this._multiCommandDisposables.get(e.id))||r.dispose()})}async _execute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(this._commandExecutingLevel,0))}executing command "${e.id}"`),this._commandExecutingLevel++;try{n=await this._injector.invoke(e.handler,t,r),this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}_syncExecute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(0,this._commandExecutingLevel))}executing command "${e.id}".`),this._commandExecutingLevel++;try{if((n=this._injector.invoke(e.handler,t,r))instanceof Promise)throw TypeError("[CommandService]: Command handler should not return a promise.");this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}};at=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?s4(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([s6(0,(0,e2.Inject)(e2.Injector)),s6(1,s5)],at);class ar{constructor(e){tg(this,"name"),tg(this,"multi",!0),tg(this,"type",0),tg(this,"priority",0),tg(this,"_implementations",[]),tg(this,"handler",async(e,t)=>{if(!this._implementations.length)return!1;let r=e.get(s5),n=e.get(s0),i=e.get(e2.Injector);for(let e of this._implementations){let s=e.command.preconditions;if((!s||s&&s(n))&&(r.debug("[MultiCommand]",`executing implementation "${e.command.name}".`),await i.invoke(e.command.handler,t)))return!0}return!1}),this.id=e,this.name=e}registerImplementation(e){let t={command:e};return this._implementations.push(t),this._implementations.sort((e,t)=>t.command.priority-e.command.priority),nK(()=>{let e=this._implementations.indexOf(t);this._implementations.splice(e,1)})}hasImplementations(){return this._implementations.length>0}}function an(e,t,r){return nX(e.map(e=>()=>t.syncExecuteCommand(e.id,e.params,r)))}function ai(e,t,r){return nz(e.map(e=>()=>t.executeCommand(e.id,e.params,r)))}function as(e){return new(0,tt.Observable)(t=>{let r=e((...e)=>t.next(e));return()=>null==r?void 0:r.dispose()})}function aa(e){return function(t){return new(0,tt.Observable)(r=>(t.subscribe({next:t=>{r.next(t),e(t)&&r.complete()},complete:()=>r.complete(),error:e=>r.error(e)}),()=>r.unsubscribe()))}}function ao(e=0){return t=>{let r=[];return t.pipe((0,tl.tap)(e=>r.push(e)),(0,e4.debounceTime)(e),(0,e7.map)(()=>r),(0,tl.tap)(()=>r=[]))}}function al(e){let t=new(0,tn.ReplaySubject)(1);return setTimeout(()=>t.next(),e),t.pipe((0,to.take)(1))}function au(e,t){let r=new(0,e5.BehaviorSubject)(t);return e.subscribe(r),r}let ac=e=>new Promise(t=>{(0,te.merge)(as(e.onCommandExecuted.bind(e)).pipe((0,e9.filter)(([e])=>e.type===s9.MUTATION)),(0,tu.timer)(300)).pipe((0,e4.debounceTime)(16),(0,tc.first)()).subscribe(()=>{t()})});function ah(e,t){let r=0,n=e.length-1;if(t<e[0])return 0;if(t>=e[e.length-1])return e.length-1;for(;r<=n;){if(e[r]===t){for(;r<e.length&&e[r]===t;)r++;return r}if(t>e[r]&&t<e[r+1])return r+1;if(e[n]===t){for(;n<e.length&&e[n]===t;)n++;return n}if(t>e[n-1]&&t<e[n])return n;r++,n--}return -1}function ad(e,t){let r=0,n=e.length-1;for(;r<=n;){let i=Math.floor((n+r)/2);if(t<e[i]&&(0===i||t>=e[i-1]))return i;if(t>=e[i])r=i+1;else if(t<e[i])n=i-1;else break}return -1}function am(e,t){let r=0,n=e.length;for(;r<n;){let i=Math.floor((r+n)/2);e[i]<=t?r=i+1:n=i}return r<e.length?r:e.length-1}function ag(e,t,r=!1){let n=e.length-1;if(t<0||t<e[0])return 0;if(n=e.length<40||t<=e[20]||t>=e[n-20]?ah(e,t):am(e,t),r){let t=e[n];return e.indexOf(t)}return n}function af(e){let t=new Blob([e],{type:"text/javascript"});return window.URL.createObjectURL(t)}let ap=2,aC=1;function a_(e,t){if(null==t||null==e)return!0;let{left:r=0,top:n=0,height:i=0,width:s=0,angle:a=0}=t,{left:o=0,top:l=0,height:u=0,width:c=0,angle:h=0}=e;return Math.abs(o-r)>ap||Math.abs(l-n)>ap||Math.abs(c-s)>ap||Math.abs(u-i)>ap||Math.abs(h-a)>aC}function ay(e,t,r){let{dataStream:n,textRuns:i=[]}=e,s=t,a=[];for(let e of i){let{st:i,ed:o}=e;ir.hasIntersectionBetweenTwoRanges(t,r,i,o)&&(i>s?(a.push(n.slice(s,i)),a.push(aE(n,{...e,ed:Math.min(o,r)}))):a.push(aE(n,{...e,st:s,ed:Math.min(o,r)}))),s=Math.max(t,Math.min(o,r))}return s!==r&&a.push(n.slice(s,r)),a.join("")}function aR(e,t=!0){var r;if(!t||null==(r=e.paragraphs)||!r.length)return ay(e,0,e.dataStream.length);{let{dataStream:t,paragraphs:r=[]}=e,n="",i=-1;for(let t of r){let{startIndex:r,paragraphStyle:s={}}=t,{spaceAbove:a,spaceBelow:o,lineSpacing:l}=s,u=[];null!=a&&("number"==typeof a?u.push(`margin-top: ${a}px`):u.push(`margin-top: ${a.v}px`)),null!=o&&("number"==typeof o?u.push(`margin-bottom: ${o}px`):u.push(`margin-bottom: ${o.v}px`)),null!=l&&u.push(`line-height: ${l}`),r>i+1?n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}>${ay(e,i+1,r)}</p>`:n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}></p>`,i=r}return i!==t.length&&(n+=ay(e,i,t.length)),n}}function aE(e,t){let{st:r,ed:n,ts:i={}}=t,{ff:s,fs:a,it:o,bl:l,ul:u,st:c,ol:h,bg:d,cl:m,va:g}=i,f=e.slice(r,n),p=[];return o===iP.TRUE&&(f=`<i>${f}</i>`),g===iL.SUPERSCRIPT?f=`<sup>${f}</sup>`:g===iL.SUBSCRIPT&&(f=`<sub>${f}</sub>`),(null==u?void 0:u.s)===iP.TRUE&&(f=`<u>${f}</u>`),(null==c?void 0:c.s)===iP.TRUE&&(f=`<s>${f}</s>`),l===iP.TRUE&&(f=`<strong>${f}</strong>`),s&&p.push(`font-family: ${s}`),m&&p.push(`color: ${m.rgb}`),a&&p.push(`font-size: ${a}pt`),h&&p.push("text-decoration: overline"),d&&p.push(`background: ${d.rgb}`),p.length?`<span style="${p.join("; ")};">${f}</span>`:f}let ab={[ij.OFFICE]:{[iF.ACCENT1]:"#4472C4",[iF.ACCENT2]:"#ED7D31",[iF.ACCENT3]:"#A5A5A5",[iF.ACCENT4]:"#70AD47",[iF.ACCENT5]:"#5B9BD5",[iF.ACCENT6]:"#70AD47",[iF.DARK1]:"#000000",[iF.DARK2]:"#44546A",[iF.LIGHT1]:"#FFFFFF",[iF.LIGHT2]:"#E7E6E6",[iF.HYPERLINK]:"#0563C1",[iF.FOLLOWED_HYPERLINK]:"#954F72"}};class aI{constructor(){tg(this,"_themeValue",iF.LIGHT1),tg(this,"_themeColors"),tg(this,"_themeTint"),tg(this,"_rgbValue",""),tg(this,"_colorType"),this._colorType=ic.UNSUPPORTED,this._themeColors=ij.OFFICE,this._themeTint=0}asRgbColor(){return new av(this._rgbValue,this)}asThemeColor(){return new aw(this._themeValue,this._themeTint,this._themeColors,this)}build(){switch(this._colorType){case ic.THEME:return this.asThemeColor();case ic.RGB:return this.asRgbColor();case ic.UNSUPPORTED:throw Error("unsupported color type")}}setRgbColor(e){return this._colorType=ic.RGB,this._rgbValue=e,this}setThemeColors(e){this._colorType=ic.THEME,this._themeColors=e}setThemeTint(e){this._colorType=ic.THEME,this._themeTint=e}setThemeColor(e){return this._colorType=ic.THEME,this._themeValue=e,this}getColorType(){return this._colorType}}class aN{constructor(e){tg(this,"_builder"),this._builder=e}static rgbColorToHexValue(e){return`#${(0x1000000+(e.getRed()<<16)+(e.getGreen()<<8)+e.getBlue()).toString(16).slice(1)}`}static hexValueToRgbColor(e){e?e.indexOf("#")>-1&&(e=e.substring(1)):e="#000000";let t=+`0x${e[0]}${e[1]}`,r=+`0x${e[2]}${e[3]}`,n=+`0x${e[4]}${e[5]}`;return new aI().setRgbColor(`rgb(${t},${r},${n})`).asRgbColor()}static hexToRgbString(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,r,n)=>t+t+r+r+n+n);let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=null;if(t){let e=Number.parseInt(t[1],16),n=Number.parseInt(t[2],16),i=Number.parseInt(t[3],16);r=`rgba(${e},${n},${i})`}return r}asRgbColor(){return this._builder.asRgbColor()}asThemeColor(){return this._builder.asThemeColor()}getColorType(){return this._builder.getColorType()}clone(){return new aN(this._builder)}equals(e){return!1}}class aS{constructor(e){tg(this,"_saturation",0),tg(this,"_hue",0),tg(this,"_lightness",0),tg(this,"_alpha",0);let t=e.getRed()/255,r=e.getGreen()/255,n=e.getBlue()/255,i=e.getAlpha()/255,s=Math.min(t,Math.min(r,n)),a=Math.max(t,Math.max(r,n)),o=a-s;if(a===s){this._hue=0,this._saturation=0,this._lightness=a;return}this._lightness=(s+a)/2,this._lightness<.5?this._saturation=o/(a+s):this._saturation=o/(2-a-s),t===a&&(this._hue=(r-n)/o),r===a&&(this._hue=2+(n-t)/o),n===a&&(this._hue=4+(t-r)/o),this._hue*=60,this._hue<0&&(this._hue+=360),this._alpha=i}asRgbColor(){let e,t=new aI;if(0===this._saturation)return t.setRgbColor(`rgba(${255*this._lightness},${255*this._lightness},${255*this._lightness},${255*this._alpha})`),t.asRgbColor();e=this._lightness<.5?this._lightness*(1+this._saturation):this._lightness+this._saturation-this._lightness*this._saturation;let r=2*this._lightness-e,n=this._hue/360,i=this.setColor(e,r,n+1/3),s=this.setColor(e,r,n),a=this.setColor(e,r,n-1/3);return t.setRgbColor(`rgba(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*a)},${255*this._alpha})`),t.asRgbColor()}getLightness(){return this._lightness}getHue(){return this._hue}getSaturation(){return this._saturation}getAlpha(){return this._alpha}setColor(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+(e-t)*6*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}setLightness(e){this._lightness=e}}let aA=class e extends aN{constructor(t,r){super(r),tg(this,"_cssString"),tg(this,"_red"),tg(this,"_green"),tg(this,"_blue"),tg(this,"_alpha");let n=t.match(e.RGBA_EXTRACT);if(n){let e=+n[1],r=+n[2],i=+n[3],s=+n[4];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=s;return}if(n=t.match(e.RGB_EXTRACT)){let e=+n[1],r=+n[2],i=+n[3];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=1;return}throw Error("Invalid rgba or rgb color")}asHexString(){return aN.rgbColorToHexValue(this)}getRed(){let t=this._red+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getGreen(){let t=this._green+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getBlue(){let t=this._blue+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getAlpha(){return this._alpha}getColorType(){return ic.RGB}clone(){return new e(this._cssString,this._builder)}asThemeColor(){throw Error("rgb color not support to themeColor")}equals(t){return t instanceof e&&t._red===this._red&&t._blue===this._blue&&t._green===this._green&&t._alpha===this._alpha}getCssString(){return this._cssString}};tg(aA,"RGB_COLOR_AMT",0),tg(aA,"RGBA_EXTRACT",RegExp("\\s*rgba\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d.\\d|\\d\\s*)\\)\\s*")),tg(aA,"RGB_EXTRACT",RegExp("\\s*rgb\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*)\\)\\s*"));let av=aA,aT=class e extends aN{constructor(e,t,r,n){super(n),tg(this,"_themeColorType"),tg(this,"_themeTint"),tg(this,"_themeColors"),this._themeColorType=e,this._themeTint=t,this._themeColors=r}lumValue(e,t){return null==e?t:e<0?t*(1+e):t*(1-e)+(255-255*(1-e))}asRgbColor(){let t,r=ab[this._themeColors];if(null==r)throw Error("not find themeColors type");let n=r[this._themeColorType];if(null==n)throw Error("not find themeColors value");if(e._cacheThemeColor.has(this._themeColors)){if((t=e._cacheThemeColor.get(this._themeColors)).has(this._themeColorType))return t.get(this._themeColorType)}else t=new Map,e._cacheThemeColor.set(this._themeColors,t);let i=new aS(aN.hexValueToRgbColor(n));i.setLightness(this.lumValue(this._themeTint,255*i.getLightness())/255);let s=i.asRgbColor();return t.set(this._themeColorType,s),s}clone(){return new e(this._themeColorType,this._themeTint,this._themeColors,this._builder)}equals(t){return t instanceof e&&t._themeColorType===this._themeColorType}getColorType(){return ic.THEME}getThemeColorType(){return this._themeColorType}};tg(aT,"_cacheThemeColor",new Map);let aw=aT,aM="rgb(",aO="rgba(",ax={aliceBlue:[240,248,255],antiqueWhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blancheAlmond:[255,235,205],blue:[0,0,255],blueViolet:[138,43,226],brown:[165,42,42],burlyWood:[222,184,135],cadetBlue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornFlowerBlue:[100,149,237],cornSilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkCyan:[0,139,139],darkGoldenrod:[184,132,11],darkGray:[169,169,169],darkGreen:[0,100,0],darkGrey:[169,169,169],darkKhaki:[189,183,107],darkMagenta:[139,0,139],darkOliveGreen:[85,107,47],darkOrange:[255,140,0],darkOrchid:[153,50,204],darkRed:[139,0,0],darkSalmon:[233,150,122],darkSeaGreen:[143,188,143],darkSlateBlue:[72,61,139],darkSlateGray:[47,79,79],darkSlateGrey:[47,79,79],darkTurquoise:[0,206,209],darkViolet:[148,0,211],deepPink:[255,20,147],deepSkyBlue:[0,191,255],dimGray:[105,105,105],dimGrey:[105,105,105],dodgerBlue:[30,144,255],firebrick:[178,34,34],floralWhite:[255,255,240],forestGreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostWhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenYellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotPink:[255,105,180],indianRed:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderBlush:[255,240,245],lawnGreen:[124,252,0],lemonChiffon:[255,250,205],lightblue:[173,216,230],lightCoral:[240,128,128],lightCyan:[224,255,255],lightGoldenrodYellow:[250,250,210],lightGray:[211,211,211],lightGreen:[144,238,144],lightGrey:[211,211,211],lightPink:[255,182,193],lightSalmon:[255,160,122],lightSeaGreen:[32,178,170],lightSkyBlue:[135,206,250],lightSlateGray:[119,136,153],lightSlateGrey:[119,136,153],lightSteelBlue:[176,196,222],lightYellow:[255,255,224],lime:[0,255,0],limeGreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumAquamarine:[102,205,170],mediumBlue:[0,0,205],mediumOrchid:[186,85,211],mediumPurple:[147,112,219],mediumSeaGreen:[60,179,113],mediumSlateBlue:[123,104,238],mediumSpringGreen:[0,250,154],mediumTurquoise:[72,209,204],mediumVioletRed:[199,21,133],midBightBlue:[25,25,112],mintCream:[245,255,250],mistyRose:[255,228,225],moccasin:[255,228,181],navajoWhite:[255,222,173],navy:[0,0,128],oldLace:[253,245,230],olive:[128,128,0],oliveDrab:[107,142,35],orange:[255,165,0],orangeRed:[255,69,0],orchid:[218,112,214],paleGoldenrod:[238,232,170],paleGreen:[152,251,152],paleTurquoise:[175,238,238],paleVioletRed:[219,112,147],papayaWhip:[255,239,213],peachPuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderBlue:[176,224,230],purple:[128,0,128],rebeccaPurple:[102,51,153],red:[255,0,0],rosyBrown:[188,143,143],royalBlue:[65,105,225],saddleBrown:[139,69,19],salmon:[250,128,114],sandyBrown:[244,164,96],seaGreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyBlue:[135,206,235],slateBlue:[106,90,205],slateGray:[119,128,144],slateGrey:[119,128,144],snow:[255,255,250],springGreen:[0,255,127],steelBlue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whiteSmoke:[245,245,245],yellow:[255,255,0],yellowGreen:[154,205,5]};class aU{constructor(e){if(tg(this,"_color"),tg(this,"_rgbColor"),tg(this,"_isValid",!1),null==e)return void this._setNullColor();if(e instanceof aU){this._color={...e._color},this._rgbColor={...e._rgbColor};return}let t=aL(e);if(null==t)return void this._setNullColor();this._color=t;let r=aB(this._color);if(null==r)return void this._setNullColor();this._rgbColor=r,this._isValid=!0}static mix(e,t,r){var n,i;r=Math.min(1,Math.max(0,r));let s=new aU(e).toRgb(),a=new aU(t).toRgb(),o=null!=(n=s.a)?n:1,l=null!=(i=a.a)?i:1;return new aU({r:(a.r-s.r)*r+s.r,g:(a.g-s.g)*r+s.g,b:(a.b-s.b)*r+s.b,a:(l-o)*r+o})}static getContrastRatio(e,t){let r=new aU(e).getLuminance(),n=new aU(t).getLuminance();return(Math.max(r,n)+.05)/(Math.min(r,n)+.05)}get isValid(){return this._isValid}toRgb(){return this._rgbColor}toRgbString(){let{r:e,g:t,b:r,a:n=1}=this.toRgb(),i=n<1;return`rgb${i?"a":""}(${e},${t},${r}${i?`,${n}`:""})`}toString(){return this.toRgbString()}toHexString(e){let{r:t,g:r,b:n,a:i=1}=this.toRgb(),s=i<1,a=[aD(Math.round(t).toString(16)),aD(Math.round(r).toString(16)),aD(Math.round(n).toString(16)),aD(Math.round(255*i).toString(16))];return e&&a[0][0]===a[0][1]&&a[1][0]===a[1][1]&&a[2][0]===a[2][1]&&a[3][0]===a[3][1]?s?`#${a[0][0]}${a[1][0]}${a[2][0]}${a[3][0]}`:`#${a[0][0]}${a[1][0]}${a[2][0]}`:s?`#${a[0]}${a[1]}${a[2]}${a[3]}`:`#${a[0]}${a[1]}${a[2]}`}toHsv(){return aY(this.toRgb())}toHsl(){return aG(this.toRgb())}lighten(e=10){let t=this.toHsl();return t.l+=e,t.l=Math.min(Math.max(t.l,0),100),new aU(t)}darken(e=10){let t=this.toHsl();return t.l-=e,t.l=Math.min(Math.max(t.l,0),100),new aU(t)}setAlpha(e){return new aU({...this._rgbColor,a:e})}getLuminance(){let{r:e,g:t,b:r}=this.toRgb();return e=aV(e),Number((.2126*e+.7152*(t=aV(t))+.0722*(r=aV(r))).toFixed(3))}getBrightness(){let{r:e,g:t,b:r}=this.toRgb();return(299*e+587*t+114*r)/1e3}getAlpha(){var e;return null!=(e=this._color.a)?e:1}isDark(){return 128>this.getBrightness()}isLight(){return!this.isDark()}_setNullColor(){this._isValid=!1,this._color={r:0,g:0,b:0,a:0},this._rgbColor={r:0,g:0,b:0,a:0}}}let aD=e=>1===e.length?`0${e}`:e,aV=e=>(e/=255)<=.03928?e/12.92:((e+.055)/1.055)**2.4,aL=e=>{if(az(e)){if("r"in e){let t={r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)};return void 0!==e.a&&(t.a=e.a),t}if("l"in e){let t={h:Math.round(e.h),s:e.s,l:e.l};return void 0!==e.a&&(t.a=e.a),t}let t={h:Math.round(e.h),s:e.s,v:e.v};return void 0!==e.a&&(t.a=e.a),t}let t=e.trim();if(ax[t]){let e=ax[t],r={r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])};return r.a=e[3]||1,r}return t.startsWith("#")?aP(t):t.startsWith("rgb")?ak(t):t.startsWith("hsl")?aF(t):t.startsWith("hsv")?aj(t):void 0},aP=e=>{let t=e.substring(1),r=RegExp(`.{1,${t.length>=6?2:1}}`,"g"),n=t.match(r);if(!n||n.length<3)throw Error(`The color '${e}' is illegal hex color`);1===n[0].length&&(n=n.map(e=>e+e));let i={r:Number.parseInt(n[0],16),g:Number.parseInt(n[1],16),b:Number.parseInt(n[2],16)};return n.length>3&&(i.a=Number.parseInt(n[3],16)/255),i},ak=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal rgb color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal rgb color`);let n={r:Number.parseInt(r[0],10),g:Number.parseInt(r[1],10),b:Number.parseInt(r[2],10)};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},aF=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsl color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsl color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),l:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},aj=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsv color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsv color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),v:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},aB=e=>{let t=aL(e);if(null!=t)return"r"in t?t:"l"in t?aH(t):aW(t)},a$=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e),aH=e=>{let{h:t,s:r,l:n}=e;t/=360,r/=100,n/=100;let i=0,s=0,a=0;if(0===r)i=s=a=n;else{let e=n<.5?n*(1+r):n+r-n*r,o=2*n-e;i=a$(o,e,t+1/3),s=a$(o,e,t),a=a$(o,e,t-1/3)}let o={r:Math.round(255*i),g:Math.round(255*s),b:Math.round(255*a)};return void 0!==e.a&&(o.a=e.a),o},aW=e=>{let{h:t,s:r,v:n}=e;t=t/360*6,r/=100,n/=100;let i=Math.floor(t),s=t-i,a=n*(1-r),o=n*(1-s*r),l=n*(1-(1-s)*r),u=i%6,c={r:255*[n,o,a,a,l,n][u],g:255*[l,n,n,o,a,a][u],b:255*[a,a,l,n,n,o][u]};return void 0!==e.a&&(c.a=e.a),c},aG=e=>{let t,r,{r:n,g:i,b:s}=e;n/=255;let a=Math.max(n,i/=255,s/=255),o=Math.min(n,i,s),l=(a+o)/2;if(a===o)t=r=0;else{let e=a-o;switch(r=l>.5?e/(2-a-o):e/(a+o),a){case n:t=(i-s)/e+6*(i<s);break;case i:t=(s-n)/e+2;break;default:t=(n-i)/e+4}t/=6}let u={h:Math.round(360*t),s:Math.round(100*r),l:Math.round(100*l)};return void 0!==e.a&&(u.a=e.a),u},aY=e=>{let t,{r:r,g:n,b:i}=e;r/=255;let s=Math.max(r,n/=255,i/=255),a=Math.min(r,n,i),o=s-a;if(s===a)t=0;else{switch(s){case r:t=(n-i)/o+6*(n<i);break;case n:t=(i-r)/o+2;break;default:t=(r-n)/o+4}t/=6}let l={h:Math.round(360*t),s:Math.round(100*(0===s?0:o/s)),v:Math.round(100*s)};return void 0!==e.a&&(l.a=e.a),l},az=e=>null!=e&&"object"==typeof e;function aX(e){return!!(/^#(?:[0]{3}|[0]{6})\b/.test(e)||/^rgb\s*\(\s*0+\s*,\s*0+\s*,\s*0+\s*\)$/.test(e)||/^rgba\s*\(\s*0+\s*,\s*0+\s*,\s*0+\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e)||/^hsl\s*\(\s*0*\s*,\s*0%*\s*,\s*0%*\s*\)$/.test(e)||/^hsla\s*\(\s*0*\s*,\s*0%*\s*,\s*0%*\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e))}function aq(e){return!!(/^#(?:[Ff]{3}|[Ff]{6})\b/.test(e)||/^rgb\s*\(\s*255\s*,\s*255\s*,\s*255\s*\)$/.test(e)||/^rgba\s*\(\s*255\s*,\s*255\s*,\s*255\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e)||/^hsl\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*\)$/.test(e)||/^hsla\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e))}function aK(e){return e&&(void 0!==e.s||void 0!==e.p||void 0!==e.v||void 0!==e.t||void 0!==e.f||void 0!==e.si||void 0!==e.custom)}function aQ(e){return void 0!==e.t?e.t:"string"==typeof e.v?ik.STRING:"number"==typeof e.v?ik.NUMBER:"boolean"==typeof e.v?ik.BOOLEAN:void 0}function aZ(e){if(null==e)return!0;let{v:t,f:r,si:n,p:i,custom:s}=e;return!(null!=t&&("string"!=typeof t||0!==t.length)||null!=r&&r.length>0||null!=n&&n.length>0||null!=i||null!=s)}function aJ(e){return null!=e&&("string"==typeof e||"number"==typeof e||"boolean"==typeof e)}var a0=((eM=a0||{})[eM.NORMAL=0]="NORMAL",eM[eM.ROW=1]="ROW",eM[eM.COLUMN=2]="COLUMN",eM[eM.ALL=3]="ALL",eM),a1=((eO=a1||{})[eO.NONE=0]="NONE",eO[eO.ROW=1]="ROW",eO[eO.COLUMN=2]="COLUMN",eO[eO.ALL=3]="ALL",eO);function a2(e){return[e.startRow,e.startColumn,e.endRow,e.endColumn]}var a5=((ex=a5||{}).NONE="none",ex.BACKWARD="backward",ex.FORWARD="forward",ex),a3=((eU=a3||{}).RECT="RECT",eU.TEXT="TEXT",eU);function a4(e,t,r){let n=!1,i=!1,s=e,a=t,o=e,l=t;if(null==r)return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l};for(let u=0;u<r.length;u++){let{startRow:c,endRow:h,startColumn:d,endColumn:m}=r[u];if(e===c&&t===d){s=h,a=m,o=c,l=d,i=!0;break}if(e>=c&&e<=h&&t>=d&&t<=m){s=h,a=m,o=c,l=d,n=!0;break}}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}var a6=((eD=a6||{}).Raw="raw",eD.Intercepted="intercepted",eD.Both="both",eD);function a9(e,t){let r={};for(let n in e){let i=Number(n),s=e[i];for(let e in s){let n=Number(e),a=s[n],o=t(i,n,a);void 0!==o&&(r[i]?r[i][n]=o:r[i]={[n]:o})}}return r}function a8(e){let t=0;for(let r of Object.keys(e))t=Math.max(t,Number(r));return t+1}function a7(e,t,r){let n=a8(r);for(let t=n-1;t>=e;t--)r[t+1]=r[t];r[e]=t}function oe(e,t,r){let n=Object.keys(r).reduce((e,t)=>Math.max(e,Number.parseInt(t)),0)+1;for(let i=e;i<n;i++)i<e+t?delete r[i]:void 0!==r[i]&&(r[i-t]=r[i],delete r[i])}function ot(e,t){let r=Object.keys(e),n=r.length,i=Object.keys(t),s=i.length,a={},o=0;for(let t=0;t<n;t++,o++){let n=r[t];a[o]=e[n]}for(let e=0;e<s;e++,o++){let r=i[e];a[o]=t[r]}return a}function or(e,t,r){if(a8(r)>0){let n={},i=0;for(let s=e;s<=t;s++)r[s]&&(n[i]=r[s],i++);return n}return{}}function on(e,t,r,n){let i=e>r;if(!i&&e+t>r)throw Error("Invalid move operation");i?function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e-1;i>=r;i--){let e=n[i];n[i+t]=e,void 0===e&&delete n[i+t]}i.forEach((e,t)=>{n[r+t]=e,void 0===e&&delete n[r+t]})}(e,t,r,n):function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e+t;i<r;i++){let e=n[i];n[i-t]=e,void 0===e&&delete n[i-t]}i.forEach((e,i)=>{n[r+i-t]=e,void 0===e&&delete n[r+i-t]})}(e,t,r,n)}class oi{constructor(e={}){tg(this,"_matrix"),this._setOriginValue(e)}static MakeObjectMatrixSize(e){return new oi({[e-1]:{}})}getMatrix(){return this._matrix}forEach(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,i))break}return this}forRow(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,Object.keys(i).map(e=>Number(e))))break}return this}forValue(e){let t=this._matrix;for(let r in t){let n=Number(r),i=t[n];if(i)for(let t in i){let r=Number(t),s=i[r];if(!1===e(n,r,s))return this}}return this}swapRow(e,t){let r=this._matrix[e],n=this._matrix[t];this._matrix[e]=n,this._matrix[t]=r}getRow(e){return this._matrix[e]}getRowOrCreate(e){let t=this.getRow(e);return null==t&&(t={},this._matrix[e]=t),t}reset(){this._setOriginValue({})}hasValue(){let e=this._matrix,t=Object.keys(e);if(0===t.length)return!1;for(let r of t)if(Object.keys(e[Number(r)]).length>0)return!0;return!1}getValue(e,t){var r,n;return null==(n=null==(r=this._matrix)?void 0:r[e])?void 0:n[t]}setValue(e,t,r){this.getRowOrCreate(e)[t]=r}deleteValue(e,t){var r,n;null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t]}realDeleteValue(e,t){var r,n,i;if(null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t],this.getRow(e)){let t=this.getRow(e);if(null==t)return;0===Object.keys(t).length&&(null==(i=this._matrix)||delete i[e])}}setRow(e,t){this._matrix[e]=t}moveRows(e,t,r){on(e,t,r,this._matrix)}moveColumns(e,t,r){this.forEach((n,i)=>{on(e,t,r,i)})}insertRows(e,t){for(let r=e;r<e+t;r++)a7(r,{},this._matrix)}insertColumns(e,t){for(let r=e;r<e+t;r++)this.forEach((e,t)=>{t&&a7(r,void 0,t)})}removeRows(e,t){oe(e,t,this._matrix)}removeColumns(e,t){this.forEach((r,n)=>{n&&oe(e,t,n)})}getFragment(e,t,r,n){let i=new oi,s=0;for(let a=e;a<=t;a++){let e={},t=0;for(let i=r;i<=n;i++){let r=this.getValue(a,i);e[t]=r,t++}i.setRow(s,e),s++}return i}getSlice(e,t,r,n){let i=new oi;for(let s=e;s<=t;s++)for(let e=r;e<=n;e++){let t=this.getValue(s,e);t&&i.setValue(s,e,ir.deepClone(t))}return i}getSizeOf(){return Object.keys(this._matrix).length}getLength(){return a8(this._matrix)}getRange(){let e=this.getLength()-1,t=0,r=this.getLength();for(let e=0;e<r;e++){let r=this.getRow(e);if(r){let e=a8(r)-1;t=e>t?e:t}}return{startRow:0,startColumn:0,endRow:e,endColumn:t}}toNativeArray(){let e=[];return this.forValue((t,r,n)=>{e.push(n)}),e}toArray(){let e=[];return this.forRow((t,r)=>{null==e[t]&&(e[t]=[]),r.forEach(r=>{e[t][r]=this.getValue(t,r)})}),e}toFullArray(){let{endColumn:e,endRow:t}=this.getRange(),r=[];for(let n=0;n<=t;n++){let t=Array(e+1).fill(void 0);r.push(t)}return this.forValue((e,t,n)=>{r[e][t]=n}),r}toJSON(){return this._matrix}clone(){return JSON.parse(JSON.stringify(this._matrix))}getData(){return JSON.parse(JSON.stringify(this._matrix))}getArrayData(){let e=0,t=0,r=!1,n=!1,i=new oi;return this.forEach((s,a)=>{r||(r=!0,e=s),Object.keys(a).forEach(r=>{let a=Number(r);n?a<t&&(t=a):(n=!0,t=a);let o=this.getValue(s,a);i.setValue(s-e,a-t,o)})}),i.getData()}getStartEndScope(){let e=1/0,t=-1/0,r=1/0,n=-1/0,i=Object.keys(this._matrix);for(let s of(i.length>0&&(e=+i[0],t=+i[i.length-1]),i)){let e=Object.keys(this._matrix[s]);e.length>0&&(r=Math.min(r,+e[0]),n=Math.max(n,+e[e.length-1]))}return{startRow:e,endRow:t,startColumn:r,endColumn:n}}getDataRange(){let e=0,t=0,r=0,n=-1,i=!1,s=!1;return this.forEach((a,o)=>{if(i||(i=!0,e=a),null==o)return;let l=a8(o)-1;l>r&&(r=l),Object.keys(o).forEach(e=>{let r=Number(e);s?r<t&&(t=r):(s=!0,t=r)}),a>n&&(n=a)}),{startRow:e,startColumn:t,endRow:n,endColumn:r}}getDiscreteRanges(){let e=[];return this.forEach((t,r)=>{Object.keys(r).forEach(r=>{let n=Number(r),i=!1;for(let r of e)if(t>=r.startRow&&t<=r.endRow+1&&n>=r.startColumn&&n<=r.endColumn+1){r.endRow=Math.max(t,r.endRow),r.endColumn=Math.max(n,r.endColumn),i=!0;break}i||e.push({startRow:t,endRow:t,startColumn:n,endColumn:n})})}),e}merge(e){this.forValue((t,r)=>{let n=e.getValue(t,r);null!=n&&this.setValue(t,r,n)})}_setOriginValue(e={}){this._matrix=e}}function os(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,mergeInfo:s}=e,{startY:a,endY:o,startX:l,endX:u}=e,c=t,h=r,d=t,m=r;if(n&&s){let{startRow:e,startColumn:t,endRow:r,endColumn:n,startY:i,endY:g,startX:f,endX:p}=s;c=e,h=t,d=r,m=n,a=i,o=g,l=f,u=p}return i&&(a=s.startY,o=s.endY,l=s.startX,u=s.endX,d=s.endRow,m=s.endColumn),{startRow:c,startColumn:h,endRow:d,endColumn:m,startY:a,endY:o,startX:l,endX:u}}let oa=os;function oo(e){if(!e)return;let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,startRow:s,startColumn:a,endRow:o,endColumn:l}=e,u=t,c=r,h=t,d=r;return(n||i)&&(u=s,c=a,h=o,d=l),{startRow:u,startColumn:c,endRow:h,endColumn:d}}function ol(e){var t;return!e||0===((null==(t=null==e?void 0:e.v)?void 0:t.toString())||"").length&&!e.p}function ou(e){return ol(e)&&(null==e?void 0:e.coverable)!==!1}function oc(e){if(e){if(e.rgb)return e.rgb;if(e.th)return new aI().setThemeColor(e.th).asThemeColor().asRgbColor().getCssString()}return null}function oh(e){return ir.isString(e)&&"="===e.substring(0,1)&&e.length>1}function od(e){return ir.isString(e)&&e.length>0}function om(e,t=!1){var r;let n="",i=new Map([["ff",()=>{e.ff&&(n+=`font-family: ${e.ff}; `)}],["fs",()=>{if(e.fs){let t=e.fs;e.va&&(t/=2),n+=`font-size: ${t}pt; `}}],["it",()=>{e.it&&(n+="font-style: italic; ")}],["bl",()=>{e.bl&&(n+="font-weight: bold; ")}],["ul",()=>{var t;null!=(t=e.ul)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} underline`):n+="text-decoration: underline; ",e.ul.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${oc(e.ul.cl)}; `),e.ul.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ul.t} `))}],["st",()=>{var t;null!=(t=e.st)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} line-through`):n+="text-decoration-line: line-through; ",e.st.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${oc(e.st.cl)}; `),e.st.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.st.t} `))}],["ol",()=>{var t;null!=(t=e.ol)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} overline`):n+="text-decoration-line: overline; ",e.ol.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${oc(e.ol.cl)}; `),e.ol.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ol.t} `))}],["bg",()=>{e.bg&&(n+=`background: ${oc(e.bg)}; `)}],["bd",()=>{var t,r,i,s,a,o,l,u,c,h,d,m;null!=(t=e.bd)&&t.b&&(n+=`border-bottom: ${og(null==(r=e.bd)?void 0:r.b.s)} ${null!=(i=oc(e.bd.b.cl))?i:""}; `),null!=(s=e.bd)&&s.t&&(n+=`border-top: ${og(null==(a=e.bd)?void 0:a.t.s)} ${null!=(o=oc(e.bd.t.cl))?o:""}; `),null!=(l=e.bd)&&l.r&&(n+=`border-right: ${og(null==(u=e.bd)?void 0:u.r.s)} ${null!=(c=oc(e.bd.r.cl))?c:""}; `),null!=(h=e.bd)&&h.l&&(n+=`border-left: ${og(null==(d=e.bd)?void 0:d.l.s)} ${null!=(m=oc(e.bd.l.cl))?m:""}; `)}],["cl",()=>{e.cl&&(n+=`color: ${oc(e.cl)}; `)}],["va",()=>{e.va===iL.SUBSCRIPT?n+="vertical-align: sub; ":e.va===iL.SUPERSCRIPT&&(n+="vertical-align: super; ")}],["td",()=>{e.td===iw.LEFT_TO_RIGHT?n+="direction: ltr; ":e.td===iw.RIGHT_TO_LEFT&&(n+="direction: rtl; ")}],["tr",()=>{var t,r,i;e.tr&&(n+=`--data-rotate: (${null==(t=e.tr)?void 0:t.a}deg${null!=(r=e.tr)&&r.v?` ,${null==(i=e.tr)?void 0:i.v}`:""});`)}],["ht",()=>{e.ht===iO.LEFT?n+="text-align: left; ":e.ht===iO.RIGHT?n+="text-align: right; ":e.ht===iO.CENTER?n+="text-align: center; ":e.ht===iO.JUSTIFIED&&(n+="text-align: justify; ")}],["vt",()=>{e.vt===ix.BOTTOM?n+="vertical-align: bottom; ":e.vt===ix.TOP?n+="vertical-align: top; ":e.vt===ix.MIDDLE&&(n+="vertical-align: middle; ")}],["tb",()=>{e.tb===iU.CLIP?n+="white-space: nowrap; overflow-x: hidden; ":e.tb===iU.WRAP&&(n+="white-space: normal;")}],["pd",()=>{var t,r,i,s,a,o,l,u;let c=`${null==(t=e.pd)?void 0:t.b}pt`,h=`${null==(r=e.pd)?void 0:r.t}pt`,d=`${null==(i=e.pd)?void 0:i.l}pt`,m=`${null==(s=e.pd)?void 0:s.r}pt`;null!=(a=e.pd)&&a.b&&(n+=`padding-bottom: ${c}; `),null!=(o=e.pd)&&o.t&&(n+=`padding-top: ${h}; `),null!=(l=e.pd)&&l.l&&(n+=`padding-left: ${d}; `),null!=(u=e.pd)&&u.r&&(n+=`padding-right: ${m}; `)}]]),s=["bd","tr","tb"];for(let n in e)t&&s.includes(n)||null==(r=i.get(n))||r();return n}function og(e){let t="";return e===il.NONE?t="none":e===il.THIN?t="0.5pt solid":e===il.HAIR?t="0.5pt double":e===il.DOTTED?t="0.5pt dotted":e===il.DASHED||e===il.DASH_DOT?t="0.5pt dashed":e===il.DASH_DOT_DOT?t="0.5pt dotted":e===il.DOUBLE?t="0.5pt double":e===il.MEDIUM?t="1pt solid":e===il.MEDIUM_DASHED||e===il.MEDIUM_DASH_DOT?t="1pt dashed":e===il.MEDIUM_DASH_DOT_DOT?t="1pt dotted":e===il.SLANT_DASH_DOT?t="0.5pt dashed":e===il.THICK&&(t="1.5pt solid"),t}function of(e){let t=0;if("none"===(e=e.trim()))t=il.NONE;else if("0.5pt solid"===e)t=il.THIN;else if("0.5pt double"===e)t=il.HAIR;else if("0.5pt dotted"===e)t=il.DOTTED;else if("0.5pt dashed"===e)t=il.DASHED;else if("1pt solid"===e)t=il.MEDIUM;else if("1pt dashed"===e)t=il.MEDIUM_DASHED;else if("1pt dotted"===e)t=il.MEDIUM_DASH_DOT_DOT;else if("1.5pt solid"===e)t=il.THICK;else{if(e.includes("none"))return il.NONE;t=il.THIN}return t}function op(e,t){let r=e.body;if(t){let{headers:n,footers:i}=e;null!=n&&n[t]?r=n[t].body:null!=i&&i[t]&&(r=i[t].body)}return r}function oC(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s,rangeType:a}=e;if(r<0||i<0||n<0||s<0||!(Number.isNaN(r)&&Number.isNaN(n))&&a===a0.COLUMN||!(Number.isNaN(i)&&Number.isNaN(s))&&a===a0.ROW||a!==a0.ROW&&a!==a0.COLUMN&&(Number.isNaN(i)||Number.isNaN(r)||Number.isNaN(s)||Number.isNaN(n)))return!1;if(t){let e=t.getRowCount(),r=t.getColumnCount();if(n>=e||s>=r)return!1}return!0}function o_(e,t){return{startRow:e,endRow:e,startColumn:t,endColumn:t}}function oy(e){return oh(e)?{f:e,v:null,p:null}:aJ(e)?{v:e,p:null,f:null}:(aK(e),e)}function oR(e,t){let r=new oi,{startRow:n,startColumn:i,endRow:s,endColumn:a}=t;if(ir.isArray(e))for(let t=0;t<=s-n;t++)for(let s=0;s<=a-i;s++)r.setValue(t+n,s+i,oy(e[t][s]));else new oi(e).forValue((e,t,n)=>{r.setValue(e,t,oy(n))});return r.getMatrix()}function oE(e,t){return Object.prototype.toString.call(e)===Object.prototype.toString.call(t)&&("[object Object]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>oE(e[r],t[r])):e===t)}function ob(e,t){let r=e.ts||{},n=t.ts||{};return e.sId===t.sId&&oE(r,n)}function oI(e,t){return t.some(t=>e.indexOf(t)>-1)}var oN,oS,oA,ov,oT,ow,oM,oO,ox={exports:{}};ox.exports;let oU=tb((oO||(oO=1,oD="millisecond",oV="second",oL="minute",oP="hour",ok="week",oF="month",oj="quarter",oB="year",o$="date",oH="Invalid Date",oW=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,oG=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,oY=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},(oX={})[oz="en"]={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},oq="$isDayjsObject",oK=function(e){return e instanceof o0||!(!e||!e[oq])},oQ=function e(t,r,n){var i;if(!t)return oz;if("string"==typeof t){var s=t.toLowerCase();oX[s]&&(i=s),r&&(oX[s]=r,i=s);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var o=t.name;oX[o]=t,i=o}return!n&&i&&(oz=i),i||!n&&oz},oZ=function(e,t){if(oK(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new o0(r)},(oJ={s:oY,z:function(e){var t=-e.utcOffset(),r=Math.abs(t);return(t<=0?"+":"-")+oY(Math.floor(r/60),2,"0")+":"+oY(r%60,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,oF),s=r-i<0,a=t.clone().add(n+(s?-1:1),oF);return+(-(n+(r-i)/(s?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return({M:oF,y:oB,w:ok,d:"day",D:o$,h:oP,m:oL,s:oV,ms:oD,Q:oj})[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}}).l=oQ,oJ.i=oK,oJ.w=function(e,t){return oZ(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})},o1=(o0=function(){function e(e){this.$L=oQ(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[oq]=!0}var t=e.prototype;return t.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(oJ.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(oW);if(n){var i=n[2]-1||0,s=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(t)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return oJ},t.isValid=function(){return this.$d.toString()!==oH},t.isSame=function(e,t){var r=oZ(e);return this.startOf(t)<=r&&r<=this.endOf(t)},t.isAfter=function(e,t){return oZ(e)<this.startOf(t)},t.isBefore=function(e,t){return this.endOf(t)<oZ(e)},t.$g=function(e,t,r){return oJ.u(e)?this[t]:this.set(r,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,t){var r=this,n=!!oJ.u(t)||t,i=oJ.p(e),s=function(e,t){var i=oJ.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?i:i.endOf("day")},a=function(e,t){return oJ.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},o=this.$W,l=this.$M,u=this.$D,c="set"+(this.$u?"UTC":"");switch(i){case oB:return n?s(1,0):s(31,11);case oF:return n?s(1,l):s(0,l+1);case ok:var h=this.$locale().weekStart||0,d=(o<h?o+7:o)-h;return s(n?u-d:u+(6-d),l);case"day":case o$:return a(c+"Hours",0);case oP:return a(c+"Minutes",1);case oL:return a(c+"Seconds",2);case oV:return a(c+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,t){var r,n=oJ.p(e),i="set"+(this.$u?"UTC":""),s=((r={}).day=i+"Date",r[o$]=i+"Date",r[oF]=i+"Month",r[oB]=i+"FullYear",r[oP]=i+"Hours",r[oL]=i+"Minutes",r[oV]=i+"Seconds",r[oD]=i+"Milliseconds",r)[n],a="day"===n?this.$D+(t-this.$W):t;if(n===oF||n===oB){var o=this.clone().set(o$,1);o.$d[s](a),o.init(),this.$d=o.set(o$,Math.min(this.$D,o.daysInMonth())).$d}else s&&this.$d[s](a);return this.init(),this},t.set=function(e,t){return this.clone().$set(e,t)},t.get=function(e){return this[oJ.p(e)]()},t.add=function(e,t){var r,n=this;e=Number(e);var i=oJ.p(t),s=function(t){var r=oZ(n);return oJ.w(r.date(r.date()+Math.round(t*e)),n)};if(i===oF)return this.set(oF,this.$M+e);if(i===oB)return this.set(oB,this.$y+e);if("day"===i)return s(1);if(i===ok)return s(7);var a=((r={})[oL]=6e4,r[oP]=36e5,r[oV]=1e3,r)[i]||1,o=this.$d.getTime()+e*a;return oJ.w(o,this)},t.subtract=function(e,t){return this.add(-1*e,t)},t.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||oH;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=oJ.z(this),s=this.$H,a=this.$m,o=this.$M,l=r.weekdays,u=r.months,c=r.meridiem,h=function(e,r,i,s){return e&&(e[r]||e(t,n))||i[r].slice(0,s)},d=function(e){return oJ.s(s%12||12,e,"0")},m=c||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(oG,function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return oJ.s(t.$y,4,"0");case"M":return o+1;case"MM":return oJ.s(o+1,2,"0");case"MMM":return h(r.monthsShort,o,u,3);case"MMMM":return h(u,o);case"D":return t.$D;case"DD":return oJ.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return h(r.weekdaysMin,t.$W,l,2);case"ddd":return h(r.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(s);case"HH":return oJ.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return m(s,a,!0);case"A":return m(s,a,!1);case"m":return String(a);case"mm":return oJ.s(a,2,"0");case"s":return String(t.$s);case"ss":return oJ.s(t.$s,2,"0");case"SSS":return oJ.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")})},t.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},t.diff=function(e,t,r){var n,i=this,s=oJ.p(t),a=oZ(e),o=(a.utcOffset()-this.utcOffset())*6e4,l=this-a,u=function(){return oJ.m(i,a)};switch(s){case oB:n=u()/12;break;case oF:n=u();break;case oj:n=u()/3;break;case ok:n=(l-o)/6048e5;break;case"day":n=(l-o)/864e5;break;case oP:n=l/36e5;break;case oL:n=l/6e4;break;case oV:n=l/1e3;break;default:n=l}return r?n:oJ.a(n)},t.daysInMonth=function(){return this.endOf(oF).$D},t.$locale=function(){return oX[this.$L]},t.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=oQ(e,t,!0);return n&&(r.$L=n),r},t.clone=function(){return oJ.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},e}()).prototype,oZ.prototype=o1,[["$ms",oD],["$s",oV],["$m",oL],["$H",oP],["$W","day"],["$M",oF],["$y",oB],["$D",o$]].forEach(function(e){o1[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),oZ.extend=function(e,t){return e.$i||(e(t,o0,oZ),e.$i=!0),oZ},oZ.locale=oQ,oZ.isDayjs=oK,oZ.unix=function(e){return oZ(1e3*e)},oZ.en=oX[oz],oZ.Ls=oX,oZ.p={},ox.exports=oZ),ox.exports));var oD,oV,oL,oP,ok,oF,oj,oB,o$,oH,oW,oG,oY,oz,oX,oq,oK,oQ,oZ,oJ,o0,o1,o2,o5={exports:{}};o5.exports;let o3=tb((o2||(o2=1,o5.exports=function(e,t){var r=t.prototype,n=r.format;r.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return n.bind(this)(e);var i=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return r.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return r.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}});return n.bind(this)(s)}}),o5.exports));var o4,o6={exports:{}};o6.exports;let o9=tb((o4||(o4=1,o8={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},o7=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,le=/\d/,lt=/\d\d/,lr=/\d\d?/,ln=/\d*[^-_:/,()\s\d]+/,li={},ls=function(e){return(e*=1)+(e>68?1900:2e3)},la=function(e){return function(t){this[e]=+t}},lo=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e||"Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),r=60*t[1]+(+t[2]||0);return 0===r?0:"+"===t[0]?-r:r}(e)}],ll=function(e){var t=li[e];return t&&(t.indexOf?t:t.s.concat(t.f))},lu=function(e,t){var r,n=li.meridiem;if(n){for(var i=1;i<=24;i+=1)if(e.indexOf(n(i,0,t))>-1){r=i>12;break}}else r=e===(t?"pm":"PM");return r},lc={A:[ln,function(e){this.afternoon=lu(e,!1)}],a:[ln,function(e){this.afternoon=lu(e,!0)}],Q:[le,function(e){this.month=3*(e-1)+1}],S:[le,function(e){this.milliseconds=100*e}],SS:[lt,function(e){this.milliseconds=10*e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[lr,la("seconds")],ss:[lr,la("seconds")],m:[lr,la("minutes")],mm:[lr,la("minutes")],H:[lr,la("hours")],h:[lr,la("hours")],HH:[lr,la("hours")],hh:[lr,la("hours")],D:[lr,la("day")],DD:[lt,la("day")],Do:[ln,function(e){var t=li.ordinal,r=e.match(/\d+/);if(this.day=r[0],t)for(var n=1;n<=31;n+=1)t(n).replace(/\[|\]/g,"")===e&&(this.day=n)}],w:[lr,la("week")],ww:[lt,la("week")],M:[lr,la("month")],MM:[lt,la("month")],MMM:[ln,function(e){var t=ll("months"),r=(ll("monthsShort")||t.map(function(e){return e.slice(0,3)})).indexOf(e)+1;if(r<1)throw Error();this.month=r%12||r}],MMMM:[ln,function(e){var t=ll("months").indexOf(e)+1;if(t<1)throw Error();this.month=t%12||t}],Y:[/[+-]?\d+/,la("year")],YY:[lt,function(e){this.year=ls(e)}],YYYY:[/\d{4}/,la("year")],Z:lo,ZZ:lo},o6.exports=function(e,t,r){r.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(ls=e.parseTwoDigitYear);var n=t.prototype,i=n.parse;n.parse=function(e){var t=e.date,n=e.utc,s=e.args;this.$u=n;var a=s[1];if("string"==typeof a){var o=!0===s[2],l=!0===s[3],u=s[2];l&&(u=s[2]),li=this.$locale(),!o&&u&&(li=r.Ls[u]),this.$d=function(e,t,r,n){try{if(["x","X"].indexOf(t)>-1)return new Date(("X"===t?1e3:1)*e);var i=(function(e){var t,r;t=e,r=li&&li.formats;for(var n=(e=t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(e,t,n){var i=n&&n.toUpperCase();return t||r[n]||o8[n]||r[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})})).match(o7),i=n.length,s=0;s<i;s+=1){var a=n[s],o=lc[a],l=o&&o[0],u=o&&o[1];n[s]=u?{regex:l,parser:u}:a.replace(/^\[|\]$/g,"")}return function(e){for(var t={},r=0,s=0;r<i;r+=1){var a=n[r];if("string"==typeof a)s+=a.length;else{var o=a.regex,l=a.parser,u=e.slice(s),c=o.exec(u)[0];l.call(t,c),e=e.replace(c,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var r=e.hours;t?r<12&&(e.hours+=12):12===r&&(e.hours=0),delete e.afternoon}}(t),t}})(t)(e),s=i.year,a=i.month,o=i.day,l=i.hours,u=i.minutes,c=i.seconds,h=i.milliseconds,d=i.zone,m=i.week,g=new Date,f=o||(s||a?1:g.getDate()),p=s||g.getFullYear(),C=0;s&&!a||(C=a>0?a-1:g.getMonth());var _,y=l||0,R=u||0,E=c||0,b=h||0;return d?new Date(Date.UTC(p,C,f,y,R,E,b+60*d.offset*1e3)):r?new Date(Date.UTC(p,C,f,y,R,E,b)):(_=new Date(p,C,f,y,R,E,b),m&&(_=n(_).week(m).toDate()),_)}catch{return new Date("")}}(t,a,n,r),this.init(),u&&!0!==u&&(this.$L=this.locale(u).$L),(o||l)&&t!=this.format(a)&&(this.$d=new Date("")),li={}}else if(a instanceof Array)for(var c=a.length,h=1;h<=c;h+=1){s[1]=a[h-1];var d=r.apply(this,s);if(d.isValid()){this.$d=d.$d,this.$L=d.$L,this.init();break}h===c&&(this.$d=new Date(""))}else i.call(this,e)}}),o6.exports));var o8,o7,le,lt,lr,ln,li,ls,la,lo,ll,lu,lc,lh,ld={exports:{}};ld.exports;let lm=tb((lh||(lh=1,ld.exports=function(e,t,r){var n=t.prototype,i=function(e){return e&&(e.indexOf?e:e.s)},s=function(e,t,r,n,s){var a=e.name?e:e.$locale(),o=i(a[t]),l=i(a[r]),u=o||l.map(function(e){return e.slice(0,n)});if(!s)return u;var c=a.weekStart;return u.map(function(e,t){return u[(t+(c||0))%7]})},a=function(){return r.Ls[r.locale()]},o=function(e,t){return e.formats[t]||e.formats[t.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})},l=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):s(e,"months")},monthsShort:function(t){return t?t.format("MMM"):s(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):s(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):s(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):s(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return o(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};n.localeData=function(){return l.bind(this)()},r.localeData=function(){var e=a();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return r.weekdays()},weekdaysShort:function(){return r.weekdaysShort()},weekdaysMin:function(){return r.weekdaysMin()},months:function(){return r.months()},monthsShort:function(){return r.monthsShort()},longDateFormat:function(t){return o(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},r.months=function(){return s(a(),"months")},r.monthsShort=function(){return s(a(),"monthsShort","months",3)},r.weekdays=function(e){return s(a(),"weekdays",null,null,e)},r.weekdaysShort=function(e){return s(a(),"weekdaysShort","weekdays",3,e)},r.weekdaysMin=function(e){return s(a(),"weekdaysMin","weekdays",2,e)}}),ld.exports));var lg,lf={exports:{}};lf.exports;let lp=tb((lg||(lg=1,lC={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},lf.exports=function(e,t,r){var n=t.prototype,i=n.format;r.en.formats=lC,n.format=function(e){void 0===e&&(e="YYYY-MM-DDTHH:mm:ssZ");var t,r,n=this.$locale().formats,s=(t=e,r=void 0===n?{}:n,t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(e,t,n){var i=n&&n.toUpperCase();return t||r[n]||lC[n]||r[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})}));return i.call(this,s)}}),lf.exports));var lC,l_,ly={exports:{}};ly.exports;let lR=tb((l_||(l_=1,lE="minute",lb=/[+-]\d\d(?::?\d\d)?/g,lI=/([+-]|\d\d)/g,ly.exports=function(e,t,r){var n=t.prototype;r.utc=function(e){var r={date:e,utc:!0,args:arguments};return new t(r)},n.utc=function(e){var t=r(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),lE):t},n.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var i=n.parse;n.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var s=n.init;n.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else s.call(this)};var a=n.utcOffset;n.utcOffset=function(e,t){var r=this.$utils().u;if(r(e))return this.$u?0:r(this.$offset)?a.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(lb);if(!t)return null;var r=(""+t[0]).match(lI)||["-",0,0],n=r[0],i=60*r[1]+ +r[2];return 0===i?0:"+"===n?i:-i}(e)))return this;var n=16>=Math.abs(e)?60*e:e,i=this;if(t)return i.$offset=n,i.$u=0===e,i;if(0!==e){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(i=this.local().add(n+s,lE)).$offset=n,i.$x.$localOffset=s}else i=this.utc();return i};var o=n.format;n.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return o.call(this,t)},n.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},n.isUTC=function(){return!!this.$u},n.toISOString=function(){return this.toDate().toISOString()},n.toString=function(){return this.toDate().toUTCString()};var l=n.toDate;n.toDate=function(e){return"s"===e&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var u=n.diff;n.diff=function(e,t,n){if(e&&this.$u===e.$u)return u.call(this,e,t,n);var i=this.local(),s=r(e).local();return u.call(i,s,t,n)}}),ly.exports));var lE,lb,lI,lN,lS={exports:{}};lS.exports;let lA=tb((lN||(lN=1,lS.exports=function(e,t){t.prototype.weekday=function(e){var t=this.$locale().weekStart||0,r=this.$W,n=(r<t?r+7:r)-t;return this.$utils().u(e)?n:this.subtract(n,"day").add(e,"day")}}),lS.exports));var lv,lT={exports:{}};lT.exports;let lw=tb((lv||(lv=1,lM="week",lO="year",lT.exports=function(e,t,r){var n=t.prototype;n.week=function(e){if(void 0===e&&(e=null),null!==e)return this.add(7*(e-this.week()),"day");var t=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var n=r(this).startOf(lO).add(1,lO).date(t),i=r(this).endOf(lM);if(n.isBefore(i))return 1}var s=r(this).startOf(lO).date(t).startOf(lM).subtract(1,"millisecond"),a=this.diff(s,lM,!0);return a<0?r(this).startOf("week").week():Math.ceil(a)},n.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}),lT.exports));var lM,lO,lx,lU={exports:{}};lU.exports;let lD=tb((lx||(lx=1,lU.exports=function(e,t){t.prototype.weekYear=function(){var e=this.month(),t=this.week(),r=this.year();return 1===t&&11===e?r+1:0===e&&t>=52?r-1:r}}),lU.exports));function lV(e,t,r,n){if(e>t)throw Error("a1 should be less than a2");if(r>n)throw Error("b1 should be less than b2");if(t<r||n<e)return[e,t];if(r<=e&&n>=t)return[];let i=n-r+1;return e<r&&t>n?[e,t-i]:r<=e&&n<t?[n+1-i,t-i]:r>e&&n>=t?[e,r-1]:[e,t]}function lL(e){if(null==e)return!1;let t=e.bullet;return(null==t?void 0:t.listId)!=null}function lP(e){return null!=e&&lk(e.paragraphStyle)}function lk(e){var t;return null!=e&&(null!=e.indentStart&&0!==e.indentStart.v||null!=e.hanging)&&(null==(t=e.hanging)?void 0:t.v)!==0}function lF(e,t,r){return e.slice(0,t)+r+e.slice(t)}function lj(e,t,r){return t>r?e:e.slice(0,t)+e.slice(r)}function lB(e){if(null==e||"boolean"==typeof e)return!1;if("number"==typeof e)return!isNaN(e);if("string"==typeof e){let t=e.trim();return""!==t&&!isNaN(Number(t))}return!1}function l$(e){let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+(t<<6)+(t<<16)-t;return t>>>0}function lH(...e){return nP({},...1===e.length&&Array.isArray(e[0])?e[0]:e)}oU.extend(o9),oU.extend(o3),oU.extend(lA),oU.extend(lm),oU.extend(lw),oU.extend(lD),oU.extend(lR),oU.extend(lp);let lW=Symbol("newer"),lG=Symbol("older");class lY{constructor(e){tg(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[lW],{done:!1,value:e.key}):{done:!0,value:void 0}}}class lz{constructor(e){tg(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[lW],{done:!1,value:e.value}):{done:!0,value:void 0}}}class lX{constructor(e){tg(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[lW],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}}}class lq{constructor(e,t){tg(this,"key"),tg(this,"value"),tg(this,lW),tg(this,lG),this.key=e,this.value=t,this[lW]=void 0,this[lG]=void 0}toJSON(){return{key:this.key,value:this.value}}}class lK{constructor(...e){if(tg(this,"_keymap"),tg(this,"size",0),tg(this,"limit"),tg(this,"oldest"),tg(this,"newest"),tg(this,"_onShiftListeners",[]),lQ.hasLength(e,1)){if(lQ.isNumber(e[0])){let t=e[0];this._initialize(t,void 0);return}if(lQ.isIterable(e[0])){let t=e[0];this._initialize(0,t)}return}if(lQ.hasLength(e,2)){let t=e[0],r=e[1];this._initialize(t,r)}}onShift(e){if(-1===this._onShiftListeners.indexOf(e))return this._onShiftListeners.push(e),nK(()=>tp(this._onShiftListeners,e));throw Error("[LRUMap]: the listener has been registered!")}_initialize(e,t){this.oldest=void 0,this.newest=void 0,this.size=0,this.limit=e,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[lW]&&(e===this.oldest&&(this.oldest=e[lW]),e[lW][lG]=e[lG]),e[lG]&&(e[lG][lW]=e[lW]),e[lW]=void 0,e[lG]=this.newest,this.newest&&(this.newest[lW]=e),this.newest=e)}assign(e){let t,r=this.limit||Number.MAX_VALUE;this._keymap.clear();let n=e[Symbol.iterator]();for(let e=n.next();!e.done;e=n.next()){let n=new lq(e.value[0],e.value[1]);if(this._keymap.set(n.key,n),t?(t[lW]=n,n[lG]=t):this.oldest=n,t=n,0==r--)throw Error("overflow")}this.newest=t,this.size=this._keymap.size}set(e,t){let r=this._keymap.get(e);return r?(r.value=t,this._markEntryAsUsed(r)):(this._keymap.set(e,r=new lq(e,t)),this.newest?(this.newest[lW]=r,r[lG]=this.newest):this.oldest=r,this.newest=r,++this.size,this.size>this.limit&&this.shift()),this}shift(){let e=this.oldest;if(e)return this.oldest&&this.oldest[lW]?(this.oldest=this.oldest[lW],this.oldest[lG]=void 0):(this.oldest=void 0,this.newest=void 0),e[lW]=e[lG]=void 0,this._keymap.delete(e.key),--this.size,this._onShiftListeners.forEach(t=>t(e)),[e.key,e.value]}get(e){let t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}has(e){return this._keymap.has(e)}find(e){let t=this._keymap.get(e);return t?t.value:void 0}delete(e){let t=this._keymap.get(e);if(t)return this._keymap.delete(t.key),t[lW]&&t[lG]?(t[lG][lW]=t[lW],t[lW][lG]=t[lG]):t[lW]?(t[lW][lG]=void 0,this.oldest=t[lW]):t[lG]?(t[lG][lW]=void 0,this.newest=t[lG]):this.oldest=this.newest=void 0,this.size--,t.value}clear(){this.oldest=void 0,this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return new lY(this.oldest)}values(){return new lz(this.oldest)}entries(){return this[Symbol.iterator]()}[Symbol.iterator](){return new lX(this.oldest)}forEach(e,t){"object"!=typeof t&&(t=this);let r=this.oldest;for(;r;)e.call(t,r.value,r.key,this),r=r[lW]}toJSON(){let e=Array(this.size),t=0,r=this.oldest;for(;r;)e[t++]={key:r.key,value:r.value},r=r[lW];return e}toString(){let e="",t=this.oldest;for(;t;)e+=`${String(t.key)}:${t.value}`,(t=t[lW])&&(e+=" < ");return e}}class lQ{static hasLength(e,t){return e.length===t}static getValueType(e){return Object.prototype.toString.apply(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isIterable(e){return null!=e[Symbol.iterator]}static isNumber(e){return"[object Number]"===this.getValueType(e)}}let lZ="general",lJ="hash",l0="zero",l1="qmark",l2="slash",l5="group",l3="scale",l4="comma",l6="break",l9="text",l8="plus",l7="minus",ue="point",ut="space",ur="percent",un="digit",ui="calendar",us="error",ua="datetime",uo="duration",ul="condition",uu="dbnum",uc="natnum",uh="locale",ud="color",um="modifier",ug="ampm",uf="escaped",up="string",uC="skip",u_="fill",uy="paren",uR="char",uE=["#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#800","#080","#008","#880","#808","#088","#CCC","#888","#99F","#936","#FFC","#CFF","#606","#F88","#06C","#CCF","#008","#F0F","#FF0","#0FF","#808","#800","#088","#00F","#0CF","#CFF","#CFC","#FF9","#9CF","#F9C","#C9F","#FC9","#36F","#3CC","#9C0","#FC0"],ub=["","$","","","","","","","","","","","","","","","","","","","","","","","","",""],uI=RegExp("["+ub.join("")+"]"),uN=Object.freeze({1078:"af",1052:"sq",1118:"am",5121:"ar_DZ",15361:"ar_BH",3073:"ar_EG",2049:"ar_IQ",11265:"ar_JO",13313:"ar_KW",12289:"ar_LB",4097:"ar_LY",6145:"ar_MA",8193:"ar_OM",16385:"ar_QA",1025:"ar_SA",10241:"ar_SY",7169:"ar_TN",14337:"ar_AE",9217:"ar_YE",1067:"hy",1101:"as",2092:"az_AZ",1068:"az_AZ",1069:"eu",1059:"be",2117:"bn",1093:"bn_IN",5146:"bs",1026:"bg",1109:"my",1027:"ca",2052:"zh_CN",3076:"zh_HK",5124:"zh_MO",4100:"zh_SG",1028:"zh_TW",1050:"hr",1029:"cs",1030:"da",1125:"dv",2067:"nl_BE",1043:"nl_NL",1126:"bin",3081:"en_AU",10249:"en_BZ",4105:"en_CA",9225:"en_CB",2057:"en_GB",16393:"en_IN",6153:"en_IE",8201:"en_JM",5129:"en_NZ",13321:"en_PH",7177:"en_ZA",11273:"en_TT",1033:"en_US",12297:"en_ZW",1061:"et",1071:"mk",1080:"fo",1065:"fa",1124:"fil",1035:"fi",2060:"fr_BE",11276:"fr_CM",3084:"fr_CA",9228:"fr_CG",12300:"fr_CI",1036:"fr_FR",5132:"fr_LU",13324:"fr_ML",6156:"fr_MC",14348:"fr_MA",10252:"fr_SN",4108:"fr_CH",7180:"fr",1122:"fy_NL",2108:"gd_IE",1084:"gd",1110:"gl",1079:"ka",3079:"de_AT",1031:"de_DE",5127:"de_LI",4103:"de_LU",2055:"de_CH",1032:"el",1140:"gn",1095:"gu",1279:"en",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig_NG",1057:"id",1040:"it_IT",2064:"it_CH",1041:"ja",1099:"kn",1120:"ks",1087:"kk",1107:"km",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1142:"la",1062:"lv",1063:"lt",2110:"ms_BN",1086:"ms_MY",1100:"ml",1082:"mt",1112:"mni",1153:"mi",1102:"mr",1104:"mn",2128:"mn",1121:"ne",1044:"no_NO",2068:"no_NO",1096:"or",1045:"pl",1046:"pt_BR",2070:"pt_PT",1094:"pa",1047:"rm",2072:"ro_MO",1048:"ro_RO",1049:"ru",2073:"ru_MO",1083:"se",1103:"sa",3098:"sr_SP",2074:"sr_SP",1072:"st",1074:"tn",1113:"sd",1115:"si",1051:"sk",1060:"sl",1143:"so",1070:"sb",11274:"es_AR",16394:"es_BO",13322:"es_CL",9226:"es_CO",5130:"es_CR",7178:"es_DO",12298:"es_EC",17418:"es_SV",4106:"es_GT",18442:"es_HN",2058:"es_MX",19466:"es_NI",6154:"es_PA",15370:"es_PY",10250:"es_PE",20490:"es_PR",1034:"es_ES",14346:"es_UY",8202:"es_VE",1089:"sw",2077:"sv_FI",1053:"sv_SE",1114:"syc",1064:"tg",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1073:"ts",1055:"tr",1090:"tk",1058:"uk",1056:"ur",2115:"uz_UZ",1091:"uz_UZ",1075:"ve",1066:"vi",1106:"cy",1076:"xh",1085:"yi",1077:"zu"}),uS=/^([a-z\d]+)(?:[_-]([a-z\d]+))?(?:\.([a-z\d]+))?(?:@([a-z\d]+))?$/i,uA={},uv=(e,t="")=>e.replace(/~/g,t).split(";"),uT=(e,t=0,r=0)=>(e.mmm||(e.mmm=t<1?e.mmmm.concat():e.mmmm.map(e=>{let r=e.slice(0,t%10);return r+(t<10||e===r?"":".")})),e.ddd||(e.ddd=r<1?e.dddd.concat():e.dddd.map(e=>{let t=e.slice(0,r%10);return t+(r<10||e===t?"":".")})),!e.mmm6&&e.mmmm6&&(e.mmm6=e.mmmm6),e),uw={group:"",decimal:".",positive:"+",negative:"-",percent:"%",exponent:"E",nan:"NaN",infinity:"",ampm:uv("AM;PM"),mmmm6:uv("Muharram;Safar;Rabi I;Rabi II;Jumada I;Jumada II;Rajab;Shaban;Ramadan;Shawwal;Dhul-Qidah;Dhul-Hijjah"),mmm6:uv("Muh.;Saf.;Rab. I;Rab. II;Jum. I;Jum. II;Raj.;Sha.;Ram.;Shaw.;Dhul-Q.;Dhul-H."),mmmm:uv("January;February;March;April;May;June;July;August;September;October;November;December"),mmm:uv("Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sep;Oct;Nov;Dec"),dddd:uv("Sunday;Monday;Tuesday;Wednesday;Thursday;Friday;Saturday"),ddd:uv("Sun;Mon;Tue;Wed;Thu;Fri;Sat"),bool:uv("TRUE;FALSE"),preferMDY:!1};function uM(e){let t=uS.exec(e);if(!t)throw SyntaxError(`Malformed locale: ${e}`);return{lang:t[1]+(t[2]?"_"+t[2]:""),language:t[1],territory:t[2]||""}}function uO(e){if("number"==typeof e)return uN[65535&e]||null;let t=parseInt(e,16);return isFinite(t)&&uN[65535&t]?uN[65535&t]||null:uS.test(e)?e:null}function ux(e){let t=uO(e),r=null;if(t){let e=uM(t);r=uA[e.lang]||uA[e.language]||null}return r}function uU(e){return Object.assign({},uw,e)}function uD(e,t){let r="object"==typeof t?t:uM(t);return uA[r.lang]=uU(e),r.language===r.lang||uA[r.language]||(uA[r.language]=uU(e)),uA[r.lang]}let uV=uU({group:",",preferMDY:!0});uV.isDefault=!0,uD({group:",",ampm:uv(";"),mmmm:uv(";;;;;;;;;;;"),mmm:uv("1;2;3;4;5;6;7;8;9;10;11;12"),dddd:uv("~;~;~;~;~;~;~",""),ddd:uv(";;;;;;")},"zh_CN");let uL={group:",",ampm:uv(";"),mmmm:uv("1;2;3;4;5;6;7;8;9;10;11;12"),mmm:uv("1;2;3;4;5;6;7;8;9;10;11;12"),dddd:uv("~;~;~;~;~;~;~",""),ddd:uv(";;;;;;")};uD({...uL,nan:"",dddd:uv("~;~;~;~;~;~;~","")},"zh_TW"),uD({...uL,dddd:uv("~;~;~;~;~;~;~","")},"zh_HK"),uD({...uL,ampm:uv(";"),dddd:uv("~;~;~;~;~;~;~",""),ddd:uv(";;;;;;")},"ja"),uD({group:",",ampm:uv(";"),mmmm:uv("1;2;3;4;5;6;7;8;9;10;11;12"),mmm:uv("1;2;3;4;5;6;7;8;9;10;11;12"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"ko"),uD({group:",",ampm:uv(";"),mmmm:uv("~;;~;;~;;~;~;;~;;~",""),mmm:uv("..;..;..;..;..;..;..;..;..;..;..;.."),dddd:uv(";;;;;;"),ddd:uv(".;.;.;.;.;.;.")},"th"),uD(uT({decimal:",",ampm:uv("dop.;odp."),mmmm:uv("ledna;nora;bezna;dubna;kvtna;ervna;ervence;srpna;z;jna;listopadu;prosince"),mmm:uv("I;II;III;IV;V;VI;VII;VIII;IX;X;XI;XII"),dddd:uv("nedle;pondl;ter;steda;tvrtek;ptek;sobota"),bool:uv("PRAVDA;NEPRAVDA")},-1,2),"cs"),uD(uT({group:".",decimal:",",mmmm:uv("januar;februar;marts;april;maj;juni;juli;august;september;oktober;november;december"),dddd:uv("sn~;man~;tirs~;ons~;tors~;fre~;lr~","dag"),bool:uv("SAND;FALSK")},13,13),"da"),uD(uT({group:".",decimal:",",ampm:uv("a.m.;p.m."),mmmm:uv("januari;februari;maart;april;mei;juni;juli;augustus;september;oktober;november;december"),mmm:uv("jan.;feb.;mrt.;apr.;mei;jun.;jul.;aug.;sep.;okt.;nov.;dec."),dddd:uv("zondag;maandag;dinsdag;woensdag;donderdag;vrijdag;zaterdag"),bool:uv("WAAR;ONWAAR")},-1,2),"nl"),uD({group:",",preferMDY:!0},"en"),uD({group:",",preferMDY:!0},"en_US"),uD({group:","},"en_AU"),uD({group:","},"en_CA"),uD({group:","},"en_GB"),uD({group:",",mmm:uv("Jan;Feb;Mar;Apr;May;Jun;Jul;Aug;Sept;Oct;Nov;Dec")},"en_IE"),uD(uT({decimal:",",nan:"epluku",ampm:uv("ap.;ip."),mmmm:uv("tammi~;helmi~;maalis~;huhti~;touko~;kes~;hein~;elo~;syys~;loka~;marras~;joulu~","kuuta"),mmm:uv("tammik.;helmik.;maalisk.;huhtik.;toukok.;kesk.;heink.;elok.;syysk.;lokak.;marrask.;jouluk."),dddd:uv("sunnun~;maanan~;tiis~;keskiviikkona;tors~;perjan~;lauan~","taina"),bool:uv("TOSI;EPTOSI")},-1,2),"fi");let uP=uT({group:"",decimal:",",mmmm:uv("janvier;fvrier;mars;avril;mai;juin;juillet;aot;septembre;octobre;novembre;dcembre"),mmm:uv("janv.;fvr.;mars;avr.;mai;juin;juil.;aot;sept.;oct.;nov.;dc."),dddd:uv("~manche;lun~;mar~;mercre~;jeu~;vendre~;same~","di"),bool:uv("VRAI;FAUX")},-1,13);uD({...uP},"fr"),uD({...uP,mmm:uv("janv.;fvr.;mars;avr.;mai;juin;juill.;aot;sept.;oct.;nov.;dc.")},"fr_CA"),uD({group:"'",decimal:".",...uP},"fr_CH");let uk=uT({mmmm:uv("Januar;Februar;Mrz;April;Mai;Juni;Juli;August;September;Oktober;November;Dezember"),mmm:uv("Jan.;Feb.;Mrz;Apr.;Mai;Juni;Juli;Aug.;Sept.;Okt.;Nov.;Dez."),dddd:uv("Sonn~;Mon~;Diens~;Mittwoch;Donners~;Frei~;Sams~","tag"),bool:uv("WAHR;FALSCH")},-1,12);uD({group:".",decimal:",",...uk},"de"),uD({group:"'",decimal:".",...uk},"de_CH"),uD(uT({group:".",decimal:",",ampm:uv("..;.."),mmmm:uv("~;~;~;~;;~;~;;~;~;~;~",""),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;")},-1,3),"el"),uD({decimal:",",ampm:uv("de.;du."),mmmm:uv("janur;februr;mrcius;prilis;mjus;jnius;jlius;augusztus;szeptember;oktber;november;december"),mmm:uv("jan.;febr.;mrc.;pr.;mj.;jn.;jl.;aug.;szept.;okt.;nov.;dec."),dddd:uv("vasrnap;htf;kedd;szerda;cstrtk;pntek;szombat"),ddd:uv("V;H;K;Sze;Cs;P;Szo"),bool:uv("IGAZ;HAMIS")},"hu"),uD(uT({group:".",decimal:",",ampm:uv("f.h.;e.h."),mmmm:uv("janar;febrar;mars;aprl;ma;jn;jl;gst;september;oktber;nvember;desember"),dddd:uv("sunnu~;mnu~;riju~;miviku~;fimmtu~;fstu~;laugar~","dagur")},13,13),"is"),uD(uT({group:".",decimal:",",mmmm:uv("Januari;Februari;Maret;April;Mei;Juni;Juli;Agustus;September;Oktober;November;Desember"),dddd:uv("Minggu;Senin;Selasa;Rabu;Kamis;Jumat;Sabtu")},3,3),"id");let uF=uT({mmmm:uv("gennaio;febbraio;marzo;aprile;maggio;giugno;luglio;agosto;settembre;ottobre;novembre;dicembre"),dddd:uv("domenica;luned;marted;mercoled;gioved;venerd;sabato"),bool:uv("VERO;FALSO")},3,3);uD({group:".",decimal:",",...uF},"it"),uD({group:"'",decimal:".",...uF},"it_CH");let uj={decimal:",",ampm:uv("a.m.;p.m."),mmmm:uv("januar;februar;mars;april;mai;juni;juli;august;september;oktober;november;desember"),mmm:uv("jan.;feb.;mar.;apr.;mai;jun.;jul.;aug.;sep.;okt.;nov.;des."),dddd:uv("sn~;man~;tirs~;ons~;tors~;fre~;lr~","dag"),bool:uv("SANN;USANN")};uD(uT({...uj},-1,13),"nb"),uD(uT({...uj},-1,13),"no"),uD(uT({decimal:",",mmmm:uv("stycznia;lutego;marca;kwietnia;maja;czerwca;lipca;sierpnia;wrzenia;padziernika;listopada;grudnia"),dddd:uv("niedziela;poniedziaek;wtorek;roda;czwartek;pitek;sobota"),ddd:uv("niedz.;pon.;wt.;r.;czw.;pt.;sob."),bool:uv("PRAWDA;FASZ")},3,-1),"pl");let uB={group:".",decimal:",",mmmm:uv("janeiro;fevereiro;maro;abril;maio;junho;julho;agosto;setembro;outubro;novembro;dezembro"),dddd:uv("domingo;segunda-feira;tera-feira;quarta-feira;quinta-feira;sexta-feira;sbado"),bool:uv("VERDADEIRO;FALSO")};uD(uT(uB,13,13),"pt"),uD(uT(uB,13,13),"pt_BR"),uD({decimal:",",nan:"",mmmm:uv(";;;;;;;;;;;"),mmm:uv(".;.;.;.;;.;.;.;.;.;.;."),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),mmmm6:uv(";;-;-;;--;--;--;--;;;"),mmm6:uv(".;.;-.;-.;.;. I;. II;. I;. II;.;.;."),bool:uv(";")},"ru"),uD(uT({decimal:",",mmmm:uv("janura;februra;marca;aprla;mja;jna;jla;augusta;septembra;oktbra;novembra;decembra"),dddd:uv("nedea;pondelok;utorok;streda;tvrtok;piatok;sobota")},3,2),"sk");let u$={group:".",decimal:",",ampm:uv("a.m.;p.m."),mmmm:uv("enero;febrero;marzo;abril;mayo;junio;julio;agosto;septiem~;octu~;noviem~;diciem~","bre"),mmm:uv("ene;feb;mar;abr;may;jun;jul;ago;sept;oct;nov;dic"),dddd:uv("domingo;lunes;martes;mircoles;jueves;viernes;sbado"),ddd:uv("dom;lun;mar;mi;jue;vie;sb"),bool:uv("VERDADERO;FALSO")},uH=uv("ene;feb;mar;abr;may;jun;jul;ago;sep;oct;nov;dic"),uW=uv("ene.;feb.;mar.;abr.;may.;jun.;jul.;ago.;sept.;oct.;nov.;dic.");uD({...u$},"es"),uD({...u$},"es_AR"),uD({...u$},"es_BO"),uD({...u$},"es_CL"),uD({...u$},"es_CO"),uD({...u$},"es_EC"),uD({...u$,mmm:uH,ampm:uv("a.m.;p.m.")},"es_MX"),uD({...u$,mmm:uW},"es_PY"),uD({...u$,mmm:uW},"es_UY"),uD({...u$,mmm:uW,mmmm:uv("enero;febrero;marzo;abril;mayo;junio;julio;agosto;setiembre;octubre;noviembre;diciembre")},"es_VE"),uD({decimal:",",ampm:uv("fm;em"),mmmm:uv("januari;februari;mars;april;maj;juni;juli;augusti;september;oktober;november;december"),mmm:uv("jan.;feb.;mars;apr.;maj;juni;juli;aug.;sep.;okt.;nov.;dec."),dddd:uv("sn~;mn~;tis~;ons~;tors~;fre~;lr~","dag"),ddd:uv("sn;mn;tis;ons;tors;fre;lr")},"sv"),uD(uT({group:".",decimal:",",ampm:uv(";S"),mmmm:uv("Ocak;ubat;Mart;Nisan;Mays;Haziran;Temmuz;Austos;Eyll;Ekim;Kasm;Aralk"),mmm:uv("Oca;ub;Mar;Nis;May;Haz;Tem;Au;Eyl;Eki;Kas;Ara"),dddd:uv("Pazar;Pazartesi;Sal;aramba;Perembe;Cuma;Cumartesi"),ddd:uv("Paz;Pzt;Sal;ar;Per;Cum;Cmt"),bool:uv("DORU;YANLI")},3,-1),"tr"),uD({group:",",ampm:uv("yb;yh"),mmmm:uv("Ionawr;Chwefror;Mawrth;Ebrill;Mai;Mehefin;Gorffennaf;Awst;Medi;Hydref;Tachwedd;Rhagfyr"),mmm:uv("Ion;Chwef;Maw;Ebr;Mai;Meh;Gorff;Awst;Medi;Hyd;Tach;Rhag"),dddd:uv("Dydd Sul;Dydd Llun;Dydd Mawrth;Dydd Mercher;Dydd Iau;Dydd Gwener;Dydd Sadwrn"),ddd:uv("Sul;Llun;Maw;Mer;Iau;Gwen;Sad")},"cy"),uD({group:".",decimal:",",mmmm:uv("yanvar;fevral;mart;aprel;may;iyun;iyul;avqust;sentyabr;oktyabr;noyabr;dekabr"),mmm:uv("yan;fev;mar;apr;may;iyn;iyl;avq;sen;okt;noy;dek"),dddd:uv("bazar;bazar ertsi;rnb axam;rnb;cm axam;cm;nb"),ddd:uv("B.;B.e.;.a.;.;C.a.;C.;.")},"az"),uD(uT({decimal:",",mmmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},3,-1),"be"),uD({decimal:",",ampm:uv("..;.."),mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),bool:uv(";")},"bg"),uD({group:".",decimal:",",mmmm:uv("de gener;de febrer;de mar;dabril;de maig;de juny;de juliol;dagost;de setembre;doctubre;de novembre;de desembre"),mmm:uv("de gen.;de febr.;de mar;dabr.;de maig;de juny;de jul.;dag.;de set.;doct.;de nov.;de des."),dddd:uv("diumenge;dilluns;dimarts;dimecres;dijous;divendres;dissabte"),ddd:uv("dg.;dl.;dt.;dc.;dj.;dv.;ds."),ampm:uv("a.m.;p.m.")},"ca"),uD(uT({group:",",decimal:".",mmmm:uv("Enero;Pebrero;Marso;Abril;Mayo;Hunyo;Hulyo;Agosto;Setyembre;Oktubre;Nobyembre;Disyembre"),dddd:uv("Linggo;Lunes;Martes;Miyerkules;Huwebes;Biyernes;Sabado")},3,3),"fil"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv("~;~;~;~;~;~;~",""),ddd:uv(";;;;;;")},"gu"),uD({group:",",decimal:".",ampm:uv(";"),dddd:uv("~;~;~;~;~;~;~"," "),ddd:uv("~;~;~;~;~;~;"," "),mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),mmmm6:uv(";; ; ;; ; ; ; ;;;"),mmm6:uv(";; ; ;; ; ; ; ;;;")},"he"),uD(uT({group:".",decimal:",",mmmm:uv("sijenja;veljae;oujka;travnja;svibnja;lipnja;srpnja;kolovoza;rujna;listopada;studenoga;prosinca"),mmm:uv("sij;velj;ou;tra;svi;lip;srp;kol;ruj;lis;stu;pro"),dddd:uv("nedjelja;ponedjeljak;utorak;srijeda;etvrtak;petak;subota")},-1,3),"hr"),uD({decimal:",",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"hy"),uD(uT({decimal:",",mmmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;")},3,3),"ka"),uD(uT({decimal:",",mmmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},13,-1),"kk"),uD({group:",",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv("~;~;~;~;~;~;~",""),ddd:uv(";;;;;;"),ampm:uv(";")},"kn"),uD({decimal:",",mmmm:uv("sausio;vasario;kovo;balandio;gegus;birelio;liepos;rugpjio;rugsjo;spalio;lapkriio;gruodio"),mmm:uv("saus.;vas.;kov.;bal.;geg.;bir.;liep.;rugp.;rugs.;spal.;lapkr.;gruod."),dddd:uv("sekmadienis;pirmadienis;antradienis;treiadienis;ketvirtadienis;penktadienis;etadienis"),ddd:uv("sk;pr;an;tr;kt;pn;t"),ampm:uv("priepiet;popiet")},"lt"),uD({decimal:",",mmmm:uv("janvris;februris;marts;aprlis;maijs;jnijs;jlijs;augusts;septembris;oktobris;novembris;decembris"),mmm:uv("janv.;febr.;marts;apr.;maijs;jn.;jl.;aug.;sept.;okt.;nov.;dec."),dddd:uv("svtdiena;pirmdiena;otrdiena;trediena;ceturtdiena;piektdiena;sestdiena"),ddd:uv("svtd.;pirmd.;otrd.;tred.;ceturtd.;piektd.;sestd."),ampm:uv("priekpusdien;pcpusdien")},"lv"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"ml"),uD({group:",",decimal:".",mmmm:uv("~;~;~;~;~;~;~;~;~;~; ~; ~"," "),mmm:uv("1~;2~;3~;4~;5~;6~;7~;8~;9~;10~;11~;12~","- "),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),ampm:uv("..;..")},"mn"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"mr"),uD(uT({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ampm:uv(";")},-1,0),"my"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),ampm:uv("..;..")},"pa"),uD({group:".",decimal:",",mmmm:uv("ianuarie;februarie;martie;aprilie;mai;iunie;iulie;august;septem~;octom~;noiem~;decem~","brie"),mmm:uv("ian.;feb.;mar.;apr.;mai;iun.;iul.;aug.;sept.;oct.;nov.;dec."),dddd:uv("duminic;luni;mari;miercuri;joi;vineri;smbt"),ddd:uv("dum.;lun.;mar.;mie.;joi;vin.;sm."),ampm:uv("a.m.;p.m.")},"ro"),uD(uT({group:".",decimal:",",mmmm:uv("januar;februar;marec;april;maj;junij;julij;avgust;september;oktober;november;december"),mmm:uv("jan.;feb.;mar.;apr.;maj;jun.;jul.;avg.;sep.;okt.;nov.;dec."),dddd:uv("nedelja;ponedeljek;torek;sreda;etrtek;petek;sobota"),ampm:uv("dop.;pop.")},-1,13),"sl"),uD(uT({group:".",decimal:",",mmmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;")},3,3),"sr"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(".;.;.;.;;;;.;.;.;.;."),dddd:uv(";;;;;;"),ddd:uv(".;.;.;.;.;.;")},"ta"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"te"),uD({decimal:",",mmmm:uv(";;;;;;;;;;;"),mmm:uv(".;.;.;.;.;.;.;.;.;.;.;."),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),ampm:uv(";")},"uk"),uD({group:".",decimal:",",mmmm:uv("~1;~2;~3;~4;~5;~6;~7;~8;~9;~10;~11;~12","thng "),mmm:uv("~1;~2;~3;~4;~5;~6;~7;~8;~9;~10;~11;~12","thg "),dddd:uv("Ch Nht;Th Hai;Th Ba;Th T;Th Nm;Th Su;Th By"),ddd:uv("CN;Th 2;Th 3;Th 4;Th 5;Th 6;Th 7"),ampm:uv("SA;CH")},"vi"),uD(uT({group:"",decimal:"",ampm:uv(";"),mmmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),mmmm6:uv(";; ; ;; ; ; ; ;;;")},0,0),"ar"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;")},"bn"),uD({group:",",decimal:".",mmmm:uv(";;;;;;;;;;;"),mmm:uv(";;;;;;;;;;;"),dddd:uv(";;;;;;"),ddd:uv(";;;;;;"),ampm:uv("am;pm")},"hi");let uG={overflow:"######",dateErrorThrows:!1,dateErrorNumber:!0,bigintErrorNumber:!1,dateSpanLarge:!0,leap1900:!0,nbsp:!1,throws:!0,invalid:"######",locale:"",ignoreTimezone:!1,grouping:[3,3],indexColors:!0,skipChar:"",repeatChar:""};function uY(e,t=0){if("number"!=typeof e)return e;if(e<0)return-uY(-e,t);if(t){let r=10**t||1;return uY(e*r,0)/r}return Math.round(e)}function uz(e,t=2,r=2){let n=e<0?-1:1,i=10**(t||2),s=10**(r||2),a=Math.abs(e),o=0,l=0,u=0,c=1,h,d;if((e=a)%1==0)d=[e*n,1];else if(e<1e-19)d=[n,1e19];else if(e>1e19)d=[1e19*n,1];else{do if(a=1/(a-Math.floor(a)),h=c,c=c*Math.floor(a)+o,o=h,l=u,(u=Math.floor(e*c+.5))>=i||c>=s)return[n*l,o];while(Math.abs(e-u/c)>=1e-13&&a!==Math.floor(a))d=[n*u,c]}return d}let uX=Math.floor;function uq(e,t=!0){if(t&&e>=0){if(0===e)return[1900,1,0];if(60===e)return[1900,2,29];if(e<60)return[1900,e<32?1:2,(e-1)%31+1]}let r=e+68569+2415019,n=uX(4*r/146097);r-=uX((146097*n+3)/4);let i=uX(4e3*(r+1)/1461001);r=r-uX(1461*i/4)+31;let s=uX(80*r/2447),a=r-uX(2447*s/80);r=uX(s/11);let o=s+2-12*r;return[100*(n-49)+i+r|0,0|o,0|a]}function uK(e,t=0,r=!0){let n=uX(e);return 6===t?function(e){if(60===e)throw Error("#VALUE!");if(e<=1)return[1317,8,29];if(e<60)return[1317,e<32?9:10,1+(e-2)%30];let t=10631/30,r=e+466935,n=uX(r/10631),i=uX(((r-=10631*n)-.1335)/t);r-=uX(i*t+.1335);let s=uX((r+28.5001)/29.5);return 13===s?[30*n+i,12,30]:[30*n+i,s,r-uX(29.5001*s-29)]}(n):-1===t?uq(n+1462):uq(n,r)}let uQ=Math.floor;function uZ(e,t){let r=null;if(Array.isArray(e)){let[t,n,i,s,a,o]=e;r=Date.UTC(t,null==n?0:n-1,null!=i?i:1,s||0,a||0,o||0)}else if(e instanceof Date&&(r=+e,!t||!t.ignoreTimezone)){let t=new Date;t.setUTCFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setUTCHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),r=+t}if(null!=r&&isFinite(r)){let e=r/864e5;return e-(e<=-25509?-25568:-25569)}return null}let uJ={j:"d",d:"d",D:"ddd",l:"dddd",n:"m",m:"m",M:"mmm",F:"mmmm",y:"yy",Y:"yyyy"},u0={j:"dd",d:"dd",D:"ddd",l:"dddd",n:"mm",m:"mm",M:"mmm",F:"mmmm",y:"yy",Y:"yyyy"},u1={},u2={};function u5(e,t,r=1){if(e){let n=e[0],i=e.slice(1);"!"===n?u5(i,t,4):"?"===n?u5(i,t,2):(t[n]=t[n]||{},u5(i,t[n],r))}else t.$=r}function u3(e,t){u5(e,t),u5(e+" x",t),u5(e+" l",t),u5(e+" l x",t),u5("l "+e,t),u5("l "+e+" x",t),u5(e+" D",t),u5(e+" D x",t),u5("D "+e,t),u5("D "+e+" x",t)}["!d-m-y","!d-m-Y","!j-m-y","!j-m-Y","!d-n-y","!d-n-Y","!j-n-y","!j-n-Y","?m-d-y","?m-d-Y","?m-j-y","?m-j-Y","?n-d-y","?n-d-Y","?n-j-y","?n-j-Y","d-M-y","d-M-Y","j-M-y","j-M-Y","M-d-y","M-d-Y","M-j-y","M-j-Y","d-F-y","d-F-Y","F-d-y","F-d-Y","F-j-y","F-j-Y","j-F-y","j-F-Y","y-F-d","y-F-j","y-M-d","y-M-j","Y-F-d","Y-F-j","Y-M-d","Y-m-d","Y-M-j","Y-m-j","Y-n-d","Y-n-j","j-F","j-M","d-F","d-M","n-d","n-j","n-Y","m-d","m-j","m-Y","M-Y","M-y","F-y","F-Y","Y-M","Y-n","Y-m","Y-F","Y-M"].forEach(e=>{"?"!==e[0]&&u3(e,u1),"!"!==e[0]&&u3(e,u2)});let u4=new Date().getUTCFullYear(),u6={".":[",","","","'",""],",":[".","","","'",""],"":[".","","","'",""]},u9=e=>e&&1===e.length&&e>="0"&&e<="9";function u8(e,t={}){let r=ux(t.locale||"")||uV,n=r.decimal,i=[...u6[n]||["'",""]];i.includes(r.group)||" "===r.group||r.group===n||i.push(r.group);let s="",a="",o=1,l="",u=!1,c=!1,h=!1,d=!1,m=!1,g=null,f=!1,p=0,C=[" ","","","+","%","(","-"].concat(ub);for(;C.includes(e[p]);){let t=e[p];if("-"===t){if(u||c)return null;u=!0,o=-1}else if(uI.test(t)){if(m)return null;m=!0,g=t}else if("("===t){if(c||u)return null;c=!0,o=-1}else if("%"===t){if(d)return null;d=!0}p++}let _=!1,y;if(e[p]===n||u9(e[p]))for(;p<e.length;){let t=e[p];if(!y&&i.includes(t))y=t;else if(!(y&&y===t))if(t===n){if(_)break;s+=".",_=!0}else if(u9(t))s+=t;else break;p++}if("e"===e[p]||"E"===e[p]){a+=e[p],("+"===e[++p]||"-"===e[p])&&(a+=e[p],p++);let t=p;for(;u9(e[p]);)a+=e[p],p++;if(t===p)return null}let R=[" ","","","%","$",")"].concat(ub);for(;R.includes(e[p]);){let t=e[p];if(uI.test(t)){if(m)return null;m=!0,g=t,f=!0}else if(")"===t){if(h||!c)return null;h=!0}else if("%"===t){if(d)return null;d=!0}p++}if(p!==e.length)return null;let E=parseFloat(s+a);if(!isFinite(E))return null;if(a){if(d||m)return null;l="0.00E+00"}else if(d){if(m)return null;l=s.includes(".")?"0.00%":"0%",E*=.01}else if(m){let e=s.includes(".")?"#,##0.00":"#,##0";l=f?e+g:g+e}else y&&(l=s.includes(".")?"#,##0.00":"#,##0");let b={v:E*o};return l&&(b.z=l),b}let u7=(e,t,r=!1)=>{for(let n of t)if(e.startsWith(n[0])){let t=n[0].length;return r&&("D"===n[2]||"M"===n[2])&&"."===e[t]&&t++,[e.slice(0,t),n]}return["",null]},ce=(e,t,r,n)=>{let i=r.path||"",s=Object.keys(t);for(let a=0;a<s.length;a++){let o,l=s[a];if(t[l]){if("$"===l||""===l)e||(o=r);else if("-"===l){let s=/^(\s*([./-]|,\s)\s*|\s+)/.exec(e);if(s){let a="-"===s[1]||"/"===s[1]||"."===s[1]?s[1]:" ";if(!r.sep||r.sep===a){let u=s[0].replace(/\s+/g," ");o=ce(e.slice(s[0].length),t[l],{...r,sep:a,path:i+u},n)}}}else if(" "===l){let s=/^[,.]?\s+/.exec(e);if(s){let a=s[0].replace(/\s+/g," ");o=ce(e.slice(s[0].length),t[l],{...r,path:i+a},n)}}else if("j"===l||"d"===l){let s=/^(0?[1-9]|1\d|2\d|3[01])\b/.exec(e);s&&(o=ce(e.slice(s[0].length),t[l],{...r,day:s[0],path:i+l},n))}else if("n"===l||"m"===l){let s=/^(0?[1-9]|1[012])\b/.exec(e);s&&(o=ce(e.slice(s[0].length),t[l],{...r,month:+s[0],_mon:s[0],path:i+l},n))}else if("F"===l||"M"===l){let[s,a]=u7(e,n.mon,n.mp);a&&a[2]===l&&(o=ce(e.slice(s.length),t[l],{...r,month:a[1],_mon:s,path:i+l},n))}else if("l"===l||"D"===l){let[s,a]=u7(e,n.day,n.dp);a&&a[2]===l&&(o=ce(e.slice(s.length),t[l],{...r,path:i+l},n))}else if("y"===l){let s=/^\d\d\b/.exec(e);if(s){let a=+s[0]>=30?+s[0]+1900:+s[0]+2e3;o=ce(e.slice(s[0].length),t[l],{...r,year:a,path:i+l},n)}}else if("Y"===l){let s=/^\d\d\d\d\b/.exec(e);s&&(o=ce(e.slice(s[0].length),t[l],{...r,year:+s[0],path:i+l},n))}else if("x"===l){let s=cs(e,{locale:n.locale});s&&(o=ce("",t[l],{...r,time:s.v,tf:s.z,path:i+l},n))}else throw Error(`Unknown date token "${l}"`);if(o&&function(e,t,r){if(r<1||t<1||t>12)return!1;if(2===t){if(r>(e%4==0&&e%100!=0||e%400==0||1900===e?29:28))return!1}else if((4===t||6===t||9===t||11===t)&&r>30||(1===t||3===t||5===t||7===t||8===t||10===t||12===t)&&r>31)return!1;return!0}(r.year||1916,r.month||1,r.day?+r.day:1))return o}}},ct=e=>e.replace(/\s+/g," ").trim().replace(//,"'").replace(/\.$/,"").toLowerCase(),cr=(e,t)=>{let r=e.map((e,r)=>[ct(e),r+1,t]);return r.sort((e,t)=>t[0].length-e[0].length),r};function cn(e,t={}){var r;let n=ux(t.locale||"")||uV,i={mon:cr(n.mmmm,"F").concat(cr(n.mmm,"M")),mp:"."===n.mmm[0].at(-1),day:cr(n.dddd,"l").concat(cr(n.ddd,"D")),dp:"."===n.ddd[0].at(-1),locale:t.locale},s=ce(ct(e),n.preferMDY?u2:u1,{path:""},i);if(s){if("."===s.sep&&3===s.path.length)return null;let e=+(null!=(r=s.year)?r:u4);s.day||(s.day=1);let t=-1/0;if(e<1900)return null;e<=1900&&s.month<=2?t=25568:e<1e4&&(t=25569);let n=Date.UTC(e,s.month-1,s.day)/864e5+t+(s.time||0);if(n>=0&&n<=2958465){let e="0"===s._mon[0]||"0"===s.day[0]||2===s._mon.length&&2===s.day.length;return{v:n,z:s.path.replace(/[jdlDnmMFyYx]/g,t=>"x"===t?s.tf||"":(e?u0[t]:uJ[t])||t)}}}return null}let ci=e=>e.replace(/\s+/g,"").trim().replace(/\./g,"").toLowerCase();function cs(e,t={}){let r=ux(t.locale||"")||uV,n=/^\s*([10]?\d|2[0-4])(?::([0-5]\d|\d))?(?::([0-5]\d|\d))?(\.\d{1,10})?(?=\s*[^\s\d]|$)/.exec(e),i="";if(n){let t=ci(e.slice(n[0].length));if(t===ci(r.ampm[0])||"a"===t||"am"===t)i="a";else if(t===ci(r.ampm[1])||"p"===t||"pm"===t)i="p";else if(t)return null}if(n){let[,e,t,r,s]=n;if(s&&!r||!i&&!t&&!r)return null;let a=+(e||0);if(i){if(a>=13)return null;"p"===i&&(a+=12)}return{v:(3600*a+60*(t||0)+ +(r||0)+ +(s||0))/86400,z:(2===e.length?"hh":"h")+":mm"+(r?":ss":"")+(i?" AM/PM":"")}}return null}function ca(e,t={}){let r=ux(t.locale||"")||uV,n=e.trim().toLowerCase(),i=r.bool[0].toLowerCase();if("true"===n||n===i)return{v:!0};let s=r.bool[1].toLowerCase();return"false"===n||n===s?{v:!1}:null}function co(e,t,r){return t[r+"_max"]=e.length,t[r+"_min"]=e.replace(/#/g,"").length,t}function cl(e,t){"string"==typeof e?t.push({type:"string",value:e}):t.push(e)}function cu(e,t){let r=e&&e.type;return r===lJ||r===l0||r===l1||r===un&&"den"===t}function cc(e){var t,r,n;let i=[],s={scale:1,percent:!1,text:!1,date:0,date_eval:!1,date_system:1,sec_decimals:0,general:!1,clock:24,int_pattern:[],frac_pattern:[],man_pattern:[],den_pattern:[],num_pattern:[],tokens:i},a="int",o=null,l=[],u,c=!1,h=-1,d=!1,m="",g=!1;for(;++h<e.length&&!d;){let f=e[h],p=f.type||us;if(m+=f.raw,p===lZ)s.general=!0,cl(f,i);else if(cu(f,a)){let e=s[a+"_pattern"];cu(u,a)||(null==u?void 0:u.type)===l5?(e.push((e.pop()||"")+f.value),o.num+=f.value):(e.push(f.value),cl(o={type:a,num:f.value},i))}else if(p===uy)"("===f.value&&(s.parens=!0),cl(f.value,i);else if(p===un)cl(f.value,i);else if(p===l2)if(g=!0,s[a+"_pattern"].length){if(!o)throw SyntaxError("Format pattern is missing a numerator");s.fractions=!0,s.num_pattern.push(s[a+"_pattern"].pop()),o.type="num",a="den",cl({type:"div"},i)}else cl(f.value,i);else if(p===l4)cl(",",i);else if(p===l3)s.scale=.001**f.raw.length;else if(p===l5){if("int"===a&&(s.grouping=!0),"den"===a)throw SyntaxError("Cannot group denominator digits")}else if(p===ut)cl(f,i);else if(p===l6){d=!0;break}else if(p===l9)s.text=!0,cl(f,i);else if(p===l8||p===l7)cl(f,i);else if(p===uo){let e=f.value.toLowerCase(),t=e[0],r={type:"",size:0,date:1,pad:e.length};"h"===t?(r.size=16,r.type="hour-elap"):"m"===t?(r.size=32,r.type="min-elap"):(r.size=64,r.type="sec-elap"),s.date=s.date|r.size,l.push(r),cl(r,i)}else if(s.date&&p===ue&&(null==(t=e[h+1])?void 0:t.type)===l0){let t=1,a="0";(null==(r=e[++h+1])?void 0:r.type)===l0&&(a+="0",t=2,h++),(null==(n=e[h+1])?void 0:n.type)===l0&&(a+="0",t=3,h++),m+=a;let o=[64,128,256,512][t];s.date=s.date|o,s.date_eval=!0,s.sec_decimals=Math.max(s.sec_decimals,t),cl({type:"subsec",size:o,decimals:t,date:1},i)}else if(p===ui)c||("B2"===f.value||"b2"===f.value?s.date_system=6:s.date_system=1);else if(p===ua){let e={type:"",size:0,date:1},t=f.value.toLowerCase(),r=t[0];if("y"===t||"yy"===t)e.size=2,e.type="year-short";else if("y"===r||"e"===r)e.size=2,e.type="year";else if("b"===t||"bb"===t)e.size=2,e.type="b-year-short";else if("b"===r)e.size=2,e.type="b-year";else if("d"===t||"dd"===t)e.size=8,e.type="day",e.pad=/dd/.test(t);else if("ddd"===t||"aaa"===t)e.size=8,e.type="weekday-short";else if("d"===r||"a"===r)e.size=8,e.type="weekday";else if("h"===r)e.size=16,e.type="hour",e.pad=/hh/i.test(t);else if("m"===r){3===t.length?(e.size=4,e.type="monthname-short"):5===t.length?(e.size=4,e.type="monthname-single"):t.length>=4&&(e.size=4,e.type="monthname");let r=l[l.length-1];!e.type&&r&&!r.used&&80&r.size&&(r.used=!0,e.size=32,e.type="min",e.pad=/mm/.test(t)),e.type||(e.size=4,e.type="month",e.pad=/mm/.test(t),e.indeterminate=!0)}else if("s"===r){e.size=64,e.type="sec",e.pad=/ss/.test(t);let r=l[l.length-1];r&&32&r.size?e.used=!0:r&&r.indeterminate&&(delete r.indeterminate,r.size=32,r.type="min",e.used=!0)}s.date=s.date|e.size,s.date_eval=!0,l.push(e),cl(e,i)}else if(p===ug)s.clock=12,s.date=16|s.date,s.date_eval=!0,f.short="A/P"===f.value,cl(f,i);else if(p===up||p===uf||p===uR)cl(f.value,i);else if(p===ul)s.condition=[f.value[0],parseFloat(f.value[1])];else if(p===uh){let e=f.value.split("-"),t=e.length<2?"":e.slice(1).join("-"),r=e[0];r&&cl(r,i);let n=uO(t);n&&(s.locale=n);let a=parseInt(t,16);isFinite(a)&&0xff0000&a&&(a>>16&255)==6&&(s.date_system=6),c=!0}else if(p===ud){let e,t=f.value.toLowerCase();(e=/^color\s*(\d+)$/i.exec(t))&&(t=parseInt(e[1],10)),s.color=t}else if(p===ur)s.scale=100,s.percent=!0,cl("%",i);else if(p===ue)cl(f,i),s.date||(s.dec_fractions=!0,a="frac");else if("exp"===p)s.exponential=!0,s.exp_plus=f.value.includes("+"),a="man",cl({type:"exp",plus:s.exp_plus},i);else if(p===uC)cl(f,i);else if(p===u_)cl(f,i);else if(p!==uu&&p!==uc)throw p===us?SyntaxError(`Illegal character: ${m}`):SyntaxError(`Unknown token ${p} in ${m}`);u=f}if(s.tokensUsed=h,s.pattern=m,/^((?:\[[^\]]+\])+)(;|$)/.test(s.pattern)&&!/^\[(?:h+|m+|s+)\]/.test(s.pattern)&&cl({type:"text"},i),s.fractions&&s.dec_fractions||s.grouping&&!s.int_pattern.length||s.fractions&&s.exponential||s.fractions&&s.den_pattern.length*s.num_pattern.length==0||g&&!s.fractions&&!s.date||s.exponential&&(s.int_pattern.length||s.frac_pattern.length)*s.man_pattern.length==0)throw SyntaxError(`Invalid pattern: ${m}`);let f=s.int_pattern.join(""),p=s.man_pattern.join(""),C=s.frac_pattern.join("");co(f,s,"int");let _=0;for(let e=0;e<f.length;e++){let t=f[f.length-1-e];/^[0-9?]/.test(t)&&(_=e+1)}s.int_min=_,co(C,s,"frac"),co(p,s,"man");let y=s.num_pattern.join(""),R=s.den_pattern[0]||"";if(R.includes("?")||y.includes("?")?(R=(R=R.replace(/\d/g,"?")).replace(/#$/g,"?"),co(y,s,"num"),co(R,s,"den"),y=y.replace(/#$/g,"?")):(co(y,s,"num"),co(R,s,"den")),s.int_p=f,s.man_p=p,s.num_p=y,s.den_p=R,s.den_pattern.length&&(s.denominator=parseInt(s.den_pattern.join("").replace(/\D/g,""),10)),s.integer=!!f.length,!s.integer&&!s.exponential&&C.length){let e=s.tokens.findIndex(e=>"point"===e.type);s.tokens.splice(e,0,{type:"int",value:"#"}),s.integer=!0,s.int_pattern=["#"],s.int_p="#"}if(s.fractions)for(let e=0;e<i.length-1;e++){let t=i[e];if("string"!==t.type&&"space"!==t.type)continue;let r=i[e+1].type;"num"===r?t.rule="num+int":"div"===r?t.rule="num":"den"===r&&(t.rule="den")}return s.grouping&&s.int_pattern.length>1&&(s.grouping=!1),s}function ch(e,t=0){let r=Math.floor(Math.log10(e));return t>1?Math.floor(r/t)*t:r}function cd(e,t=1){return t<-300?parseFloat(e.toExponential().split("e")[0]):e*10**-t}let cm={total:1,sign:0,period:0,int:1,frac:0},cg=(e,t)=>e.replace(/\./,t.decimal),cf=(e,t,r)=>{let n=Math.abs(t);return[cg((1===e?e:uY(e,5))+"",r),r.exponent,t<0?r.negative:r.positive,n<10?"0":"",n]};function cp(e,t,r,n){let i=0|r;if("string"==typeof r)e.push(r);else if(r===i)e.push(Math.abs(i));else{let t=Math.abs(r),i=ch(t),s=cd(t,i);10===s&&(s=1,i++);let a=function(e,t=!0){let r=Math.abs(e);if(!r)return cm;let n=t&&e<0?1:0,i=Math.floor(r),s=Math.floor(Math.log10(r)+1),a=0,o=0;if(i!==r){a=1;let e=String(uY(r*10**-s,15)),t=e.length,n=!0,i=0;for(;i<=e.length;){if("."===e[i]){t--;break}"0"===e[i]&&n?t--:n=!1,i++}(o=t-s)<0&&(o=0,a=0)}return{total:n+Math.max(s,1)+a+o,digits:Math.max(s,0)+o,sign:n,period:a,int:Math.max(s,1),frac:o}}(t);if(i>=-4&&i<=-1){let r=t.toPrecision(10+i).replace(/\.?0+$/,"");e.push(cg(r,n))}else if(10===i){let r=t.toFixed(10).slice(0,12).replace(/\.$/,"");e.push(cg(r,n))}else if(9>=Math.abs(i))if(a.total<=11){let r=uY(t,9).toFixed(a.frac);e.push(cg(r,n))}else 9===i?e.push(Math.floor(t)):i>=0&&i<9?e.push(cg(String(uY(t,9-i)),n)):e.push(...cf(s,i,n));else a.total>=12?e.push(...cf(s,i,n)):e.push(cg(uY(t,9).toFixed(a.frac),n))}return e}function cC(e,t=!1){return"0"===e?"0":"?"===e?t?"":" ":""}function c_(e,t,r,n){var i,s;let a="",o="",l="",u="",c="",h="",d=0,m=0;if("bigint"==typeof e){if(!(e<=Number.MAX_SAFE_INTEGER)||!(e>=Number.MIN_SAFE_INTEGER))return r.bigintErrorNumber?String(e):r.overflow;m=e=Number(e)}else m=Math.trunc(e);let g=0,f=0,p=1,C=0,_=0,y=0,R=0,E=0,b=0,I=n||uV;if(!t.text&&isFinite(t.scale)&&1!==t.scale&&(e=function(e){if(0===e)return e;let t=Math.ceil(Math.log10(e<0?-e:e)),r=10**(16-Math.floor(t));return isFinite(r)?Math.round(e*r)/r:0}(e*t.scale)),t.exponential){let r=Math.abs(e);r&&(d=ch(r,t.int_max)),e&&!t.integer&&d++,r=cd(r,d),1===t.int_max&&10===uY(r,t.frac_max)&&(r=1,d++),e=e<0?-r:r,a+=Math.abs(d)}if(t.integer){let r=Math.abs(uY(e,t.fractions?1:t.frac_max));h+=r<1?"":Math.floor(r)}let N=null!=(i=r.grouping[0])?i:3,S=null!=(s=r.grouping[1])?s:N;t.dec_fractions&&(c=String(uY(e,t.frac_max)).split(".")[1]||"");let A=!t.error&&(t.num_p.includes("0")||t.den_p.includes("0")),v=A;if(t.fractions){v=A||!!(e%1);let r=Math.abs(t.integer?e%1:e);if(r)if(v=!0,t.denominator&&isFinite(t.denominator))u+=t.denominator,"0"===(l+=uY(r*t.denominator))&&(l="",u="",v=A);else{let e=uz(r,1/0,t.den_max);l+=e[0],u+=e[1],t.integer&&"0"===l&&(l="",u="",v=A)}else e||t.integer||(v=!0,l="0",u="1");!t.integer||v||Math.trunc(e)||(h="0")}if(t.date){let n,i;m=Math.trunc(e);let s=86400*(e-m);if(g=Math.floor(s),1e-6>Math.abs(b=s-g)?b=0:b>.9999&&(b=0,86400===(g+=1)&&(g=0,m+=1)),b){let e=512&t.date||256&t.date||128&t.date;(512===e&&b>.9995||256===e&&b>.995||128===e&&b>.95||!e&&b>=.5)&&(g++,b=0)}if(m||t.date_system){let n=uK(e,t.date_system,r.leap1900);f=n[0],p=n[1],C=n[2]}if(g){let e=g<0?86400+g:g;E=Math.floor(e)%60,R=Math.floor(e/60)%60,y=Math.floor(e/60/60)%60}if(_=(6+m)%7,t.date_eval&&(n=e,i=m+g/86400,r.dateSpanLarge?n<-694324||i>=0x222ba13:n<0||i>=2958466)){if(r.dateErrorThrows)throw Error("Date out of bounds");return r.dateErrorNumber?cp(e<0?[I.negative]:[],{},e,I).join(""):r.overflow}}let T=cC("?",r.nbsp);d<0?o="-":t.exp_plus&&(o="+");let w=[],M=(e,t,n,i)=>{let s=!i&&e.length>t.length?n.length+e.length-t.length:n.length;e.length<t.length&&(i+=e.length-t.length);for(let t=0;t<s;t++)w.push(e[t+i]||cC(n[t],r.nbsp));return s},O=!1,x={int:0,frac:0,man:0,num:0,den:0};for(let i=0,s=t.tokens.length;i<s;i++){let s=t.tokens[i],d=s.type,A=s.num?s.num.length:0;if("string"===d)s.rule?"num"===s.rule?v?w.push(s.value.replace(/ /g,T)):(t.num_min>0||t.den_min>0)&&w.push(s.value.replace(/./g,T)):"num+int"===s.rule?v&&h?w.push(s.value.replace(/ /g,T)):t.den_min>0&&(h||t.num_min)&&w.push(s.value.replace(/./g,T)):"den"===s.rule&&(v?w.push(s.value.replace(/ /g,T)):(t.den_min>0||t.den_min>0)&&w.push(s.value.replace(/./g,T))):w.push(s.value.replace(/ /g,T));else if("space"===d)"num+int"===s.rule?(v||t.num_min||t.den_min)&&(h||t.num_min)&&w.push(T):w.push(T);else if("error"===d)w.push(r.invalid);else if("point"===d)w.push(t.date?s.value:I.decimal);else if("general"===d)cp(w,t,e,I);else if("exp"===d)w.push(I.exponent);else if("minus"===d)s.volatile&&t.date||s.volatile&&(e>=0||"number"!=typeof e)||(s.volatile&&!t.fractions&&(t.integer||t.dec_fractions)?(e<0&&h&&"0"!==h||c)&&w.push(I.negative):w.push(I.negative));else if("plus"===d)w.push(I.positive);else if("text"===d)w.push(e);else if("fill"===d)r.fillChar&&w.push(r.fillChar,s.value);else if("skip"===d)r.skipChar?w.push(r.skipChar,s.value):w.push(r.nbsp?"":" ");else if("div"===d)v?w.push("/"):t.num_min>0||t.den_min>0?w.push(T):w.push(cC("#",r.nbsp));else if("int"===d)if(1===t.int_pattern.length){let e=t.int_p,n=Math.max(t.int_min,h.length),i="";for(let s=n;s>0;s--){let n=h.charAt(h.length-s),a=n?"":e.charAt(e.length-s)||e[0],o="";if(t.grouping){let e=s-1-N;e>=0&&!(e%S)&&(o=n||"0"===a?I.group:cC("?",r.nbsp))}i+=(n||cC(a,r.nbsp))+o}w.push(i)}else x.int+=M(h,t.int_p,s.num,x.int);else if("frac"===d){let e=x.frac;for(let t=0;t<A;t++)w.push(c[t+e]||cC(s.num[t],r.nbsp));x.frac+=A}else if("man"===d)x[d]||x.man||w.push(o),x.man+=M(a,t.man_p,s.num,x.man);else if("num"===d)x.num+=M(l,t.num_p,s.num,x.num);else if("den"===d){let e=x.den;for(let t=0;t<A;t++){let n=u[t+e];if(!n){let e=s.num[t];"123456789".includes(e)||O&&"0"===e?(O=!0,n=r.nbsp?"":" "):n=O||t!==A-1||"0"!==e||u?cC(e,r.nbsp):"1"}w.push(n)}x.den+=A}else if("year"===d)f<0&&w.push(I.negative),w.push(String(Math.abs(f)).padStart(4,"0"));else if("year-short"===d){let e=f%100;w.push(e<10?"0":"",e)}else if("month"===d)w.push(s.pad&&p<10?"0":"",p);else if("monthname-single"===d)6===t.date_system?w.push(I.mmmm6[p-1].charAt(0)):w.push(I.mmmm[p-1].charAt(0));else if("monthname-short"===d)6===t.date_system?w.push(I.mmm6[p-1]):w.push(I.mmm[p-1]);else if("monthname"===d)6===t.date_system?w.push(I.mmmm6[p-1]):w.push(I.mmmm[p-1]);else if("weekday-short"===s.type)w.push(I.ddd[_]);else if("weekday"===d)w.push(I.dddd[_]);else if("day"===d)w.push(s.pad&&C<10?"0":"",C);else if("hour"===d){let e=y%t.clock||(t.clock<24?t.clock:0);w.push(s.pad&&e<10?"0":"",e)}else if("min"===d)w.push(s.pad&&R<10?"0":"",R);else if("sec"===d)w.push(s.pad&&E<10?"0":"",E);else if("subsec"===d){w.push(I.decimal);let e=b.toFixed(t.sec_decimals);w.push(e.slice(2,2+s.decimals))}else if("ampm"===d){let e=y<12?0:1;s.short&&!n?w.push("AP"[e]):w.push(I.ampm[e])}else if("hour-elap"===d){e<0&&w.push(I.negative);let t=24*m+Math.floor(Math.abs(g)/3600);w.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("min-elap"===d){e<0&&w.push(I.negative);let t=1440*m+Math.floor(Math.abs(g)/60);w.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("sec-elap"===d){e<0&&w.push(I.negative);let t=86400*m+Math.abs(g);w.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("b-year"===d)w.push(f+543);else if("b-year-short"===d){let e=(f+543)%100;w.push(e<10?"0":"",e)}}return w.join("")}let cy=cc([{type:l9,value:"@",raw:"@"}]);function cR(e,t){for(let r=0;r<3;r++){let n=t[r];if(n){let t;if(n.condition){let r=n.condition[0],i=n.condition[1];"="===r?t=e===i:">"===r?t=e>i:"<"===r?t=e<i:">="===r?t=e>=i:"<="===r?t=e<=i:"<>"===r&&(t=e!==i)}else t=!0;if(t)return n}}}function cE(e){return!!(e[0]&&e[0].percent||e[1]&&e[1].percent||e[2]&&e[2].percent||e[3]&&e[3].percent)}function cb(e){return!!(e[0]&&e[0].date||e[1]&&e[1].date||e[2]&&e[2].date||e[3]&&e[3].date)}function cI(e){let[t,r,n,i]=e;return!!((!t||t.generated)&&(!r||r.generated)&&(!n||n.generated)&&i&&i.text&&!i.generated)}let cN={text:15,datetime:10.8,date:10.8,time:10.8,percent:10.6,currency:10.4,grouped:10.2,scientific:6,number:4,fraction:2,general:0,error:0},cS=[["DMY",1],["DM",2],["MY",3],["MDY",4],["MD",5],["hmsa",6],["hma",7],["hms",8],["hm",9]],cA=[[lZ,/^General/i,0],[lJ,/^#/,0],[l0,/^0/,0],[l1,/^\?/,0],[l2,/^\//,0],[l6,/^;/,0],[l9,/^@/,0],[l8,/^\+/,0],[l7,/^-/,0],[ue,/^\./,0],[ut,/^ /,0],[ur,/^%/,0],[un,/^[1-9]/,0],[ui,/^(?:B[12])/i,0],[us,/^B$/,0],[ua,/^(?:[hH]+|[mM]+|[sS]+|[yY]+|[bB]+|[dD]+|[gG]+|[aA]{3,}|e+)/,0],[uo,/^(?:\[(h+|m+|s+)\])/i,1],[ul,/^\[(<[=>]?|>=?|=)\s*(-?[.\d]+)\]/,[1,2]],[uu,/^\[(DBNum[0-4]?\d)\]/i,1],[uc,/^\[(NatNum[0-4]?\d)\]/i,1],[uh,/^\[\$([^\]]+)\]/,1],[ud,/^\[(black|blue|cyan|green|magenta|red|white|yellow|color\s*\d+)\]/i,1],[um,/^\[([^\]]+)\]/,1],[ug,/^(?:AM\/PM|am\/pm|A\/P)/,0],[uf,/^\\(.)/,1],[up,/^"([^"]*?)"/,1],[uC,/^_(\\.|.)/,1],["exp",/^[Ee]([+-])/,1],[u_,/^\*(\\.|.)/,1],[uy,/^[()]/,0],[us,/^[ENn["*/\\_]/,0],[uR,/^./,0]],cv=e=>{let t=(e||"\0").charCodeAt(0);return 63===t||35===t||t>=48&&t<=57};function cT(e){let t=0,r=[],n=[];for(;t<e.length;){let i=e.slice(t),s=0,a=/^(,+)(.)?/.exec(i);if(a){let i=a[1];s=i.length;let o=e[t-1]||"",l=!1,u=!1;cv(o)?(l=!0,u=!0):"."===o&&(u=!0);let c=a[2]||"";if(l&&(!c||";"===c)&&(l=!1),u&&cv(c)&&(u=!1),l&&!u)r.push({type:l5,value:",",raw:i});else if(!l&&u)r.push({type:l3,value:",",raw:i});else if(l&&u){let e={type:l3,value:",",raw:i};r.push(e),n.push(e)}else r.push({type:l4,value:",",raw:i})}else{let e;for(let[t,n,a]of cA){let o=n.exec(i);if(o){e={type:t,value:Array.isArray(a)?a.map(e=>o[e]):o[a||0],raw:o[0]},r.push(e),s=o[0].length;break}}n.length&&";"===e.raw&&(n.length=0),n.length&&cv(e.raw)&&(n.forEach(e=>e.type=l5),n.length=0)}if(!s){let e=i[0];s=1,r.push({type:uR,value:e,raw:e})}t+=s}return r}let cw=e=>{let t=e.condition;t&&t[1]<0&&("<"===t[0]||"<="===t[0]||"="===t[0])||e.tokens.unshift({type:"minus",volatile:!0})},cM=(e,t=null)=>{let r={};for(let t in e)Array.isArray(e[t])?r[t]=[...e[t]]:r[t]=e[t];return t&&r.tokens.unshift(t),r.generated=!0,r},cO=Object.create({});function cx(e,t=!1){e||(e="General");let r=cO[e];if(!r)try{r=function(e){var t;let r=[],n=!1,i,s=null,a=0,o=!1,l=0,u=0,c=cT(e);do{if(((o=cc(c)).date||o.general)&&(o.int_pattern.length||o.frac_pattern.length||1!==o.scale||o.text))throw Error("Illegal format");if(o.condition&&(u++,n=!0),o.text){if(s)throw Error("Unexpected partition");s=o}o.locale&&(i=uO(o.locale)),r.push(o),a=+((null==(t=c[o.tokensUsed])?void 0:t.type)==="break"),c=c.slice(o.tokensUsed+a),l++}while(a&&l<4&&u<3)if(a)throw Error("Unexpected partition");if(u>2)throw Error("Unexpected condition");let h=r[3];if(h&&(h.int_pattern.length||h.frac_pattern.length||h.date))throw Error("Unexpected partition");if(n){let e=r.length;if(1===e&&(r[1]=cc(cT("General")),r[1].generated=!0),e<3){let e=r[0],t=r[1];if(cw(e),t.condition)cw(t);else{let r=e.condition;("="===r[0]||r[1]>=0&&(">"===r[0]||">="===r[0]))&&t.tokens.unshift({type:"minus",volatile:!0})}}else r.forEach(cw)}else{if(r.length<4&&s)for(let e=0,t=r.length;e<t;e++)r[e]===s&&r.splice(e,1);if(r.length<1&&s&&(r[0]=cc(cT("General")),r[0].generated=!0),r.length<2&&r.push(cM(r[0],{type:"minus",volatile:!0})),r.length<3&&r.push(cM(r[0])),r.length<4)if(s)r.push(s);else{let e=cc(cT("@"));e.generated=!0,r.push(e)}r[0].condition=[">",0],r[1].condition=["<",0],r[2].condition=null}return{pattern:e,partitions:r,locale:i}}(e),cO[e]=r}catch(i){if(t)throw i;let n={tokens:[{type:"error"}],error:i.message};r={pattern:e,partitions:[n,n,n,n],error:i.message,locale:null}}return r}let cU=Object.freeze({AMPM:ug,BREAK:l6,CALENDAR:ui,CHAR:uR,COLOR:ud,COMMA:l4,CONDITION:ul,DATETIME:ua,DBNUM:uu,DIGIT:un,DURATION:uo,ERROR:us,ESCAPED:uf,EXP:"exp",FILL:u_,GENERAL:lZ,GROUP:l5,HASH:lJ,LOCALE:uh,MINUS:l7,MODIFIER:um,NATNUM:uc,PAREN:uy,PERCENT:ur,PLUS:l8,POINT:ue,QMARK:l1,SCALE:l3,SKIP:uC,SLASH:l2,SPACE:ut,STRING:up,TEXT:l9,ZERO:l0}),cD=Object.freeze(Object.defineProperty({__proto__:null,addLocale:uD,dateFromSerial:function(e,t){let r=0|e,n=86400*(e-r),i=uQ(n);n-i>.9999&&86400===(i+=1)&&(i=0,r+=1);let s=i<0?86400+i:i,[a,o,l]=uK(e,0,t&&t.leap1900),u=uQ(s/60/60)%60;return[a,o,l,u,uQ(s/60)%60,uQ(s)%60]},dateToSerial:uZ,dec2frac:uz,format:function(e,t,r={}){var n;let i=Object.assign({},uG,r),s=cx(e,i.throws);return function(e,t,r){let n=t.partitions,i=ux(t.locale||r.locale),s=n[3]?n[3]:cy;if("boolean"==typeof e&&(e=(i||uV).bool[+!e]),null==e)return"";let a="bigint"==typeof e;if("number"!=typeof e&&!a)return c_(e,s,r,i);if(!a&&!isFinite(e)){let t=i||uV;return isNaN(e)?t.nan:(e<0?t.negative:"")+t.infinity}let o=cR(e,n);return o?c_(e,o,r,i):r.overflow}(null!=(n=uZ(t,i))?n:t,s,i)},formatColor:function(e,t,r){let n=Object.assign({},uG,r),i=cx(e,n.throws);var s,a=null!=(s=uZ(t,n))?s:t;let o=i.partitions,l=o[3],u=null;return("number"==typeof a||"bigint"==typeof a)&&isFinite(a)&&(l=cR(a,o)),l&&l.color&&(u=l.color),u&&"number"==typeof u&&n.indexColors&&(u=uE[u-1]||"#000"),u},getFormatDateInfo:function(e){let t=cx(e,!1);return t.dateInfo||(t.dateInfo=function(e){let[t]=e;return{year:!!(2&t.date),month:!!(4&t.date),day:!!(8&t.date),hours:!!(16&t.date),minutes:!!(32&t.date),seconds:!!(64&t.date),clockType:12===t.clock?12:24}}(t.partitions)),t.dateInfo},getFormatInfo:function(e,t={}){let r=cx(e,!1);return r.info||(r.info=function(e,t=null){var r;let[n,i]=e,s=n.frac_max,a={type:"general",isDate:cb(e),isText:cI(e),isPercent:cE(e),maxDecimals:n.general?9:s,scale:null!=(r=n.scale)?r:1,color:0,parentheses:0,grouped:+!!n.grouping},o=!a.isDate&&!a.isText&&!n.error&&n.tokens.some(e=>"string"===e.type&&(t?e.value===t:uI.test(e.value))),l="G",u=s>=0?Math.min(15,s):"",c="",h="";if(i&&i.color&&(h="-",a.color=1),n.parens&&(c="()",a.parentheses=1),o)l="C",a.type="currency";else if(n.error)a.type="error",a.maxDecimals=0;else if(a.isDate){let e=0,t=0,r="";n.tokens.forEach(n=>{let i=n.type;/^(b-)?year/.test(i)?(r+="Y",t++):i.startsWith("month")?(r+="M",t++):/^(week)?day/.test(i)?(r+="D",t++):("hour"===i||"min"===i||"sec"===i||"ampm"===i)&&(r+=i[0],e++)}),a.type="date",t&&e?a.type="datetime":!t&&e&&(a.type="time");let i=cS.find(e=>r.startsWith(e[0]));l=i?"D":"G",u=i?i[1]:""}else a.isText?(l="G",a.type="text",u="",a.maxDecimals=0):n.general?(l="G",a.type="general",u=""):n.fractions?(l="G",a.type="fraction",u=""):n.exponential?(l="S",a.type="scientific"):a.isPercent?(l="P",a.type="percent"):n.grouping?(l=",",a.type="grouped"):(n.int_max||s)&&(l="F",a.type="number");return a.code=l+u+h+c,a.level=cN[a.type],Object.freeze(a)}(r.partitions,null==t?void 0:t.currency)),r.info},getLocale:ux,isDateFormat:function(e){return cb(cx(e,!1).partitions)},isPercentFormat:function(e){return cE(cx(e,!1).partitions)},isTextFormat:function(e){return cI(cx(e,!1).partitions)},isValidFormat:function(e){try{return cx(e,!0),!0}catch{return!1}},parseBool:ca,parseDate:cn,parseLocale:uM,parseNumber:u8,parseTime:cs,parseValue:function(e,t){var r,n,i;return null!=(i=null!=(n=null!=(r=u8(e,t))?r:cn(e,t))?n:cs(e,t))?i:ca(e,t)},round:uY,tokenTypes:cU,tokenize:cT},Symbol.toStringTag,{value:"Module"})),cV="@@@",cL="@",cP="General";function ck(e){return e===cV||e===cL}function cF(e){return null==e||e===cP}let cj=(e,t)=>{if(e&&!t||!e&&t)return!1;let r=e=>{let t=cT(e),r="",n=!1,i=!1;for(let e of t){if(e.type===cU.POINT){n=!0;continue}if(!(i&&e.type===cU.MINUS)&&e.type!==cU.SKIP){if(e.type===cU.COLOR){i=!0;continue}i=!1,n&&e.type===cU.ZERO||(n=!1)||(r+=e.value||"")}}return r};return r(e)===r(t)},cB={sheetId:"",range:{startRow:-1,endRow:-1,startColumn:-1,endColumn:-1}},c$={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1},cH={startRow:0,startColumn:0,endRow:0,endColumn:0},cW={row:0,column:0},cG={ff:"Arial",fs:11,it:iP.FALSE,bl:iP.FALSE,ul:{s:iP.FALSE},st:{s:iP.FALSE},ol:{s:iP.FALSE},tr:{a:0,v:iP.FALSE},td:iw.UNSPECIFIED,cl:{rgb:"#000"},bg:{rgb:"#fff"},ht:iO.UNSPECIFIED,vt:ix.UNSPECIFIED,tb:iU.UNSPECIFIED,pd:{t:0,r:0,b:0,l:0},n:null,bd:{b:null,l:null,r:null,t:null}},cY={id:"default_slide",title:"defaultSlide",pageSize:{width:300,height:300}},cz=[tv,tw,tT],cX={[i2.HEADING_1]:{fs:20,bl:1},[i2.HEADING_2]:{fs:18,bl:1},[i2.HEADING_3]:{fs:16,bl:1},[i2.HEADING_4]:{fs:14,bl:1},[i2.HEADING_5]:{fs:12,bl:1},[i2.NORMAL_TEXT]:null,[i2.TITLE]:{fs:26,bl:1},[i2.SUBTITLE]:{fs:15,cl:{rgb:"#999999"}},[i2.NAMED_STYLE_TYPE_UNSPECIFIED]:null},cq={[i2.HEADING_1]:{spaceAbove:{v:20},spaceBelow:{v:10}},[i2.HEADING_2]:{spaceAbove:{v:18},spaceBelow:{v:10}},[i2.HEADING_3]:{spaceAbove:{v:16},spaceBelow:{v:10}},[i2.HEADING_4]:{spaceAbove:{v:14},spaceBelow:{v:8}},[i2.HEADING_5]:{spaceAbove:{v:12},spaceBelow:{v:8}},[i2.NORMAL_TEXT]:{spaceAbove:{v:0},spaceBelow:{v:0}},[i2.TITLE]:{spaceAbove:{v:0},spaceBelow:{v:7}},[i2.SUBTITLE]:{spaceAbove:{v:0},spaceBelow:{v:16}},[i2.NAMED_STYLE_TYPE_UNSPECIFIED]:null},cK="univer-sheets-chart-print-chart",cQ="univer-docs-drawing-printing";var cZ=((eV=cZ||{}).ARRAY_CONVERTOR="ARRAY_CONVERTOR",eV.MATRIX_CONVERTOR="MATRIX_CONVERTOR",eV);let cJ={[sc.A3]:{width:1123,height:1587},[sc.A4]:{width:794,height:1124},[sc.A5]:{width:559,height:794},[sc.B4]:{width:944,height:1344},[sc.B5]:{width:665,height:944},[sc.Executive]:{width:696,height:1008},[sc.Folio]:{width:816,height:1248},[sc.Legal]:{width:816,height:1344},[sc.Letter]:{width:816,height:1056},[sc.Statement]:{width:528,height:816},[sc.Tabloid]:{width:1056,height:1632}};function c0(e,t){let{textRuns:r=[]}=t,n=0;for(let t of r){let{ts:r={},st:i,ed:s}=t;if(null==r[e])return iP.FALSE;switch(e){case"bl":case"it":if(r[e]===iP.FALSE)return iP.FALSE;break;case"ul":case"st":if(r[e].s===iP.FALSE)return iP.FALSE;break;default:throw Error(`unknown style key: ${e} in IStyleBase`)}n+=s-i}return t.dataStream.indexOf(`\r
`)===n?iP.TRUE:iP.FALSE}let c1=class e{constructor(e,t,r){tg(this,"_range"),tg(this,"_worksheet"),this._deps=r,this._range=t,this._worksheet=e}static foreach(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}getRangeData(){return this._range}getValue(){return this.getValues()[0][0]}getValues(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=[];for(let s=e;s<=t;s++){let e=[];for(let t=r;t<=n;t++)e.push(this.getMatrix().getValue(s,t)||null);i.push(e)}return i}getMatrix(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new oi;for(let a=e;a<=t;a++)for(let e=r;e<=n;e++)s.setValue(a,e,i.getValue(a,e)||null);return s}getMatrixObject(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new oi;for(let a=e;a<=t;a++)for(let t=r;t<=n;t++)s.setValue(a-e,t-r,i.getValue(a,t)||{});return s}getA1Notation(){let e,t,{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range;return i<s?(e=ir.numToWord(i+1)+(r+1),t=ir.numToWord(s+1)+(n+1)):(e=ir.numToWord(s+1)+(n+1),t=ir.numToWord(i+1)+(r+1)),e===t?`${e}`:`${e}:${t}`}getBackground(){return this.getBackgrounds()[0][0]}getBackgrounds(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.bg)?void 0:r.rgb)||cG.bg.rgb}))}getCell(t,r){let{startRow:n,startColumn:i}=this._range;return new e(this._worksheet,{startRow:n+t,endRow:n+t,startColumn:i+r,endColumn:i+r},this._deps)}getColumn(){return this._range.startColumn}getObjectValue(e={}){return this.getObjectValues(e)[0][0]}getObjectValues(e={}){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range,a=this._worksheet.getCellMatrix().getFragment(r,n,i,s).getData();if(e.isIncludeStyle){let e=this._deps.getStyles();for(let o=0;o<=n-r;o++)for(let r=0;r<=s-i;r++){if(null==a||(null==(t=null==a?void 0:a[o])?void 0:t[r])==null)continue;let n=a[o][r].s;n&&(a[o][r].s=e.get(n))}}return a}getFontColor(){return this.getFontColors()[0][0]}getFontColors(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.cl)?void 0:r.rgb)||cG.cl.rgb}))}getFontFamilies(){return this._getStyles("ff")}getFontFamily(){return this.getFontFamilies()[0][0]}getUnderlines(){return this._getStyles("ul")}getUnderline(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?c0("ul",r.body)===iP.TRUE?{s:iP.TRUE}:{s:iP.FALSE}:this.getUnderlines()[0][0]}getOverlines(){return this._getStyles("ol")}getOverline(){return this.getOverlines()[0][0]}getStrikeThrough(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?c0("st",r.body)===iP.TRUE?{s:iP.TRUE}:{s:iP.FALSE}:this.getStrikeThroughs()[0][0]}getStrikeThroughs(){return this._getStyles("st")}getFontSize(){var e,t;let r=(null==(e=this.getValue())?void 0:e.p)||{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0&&r.body.textRuns.some(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)!=null})?Math.max(...r.body.textRuns.map(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)||0})):this.getFontSizes()[0][0]}getFontSizes(){return this._getStyles("fs")}getBorder(){return this.getBorders()[0][0]}getBorders(){return this._getStyles("bd")}getFontStyle(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?c0("it",r.body)===iP.TRUE?iD.ITALIC:iD.NORMAL:this._getFontStyles()[0][0]}_getFontStyles(){return this._getStyles("it")}getFontWeight(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?c0("bl",r.body)===iP.TRUE?iV.BOLD:iV.NORMAL:this._getFontWeights()[0][0]}_getFontWeights(){return this._getStyles("bl")}getGridId(){return this._worksheet.getSheetId()}getHeight(){let{_range:e,_worksheet:t}=this,{startRow:r,endRow:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getRowHeight(e);return i}getHorizontalAlignment(){return this.getHorizontalAlignments()[0][0]}getHorizontalAlignments(){return this._getStyles("ht")}getLastColumn(){return this._range.endColumn}getLastRow(){return this._range.endRow}getNumColumns(){let{startColumn:e,endColumn:t}=this._range;return t-e+1}getNumRows(){let{startRow:e,endRow:t}=this._range;return t-e+1}getRichTextValue(){return this.getRichTextValues()[0][0]}getRichTextValues(){return this.getValues().map(e=>e.map(e=>(null==e?void 0:e.p)||""))}getRowIndex(){return this._range.startRow}getSheet(){return this._worksheet}getTextDirection(){return this.getTextDirections()[0][0]}getTextDirections(){return this._getStyles("td")}getTextRotation(){return this.getTextRotations()[0][0]}getTextRotations(){return this._getStyles("tr")}getTextStyle(){return this.getTextStyles()[0][0]}getTextStyles(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>e.getStyleByCell(t)))}getVerticalAlignment(){return this.getVerticalAlignments()[0][0]}getVerticalAlignments(){return this._getStyles("vt")}getWidth(){let{_range:e,_worksheet:t}=this,{startColumn:r,endColumn:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getColumnWidth(e);return i}getWrap(){return this.getWrapStrategy()===iU.WRAP?iP.TRUE:iP.FALSE}getWrapStrategies(){return this._getStyles("tb")}getWrapStrategy(){return this.getWrapStrategies()[0][0]}forEach(t){e.foreach(this._range,t)}_getStyles(e){let t=this._deps.getStyles();return this.getValues().map(r=>r.map(r=>{let n=t&&t.getStyleByCell(r);return n&&n[e]||cG[e]}))}};tg(c1,"transformRange",(e,t)=>{let r=t.getMaxColumns()-1,n=t.getMaxRows()-1;return e.rangeType===a0.ALL?{startColumn:0,startRow:0,endColumn:r,endRow:n}:e.rangeType===a0.COLUMN?{startRow:0,endRow:n,startColumn:e.startColumn,endColumn:e.endColumn}:e.rangeType===a0.ROW?{startColumn:0,endColumn:r,startRow:e.startRow,endRow:e.endRow}:{startColumn:e.startColumn,endColumn:Math.min(e.endColumn,r),startRow:e.startRow,endRow:Math.min(e.endRow,n)}});let c2=c1;function c5(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}class c3{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,r=[];if(!hn(e,t))return r;let n=this.toBBox,i=[];for(;t;){for(let s=0;s<t.children.length;s++){let a=t.children[s],o=t.leaf?n(a):a;hn(e,o)&&(t.leaf?r.push(a):hr(e,o)?this._all(a,r):i.push(a))}t=i.pop()}return r}collides(e){let t=this.data;if(!hn(e,t))return!1;let r=[];for(;t;){for(let n=0;n<t.children.length;n++){let i=t.children[n],s=t.leaf?this.toBBox(i):i;if(hn(e,s)){if(t.leaf||hr(e,s))return!0;r.push(i)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=hi([]),this}remove(e,t){let r,n,i;if(!e)return this;let s=this.data,a=this.toBBox(e),o=[],l=[];for(;s||o.length;){if(s||(s=o.pop(),n=o[o.length-1],r=l.pop(),i=!0),s.leaf){let r=function(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return -1}(e,s.children,t);if(-1!==r)return s.children.splice(r,1),o.push(s),this._condense(o),this}!i&&!s.leaf&&hr(s,a)?(o.push(s),l.push(r),r=0,n=s,s=s.children[0]):n?(r++,s=n.children[r],i=!1):s=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){let i=r-t+1,s=this._maxEntries,a;if(i<=s)return c4(a=hi(e.slice(t,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),(a=hi([])).leaf=!1,a.height=n;let o=Math.ceil(i/s),l=o*Math.ceil(Math.sqrt(s));hs(e,t,r,l,this.compareMinX);for(let i=t;i<=r;i+=l){let t=Math.min(i+l-1,r);hs(e,i,t,o,this.compareMinY);for(let r=i;r<=t;r+=o){let i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return c4(a,this.toBBox),a}_chooseSubtree(e,t,r,n){for(;n.push(t),!(t.leaf||n.length-1===r);){let r=1/0,n=1/0,a;for(let o=0;o<t.children.length;o++){var i,s;let l=t.children[o],u=he(l),c=(i=e,(Math.max((s=l).maxX,i.maxX)-Math.min(s.minX,i.minX))*(Math.max(s.maxY,i.maxY)-Math.min(s.minY,i.minY))-u);c<n?(n=c,r=u<r?u:r,a=l):c===n&&u<r&&(r=u,a=l)}t=a||t.children[0]}return t}_insert(e,t,r){let n=r?e:this.toBBox(e),i=[],s=this._chooseSubtree(n,this.data,t,i);for(s.children.push(e),c9(s,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(e,t){let r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);let s=this._chooseSplitIndex(r,i,n),a=hi(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,c4(r,this.toBBox),c4(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=hi([e,t]),this.data.height=e.height+1,this.data.leaf=!1,c4(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,i=1/0,s=1/0;for(let a=t;a<=r-t;a++){let t=c6(e,0,a,this.toBBox),o=c6(e,a,r,this.toBBox),l=function(e,t){let r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-r)*Math.max(0,Math.min(e.maxY,t.maxY)-n)}(t,o),u=he(t)+he(o);l<i?(i=l,n=a,s=u<s?u:s):l===i&&u<s&&(s=u,n=a)}return n||r-t}_chooseSplitAxis(e,t,r){let n=e.leaf?this.compareMinX:c8,i=e.leaf?this.compareMinY:c7;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);let i=this.toBBox,s=c6(e,0,t,i),a=c6(e,r-t,r,i),o=ht(s)+ht(a);for(let n=t;n<r-t;n++){let t=e.children[n];c9(s,e.leaf?i(t):t),o+=ht(s)}for(let n=r-t-1;n>=t;n--){let t=e.children[n];c9(a,e.leaf?i(t):t),o+=ht(a)}return o}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)c9(t[n],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():c4(e[t],this.toBBox)}}function c4(e,t){c6(e,0,e.children.length,t,e)}function c6(e,t,r,n,i){i||(i=hi(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<r;s++){let t=e.children[s];c9(i,e.leaf?n(t):t)}return i}function c9(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function c8(e,t){return e.minX-t.minX}function c7(e,t){return e.minY-t.minY}function he(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function ht(e){return e.maxX-e.minX+(e.maxY-e.minY)}function hr(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function hn(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function hi(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function hs(e,t,r,n,i){let s=[t,r];for(;s.length;){if((r=s.pop())-(t=s.pop())<=n)continue;let a=t+Math.ceil((r-t)/n/2)*n;(function e(t,r,n=0,i=t.length-1,s=function(e,t){return e<t?-1:+(e>t)}){for(;i>n;){if(i-n>600){let a=i-n+1,o=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(o-a/2<0?-1:1),h=Math.max(n,Math.floor(r-o*u/a+c)),d=Math.min(i,Math.floor(r+(a-o)*u/a+c));e(t,r,h,d,s)}let a=t[r],o=n,l=i;for(c5(t,n,r),s(t[i],a)>0&&c5(t,n,i);o<l;){for(c5(t,o,l),o++,l--;0>s(t[o],a);)o++;for(;s(t[l],a)>0;)l--}0===s(t[n],a)?c5(t,n,l):c5(t,++l,i),l<=r&&(n=l+1),r<=l&&(i=l-1)}})(e,a,t,r,i),s.push(t,a,a,r)}}function ha(e,t,r,n=!1){if(0===t&&0===r)return e;let i={...e},s=i.startAbsoluteRefType||a1.NONE,a=i.endAbsoluteRefType||a1.NONE,o=i.rangeType||a0.NORMAL;if(!n&&s===a1.ALL&&a===a1.ALL)return i;let l=ho(i.startRow,r,i.startColumn,t,o),u=ho(i.endRow,r,i.endColumn,t,o);return n||s===a1.NONE&&a===a1.NONE?i={...i,startRow:l.row,startColumn:l.column,endRow:u.row,endColumn:u.column}:(s===a1.NONE?i={...i,startRow:l.row,startColumn:l.column}:s===a1.COLUMN?i={...i,startRow:l.row}:s===a1.ROW&&(i={...i,startColumn:l.column}),a===a1.NONE?i={...i,endRow:u.row,endColumn:u.column}:a===a1.COLUMN?i={...i,endRow:u.row}:a===a1.ROW&&(i={...i,endColumn:u.column}),i)}function ho(e,t,r,n,i){return i===a0.NORMAL?{row:e+t,column:r+n}:i===a0.ROW?{row:e+t,column:r}:i===a0.COLUMN?{row:e,column:r+n}:{row:e,column:r}}function hl(e){let t=new Set,r=new Set;for(let n of e)t.add(n.startColumn),t.add(n.endColumn+1),r.add(n.startRow),r.add(n.endRow+1);let n=Array.from(t).sort((e,t)=>e-t),i=Array.from(r).sort((e,t)=>e-t);e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let s=[];for(let t=0;t<i.length-1;t++)for(let r=0;r<n.length-1;r++){let a=n[r],o=n[r+1]-1,l=i[t],u=i[t+1]-1;for(let t of e){if(t.startRow>u)break;if(t.startRow<=l&&t.endRow>=u&&t.startColumn<=a&&t.endColumn>=o){s.push({startColumn:a,endColumn:o,startRow:l,endRow:u});break}}}return s}function hu(e,t){let r=hc(e.startRow,e.endRow,t.startRow,t.endRow),n=hc(e.startColumn,e.endColumn,t.startColumn,t.endColumn);if(!r||!n)return null;let[i,s]=r,[a,o]=n,l=function(e,t,r,n,i,s){let a=void 0!==e?e:hh(r,n,i,s),o=void 0!==t?t:hh(r,n,i,s);return a===a0.ALL||o===a0.ALL?a===o?a:a===a0.ALL?o:a:a===o?a:(a===a0.NORMAL||a0.NORMAL,a0.NORMAL)}(e.rangeType,t.rangeType,i,s,a,o);return{startRow:i,endRow:s,startColumn:a,endColumn:o,rangeType:l}}function hc(e,t,r,n){let i=isNaN(e)?-1/0:e,s=isNaN(t)?1/0:t,a=isNaN(r)?-1/0:r,o=isNaN(n)?1/0:n,l=Math.max(i,a),u=Math.min(s,o);return l<=u?[l===-1/0?NaN:l,u===1/0?NaN:u]:null}function hh(e,t,r,n){let i=!isNaN(e)&&!isNaN(t),s=!isNaN(r)&&!isNaN(n);return i&&s?a0.NORMAL:i?a0.ROW:s?a0.COLUMN:a0.ALL}let hd=class e{static clone(e){return void 0!==e.rangeType?{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn,rangeType:e.rangeType}:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}static equals(e,t){return null!=e&&null!=t&&e.endRow===t.endRow&&e.endColumn===t.endColumn&&e.startRow===t.startRow&&e.startColumn===t.startColumn&&(e.rangeType===t.rangeType||void 0===e.rangeType&&t.rangeType===a0.NORMAL||void 0===t.rangeType&&e.rangeType===a0.NORMAL)}static simpleRangesIntersect(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s}=e,{startRow:a,endRow:o,startColumn:l,endColumn:u}=t;return r<=o&&n>=a&&i<=u&&s>=l}static intersects(e,t){if(e.rangeType===a0.ROW&&t.rangeType===a0.COLUMN||e.rangeType===a0.COLUMN&&t.rangeType===a0.ROW)return!0;if(e.rangeType===a0.ROW&&t.rangeType===a0.ROW)return e.startRow<=t.endRow&&e.endRow>=t.startRow;if(e.rangeType===a0.COLUMN&&t.rangeType===a0.COLUMN)return e.startColumn<=t.endColumn&&e.endColumn>=t.startColumn;let r=Math.floor(Number.MAX_SAFE_INTEGER/10),n=Number.isNaN(e.startRow)?0:e.startRow,i=Number.isNaN(e.endRow)?r:e.endRow,s=Number.isNaN(e.startColumn)?0:e.startColumn,a=Number.isNaN(e.endColumn)?r:e.endColumn,o=Number.isNaN(t.startRow)?0:t.startRow,l=Number.isNaN(t.endRow)?r:t.endRow,u=Number.isNaN(t.startColumn)?0:t.startColumn,c=Number.isNaN(t.endColumn)?r:t.endColumn,h=Math.abs(n+i-o-l),d=Math.abs(n-i)+Math.abs(o-l);return Math.abs(s+a-u-c)<=Math.abs(s-a)+Math.abs(u-c)&&h<=d}static doAnyRangesIntersect(e,t){let r=new c3;return r.load(e.map(e=>({minX:e.startColumn,minY:e.startRow,maxX:e.endColumn,maxY:e.endRow}))),t.some(e=>r.search({minX:e.startColumn,minY:e.startRow,maxX:e.endColumn,maxY:e.endRow}).length>0)}static getIntersects(e,t){let r,n,i,s=e.startRow,a=e.endRow,o=e.startColumn,l=e.endColumn,u=t.startRow,c=t.endRow,h=t.startColumn,d=t.endColumn;return u<=a&&(n=u>=s?u:s,c>=s&&(i=c>=a?a:c,h<=l&&(r=h>o?h:o,d>=o)))?{startRow:n,endRow:i,startColumn:r,endColumn:d>=l?l:d,rangeType:a0.NORMAL}:null}static contains(e,t){return e.startRow<=t.startRow&&e.endRow>=t.endRow&&e.startColumn<=t.startColumn&&e.endColumn>=t.endColumn}static realContain(t,r){return e.contains(t,r)&&(t.startRow<r.startRow||t.endRow>r.endRow||t.startColumn<r.startColumn||t.endColumn>r.endColumn)}static union(...e){return e.reduce((e,t)=>({startRow:Math.min(e.startRow,t.startRow),startColumn:Math.min(e.startColumn,t.startColumn),endRow:Math.max(e.endRow,t.endRow),endColumn:Math.max(e.endColumn,t.endColumn),rangeType:a0.NORMAL}),e[0])}static realUnion(...t){let r=t.some(e=>e.rangeType===a0.COLUMN),n=t.some(e=>e.rangeType===a0.ROW),i=e.union(...t);return{startColumn:n?NaN:i.startColumn,endColumn:n?NaN:i.endColumn,startRow:r?NaN:i.startRow,endRow:r?NaN:i.endRow,rangeType:n?a0.ROW:r?a0.COLUMN:a0.NORMAL}}static subtract(e,t){if(t.startRow>e.endRow||t.endRow<e.startRow||t.startColumn>e.endColumn||t.endColumn<e.startColumn)return[e];let r=[];t.startRow>=e.startRow&&r.push({startRow:e.startRow,startColumn:e.startColumn,endRow:t.startRow-1,endColumn:e.endColumn}),t.endRow<=e.endRow&&r.push({startRow:t.endRow+1,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn});let n=Math.max(e.startRow,t.startRow),i=Math.min(e.endRow,t.endRow);return t.startColumn>=e.startColumn&&r.push({startRow:n,startColumn:e.startColumn,endRow:i,endColumn:t.startColumn-1}),t.endColumn<=e.endColumn&&r.push({startRow:n,startColumn:t.endColumn+1,endRow:i,endColumn:e.endColumn}),r.filter(e=>e.startRow<=e.endRow&&e.startColumn<=e.endColumn)}static mergeRanges(e){return function(e){e.sort((e,t)=>e.startColumn-t.startColumn||e.startRow-t.startRow);let t={};for(let r of e)t[r.startColumn]||(t[r.startColumn]=[]),t[r.startColumn].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startRow-t.startRow);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startRow<=i.endRow+1&&t.startColumn===i.startColumn&&t.endColumn===i.endColumn?i.endRow=Math.max(i.endRow,t.endRow):(r.push(i),i=t)}r.push(i)}return r}(function(e){e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let t={};for(let r of e)t[r.startRow]||(t[r.startRow]=[]),t[r.startRow].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startColumn-t.startColumn);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startColumn<=i.endColumn+1&&t.startRow===i.startRow&&t.endRow===i.endRow?i.endColumn=Math.max(i.endColumn,t.endColumn):(r.push(i),i=t)}r.push(i)}return r}(hl(e)))}static splitIntoGrid(e){return hl(e)}static subtractMulti(e,t){if(!t.length)return e;let r=e;return t.forEach(e=>{r=function(e,t){let r=[];return e.forEach(e=>{r.push(...hm.subtract(e,t))}),hm.mergeRanges(r)}(r,e)}),r}static hasIntersectionBetweenTwoRect(e,t){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}static getIntersectionBetweenTwoRect(e,t){let r=Math.max(e.left,t.left),n=Math.min(e.right,t.right),i=Math.max(e.top,t.top),s=Math.min(e.bottom,t.bottom);return n<=r||s<=i?null:{left:r,right:n,top:i,bottom:s,width:n-r,height:s-i}}static sort(e){return e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn)}};tg(hd,"getRelativeRange",(e,t)=>({startRow:e.startRow-t.startRow,endRow:e.endRow-e.startRow,startColumn:e.startColumn-t.startColumn,endColumn:e.endColumn-e.startColumn})),tg(hd,"getPositionRange",(e,t,r)=>({...r||{},startRow:r&&[a1.ROW,a1.ALL].includes(r.startAbsoluteRefType||0)?r.startRow:e.startRow+t.startRow,endRow:r&&[a1.ROW,a1.ALL].includes(r.endAbsoluteRefType||0)?r.endRow:e.endRow+e.startRow+t.startRow,startColumn:r&&[a1.COLUMN,a1.ALL].includes(r.startAbsoluteRefType||0)?r.startColumn:e.startColumn+t.startColumn,endColumn:r&&[a1.COLUMN,a1.ALL].includes(r.endAbsoluteRefType||0)?r.endColumn:e.endColumn+e.startColumn+t.startColumn})),tg(hd,"moveHorizontal",(e,t=0,r=0)=>({...e,startColumn:e.startColumn+t,endColumn:e.endColumn+t+r})),tg(hd,"moveVertical",(e,t=0,r=0)=>({...e,startRow:e.startRow+t,endRow:e.endRow+t+r})),tg(hd,"moveOffset",(e,t,r)=>{let n={...e};switch(e.startAbsoluteRefType){case a1.ROW:n.startColumn+=t;break;case a1.COLUMN:n.startRow+=r;break;case a1.ALL:break;case a1.NONE:default:n.startRow+=r,n.startColumn+=t}switch(e.endAbsoluteRefType){case a1.ROW:n.endColumn+=t;break;case a1.COLUMN:n.endRow+=r;break;case a1.ALL:break;case a1.NONE:default:n.endRow+=r,n.endColumn+=t}return n});let hm=hd;function hg(e,t){let r=e.toFullArray(),n=[];for(;;){let e=function(e,t){if(0===e.length||0===e[0].length)return null;let r=Array(e[0].length).fill(0),n=0,i=null;for(let s=0;s<e.length;s++){for(let n=0;n<e[0].length;n++)r[n]=t(e[s][n])?r[n]+1:0;let a=function(e){let t=[],r=0,n={area:0,height:0,start:0,end:0},i=0;for(;i<e.length;)if(0===t.length||e[i]>=e[t[t.length-1]])t.push(i++);else{let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}for(;t.length>0;){let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}return n}(r);a.area>n&&(n=a.area,i={startColumn:a.start,startRow:s-a.height+1,endColumn:a.end,endRow:s})}return i}(r,t);if(!e)break;n.push(e),function(e,t){c2.foreach(t,(t,r)=>{e[t][r]=void 0})}(r,e)}return n}class hf{constructor(e,t){tg(this,"_values",[]),tg(this,"_keys",[]),tg(this,"_keyMaps",new Map),this._values=e,this._keys=t,e.forEach(e=>{this._initKeyMap(e)})}_initKeyMap(e){this._keys.forEach(t=>{let r=e[t],n=this._keyMaps.get(t)||new Map;n.set(r,e),this._keyMaps.set(t,n)})}getValue(e,t){let r=t||this._keys;for(let t=0;t<r.length;t++){let n=this._keyMaps.get(r[t]);if(null!=n&&n.has(e))return n.get(e)}return null}hasValue(e){for(let t=0;t<this._keys.length;t++){let r=this._keyMaps.get(this._keys[t]);if(null!=r&&r.has(e))return!0}return!1}addValue(e){this._values.push(e),this._initKeyMap(e)}setValue(e,t,r){let n=this.getValue(e);n&&Object.keys(n).includes(t)&&(n[t]=r)}deleteValue(e,t){let r=this.getValue(e,t);if(r){this._keys.forEach(e=>{let t=this._keyMaps.get(e),n=r[e];null==t||t.delete(n)});let e=this._values.findIndex(e=>e===r);this._values.splice(e,1)}}getValues(){return this._values}getKeyMap(e){var t;return[...(null==(t=this._keyMaps.get(e))?void 0:t.keys())||[]]}clear(){this._values=[],this._keys=[],this._keyMaps.clear()}}function hp(e,t,r,n){return{forEach(i){for(let s=e;s<=t;s++)for(let e=r;e<=n;e++)i(s,e)}}}function hC(e){if(null==e||0===e.length)return NaN;let t=e.toLowerCase().split(""),r=t.length,n=e=>e.charCodeAt(0)-96,i=0;for(let e=0;e<r;e++)i+=n(t[e])*26**(r-e-1);return 0===i?NaN:i-1}function h_(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}function hy(e,t){let r="";for(;t>0;)r+=e,t--;return r}function hR(e,t=!1){let r=97;return t&&(r=65),hy(String.fromCharCode(e%26+r),Math.floor(e/26)+1)}function hE(e,t){return e.zIndex>t.zIndex?1:e.zIndex===t.zIndex?0:-1}function hb(e,t){return e.zIndex>t.zIndex?-1:+(e.zIndex!==t.zIndex)}function hI(e="index",t=1){return(r,n)=>r[e]>n[e]?t:r[e]===n[e]?0:-t}function hN(e,t=!1){let r=[];for(let n of e){let{st:e,ed:i,ts:s}=n;if(void 0===n.sId&&delete n.sId,e===i||!t&&ir.isEmptyObject(s)&&null==n.sId)continue;if(0===r.length){r.push(n);continue}let a=r.pop();ob(n,a)&&ir.hasIntersectionBetweenTwoRanges(a.st,a.ed,n.st,n.ed)?r.push({...n,st:a.st,ed:i}):r.push(a,n)}return r}function hS(e,t,r,n){var i;let{textRuns:s}=e;if(null==s)return;let a=[],o=s.length,l=!1,u=null!=(i=t.textRuns)?i:[];if(u.length)for(let e of u)e.st+=n,e.ed+=n;for(let e=0;e<o;e++){let t=s[e],{st:i,ed:o}=t;if(o<=n)a.push(t);else if(n>i&&n<o){l=!0;let e={...t,ed:n};a.push(e),u.length&&a.push(...u);let i={...t,st:n+r,ed:o+r};a.push(i)}else t.st+=r,t.ed+=r,l||(l=!0,a.push(...u)),a.push(t)}l||(l=!0,a.push(...u)),e.textRuns=hN(a)}function hA(e,t,r,n){let{paragraphs:i}=e;if(null==i)return;let{paragraphs:s}=t,a=[];for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r),a.push(t.startIndex)}let o=-1;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n;let r=t.startIndex;o=a.indexOf(r)}-1!==o&&i.splice(o,1),i.push(...s),i.sort(hI("startIndex"))}}function hv(e,t,r,n){let{sectionBreaks:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.sectionBreaks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(hI("startIndex"))}}function hT(e,t,r,n){let{customBlocks:i=[]}=e;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.customBlocks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(hI("startIndex"))}i.length&&!e.customBlocks&&(e.customBlocks=i)}function hw(e,t,r,n){let{tables:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s,endIndex:a}=t;s>n?(t.startIndex+=r,t.endIndex+=r):a>n&&(t.endIndex+=r)}let s=t.tables;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n,t.endIndex+=n}i.push(...s),i.sort(hI("startIndex"))}}let hM=e=>e.split("$")[0];function hO(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};r.rangeId=hM(r.rangeId);for(let n=1;n<e.length;n++){let i=e[n];i.rangeId=hM(i.rangeId),i.rangeId===r.rangeId&&tP(r.properties,i.properties)&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}t.push(r);let n=Object.create(null);for(let e=0,r=t.length;e<r;e++){let r=t[e],i=r.rangeId;n[i]?(r.rangeId=`${i}$${n[i]}`,n[i]=n[i]+1):n[i]=1}return t}function hx(e,t){let r=e.findIndex(e=>e.startIndex<t&&e.endIndex>=t),n=e[r];n&&e.splice(r,1,{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:n.startIndex,endIndex:t-1,properties:{...n.properties}},{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:t,endIndex:n.endIndex,properties:{...n.properties}})}function hU(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};for(let n=1;n<e.length;n++){let i=e[n];i.id===r.id&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}return t.push(r),t}function hD(e,t){e.filter(e=>e.startIndex<t&&e.endIndex>=t).forEach(r=>{let n=e.indexOf(r);e.splice(n,1,{id:r.id,type:r.type,startIndex:r.startIndex,endIndex:t-1},{id:r.id,type:r.type,startIndex:t,endIndex:r.endIndex})})}function hV(e,t,r){let{textRuns:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{st:l,ed:u}=o;if(r<=l&&i>=u){s.push({...o,st:l-r,ed:u-r});continue}l<=r&&u>=i?(s.push({...o,st:r-r,ed:i-r}),o.ed-=t):r>=l&&r<u?(s.push({...o,st:r-r,ed:u-r}),o.ed=r):i>l&&i<=u?(s.push({...o,st:l-r,ed:i-r}),o.st=i-t,o.ed-=t):l>=i&&(o.st-=t,o.ed-=t),a.push(o)}e.textRuns=a}return 0===s.length&&s.push({st:0,ed:t,ts:{}}),s}function hL(e,t,r){let{paragraphs:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<i){s.push({...o,startIndex:l-r});continue}l>=i&&(o.startIndex-=t),a.push(o)}e.paragraphs=a}return s}function hP(e,t,r){let{sectionBreaks:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.sectionBreaks=a}return s}function hk(e,t,r){let{customBlocks:n=[]}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.customBlocks=a}return n.length&&!e.customBlocks&&(e.customBlocks=n),s}function hF(e,t,r){let{tables:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(r<=l&&i>=u){s.push({...o,startIndex:l-r,endIndex:u-r});continue}if(l<=r&&u>=i){let e=lV(l,u,r,i);if(0===e.length||(o.startIndex=e[0],o.endIndex=e[1],o.startIndex===o.endIndex))continue}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.tables=a}return s}var hj=((eL=hj||{}).ORDER_LIST_QUICK_1="1.",eL.ORDER_LIST_QUICK_2="a)",eL.ORDER_LIST_QUICK_3="a.",eL.ORDER_LIST_QUICK_4="i.",eL.ORDER_LIST_QUICK_5="A.",eL.ORDER_LIST_QUICK_6="I.",eL.ORDER_LIST_QUICK_7="01.",eL.BULLET_LIST="*",eL),hB=((eP=hB||{}).BULLET_LIST="BULLET_LIST",eP.BULLET_LIST_1="BULLET_LIST_1",eP.BULLET_LIST_2="BULLET_LIST_2",eP.BULLET_LIST_3="BULLET_LIST_3",eP.BULLET_LIST_4="BULLET_LIST_4",eP.BULLET_LIST_5="BULLET_LIST_5",eP.ORDER_LIST="ORDER_LIST",eP.ORDER_LIST_1="ORDER_LIST_1",eP.ORDER_LIST_2="ORDER_LIST_2",eP.ORDER_LIST_3="ORDER_LIST_3",eP.ORDER_LIST_4="ORDER_LIST_4",eP.ORDER_LIST_5="ORDER_LIST_5",eP.ORDER_LIST_QUICK_2="ORDER_LIST_QUICK_2",eP.ORDER_LIST_QUICK_3="ORDER_LIST_QUICK_3",eP.ORDER_LIST_QUICK_4="ORDER_LIST_QUICK_4",eP.ORDER_LIST_QUICK_5="ORDER_LIST_QUICK_5",eP.ORDER_LIST_QUICK_6="ORDER_LIST_QUICK_6",eP.CHECK_LIST="CHECK_LIST",eP.CHECK_LIST_CHECKED="CHECK_LIST_CHECKED",eP);let h$={"a)":{glyphFormat:"%1)",glyphType:iH.DECIMAL},"1.":{glyphType:iH.DECIMAL},"a.":{glyphFormat:"%1.",glyphType:iH.LOWER_LETTER},"A.":{glyphType:iH.UPPER_LETTER},"i.":{glyphFormat:"%1.",glyphType:iH.LOWER_ROMAN},"I.":{glyphFormat:"%1.",glyphType:iH.UPPER_LETTER}},hH=e=>[...e,...e,...e].map((e,t)=>({glyphFormat:` %${t+1}`,glyphSymbol:e,bulletAlignment:iW.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),hW=e=>e.map((e,t)=>({...e,bulletAlignment:iW.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),hG=(e,t)=>Array(9).fill(0).map((r,n)=>({glyphFormat:` %${n+1}`,glyphSymbol:e,bulletAlignment:iW.START,textStyle:{fs:16},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*n},textStyle:t}})),hY={BULLET_LIST:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},BULLET_LIST_1:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},BULLET_LIST_2:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},BULLET_LIST_3:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},BULLET_LIST_4:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},BULLET_LIST_5:{listType:"BULLET_LIST",nestingLevel:hH(["","",""])},ORDER_LIST:{listType:"ORDER_LIST",nestingLevel:hW([{glyphFormat:"%1.",glyphType:iH.DECIMAL},{glyphFormat:"%2.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%3.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:iH.DECIMAL},{glyphFormat:"%5.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%6.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:iH.DECIMAL},{glyphFormat:"%8.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%9.",glyphType:iH.LOWER_ROMAN}])},ORDER_LIST_1:{listType:"ORDER_LIST",nestingLevel:hW([{glyphFormat:"%1)",glyphType:iH.DECIMAL},{glyphFormat:"%2)",glyphType:iH.LOWER_LETTER},{glyphFormat:"%3)",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%4)",glyphType:iH.DECIMAL},{glyphFormat:"%5)",glyphType:iH.LOWER_LETTER},{glyphFormat:"%6)",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%7)",glyphType:iH.DECIMAL},{glyphFormat:"%8)",glyphType:iH.LOWER_LETTER},{glyphFormat:"%9)",glyphType:iH.LOWER_ROMAN}])},ORDER_LIST_2:{listType:"ORDER_LIST",nestingLevel:hW(["%1.","%1.%2.","%1.%2.%3.","%1.%2.%3.%4.","%1.%2.%3.%4.%5.","%1.%2.%3.%4.%5.%6.","%1.%2.%3.%4.%5.%6.%7."].map(e=>({glyphFormat:e,glyphType:iH.DECIMAL})))},ORDER_LIST_3:{listType:"ORDER_LIST",nestingLevel:hW([{glyphFormat:"%1.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%2.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%3.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%5.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%6.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%8.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%9.",glyphType:iH.LOWER_ROMAN}])},ORDER_LIST_4:{listType:"ORDER_LIST",nestingLevel:hW([{glyphFormat:"%1.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%2.",glyphType:iH.DECIMAL},{glyphFormat:"%3.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%5.",glyphType:iH.DECIMAL},{glyphFormat:"%6.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:iH.UPPER_LETTER},{glyphFormat:"%8.",glyphType:iH.DECIMAL},{glyphFormat:"%9.",glyphType:iH.LOWER_ROMAN}])},ORDER_LIST_5:{listType:"ORDER_LIST",nestingLevel:hW([{glyphFormat:"%1.",glyphType:iH.DECIMAL_ZERO},{glyphFormat:"%2.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%3.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:iH.DECIMAL_ZERO},{glyphFormat:"%5.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%6.",glyphType:iH.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:iH.DECIMAL_ZERO},{glyphFormat:"%8.",glyphType:iH.LOWER_LETTER},{glyphFormat:"%9.",glyphType:iH.LOWER_ROMAN}])},CHECK_LIST:{listType:"CHECK_LIST",nestingLevel:hG("")},CHECK_LIST_CHECKED:{listType:"CHECK_LIST_CHECKED",nestingLevel:hG("",{st:{s:iP.TRUE}})}},hz=e=>{let{glyphFormat:t,glyphType:r}=e,n=ir.deepClone(hY.ORDER_LIST);return n.nestingLevel[0].glyphFormat=t,n.nestingLevel[0].glyphType=r,n};Object.assign(hY,{ORDER_LIST_QUICK_2:hz(h$["a)"]),ORDER_LIST_QUICK_3:hz(h$["a."]),ORDER_LIST_QUICK_4:hz(h$["i."]),ORDER_LIST_QUICK_6:hz(h$["I."])});let hX={"1.":"ORDER_LIST","a)":"ORDER_LIST_QUICK_2","a.":"ORDER_LIST_QUICK_3","i.":"ORDER_LIST_QUICK_4","A.":"ORDER_LIST_3","I.":"ORDER_LIST_QUICK_6","01.":"ORDER_LIST_5","*":"BULLET_LIST"};function hq(e,t,r){if(0===t.length)return e;e=ir.deepClone(e),t=ir.deepClone(t);let n=[],i=e.length,s=t.length,a=0,o=0,l=null;function u(){return!!l&&(n.push(l),l=null,!0)}for(;a<i&&o<s;){let i,{st:s,ed:c,ts:h}=e[a],{st:d,ed:m,ts:g,sId:f}=t[o];if(i=r===sZ.COVER?{...g,...h}:{...h},c<d)u()||n.push(e[a]),a++;else if(m<s)u()||n.push(t[o]),o++;else{let r={st:Math.min(s,d),ed:Math.max(s,d),ts:s<d?{...h}:{...g},sId:s<d?void 0:f};r.ed>r.st&&n.push(r),n.push({st:Math.max(s,d),ed:Math.min(c,m),ts:i,sId:f}),c<m?(a++,t[o].st=c,t[o].st===t[o].ed&&o++):(o++,e[a].st=m,e[a].st===e[a].ed&&a++);let u={st:Math.min(c,m),ed:Math.max(c,m),ts:c<m?{...g}:{...h},sId:c<m?f:void 0};l=u.ed>u.st?u:null}}u();let c=n[n.length-1],h=e[i-1],d=t[s-1];return c&&c.ed!==Math.max(h.ed,d.ed)&&(h.ed>d.ed?n.push(h):n.push(d)),hN(n)}var hK=((ek=hK||{})[ek.copy=0]="copy",ek[ek.cut=1]="cut",ek);function hQ(e,t,r,n=!0){let{textRuns:i}=e;if(i){let e=[];for(let n of i){let i=ir.deepClone(n),{st:s,ed:a}=i;ir.hasIntersectionBetweenTwoRanges(s,a,t,r)&&(t>=s&&t<=a?e.push({...i,st:t,ed:Math.min(r,a)}):r>=s&&r<=a?e.push({...i,st:Math.max(t,s),ed:r}):e.push(i))}return hN(e.map(e=>{let{st:r,ed:n}=e;return{...e,st:r-t,ed:n-t}}))}if(n)return[{st:0,ed:r-t,ts:{}}]}function hZ(e,t,r){let{tables:n=[]}=e,i=[];for(let e of n){let n=ir.deepClone(e),{startIndex:s,endIndex:a}=n;s>=t&&a<=r&&i.push({...n,startIndex:s-t,endIndex:a-t})}return i}function hJ(e,t,r){let{paragraphs:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;if(n>=t&&n<r){let t=ir.deepClone(e);i.push(t)}}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function h0(e,t,r){let{sectionBreaks:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;n>=t&&n<=r&&i.push(ir.deepClone(e))}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function h1(e,t,r){let{customBlocks:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;n>=t&&n<r&&i.push(ir.deepClone(e))}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function h2(e,t,r,n=!0,i=1){let{dataStream:s}=e,a={dataStream:s.slice(t,r)};a.textRuns=hQ(e,t,r,n);let o=hZ(e,t,r);if(o.length&&(a.tables=o),a.paragraphs=hJ(e,t,r),1===i){let i=h4(e,t,r);i?a.customDecorations=i:n&&(a.customDecorations=[])}let{customRanges:l}=h3(e,t,r);return l?a.customRanges=l:n&&(a.customRanges=[]),a.customBlocks=h1(e,t,r),a}function h5(e){let{dataStream:t,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}=e,o=0,l=0;null==i||i.forEach(e=>{e.startIndex<0&&(o=Math.max(o,-e.startIndex)),e.endIndex>t.length-1&&(l=Math.max(l,e.endIndex-t.length+1))});let u=`${t}`;return r&&(r[0]&&(r[0].st=r[0].st-o),r[r.length-1]&&(r[r.length-1].ed=r[r.length-1].ed+l)),null==r||r.forEach(e=>{e.st+=o,e.ed+=o}),null==n||n.forEach(e=>{e.startIndex+=o}),null==i||i.forEach(e=>{e.startIndex+=o,e.endIndex+=o}),null==s||s.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),null==a||a.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),{...e,dataStream:u,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}}function h3(e,t,r){if(null==e.customRanges)return{};let{customRanges:n}=e;return{customRanges:n.filter(e=>Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)).map(e=>({...e,startIndex:Math.max(e.startIndex,t),endIndex:Math.min(e.endIndex,r-1)})).map(e=>({...e,startIndex:e.startIndex-t,endIndex:e.endIndex-t})),leftOffset:0,rightOffset:0}}function h4(e,t,r){if(null==e.customDecorations)return;let{customDecorations:n=[]}=e,i=[];return n.forEach(e=>{if(Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)){let n=ir.deepClone(e);i.push({...n,startIndex:Math.max(n.startIndex-t,0),endIndex:Math.min(n.endIndex,r-1)-t})}}),i}function h6(e,t,r=sZ.COVER){if(""!==t.dataStream)throw Error("Cannot compose other body with non-empty dataStream");let n={dataStream:e.dataStream},{textRuns:i,paragraphs:s=[],customRanges:a,customDecorations:o=[]}=e,{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h=[]}=t;n.textRuns=null==l||null==i?null!=l?l:i:hq(l,i,r),n.customRanges=function(e,t,r){if(null==e||null==t)return null!=e?e:t;if(0===t.length||0===e.length)return e;if(t.length>1||e.length>1)throw Error("Cannot cover multiple customRanges");return r===sZ.REPLACE?[{...e[0]}]:[{...t[0],...e[0]}]}(c,a,r);let d=0===o.length||0===h.length||r===sZ.REPLACE?h:[...h,...o.filter(e=>!h.some(t=>e.id===t.id))];d.length&&(n.customDecorations=d);let m=[],g=0,f=0;for(;g<s.length&&f<u.length;){let e=s[g],t=u[f],{startIndex:r}=e,{startIndex:n}=t;r===n?(m.push(ir.deepMerge(e,t)),g++,f++):r<n?(m.push(ir.deepClone(e)),g++):(m.push(ir.deepClone(t)),f++)}return g<s.length&&m.push(...s.slice(g)),f<u.length&&m.push(...u.slice(f)),m.length&&(n.paragraphs=m),n}class h9{constructor(e){tg(this,"_index",0),tg(this,"_offset",0),this._actions=e}hasNext(){return this.peekLength()<1/0}next(e){e||(e=1/0);let t=this._actions[this._index];if(!t)return{t:sJ.RETAIN,len:1/0};{let r=this._offset,n=t.len;return e>=n-r?(e=n-r,this._index+=1,this._offset=0):this._offset+=e,t.t===sJ.DELETE||t.t===sJ.RETAIN&&null==t.body?ir.deepClone({...t,len:e}):ir.deepClone({...t,len:e,body:h2(t.body,r,r+e,!1)})}}peek(){return this._actions[this._index]}peekLength(){return this._actions[this._index]?this._actions[this._index].len-this._offset:1/0}peekType(){let e=this._actions[this._index];return e?e.t:sJ.RETAIN}rest(){if(!this.hasNext())return[];if(0===this._offset)return this._actions.slice(this._index);{let e=this._offset,t=this._index,r=this.next(),n=this._actions.slice(this._index);return this._offset=e,this._index=t,[r].concat(n)}}}function h8(e,t,r){let{dataStream:n}=e,i=r+t,s=hV(e,t,r),a=hL(e,t,r),o=hP(e,t,r),l=hk(e,t,r),u=hF(e,t,r),c=function(e,t,r){let{customRanges:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(l>=r&&u<=i){s.push(o);continue}if(Math.max(r,l)<=Math.min(i,u)){let e=lV(l,u,r,i);if(0===e.length)continue;o.startIndex=e[0],o.endIndex=e[1]}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.customRanges=hO(a)}return s}(e,t,r),h=function(e,t,r,n=!0){let{customDecorations:i}=e,s=r+t-1,a=[];if(i){let o=[];for(let e=0,l=i.length;e<l;e++){let l=i[e],{startIndex:u,endIndex:c}=l;if(u>=r&&c<=s){a.push(l);continue}if(Math.max(r,u)<=Math.min(s,c)){let e=lV(u,c,r,s);if(0===e.length)continue;l.startIndex=e[0],l.endIndex=e[1]}else s<u&&n&&(l.startIndex-=t,l.endIndex-=t);o.push(l)}e.customDecorations=o}return a}(e,t,r),d="";return n&&(e.dataStream=lj(n,r,i),d=n.slice(r,i)),{dataStream:d,textRuns:s,paragraphs:a,sectionBreaks:o,customBlocks:l,tables:u,customRanges:c,customDecorations:h}}function h7(e,t,r,n){e.dataStream=lF(e.dataStream,n,t.dataStream),hS(e,t,r,n),hA(e,t,r,n),hv(e,t,r,n),hT(e,t,r,n),hw(e,t,r,n),function(e,t,r,n){e.customRanges||(e.customRanges=[]);let{customRanges:i}=e;hx(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customRanges){for(let e=0,r=t.customRanges.length;e<r;e++){let r=t.customRanges[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customRanges=hO(i)}(e,t,r,n),function(e,t,r,n){e.customDecorations||(e.customDecorations=[]);let{customDecorations:i}=e;hD(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customDecorations){for(let e=0,r=t.customDecorations.length;e<r;e++){let r=t.customDecorations[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customDecorations=hU(i)}(e,t,r,n)}function de(e,t,r,n,i){let s={startIndex:t.startIndex};if(t.paragraphStyle&&(s.paragraphStyle=ir.deepClone(t.paragraphStyle),e.paragraphStyle)){if(r===sZ.REPLACE)if(n===sZ.REPLACE)1===i&&(s.paragraphStyle={...e.paragraphStyle});else if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else if(n===sZ.REPLACE)if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else if(1===i)for(let t of Object.keys(e.paragraphStyle))s.paragraphStyle[t]&&delete s.paragraphStyle[t]}return r===sZ.REPLACE&&n===sZ.REPLACE?s.bullet=1===i?ir.deepClone(e.bullet):ir.deepClone(t.bullet):void 0===e.bullet?s.bullet=ir.deepClone(t.bullet):r===sZ.REPLACE||n===sZ.REPLACE?s.bullet=0===i&&t.bullet?ir.deepClone(t.bullet):ir.deepClone(e.bullet):0===i&&void 0!==t.bullet&&(s.bullet=ir.deepClone(t.bullet)),s}function dt(e){return 1===Object.keys(e).length}let dr=class e{constructor(){tg(this,"_actions",[])}static apply(e,t){let r=new nF;return r.reset(),t.forEach(t=>{var n,i;let s=ir.deepClone(t);switch(s.t){case sJ.RETAIN:{let{coverType:t,body:n,len:i}=s;null!=n&&function(e,t,r,n,i=sZ.COVER){var s,a,o,l,u;(function(e,t,r,n,i){let{textRuns:s}=e,{textRuns:a}=t;if(null==s||null==a)return;let o=hV(e,r,n);i!==sZ.REPLACE&&(t.textRuns=hq(a,o,i)),hS(e,t,r,n)})(s=e,a=t,o=r,l=n,u=i),function(e,t,r,n,i){let{paragraphs:s}=e,{paragraphs:a}=t;if(null==s||null==a)return;let o=hL(e,r,n);if(i!==sZ.REPLACE){let e=[];for(let t of a){let{startIndex:r,paragraphStyle:n,bullet:s}=t,a=[];for(let e of o){let t,o,{startIndex:l,paragraphStyle:u,bullet:c}=e;if(i===sZ.COVER?(t={...u,...n},o={listId:"",listType:hB.BULLET_LIST,nestingLevel:0,textStyle:{},...c,...s}):(t={...n,...u},o={listId:"",listType:hB.BULLET_LIST,nestingLevel:0,textStyle:{},...s,...c}),r===l){a.push({startIndex:r,paragraphStyle:t,bullet:o});break}}e.push(...a),a=[]}t.paragraphs=e}hA(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){let{sectionBreaks:s}=e,{sectionBreaks:a}=t;if(null==s||null==a)return;let o=hP(e,r,n);if(i!==sZ.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===sZ.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.sectionBreaks=e}hv(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){let{customBlocks:s=[]}=e,{customBlocks:a}=t;if(null==s||null==a)return;let o=hk(e,r,n);if(i!==sZ.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===sZ.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.customBlocks=e}hT(e,t,r,n),s.length&&!e.customBlocks&&(e.customBlocks=s)}(s,a,o,l,u),function(e,t,r,n,i){let{tables:s}=e,{tables:a}=t;if(null==s||null==a)return;let o=hF(e,r,n);if(i!==sZ.REPLACE){let e=[];for(let t of a){let{startIndex:r,endIndex:n}=t,s=[];for(let e of o){let{startIndex:a,endIndex:o}=e;if(a>=r&&o<=n){i===sZ.COVER?s.push({...e,...t}):s.push({...t,...e});break}}e.push(...s),s=[]}t.tables=e}hw(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){e.customRanges||(e.customRanges=[]),hx(e.customRanges,n),hx(e.customRanges,n+r);let s=n+r-1,{customRanges:a}=t,o=[],l=new Map;e.customRanges.forEach(e=>{let{startIndex:t,endIndex:r}=e;t>=n&&r<=s?l.set(e.rangeId,e):o.push(e)}),a&&(a.forEach(e=>{let{startIndex:t,endIndex:r}=e;o.push({...e,startIndex:t+n,endIndex:r+n})}),e.customRanges=hO(o))}(s,a,o,l),function(e,t,r,n,i){e.customDecorations||(e.customDecorations=[]),hD(e.customDecorations,n),hD(e.customDecorations,n+r);let s=[],{customDecorations:a}=e,{customDecorations:o=[]}=t;if(i===sZ.REPLACE){for(let e=0;e<a.length;e++){let t=a[e],{startIndex:i,endIndex:o}=t;i>=n&&o<=n+r-1&&s.push(t)}o.forEach(e=>{let{startIndex:t,endIndex:r}=e;a.push({...e,startIndex:t+n,endIndex:r+n})})}else for(let e of o){let{id:t}=e;if(e.type===iY.DELETED){let e=a.filter(e=>e.id===t);e.length&&s.push(...e)}else a.push({...e,startIndex:e.startIndex+n,endIndex:e.endIndex+n})}for(let e of s){let{id:t}=e,r=a.findIndex(e=>e.id===t);-1!==r&&a.splice(r,1)}e.customDecorations=hU(a)}(s,a,o,l,u)}(e,n,i,r.cursor,t),r.moveCursor(i);break}case sJ.INSERT:{let{body:t,len:i}=s;n=r.cursor,0!==i&&h7(e,t,i,n),r.moveCursor(i);break}case sJ.DELETE:{let{len:t}=s;i=r.cursor,t<=0||h8(e,t,i);break}default:throw Error(`Unknown action type for action: ${s}.`)}}),e}static compose(t,r){let n=new h9(t),i=new h9(r),s=new e;for(;n.hasNext()||i.hasNext();)if(i.peekType()===sJ.INSERT)s.push(i.next());else if(n.peekType()===sJ.DELETE)s.push(n.next());else{let e=Math.min(n.peekLength(),i.peekLength()),t=n.next(e),r=i.next(e);if(t.t===sJ.INSERT&&r.t===sJ.RETAIN)null==r.body?s.push(t):s.push({...t,body:h6(t.body,r.body,r.coverType)});else if(t.t===sJ.RETAIN&&r.t===sJ.RETAIN)if(null==t.body&&null==r.body)s.push(t.len!==1/0?t:r);else if(t.body&&r.body){let e=t.coverType===sZ.REPLACE||r.coverType===sZ.REPLACE?sZ.REPLACE:sZ.COVER;s.push({...t,t:sJ.RETAIN,coverType:e,body:h6(t.body,r.body,r.coverType)})}else s.push(t.body?t:r);else t.t===sJ.RETAIN&&r.t===sJ.DELETE?s.push(r):t.t===sJ.INSERT&&(r.t,sJ.DELETE)}return s.trimEndUselessRetainAction(),s.serialize()}static transform(e,t,r="right"){return this._transform(t,e,"left"===r?"right":"left")}static _transform(t,r,n="right"){let i=new h9(t),s=new h9(r),a=new e;for(;i.hasNext()||s.hasNext();)if(i.peekType()===sJ.INSERT&&("left"===n||s.peekType()!==sJ.INSERT)){let e=i.next();a.retain(e.len)}else if(s.peekType()===sJ.INSERT)a.push(s.next());else{let e=Math.min(i.peekLength(),s.peekLength()),t=i.next(e),r=s.next(e);if(t.t===sJ.DELETE)continue;if(r.t===sJ.DELETE){a.push(r);continue}if(null==t.body||null==r.body)a.push(r);else{let{coverType:e,body:i}=function(e,t,r=!1){let{body:n,coverType:i=sZ.COVER}=e,{body:s,coverType:a=sZ.COVER}=t;if(null==n||""!==n.dataStream||null==s||""!==s.dataStream)throw Error("Data stream is not supported in retain transform.");let o={dataStream:""},{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h}=n,{textRuns:d,paragraphs:m=[],customRanges:g,customDecorations:f}=s,p=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];t=ir.deepClone(t),e=ir.deepClone(e);let s=[],a=t.length,o=e.length,l=0,u=0,c=null;function h(){return!!c&&(s.push(c),c=null,!0)}for(;l<a&&u<o;){let{st:a,ed:o,ts:d}=t[l],{st:m,ed:g,ts:f,sId:p}=e[u],C={};if(0===i)C={...d},r===sZ.COVER&&n===sZ.REPLACE&&f&&(C=Object.assign({},f,C));else if(C={...d},r===sZ.REPLACE){if(n===sZ.REPLACE)C={...f};else if(d&&f)for(let e of Object.keys(d))f[e]&&delete C[e]}else if(n===sZ.REPLACE){if(f)for(let e of Object.keys(f))void 0!==f[e]&&(C[e]=f[e])}else if(f)for(let e of Object.keys(f))void 0!==C[e]&&delete C[e];if(o<m)h()||s.push(t[l]),l++;else if(g<a)h()||s.push(e[u]),u++;else{let r={st:Math.min(a,m),ed:Math.max(a,m),ts:a<m?{...d}:{...f}};r.ed>r.st&&s.push(),s.push({st:Math.max(a,m),ed:Math.min(o,g),ts:C,sId:p}),o<g?(l++,e[u].st=o,e[u].st===e[u].ed&&u++):(u++,t[l].st=g,t[l].st===t[l].ed&&l++);let n={st:Math.min(o,g),ed:Math.max(o,g),ts:o<g?{...f}:{...d},sId:o<g?p:void 0};c=n.ed>n.st?n:null}}h();let d=s[s.length-1],m=t[a-1],g=e[o-1];return d.ed!==Math.max(m.ed,g.ed)&&(m.ed>g.ed?s.push(m):s.push(g)),hN(s,!0)}(l,d,i,a,+!!r);p&&(o.textRuns=p);let C=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];if(e.length>1||t.length>1)throw Error("CustomRanges is only supported transform for length one now.");let s=e[0],a=t[0];if(r===sZ.REPLACE)return 1===i?[ir.deepClone(s)]:[ir.deepClone(a)];if(n===sZ.REPLACE){let e=ir.deepClone(a);return 1===i&&Object.assign(e,ir.deepClone(s)),[e]}{let e=ir.deepClone(a);return 1===i&&Object.assign(e,ir.deepClone(s)),[e]}}(c,g,i,a,+!!r);C&&(o.customRanges=C);let _=function(e,t){if(null==e||null==t)return t;if(0===e.length||0===t.length)return ir.deepClone(t);let r=[];for(let n of t){let{id:t,type:i}=n,s=!1;for(let a of e)if(a.id===t){(a.type===iY.DELETED||i===iY.DELETED)&&(s=!0,r.push({...n,type:iY.DELETED}));break}s||r.push(n)}return r}(h,f);_&&(o.customDecorations=_);let y=[],R=0,E=0;for(;R<u.length&&E<m.length;){let e=u[R],t=m[E],{startIndex:n}=e,{startIndex:s}=t;if(n===s){let s={startIndex:n};s=r?de(e,t,i,a,1):de(e,t,i,a,0),y.push(s),R++,E++}else n<s?R++:(y.push(ir.deepClone(t)),E++)}return E<m.length&&y.push(...m.slice(E)),y.length&&(o.paragraphs=y),{coverType:a,body:o}}(t,r,"left"===n);a.push({...r,t:sJ.RETAIN,coverType:e,body:i})}}return a.trimEndUselessRetainAction(),a.serialize()}static transformPosition(e,t,r=!1){let n=new h9(e),i=0;for(;n.hasNext()&&i<=t;){let e=n.peekLength(),s=n.peekType();if(n.next(),s===sJ.DELETE){t-=Math.min(e,t-i);continue}s===sJ.INSERT&&(i<t||!r)&&(t+=e),i+=e}return t}static isNoop(e){return 0===e.length}static invert(e){let t=[];for(let r of e)if(r.t===sJ.INSERT)t.push({t:sJ.DELETE,len:r.len,body:r.body});else if(r.t===sJ.DELETE){if(null==r.body)throw Error("Can not invert DELETE action without body property, makeInvertible must be called first.");t.push({t:sJ.INSERT,body:r.body,len:r.len})}else if(null!=r.body){if(null==r.oldBody)throw Error("Can not invert RETAIN action without oldBody property, makeInvertible must be called first.");t.push({t:sJ.RETAIN,body:r.oldBody,oldBody:r.body,len:r.len,coverType:sZ.REPLACE})}else t.push(r);return t}static makeInvertible(e,t){let r=[],n=0;for(let i of e){if(i.t===sJ.DELETE&&(null==i.body||i.body&&i.body.dataStream.length!==i.len)){let e=h2(t,n,n+i.len,!1);i.len=e.dataStream.length,i.body=e}if(i.t===sJ.RETAIN&&null!=i.body){let e=h2(t,n,n+i.len,!0);i.oldBody={...e,dataStream:""},i.len=e.dataStream.length}r.push(i),i.t!==sJ.INSERT&&(n+=i.len)}return r}insert(e,t){let r={t:sJ.INSERT,body:t,len:e};return this.push(r),this}retain(e,t,r){let n={t:sJ.RETAIN,len:e};return null!=t&&(n.body=t),null!=r&&(n.coverType=r),this.push(n),this}delete(e){let t={t:sJ.DELETE,len:e};return this.push(t),this}empty(){return this._actions=[],this}serialize(){return this._actions}push(...e){if(e.length>1){for(let t of e)this.push(t);return this}let t=this._actions.length,r=this._actions[t-1],n=ir.deepClone(e[0]);if(n.t===sJ.RETAIN&&0===n.len&&null==n.body)return this;if("object"==typeof r){if(r.t===sJ.DELETE&&n.t===sJ.DELETE)return r.len+=n.len,this;if(r.t===sJ.DELETE&&n.t===sJ.INSERT&&(t-=1,null==(r=this._actions[t-1])))return this._actions.unshift(n),this;if(r.t===sJ.RETAIN&&n.t===sJ.RETAIN&&null==r.body&&null==n.body)return r.len+=n.len,this;if(r.t===sJ.INSERT&&dt(r.body)&&n.t===sJ.INSERT&&dt(n.body))return r.len+=n.len,r.body.dataStream+=n.body.dataStream,this}return t===this._actions.length?this._actions.push(n):this._actions.splice(t,0,n),this}trimEndUselessRetainAction(){let e=this._actions[this._actions.length-1];for(;e&&e.t===sJ.RETAIN&&function(e){let{body:t}=e;if(null==t)return!0;let{textRuns:r,paragraphs:n,customRanges:i,customBlocks:s,customDecorations:a,tables:o}=t;return null==r&&null==n&&null==i&&null==s&&null==a&&null==o}(e);)this._actions.pop(),e=this._actions[this._actions.length-1];return this}};tg(dr,"id","text-x"),tg(dr,"uri","https://github.com/dream-num/univer#text-x");let dn=dr;Object.defineProperty(dn,"name",{value:"text-x"});let di=class e{static registerSubtype(e){var t;null==e||this._subTypes.has(e.name)&&(null==(t=this._subTypes.get(e.name))?void 0:t.id)!==dn.id||(this._subTypes.set(e.name,e),sK.type.registerSubtype(e))}static apply(e,t){if(!sK.type.isNoop(t))return sK.type.apply(e,t)}static compose(e,t){return sK.type.compose(e,t)}static transform(e,t,r){return sK.type.transform(e,t,r)}static transformPosition(e,t,r="right"){return e&&2===e.length&&"body"===e[0]&&e[1].et===dn.name?dn.transformPosition(e[1].e,t,"left"===r):t}static invertWithDoc(e,t){return sK.type.invertWithDoc(e,t)}static isNoop(e){return sK.type.isNoop(e)}static getInstance(){return null==this._instance&&(this._instance=new e),this._instance}removeOp(e,t){return sK.removeOp(e,t)}moveOp(e,t){return sK.moveOp(e,t)}insertOp(e,t){return sK.insertOp(e,t)}replaceOp(e,t,r){return sK.replaceOp(e,t,r)}editOp(e,t=["body"]){return sK.editOp(t,dn.name,e)}};tg(di,"uri","https://github.com/dream-num/univer#json-x"),tg(di,"_subTypes",new Map),tg(di,"_instance",null);let ds=di;ds.registerSubtype(dn);var da=((eF=da||{}).PARAGRAPH="PARAGRAPH",eF.SECTION_BREAK="SECTION_BREAK",eF.TABLE="TABLE",eF.TABLE_ROW="TABLE_ROW",eF.TABLE_CELL="TABLE_CELL",eF.CUSTOM_BLOCK="CUSTOM_BLOCK",eF),dl=((ej=dl||{}).PARAGRAPH="\r",ej.SECTION_BREAK=`
`,ej.TABLE_START="\x1a",ej.TABLE_ROW_START="\x1b",ej.TABLE_CELL_START="\x1c",ej.TABLE_CELL_END="\x1d",ej.TABLE_ROW_END="\x0e",ej.TABLE_END="\x0f",ej.CUSTOM_RANGE_START="\x1f",ej.CUSTOM_RANGE_END="\x1e",ej.COLUMN_BREAK="\v",ej.PAGE_BREAK="\f",ej.DOCS_END="\0",ej.TAB="	",ej.CUSTOM_BLOCK="\b",ej.LETTER="",ej.SPACE=" ",ej);function du(e){return`${e}`}let dc=[dl.TABLE_START,dl.TABLE_ROW_START,dl.TABLE_CELL_START,dl.TABLE_CELL_END,dl.TABLE_ROW_END,dl.TABLE_END],dh=e=>{let t=e.endsWith(`\r
`)?e.slice(0,-2):e;return dc.reduce((e,t)=>e.replaceAll(t,""),t)},dd={id:"default_doc",documentStyle:{}};class dm extends n4{constructor(e){var t;super(),tg(this,"type",n2.UNIVER_DOC),tg(this,"_name$",new(0,e5.BehaviorSubject)("")),tg(this,"name$",this._name$.asObservable()),tg(this,"snapshot"),this.snapshot={...dd,...e},this._name$.next(null!=(t=this.snapshot.title)?t:"No Title")}getUnitId(){throw Error("Method not implemented.")}getRev(){var e;return null!=(e=this.snapshot.rev)?e:1}incrementRev(){this.snapshot.rev=this.getRev()+1}setRev(e){this.snapshot.rev=e}setName(e){this.snapshot.title=e,this._name$.next(e)}get drawings(){return this.snapshot.drawings}get documentStyle(){return this.snapshot.documentStyle}get lists(){return this.snapshot.lists}get zoomRatio(){var e;return(null==(e=this.snapshot.settings)?void 0:e.zoomRatio)||1}resetDrawing(e,t){this.snapshot.drawings=e,this.snapshot.drawingsOrder=t}getBody(){return this.snapshot.body}getSnapshot(){return this.snapshot}getBulletPresetList(){var e;let t=null!=(e=this.snapshot.lists)?e:{};return{...hY,...t}}updateDocumentId(e){this.snapshot.id=e}updateDocumentRenderConfig(e){let{documentStyle:t}=this.snapshot;null==t.renderConfig?t.renderConfig=e:t.renderConfig={...t.renderConfig,...e}}getDocumentStyle(){return this.snapshot.documentStyle}updateDocumentStyle(e){null==this.snapshot.documentStyle?this.snapshot.documentStyle=e:this.snapshot.documentStyle={...this.snapshot.documentStyle,...e}}updateDocumentDataMargin(e){let{t:t,l:r,b:n,r:i}=e,{documentStyle:s}=this.snapshot;null!=t&&(s.marginTop=t),null!=r&&(s.marginLeft=r),null!=n&&(s.marginBottom=n),null!=i&&(s.marginRight=i)}updateDocumentDataPageSize(e,t){let{documentStyle:r}=this.snapshot;if(!r.pageSize){r.pageSize={width:null!=e?e:1/0,height:null!=t?t:1/0};return}void 0!==e&&(r.pageSize.width=e),void 0!==t&&(r.pageSize.height=t)}updateDrawing(e,t){let{drawings:r}=this,{width:n,height:i,left:s,top:a}=t,o=null==r?void 0:r[e];if(!o)return;let l=o.docTransform;l.size.width=n,l.size.height=i,l.positionH.posOffset=s,l.positionV.posOffset=a}setZoomRatio(e=1){this.snapshot.settings?this.snapshot.settings.zoomRatio=e:this.snapshot.settings={zoomRatio:e}}setDisabled(e){this.snapshot.disabled=e}getDisabled(){return this.snapshot.disabled}getTitle(){return this.snapshot.title}}class dg extends dm{constructor(e){var t,r;super(ir.isEmptyObject(e)?function(e=ii(6),t=iR.EN_US,r=""){return{id:e,locale:t,title:r,tableSource:{},drawings:{},drawingsOrder:[],headers:{},footers:{},body:{dataStream:`\r
`,textRuns:[],customBlocks:[],tables:[],paragraphs:[{startIndex:0,paragraphStyle:{spaceAbove:{v:5},lineSpacing:1,spaceBelow:{v:0}}}],sectionBreaks:[{startIndex:1}]},documentStyle:{pageSize:{width:793.3333333333334,height:1122.6666666666667},documentFlavor:iX.TRADITIONAL,marginTop:50,marginBottom:50,marginRight:50,marginLeft:50,renderConfig:{zeroWidthParagraphBreak:iP.FALSE,vertexAngle:0,centerAngle:0,background:{rgb:"#ccc"}},autoHyphenation:iP.TRUE,doNotHyphenateCaps:iP.FALSE,consecutiveHyphenLimit:2,defaultHeaderId:"",defaultFooterId:"",evenPageHeaderId:"",evenPageFooterId:"",firstPageHeaderId:"",firstPageFooterId:"",evenAndOddHeaders:iP.FALSE,useFirstPageHeaderFooter:iP.FALSE,marginHeader:30,marginFooter:30},settings:{}}}():e),tg(this,"_unitId"),tg(this,"headerModelMap",new Map),tg(this,"footerModelMap",new Map),tg(this,"change$",new(0,e5.BehaviorSubject)(0)),this._unitId=null!=(t=this.snapshot.id)?t:ii(6),this._initializeHeaderFooterModel(),this._name$.next(null!=(r=this.snapshot.title)?r:"")}dispose(){super.dispose(),this.headerModelMap.forEach(e=>{e.dispose()}),this.footerModelMap.forEach(e=>{e.dispose()}),this._name$.complete()}getDrawings(){return this.snapshot.drawings}getDrawingsOrder(){return this.snapshot.drawingsOrder}getCustomRanges(){var e;return null==(e=this.snapshot.body)?void 0:e.customRanges}getCustomDecorations(){var e;return null==(e=this.snapshot.body)?void 0:e.customDecorations}getSettings(){return this.snapshot.settings}reset(e){if(e.id&&e.id!==this._unitId)throw Error("Cannot reset a document model with a different unit id!");this.snapshot={...dd,...e},this._initializeHeaderFooterModel(),this.change$.next(this.change$.value+1)}getSelfOrHeaderFooterModel(e){if(null!=e){if(this.headerModelMap.has(e))return this.headerModelMap.get(e);if(this.footerModelMap.has(e))return this.footerModelMap.get(e)}return this}getUnitId(){return this._unitId}apply(e){if(!ds.isNoop(e))return this.snapshot=ds.apply(this.snapshot,e),null!=e&&e.some(e=>Array.isArray(e)&&((null==e?void 0:e[0])==="headers"||(null==e?void 0:e[0])==="footers"))&&(this.headerModelMap.clear(),this.footerModelMap.clear(),this._initializeHeaderFooterModel()),this.change$.next(this.change$.value+1),this.snapshot}sliceBody(e,t,r=hK.copy){let n=this.getBody();if(null!=n)return h2(n,e,t,!1,r)}_initializeHeaderFooterModel(){let{headers:e,footers:t}=this.getSnapshot();if(e)for(let t in e){let r=e[t];this.headerModelMap.set(t,new dg(r)),this.headerModelMap.get(t).updateDocumentId(this.getUnitId())}if(t)for(let e in t){let r=t[e];this.footerModelMap.set(e,new dg(r)),this.footerModelMap.get(e).updateDocumentId(this.getUnitId())}}updateDocumentId(e){super.updateDocumentId(e),this._unitId=e}getPlainText(){var e,t;return dh(null!=(t=null==(e=this.getBody())?void 0:e.dataStream)?t:"")}}function df(e,t,r,n){return e<=r&&t>=r||e>=r&&e<=n}function dp(e,t,r,n){let i=[];for(let s=0,a=r.length;s<a;s++){let a=r[s];if((void 0===n||a.rangeType===n)&&Math.max(a.startIndex,e)<=Math.min(a.endIndex,t)&&i.push({...a}),a.startIndex>t)break}return i}let dC=tb(function(){if(e1)return e0;function e(h,d,m,g,p){if(h===d)return h?[[0,h]]:[];if(null!=m){var C=function(e,t,r){var n="number"==typeof r?{index:r,length:0}:r.oldRange,i="number"==typeof r?null:r.newRange,s=e.length,a=t.length;if(0===n.length&&(null===i||0===i.length)){var o=n.index,l=e.slice(0,o),u=e.slice(o),c=i?i.index:null;e:{var h=o+a-s;if(null!==c&&c!==h||h<0||h>a)break e;var d=t.slice(0,h),m=t.slice(h);if(m!==u)break e;var g=Math.min(o,h),p=l.slice(0,g),C=d.slice(0,g);if(p!==C)break e;var _=l.slice(g),y=d.slice(g);return f(p,_,y,u)}e:if(null===c||c===o){var d=t.slice(0,o),m=t.slice(o);if(d!==l)break e;var R=Math.min(s-o,a-o),E=u.slice(u.length-R),b=m.slice(m.length-R);if(E!==b)break e;var _=u.slice(0,u.length-R),y=m.slice(0,m.length-R);return f(l,_,y,E)}}if(n.length>0&&i&&0===i.length)e:{var p=e.slice(0,n.index),E=e.slice(n.index+n.length),g=p.length,R=E.length;if(a<g+R)break e;var C=t.slice(0,g),b=t.slice(a-R);if(p!==C||E!==b)break e;var _=e.slice(g,s-R),y=t.slice(g,a-R);return f(p,_,y,E)}return null}(h,d,m);if(C)return C}var _=r(h,d),y=h.substring(0,_);_=i(h=h.substring(_),d=d.substring(_));var R=h.substring(h.length-_),E=function(n,s){if(!n)return[[1,s]];if(!s)return[[-1,n]];var a,o=n.length>s.length?n:s,l=n.length>s.length?s:n,u=o.indexOf(l);if(-1!==u)return a=[[1,o.substring(0,u)],[0,l],[1,o.substring(u+l.length)]],n.length>s.length&&(a[0][0]=a[2][0]=-1),a;if(1===l.length)return[[-1,n],[1,s]];var c=function(e,t){var n,s,a,o,l=e.length>t.length?e:t,u=e.length>t.length?t:e;if(l.length<4||2*u.length<l.length)return null;function c(e,t,n){for(var s,a,o,l,u=e.substring(n,n+Math.floor(e.length/4)),c=-1,h="";-1!==(c=t.indexOf(u,c+1));){var d=r(e.substring(n),t.substring(c)),m=i(e.substring(0,n),t.substring(0,c));h.length<m+d&&(h=t.substring(c-m,c)+t.substring(c,c+d),s=e.substring(0,n-m),a=e.substring(n+d),o=t.substring(0,c-m),l=t.substring(c+d))}return 2*h.length>=e.length?[s,a,o,l,h]:null}var h,d=c(l,u,Math.ceil(l.length/4)),m=c(l,u,Math.ceil(l.length/2));return d||m?(h=m?d&&d[4].length>m[4].length?d:m:d,e.length>t.length?(n=h[0],s=h[1],a=h[2],o=h[3]):(a=h[0],o=h[1],n=h[2],s=h[3]),[n,s,a,o,h[4]]):null}(n,s);if(c){var h=c[0],d=c[1],m=c[2],g=c[3],f=c[4],p=e(h,m),C=e(d,g);return p.concat([[0,f]],C)}return function(e,r){for(var n=e.length,i=r.length,s=Math.ceil((n+i)/2),a=2*s,o=Array(a),l=Array(a),u=0;u<a;u++)o[u]=-1,l[u]=-1;o[s+1]=0,l[s+1]=0;for(var c=n-i,h=c%2!=0,d=0,m=0,g=0,f=0,p=0;p<s;p++){for(var C=-p+d;C<=p-m;C+=2){var _,y=s+C;_=C===-p||C!==p&&o[y-1]<o[y+1]?o[y+1]:o[y-1]+1;for(var R=_-C;_<n&&R<i&&e.charAt(_)===r.charAt(R);)_++,R++;if(o[y]=_,_>n)m+=2;else if(R>i)d+=2;else if(h){var E=s+c-C;if(E>=0&&E<a&&-1!==l[E]){var b=n-l[E];if(_>=b)return t(e,r,_,R)}}}for(var I=-p+g;I<=p-f;I+=2){var b,E=s+I;b=I===-p||I!==p&&l[E-1]<l[E+1]?l[E+1]:l[E-1]+1;for(var N=b-I;b<n&&N<i&&e.charAt(n-b-1)===r.charAt(i-N-1);)b++,N++;if(l[E]=b,b>n)f+=2;else if(N>i)g+=2;else if(!h){var y=s+c-I;if(y>=0&&y<a&&-1!==o[y]){var _=o[y],R=s+_-y;if(_>=(b=n-b))return t(e,r,_,R)}}}}return[[-1,e],[1,r]]}(n,s)}(h=h.substring(0,h.length-_),d=d.substring(0,d.length-_));return y&&E.unshift([0,y]),R&&E.push([0,R]),c(E,p),g&&function(e){for(var t=!1,r=[],h=0,d=null,m=0,g=0,f=0,p=0,C=0;m<e.length;)0==e[m][0]?(r[h++]=m,g=p,f=C,p=0,C=0,d=e[m][1]):(1==e[m][0]?p+=e[m][1].length:C+=e[m][1].length,d&&d.length<=Math.max(g,f)&&d.length<=Math.max(p,C)&&(e.splice(r[h-1],0,[-1,d]),e[r[h-1]+1][0]=1,h--,m=--h>0?r[h-1]:-1,g=0,f=0,p=0,C=0,d=null,t=!0)),m++;for(t&&c(e),function(e){function t(e,t){if(!e||!t)return 6;var r=e.charAt(e.length-1),n=t.charAt(0),i=r.match(s),c=n.match(s),h=i&&r.match(a),d=c&&n.match(a),m=h&&r.match(o),g=d&&n.match(o),f=m&&e.match(l),p=g&&t.match(u);return f||p?5:m||g?4:i&&!h&&d?3:h||d?2:i||c?1:0}for(var r=1;r<e.length-1;){if(0==e[r-1][0]&&0==e[r+1][0]){var n=e[r-1][1],c=e[r][1],h=e[r+1][1],d=i(n,c);if(d){var m=c.substring(c.length-d);n=n.substring(0,n.length-d),c=m+c.substring(0,c.length-d),h=m+h}for(var g=n,f=c,p=h,C=t(n,c)+t(c,h);c.charAt(0)===h.charAt(0);){n+=c.charAt(0),c=c.substring(1)+h.charAt(0),h=h.substring(1);var _=t(n,c)+t(c,h);_>=C&&(C=_,g=n,f=c,p=h)}e[r-1][1]!=g&&(g?e[r-1][1]=g:(e.splice(r-1,1),r--),e[r][1]=f,p?e[r+1][1]=p:(e.splice(r+1,1),r--))}r++}}(e),m=1;m<e.length;){if(-1==e[m-1][0]&&1==e[m][0]){var _=e[m-1][1],y=e[m][1],R=n(_,y),E=n(y,_);R>=E?(R>=_.length/2||R>=y.length/2)&&(e.splice(m,0,[0,y.substring(0,R)]),e[m-1][1]=_.substring(0,_.length-R),e[m+1][1]=y.substring(R),m++):(E>=_.length/2||E>=y.length/2)&&(e.splice(m,0,[0,_.substring(0,E)]),e[m-1][0]=1,e[m-1][1]=y.substring(0,y.length-E),e[m+1][0]=-1,e[m+1][1]=_.substring(E),m++),m++}m++}}(E),E}function t(t,r,n,i){var s=t.substring(0,n),a=r.substring(0,i),o=t.substring(n),l=r.substring(i),u=e(s,a),c=e(o,l);return u.concat(c)}function r(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(s,i)==t.substring(s,i)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return h(e.charCodeAt(i-1))&&i--,i}function n(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var s=0,a=1;;){var o=e.substring(i-a),l=t.indexOf(o);if(-1==l)return s;a+=l,(0==l||e.substring(i-a)==t.substring(0,a))&&(s=a,a++)}}function i(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return d(e.charCodeAt(e.length-i))&&i--,i}e1=1;var s=/[^a-zA-Z0-9]/,a=/\s/,o=/[\r\n]/,l=/\n\r?\n$/,u=/^\r?\n\r?\n/;function c(e,t){e.push([0,""]);for(var n,s=0,a=0,o=0,l="",u="";s<e.length;){if(s<e.length-1&&!e[s][1]){e.splice(s,1);continue}switch(e[s][0]){case 1:o++,u+=e[s][1],s++;break;case -1:a++,l+=e[s][1],s++;break;case 0:var h=s-o-a-1;if(t){if(h>=0&&g(e[h][1])){var d=e[h][1].slice(-1);if(e[h][1]=e[h][1].slice(0,-1),l=d+l,u=d+u,!e[h][1]){e.splice(h,1),s--;var f=h-1;e[f]&&1===e[f][0]&&(o++,u=e[f][1]+u,f--),e[f]&&-1===e[f][0]&&(a++,l=e[f][1]+l,f--),h=f}}if(m(e[s][1])){var d=e[s][1].charAt(0);e[s][1]=e[s][1].slice(1),l+=d,u+=d}}if(s<e.length-1&&!e[s][1]){e.splice(s,1);break}if(l.length>0||u.length>0){l.length>0&&u.length>0&&(0!==(n=r(u,l))&&(h>=0?e[h][1]+=u.substring(0,n):(e.splice(0,0,[0,u.substring(0,n)]),s++),u=u.substring(n),l=l.substring(n)),0!==(n=i(u,l))&&(e[s][1]=u.substring(u.length-n)+e[s][1],u=u.substring(0,u.length-n),l=l.substring(0,l.length-n)));var p=o+a;0===l.length&&0===u.length?(e.splice(s-p,p),s-=p):0===l.length?(e.splice(s-p,p,[1,u]),s=s-p+1):0===u.length?(e.splice(s-p,p,[-1,l]),s=s-p+1):(e.splice(s-p,p,[-1,l],[1,u]),s=s-p+2)}0!==s&&0===e[s-1][0]?(e[s-1][1]+=e[s][1],e.splice(s,1)):s++,o=0,a=0,l="",u=""}}""===e[e.length-1][1]&&e.pop();var C=!1;for(s=1;s<e.length-1;)0===e[s-1][0]&&0===e[s+1][0]&&(e[s][1].substring(e[s][1].length-e[s-1][1].length)===e[s-1][1]?(e[s][1]=e[s-1][1]+e[s][1].substring(0,e[s][1].length-e[s-1][1].length),e[s+1][1]=e[s-1][1]+e[s+1][1],e.splice(s-1,1),C=!0):e[s][1].substring(0,e[s+1][1].length)==e[s+1][1]&&(e[s-1][1]+=e[s+1][1],e[s][1]=e[s][1].substring(e[s+1][1].length)+e[s+1][1],e.splice(s+1,1),C=!0)),s++;C&&c(e,t)}function h(e){return e>=55296&&e<=56319}function d(e){return e>=56320&&e<=57343}function m(e){return d(e.charCodeAt(0))}function g(e){return h(e.charCodeAt(e.length-1))}function f(e,t,r,n){return g(e)||m(n)?null:function(e){for(var t=[],r=0;r<e.length;r++)e[r][1].length>0&&t.push(e[r]);return t}([[0,e],[-1,t],[1,r],[0,n]])}function p(t,r,n,i){return e(t,r,n,i,!0)}return p.INSERT=1,p.DELETE=-1,p.EQUAL=0,e0=p}());function d_(e,t,r=0,n=null,i=!0){e.sort((e,t)=>e.startOffset-t.startOffset);let s=[],{paragraphs:a=[]}=t,o=null==a?void 0:a.find(t=>t.startIndex>=e[0].startOffset&&t.startIndex<e[0].endOffset),l=r;if(e.forEach(e=>{let{startOffset:t,endOffset:r}=e;t>l&&(s.push({t:sJ.RETAIN,len:t-l}),l=t),l<r&&(s.push({t:sJ.DELETE,len:r-l}),l=r)}),n&&s.push({t:sJ.INSERT,body:n,len:n.dataStream.length}),o&&i){let t=a.find(t=>t.startIndex-r>=e[e.length-1].endOffset-1);t&&(t.startIndex>l&&(s.push({t:sJ.RETAIN,len:t.startIndex-l}),l=t.startIndex),s.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...t,startIndex:0,bullet:null==o?void 0:o.bullet}]},coverType:sZ.REPLACE}))}return s}function dy(e,t,r,n){let{startOffset:i,endOffset:s}=e,a=null!=n?n:db(t,r),o=[],l=-1;for(let e=0;e<a.length;e++){let t=a[e],{startIndex:r}=t;(i>l&&i<=r||s>l&&s<=r||r>=i&&r<=s)&&o.push(t),l=r}return o}function dR(e,t,r){let n=[],i=db(t,r);for(let s of e){let e=dy(s,t,r,i);n.push(...e)}return n}let dE=[dl.PARAGRAPH,dl.TABLE_START,dl.TABLE_END,dl.TABLE_ROW_START,dl.TABLE_CELL_START,dl.TABLE_CELL_END];function db(e,t){let r=[];for(let n=0;n<e.length;n++){let i=e[n],{startIndex:s}=i,a=s-1;for(;!dE.includes(t[a])&&a>=0;)a--;r.push({...i,paragraphStart:a+1,paragraphEnd:i.startIndex})}return r}class dI{}function dN(e,t,r,n){var i;let s;if(""===t)return e;let a=new dg({id:"mock-id",body:e,documentStyle:{}}),o=t.length;for(;(s=(n?a.getBody().dataStream:a.getBody().dataStream.toLowerCase()).indexOf(t))>=0;){let e=new dn,t=ds.getInstance();if(s>0&&e.retain(s),r.length>0){let t=a.sliceBody(s,s+o),n={dataStream:r};Array.isArray(null==t?void 0:t.textRuns)&&t.textRuns.length&&(n.textRuns=[{...t.textRuns[0],st:0,ed:r.length}]),null!=(i=null==t?void 0:t.customRanges)&&i.length&&(n.customRanges=[{...t.customRanges[0],startIndex:0,endIndex:r.length-1}]),e.insert(r.length,n)}e.delete(o),a.apply(t.editOp(e.serialize()))}let l=a.getBody();return a.dispose(),l}function dS(e){var t;return e.body=function(e){if(e.customRanges||(e.customRanges=[]),!e.paragraphs){e.paragraphs=[];for(let t=0;t<e.dataStream.length;t++)"\r"===e.dataStream[t]&&e.paragraphs.push({startIndex:t})}return e.customBlocks||(e.customBlocks=[]),e.textRuns||(e.textRuns=[]),e.customDecorations||(e.customDecorations=[]),e.sectionBreaks||(e.sectionBreaks=[]),e.tables||(e.tables=[]),e}(null!=(t=e.body)?t:{dataStream:""}),e.drawingsOrder||(e.drawingsOrder=[]),e.drawings||(e.drawings={}),e.documentStyle||(e.documentStyle={}),e}tg(dI,"customRange",{add:function(e){let{ranges:t,rangeId:r,rangeType:n,wholeEntity:i,properties:s,body:a}=e,o=0,l=new dn,u=!1;return t.forEach(e=>{var t,c,h;let d=function(e,t){var r,n,i,s,a;let o=dp(e.startOffset,e.collapsed?e.startOffset:e.endOffset-1,null!=(r=t.customRanges)?r:[]),l=Math.min(e.startOffset,null!=(i=null==(n=o[0])?void 0:n.startIndex)?i:1/0),u=Math.max(e.endOffset,(null!=(a=null==(s=o[o.length-1])?void 0:s.endIndex)?a:-1/0)+1);return{startOffset:l,endOffset:u,collapsed:l===u}}(e,a);if(!d||!a)return!1;let{startOffset:m,endOffset:g}=d,f=null!=(t=a.customRanges)?t:[],p=(null!=(c=a.paragraphs)?c:[]).filter(e=>e.startIndex<g&&e.startIndex>m),C=(null!=(h=a.customBlocks)?h:[]).filter(e=>e.startIndex<g&&e.startIndex>m);(function(e,t){let r=[],n=e[0];for(let i of t)i<e[0]||i>e[1]||(n<i&&r.push([n,i-1]),n=i+1);return n<=e[1]&&r.push([n,e[1]]),r})([m,g-1],[...p.map(e=>e.startIndex),...C.map(e=>e.startIndex)]).forEach(([e,t],a)=>((e,t,a)=>{var u,c,h,d;let m=dp(e,t,f,n),g=Math.min(null!=(c=null==(u=m[0])?void 0:u.startIndex)?c:1/0,e),p=Math.max(null!=(d=null==(h=m[m.length-1])?void 0:h.endIndex)?d:-1/0,t),C={rangeId:a?`${r}$${a}`:r,rangeType:n,startIndex:0,endIndex:p-g,wholeEntity:i,properties:{...s}};l.push({t:sJ.RETAIN,len:g-o}),l.push({t:sJ.RETAIN,len:p-g+1,body:{dataStream:"",customRanges:[C]},coverType:sZ.COVER}),o=p+1})(e,t,a)),u=!0,l.selections=[{startOffset:d.endOffset,endOffset:d.endOffset,collapsed:!0}]}),!!u&&l},delete:function(e){var t,r,n;let{rangeId:i,segmentId:s,documentDataModel:a,insert:o}=e,l=null==(r=null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.customRanges)?void 0:r.find(e=>e.rangeId===i);if(!l)return!1;let{startIndex:u,endIndex:c}=l,h=new dn;h.push({t:sJ.RETAIN,len:u}),h.push({t:sJ.RETAIN,len:c-u+1,body:{dataStream:"",customRanges:[]}}),o&&h.push({t:sJ.INSERT,body:o,len:o.dataStream.length});let d=c+1+(null!=(n=null==o?void 0:o.dataStream.length)?n:0);return h.selections=[{startOffset:d,endOffset:d,collapsed:!0}],h},copyCustomRange:function(e){return{...ir.deepClone(e),rangeId:ii()}},getCustomRangesInterestsWithSelection:function(e,t){let r=[];for(let n=0,i=t.length;n<i;n++){let i=t[n];e.collapsed?i.startIndex<e.startOffset&&e.startOffset<=i.endIndex&&r.push(i):df(e.startOffset,e.endOffset-1,i.startIndex,i.endIndex)&&r.push(i)}return r},isIntersecting:df}),tg(dI,"customDecoration",{add:function(e){let{ranges:t,id:r,type:n}=e,i=new dn,s=0;for(let e=0;e<t.length;e++){let{startOffset:a,endOffset:o}=t[e];a>0&&i.push({t:sJ.RETAIN,len:a-s}),i.push({t:sJ.RETAIN,body:{dataStream:"",customDecorations:[{id:r,type:n,startIndex:0,endIndex:o-a-1}]},len:o-a}),s=o}return i},delete:function(e){var t,r,n;let{id:i,segmentId:s,documentDataModel:a}=e,o=null==a?void 0:a.getBody();if(!a||!o)return!1;let l=null==(n=null==(r=null==(t=a.getSelfOrHeaderFooterModel(s))?void 0:t.getBody())?void 0:r.customDecorations)?void 0:n.find(e=>e.id===i);if(!l)return!1;let u=new dn,{startIndex:c,endIndex:h}=l,d=h-c+1;return u.push({t:sJ.RETAIN,len:c}),u.push({t:sJ.RETAIN,len:d,body:{dataStream:"",customDecorations:[{startIndex:0,endIndex:d-1,id:i,type:iY.DELETED}]}}),u}}),tg(dI,"selection",{replace:e=>{var t;let{selection:r,body:n,doc:i}=e,s=r.segmentId,a=null==(t=i.getSelfOrHeaderFooterModel(s))?void 0:t.getBody();if(!a)return!1;let o=r.collapsed?null:h2(a,r.startOffset,r.endOffset),l=dC(o?o.dataStream:"",n.dataStream),u=0,c=l.map(([e,t])=>{switch(e){case 0:{let e={t:sJ.RETAIN,body:{...h2(n,u,u+t.length,!1),dataStream:""},len:t.length};return u+=t.length,e}case 1:{let e={t:sJ.INSERT,body:h2(n,u,u+t.length),len:t.length};return u+=t.length,e}default:return{t:sJ.DELETE,len:t.length}}}),h=new dn;return h.push({t:sJ.RETAIN,len:r.startOffset}),h.push(...c),h},makeSelection:function(e,t){if(typeof t>"u")return{startOffset:e,endOffset:e,collapsed:!0};if(t<e)throw Error(`Cannot make a doc selection when endOffset ${t} is less than startOffset ${e}.`);return{startOffset:e,endOffset:t,collapsed:e===t}},normalizeSelection:function(e){let{startOffset:t,endOffset:r,collapsed:n}=e;return{startOffset:Math.min(t,r),endOffset:Math.max(t,r),collapsed:n}},delete:d_,replaceTextRuns:e=>{var t;let{selection:r,body:n,doc:i,themeService:s}=e,a=r.segmentId,o=null==(t=i.getSelfOrHeaderFooterModel(a))?void 0:t.getBody();if(!o)return!1;let l=r.collapsed?null:h2(o,r.startOffset,r.endOffset),u=dC(l?l.dataStream:"",n.dataStream),c=0,h=u.map(([e,t])=>{switch(e){case 0:{let e=hQ(n,c,c+t.length,!1),r=hQ(l,c,c+t.length,!1),i={t:sJ.RETAIN,body:(null==e?void 0:e.length)===(null==r?void 0:r.length)&&null!=e&&e.every((e,t)=>JSON.stringify(e)===JSON.stringify(null==r?void 0:r[t]))?void 0:{textRuns:null==e?void 0:e.map(e=>{var t,r,n,i,a,o,l;return{...e,ts:{...e.ts,cl:null!=(n=null==(r=null==(t=e.ts)?void 0:t.cl)?void 0:r.rgb)&&n.includes(".")?{rgb:s.getColorFromTheme(null!=(o=null==(a=null==(i=e.ts)?void 0:i.cl)?void 0:a.rgb)?o:"")}:null==(l=e.ts)?void 0:l.cl}}}),dataStream:""},len:t.length};return c+=t.length,i}case 1:{let e={t:sJ.INSERT,body:h2(n,c,c+t.length),len:t.length};return c+=t.length,e}default:return{t:sJ.DELETE,len:t.length}}});if(h.every(e=>e.t===sJ.RETAIN&&!e.body))return!1;let d=new dn;return d.push({t:sJ.RETAIN,len:r.startOffset}),d.push(...h),d},retain:function(e,t,r=0){let n=[],i=r;return e.forEach(e=>{let{startOffset:r,endOffset:s}=e;r>i&&(n.push({t:sJ.RETAIN,len:r-i}),i=r),s>i&&(n.push({t:sJ.RETAIN,len:s-i,body:{...ir.deepClone(t),dataStream:""}}),i=s)}),n}}),tg(dI,"range",{isIntersects:function(e,t,r,n){return Math.max(e,r)<=Math.min(t,n)},getParagraphsInRange:dy,getParagraphsInRanges:dR}),tg(dI,"transform",{getPlainText:dh,fromPlainText:e=>{let t=e.replace(/\n/g,"\r"),r=[],n=[],i=0,s="",a=(a,o=!0)=>{let l=t.slice(i,a);if(ir.isLegalUrl(l)){let t=ii(),u=`${l}`,c={startIndex:i,endIndex:i+u.length-1,rangeId:t,rangeType:iG.HYPERLINK,properties:{url:e}};n.push(c),s+=u,i=a+1,o&&(s+="\r",r.push({startIndex:a}))}else s+=t.slice(i,a+1),i=a+1,o&&r.push({startIndex:a})},o=0;for(let e=0;e<t.length;e++)"\r"===t[e]&&(a(e),o=e);return(o!==t.length-1||1===t.length)&&a(t.length,!1),{dataStream:s,paragraphs:r,customRanges:n}},isEmptyDocument:e=>!e||""===dh(e).replaceAll("\r","")}),tg(dI,"paragraph",{bullet:{set:e=>{var t,r;let{paragraphs:n,listType:i,segmentId:s,document:a}=e;if((null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)==null)return!1;let o=ii(6),l=new nF;l.reset();let u=new dn;for(let e of n){let{startIndex:t,paragraphStyle:n={},bullet:s}=e;u.push({t:sJ.RETAIN,len:t-l.cursor}),u.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:n,bullet:{nestingLevel:null!=(r=null==s?void 0:s.nestingLevel)?r:0,textStyle:(null==s?void 0:s.listType)===i?s.textStyle:{fs:20},listType:i,listId:o}}]},coverType:sZ.REPLACE}),l.moveCursorTo(t+1)}return u},switch:e=>{var t,r,n;let{paragraphs:i,segmentId:s,document:a}=e,o=e.listType,l=null!=(r=null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)?r:[],u=i.every(e=>{var t;return(null==(t=e.bullet)?void 0:t.listType.indexOf(o))===0}),c=ii(6);if(1===i.length){let e=l.indexOf(i[0]),t=l[e-1],r=l[e+1];t&&t.bullet&&0===t.bullet.listType.indexOf(o)?(c=t.bullet.listId,o!==hB.CHECK_LIST&&(o=t.bullet.listType)):r&&r.bullet&&0===r.bullet.listType.indexOf(o)&&(c=r.bullet.listId,o!==hB.CHECK_LIST&&(o=r.bullet.listType))}let h=new nF;h.reset();let d=new dn;for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:i}=e;d.push({t:sJ.RETAIN,len:t-h.cursor}),d.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[u?{paragraphStyle:r,startIndex:0}:{startIndex:0,paragraphStyle:{...r},bullet:{nestingLevel:null!=(n=null==i?void 0:i.nestingLevel)?n:0,textStyle:{fs:20},listType:o,listId:c}}]},coverType:sZ.REPLACE}),h.moveCursorTo(t+1)}return d},toggleChecklist:e=>{var t;let{paragraphIndex:r,segmentId:n,document:i}=e,s=null==(t=i.getSelfOrHeaderFooterModel(n).getBody())?void 0:t.paragraphs;if(null==s)return!1;let a=s.find(e=>e.startIndex===r);if(!(null!=a&&a.bullet)||-1===a.bullet.listType.indexOf(hB.CHECK_LIST))return!1;let o=new nF;o.reset();let l=new dn,{startIndex:u,paragraphStyle:c={}}=a,h=a.bullet.listType===hB.CHECK_LIST?hB.CHECK_LIST_CHECKED:hB.CHECK_LIST;return l.push({t:sJ.RETAIN,len:u-o.cursor}),l.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...a,paragraphStyle:c,startIndex:0,bullet:{...a.bullet,listType:h}}]},coverType:sZ.REPLACE}),o.moveCursorTo(u+1),l},changeNestLevel:e=>{var t,r,n;let{paragraphs:i,document:s,type:a}=e,o=new nF;o.reset();let l=new dn,u=null!=(t=s.getSnapshot().lists)?t:{},c=null!=(n=null==(r=s.getBody())?void 0:r.tables)?n:[],h={...hY,...u};for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:n}=e,i=function(e,t){return t.some(t=>e.startIndex>t.startIndex&&e.startIndex<t.endIndex)}(e,c);if(l.push({t:sJ.RETAIN,len:t-o.cursor}),n){let e=h[n.listType].nestingLevel.length-1;i&&(e=Math.min(e,2)),l.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:{...r},bullet:{...n,nestingLevel:Math.max(Math.min(n.nestingLevel+a,e),0)}}]},coverType:sZ.REPLACE})}else l.push({t:sJ.RETAIN,len:1});o.moveCursorTo(t+1)}return l}},style:{set:e=>{var t,r,n,i;let{textRanges:s,segmentId:a,document:o,style:l,paragraphTextRun:u,cursor:c,deleteLen:h,textX:d}=e,m=o.getSelfOrHeaderFooterModel(a),g=dR(s,null!=(r=null==(t=m.getBody())?void 0:t.paragraphs)?r:[],null!=(i=null==(n=m.getBody())?void 0:n.dataStream)?i:""),f=new nF;c&&f.moveCursorTo(c);let p=null!=d?d:new dn;g.sort((e,t)=>e.startIndex-t.startIndex);let C=Math.max(0,g[0].paragraphStart-1);for(let e of(C>f.cursor&&(p.push({t:sJ.RETAIN,len:C-f.cursor}),f.moveCursorTo(C)),h&&p.push({t:sJ.DELETE,len:h}),g)){let{startIndex:t,paragraphStyle:r={}}=e,n=t-f.cursor;p.push({t:sJ.RETAIN,len:n,...u?{body:{dataStream:"",textRuns:[{ts:u,st:0,ed:n}]},coverType:sZ.REPLACE}:null}),p.push({t:sJ.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:{...r,...l}}]},coverType:sZ.REPLACE}),f.moveCursorTo(t+1)}return p}},util:{transform:db,getParagraphsInRange:dy,getParagraphsInRanges:dR}}),tg(dI,"drawing",{add:e=>{var t,r,n,i;let{selection:s,documentDataModel:a,drawings:o}=e,{collapsed:l,startOffset:u,segmentId:c}=s,h=new dn,d=ds.getInstance(),m=[],g=a.getSelfOrHeaderFooterModel(c).getBody();if(!g)return!1;let f=null!=(r=null==(t=a.getSnapshot().drawingsOrder)?void 0:t.length)?r:0,p=0;if(l)u>0&&h.push({t:sJ.RETAIN,len:u});else{let e=d_([s],g,0,null,!1);h.push(...e);let t=function(e,t){let r=[],{customBlocks:n=[]}=e;for(let e of t){let{startOffset:t,endOffset:i}=e;if(null!=t&&null!=i)for(let e of n){let{startIndex:n}=e;n>=t&&n<i&&r.push(e.blockId)}}return r}(g,[s]),r=null!=(n=a.getDrawings())?n:{},o=null!=(i=a.getDrawingsOrder())?i:[],l=t.sort((e,t)=>o.indexOf(e)>o.indexOf(t)?-1:+(o.indexOf(e)<o.indexOf(t)));if(l.length>0)for(let e of l){let t=r[e],n=o.indexOf(e);if(null==t||n<0)continue;let i=d.removeOp(["drawings",e],t),s=d.removeOp(["drawingsOrder",n],e);m.push(i),m.push(s),p++}}h.push({t:sJ.INSERT,body:{dataStream:"\b".repeat(o.length),customBlocks:o.map((e,t)=>({startIndex:t,blockId:e.drawingId}))},len:o.length});let C=function(e,t=""){if(!t)return["body"];let{headers:r,footers:n}=e.getSnapshot();if(null==r&&null==n)throw Error("Document data model must have headers or footers when update by segment id");if((null==r?void 0:r[t])!=null)return["headers",t,"body"];if((null==n?void 0:n[t])!=null)return["footers",t,"body"];throw Error("Segment id not found in headers or footers")}(a,c),_=d.editOp(h.serialize(),C);for(let e of(m.push(_),o)){let{drawingId:t}=e,r=d.insertOp(["drawings",t],e),n=d.insertOp(["drawingsOrder",f-p],t);m.push(r),m.push(n)}return m.reduce((e,t)=>ds.compose(e,t),null)}});class dA{constructor(e={}){tg(this,"_style"),this._style=e}static create(e={}){return new dA(e)}get fontFamily(){return this._style.ff}get fontSize(){return this._style.fs}get italic(){return this._style.it===iP.TRUE}get bold(){return this._style.bl===iP.TRUE}get underline(){return this._style.ul&&dT.create(this._style.ul)}get bottomBorderLine(){return this._style.bbl&&dT.create(this._style.bbl)}get strikethrough(){return this._style.st&&dT.create(this._style.st)}get overline(){return this._style.ol&&dT.create(this._style.ol)}get background(){return this._style.bg}get border(){return this._style.bd}get color(){return this._style.cl}get verticalAlign(){return this._style.va}get numberFormat(){return this._style.n}copy(){return dv.create(ir.deepClone(this._style))}getValue(){return{...this._style}}}class dv extends dA{static create(e={}){return new dv(e)}constructor(e={}){super(e)}setFontFamily(e){return this._style.ff=e,this}setFontSize(e){return this._style.fs=e,this}setItalic(e){return this._style.it=+!!e,this}setBold(e){return this._style.bl=+!!e,this}setUnderline(e){return this._style.ul=e.build(),this}setBottomBorderLine(e){return this._style.bbl=e.build(),this}setStrikethrough(e){return this._style.st=e.build(),this}setOverline(e){return this._style.ol=e.build(),this}setBackground(e){return this._style.bg=e,this}setBorder(e){return this._style.bd=e,this}setColor(e){return this._style.cl=e,this}setVerticalAlign(e){return this._style.va=e,this}copy(){return dv.create(ir.deepClone(this._style))}build(){return this.getValue()}}class dT{constructor(e={s:1}){tg(this,"_decoration"),this._decoration=e}static create(e={s:1}){return new dT(e)}get show(){return this._decoration.s===iP.TRUE}get followFontColor(){return this._decoration.c===iP.TRUE}get color(){return this._decoration.cl}get type(){return this._decoration.t}setShow(e){return this._decoration.s=+!!e,this}setFollowFontColor(e){return this._decoration.c=+!!e,this}setColor(e){return this._decoration.cl=e,this}setLineType(e){return this._decoration.t=e,this}copy(){return dT.create(ir.deepClone(this._decoration))}build(){return{...this._decoration}}}class dw{constructor(e={}){tg(this,"_style"),this._style=e}static create(e={}){return new dw(e)}get indentFirstLine(){return this._style.indentFirstLine}get hanging(){return this._style.hanging}get indentStart(){return this._style.indentStart}get tabStops(){return this._style.tabStops}get indentEnd(){return this._style.indentEnd}get textStyle(){return this._style.textStyle}get headingId(){return this._style.headingId}get namedStyleType(){return this._style.namedStyleType}get horizontalAlign(){return this._style.horizontalAlign}get lineSpacing(){return this._style.lineSpacing}get direction(){return this._style.direction}get spacingRule(){return this._style.spacingRule}get snapToGrid(){return this._style.snapToGrid}get spaceAbove(){return this._style.spaceAbove}get spaceBelow(){return this._style.spaceBelow}get borderBetween(){return this._style.borderBetween}get borderTop(){return this._style.borderTop}get borderBottom(){return this._style.borderBottom}get borderLeft(){return this._style.borderLeft}get borderRight(){return this._style.borderRight}get keepLines(){return this._style.keepLines===iP.TRUE}get keepNext(){return this._style.keepNext===iP.TRUE}get wordWrap(){return this._style.wordWrap===iP.TRUE}get widowControl(){return this._style.widowControl===iP.TRUE}get shading(){return this._style.shading}get suppressHyphenation(){return this._style.suppressHyphenation===iP.TRUE}copy(){return dM.create(ir.deepClone(this._style))}getValue(){return this._style}}class dM extends dw{static create(e={}){return new dM(e)}constructor(e={}){super(e)}setIndentFirstLine(e){return this._style.indentFirstLine=e,this}setHanging(e){return this._style.hanging=e,this}setIndentStart(e){return this._style.indentStart=e,this}setTabStops(e){return this._style.tabStops=e,this}setIndentEnd(e){return this._style.indentEnd=e,this}setTextStyle(e){return this._style.textStyle=e,this}setHeadingId(e){return this._style.headingId=e,this}setNamedStyleType(e){return this._style.namedStyleType=e,this}setHorizontalAlign(e){return this._style.horizontalAlign=e,this}setLineSpacing(e){return this._style.lineSpacing=e,this}setDirection(e){return this._style.direction=e,this}setSpacingRule(e){return this._style.spacingRule=e,this}setSnapToGrid(e){return this._style.snapToGrid=+!!e,this}setSpaceAbove(e){return this._style.spaceAbove=e,this}setSpaceBelow(e){return this._style.spaceBelow=e,this}setBorderBetween(e){return this._style.borderBetween=e,this}setBorderTop(e){return this._style.borderTop=e,this}setBorderBottom(e){return this._style.borderBottom=e,this}setBorderLeft(e){return this._style.borderLeft=e,this}setBorderRight(e){return this._style.borderRight=e,this}setKeepLines(e){return this._style.keepLines=+!!e,this}setKeepNext(e){return this._style.keepNext=+!!e,this}setWordWrap(e){return this._style.wordWrap=+!!e,this}setWidowControl(e){return this._style.widowControl=+!!e,this}setShading(e){return this._style.shading=e,this}setSuppressHyphenation(e){return this._style.suppressHyphenation=+!!e,this}copy(){return dM.create(ir.deepClone(this._style))}build(){return this.getValue()}}class dO{constructor(e){if(tg(this,"_data"),!e.body)throw Error("Invalid document data, body is required");this._data=dS(e)}static create(e){return new dO(e)}static createByBody(e){return new dO({body:e,id:"d",documentStyle:{}})}copy(){return dx.create(ir.deepClone(this._data))}slice(e,t){let{body:r,...n}=this._data;return dx.create({...ir.deepClone(n),body:h2(r,e,t)})}toPlainText(){var e,t;return dI.transform.getPlainText(null!=(t=null==(e=this._data.body)?void 0:e.dataStream)?t:"").replaceAll("\r",`
`)}getParagraphStyle(){var e,t;return dw.create(null==(t=null==(e=this._data.body)?void 0:e.paragraphs)?void 0:t[0].paragraphStyle)}getParagraphBullet(){var e,t;return null==(t=null==(e=this._data.body)?void 0:e.paragraphs)?void 0:t[0].bullet}getParagraphs(){var e,t;let r=null!=(t=null==(e=this._data.body)?void 0:e.paragraphs)?t:[],n=0;return r.map(e=>{let t=this.slice(n,e.startIndex);return n=e.startIndex,t})}getTextRuns(){var e,t;return(null!=(t=null==(e=this._data.body)?void 0:e.textRuns)?t:[]).map(e=>({...e,ts:e.ts?dA.create(e.ts):null}))}getLinks(){var e,t,r;return null!=(r=null==(t=null==(e=this._data.body)?void 0:e.customRanges)?void 0:t.filter(e=>e.rangeType===iG.HYPERLINK))?r:[]}getData(){return this._data}}class dx extends dO{constructor(e){super(e),tg(this,"_doc"),this._doc=new dg(e)}static newEmptyData(){return dS({id:"d",documentStyle:{},drawings:{},drawingsOrder:[],body:{dataStream:`\r
`,customBlocks:[],customRanges:[],paragraphs:[{startIndex:0}],textRuns:[],tables:[],sectionBreaks:[]}})}static create(e){return new dx(null!=e?e:dx.newEmptyData())}insertText(e,t,r){var n,i;let s=(null!=(i=null==(n=this._data.body)?void 0:n.dataStream.length)?i:2)-2,a,o;if("string"==typeof e?a=e:(s=Math.min(e,s),a=t),o="object"==typeof t?t instanceof dv?t.build():t:r instanceof dv?r.build():r,!a)return this;let l={dataStream:a,textRuns:o?[{ts:o,st:s,ed:s+a.length}]:[]},u=dI.selection.replace({doc:this._doc,selection:{startOffset:s,endOffset:s,collapsed:!0},body:l});if(!u)throw Error("Insert text failed, please check.");return dn.apply(this._doc.getBody(),u.serialize()),this}insertRichText(e,t){var r,n;let i=(null!=(n=null==(r=this._data.body)?void 0:r.dataStream.length)?n:2)-2,s;"object"==typeof e?s=e instanceof dO?e.getData():e:(i=Math.min(e,i),s=t instanceof dO?t.getData():t);let a=dI.selection.replace({doc:this._doc,selection:{startOffset:i,endOffset:i,collapsed:!0},body:s.body});if(!a)throw Error("Insert text failed, please check.");return dn.apply(this._doc.getBody(),a.serialize()),this}delete(e,t){if(void 0!==t){if(!t)return this;let r=dI.selection.delete([{startOffset:e,endOffset:e+t,collapsed:!0}],this._data.body);dn.apply(this._doc.getBody(),r)}return this}setStyle(e,t,r){let n={dataStream:"",textRuns:[{ts:r instanceof dv?r.build():r,st:0,ed:t-e}]},i=dI.selection.retain([{startOffset:e,endOffset:t,collapsed:!0}],n);return dn.apply(this._doc.getBody(),i),this}setLink(e,t,r){let n=dI.customRange.add({rangeType:iG.HYPERLINK,rangeId:ii(),properties:{url:r},ranges:[{startOffset:e,endOffset:t,collapsed:!1}],body:this._data.body});if(!n)throw Error("Insert text failed, please check.");return dn.apply(this._doc.getBody(),n.serialize()),this}cancelLink(e,t){if("string"==typeof e){let t=dI.customRange.delete({rangeId:e,documentDataModel:this._doc});if(!t)throw Error("Insert text failed, please check.");dn.apply(this._doc.getBody(),t.serialize())}else this.slice(e,t).getLinks().forEach(e=>{let t=dI.customRange.delete({rangeId:e.rangeId,documentDataModel:this._doc});if(!t)throw Error("Insert text failed, please check.");dn.apply(this._doc.getBody(),t.serialize())});return this}updateLink(e,t){var r,n;let i=null==(n=null==(r=this._data.body)?void 0:r.customRanges)?void 0:n.find(t=>t.rangeId===e);if(!i)throw Error("Link not found");return i.properties.url=t,this}insertParagraph(e,t){var r,n;let i,s;return"object"==typeof e?(i={dataStream:"\r",paragraphs:[{startIndex:0,paragraphStyle:e.build()}]},s=(null!=(n=null==(r=this._data.body)?void 0:r.dataStream.length)?n:2)-2):(s=e,i={dataStream:"\r",paragraphs:[{startIndex:0,paragraphStyle:null==t?void 0:t.build()}]}),this.insertRichText(s,dO.create({body:i,id:"d",documentStyle:{}})),this}insertLink(e,t,r){let n="",i="";"string"==typeof e?(n=e,i=t):(n=t,i=r);let s=dx.createByBody({dataStream:n,customRanges:[{rangeType:iG.HYPERLINK,rangeId:ii(),properties:{url:i},startIndex:0,endIndex:n.length-1}]});return"number"==typeof e?this.insertRichText(e,s):this.insertRichText(s)}}let dU="__default_document_sub_component_id20231101__";class dD{constructor(){tg(this,"skipNextObservers",!1),tg(this,"lastReturnValue"),tg(this,"isStopPropagation",!1)}stopPropagation(){this.isStopPropagation=!0}}class dV extends ts.Subject{constructor(){super(...arguments),tg(this,"_sortedObservers",[])}subscribe(){throw Error("[EventSubject]: please use `subscribeEvent` instead of `subscribe` method for `EventSubject`.")}next(){throw Error("[EventSubject]: please use `emitEvent` instead of `next` method for `EventSubject`.")}unsubscribe(){super.unsubscribe(),this._sortedObservers.length=0}complete(){super.complete(),this._sortedObservers.length=0}subscribeEvent(e){let t;t="function"==typeof e?{next:([t,r])=>e(t,r)}:e;let r=super.subscribe(t);return this._sortedObservers.push(t),this._sortedObservers.sort((e,t)=>{var r,n;return(null!=(r=e.priority)?r:0)-(null!=(n=t.priority)?n:0)}),r.add(()=>this._sortedObservers=this._sortedObservers.filter(e=>e!==t)),r}clearObservers(){this._sortedObservers.forEach(e=>{var t;return null==(t=e.complete)?void 0:t.call(e)}),this._sortedObservers.length=0}emitEvent(e){var t;if(!this.closed){let r=new dD;for(let n of(r.lastReturnValue=e,this._sortedObservers)){let i=null==(t=n.next)?void 0:t.call(n,[e,r]);if(r.lastReturnValue=i,r.skipNextObservers)return{handled:!0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}return{handled:this._sortedObservers.length>0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}throw Error("[EventSubject]: cannot emit event on a closed subject.")}}function dL(e){return new(0,tt.Observable)(t=>{let r=e.subscribeEvent(e=>{t.next(e)});return()=>r.unsubscribe()})}let dP=(0,e2.createIdentifier)("core.resource-manager.service"),dk={[n5.Editor]:"Editor",[n5.Owner]:"Owner",[n5.Reader]:"Reader",[n5.UNRECOGNIZED]:"UNRECOGNIZED"},dF=e=>e?{userID:`${dk[e]}_${ii(8)}`,name:dk[e],avatar:""}:{userID:"",name:"",avatar:"",anonymous:!0,canBindAnonymous:!1};class dj extends nJ{constructor(){super(...arguments),tg(this,"_model",new Map),tg(this,"_userChange$",new(0,ts.Subject)),tg(this,"userChange$",this._userChange$.asObservable()),tg(this,"_currentUser$",new(0,e5.BehaviorSubject)(dF())),tg(this,"currentUser$",this._currentUser$.asObservable())}dispose(){super.dispose(),this._model.clear(),this._userChange$.complete(),this._currentUser$.complete()}getCurrentUser(){return this._currentUser$.getValue()}setCurrentUser(e){this.addUser(e),this._currentUser$.next(e)}addUser(e){this._model.set(e.userID,e),this._userChange$.next({type:"add",user:e})}getUser(e,t){let r=this._model.get(e);if(r)return r;t&&t()}delete(e){let t=this.getUser(e);this._model.delete(e),t&&this._userChange$.next({type:"delete",user:t})}clear(){this._model.clear(),this._userChange$.next({type:"clear"})}list(){return Array.from(this._model.values())}}var dB=Object.getOwnPropertyDescriptor,d$=(e,t)=>(r,n)=>t(r,n,e);let dH=class{constructor(e,t){tg(this,"_permissionMap",new Map([])),this._resourceManagerService=e,this._userManagerService=t,this._initSnapshot(),this._initDefaultUser()}_initDefaultUser(){let e=this._userManagerService.getCurrentUser();e&&e.userID||this._userManagerService.setCurrentUser(dF(n5.Owner))}_getRole(e){let t,r=this._userManagerService.getCurrentUser();return!!r&&(t=r.userID,t.startsWith(dk[e]))}_initSnapshot(){this._resourceManagerService.registerPluginResource({toJson:e=>JSON.stringify([...this._permissionMap.keys()].reduce((e,t)=>{let r=this._permissionMap.get(t);return e[t]=r,e},{})),parseJson:e=>JSON.parse(e),pluginName:"SHEET_AuthzIoMockService_PLUGIN",businesses:[n2.UNIVER_SHEET,n2.UNIVER_DOC,n2.UNIVER_SLIDE],onLoad:(e,t)=>{for(let e in t)this._permissionMap.set(e,t[e])},onUnLoad:()=>{this._permissionMap.clear()}})}async create(e){return ii(8)}async allowed(e){return Promise.resolve([])}async batchAllowed(e){return Promise.resolve([])}async list(e){let t=[];return e.objectIDs.forEach(r=>{let n=this._permissionMap.get(r);if(n){let i={objectID:r,unitID:e.unitID,objectType:n.objectType,name:n.name,shareOn:!1,shareRole:n5.Owner,shareScope:-1,scope:{read:n3.AllCollaborator,edit:n3.AllCollaborator},creator:dF(n5.Owner),strategies:[{action:6,role:1},{action:16,role:1},{action:17,role:1},{action:18,role:1},{action:19,role:1},{action:33,role:1},{action:34,role:1},{action:35,role:1},{action:36,role:1},{action:37,role:1},{action:38,role:1},{action:39,role:1},{action:40,role:1}],actions:e.actions.map(e=>({action:e,allowed:this._getRole(n5.Owner)||this._getRole(n5.Editor)}))};t.push(i)}}),t}async listCollaborators(){return[]}async listRoles(){return{roles:[],actions:[]}}async deleteCollaborator(){}async update(e){}async updateCollaborator(){}async createCollaborator(){}async putCollaborators(e){}};dH=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?dB(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([d$(0,dP),d$(1,(0,e2.Inject)(dj))],dH);let dW=(0,e2.createIdentifier)("IAuthzIoIoService"),dG=(0,e2.createIdentifier)("univer.config-service");class dY{constructor(){tg(this,"_configChanged$",new(0,ts.Subject)),tg(this,"configChanged$",this._configChanged$.asObservable()),tg(this,"_config",new Map)}dispose(){this._config.clear(),this._configChanged$.complete()}getConfig(e){return this._config.get(e)}setConfig(e,t,r){var n;let{merge:i=!1}=r||{},s=null!=(n=this._config.get(e))?n:{};s=i?nP(s,t):t,this._config.set(e,s),this._configChanged$.next({[e]:s})}deleteConfig(e){return this._config.delete(e)}subscribeConfigValue$(e){return new(0,tt.Observable)(t=>{Object.prototype.hasOwnProperty.call(this._config,e)&&t.next(this._config.get(e));let r=this.configChanged$.pipe((0,e9.filter)(t=>Object.prototype.hasOwnProperty.call(t,e))).subscribe(r=>t.next(r[e]));return()=>r.unsubscribe()})}}let dz="FOCUSING_UNIT",dX="FOCUSING_SHEET",dq="FOCUSING_DOC",dK="FOCUSING_SLIDE",dQ="FOCUSING_EDITOR_BUT_HIDDEN",dZ="EDITOR_ACTIVATED",dJ="FOCUSING_EDITOR_INPUT_FORMULA",d0="FOCUSING_FX_BAR_EDITOR",d1="FOCUSING_UNIVER_EDITOR",d2="FOCUSING_EDITOR_INPUT_FORMULA",d5="FOCUSING_PANEL_EDITOR",d3="FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",d4="FOCUSING_COMMON_DRAWINGS",d6="FORMULA_EDITOR_ACTIVATED";class d9 extends nJ{constructor(){super(...arguments),tg(this,"_error$",new(0,ts.Subject)),tg(this,"error$",this._error$.asObservable())}dispose(){this._error$.complete()}emit(e){this._error$.next({errorKey:e})}}var d8=((eB=d8||{}).URL="URL",eB.UUID="UUID",eB.BASE64="BASE64",eB),d7=((e$=d7||{}).SUCCUSS="0",e$.ERROR_EXCEED_SIZE="1",e$.ERROR_IMAGE_TYPE="2",e$.ERROR_UPLOAD_COUNT_LIMIT="3",e$.ERROR_IMAGE="4",e$);let me=(0,e2.createIdentifier)("core.image-io.service");class mt{constructor(e={}){tg(this,"_styles"),tg(this,"_cacheMap",new lK(1e5)),this._styles=e,this._generateCacheMap()}each(e){return Object.entries(this._styles).forEach(e),this}search(e,t){return this._cacheMap.has(t)?this._cacheMap.get(t):this._getExistingStyleId(e)||"-1"}get(e){return"string"!=typeof e?e:(e=String(e),this._styles[e])}add(e,t){let r=ii(6);return this._styles[r]=e,this._cacheMap.set(t,r),r}setValue(e){if(null==e)return;let t=JSON.stringify(e),r=this.search(e,t);return"-1"!==r?r:this.add(e,t)}toJSON(){return this._styles}getStyleByCell(e){let t;t=e&&ir.isObject(e.s)?e.s:(null==e?void 0:e.s)&&this.get(e.s);let r=null==e?void 0:e.interceptorStyle;return r?{...t,...r}:t}_generateCacheMap(){let{_styles:e,_cacheMap:t}=this;for(let r in e){let n=JSON.stringify(e[r]);t.set(n,r)}}_getExistingStyleId(e){let{_styles:t}=this;for(let r in t)if(ir.diffValue(t[r],e))return r;return null}}let mr=(e,t)=>t.length===e.length&&!e.some(e=>t.some(t=>!hm.equals(t,e))),mn=(e,t)=>t.length===e.length&&e.every((e,r)=>{let n=t[r];return n.unitId===e.unitId&&n.sheetId===e.sheetId&&hm.equals(e.range,n.range)}),mi={t:0,b:2,l:2,r:2};function ms(e,t,r={}){let n=e.length,{textRotation:i,paddingData:s,horizontalAlign:a=iO.UNSPECIFIED,verticalAlign:o=ix.UNSPECIFIED,wrapStrategy:l=iU.UNSPECIFIED,cellValueType:u}=r,{t:c,r:h,b:d,l:m}=s||mi,{vertexAngle:g,centerAngle:f}=mc(i);return new dg({id:"d",body:{dataStream:`${e}${tM}`,textRuns:[{ts:t,st:0,ed:n}],paragraphs:[{startIndex:n,paragraphStyle:{horizontalAlign:a}}],sectionBreaks:[{startIndex:n+1}]},documentStyle:{pageSize:{width:1/0,height:1/0},marginTop:c,marginBottom:d,marginRight:h,marginLeft:m,renderConfig:{horizontalAlign:a,verticalAlign:o,centerAngle:f,vertexAngle:g,wrapStrategy:l,cellValueType:u,zeroWidthParagraphBreak:1}},drawings:{},drawingsOrder:[]})}function ma(e){if(!e)return{};let{ff:t,fs:r,it:n,bl:i,ul:s,st:a,ol:o,cl:l}=e,u={};return t&&(u.ff=t),r&&(u.fs=r),n&&(u.it=n),i&&(u.bl=i),s&&(u.ul=s),a&&(u.st=a),o&&(u.ol=o),l&&(u.cl=l),u}function mo(e,t,r){var n;let i=e.getBody();if(null!=(n=i.customRanges)&&n.some(e=>e.rangeType===iG.HYPERLINK))return;let s=dI.customRange.add({ranges:[{startOffset:0,endOffset:i.dataStream.length-1,collapsed:!1}],rangeId:r,rangeType:iG.HYPERLINK,body:i,properties:{url:t,refId:r}});s&&dn.apply(i,s.serialize())}function ml(e){return null!=e}function mu(e){let t=cG.ff,r=cG.fs;if(!e){let e=`${r}pt  ${t}`;return{fontCache:e,fontString:e,fontSize:r,originFontSize:r,fontFamily:t}}let n=sr.ITALIC;(0===e.it||void 0===e.it)&&(n=sr.NORMAL);let i=sr.BOLD;(0===e.bl||void 0===e.bl)&&(i=sr.NORMAL);let s=r;e.fs&&(s=Math.ceil(e.fs));let a=t;if(e.ff){let r=e.ff;(r=r.replace(/"/g,"").replace(/'/g,"")).indexOf(" ")>-1&&(r=`"${r}"`),null==r&&(r=t),a=r}let{va:o}=e,l=s;if(o===iL.SUBSCRIPT||o===iL.SUPERSCRIPT){let{sbr:e,spr:t}=function(e,t){return{sbr:.6,sbo:t,spr:.6,spo:t}}(0,l);l*=o===iL.SUBSCRIPT?e:t}let u=`${n} ${i} ${l}pt ${a}`,c=`${u}, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif `;return{fontCache:u,fontString:c,fontSize:l,originFontSize:s,fontFamily:a}}function mc(e){let{a:t=0,v:r=iP.FALSE}=e||{a:0,v:iP.FALSE},n=0,i=t;return r===iP.TRUE&&(n=90,i=90),{centerAngle:n,vertexAngle:i}}class mh{constructor(e,t){tg(this,"_columnData",{}),this._config=e,this._columnData=t}getColumnData(){return this._columnData}getColVisible(e){let{_columnData:t}=this,r=t[e];return!r||r.hd!==iP.TRUE}getColumnStyle(e){var t;return null==(t=this._columnData[e])?void 0:t.s}setColumnStyle(e,t){this.getColumnOrCreate(e).s=t}getHiddenCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&e?(n=!1,r.push({rangeType:a0.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):n||e||(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:a0.COLUMN}),r}getVisibleCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&!e?(n=!1,r.push({rangeType:a0.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:a0.COLUMN}),r}getColumnDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getColumn(i);r[n]=null!=e?e:{w:this._config.defaultColumnWidth,hd:iP.FALSE},n++}return r}getSize(){return a8(this._columnData)}getColumnWidth(e){var t,r;return null!=(r=null==(t=this._columnData[e])?void 0:t.w)?r:this._config.defaultColumnWidth}setColumnWidth(e,t){let r=this._columnData[e];t===this._config.defaultColumnWidth?r&&(delete r.w,0===Object.keys(r).length&&delete this._columnData[e]):this._columnData[e]=r?{...r,w:t}:{w:t}}getColumn(e){return this._columnData[e]}removeColumn(e){delete this._columnData[e]}getColumnOrCreate(e){let{_columnData:t}=this,r=t[e];if(r)return r;let n={};return this._columnData[e]=n,n}setCustomMetadata(e,t){let r=this.getColumn(e);r&&(r.custom=t)}getCustomMetadata(e){var t;return null==(t=this.getColumn(e))?void 0:t.custom}}class md{constructor(e,t,r){tg(this,"_rowData"),this._config=e,this._viewModel=t,this._rowData=r}getRowData(){return this._rowData}getRowStyle(e){var t;return null==(t=this._rowData[e])?void 0:t.s}setRowStyle(e,t){this.getRowOrCreate(e).s=t}getRowDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getRow(i);r[n]=null!=e?e:{h:this._config.defaultRowHeight,hd:iP.FALSE},n++}return r}getRowHeight(e,t=1){let{_rowData:r}=this,n=this._config,i=0;for(let s=0;s<t;s++){let{ia:t,ah:a,h:o=n.defaultRowHeight}=r[s+e]||{hd:iP.FALSE,h:n.defaultRowHeight};i+=(null==t||t===iP.TRUE)&&"number"==typeof a?a:o}return i}setRowHeight(e,t){let r=this._rowData[e];if(t===this._config.defaultRowHeight)r&&(delete r.h,0===Object.keys(r).length&&delete this._rowData[e]);else{let n=Math.min(t,2e3);this._rowData[e]=r?{...r,h:n}:{h:n}}}getRow(e){return this._rowData[e]}removeRow(e){delete this._rowData[e]}getRowOrCreate(e){let{_rowData:t}=this,r=t[e];if(r)return r;let n={};return t[e]=n,n}getHiddenRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:a0.ROW})):n||e||(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:a0.ROW}),r}getVisibleRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&!e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:a0.ROW})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:a0.ROW}),r}getRowRawVisible(e){let t=this.getRow(e);return!t||t.hd!==iP.TRUE}getSize(){return a8(this._rowData)}setCustomMetadata(e,t){let r=this.getRow(e);r&&(r.custom=t)}getCustomMetadata(e){var t;return null==(t=this.getRow(e))?void 0:t.custom}}let mm="DEFAULT_WORKSHEET_ROW_COUNT",mg=1e3,mf="DEFAULT_WORKSHEET_COLUMN_COUNT",mp=20,mC="DEFAULT_WORKSHEET_ROW_HEIGHT",m_=24,my="DEFAULT_WORKSHEET_COLUMN_WIDTH",mR=88,mE="DEFAULT_WORKSHEET_ROW_TITLE_WIDTH",mb=46,mI="DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT",mN=20;function mS(e){let t={name:"Sheet1",id:"sheet-01",tabColor:"",hidden:iP.FALSE,rowCount:mg,columnCount:mp,zoomRatio:1,freeze:{xSplit:0,ySplit:0,startRow:-1,startColumn:-1},scrollTop:0,scrollLeft:0,defaultColumnWidth:mR,defaultRowHeight:m_,mergeData:[],cellData:{},rowData:{},columnData:{},showGridlines:iP.TRUE,rowHeader:{width:mb,hidden:iP.FALSE},columnHeader:{height:mN,hidden:iP.FALSE},rightToLeft:iP.FALSE};return Object.keys(t).forEach(r=>{typeof e[r]>"u"&&(e[r]=t[r])}),e}class mA extends nJ{constructor(e){super(),tg(this,"_cellCache",new Map),tg(this,"_rowCache",new Map),tg(this,"_columnCache",new Map),tg(this,"_hasRow",!1),tg(this,"_hasColumn",!1),tg(this,"_hasAll",!1),tg(this,"_allIndex",-1),tg(this,"_mergeData"),tg(this,"_rangeMap",new lK(5e4)),tg(this,"_skeletonCache",new lK(5e4)),this._init(e.concat())}_init(e){this._mergeData=e,this._createCache(e)}_clearCache(){this._cellCache.clear(),this._rowCache.clear(),this._columnCache.clear(),this._hasAll=!1,this._allIndex=-1,this._rangeMap.clear(),this._skeletonCache.clear(),this._hasColumn=!1,this._hasRow=!1}_createCache(e){let t=0;for(let r of e){let{rangeType:e}=r;e===a0.ROW?this._createRowCache(r,t):e===a0.COLUMN?this._createColumnCache(r,t):e===a0.ALL?this._createCellAllCache(t):this._createCellCache(r,t),t++}}rebuild(e){this._clearCache(),this._init(e.concat())}_createRowCache(e,t){let{startRow:r,endRow:n}=e;for(let e=r;e<=n;e++)this._rowCache.set(e,t),this._hasRow=!0}_createColumnCache(e,t){let{startColumn:r,endColumn:n}=e;for(let e=r;e<=n;e++)this._columnCache.set(e,t),this._hasColumn=!0}_createCellAllCache(e){this._hasAll=!0,this._allIndex=e}_createCellCache(e,t){for(let r=e.startRow;r<=e.endRow;r++){let n=this._cellCache.get(r);null==n&&(n=new Map,this._cellCache.set(r,n));for(let r=e.startColumn;r<=e.endColumn;r++)n.set(r,t)}}add(e){this._mergeData.push(e),this._clearCache(),this._createCache(this._mergeData)}remove(e,t){let r=this._getMergeDataIndex(e,t);-1!==r&&(this._mergeData.splice(r,1),this._clearCache(),this._createCache(this._mergeData))}getMergedCell(e,t){let r=this._getMergeDataIndex(e,t);return -1!==r?this._mergeData[r]:null}getMergeDataIndex(e,t){return this._getMergeDataIndex(e,t)}isRowContainsMergedCell(e){return!(!this._hasAll&&ir.isEmptyObject(this._columnCache))||this._mergeData.some(t=>t.startRow<=e&&e<=t.endRow)}isColumnContainsMergedCell(e){return!(!this._hasAll&&ir.isEmptyObject(this._rowCache))||this._mergeData.some(t=>t.startColumn<=e&&e<=t.endColumn)}getMergedCellRange(e,t,r,n){let i=[],s=`${e}-${t}-${r}-${n}`;if(this._rangeMap.has(s))return this._getRangeFromCache(s);let a=0,o=[];for(let s of this._mergeData||[])hm.intersects(s,{startRow:e,endRow:r,startColumn:t,endColumn:n})&&(i.push({...s}),o.push(a)),a++;return this._rangeMap.set(s,o),i}getMergedCellRangeForSkeleton(e,t,r,n){let i=[],s=this._mergeData,a=`${e}-${t}-${r}-${n}`;if(this._skeletonCache.has(a))return this._getSkeletonRangeFromCache(a);let o=[];for(let a=0;a<s.length;a++){let{startRow:l,endRow:u,startColumn:c,endColumn:h}=s[a];for(let s=e;s<=r;s++){let e=!1;for(let r=t;r<=n;r++)if(s>=l&&s<=u&&r>=c&&r<=h){i.push({startRow:l,endRow:u,startColumn:c,endColumn:h}),o.push(a),e=!0;break}if(e)break}}return this._skeletonCache.set(a,o),i}_getRangeFromCache(e){let t=this._rangeMap.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getSkeletonRangeFromCache(e){let t=this._skeletonCache.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getMergeDataIndex(e,t){var r;if(this._hasAll)return this._allIndex;if(this._hasRow){let t=this._rowCache.get(e);if(void 0!==t)return t}if(this._hasColumn){let e=this._columnCache.get(t);if(void 0!==e)return e}let n=null==(r=this._cellCache.get(e))?void 0:r.get(t);return void 0!==n?n:-1}getMergeDataSnapshot(){return this._mergeData}dispose(){this._clearCache(),this._mergeData=[]}}class mv extends nJ{constructor(e){super(),tg(this,"_cellContentInterceptor",null),tg(this,"_rowFilteredInterceptor",null),this.getRawCell=e}dispose(){super.dispose(),this._cellContentInterceptor=null,this._rowFilteredInterceptor=null}getCell(e,t,r,n){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,tB.Value|tB.Style,r,n):this.getRawCell(e,t)}getCellValueOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,tB.Value):this.getRawCell(e,t)}getCellStyleOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,tB.Style):this.getRawCell(e,t)}getRowFiltered(e){var t,r;return null!=(r=null==(t=this._rowFilteredInterceptor)?void 0:t.getRowFiltered(e))&&r}registerCellContentInterceptor(e){if(this._cellContentInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._cellContentInterceptor=e,nK(()=>this._cellContentInterceptor=null)}registerRowFilteredInterceptor(e){if(this._rowFilteredInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._rowFilteredInterceptor=e,nK(()=>this._rowFilteredInterceptor=null)}}let mT={isDeepClone:!1,displayRawFormula:!1,ignoreTextRotation:!1};class mw{constructor(e,t,r){var n;tg(this,"_sheetId"),tg(this,"_snapshot"),tg(this,"_cellData"),tg(this,"_rowManager"),tg(this,"_columnManager"),tg(this,"_viewModel"),tg(this,"_spanModel"),tg(this,"_isRowStylePrecedeColumnStyle",!0),tg(this,"_getCellHeight"),this.unitId=e,this._styles=r,this._snapshot=mS(t);let{columnData:i,rowData:s,cellData:a}=this._snapshot;this._sheetId=null!=(n=this._snapshot.id)?n:ii(6),this._cellData=new oi(a),this._viewModel=new mv((e,t)=>this.getCellRaw(e,t)),this._rowManager=new md(this._snapshot,this._viewModel,s),this._columnManager=new mh(this._snapshot,i),this._spanModel=new mA(this._snapshot.mergeData)}__interceptViewModel(e){e(this._viewModel)}__registerGetCellHeight(e){return this._getCellHeight=e,nK(()=>{this._getCellHeight=null})}getSnapshot(){return this._snapshot}getCellHeight(e,t){return this._getCellHeight?this._getCellHeight(e,t):this._snapshot.defaultRowHeight}setMergeData(e){this._snapshot.mergeData=e,this.getSpanModel().rebuild(e)}getSpanModel(){return this._spanModel}setIsRowStylePrecedeColumnStyle(e){this._isRowStylePrecedeColumnStyle=e}getStyleDataByHash(e){return{...this._styles.get(e)}}setStyleData(e){return this._styles.setValue(e)}getColumnStyle(e,t=!1){return t?this._columnManager.getColumnStyle(e):this._styles.get(this._columnManager.getColumnStyle(e))}setColumnStyle(e,t){this._columnManager.setColumnStyle(e,t)}getRowStyle(e,t=!1){return t?this._rowManager.getRowStyle(e):this._styles.get(this._rowManager.getRowStyle(e))}setRowStyle(e,t){this._rowManager.setRowStyle(e,t)}getDefaultCellStyle(){return this._snapshot.defaultStyle}getDefaultCellStyleInternal(){let e=this._snapshot.defaultStyle;return this._styles.get(e)}setDefaultCellStyle(e){this._snapshot.defaultStyle=e}getCellStyle(e,t){let r=this.getCell(e,t);if(r){let e=r.s;return"string"==typeof e?this._styles.get(e):e}return null}getComposedCellStyle(e,t,r){let n=this.getDefaultCellStyleInternal(),i=this.getRowStyle(e),s=this.getColumnStyle(t),a=this.getCell(e,t),o=this._styles.getStyleByCell(a);return(null!=r?r:this._isRowStylePrecedeColumnStyle)?is(n,s,i,null==a?void 0:a.themeStyle,o):is(n,i,s,null==a?void 0:a.themeStyle,o)}getComposedCellStyleByCellData(e,t,r,n){let i=this.getDefaultCellStyleInternal(),s=this.getRowStyle(e),a=this.getColumnStyle(t),o=this._styles.getStyleByCell(r);return(null!=n?n:this._isRowStylePrecedeColumnStyle)?is(i,a,s,null==r?void 0:r.themeStyle,o):is(i,s,a,null==r?void 0:r.themeStyle,o)}getCellMatrix(){return this._cellData}getCellMatrixPrintRange(){let e=this.getCellMatrix(),t=this.getMergeData(),r=-1,n=-1,i=-1,s=-1,a=!1,o=!1;return e.forEach((t,l)=>{Object.keys(l).forEach(l=>{let u=+l,c=e.getValue(t,u),h=null!=c&&c.s?this._styles.get(c.s):null,d=(null==h?void 0:h.bd)&&(h.bd.b||h.bd.l||h.bd.r||h.bd.t||h.bd.bc_tr||h.bd.bl_tr||h.bd.ml_tr||h.bd.tl_bc||h.bd.tl_br||h.bd.tl_mr);(c&&(c.v||c.p)||null!=h&&h.bg||d)&&(a?r=Math.min(r,t):(r=t,a=!0),n=Math.max(n,t),o?i=Math.min(i,u):(o=!0,i=u),s=Math.max(s,u))})}),t.forEach(e=>{a?r=Math.min(r,e.startRow):(r=e.startRow,a=!0),n=Math.max(n,e.endRow),o?i=Math.min(i,e.startColumn):(i=e.startColumn,a=!0),s=Math.max(s,e.endColumn)}),a&&o?{startColumn:i,startRow:r,endColumn:s,endRow:n}:null}getRowManager(){return this._rowManager}getUnitId(){return this.unitId}getSheetId(){return this._sheetId}getColumnManager(){return this._columnManager}getName(){return this._snapshot.name}clone(){let{_snapshot:e}=this,t=ir.deepClone(e);return new mw(this.unitId,t,this._styles)}getMergeData(){return this._spanModel.getMergeDataSnapshot()}getMergedCell(e,t){return this._spanModel.getMergedCell(e,t)}getMergedCellRange(e,t,r,n){return this._spanModel.getMergedCellRange(e,t,r,n)}isRowContainsMergedCell(e){return this._spanModel.isRowContainsMergedCell(e)}isColumnContainsMergedCell(e){return this._spanModel.isColumnContainsMergedCell(e)}getCellInfoInMergeData(e,t){let r=this.getMergedCell(e,t),n=!1,i=!1,s=e,a=t,o=e,l=t;if(r){let{startRow:u,endRow:c,startColumn:h,endColumn:d}=r;e===u&&t===h?(s=c,a=d,o=u,l=h,i=!0):e>=u&&e<=c&&t>=h&&t<=d&&(s=c,a=d,o=u,l=h,n=!0)}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}getCell(e,t){return e<0||t<0?null:this._viewModel.getCell(e,t)}getCellValueOnly(e,t){return e<0||t<0?null:this._viewModel.getCellValueOnly(e,t)}getCellStyleOnly(e,t){return e<0||t<0?null:this._viewModel.getCellStyleOnly(e,t)}getCellRaw(e,t){return this.getCellMatrix().getValue(e,t)}getCellWithFilteredInterceptors(e,t,r,n){return this._viewModel.getCell(e,t,r,n)}getRowFiltered(e){return this._viewModel.getRowFiltered(e)}getRangeFilterRows(e){let t=[];for(let r=e.startRow;r<=e.endRow;r++)this.getRowFiltered(r)&&t.push(r);return t}getMatrixWithMergedCells(e,t,r,n,i=a6.Raw){let s=this.getCellMatrix(),a=this._spanModel.getMergedCellRange(e,t,r,n),o=new oi;return hp(e,r,t,n).forEach((e,t)=>{var r;let n;if(i===a6.Raw)n=this.getCellRaw(e,t);else if(i===a6.Intercepted)n=this.getCell(e,t);else if(i===a6.Both){let i=this.getCellRaw(e,t);if(i){n={...i};let s=null==(r=this.getCell(e,t))?void 0:r.v;ml(s)&&n&&(n.displayV=String(s))}}n&&o.setValue(e,t,n)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;hp(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),rowSpan:i-r+1,colSpan:n-t+1}),(e!==r||a!==t)&&o.realDeleteValue(e,a)})}),o}getRange(e,t,r,n){return"object"==typeof e?new c2(this,e,{getStyles:()=>this._styles}):new c2(this,{startRow:e,startColumn:t,endColumn:n||t,endRow:r||e},{getStyles:()=>this._styles})}getScrollLeftTopFromSnapshot(){return{scrollLeft:this._snapshot.scrollLeft,scrollTop:this._snapshot.scrollTop}}getZoomRatio(){return this._snapshot.zoomRatio||1}getConfig(){return this._snapshot}getFreeze(){return this._snapshot.freeze}getMaxColumns(){let{_snapshot:e}=this,{columnCount:t}=e;return t}getMaxRows(){let{_snapshot:e}=this,{rowCount:t}=e;return t}getRowCount(){return this._snapshot.rowCount}setRowCount(e){this._snapshot.rowCount=e}getColumnCount(){return this._snapshot.columnCount}setColumnCount(e){this._snapshot.columnCount=e}isSheetHidden(){return this._snapshot.hidden}hasHiddenGridlines(){let{_snapshot:e}=this,{showGridlines:t}=e;return 0===t}getGridlinesColor(){return this.getConfig().gridlinesColor}getTabColor(){let{_snapshot:e}=this,{tabColor:t}=e;return t}getColumnWidth(e){return this.getColumnManager().getColumnWidth(e)}getRowHeight(e){return this._viewModel.getRowFiltered(e)?0:this.getRowManager().getRowHeight(e)}isRowFiltered(e){return this._viewModel.getRowFiltered(e)}getRowVisible(e){return!this.isRowFiltered(e)&&this.getRowRawVisible(e)}getRowRawVisible(e){return this.getRowManager().getRowRawVisible(e)}getHiddenRows(e,t){let r=this.getMaxColumns()-1,n=this._rowManager.getHiddenRows(e,t);return n.forEach(e=>e.endColumn=r),n}getColVisible(e){return this._columnManager.getColVisible(e)}getHiddenCols(e,t){let r=this.getMaxRows()-1,n=this._columnManager.getHiddenCols(e,t);return n.forEach(e=>e.endRow=r),n}getVisibleRows(){let e=this.getRowCount();return this._rowManager.getVisibleRows(0,e-1)}getVisibleCols(){let e=this.getColumnCount();return this._columnManager.getVisibleCols(0,e-1)}isRightToLeft(){let{_snapshot:e}=this,{rightToLeft:t}=e;return t}getLastRowWithContent(){return this._cellData.getLength()-1}getLastColumnWithContent(){return this._cellData.getRange().endColumn}getDataRangeScope(){return this._cellData.getStartEndScope()}cellHasValue(e){return e&&(void 0!==e.v||void 0!==e.f||void 0!==e.p)}iterateByRow(e,t=!0){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e,a=this;return{[Symbol.iterator]:()=>{let e=r,o=n;return{next(){for(;;){if(o>s&&(e+=1,o=n),e>i)return{done:!0,value:void 0};let r=a.getCell(e,o),l=!r,u=a.getMergedCell(e,o);if(u){if(e!==u.startRow||o!==u.startColumn||l&&t){o=u.endColumn+1;continue}let n={row:e,col:o,value:r};return n.colSpan=u.endColumn-u.startColumn+1,n.rowSpan=u.endRow-u.startRow+1,o=u.endColumn+1,{done:!1,value:n}}if(l&&t)o+=1;else{let t={row:e,col:o,value:r};return o+=1,{done:!1,value:t}}}}}}}}iterateByColumn(e,t=!0,r=!0){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e,o=this;return{[Symbol.iterator]:()=>{let e=n,l=i;return{next(){for(;;){if(e>s&&(l+=1,e=n),l>a)return{done:!0,value:void 0};let i=o.getMergedCell(e,l);if(i){let n=e!==i.startRow,s=n||l!==i.startColumn;if(r&&s||!r&&n){e=i.endRow+1;continue}let a=o.getCell(i.startRow,i.startColumn);if(!a&&t){e=i.endRow+1;continue}let u={row:e,col:i.startColumn,value:a};return u.colSpan=i.endColumn-i.startColumn+1,u.rowSpan=i.endRow-i.startRow+1,e=i.endRow+1,{done:!1,value:u}}let u=o.getCell(e,l);if(!u&&t)e+=1;else{let t={row:e,col:l,value:u};return e+=1,{done:!1,value:t}}}}}}}}getCellDocumentModel(e,t,r=mT){var n;if(!e)return;let{isDeepClone:i,displayRawFormula:s,ignoreTextRotation:a}={...mT,...r},o,l="document",u=function(e){if(!e)return{};let{tr:t,td:r,ht:n,vt:i,tb:s,pd:a}=e;return{textRotation:t,textDirection:r,horizontalAlign:n,verticalAlign:i,wrapStrategy:s,paddingData:a}}(t),c=a?cG.tr:u.textRotation||cG.tr,h=u.horizontalAlign||cG.ht,d=u.verticalAlign||cG.vt,m=u.wrapStrategy||cG.tb,g=u.paddingData||mi;if(e.f&&s)o=ms(e.f.toString(),{},{verticalAlign:d}),h=cG.ht;else if(e.p){let{centerAngle:t,vertexAngle:r}=mc(c);o=this._updateConfigAndGetDocumentModel(i?ir.deepClone(e.p):e.p,h,g,{horizontalAlign:h,verticalAlign:d,centerAngle:t,vertexAngle:r,wrapStrategy:m,zeroWidthParagraphBreak:1})}else if(null!=e.v){let r=ma(t);l=mu(r).fontCache;let n=mM(e);e.t===ik.FORCE_STRING&&s&&(n=`'${n}`),o=ms(n,r,{...u,textRotation:c,cellValueType:e.t})}return o&&e.linkUrl&&e.linkId&&mo(o,e.linkUrl,e.linkId),{documentModel:o,fontString:l,textRotation:c,wrapStrategy:m,verticalAlign:d,horizontalAlign:h,paddingData:g,fill:null==(n=null==t?void 0:t.bg)?void 0:n.rgb}}_updateConfigAndGetDocumentModel(e,t,r,n){var i,s,a,o,l;if(n&&null!=(i=e.body)&&i.dataStream){for(let i of(e.documentStyle||(e.documentStyle={}),e.documentStyle.marginTop=null!=(s=r.t)?s:0,e.documentStyle.marginBottom=null!=(a=r.b)?a:2,e.documentStyle.marginLeft=null!=(o=r.l)?o:2,e.documentStyle.marginRight=null!=(l=r.r)?l:2,e.documentStyle.pageSize={width:1/0,height:1/0},e.documentStyle.renderConfig={...e.documentStyle.renderConfig,...n},e.body.paragraphs||[]))i.paragraphStyle||(i.paragraphStyle={}),i.paragraphStyle.horizontalAlign=t;return new dg(e)}}getBlankCellDocumentModel(e,t,r){let n=this.getComposedCellStyleByCellData(t,r,e),i=ma(n),s=this.getCellDocumentModel(e,n,{ignoreTextRotation:!0});if(null!=s)return null==s.documentModel&&(s.documentModel=ms("",i)),s;let a="document",o=cG.tr,l=cG.ht,u=cG.vt,c=cG.tb;return a=mu({}).fontCache,{documentModel:ms("",i),fontString:a,textRotation:o,wrapStrategy:c,verticalAlign:u,horizontalAlign:l,paddingData:mi}}getCellDocumentModelWithFormula(e,t,r){let n=this.getComposedCellStyleByCellData(t,r,e);return this.getCellDocumentModel(e,n,{isDeepClone:!0,displayRawFormula:!0,ignoreTextRotation:!0})}getCustomMetadata(){return this._snapshot.custom}setCustomMetadata(e){this._snapshot.custom=e}}function mM(e){var t,r;if(!e)return"";let n=null==(r=null==(t=e.p)?void 0:t.body)?void 0:r.dataStream;if(n)return dI.transform.getPlainText(n);let i=e.v;return"string"==typeof i?e.t===ik.BOOLEAN?i.toUpperCase():i.replace(/[\r\n]/g,""):"number"==typeof i?e.t===ik.BOOLEAN?i?"TRUE":"FALSE":i.toString():"boolean"==typeof i?i?"TRUE":"FALSE":""}function mO(e){if(null===e)return"";if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return"";let r=t.dataStream;return dI.transform.getPlainText(r)}return null==e?void 0:e.v}var mx=Object.getOwnPropertyDescriptor;function mU(e,t){return`${e.getUnitId()}|${t.getSheetId()}`}let mD=class extends n4{constructor(e={},t){super(),tg(this,"type",n2.UNIVER_SHEET),tg(this,"_sheetCreated$",new(0,ts.Subject)),tg(this,"sheetCreated$",this._sheetCreated$.asObservable()),tg(this,"_sheetDisposed$",new(0,ts.Subject)),tg(this,"sheetDisposed$",this._sheetDisposed$.asObservable()),tg(this,"_activeSheet$",new(0,e5.BehaviorSubject)(null)),tg(this,"activeSheet$",this._activeSheet$.asObservable()),tg(this,"_worksheets"),tg(this,"_styles"),tg(this,"_snapshot"),tg(this,"_unitId"),tg(this,"_count"),tg(this,"_name$"),tg(this,"name$"),this._logService=t;let r=function(e="",t=iR.ZH_CN,r=""){return{id:e,sheetOrder:[],name:r,appVersion:"0.10.2",locale:t,styles:{},sheets:{},resources:[]}}();ir.isEmptyObject(e)?this._snapshot=r:this._snapshot=ir.commonExtend(r,e);let{styles:n}=this._snapshot;(null==this._snapshot.id||0===this._snapshot.id.length)&&(this._snapshot.id=ii(6)),this._unitId=this._snapshot.id,this._styles=new mt(n),this._count=1,this._worksheets=new Map,this._name$=new(0,e5.BehaviorSubject)(e.name||""),this.name$=this._name$.asObservable(),this._parseWorksheetSnapshots()}get _activeSheet(){return this._activeSheet$.getValue()}get name(){return this._name$.getValue()}static isIRangeType(e){return"string"==typeof e||"startRow"in e||"row"in e}dispose(){super.dispose(),this._sheetCreated$.complete(),this._sheetDisposed$.complete(),this._activeSheet$.complete(),this._name$.complete()}save(){return ir.deepClone(this._snapshot)}getSnapshot(){return this._snapshot}getName(){return this._snapshot.name}setName(e){this._name$.next(e),this._snapshot.name=e}getUnitId(){return this._unitId}getRev(){var e;return null!=(e=this._snapshot.rev)?e:1}incrementRev(){this._snapshot.rev=this.getRev()+1}setRev(e){this._snapshot.rev=e}addWorksheet(e,t,r){let{sheets:n,sheetOrder:i}=this._snapshot;if(n[e])return!1;n[e]=r,i.splice(t,0,e);let s=new mw(this._unitId,r,this._styles);return this._worksheets.set(e,s),this._sheetCreated$.next(s),!0}getSheetOrders(){return this._snapshot.sheetOrder}getWorksheets(){return this._worksheets}getActiveSpreadsheet(){return this}getStyles(){return this._styles}getConfig(){return this._snapshot}getIndexBySheetId(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>t===e)}getActiveSheet(e){if(!this._activeSheet&&typeof e>"u")throw Error(`[Workbook]: no active Worksheet on Workbook ${this._unitId}!`);return this._activeSheet}ensureActiveSheet(){let e=this._activeSheet;if(e)return e;let t=this._snapshot.sheetOrder;for(let e=0,r=t.length;e<r;e++){let r=this._worksheets.get(t[e]);if(r&&r.isSheetHidden()!==iP.TRUE)return this.setActiveSheet(r),r}let r=this._worksheets.get(t[0]);return this.setActiveSheet(r),r}setActiveSheet(e){this._activeSheet$.next(e)}removeSheet(e){let t=this._worksheets.get(e);return!!t&&(this._worksheets.delete(e),this._snapshot.sheetOrder.splice(this._snapshot.sheetOrder.indexOf(e),1),delete this._snapshot.sheets[e],this._sheetDisposed$.next(t),!0)}getActiveSheetIndex(){let{sheetOrder:e}=this._snapshot;return e.findIndex(e=>this._worksheets.get(e)===this._activeSheet)}getSheetSize(){return this._snapshot.sheetOrder.length}getSheets(){let{sheetOrder:e}=this._snapshot;return e.map(e=>this._worksheets.get(e))}getSheetsName(){let{sheetOrder:e}=this._snapshot,t=[];return e.forEach(e=>{let r=this._worksheets.get(e);r&&t.push(r.getName())}),t}getSheetIndex(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>e.getSheetId()===t)}getSheetBySheetName(e){let{sheetOrder:t}=this._snapshot,r=t.find(t=>this._worksheets.get(t).getName()===e);return this._worksheets.get(r)}getSheetBySheetId(e){return this._worksheets.get(e)}getSheetByIndex(e){let{sheetOrder:t}=this._snapshot;return this._worksheets.get(t[e])}getHiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden===iP.TRUE).map(e=>e.getConfig().id)}getUnhiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden!==iP.TRUE).map(e=>e.getConfig().id)}load(e){this._snapshot=e}checkSheetName(e){return this.getSheetsName().includes(e)}uniqueSheetName(e="Sheet1"){let t=e;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}generateNewSheetName(e){let t=e+this._count;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}_parseWorksheetSnapshots(){let{_snapshot:e,_worksheets:t}=this,{sheets:r,sheetOrder:n}=e;if(ir.isEmptyObject(r)){let e=ii();r[e]={id:e}}for(let e in r){let i=r[e],{name:s}=i;i.name=this.uniqueSheetName(s),i.name!==s&&this._logService.debug("[Workbook]",`The worksheet name ${s} is duplicated, we changed it to ${i.name}. Please fix the problem in your snapshot.`);let a=new mw(this._unitId,i,this._styles);t.set(e,a),n.includes(e)||n.push(e)}this.ensureActiveSheet()}getCustomMetadata(){return this._snapshot.custom}setCustomMetadata(e){this._snapshot.custom=e}};mD=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?mx(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>s5(e,t,1)],mD);class mV extends n4{constructor(e){var t;super(),tg(this,"type",n2.UNIVER_SLIDE),tg(this,"_activePage$",new(0,e5.BehaviorSubject)(null)),tg(this,"activePage$",this._activePage$.asObservable()),tg(this,"_name$"),tg(this,"name$"),tg(this,"_snapshot"),tg(this,"_unitId"),this._snapshot={...cY,...e},this._unitId=null!=(t=this._snapshot.id)?t:ii(6),this._name$=new(0,e5.BehaviorSubject)(this._snapshot.title),this.name$=this._name$.asObservable()}get _activePage(){var e,t;let r=this._activePage$.getValue();if(!r){let r=null==(e=this.getPageOrder())?void 0:e[0];return r?null==(t=this.getPages())?void 0:t[r]:null}return r}setName(e){var t;this._snapshot.title=e,this._name$.next(e),this._unitId=null!=(t=this._snapshot.id)?t:ii(6)}getRev(){return 0}incrementRev(){}setRev(e){}getSnapshot(){return this._snapshot}getUnitId(){return this._unitId}getPages(){var e;return null==(e=this._snapshot.body)?void 0:e.pages}getPageOrder(){var e;return null==(e=this._snapshot.body)?void 0:e.pageOrder}getPage(e){let t=this.getPages();return null==t?void 0:t[e]}getElementsByPage(e){var t;return null==(t=this.getPage(e))?void 0:t.pageElements}getElement(e,t){var r;return null==(r=this.getElementsByPage(e))?void 0:r[t]}getPageSize(){return this._snapshot.pageSize}getBlankPage(){let e=ii(6);return{id:e,pageType:sw.SLIDE,zIndex:10,title:e,description:"",pageBackgroundFill:{rgb:"rgb(255,255,255)"},pageElements:{}}}setActivePage(e){this._activePage$.next(e)}getActivePage(){return this._activePage}updatePage(e,t){this._snapshot.body&&(this._snapshot.body.pages[e]=t)}appendPage(e){var t;if(!this._snapshot.body)return;this._snapshot.body.pages[e.id]=e;let r=this._activePage,n=this._snapshot.body.pageOrder.indexOf(null!=(t=null==r?void 0:r.id)?t:"");this._snapshot.body.pageOrder.splice(n+1,0,e.id)}}var mL=Object.getOwnPropertyDescriptor,mP=(e,t)=>(r,n)=>t(r,n,e);let mk=(0,e2.createIdentifier)("univer.current"),mF=class extends nJ{constructor(e,t){super(),tg(this,"_unitsByType",new Map),tg(this,"_createHandler"),tg(this,"_ctorByType",new Map),tg(this,"_currentUnits",new Map),tg(this,"_currentUnits$",new(0,e5.BehaviorSubject)(this._currentUnits)),tg(this,"currentUnits$",this._currentUnits$.asObservable()),tg(this,"_unitAdded$",new(0,ts.Subject)),tg(this,"unitAdded$",this._unitAdded$.asObservable()),tg(this,"_unitDisposed$",new(0,ts.Subject)),tg(this,"unitDisposed$",this._unitDisposed$.asObservable()),tg(this,"_focused$",new(0,e5.BehaviorSubject)(null)),tg(this,"focused$",this._focused$.asObservable()),this._injector=e,this._contextService=t}dispose(){super.dispose(),this._focused$.complete()}__setCreateHandler(e){this._createHandler=e}createUnit(e,t,r){return this._createHandler(e,t,this._ctorByType.get(e),r)}registerCtorForType(e,t){return this._ctorByType.set(e,t),{dispose:()=>{this._ctorByType.delete(e)}}}getCurrentTypeOfUnit$(e){return this.currentUnits$.pipe((0,e7.map)(t=>{var r;return null!=(r=t.get(e))?r:null}),(0,e6.distinctUntilChanged)())}getCurrentUnitForType(e){return this._currentUnits.get(e)}getCurrentUnitOfType(e){return this.getCurrentUnitForType(e)}setCurrentUnitForType(e){let t=this._getUnitById(e);if(!t)throw Error(`[UniverInstanceService]: no document with unitId ${e}!`);this._currentUnits.set(t[1],t[0]),this._currentUnits$.next(this._currentUnits)}getTypeOfUnitAdded$(e){return this._unitAdded$.pipe((0,e9.filter)(t=>t.type===e))}__addUnit(e,t){var r;let n=e.type;this._unitsByType.has(n)||this._unitsByType.set(n,[]);let i=this._unitsByType.get(n),s=e.getUnitId();if(-1!==i.findIndex(e=>e.getUnitId()===s))throw Error(`[UniverInstanceService]: cannot create a unit with the same unit id: ${s}.`);i.push(e),this._unitAdded$.next(e),(null==(r=null==t?void 0:t.makeCurrent)||r)&&this.setCurrentUnitForType(e.getUnitId())}getTypeOfUnitDisposed$(e){return this.unitDisposed$.pipe((0,e9.filter)(t=>t.type===e))}getUnit(e,t){var r;let n=null==(r=this._getUnitById(e))?void 0:r[0];return t&&(null==n?void 0:n.type)!==t?null:n}getCurrentUniverDocInstance(){return this.getCurrentUnitForType(n2.UNIVER_DOC)}getUniverDocInstance(e){return this.getUnit(e,n2.UNIVER_DOC)}getUniverSheetInstance(e){return this.getUnit(e,n2.UNIVER_SHEET)}getAllUnitsForType(e){var t;return null!=(t=this._unitsByType.get(e))?t:[]}changeDoc(e,t){let r=this.getAllUnitsForType(n2.UNIVER_DOC),n=r.find(t=>t.getUnitId()===e);if(null!=n){let e=r.indexOf(n);r.splice(e,1)}this.__addUnit(t)}get focused(){var e;let t=this._focused$.getValue();return t?null==(e=this._getUnitById(t))?void 0:e[0]:null}focusUnit(e){this._focused$.next(e),this.focused instanceof mD?(this._contextService.setContextValue(dz,!0),this._contextService.setContextValue(dq,!1),this._contextService.setContextValue(dX,!0),this._contextService.setContextValue(dK,!1),this.setCurrentUnitForType(e)):this.focused instanceof dg?(this._contextService.setContextValue(dz,!0),this._contextService.setContextValue(dq,!0),this._contextService.setContextValue(dX,!1),this._contextService.setContextValue(dK,!1),this.setCurrentUnitForType(e)):this.focused instanceof mV?(this._contextService.setContextValue(dz,!0),this._contextService.setContextValue(dq,!1),this._contextService.setContextValue(dX,!1),this._contextService.setContextValue(dK,!0),this.setCurrentUnitForType(e)):(this._contextService.setContextValue(dz,!1),this._contextService.setContextValue(dq,!1),this._contextService.setContextValue(dX,!1),this._contextService.setContextValue(dK,!1))}getFocusedUnit(){return this.focused}getUnitType(e){let t=this._getUnitById(e);return t?t[1]:n2.UNRECOGNIZED}disposeUnit(e){let t=this._getUnitById(e);if(!t)return!1;let[r,n]=t,i=this._unitsByType.get(n),s=i.indexOf(r);return i.splice(s,1),this._tryResetCurrentOnRemoval(e,n),this._tryResetFocusOnRemoval(e),this._unitDisposed$.next(r),!0}_tryResetCurrentOnRemoval(e,t){let r=this.getCurrentUnitForType(t);(null==r?void 0:r.getUnitId())===e&&(this._currentUnits.set(t,null),this._currentUnits$.next(this._currentUnits))}_tryResetFocusOnRemoval(e){var t;(null==(t=this.focused)?void 0:t.getUnitId())===e&&this._focused$.next(null)}_getUnitById(e){for(let[t,r]of this._unitsByType){let n=r.find(t=>t.getUnitId()===e);if(n)return[n,t]}}};mF=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?mL(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([mP(0,(0,e2.Inject)(e2.Injector)),mP(1,s0)],mF);var mj=((eH=mj||{})[eH.Starting=0]="Starting",eH[eH.Ready=1]="Ready",eH[eH.Rendered=2]="Rendered",eH[eH.Steady=3]="Steady",eH);let mB={0:"Starting",1:"Ready",2:"Rendered",3:"Steady"};var m$=Object.getOwnPropertyDescriptor;class mH extends Error{constructor(e){super(`[LifecycleService]: lifecycle stage "${mB[e]}" will never be reached!`),this.name="LifecycleUnreachableError"}}let mW=class extends nJ{constructor(e){super(),tg(this,"_lifecycle$",new(0,e5.BehaviorSubject)(mj.Starting)),tg(this,"lifecycle$",this._lifecycle$.asObservable()),tg(this,"_lock",!1),this._logService=e,this._reportProgress(mj.Starting)}get stage(){return this._lifecycle$.getValue()}set stage(e){if(this._lock)throw Error("[LifecycleService]: cannot set new stage when related logic is all handled!");if(e<this.stage)throw Error("[LifecycleService]: lifecycle stage cannot go backward!");e!==this.stage&&(this._lock=!0,this._reportProgress(e),this._lifecycle$.next(e),this._lock=!1)}dispose(){this._lifecycle$.complete(),super.dispose()}onStage(e){return(0,e8.firstValueFrom)(this.lifecycle$.pipe((0,e9.filter)(t=>t>=e),aa(t=>t===e),(0,e7.map)(()=>{}))).catch(t=>"EmptyError"===t.name?Promise.reject(new mH(e)):Promise.reject(t))}subscribeWithPrevious(){return(0,te.merge)(mG(this.stage),this._lifecycle$.pipe((0,ti.skip)(1))).pipe(aa(e=>e===mj.Steady))}_reportProgress(e){this._logService.debug("[LifecycleService]",`lifecycle progressed to "${mB[e]}".`)}};function mG(e){switch(e){case mj.Starting:return(0,tr.of)(mj.Starting);case mj.Ready:return(0,tr.of)(mj.Starting,mj.Ready);case mj.Rendered:return(0,tr.of)(mj.Starting,mj.Ready,mj.Rendered);default:return(0,tr.of)(mj.Starting,mj.Ready,mj.Rendered,mj.Steady)}}mW=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?m$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>s5(e,t,0)],mW);let mY=(0,e2.createIdentifier)("ILocalStorageService");class mz extends nJ{constructor(){super(),tg(this,"_currentLocale$",new(0,e5.BehaviorSubject)(iR.ZH_CN)),tg(this,"currentLocale$",this._currentLocale$.asObservable()),tg(this,"_locales",null),tg(this,"localeChanged$",new(0,ts.Subject)),tg(this,"t",(e,...t)=>{if(!this._locales)throw Error("[LocaleService]: Locale not initialized");let r=e.split("."),n=this.resolveKeyPath(this._locales[this._currentLocale],r);if("string"!=typeof n)return e;{let e=n;return t.forEach((t,r)=>{e=e.replace(`{${r}}`,t)}),e}}),this.disposeWithMe(nK(()=>{this._locales=null,this._currentLocale$.complete(),this.localeChanged$.complete()}))}get _currentLocale(){return this._currentLocale$.value}load(e){var t;this._locales=nP(null!=(t=this._locales)?t:{},e)}setLocale(e){this._currentLocale$.next(e),this.localeChanged$.next()}getLocales(){var e;return null==(e=this._locales)?void 0:e[this._currentLocale]}getCurrentLocale(){return this._currentLocale}resolveKeyPath(e,t){let r=t.shift();if(r&&e&&r in e){let n=e[r];return t.length>0&&("object"==typeof n||Array.isArray(n))?this.resolveKeyPath(n,t):n}return null}}var mX=Object.getOwnPropertyDescriptor;let mq=class{constructor(e){this._userManagerService=e}async list(e){return{list:[{type:iE.PERSON,mentions:[{objectType:iE.PERSON,objectId:this._userManagerService.getCurrentUser().userID,label:this._userManagerService.getCurrentUser().name,metadata:{icon:this._userManagerService.getCurrentUser().avatar}}],metadata:{},title:"PEOPLE"}],page:e.page,size:e.size,total:1}}};mq=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?mX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(eW=(0,e2.Inject)(dj),(e,t)=>eW(e,t,0))],mq);let mK=(0,e2.createIdentifier)("univer.service.mention-io");var mQ=((eG=mQ||{}).INIT="init",eG.FETCHING="fetching",eG.DONE="done",eG);let mZ=(0,e2.createIdentifier)("univer.permission-service");class mJ extends nJ{constructor(){super(...arguments),tg(this,"_permissionPointMap",new Map),tg(this,"_permissionPointUpdate$",new(0,ts.Subject)),tg(this,"permissionPointUpdate$",this._permissionPointUpdate$.asObservable()),tg(this,"_showComponents",!0)}setShowComponents(e){this._showComponents=e}getShowComponents(){return this._showComponents}deletePermissionPoint(e){let t=this._permissionPointMap.get(e);t&&(t.complete(),this._permissionPointMap.delete(e))}addPermissionPoint(e){let t=e instanceof e5.BehaviorSubject,r=t?e.getValue():e;if(!r.id)return!1;if(this._permissionPointMap.get(r.id))throw Error(`${r.id} PermissionPoint already exists`);return this._permissionPointMap.set(r.id,t?e:new(0,e5.BehaviorSubject)(r)),this._permissionPointUpdate$.next(r),!0}updatePermissionPoint(e,t){let r=this._permissionPointMap.get(e);if(!r)return;let n=r.getValue();n.value=t,n.status=mQ.DONE,r.next(n),this._permissionPointUpdate$.next(n)}clearPermissionMap(){this._permissionPointMap.clear()}getPermissionPoint(e){let t=this._permissionPointMap.get(e);if(t)return t.getValue()}getPermissionPoint$(e){let t=this._permissionPointMap.get(e);if(t)return t}composePermission$(e){let t=e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.asObservable()});return(0,e3.combineLatest)(t).pipe((0,e7.map)(e=>e))}composePermission(e){return e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.getValue()})}getAllPermissionPoint(){let e=new Map;return this._permissionPointMap.forEach((t,r)=>{e.set(r,t)}),e}}function m0(e,t){if(!t)return e;let r=[];for(let n of e){let e=t.find(([e])=>e===n[0]);if(e){if(null===e[1])continue;r.push([n[0],e[1]])}else r.push(n)}return r}var m1=Object.getOwnPropertyDescriptor,m2=(e,t)=>(r,n)=>t(r,n,e);let m5=Symbol("DependentOn");class m3 extends nJ{onStarting(){}onReady(){}onRendered(){}onSteady(){}getUnitType(){return this.constructor.type}getPluginName(){return this.constructor.pluginName}}tg(m3,"pluginName"),tg(m3,"type",n2.UNIVER_UNKNOWN);class m4{constructor(){tg(this,"_plugins",[])}addPlugin(e){this._plugins.push(e)}removePlugins(){let e=this._plugins.slice();return this._plugins.length=0,e}forEachPlugin(e){this._plugins.forEach(e)}}function m6(...e){return function(t){t[m5]=e}}let m9=class{constructor(e,t,r){tg(this,"_pluginRegistry",new Map),tg(this,"_pluginStore",new m4),tg(this,"_seenPlugins",new Set),tg(this,"_loadedPlugins",new Set),tg(this,"_loadedPluginTypes",new Set([n2.UNIVER_UNKNOWN])),tg(this,"_flushTimerByType",new Map),this._injector=e,this._lifecycleService=t,this._logService=r}dispose(){this._pluginStore.removePlugins().forEach(e=>e.dispose()),this._flushTimerByType.forEach(e=>clearTimeout(e))}registerPlugin(e,t){this._assertPluginValid(e);let r={plugin:e,options:t};this._pluginRegistry.set(e.pluginName,r),this._logService.debug("[PluginService]",`Plugin "${e.pluginName}" registered.`);let{type:n}=e;this._loadedPluginTypes.has(n)&&(n===n2.UNIVER_UNKNOWN?this._loadFromPlugins([r]):this._flushType(n))}startPluginsForType(e){this._loadedPluginTypes.has(e)||this._loadPluginsForType(e)}_loadPluginsForType(e){let t=Array.from(this._pluginRegistry.keys()),r=[];t.forEach(t=>{let n=this._pluginRegistry.get(t);n.plugin.type===e&&r.push(n)}),this._loadFromPlugins(r),this._loadedPluginTypes.add(e)}_assertPluginValid(e){let{type:t,pluginName:r}=e;if(t===n2.UNRECOGNIZED)throw Error(`[PluginService]: invalid plugin type for ${e.name}. Please assign a "type" to your plugin.`);if(!r)throw Error(`[PluginService]: no plugin name for ${e.name}. Please assign a "pluginName" to your plugin.`);if(this._seenPlugins.has(r))throw Error(`[PluginService]: duplicated plugin name for "${r}". Maybe a plugin that dependents on "${r} has already registered it. In that case please register "${r}" before the that plugin.`);this._seenPlugins.add(e.pluginName)}_flushType(e){void 0===this._flushTimerByType.get(e)&&this._flushTimerByType.set(e,setTimeout(()=>{this._loadPluginsForType(e),this._flushTimerByType.delete(e)},4))}_loadFromPlugins(e){let t=[],r=new Set,n=e=>{let{plugin:i}=e,{pluginName:s}=i;if(this._loadedPlugins.has(s)||r.has(s))return;r.add(s),this._pluginRegistry.delete(s);let a=i[m5];a&&a.forEach(e=>{let t=this._pluginRegistry.get(e.pluginName);if(t)n(t);else if(!this._seenPlugins.has(e.pluginName)&&!r.has(e.pluginName)){if(i.type===n2.UNIVER_UNKNOWN&&e.type!==n2.UNIVER_UNKNOWN)throw Error(`[PluginService]: cannot register a plugin with Univer type that depends on a plugin with other type. The dependent is ${i.pluginName} and the dependency is ${e.pluginName}.`);i.type!==e.type&&e.type!==n2.UNIVER_UNKNOWN&&this._logService.debug("[PluginService]",`Plugin "${s}" depends on "${e.pluginName}" which has different type.`),this._logService.debug("[PluginService]",`Plugin "${s}" depends on "${e.pluginName}" which is not registered. Univer will automatically register it with default configuration.`),this._assertPluginValid(e),n({plugin:e,options:void 0})}}),t.push(e)};e.forEach(e=>n(e));let i=t.map(e=>this._initPlugin(e.plugin,e.options));this._pluginsRunLifecycle(i)}_pluginsRunLifecycle(e){let t=this._lifecycleService.stage;if(mG(t).subscribe(t=>this._runStage(e,t)),t!==mj.Steady){let t=this._lifecycleService.lifecycle$.pipe((0,ti.skip)(1)).subscribe(r=>{this._runStage(e,r),r===mj.Steady&&t.unsubscribe()})}}_runStage(e,t){e.forEach(e=>{switch(t){case mj.Starting:e.onStarting();break;case mj.Ready:e.onReady();break;case mj.Rendered:e.onRendered();break;case mj.Steady:e.onSteady()}})}_initPlugin(e,t){let r=this._injector.createInstance(e,t);return this._pluginStore.addPlugin(r),this._loadedPlugins.add(e.pluginName),this._logService.debug("[PluginService]",`Plugin "${r.getPluginName()}" loaded.`),r}};m9=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?m1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([m2(0,(0,e2.Inject)(e2.Injector)),m2(1,(0,e2.Inject)(mW)),m2(2,s5)],m9);let m8=(0,e2.createIdentifier)("resource-loader-service");var m7=Object.getOwnPropertyDescriptor;let ge=class extends nJ{constructor(e){super(),tg(this,"_resourceMap",new Map),tg(this,"_register$",new(0,ts.Subject)),tg(this,"register$",this._register$.asObservable()),this._logService=e}getAllResourceHooks(){return[...this._resourceMap.values()]}getResources(e,t){return t?this.getResourcesByType(e,t):this.getAllResourceHooks().map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}getResourcesByType(e,t){return this.getAllResourceHooks().filter(e=>e.businesses.includes(t)).map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}registerPluginResource(e){let t=e.pluginName;if(this._resourceMap.has(t))throw Error(`the pluginName is registered {${t}}`);return this._resourceMap.set(t,e),this._register$.next(e),nK(()=>this._resourceMap.delete(t))}disposePluginResource(e){this._resourceMap.delete(e)}loadResources(e,t){this.getAllResourceHooks().forEach(r=>{var n;let i=null==(n=null==t?void 0:t.find(e=>e.name===r.pluginName))?void 0:n.data;if(i)try{let t=r.parseJson(i);r.onLoad(e,t)}catch(e){this._logService.error("[ResourceManagerService]","loadResources error",e)}})}unloadResources(e){this.getAllResourceHooks().forEach(t=>{t.onUnLoad(e)})}dispose(){this._register$.complete(),this._resourceMap.clear()}};ge=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?m7(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>s5(e,t,0)],ge);class gt extends nJ{constructor(){super(),tg(this,"_darkMode$",new(0,e5.BehaviorSubject)(!1)),tg(this,"darkMode$",this._darkMode$.asObservable()),tg(this,"_validColorCache",new Map),tg(this,"_currentTheme",th.defaultTheme),tg(this,"_currentTheme$",new(0,e5.BehaviorSubject)(this._currentTheme)),tg(this,"currentTheme$",this._currentTheme$.asObservable()),this.disposeWithMe(nK(()=>{this._currentTheme=th.defaultTheme,this._currentTheme$.complete(),this._darkMode$.complete()}))}get darkMode(){return this._darkMode$.getValue()}isValidThemeColor(e){if(this._validColorCache.has(e))return this._validColorCache.get(e);let t=!1,r=e.split(".");if(1===r.length)t=e in th.defaultTheme;else if(2===r.length){let[e,n]=r;t=e in th.defaultTheme&&n in this._currentTheme[e]}return this._validColorCache.set(e,t),t}getCurrentTheme(){return this._currentTheme}setTheme(e){this._currentTheme=e,this._currentTheme$.next(e)}setDarkMode(e){this._darkMode$.next(e)}getColorFromTheme(e){return nC(this._currentTheme,e)}}var gr=Object.getOwnPropertyDescriptor,gn=(e,t)=>(r,n)=>t(r,n,e);let gi=(0,e2.createIdentifier)("univer.undo-redo.service");class gs{dispose(){}async dispatchToHandlers(){return!1}}let ga="univer.command.redo",go="univer.command.undo",gl=new class extends gs{constructor(){super(...arguments),tg(this,"type",s9.COMMAND),tg(this,"id",go)}handler(e){let t=e.get(gi),r=t.pitchTopUndoElement();if(!r)return!1;let n=e.get(s8);return!!an(r.undoMutations,n)&&(t.popUndoToRedo(),!0)}},gu=new class extends gs{constructor(){super(...arguments),tg(this,"type",s9.COMMAND),tg(this,"id",ga)}handler(e){let t=e.get(gi),r=t.pitchTopRedoElement();if(!r)return!1;let n=e.get(s8);return!!an(r.redoMutations,n)&&(t.popRedoToUndo(),!0)}},gc=class extends nJ{constructor(e,t,r){super(),tg(this,"undoRedoStatus$"),tg(this,"_undoRedoStatus$",new(0,e5.BehaviorSubject)({undos:0,redos:0})),tg(this,"_undoStacks",new Map),tg(this,"_redoStacks",new Map),tg(this,"_batchingStatus",new Map),this._univerInstanceService=e,this._commandService=t,this._contextService=r,this.undoRedoStatus$=this._undoRedoStatus$.asObservable(),this.disposeWithMe(this._commandService.registerCommand(gl)),this.disposeWithMe(this._commandService.registerCommand(gu)),this.disposeWithMe(nK(()=>this._undoRedoStatus$.complete())),this.disposeWithMe(nK(this._univerInstanceService.focused$.subscribe(()=>this._updateStatus())))}pushUndoRedo(e){let{unitID:t}=e,r=this._getRedoStack(t,!0),n=this._getUndoStack(t,!0);if(r.length=0,this._batchingStatus.has(e.unitID)){let t=this._batchingStatus.get(e.unitID),r=this._pitchUndoElement(e.unitID);0!==t&&r?this._tryBatchingElements(r,e):(i(e),this._batchingStatus.set(e.unitID,1))}else i(e);function i(e){n.push(e),n.length>20&&n.splice(0,1)}this._updateStatus()}clearUndoRedo(e){let t=this._getRedoStack(e);t&&(t.length=0);let r=this._getUndoStack(e);r&&(r.length=0),this._updateStatus()}pitchTopUndoElement(){let e=this._getFocusedUnitId();return this._pitchUndoElement(e)}pitchTopRedoElement(){let e=this._getFocusedUnitId();return this._pitchRedoElement(e)}_pitchUndoElement(e){let t=this._getUndoStack(e);return null!=t&&t.length?t[t.length-1]:null}_pitchRedoElement(e){let t=this._getRedoStack(e);return null!=t&&t.length?t[t.length-1]:null}popUndoToRedo(){let e=this._getUndoStackForFocused().pop();e&&(this._getRedoStackForFocused().push(e),this._updateStatus())}popRedoToUndo(){let e=this._getRedoStackForFocused().pop();e&&(this._getUndoStackForFocused().push(e),this._updateStatus())}rollback(e,t){let r=t||this._getFocusedUnitId(),n=this._getUndoStack(r),i=null==n?void 0:n[(null==n?void 0:n.length)-1];i&&i.id===e&&(n.pop(),an(i.undoMutations,this._commandService))}__tempBatchingUndoRedo(e){if(this._batchingStatus.has(e))throw Error("[LocalUndoRedoService]: cannot batching undo redo twice at the same time!");return this._batchingStatus.set(e,0),nK(()=>this._batchingStatus.delete(e))}_updateStatus(){var e,t;let r=this._getFocusedUnitId(),n=r&&(null==(e=this._undoStacks.get(r))?void 0:e.length)||0,i=r&&(null==(t=this._redoStacks.get(r))?void 0:t.length)||0;this._undoRedoStatus$.next({undos:n,redos:i})}_getUndoStack(e,t=!1){let r=this._undoStacks.get(e);return!r&&t&&(r=[],this._undoStacks.set(e,r)),r||null}_getRedoStack(e,t=!1){let r=this._redoStacks.get(e);return!r&&t&&(r=[],this._redoStacks.set(e,r)),r||null}_getUndoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getUndoStack(e,!0)}_getRedoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getRedoStack(e,!0)}_tryBatchingElements(e,t){e.redoMutations.push(...t.redoMutations),e.undoMutations.push(...t.undoMutations)}_getFocusedUnitId(){var e,t,r,n;let i=this._contextService.getContextValue(dX),s=this._contextService.getContextValue(d0),a=this._contextService.getContextValue(dZ);return i?s?tT:a?tv:null!=(t=null==(e=this._univerInstanceService.getFocusedUnit())?void 0:e.getUnitId())?t:"":null!=(n=null==(r=this._univerInstanceService.getFocusedUnit())?void 0:r.getUnitId())?n:""}};gc=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?gr(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([gn(0,mk),gn(1,s8),gn(2,s0)],gc);class gh{constructor(e,t=100){tg(this,"_imageCacheMap"),this._injector=e,this._imageCacheMap=new lK(t)}_getImageCacheKey(e,t){return`${e}-${t}`}getImage(e,t,r,n){let i=this._getImageCacheKey(e,t);return this._imageCacheMap.get(i)||((async()=>{let s=new Image,a=this._injector.has(me)?this._injector.get(me):null;if(e===d8.UUID)try{s.src=await (null==a?void 0:a.getImage(t))||""}catch(e){console.error(e)}else s.src=t;s.onload=()=>{s.removeAttribute("data-error"),null==r||r()},s.onerror=()=>{s.setAttribute("data-error","true"),null==n||n()},this._imageCacheMap.set(i,s)})(),null)}}function gd(e){return!(0===e.length||e.length>31||e.startsWith("'")||e.endsWith("'")||/[:\\\/\?\*\[\]]/.test(e))}function gm(e,t){return!(t.has(e)||0===e.length||!/^[A-Za-z_]/.test(e)||/[ :\\\/\?\*\[\]]/.test(e))}let gg=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class gf{static from(e){if(!(e instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[t,r]=new Uint8Array(e,0,2);if(219!==t)throw Error("Data does not appear to be in a KDBush format.");let n=r>>4;if(1!==n)throw Error(`Got v${n} data when expected v1.`);let i=gg[15&r];if(!i)throw Error("Unrecognized array type.");let[s]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new gf(a,s,i,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let i=gg.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(i<0)throw Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){let r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,n,i,s,a){if(s-i<=n)return;let o=i+s>>1;(function e(t,r,n,i,s,a){for(;s>i;){if(s-i>600){let o=s-i+1,l=n-i+1,u=Math.log(o),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(o-c)/o)*(l-o/2<0?-1:1),d=Math.max(i,Math.floor(n-l*c/o+h)),m=Math.min(s,Math.floor(n+(o-l)*c/o+h));e(t,r,n,d,m,a)}let o=r[2*n+a],l=i,u=s;for(gp(t,r,i,n),r[2*s+a]>o&&gp(t,r,i,s);l<u;){for(gp(t,r,l,u),l++,u--;r[2*l+a]<o;)l++;for(;r[2*u+a]>o;)u--}r[2*i+a]===o?gp(t,r,i,u):gp(t,r,++u,s),u<=n&&(i=u+1),n<=u&&(s=u-1)}})(t,r,o,i,s,a),e(t,r,n,i,o-1,1-a),e(t,r,n,o+1,s,1-a)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:i,coords:s,nodeSize:a}=this,o=[0,i.length-1,0],l=[];for(;o.length;){let u=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=a){for(let a=h;a<=c;a++){let o=s[2*a],u=s[2*a+1];o>=e&&o<=r&&u>=t&&u<=n&&l.push(i[a])}continue}let d=h+c>>1,m=s[2*d],g=s[2*d+1];m>=e&&m<=r&&g>=t&&g<=n&&l.push(i[d]),(0===u?e<=m:t<=g)&&(o.push(h),o.push(d-1),o.push(1-u)),(0===u?r>=m:n>=g)&&(o.push(d+1),o.push(c),o.push(1-u))}return l}within(e,t,r){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:n,coords:i,nodeSize:s}=this,a=[0,n.length-1,0],o=[],l=r*r;for(;a.length;){let u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=s){for(let r=h;r<=c;r++)g_(i[2*r],i[2*r+1],e,t)<=l&&o.push(n[r]);continue}let d=h+c>>1,m=i[2*d],g=i[2*d+1];g_(m,g,e,t)<=l&&o.push(n[d]),(0===u?e-r<=m:t-r<=g)&&(a.push(h),a.push(d-1),a.push(1-u)),(0===u?e+r>=m:t+r>=g)&&(a.push(d+1),a.push(c),a.push(1-u))}return o}}function gp(e,t,r,n){gC(e,r,n),gC(t,2*r,2*n),gC(t,2*r+1,2*n+1)}function gC(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function g_(e,t,r,n){let i=e-r,s=t-n;return i*i+s*s}class gy{constructor(e=!1){tg(this,"_tree",new Map),tg(this,"_oneCellCache",new Map),tg(this,"_kdTree",new Map),this._enableOneCellCache=e}dispose(){this.clear()}getTree(e,t){return this._tree.has(e)||this._tree.set(e,new Map),this._tree.get(e).has(t)||this._tree.get(e).set(t,new c3),this._tree.get(e).get(t)}_getOneCellCache(e,t,r,n){return this._oneCellCache.has(e)||this._oneCellCache.set(e,new Map),this._oneCellCache.get(e).has(t)||this._oneCellCache.get(e).set(t,new Map),this._oneCellCache.get(e).get(t).has(r)||this._oneCellCache.get(e).get(t).set(r,new Map),this._oneCellCache.get(e).get(t).get(r).has(n)||this._oneCellCache.get(e).get(t).get(r).set(n,new Set),this._oneCellCache.get(e).get(t).get(r).get(n)}_removeOneCellCache(e,t,r,n,i){let s=this._oneCellCache.get(e);if(!s)return;let a=s.get(t);if(!a)return;let o=a.get(r);if(!o)return;let l=o.get(n);l&&l.delete(i)}_removeCellCacheByRange(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this._oneCellCache.get(t);if(!s)return;let a=s.get(r);if(!a)return;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=n;for(let e=o;e<=u;e++){let t=a.get(e);if(t)for(let e=l;e<=c;e++){let r=t.get(e);r&&r.delete(i)}}}_insertOneCellCache(e,t,r,n,i){this._getOneCellCache(e,t,r,n).add(i)}_getRdTreeItems(e){let t=[];for(let[r,n]of e)for(let[e,i]of n)t.push({x:e,y:r,ids:i});return t}_searchByOneCellCache(e){var t;let{unitId:r,sheetId:n,range:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=i,u=null==(t=this._kdTree.get(r))?void 0:t.get(n);if(!u)return[];let{tree:c,items:h}=u,d=c.range(a,s,l,o),m=[];for(let e of d){let t=h[e];m.push(...Array.from(t.ids))}return m}openKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of(this._kdTree.has(t)||this._kdTree.set(t,new Map),r)){let r=this._getRdTreeItems(i),s=new gf(r.length);for(let i of(null==(e=this._kdTree.get(t))||e.set(n,{tree:s,items:r}),r))s.add(i.x,i.y);s.finish()}}closeKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of r)null==(e=this._kdTree.get(t))||e.set(n,void 0)}insert(e){let{unitId:t,sheetId:r,range:n,id:i}=e;if(!t||0===t.length)return;let{startRow:s,endRow:a,startColumn:o,endColumn:l}=n;if(this._enableOneCellCache&&s===a&&o===l)return void this._insertOneCellCache(t,r,s,o,i);let u=this.getTree(t,r);Number.isNaN(s)&&(s=0),Number.isNaN(o)&&(o=0),Number.isNaN(a)&&(a=1/0),Number.isNaN(l)&&(l=1/0),u.insert({minX:o,minY:s,maxX:l,maxY:a,id:i})}bulkInsert(e){for(let t of e)this.insert(t)}*searchGenerator(e){var t;let{unitId:r,sheetId:n,range:i}=e;if(this._enableOneCellCache)for(let t of this._searchByOneCellCache(e))yield t;let s=null==(t=this._tree.get(r))?void 0:t.get(n);if(s)for(let e of s.search({minX:i.startColumn,minY:i.startRow,maxX:i.endColumn,maxY:i.endRow}))yield e.id}bulkSearch(e,t){let r=new Set;for(let n of e)for(let e of this.searchGenerator(n))(null==t?void 0:t.has(e))!==!0&&r.add(e);return r}removeById(e,t){var r,n;t?(null==(r=this._tree.get(e))||r.delete(t),null==(n=this._oneCellCache.get(e))||n.delete(t)):(this._tree.delete(e),this._oneCellCache.delete(e))}_removeRTreeItem(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this.getTree(t,r),a=s.search({minX:n.startColumn,minY:n.startRow,maxX:n.endColumn,maxY:n.endRow});for(let e=0;e<a.length;e++)a[e].id===i&&s.remove(a[e])}remove(e){let{unitId:t,sheetId:r,range:n,id:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=n;this._enableOneCellCache?s===o&&a===l?this._removeOneCellCache(t,r,n.startRow,n.startColumn,i):(this._removeCellCacheByRange(e),this._removeRTreeItem(e)):this._removeRTreeItem(e)}bulkRemove(e){for(let t of e)this.remove(t)}clear(){this._tree.clear(),this._oneCellCache.clear()}toJSON(){let e={};return this._tree.forEach((t,r)=>{e[r]={},t.forEach((t,n)=>{e[r][n]=t.toJSON()})}),e}fromJSON(e){for(let t in this._tree.clear(),e)for(let r in this._tree.set(t,new Map),e[t]){let n=new c3;n.fromJSON(e[t][r]),this._tree.get(t).set(r,n)}}}function gR(e){return new Promise(t=>setTimeout(t,e))}function gE(e=1){return new Promise(t=>{let r=0,n=()=>{++r>=e?t():requestAnimationFrame(n)};requestAnimationFrame(n)})}var gb=Object.getOwnPropertyDescriptor;let gI=class extends nJ{constructor(e){super(),tg(this,"_fontLocale"),tg(this,"_dirty",!0),this._localeService=e,this._localeInitial()}get dirty(){return this._dirty}getFontLocale(){return this._fontLocale}makeDirty(e){this._dirty=e}dispose(){super.dispose(),this._fontLocale=null}_localeInitial(){}};gI=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?gb(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(eY=(0,e2.Inject)(mz),(e,t)=>eY(e,t,0))],gI);var gN=Object.getOwnPropertyDescriptor,gS=(e,t)=>(r,n)=>t(r,n,e);let gA=class extends gI{constructor(e,t,r,n,i,s){super(r),tg(this,"_worksheetData"),tg(this,"_renderRawFormula",!1),tg(this,"_cellData"),tg(this,"_imageCacheMap"),tg(this,"_skipAutoHeightForMergedCells",!0),tg(this,"_rowTotalHeight",0),tg(this,"_columnTotalWidth",0),tg(this,"_rowHeaderWidth",0),tg(this,"_columnHeaderHeight",0),tg(this,"_rowHeightAccumulation",[]),tg(this,"_columnWidthAccumulation",[]),tg(this,"_marginTop",0),tg(this,"_marginLeft",0),tg(this,"_scaleX"),tg(this,"_scaleY"),tg(this,"_scrollX"),tg(this,"_scrollY"),this.worksheet=e,this._styles=t,this._contextService=n,this._configService=i,this._injector=s,this._worksheetData=this.worksheet.getConfig(),this._cellData=this.worksheet.getCellMatrix(),this._imageCacheMap=new gh(this._injector),this.initConfig()}initConfig(){var e,t;this._skipAutoHeightForMergedCells=!(null!=(e=this._configService.getConfig(tx))&&e),this.worksheet.setIsRowStylePrecedeColumnStyle(null!=(t=this._configService.getConfig(tO))&&t)}resetCache(){}getWorksheetConfig(){return this._worksheetData}getLocation(){return[this.worksheet.getUnitId(),this.worksheet.getSheetId()]}set columnHeaderHeight(e){this._columnHeaderHeight=e,this._worksheetData.columnHeader.height=e}set rowHeaderWidth(e){this._rowHeaderWidth=e,this._worksheetData.rowHeader.width=e}get rowHeightAccumulation(){return this._rowHeightAccumulation}get rowTotalHeight(){return this._rowTotalHeight}get columnWidthAccumulation(){return this._columnWidthAccumulation}get columnTotalWidth(){return this._columnTotalWidth}get rowHeaderWidth(){return this._rowHeaderWidth}get columnHeaderHeight(){return this._columnHeaderHeight}setMarginLeft(e){this._marginLeft=e}setMarginTop(e){this._marginTop=e}setScale(e,t){this._updateLayout(),this._scaleX=e,this._scaleY=t||e,this._updateLayout()}setScroll(e,t){ir.isDefine(e)&&(this._scrollX=e),ir.isDefine(t)&&(this._scrollY=t)}get scrollX(){return this._scrollX}get scrollY(){return this._scrollY}get scaleX(){return this._scaleX}get scaleY(){return this._scaleY}get rowHeaderWidthAndMarginLeft(){return this.rowHeaderWidth+this._marginLeft}get columnHeaderHeightAndMarginTop(){return this.columnHeaderHeight+this._marginTop}get imageCacheMap(){return this._imageCacheMap}_generateRowMatrixCache(e,t,r){let n=0,i=[];for(let s=0;s<e;s++){let e=r;if(this.worksheet.getRowFiltered(s))e=0;else if(null!=t[s]){let n=t[s];if(!n)continue;let{h:i=r,ah:a,ia:o}=n;e=(null==o||o===iP.TRUE)&&"number"==typeof a?a:i,n.hd===iP.TRUE&&(e=0)}n+=e,i.push(n)}return{rowTotalHeight:n,rowHeightAccumulation:i}}_generateColumnMatrixCache(e,t,r){let n=0,i=[];for(let s=0;s<e;s++){let e=r;if(null!=t[s]){let r=t[s];if(!r)continue;null!=r.w&&(e=r.w),r.hd===iP.TRUE&&(e=0)}n+=e,i.push(n)}return{columnTotalWidth:n,columnWidthAccumulation:i}}intersectMergeRange(e,t){return!!this.worksheet.getMergedCell(e,t)}_getOverflowBound(e,t,r,n,i=iO.LEFT){let s=0;if(t>r){let a=this._columnWidthAccumulation.length-1;for(let o=t;o>=r;o--){let r=o;if(!ou(this.worksheet.getCell(e,r))&&r!==t||this.intersectMergeRange(e,r))return r===t?r:r+1>a?a:r+1;let{startX:l,endX:u}=gw(e,r,this.rowHeightAccumulation,this.columnWidthAccumulation);if(i===iO.CENTER&&r===t?s+=(u-l)/2:s+=u-l,n<s)return r}return t}for(let a=t;a<=r;a++){let r=a;if(!ou(this.worksheet.getCell(e,r))&&r!==t||this.intersectMergeRange(e,r))return r===t?r:r-1<0?0:r-1;let{startX:o,endX:l}=gw(e,r,this.rowHeightAccumulation,this.columnWidthAccumulation);if(i===iO.CENTER&&r===t?s+=(l-o)/2:s+=l-o,n<s)return r}return r}_updateLayout(){if(!this.dirty)return;let{rowData:e,columnData:t,defaultRowHeight:r,defaultColumnWidth:n,rowCount:i,columnCount:s,rowHeader:a,columnHeader:o}=this._worksheetData,{rowTotalHeight:l,rowHeightAccumulation:u}=this._generateRowMatrixCache(i,e,r),{columnTotalWidth:c,columnWidthAccumulation:h}=this._generateColumnMatrixCache(s,t,n);this._rowHeaderWidth=a.hidden!==iP.TRUE?this._dynamicallyUpdateRowHeaderWidth(a):0,this._columnHeaderHeight=o.hidden!==iP.TRUE?o.height:0,this._rowTotalHeight=l,this._rowHeightAccumulation=u,this._columnTotalWidth=c,this._columnWidthAccumulation=h,this.makeDirty(!1)}calculate(){return this.resetCache(),this._updateLayout(),this}resetRangeCache(e){}_dynamicallyUpdateRowHeaderWidth(e){let t=8*`${this.worksheet.getRowCount()}`.length;return Math.max(e.width,t)}_hasUnMergedCellInRow(e,t,r){if(!this.worksheet.getMergeData())return!1;for(let n=t;n<=r;n++){let{isMerged:t,isMergedMainCell:r}=this.worksheet.getCellInfoInMergeData(e,n);if(!t&&!r)return!0}return!1}expandRangeByMerge(e){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=e,s=this._worksheetData.mergeData;if(!s)return{startRow:t,startColumn:r,endRow:n,endColumn:i};let a=!0,o=new oi;for(;a;){a=!1;for(let e=0;e<s.length;e++){let{startRow:l,startColumn:u,endRow:c,endColumn:h}=s[e];!o.getValue(l,u)&&hu({startColumn:r,startRow:t,endColumn:i,endRow:n},{startColumn:u,startRow:l,endColumn:h,endRow:c})&&(t=Math.min(t,l),r=Math.min(r,u),n=Math.max(n,c),i=Math.max(i,h),o.setValue(l,u,!0),a=!0)}}return{startRow:t,startColumn:r,endRow:n,endColumn:i}}getColumnCount(){return this._columnWidthAccumulation.length}getRowCount(){return this._rowHeightAccumulation.length}_getCellMergeInfo(e,t){return this.worksheet.getCellInfoInMergeData(e,t)}getNoMergeCellPositionByIndex(e,t,r=!0){return this.getNoMergeCellWithCoordByIndex(e,t,r)}getNoMergeCellWithCoordByIndex(e,t,r=!0){let{rowHeightAccumulation:n,columnWidthAccumulation:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:a}=this,{startY:o,endY:l,startX:u,endX:c}=gw(e,t,n,i);return r&&(o+=a,l+=a,u+=s,c+=s),{startY:o,endY:l,startX:u,endX:c}}getNoMergeCellPositionByIndexWithNoHeader(e,t){let{rowHeightAccumulation:r,columnWidthAccumulation:n}=this,{startY:i,endY:s,startX:a,endX:o}=gw(e,t,r,n);return{startY:i,endY:s,startX:a,endX:o}}getRowIndexByOffsetY(e,t,r,n){var i;let{rowHeightAccumulation:s}=this,a=ag(s,e=gO(e,t,r,this.columnHeaderHeightAndMarginTop),null==n?void 0:n.firstMatch);return null!=n&&n.closeFirst&&Math.abs(s[a]-e)<Math.abs(e-(null!=(i=s[a-1])?i:0))&&(a+=1),a}getColumnIndexByOffsetX(e,t,r,n){var i;let s=gM(e,t,r,this.rowHeaderWidthAndMarginLeft),{columnWidthAccumulation:a}=this,o=ag(a,s,null==n?void 0:n.firstMatch);return null!=n&&n.closeFirst&&Math.abs(a[o]-s)<Math.abs(s-(null!=(i=a[o-1])?i:0))&&(o+=1),o}getCellIndexByOffset(e,t,r,n,i,s){return{row:this.getRowIndexByOffsetY(t,n,i,s),column:this.getColumnIndexByOffsetX(e,r,i,s)}}getCellByOffset(e,t,r,n,i){let s=this==null?void 0:this.getCellIndexByOffset(e,t,r,n,i,{firstMatch:!0});return s?this.worksheet.getCellInfoInMergeData(s.row,s.column):null}getCellWithCoordByIndex(e,t,r=!0){let{rowHeightAccumulation:n,columnWidthAccumulation:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:a}=this,o=gw(e,t,n,i,this.worksheet.getCellInfoInMergeData(e,t)),{isMerged:l,isMergedMainCell:u}=o,{startY:c,endY:h,startX:d,endX:m,mergeInfo:g}=o,f=s,p=a;return!1===r&&(f=0,p=0),c+=p,h+=p,d+=f,m+=f,g.startY+=p,g.endY+=p,g.startX+=f,g.endX+=f,{actualRow:e,actualColumn:t,startX:d,startY:c,endX:m,endY:h,isMerged:l,isMergedMainCell:u,mergeInfo:g}}getCellWithCoordByOffset(e,t,r,n,i,s){let{row:a,column:o}=this.getCellIndexByOffset(e,t,r,n,i,s);return this.getCellWithCoordByIndex(a,o)}getOffsetByColumn(e){let{columnWidthAccumulation:t,rowHeaderWidthAndMarginLeft:r}=this,n=t.length-1,i=t[e];return null!=i?i+r:e<0?r:t[n]+r}getOffsetByRow(e){let{rowHeightAccumulation:t,columnHeaderHeightAndMarginTop:r}=this,n=t.length-1,i=t[e];return null!=i?i+r:e<0?r:t[n]+r}getOffsetRelativeToRowCol(e,t){let r=ag(this.columnWidthAccumulation,e),n=0;n=0===r?e:e-this._columnWidthAccumulation[r-1];let i=ag(this.rowHeightAccumulation,t),s=0;return s=0===i?t:t-this._rowHeightAccumulation[i-1],{row:i,column:r,columnOffset:n,rowOffset:s}}_updateConfigAndGetDocumentModel(e,t,r,n){var i,s,a,o,l;if(n&&null!=(i=e.body)&&i.dataStream){for(let i of(e.documentStyle||(e.documentStyle={}),e.documentStyle.marginTop=null!=(s=r.t)?s:0,e.documentStyle.marginBottom=null!=(a=r.b)?a:2,e.documentStyle.marginLeft=null!=(o=r.l)?o:2,e.documentStyle.marginRight=null!=(l=r.r)?l:2,e.documentStyle.pageSize={width:1/0,height:1/0},e.documentStyle.renderConfig={...e.documentStyle.renderConfig,...n},e.body.paragraphs||[]))i.paragraphStyle||(i.paragraphStyle={}),i.paragraphStyle.horizontalAlign=t;return new dg(e)}}dispose(){super.dispose(),this._rowHeightAccumulation=[],this._columnWidthAccumulation=[],this._rowTotalHeight=0,this._columnTotalWidth=0,this._rowHeaderWidth=0,this._columnHeaderHeight=0,this._worksheetData=null,this._cellData=null,this._styles=null}};function gv(e,t,r,n){let i=r[e-1]||0,s=r[e];null==s&&(s=r[r.length-1]);let a=n[t-1]||0,o=n[t];return null==o&&(o=n[n.length-1]),{startY:i,endY:s,startX:a,endX:o}}function gT(e,t,r,n){return gv(e,t,r,n)}function gw(e,t,r,n,i){let{startY:s,endY:a,startX:o,endX:l}=gv(e=ir.clamp(e,0,r.length-1),t=ir.clamp(t,0,n.length-1),r,n);if(!i)return{startY:s,endY:a,startX:o,endX:l,isMerged:!1,isMergedMainCell:!1,actualRow:e,actualColumn:t,mergeInfo:{startY:s,endY:a,startX:o,endX:l,startRow:e,startColumn:t,endRow:e,endColumn:t}};let{isMerged:u,isMergedMainCell:c,startRow:h,startColumn:d,endRow:m,endColumn:g}=i,f={startRow:h,startColumn:d,endRow:m,endColumn:g,startY:s,endY:a,startX:o,endX:l},p=r.length-1,C=n.length-1;if(u&&-1!==h&&-1!==d){let e=r[h-1]||0,t=r[m]||r[p],i=n[d-1]||0,s=n[g]||n[C];f={...f,startY:e,endY:t,startX:i,endX:s}}else if(!u&&-1!==m&&-1!==g){let e=r[m]||r[p],t=n[g]||n[C];f={...f,startY:s,endY:e,startX:o,endX:t}}return{isMerged:u,isMergedMainCell:c,actualRow:e,actualColumn:t,startY:s,endY:a,startX:o,endX:l,mergeInfo:f}}function gM(e,t,r,n){let{x:i}=r;return e/t+i-n}function gO(e,t,r,n){let{y:i}=r;return e/t+i-n}gA=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?gN(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([gS(2,(0,e2.Inject)(mz)),gS(3,s0),gS(4,dG),gS(5,(0,e2.Inject)(e2.Injector))],gA);let gx=["script","style","meta","comment","link"];var gU=((ez=gU||{})[ez.INFO=0]="INFO",ez[ez.STOP=1]="STOP",ez[ez.WARNING=2]="WARNING",ez),gD=((eX=gD||{})[eX.DISABLED=0]="DISABLED",eX[eX.FULL_ALPHA=1]="FULL_ALPHA",eX[eX.FULL_HANGUL=2]="FULL_HANGUL",eX[eX.FULL_KATAKANA=3]="FULL_KATAKANA",eX[eX.HALF_ALPHA=4]="HALF_ALPHA",eX[eX.HALF_HANGUL=5]="HALF_HANGUL",eX[eX.HALF_KATAKANA=6]="HALF_KATAKANA",eX[eX.HIRAGANA=7]="HIRAGANA",eX[eX.NO_CONTROL=8]="NO_CONTROL",eX[eX.OFF=9]="OFF",eX[eX.ON=10]="ON",eX),gV=((eq=gV||{}).BETWEEN="between",eq.EQUAL="equal",eq.GREATER_THAN="greaterThan",eq.GREATER_THAN_OR_EQUAL="greaterThanOrEqual",eq.LESS_THAN="lessThan",eq.LESS_THAN_OR_EQUAL="lessThanOrEqual",eq.NOT_BETWEEN="notBetween",eq.NOT_EQUAL="notEqual",eq),gL=((eK=gL||{})[eK.TEXT=0]="TEXT",eK[eK.ARROW=1]="ARROW",eK[eK.CUSTOM=2]="CUSTOM",eK),gP=((eQ=gP||{}).VALID="valid",eQ.INVALID="invalid",eQ.VALIDATING="validating",eQ),gk=((eZ=gk||{}).CUSTOM="custom",eZ.LIST="list",eZ.LIST_MULTIPLE="listMultiple",eZ.NONE="none",eZ.TEXT_LENGTH="textLength",eZ.DATE="date",eZ.TIME="time",eZ.WHOLE="whole",eZ.DECIMAL="decimal",eZ.CHECKBOX="checkbox",eZ.ANY="any",eZ),gF=Object.getOwnPropertyDescriptor,gj=(e,t)=>(r,n)=>t(r,n,e);let gB=class extends nJ{constructor(e,t){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._init()}_init(){let e=e=>{e.businesses.forEach(t=>{switch(t){case n2.UNRECOGNIZED:case n2.UNIVER_UNKNOWN:case n2.UNIVER_SLIDE:case n2.UNIVER_DOC:this._univerInstanceService.getAllUnitsForType(n2.UNIVER_DOC).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Document{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}});break;case n2.UNIVER_SHEET:this._univerInstanceService.getAllUnitsForType(n2.UNIVER_SHEET).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Workbook{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}})}})};this._resourceManagerService.getAllResourceHooks().forEach(t=>e(t)),this.disposeWithMe(this._resourceManagerService.register$.subscribe(t=>e(t))),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(n2.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(n2.UNIVER_DOC).subscribe(e=>{tD(e.getUnitId())||this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(n2.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(n2.UNIVER_DOC).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())}))}saveUnit(e){let t=this._univerInstanceService.getUnit(e);if(!t)return null;let r=this._resourceManagerService.getResources(e,t.type),n=ir.deepClone(t.getSnapshot());return n.resources=r,n}};gB=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?gF(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([gj(0,(0,e2.Inject)(dP)),gj(1,(0,e2.Inject)(mk))],gB);class g${constructor(e={},t){tg(this,"_startedTypes",new Set),tg(this,"_injector"),tg(this,"_disposingCallbacks",new nZ);let r=this._injector=function(e,t){let r=m0([[d9],[mz],[gt],[mW],[m9],[dj],[mk,{useClass:mF}],[mZ,{useClass:mJ}],[s5,{useClass:s3,lazy:!0}],[s8,{useClass:at}],[gi,{useClass:gc,lazy:!0}],[dG,{useClass:dY}],[s0,{useClass:s1}],[dP,{useClass:ge,lazy:!0}],[m8,{useClass:gB,lazy:!0}],[dW,{useClass:dH}],[mK,{useClass:mq,lazy:!0}]],t),n=e?e.createChild(r):new(0,e2.Injector)(r);return tL(n,[[dj],[m8]]),n}(t,null==e?void 0:e.override),{theme:n,darkMode:i,locale:s,locales:a,logLevel:o}=e;n&&this._injector.get(gt).setTheme(n),i&&this._injector.get(gt).setDarkMode(i),a&&this._injector.get(mz).load(a),s&&this._injector.get(mz).setLocale(s),o&&this._injector.get(s5).setLogLevel(o),this._init(r)}get _univerInstanceService(){return this._injector.get(mk)}get _pluginService(){return this._injector.get(m9)}__getInjector(){return this._injector}onDispose(e){let t=this._disposingCallbacks.add(nK(e));return nK(()=>t.dispose(!0))}dispose(){this._disposingCallbacks.dispose(),this._injector.dispose()}setLocale(e){this._injector.get(mz).setLocale(e)}createUnit(e,t){return this._univerInstanceService.createUnit(e,t)}createUniverSheet(e){return this._injector.get(s5).warn("[Univer]","Univer.createUniverSheet is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(n2.UNIVER_SHEET,e)}createUniverDoc(e){return this._injector.get(s5).warn("[Univer]","Univer.createUniverDoc is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(n2.UNIVER_DOC,e)}createUniverSlide(e){return this._injector.get(s5).warn("[Univer]","Univer.createUniverSlide is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(n2.UNIVER_SLIDE,e)}_init(e){this._univerInstanceService.registerCtorForType(n2.UNIVER_SHEET,mD),this._univerInstanceService.registerCtorForType(n2.UNIVER_DOC,dg),this._univerInstanceService.registerCtorForType(n2.UNIVER_SLIDE,mV);let t=e.get(mk);t.__setCreateHandler((r,n,i,s)=>{if(!this._startedTypes.has(r)){this._pluginService.startPluginsForType(r),this._startedTypes.add(r);let a=e.createInstance(i,n);return t.__addUnit(a,s),this._tryProgressToReady(),a}let a=e.createInstance(i,n);return t.__addUnit(a,s),a})}_tryProgressToReady(){this._injector.get(mW).stage<mj.Ready&&(this._injector.get(mW).stage=mj.Ready)}registerPlugin(e,t){this._pluginService.registerPlugin(e,t)}registerPlugins(e){e.forEach(e=>{let[t,r]=e;this._pluginService.registerPlugin(t,r)})}}(function(){let e=new Map,t=0;"function"!=typeof tf.requestIdleCallback&&(tf.requestIdleCallback=function(r){let n=Date.now(),i=++t,s=setTimeout(function(){e.delete(i);let t=Math.max(0,50-(Date.now()-n));r({didTimeout:0===t,timeRemaining:()=>t})},1);return e.set(i,s),i}),"function"!=typeof tf.cancelIdleCallback&&(tf.cancelIdleCallback=function(t){let r=e.get(t);void 0!==r&&(clearTimeout(r),e.delete(t))})})(),"function"!=typeof tf.Array.prototype.findLastIndex&&(tf.Array.prototype.findLastIndex=function(e,t){if(this==null)throw TypeError("Array.prototype.findLastIndex called on null or undefined");if("function"!=typeof e)throw TypeError("callback must be a function");let r=this.length>>>0;for(let n=r-1;n>=0;n--)if(n in this&&e.call(t,this[n],n,this))return n;return -1}),"function"!=typeof tf.Array.prototype.findLast&&(tf.Array.prototype.findLast=function(e,t){let r=this.findLastIndex(e,t);return -1!==r?this[r]:void 0}),"function"!=typeof tf.String.prototype.at&&(tf.String.prototype.at=function(e){if(this==null)throw TypeError("String.prototype.at called on null or undefined");let t=this.length;if(e<0&&(e=t+e),!(e<0||e>=t))return this.charAt(e)}),eJ=e.exports,Object.keys(e2).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(eJ,e)||Object.defineProperty(eJ,e,{enumerable:!0,get:function(){return e2[e]}})})}),c("dqRu2",function(e,t){let r;i(e.exports,"isCtor",function(){return a}),i(e.exports,"isClassDependencyItem",function(){return o}),i(e.exports,"isFactoryDependencyItem",function(){return l}),i(e.exports,"isValueDependencyItem",function(){return u}),i(e.exports,"isAsyncDependencyItem",function(){return c}),i(e.exports,"isAsyncHook",function(){return d}),i(e.exports,"RediError",function(){return p}),i(e.exports,"Quantity",function(){return C}),i(e.exports,"LookUp",function(){return _}),i(e.exports,"createIdentifier",function(){return T}),i(e.exports,"SkipSelf",function(){return M}),i(e.exports,"Self",function(){return O}),i(e.exports,"Many",function(){return V}),i(e.exports,"Optional",function(){return L}),i(e.exports,"Inject",function(){return P}),i(e.exports,"setDependencies",function(){return F}),i(e.exports,"forwardRef",function(){return j}),i(e.exports,"WithNew",function(){return B}),i(e.exports,"isDisposable",function(){return $}),i(e.exports,"Injector",function(){return er});let s=Symbol("$$IDENTIFIER_DECORATOR");function a(e){return"function"==typeof e}function o(e){return!!e&&void 0!==e.useClass}function l(e){return!!e&&void 0!==e.useFactory}function u(e){return!!e&&void 0!==e.useValue}function c(e){return!!e&&void 0!==e.useAsync}let h=Symbol("AsyncHook");function d(e){return!!e&&e.__symbol===h}function m(e){return a(e)&&!e[s]?e.name:e.toString()}var g,f,p=class extends Error{constructor(e){super(`[redi]: ${e}`)}};let C=((g={}).MANY="many",g.OPTIONAL="optional",g.REQUIRED="required",g),_=((f={}).SELF="self",f.SKIP_SELF="skipSelf",f),y=Symbol("$$TARGET"),R=Symbol("$$DEPENDENCIES");var E=class extends p{constructor(e,t){super(`Could not find dependency registered on the ${e} (indexed) parameter of the constructor of "${m(t)}".`)}},b=class extends p{constructor(e,t){super(`It seems that you forgot to provide a parameter to @Required() on the ${t}th parameter of "${m(e)}"`)}},I=class extends p{constructor(e,t){super(`It seems that you register "undefined" as dependency on the ${t}th parameter of "${m(e)}". Please make sure that there is not cyclic dependency among your TypeScript files, or consider using "forwardRef". For more info please visit our website https://redi.wendell.fun/docs/faq#could-not-find-dependency-registered-on`)}};function N(e,t){let r=(e[R]||[]).find(e=>e.paramIndex===t);if(!r)throw new E(t,e);return r}function S(e,t,r,n=C.REQUIRED,i){let s={paramIndex:r,identifier:t,quantity:n,lookUp:i,withNew:!1};if(void 0===t)throw new I(e,r);e[y]===e?e[R].push(s):(e[R]=[s],e[y]=e)}let A=new Set,v=new Map;function T(e){if(A.has(e))return console.error(`Identifier "${e}" already exists. Returning the cached identifier decorator.`),v.get(e);let t=function(e,r,n){S(e,t,n)};return t.decoratorName=e,t.toString=()=>t.decoratorName,t[s]=!0,A.add(e),v.set(e,t),t}function w(e){return function t(){return this instanceof t?this:function(t,r,n){N(t,n).lookUp=e}}}let M=w(_.SKIP_SELF),O=w(_.SELF);var x=class extends p{constructor(e,t,r){let n=`Expect ${t===C.OPTIONAL?"0 or 1":"1"} dependency item(s) for id "${m(e)}" but get ${r}.`;0===r&&(n+=" Did you forget to register it?"),r>1&&(n+=" You register it more than once."),super(n),this.quantity=t,this.actual=r}};function U(e,t,r){if(t===C.OPTIONAL&&r>1||t===C.REQUIRED&&1!==r)throw new x(e,t,r)}function D(e){return function t(r){return this instanceof t?this:function(t,n,i){if(r)S(t,r,i,e);else{if(e===C.REQUIRED)throw new b(t,i);N(t,i).quantity=e}}}}let V=D(C.MANY),L=D(C.OPTIONAL),P=D(C.REQUIRED);function k(e,t=0){return e?e.map((e,r)=>{let n;if(r+=t,!Array.isArray(e))return{paramIndex:r,identifier:e,quantity:C.REQUIRED,withNew:!1};let i=e.slice(0,e.length-1),s=e[e.length-1],a=C.REQUIRED,o=!1;return i.forEach(e=>{e instanceof O?n=_.SELF:e instanceof M?n=_.SKIP_SELF:e instanceof L?a=C.OPTIONAL:e instanceof V?a=C.MANY:o=!0}),{paramIndex:r,identifier:s,quantity:a,lookUp:n,withNew:o}}):[]}function F(e,t,r=0){k(t,r).forEach(t=>{S(e,t.identifier,t.paramIndex,t.quantity,t.lookUp)})}function j(e){return{unwrap:e}}let B=function e(){return this instanceof e?this:function(e,t,r){N(e,r).withNew=!0}};function $(e){return!!e&&"function"==typeof e.dispose}let H=[];var W=class extends p{constructor(e,t,r){super(`Cannot find "${m(t)}" registered by any injector. It is the ${r}th param of "${e&&!0===e[s]?m(e):e.name}".`)}},G=class extends p{constructor(e){super(`Cannot find "${m(e)}" registered by any injector. The stack of dependencies is: "${H.map(e=>m(e)).join(" -> ")}".`),H.length=0}},Y=class{dependencyMap=new Map;constructor(e){this.normalizeDependencies(e).map(e=>this.add(e[0],e[1]))}add(e,t){void 0===t&&(t={useClass:e,lazy:!1});let r=this.dependencyMap.get(e);void 0===r&&(r=[],this.dependencyMap.set(e,r)),r.push(t)}delete(e){this.dependencyMap.delete(e)}get(e,t){let r=this.dependencyMap.get(e);return U(e,t,r.length),t===C.MANY?r:r[0]}has(e){return this.dependencyMap.has(e)}dispose(){this.dependencyMap.clear()}normalizeDependencies(e){return e.map(e=>{let t,r=e[0];return[r,t=1===e.length?{useClass:e[0],lazy:!1}:e[1]]})}},z=class{resolvedDependencies=new Map;add(e,t){let r=this.resolvedDependencies.get(e);void 0===r&&(r=[],this.resolvedDependencies.set(e,r)),r.push(t)}has(e){return this.resolvedDependencies.has(e)}get(e,t){let r=this.resolvedDependencies.get(e);if(!r)throw new G(e);return(U(e,t,r.length),t===C.MANY)?r:r[0]}dispose(){Array.from(this.resolvedDependencies.values()).forEach(e=>{e.forEach(e=>$(e)?e.dispose():void 0)}),this.resolvedDependencies.clear()}};if("undefined"!=typeof requestIdleCallback&&"undefined"!=typeof cancelIdleCallback)r=(e,t)=>{let r=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0),n=!1;return()=>{n||(n=!0,cancelIdleCallback(r))}};else{let e=Object.freeze({didTimeout:!0,timeRemaining:()=>15});r=t=>{let r=setTimeout(()=>t(e)),n=!1;return()=>{n||(n=!0,clearTimeout(r))}}}var X=class{executor;disposeIdleCallback;didRun=!1;value;error;constructor(e){this.executor=()=>{try{this.value=e()}catch(e){this.error=e}finally{this.didRun=!0}},this.disposeIdleCallback=r(()=>this.executor())}hasRun(){return this.didRun}dispose(){this.disposeIdleCallback()}getValue(){if(this.didRun||(this.disposeIdleCallback(),this.executor()),this.error)throw this.error;return this.value}};let q=Symbol("$$NOT_INSTANTIATED_SYMBOL");var K=class extends p{constructor(e){super(`Detecting cyclic dependency. The last identifier is "${m(e)}".`)}},Q=class extends p{constructor(){super("Injector cannot be accessed after it was disposed.")}},Z=class extends p{constructor(e){super(`Async item "${m(e)}" returns another async item.`)}},J=class extends p{constructor(e){super(`Cannot get async item "${m(e)}" from sync api.`)}},ee=class extends p{constructor(e){super(`Cannot add dependency "${m(e)}" after it is already resolved.`)}},et=class extends p{constructor(e){super(`Cannot delete dependency "${m(e)}" when it is already resolved.`)}},er=class e{dependencyCollection;resolvedDependencyCollection;children=[];resolutionOngoing=0;disposingCallbacks=new Set;disposed=!1;constructor(e,t=null){this.parent=t,this.dependencyCollection=new Y(e||[]),this.resolvedDependencyCollection=new z,t&&t.children.push(this)}onDispose(e){return this.disposingCallbacks.add(e),{dispose:()=>this.disposingCallbacks.delete(e)}}createChild(t){return this._ensureInjectorNotDisposed(),new e(t,this)}dispose(){this.children.forEach(e=>e.dispose()),this.children.length=0,this.dependencyCollection.dispose(),this.resolvedDependencyCollection.dispose(),this.deleteSelfFromParent(),this.disposed=!0,this.disposingCallbacks.forEach(e=>e()),this.disposingCallbacks.clear()}deleteSelfFromParent(){if(this.parent){let e=this.parent.children.indexOf(this);this.parent.children.splice(e,1)}}add(e){this._ensureInjectorNotDisposed();let t=e[0],r=e[1];if(this.resolvedDependencyCollection.has(t))throw new ee(t);void 0===r?this.dependencyCollection.add(t):c(r)||o(r)||u(r)||l(r)?this.dependencyCollection.add(t,r):this.resolvedDependencyCollection.add(t,r)}replace(e){this._ensureInjectorNotDisposed();let t=e[0];if(this.resolvedDependencyCollection.has(t))throw new ee(t);this.dependencyCollection.delete(t),this.dependencyCollection.add(t,e[1])}delete(e){if(this._ensureInjectorNotDisposed(),this.resolvedDependencyCollection.has(e))throw new et(e);this.dependencyCollection.delete(e)}invoke(e,...t){return this._ensureInjectorNotDisposed(),e({get:(e,t,r)=>this._get(e,t,r),has:e=>this.has(e)},...t)}has(e){return this.dependencyCollection.has(e)||this.parent?.has(e)||!1}get(e,t,r){this._ensureInjectorNotDisposed();let n=this._get(e,t,r);if(Array.isArray(n)&&n.some(e=>d(e))||d(n))throw new J(e);return n}_get(e,t,r,n){let i=C.REQUIRED;if(t===C.REQUIRED||t===C.OPTIONAL||t===C.MANY?i=t:r=t,!n){let t=this.getValue(e,i,r);if(t!==q)return t}return this.createDependency(e,i,r,!n)}getAsync(e){this._ensureInjectorNotDisposed();let t=this.getValue(e,C.REQUIRED);if(t!==q)return Promise.resolve(t);let r=this.createDependency(e,C.REQUIRED);return d(r)?r.whenReady():Promise.resolve(r)}createInstance(e,...t){return this._ensureInjectorNotDisposed(),this._resolveClassImpl({useClass:e},...t)}_resolveDependency(e,t,r=!0){let n;H.push(e);try{n=u(t)?this._resolveValueDependency(e,t):l(t)?this._resolveFactory(e,t,r):o(t)?this._resolveClass(e,t,r):(t&&void 0!==t.useExisting?0:1)?this._resolveAsync(e,t):this._resolveExisting(e,t),H.pop()}catch(e){throw H.pop(),e}return n}_resolveExisting(e,t){let r=this.get(t.useExisting);return this.resolvedDependencyCollection.add(e,r),r}_resolveValueDependency(e,t){let r=t.useValue;return this.resolvedDependencyCollection.add(e,r),r}_resolveClass(e,t,r){let n;if(t.lazy){let e=new X(()=>(this._ensureInjectorNotDisposed(),this._resolveClassImpl(t)));n=new Proxy(Object.create(null),{get(t,r){if(r in t)return t[r];let n=e.getValue(),i=n[r];return"function"!=typeof i||(i=i.bind(n),t[r]=i),i},set:(t,r,n)=>(e.getValue()[r]=n,!0)})}else n=this._resolveClassImpl(t);return e&&r&&this.resolvedDependencyCollection.add(e,n),n}_resolveClassImpl(e,...t){let r=e.useClass;this.markNewResolution(r);let n=(r[R]||[]).sort((e,t)=>e.paramIndex-t.paramIndex).map(e=>{var t,r;return{...e,identifier:(r=t=e.identifier)&&"function"==typeof r.unwrap?t.unwrap():t}}),i=[];for(let e of n)try{let t=this._get(e.identifier,e.quantity,e.lookUp,e.withNew);i.push(t)}catch(t){if(t instanceof G||t instanceof x&&0===t.actual)throw new W(r,e.identifier,e.paramIndex);throw t}let s=[...t],a=n.length>0?n[0].paramIndex:s.length;if(s.length!==a){console.warn(`[redi]: Expect ${a} custom parameter(s) of ${m(r)} but get ${s.length}.`);let e=a-s.length;s=e>0?[...s,...Array.from({length:e}).fill(void 0)]:s.slice(0,a)}let o=new r(...s,...i);return e?.onInstantiation?.(o),this.markResolutionCompleted(),o}_resolveFactory(e,t,r){this.markNewResolution(e);let n=k(t.deps),i=[];for(let t of n)try{let e=this._get(t.identifier,t.quantity,t.lookUp,t.withNew);i.push(e)}catch(r){if(r instanceof G||r instanceof x&&0===r.actual)throw new W(e,t.identifier,t.paramIndex);throw r}let s=t.useFactory.apply(null,i);return r&&this.resolvedDependencyCollection.add(e,s),this.markResolutionCompleted(),t?.onInstantiation?.(s),s}_resolveAsync(e,t){return{__symbol:h,whenReady:()=>this._resolveAsyncImpl(e,t)}}_resolveAsyncImpl(e,t){return t.useAsync().then(r=>{let n,i=this.getValue(e);if(i!==q)return i;if(Array.isArray(r)){let t=r[1];if(c(t))throw new Z(e);n=this._resolveDependency(e,t)}else n=a(r)?this._resolveClassImpl({useClass:r,onInstantiation:t.onInstantiation}):r;return this.resolvedDependencyCollection.add(e,n),n})}getValue(t,r=C.REQUIRED,n){let i=()=>this.dependencyCollection.has(t)&&!this.resolvedDependencyCollection.has(t)?q:this.resolvedDependencyCollection.get(t,r),s=()=>{if(this.parent)return this.parent.getValue(t,r);if(r===C.OPTIONAL)return null;if(r===C.MANY)return[];throw new x(t,C.REQUIRED,0)};return n===_.SKIP_SELF?s():t===e?this:n===_.SELF||this.resolvedDependencyCollection.has(t)||this.dependencyCollection.has(t)?i():s()}createDependency(e,t,r,n=!0){let i=()=>{let r=this.dependencyCollection.get(e,t);return Array.isArray(r)?r.map(t=>this._resolveDependency(e,t,n)):this._resolveDependency(e,r,n)},s=()=>{if(this.parent)return this.parent.createDependency(e,t,void 0,n);if(t===C.OPTIONAL)return null;if(t===C.MANY)return[];throw H.push(e),new G(e)};return r===_.SKIP_SELF?s():this.dependencyCollection.has(e)?i():s()}markNewResolution(e){if(this.resolutionOngoing+=1,this.resolutionOngoing>=300)throw new K(e)}markResolutionCompleted(){this.resolutionOngoing-=1}_ensureInjectorNotDisposed(){if(this.disposed)throw new Q}};let en="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof window&&window||void 0!==n&&n,ei="REDI_GLOBAL_LOCK";en[ei]?console.error(`[redi]: You are loading scripts of redi more than once! This may cause undesired behavior in your application.
Maybe your dependencies added redi as its dependency and bundled redi to its dist files. Or you import different versions of redi.
For more info please visit our website: https://redi.wendell.fun/en-US/docs/faq#import-scripts-of-redi-more-than-once`):en[ei]=!0}),c("5LPkb",function(e,t){i(e.exports,"BehaviorSubject",function(){return n});var r=u("14wAQ"),n=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return(0,r.__extends)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r.closed||t.next(this._value),r},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(u("1mjSk").Subject)}),c("14wAQ",function(e,t){i(e.exports,"__extends",function(){return n}),i(e.exports,"__awaiter",function(){return s}),i(e.exports,"__generator",function(){return a}),i(e.exports,"__values",function(){return o}),i(e.exports,"__read",function(){return l}),i(e.exports,"__spreadArray",function(){return u}),i(e.exports,"__await",function(){return c}),i(e.exports,"__asyncGenerator",function(){return h}),i(e.exports,"__asyncValues",function(){return d});var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})}function a(e,t){var r,n,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,n=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a}function u(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function c(e){return this instanceof c?(this.v=e,this):new c(e)}function h(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function a(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||o(e,t)})},t&&(n[e]=t(n[e])))}function o(e,t){try{var r;(r=i[e](t)).value instanceof c?Promise.resolve(r.value.v).then(l,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function h(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function d(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=o(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){var s,a,o;s=n,a=i,o=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:o})},a)})}}}"function"==typeof SuppressedError&&SuppressedError}),c("1mjSk",function(e,t){i(e.exports,"Subject",function(){return c});var r=u("14wAQ"),n=u("1O3Nt"),s=u("e1VZ5"),a=u("c6P6i"),o=u("hFN8R"),l=u("dIjnd"),c=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,r.__extends)(t,e),t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new(0,a.ObjectUnsubscribedError)},t.prototype.next=function(e){var t=this;(0,l.errorContext)(function(){var n,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var s=(0,r.__values)(t.currentObservers),a=s.next();!a.done;a=s.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;(0,l.errorContext)(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;(0,l.errorContext)(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?s.EMPTY_SUBSCRIPTION:(this.currentObservers=null,i.push(e),new(0,s.Subscription)(function(){t.currentObservers=null,(0,o.arrRemove)(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},t.prototype.asObservable=function(){var e=new(0,n.Observable);return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(n.Observable),h=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return(0,r.__extends)(t,e),t.prototype.next=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.next)||r.call(t,e)},t.prototype.error=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.error)||r.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!=(r=null==(t=this.source)?void 0:t.subscribe(e))?r:s.EMPTY_SUBSCRIPTION},t}(c)}),c("1O3Nt",function(e,t){i(e.exports,"Observable",function(){return h});var r=u("lftZl"),n=u("e1VZ5"),s=u("eDMxo"),a=u("1hKfX"),o=u("laEi0"),l=u("3IQI0"),c=u("dIjnd"),h=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,i){var s=this,a=!function(e){return e&&e instanceof r.Subscriber||e&&(0,l.isFunction)(e.next)&&(0,l.isFunction)(e.error)&&(0,l.isFunction)(e.complete)&&(0,n.isSubscription)(e)}(e)?new(0,r.SafeSubscriber)(e,t,i):e;return(0,c.errorContext)(function(){var e=s.operator,t=s.source;a.add(e?e.call(a,t):t?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=d(t))(function(t,i){var s=new(0,r.SafeSubscriber)({next:function(t){try{e(t)}catch(e){i(e),s.unsubscribe()}},error:i,complete:t});n.subscribe(s)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[s.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,a.pipeFromArray)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=d(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function d(e){var t;return null!=(t=null!=e?e:o.config.Promise)?t:Promise}}),c("lftZl",function(e,t){i(e.exports,"Subscriber",function(){return m}),i(e.exports,"SafeSubscriber",function(){return C});var r=u("14wAQ"),n=u("3IQI0"),s=u("e1VZ5"),a=u("laEi0"),o=u("ghA1h"),l=u("f1euv"),c=u("6x7Ga"),h=u("caYEJ"),d=u("dIjnd"),m=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,(0,s.isSubscription)(t)&&t.add(r)):r.destination=R,r}return(0,r.__extends)(t,e),t.create=function(e,t,r){return new C(e,t,r)},t.prototype.next=function(e){this.isStopped?y((0,c.nextNotification)(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?y((0,c.errorNotification)(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?y(c.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(s.Subscription),g=Function.prototype.bind;function f(e,t){return g.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){_(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){_(e)}else _(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){_(e)}},e}(),C=function(e){function t(t,r,i){var s,o,l=e.call(this)||this;return(0,n.isFunction)(t)||!t?s={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=i?i:void 0}:l&&a.config.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},s={next:t.next&&f(t.next,o),error:t.error&&f(t.error,o),complete:t.complete&&f(t.complete,o)}):s=t,l.destination=new p(s),l}return(0,r.__extends)(t,e),t}(m);function _(e){a.config.useDeprecatedSynchronousErrorHandling?(0,d.captureError)(e):(0,o.reportUnhandledError)(e)}function y(e,t){var r=a.config.onStoppedNotification;r&&h.timeoutProvider.setTimeout(function(){return r(e,t)})}var R={closed:!0,next:l.noop,error:function(e){throw e},complete:l.noop}}),c("3IQI0",function(e,t){i(e.exports,"isFunction",function(){return r});function r(e){return"function"==typeof e}}),c("e1VZ5",function(e,t){i(e.exports,"Subscription",function(){return o}),i(e.exports,"EMPTY_SUBSCRIPTION",function(){return l}),i(e.exports,"isSubscription",function(){return c});var r=u("14wAQ"),n=u("3IQI0"),s=u("iftTV"),a=u("hFN8R"),o=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,i,a,o,l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var u=(0,r.__values)(l),c=u.next();!c.done;c=u.next())c.value.remove(this)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else l.remove(this);var d=this.initialTeardown;if((0,n.isFunction)(d))try{d()}catch(e){o=e instanceof s.UnsubscriptionError?e.errors:[e]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var g=(0,r.__values)(m),f=g.next();!f.done;f=g.next()){var p=f.value;try{h(p)}catch(e){o=null!=o?o:[],e instanceof s.UnsubscriptionError?o=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(o)),(0,r.__read)(e.errors)):o.push(e)}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}}if(o)throw new(0,s.UnsubscriptionError)(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)h(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(r=this._finalizers)?r:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&(0,a.arrRemove)(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&(0,a.arrRemove)(r,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),l=o.EMPTY;function c(e){return e instanceof o||e&&"closed"in e&&(0,n.isFunction)(e.remove)&&(0,n.isFunction)(e.add)&&(0,n.isFunction)(e.unsubscribe)}function h(e){(0,n.isFunction)(e)?e():e.unsubscribe()}}),c("iftTV",function(e,t){i(e.exports,"UnsubscriptionError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}})}),c("bfFMS",function(e,t){i(e.exports,"createErrorClass",function(){return r});function r(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}}),c("hFN8R",function(e,t){i(e.exports,"arrRemove",function(){return r});function r(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}}),c("laEi0",function(e,t){i(e.exports,"config",function(){return r});var r={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}}),c("ghA1h",function(e,t){i(e.exports,"reportUnhandledError",function(){return s});var r=u("laEi0"),n=u("caYEJ");function s(e){n.timeoutProvider.setTimeout(function(){var t=r.config.onUnhandledError;if(t)t(e);else throw e})}}),c("caYEJ",function(e,t){i(e.exports,"timeoutProvider",function(){return n});var r=u("14wAQ"),n={setTimeout:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=n.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,r.__spreadArray)([e,t],(0,r.__read)(i))):setTimeout.apply(void 0,(0,r.__spreadArray)([e,t],(0,r.__read)(i)))},clearTimeout:function(e){var t=n.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}}),c("f1euv",function(e,t){i(e.exports,"noop",function(){return r});function r(){}}),c("6x7Ga",function(e,t){i(e.exports,"COMPLETE_NOTIFICATION",function(){return r}),i(e.exports,"errorNotification",function(){return n}),i(e.exports,"nextNotification",function(){return s});var r=a("C",void 0,void 0);function n(e){return a("E",void 0,e)}function s(e){return a("N",e,void 0)}function a(e,t,r){return{kind:e,value:t,error:r}}}),c("dIjnd",function(e,t){i(e.exports,"errorContext",function(){return s}),i(e.exports,"captureError",function(){return a});var r=u("laEi0"),n=null;function s(e){if(r.config.useDeprecatedSynchronousErrorHandling){var t=!n;if(t&&(n={errorThrown:!1,error:null}),e(),t){var i=n,s=i.errorThrown,a=i.error;if(n=null,s)throw a}}else e()}function a(e){r.config.useDeprecatedSynchronousErrorHandling&&n&&(n.errorThrown=!0,n.error=e)}}),c("eDMxo",function(e,t){i(e.exports,"observable",function(){return r});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"}),c("1hKfX",function(e,t){i(e.exports,"pipe",function(){return n}),i(e.exports,"pipeFromArray",function(){return s});var r=u("2N6l4");function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(e)}function s(e){return 0===e.length?r.identity:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}}),c("2N6l4",function(e,t){i(e.exports,"identity",function(){return r});function r(e){return e}}),c("c6P6i",function(e,t){i(e.exports,"ObjectUnsubscribedError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})}),c("5K4WI",function(e,t){i(e.exports,"combineLatest",function(){return m}),i(e.exports,"combineLatestInit",function(){return g});var r=u("1O3Nt"),n=u("6obID"),s=u("fz1T5"),a=u("2N6l4"),o=u("h319C"),l=u("4xvfD"),c=u("TccoZ"),h=u("iNetn"),d=u("99A8K");function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,l.popScheduler)(e),u=(0,l.popResultSelector)(e),h=(0,n.argsArgArrayOrObject)(e),d=h.args,m=h.keys;if(0===d.length)return(0,s.from)([],i);var f=new(0,r.Observable)(g(d,i,m?function(e){return(0,c.createObject)(m,e)}:a.identity));return u?f.pipe((0,o.mapOneOrManyArgs)(u)):f}function g(e,t,r){return void 0===r&&(r=a.identity),function(n){f(t,function(){for(var i=e.length,a=Array(i),o=i,l=i,u=function(i){f(t,function(){var u=(0,s.from)(e[i],t),c=!1;u.subscribe((0,h.createOperatorSubscriber)(n,function(e){a[i]=e,!c&&(c=!0,l--),l||n.next(r(a.slice()))},function(){--o||n.complete()}))},n)},c=0;c<i;c++)u(c)},n)}}function f(e,t,r){e?(0,d.executeSchedule)(r,e,t):t()}}),c("6obID",function(e,t){i(e.exports,"argsArgArrayOrObject",function(){return o});var r=Array.isArray,n=Object.getPrototypeOf,s=Object.prototype,a=Object.keys;function o(e){if(1===e.length){var t,i=e[0];if(r(i))return{args:i,keys:null};if((t=i)&&"object"==typeof t&&n(t)===s){var o=a(i);return{args:o.map(function(e){return i[e]}),keys:o}}}return{args:e,keys:null}}}),c("fz1T5",function(e,t){i(e.exports,"from",function(){return s});var r=u("3ESKv"),n=u("b7gpN");function s(e,t){return t?(0,r.scheduled)(e,t):(0,n.innerFrom)(e)}}),c("3ESKv",function(e,t){i(e.exports,"scheduled",function(){return C});var r=u("HWDtl"),n=u("kx7NJ"),s=u("61w6q"),a=u("3kNl0"),o=u("1jutQ"),l=u("5BIEa"),c=u("jWdZ8"),h=u("bLVFn"),d=u("6woc9"),m=u("aewtS"),g=u("729in"),f=u("fdiCB"),p=u("dvjJq");function C(e,t){if(null!=e){if((0,l.isInteropObservable)(e))return(0,r.scheduleObservable)(e,t);if((0,h.isArrayLike)(e))return(0,s.scheduleArray)(e,t);if((0,c.isPromise)(e))return(0,n.schedulePromise)(e,t);if((0,m.isAsyncIterable)(e))return(0,o.scheduleAsyncIterable)(e,t);if((0,d.isIterable)(e))return(0,a.scheduleIterable)(e,t);if((0,f.isReadableStreamLike)(e))return(0,p.scheduleReadableStreamLike)(e,t)}throw(0,g.createInvalidObservableTypeError)(e)}}),c("HWDtl",function(e,t){i(e.exports,"scheduleObservable",function(){return a});var r=u("b7gpN"),n=u("jHEit"),s=u("bQ23s");function a(e,t){return(0,r.innerFrom)(e).pipe((0,s.subscribeOn)(t),(0,n.observeOn)(t))}}),c("b7gpN",function(e,t){i(e.exports,"innerFrom",function(){return p});var r=u("14wAQ"),n=u("bLVFn"),s=u("jWdZ8"),a=u("1O3Nt"),o=u("5BIEa"),l=u("aewtS"),c=u("729in"),h=u("6woc9"),d=u("fdiCB"),m=u("3IQI0"),g=u("ghA1h"),f=u("eDMxo");function p(e){if(e instanceof a.Observable)return e;if(null!=e){var t,i,u,p,_;if((0,o.isInteropObservable)(e)){return t=e,new(0,a.Observable)(function(e){var r=t[f.observable]();if((0,m.isFunction)(r.subscribe))return r.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")})}if((0,n.isArrayLike)(e)){return i=e,new(0,a.Observable)(function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}if((0,s.isPromise)(e)){return u=e,new(0,a.Observable)(function(e){u.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,g.reportUnhandledError)})}if((0,l.isAsyncIterable)(e))return C(e);if((0,h.isIterable)(e)){return p=e,new(0,a.Observable)(function(e){var t,n;try{for(var i=(0,r.__values)(p),s=i.next();!s.done;s=i.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}if((0,d.isReadableStreamLike)(e)){return _=e,C((0,d.readableStreamLikeToAsyncGenerator)(_))}}throw(0,c.createInvalidObservableTypeError)(e)}function C(e){return new(0,a.Observable)(function(t){(function(e,t){var n,i,s,a;return(0,r.__awaiter)(this,void 0,void 0,function(){var o;return(0,r.__generator)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=(0,r.__asyncValues)(e),l.label=1;case 1:return[4,n.next()];case 2:if((i=l.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s={error:l.sent()},[3,11];case 6:if(l.trys.push([6,,9,10]),!(i&&!i.done&&(a=n.return)))return[3,8];return[4,a.call(n)];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}}),c("bLVFn",function(e,t){i(e.exports,"isArrayLike",function(){return r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}}),c("jWdZ8",function(e,t){i(e.exports,"isPromise",function(){return n});var r=u("3IQI0");function n(e){return(0,r.isFunction)(null==e?void 0:e.then)}}),c("5BIEa",function(e,t){i(e.exports,"isInteropObservable",function(){return s});var r=u("eDMxo"),n=u("3IQI0");function s(e){return(0,n.isFunction)(e[r.observable])}}),c("aewtS",function(e,t){i(e.exports,"isAsyncIterable",function(){return n});var r=u("3IQI0");function n(e){return Symbol.asyncIterator&&(0,r.isFunction)(null==e?void 0:e[Symbol.asyncIterator])}}),c("729in",function(e,t){i(e.exports,"createInvalidObservableTypeError",function(){return r});function r(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}}),c("6woc9",function(e,t){i(e.exports,"isIterable",function(){return s});var r=u("kZq5V"),n=u("3IQI0");function s(e){return(0,n.isFunction)(null==e?void 0:e[r.iterator])}}),c("kZq5V",function(e,t){i(e.exports,"iterator",function(){return r});var r="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}),c("fdiCB",function(e,t){i(e.exports,"readableStreamLikeToAsyncGenerator",function(){return s}),i(e.exports,"isReadableStreamLike",function(){return a});var r=u("14wAQ"),n=u("3IQI0");function s(e){return(0,r.__asyncGenerator)(this,arguments,function(){var t,n,i;return(0,r.__generator)(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,(0,r.__await)(t.read())];case 3:if(i=(n=s.sent()).value,!n.done)return[3,5];return[4,(0,r.__await)(void 0)];case 4:return[2,s.sent()];case 5:return[4,(0,r.__await)(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function a(e){return(0,n.isFunction)(null==e?void 0:e.getReader)}}),c("jHEit",function(e,t){i(e.exports,"observeOn",function(){return a});var r=u("99A8K"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=0),(0,n.operate)(function(n,i){n.subscribe((0,s.createOperatorSubscriber)(i,function(n){return(0,r.executeSchedule)(i,e,function(){return i.next(n)},t)},function(){return(0,r.executeSchedule)(i,e,function(){return i.complete()},t)},function(n){return(0,r.executeSchedule)(i,e,function(){return i.error(n)},t)}))})}}),c("99A8K",function(e,t){i(e.exports,"executeSchedule",function(){return r});function r(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}}),c("jSzwf",function(e,t){i(e.exports,"operate",function(){return n});var r=u("3IQI0");function n(e){return function(t){if((0,r.isFunction)(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}}),c("iNetn",function(e,t){i(e.exports,"createOperatorSubscriber",function(){return n});var r=u("14wAQ");function n(e,t,r,n,i){return new s(e,t,r,n,i)}var s=function(e){function t(t,r,n,i,s,a){var o=e.call(this,t)||this;return o.onFinalize=s,o.shouldUnsubscribe=a,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return(0,r.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),r||null==(t=this.onFinalize)||t.call(this)}},t}(u("lftZl").Subscriber)}),c("bQ23s",function(e,t){i(e.exports,"subscribeOn",function(){return n});var r=u("jSzwf");function n(e,t){return void 0===t&&(t=0),(0,r.operate)(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}}),c("kx7NJ",function(e,t){i(e.exports,"schedulePromise",function(){return a});var r=u("b7gpN"),n=u("jHEit"),s=u("bQ23s");function a(e,t){return(0,r.innerFrom)(e).pipe((0,s.subscribeOn)(t),(0,n.observeOn)(t))}}),c("61w6q",function(e,t){i(e.exports,"scheduleArray",function(){return n});var r=u("1O3Nt");function n(e,t){return new(0,r.Observable)(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}}),c("3kNl0",function(e,t){i(e.exports,"scheduleIterable",function(){return o});var r=u("1O3Nt"),n=u("kZq5V"),s=u("3IQI0"),a=u("99A8K");function o(e,t){return new(0,r.Observable)(function(r){var i;return(0,a.executeSchedule)(r,t,function(){i=e[n.iterator](),(0,a.executeSchedule)(r,t,function(){var e,t,n;try{t=(e=i.next()).value,n=e.done}catch(e){r.error(e);return}n?r.complete():r.next(t)},0,!0)}),function(){return(0,s.isFunction)(null==i?void 0:i.return)&&i.return()}})}}),c("1jutQ",function(e,t){i(e.exports,"scheduleAsyncIterable",function(){return s});var r=u("1O3Nt"),n=u("99A8K");function s(e,t){if(!e)throw Error("Iterable cannot be null");return new(0,r.Observable)(function(r){(0,n.executeSchedule)(r,t,function(){var i=e[Symbol.asyncIterator]();(0,n.executeSchedule)(r,t,function(){i.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}}),c("dvjJq",function(e,t){i(e.exports,"scheduleReadableStreamLike",function(){return s});var r=u("1jutQ"),n=u("fdiCB");function s(e,t){return(0,r.scheduleAsyncIterable)((0,n.readableStreamLikeToAsyncGenerator)(e),t)}}),c("h319C",function(e,t){i(e.exports,"mapOneOrManyArgs",function(){return a});var r=u("14wAQ"),n=u("hciHF"),s=Array.isArray;function a(e){return(0,n.map)(function(t){return s(t)?e.apply(void 0,(0,r.__spreadArray)([],(0,r.__read)(t))):e(t)})}}),c("hciHF",function(e,t){i(e.exports,"map",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e,t){return(0,r.operate)(function(r,i){var s=0;r.subscribe((0,n.createOperatorSubscriber)(i,function(r){i.next(e.call(t,r,s++))}))})}}),c("4xvfD",function(e,t){i(e.exports,"popResultSelector",function(){return a}),i(e.exports,"popScheduler",function(){return o}),i(e.exports,"popNumber",function(){return l});var r=u("3IQI0"),n=u("4tjBj");function s(e){return e[e.length-1]}function a(e){return(0,r.isFunction)(s(e))?e.pop():void 0}function o(e){return(0,n.isScheduler)(s(e))?e.pop():void 0}function l(e,t){return"number"==typeof s(e)?e.pop():t}}),c("4tjBj",function(e,t){i(e.exports,"isScheduler",function(){return n});var r=u("3IQI0");function n(e){return e&&(0,r.isFunction)(e.schedule)}}),c("TccoZ",function(e,t){i(e.exports,"createObject",function(){return r});function r(e,t){return e.reduce(function(e,r,n){return e[r]=t[n],e},{})}}),c("bXJOC",function(e,t){i(e.exports,"debounceTime",function(){return a});var r=u("jaZjQ"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=r.asyncScheduler),(0,n.operate)(function(r,n){var i=null,a=null,o=null,l=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,n.next(e)}};function u(){var r=o+e,s=t.now();if(s<r){i=this.schedule(void 0,r-s),n.add(i);return}l()}r.subscribe((0,s.createOperatorSubscriber)(n,function(r){a=r,o=t.now(),i||(i=t.schedule(u,e),n.add(i))},function(){l(),n.complete()},void 0,function(){a=i=null}))})}}),c("jaZjQ",function(e,t){i(e.exports,"asyncScheduler",function(){return n}),i(e.exports,"async",function(){return s});var r=u("aTfYm"),n=new(0,u("7GTYN").AsyncScheduler)(r.AsyncAction),s=n}),c("aTfYm",function(e,t){i(e.exports,"AsyncAction",function(){return o});var r=u("14wAQ"),n=u("iSRzt"),s=u("ic7D4"),a=u("hFN8R"),o=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return(0,r.__extends)(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r,n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!=(r=this.id)?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),s.intervalProvider.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&s.intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,(0,a.arrRemove)(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(n.Action)}),c("iSRzt",function(e,t){i(e.exports,"Action",function(){return n});var r=u("14wAQ"),n=function(e){function t(t,r){return e.call(this)||this}return(0,r.__extends)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(u("e1VZ5").Subscription)}),c("ic7D4",function(e,t){i(e.exports,"intervalProvider",function(){return n});var r=u("14wAQ"),n={setInterval:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=n.delegate;return(null==a?void 0:a.setInterval)?a.setInterval.apply(a,(0,r.__spreadArray)([e,t],(0,r.__read)(i))):setInterval.apply(void 0,(0,r.__spreadArray)([e,t],(0,r.__read)(i)))},clearInterval:function(e){var t=n.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0}}),c("7GTYN",function(e,t){i(e.exports,"AsyncScheduler",function(){return s});var r=u("14wAQ"),n=u("gDW7u"),s=function(e){function t(t,r){void 0===r&&(r=n.Scheduler.now);var i=e.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return(0,r.__extends)(t,e),t.prototype.flush=function(e){var t,r=this.actions;if(this._active)return void r.push(e);this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=r.shift())if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}},t}(n.Scheduler)}),c("gDW7u",function(e,t){i(e.exports,"Scheduler",function(){return n});var r=u("O2Flc"),n=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=r.dateTimestampProvider.now,e}()}),c("O2Flc",function(e,t){i(e.exports,"dateTimestampProvider",function(){return r});var r={now:function(){return(r.delegate||Date).now()},delegate:void 0}}),c("arCqp",function(e,t){i(e.exports,"distinctUntilChanged",function(){return a});var r=u("2N6l4"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=r.identity),e=null!=e?e:o,(0,n.operate)(function(r,n){var i,a=!0;r.subscribe((0,s.createOperatorSubscriber)(n,function(r){var s=t(r);(a||!e(i,s))&&(a=!1,i=s,n.next(r))}))})}function o(e,t){return e===t}}),c("lMvMU",function(e,t){i(e.exports,"filter",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e,t){return(0,r.operate)(function(r,i){var s=0;r.subscribe((0,n.createOperatorSubscriber)(i,function(r){return e.call(t,r,s++)&&i.next(r)}))})}}),c("dBx9C",function(e,t){i(e.exports,"firstValueFrom",function(){return s});var r=u("aXqMV"),n=u("lftZl");function s(e,t){var i="object"==typeof t;return new Promise(function(s,a){var o=new(0,n.SafeSubscriber)({next:function(e){s(e),o.unsubscribe()},error:a,complete:function(){i?s(t.defaultValue):a(new(0,r.EmptyError))}});e.subscribe(o)})}}),c("aXqMV",function(e,t){i(e.exports,"EmptyError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})}),c("i54iF",function(e,t){i(e.exports,"merge",function(){return l});var r=u("gpa4f"),n=u("b7gpN"),s=u("gL4uk"),a=u("4xvfD"),o=u("fz1T5");function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,a.popScheduler)(e),l=(0,a.popNumber)(e,1/0);return e.length?1===e.length?(0,n.innerFrom)(e[0]):(0,r.mergeAll)(l)((0,o.from)(e,i)):s.EMPTY}}),c("gpa4f",function(e,t){i(e.exports,"mergeAll",function(){return s});var r=u("97m73"),n=u("2N6l4");function s(e){return void 0===e&&(e=1/0),(0,r.mergeMap)(n.identity,e)}}),c("97m73",function(e,t){i(e.exports,"mergeMap",function(){return function e(t,i,l){return(void 0===l&&(l=1/0),(0,o.isFunction)(i))?e(function(e,s){return(0,r.map)(function(t,r){return i(e,t,s,r)})((0,n.innerFrom)(t(e,s)))},l):("number"==typeof i&&(l=i),(0,s.operate)(function(e,r){return(0,a.mergeInternals)(e,r,t,l)}))}});var r=u("hciHF"),n=u("b7gpN"),s=u("jSzwf"),a=u("c8eGQ"),o=u("3IQI0")}),c("c8eGQ",function(e,t){i(e.exports,"mergeInternals",function(){return a});var r=u("b7gpN"),n=u("99A8K"),s=u("iNetn");function a(e,t,i,a,o,l,u,c){var h=[],d=0,m=0,g=!1,f=function(){!g||h.length||d||t.complete()},p=function(e){return d<a?C(e):h.push(e)},C=function(e){l&&t.next(e),d++;var c=!1;(0,r.innerFrom)(i(e,m++)).subscribe((0,s.createOperatorSubscriber)(t,function(e){null==o||o(e),l?p(e):t.next(e)},function(){c=!0},void 0,function(){if(c)try{for(d--;h.length&&d<a;)!function(){var e=h.shift();u?(0,n.executeSchedule)(t,u,function(){return C(e)}):C(e)}();f()}catch(e){t.error(e)}}))};return e.subscribe((0,s.createOperatorSubscriber)(t,p,function(){g=!0,f()})),function(){null==c||c()}}}),c("gL4uk",function(e,t){i(e.exports,"EMPTY",function(){return r});var r=new(0,u("1O3Nt").Observable)(function(e){return e.complete()})}),c("3yupB",function(e,t){i(e.exports,"of",function(){return s});var r=u("4xvfD"),n=u("fz1T5");function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,r.popScheduler)(e);return(0,n.from)(e,i)}}),c("3rvNF",function(e,t){i(e.exports,"ReplaySubject",function(){return a});var r=u("14wAQ"),n=u("1mjSk"),s=u("O2Flc"),a=function(e){function t(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=s.dateTimestampProvider);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return(0,r.__extends)(t,e),t.prototype.next=function(t){var r=this.isStopped,n=this._buffer,i=this._infiniteTimeWindow,s=this._timestampProvider,a=this._windowTime;!r&&(n.push(t),i||n.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,n=this._infiniteTimeWindow,i=(n?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!n){for(var s=t.now(),a=0,o=1;o<r.length&&r[o]<=s;o+=2)a=o;a&&r.splice(0,a+1)}},t}(n.Subject)}),c("9GqS8",function(e,t){i(e.exports,"skip",function(){return n});var r=u("lMvMU");function n(e){return(0,r.filter)(function(t,r){return e<=r})}}),c("9z4na",function(e,t){i(e.exports,"take",function(){return a});var r=u("gL4uk"),n=u("jSzwf"),s=u("iNetn");function a(e){return e<=0?function(){return r.EMPTY}:(0,n.operate)(function(t,r){var n=0;t.subscribe((0,s.createOperatorSubscriber)(r,function(t){++n<=e&&(r.next(t),e<=n&&r.complete())}))})}}),c("b7wVW",function(e,t){i(e.exports,"tap",function(){return o});var r=u("3IQI0"),n=u("jSzwf"),s=u("iNetn"),a=u("2N6l4");function o(e,t,i){var o=(0,r.isFunction)(e)||t||i?{next:e,error:t,complete:i}:e;return o?(0,n.operate)(function(e,t){null==(r=o.subscribe)||r.call(o);var r,n=!0;e.subscribe((0,s.createOperatorSubscriber)(t,function(e){var r;null==(r=o.next)||r.call(o,e),t.next(e)},function(){var e;n=!1,null==(e=o.complete)||e.call(o),t.complete()},function(e){var r;n=!1,null==(r=o.error)||r.call(o,e),t.error(e)},function(){var e,t;n&&(null==(e=o.unsubscribe)||e.call(o)),null==(t=o.finalize)||t.call(o)}))}):a.identity}}),c("aMpZj",function(e,t){i(e.exports,"timer",function(){return o});var r=u("1O3Nt"),n=u("jaZjQ"),s=u("4tjBj"),a=u("hdn9Z");function o(e,t,i){void 0===e&&(e=0),void 0===i&&(i=n.async);var o=-1;return null!=t&&((0,s.isScheduler)(t)?i=t:o=t),new(0,r.Observable)(function(t){var r=(0,a.isValidDate)(e)?e-i.now():e;r<0&&(r=0);var n=0;return i.schedule(function(){t.closed||(t.next(n++),0<=o?this.schedule(void 0,o):t.complete())},r)})}}),c("hdn9Z",function(e,t){i(e.exports,"isValidDate",function(){return r});function r(e){return e instanceof Date&&!isNaN(e)}}),c("bDEN0",function(e,t){i(e.exports,"first",function(){return c});var r=u("aXqMV"),n=u("lMvMU"),s=u("9z4na"),a=u("gSl4p"),o=u("aRjCl"),l=u("2N6l4");function c(e,t){var i=arguments.length>=2;return function(u){return u.pipe(e?(0,n.filter)(function(t,r){return e(t,r,u)}):l.identity,(0,s.take)(1),i?(0,a.defaultIfEmpty)(t):(0,o.throwIfEmpty)(function(){return new(0,r.EmptyError)}))}}}),c("gSl4p",function(e,t){i(e.exports,"defaultIfEmpty",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e){return(0,r.operate)(function(t,r){var i=!1;t.subscribe((0,n.createOperatorSubscriber)(r,function(e){i=!0,r.next(e)},function(){i||r.next(e),r.complete()}))})}}),c("aRjCl",function(e,t){i(e.exports,"throwIfEmpty",function(){return a});var r=u("aXqMV"),n=u("jSzwf"),s=u("iNetn");function a(e){return void 0===e&&(e=o),(0,n.operate)(function(t,r){var n=!1;t.subscribe((0,s.createOperatorSubscriber)(r,function(e){n=!0,r.next(e)},function(){return n?r.complete():r.error(e())}))})}function o(){return new(0,r.EmptyError)}}),c("hBGpS",function(e,t){i(e.exports,"defaultTheme",function(){return r}),i(e.exports,"greenTheme",function(){return n});let r={white:"#FFFFFF",black:"#000000",primary:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},gray:{50:"#F9FAFB",100:"#EEEFF1",200:"#E3E5EA",300:"#A8B0BD",400:"#7D8698",500:"#4E5565",600:"#31363F",700:"#272A2F",800:"#1F2124",900:"#1B1C1F"},blue:{50:"#EBF5FF",100:"#E1EFFE",200:"#C3DDFD",300:"#A4CAFE",400:"#76A9FA",500:"#3F83F8",600:"#1C64F2",700:"#1A56DB",800:"#1E429F",900:"#233876"},red:{50:"#FDF2F2",100:"#FDE8E8",200:"#FBD5D5",300:"#F8B4B4",400:"#F98080",500:"#F05252",600:"#E02424",700:"#C81E1E",800:"#9B1C1C",900:"#771D1D"},orange:{50:"#FFF8F1",100:"#FEECDC",200:"#FCD9BD",300:"#FDBA8C",400:"#FF8A4C",500:"#FF5A1F",600:"#D03801",700:"#B43403",800:"#8A2C0D",900:"#771D1D"},yellow:{50:"#FDFCEA",100:"#FFF4B9",200:"#FCDC6A",300:"#FAC815",400:"#F1B312",500:"#D49D0F",600:"#AB7F0E",700:"#9A6D15",800:"#725213",900:"#634312"},green:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},jiqing:{50:"#EDFAFA",100:"#D5F5F6",200:"#AFECEF",300:"#7EDCE2",400:"#16BDCA",500:"#0694A2",600:"#047481",700:"#036672",800:"#05505C",900:"#014451"},indigo:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},purple:{50:"#F6F5FF",100:"#EDEBFE",200:"#DCD7FE",300:"#CABFFD",400:"#AC94FA",500:"#9061F9",600:"#7E3AF2",700:"#6C2BD9",800:"#5521B5",900:"#4A1D96"},pink:{50:"#FDF2F8",100:"#FCE8F3",200:"#FAD1E8",300:"#F8B4D9",400:"#F17EB8",500:"#E74694",600:"#D61F69",700:"#BF125D",800:"#99154B",900:"#751A3D"},"loop-color":{1:"purple.400",2:"green.500",3:"blue.500",4:"yellow.400",5:"pink.300",6:"jiqing.600",7:"orange.400",8:"gray.800",9:"indigo.500",10:"red.300",11:"green.600",12:"yellow.700"}},n={white:"#FFFFFF",black:"#000000",primary:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},gray:{50:"#F9FAFB",100:"#EEEFF1",200:"#E3E5EA",300:"#A8B0BD",400:"#7D8698",500:"#4E5565",600:"#31363F",700:"#272A2F",800:"#1F2124",900:"#1B1C1F"},blue:{50:"#EBF5FF",100:"#E1EFFE",200:"#C3DDFD",300:"#A4CAFE",400:"#76A9FA",500:"#3F83F8",600:"#1C64F2",700:"#1A56DB",800:"#1E429F",900:"#233876"},red:{50:"#FDF2F2",100:"#FDE8E8",200:"#FBD5D5",300:"#F8B4B4",400:"#F98080",500:"#F05252",600:"#E02424",700:"#C81E1E",800:"#9B1C1C",900:"#771D1D"},orange:{50:"#FFF8F1",100:"#FEECDC",200:"#FCD9BD",300:"#FDBA8C",400:"#FF8A4C",500:"#FF5A1F",600:"#D03801",700:"#B43403",800:"#8A2C0D",900:"#771D1D"},yellow:{50:"#FDFCEA",100:"#FFF4B9",200:"#FCDC6A",300:"#FAC815",400:"#F1B312",500:"#D49D0F",600:"#AB7F0E",700:"#9A6D15",800:"#725213",900:"#634312"},green:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},jiqing:{50:"#EDFAFA",100:"#D5F5F6",200:"#AFECEF",300:"#7EDCE2",400:"#16BDCA",500:"#0694A2",600:"#047481",700:"#036672",800:"#05505C",900:"#014451"},indigo:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},purple:{50:"#F6F5FF",100:"#EDEBFE",200:"#DCD7FE",300:"#CABFFD",400:"#AC94FA",500:"#9061F9",600:"#7E3AF2",700:"#6C2BD9",800:"#5521B5",900:"#4A1D96"},pink:{50:"#FDF2F8",100:"#FCE8F3",200:"#FAD1E8",300:"#F8B4D9",400:"#F17EB8",500:"#E74694",600:"#D61F69",700:"#BF125D",800:"#99154B",900:"#751A3D"},"loop-color":{1:"purple.400",2:"green.500",3:"blue.500",4:"yellow.400",5:"pink.300",6:"jiqing.600",7:"orange.400",8:"gray.800",9:"indigo.500",10:"red.300",11:"green.600",12:"yellow.700"}}}),c("8L69c",function(e,t){var r,n,i,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var u=[],c=!1,h=-1;function d(){c&&i&&(c=!1,i.length?u=i.concat(u):h=-1,u.length&&m())}function m(){if(!c){var e=l(d);c=!0;for(var t=u.length;t;){for(i=u,u=[];++h<t;)i&&i[h].run();h=-1,t=u.length}i=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new g(e,t)),1!==u.length||c||l(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),c("ejawP",function(e,t){let r,n,s,a,o,l,c,h,d,m,g,f,p,C,_,y,R;i(e.exports,"checkCellValueType",function(){return j}),i(e.exports,"AddMergeUndoMutationFactory",function(){return B}),i(e.exports,"AddWorksheetMergeMutation",function(){return $}),i(e.exports,"INTERCEPTOR_POINT",function(){return H}),i(e.exports,"InterceptCellContentPriority",function(){return W}),i(e.exports,"BEFORE_CELL_EDIT",function(){return X}),i(e.exports,"AFTER_CELL_EDIT",function(){return q}),i(e.exports,"VALIDATE_CELL",function(){return K}),i(e.exports,"SheetInterceptorService",function(){return Q}),i(e.exports,"RangeThemeStyle",function(){return ee}),i(e.exports,"SheetRangeThemeModel",function(){return el}),i(e.exports,"getSheetCommandTargetWorkbook",function(){return eu}),i(e.exports,"getSheetCommandTarget",function(){return ec}),i(e.exports,"getSheetMutationTarget",function(){return eh}),i(e.exports,"SetWorksheetRangeThemeStyleMutation",function(){return ed}),i(e.exports,"SetWorksheetRangeThemeStyleMutationFactory",function(){return em}),i(e.exports,"DeleteWorksheetRangeThemeStyleMutation",function(){return eg}),i(e.exports,"DeleteWorksheetRangeThemeStyleMutationFactory",function(){return ef}),i(e.exports,"InsertRowMutationUndoFactory",function(){return ep}),i(e.exports,"InsertRowMutation",function(){return eC}),i(e.exports,"InsertColMutationUndoFactory",function(){return e_}),i(e.exports,"InsertColMutation",function(){return ey}),i(e.exports,"MoveRangeMutation",function(){return eR}),i(e.exports,"MoveRowsMutationUndoFactory",function(){return eE}),i(e.exports,"MoveRowsMutation",function(){return eb}),i(e.exports,"MoveColsMutationUndoFactory",function(){return eI}),i(e.exports,"MoveColsMutation",function(){return eN}),i(e.exports,"RemoveRowMutation",function(){return eS}),i(e.exports,"RemoveColMutation",function(){return eA}),i(e.exports,"RemoveMergeUndoMutationFactory",function(){return ev}),i(e.exports,"RemoveWorksheetMergeMutation",function(){return eT}),i(e.exports,"ReorderRangeUndoMutationFactory",function(){return ew}),i(e.exports,"ReorderRangeMutation",function(){return eM}),i(e.exports,"SetColDataMutationFactory",function(){return eO}),i(e.exports,"SetColDataMutation",function(){return ex}),i(e.exports,"SetColHiddenMutation",function(){return eU}),i(e.exports,"SetColVisibleMutation",function(){return eD}),i(e.exports,"SetGridlinesColorMutation",function(){return eV}),i(e.exports,"SetRangeValuesUndoMutationFactory",function(){return ek}),i(e.exports,"SetRangeValuesMutation",function(){return eF}),i(e.exports,"SetRowDataMutationFactory",function(){return eB}),i(e.exports,"SetRowDataMutation",function(){return e$}),i(e.exports,"SetRowVisibleMutation",function(){return eH}),i(e.exports,"SetRowHiddenMutation",function(){return eW}),i(e.exports,"SetWorksheetColWidthMutationFactory",function(){return eG}),i(e.exports,"SetWorksheetColWidthMutation",function(){return eY}),i(e.exports,"SetWorksheetColumnCountUndoMutationFactory",function(){return ez}),i(e.exports,"SetWorksheetColumnCountMutation",function(){return eX}),i(e.exports,"SetWorksheetDefaultStyleMutation",function(){return eq}),i(e.exports,"SetWorksheetDefaultStyleMutationFactory",function(){return eK}),i(e.exports,"SetWorksheetRowCountUndoMutationFactory",function(){return eQ}),i(e.exports,"SetWorksheetRowCountMutation",function(){return eZ}),i(e.exports,"SetWorksheetRowAutoHeightMutationFactory",function(){return e1}),i(e.exports,"SetWorksheetRowHeightMutation",function(){return e2}),i(e.exports,"SetWorksheetRowIsAutoHeightMutation",function(){return e5}),i(e.exports,"SetWorksheetRowAutoHeightMutation",function(){return e3}),i(e.exports,"ToggleGridlinesMutation",function(){return e4}),i(e.exports,"SetWorksheetActiveOperation",function(){return e6}),i(e.exports,"SheetSkeletonChangeType",function(){return e9}),i(e.exports,"SheetValueChangeType",function(){return e8}),i(e.exports,"COMMAND_LISTENER_SKELETON_CHANGE",function(){return e7}),i(e.exports,"COMMAND_LISTENER_VALUE_CHANGE",function(){return te}),i(e.exports,"getValueChangedEffectedRange",function(){return tt}),i(e.exports,"getSkeletonChangedEffectedRange",function(){return tr}),i(e.exports,"expandToContinuousRange",function(){return ts}),i(e.exports,"createTopMatrixFromRanges",function(){return ta}),i(e.exports,"createTopMatrixFromMatrix",function(){return to}),i(e.exports,"findAllRectangle",function(){return tc}),i(e.exports,"rangeMerge",function(){return th}),i(e.exports,"RangeMergeUtil",function(){return td}),i(e.exports,"SELECTION_CONTROL_BORDER_BUFFER_WIDTH",function(){return tm}),i(e.exports,"SELECTION_CONTROL_BORDER_BUFFER_COLOR",function(){return tg}),i(e.exports,"convertSelectionDataToRange",function(){return tf}),i(e.exports,"convertPrimaryWithCoordToPrimary",function(){return tp}),i(e.exports,"SplitDelimiterEnum",function(){return tC}),i(e.exports,"splitRangeText",function(){return ty}),i(e.exports,"findFirstNonEmptyCell",function(){return tR}),i(e.exports,"generateNullCell",function(){return tE}),i(e.exports,"generateNullCellValue",function(){return tb}),i(e.exports,"rangeToDiscreteRange",function(){return tI}),i(e.exports,"getVisibleRanges",function(){return tN}),i(e.exports,"ViewStateEnum",function(){return tS}),i(e.exports,"EditStateEnum",function(){return tA}),i(e.exports,"RangeProtectionRuleModel",function(){return tv}),i(e.exports,"FactoryDeleteRangeProtectionMutation",function(){return tT}),i(e.exports,"AddRangeProtectionMutation",function(){return tO}),i(e.exports,"DeleteRangeProtectionMutation",function(){return tw}),i(e.exports,"FactoryAddRangeProtectionMutation",function(){return tM}),i(e.exports,"AddRangeProtectionCommand",function(){return tx}),i(e.exports,"SelectionMoveType",function(){return tU}),i(e.exports,"WorkbookSelectionModel",function(){return tD}),i(e.exports,"SheetsSelectionsService",function(){return tL}),i(e.exports,"DISABLE_NORMAL_SELECTIONS",function(){return tP}),i(e.exports,"SELECTIONS_ENABLED",function(){return tk}),i(e.exports,"REF_SELECTIONS_ENABLED",function(){return tF}),i(e.exports,"ClearSelectionAllCommand",function(){return tj}),i(e.exports,"ClearSelectionFormatCommand",function(){return tB}),i(e.exports,"alignToMergedCellsBorders",function(){return t$}),i(e.exports,"getCellAtRowCol",function(){return tH}),i(e.exports,"setEndForRange",function(){return tW}),i(e.exports,"getPrimaryForRange",function(){return tG}),i(e.exports,"followSelectionOperation",function(){return tY}),i(e.exports,"SetSelectionsOperation",function(){return t0}),i(e.exports,"isSingleCellSelection",function(){return tz}),i(e.exports,"copyRangeStyles",function(){return tq}),i(e.exports,"IRefSelectionsService",function(){return tQ}),i(e.exports,"RefSelectionsService",function(){return tZ}),i(e.exports,"getSelectionsService",function(){return tJ}),i(e.exports,"SelectRangeCommand",function(){return t1}),i(e.exports,"MoveRangeCommand",function(){return t5}),i(e.exports,"getMoveRangeUndoRedoMutations",function(){return t3}),i(e.exports,"UnitAction",function(){return t6}),i(e.exports,"UnitObject",function(){return t9}),i(e.exports,"RangeProtectionPermissionEditPoint",function(){return t8}),i(e.exports,"RangeProtectionPermissionViewPoint",function(){return t7}),i(e.exports,"WorkbookCommentPermission",function(){return re}),i(e.exports,"WorkbookCopyPermission",function(){return rt}),i(e.exports,"WorkbookCopySheetPermission",function(){return rr}),i(e.exports,"WorkbookCreateProtectPermission",function(){return rn}),i(e.exports,"WorkbookCreateSheetPermission",function(){return ri}),i(e.exports,"WorkbookDeleteColumnPermission",function(){return rs}),i(e.exports,"WorkbookDeleteRowPermission",function(){return ra}),i(e.exports,"WorkbookDeleteSheetPermission",function(){return ro}),i(e.exports,"WorkbookDuplicatePermission",function(){return rl}),i(e.exports,"WorkbookEditablePermission",function(){return ru}),i(e.exports,"WorkbookExportPermission",function(){return rc}),i(e.exports,"WorkbookHideSheetPermission",function(){return rh}),i(e.exports,"WorkbookHistoryPermission",function(){return rd}),i(e.exports,"WorkbookInsertColumnPermission",function(){return rm}),i(e.exports,"WorkbookInsertRowPermission",function(){return rg}),i(e.exports,"WorkbookManageCollaboratorPermission",function(){return rf}),i(e.exports,"WorkbookMoveSheetPermission",function(){return rp}),i(e.exports,"WorkbookPrintPermission",function(){return rC}),i(e.exports,"WorkbookRecoverHistoryPermission",function(){return r_}),i(e.exports,"WorkbookRenameSheetPermission",function(){return ry}),i(e.exports,"WorkbookSharePermission",function(){return rR}),i(e.exports,"WorkbookViewPermission",function(){return rE}),i(e.exports,"WorkbookViewHistoryPermission",function(){return rb}),i(e.exports,"WorksheetCopyPermission",function(){return rI}),i(e.exports,"WorksheetDeleteColumnPermission",function(){return rN}),i(e.exports,"WorksheetDeleteProtectionPermission",function(){return rS}),i(e.exports,"WorksheetDeleteRowPermission",function(){return rA}),i(e.exports,"WorksheetEditPermission",function(){return rv}),i(e.exports,"WorksheetEditExtraObjectPermission",function(){return rT}),i(e.exports,"WorksheetFilterPermission",function(){return rw}),i(e.exports,"WorksheetInsertColumnPermission",function(){return rM}),i(e.exports,"WorksheetInsertHyperlinkPermission",function(){return rO}),i(e.exports,"WorksheetInsertRowPermission",function(){return rx}),i(e.exports,"WorksheetManageCollaboratorPermission",function(){return rU}),i(e.exports,"WorksheetPivotTablePermission",function(){return rD}),i(e.exports,"WorksheetSelectProtectedCellsPermission",function(){return rV}),i(e.exports,"WorksheetSelectUnProtectedCellsPermission",function(){return rL}),i(e.exports,"WorksheetSetCellStylePermission",function(){return rP}),i(e.exports,"WorksheetSetCellValuePermission",function(){return rk}),i(e.exports,"WorksheetSetColumnStylePermission",function(){return rF}),i(e.exports,"WorksheetSetRowStylePermission",function(){return rj}),i(e.exports,"WorksheetSortPermission",function(){return rB}),i(e.exports,"WorksheetViewPermission",function(){return r$}),i(e.exports,"SetRangeValuesCommand",function(){return rH}),i(e.exports,"getInsertRangeMutations",function(){return rW}),i(e.exports,"getRemoveRangeMutations",function(){return rG}),i(e.exports,"handleInsertRangeMutation",function(){return rY}),i(e.exports,"handleDeleteRangeMutation",function(){return rz}),i(e.exports,"DeleteRangeMoveLeftCommand",function(){return rq}),i(e.exports,"DeleteRangeMoveUpCommand",function(){return rQ}),i(e.exports,"InsertRangeMoveDownCommand",function(){return rZ}),i(e.exports,"InsertRangeMoveRightCommand",function(){return r0}),i(e.exports,"InsertRowCommand",function(){return r2}),i(e.exports,"InsertRowByRangeCommand",function(){return r5}),i(e.exports,"InsertRowBeforeCommand",function(){return r3}),i(e.exports,"InsertRowAfterCommand",function(){return r4}),i(e.exports,"InsertMultiRowsAboveCommand",function(){return r6}),i(e.exports,"InsertMultiRowsAfterCommand",function(){return r9}),i(e.exports,"InsertColCommand",function(){return r7}),i(e.exports,"InsertColByRangeCommand",function(){return ne}),i(e.exports,"InsertColBeforeCommand",function(){return nt}),i(e.exports,"InsertColAfterCommand",function(){return nr}),i(e.exports,"InsertMultiColsLeftCommand",function(){return nn}),i(e.exports,"InsertMultiColsRightCommand",function(){return ni}),i(e.exports,"RemoveRowByRangeCommand",function(){return na}),i(e.exports,"RemoveRowCommand",function(){return no}),i(e.exports,"RemoveColByRangeCommand",function(){return nu}),i(e.exports,"RemoveColCommand",function(){return nc}),i(e.exports,"RemoveSheetUndoMutationFactory",function(){return nh}),i(e.exports,"RemoveSheetMutation",function(){return nd}),i(e.exports,"MoveRowsCommand",function(){return ng}),i(e.exports,"MoveColsCommand",function(){return np}),i(e.exports,"SheetSkeletonService",function(){return ny}),i(e.exports,"ReorderRangeCommand",function(){return nI}),i(e.exports,"EffectRefRangId",function(){return nN}),i(e.exports,"OperatorType",function(){return nS}),i(e.exports,"rotateRange",function(){return nT}),i(e.exports,"handleBaseMoveRowsCols",function(){return nw}),i(e.exports,"handleMoveRows",function(){return nM}),i(e.exports,"handleMoveCols",function(){return nO}),i(e.exports,"handleMoveRange",function(){return nx}),i(e.exports,"handleBaseRemoveRange",function(){return nU}),i(e.exports,"handleIRemoveCol",function(){return nD}),i(e.exports,"handleIRemoveRow",function(){return nV}),i(e.exports,"handleBaseInsertRange",function(){return nL}),i(e.exports,"handleInsertRow",function(){return nP}),i(e.exports,"handleInsertCol",function(){return nk}),i(e.exports,"handleInsertRangeMoveDown",function(){return nF}),i(e.exports,"handleInsertRangeMoveRight",function(){return nj}),i(e.exports,"handleDeleteRangeMoveLeft",function(){return nB}),i(e.exports,"handleDeleteRangeMoveUp",function(){return n$}),i(e.exports,"runRefRangeMutations",function(){return nH}),i(e.exports,"handleDefaultRangeChangeWithEffectRefCommands",function(){return nW}),i(e.exports,"handleDefaultRangeChangeWithEffectRefCommandsSkipNoInterests",function(){return nG}),i(e.exports,"handleCommonDefaultRangeChangeWithEffectRefCommands",function(){return nY}),i(e.exports,"handleCommonRangeChangeWithEffectRefCommandsSkipNoInterests",function(){return nz}),i(e.exports,"adjustRangeOnMutation",function(){return nX}),i(e.exports,"getSeparateEffectedRangesOnCommand",function(){return nK}),i(e.exports,"RefRangeService",function(){return n5}),i(e.exports,"getAddMergeMutationRangeByType",function(){return it}),i(e.exports,"MERGE_CELL_INTERCEPTOR_CHECK",function(){return ir}),i(e.exports,"MergeCellController",function(){return ii}),i(e.exports,"AddWorksheetMergeCommand",function(){return io}),i(e.exports,"AddWorksheetMergeAllCommand",function(){return il}),i(e.exports,"AddWorksheetMergeVerticalCommand",function(){return iu}),i(e.exports,"AddWorksheetMergeHorizontalCommand",function(){return ic}),i(e.exports,"addMergeCellsUtil",function(){return ih}),i(e.exports,"WorksheetProtectionRuleModel",function(){return id}),i(e.exports,"AddWorksheetProtectionMutation",function(){return im}),i(e.exports,"DeleteWorksheetProtectionMutation",function(){return ig}),i(e.exports,"AddWorksheetProtectionCommand",function(){return ip}),i(e.exports,"SetWorksheetRangeThemeStyleCommand",function(){return iC}),i(e.exports,"AppendRowCommand",function(){return i_}),i(e.exports,"ClearSelectionContentCommand",function(){return iy}),i(e.exports,"InsertSheetUndoMutationFactory",function(){return iR}),i(e.exports,"InsertSheetMutation",function(){return iE}),i(e.exports,"CopySheetCommand",function(){return ib}),i(e.exports,"DeleteRangeProtectionCommand",function(){return iI}),i(e.exports,"DeleteWorksheetProtectionCommand",function(){return iN}),i(e.exports,"DeleteWorksheetRangeThemeStyleCommand",function(){return iS}),i(e.exports,"InsertDefinedNameCommand",function(){return iA}),i(e.exports,"InsertSheetCommand",function(){return iv}),i(e.exports,"RegisterWorksheetRangeThemeStyleMutation",function(){return iT}),i(e.exports,"UnregisterWorksheetRangeThemeStyleMutation",function(){return iw}),i(e.exports,"RegisterWorksheetRangeThemeStyleCommand",function(){return iM}),i(e.exports,"RemoveDefinedNameCommand",function(){return iO}),i(e.exports,"RemoveSheetCommand",function(){return ix}),i(e.exports,"RemoveWorksheetMergeCommand",function(){return iU}),i(e.exports,"BorderStyleManagerService",function(){return iD}),i(e.exports,"SetBorderCommand",function(){return iP}),i(e.exports,"SetBorderPositionCommand",function(){return ik}),i(e.exports,"SetBorderStyleCommand",function(){return iF}),i(e.exports,"SetBorderColorCommand",function(){return ij}),i(e.exports,"SetBorderBasicCommand",function(){return iB}),i(e.exports,"SetColDataCommand",function(){return i$}),i(e.exports,"SetSpecificColsVisibleCommand",function(){return iH}),i(e.exports,"SetSelectedColsVisibleCommand",function(){return iW}),i(e.exports,"SetColHiddenCommand",function(){return iG}),i(e.exports,"SetDefinedNameCommand",function(){return iz}),i(e.exports,"SetFrozenMutationFactory",function(){return iX}),i(e.exports,"SetFrozenMutation",function(){return iq}),i(e.exports,"SetFrozenCommand",function(){return iK}),i(e.exports,"CancelFrozenCommand",function(){return iQ}),i(e.exports,"SetGridlinesColorCommand",function(){return iZ}),i(e.exports,"SetRangeProtectionMutation",function(){return iJ}),i(e.exports,"FactorySetRangeProtectionMutation",function(){return i0}),i(e.exports,"SetWorksheetProtectionMutation",function(){return i1}),i(e.exports,"SetProtectionCommand",function(){return i2}),i(e.exports,"SetRowDataCommand",function(){return i5}),i(e.exports,"SetSpecificRowsVisibleCommand",function(){return i3}),i(e.exports,"SetSelectedRowsVisibleCommand",function(){return i4}),i(e.exports,"SetRowHiddenCommand",function(){return i6}),i(e.exports,"SetStyleCommand",function(){return i7}),i(e.exports,"SetBoldCommand",function(){return se}),i(e.exports,"SetItalicCommand",function(){return st}),i(e.exports,"SetUnderlineCommand",function(){return sr}),i(e.exports,"SetStrikeThroughCommand",function(){return sn}),i(e.exports,"SetOverlineCommand",function(){return si}),i(e.exports,"SetFontFamilyCommand",function(){return ss}),i(e.exports,"SetFontSizeCommand",function(){return sa}),i(e.exports,"SetTextColorCommand",function(){return so}),i(e.exports,"ResetTextColorCommand",function(){return sl}),i(e.exports,"SetBackgroundColorCommand",function(){return su}),i(e.exports,"ResetBackgroundColorCommand",function(){return sc}),i(e.exports,"SetVerticalTextAlignCommand",function(){return sh}),i(e.exports,"SetHorizontalTextAlignCommand",function(){return sd}),i(e.exports,"SetTextWrapCommand",function(){return sm}),i(e.exports,"SetTextRotationCommand",function(){return sg}),i(e.exports,"SetTabColorMutation",function(){return sf}),i(e.exports,"SetTabColorCommand",function(){return sp}),i(e.exports,"SetWorkbookNameMutation",function(){return sC}),i(e.exports,"SetWorkbookNameCommand",function(){return s_}),i(e.exports,"SetWorksheetActivateCommand",function(){return sy}),i(e.exports,"DeltaColumnWidthCommand",function(){return sR}),i(e.exports,"SetColWidthCommand",function(){return sE}),i(e.exports,"SetWorksheetColumnCountCommand",function(){return sb}),i(e.exports,"SetWorksheetDefaultStyleCommand",function(){return sI}),i(e.exports,"SetWorksheetHideMutation",function(){return sS}),i(e.exports,"SetWorksheetHideCommand",function(){return sA}),i(e.exports,"SetWorksheetNameMutation",function(){return sv}),i(e.exports,"SetWorksheetNameCommand",function(){return sT}),i(e.exports,"SetWorksheetOrderMutation",function(){return sw}),i(e.exports,"SetWorksheetOrderCommand",function(){return sM}),i(e.exports,"WorksheetProtectionPointModel",function(){return sO}),i(e.exports,"RangeProtectionPermissionDeleteProtectionPoint",function(){return sx}),i(e.exports,"RangeProtectionPermissionManageCollaPoint",function(){return sU}),i(e.exports,"getAllRangePermissionPoint",function(){return sD}),i(e.exports,"baseProtectionActions",function(){return sV}),i(e.exports,"getDefaultRangePermission",function(){return sL}),i(e.exports,"getAllWorkbookPermissionPoint",function(){return sP}),i(e.exports,"defaultWorkbookPermissionPoints",function(){return sk}),i(e.exports,"getAllWorksheetPermissionPoint",function(){return sF}),i(e.exports,"getAllWorksheetPermissionPointByPointPanel",function(){return sj}),i(e.exports,"defaultWorksheetPermissionPoint",function(){return sB}),i(e.exports,"WorksheetPermissionService",function(){return sW}),i(e.exports,"SetWorksheetPermissionPointsMutation",function(){return sG}),i(e.exports,"SetWorksheetPermissionPointsCommand",function(){return sY}),i(e.exports,"SetWorksheetProtectionCommand",function(){return sz}),i(e.exports,"SetWorksheetRightToLeftMutation",function(){return sX}),i(e.exports,"SetWorksheetRightToLeftCommand",function(){return sq}),i(e.exports,"SetWorksheetRowCountCommand",function(){return sK}),i(e.exports,"DeltaRowHeightCommand",function(){return sQ}),i(e.exports,"SetRowHeightCommand",function(){return sZ}),i(e.exports,"SetWorksheetRowIsAutoHeightCommand",function(){return sJ}),i(e.exports,"SetWorksheetShowCommand",function(){return s0}),i(e.exports,"SplitTextToColumnsCommand",function(){return s1}),i(e.exports,"ToggleCellCheckboxCommand",function(){return s2}),i(e.exports,"ToggleGridlinesCommand",function(){return s5}),i(e.exports,"UnregisterWorksheetRangeThemeStyleCommand",function(){return s3}),i(e.exports,"AddRangeThemeMutation",function(){return s4}),i(e.exports,"EmptyMutation",function(){return s6}),i(e.exports,"MarkDirtyRowAutoHeightMutation",function(){return s9}),i(e.exports,"CancelMarkDirtyRowAutoHeightMutation",function(){return s8}),i(e.exports,"INumfmtService",function(){return s7}),i(e.exports,"factorySetNumfmtUndoMutation",function(){return ae}),i(e.exports,"transformCellsToRange",function(){return ai}),i(e.exports,"SetNumfmtMutation",function(){return at}),i(e.exports,"RemoveNumfmtMutation",function(){return ar}),i(e.exports,"factoryRemoveNumfmtUndoMutation",function(){return an}),i(e.exports,"RemoveRangeThemeMutation",function(){return as}),i(e.exports,"SetRangeThemeMutation",function(){return aa}),i(e.exports,"ScrollToCellOperation",function(){return ao}),i(e.exports,"AddMergeRedoSelectionsOperationFactory",function(){return al}),i(e.exports,"AddMergeUndoSelectionsOperationFactory",function(){return au}),i(e.exports,"MAX_CELL_PER_SHEET_KEY",function(){return ac}),i(e.exports,"SCOPE_WORKBOOK_VALUE_DEFINED_NAME",function(){return am}),i(e.exports,"DefinedNameDataController",function(){return ag}),i(e.exports,"SheetPermissionCheckController",function(){return aC}),i(e.exports,"WorkbookPermissionService",function(){return aR}),i(e.exports,"SheetPermissionInitController",function(){return aI}),i(e.exports,"RangeProtectionRenderModel",function(){return aA}),i(e.exports,"RangeProtectionCache",function(){return aw}),i(e.exports,"IExclusiveRangeService",function(){return aH}),i(e.exports,"ExclusiveRangeService",function(){return aW}),i(e.exports,"NumfmtService",function(){return az}),i(e.exports,"RangeProtectionRefRangeService",function(){return aZ}),i(e.exports,"RangeProtectionService",function(){return a1}),i(e.exports,"SheetRangeThemeService",function(){return a5}),i(e.exports,"UniverSheetsPlugin",function(){return a8}),i(e.exports,"PermissionPointsDefinitions",function(){return a7}),i(e.exports,"checkRangesEditablePermission",function(){return oe}),i(e.exports,"getNextPrimaryCell",function(){return oa});var E=u("7yNYd"),b=u("dqRu2"),I=u("5LPkb"),N=u("arCqp"),S=u("lMvMU"),A=u("bDEN0"),v=u("hciHF"),T=u("i54iF"),w=u("3yupB"),M=u("c3hg1"),O=u("9GqS8"),x=u("1mjSk"),U=u("23cfA"),D=u("2jrJe"),V=u("86b1c"),S=u("lMvMU"),v=u("hciHF"),D=u("2jrJe"),L=u("k2g5B"),P=Object.defineProperty,k=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?P(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r};function F(e,t){return void 0!==e.v?j(e.v,e.t):j(t.v,t.t)}function j(e,t){return null===e?null:"string"==typeof e?(0,E.isRealNum)(e)?(0==+e||1==+e)&&t===E.CellValueType.BOOLEAN?E.CellValueType.BOOLEAN:(0,E.willLoseNumericPrecision)(e)?E.CellValueType.FORCE_STRING:E.CellValueType.NUMBER:(0,E.isBooleanString)(e)?E.CellValueType.BOOLEAN:E.CellValueType.STRING:"number"==typeof e?(0===e||1===e)&&t===E.CellValueType.BOOLEAN?E.CellValueType.BOOLEAN:E.CellValueType.NUMBER:"boolean"==typeof e?E.CellValueType.BOOLEAN:E.CellValueType.FORCE_STRING}let B=(e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:E.Tools.deepClone(t.ranges)}},$={id:"sheet.mutation.add-worksheet-merge",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)i.push(s[e]);return n.getSpanModel().rebuild(i),!0}},H={CELL_CONTENT:(0,E.createInterceptorKey)("CELL_CONTENT"),ROW_FILTERED:(0,E.createInterceptorKey)("ROW_FILTERED")};var W=((r=W||{})[r.DATA_VALIDATION=9]="DATA_VALIDATION",r[r.NUMFMT=10]="NUMFMT",r[r.CELL_IMAGE=11]="CELL_IMAGE",r);let G="sheet.interceptor.range-theme-id",Y="sheet.interceptor.ignore-range-theme";var z=Object.getOwnPropertyDescriptor;let X=(0,E.createInterceptorKey)("BEFORE_CELL_EDIT"),q=(0,E.createInterceptorKey)("AFTER_CELL_EDIT"),K=(0,E.createInterceptorKey)("VALIDATE_CELL"),Q=class extends E.Disposable{constructor(e){super(),k(this,"_interceptorsByName",new Map),k(this,"_commandInterceptors",[]),k(this,"_rangeInterceptors",[]),k(this,"_autoHeightInterceptors",[]),k(this,"_beforeCommandInterceptor",[]),k(this,"_afterCommandInterceptors",[]),k(this,"_workbookDisposables",new Map),k(this,"_worksheetDisposables",new Map),k(this,"_interceptorsDirty",!1),k(this,"_composedInterceptorByKey",new Map),k(this,"writeCellInterceptor",new(0,E.InterceptorManager)({BEFORE_CELL_EDIT:X,AFTER_CELL_EDIT:q,VALIDATE_CELL:K})),this._univerInstanceService=e,this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(E.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._interceptWorkbook(e)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(E.UniverInstanceType.UNIVER_SHEET).subscribe(e=>this._disposeWorkbookInterceptor(e))),this.intercept(H.CELL_CONTENT,{priority:-1,effect:E.InterceptorEffectEnum.Style|E.InterceptorEffectEnum.Value,handler:e=>e}),this.disposeWithMe(this.writeCellInterceptor.intercept(q,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(X,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(K,{priority:-1,handler:e=>e}))}dispose(){super.dispose(),this._workbookDisposables.forEach(e=>e.dispose()),this._workbookDisposables.clear(),this._worksheetDisposables.clear(),this._interceptorsByName.clear()}interceptCommand(e){if(this._commandInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._commandInterceptors.push(e),this._commandInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._commandInterceptors,e)))}onCommandExecute(e){let t=this._commandInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}interceptAfterCommand(e){if(this._afterCommandInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._afterCommandInterceptors.push(e),this._afterCommandInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._afterCommandInterceptors,e)))}afterCommandExecute(e){let t=this._afterCommandInterceptors.map(t=>t.getMutations(e));return{undos:t.map(e=>e.undos).flat(),redos:t.map(e=>e.redos).flat()}}interceptAutoHeight(e){if(this._autoHeightInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._autoHeightInterceptors.push(e),this._autoHeightInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._autoHeightInterceptors,e)))}generateMutationsOfAutoHeight(e){let t=this._autoHeightInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}interceptBeforeCommand(e){if(this._beforeCommandInterceptor.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._beforeCommandInterceptor.push(e),this._beforeCommandInterceptor.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._beforeCommandInterceptor,e)))}async beforeCommandExecute(e){return(await Promise.all(this._beforeCommandInterceptor.map(t=>t.performCheck(e)))).every(e=>e)}interceptRanges(e){if(this._rangeInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._rangeInterceptors.push(e),this._rangeInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._rangeInterceptors,e)))}generateMutationsByRanges(e){let t=this._rangeInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}onWriteCell(e,t,r,n,i){let s={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:r,col:n,origin:E.Tools.deepClone(i)};return this.writeCellInterceptor.fetchThroughInterceptors(q)(i,s)}onValidateCell(e,t,r,n){let i={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:r,col:n};return this.writeCellInterceptor.fetchThroughInterceptors(K)(Promise.resolve(!0),i)}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);r.push(t);let n=r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)});if(this._interceptorsDirty=!0,e!==H.CELL_CONTENT)return this._interceptorsByName.set(e,n),this.disposeWithMe((0,E.toDisposable)(()=>(0,E.remove)(this._interceptorsByName.get(e),t)));{let r=E.InterceptorEffectEnum.Style|E.InterceptorEffectEnum.Value;this._interceptorsByName.set(`${e}-${r}`,n);let i=E.InterceptorEffectEnum.Style|E.InterceptorEffectEnum.Value;return this._interceptorsByName.set(`${e}-${E.InterceptorEffectEnum.Style}`,n.filter(e=>((e.effect||i)&E.InterceptorEffectEnum.Style)>0)),this._interceptorsByName.set(`${e}-${E.InterceptorEffectEnum.Value}`,n.filter(e=>((e.effect||i)&E.InterceptorEffectEnum.Value)>0)),this.disposeWithMe((0,E.toDisposable)(()=>{(0,E.remove)(this._interceptorsByName.get(e),t),(0,E.remove)(this._interceptorsByName.get(`${e}-${r}`),t),(0,E.remove)(this._interceptorsByName.get(`${e}-${E.InterceptorEffectEnum.Style}`),t),(0,E.remove)(this._interceptorsByName.get(`${e}-${E.InterceptorEffectEnum.Value}`),t)}))}}fetchThroughInterceptors(e,t,r,n){let i=void 0===t?e:`${e}-${t}`,s=null!=r?r:i,a=this._composedInterceptorByKey.get(s);if(!a||this._interceptorsDirty){let e=this._interceptorsByName.get(i);e&&n&&(e=e.filter(n)),a=(0,E.composeInterceptors)(e||[]),this._composedInterceptorByKey.set(s,a)}return a}_interceptWorkbook(e){let t=new(0,E.DisposableCollection),r=e.getUnitId(),n=this,i=t=>{let i=t.getSheetId();t.__interceptViewModel(s=>{let a=new(0,E.DisposableCollection);n._worksheetDisposables.set(Z(r,t),a),a.add(s.registerCellContentInterceptor({getCell(s,a,o,l,u){let c=t.getCellRaw(s,a);return n.fetchThroughInterceptors(H.CELL_CONTENT,o,l,u)(c,{unitId:r,subUnitId:i,row:s,col:a,worksheet:t,workbook:e,rawData:c})}})),a.add(s.registerRowFilteredInterceptor({getRowFiltered:s=>!!n.fetchThroughInterceptors(H.ROW_FILTERED)(!1,{unitId:r,subUnitId:i,row:s,workbook:e,worksheet:t})}))})};e.getSheets().forEach(e=>i(e)),t.add(e.sheetCreated$.subscribe(e=>i(e))),t.add((0,E.toDisposable)(()=>e.getSheets().forEach(e=>this._disposeSheetInterceptor(r,e)))),t.add(e.sheetDisposed$.subscribe(e=>this._disposeSheetInterceptor(r,e))),this._workbookDisposables.set(r,t)}_disposeWorkbookInterceptor(e){let t=e.getUnitId(),r=this._workbookDisposables.get(t);r&&(r.dispose(),this._workbookDisposables.delete(t))}_disposeSheetInterceptor(e,t){let r=Z(e,t),n=this._worksheetDisposables.get(r);n&&(n.dispose(),this._worksheetDisposables.delete(r))}};function Z(e,t){return`${e}|${t.getSheetId()}`}Q=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?z(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(n=E.IUniverInstanceService,(e,t)=>n(e,t,0))],Q);let J=e=>{let t={};return e.bg&&(t.bg={...e.bg}),e.ol&&(t.ol={...e.ol}),e.bd&&(t.bd={...e.bd}),e.cl&&(t.cl={...e.cl}),e.ht&&(t.ht=e.ht),e.vt&&(t.vt=e.vt),void 0!==e.bl&&(t.bl=e.bl),t};class ee{constructor(e,t){k(this,"_name"),k(this,"wholeStyle",null),k(this,"headerRowStyle",null),k(this,"headerColumnStyle",null),k(this,"firstRowStyle",null),k(this,"secondRowStyle",null),k(this,"lastRowStyle",null),k(this,"firstColumnStyle",null),k(this,"secondColumnStyle",null),k(this,"lastColumnStyle",null),k(this,"_mergeCacheMap",new Map),t&&this.fromJson({...t,name:e}),this._name=e}getName(){return this._name}getWholeStyle(){return this.wholeStyle}setWholeStyle(e){this.wholeStyle=e,this._resetStyleCache()}getFirstRowStyle(){return this.firstRowStyle}setFirstRowStyle(e){this.firstRowStyle=e,this._resetStyleCache()}getSecondRowStyle(){return this.secondRowStyle}setSecondRowStyle(e){this.secondRowStyle=e,this._resetStyleCache()}getLastRowStyle(){return this.lastRowStyle}setLastRowStyle(e){this.lastRowStyle=e,this._resetStyleCache()}getFirstColumnStyle(){return this.firstColumnStyle}setFirstColumnStyle(e){this.firstColumnStyle=e,this._resetStyleCache()}getSecondColumnStyle(){return this.secondColumnStyle}setSecondColumnStyle(e){this.secondColumnStyle=e,this._resetStyleCache()}getLastColumnStyle(){return this.lastColumnStyle}setLastColumnStyle(e){this.lastColumnStyle=e,this._resetStyleCache()}getHeaderRowStyle(){return this.headerRowStyle}setHeaderRowStyle(e){this.headerRowStyle=e,this._resetStyleCache()}getHeaderColumnStyle(){return this.headerColumnStyle}setHeaderColumnStyle(e){this.headerColumnStyle=e,this._resetStyleCache()}getStyle(e,t,r,n){let i=0;return r&&(i|=32),n&&(i|=512),e>=0&&t>=0&&(i|=1),e%2==1&&(i|=8),e%2==0&&(i|=16),0===e&&(i|=2),0===t&&(i|=4),t%2==1&&(i|=128),t%2==0&&(i|=256),0===i?null:this._getMergeStyle(i)}_getMergeStyle(e){let t=this._mergeCacheMap.get(e);return t||(t=this._mergeStyle(e),this._mergeCacheMap.set(e,t)),t}_mergeStyle(e){let t=[];return this.wholeStyle&&1&e&&t.push(this.wholeStyle),this.firstColumnStyle&&128&e&&t.push(this.firstColumnStyle),this.secondColumnStyle&&256&e&&t.push(this.secondColumnStyle),this.firstRowStyle&&8&e&&t.push(this.firstRowStyle),this.secondRowStyle&&16&e&&t.push(this.secondRowStyle),this.headerColumnStyle&&4&e&&t.push(this.headerColumnStyle),this.lastColumnStyle&&512&e&&t.push(this.lastColumnStyle),this.headerRowStyle&&2&e&&t.push(this.headerRowStyle),this.lastRowStyle&&32&e&&t.push(this.lastRowStyle),function(e){let t={};if(1===e.length)return e[0];for(let r of e)r.bg&&(t.bg=r.bg),r.ol&&(t.ol=r.ol),r.bd&&(t.bd={...t.bd,...r.bd}),r.cl&&(t.cl=r.cl),r.ht&&(t.ht=r.ht),r.vt&&(t.vt=r.vt),void 0!==r.bl&&(t.bl=r.bl);return t}(t)}_resetStyleCache(){this._mergeCacheMap.clear()}toJson(){let e={name:this._name};return this.wholeStyle&&(e.wholeStyle=J(this.wholeStyle)),this.headerRowStyle&&(e.headerRowStyle=J(this.headerRowStyle)),this.headerColumnStyle&&(e.headerColumnStyle=J(this.headerColumnStyle)),this.firstRowStyle&&(e.firstRowStyle=J(this.firstRowStyle)),this.secondRowStyle&&(e.secondRowStyle=J(this.secondRowStyle)),this.lastRowStyle&&(e.lastRowStyle=J(this.lastRowStyle)),this.firstColumnStyle&&(e.firstColumnStyle=J(this.firstColumnStyle)),this.secondColumnStyle&&(e.secondColumnStyle=J(this.secondColumnStyle)),this.lastColumnStyle&&(e.lastColumnStyle=J(this.lastColumnStyle)),e}fromJson(e){this._name=e.name,e.wholeStyle&&(this.wholeStyle=J(e.wholeStyle)),e.headerRowStyle&&(this.headerRowStyle=J(e.headerRowStyle)),e.headerColumnStyle&&(this.headerColumnStyle=J(e.headerColumnStyle)),e.firstRowStyle&&(this.firstRowStyle=J(e.firstRowStyle)),e.secondRowStyle&&(this.secondRowStyle=J(e.secondRowStyle)),e.lastRowStyle&&(this.lastRowStyle=J(e.lastRowStyle)),e.firstColumnStyle&&(this.firstColumnStyle=J(e.firstColumnStyle)),e.secondColumnStyle&&(this.secondColumnStyle=J(e.secondColumnStyle)),e.lastColumnStyle&&(this.lastColumnStyle=J(e.lastColumnStyle))}dispose(){this._mergeCacheMap.clear()}}let et=[{baseName:"blue",header:"rgb(164, 202, 254)",color:"rgb(225, 239, 254)"},{baseName:"grey",header:"rgb(205, 208, 216)",color:"rgb(238, 239, 241)"},{baseName:"red",header:"rgb(248, 180, 180)",color:"rgb(253, 232, 232)"},{baseName:"orange",header:"rgb(253, 186, 140)",color:"rgb(254, 236, 220)"},{baseName:"yellow",header:"rgb(250, 200, 21)",color:"rgb(255, 244, 185)"},{baseName:"green",header:"rgb(132, 225, 188)",color:"rgb(222, 247, 236)"},{baseName:"azure",header:"rgb(126, 220, 226)",color:"rgb(213, 245, 246)"},{baseName:"indigo",header:"rgb(186, 198, 248)",color:"rgb(233, 237, 255)"},{baseName:"purple",header:"rgb(202, 191, 253)",color:"rgb(237, 235, 254)"},{baseName:"magenta",header:"rgb(248, 180, 217)",color:"rgb(252, 232, 243)"}].map(({baseName:e,header:t,color:r})=>new ee(`light-${e}`,{headerRowStyle:{bg:{rgb:t}},firstColumnStyle:{bg:{rgb:"rgb(255, 255, 255)"}},secondColumnStyle:{bg:{rgb:r}},lastRowStyle:{bg:{rgb:t}}})),er=[...et,...[{baseName:"blue",rowHeader:"rgb(63, 131, 248)",colHeader:"rgb(195, 221, 253)"},{baseName:"grey",rowHeader:"rgb(95, 101, 116)",colHeader:"rgb(227, 229, 234)"},{baseName:"red",rowHeader:"rgb(240, 82, 82)",colHeader:"rgb(251, 213, 213)"},{baseName:"orange",rowHeader:"rgb(255, 90, 31)",colHeader:"rgb(252, 217, 189)"},{baseName:"yellow",rowHeader:"rgb(212, 157, 15)",colHeader:"rgb(252, 220, 106)"},{baseName:"green",rowHeader:"rgb(13, 164, 113)",colHeader:"rgb(188, 240, 218)"},{baseName:"azure",rowHeader:"rgb(6, 148, 162)",colHeader:"rgb(175, 236, 239)"},{baseName:"indigo",rowHeader:"rgb(70, 106, 247)",colHeader:"rgb(210, 218, 250)"},{baseName:"purple",rowHeader:"rgb(144, 97, 249)",colHeader:"rgb(220, 215, 254)"},{baseName:"magenta",rowHeader:"rgb(231, 70, 148)",colHeader:"rgb(250, 209, 232)"}].map(({baseName:e,rowHeader:t,colHeader:r})=>new ee(`middle-${e}`,{headerRowStyle:{bg:{rgb:t}},headerColumnStyle:{bg:{rgb:r}},secondRowStyle:{bg:{rgb:r}},lastRowStyle:{bg:{rgb:t}},lastColumnStyle:{bg:{rgb:r}}})),...[{baseName:"blue",rowHeader:"rgb(30, 66, 159)",firstRow:"rgb(195, 221, 253)",secondRow:"rgb(118, 169, 250)"},{baseName:"grey",rowHeader:"rgb(44, 48, 64)",firstRow:"rgb(227, 229, 234)",secondRow:"rgb(151, 157, 172)"},{baseName:"red",rowHeader:"rgb(155, 28, 28)",firstRow:"rgb(251, 213, 213)",secondRow:"rgb(249, 128, 128)"},{baseName:"orange",rowHeader:"rgb(180, 52, 3)",firstRow:"rgb(252, 217, 189)",secondRow:"rgb(255, 138, 76)"},{baseName:"yellow",rowHeader:"rgb(154, 109, 21)",firstRow:"rgb(252, 220, 106)",secondRow:"rgb(212, 157, 15)"},{baseName:"green",rowHeader:"rgb(4, 108, 78)",firstRow:"rgb(188, 240, 218)",secondRow:"rgb(49, 196, 141)"},{baseName:"azure",rowHeader:"rgb(3, 102, 114)",firstRow:"rgb(175, 236, 239)",secondRow:"rgb(22, 189, 202)"},{baseName:"indigo",rowHeader:"rgb(16, 51, 191)",firstRow:"rgb(210, 218, 250)",secondRow:"rgb(98, 128, 249)"},{baseName:"purple",rowHeader:"rgb(74, 29, 150)",firstRow:"rgb(220, 215, 254)",secondRow:"rgb(172, 148, 250)"},{baseName:"magenta",rowHeader:"rgb(153, 21, 75)",firstRow:"rgb(250, 209, 232)",secondRow:"rgb(241, 126, 184)"}].map(({baseName:e,rowHeader:t,firstRow:r,secondRow:n})=>new ee(`dark-${e}`,{headerRowStyle:{bg:{rgb:t},cl:{rgb:"rgb(255, 255, 255)"},ht:E.HorizontalAlign.CENTER,bl:E.BooleanNumber.TRUE},firstRowStyle:{bg:{rgb:r}},secondRowStyle:{bg:{rgb:n}},lastRowStyle:{bg:{rgb:t}}}))],en={headerRowStyle:{bg:{rgb:"rgb(68,114,196)"},cl:{rgb:"rgb(255,255,255)"},ht:E.HorizontalAlign.CENTER,bl:E.BooleanNumber.TRUE},firstRowStyle:{bg:{rgb:"rgb(217,225,242)"}}},ei=new ee("default",en),es=new ee("default-last-row",{...en,lastRowStyle:{bd:{t:{s:E.BorderStyleTypes.THIN,cl:{rgb:"rgb(68,114,196)"}}},ht:E.HorizontalAlign.CENTER,bl:E.BooleanNumber.TRUE}});var ea=Object.getOwnPropertyDescriptor,eo=(e,t)=>(r,n)=>t(r,n,e);let el=class extends E.Disposable{constructor(e,t){super(),k(this,"_rangeThemeStyleMap",new Map),k(this,"_rangeThemeStyleRuleMap",new Map),k(this,"_rTreeCollection",new Map),k(this,"_defaultRangeThemeMap",new Map),k(this,"_rangeThemeMapChanged$",new(0,x.Subject)),k(this,"rangeThemeMapChange$",this._rangeThemeMapChanged$.asObservable()),this._sheetInterceptorService=e,this._resourceManagerService=t,this._registerIntercept(),this._initSnapshot(),this._initDefaultTheme()}_initDefaultTheme(){for(let e of(this.registerDefaultRangeTheme(ei),this.registerDefaultRangeTheme(es),er))this.registerDefaultRangeTheme(e)}_ensureRangeThemeStyleMap(e){return this._rangeThemeStyleMap.has(e)||this._rangeThemeStyleMap.set(e,new Map),this._rangeThemeStyleMap.get(e)}_ensureRangeThemeStyleRuleMap(e){return this._rangeThemeStyleRuleMap.has(e)||this._rangeThemeStyleRuleMap.set(e,new Map),this._rangeThemeStyleRuleMap.get(e)}_ensureRTreeCollection(e){return this._rTreeCollection.has(e)||this._rTreeCollection.set(e,new(0,E.RTree)),this._rTreeCollection.get(e)}getDefaultRangeThemeStyle(e){return this._defaultRangeThemeMap.get(e)}getCustomRangeThemeStyle(e,t){return this._ensureRangeThemeStyleMap(e).get(t)}registerRangeThemeRule(e,t){let{unitId:r,subUnitId:n,range:i}=t,s=(0,E.generateRandomId)(),a=this._ensureRangeThemeStyleRuleMap(r),o=this._ensureRTreeCollection(r);a.set(s,{rangeInfo:t,themeName:e}),o.insert({unitId:r,sheetId:n,range:i,id:s})}getRegisteredRangeThemeStyle(e){let{unitId:t,subUnitId:r,range:n}=e,i=Array.from(this._ensureRTreeCollection(t).bulkSearch([{unitId:t,sheetId:r,range:n}]));if(i[0]){let e=this._ensureRangeThemeStyleRuleMap(t).get(i[0]);if(e)return e.themeName}}removeRangeThemeRule(e,t){let{unitId:r,subUnitId:n,range:i}=t,s=this._ensureRTreeCollection(r),a=Array.from(s.bulkSearch([{unitId:r,sheetId:n,range:i}])),o=this._ensureRangeThemeStyleRuleMap(r);for(let t=0;t<a.length;t++){let l=o.get(a[t]);if(l&&l.themeName===e){o.delete(a[t]),s.remove({unitId:r,sheetId:n,range:i,id:a[t]});break}}}registerDefaultRangeTheme(e){this._defaultRangeThemeMap.set(e.getName(),e),this._rangeThemeMapChanged$.next({type:"add",styleName:e.getName()})}unRegisterDefaultRangeTheme(e){this._defaultRangeThemeMap.delete(e),this._rangeThemeMapChanged$.next({type:"remove",styleName:e})}getRegisteredRangeThemes(){return Array.from(this._defaultRangeThemeMap.keys())}registerRangeThemeStyle(e,t){this._ensureRangeThemeStyleMap(e).set(t.getName(),t),this._rangeThemeMapChanged$.next({type:"add",styleName:t.getName()})}unregisterRangeThemeStyle(e,t){this._ensureRangeThemeStyleMap(e).delete(t),this._rangeThemeMapChanged$.next({type:"remove",styleName:t})}getALLRegisteredTheme(e){return Array.from(this._ensureRangeThemeStyleMap(e).keys())}getRangeThemeStyle(e,t){return this._defaultRangeThemeMap.has(t)?this._defaultRangeThemeMap.get(t):this._ensureRangeThemeStyleMap(e).get(t)}getCellStyle(e,t,r,n){let i=Array.from(this._ensureRTreeCollection(e).bulkSearch([{unitId:e,sheetId:t,range:{startRow:r,startColumn:n,endRow:r,endColumn:n}}]));if(i[0]){let t=this._ensureRangeThemeStyleRuleMap(e).get(i[0]);if(t){let{rangeInfo:i,themeName:s}=t,a=r-i.range.startRow,o=n-i.range.startColumn,l=this.getRangeThemeStyle(e,s);if(l)return l.getStyle(a,o,r===i.range.endRow,n===i.range.endColumn)}}}_registerIntercept(){this.disposeWithMe(this._sheetInterceptorService.intercept(H.CELL_CONTENT,{id:G,effect:E.InterceptorEffectEnum.Style,handler:(e,t,r)=>{let{row:n,col:i,unitId:s,subUnitId:a}=t,o=this.getCellStyle(s,a,n,i);if(o){let n=e&&e!==t.rawData?e:{...t.rawData};return n.themeStyle=o,r(n)}return r(e)}}))}toJson(e){let t=this._ensureRangeThemeStyleRuleMap(e),r=this._ensureRangeThemeStyleMap(e);if(0===r.size&&0===t.size)return"{}";let n={};t.forEach((e,t)=>{n[t]=e});let i={};return r.forEach((e,t)=>{i[t]=e.toJson()}),JSON.stringify({rangeThemeStyleRuleMap:n,rangeThemeStyleMapJson:i})}fromJSON(e,t){let{rangeThemeStyleRuleMap:r,rangeThemeStyleMapJson:n}=t;r&&Object.keys(r).forEach(e=>{let{themeName:t,rangeInfo:n}=r[e];t.startsWith("table")||(this.registerRangeThemeRule(t,n),this._ensureRTreeCollection(n.unitId).insert({unitId:e,sheetId:n.subUnitId,range:n.range,id:e}))}),n&&Object.keys(n).forEach(t=>{let r=n[t],i=new ee(r.name);i.fromJson(r),this._ensureRangeThemeStyleMap(e).set(i.getName(),i)})}deleteUnitId(e){this._rangeThemeStyleMap.delete(e),this._rangeThemeStyleRuleMap.delete(e),this._rTreeCollection.delete(e)}_initSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e=>this.toJson(e),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},businesses:[E.UniverInstanceType.UNIVER_SHEET],pluginName:"SHEET_RANGE_THEME_MODEL_PLUGIN",onLoad:(e,t)=>{this.fromJSON(e,t)},onUnLoad:e=>{this.deleteUnitId(e)}}))}dispose(){super.dispose(),this._rangeThemeStyleMap.clear(),this._rangeThemeStyleRuleMap.clear(),this._defaultRangeThemeMap.clear(),this._rTreeCollection.clear()}};function eu(e,t){let{unitId:r}=t,n=r?e.getUnit(r,E.UniverInstanceType.UNIVER_SHEET):e.getCurrentUnitOfType(E.UniverInstanceType.UNIVER_SHEET);return n?{workbook:n,unitId:n.getUnitId()}:null}function ec(e,t={}){let{unitId:r,subUnitId:n}=t,i=r?e.getUnit(r,E.UniverInstanceType.UNIVER_SHEET):e.getCurrentUnitOfType(E.UniverInstanceType.UNIVER_SHEET);if(!i)return null;let s=n?i.getSheetBySheetId(n):i.getActiveSheet(!0);return s?{worksheet:s,workbook:i,unitId:i.getUnitId(),subUnitId:s.getSheetId()}:null}function eh(e,t){let{unitId:r,subUnitId:n}=t,i=e.getUnit(r,E.UniverInstanceType.UNIVER_SHEET);if(!i)return null;let s=i.getSheetBySheetId(n);return s?{worksheet:s,workbook:i}:null}el=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ea(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([eo(0,(0,b.Inject)(Q)),eo(1,(0,b.Inject)(E.IResourceManagerService))],el);let ed={id:"sheet.mutation.set-worksheet-range-theme-style",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,themeName:s}=t,a=ec(e.get(E.IUniverInstanceService)),o=e.get(el);return!!a&&(o.registerRangeThemeRule(s,{range:i,unitId:r,subUnitId:n}),!0)}},em=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetRangeThemeStyleMutation]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),range:t.range,themeName:t.themeName}},eg={id:"sheet.mutation.remove-worksheet-range-theme-style",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,themeName:s}=t,a=ec(e.get(E.IUniverInstanceService)),o=e.get(el);return!!a&&(o.removeRangeThemeRule(s,{range:i,unitId:r,subUnitId:n}),!0)}},ef=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[DeleteWorksheetRangeThemeStyleMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),range:t.range,themeName:t.themeName}},ep=(e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},eC={id:"sheet.mutation.insert-row",type:E.CommandType.MUTATION,handler:(e,t)=>{var r;let{unitId:n,subUnitId:i,range:s,rowInfo:a}=t,o=e.get(E.IUniverInstanceService).getUniverSheetInstance(n);if(null==o)throw Error("universheet is null error!");let l=o.getSheetBySheetId(i);if(null==l)throw Error("worksheet is null error!");let u=l.getRowManager().getRowData(),c={h:l.getConfig().defaultRowHeight,hd:0},h=s.startRow,d=s.endRow-s.startRow+1;for(let e=h;e<h+d;e++)a?(0,E.insertMatrixArray)(e,null!=(r=a[e-s.startRow])?r:c,u):(0,E.insertMatrixArray)(e,c,u);return l.setRowCount(l.getRowCount()+s.endRow-s.startRow+1),l.getCellMatrix().insertRows(s.startRow,d),!0}},e_=(e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},ey={id:"sheet.mutation.insert-col",type:E.CommandType.MUTATION,handler:(e,t)=>{var r;let n=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==n)throw Error("universheet is null error!");let i=n.getSheetBySheetId(t.subUnitId);if(!i)return!1;let s=i.getColumnManager(),{range:a,colInfo:o}=t,l=s.getColumnData(),u=a.startColumn,c=a.endColumn-a.startColumn+1,h=i.getConfig().defaultColumnWidth;for(let e=u;e<u+c;e++){let t={w:h,hd:0};o?(0,E.insertMatrixArray)(e,null!=(r=o[e-a.startColumn])?r:t,l):(0,E.insertMatrixArray)(e,t,l)}return i.setColumnCount(i.getColumnCount()+a.endColumn-a.startColumn+1),i.getCellMatrix().insertColumns(a.startColumn,c),!0}},eR={id:"sheet.mutation.move-range",type:E.CommandType.MUTATION,handler:(e,t)=>{let{from:r,to:n}=t;if(!r||!n)return!1;let i=e.get(E.IUniverInstanceService).getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getSheetBySheetId(t.from.subUnitId),a=i.getSheetBySheetId(t.to.subUnitId);if(!s||!a)return!1;let o=s.getCellMatrix(),l=a.getCellMatrix();return new(0,E.ObjectMatrix)(r.value).forValue((e,t,r)=>{o.setValue(e,t,r)}),new(0,E.ObjectMatrix)(n.value).forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}};function eE(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startRow>s.startRow,o=i.endRow-i.startRow+1;return a?{unitId:r,subUnitId:n,sourceRange:E.Rectangle.clone(s),targetRange:{...i,endRow:i.endRow+o,startRow:i.startRow+o}}:{unitId:r,subUnitId:n,targetRange:E.Rectangle.clone(i),sourceRange:{...s,endRow:s.endRow-o,startRow:s.startRow-o}}}let eb={id:"sheet.mutation.move-rows",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(E.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveRowMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveRowMutation] worksheet is null!");let l=i.startRow,u=i.endRow-i.startRow+1,c=s.startRow,h=o.getRowManager().getRowData();return(0,E.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveRows(l,u,c),!0}};function eI(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startColumn>s.startColumn,o=i.endColumn-i.startColumn+1;return a?{unitId:r,subUnitId:n,sourceRange:E.Rectangle.clone(s),targetRange:{...i,endColumn:i.endColumn+o,startColumn:i.startColumn+o}}:{unitId:r,subUnitId:n,targetRange:E.Rectangle.clone(i),sourceRange:{...s,startColumn:s.startColumn-o,endColumn:s.endColumn-o}}}let eN={id:"sheet.mutation.move-columns",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(E.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveColumnMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveColumnMutation] worksheet is null!");let l=i.startColumn,u=i.endColumn-i.startColumn+1,c=s.startColumn,h=o.getColumnManager().getColumnData();return(0,E.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveColumns(l,u,c),!0}},eS={id:"sheet.mutation.remove-rows",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getRowManager().getRowData();for(let e=i.startRow;e<=i.endRow;e++)n.getRowFiltered(e);let a=i.endRow-i.startRow+1;return(0,E.spliceArray)(i.startRow,a,s),n.getCellMatrix().removeRows(i.startRow,a),n.setRowCount(n.getRowCount()-a),!0}},eA={id:"sheet.mutation.remove-col",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getColumnManager().getColumnData(),a=i.endColumn-i.startColumn+1;return(0,E.spliceArray)(i.startColumn,a,s),n.setColumnCount(n.getColumnCount()-a),n.getCellMatrix().removeColumns(i.startColumn,a),!0}},ev=(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().mergeData,s=t.ranges,a=[];for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];E.Rectangle.intersects(r,n)&&a.push(i[t])}return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:a}},eT={id:"sheet.mutation.remove-worksheet-merge",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];E.Rectangle.intersects(r,n)&&i.splice(t,1)}return n.getSpanModel().rebuild(i),!0}},ew=e=>{let{order:t}=e,r={};return Object.keys(t).forEach(e=>{r[t[Number(e)]]=Number(e)}),{...e,order:r}},eM={id:"sheet.mutation.reorder-range",type:E.CommandType.MUTATION,handler:(e,t)=>{let{subUnitId:r,unitId:n,range:i,order:s}=t,a=e.get(E.IUniverInstanceService).getUnit(n).getSheetBySheetId(r);if(!a)return!1;let o=new(0,E.ObjectMatrix);E.Range.foreach(i,(e,t)=>{if(s.hasOwnProperty(e)){let r=s[e],n=E.Tools.deepClone(a.getCellRaw(r,t));o.setValue(e,t,n)}});let l=a.getCellMatrix();return o.forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}},eO=(e,t)=>{let{unitId:r,subUnitId:n,columnData:i}=e,s={},a=t.getColumnManager();for(let e in i){let t=i[e],r=a.getColumn(Number(e));s[e]=function(e,t){if(null==e)return e;let r=E.Tools.deepClone(e);if(null==t)return r;let n={};return"w"in t&&(n.w=r.w),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,columnData:s}},ex={id:"sheet.mutation.set-col-data",type:E.CommandType.MUTATION,handler:(e,t)=>{let{columnData:r}=t,n=ec(e.get(E.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getColumnManager();for(let e in r){let t=r[e];if(null==t){s.removeColumn(Number(e));continue}Object.assign(s.getColumnOrCreate(Number(e)),t)}return!0}},eU={id:"sheet.mutation.set-col-hidden",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=E.BooleanNumber.TRUE)}}return!0}},eD={id:"sheet.mutation.set-col-visible",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=E.BooleanNumber.FALSE)}}return!0}},eV={id:"sheet.mutation.set-gridlines-color",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=ec(e.get(E.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r;return n.getConfig().gridlinesColor=t.color,!0}};function eL(e,t,r=!1){if(null===t)return t;if(void 0===t)return e;let n=E.Tools.deepClone(e)||{};for(let e in t)r&&["bd","tr","td","ht","vt","tb","pd","bg"].includes(e)||(e in n&&"bd"===e?n[e]=Object.assign(n[e],t[e]):n[e]=t[e]);return"cl"in n&&("ul"in n&&n.ul&&(n.ul.cl=n.cl),"ol"in n&&n.ol&&(n.ol.cl=n.cl),"st"in n&&n.st&&(n.st.cl=n.cl)),n}function eP(e,t){return void 0===t.v||null===t.v?t.v:e===E.CellValueType.NUMBER?Number(t.v):e===E.CellValueType.BOOLEAN?+!!function(e){if("string"==typeof e){if("TRUE"===e.toUpperCase())return!0;if("FALSE"===e.toUpperCase())return!1;if((0,E.isSafeNumeric)(e)){if(0===Number(e))return!1;if(1===Number(e))return!0}}if("number"==typeof e){if(0===e)return!1;if(1===e)return!0}return"boolean"==typeof e?e:null}(t.v):e===E.CellValueType.STRING||e===E.CellValueType.FORCE_STRING?`${t.v}`:t.v}let ek=(e,t)=>{let{unitId:r,subUnitId:n,cellValue:i}=t,s=e.get(E.IUniverInstanceService).getUniverSheetInstance(r);if(null==s)throw Error("workbook is null error!");let a=s.getSheetBySheetId(n);if(null==a)throw Error("worksheet is null error!");let o=a.getCellMatrix(),l=s.getStyles(),u=new(0,E.ObjectMatrix);return new(0,E.ObjectMatrix)(i).forValue((e,t,r)=>{let n=E.Tools.deepClone(null==o?void 0:o.getValue(e,t))||{},i=l.getStyleByCell(n);n.s=function(e,t){if(!t||!Object.keys(t).length)return e;let r=E.Tools.deepClone(null!=e?e:{});for(let e in t)"bd"===e?r[e]=function(e,t){if(!t||!Object.keys(t).length)return e;for(let r in t)r in e||(e[r]=null);return e}(r[e]||{},t[e]):e in r||(r[e]=null);return r}(i,l.getStyleByCell(r)),u.setValue(e,t,null==n?null:(void 0===n.f&&(n.f=null),void 0===n.si&&(n.si=null),void 0===n.p&&(n.p=null),void 0===n.v&&(n.v=null),void 0===n.t&&(n.t=null),void 0===n.s&&(n.s=null),void 0===n.custom&&(n.custom=null),n))}),{...t,options:{},cellValue:u.getMatrix()}},eF={id:"sheet.mutation.set-range-values",type:E.CommandType.MUTATION,handler:(e,t)=>{let{cellValue:r,subUnitId:n,unitId:i}=t,s=e.get(E.IUniverInstanceService).getUnit(i);if(!s)return!1;let a=s.getSheetBySheetId(n);if(!a)return!1;let o=a.getCellMatrix(),l=s.getStyles();return new(0,E.ObjectMatrix)(r).forValue((e,t,r)=>{if(r){let n=o.getValue(e,t)||{};n=function(e,t,r){let n=function(e,t,r){var n,i,s,a,o;if(t.t)return t.t;if(null===t.v)return null;let l=e.getStyleByCell(t),u=e.getStyleByCell(r);if(r.t===E.CellValueType.FORCE_STRING){if(!(0,E.isTextFormat)(null==(n=null==u?void 0:u.n)?void 0:n.pattern)&&void 0!==t.v){if((0,E.isRealNum)(t.v))return E.CellValueType.NUMBER;if((0,E.isBooleanString)(`${t.v}`))return E.CellValueType.BOOLEAN}return E.CellValueType.FORCE_STRING}return null!=(o=null==(a=l)?void 0:a.n)&&o.pattern?(0,E.isTextFormat)(null==(i=null==l?void 0:l.n)?void 0:i.pattern)?E.CellValueType.STRING:F(t,r):(0,E.isTextFormat)(null==(s=null==u?void 0:u.n)?void 0:s.pattern)?E.CellValueType.STRING:F(t,r)}(r,e,t);return Object.keys(e).forEach(i=>{if(ej.has(i)){var s,a,o;let r=e[i];s=t,a=i,void 0===(o=r)||(null===o?delete s[a]:s[a]=o)}else"v"===i?void 0!==e.v&&(t.v=eP(n,e)):"s"===i&&function(e,t,r){var n;let i=e.getStyleByCell(t);null==i&&delete t.s,"string"==typeof r.s&&(r.s=e.get(r.s));let s=eL(i,r.s?r.s:null);s&&(E.Tools.removeNull(s),Object.entries(s).forEach(([e,t])=>{"object"==typeof t&&null!==t&&0===Object.keys(t).length&&delete s[e]})),E.Tools.isEmptyObject(s)?delete t.s:t.s=e.setValue(s);let a=r.v?`${r.v}\r
`:"";!r.p&&t.p&&(a&&a!==(null==(n=t.p.body)?void 0:n.dataStream)?delete t.p:function(e,t){var r;if(null==e.body)return;Array.isArray(e.body.textRuns)||(e.body.textRuns=[]);let n=0,i=[],s=(null==(r=e.body)?void 0:r.paragraphs)||[];for(let r of e.body.textRuns){let{st:e,ed:a,ts:o={}}=r;if(n<e){let r={st:n,ed:e},s=eL({},t,!0);s&&E.Tools.removeNull(s),E.Tools.isEmptyObject(s)||(r.ts=s),i.push(r)}let l=eL(o,t,!0);l&&E.Tools.removeNull(l),E.Tools.isEmptyObject(l)?delete r.ts:r.ts=l,i.push(r),n=function e(t,r){return t.some(e=>e.startIndex===r)?e(t,r+1):r}(s,a)}let a=e.body.dataStream.endsWith(`\r
`)?e.body.dataStream.length-2:e.body.dataStream.length;if(n<a){let e={st:n,ed:a},r=eL({},t,!0);r&&E.Tools.removeNull(r),E.Tools.isEmptyObject(r)||(e.ts=r),i.push(e)}e.body.textRuns=(0,E.normalizeTextRuns)(i)}(t.p,r.s?r.s:null))}(r,t,e)}),void 0!==t.v&&(t.t=n,t.v=eP(n,t)),null===t.v&&(delete t.t,delete t.v),t}(r,n,l),E.Tools.isEmptyObject(n)?o.realDeleteValue(e,t):o.setValue(e,t,n)}else o.realDeleteValue(e,t)}),!0}},ej=new Set(["f","p","si","custom","ref"]),eB=(e,t)=>{let{unitId:r,subUnitId:n,rowData:i}=e,s={},a=t.getRowManager();for(let e in i){let t=i[e],r=a.getRow(Number(e));s[e]=function(e,t){if(null==e)return e;let r=E.Tools.deepClone(e);if(null==t)return r;let n={};return"h"in t&&(n.h=r.h),"ia"in t&&(n.ia=r.ia),"ah"in t&&(n.ah=r.ah),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,rowData:s}},e$={id:"sheet.mutation.set-row-data",type:E.CommandType.MUTATION,handler:(e,t)=>{let{rowData:r}=t,n=ec(e.get(E.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getRowManager();for(let e in r){let t=r[e];if(null==t){s.removeRow(Number(e));continue}Object.assign(s.getRowOrCreate(Number(e)),t)}return!0}},eH={id:"sheet.mutation.set-row-visible",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=0)}}return!0}},eW={id:"sheet.mutation.set-row-hidden",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=1)}}return!0}},eG=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getColumnManager();for(let e=0;e<i.length;e++){let t=i[e];for(let e=t.startColumn;e<t.endColumn+1;e++)s[e]=a.getColumnWidth(e)}return{unitId:r,subUnitId:n,ranges:i,colWidth:s}},eY={id:"sheet.mutation.set-worksheet-col-width",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=ec(e.get(E.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r,i=n.getColumnManager(),s=t.ranges;for(let e=0;e<s.length;e++){let r=s[e];for(let e=r.startColumn;e<r.endColumn+1;e++)n.getColVisible(e)&&("number"==typeof t.colWidth?i.setColumnWidth(e,t.colWidth):E.Tools.isDefine(t.colWidth[e])&&i.setColumnWidth(e,t.colWidth[e]))}return!0}},ez=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetColumnCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,columnCount:r.worksheet.getColumnCount()}},eX={id:"sheet.mutation.set-worksheet-column-count",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);return!!r&&(r.worksheet.setColumnCount(t.columnCount),!0)}},eq={id:"sheet.mutation.set-worksheet-default-style",type:E.CommandType.MUTATION,handler:(e,t)=>{let{defaultStyle:r}=t,n=ec(e.get(E.IUniverInstanceService));if(!n)return!1;let{worksheet:i}=n;return!!i&&(i.setDefaultCellStyle(r),!0)}},eK=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetDefaultStyleMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),defaultStyle:n.getDefaultCellStyle()}},eQ=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetRowCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,rowCount:r.worksheet.getRowCount()}},eZ={id:"sheet.mutation.set-worksheet-row-count",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);return!!r&&(r.worksheet.setRowCount(t.rowCount),!0)}},eJ=(e,t)=>{var r,n;let{unitId:i,subUnitId:s,ranges:a}=e,o={},l=t.getRowManager();for(let{startRow:e,endRow:i}of a)for(let s=e;s<i+1;s++)o[s]=null!=(n=null==(r=l.getRow(s))?void 0:r.h)?n:t.getConfig().defaultRowHeight;return{unitId:i,subUnitId:s,ranges:a,rowHeight:o}},e0=(e,t)=>{var r;let{unitId:n,subUnitId:i,ranges:s}=e,a={},o=t.getRowManager();for(let{startRow:e,endRow:t}of s)for(let n=e;n<=t;n++)a[n]=null==(r=o.getRow(n))?void 0:r.ia;return{unitId:n,subUnitId:i,ranges:s,autoHeightInfo:a}},e1=(e,t)=>{var r,n;let{unitId:i,subUnitId:s,rowsAutoHeightInfo:a}=e,o=[],l=t.getRowManager();for(let e of a){let{row:i}=e;o.push({row:i,autoHeight:null!=(n=null==(r=l.getRow(i))?void 0:r.ah)?n:t.getConfig().defaultRowHeight})}return{unitId:i,subUnitId:s,rowsAutoHeightInfo:o}},e2={id:"sheet.mutation.set-worksheet-row-height",type:E.CommandType.MUTATION,handler:(e,t)=>{let{ranges:r,rowHeight:n}=t,i=ec(e.get(E.IUniverInstanceService),t);if(!i)return!1;let{worksheet:s}=i,a=s.getRowManager();for(let{startRow:e,endRow:t}of r)for(let r=e;r<=t;r++)"number"==typeof n?a.setRowHeight(r,n):E.Tools.isDefine(n[r])&&a.setRowHeight(r,n[r]);return!0}},e5={id:"sheet.mutation.set-worksheet-row-is-auto-height",type:E.CommandType.MUTATION,handler:(e,t)=>{var r;let{ranges:n,autoHeightInfo:i}=t,s=ec(e.get(E.IUniverInstanceService),t);if(!s)return!1;let a=s.worksheet.getRowManager();for(let{startRow:e,endRow:t}of n)for(let n=e;n<=t;n++){let e=a.getRowOrCreate(n);"number"==typeof i?e.ia=i:e.ia=null!=(r=i[n])?r:void 0}return!0}},e3={id:"sheet.mutation.set-worksheet-row-auto-height",type:E.CommandType.MUTATION,handler:(e,t)=>{let{rowsAutoHeightInfo:r}=t,n=ec(e.get(E.IUniverInstanceService),t);if(!n)return!1;let i=n.worksheet.getRowManager();for(let{row:e,autoHeight:t}of r)i.getRowOrCreate(e).ah=t;return!0}},e4={id:"sheet.mutation.toggle-gridlines",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=ec(e.get(E.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r;return n.getConfig().showGridlines=t.showGridlines,!0}},e6={id:"sheet.operation.set-worksheet-active",type:E.CommandType.OPERATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;for(let[,e]of r.getWorksheets())if(e.getSheetId()===t.subUnitId)return r.setActiveSheet(e),!0;return!1}};var e9=((s=e9||{}).SET_WORKSHEET_ROW_HEIGHT="sheet.mutation.set-worksheet-row-height",s.SET_WORKSHEET_ROW_IS_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-is-auto-height",s.SET_WORKSHEET_ROW_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-auto-height",s.SET_WORKSHEET_COL_WIDTH="sheet.mutation.set-worksheet-col-width",s.SET_WORKSHEET_ACTIVE="sheet.operation.set-worksheet-active",s.MOVE_ROWS="sheet.mutation.move-rows",s.MOVE_COLUMNS="sheet.mutation.move-columns",s.SET_COL_HIDDEN="sheet.mutation.set-col-hidden",s.SET_COL_VISIBLE="sheet.mutation.set-col-visible",s.SET_ROW_HIDDEN="sheet.mutation.set-row-hidden",s.SET_ROW_VISIBLE="sheet.mutation.set-row-visible",s.INSERT_COL="sheet.mutation.insert-col",s.INSERT_ROW="sheet.mutation.insert-row",s.REMOVE_COL="sheet.mutation.remove-col",s.REMOVE_ROW="sheet.mutation.remove-rows",s.TOGGLE_GRIDLINES="sheet.mutation.toggle-gridlines",s.SET_GRIDLINES_COLOR="sheet.mutation.set-gridlines-color",s),e8=((a=e8||{}).SET_RANGE_VALUES="sheet.mutation.set-range-values",a.MOVE_RANGE="sheet.mutation.move-range",a.REMOVE_WORKSHEET_MERGE="sheet.mutation.remove-worksheet-merge",a.ADD_WORKSHEET_MERGE="sheet.mutation.add-worksheet-merge",a.REORDER_RANGE="sheet.mutation.reorder-range",a.SET_WORKSHEET_DEFAULT_STYLE="sheet.mutation.set-worksheet-default-style",a.SET_ROW_DATA="sheet.mutation.set-row-data",a.SET_COL_DATA="sheet.mutation.set-col-data",a.SET_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.set-worksheet-range-theme-style",a.DELETE_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.delete-worksheet-range-theme-style",a);let e7=[e2.id,e5.id,e3.id,eY.id,e6.id,eb.id,eN.id,eU.id,eD.id,eW.id,eH.id,ey.id,eC.id,eA.id,eS.id,e4.id,eV.id,eZ.id,eX.id],te=[eF.id,eR.id,eT.id,$.id,eM.id,eq.id,e$.id,ex.id,ed.id,eg.id];function tt(e){switch(e.id){case"sheet.mutation.set-range-values":{let t=e.params,r=new(0,E.ObjectMatrix)(t.cellValue).getDataRange();return -1===r.endRow?[]:t.cellValue?[{unitId:t.unitId,subUnitId:t.subUnitId,range:r}]:[]}case"sheet.mutation.move-range":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.from.subUnitId,range:new(0,E.ObjectMatrix)(t.from.value).getRange()},{unitId:t.unitId,subUnitId:t.to.subUnitId,range:new(0,E.ObjectMatrix)(t.to.value).getRange()}]}case"sheet.mutation.remove-worksheet-merge":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:e}))}case"sheet.mutation.add-worksheet-merge":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:e}))}case"sheet.mutation.reorder-range":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}]}case"sheet.mutation.set-worksheet-default-style":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:0,endRow:Number.MAX_SAFE_INTEGER,startColumn:0,endColumn:Number.MAX_SAFE_INTEGER}}]}case"sheet.mutation.set-row-data":{let t=e.params,r=Object.keys(t.rowData).map(Number);return 0===r.length?[]:[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:Math.min(...r),endRow:Math.max(...r),startColumn:0,endColumn:Number.MAX_SAFE_INTEGER}}]}case"sheet.mutation.set-col-data":{let t=e.params,r=Object.keys(t.columnData).map(Number);return 0===r.length?[]:[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:0,endRow:Number.MAX_SAFE_INTEGER,startColumn:Math.min(...r),endColumn:Math.max(...r)}}]}case"sheet.mutation.set-worksheet-range-theme-style":case"sheet.mutation.delete-worksheet-range-theme-style":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}]}default:return[]}}function tr(e,t){switch(e.id){case"sheet.mutation.set-worksheet-row-height":case"sheet.mutation.set-worksheet-row-is-auto-height":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:E.RANGE_TYPE.ROW}}))}case"sheet.mutation.set-worksheet-row-auto-height":{let r=e.params;return r.rowsAutoHeightInfo.map(e=>({unitId:r.unitId,subUnitId:r.subUnitId,range:{startRow:e.row,endRow:e.row,startColumn:0,endColumn:t-1,rangeType:E.RANGE_TYPE.ROW}}))}case"sheet.mutation.set-worksheet-col-width":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:E.RANGE_TYPE.COLUMN}}))}case"sheet.mutation.move-rows":case"sheet.mutation.move-columns":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.targetRange},{unitId:t.unitId,subUnitId:t.subUnitId,range:t.sourceRange}]}case"sheet.mutation.set-col-hidden":case"sheet.mutation.set-col-visible":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:E.RANGE_TYPE.COLUMN}}))}case"sheet.mutation.set-row-hidden":case"sheet.mutation.set-row-visible":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:E.RANGE_TYPE.ROW}}))}case"sheet.mutation.insert-col":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:E.RANGE_TYPE.COLUMN}}]}case"sheet.mutation.insert-row":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:E.RANGE_TYPE.ROW}}]}case"sheet.mutation.remove-col":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:E.RANGE_TYPE.COLUMN}}]}case"sheet.mutation.remove-rows":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:E.RANGE_TYPE.ROW}}]}default:return[]}}function tn(e){return null!=e&&(void 0!==e.v&&null!==e.v&&""!==e.v||void 0!==e.p)}function ti(e,t){return e&&e.spanAnchor?tn(t.getValue(e.spanAnchor.startRow,e.spanAnchor.startColumn)):tn(e)}function ts(e,t,r){let n=r.getMaxRows(),i=r.getMaxColumns(),s=function(e,t,r,n,i){let s=e.getCellMatrix(),a=e.getSpanModel().getMergedCellRange(0,0,n,i),o=new(0,E.ObjectMatrix);return s.forValue((e,t)=>{let r=s.getValue(e,t);r&&o.setValue(e,t,r)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;(0,E.createRowColIter)(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}),(e!==r||a!==t)&&(o.realDeleteValue(e,a),o.setValue(e,a,{spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}))})}),o}(r,0,0,n-1,i-1),a=r.getSnapshot().mergeData.length>0,{left:o,right:l,up:u,down:c}=t,h=!0,d={...e},m=[];for(;h;){if(h=!1,u&&0!==d.startRow){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endColumn:a}=e,o=null,l=!1;for(let e=s;e<=a;e++){let r=t.getValue(i-1,e);if(l=l||ti(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startRow=e.startRow-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(c&&d.endRow!==n-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startColumn:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=s;e++){let r=t.getValue(a+1,e);if(l=l||ti(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endRow=e.endRow+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(o&&0!==d.startColumn){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s-1);if(l=l||ti(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startColumn=e.startColumn-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(l&&d.endColumn!==i-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s+1);if(l=l||ti(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endColumn=e.endColumn+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}}return m.length>0&&(d=E.Rectangle.union(d,...m)),d}let ta=e=>{let t=new(0,E.ObjectMatrix);return e.forEach(e=>{E.Range.foreach(e,(e,r)=>{t.setValue(e,r,1)})}),t.forValue((e,r)=>{let n=t.getValue(e-1,r);n&&t.setValue(e,r,n+1)}),t},to=e=>(e.forValue((t,r)=>{let n=e.getValue(t-1,r);n&&e.setValue(t,r,n+1)}),e),tl=e=>{let t={area:0},r=(e,r)=>t.area<e&&(t.area=e,t.range=r,!0);return e.forValue((t,n,i)=>{let s=1,a=i;r(+a,{startRow:t-a+1,endRow:t,startColumn:n,endColumn:n});let o={startRow:t-a+1,endRow:t,startColumn:0,endColumn:n};for(let i=n-1;i>=0&&e.getValue(t,i);i--){let n=(a=Math.min(e.getValue(t,i)||0,a))*++s;o.startColumn=i,o.startRow=t-a+1,r(n,o)}}),t},tu=(e,t)=>{E.Range.foreach(t,(t,r)=>{e.realDeleteValue(t,r)});for(let r=t.startColumn;r<=t.endColumn;r++){let n=t.endRow+1;if(e.getValue(n,r)>0){e.setValue(n,r,1);let t=n+1;for(;e.getValue(t,r)>0;)e.setValue(t,r,e.getValue(t-1,r)+1),t++}}return e},tc=e=>{let t=[],r=tl(e);for(;r.area>0;)r.range&&(t.push(r.range),tu(e,r.range)),r=tl(e);return t},th=e=>tc(ta(e));class td{constructor(){k(this,"_matrix",new(0,E.ObjectMatrix))}add(...e){return e.forEach(e=>{E.Range.foreach(e,(e,t)=>{this._matrix.setValue(e,t,1)})}),this}subtract(...e){return e.forEach(e=>{E.Range.foreach(e,(e,t)=>{this._matrix.realDeleteValue(e,t)})}),this}merge(){return tc(to(this._matrix))}}let tm=1.5,tg="rgba(255, 255, 255, 0.01)";function tf(e){let{rangeWithCoord:t,primaryWithCoord:r,style:n}=e,i={range:{startRow:t.startRow,startColumn:t.startColumn,endRow:t.endRow,endColumn:t.endColumn,rangeType:t.rangeType,unitId:t.unitId,sheetId:t.sheetId},primary:null,style:n};return null!=r&&(i.primary=tp(r)),i}function tp(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=e.mergeInfo;return{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,startRow:s,startColumn:a,endRow:o,endColumn:l}}var tC=((o=tC||{})[o.Tab=1]="Tab",o[o.Comma=2]="Comma",o[o.Semicolon=4]="Semicolon",o[o.Space=8]="Space",o[o.Custom=16]="Custom",o);class t_{constructor(){k(this,"_tabCount",0),k(this,"_commaCount",0),k(this,"_semicolonCount",0),k(this,"_spaceCount",0)}add(e){switch(e){case"	":this._tabCount++;break;case",":this._commaCount++;break;case";":this._semicolonCount++;break;case" ":this._spaceCount++}}update(e){e&&"string"==typeof e&&(e.includes("	")&&this._tabCount++,e.includes(",")&&this._commaCount++,e.includes(";")&&this._semicolonCount++,e.trim().includes(" ")&&this._spaceCount++)}getDelimiter(){let e=Math.max(this._tabCount,this._commaCount,this._semicolonCount,this._spaceCount);return 0===e||e===this._tabCount?1:e===this._commaCount?2:e===this._semicolonCount?4:e===this._spaceCount?8:1}}function ty(e,t,r,n,i=!1){let{startColumn:s,startRow:a,endColumn:o,endRow:l}=E.Range.transformRange(t,e);if(s!==o)throw Error("The range must be in the same column.");if(r&&(16&r)>0&&(void 0===n||1!==n.length))throw Error("The custom delimiter must a character.");let u=void 0===r,c=u?new t_:null,h=[];for(let t=a;t<=l;t++){let r=function(e){if(null!=e){if(e.p){var t;return(null==(t=e.p.body)?void 0:t.dataStream.replace(/\r\n$/,""))||""}if(e.v&&"string"==typeof e.v)return e.v;if(e.t&&(e.t===E.CellValueType.FORCE_STRING||e.t===E.CellValueType.STRING))return String(e.v)}}(e.getCell(t,s));h.push(r),c&&c.update(r)}let d=function(e,t,r){let n=[];void 0!==r&&(16&e)>0&&n.push(r),(1&e)>0&&n.push("	"),(2&e)>0&&n.push(","),(4&e)>0&&n.push(";"),(8&e)>0&&n.push(" ");let i="";for(let e of n)i+=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let s="[".concat(i,"]");return t&&(s+="+"),new RegExp(s)}(u?c.getDelimiter():r,i,n),m=-1,g=0,f=0,p=[];for(let e of h){if(void 0!==e){let t=String(e).split(d);m=m<0?t.length:Math.max(m,t.length),p.push(t),g=f}else p.push(void 0);f++}return{rs:p,maxLength:-1===m?0:m,lastRow:g}}function tR(e,t){for(let n=e.startRow;n<=e.endRow;n++)for(let i=e.startColumn;i<=e.endColumn;i++){var r;if(null!=(r=t.getCell(n,i))&&(void 0!==r.v&&null!==r.v&&""!==r.v||void 0!==r.p))return{startRow:n,startColumn:i,endRow:n,endColumn:i}}return null}function tE(e){let t=new(0,E.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,null)}),t.clone()}function tb(e){let t=new(0,E.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{v:null,p:null,f:null,si:null,custom:null})}),t.clone()}function tI(e,t,r,n){let i=t.get(E.IUniverInstanceService),s=r?i.getUnit(r,E.UniverInstanceType.UNIVER_SHEET):i.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET),a=n?null==s?void 0:s.getSheetBySheetId(n):null==s?void 0:s.getActiveSheet();if(!a)return null;let{startRow:o,endRow:l,startColumn:u,endColumn:c}=e,h=[],d=[];for(let e=o;e<=l;e++)a.getRowFiltered(e)||h.push(e);for(let e=u;e<=c;e++)d.push(e);return{rows:h,cols:d}}function tN(e,t,r,n){let i=[],s=[];for(let a of e){let e=tI(a,t,r,n);e&&(i.push(...e.rows),s.push(...e.cols))}let a=Array.from(new Set(i)).sort((e,t)=>e-t),o=Array.from(new Set(s)).sort((e,t)=>e-t),l=[];function u(e){let t=[],r=e[0];for(let n=1;n<e.length;n++)e[n]!==e[n-1]+1&&(t.push([r,e[n-1]]),r=e[n]);return t.push([r,e[e.length-1]]),t}let c=u(a),h=u(o);for(let[e,t]of c)for(let[r,n]of h)l.push({startRow:e,endRow:t,startColumn:r,endColumn:n});return l}var tS=((l=tS||{}).OthersCanView="othersCanView",l.NoOneElseCanView="noOneElseCanView",l),tA=((c=tA||{}).DesignedUserCanEdit="designedUserCanEdit",c.OnlyMe="onlyMe",c);class tv{constructor(){k(this,"_model",new Map),k(this,"_ruleChange$",new(0,x.Subject)),k(this,"ruleChange$",this._ruleChange$.asObservable()),k(this,"_ruleRefresh$",new(0,x.Subject)),k(this,"ruleRefresh$",this._ruleRefresh$.asObservable()),k(this,"_rangeRuleInitStateChange",new(0,I.BehaviorSubject)(!1)),k(this,"rangeRuleInitStateChange$",this._rangeRuleInitStateChange.asObservable())}dispose(){this._ruleChange$.complete(),this._ruleRefresh$.complete()}ruleRefresh(e){this._ruleRefresh$.next(e)}getRangeRuleInitState(){return this._rangeRuleInitStateChange.value}changeRuleInitState(e){this._rangeRuleInitStateChange.next(e)}addRule(e,t,r){this._ensureRuleMap(e,t).set(r.id,r),this._ruleChange$.next({unitId:e,subUnitId:t,rule:r,type:"add"})}deleteRule(e,t,r){var n,i,s,a;let o=null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r);o&&(null==(a=null==(s=this._model.get(e))?void 0:s.get(t))||a.delete(r),this._ruleChange$.next({unitId:e,subUnitId:t,rule:o,type:"delete"}))}setRule(e,t,r,n){var i,s;let a=this.getRule(e,t,r);a&&(null==(s=null==(i=this._model.get(e))?void 0:i.get(t))||s.set(r,n),this._ruleChange$.next({unitId:e,subUnitId:t,oldRule:a,rule:n,type:"set"}))}getRule(e,t,r){var n,i;return null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r)}getSubunitRuleList(e,t){var r;return[...((null==(r=this._model.get(e))?void 0:r.get(t))||new Map).values()]}getSubunitRuleListLength(e,t){var r;let n=null==(r=this._model.get(e))?void 0:r.get(t);return n?n.size:0}_ensureRuleMap(e,t){let r=this._model.get(e);r||(r=new Map,this._model.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t),n=[...r.keys()];e[t]={},n.forEach(n=>{let i=r.get(n);e[t][n]=[...i.values()]})}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r],i=new Map;Object.keys(n).forEach(e=>{let t=n[e].reduce((e,t)=>(e.set(t.id,t),e),new Map);i.set(e,t)}),t.set(r,i)}),this._model=t}deleteUnitModel(e){this._model.delete(e)}createRuleId(e,t){let r=(0,E.generateRandomId)(4),n=this._ensureRuleMap(e,t);for(;n.has(r);)r=(0,E.generateRandomId)(4);return r}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)for(let r of i.values())if(r.permissionId===t)return[e,n];return null}}let tT=(e,t)=>{let r=e.get(tv),n=t.ruleIds.map(e=>r.getRule(t.unitId,t.subUnitId,e)).filter(e=>!!e);return{id:tO.id,params:{subUnitId:t.subUnitId,unitId:t.unitId,rules:n}}},tw={id:"sheet.mutation.delete-range-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,ruleIds:i}=t,s=e.get(tv);return i.forEach(e=>{s.deleteRule(r,n,e)}),!0}},tM=e=>{let t={...e,ruleIds:e.rules.map(e=>e.id)};return{id:tw.id,params:t}},tO={id:"sheet.mutation.add-range-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rules:i}=t,s=e.get(tv);return i.forEach(e=>{s.addRule(r,n,e)}),!0}},tx={type:E.CommandType.COMMAND,id:"sheet.command.add-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=e.get(tv),{rule:s,permissionId:a}=t,{unitId:o,subUnitId:l,ranges:u,description:c,viewState:h,editState:d}=s,m=[{ranges:u,permissionId:a,id:i.createRuleId(o,l),description:c,unitType:s.unitType,unitId:o,subUnitId:l,viewState:h,editState:d}];if(await r.executeCommand(tO.id,{unitId:o,subUnitId:l,rules:m})){let e=[{id:tO.id,params:{unitId:o,subUnitId:l,rules:m}}],t=[{id:tw.id,params:{unitId:o,subUnitId:l,ruleIds:m.map(e=>e.id)}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}};var tU=((h=tU||{})[h.MOVE_START=0]="MOVE_START",h[h.MOVING=1]="MOVING",h[h.MOVE_END=2]="MOVE_END",h[h.ONLY_SET=3]="ONLY_SET",h);class tD extends E.Disposable{constructor(e){super(),k(this,"_worksheetSelections",new Map),k(this,"_selectionMoveStart$",new(0,x.Subject)),k(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable()),k(this,"_selectionMoving$",new(0,x.Subject)),k(this,"selectionMoving$",this._selectionMoving$.asObservable()),k(this,"_selectionMoveEnd$",new(0,I.BehaviorSubject)([])),k(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable()),k(this,"_selectionSet$",new(0,I.BehaviorSubject)([])),k(this,"selectionSet$",this._selectionSet$.asObservable()),k(this,"selectionChanged$"),k(this,"_beforeSelectionMoveEnd$",new(0,I.BehaviorSubject)([])),k(this,"beforeSelectionMoveEnd$",this._beforeSelectionMoveEnd$.asObservable()),this._workbook=e,this.selectionChanged$=(0,T.merge)(this._selectionMoveEnd$,this._selectionSet$)}dispose(){super.dispose(),this._beforeSelectionMoveEnd$.complete(),this._selectionMoveEnd$.complete(),this._selectionMoving$.complete(),this._selectionMoveStart$.complete(),this._selectionSet$.complete()}addSelections(e,t){let r=this.getSelectionsOfWorksheet(e);r.push(...t),this._selectionSet$.next(r)}setSelections(e,t=[],r){switch(this.setSelectionsOfWorksheet(e,t),r){case tU.MOVE_START:this._selectionMoveStart$.next(t);break;case tU.MOVING:this._selectionMoving$.next(t);break;case tU.MOVE_END:this._beforeSelectionMoveEnd$.next(t),this._selectionMoveEnd$.next(t);break;case tU.ONLY_SET:default:this._selectionSet$.next(t)}}getCurrentSelections(){return this._getCurrentSelections()}getSelectionOfWorksheet(e){return this.getSelectionsOfWorksheet(e)}getSelectionsOfWorksheet(e){return this._worksheetSelections.has(e)||this._worksheetSelections.set(e,[]),this._worksheetSelections.get(e)}setSelectionsOfWorksheet(e,t){this._worksheetSelections.set(e,[...t])}deleteSheetSelection(e){this._worksheetSelections.set(e,[])}clear(){this._worksheetSelections.clear(),this._selectionSet$.next([])}_getCurrentSelections(){return this.getSelectionsOfWorksheet(this._workbook.getActiveSheet().getSheetId())}getCurrentLastSelection(){let e=this._getCurrentSelections();return e[e.length-1]}}var tV=Object.getOwnPropertyDescriptor;let tL=class extends E.RxDisposable{constructor(e){super(),k(this,"selectionMoveStart$"),k(this,"selectionMoving$"),k(this,"selectionMoveEnd$"),k(this,"selectionSet$"),k(this,"selectionChanged$"),k(this,"_workbookSelections",new Map),this._instanceSrv=e,this._init()}get _currentSelectionPos(){let e=this._instanceSrv.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!e)return null;let t=e.getActiveSheet();return{unitId:e.getUnitId(),sheetId:t.getSheetId()}}get currentSelectionParam(){return this._currentSelectionPos}_init(){let e=this._instanceSrv.getCurrentTypeOfUnit$(E.UniverInstanceType.UNIVER_SHEET).pipe((0,M.shareReplay)(1),(0,D.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,U.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveStart$:(0,w.of)())),this.selectionMoving$=e.pipe((0,U.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoving$:(0,w.of)())),this.selectionMoveEnd$=e.pipe((0,U.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveEnd$:(0,w.of)([]))),this.selectionSet$=e.pipe((0,U.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionSet$:(0,w.of)([]))),this.selectionChanged$=e.pipe((0,U.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionChanged$:(0,w.of)([]))).pipe((0,N.distinctUntilChanged)((e,t)=>e.length===t.length&&(0===e.length&&0===t.length||e.every((e,r)=>JSON.stringify(e)===JSON.stringify(t[r])))),(0,O.skip)(1)),this._instanceSrv.getTypeOfUnitDisposed$(E.UniverInstanceType.UNIVER_SHEET).pipe((0,D.takeUntil)(this.dispose$)).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId())})}clear(){this._workbookSelections.forEach(e=>e.clear())}getCurrentSelections(){return this._getCurrentSelections()}getCurrentLastSelection(){let e=this._getCurrentSelections();return null==e?void 0:e[e.length-1]}addSelections(e,t,r){if("string"==typeof e)return void this._ensureWorkbookSelection(e).addSelections(t,r);let n=this._currentSelectionPos;if(!n)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:i,sheetId:s}=n;this._ensureWorkbookSelection(i).addSelections(s,e)}setSelections(e,t,r,n){if("string"==typeof e&&"string"==typeof t)return void this._ensureWorkbookSelection(e).setSelections(t,r||[],null!=n?n:tU.ONLY_SET);let i=this._currentSelectionPos;if(!i)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:s,sheetId:a}=i;if("object"==typeof e){let n=null!=t?t:tU.ONLY_SET;this._ensureWorkbookSelection(s).setSelections(a,null!=e?e:r,n)}}clearCurrentSelections(){this._getCurrentSelections().splice(0)}isOverlapping(){let e=this.getCurrentSelections();return null!=e&&e.some(({range:t},r)=>e.some(({range:e},n)=>r!==n&&t.startRow<=e.endRow&&t.endRow>=e.startRow&&t.startColumn<=e.endColumn&&t.endColumn>=e.startColumn))}_getCurrentSelections(){let e=this._currentSelectionPos;if(!e)return[];let{unitId:t,sheetId:r}=e;return this._ensureWorkbookSelection(t).getSelectionsOfWorksheet(r)}getWorkbookSelections(e){return this._ensureWorkbookSelection(e)}_ensureWorkbookSelection(e){let t=this._workbookSelections.get(e);if(!t){let r=this._instanceSrv.getUnit(e);if(!r)throw Error(`[SheetsSelectionsService]: cannot resolve unit with id "${e}"!`);t=new tD(r),this._workbookSelections.set(e,t)}return t}_removeWorkbookSelection(e){this._workbookSelections.delete(e)}};tL=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tV(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(d=E.IUniverInstanceService,(e,t)=>d(e,t,0))],tL);let tP="DISABLE_NORMAL_SELECTIONS",tk="SELECTIONS_ENABLED",tF="REF_SELECTIONS_ENABLED",tj={id:"sheet.command.clear-selection-all",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(E.IUniverInstanceService),i=e.get(E.ICommandService),s=e.get(tL),a=e.get(E.IUndoRedoService),o=e.get(Q),l=n.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=tN(d,e,u,h),g=[],f=[],p={subUnitId:h,unitId:u,cellValue:tE(m)},C=ek(e,p);g.push({id:eF.id,params:p}),f.push({id:eF.id,params:C});let _=o.onCommandExecute({id:tj.id});return g.push(..._.redos),f.unshift(..._.undos),!!(0,E.sequenceExecute)(g,i)&&(a.pushUndoRedo({unitID:u,undoMutations:f,redoMutations:g}),!0)}},tB={id:"sheet.command.clear-selection-format",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(E.IUniverInstanceService),i=e.get(E.ICommandService),s=e.get(tL),a=e.get(E.IUndoRedoService),o=e.get(Q),l=n.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=tN(d,e,u,h),g=[],f=[],p={subUnitId:h,unitId:u,cellValue:function(e){let t=new(0,E.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{s:null})}),t.clone()}(m)},C=ek(e,p);g.push({id:eF.id,params:p}),f.push({id:eF.id,params:C});let _=o.onCommandExecute({id:tB.id});return g.push(..._.redos),f.unshift(..._.undos),!!(0,E.sequenceExecute)(g,i)&&(a.pushUndoRedo({unitID:u,undoMutations:f,redoMutations:g}),!0)}};function t$(e,t,r=!0){let n=t.getMatrixWithMergedCells(...(0,E.selectionToArray)(e)),i=[];if(n.forValue((t,r,n)=>{if(void 0!==n.colSpan&&void 0!==n.rowSpan){let s={startRow:t,startColumn:r,endRow:t+n.rowSpan-1,endColumn:r+n.colSpan-1};E.Rectangle.contains(e,s)||i.push(s)}}),0===i.length)return e;let s=E.Rectangle.union(e,...i);return r?t$(s,t,r):s}function tH(e,t,r){let n=null;return r.getMatrixWithMergedCells(e,t,e,t).forValue((e,t,r)=>(n={actualRow:e,actualColumn:t,startRow:e,startColumn:t,isMerged:void 0!==r.rowSpan||void 0!==r.colSpan,isMergedMainCell:void 0!==r.rowSpan&&void 0!==r.colSpan,endRow:e+(void 0!==r.rowSpan?r.rowSpan-1:0),endColumn:t+(void 0!==r.colSpan?r.colSpan-1:0),rangeType:E.RANGE_TYPE.NORMAL},!1)),n||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:E.RANGE_TYPE.NORMAL}}function tW(e,t,r){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return Number.isNaN(n)&&(e.startRow=0),Number.isNaN(s)&&(e.endRow=t-1),Number.isNaN(i)&&(e.startColumn=0),Number.isNaN(a)&&(e.endColumn=r-1),e}function tG(e,t){let r=Number.isNaN(e.startRow)?0:e.startRow,n=Number.isNaN(e.startColumn)?0:e.startColumn,i=t.getMergedCell(r,n);return i?{...i,actualRow:r,actualColumn:n,rangeType:E.RANGE_TYPE.NORMAL,isMerged:!0,isMergedMainCell:!0}:{startRow:r,startColumn:n,endRow:e.startRow,endColumn:e.startColumn,actualRow:r,actualColumn:n,rangeType:E.RANGE_TYPE.NORMAL,isMerged:!1,isMergedMainCell:!1}}let tY=(e,t,r)=>({id:t0.id,params:{unitId:t.getUnitId(),subUnitId:r.getSheetId(),reveal:!0,selections:[{range:e,primary:tG(e,r)}]}});function tz(e){if(!e)return!1;let{range:t,primary:r}=e;return E.Rectangle.equals(t,r)}let tX=e=>e.id!==G;function tq(e,t,r,n,i,s,a){let o={};for(let l=t;l<=r;l++)for(let t=n;t<=i;t++){let r=s?e.getCellWithFilteredInterceptors(a,t,Y,tX):e.getCellWithFilteredInterceptors(l,a,Y,tX);r&&r.s&&(o[l]||(o[l]={}),o[l][t]={s:r.s})}return o}var tK=Object.getOwnPropertyDescriptor;let tQ=(0,b.createIdentifier)("sheets-formula.ref-selections.service"),tZ=class extends tL{constructor(e){super(e)}_init(){let e=this._getAliveWorkbooks$().pipe((0,D.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,U.switchMap)(e=>(0,T.merge)(...e.map(e=>e.selectionMoveStart$)))),this.selectionMoving$=e.pipe((0,U.switchMap)(e=>(0,T.merge)(...e.map(e=>e.selectionMoving$)))),this.selectionMoveEnd$=e.pipe((0,U.switchMap)(e=>(0,T.merge)(...e.map(e=>e.selectionMoveEnd$)))),this.selectionSet$=e.pipe((0,U.switchMap)(e=>(0,T.merge)(...e.map(e=>e.selectionSet$))))}_getAliveWorkbooks$(){let e=this._instanceSrv.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET);e.forEach(e=>this._ensureWorkbookSelection(e.getUnitId()));let t=new(0,I.BehaviorSubject)(e);return this.disposeWithMe(this._instanceSrv.getTypeOfUnitAdded$(E.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._ensureWorkbookSelection(e.getUnitId()),t.next([...t.getValue(),e])})),this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(E.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId()),t.next(t.getValue().filter(t=>t!==e))})),t.pipe((0,v.map)(e=>e.map(e=>this._ensureWorkbookSelection(e.getUnitId()))))}};function tJ(e,t){let r=e.get(E.IContextService).getContextValue(tF);return e.get(r&&!t?tQ:tL)}tZ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tK(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(m=E.IUniverInstanceService,(e,t)=>m(e,t,0))],tZ);let t0={id:"sheet.operation.set-selections",type:E.CommandType.OPERATION,handler:(e,t)=>{if(!t)return!1;let{selections:r,type:n,unitId:i,subUnitId:s}=t;return tJ(e).setSelections(i,s,[...r],n),!0}},t1={id:"sheet.command.select-range",type:E.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnit:n,range:i}=t,s=e.get(E.ICommandService),a=ec(e.get(E.IUniverInstanceService),t);if(!a)return!1;let o=[{range:i,primary:tG(i,a.worksheet),style:null}];return s.syncExecuteCommand(t0.id,{unitId:r,subUnitId:n,selections:o})}},t2="sheet.command.move-range",t5={type:E.CommandType.COMMAND,id:t2,handler:async(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService),o=e.get(E.ErrorService),l=e.get(E.LocaleService),u=e.get(Q),c=ec(a);if(!c||!await u.beforeCommandExecute({id:t5.id,params:t}))return!1;let{worksheet:h,subUnitId:d,unitId:m}=c,g=t3(e,{unitId:m,subUnitId:d,range:t.fromRange},{subUnitId:d,range:t.toRange});if(null===g)return o.emit(l.t("sheets.info.acrossMergedCell")),!1;let f=u.onCommandExecute({id:t5.id,params:t}),p=[...null!=(r=f.preRedos)?r:[],...g.redos,...f.redos,{id:t0.id,params:{unitId:m,subUnitId:d,selections:[{range:t.toRange,primary:function(e,t,r){let n=e.startRow,i=e.startColumn,s=r.getMergedCell(n,i),a=tG(t,r);if(s){let e=s.endRow-s.startRow+1,t=s.endColumn-s.startColumn+1;a.endRow=a.startRow+e-1,a.endColumn=a.startColumn+t-1,a.actualRow=a.startRow,a.actualColumn=a.startColumn,a.isMerged=!1,a.isMergedMainCell=!0}return a}(t.fromRange,t.toRange,h)}],type:tU.MOVE_END}}],C=[...null!=(n=f.preUndos)?n:[],...g.undos,...f.undos,{id:t0.id,params:{unitId:m,subUnitId:d,selections:[{range:t.fromRange,primary:tG(t.fromRange,h)}],type:tU.MOVE_END}}],_=(0,E.sequenceExecute)(p,i).result,{undos:y,redos:R}=u.generateMutationsOfAutoHeight({unitId:m,subUnitId:d,ranges:[t.fromRange,t.toRange]}),b=u.afterCommandExecute({id:t5.id,params:t});return!!_&&((0,E.sequenceExecute)([...b.redos,...R],i),s.pushUndoRedo({unitID:m,undoMutations:[...C,...b.undos,...y],redoMutations:[...p,...b.redos,...R]}),!0)}};function t3(e,t,r,n=!1){let i=[],s=[],{range:a,subUnitId:o,unitId:l}=t,{range:u,subUnitId:c}=r,h=e.get(E.IUniverInstanceService).getUniverSheetInstance(l),d=null==h?void 0:h.getSheetBySheetId(c),m=null==h?void 0:h.getSheetBySheetId(o),g=null==d?void 0:d.getCellMatrix(),f=null==m?void 0:m.getCellMatrix();if(d&&m&&g&&f){let e=t$(u,d,!1);if(!E.Rectangle.equals(u,e)&&!n)return null;let m=new(0,E.ObjectMatrix),p=new(0,E.ObjectMatrix),C=new(0,E.ObjectMatrix);E.Range.foreach(a,(e,t)=>{let r=f.getValue(e,t);if(m.setValue(e,t,E.Tools.deepClone(r)),r){let n=null==h?void 0:h.getStyles().get(r.s);C.setValue(e,t,E.Tools.deepClone(n))}p.setValue(e,t,null)});let _=new(0,E.ObjectMatrix),y=new(0,E.ObjectMatrix);E.Range.foreach(u,(e,t)=>{_.setValue(e,t,E.Tools.deepClone(g.getValue(e,t)))}),E.Range.foreach(a,(e,t)=>{let r=(0,E.cellToRange)(e,t),n=E.Rectangle.getRelativeRange(r,a),i=E.Rectangle.getPositionRange(n,u),s=E.Tools.deepClone(C.getValue(e,t)),o=E.Tools.deepClone(m.getValue(e,t));o&&s&&(o.s=s),y.setValue(i.startRow,i.startColumn,o)});let R={fromRange:t.range,toRange:r.range,from:{value:p.getMatrix(),subUnitId:o},to:{value:y.getMatrix(),subUnitId:c},unitId:l},b={fromRange:r.range,toRange:t.range,from:{value:m.getMatrix(),subUnitId:o},to:{value:_.getMatrix(),subUnitId:c},unitId:l};i.push({id:eR.id,params:R}),s.push({id:eR.id,params:b})}return{redos:i,undos:s}}var t4=((g=t4||{})[g.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",g[g.UNIVER_DOC=1]="UNIVER_DOC",g[g.UNIVER_SHEET=2]="UNIVER_SHEET",g[g.UNIVER_SLIDE=3]="UNIVER_SLIDE",g[g.UNIVER_PROJECT=4]="UNIVER_PROJECT",g[g.UNRECOGNIZED=-1]="UNRECOGNIZED",g),t6=((f=t6||{})[f.View=0]="View",f[f.Edit=1]="Edit",f[f.ManageCollaborator=2]="ManageCollaborator",f[f.Print=3]="Print",f[f.Duplicate=4]="Duplicate",f[f.Comment=5]="Comment",f[f.Copy=6]="Copy",f[f.Share=7]="Share",f[f.Export=8]="Export",f[f.MoveWorksheet=9]="MoveWorksheet",f[f.DeleteWorksheet=10]="DeleteWorksheet",f[f.HideWorksheet=11]="HideWorksheet",f[f.RenameWorksheet=12]="RenameWorksheet",f[f.CreateWorksheet=13]="CreateWorksheet",f[f.SetWorksheetStyle=14]="SetWorksheetStyle",f[f.EditWorksheetCell=15]="EditWorksheetCell",f[f.InsertHyperlink=16]="InsertHyperlink",f[f.Sort=17]="Sort",f[f.Filter=18]="Filter",f[f.PivotTable=19]="PivotTable",f[f.FloatImg=20]="FloatImg",f[f.History=21]="History",f[f.RwHgtClWdt=22]="RwHgtClWdt",f[f.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",f[f.ViewFilter=24]="ViewFilter",f[f.MoveSheet=25]="MoveSheet",f[f.DeleteSheet=26]="DeleteSheet",f[f.HideSheet=27]="HideSheet",f[f.CopySheet=28]="CopySheet",f[f.RenameSheet=29]="RenameSheet",f[f.CreateSheet=30]="CreateSheet",f[f.SelectProtectedCells=31]="SelectProtectedCells",f[f.SelectUnProtectedCells=32]="SelectUnProtectedCells",f[f.SetCellStyle=33]="SetCellStyle",f[f.SetCellValue=34]="SetCellValue",f[f.SetRowStyle=35]="SetRowStyle",f[f.SetColumnStyle=36]="SetColumnStyle",f[f.InsertRow=37]="InsertRow",f[f.InsertColumn=38]="InsertColumn",f[f.DeleteRow=39]="DeleteRow",f[f.DeleteColumn=40]="DeleteColumn",f[f.EditExtraObject=41]="EditExtraObject",f[f.Delete=42]="Delete",f[f.RecoverHistory=43]="RecoverHistory",f[f.ViewHistory=44]="ViewHistory",f[f.CreatePermissionObject=45]="CreatePermissionObject",f[f.UNRECOGNIZED=-1]="UNRECOGNIZED",f),t9=((p=t9||{})[p.Unkonwn=0]="Unkonwn",p[p.Workbook=1]="Workbook",p[p.Worksheet=2]="Worksheet",p[p.SelectRange=3]="SelectRange",p[p.Document=4]="Document",p[p.Slide=5]="Slide",p[p.UNRECOGNIZED=-1]="UNRECOGNIZED",p);class t8{constructor(e,t,r){k(this,"type",t9.SelectRange),k(this,"subType",t6.Edit),k(this,"status",E.PermissionStatus.INIT),k(this,"value",!0),k(this,"id"),k(this,"unitId"),k(this,"subUnitId"),k(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${t9.SelectRange}.${t6.Edit}.${r}`}}class t7{constructor(e,t,r){k(this,"type",t9.SelectRange),k(this,"subType",t6.View),k(this,"status",E.PermissionStatus.INIT),k(this,"value",!0),k(this,"id"),k(this,"unitId"),k(this,"subUnitId"),k(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${t9.SelectRange}.${t6.View}.${r}`}}class re{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Comment),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Comment}_${e}`}}class rt{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Copy),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Copy}_${e}`}}class rr{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"subType",t6.CopySheet),k(this,"status",E.PermissionStatus.INIT),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.CopySheet}_${e}`}}class rn{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.CreatePermissionObject),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.CreatePermissionObject}_${e}`}}class ri{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.CreateSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.CreateSheet}_${e}`}}class rs{constructor(e){k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.DeleteColumn),this.unitId=e,this.id=`${this.type}.${t6.DeleteColumn}_${e}`}}class ra{constructor(e){k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.DeleteRow),this.unitId=e,this.id=`${this.type}.${t6.DeleteRow}_${e}`}}class ro{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.DeleteSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.DeleteSheet}_${e}`}}class rl{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Duplicate),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Duplicate}_${e}`}}class ru{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Edit),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Edit}_${e}`}}class rc{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Export),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Export}_${e}`}}class rh{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.HideSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.HideSheet}_${e}`}}class rd{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.History),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.History}_${e}`}}class rm{constructor(e){k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.InsertColumn),this.unitId=e,this.id=`${this.type}.${t6.InsertColumn}_${e}`}}class rg{constructor(e){k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.InsertRow),this.unitId=e,this.id=`${this.type}.${t6.InsertRow}_${e}`}}class rf{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.ManageCollaborator),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.ManageCollaborator}_${e}`}}class rp{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.MoveSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.MoveSheet}_${e}`}}class rC{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Print),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Print}_${e}`}}class r_{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.RecoverHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.RecoverHistory}_${e}`}}class ry{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.RenameSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.RenameSheet}_${e}`}}class rR{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.Share),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.Share}_${e}`}}class rE{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.View),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.View}_${e}`}}class rb{constructor(e){k(this,"id"),k(this,"value",!0),k(this,"type",t9.Workbook),k(this,"status",E.PermissionStatus.INIT),k(this,"subType",t6.ViewHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${t6.ViewHistory}_${e}`}}class rI{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.Copy),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.Copy}_${e}_${t}`}}class rN{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.DeleteColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.DeleteColumn}_${e}_${t}`}}class rS{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.Delete),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.Delete}_${e}_${t}`}}class rA{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.DeleteRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.DeleteRow}_${e}_${t}`}}class rv{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.Edit),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.Edit}_${e}_${t}`}}class rT{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.EditExtraObject),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.EditExtraObject}_${e}_${t}`}}class rw{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.Filter),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.Filter}_${e}_${t}`}}class rM{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.InsertColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.InsertColumn}_${e}_${t}`}}class rO{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.InsertHyperlink),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.InsertHyperlink}_${e}_${t}`}}class rx{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.InsertRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.InsertRow}_${e}_${t}`}}class rU{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.ManageCollaborator),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.ManageCollaborator}_${e}_${t}`}}class rD{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.PivotTable),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.PivotTable}_${e}_${t}`}}class rV{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SelectProtectedCells),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SelectProtectedCells}_${e}_${t}`}}class rL{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SelectUnProtectedCells),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SelectUnProtectedCells}_${e}_${t}`}}class rP{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SetCellStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SetCellStyle}_${e}_${t}`}}class rk{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SetCellValue),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SetCellValue}_${e}_${t}`}}class rF{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SetColumnStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SetColumnStyle}_${e}_${t}`}}class rj{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.SetRowStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.SetRowStyle}_${e}_${t}`}}class rB{constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.Sort),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.Sort}_${e}_${t}`}}class r${constructor(e,t){k(this,"value",!0),k(this,"type",t9.Worksheet),k(this,"status",E.PermissionStatus.INIT),k(this,"id"),k(this,"subType",t6.View),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${t6.View}_${e}_${t}`}}let rH={id:"sheet.command.set-range-values",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n,i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService),o=e.get(tL),l=e.get(Q),u=e.get(E.IPermissionService),c=ec(a,t);if(!c)return!1;let{subUnitId:h,unitId:d,workbook:m,worksheet:g}=c,{value:f,range:p,redoUndoId:C}=t,_=p?[p]:null==(r=o.getCurrentSelections())?void 0:r.map(e=>e.range);if(!_||!_.length||!u.getPermissionPoint(new rv(d,h).id))return!1;let y=new(0,E.ObjectMatrix);if(E.Tools.isArray(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=0;e<=n-t;e++)for(let n=0;n<=i-r;n++)y.setValue(e+t,n+r,f[e][n])}else if((0,E.isICellData)(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)y.setValue(e,t,f)}else n=f;let R={subUnitId:h,unitId:d,cellValue:null!=n?n:y.getMatrix()},b=ek(e,R),I=(0,E.mapObjectMatrix)(R.cellValue,(e,t)=>g.getCellHeight(e,t)||void 0);if(!i.syncExecuteCommand(eF.id,R))return!1;let{undos:N,redos:S}=l.onCommandExecute({id:rH.id,params:R}),{undos:A,redos:v}=l.generateMutationsOfAutoHeight({unitId:d,subUnitId:h,ranges:_,cellHeights:new(0,E.ObjectMatrix)(I)});if((0,E.sequenceExecute)([...S,...v],i).result){let e=tY(null!=p?p:y.getRange(),m,g);return s.pushUndoRedo({unitID:d,undoMutations:[{id:eF.id,params:b},...N,...A,e],redoMutations:[{id:eF.id,params:R},...S,...v,E.Tools.deepClone(e)],id:C}),!0}return!1}};function rW(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o,cellValue:l={}}=t,u=e.get(E.IUniverInstanceService),c=e.get(Q),h=u.getUniverSheetInstance(i),d=null==h?void 0:h.getSheetBySheetId(s);if(d){let t=d.getCellMatrix(),u=t.getDataRange();if(a.startColumn<=u.endColumn||a.startRow<=u.endRow){let l,c;if(o===E.Dimension.COLUMNS){let e=Math.min(a.endRow,u.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,E.getArrayLength)(e)-1:0)}l={startRow:a.startRow,startColumn:a.startColumn,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:l.startColumn+n,endRow:e,endColumn:l.endColumn+n}}else{let e=Math.min(a.endColumn,u.endColumn),t=u.endRow;l={startRow:a.startRow,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:l.startRow+r,startColumn:a.startColumn,endRow:l.endRow+r,endColumn:e}}let h=t3(e,{unitId:i,subUnitId:s,range:l},{subUnitId:s,range:c},!0);h&&(r.push(...h.redos),n.push(...h.undos))}if(0===Object.entries(l).length)for(let e=a.startRow;e<=a.endRow;e++){l[e]||(l[e]={});for(let t=a.startColumn;t<=a.endColumn;t++)l[e][t]=null}let h={subUnitId:s,unitId:i,cellValue:l},m=ek(e,h),{undos:g,redos:f}=c.onCommandExecute({id:rH.id,params:{...h,range:a}});r.push({id:eF.id,params:h},...f),n.push({id:eF.id,params:m},...g)}return{redo:r,undo:n}}function rG(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o}=t,l=e.get(E.IUniverInstanceService),u=e.get(Q),c=l.getUniverSheetInstance(i),h=null==c?void 0:c.getSheetBySheetId(s);if(h){let t=h.getCellMatrix(),l=t.getDataRange(),c={subUnitId:s,unitId:i,cellValue:tE([a])},d=ek(e,c),m=u.onCommandExecute({id:rH.id,params:c});if(r.push({id:eF.id,params:c},...m.redos),n.push(...m.undos,{id:eF.id,params:d}),a.startColumn<=l.endColumn||a.startRow<=l.endRow){let u=null,c=null;if(o===E.Dimension.COLUMNS&&a.endColumn<l.endColumn){let e=Math.min(a.endRow,l.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,E.getArrayLength)(e)-1:0)}u={startRow:a.startRow,startColumn:a.endColumn+1,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:u.startColumn-n,endRow:e,endColumn:u.endColumn-n}}if(o===E.Dimension.ROWS&&a.endRow<l.endRow){let e=Math.min(a.endColumn,l.endColumn),t=l.endRow;u={startRow:a.endRow+1,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:u.startRow-r,startColumn:a.startColumn,endRow:u.endRow-r,endColumn:e}}if(u&&c){let t=t3(e,{unitId:i,subUnitId:s,range:u},{subUnitId:s,range:c},!0);t&&(r.push(...t.redos),n.push(...t.undos))}}}return{redo:r,undo:n}}function rY(e,t,r,n,i,s){let{startRow:a,endRow:o,startColumn:l,endColumn:u}=t;if(i===E.Dimension.ROWS){let t=o-a+1;for(let n=r;n>=a;n--)for(let r=l;r<=u;r++){let i=e.getValue(n,r);null==i?e.realDeleteValue(n+t,r):e.setValue(n+t,r,i)}for(let t=o;t>=a;t--)for(let r=l;r<=u;r++)s&&s[t]&&s[t][r]?e.setValue(t,r,s[t][r]):e.realDeleteValue(t,r)}else if(i===E.Dimension.COLUMNS){let t=u-l+1;for(let r=a;r<=o;r++)for(let i=n;i>=l;i--){let n=e.getValue(r,i);null==n?e.realDeleteValue(r,i+t):e.setValue(r,i+t,n)}for(let t=a;t<=o;t++)for(let r=u;r>=l;r--)s&&s[t]&&s[t][r]?e.setValue(t,r,s[t][r]):e.realDeleteValue(t,r)}}function rz(e,t,r,n,i){let{startRow:s,endRow:a,startColumn:o,endColumn:l}=t,u=a-s+1,c=l-o+1;if(i===E.Dimension.ROWS)for(let t=s;t<=r;t++)for(let r=o;r<=l;r++){let n=e.getValue(t+u,r);null==n?e.realDeleteValue(t,r):e.setValue(t,r,n)}else if(i===E.Dimension.COLUMNS)for(let t=s;t<=a;t++)for(let r=o;r<=n;r++){let n=e.getValue(t,r+c);null==n?e.realDeleteValue(t,r):e.setValue(t,r,n)}}let rX="sheet.command.delete-range-move-left",rq={type:E.CommandType.COMMAND,id:rX,handler:async(e,t)=>{var r,n,i;let s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService),o=e.get(E.IUniverInstanceService),l=e.get(tL),u=e.get(Q),c=ec(o);if(!c)return!1;let{worksheet:h,workbook:d,subUnitId:m,unitId:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let p={range:f,subUnitId:m,unitId:g,shiftDimension:E.Dimension.COLUMNS},C=u.onCommandExecute({id:rq.id,params:{range:f}}),{redo:_,undo:y}=rG(e,p),R=[...null!=(n=C.preRedos)?n:[],..._],b=[...C.undos,...y];return R.push(...C.redos),R.push(tY(f,d,h)),b.push(...null!=(i=C.preUndos)?i:[]),!!(0,E.sequenceExecute)(R,s).result&&(a.pushUndoRedo({unitID:g,undoMutations:b.reverse(),redoMutations:R}),!0)}},rK="sheet.command.delete-range-move-up",rQ={type:E.CommandType.COMMAND,id:rK,handler:async(e,t)=>{var r,n,i;let s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService),o=e.get(E.IUniverInstanceService),l=e.get(tL),u=e.get(Q),c=ec(o);if(!c)return!1;let{unitId:h,subUnitId:d,workbook:m,worksheet:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let p={range:f,subUnitId:d,unitId:h,shiftDimension:E.Dimension.ROWS},C=u.onCommandExecute({id:rQ.id,params:{range:f}}),{redo:_,undo:y}=rG(e,p),R=[...null!=(n=C.preRedos)?n:[],..._],b=[...C.undos,...y];return R.push(...C.redos),R.push(tY(f,m,g)),b.push(...null!=(i=C.preUndos)?i:[]),!!(0,E.sequenceExecute)(R,s).result&&(a.pushUndoRedo({unitID:h,undoMutations:b.reverse(),redoMutations:R}),!0)}},rZ={type:E.CommandType.COMMAND,id:"sheet.command.insert-range-move-down",handler:async(e,t)=>{var r,n,i;let s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService),o=e.get(E.IUniverInstanceService),l=e.get(tL),u=e.get(Q),c=e.get(E.ErrorService),h=e.get(E.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=ec(o);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f,workbook:p}=d,C=null==t?void 0:t.range;if(C||(C=null==(r=l.getCurrentLastSelection())?void 0:r.range),!C)return!1;let _=[],y=[],R=f.getCellMatrix(),b=R.getDataRange(),I=Math.max(R.getSlice(b.startRow,b.endRow,C.startColumn,C.endColumn).getDataRange().endRow+(C.endRow-C.startRow+1)-b.endRow,0);if(I>0){let t=C.startRow-1,r=f.getRowHeight(t),n={unitId:m,subUnitId:g,range:{startRow:b.endRow+1,endRow:b.endRow+I,startColumn:b.startColumn,endColumn:b.endColumn},rowInfo:Array(I).fill(void 0).map(()=>({h:r,hd:E.BooleanNumber.FALSE}))};_.push({id:eC.id,params:n});let i=ep(e,n);y.push({id:eS.id,params:i})}let N={};E.Range.foreach(C,(e,t)=>{let r=f.getCell(e,t);r&&(N[e]||(N[e]={}),N[e][t]={s:r.s})});let{redo:S,undo:A}=rW(e,{range:C,subUnitId:g,unitId:m,shiftDimension:E.Dimension.ROWS,cellValue:N});_.push(...S),y.push(...A);let v=u.onCommandExecute({id:rZ.id,params:{range:C}});return _.push(...v.redos),_.push(tY(C,p,f)),y.push(...null!=(n=v.preUndos)?n:[]),_.unshift(...null!=(i=v.preRedos)?i:[]),y.unshift(...v.undos),!!(0,E.sequenceExecute)(_,s)&&(a.pushUndoRedo({unitID:m,undoMutations:y.reverse(),redoMutations:_}),!0)}},rJ="sheet.command.insert-range-move-right",r0={type:E.CommandType.COMMAND,id:rJ,handler:async(e,t)=>{var r,n,i;let s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService),o=e.get(E.IUniverInstanceService),l=e.get(tL),u=e.get(Q),c=e.get(E.ErrorService),h=e.get(E.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=ec(o);if(!d)return!1;let{workbook:m,worksheet:g,unitId:f,subUnitId:p}=d,C=null==t?void 0:t.range;if(C||(C=null==(r=l.getCurrentLastSelection())?void 0:r.range),!C)return!1;let _=[],y=[],R=g.getCellMatrix(),b=R.getDataRange(),I=Math.max(R.getSlice(C.startRow,C.endRow,b.startColumn,b.endColumn).getDataRange().endColumn+(C.endColumn-C.startColumn+1)-b.endColumn,0);if(I>0){let t=C.startColumn-1,r=g.getColumnWidth(t),n={unitId:f,subUnitId:p,range:{startRow:b.startRow+1,endRow:b.endRow,startColumn:b.endColumn+1,endColumn:b.endColumn+I},colInfo:Array(I).fill(void 0).map(()=>({w:r,hd:E.BooleanNumber.FALSE}))};_.push({id:ey.id,params:n});let i=e_(e,n);y.push({id:eA.id,params:i})}let N={};E.Range.foreach(C,(e,t)=>{let r=g.getCell(e,t);r&&r.s&&(N[e]||(N[e]={}),N[e][t]={s:r.s})});let{redo:S,undo:A}=rW(e,{range:C,subUnitId:p,unitId:f,shiftDimension:E.Dimension.COLUMNS,cellValue:N});_.push(...S),y.push(...A);let v=u.onCommandExecute({id:r0.id,params:{range:C}});return _.push(...v.redos),_.push(tY(C,m,g)),y.push(...null!=(n=v.preUndos)?n:[]),_.unshift(...null!=(i=v.preRedos)?i:[]),y.unshift(...v.undos),!!(0,E.sequenceExecute)(_,s).result&&(a.pushUndoRedo({unitID:f,undoMutations:y.reverse(),redoMutations:_}),!0)}},r1="sheet.command.insert-row",r2={type:E.CommandType.COMMAND,id:r1,handler:async(e,t)=>{let r=e.get(E.ICommandService),n=e.get(Q),{range:i,direction:s,unitId:a,subUnitId:o,cellValue:l}=t;return!!await n.beforeCommandExecute({id:r2.id,params:t})&&r.syncExecuteCommand(r5.id,{range:i,direction:s,unitId:a,subUnitId:o,cellValue:l})}},r5={type:E.CommandType.COMMAND,id:"sheet.command.insert-row-by-range",handler:(e,t)=>{var r,n,i,s;let a=e.get(E.ICommandService),o=e.get(E.IUndoRedoService),l=e.get(E.IUniverInstanceService),u=e.get(Q),c=ec(l,t);if(!c)return!1;let{workbook:h,worksheet:d}=c,{range:m,direction:g,unitId:f,subUnitId:p,cellValue:C}=t,{startRow:_,endRow:y}=m;m.rangeType=E.RANGE_TYPE.ROW;let R=g===E.Direction.UP?_:_-1,b=d.getRowHeight(R),I={unitId:f,subUnitId:p,range:m,rowInfo:Array(y-_+1).fill(void 0).map(()=>({h:b,hd:E.BooleanNumber.FALSE}))},N=ep(e,I),S=[{id:eC.id,params:I}],A=[{id:eS.id,params:N}];C&&Object.keys(C).length>0&&S.push({id:eF.id,params:{unitId:f,subUnitId:p,cellValue:C}});let v=u.onCommandExecute({id:r2.id,params:t});return S.unshift(...null!=(r=v.preRedos)?r:[]),S.push(...null!=(n=v.redos)?n:[]),S.push(tY(m,h,d)),A.unshift(...null!=(i=v.preUndos)?i:[]),A.push(...null!=(s=v.undos)?s:[]),!!(0,E.sequenceExecute)(S,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:A,redoMutations:S}),!0)}},r3={type:E.CommandType.COMMAND,id:"sheet.command.insert-row-before",handler:async e=>{var t;let r,n=null==(t=e.get(tL).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s,subUnitId:a,unitId:o}=i,{startRow:l,endRow:u}=r,c=s.getColumnCount()-1,h={unitId:o,subUnitId:a,direction:E.Direction.UP,range:{startRow:l,endRow:u,startColumn:0,endColumn:c},cellValue:tq(s,l,u,0,c,!0,l-1)};return e.get(E.ICommandService).executeCommand(r2.id,h)}},r4={type:E.CommandType.COMMAND,id:"sheet.command.insert-row-after",handler:async e=>{var t;let r,n=null==(t=e.get(tL).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=r.endRow-r.startRow+1,u=r.endRow+1,c=r.endRow+l,h=s.getColumnCount()-1,d={unitId:a,subUnitId:o,direction:E.Direction.DOWN,range:{startRow:u,endRow:c,startColumn:0,endColumn:h,rangeType:E.RANGE_TYPE.ROW},cellValue:tq(s,u,c,0,h,!0,r.endRow)};return e.get(E.ICommandService).executeCommand(r2.id,d)}},r6={type:E.CommandType.COMMAND,id:"sheet.command.insert-multi-rows-above",handler:async(e,t)=>{var r;let n,i=null==(r=e.get(tL).getCurrentSelections())?void 0:r.map(e=>e.range);if((null==i?void 0:i.length)!==1)return!1;n=i[0];let s=ec(e.get(E.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=t.value||0,c=n.startRow,h=n.startRow+u-1,d=a.getColumnCount()-1,m=tq(a,c,h,0,d,!0,c-1),g={unitId:o,subUnitId:l,direction:E.Direction.UP,range:{startRow:c,endRow:h,startColumn:0,endColumn:d,rangeType:E.RANGE_TYPE.ROW},cellValue:m};return e.get(E.ICommandService).executeCommand(r2.id,g)}},r9={type:E.CommandType.COMMAND,id:"sheet.command.insert-multi-rows-after",handler:async(e,t)=>{var r;let n,i=null==(r=e.get(tL).getCurrentSelections())?void 0:r.map(e=>e.range);if((null==i?void 0:i.length)!==1)return!1;n=i[0];let s=ec(e.get(E.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=t.value||0,c=n.endRow+1,h=n.endRow+u,d=a.getColumnCount()-1,m={unitId:o,subUnitId:l,direction:E.Direction.DOWN,range:{startRow:c,endRow:h,startColumn:0,endColumn:d,rangeType:E.RANGE_TYPE.ROW},cellValue:tq(a,c,h,0,d,!0,n.endRow)};return e.get(E.ICommandService).executeCommand(r2.id,m)}},r8="sheet.command.insert-col",r7={type:E.CommandType.COMMAND,id:r8,handler:async(e,t)=>{let r=e.get(E.ICommandService),n=e.get(Q),{range:i,direction:s,subUnitId:a,unitId:o,cellValue:l}=t;return!!await n.beforeCommandExecute({id:r7.id,params:t})&&r.syncExecuteCommand(ne.id,{range:i,direction:s,unitId:o,subUnitId:a,cellValue:l})}},ne={type:E.CommandType.COMMAND,id:"sheet.command.insert-col-by-range",handler:(e,t)=>{var r,n,i,s;let a=e.get(E.ICommandService),o=e.get(E.IUndoRedoService),l=e.get(E.IUniverInstanceService),u=e.get(Q),{range:c,direction:h,subUnitId:d,unitId:m,cellValue:g}=t,{startColumn:f,endColumn:p}=t.range;c.rangeType=E.RANGE_TYPE.COLUMN;let C=l.getUniverSheetInstance(t.unitId),_=C.getSheetBySheetId(t.subUnitId),y=h===E.Direction.LEFT?f:f-1,R=_.getColumnWidth(y),b={unitId:m,subUnitId:d,range:c,colInfo:Array(p-f+1).fill(void 0).map(()=>({w:R,hd:E.BooleanNumber.FALSE}))},I=e_(e,b),N=[{id:ey.id,params:b}],S=[{id:eA.id,params:I}];g&&N.push({id:eF.id,params:{unitId:m,subUnitId:d,cellValue:g}});let A=u.onCommandExecute({id:r7.id,params:t});return N.unshift(...null!=(r=A.preRedos)?r:[]),N.push(...null!=(n=A.redos)?n:[]),N.push(tY(c,C,_)),S.unshift(...null!=(i=A.preUndos)?i:[]),S.push(...null!=(s=A.undos)?s:[]),!!(0,E.sequenceExecute)(N,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:S.filter(Boolean),redoMutations:N.filter(Boolean)}),!0)}},nt={type:E.CommandType.COMMAND,id:"sheet.command.insert-col-before",handler:async e=>{let t,r=e.get(tL).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=ec(e.get(E.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,{startColumn:o,endColumn:l}=t,u=i.getRowCount()-1,c={unitId:s,subUnitId:a,direction:E.Direction.LEFT,range:{startColumn:o,endColumn:l,startRow:0,endRow:u,rangeType:E.RANGE_TYPE.COLUMN},cellValue:tq(i,0,u,o,l,!1,o-1)};return e.get(E.ICommandService).executeCommand(r7.id,c)}},nr={type:E.CommandType.COMMAND,id:"sheet.command.insert-col-after",handler:async e=>{let t,r=e.get(tL).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=ec(e.get(E.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,o=t.endColumn-t.startColumn+1,l=t.endColumn+1,u=t.endColumn+o,c=i.getRowCount()-1,h={unitId:s,subUnitId:a,direction:E.Direction.RIGHT,range:{startColumn:l,endColumn:u,startRow:0,endRow:c},cellValue:tq(i,0,c,l,u,!1,t.endColumn)};return e.get(E.ICommandService).executeCommand(r7.id,h)}},nn={type:E.CommandType.COMMAND,id:"sheet.command.insert-multi-cols-before",handler:async(e,t)=>{let r,n=e.get(tL).getCurrentSelections();if((null==n?void 0:n.length)!==1)return!1;r=n[0].range;let i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=t.value||0,u=r.startColumn,c=r.startColumn+l-1,h=s.getRowCount()-1,d={unitId:a,subUnitId:o,direction:E.Direction.LEFT,range:{startColumn:u,endColumn:c,startRow:0,endRow:h,rangeType:E.RANGE_TYPE.COLUMN},cellValue:tq(s,0,h,u,c,!1,u-1)};return e.get(E.ICommandService).executeCommand(r7.id,d)}},ni={type:E.CommandType.COMMAND,id:"sheet.command.insert-multi-cols-right",handler:async(e,t)=>{let r,n=e.get(tL).getCurrentSelections();if((null==n?void 0:n.length)!==1)return!1;r=n[0].range;let i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=t.value||0,u=r.endColumn+1,c=r.endColumn+l,h=s.getRowCount()-1,d={unitId:a,subUnitId:o,direction:E.Direction.RIGHT,range:{startColumn:u,endColumn:c,startRow:0,endRow:h},cellValue:tq(s,0,h,u,c,!1,r.endColumn)};return e.get(E.ICommandService).executeCommand(r7.id,d)}},ns="sheet.command.remove-row",na={type:E.CommandType.COMMAND,id:"sheet.command.remove-row-by-range",handler:(e,t)=>{var r,n,i;if(!t)return!1;let s=ec(e.get(E.IUniverInstanceService),t);if(!s)return!1;let{workbook:a,worksheet:o}=s,l=e.get(Q),{range:u,unitId:c,subUnitId:h}=t,d=tN([u],e,c,h).reverse(),m=[],g=[];d.forEach(e=>{let t=[],r=[],n={unitId:c,subUnitId:h,range:e},i=((e,t)=>{let r=t.getRowManager().getRowData(),n=e.range,i=(0,E.sliceMatrixArray)(n.startRow,n.endRow,r),s=(0,E.concatMatrixArray)({},i);return{unitId:e.unitId,subUnitId:e.subUnitId,range:e.range,rowInfo:s}})(n,o),s={unitId:c,subUnitId:h,cellValue:o.getCellMatrix().getSlice(e.startRow,e.endRow,0,o.getColumnCount()-1).getMatrix()};r.push({id:eS.id,params:n}),t.push({id:eC.id,params:i}),t.push({id:eF.id,params:s}),g.push(...r),m.unshift(...t)});let f=l.onCommandExecute({id:ns,params:{range:u}}),p=e.get(E.ICommandService);return!!(0,E.sequenceExecute)([...null!=(r=f.preRedos)?r:[],...g,...f.redos,tY(u,a,o)],p).result&&(e.get(E.IUndoRedoService).pushUndoRedo({unitID:c,undoMutations:[...null!=(n=f.preUndos)?n:[],...m,...f.undos],redoMutations:[...null!=(i=f.preRedos)?i:[],...g,...f.redos]}),!0)}},no={type:E.CommandType.COMMAND,id:ns,handler:async(e,t)=>{var r;let n=e.get(tL),i=e.get(Q),s=e.get(E.ICommandService),a=null==t?void 0:t.range;if(a||(a=null==(r=n.getCurrentLastSelection())?void 0:r.range),!a)return!1;let o=ec(e.get(E.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o;return a={...a,startColumn:0,endColumn:Math.max(l.getMaxColumns()-1,0)},!!await i.beforeCommandExecute({id:no.id,params:{range:a}})&&s.syncExecuteCommand(na.id,{range:a,unitId:c,subUnitId:u})}},nl="sheet.command.remove-col",nu={type:E.CommandType.COMMAND,id:"sheet.command.remove-col-by-range",handler:(e,t)=>{var r,n,i;if(!t)return!1;let s=ec(e.get(E.IUniverInstanceService),t);if(!s)return!1;let{workbook:a,worksheet:o}=s,l=e.get(Q),{range:u,unitId:c,subUnitId:h}=t,d={unitId:c,subUnitId:h,range:u},m=((e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getColumnManager().getColumnData(),s=t.range,a=(0,E.sliceMatrixArray)(s.startColumn,s.endColumn,i),o=(0,E.concatMatrixArray)({},a);return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,colInfo:o}})(e,d),g={unitId:c,subUnitId:h,cellValue:o.getCellMatrix().getSlice(0,o.getRowCount()-1,u.startColumn,u.endColumn).getMatrix()},f=l.onCommandExecute({id:nl,params:{range:u}}),p=e.get(E.ICommandService);return!!(0,E.sequenceExecute)([...null!=(r=f.preRedos)?r:[],{id:eA.id,params:d},...f.redos,tY(u,a,o)],p).result&&(e.get(E.IUndoRedoService).pushUndoRedo({unitID:c,undoMutations:[...null!=(n=f.preUndos)?n:[],{id:ey.id,params:m},{id:eF.id,params:g},...f.undos],redoMutations:[...null!=(i=f.preRedos)?i:[],{id:eA.id,params:d},...f.redos]}),!0)}},nc={type:E.CommandType.COMMAND,id:nl,handler:async(e,t)=>{var r;let n=e.get(tL),i=e.get(Q),s=e.get(E.ICommandService),a=null==t?void 0:t.range;if(a||(a=null==(r=n.getCurrentLastSelection())?void 0:r.range),!a)return!1;let o=ec(e.get(E.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o;return a={...a,startRow:0,endRow:Math.max(l.getMaxRows()-1,0)},!!await i.beforeCommandExecute({id:nc.id,params:{range:a}})&&s.syncExecuteCommand(nu.id,{range:a,unitId:c,subUnitId:u})}},nh=(e,t)=>{let r=e.get(E.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=eh(r,t);if(!s)throw Error("[RemoveSheetUndoMutationFactory]: Worksheet is null error!");let{workbook:a,worksheet:o}=s,l=o.getConfig();return{index:a.getConfig().sheetOrder.findIndex(e=>e===n),sheet:l,unitId:i}},nd={id:"sheet.mutation.remove-sheet",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=r.getUniverSheetInstance(i);return!!s&&s.removeSheet(n)}},nm="sheet.command.move-rows",ng={id:nm,type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(tL),{fromRange:{startRow:s},toRange:{startRow:a},range:o}=t,l=o?[nC(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===E.RANGE_TYPE.ROW&&e.range.startRow<=s&&s<=e.range.endRow);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(Q),h=ec(e.get(E.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),p=e.get(E.ErrorService),C=e.get(E.LocaleService),_=u[0].range,y=u[0].primary,R=t$(_,m,!1);if(!E.Rectangle.equals(_,R))return p.emit(C.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startRow<a&&a<=e.endRow))return p.emit(C.t("sheets.info.acrossMergedCell")),!1;let b={..._,startRow:a,endRow:a+_.endRow-_.startRow},I={unitId:g,subUnitId:f,sourceRange:_,targetRange:b},N=eE(e,I),S=e.get(E.ICommandService),A=c.onCommandExecute({id:ng.id,params:t}),v=[...null!=(r=A.preRedos)?r:[],{id:eb.id,params:I}],T=[...null!=(n=A.preUndos)?n:[],{id:eb.id,params:N}];if(y){let e=_.endRow-_.startRow+1,t=a-s<0?b:{...b,startRow:b.startRow-e,endRow:b.endRow-e},r={unitId:g,subUnitId:f,type:tU.MOVE_END,selections:[{range:t,primary:tG(t,m),style:null}]},n={unitId:g,subUnitId:f,type:tU.MOVE_END,selections:[{range:_,primary:y,style:null}]};v.push({id:t0.id,params:r}),T.push({id:t0.id,params:n})}return v.push(...A.redos),T.push(...A.undos),!!(0,E.sequenceExecute)(v,S).result&&(e.get(E.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:v}),!0)}},nf="sheet.command.move-cols",np={id:nf,type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(tL),{fromRange:{startColumn:s},toRange:{startColumn:a},range:o}=t,l=o?[nC(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===E.RANGE_TYPE.COLUMN&&e.range.startColumn<=s&&s<=e.range.endColumn);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(Q),h=ec(e.get(E.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),p=e.get(E.ErrorService),C=e.get(E.LocaleService),_=u[0].range,y=u[0].primary,R=t$(_,m,!1);if(!E.Rectangle.equals(_,R))return p.emit(C.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startColumn<a&&a<=e.endColumn))return p.emit(C.t("sheets.info.acrossMergedCell")),!1;let b={..._,startColumn:a,endColumn:a+_.endColumn-_.startColumn},I={unitId:g,subUnitId:f,sourceRange:_,targetRange:b},N=eI(e,I),S=e.get(E.ICommandService),A=c.onCommandExecute({id:np.id,params:t}),v=[...null!=(r=A.preRedos)?r:[],{id:eN.id,params:I}],T=[...null!=(n=A.preUndos)?n:[],{id:eN.id,params:N}];if(y){let e=_.endColumn-_.startColumn+1,t=a-s<0?b:{...b,startColumn:b.startColumn-e,endColumn:b.endColumn-e},r={unitId:g,subUnitId:f,type:tU.MOVE_END,selections:[{range:t,primary:tG(t,m),style:null}]},n={unitId:g,subUnitId:f,type:tU.MOVE_END,selections:[{range:_,primary:y,style:null}]};v.push({id:t0.id,params:r}),T.push({id:t0.id,params:n})}return v.push(...A.redos),T.push(...A.undos),(0,E.sequenceExecute)(v,S).result&&e.get(E.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:v}),!0}};function nC(e){return{range:e,primary:null,style:null}}var n_=Object.getOwnPropertyDescriptor;let ny=class extends E.Disposable{constructor(e){super(),k(this,"_sheetSkeletonStore",new Map),this._injector=e,this.disposeWithMe(()=>{this._sheetSkeletonStore=new Map})}getSkeleton(e,t){if(this._sheetSkeletonStore.has(e))return this._sheetSkeletonStore.get(e).get(t)}setSkeleton(e,t,r){this._sheetSkeletonStore.has(e)||this._sheetSkeletonStore.set(e,new Map),this._sheetSkeletonStore.get(e).set(t,r)}deleteSkeleton(e,t){this._sheetSkeletonStore.has(e)&&this._sheetSkeletonStore.get(e).delete(t)}};function nR(e,t){let r=new(0,E.ObjectMatrix);return e.map(e=>E.Range.transformRange(e,t)).forEach(e=>{E.Range.foreach(e,(e,n)=>{let i=t.getCellHeight(e,n);i&&r.setValue(e,n,i)})}),r}function nE(e,t){if(!t)return{suitableRanges:e,remainingRanges:[]};let r=Math.ceil(1e4/t.worksheet.getColumnCount()),n=[],i=[],s=t.getOffsetRelativeToRowCol(0,t.scrollY).row,a=e.map(e=>{let t;return t=s>=e.startRow&&s<=e.endRow?0:s<e.startRow?e.startRow-s:s-e.endRow,{range:e,distance:t,rowCount:e.endRow-e.startRow+1}});a.sort((e,t)=>e.distance!==t.distance?e.distance-t.distance:e.rowCount-t.rowCount);let o=0;for(let e of a)if(o+e.rowCount<=r)n.push(e.range),o+=e.rowCount;else{let t=r-o;if(t>0){let s={...e.range,endRow:e.range.startRow+t-1},a={...e.range,startRow:e.range.startRow+t};n.push(s),i.push(a),o=r}else i.push(e.range)}return{suitableRanges:n,remainingRanges:i}}ny=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?n_(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(C=(0,b.Inject)(b.Injector),(e,t)=>C(e,t,0))],ny);let nb="sheet.command.reorder-range",nI={id:nb,type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let{subUnitId:i,unitId:s,range:a,order:o}=t,l=e.get(E.ICommandService),u={id:eM.id,params:{unitId:s,subUnitId:i,order:o,range:a}},c={id:eM.id,params:ew(u.params)},h=e.get(Q),d=h.onCommandExecute({id:nI.id,params:t}),m=[...null!=(r=d.preRedos)?r:[],u,...d.redos],g=[...null!=(n=d.preUndos)?n:[],c,...d.undos],f=(0,E.sequenceExecute)(m,l),{suitableRanges:p,remainingRanges:C}=nE([a],e.get(ny).getSkeleton(s,i)),{undos:_,redos:y}=h.generateMutationsOfAutoHeight({unitId:s,subUnitId:i,ranges:[a],autoHeightRanges:p,lazyAutoHeightRanges:C}),R=h.afterCommandExecute({id:nI.id,params:t});return!!f.result&&((0,E.sequenceExecute)([...R.redos,...y],l),e.get(E.IUndoRedoService).pushUndoRedo({unitID:s,undoMutations:[...g,...R.undos,..._],redoMutations:[...m,...R.redos,...y]}),!0)}},nN={MoveRangeCommandId:t2,InsertRowCommandId:r1,InsertColCommandId:r8,RemoveColCommandId:nl,RemoveRowCommandId:ns,DeleteRangeMoveLeftCommandId:rX,DeleteRangeMoveUpCommandId:rK,InsertRangeMoveDownCommandId:"sheet.command.insert-range-move-down",InsertRangeMoveRightCommandId:rJ,MoveColsCommandId:nf,MoveRowsCommandId:nm,ReorderRangeCommandId:nb};var nS=((_=nS||{})[_.Set=0]="Set",_[_.Delete=1]="Delete",_[_.HorizontalMove=2]="HorizontalMove",_[_.VerticalMove=3]="VerticalMove",_[_.Unknown=4]="Unknown",_);let nA=Number.MAX_SAFE_INTEGER,nv=e=>{let t={...e},r=Number.isNaN(t.startRow)&&Number.isNaN(t.endRow)&&!Number.isNaN(t.startColumn)&&!Number.isNaN(t.endColumn),n=Number.isNaN(t.startColumn)&&Number.isNaN(t.endColumn)&&!Number.isNaN(t.startRow)&&!Number.isNaN(t.endRow);return(t.rangeType===E.RANGE_TYPE.COLUMN||r)&&(t.startRow=0,t.endRow=nA),(t.rangeType===E.RANGE_TYPE.ROW||n)&&(t.startColumn=0,t.endColumn=nA),t.rangeType===E.RANGE_TYPE.ALL&&(t.startColumn=0,t.endColumn=nA,t.startRow=0,t.endRow=nA),t},nT=e=>{let t=e.rangeType;return e.rangeType===E.RANGE_TYPE.COLUMN?t=E.RANGE_TYPE.ROW:e.rangeType===E.RANGE_TYPE.ROW&&(t=E.RANGE_TYPE.COLUMN),{startRow:e.startColumn,endRow:e.endColumn,startColumn:e.startRow,endColumn:e.endRow,rangeType:t}},nw=(e,t,r)=>{let n={...r},i={...t},s=(e,t)=>{let r=Math.max(e.start,t.start),n=Math.min(e.end,t.end);return n<r?null:{start:r,end:n}},a=e=>e.end-e.start+1,o=t.start>e.start;if(o){let r=Math.min(e.end,t.start)-e.start+1;i.start-=r,i.end-=r}let l=a(e),u=s(e,n),c=u&&a(u)>=a(n);if(e.end<n.start)n.start-=l,n.end-=l;else if(u){let t=a(u);if(c){let t,r=(t={start:n.start-e.start,end:n.start-e.start+n.end-n.start},{start:i.start+t.start,end:i.start+t.start+t.end-t.start});n.start=r.start,n.end=r.end}else u.start>e.start?o?(n.end-=t+l,n.start-=l):n.end-=t:o?n.end-=t:n.start>e.start&&n.end>e.end?(n.start-=l,n.end-=l+t):n.end-=t}let h=s(i,n);return c||(i.start<=n.start?(n.start+=l,n.end+=l):h&&(o?i.end<=n.start||i.start<=n.start&&i.end>=n.start?(n.start+=l,n.end+=l):i.start>=n.start&&i.start<=n.end&&(n.end+=l):n.start<i.start&&n.end>i.start?n.end+=l:(n.start>=i.end||n.start>=i.start&&n.start<=i.end)&&(n.end+=l,n.start+=l))),{step:n.start-r.start,length:a(n)-a(r)}},nM=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=nv(r),s=nv(n),a=nv(t),o=nw({start:i.startRow,end:i.endRow},{start:s.startRow,end:s.endRow},{start:a.startRow,end:a.endRow});return null===o?[{type:nS.Delete}]:[{type:nS.VerticalMove,step:o.step||0,length:o.length||0}]},nO=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=nv(r),s=nv(n),a=nv(t),o=nw({start:i.startColumn,end:i.endColumn},{start:s.startColumn,end:s.endColumn},{start:a.startColumn,end:a.endColumn});return null===o?[{type:nS.Delete}]:[{type:nS.HorizontalMove,step:o.step||0,length:o.length||0}]},nx=(e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s)return[];let a=[];if(E.Rectangle.contains(i,t)&&a.push({type:nS.Delete}),E.Rectangle.contains(s,t)){a.push({type:nS.Delete});let e=E.Rectangle.getRelativeRange(t,s),r=E.Rectangle.getPositionRange(e,i);return[{type:nS.Set,range:r}]}return a},nU=(e,t)=>{let r=nv(e),n=nv(t),i=e=>e.endColumn-e.startColumn+1,s=e=>e.endRow-e.startRow+1;if(r.startRow<=n.startRow&&r.endRow>=n.endRow){if(n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn){let e=E.Rectangle.getIntersects(n,r);if(e)return{step:0,length:-i(e)}}if(n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn&&s(r)>=s(n))return null;if(n.startColumn>=r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn){let e=E.Rectangle.getIntersects(n,r);if(e){let t=-i(e);return{step:-(i(r)-i(e)),length:t}}}if(n.startColumn>r.endColumn)return{step:-i(r),length:0}}return{step:0,length:0}},nD=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=nU(n,t);if(s){let{step:e,length:t}=s;i.push({type:nS.HorizontalMove,step:e,length:t})}else i.push({type:nS.Delete});return i},nV=(e,t,r)=>{var n;let i=null==(n=e.params)?void 0:n.range;if(!i)return[];let s=[];if(r&&r.length>0){let e=i.startRow;for(let t=i.startRow;t<=i.endRow;t++){if(r.includes(t)){if(t===e){e=t+1;continue}a({...i,startRow:e,endRow:t-1}),e=t+1;continue}t===i.endRow&&a({...i,startRow:e,endRow:i.endRow})}}else a(i);function a(e){let r=nU(nT(e),nT(t));if(r){let{step:e,length:t}=r;s.push({type:nS.VerticalMove,step:e,length:t})}else s.push({type:nS.Delete})}return s},nL=(e,t)=>{let r=nv(e),n=nv(t),i=e=>e.endColumn-e.startColumn+1;return r.startRow<=n.startRow&&r.endRow>=n.endRow?n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn?{step:0,length:i(r)}:n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn>=r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn||n.startColumn>=r.endColumn?{step:i(r),length:0}:{step:0,length:0}:{step:0,length:0}},nP=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=nL(nT(n),nT(t));return i.push({type:nS.VerticalMove,step:s,length:a}),i},nk=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=nL(n,t);return i.push({type:nS.HorizontalMove,step:s,length:a}),i},nF=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=nL(nT(n),nT(t));return i.push({type:nS.VerticalMove,step:s,length:a}),i},nj=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=nL(n,t);return i.push({type:nS.HorizontalMove,step:s,length:a}),i},nB=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=nU(n,t);if(s){let{step:e,length:t}=s;i.push({type:nS.HorizontalMove,step:e,length:t})}else i.push({type:nS.Delete});return i},n$=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=nU(nT(n),nT(t));if(s){let{step:e,length:t}=s;i.push({type:nS.VerticalMove,step:e,length:t})}else i.push({type:nS.Delete});return i},nH=(e,t)=>{let r={...t};return e.forEach(e=>{switch(e.type){case nS.Delete:r=null;break;case nS.HorizontalMove:if(!r)return;r.startColumn+=e.step,r.endColumn+=e.step+(e.length||0);break;case nS.VerticalMove:if(!r)return;r.startRow+=e.step,r.endRow+=e.step+(e.length||0);break;case nS.Set:r=e.range}}),r&&(r.endColumn<r.startColumn||r.endRow<r.startRow)?null:r},nW=(e,t)=>{let r=[];switch(t.id){case nN.DeleteRangeMoveLeftCommandId:r=nB(t,e);break;case nN.DeleteRangeMoveUpCommandId:r=n$(t,e);break;case nN.InsertColCommandId:r=nk(t,e);break;case nN.InsertRangeMoveDownCommandId:r=nF(t,e);break;case nN.InsertRangeMoveRightCommandId:r=nj(t,e);break;case nN.InsertRowCommandId:r=nP(t,e);break;case nN.MoveColsCommandId:r=nO(t,e);break;case nN.MoveRangeCommandId:r=nx(t,e);break;case nN.MoveRowsCommandId:r=nM(t,e);break;case nN.RemoveColCommandId:r=nD(t,e);break;case nN.RemoveRowCommandId:r=nV(t,e);break;case nN.ReorderRangeCommandId:r=((e,t)=>{let{range:r,order:n}=e.params||{};if(!r||!n)return[];if(E.Rectangle.contains(r,t)&&t.endRow===t.startRow){let e=[],r=t.startRow;for(let t in n)if(n[t]===r){let n=Number(t);return e.push({type:nS.VerticalMove,step:n-r,length:0}),e}}return[]})(t,e)}return nH(r,e)},nG=(e,t,r)=>[rq.id,rQ.id].includes(t.id)||nq(t,r).some(t=>E.Rectangle.intersects(t,e))?nW(e,t):e,nY=(e,t)=>{let r=[];switch(t.id){case nN.DeleteRangeMoveLeftCommandId:return((e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={startRow:n.startRow,endRow:n.endRow,startColumn:n.startColumn,endColumn:1/0},s=n.endColumn-n.startColumn+1,a=E.Rectangle.getIntersects(n,t),o=E.Rectangle.subtract(t,i),l=E.Rectangle.getIntersects(i,t);if(!a&&!l)return[t];let u=new(0,E.ObjectMatrix);return l&&E.Range.foreach(l,(e,t)=>{u.setValue(e,t-s,1)}),a&&E.Range.foreach(a,(e,t)=>{u.setValue(e,t-s,0)}),o.forEach(e=>{E.Range.foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,E.queryObjectMatrix)(u,e=>1===e)})(t,e);case nN.DeleteRangeMoveUpCommandId:return((e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={...n,startRow:n.startRow,endRow:1/0},s=n.endRow-n.startRow+1,a=E.Rectangle.getIntersects(n,t),o=E.Rectangle.subtract(t,i),l=E.Rectangle.getIntersects(i,t);if(!a&&!l)return[t];let u=new(0,E.ObjectMatrix);return l&&E.Range.foreach(l,(e,t)=>{u.setValue(e-s,t,1)}),a&&E.Range.foreach(a,(e,t)=>{u.setValue(e-s,t,0)}),o.forEach(e=>{E.Range.foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,E.queryObjectMatrix)(u,e=>1===e)})(t,e);case nN.InsertRangeMoveDownCommandId:return((e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endRow-n.startRow+1,s={...n,startRow:n.startRow,endRow:1/0},a=E.Rectangle.subtract(t,s),o=E.Rectangle.getIntersects(s,t);if(!o)return[t];let l=new(0,E.ObjectMatrix);return a.forEach(e=>{E.Range.foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&E.Range.foreach(o,(e,t)=>{l.setValue(e+i,t,1)}),(0,E.queryObjectMatrix)(l,e=>1===e)})(t,e);case nN.InsertRangeMoveRightCommandId:return((e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endColumn-n.startColumn+1,s={...n,startColumn:n.startColumn,endColumn:1/0},a=E.Rectangle.subtract(t,s),o=E.Rectangle.getIntersects(s,t);if(!o)return[t];let l=new(0,E.ObjectMatrix);return a.forEach(e=>{E.Range.foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&E.Range.foreach(o,(e,t)=>{l.setValue(e,t+i,1)}),(0,E.queryObjectMatrix)(l,e=>1===e)})(t,e);case nN.InsertColCommandId:let n=t.params,i=n.range.startColumn,s=n.range.endColumn-n.range.startColumn+1;return e.startColumn>=i?[{startRow:e.startRow,endRow:e.endRow,startColumn:e.startColumn+s,endColumn:e.endColumn+s}]:e.endColumn<i?[e]:[{startRow:e.startRow,endRow:e.endRow,startColumn:e.startColumn,endColumn:e.endColumn+s}];case nN.InsertRowCommandId:let a=t.params,o=a.range.startRow,l=a.range.endRow-a.range.startRow+1;return e.startRow>=o?[{startRow:e.startRow+l,endRow:e.endRow+l,startColumn:e.startColumn,endColumn:e.endColumn}]:e.endRow<o?[e]:[{startRow:e.startRow,endRow:e.endRow+l,startColumn:e.startColumn,endColumn:e.endColumn}];case nN.MoveColsCommandId:return((e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startColumn,s=r.endColumn-r.startColumn+1,a=n.startColumn,o=new(0,E.ObjectMatrix);return E.Range.foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveColumns(i,s,a),(0,E.queryObjectMatrix)(o,e=>1===e)})(t,e);case nN.MoveRangeCommandId:return((e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s||!E.Rectangle.intersects(s,t)&&!E.Rectangle.intersects(i,t))return[t];if(E.Rectangle.contains(s,t)){let e=E.Rectangle.getRelativeRange(t,s);return[E.Rectangle.getPositionRange(e,i)]}let a=new(0,E.ObjectMatrix);E.Range.foreach(t,(e,t)=>{a.setValue(e,t,1)});let o=new(0,E.ObjectMatrix),l=E.Rectangle.getIntersects(s,t);l&&E.Range.foreach(l,(e,t)=>{a.getValue(e,t)&&(a.setValue(e,t,void 0),o.setValue(e,t,1))});let u=i.startColumn-s.startColumn,c=i.startRow-s.startRow,h={startColumn:i.startColumn-u,endColumn:i.endColumn-u,startRow:i.startRow-c,endRow:i.endRow-c};return h&&E.Range.foreach(h,(e,t)=>{var r;let n=e+c,i=t+u;a.setValue(n,i,null!=(r=o.getValue(e,t))?r:0)}),(0,E.queryObjectMatrix)(a,e=>1===e)})(t,e);case nN.MoveRowsCommandId:return((e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startRow,s=r.endRow-r.startRow+1,a=n.startRow,o=new(0,E.ObjectMatrix);return E.Range.foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveRows(i,s,a),(0,E.queryObjectMatrix)(o,e=>1===e)})(t,e);case nN.ReorderRangeCommandId:let{range:u,order:c}=t.params||{};if(!u||!c)return[e];let h=new(0,E.ObjectMatrix);E.Range.foreach(e,(e,t)=>{h.setValue(e,t,1)});let d=new(0,E.ObjectMatrix);return E.Range.foreach(u,(e,t)=>{var r;if(Object.prototype.hasOwnProperty.call(c,e)){let n=c[e],i=null!=(r=h.getValue(n,t))?r:0;d.setValue(e,t,i)}}),d.forValue((e,t,r)=>{h.setValue(e,t,r)}),(0,E.queryObjectMatrix)(h,e=>1===e);case nN.RemoveColCommandId:r=nD(t,e);break;case nN.RemoveRowCommandId:return((e,t)=>{var r;let n=null!=(r=e.ranges)?r:[e.range],i=new(0,E.ObjectMatrix);return E.Range.foreach(t,(e,t)=>{i.setValue(e,t,1)}),n.forEach(e=>{let t=e.startRow,r=e.endRow-t+1;i.removeRows(t,r)}),(0,E.queryObjectMatrix)(i,e=>1===e)})(t.params,e)}let m=nH(r,e);return m?[m]:[]},nz=(e,t,r)=>[rq.id,rQ.id,rZ.id,rJ].includes(t.id)||nq(t,r).some(t=>E.Rectangle.intersects(t,e))?nY(e,t):e;function nX(e,t){let{id:r,params:n}=t,i={length:0,step:0,type:nS.Unknown};switch(r){case nd.id:i.type=nS.Delete;break;case eb.id:(i=nw({start:n.sourceRange.startRow,end:n.sourceRange.endRow},{start:n.targetRange.startRow,end:n.targetRange.endRow},{start:e.startRow,end:e.endRow})).type=nS.VerticalMove;break;case eN.id:(i=nw({start:n.sourceRange.startColumn,end:n.sourceRange.endColumn},{start:n.targetRange.startColumn,end:n.targetRange.endColumn},{start:e.startColumn,end:e.endColumn})).type=nS.HorizontalMove;break;case eA.id:(i=nU(n.range,e))?i.type=nS.HorizontalMove:i={step:0,length:0,type:nS.Delete};break;case eS.id:(i=nU(nT(n.range),nT(e)))?i.type=nS.VerticalMove:i={step:0,length:0,type:nS.Delete};break;case eC.id:(i=nL(nT(n.range),nT(e))).type=nS.VerticalMove;break;case ey.id:(i=nL(n.range,e)).type=nS.HorizontalMove;break;case eR.id:i=function(e,t,r){let n=[];if(E.Rectangle.contains(t,r)&&n.push({type:nS.Delete}),E.Rectangle.contains(e,r)){n.push({type:nS.Delete});let i=E.Rectangle.getRelativeRange(r,e),s=E.Rectangle.getPositionRange(i,t);return[{type:nS.Set,range:s}]}return n}(n.fromRange||new(0,E.ObjectMatrix)(n.from).getRange(),n.toRange||new(0,E.ObjectMatrix)(n.to).getRange(),e)}return i?Array.isArray(i)?nH(i,e):nH([i],e):e}function nq(e,t){var r,n,i,s,a,o;let{selectionManagerService:l}=t;switch(e.id){case nN.MoveColsCommandId:{let t=e.params;return[t.fromRange,{...t.toRange,startColumn:t.toRange.startColumn-.5,endColumn:t.toRange.endColumn-.5}]}case nN.MoveRowsCommandId:{let t=e.params;return[t.fromRange,{...t.toRange,startRow:t.toRange.startRow-.5,endRow:t.toRange.startRow-.5}]}case nN.MoveRangeCommandId:return[e.params.fromRange,e.params.toRange];case nN.InsertRowCommandId:{let t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.endRow-.5}]}case nN.InsertColCommandId:{let t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.endColumn-.5}]}case nN.RemoveRowCommandId:case nN.RemoveColCommandId:return[e.params.range];case nN.DeleteRangeMoveUpCommandId:case nN.InsertRangeMoveDownCommandId:{let t=(null==(r=e.params)?void 0:r.range)||(null==(i=null==(n=l.getCurrentSelections())?void 0:n.map(e=>e.range))?void 0:i[0]);return t?[t]:[]}case nN.DeleteRangeMoveLeftCommandId:case nN.InsertRangeMoveRightCommandId:{let t=(null==(s=e.params)?void 0:s.range)||(null==(o=null==(a=l.getCurrentSelections())?void 0:a.map(e=>e.range))?void 0:o[0]);return t?[t]:[]}case nN.ReorderRangeCommandId:{let{range:t,order:r}=e.params,n=[];for(let e=t.startRow;e<=t.endRow;e++)e in r&&n.push({startRow:e,endRow:e,startColumn:t.startColumn,endColumn:t.endColumn});return n}}}function nK(e,t){var r,n,i,s,a,o;let l=e.get(E.IUniverInstanceService),u=e.get(tL);switch(t.id){case nN.MoveColsCommandId:{let e=t.params,r=ec(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startColumn:e.fromRange.startColumn<e.toRange.startColumn?e.fromRange.endColumn+1:e.toRange.startColumn,endColumn:e.fromRange.startColumn<e.toRange.startColumn?e.toRange.endColumn-1:e.fromRange.startColumn-1}]}}case nN.MoveRowsCommandId:{let e=t.params,r=ec(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startRow:e.fromRange.startRow<e.toRange.startRow?e.fromRange.endRow+1:e.toRange.startRow,endRow:e.fromRange.startRow<e.toRange.startRow?e.toRange.endRow-1:e.fromRange.startRow-1}]}}case nN.MoveRangeCommandId:{let e=t.params,r=ec(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,e.toRange]}}case nN.InsertRowCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startRow>0?[{...r,startRow:r.startRow-1,endRow:r.endRow-1}]:[],{...r,startRow:r.startRow,endRow:Number.MAX_SAFE_INTEGER}]}}case nN.InsertColCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startColumn>0?[{...r,startColumn:r.startColumn-1,endColumn:r.endColumn-1}]:[],{...r,startColumn:r.startColumn,endColumn:Number.MAX_SAFE_INTEGER}]}}case nN.RemoveRowCommandId:{let e=t.params.range,r=ec(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startRow:e.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}}case nN.RemoveColCommandId:{let e=t.params.range,r=ec(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}}case nN.DeleteRangeMoveUpCommandId:case nN.InsertRangeMoveDownCommandId:{let e=ec(l),s=(null==(r=t.params)?void 0:r.range)||(null==(i=null==(n=u.getCurrentSelections())?void 0:n.map(e=>e.range))?void 0:i[0]);return s?{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[s,{...s,startRow:s.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}:{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[]}}case nN.DeleteRangeMoveLeftCommandId:case nN.InsertRangeMoveRightCommandId:{let e=(null==(s=t.params)?void 0:s.range)||(null==(o=null==(a=u.getCurrentSelections())?void 0:a.map(e=>e.range))?void 0:o[0]),r=ec(l);return e?{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}:{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[]}}case nN.ReorderRangeCommandId:{let{range:e,order:r}=t.params,n=[];for(let t=e.startRow;t<=e.endRow;t++)t in r&&n.push({startRow:t,endRow:t,startColumn:e.startColumn,endColumn:e.endColumn});let i=ec(l);return{unitId:i.unitId,subUnitId:i.subUnitId,ranges:n}}}}var nQ=Object.getOwnPropertyDescriptor,nZ=(e,t)=>(r,n)=>t(r,n,e);let nJ=(0,E.createInterceptorKey)("MERGE_REDO"),n0=(0,E.createInterceptorKey)("MERGE_UNDO"),n1=Math.floor(Number.MAX_SAFE_INTEGER/10);class n2 extends E.Disposable{constructor(e,t,r,n,i=!1){super(),this._unitId=e,this._subUnitId=t,this._range=r,this._callback=n,this._skipIntersects=i}onMutation(e){var t,r;if((null==(t=e.params)?void 0:t.unitId)!==this._unitId)return;if(e.id===eR.id){let t=e.params;if(t.from.subUnitId!==this._subUnitId||t.to.subUnitId!==this._subUnitId)return}else if((null==(r=e.params)?void 0:r.subUnitId)!==this._subUnitId)return;if(!this._range)return;if(this._skipIntersects){if(e.id===nd.id)return;let t=function(e){switch(e.id){case eN.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startColumn:t.targetRange.startColumn-.5,endColumn:t.targetRange.startColumn-.5}]}case eb.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startRow:t.targetRange.startRow-.5,endRow:t.targetRange.startRow-.5}]}case eR.id:{let t=e.params;return[new(0,E.ObjectMatrix)(t.from.value).getRange(),new(0,E.ObjectMatrix)(t.to.value).getRange()]}case ey.id:{let t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.startColumn-.5}]}case eC.id:{let t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.startRow-.5}]}case eA.id:case eS.id:return[e.params.range]}}(e);if(null!=t&&t.some(e=>E.Rectangle.intersects(e,this._range)))return}let n=nX(this._range,e);if(n&&E.Rectangle.equals(n,this._range))return!1;let i=this._range;this._range=n,this._callback(i,n)}}let n5=class extends E.Disposable{constructor(e,t,r,n){super(),k(this,"interceptor",new(0,E.InterceptorManager)({MERGE_REDO:nJ,MERGE_UNDO:n0})),k(this,"_watchRanges",new Set),k(this,"_refRangeManagerMap",new Map),k(this,"_serializer",function(){let e=["startRow","startColumn","endRow","endColumn","rangeType"];return{deserialize:t=>{let r=e.reduce((e,t,r)=>(e[String(r)]=t,e),{});return t.split("_").reduce((e,t,n)=>{let i=String(n);return t&&r[i]&&(e[r[i]]=t),e},{})},serialize:t=>e.reduce((e,r,n)=>{let i=t[r];return void 0!==i?`${e}${n>0?"_":""}${i}`:`${e}`},"")}}()),k(this,"_onRefRangeChange",()=>{this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET).getActiveSheet(),r=n3(this._univerInstanceService),n=n4(this._univerInstanceService);if(!t||!r||!n)return{redos:[],undos:[],preRedos:[],preUndos:[]};let i=((()=>{switch(e.id){case nN.MoveColsCommandId:{let i=e.params,s=Math.min(i.fromRange.startColumn,i.toRange.startColumn);return this._checkRange([{...i.fromRange,startColumn:s,endColumn:t.getColumnCount()-1}],r,n)}case nN.MoveRowsCommandId:{let i=e.params,s=Math.min(i.fromRange.startRow,i.toRange.startRow);return this._checkRange([{...i.fromRange,startRow:s,endRow:t.getRowCount()-1}],r,n)}case nN.MoveRangeCommandId:return this._checkRange([e.params.fromRange,e.params.toRange],r,n);case nN.InsertRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:E.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case nN.InsertColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:E.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case nN.RemoveRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:E.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case nN.RemoveColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:E.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case nN.DeleteRangeMoveUpCommandId:case nN.InsertRangeMoveDownCommandId:{let t=e.params.range||n6(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:t.endColumn,endRow:n1};return this._checkRange([i],r,n)}case nN.DeleteRangeMoveLeftCommandId:case nN.InsertRangeMoveRightCommandId:{let t=e.params.range||n6(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:n1,endRow:t.endRow};return this._checkRange([i],r,n)}case nN.ReorderRangeCommandId:{let{range:t,order:i}=e.params,s=[];for(let e=t.startRow;e<=t.endRow;e++)e in i&&s.push({startRow:e,endRow:e,startColumn:t.startColumn,endColumn:t.endColumn});return this._checkRange(s,r,n)}}})()||[]).reduce((t,r)=>{let n=r(e);return t.push(n),t},[]).reduce((e,t)=>{var r,n;return e.redos.push(...t.redos),e.undos.push(...t.undos),e.preRedos.push(...null!=(r=t.preRedos)?r:[]),e.preUndos.push(...null!=(n=t.preUndos)?n:[]),e},{redos:[],undos:[],preUndos:[],preRedos:[]}),s=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.preRedos,null)||[],a=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.redos,null)||[],o=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.preUndos,null)||[];return{redos:a,undos:this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.undos,null)||[],preRedos:s,preUndos:o}}})}),k(this,"_checkRange",(e,t,r)=>{var n,i;let s=(n=t,i=r,`${n}_${i}`),a=this._refRangeManagerMap.get(s);if(a){let t=new Set;return[...a.keys()].forEach(r=>{let n=a.get(r),i=this._serializer.deserialize(r),s={...i,startRow:+i.startRow,endRow:+i.endRow,startColumn:+i.startColumn,endColumn:+i.endColumn,rangeType:i.rangeType&&+i.rangeType};e.some(e=>E.Rectangle.intersects(e,s))&&n&&n.forEach(e=>{t.add(e)})}),[...t]}return[]}),k(this,"registerRefRange",(e,t,r,n)=>{var i,s;let a=r||n3(this._univerInstanceService),o=n||n4(this._univerInstanceService);if(!a||!o)return(0,E.toDisposable)(()=>{});let l=(i=a,s=o,`${i}_${s}`),u=this._serializer.serialize(e),c=this._refRangeManagerMap.get(l);c||(c=new Map,this._refRangeManagerMap.set(l,c));let h=c.get(u);return h?h.add(t):c.set(u,new Set([t])),(0,E.toDisposable)(()=>{let e=c.get(u);e&&(e.delete(t),e.size||(c.delete(u),c.size||this._refRangeManagerMap.delete(l)))})}),this._commandService=e,this._sheetInterceptorService=t,this._univerInstanceService=r,this._selectionManagerService=n,this._onRefRangeChange(),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_REDO,{priority:-1,handler:e=>e}),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_UNDO,{priority:-1,handler:e=>e})}watchRange(e,t,r,n,i){let s;0===this._watchRanges.size&&(s=this._commandService.onCommandExecuted(e=>{if(e.type!==E.CommandType.MUTATION)return!1;for(let t of this._watchRanges)t.onMutation(e)}));let a=new n2(e,t,r,n,i);this._watchRanges.add(a);let o=(0,E.toDisposable)(()=>{this._watchRanges.delete(a),0===this._watchRanges.size&&(null==s||s.dispose(),s=null)}),l=this.disposeWithMe(o);return(0,E.toDisposable)(()=>{l.dispose(),o.dispose()})}};function n3(e){return e.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET).getUnitId()}function n4(e){var t;return null==(t=e.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET).getActiveSheet())?void 0:t.getSheetId()}function n6(e){var t;return(null==(t=e.getCurrentSelections())?void 0:t.map(e=>e.range))||[]}n5=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?nQ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([nZ(0,E.ICommandService),nZ(1,(0,b.Inject)(Q)),nZ(2,(0,b.Inject)(E.IUniverInstanceService)),nZ(3,(0,b.Inject)(tL))],n5);var n9=Object.getOwnPropertyDescriptor,n8=(e,t)=>(r,n)=>t(r,n,e);let n7=[ey.id,eC.id,eA.id,eS.id],ie=[eb.id,eN.id];function it(e,t){let r=e;if(void 0!==t){let e=[];for(let n=0;n<r.length;n++){let{startRow:i,endRow:s,startColumn:a,endColumn:o}=r[n];if(t===E.Dimension.ROWS)for(let t=i;t<=s;t++){let r={startRow:t,endRow:t,startColumn:a,endColumn:o};e.push(r)}else if(t===E.Dimension.COLUMNS)for(let t=a;t<=o;t++){let r={startRow:i,endRow:s,startColumn:t,endColumn:t};e.push(r)}}r=e}return r}let ir=(0,E.createInterceptorKey)("mergeCellPermissionCheck"),ii=class extends E.Disposable{constructor(e,t,r,n,i,s){super(),k(this,"disposableCollection",new(0,E.DisposableCollection)),k(this,"interceptor",new(0,E.InterceptorManager)({MERGE_CELL_INTERCEPTOR_CHECK:ir})),this._commandService=e,this._refRangeService=t,this._univerInstanceService=r,this._injector=n,this._sheetInterceptorService=i,this._selectionManagerService=s,this._onRefRangeChange(),this._initCommandInterceptor(),this._commandExecutedListener()}_initCommandInterceptor(){let e=this;this._sheetInterceptorService.interceptCommand({getMutations(t){var r;switch(t.id){case tj.id:case tB.id:{let t=e._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET),n=t.getUnitId(),i=null==t?void 0:t.getActiveSheet();if(!i)return{redos:[],undos:[]};let s=i.getSheetId(),a=i.getConfig().mergeData,o=null==(r=e._selectionManagerService.getCurrentSelections())?void 0:r.map(e=>e.range);if(o&&o.length>0&&o.some(e=>a.some(t=>E.Rectangle.intersects(t,e)))){let t={unitId:n,subUnitId:s,ranges:o},r=ev(e._injector,t);return{redos:[{id:eT.id,params:t}],undos:[{id:$.id,params:r}]}}}}return{redos:[],undos:[]}}}),this._sheetInterceptorService.interceptRanges({getMutations:({unitId:e,subUnitId:t,ranges:r})=>{let n=[],i=[],s={redos:n,undos:i};if(!r||!r.length)return s;let a=ec(this._univerInstanceService,{unitId:e,subUnitId:t});if(!a)return s;let{worksheet:o}=a,l=o.getMergeData().filter(e=>r.some(t=>E.Rectangle.intersects(e,t)));return l.length?(n.push({id:eT.id,params:{unitId:e,subUnitId:t,ranges:l}}),i.push({id:$.id,params:{unitId:e,subUnitId:t,ranges:l}}),{undos:i,redos:n}):s}})}refRangeHandle(e,t,r){switch(e.id){case nN.MoveColsCommandId:{let n=e.params;return this._handleMoveColsCommand(n,t,r)}case nN.MoveRowsCommandId:{let n=e.params;return this._handleMoveRowsCommand(n,t,r)}case r2.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertRowCommand(n,i,s)}case r7.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertColCommand(n,i,s)}case nc.id:{let n=e.params;return this._handleRemoveColCommand(n,t,r)}case no.id:{let n=e.params;return this._handleRemoveRowCommand(n,t,r)}case t5.id:{let n=e.params;return this._handleMoveRangeCommand(n,t,r)}case r0.id:{let n=e.params;return this._handleInsertRangeMoveRightCommand(n,t,r)}case rZ.id:{let n=e.params;return this._handleInsertRangeMoveDownCommand(n,t,r)}case rQ.id:{let n=e.params;return this._handleDeleteRangeMoveUpCommand(n,t,r)}case rq.id:{let n=e.params;return this._handleDeleteRangeMoveLeftCommand(n,t,r)}}return{redos:[],undos:[]}}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getUniverSheetInstance(e);if(!r)return;let n=null==r?void 0:r.getSheetBySheetId(t);if(!n)return;this.disposableCollection.dispose();let i=n.getMergeData(),s=r=>this.refRangeHandle(r,e,t);i.forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,s,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===e6.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}if(t.id===$.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(r.unitId,r.subUnitId)}})),this._univerInstanceService.getCurrentTypeOfUnit$(E.UniverInstanceType.UNIVER_SHEET).pipe((0,A.first)(e=>!!e)).subscribe(t=>{let r=t.getActiveSheet();r&&e(t.getUnitId(),r.getSheetId())})}_handleMoveRowsCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startRow:u,endRow:c}=l;if(s.forEach(t=>{if(u<=t.startRow&&c>=t.endRow){a.ranges.push(t);let r=nH(nM({id:nN.MoveRowsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=ev(this._injector,a),d=B(this._injector,o);return{preRedos:[{id:eT.id,params:a}],redos:[{id:$.id,params:o}],preUndos:[{id:eT.id,params:d}],undos:[{id:$.id,params:h}]}}_handleMoveColsCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startColumn:u,endColumn:c}=l;if(s.forEach(t=>{if(u<=t.startColumn&&c>=t.endColumn){a.ranges.push(t);let r=nH(nO({id:nN.MoveColsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=ev(this._injector,a),d=B(this._injector,o);return{preRedos:[{id:eT.id,params:a}],redos:[{id:$.id,params:o}],preUndos:[{id:eT.id,params:d}],undos:[{id:$.id,params:h}]}}_handleMoveRangeCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=i.getMergeData(),a=s.filter(t=>E.Rectangle.intersects(t,e.fromRange)),o=s.filter(t=>E.Rectangle.intersects(t,e.toRange)),l=it(a.map(t=>E.Rectangle.getRelativeRange(t,e.fromRange)).map(t=>E.Rectangle.getPositionRange(t,e.toRange))).filter(e=>!s.some(t=>E.Rectangle.equals(e,t)));return{redos:[{id:eT.id,params:{unitId:t,subUnitId:r,ranges:a}},{id:eT.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:$.id,params:{unitId:t,subUnitId:r,ranges:l}}],undos:[{id:eT.id,params:{unitId:t,subUnitId:r,ranges:l}},{id:$.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:$.id,params:{unitId:t,subUnitId:r,ranges:a}}]}}_handleInsertRowCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let{range:s}=e,{startRow:a,endRow:o}=s,l=E.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=E.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&(t.endRow+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d);return{redos:[{id:eT.id,params:c},{id:$.id,params:d}],undos:[{id:eT.id,params:m},{id:$.id,params:h}]}}_handleInsertColCommand(e,t,r){let{range:n}=e,i=is(this._univerInstanceService,t);if(!i)return this._handleNull();let s=ia(i,r);if(!s)return this._handleNull();let{startColumn:a,endColumn:o}=n,l=E.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=E.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&(t.endColumn+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d);return{redos:[{id:eT.id,params:c},{id:$.id,params:d}],undos:[{id:eT.id,params:m},{id:$.id,params:h}]}}_handleRemoveColCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let{range:s}=e,{startColumn:a,endColumn:o}=s,l=E.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(E.Rectangle.intersects(s,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=E.Tools.deepClone(i.getMergeData()).reduce((e,t)=>{if(E.Rectangle.intersects(s,t)){if(a<=t.startColumn&&o>=t.endColumn)return e;a>=t.startColumn&&o<=t.endColumn?t.endColumn-=o-a+1:a<t.startColumn?(t.startColumn=a,t.endColumn-=o-a+1):o>t.endColumn&&(t.endColumn=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d),g=[{id:eT.id,params:c}],f=[{id:$.id,params:d}];return{preUndos:[{id:eT.id,params:m}],undos:[{id:$.id,params:h}],preRedos:g,redos:f}}_handleRemoveRowCommand(e,t,r){let{range:n}=e,i=is(this._univerInstanceService,t);if(!i)return this._handleNull();let s=ia(i,r);if(!s)return this._handleNull();let{startRow:a,endRow:o}=n,l=E.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(E.Rectangle.intersects(n,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=E.Tools.deepClone(s.getMergeData()).reduce((e,t)=>{if(E.Rectangle.intersects(n,t)){if(a<=t.startRow&&o>=t.endRow)return e;a>=t.startRow&&o<=t.endRow?t.endRow-=o-a+1:a<t.startRow?(t.startRow=a,t.endRow-=o-a+1):o>t.endRow&&(t.endRow=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d),g=[{id:eT.id,params:c}],f=[{id:$.id,params:d}];return{preUndos:[{id:eT.id,params:m}],undos:[{id:$.id,params:h}],preRedos:g,redos:f}}_handleInsertRangeMoveRightCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if(E.Rectangle.intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),E.Rectangle.contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn+t,endRow:e.endRow,endColumn:e.endColumn+t})}});let c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d);return{preRedos:[{id:eT.id,params:c}],redos:[{id:$.id,params:d}],preUndos:[{id:eT.id,params:m}],undos:[{id:$.id,params:h}]}}_handleInsertRangeMoveDownCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if(E.Rectangle.intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),E.Rectangle.contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1;u.push({startRow:e.startRow+r,startColumn:e.startColumn,endRow:e.endRow+r,endColumn:e.endColumn})}});let c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d),g=[{id:eT.id,params:c}],f=[{id:$.id,params:d}],p=[{id:eT.id,params:m}];return{redos:f,undos:[{id:$.id,params:h}],preRedos:g,preUndos:p}}_handleDeleteRangeMoveUpCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if(E.Rectangle.intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),E.Rectangle.contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1,n=E.Rectangle.moveVertical(e,-r);u.push(n)}});let c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d),g=[{id:eT.id,params:c}],f=[{id:$.id,params:d}],p=[{id:eT.id,params:m}];return{redos:f,undos:[{id:$.id,params:h}],preRedos:g,preUndos:p}}_handleDeleteRangeMoveLeftCommand(e,t,r){let n=is(this._univerInstanceService,t);if(!n)return this._handleNull();let i=ia(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if(E.Rectangle.intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),E.Rectangle.contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn-t,endRow:e.endRow,endColumn:e.endColumn-t})}});let c={unitId:t,subUnitId:r,ranges:l},h=ev(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=B(this._injector,d);return{preRedos:[{id:eT.id,params:c}],redos:[{id:$.id,params:d}],undos:[{id:$.id,params:h}],preUndos:[{id:eT.id,params:m}]}}_checkIsMergeCell(e){return e.startRow!==e.endRow||e.startColumn!==e.endColumn}_handleNull(){return{redos:[],undos:[]}}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(ie.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn,u=r.getConfig().mergeData,c=[];u.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h}=e;E.Rectangle.intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),e.startRow===e.endRow&&e.startColumn===e.endColumn||c.push({startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h})}),r.setMergeData(c),this.disposableCollection.dispose();let{unitId:h,subUnitId:d}=e.params,m=e=>this.refRangeHandle(e,h,d);c.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,m,h,d))})}if(n7.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=r.getConfig().mergeData,i=e.params;if(!i)return;let{range:s}=i,a=e.id.includes("row"),o=e.id.includes("insert"),l=a?s.startRow:s.startColumn,u=a?s.endRow:s.endColumn,c=u-l+1,h=[];n.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s}=e;o?a?l<=t&&(t+=c,r+=c):l<=n&&(n+=c,i+=c):a?u<t&&(t-=c,r-=c):u<n&&(n-=c,i-=c),e.startRow===e.endRow&&e.startColumn===e.endColumn||h.push({startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s})}),r.setMergeData(h),this.disposableCollection.dispose();let{unitId:d,subUnitId:m}=e.params,g=e=>this.refRangeHandle(e,d,m);h.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,g,d,m))})}}))}};function is(e,t){return t?e.getUniverSheetInstance(t):e.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET)}function ia(e,t){return t?e.getSheetBySheetId(t):e.getActiveSheet()}ii=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?n9(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([n8(0,(0,b.Inject)(E.ICommandService)),n8(1,(0,b.Inject)(n5)),n8(2,(0,b.Inject)(E.IUniverInstanceService)),n8(3,(0,b.Inject)(b.Injector)),n8(4,(0,b.Inject)(Q)),n8(5,(0,b.Inject)(tL))],ii);let io={type:E.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=e.get(E.IUniverInstanceService),s=t.unitId,a=t.subUnitId,o=it(t.selections,t.value),l=i.getUniverSheetInstance(s).getSheetBySheetId(a),u=[],c=[],h=o.some(e=>(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i),o=!1;return a.forValue((t,i,s)=>{if(s&&(t!==r||i!==n)&&e.cellHasValue(s))return o=!0,!1}),o})(l,e)),d={unitId:s,subUnitId:a,ranges:o},m={unitId:s,subUnitId:a,ranges:o};u.push({id:eT.id,params:d}),u.push({id:$.id,params:m});let g=ev(e,d),f=B(e,m);if(c.push({id:eT.id,params:f}),c.push({id:$.id,params:g}),h){let t=function(e,t,r,n){let i=[],s=[],a=r.getSheetId();return n.forEach(n=>{let o={unitId:t,subUnitId:a,cellValue:(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i,E.CellModeEnum.Raw),o=new(0,E.ObjectMatrix);return a.forValue((e,t,i)=>{i&&(e!==r||t!==n)&&o.setValue(e,t,null)}),o})(r,n).getData()},l=ek(e,o);i.push({id:eF.id,params:l}),s.push({id:eF.id,params:o})}),{undos:i,redos:s}}(e,s,l,o);u.unshift(...t.redos),c.push(...t.undos)}return!!(0,E.sequenceExecute)(u,r).result&&(n.pushUndoRedo({unitID:s,undoMutations:c,redoMutations:u}),!0)}},il={type:E.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-all",handler:async e=>{var t;let r=e.get(E.ICommandService),n=null==(t=e.get(tL).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(E.IUniverInstanceService).getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(io.id,{selections:n,unitId:a,subUnitId:o})}},iu={type:E.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-vertical",handler:async e=>{var t;let r=e.get(E.ICommandService),n=null==(t=e.get(tL).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(E.IUniverInstanceService).getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(io.id,{value:E.Dimension.COLUMNS,selections:n,unitId:a,subUnitId:o})}},ic={type:E.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-horizontal",handler:async e=>{var t;let r=e.get(E.ICommandService),n=null==(t=e.get(tL).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(E.IUniverInstanceService).getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(io.id,{value:E.Dimension.ROWS,selections:n,unitId:a,subUnitId:o})}};function ih(e,t,r,n,i){let s=ec(e.get(E.IUniverInstanceService),{unitId:t,subUnitId:r});if(!s)return;let{worksheet:a}=s;if(a.getMergeData().some(e=>n.some(t=>E.Rectangle.intersects(t,e))))throw Error("The ranges to be merged overlap with the existing merged cells");e.get(E.ICommandService).executeCommand(io.id,{unitId:t,subUnitId:r,selections:n,defaultMerge:i})}class id{constructor(){k(this,"_model",new Map),k(this,"_ruleChange",new(0,x.Subject)),k(this,"_ruleRefresh",new(0,x.Subject)),k(this,"_resetOrder",new(0,x.Subject)),k(this,"ruleChange$",this._ruleChange.asObservable()),k(this,"ruleRefresh$",this._ruleRefresh.asObservable()),k(this,"resetOrder$",this._resetOrder.asObservable()),k(this,"_worksheetRuleInitStateChange",new(0,I.BehaviorSubject)(!1)),k(this,"worksheetRuleInitStateChange$",this._worksheetRuleInitStateChange.asObservable())}changeRuleInitState(e){this._worksheetRuleInitStateChange.next(e)}getSheetRuleInitState(){return this._worksheetRuleInitStateChange.value}addRule(e,t){this._ensureSubUnitMap(e).set(t.subUnitId,t),this._ruleChange.next({unitId:e,rule:t,type:"add",subUnitId:t.subUnitId})}deleteRule(e,t){var r,n,i;let s=null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t);s&&(null==(i=this._model.get(e))||i.delete(t),this._ruleChange.next({unitId:e,rule:s,type:"delete",subUnitId:t}))}setRule(e,t,r){var n,i;let s=this.getRule(e,t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.set(t,r),this._ruleChange.next({unitId:e,oldRule:s,rule:r,type:"set",subUnitId:t}))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=new Map,this._model.set(e,t)),t}ruleRefresh(e){this._ruleRefresh.next(e)}resetOrder(){this._resetOrder.next(Math.random())}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}let im={id:"sheet.mutation.add-worksheet-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,rule:n}=t;return e.get(id).addRule(r,n),!0}},ig={id:"sheet.mutation.delete-worksheet-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n}=t;return e.get(id).deleteRule(r,n),!0}},ip={type:E.CommandType.COMMAND,id:"sheet.command.add-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{rule:i,unitId:s}=t,a=i.subUnitId;if(await r.executeCommand(im.id,{unitId:s,rule:i,subUnitId:i.subUnitId})){let e=[{id:im.id,params:{unitId:s,rule:i,subUnitId:i.subUnitId}}],t=[{id:ig.id,params:{unitId:s,subUnitId:a}}];n.pushUndoRedo({unitID:s,redoMutations:e,undoMutations:t})}return!0}},iC={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-range-theme-style",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{unitId:i}=t,s=em(e,t);return!!r.syncExecuteCommand(ed.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:eg.id,params:s}],redoMutations:[{id:ed.id,params:t}]}),!0)}},i_={type:E.CommandType.COMMAND,id:"sheet.command.append-row",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{unitId:i,subUnitId:s,cellValue:a,insertRowNums:o,insertColumnNums:l,maxRows:u,maxColumns:c}=t,h={unitId:i,subUnitId:s,cellValue:a},d=ek(e,h),m=[{id:eF.id,params:h}],g=[{id:eF.id,params:d}];if(o){let t={unitId:i,subUnitId:s,range:{startRow:u,endRow:u,startColumn:0,endColumn:c-1}},r=ep(e,t);m.unshift({id:eC.id,params:t}),g.push({id:eS.id,params:r})}if(l){let t={unitId:i,subUnitId:s,range:{startRow:0,endRow:u-1,startColumn:c,endColumn:c-1+l}},r=e_(e,t);m.unshift({id:ey.id,params:t}),g.push({id:eA.id,params:r})}return!!(0,E.sequenceExecute)(m,r).result&&(n.pushUndoRedo({unitID:i,undoMutations:g,redoMutations:m}),!0)}},iy={id:"sheet.command.clear-selection-content",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(E.IUniverInstanceService),i=e.get(E.ICommandService),s=e.get(tL),a=e.get(E.IUndoRedoService),o=e.get(Q),l=n.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=tN(d,e,u,h),g={subUnitId:h,unitId:u,cellValue:tb(m)},f=ek(e,g),p=o.onCommandExecute({id:iy.id}),C=[{id:eF.id,params:g},...p.redos],_=[...p.undos,{id:eF.id,params:f}];return!!(0,E.sequenceExecute)(C,i).result&&(a.pushUndoRedo({unitID:u,undoMutations:_,redoMutations:C}),!0)}},iR=(e,t)=>({subUnitId:t.sheet.id,unitId:t.unitId,subUnitName:t.sheet.name}),iE={id:"sheet.mutation.insert-sheet",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService),{sheet:n,index:i,unitId:s}=t,a=r.getUniverSheetInstance(s);return!!a&&a.addWorksheet(n.id,i,n)}},ib={type:E.CommandType.COMMAND,id:"sheet.command.copy-sheet",handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService),o=e.get(Q),l=e.get(E.LocaleService),u=ec(a,t);if(!u)return!1;let{workbook:c,worksheet:h,unitId:d,subUnitId:m}=u,g=E.Tools.deepClone(h.getConfig());g.name=function(e,t,r){let n=r+t.t("sheets.tabs.sheetCopy",""),i=2;for(;e.checkSheetName(n);)n=r+t.t("sheets.tabs.sheetCopy",`${i}`),i++;return n}(c,l,g.name),g.id=(0,E.generateRandomId)();let f={index:c.getSheetIndex(h)+1,sheet:g,unitId:d},p=iR(e,f),C=o.onCommandExecute({id:ib.id,params:{unitId:d,subUnitId:m,targetSubUnitId:g.id}}),_=[...null!=(r=C.preRedos)?r:[],{id:iE.id,params:f},...C.redos],y=[...null!=(n=C.preUndos)?n:[],{id:nd.id,params:p},...C.undos];return!!(0,E.sequenceExecute)(_,i).result&&(s.pushUndoRedo({unitID:d,undoMutations:y,redoMutations:_}),!0)}},iI={type:E.CommandType.COMMAND,id:"sheet.command.delete-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{unitId:i,subUnitId:s,rule:a}=t,o={unitId:i,subUnitId:s,ruleIds:[a.id]};return await r.executeCommand(tw.id,o)&&n.pushUndoRedo({unitID:i,redoMutations:[{id:tw.id,params:o}],undoMutations:[{id:tO.id,params:{unitId:i,subUnitId:s,rules:[a]}}]}),!0}},iN={type:E.CommandType.COMMAND,id:"sheet.command.delete-worksheet-protection",handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{rule:i,unitId:s,subUnitId:a}=t;r.executeCommand(ig.id,{unitId:s,subUnitId:a});let o=[{id:ig.id,params:{unitId:s,subUnitId:a}}],l=[{id:im.id,params:{unitId:s,rule:i,subUnitId:a}}];return n.pushUndoRedo({unitID:s,redoMutations:o,undoMutations:l}),!0}},iS={type:E.CommandType.COMMAND,id:"sheet.command.remove-worksheet-range-theme-style",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{unitId:i}=t,s=ef(e,t);return!!r.syncExecuteCommand(eg.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:ed.id,params:s}],redoMutations:[{id:eg.id,params:t}]}),!0)}},iA={id:"sheet.command.insert-defined-name",type:E.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService);if(!t)return!1;let i={...t};return!!r.syncExecuteCommand(V.SetDefinedNameMutation.id,i)&&(n.pushUndoRedo({unitID:t.unitId,undoMutations:[{id:V.RemoveDefinedNameMutation.id,params:i}],redoMutations:[{id:V.SetDefinedNameMutation.id,params:i}]}),!0)}},iv={id:"sheet.command.insert-sheet",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(E.ICommandService),i=e.get(E.IUndoRedoService),s=e.get(E.IUniverInstanceService),a=e.get(E.LocaleService),o=eu(s,{unitId:null==t?void 0:t.unitId});if(!o)return!1;let{unitId:l,workbook:u}=o,c=u.getSheets().length,h=null==t?void 0:t.sheet,d=null==h?void 0:h.id,m=(0,E.mergeWorksheetSnapshotWithDefault)(h||{});t?(c=null!=(r=t.index)?r:c,m.id=d||(0,E.generateRandomId)(),m.name=(null==h?void 0:h.name)||u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`)):(m.id=(0,E.generateRandomId)(),m.name=u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`));let g={index:c,sheet:m,unitId:l},f=iR(e,g);return!!n.syncExecuteCommand(iE.id,g)&&(i.pushUndoRedo({unitID:l,undoMutations:[{id:nd.id,params:f}],redoMutations:[{id:iE.id,params:g}]}),!0)}},iT={id:"sheet.mutation.register-worksheet-range-theme-style",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,rangeThemeStyleJson:n,themeName:i}=t,s=ec(e.get(E.IUniverInstanceService)),a=e.get(el);if(!s)return!1;let o=new ee(i,n);return a.registerRangeThemeStyle(r,o),!0}},iw={id:"sheet.mutation.unregister-worksheet-range-theme-style",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,themeName:n}=t,i=ec(e.get(E.IUniverInstanceService)),s=e.get(el);return!!i&&(s.unregisterRangeThemeStyle(r,n),!0)}},iM={id:"sheet.command.register-worksheet-range-theme-style",type:E.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,rangeThemeStyle:n}=t,i=e.get(E.IUniverInstanceService),s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService);if(!ec(i))return!1;let o={unitId:r,themeName:n.getName(),rangeThemeStyleJson:n.toJson()},l={unitId:r,themeName:n.getName()};return s.syncExecuteCommand(iT.id,o)&&a.pushUndoRedo({unitID:r,undoMutations:[{id:iw.id,params:l}],redoMutations:[{id:iT.id,params:o}]}),!0}},iO={id:"sheet.command.remove-defined-name",type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(Q);if(!t)return!1;let o={...t},l=a.onCommandExecute({id:iO.id,params:t}),u=[...null!=(r=l.preRedos)?r:[],{id:V.RemoveDefinedNameMutation.id,params:o},...l.redos],c=[...null!=(n=l.preUndos)?n:[],{id:V.SetDefinedNameMutation.id,params:o},...l.undos];return!!(0,E.sequenceExecute)(u,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:c.filter(Boolean),redoMutations:u.filter(Boolean)}),!0)}},ix={id:"sheet.command.remove-sheet",type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService),o=e.get(Q),l=ec(a,t);if(!l)return!1;let{unitId:u,subUnitId:c,workbook:h,worksheet:d}=l;if(h.getSheets().length<=1)return!1;let m={subUnitId:c,unitId:u,subUnitName:d.getName()},g=nh(e,m),f=o.onCommandExecute({id:ix.id,params:{unitId:u,subUnitId:c}}),p=[...null!=(r=f.preRedos)?r:[],{id:nd.id,params:m},...f.redos],C=[...null!=(n=f.preUndos)?n:[],{id:iE.id,params:g},...f.undos];return!!(0,E.sequenceExecute)(p,i).result&&(s.pushUndoRedo({unitID:u,undoMutations:C,redoMutations:p}),!0)}},iU={type:E.CommandType.COMMAND,id:"sheet.command.remove-worksheet-merge",handler:(e,t)=>{var r;let n=e.get(tL),i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService),o=(null==t?void 0:t.ranges)||(null==(r=n.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=o&&o.length))return!1;let l=ec(a);if(!l)return!1;let{subUnitId:u,unitId:c,worksheet:h}=l,d=h.getConfig().mergeData.filter(e=>o.some(t=>E.Rectangle.intersects(t,e)));if(!d.length)return!1;let m=ev(e,{unitId:c,subUnitId:u,ranges:o}),g=n.getCurrentSelections();if(!(null!=g&&g.length))return!1;let f=E.Tools.deepClone(g),p=E.Tools.deepClone(g),C=p[p.length-1],{startRow:_,startColumn:y}=C.range;C.primary={startRow:_,startColumn:y,endRow:_,endColumn:y,actualRow:_,actualColumn:y,isMerged:!1,isMergedMainCell:!1};let R=function(e,t){let r=new(0,E.ObjectMatrix),n=new(0,E.ObjectMatrix);return t.forEach(t=>{let{startRow:i,startColumn:s,endColumn:a,endRow:o}=t,l=e.getCellMatrix().getValue(i,s);if(null!=l&&l.s)for(let e=i;e<=o;e++)for(let t=s;t<=a;t++)(e!==i||t!==s)&&(r.setValue(e,t,{s:l.s}),n.setValue(e,t,null))}),{redoParams:r,undoParams:n}}(h,d),b={unitId:c,subUnitId:u,cellValue:R.redoParams.getMatrix()},I={unitId:c,subUnitId:u,cellValue:R.undoParams.getMatrix()},N=[{id:eT.id,params:m},{id:eF.id,params:b},{id:t0.id,params:{selections:p}}],S=[{id:$.id,params:m},{id:eF.id,params:I},{id:t0.id,params:{selections:f}}];return!!(0,E.sequenceExecute)(N,i)&&(s.pushUndoRedo({unitID:c,undoMutations:S,redoMutations:N}),!0)}};class iD{constructor(){k(this,"_borderInfo",{type:E.BorderType.ALL,color:"#000000",style:E.BorderStyleTypes.THIN,activeBorderType:!1}),k(this,"_borderInfo$",new(0,I.BehaviorSubject)(this._borderInfo)),k(this,"borderInfo$",this._borderInfo$.asObservable())}dispose(){this._borderInfo$.complete()}setType(e){this._borderInfo.type=e,this.setActiveBorderType(!0),this._refresh()}setColor(e){this._borderInfo.color=e,this._refresh()}setStyle(e){this._borderInfo.style=e,this._refresh()}setActiveBorderType(e){this._borderInfo.activeBorderType=e}getBorderInfo(){return this._borderInfo}_refresh(){this._borderInfo$.next(this._borderInfo)}}function iV(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}let iL=(e,t,r,n)=>{let{mr:i,worksheet:s}=e;t.startRow<0||t.startColumn<0||iV(t,(e,t)=>{var a,o;let l=s.getMergedCell(e,t),u=r;if(l&&(r.bc_tr||r.ml_tr||r.bl_tr||r.tl_mr||r.tl_bc||r.tl_br)){if(n){let e=E.Tools.deepClone(null==(a=i.getValue(l.startRow,l.startColumn))?void 0:a.s);u=null!=e&&e.bd?Object.assign(e.bd,r):r}i.setValue(l.startRow,l.startColumn,{s:{bd:u}})}else{if(n){let n=E.Tools.deepClone(null==(o=i.getValue(e,t))?void 0:o.s);u=null!=n&&n.bd?Object.assign(n.bd,r):r}i.setValue(e,t,{s:{bd:u}})}})},iP={id:"sheet.command.set-border",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(E.ICommandService),i=e.get(E.IUndoRedoService),s=e.get(E.IUniverInstanceService),a=e.get(tL),o=e.get(iD),l=ec(s,t);if(!l)return!1;let u=(null==t?void 0:t.ranges)||(null==(r=a.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=u&&u.length))return!1;let{activeBorderType:c}=o.getBorderInfo();if(!c)return!1;let h=function(e,t,r){let{style:n,color:i,type:s}=e.getBorderInfo(),a=s===E.BorderType.TOP||s===E.BorderType.ALL||s===E.BorderType.OUTSIDE,o=s===E.BorderType.LEFT||s===E.BorderType.ALL||s===E.BorderType.OUTSIDE,l=s===E.BorderType.BOTTOM||s===E.BorderType.ALL||s===E.BorderType.OUTSIDE,u=s===E.BorderType.RIGHT||s===E.BorderType.ALL||s===E.BorderType.OUTSIDE,c=s===E.BorderType.VERTICAL||s===E.BorderType.ALL||s===E.BorderType.INSIDE,h=s===E.BorderType.HORIZONTAL||s===E.BorderType.ALL||s===E.BorderType.INSIDE,d=s.indexOf("tlbr")>-1,m=s.indexOf("tlbc")>-1,g=s.indexOf("tlmr")>-1,f=s.indexOf("bltr")>-1,p=s.indexOf("mltr")>-1,C=s.indexOf("bctr")>-1,_=r[0],{topRangeOut:y,leftRangeOut:R,bottomRangeOut:b,rightRangeOut:I,topRange:N,leftRange:S,bottomRange:A,rightRange:v}=(e=>{let t={startRow:e.startRow-1,startColumn:e.startColumn,endRow:e.startRow-1,endColumn:e.endColumn},r={startRow:e.startRow,startColumn:e.startColumn-1,endRow:e.endRow,endColumn:e.startColumn-1},n={startRow:e.endRow+1,startColumn:e.startColumn,endRow:e.endRow+1,endColumn:e.endColumn},i={startRow:e.startRow,startColumn:e.endColumn+1,endRow:e.endRow,endColumn:e.endColumn+1},s={startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow,endColumn:e.endColumn},a={startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.startColumn};return{topRangeOut:t,leftRangeOut:r,bottomRangeOut:n,rightRangeOut:i,topRange:s,leftRange:a,bottomRange:{startRow:e.endRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn},rightRange:{startRow:e.startRow,startColumn:e.endColumn,endRow:e.endRow,endColumn:e.endColumn}}})(_),T=new(0,E.ObjectMatrix),{worksheet:w,unitId:M,subUnitId:O}=t;return{worksheet:w,unitId:M,subUnitId:O,style:n,color:i,type:s,top:a,left:o,right:u,bottom:l,vertical:c,horizontal:h,tl_br:d,tl_bc:m,tl_mr:g,bl_tr:f,ml_tr:p,bc_tr:C,topRangeOut:y,leftRangeOut:R,bottomRangeOut:b,rightRangeOut:I,topRange:N,leftRange:S,bottomRange:A,rightRange:v,range:_,mr:T,borderStyle:{s:n,cl:{rgb:i}}}}(o,l,u);(e=>{let{range:t,mr:r,borderStyle:n,vertical:i,horizontal:s,worksheet:a}=e;i&&iV(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startColumn!==t.startColumn&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{l:E.Tools.deepClone(n)}):{l:E.Tools.deepClone(n)}}})}else{if(i!==t.endColumn){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:E.Tools.deepClone(n)}):{r:E.Tools.deepClone(n)}}})}if(i!==t.startColumn){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:E.Tools.deepClone(n)}):{l:E.Tools.deepClone(n)}}})}}}),s&&iV(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startRow!==t.startRow&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{t:E.Tools.deepClone(n)}):{t:E.Tools.deepClone(n)}}})}else{if(e!==t.endRow){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:E.Tools.deepClone(n)}):{b:E.Tools.deepClone(n)}}})}if(e!==t.startRow){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:E.Tools.deepClone(n)}):{t:E.Tools.deepClone(n)}}})}}})})(h),(e=>{let{top:t,left:r,right:n,bottom:i,borderStyle:s,bottomRange:a,topRange:o,leftRange:l,rightRange:u,bottomRangeOut:c,topRangeOut:h,leftRangeOut:d,rightRangeOut:m}=e,g=(t,r,n)=>{iL(e,t,r,n)};t&&(g(h,{b:null}),g(o,{t:E.Tools.deepClone(s)},!0)),i&&(g(c,{t:null}),g(a,{b:E.Tools.deepClone(s)},!0)),r&&(g(d,{r:null}),g(l,{l:E.Tools.deepClone(s)},!0)),n&&(g(m,{l:null}),g(u,{r:E.Tools.deepClone(s)},!0))})(h),function(e){let{borderStyle:t,tl_br:r,tl_bc:n,tl_mr:i,bl_tr:s,ml_tr:a,bc_tr:o}=e,l=(t,r,n)=>{iL(e,t,r,n)};r&&l(e.range,{tl_br:E.Tools.deepClone(t)},!0),n&&l(e.range,{tl_bc:E.Tools.deepClone(t)},!0),i&&l(e.range,{tl_mr:E.Tools.deepClone(t)},!0),s&&l(e.range,{bl_tr:E.Tools.deepClone(t)},!0),a&&l(e.range,{ml_tr:E.Tools.deepClone(t)},!0),o&&l(e.range,{bc_tr:E.Tools.deepClone(t)},!0)}(h),(e=>{let{range:t,worksheet:r,mr:n,top:i,bottom:s,left:a,right:o,vertical:l,horizontal:u,tl_br:c,tl_bc:h,tl_mr:d,bl_tr:m,ml_tr:g,bc_tr:f,topRange:p,bottomRange:C,leftRange:_,rightRange:y,topRangeOut:R,bottomRangeOut:E,leftRangeOut:b,rightRangeOut:I}=e,N=(t,r,n)=>{iL(e,t,r,n)};i||s||a||o||l||u||c||h||d||m||g||f||(iV(t,(e,i)=>{var s,a,o,l,u,c,h,d;let m=r.getMergedCell(e,i);if(m){if(m.endColumn!==t.endColumn){let t=null==(s=n.getValue(m.startRow,m.startColumn))?void 0:s.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(m.startColumn!==t.startColumn){let t=null==(a=n.getValue(m.startRow,m.startColumn))?void 0:a.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(m.endRow!==t.endRow){let t=null==(o=n.getValue(m.startRow,m.startColumn))?void 0:o.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(m.startRow!==t.startRow){let t=null==(l=n.getValue(m.startRow,m.startColumn))?void 0:l.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}else{if(i!==t.endColumn){let t=null==(u=n.getValue(e,i))?void 0:u.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(i!==t.startColumn){let t=null==(c=n.getValue(e,i))?void 0:c.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(e!==t.endRow){let t=null==(h=n.getValue(e,i))?void 0:h.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(e!==t.startRow){let t=null==(d=n.getValue(e,i))?void 0:d.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}}),N(R,{b:null}),N(p,{t:null},!0),N(E,{t:null}),N(C,{b:null},!0),N(b,{r:null}),N(_,{l:null},!0),N(I,{l:null}),N(y,{r:null},!0),N(t,{tl_br:null},!0),N(t,{tl_bc:null},!0),N(t,{tl_mr:null},!0),N(t,{bl_tr:null},!0),N(t,{ml_tr:null},!0),N(t,{bc_tr:null},!0))})(h);let{unitId:d,subUnitId:m,mr:g}=h,f={unitId:d,subUnitId:m,cellValue:g.getData()},p=ek(e,f);return!!n.syncExecuteCommand(eF.id,f)&&(i.pushUndoRedo({unitID:d,undoMutations:[{id:eF.id,params:p}],redoMutations:[{id:eF.id,params:f}]}),!0)}},ik={id:"sheet.command.set-border-position",type:E.CommandType.COMMAND,handler:(e,t)=>{if(!t.value)return!1;let r=e.get(E.ICommandService);return e.get(iD).setType(t.value),r.syncExecuteCommand(iP.id)}},iF={id:"sheet.command.set-border-style",type:E.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(E.ICommandService);return e.get(iD).setStyle(t.value),r.syncExecuteCommand(iP.id)}},ij={id:"sheet.command.set-border-color",type:E.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(E.ICommandService);return e.get(iD).setColor(t.value),r.syncExecuteCommand(iP.id)}},iB={id:"sheet.command.set-border-basic",type:E.CommandType.COMMAND,handler:(e,t)=>{let{unitId:r,subUnitId:n,value:i,ranges:s}=t,{type:a,color:o,style:l}=i,u=e.get(E.ICommandService),c=e.get(iD);return c.setType(a),o&&c.setColor(o),c.setStyle(l),u.syncExecuteCommand(iP.id,{unitId:r,subUnitId:n,ranges:s})}},i$={type:E.CommandType.COMMAND,id:"sheet.command.set-col-data",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService),t);if(!i)return!1;let{columnData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,columnData:s},c=eO(u,l);return!!r.syncExecuteCommand(ex.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:ex.id,params:c}],redoMutations:[{id:ex.id,params:u}]}),!0)}},iH={type:E.CommandType.COMMAND,id:"sheet.command.set-col-visible-on-cols",handler:(e,t)=>{var r,n;let{unitId:i,subUnitId:s,ranges:a}=t,o=e.get(Q),l=e.get(E.ICommandService),u=ec(e.get(E.IUniverInstanceService),{unitId:i,subUnitId:s});if(!u)return!1;let{worksheet:c}=u,h={unitId:i,subUnitId:s,ranges:a},d={unitId:i,subUnitId:s,reveal:!0,selections:a.map(e=>({range:e,primary:tG(e,c),style:null}))},m=((e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}})(e,h),g={unitId:i,subUnitId:s,selections:iY(a).map(e=>({range:e,primary:tG(e,c),style:null}))},f=(0,E.sequenceExecute)([{id:eD.id,params:h},{id:t0.id,params:d}],l),p=o.onCommandExecute({id:iH.id,params:t}),C=(0,E.sequenceExecute)([...p.redos],l);return f.result&&C.result&&e.get(E.IUndoRedoService).pushUndoRedo({unitID:i,undoMutations:[{id:eU.id,params:m},{id:t0.id,params:g},...null!=(r=p.undos)?r:[]],redoMutations:[...null!=(n=p.preRedos)?n:[],{id:eD.id,params:h},{id:t0.id,params:d},...p.redos]}),!0}},iW={type:E.CommandType.COMMAND,id:"sheet.command.set-selected-cols-visible",handler:e=>{var t;let r=e.get(tL),n=e.get(E.ICommandService),i=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===E.RANGE_TYPE.COLUMN);if(!(null!=i&&i.length))return!1;let s=ec(e.get(E.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=i.map(e=>a.getHiddenCols(e.startColumn,e.endColumn)).flat();return n.executeCommand(iH.id,{unitId:o,subUnitId:l,ranges:u})}},iG={type:E.CommandType.COMMAND,id:"sheet.command.set-col-hidden",handler:(e,t)=>{var r,n,i,s;let a=e.get(tL),o=e.get(Q),l=e.get(E.IUniverInstanceService),u=e.get(E.ICommandService),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===E.RANGE_TYPE.COLUMN);if(!(null!=c&&c.length))return!1;let h=ec(l,t);if(!h)return!1;let{worksheet:d,unitId:m,subUnitId:g}=h,f={unitId:m,subUnitId:g,ranges:c=function(e,t){let r=e.getRowCount()-1,n=e.getHiddenCols(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startColumn>=e.startColumn&&t.endColumn<=e.endColumn);if(t.length){let n=e.startColumn;t.forEach(e=>{e.startColumn>n&&(i.push({startColumn:n,endColumn:e.startColumn-1,startRow:0,endRow:r}),n=e.endColumn+1)}),n<=e.endColumn&&i.push({startColumn:n,endColumn:e.endColumn,startRow:0,endRow:r})}else i.push(e)}),i}(h.worksheet,c)},p={unitId:m,subUnitId:g,selections:iY(c).map(e=>({range:e,primary:tG(e,d),style:null}))},C=((e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}})(e,f),_={unitId:m,subUnitId:g,reveal:!0,selections:c.map(e=>({range:e,primary:tG(e,d),style:null}))},y=(0,E.sequenceExecute)([{id:eU.id,params:f},{id:t0.id,params:p}],u),R=o.onCommandExecute({id:iG.id,params:f}),b=(0,E.sequenceExecute)([...R.redos],u);return!!y.result&&!!b.result&&(e.get(E.IUndoRedoService).pushUndoRedo({unitID:m,undoMutations:[{id:eD.id,params:C},{id:t0.id,params:_},...null!=(i=R.undos)?i:[]],redoMutations:[...null!=(s=R.preRedos)?s:[],{id:eU.id,params:f},{id:t0.id,params:p},...R.redos]}),!0)}};function iY(e){return(function(e){let t,r=[];return e.sort((e,t)=>e.startColumn-t.startColumn).forEach(e=>{if(!t){t=e;return}t.endColumn===e.startColumn-1?t.endColumn=e.endColumn:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startColumn?e.endColumn+1:e.startColumn-1;return{...e,startColumn:t,endColumn:t}})}let iz={id:"sheet.command.set-defined-name",type:E.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(Q);if(!t)return!1;let o={...t},l=(0,V.SetDefinedNameMutationFactory)(e,t),u=a.onCommandExecute({id:iz.id,params:t}),c=[...null!=(r=u.preRedos)?r:[],{id:V.RemoveDefinedNameMutation.id,params:l},{id:V.SetDefinedNameMutation.id,params:o},...u.redos],h=[...null!=(n=u.preUndos)?n:[],{id:V.RemoveDefinedNameMutation.id,params:o},{id:V.SetDefinedNameMutation.id,params:l},...u.undos];return!!(0,E.sequenceExecute)(c,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:h.filter(Boolean),redoMutations:c.filter(Boolean)}),!0)}},iX=(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().freeze;return{unitId:t.unitId,subUnitId:t.subUnitId,...i}},iq={id:"sheet.mutation.set-frozen",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig(),{startRow:s,startColumn:a,ySplit:o,xSplit:l}=t;return i.freeze={startRow:s,startColumn:a,ySplit:o,xSplit:l},!0}},iK={type:E.CommandType.COMMAND,id:"sheet.command.set-frozen",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService),{unitId:t.unitId,subUnitId:t.subUnitId});if(!i)return!1;let{unitId:s,subUnitId:a,worksheet:o}=i,{startColumn:l,startRow:u,xSplit:c,ySplit:h}=t;if(u>=o.getRowCount()||l>=o.getColumnCount()||c>=o.getColumnCount()||h>=o.getRowCount())return!1;let d={unitId:s,subUnitId:a,...t},m=iX(e,d);return!!r.syncExecuteCommand(iq.id,d)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:iq.id,params:m}],redoMutations:[{id:iq.id,params:d}]}),!0)}},iQ={type:E.CommandType.COMMAND,id:"sheet.command.cancel-frozen",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUniverInstanceService),i=e.get(E.IUndoRedoService),s=ec(n,{unitId:null==t?void 0:t.unitId,subUnitId:null==t?void 0:t.subUnitId});if(!s)return!1;let{unitId:a,subUnitId:o}=s,l={unitId:a,subUnitId:o,startRow:-1,startColumn:-1,xSplit:0,ySplit:0},u=iX(e,l);return r.syncExecuteCommand(iq.id,l)&&i.pushUndoRedo({unitID:a,undoMutations:[{id:iq.id,params:u}],redoMutations:[{id:iq.id,params:l}]}),!0}},iZ={type:E.CommandType.COMMAND,id:"sheet.command.set-gridlines-color",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s}=i,a=s.getConfig().gridlinesColor;if(a===(null==t?void 0:t.color))return!1;let{unitId:o,subUnitId:l}=i,u={color:null==t?void 0:t.color,unitId:o,subUnitId:l};return!!r.syncExecuteCommand(eV.id,u)&&(n.pushUndoRedo({unitID:o,undoMutations:[{id:eV.id,params:{color:a,unitId:o,subUnitId:l}}],redoMutations:[{id:eV.id,params:u}]}),!0)}},iJ={id:"sheet.mutation.set-range-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i,ruleId:s}=t;return e.get(tv).setRule(r,n,s,i),!0}},i0=(e,t)=>{let{unitId:r,subUnitId:n,ruleId:i}=t,s=e.get(tv).getRule(r,n,i);return s?{id:iJ.id,params:{...t,rule:s}}:null},i1={id:"sheet.mutation.set-worksheet-protection",type:E.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i}=t;return e.get(id).setRule(r,n,i),!0}},i2={type:E.CommandType.COMMAND,id:"sheet.command.set-protection",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=e.get(tv),{rule:s,oldRule:a}=t,{unitId:o,subUnitId:l}=s,u=[],c=[];return(null==a?void 0:a.unitType)===s.unitType?s.unitType===t9.Worksheet?(u.push({id:i1.id,params:{unitId:o,subUnitId:l,rule:s}}),c.push({id:i1.id,params:{unitId:o,subUnitId:l,rule:a}})):(u.push({id:iJ.id,params:{unitId:o,subUnitId:l,rule:s,ruleId:s.id}}),c.push({id:iJ.id,params:{unitId:o,subUnitId:l,ruleId:a.id,rule:a}})):(a&&(a.unitType===t9.Worksheet?(u.push({id:ig.id,params:{unitId:o,subUnitId:l}}),c.push({id:im.id,params:{unitId:o,rule:a,subUnitId:a.subUnitId}})):a.unitType===t9.SelectRange&&(u.push({id:tw.id,params:{unitId:o,subUnitId:l,ruleIds:[a.id]}}),c.push({id:tO.id,params:{unitId:o,subUnitId:l,rules:[a]}}))),s.unitType===t9.Worksheet?(u.push({id:im.id,params:{unitId:o,rule:s,subUnitId:s.subUnitId}}),c.unshift({id:ig.id,params:{unitId:o,subUnitId:l}})):s.unitType===t9.SelectRange&&(s.id=i.createRuleId(o,l),u.push({id:tO.id,params:{unitId:o,subUnitId:l,rules:[s]}}),c.unshift({id:tw.id,params:{unitId:o,subUnitId:l,ruleIds:[s.id]}}))),(0,E.sequenceExecute)(u,r)&&n.pushUndoRedo({unitID:o,undoMutations:c,redoMutations:u}),!0}},i5={type:E.CommandType.COMMAND,id:"sheet.command.set-row-data",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService),t);if(!i)return!1;let{rowData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,rowData:s},c=eB(u,l);return!!r.syncExecuteCommand(e$.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:e$.id,params:c}],redoMutations:[{id:e$.id,params:u}]}),!0)}},i3={type:E.CommandType.COMMAND,id:"sheet.command.set-specific-rows-visible",handler:(e,t)=>{var r,n,i;let{unitId:s,subUnitId:a,ranges:o}=t,l=e.get(E.ICommandService),u=e.get(E.IUndoRedoService),c=e.get(Q),h=ec(e.get(E.IUniverInstanceService),{unitId:s,subUnitId:a});if(!h)return!1;let{worksheet:d}=h,m={unitId:s,subUnitId:a,ranges:o},g={unitId:s,subUnitId:a,reveal:!0,selections:o.map(e=>({range:e,primary:tG(e,d),style:null}))},f=((e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}})(e,m),p={unitId:s,subUnitId:a,selections:i9(o).map(e=>({range:e,primary:tG(e,d),style:null}))},C=(0,E.sequenceExecute)([{id:eH.id,params:m},{id:t0.id,params:g}],l),_=c.onCommandExecute({id:i3.id,params:t}),y=(0,E.sequenceExecute)([..._.redos],l);return C.result&&y.result&&u.pushUndoRedo({unitID:s,undoMutations:[...null!=(r=_.preUndos)?r:[],{id:eW.id,params:f},{id:t0.id,params:p},...null!=(n=_.undos)?n:[]],redoMutations:[...null!=(i=_.preRedos)?i:[],{id:eH.id,params:m},{id:t0.id,params:g},..._.redos]}),!0}},i4={type:E.CommandType.COMMAND,id:"sheet.command.set-selected-rows-visible",handler:async e=>{var t;let r=e.get(tL),n=e.get(E.IUniverInstanceService),i=e.get(E.ICommandService),s=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===E.RANGE_TYPE.ROW);if(!(null!=s&&s.length))return!1;let a=ec(n);if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,c=s.map(e=>o.getHiddenRows(e.startRow,e.endRow)).flat();return i.executeCommand(i3.id,{unitId:l,subUnitId:u,ranges:c})}},i6={type:E.CommandType.COMMAND,id:"sheet.command.set-rows-hidden",handler:(e,t)=>{var r,n,i,s,a,o;let l=e.get(tL),u=e.get(E.ICommandService),c=e.get(E.IUndoRedoService),h=e.get(E.IUniverInstanceService),d=e.get(Q),m=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=l.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===E.RANGE_TYPE.ROW);if(!(null!=m&&m.length))return!1;let g=ec(h,t);if(!g)return!1;m=function(e,t){let r=e.getMaxColumns()-1,n=e.getHiddenRows(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startRow>=e.startRow&&t.endRow<=e.endRow);if(t.length){let n=e.startRow;t.forEach(e=>{e.startRow>n&&(i.push({startRow:n,endRow:e.startRow-1,startColumn:0,endColumn:r}),n=e.endRow+1)}),n<=e.endRow&&i.push({startRow:n,endRow:e.endRow,startColumn:0,endColumn:r})}else i.push(e)}),i}(g.worksheet,m);let{unitId:f,subUnitId:p,worksheet:C}=g,_={unitId:f,subUnitId:p,ranges:m},y={unitId:f,subUnitId:p,selections:i9(m).map(e=>({range:e,primary:tG(e,C),style:null}))},R=((e,t)=>{if(null==e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}})(e,_),b={unitId:f,subUnitId:p,reveal:!0,selections:m.map(e=>({range:e,primary:tG(e,C),style:null}))},I=d.onCommandExecute({id:i6.id,params:_});return(0,E.sequenceExecute)([...null!=(i=I.preRedos)?i:[],{id:eW.id,params:_},{id:t0.id,params:y},...I.redos],u).result&&c.pushUndoRedo({unitID:f,undoMutations:[...null!=(s=I.preUndos)?s:[],{id:eH.id,params:R},{id:t0.id,params:b},...null!=(a=I.undos)?a:[]],redoMutations:[...null!=(o=I.preRedos)?o:[],{id:eW.id,params:_},{id:t0.id,params:y},...I.redos]}),!0}};function i9(e){return(function(e){let t,r=[];return e.sort((e,t)=>e.startRow-t.startRow).forEach(e=>{if(!t){t=e;return}e.startRow===t.endRow+1?t.endRow=e.endRow:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startRow?e.endRow+1:e.startRow-1;return{...e,startRow:t,endRow:t}})}let i8=["ff","fs","tr","tb"],i7={type:E.CommandType.COMMAND,id:"sheet.command.set-style",handler:(e,t)=>{var r;let n=ec(e.get(E.IUniverInstanceService),t);if(!n)return!1;let{unitId:i,subUnitId:s,worksheet:a}=n,{range:o,style:l}=t,u=e.get(E.ICommandService),c=e.get(E.IUndoRedoService),h=e.get(tL),d=o?[o]:null==(r=h.getCurrentSelections())?void 0:r.map(e=>e.range);if(!(null!=d&&d.length))return!1;let m=new(0,E.ObjectMatrix),g={forOperableEach:function(e,t){for(let r=e.startRow;r<=e.endRow;r++)if(!a.getRowFiltered(r))for(let n=e.startColumn;n<=e.endColumn;n++)t(r,n,e)}};if(E.Tools.isArray(l.value))for(let e=0;e<d.length;e++)g.forOperableEach(d[e],(e,t,r)=>{m.setValue(e,t,{s:{[l.type]:l.value[e-r.startRow][t-r.startColumn]}})});else for(let e=0;e<d.length;e++){let t={s:{[l.type]:l.value}};g.forOperableEach(d[e],(e,r)=>m.setValue(e,r,t))}let f={subUnitId:s,unitId:i,cellValue:m.getMatrix()},p=e.get(ny).getSkeleton(i,s),C=ek(e,f),_=u.syncExecuteCommand(eF.id,f),y=e.get(Q),R=[],b=[];if(i8.includes(null==t?void 0:t.style.type)){let{suitableRanges:e,remainingRanges:t}=nE(d,p),r=nR(e,a),{undos:n,redos:o}=y.generateMutationsOfAutoHeight({unitId:i,subUnitId:s,ranges:e,autoHeightRanges:e,lazyAutoHeightRanges:t,cellHeights:r});R=n,b=o}let{undos:I,redos:N}=y.onCommandExecute({id:i7.id,params:t}),S=(0,E.sequenceExecute)([...N,...b],u);return!!_&&!!S.result&&(c.pushUndoRedo({unitID:f.unitId,undoMutations:[{id:eF.id,params:C},...I,...R],redoMutations:[{id:eF.id,params:f},...N,...b]}),!0)}},se={type:E.CommandType.COMMAND,id:"sheet.command.set-bold",handler:e=>{let t=e.get(tL).getCurrentLastSelection();if(!t)return!1;let r=ec(e.get(E.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,{actualRow:i,actualColumn:s}=t.primary,a={style:{type:"bl",value:n.getRange(i,s).getFontWeight()===E.FontWeight.BOLD?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE}};return e.get(E.ICommandService).syncExecuteCommand(i7.id,a)}},st={type:E.CommandType.COMMAND,id:"sheet.command.set-italic",handler:e=>{let t=e.get(tL).getCurrentLastSelection();if(!t)return!1;let r=ec(e.get(E.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;if(t.primary){let{startRow:e,startColumn:r}=t.primary;i=n.getRange(e,r).getFontStyle()===E.FontItalic.ITALIC}let s={style:{type:"it",value:i?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE}};return e.get(E.ICommandService).syncExecuteCommand(i7.id,s)}},sr={type:E.CommandType.COMMAND,id:"sheet.command.set-underline",handler:e=>{let t=e.get(tL).getCurrentLastSelection();if(!t)return!1;let r=ec(e.get(E.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.startRow,t.primary.startColumn).getUnderline().s);let s={style:{type:"ul",value:{s:i?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE}}};return e.get(E.ICommandService).syncExecuteCommand(i7.id,s)}},sn={type:E.CommandType.COMMAND,id:"sheet.command.set-stroke",handler:e=>{let t=e.get(tL).getCurrentLastSelection();if(!t)return!1;let r=ec(e.get(E.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.actualRow,t.primary.actualColumn).getStrikeThrough().s);let s={style:{type:"st",value:{s:i?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE}}};return e.get(E.ICommandService).syncExecuteCommand(i7.id,s)}},si={type:E.CommandType.COMMAND,id:"sheet.command.set-overline",handler:e=>{let t=e.get(tL).getCurrentLastSelection();if(!t)return!1;let r=ec(e.get(E.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.startRow,t.primary.startColumn).getOverline().s);let s={style:{type:"ol",value:{s:i?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE}}};return e.get(E.ICommandService).syncExecuteCommand(i7.id,s)}},ss={type:E.CommandType.COMMAND,id:"sheet.command.set-font-family",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={style:{type:"ff",value:t.value}};return r.syncExecuteCommand(i7.id,n)}},sa={type:E.CommandType.COMMAND,id:"sheet.command.set-font-size",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={style:{type:"fs",value:t.value}};return r.syncExecuteCommand(i7.id,n)}},so={type:E.CommandType.COMMAND,id:"sheet.command.set-text-color",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={style:{type:"cl",value:{rgb:t.value}}};return r.syncExecuteCommand(i7.id,n)}},sl={type:E.CommandType.COMMAND,id:"sheet.command.reset-text-color",handler:e=>e.get(E.ICommandService).syncExecuteCommand(i7.id,{style:{type:"cl",value:{rgb:null}}})},su={type:E.CommandType.COMMAND,id:"sheet.command.set-background-color",handler:(e,t)=>{if(!t||!t.value)return!1;let r=e.get(E.ICommandService),n={style:{type:"bg",value:{rgb:t.value}}};return r.syncExecuteCommand(i7.id,n)}},sc={type:E.CommandType.COMMAND,id:"sheet.command.reset-background-color",handler:e=>e.get(E.ICommandService).syncExecuteCommand(i7.id,{style:{type:"bg",value:{rgb:null}}})},sh={type:E.CommandType.COMMAND,id:"sheet.command.set-vertical-text-align",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"vt",value:t.value}};return r.syncExecuteCommand(i7.id,n)}},sd={type:E.CommandType.COMMAND,id:"sheet.command.set-horizontal-text-align",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"ht",value:t.value}};return r.syncExecuteCommand(i7.id,n)}},sm={type:E.CommandType.COMMAND,id:"sheet.command.set-text-wrap",handler:(e,t)=>{if(!t)return!1;let r=e.get(E.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tb",value:t.value}};return r.syncExecuteCommand(i7.id,n)}},sg={type:E.CommandType.COMMAND,id:"sheet.command.set-text-rotation",handler:(e,t)=>{if(!t)return!1;let r="number"==typeof t.value?{a:t.value}:{a:0,v:E.BooleanNumber.TRUE},n=e.get(E.ICommandService),i={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tr",value:r}};return n.syncExecuteCommand(i7.id,i)}},sf={id:"sheet.mutation.set-tab-color",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().tabColor=t.color,!0)}},sp={type:E.CommandType.COMMAND,id:"sheet.command.set-tab-color",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{unitId:s,subUnitId:a}=i,o={color:t.value,unitId:s,subUnitId:a},l=((e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().tabColor;return{...E.Tools.deepClone(t),color:r}})(e,o);return!!r.syncExecuteCommand(sf.id,o)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:sf.id,params:l}],redoMutations:[{id:sf.id,params:o}]}),!0)}},sC={id:"sheet.mutation.set-workbook-name",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUnit(t.unitId,E.UniverInstanceType.UNIVER_SHEET);return!!r&&(r.setName(t.name),!0)}},s_={type:E.CommandType.COMMAND,id:"sheet.command.set-workbook-name",handler:(e,t)=>{var r;let n=e.get(E.ICommandService),i=e.get(Q);if(!eu(e.get(E.IUniverInstanceService),t))return!1;let s=i.onCommandExecute({id:s_.id,params:t}),a={name:t.name,unitId:t.unitId},o=[...null!=(r=s.preRedos)?r:[],{id:sC.id,params:a},...s.redos];return(0,E.sequenceExecute)(o,n).result}},sy={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-activate",handler:(e,t,r)=>{let n=e.get(E.ICommandService),i=ec(e.get(E.IUniverInstanceService),t);if(!i)return!1;let{unitId:s,subUnitId:a}=i;return new Promise(e=>{setTimeout(()=>{e(n.syncExecuteCommand(e6.id,{unitId:s,subUnitId:a},r))},4)})}},sR={type:E.CommandType.COMMAND,id:"sheet.command.delta-column-width",handler:async(e,t)=>{let r,n=e.get(tL).getCurrentSelections();if(!(null!=n&&n.length))return!1;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=ec(e.get(E.IUniverInstanceService));if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,{anchorCol:c,deltaX:h}=t,d=o.getColumnWidth(c)+h,m=1===n.length&&n[0].range.rangeType===E.RANGE_TYPE.ALL,g=n.filter(e=>e.range.rangeType===E.RANGE_TYPE.COLUMN),f=m?E.RANGE_TYPE.ALL:g.some(({range:e})=>{let{startColumn:t,endColumn:r}=e;return t<=c&&c<=r})?E.RANGE_TYPE.COLUMN:E.RANGE_TYPE.NORMAL;if(f===E.RANGE_TYPE.ALL){let e=o.getRowCount();r={subUnitId:u,unitId:l,colWidth:d,ranges:Array(o.getColumnCount()).fill(void 0).map((t,r)=>({startRow:0,endRow:e-1,startColumn:r,endColumn:r}))}}else r=f===E.RANGE_TYPE.COLUMN?{subUnitId:u,unitId:l,ranges:g.map(e=>E.Rectangle.clone(e.range)),colWidth:d}:{subUnitId:u,unitId:l,colWidth:d,ranges:[{startRow:0,endRow:o.getMaxRows()-1,startColumn:c,endColumn:c}]};let p=e.get(ny).getSkeleton(l,u),{suitableRanges:C,remainingRanges:_}=nE(r.ranges,p);nR(C,o);let y=e.get(Q),{undos:R,redos:b}=y.onCommandExecute({id:sR.id,params:r}),I=eG(r,o),N=i.syncExecuteCommand(eY.id,r),{undos:S,redos:A}=y.generateMutationsOfAutoHeight({unitId:l,subUnitId:u,ranges:C,autoHeightRanges:C,lazyAutoHeightRanges:_}),{undos:v,redos:T}=e.get(Q).afterCommandExecute({id:sR.id,params:r}),w=(0,E.sequenceExecute)([...b,...T,...A],i);return N&&w.result&&s.pushUndoRedo({unitID:l,undoMutations:[{id:eY.id,params:I},...R,...v,...S],redoMutations:[{id:eY.id,params:r},...b,...T,...A]}),!0}},sE={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-col-width",handler:(e,t)=>{var r,n,i,s;let a=e.get(tL),o=e.get(E.ICommandService),l=e.get(E.IUndoRedoService),u=e.get(Q),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=c&&c.length))return!1;let h=ec(e.get(E.IUniverInstanceService),t);if(!h)return!1;let{subUnitId:d,unitId:m,worksheet:g}=h,f=e.get(ny).getSkeleton(m,d),p={subUnitId:d,unitId:m,ranges:c,colWidth:t.value},{suitableRanges:C,remainingRanges:_}=nE(p.ranges,f);nR(C,g);let y=eG(p,g),R=o.syncExecuteCommand(eY.id,p),{undos:b,redos:I}=u.generateMutationsOfAutoHeight({unitId:m,subUnitId:d,ranges:C,autoHeightRanges:C,lazyAutoHeightRanges:_}),N=u.onCommandExecute({id:sE.id,params:p}),S=(0,E.sequenceExecute)([...N.redos,...I],o);return!!R&&!!S.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=N.preUndos)?i:[],{id:eY.id,params:y},...N.undos,...b],redoMutations:[...null!=(s=N.preRedos)?s:[],{id:eY.id,params:p},...N.redos,...I]}),!0)}};E.CommandType.COMMAND;let sb={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-column-count",handler:(e,t)=>{let{unitId:r,subUnitId:n,columnCount:i}=t,s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService);if(!ec(e.get(E.IUniverInstanceService),t))return!1;let o={unitId:r,subUnitId:n,columnCount:i},l=ez(e,o);return!!s.syncExecuteCommand(eX.id,o)&&(a.pushUndoRedo({unitID:r,undoMutations:[{id:eX.id,params:l}],redoMutations:[{id:eX.id,params:o}]}),!0)}},sI={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-default-style",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{unitId:i}=t,s=eK(e,t);return!!r.syncExecuteCommand(eq.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:eq.id,params:s}],redoMutations:[{id:eq.id,params:t}]}),!0)}},sN=(e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetHideMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{hidden:n.isSheetHidden(),unitId:t.unitId,subUnitId:n.getSheetId()}},sS={id:"sheet.mutation.set-worksheet-hidden",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().hidden=t.hidden,!0)}},sA={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-hidden",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=e.get(E.ErrorService),s=e.get(E.LocaleService),a=ec(e.get(E.IUniverInstanceService),t);if(!a)return!1;let{workbook:o,worksheet:l,unitId:u,subUnitId:c}=a;if(l.getConfig().hidden===E.BooleanNumber.TRUE)return!1;let h={unitId:u,subUnitId:c,hidden:E.BooleanNumber.TRUE},d=sN(e,h);return 1===o.getSheets().filter(e=>e.getConfig().hidden===E.BooleanNumber.FALSE).length?(i.emit(s.t("sheets.info.hideSheet")),!1):!!r.syncExecuteCommand(sS.id,h)&&(n.pushUndoRedo({unitID:u,undoMutations:[{id:sS.id,params:d}],redoMutations:[{id:sS.id,params:h}]}),!0)}},sv={id:"sheet.mutation.set-worksheet-name",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().name=t.name,!0)}},sT={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-name",handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(Q),o=ec(e.get(E.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u}=o,c={subUnitId:u,name:t.name,unitId:l},h=((e,t)=>{let r=eh(e.get(E.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetNameMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,name:n.getName(),subUnitId:n.getSheetId()}})(e,c),d=a.onCommandExecute({id:sT.id,params:t}),m=[...null!=(r=d.preRedos)?r:[],{id:sv.id,params:c},...d.redos],g=[...null!=(n=d.preUndos)?n:[],{id:sv.id,params:h},...d.undos];return!!(0,E.sequenceExecute)(m,i).result&&(s.pushUndoRedo({unitID:l,undoMutations:g,redoMutations:m}),!0)}},sw={id:"sheet.mutation.set-worksheet-order",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getConfig();return n.sheetOrder.splice(t.fromOrder,1),n.sheetOrder.splice(t.toOrder,0,t.subUnitId),!0}},sM={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-order",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService),t);if(!i)return!1;let{workbook:s,unitId:a,subUnitId:o}=i,l={fromOrder:s.getConfig().sheetOrder.indexOf(o),toOrder:t.order,unitId:a,subUnitId:o},u={...E.Tools.deepClone(l),toOrder:l.fromOrder,fromOrder:l.toOrder};return!!r.syncExecuteCommand(sw.id,l)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:sw.id,params:u}],redoMutations:[{id:sw.id,params:l}]}),!0)}};class sO{constructor(){k(this,"_model",new Map),k(this,"_pointChange",new(0,x.Subject)),k(this,"pointChange$",this._pointChange.asObservable())}addRule(e){this._ensureSubUnitMap(e.unitId).set(e.subUnitId,e),this._pointChange.next(e)}deleteRule(e,t){var r,n,i;let s=null==(r=this._model.get(e))?void 0:r.get(t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.delete(t),this._pointChange.next(s))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=new Map,this._model.set(e,t)),t}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}class sx{constructor(e,t,r){k(this,"type",t9.SelectRange),k(this,"subType",t6.Delete),k(this,"status",E.PermissionStatus.INIT),k(this,"value",!0),k(this,"id"),k(this,"unitId"),k(this,"subUnitId"),k(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${t9.SelectRange}.${t6.Delete}.${r}`}}class sU{constructor(e,t,r){k(this,"type",t9.SelectRange),k(this,"subType",t6.ManageCollaborator),k(this,"status",E.PermissionStatus.INIT),k(this,"value",!0),k(this,"id"),k(this,"unitId"),k(this,"subUnitId"),k(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${t9.SelectRange}.${t6.ManageCollaborator}.${r}`}}let sD=()=>[t7,t8,sU,sx],sV=[t6.Edit,t6.View,t6.ManageCollaborator,t6.Delete],sL=(e="unitId",t="subUnitId",r="permissionId")=>sD().reduce((n,i)=>{let s=new i(e,t,r);return n[s.subType]=s.value,n},{}),sP=()=>[ru,rC,re,rE,rt,rc,rf,ri,ro,ry,rh,rl,rR,rp,rr,rb,r_,rn,rg,rm,ra,rs],sk=[t6.Edit,t6.Print,t6.Comment,t6.View,t6.Copy,t6.Export,t6.ManageCollaborator,t6.CreateSheet,t6.DeleteSheet,t6.RenameSheet,t6.HideSheet,t6.Duplicate,t6.Share,t6.MoveSheet,t6.CopySheet,t6.RecoverHistory,t6.ViewHistory,t6.CreatePermissionObject,t6.InsertRow,t6.InsertColumn,t6.DeleteRow,t6.DeleteColumn],sF=()=>[rv,r$,rU,rS],sj=()=>[rI,rN,rA,rT,rw,rM,rx,rO,rD,rP,rk,rF,rj,rB],sB=[t6.Copy,t6.DeleteColumn,t6.DeleteRow,t6.EditExtraObject,t6.Filter,t6.InsertColumn,t6.InsertRow,t6.InsertHyperlink,t6.PivotTable,t6.SetCellStyle,t6.SetCellValue,t6.SetColumnStyle,t6.SetRowStyle,t6.Sort];var s$=Object.getOwnPropertyDescriptor,sH=(e,t)=>(r,n)=>t(r,n,e);let sW=class extends E.RxDisposable{constructor(e,t,r,n,i,s,a,o){super(),this._permissionService=e,this._univerInstanceService=t,this._injector=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointRuleModel=i,this._resourceManagerService=s,this._rangeProtectionRuleModel=a,this._logService=o,this._init(),this._initRuleChange(),this._initRuleSnapshot(),this._initPointSnapshot()}_init(){let e=e=>{let t=e.getUnitId(),r=e=>{let r=e.getSheetId();[...sF(),...sj()].forEach(e=>{let n=new e(t,r);this._permissionService.addPermissionPoint(n)}),this._logService.debug("[WorksheetPermissionService]","Initialization completed",t,r)};e.getSheets().forEach(e=>{r(e)}),e.sheetCreated$.subscribe(e=>{r(e)}),e.sheetDisposed$.subscribe(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...sD()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...sF(),...sj()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})})};this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this._univerInstanceService.getTypeOfUnitAdded$(E.UniverInstanceType.UNIVER_SHEET).pipe((0,D.takeUntil)(this.dispose$)).subscribe(e),this._univerInstanceService.getTypeOfUnitDisposed$(E.UniverInstanceType.UNIVER_SHEET).pipe((0,D.takeUntil)(this.dispose$)).subscribe(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();sF().forEach(e=>{let t=new e(r,n);this._permissionService.deletePermissionPoint(t.id)})})})}_initRuleChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":break;case"delete":sF().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,!0)});break;case"set":sF().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,e.rule)})}}))}_initRuleSnapshot(){let e=()=>JSON.stringify(this._worksheetProtectionRuleModel.toObject());this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_PLUGIN",businesses:[t4.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionRuleModel.fromObject(t),Object.keys(t).forEach(t=>{sF().forEach(r=>{let n=new r(e,t);n.value=!1,this._permissionService.addPermissionPoint(n)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)},onUnLoad:e=>{let t=this._univerInstanceService.getUnit(e);t&&(t.getSheets().forEach(t=>{let r=t.getSheetId();[...sF(),...sj()].forEach(t=>{let n=new t(e,r);this._permissionService.deletePermissionPoint(n.id)})}),sP().forEach(t=>{let r=new t(e);this._permissionService.deletePermissionPoint(r.id)})),this._worksheetProtectionRuleModel.deleteUnitModel(e)}}))}_initPointSnapshot(){let e=()=>JSON.stringify(this._worksheetProtectionPointRuleModel.toObject());this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_POINT_PLUGIN",businesses:[t4.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionPointRuleModel.fromObject(t),Object.keys(t).forEach(t=>{sj().forEach(r=>{let n=new r(e,t);this._permissionService.addPermissionPoint(n)})})},onUnLoad:e=>{this._worksheetProtectionPointRuleModel.deleteUnitModel(e)}}))}};sW=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?s$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sH(0,(0,b.Inject)(E.IPermissionService)),sH(1,(0,b.Inject)(E.IUniverInstanceService)),sH(2,(0,b.Inject)(b.Injector)),sH(3,(0,b.Inject)(id)),sH(4,(0,b.Inject)(sO)),sH(5,(0,b.Inject)(E.IResourceManagerService)),sH(6,(0,b.Inject)(tv)),sH(7,(0,b.Inject)(E.ILogService))],sW);let sG={id:"sheet.mutation.set-worksheet-permission-points",type:E.CommandType.MUTATION,handler:(e,t)=>{let{rule:r}=t;return e.get(sO).addRule(r),!0}},sY={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-permission-points",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),{rule:n}=t;return r.executeCommand(sG.id,{rule:n,unitId:n.unitId,subUnitId:n.subUnitId}),!0}},sz={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),{rule:i,permissionId:s,oldRule:a}=t,{unitId:o,subUnitId:l}=i,u={...i,permissionId:s};if(await r.executeCommand(i1.id,{unitId:o,subUnitId:l,newRule:u})){let e=[{id:i1.id,params:{unitId:o,subUnitId:l,newRule:u}}],t=[{id:i1.id,params:{unitId:o,subUnitId:l,rule:a}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}},sX={id:"sheet.mutation.set-worksheet-right-to-left",type:E.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().rightToLeft=t.rightToLeft,!0)}},sq={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-right-to-left",handler:async(e,t)=>{var r;let n=e.get(E.ICommandService),i=e.get(E.IUndoRedoService),s=ec(e.get(E.IUniverInstanceService),t);if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=E.BooleanNumber.FALSE;t&&(l=null!=(r=t.rightToLeft)?r:E.BooleanNumber.FALSE);let u={rightToLeft:l,unitId:a,subUnitId:o},c=((e,t)=>{let r=e.get(E.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().rightToLeft;return{...E.Tools.deepClone(t),rightToLeft:r}})(e,u);return!!n.syncExecuteCommand(sX.id,u)&&(i.pushUndoRedo({unitID:a,undoMutations:[{id:sX.id,params:c}],redoMutations:[{id:sX.id,params:u}]}),!0)}},sK={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-row-count",handler:(e,t)=>{let{unitId:r,subUnitId:n,rowCount:i}=t,s=e.get(E.ICommandService),a=e.get(E.IUndoRedoService);if(!ec(e.get(E.IUniverInstanceService),t))return!1;let o={unitId:r,subUnitId:n,rowCount:i},l=eQ(e,o);return!!s.syncExecuteCommand(eZ.id,o)&&(a.pushUndoRedo({unitID:r,undoMutations:[{id:eZ.id,params:l}],redoMutations:[{id:eZ.id,params:o}]}),!0)}},sQ={type:E.CommandType.COMMAND,id:"sheet.command.delta-row-height",handler:async(e,t)=>{var r,n;let i,s=e.get(tL).getCurrentSelections(),a=e.get(Q);if(!(null!=s&&s.length))return!1;let o=ec(e.get(E.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o,{anchorRow:h,deltaY:d}=t,m=l.getRowHeight(h)+d,g=1===s.length&&s[0].range.rangeType===E.RANGE_TYPE.ALL,f=s.filter(e=>e.range.rangeType===E.RANGE_TYPE.ROW),p=g?E.RANGE_TYPE.ALL:f.some(({range:e})=>{let{startRow:t,endRow:r}=e;return t<=h&&h<=r})?E.RANGE_TYPE.ROW:E.RANGE_TYPE.NORMAL;if(p===E.RANGE_TYPE.ALL){let e=l.getColumnCount();i={subUnitId:u,unitId:c,rowHeight:m,ranges:Array(l.getRowCount()).fill(void 0).map((t,r)=>({startRow:r,endRow:r,startColumn:0,endColumn:e-1}))}}else i=p===E.RANGE_TYPE.ROW?{subUnitId:u,unitId:c,ranges:f.map(e=>E.Rectangle.clone(e.range)),rowHeight:m}:{subUnitId:u,unitId:c,rowHeight:m,ranges:[{startRow:h,endRow:h,startColumn:0,endColumn:l.getMaxColumns()-1}]};let C=eJ(i,l),_={unitId:c,subUnitId:u,ranges:i.ranges,autoHeightInfo:E.BooleanNumber.FALSE},y=e0(_,l),R=e.get(E.ICommandService),b=e.get(E.IUndoRedoService),I=a.onCommandExecute({id:sQ.id,params:i}),N=(0,E.sequenceExecute)([{id:e2.id,params:i},{id:e5.id,params:_}],R),S=(0,E.sequenceExecute)([...I.redos],R);return!!N.result&&!!S.result&&(b.pushUndoRedo({unitID:c,undoMutations:[...null!=(r=I.preUndos)?r:[],{id:e2.id,params:C},{id:e5.id,params:y},...I.undos],redoMutations:[...null!=(n=I.preRedos)?n:[],{id:e2.id,params:i},{id:e5.id,params:_},...I.redos]}),!0)}},sZ={type:E.CommandType.COMMAND,id:"sheet.command.set-row-height",handler:(e,t)=>{var r,n,i,s;let a=e.get(tL),o=e.get(E.ICommandService),l=e.get(E.IUndoRedoService),u=e.get(E.IUniverInstanceService),c=e.get(Q),h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d=ec(u,t);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f}=d,p={subUnitId:g,unitId:m,ranges:h,rowHeight:t.value},C=eJ(p,f),_={unitId:m,subUnitId:g,ranges:p.ranges,autoHeightInfo:E.BooleanNumber.FALSE},y=e0(_,f),R=(0,E.sequenceExecute)([{id:e2.id,params:p},{id:e5.id,params:_}],o),b=c.onCommandExecute({id:sZ.id,params:p}),I=(0,E.sequenceExecute)([...b.redos],o);return!!R.result&&!!I.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=b.preRedos)?i:[],{id:e2.id,params:C},{id:e5.id,params:y},...b.undos],redoMutations:[...null!=(s=b.preRedos)?s:[],{id:e2.id,params:p},{id:e5.id,params:_},...b.redos]}),!0)}},sJ={type:E.CommandType.COMMAND,id:"sheet.command.set-row-is-auto-height",handler:(e,t)=>{var r,n;let i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(tL),o=ec(e.get(E.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u,worksheet:c}=o,h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d={unitId:l,subUnitId:u,ranges:h,autoHeightInfo:E.BooleanNumber.TRUE},m=e0(d,c),g=i.syncExecuteCommand(e5.id,d),f=e.get(ny).getSkeleton(l,u),{suitableRanges:p,remainingRanges:C}=nE(d.ranges,f),_=e.get(Q),{undos:y,redos:R}=_.generateMutationsOfAutoHeight({unitId:l,subUnitId:u,ranges:p,autoHeightRanges:p,lazyAutoHeightRanges:C}),{undos:b,redos:I}=_.onCommandExecute({id:sJ.id,params:d}),N=(0,E.sequenceExecute)([...I,...R],i);return!!g&&!!N.result&&(s.pushUndoRedo({unitID:l,undoMutations:[{id:e5.id,params:m},...b,...y],redoMutations:[{id:e5.id,params:d},...I,...R]}),!0)}},s0={type:E.CommandType.COMMAND,id:"sheet.command.set-worksheet-show",handler:(e,t)=>{let{unitId:r,subUnitId:n}=t,i=e.get(E.ICommandService),s=e.get(E.IUndoRedoService),a=e.get(E.IUniverInstanceService);if(!ec(e.get(E.IUniverInstanceService)))return!1;let o=a.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getSheetBySheetId(n);if(!l||l.getConfig().hidden===E.BooleanNumber.FALSE)return!1;let u={unitId:r,subUnitId:n,hidden:E.BooleanNumber.FALSE},c=sN(e,u),h=i.syncExecuteCommand(sS.id,u),d=i.syncExecuteCommand(e6.id,{unitId:r,subUnitId:n});return!!h&&!!d&&(s.pushUndoRedo({unitID:r,undoMutations:[{id:sS.id,params:c}],redoMutations:[{id:sS.id,params:u}]}),!0)}},s1={type:E.CommandType.COMMAND,id:"sheet.command.split-text-to-columns",handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,delimiter:s,customDelimiter:a,treatMultipleDelimitersAsOne:o}=t,l=e.get(E.ICommandService),u=e.get(E.IUniverInstanceService),c=e.get(E.IUndoRedoService);if(!ec(e.get(E.IUniverInstanceService)))return!1;let h=u.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!h)return!1;let d=h.getSheetBySheetId(n);if(!d)return!1;let{lastRow:m,rs:g,maxLength:f}=ty(d,i,s,a,o),p=d.getColumnCount(),{startColumn:C}=E.Range.transformRange(i,d);if(i.startColumn!==i.endColumn)return!1;let _=[],y=[],R=C+f+1-p;if(R>0){let t={unitId:r,subUnitId:n,range:{startRow:0,endRow:d.getRowCount()-1,startColumn:p-1,endColumn:p-1+R}};_.push({id:ey.id,params:t});let i=e_(e,t);y.push({id:eA.id,params:i})}let b={startRow:i.startRow,endRow:m,startColumn:C,endColumn:C+f},I=new(0,E.ObjectMatrix);for(let e=b.startRow;e<=b.endRow;e++)for(let t=b.startColumn;t<=b.endColumn;t++){let r=g[e-b.startRow];0===t&&(null==r?void 0:r.length)===1?I.setValue(e,t,d.getCell(e,t)):I.setValue(e,t,{v:(null==r?void 0:r[t-b.startColumn])||null,p:null,f:null,si:null,custom:null})}let N={unitId:r,subUnitId:n,cellValue:I.clone()},S=ek(e,N);return _.push({id:eF.id,params:N}),y.unshift({id:eF.id,params:S}),!!(0,E.sequenceExecute)(_,l).result&&(c.pushUndoRedo({unitID:r,undoMutations:y,redoMutations:_}),!0)}},s2={id:"sheet.command.toggle-cell-checkbox",type:E.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,row:i,col:s,paragraphIndex:a}=t,o=e.get(E.IUniverInstanceService).getUnit(r,E.UniverInstanceType.UNIVER_SHEET),l=null==o?void 0:o.getSheetBySheetId(n),u=e.get(E.IUndoRedoService),c=e.get(E.ICommandService);if(!l)return!1;let h=l.getCell(i,s);if(!(null!=h&&h.p))return!1;let d=E.Tools.deepClone(h.p),m=new(0,E.DocumentDataModel)(d),g=E.BuildTextUtils.paragraph.bullet.toggleChecklist({document:m,paragraphIndex:a});if(!g)return!1;E.TextX.apply(m.getBody(),g.serialize());let f={unitId:r,subUnitId:n,cellValue:{[i]:{[s]:{p:d,t:E.CellValueType.STRING}}}},p={id:eF.id,params:f},C=ek(e,f),_={id:eF.id,params:C},y=[p];return u.pushUndoRedo({redoMutations:y,undoMutations:[_],unitID:r}),c.syncExecuteCommand(p.id,p.params)}},s5={type:E.CommandType.COMMAND,id:"sheet.command.toggle-gridlines",handler:(e,t)=>{let r=e.get(E.ICommandService),n=e.get(E.IUndoRedoService),i=ec(e.get(E.IUniverInstanceService));if(!i)return!1;let{worksheet:s}=i,a=s.getConfig().showGridlines;if(a===(null==t?void 0:t.showGridlines))return!1;let{unitId:o,subUnitId:l}=i,u={showGridlines:a===E.BooleanNumber.TRUE?E.BooleanNumber.FALSE:E.BooleanNumber.TRUE,unitId:o,subUnitId:l};return!!r.syncExecuteCommand(e4.id,u)&&(n.pushUndoRedo({unitID:o,undoMutations:[{id:e4.id,params:{showGridlines:a,unitId:o,subUnitId:l}}],redoMutations:[{id:e4.id,params:u}]}),!0)}},s3={id:"sheet.command.unregister-worksheet-range-theme-style",type:E.CommandType.COMMAND,handler:(e,t)=>{var r;if(!t)return!1;let{unitId:n,themeName:i}=t,s=e.get(E.IUniverInstanceService),a=e.get(E.ICommandService),o=e.get(E.IUndoRedoService),l=e.get(el);if(!ec(s))return!1;let u={unitId:n,themeName:i,rangeThemeStyleJson:null==(r=l.getRangeThemeStyle(n,i))?void 0:r.toJson()};return a.syncExecuteCommand(iT.id,t)&&o.pushUndoRedo({unitID:n,undoMutations:[{id:iT.id,params:u}],redoMutations:[{id:iw.id,params:{unitId:n,themeName:i}}]}),!0}},s4={id:"sheet.mutation.add-range-theme",type:E.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{styleJSON:r,unitId:n}=t,i=e.get(el),s=new ee(r.name);return s.fromJson(r),i.registerRangeThemeStyle(n,s),!0}},s6={id:"sheet.mutation.empty",type:E.CommandType.MUTATION,handler:()=>!0},s9={id:"sheet.operation.mark-dirty-row-auto-height",type:E.CommandType.OPERATION,handler:()=>!0},s8={id:"sheet.operation.cancel-mark-dirty-row-auto-height",type:E.CommandType.OPERATION,handler:()=>!0},s7=(0,b.createIdentifier)("INumfmtService"),ae=(e,t)=>{let r=e.get(s7),{values:n,unitId:i,subUnitId:s}=t,a=[],o=[];Object.keys(n).forEach(e=>{n[e].ranges.forEach(e=>{E.Range.foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n?a.push({pattern:n.pattern,row:e,col:t}):o.push({startColumn:t,endColumn:t,startRow:e,endRow:e})})})});let l=[];if(a.length){let e=ai(i,s,a);Object.keys(e.values).forEach(t=>{let r=e.values[t];r.ranges=th(r.ranges)}),l.push({id:at.id,params:ai(i,s,a)})}return o.length&&l.push({id:ar.id,params:{unitId:i,subUnitId:s,ranges:o}}),l},at={id:"sheet.mutation.set.numfmt",type:E.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{values:r,refMap:n}=t,i=e.get(s7),s=t.unitId,a=t.subUnitId,o=Object.keys(r).reduce((e,t)=>{let i=n[t],s=r[t].ranges;return i&&e.push({...i,ranges:s}),e},[]);return i.setValues(s,a,o),!0}},ar={id:"sheet.mutation.remove.numfmt",type:E.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,ranges:i}=t;return e.get(s7).deleteValues(r,n,i),!0}},an=(e,t)=>{let r=e.get(s7),{ranges:n,unitId:i,subUnitId:s}=t,a=[];if(n.forEach(e=>{E.Range.foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n&&a.push({pattern:n.pattern,row:e,col:t})})}),!a.length)return[];let o=ai(i,s,a);return Object.keys(o.values).forEach(e=>{let t=o.values[e];t.ranges=th(t.ranges)}),[{id:at.id,params:o}]},ai=(e,t,r)=>{let n=((e,t,r="")=>e.reduce((e,n)=>{let i=n&&n[t];return"string"!=typeof i?console.warn(n,`${t} is not string`):i?(e[i]||(e[i]=[]),e[i].push(n)):e[r].push(n),e},{}))(r,"pattern"),i={},s={},a=((e=0)=>{let t=e;return function(){return t++}})();return Object.keys(n).forEach(e=>{let t=n[e],r=a();i[r]={pattern:e},t.forEach(e=>{s[r]||(s[r]={ranges:[]}),s[r].ranges.push((0,E.cellToRange)(e.row,e.col))})}),{unitId:e,subUnitId:t,refMap:i,values:s}},as={id:"sheet.mutation.remove-range-theme",type:E.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{styleName:r,unitId:n}=t;return e.get(el).unregisterRangeThemeStyle(n,r),!0}},aa={id:"sheet.mutation.set-range-theme",type:E.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{unitId:r,styleName:n,style:i}=t,s=e.get(el).getRangeThemeStyle(r,n);return s&&(i.headerRowStyle&&s.setHeaderRowStyle(i.headerRowStyle),i.firstRowStyle&&s.setFirstRowStyle(i.firstRowStyle),i.secondRowStyle&&s.setSecondRowStyle(i.secondRowStyle),i.lastRowStyle&&s.setLastRowStyle(i.lastRowStyle)),!0}},ao={id:"sheet.operation.scroll-to-cell",type:E.CommandType.OPERATION,handler:()=>!0},al=(e,t,r)=>{let n=e.get(tL).getCurrentSelections(),{value:i,selections:s,unitId:a,subUnitId:o}=t;if(n){let e=n[(null==n?void 0:n.length)-1].primary;if(e){let{actualColumn:t,actualRow:l}=e,{startRow:u,startColumn:c,endRow:h,endColumn:d}=s[s.length-1];if(i===E.Dimension.COLUMNS){let e=r.find(e=>e.startColumn===t&&e.endColumn===t&&l===e.startRow);e&&(d=e.endColumn,u=e.startRow,h=e.endRow)}else if(i===E.Dimension.ROWS){let e=r.find(e=>e.startRow===l&&e.endRow===l&&t===e.startColumn);e&&(h=e.endRow,c=e.startColumn,d=e.endColumn)}let m={startRow:u,startColumn:c,endRow:h,endColumn:d,actualRow:l,actualColumn:t,isMerged:!0,isMergedMainCell:u===l&&c===t},g=n.map((e,t,r)=>({range:e.range,style:null,primary:t===r.length-1?m:null})),f={unitId:a,subUnitId:o,type:tU.ONLY_SET,selections:g};return{id:t0.id,params:f}}}return null},au=(e,t)=>{let r=e.get(tL).getCurrentSelections(),{unitId:n,subUnitId:i}=t;if(r&&r[(null==r?void 0:r.length)-1].primary){let e={unitId:n,subUnitId:i,type:tU.ONLY_SET,selections:[...r]};return{id:t0.id,params:e}}return null},ac="maxCellsPerSheet";var ah=Object.getOwnPropertyDescriptor,ad=(e,t)=>(r,n)=>t(r,n,e);let am="AllDefaultWorkbook",ag=class extends E.Disposable{constructor(e,t){super(),this._definedNamesService=e,this._resourceManagerService=t,this._initialize()}_initialize(){this._initSnapshot()}_initSnapshot(){let e=e=>{let t=this._definedNamesService.getDefinedNameMap(e);return t?JSON.stringify(t):""};this.disposeWithMe(this._resourceManagerService.registerPluginResource({pluginName:"SHEET_DEFINED_NAME_PLUGIN",businesses:[E.UniverInstanceType.UNIVER_SHEET],toJson:t=>e(t),parseJson:e=>(e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}})(e),onUnLoad:e=>{this._definedNamesService.removeUnitDefinedName(e)},onLoad:(e,t)=>{this._definedNamesService.registerDefinedNames(e,t)}}))}};ag=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ah(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ad(0,V.IDefinedNamesService),ad(1,E.IResourceManagerService)],ag);var af=Object.getOwnPropertyDescriptor,ap=(e,t)=>(r,n)=>t(r,n,e);let aC=class extends E.Disposable{constructor(e,t,r,n,i,s,a,o,l,u){super(),k(this,"disposableCollection",new(0,E.DisposableCollection)),k(this,"_triggerPermissionUIEvent$",new(0,x.Subject)),k(this,"triggerPermissionUIEvent$",this._triggerPermissionUIEvent$.asObservable()),this._commandService=e,this._univerInstanceService=t,this._permissionService=r,this._selectionManagerService=n,this._rangeProtectionRuleModel=i,this._worksheetProtectionRuleModel=s,this._localeService=a,this._lexerTreeBuilder=o,this._contextService=l,this._definedNamesService=u,this._initialize()}blockExecuteWithoutPermission(e){throw this._triggerPermissionUIEvent$.next(e),new(0,E.CustomCommandExecutionError)("have no permission")}_getPermissionCheck(e,t){let r=!0,n="";switch(e){case rH.id:(0,E.isICellData)(t.value)&&t.value.f?(r=this._permissionCheckWithFormula(t),n=this._localeService.t("permission.dialog.formulaErr")):r=this._permissionCheckBySetRangeValue({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rk,rv]},t);break;case iy.id:r=this.permissionCheckWithRanges({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rk,rv]}),n=this._localeService.t("permission.dialog.editErr");break;case sR.id:case sE.id:r=this.permissionCheckWithoutRange({worksheetTypes:[rF]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case sQ.id:case sZ.id:case sJ.id:r=this.permissionCheckWithoutRange({worksheetTypes:[rj]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case np.id:case ng.id:r=this._permissionCheckByMoveCommand(t),n=this._localeService.t("permission.dialog.moveRowColErr");break;case t5.id:r=this._permissionCheckByMoveRangeCommand(t),n=this._localeService.t("permission.dialog.moveRangeErr");break;case sM.id:r=this._permissionCheckByWorksheetCommand([ru,rp]),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder();break;case sT.id:r=this._permissionCheckByWorksheetCommand([ru,ry]),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder();break;case s0.id:{let{unitId:e,subUnitId:i}=t;r=this._permissionCheckByWorksheetCommand([ru,rh],e,i),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder()}break;case iH.id:r=this.permissionCheckWithRanges({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rv,rF]},t.ranges),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case i3.id:r=this.permissionCheckWithRanges({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rv,rj]},t.ranges),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case iW.id:r=this.permissionCheckWithRanges({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rv,rF]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case i4.id:r=this.permissionCheckWithRanges({workbookTypes:[ru],rangeTypes:[t8],worksheetTypes:[rv,rj]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case r0.id:r=this._permissionCheckWithInsertRangeMove("right"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case rZ.id:r=this._permissionCheckWithInsertRangeMove("bottom"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case rq.id:r=this._permissionCheckWithInsertRangeMove("left"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case rQ.id:r=this._permissionCheckWithInsertRangeMove("top"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr")}r||this.blockExecuteWithoutPermission(n)}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{this._getPermissionCheck(e.id,null==e?void 0:e.params)})),this.disposeWithMe(this._commandService.onCommandExecuted(e=>{var t;if(e.id===sv.id){let{unitId:r=null==(t=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET))?void 0:t.getUnitId(),subUnitId:n}=e.params;if(!r||!n)return;let i=this._worksheetProtectionRuleModel.getRule(r,n),s=this._rangeProtectionRuleModel.getSubunitRuleList(r,n);i&&this._worksheetProtectionRuleModel.ruleRefresh(i.permissionId),s.length&&this._rangeProtectionRuleModel.ruleRefresh(n)}}))}_permissionCheckWithInsertRangeMove(e){var t;let r=ec(this._univerInstanceService);if(!r)return!1;let{worksheet:n,unitId:i,subUnitId:s}=r,a=E.Tools.deepClone(null==(t=this._selectionManagerService.getCurrentLastSelection())?void 0:t.range);return!(!a||("top"===e||"bottom"===e?a.endRow=n.getRowCount()-1:("left"===e||"right"===e)&&(a.endColumn=n.getColumnCount()-1),this._rangeProtectionRuleModel.getSubunitRuleList(i,s).map(e=>e.ranges).flat().some(e=>E.Rectangle.getIntersects(a,e))))}_permissionCheckByWorksheetCommand(e,t,r){var n,i;let s=ec(this._univerInstanceService,{unitId:t,subUnitId:r});if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=this._worksheetProtectionRuleModel.getRule(a,o),u=this._rangeProtectionRuleModel.getSubunitRuleList(a,o).length>0;return l||u?null!=(i=null==(n=this._permissionService.getPermissionPoint(new rf(a).id))?void 0:n.value)&&i:this._permissionService.composePermission(e.map(e=>new e(a).id)).every(e=>e.value)}permissionCheckWithoutRange(e){var t,r,n,i;let s=ec(this._univerInstanceService);if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=this._selectionManagerService.getCurrentLastSelection();if(!u)return!0;let c=null!=(r=null==(t=null==u?void 0:u.primary)?void 0:t.actualRow)?r:0,h=null!=(i=null==(n=null==u?void 0:u.primary)?void 0:n.actualColumn)?i:0,{workbookTypes:d,worksheetTypes:m,rangeTypes:g}=e;return!(d&&!0===d.some(e=>{var t,r;let n=new e(o);return(null!=(r=null==(t=this._permissionService.getPermissionPoint(n.id))?void 0:t.value)&&r)===!1})||m&&!0===m.some(e=>{var t,r;let n=new e(o,l);return(null!=(r=null==(t=this._permissionService.getPermissionPoint(n.id))?void 0:t.value)&&r)===!1})||g&&!0===g.some(e=>{var t,r,n,i,s;let u=null==(r=null==(t=a.getCell(c,h))?void 0:t.selectionProtection)?void 0:r[0];if(!(null!=u&&u.ruleId))return!1;let d=null==(n=this._rangeProtectionRuleModel.getRule(o,l,u.ruleId))?void 0:n.permissionId;if(!d)return!1;let m=new e(o,l,d);return(null!=(s=null==(i=this._permissionService.getPermissionPoint(m.id))?void 0:i.value)&&s)===!1}))}permissionCheckWithRanges(e,t,r,n){var i;let s=ec(this._univerInstanceService);if(!s)return!1;let{workbook:a,worksheet:o}=s;r||(r=a.getUnitId()),n||(n=o.getSheetId());let l=null!=t?t:null==(i=this._selectionManagerService.getCurrentSelections())?void 0:i.map(e=>e.range);if(!l)return!1;let{workbookTypes:u,worksheetTypes:c,rangeTypes:h}=e,d=[];return u&&d.push(...u.map(e=>new e(r).id)),c&&d.push(...c.map(e=>new e(r,n).id)),h&&this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(e=>{l.some(t=>e.ranges.some(e=>E.Rectangle.intersects(e,t)))&&d.push(...h.map(t=>new t(r,n,e.permissionId).id))}),!d.length||this._permissionService.composePermission(d).every(e=>e.value)}_permissionCheckByMoveCommand(e){let t=ec(this._univerInstanceService);if(!t)return!1;let{worksheet:r,unitId:n,subUnitId:i}=t,s=e.toRange;s.endRow===r.getRowCount()-1?s.endColumn=s.startColumn:s.endRow=s.startRow;let a=this._rangeProtectionRuleModel.getSubunitRuleList(n,i).reduce((e,t)=>[...e,...t.ranges],[]).filter(e=>E.Rectangle.intersects(e,s));return!(a.length>0)&&(a.forEach(e=>{var t,n;for(let i=e.startRow;i<=e.endRow;i++)for(let s=e.startColumn;s<=e.endColumn;s++){let e=null==(n=null==(t=r.getCell(i,s))?void 0:t.selectionProtection)?void 0:n[0];if((null==e?void 0:e[t6.Edit])===!1)return!1}}),!0)}_permissionCheckByMoveRangeCommand(e){let t=ec(this._univerInstanceService);if(!t)return!1;let{worksheet:r,unitId:n,subUnitId:i}=t,s=e.toRange,a=this._rangeProtectionRuleModel.getSubunitRuleList(n,i).reduce((e,t)=>[...e,...t.ranges],[]).filter(e=>E.Rectangle.intersects(e,s));return!(a.length>0)&&(a.forEach(e=>{var t,n;for(let i=e.startRow;i<=e.endRow;i++)for(let s=e.startColumn;s<=e.endColumn;s++){let e=null==(n=null==(t=r.getCell(i,s))?void 0:t.selectionProtection)?void 0:n[0];if((null==e?void 0:e[t6.Edit])===!1)return!1}}),!0)}_permissionCheckBySetRangeValue(e,t){let r=[];r=t.range?[t.range]:[new(0,E.ObjectMatrix)(t.value).getDataRange()];let{unitId:n,subUnitId:i}=t;return this.permissionCheckWithRanges(e,r,n,i)}_permissionCheckWithFormula(e){var t,r,n,i,s;let a=e.value,o=e.range,l=a.f;if(l){let a=l.substring(1),o=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET),u=null!=(t=e.unitId)?t:o.getUnitId(),c=this._definedNamesService.getValueByName(u,a);if(c){let e=c.formulaOrRefString;e.startsWith(V.operatorToken.EQUALS)&&(e=e.slice(1));let t=e.split(",");for(let e=0;e<t.length;e++){let i=t[e],s=(0,V.deserializeRangeWithSheet)(i);if(s.sheetName){let e=o.getSheetBySheetName(s.sheetName);if(!e)return!0;let{startRow:t,endRow:i,startColumn:a,endColumn:l}=s.range;for(let s=t;s<=i;s++)for(let t=a;t<=l;t++){let i=null==(n=null==(r=e.getCell(s,t))?void 0:r.selectionProtection)?void 0:n[0];if((null==i?void 0:i[t6.View])===!1)return!1}}}return!0}{let e=this._lexerTreeBuilder.sequenceNodesBuilder(l);if(!e)return!0;for(let t=0;t<e.length;t++){let r=e[t];if("string"==typeof r||r.nodeType!==V.sequenceNodeType.REFERENCE)continue;let{token:n}=r,a=(0,V.deserializeRangeWithSheetWithCache)(n),o=a.unitId?this._univerInstanceService.getUnit(a.unitId):this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!o)break;let l=a.sheetName?o.getSheetBySheetName(a.sheetName):o.getActiveSheet(),u=o.getUnitId();if(a.sheetName){if(!(l=o.getSheetBySheetName(a.sheetName)))return!0;let e=null==l?void 0:l.getSheetId();if(!this._permissionService.getPermissionPoint(new r$(u,e).id))return!1}if(!l)break;let{startRow:c,endRow:h,startColumn:d,endColumn:m}=a.range;for(let e=c;e<=h;e++)for(let t=d;t<=m;t++){let r=null==(s=null==(i=l.getCell(e,t))?void 0:i.selectionProtection)?void 0:s[0];if((null==r?void 0:r[t6.View])===!1)return!1}}return!0}}if(o){let t=ec(this._univerInstanceService);if(!t)return!1;let r=e.unitId||t.unitId,n=e.subUnitId||t.subUnitId,i=this._rangeProtectionRuleModel.getSubunitRuleList(r,n).filter(e=>e.ranges.some(e=>E.Rectangle.intersects(e,o))).map(e=>new t8(r,n,e.permissionId).id);if(!this._permissionService.composePermission(i).every(e=>e.value))return!1}return!0}};aC=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?af(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ap(0,E.ICommandService),ap(1,E.IUniverInstanceService),ap(2,E.IPermissionService),ap(3,(0,b.Inject)(tL)),ap(4,(0,b.Inject)(tv)),ap(5,(0,b.Inject)(id)),ap(6,(0,b.Inject)(E.LocaleService)),ap(7,(0,b.Inject)(V.LexerTreeBuilder)),ap(8,E.IContextService),ap(9,V.IDefinedNamesService)],aC);var a_=Object.getOwnPropertyDescriptor,ay=(e,t)=>(r,n)=>t(r,n,e);let aR=class extends E.Disposable{constructor(e,t,r,n,i){super(),k(this,"_unitPermissionInitStateChange",new(0,I.BehaviorSubject)(!1)),k(this,"unitPermissionInitStateChange$",this._unitPermissionInitStateChange.asObservable()),this._permissionService=e,this._univerInstanceService=t,this._rangeProtectionRuleModel=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointModel=i,this._init()}_init(){let e=e=>{let t=e.getUnitId();sP().forEach(e=>{let r=new e(t);this._permissionService.addPermissionPoint(r)})};this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(E.UniverInstanceType.UNIVER_SHEET).subscribe(t=>{e(t)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(E.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{let t=e.getUnitId();e.getSheets().forEach(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...sD()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...sF(),...sj()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})}),sP().forEach(e=>{let r=new e(t);this._permissionService.deletePermissionPoint(r.id)}),this._rangeProtectionRuleModel.deleteUnitModel(t),this._worksheetProtectionPointModel.deleteUnitModel(t),this._worksheetProtectionRuleModel.deleteUnitModel(t)}))}changeUnitInitState(e){this._unitPermissionInitStateChange.next(e)}};aR=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a_(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ay(0,(0,b.Inject)(E.IPermissionService)),ay(1,(0,b.Inject)(E.IUniverInstanceService)),ay(2,(0,b.Inject)(tv)),ay(3,(0,b.Inject)(id)),ay(4,(0,b.Inject)(sO))],aR);var aE=Object.getOwnPropertyDescriptor,ab=(e,t)=>(r,n)=>t(r,n,e);let aI=class extends E.Disposable{constructor(e,t,r,n,i,s,a,o,l,u){super(),this._univerInstanceService=e,this._permissionService=t,this._authzIoService=r,this._rangeProtectionRuleModel=n,this._worksheetProtectionRuleModel=i,this._userManagerService=s,this._worksheetProtectionPointRuleModel=a,this._workbookPermissionService=o,this._undoRedoService=l,this._commandService=u}initPermission(){this._initRangePermissionFromSnapshot(),this._initRangePermissionChange(),this._initWorksheetPermissionFromSnapshot(),this._initWorksheetPermissionChange(),this._initWorksheetPermissionPointsChange(),this._initWorkbookPermissionFromSnapshot(),this._initUserChange(),this._refreshPermissionByCollaCreate()}async _initRangePermissionFromSnapshot(){let e=async e=>{let t=[],r=e.getUnitId(),n=e.getSheets(),i=new Map;if(n.forEach(e=>{let n=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(e=>{i.set(e.permissionId,e),t.push({objectID:e.permissionId,unitID:r,objectType:t9.SelectRange,actions:sV})})}),!t.length)return void this._rangeProtectionRuleModel.changeRuleInitState(!0);this._authzIoService.batchAllowed(t).then(e=>{e.forEach(e=>{let t=i.get(e.objectID);t&&sD().forEach(n=>{let i=new n(r,t.subUnitId,e.objectID),s=i.subType,a=e.actions.find(e=>e.action===s);(null==a?void 0:a.allowed)!==void 0&&this._permissionService.updatePermissionPoint(i.id,a.allowed)})}),this._rangeProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).map(t=>e(t))),this._rangeProtectionRuleModel.changeRuleInitState(!0)}_initRangePermissionChange(){this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe(e=>{"delete"!==e.type?this._authzIoService.allowed({objectID:e.rule.permissionId,unitID:e.unitId,objectType:t9.SelectRange,actions:sV}).then(t=>{sD().forEach(r=>{if("set"===e.type){let{rule:t,oldRule:r}=e;if(t.permissionId===(null==r?void 0:r.permissionId))return}let n=e.rule,i=new r(n.unitId,n.subUnitId,n.permissionId),s=i.subType,a=t.find(e=>e.action===s);a&&this._permissionService.updatePermissionPoint(i.id,a.allowed)}),this._rangeProtectionRuleModel.ruleRefresh(e.rule.permissionId)}):0===this._rangeProtectionRuleModel.getSubunitRuleList(e.unitId,e.subUnitId).length&&(this._worksheetProtectionPointRuleModel.deleteRule(e.unitId,e.subUnitId),[...sj()].forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,r.value)}))}))}async initWorkbookPermissionChange(e){var t;let r=e||(null==(t=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET))?void 0:t.getUnitId());if(r)return this._authzIoService.allowed({objectID:r,objectType:t9.Workbook,unitID:r,actions:sk}).then(e=>{sP().forEach(t=>{let n=new t(r),i=n.subType,s=e.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)})})}async _initWorkbookPermissionFromSnapshot(){await Promise.all(this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).map(e=>this.initWorkbookPermissionChange(e.getUnitId()))),this._workbookPermissionService.changeUnitInitState(!0)}_initWorksheetPermissionChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{"delete"!==e.type?this._authzIoService.allowed({objectID:e.rule.permissionId,unitID:e.unitId,objectType:t9.Worksheet,actions:sV}).then(t=>{sF().forEach(r=>{let n=new r(e.unitId,e.subUnitId),i=n.subType,s=t.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)}),this._worksheetProtectionRuleModel.ruleRefresh(e.rule.permissionId)}):([...sF(),...sj()].forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,!0)}),this._worksheetProtectionPointRuleModel.deleteRule(e.unitId,e.subUnitId))}))}_initWorksheetPermissionPointsChange(){this.disposeWithMe(this._worksheetProtectionPointRuleModel.pointChange$.subscribe(e=>{this._authzIoService.allowed({objectID:e.permissionId,unitID:e.unitId,objectType:t9.Worksheet,actions:sB}).then(t=>{sj().forEach(r=>{let n=new r(e.unitId,e.subUnitId),i=n.subType,s=t.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)})})}))}async _initWorksheetPermissionFromSnapshot(){let e=async e=>{let t=[],r=e.getUnitId(),n=e.getSheets(),i=new Map;if(n.forEach(e=>{let n=e.getSheetId(),s=this._worksheetProtectionRuleModel.getRule(r,n);s&&(i.set(s.permissionId,s),t.push({objectID:s.permissionId,unitID:r,objectType:t9.Worksheet,actions:sV}));let a=this._worksheetProtectionPointRuleModel.getRule(r,n);a&&(i.set(a.permissionId,a),t.push({objectID:a.permissionId,unitID:r,objectType:t9.Worksheet,actions:sB}))}),!t.length)return void this._worksheetProtectionRuleModel.changeRuleInitState(!0);this._authzIoService.batchAllowed(t).then(e=>{e.forEach(e=>{let t=i.get(e.objectID);t&&[...sF(),...sj()].forEach(n=>{let i=new n(r,t.subUnitId),s=i.subType,a=e.actions.find(e=>e.action===s);(null==a?void 0:a.allowed)!==void 0&&this._permissionService.updatePermissionPoint(i.id,a.allowed)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).map(t=>e(t))),this._worksheetProtectionRuleModel.changeRuleInitState(!0)}_initUserChange(){this.disposeWithMe(this._userManagerService.currentUser$.pipe((0,O.skip)(1)).subscribe(()=>{let e=this._permissionService.getAllPermissionPoint();this._permissionService.clearPermissionMap(),this._worksheetProtectionRuleModel.changeRuleInitState(!1),this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).forEach(t=>{let r=t.getUnitId();sP().forEach(t=>{let n=new t(r);e.has(n.id)&&(n=e.get(n.id)),this._permissionService.addPermissionPoint(n)}),t.getSheets().forEach(t=>{let n=t.getSheetId();[...sF(),...sj()].forEach(t=>{let i=new t(r,n);e.has(i.id)&&(i=e.get(i.id)),this._permissionService.addPermissionPoint(i)}),this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(t=>{sD().forEach(i=>{let s=new i(r,n,t.permissionId);e.has(s.id)&&(s=e.get(s.id)),this._permissionService.addPermissionPoint(s)})})}),this._initWorkbookPermissionFromSnapshot(),this._initWorksheetPermissionFromSnapshot(),this._initRangePermissionFromSnapshot()})}))}refreshPermission(e,t){let r=this._worksheetProtectionRuleModel.getTargetByPermissionId(e,t),n=!1;if(r){let[i,s]=r;this._authzIoService.allowed({objectID:t,unitID:e,objectType:t9.Worksheet,actions:sV}).then(r=>{let i="";sF().forEach(t=>{var a;let o=new t(e,s),l=o.subType,u=r.find(e=>e.action===l);u&&((null==(a=this._permissionService.getPermissionPoint(o.id))?void 0:a.value)!==u.allowed&&(n=!0),this._permissionService.updatePermissionPoint(o.id,u.allowed),i+=`${u.action}_${u.allowed}`)}),this._worksheetProtectionRuleModel.ruleRefresh(`${t}_${i}`),n&&this._undoRedoService.clearUndoRedo(e)})}let i=this._worksheetProtectionPointRuleModel.getTargetByPermissionId(e,t);if(i){let[r,s]=i;this._authzIoService.allowed({objectID:t,unitID:e,objectType:t9.Worksheet,actions:sB}).then(t=>{sj().forEach(r=>{var i;let a=new r(e,s),o=a.subType,l=t.find(e=>e.action===o);l&&((null==(i=this._permissionService.getPermissionPoint(a.id))?void 0:i.value)!==l.allowed&&(n=!0),this._permissionService.updatePermissionPoint(a.id,l.allowed))}),n&&this._undoRedoService.clearUndoRedo(e)})}let s=this._rangeProtectionRuleModel.getTargetByPermissionId(e,t);if(s){let[r,i]=s;this._authzIoService.allowed({objectID:t,unitID:e,objectType:t9.SelectRange,actions:sV}).then(r=>{let s="";sD().forEach(a=>{var o;let l=new a(e,i,t),u=l.subType,c=r.find(e=>e.action===u);c&&((null==(o=this._permissionService.getPermissionPoint(l.id))?void 0:o.value)!==c.allowed&&(n=!0),this._permissionService.updatePermissionPoint(l.id,c.allowed),s+=`${c.action}_${c.allowed}`)}),this._rangeProtectionRuleModel.ruleRefresh(`${t}_${s}`),n&&this._undoRedoService.clearUndoRedo(e)})}}_refreshPermissionByCollaCreate(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{if(null!=t&&t.fromCollab&&(e.id===tO.id||e.id===im.id||e.id===sG.id)){let t=e.params;this._undoRedoService.clearUndoRedo(t.unitId)}}))}};aI=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aE(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ab(0,E.IUniverInstanceService),ab(1,E.IPermissionService),ab(2,E.IAuthzIoService),ab(3,(0,b.Inject)(tv)),ab(4,(0,b.Inject)(id)),ab(5,(0,b.Inject)(E.UserManagerService)),ab(6,(0,b.Inject)(sO)),ab(7,(0,b.Inject)(aR)),ab(8,(0,b.Inject)(E.IUndoRedoService)),ab(9,(0,b.Inject)(E.ICommandService))],aI);var aN=Object.getOwnPropertyDescriptor,aS=(e,t)=>(r,n)=>t(r,n,e);let aA=class{constructor(e,t){k(this,"_cache",new(0,E.LRUMap)(1e4)),this._selectionProtectionRuleModel=e,this._permissionService=t,this._init()}_init(){this._permissionService.permissionPointUpdate$.pipe((0,S.filter)(e=>e.type===t9.SelectRange),(0,S.filter)(e=>sD().some(t=>e instanceof t)),(0,v.map)(e=>e)).subscribe(e=>{for(let t of this._selectionProtectionRuleModel.getSubunitRuleList(e.unitId,e.subUnitId))t.permissionId===e.permissionId&&t.ranges.forEach(t=>{E.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})})}),this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{var t;e.rule.ranges.forEach(t=>{E.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(t=>{E.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}))})}_createKey(e,t,r,n){return`${e}_${t}_${r}_${n}`}getCellInfo(e,t,r,n){let i=this._selectionProtectionRuleModel.getSubunitRuleList(e,t);if(!i||!i.length)return[];let s=this._createKey(e,t,r,n),a=this._cache.get(s);if(a)return a;let o=[];for(let s of i)if(s.ranges.some(e=>e.startRow<=r&&e.endRow>=r&&e.startColumn<=n&&e.endColumn>=n)){let r=sD().reduce((r,n)=>{var i;let a=new n(e,t,s.permissionId),o=this._permissionService.getPermissionPoint(a.id);return r[a.subType]=null!=(i=null==o?void 0:o.value)?i:a.value,r},{});o.push({...r,ruleId:s.id,ranges:s.ranges})}return this._cache.set(s,o),o}clear(){this._cache.clear()}};aA=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aN(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aS(0,(0,b.Inject)(tv)),aS(1,(0,b.Inject)(E.IPermissionService))],aA);var av=Object.getOwnPropertyDescriptor,aT=(e,t)=>(r,n)=>t(r,n,e);let aw=class extends E.Disposable{constructor(e,t,r){super(),k(this,"_cellRuleCache",new Map),k(this,"_permissionIdCache",new Map),k(this,"_cellInfoCache",new Map),k(this,"_rowInfoCache",new Map),k(this,"_colInfoCache",new Map),this._ruleModel=e,this._permissionService=t,this._univerInstanceService=r,this._initUpdateCellRuleCache(),this._initUpdateCellInfoCache(),this._initUpdateRowColInfoCache(),this._initCache()}_initCache(){this._univerInstanceService.getAllUnitsForType(E.UniverInstanceType.UNIVER_SHEET).forEach(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();this.reBuildCache(r,n)})})}_initUpdateCellInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,S.filter)(e=>e.type===t9.SelectRange),(0,v.map)(e=>e)).subscribe(e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureCellInfoMap(r,t);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;for(let e=t;e<=r;e++)for(let t=n;t<=i;t++)a.delete(`${e}-${t}`)})}),this._ruleModel.ruleChange$.subscribe(e=>{var t;let{unitId:r,subUnitId:n}=e,i=this._ensureCellInfoMap(r,n);e.rule.ranges.forEach(e=>{E.Range.foreach(e,(e,t)=>{i.delete(`${e}-${t}`)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(e=>{E.Range.foreach(e,(e,t)=>{this._cellInfoCache.delete(`${e}-${t}`)})}))})}_initUpdateCellRuleCache(){this._ruleModel.ruleChange$.subscribe(e=>{let{type:t}=e;"add"===t?this._addCellRuleCache(e):"delete"===t?this._deleteCellRuleCache(e):(this._deleteCellRuleCache({...e,rule:e.oldRule}),this._addCellRuleCache(e))})}_ensureRuleMap(e,t){let r=this._cellRuleCache.get(e);r||(r=new Map,this._cellRuleCache.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}_ensureCellInfoMap(e,t){let r=this._cellInfoCache.get(e);r||(r=new Map,this._cellInfoCache.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}_ensureRowColInfoMap(e,t,r){let n="row"===r?this._rowInfoCache.get(e):this._colInfoCache.get(e);n||(n=new Map,"row"===r?this._rowInfoCache.set(e,n):this._colInfoCache.set(e,n));let i=n.get(t);return i||(i=new Map,n.set(t,i)),i}_addCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:s,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=s;t<=a;t++)i.set(`${e}-${t}`,n.id)}),this._permissionIdCache.set(n.permissionId,n.id)}_deleteCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t),s=this._ensureCellInfoMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=n;t<=a;t++)i.delete(`${e}-${t}`),s.delete(`${e}-${t}`)}),this._permissionIdCache.delete(n.permissionId)}_getSelectionActions(e,t,r){var n,i,s,a,o,l,u,c;let h=null==(i=null==(n=this._permissionService.getPermissionPoint(new t8(e,t,r.permissionId).id))?void 0:n.value)||i,d=null==(a=null==(s=this._permissionService.getPermissionPoint(new t7(e,t,r.permissionId).id))?void 0:s.value)||a,m=null!=(l=null==(o=this._permissionService.getPermissionPoint(new sU(e,t,r.permissionId).id))?void 0:o.value)&&l,g=null!=(c=null==(u=this._permissionService.getPermissionPoint(new sx(e,t,r.permissionId).id))?void 0:u.value)&&c;return{[t6.Edit]:h,[t6.View]:d,[t6.ManageCollaborator]:m,[t6.Delete]:g}}reBuildCache(e,t){let r=this._ensureRuleMap(e,t),n=this._ensureCellInfoMap(e,t);r.clear(),n.clear();let i=this._ensureRowColInfoMap(e,t,"row"),s=this._ensureRowColInfoMap(e,t,"col");i.clear(),s.clear(),this._ruleModel.getSubunitRuleList(e,t).forEach(a=>{let o=this._getSelectionActions(e,t,a),l={...o,ruleId:a.id,ranges:a.ranges};a.ranges.forEach(e=>{let{startRow:t,endRow:u,startColumn:c,endColumn:h}=e;for(let e=t;e<=u;e++){let t=i.get(`${e}`);t?t.set(a.id,o):i.set(`${e}`,new Map([[a.id,o]]));for(let t=c;t<=h;t++){r.set(`${e}-${t}`,a.id),n.set(`${e}-${t}`,l);let i=s.get(`${t}`);i?i.set(a.id,o):s.set(`${t}`,new Map([[a.id,o]]))}}}),this._permissionIdCache.set(a.permissionId,a.id)})}getRowPermissionInfo(e,t,r,n){var i;let s=null==(i=this._rowInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}getColPermissionInfo(e,t,r,n){var i;let s=null==(i=this._colInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}_initUpdateRowColInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,S.filter)(e=>e.type===t9.SelectRange),(0,v.map)(e=>e)).subscribe({next:e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureRowColInfoMap(r,t,"row"),o=this._ensureRowColInfoMap(r,t,"col"),l=this._getSelectionActions(r,t,s);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:s}=e;for(let e=t;e<=r;e++){let t=a.get(`${e}`);t?t.set(i,l):a.set(`${e}`,new Map([[i,l]]));for(let e=n;e<=s;e++){let t=o.get(`${e}`);t?t.set(i,l):o.set(`${e}`,new Map([[i,l]]))}}})}}),this._ruleModel.ruleChange$.subscribe(e=>{if("delete"===e.type){let{unitId:t,subUnitId:r,rule:n}=e,i=this._ensureRowColInfoMap(t,r,"row"),s=this._ensureRowColInfoMap(t,r,"col");n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:a,endColumn:o}=e;for(let e=t;e<=r;e++){let t=i.get(`${e}`);null==t||t.delete(n.id);for(let e=a;e<=o;e++){let t=s.get(`${e}`);null==t||t.delete(n.id)}}})}})}getCellInfo(e,t,r,n){var i,s;let a=this._ensureCellInfoMap(e,t),o=a.get(`${r}-${n}`);if(o)return o;let l=null==(s=null==(i=this._cellRuleCache.get(e))?void 0:i.get(t))?void 0:s.get(`${r}-${n}`);if(!l)return;let u=this._ruleModel.getRule(e,t,l);if(u){let i={...this._getSelectionActions(e,t,u),ruleId:l,ranges:u.ranges};return a.set(`${r}-${n}`,i),i}}deleteUnit(e){this._cellRuleCache.delete(e),this._cellInfoCache.delete(e),this._rowInfoCache.delete(e),this._colInfoCache.delete(e);let t=this._univerInstanceService.getUnit(e);null==t||t.getSheets().forEach(t=>{let r=t.getSheetId();this._ruleModel.getSubunitRuleList(e,r).forEach(e=>{this._permissionIdCache.delete(e.permissionId)})})}};aw=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?av(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aT(0,(0,b.Inject)(tv)),aT(1,(0,b.Inject)(E.IPermissionService)),aT(2,(0,b.Inject)(E.IUniverInstanceService))],aw);let aM="ONLY_REGISTER_FORMULA_RELATED_MUTATIONS_KEY";var aO=Object.getOwnPropertyDescriptor,ax=(e,t)=>(r,n)=>t(r,n,e);let aU=class extends E.Disposable{constructor(e,t,r){var n;super(),this._commandService=e,this._configService=t,this._dataSyncPrimaryController=r,[eF,ey,eC,iE,eR,eb,eN,eA,eS,nd,eT,ar,$,sC,sv,at,eM,s6,eW,eH,s9,s8].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)}),null!=(n=this._configService.getConfig(aM))&&n||[i_,tj,iy,tB,ib,rq,rQ,sR,sQ,nr,nt,nn,ni,ne,r7,rZ,r0,r4,r3,r9,r6,r5,r2,iv,np,t5,ng,na,nc,nu,no,ix,nI,iU,sc,sl,su,iB,ij,iP,ik,iF,iG,eU,eD,sE,i$,ex,iK,iq,iQ,sd,rH,sZ,i6,i5,e$,iW,i4,iH,i3,i7,sp,sf,so,sg,sm,sh,s_,sy,e6,sA,sS,sT,sM,sw,e3,e2,sJ,e5,eY,sK,eZ,sb,eX,t1,t0,ao,iA,iO,iz,s0,s5,e4,iZ,eV,sY,im,i1,ig,sG,tx,i2,iI,ip,iN,sz,tO,tw,iJ,s2,eq,sI,s1,eg,ed,iw,iT,s3,iM,iC,iS,s4,aa,as].forEach(e=>this.disposeWithMe(this._commandService.registerCommand(e))),this._configService.setConfig(ac,3e6)}};aU=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aO(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ax(0,E.ICommandService),ax(1,E.IConfigService),ax(2,(0,b.Optional)(L.DataSyncPrimaryController))],aU);var aD=Object.getOwnPropertyDescriptor,aV=(e,t)=>(r,n)=>t(r,n,e);let aL=class extends E.Disposable{constructor(e,t){super(),this._univerInstanceService=e,this._commandService=t,this._initialize()}_initialize(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id!==V.SetFormulaCalculationResultMutation.id)return;let{unitData:t}=e.params,r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];if(null==s)continue;let a=Object.keys(s);for(let e=0;e<a.length;e++){let t=a[e],r=s[t];if(null==r)continue;let o=this._getMergedCellData(i,t,r),l={subUnitId:t,unitId:i,cellValue:o};n.push({id:eF.id,params:l})}}return n.every(e=>this._commandService.executeCommand(e.id,e.params,{onlyLocal:!0,fromFormula:!0}))}))}_getMergedCellData(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e),i=null==n?void 0:n.getStyles(),s=null==n?void 0:n.getSheetBySheetId(t),a=null==s?void 0:s.getCellMatrix(),o=new(0,E.ObjectMatrix)(r);return o.forValue((e,t,r)=>{let n=null==a?void 0:a.getValue(e,t),s=(0,V.handleNumfmtInCell)(n,r,i);o.setValue(e,t,s)}),o.getMatrix()}};aL=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aV(0,(0,b.Inject)(E.IUniverInstanceService)),aV(1,E.ICommandService)],aL);let aP={};var ak=Object.getOwnPropertyDescriptor;let aF=class extends E.Disposable{constructor(e){super(),this._sheetInterceptorService=e,this._initialize()}_initialize(){this._initInterceptorCellContent()}_initInterceptorCellContent(){this.disposeWithMe(this._sheetInterceptorService.intercept(H.CELL_CONTENT,{priority:11,effect:E.InterceptorEffectEnum.Value|E.InterceptorEffectEnum.Style,handler:(e,t,r)=>{var n;let i=t.workbook.getStyles().getStyleByCell(e);return null!=(n=null==i?void 0:i.n)&&n.pattern||(null==e?void 0:e.t)===E.CellValueType.NUMBER&&void 0!==e.v&&null!==e.v&&(0,E.isRealNum)(e.v)&&(e&&e!==t.rawData||(e={...t.rawData}),e.v=(0,V.stripErrorMargin)(Number(e.v))),r(e)}}))}};aF=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ak(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(y=(0,b.Inject)(Q),(e,t)=>y(e,t,0))],aF);var aj=Object.getOwnPropertyDescriptor,aB=(e,t)=>(r,n)=>t(r,n,e);let a$=class extends E.Disposable{constructor(e,t,r,n){super(),this._permissionService=e,this._worksheetProtectionRuleModel=t,this._sheetInterceptorService=r,this._rangeProtectionCache=n,this._initViewModelByRangeInterceptor(),this._initViewModelBySheetInterceptor()}_initViewModelByRangeInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(H.CELL_CONTENT,{priority:999,effect:E.InterceptorEffectEnum.Value|E.InterceptorEffectEnum.Style,handler:(e={},t,r)=>{let{unitId:n,subUnitId:i,row:s,col:a}=t,o=this._rangeProtectionCache.getCellInfo(n,i,s,a);if(o){let n=!1===o[t6.View],i=e&&e!==t.rawData?e:{...t.rawData};return i.selectionProtection=[o],n?(delete i.s,delete i.v,delete i.p,i):r(i)}return r(e)}}))}_initViewModelBySheetInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(H.CELL_CONTENT,{priority:999,effect:E.InterceptorEffectEnum.Value|E.InterceptorEffectEnum.Style,handler:(e={},t,r)=>{var n,i,s,a,o;let{unitId:l,subUnitId:u}=t,c=this._worksheetProtectionRuleModel.getRule(l,u);if(null!=c&&c.permissionId){let c=[{[t6.View]:null!=(i=null==(n=this._permissionService.getPermissionPoint(new r$(l,u).id))?void 0:n.value)&&i,[t6.Edit]:null!=(a=null==(s=this._permissionService.getPermissionPoint(new rv(l,u).id))?void 0:s.value)&&a}],h=!(null!=(o=c[0])&&o[t6.View]),d=e&&e!==t.rawData?e:{...e};return d.hasWorksheetRule=!0,d.selectionProtection=c,h?(delete d.s,delete d.v,delete d.p,d):r(d)}return r(e)}}))}};a$=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aj(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aB(0,E.IPermissionService),aB(1,(0,b.Inject)(id)),aB(2,(0,b.Inject)(Q)),aB(3,(0,b.Inject)(aw))],a$);let aH=(0,b.createIdentifier)("univer.exclusive-range-service");class aW extends E.Disposable{constructor(){super(...arguments),k(this,"_exclusiveRanges",new Map),k(this,"_exclusiveRangesChange$",new(0,x.Subject)),k(this,"exclusiveRangesChange$",this._exclusiveRangesChange$.asObservable())}_ensureUnitMap(e){return this._exclusiveRanges.has(e)||this._exclusiveRanges.set(e,new Map),this._exclusiveRanges.get(e)}_ensureSubunitMap(e,t){let r=this._ensureUnitMap(e);return r.has(t)||r.set(t,new Map),r.get(t)}_ensureFeature(e,t,r){let n=this._ensureSubunitMap(e,t);return n.has(r)||n.set(r,[]),n.get(r)}addExclusiveRange(e,t,r,n){let i=this._ensureFeature(e,t,r);i.push(...n),this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:i.map(e=>e.range)})}getExclusiveRanges(e,t,r){var n,i;return null==(i=null==(n=this._exclusiveRanges.get(e))?void 0:n.get(t))?void 0:i.get(r)}clearExclusiveRanges(e,t,r){let n=this.getExclusiveRanges(e,t,r);this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:(null==n?void 0:n.map(e=>e.range))||[]}),this._ensureFeature(e,t,r),this._exclusiveRanges.get(e).get(t).set(r,[])}clearExclusiveRangesByGroupId(e,t,r,n){let i=this.getExclusiveRanges(e,t,r);this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:(null==i?void 0:i.map(e=>e.range))||[]});let s=this.getExclusiveRanges(e,t,r);if(s){let i=s.filter(e=>e.groupId!==n);this._exclusiveRanges.get(e).get(t).set(r,i)}}getInterestGroupId(e){let t=[];return e.forEach(e=>{var r;let n=e.range,{unitId:i,sheetId:s}=n;if(!i||!s)return;let a=null==(r=this._exclusiveRanges.get(i))?void 0:r.get(s);if(a)for(let e of a.keys()){let r=a.get(e);if(r){for(let i of r)if(E.Rectangle.intersects(n,i.range)){t.push(e);break}}}}),t}}var aG=Object.getOwnPropertyDescriptor,aY=(e,t)=>(r,n)=>t(r,n,e);let az=class extends E.Disposable{constructor(e,t,r){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._logService=r}getValue(e,t,r,n){let i=this._univerInstanceService.getUniverSheetInstance(e);if(!i)return;let s=null==i?void 0:i.getSheetBySheetId(t);if(!s)return;let a=i.getStyles(),o=s.getCellRaw(r,n);if(null!=o&&o.s){let e=a.get(o.s);if(null!=e&&e.n)return e.n}return null}deleteValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles();r.forEach(e=>{E.Range.foreach(e,(e,t)=>{let r=i.getCellRaw(e,t);if(!r)return;let n=null==r?void 0:r.s,a={...n&&s.get(n)||{}};delete a.n,r.s=s.setValue(a)})})}setValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles(),a=i.getCellMatrix();r.forEach(e=>{e.ranges.forEach(t=>{E.Range.foreach(t,(t,r)=>{let n=i.getCellRaw(t,r);if(n){let t={...s.getStyleByCell(n)||{},n:{pattern:e.pattern}};n.s=s.setValue(t)}else{let n={n:{pattern:e.pattern}},i=s.setValue(n);i&&a.setValue(t,r,{s:i})}})})})}};az=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aG(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aY(0,E.IResourceManagerService),aY(1,E.IUniverInstanceService),aY(2,E.ILogService)],az);var aX=Object.getOwnPropertyDescriptor,aq=(e,t)=>(r,n)=>t(r,n,e);let aK=[ey.id,eC.id,eA.id,eS.id],aQ=[eb.id,eN.id],aZ=class extends E.Disposable{constructor(e,t,r,n,i,s,a,o){super(),k(this,"disposableCollection",new(0,E.DisposableCollection)),this._selectionProtectionRuleModel=e,this._univerInstanceService=t,this._commandService=r,this._refRangeService=n,this._selectionProtectionRenderModel=i,this._rangeProtectionCache=s,this._sheetInterceptorService=a,this._rangeProtectionRuleModel=o,this._onRefRangeChange(),this._correctPermissionRange(),this._initReBuildCache(),this._initRemoveSheet()}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!r||!(null==r?void 0:r.getSheetBySheetId(t)))return;this.disposableCollection.dispose();let n=r=>this.refRangeHandle(r,e,t);this._selectionProtectionRuleModel.getSubunitRuleList(e,t).reduce((e,t)=>[...e,...t.ranges],[]).forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,n,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===sy.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}if(t.id===iJ.id||t.id===tO.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}}));let t=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(t){let r=t.getActiveSheet();if(!r)return;e(t.getUnitId(),r.getSheetId())}}refRangeHandle(e,t,r){switch(e.id){case ng.id:return this._getRefRangeMutationsByMoveRows(e.params,t,r);case np.id:return this._getRefRangeMutationsByMoveCols(e.params,t,r);case r2.id:return this._getRefRangeMutationsByInsertRows(e.params,t,r);case r7.id:return this._getRefRangeMutationsByInsertCols(e.params,t,r);case nc.id:return this._getRefRangeMutationsByDeleteCols(e.params,t,r);case no.id:return this._getRefRangeMutationsByDeleteRows(e.params,t,r)}return{redos:[],undos:[]}}_getRefRangeMutationsByDeleteCols(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>E.Rectangle.intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=E.Tools.deepClone(n),o=a.ranges.reduce((e,t)=>{if(E.Rectangle.intersects(t,i)){let r=E.Tools.deepClone(t),{startColumn:n,endColumn:s}=i;if(n<=r.startColumn&&s>=r.endColumn)return e;n>=r.startColumn&&s<=r.endColumn?r.endColumn-=s-n+1:n<r.startColumn?(r.startColumn=n,r.endColumn-=s-n+1):s>r.endColumn&&(r.endColumn=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,a.ranges.length?(e.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})):(e.push({id:tw.id,params:{unitId:t,subUnitId:r,ruleIds:[n.id]}}),s.push({id:tO.id,params:{unitId:t,subUnitId:r,name:"",rules:[n]}}))}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByDeleteRows(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>E.Rectangle.intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=E.Tools.deepClone(n),o=a.ranges.reduce((e,t)=>{if(E.Rectangle.intersects(t,i)){let r=E.Tools.deepClone(t),{startRow:n,endRow:s}=i;if(n<=r.startRow&&s>=r.endRow)return e;n>=r.startRow&&s<=r.endRow?r.endRow-=s-n+1:n<r.startRow?(r.startRow=n,r.endRow-=s-n+1):s>r.endRow&&(r.endRow=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,e.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertCols(e,t,r){let n=e.range.startColumn,i=e.range.endColumn-e.range.startColumn+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startColumn&&n<=e.endColumn));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=E.Tools.deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startColumn&&n<=e.endColumn&&(e.endColumn+=i,l=!0)}),l&&(e.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertRows(e,t,r){let n=e.range.startRow,i=e.range.endRow-e.range.startRow+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startRow&&n<=e.endRow));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=E.Tools.deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startRow&&n<=e.endRow&&(e.endRow+=i,l=!0)}),l&&(e.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveRows(e,t,r){let n=e.toRange,i=n.startRow,s=n.endRow-n.startRow+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startRow&&i<=e.endRow));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=E.Tools.deepClone(a),u=e.fromRange.startRow,c=!1;l.ranges.forEach(e=>{i>e.startRow&&i<=e.endRow&&(u<e.startRow&&(e.startRow=e.startRow-s,e.endRow=e.endRow-s),e.endRow+=s,c=!0)}),c&&(n.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveCols(e,t,r){let n=e.toRange,i=n.startColumn,s=n.endColumn-n.startColumn+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startColumn&&i<=e.endColumn));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=E.Tools.deepClone(a),u=e.fromRange.startColumn,c=!1;l.ranges.forEach(e=>{i>e.startColumn&&i<=e.endColumn&&(u<e.startColumn&&(e.startColumn=e.startColumn-s,e.endColumn=e.endColumn-s),e.endColumn+=s,c=!0)}),c&&(n.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:iJ.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_correctPermissionRange(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(aQ.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getCurrentUnitForType(E.UniverInstanceType.UNIVER_SHEET);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u}=e;E.Rectangle.intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),this._checkIsRightRange({startRow:t,endRow:r,startColumn:i,endColumn:u})&&(e.startColumn=i,e.endColumn=u,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:u,subUnitId:c}=e.params,h=e=>this.refRangeHandle(e,u,c);this._selectionProtectionRuleModel.getSubunitRuleList(u,c).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,h,u,c))}),this._selectionProtectionRenderModel.clear()}if(aK.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=e.params;if(!n)return;let{range:i}=n,s=e.id.includes("row"),a=e.id.includes("insert"),o=s?i.startRow:i.startColumn,l=s?i.endRow:i.endColumn,u=l-o+1;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;a?s?o<=t&&(t+=u,r+=u):o<=n&&(n+=u,i+=u):s?l<t&&(t-=u,r-=u):l<n&&(n-=u,i-=u),this._checkIsRightRange({startRow:t,endRow:r,startColumn:n,endColumn:i})&&(e.startColumn=n,e.endColumn=i,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:c,subUnitId:h}=e.params,d=e=>this.refRangeHandle(e,c,h);this._selectionProtectionRuleModel.getSubunitRuleList(c,h).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,d,c,h))}),this._selectionProtectionRenderModel.clear()}}))}_checkIsRightRange(e){return e.startRow<=e.endRow&&e.startColumn<=e.endColumn}_initReBuildCache(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(aK.includes(e.id)||aQ.includes(e.id)){let{unitId:t,subUnitId:r}=e.params;this._rangeProtectionCache.reBuildCache(t,r)}}))}_initRemoveSheet(){this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=[],r=[];if(e.id===ix.id){let n=e.params,i=[],s=[];this._rangeProtectionRuleModel.getSubunitRuleList(n.unitId,n.subUnitId).forEach(e=>{i.push(e.id),s.push(e)}),i.length&&s.length&&(r.push({id:tw.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,ruleIds:i}}),t.push({id:tO.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,name:"",rules:s}}))}return{redos:[],undos:t,preRedos:r,preUndos:[]}}})}};aZ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aq(0,(0,b.Inject)(tv)),aq(1,(0,b.Inject)(E.IUniverInstanceService)),aq(2,E.ICommandService),aq(3,(0,b.Inject)(n5)),aq(4,(0,b.Inject)(aA)),aq(5,(0,b.Inject)(aw)),aq(6,(0,b.Inject)(Q)),aq(7,(0,b.Inject)(tv))],aZ);var aJ=Object.getOwnPropertyDescriptor,a0=(e,t)=>(r,n)=>t(r,n,e);let a1=class extends E.Disposable{constructor(e,t,r,n,i){super(),this._selectionProtectionRuleModel=e,this._permissionService=t,this._resourceManagerService=r,this._selectionProtectionCache=n,this._univerInstanceService=i,this._initSnapshot(),this._initRuleChange()}_initRuleChange(){this.disposeWithMe(this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":sD().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(r)});break;case"delete":sD().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.deletePermissionPoint(r.id)});break;case"set":e.oldRule.permissionId!==e.rule.permissionId&&sD().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.oldRule.permissionId);this._permissionService.deletePermissionPoint(r.id);let n=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(n)})}}))}_initSnapshot(){let e=e=>{let t=this._selectionProtectionRuleModel.toObject()[e];return t?JSON.stringify(t):""};this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e,parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_RANGE_PROTECTION_PLUGIN",businesses:[t4.UNIVER_SHEET],onLoad:(e,t)=>{let r=this._selectionProtectionRuleModel.toObject();r[e]=t,this._selectionProtectionRuleModel.fromObject(r);let n=[];Object.keys(t).forEach(r=>{let i=t[r];this._selectionProtectionRuleModel.getSubunitRuleList(e,r).forEach(t=>{n.push({objectID:t.permissionId,unitID:e,objectType:t9.SelectRange,actions:sV})}),i.forEach(t=>{sD().forEach(n=>{let i=new n(e,r,t.permissionId);i.value=!1,this._permissionService.addPermissionPoint(i)})}),this._selectionProtectionCache.reBuildCache(e,r)})},onUnLoad:e=>{this._selectionProtectionCache.deleteUnit(e)}}))}};a1=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aJ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([a0(0,(0,b.Inject)(tv)),a0(1,(0,b.Inject)(E.IPermissionService)),a0(2,(0,b.Inject)(E.IResourceManagerService)),a0(3,(0,b.Inject)(aw)),a0(4,(0,b.Inject)(E.IUniverInstanceService))],a1);var a2=Object.getOwnPropertyDescriptor;let a5=class extends E.Disposable{constructor(e){super(),this._sheetRangeThemeModel=e}registerRangeTheme(e,t){this._sheetRangeThemeModel.registerRangeThemeStyle(e,t)}removeRangeThemeRule(e,t){this._sheetRangeThemeModel.removeRangeThemeRule(e,t)}getALLRegisterThemes(e){return this._sheetRangeThemeModel.getALLRegisteredTheme(e)}registerRangeThemeStyle(e,t){this._sheetRangeThemeModel.registerRangeThemeRule(e,t)}getAppliedRangeThemeStyle(e){return this._sheetRangeThemeModel.getRegisteredRangeThemeStyle(e)}getRegisteredRangeThemes(){return this._sheetRangeThemeModel.getRegisteredRangeThemes()}};a5=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a2(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(R=(0,b.Inject)(el),(e,t)=>R(e,t,0))],a5);var a3=Object.defineProperty,a4=Object.getOwnPropertyDescriptor,a6=(e,t)=>(r,n)=>t(r,n,e),a9=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?a3(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r};let a8=class extends E.Plugin{constructor(e=aP,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=(0,E.merge)({},aP,this._config);this._configService.setConfig("sheets.config",n),this._initConfig(),this._initDependencies()}_initConfig(){var e,t,r;null!=(e=this._config)&&e.onlyRegisterFormulaRelatedMutations&&this._configService.setConfig(aM,!0),null!=(t=this._config)&&t.isRowStylePrecedeColumnStyle&&this._configService.setConfig(E.IS_ROW_STYLE_PRECEDE_COLUMN_STYLE,!0),null!=(r=this._config)&&r.autoHeightForMergedCells&&this._configService.setConfig(E.AUTO_HEIGHT_FOR_MERGED_CELLS,!0)}_initDependencies(){var e;let t=[[iD],[tL],[n5],[aR],[s7,{useClass:az}],[Q],[a5],[ny],[aU],[ii],[aF],[ag],[sW],[id],[sO],[a$],[aI],[aC],[el],[aA],[tv],[aw],[aZ],[a1],[aH,{useClass:aW,deps:[tL]}]];null!=(e=this._config)&&e.notExecuteFormula||t.push([aL]),(0,E.registerDependencies)(this._injector,(0,E.mergeOverrideWithDependencies)(t,this._config.override)),(0,E.touchDependencies)(this._injector,[[Q],[a1],[aH],[aI]])}onStarting(){(0,E.touchDependencies)(this._injector,[[aU],[ii],[aR],[sW],[a$],[ny]])}onRendered(){(0,E.touchDependencies)(this._injector,[[s7]])}onReady(){(0,E.touchDependencies)(this._injector,[[aL],[ag],[el],[aF],[aA],[aZ],[n5],[aC]])}};a9(a8,"pluginName","SHEET_PLUGIN"),a9(a8,"type",E.UniverInstanceType.UNIVER_SHEET),a8=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a4(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(0,E.DependentOn)(V.UniverFormulaEnginePlugin),a6(1,(0,b.Inject)(b.Injector)),a6(2,E.IConfigService)],a8);let a7={WorkbookCommentPermission:re,WorkbookCopyPermission:rt,WorkbookCreateProtectPermission:rn,WorkbookCreateSheetPermission:ri,WorkbookDeleteSheetPermission:ro,WorkbookDuplicatePermission:rl,WorkbookEditablePermission:ru,WorkbookExportPermission:rc,WorkbookHideSheetPermission:rh,WorkbookHistoryPermission:rd,WorkbookManageCollaboratorPermission:rf,WorkbookMoveSheetPermission:rp,WorkbookPrintPermission:rC,WorkbookRecoverHistoryPermission:r_,WorkbookRenameSheetPermission:ry,WorkbookSharePermission:rR,WorkbookViewHistoryPermission:rb,WorkbookViewPermission:rE,WorksheetCopyPermission:rI,WorksheetDeleteColumnPermission:rN,WorksheetDeleteProtectionPermission:rS,WorksheetDeleteRowPermission:rA,WorksheetEditExtraObjectPermission:rT,WorksheetEditPermission:rv,WorksheetFilterPermission:rw,WorksheetInsertColumnPermission:rM,WorksheetInsertHyperlinkPermission:rO,WorksheetInsertRowPermission:rx,WorksheetManageCollaboratorPermission:rU,WorksheetPivotTablePermission:rD,WorksheetSetCellStylePermission:rP,WorksheetSetCellValuePermission:rk,WorksheetSetColumnStylePermission:rF,WorksheetSetRowStylePermission:rj,WorksheetSortPermission:rB,WorksheetViewPermission:r$,RangeProtectionPermissionEditPoint:t8,RangeProtectionPermissionViewPoint:t7},oe=(e,t,r,n)=>{let i=e.get(E.IPermissionService),s=e.get(tv),a=i.getPermissionPoint(new ru(t).id);if(!(null!=a&&a.value))return!1;let o=i.getPermissionPoint(new rv(t,r).id);if(!(null!=o&&o.value))return!1;let l=s.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n.some(t=>E.Rectangle.intersects(e,t))));return!l.length||l.every(e=>{let n=e.permissionId,s=i.getPermissionPoint(new t8(t,r,n).id);return!!(null!=s&&s.value)})},ot=(e,t,r,n=1,i=!0,s=!0)=>{let{startRow:a,endRow:o}=E.Range.transformRange(e,t),l=r.startRow-n,u=t.getMergedCell(l,r.startColumn),c=!u||u.startRow===l&&u.startColumn===r.startColumn;for(;!t.getRowVisible(l)||!c;)l--,c=!(u=t.getMergedCell(l,r.startColumn))||u.startRow===l&&u.startColumn===r.startColumn;return l>=a?{...r,startRow:l,endRow:l}:s?on(e,t,{...r,startRow:o,endRow:o},n,i,!1):void 0},or=(e,t,r,n=1,i=!0,s=!0)=>{let{startRow:a,endRow:o}=E.Range.transformRange(e,t),l=r.endRow+n,u=t.getMergedCell(l,r.startColumn),c=!u||u.startRow===l&&u.startColumn===r.startColumn;for(;!t.getRowVisible(l)||!c;)l++,c=!(u=t.getMergedCell(l,r.startColumn))||u.startRow===l&&u.startColumn===r.startColumn;return l<=o?{...r,startRow:l,endRow:l}:s?oi(e,t,{...r,startRow:a,endRow:a},n,i,!1):void 0},on=(e,t,r,n=1,i=!0,s=!0)=>{let{startColumn:a,endColumn:o}=E.Range.transformRange(e,t),l=r.startColumn-n,u=t.getMergedCell(r.startRow,l),c=!u||u.startRow===r.startRow&&u.startColumn===l;for(;!t.getColVisible(l)||!c;)l--,c=!(u=t.getMergedCell(r.startRow,l))||u.startRow===r.startRow&&u.startColumn===l;return l>=a?{...r,startColumn:l,endColumn:l}:s?ot(e,t,{...r,startColumn:o,endColumn:o},n,i,!1):void 0},oi=(e,t,r,n=1,i=!0,s=!0)=>{let{startColumn:a,endColumn:o}=E.Range.transformRange(e,t),l=r.endColumn+n,u=t.getMergedCell(r.startRow,l),c=!u||u.startRow===r.startRow&&u.startColumn===l;for(;!t.getColVisible(l)||!c;)l++,c=!(u=t.getMergedCell(r.startRow,l))||u.startRow===r.startRow&&u.startColumn===l;return l<=o?{...r,endColumn:l,startColumn:l}:s?or(e,t,{...r,startColumn:a,endColumn:a},n,i,!1):void 0};function os(e,t,r){let n=null;return r.getMatrixWithMergedCells(e,t,e,t).forValue((e,t,r)=>(n={actualRow:e,actualColumn:t,startRow:e,startColumn:t,isMerged:void 0!==r.rowSpan||void 0!==r.colSpan,isMergedMainCell:void 0!==r.rowSpan&&void 0!==r.colSpan,endRow:e+(void 0!==r.rowSpan?r.rowSpan-1:0),endColumn:t+(void 0!==r.colSpan?r.colSpan-1:0),rangeType:E.RANGE_TYPE.NORMAL},!1)),n||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:E.RANGE_TYPE.NORMAL}}let oa=(e,t,r)=>{let n,i=-1,s;for(let t=0;t<e.length;t++)if(e[t].primary){n=e[t],i=t,s=n.primary;break}if(-1===i)return null;let a=t===E.Direction.LEFT||t===E.Direction.UP,o=a?i-1>=0?i-1:e.length-1:i+1<e.length?i+1:0,l=e[o];if(!n||!s)return null;let u={...s},{startRow:c,startColumn:h,endRow:d,endColumn:m}=n.range,g=a?u.startRow===c&&u.startColumn===h:u.endRow===d&&u.endColumn===m,f=g&&a;if(!E.Rectangle.equals(n.range,u)){let e=g?l.range:((e,t,r,n,i=1)=>{switch(n){case E.Direction.UP:return ot(e,t,r,i);case E.Direction.DOWN:return or(e,t,r,i);case E.Direction.LEFT:return on(e,t,r,i);case E.Direction.RIGHT:return oi(e,t,r,i)}})(n.range,r,u,t);if(!e)return null;let i=f?os(e.endRow,e.endColumn,r):os(e.startRow,e.startColumn,r);return{startRow:i.startRow,startColumn:i.startColumn,endRow:i.endRow,endColumn:i.endColumn}}let p=f?os(l.range.endRow,l.range.endColumn,r):os(l.range.startRow,l.range.startColumn,r);return{startRow:p.startRow,startColumn:p.startColumn,endRow:p.endRow,endColumn:p.endColumn}}}),c("c3hg1",function(e,t){i(e.exports,"shareReplay",function(){return s});var r=u("3rvNF"),n=u("8LCGH");function s(e,t,i){var s,a,o,l,u=!1;return e&&"object"==typeof e?(l=void 0===(s=e.bufferSize)?1/0:s,t=void 0===(a=e.windowTime)?1/0:a,u=void 0!==(o=e.refCount)&&o,i=e.scheduler):l=null!=e?e:1/0,(0,n.share)({connector:function(){return new(0,r.ReplaySubject)(l,t,i)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:u})}}),c("8LCGH",function(e,t){i(e.exports,"share",function(){return l});var r=u("14wAQ"),n=u("b7gpN"),s=u("1mjSk"),a=u("lftZl"),o=u("jSzwf");function l(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new(0,s.Subject)}:t,i=e.resetOnError,l=void 0===i||i,u=e.resetOnComplete,h=void 0===u||u,d=e.resetOnRefCountZero,m=void 0===d||d;return function(e){var t,i,s,u=0,d=!1,g=!1,f=function(){null==i||i.unsubscribe(),i=void 0},p=function(){f(),t=s=void 0,d=g=!1},C=function(){var e=t;p(),null==e||e.unsubscribe()};return(0,o.operate)(function(e,o){u++,g||d||f();var _=s=null!=s?s:r();o.add(function(){0!=--u||g||d||(i=c(C,m))}),_.subscribe(o),!t&&u>0&&(t=new(0,a.SafeSubscriber)({next:function(e){return _.next(e)},error:function(e){g=!0,f(),i=c(p,l,e),_.error(e)},complete:function(){d=!0,f(),i=c(p,h),_.complete()}}),(0,n.innerFrom)(e).subscribe(t))})(e)}}function c(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(!0===t)return void e();if(!1!==t){var o=new(0,a.SafeSubscriber)({next:function(){o.unsubscribe(),e()}});return(0,n.innerFrom)(t.apply(void 0,(0,r.__spreadArray)([],(0,r.__read)(i)))).subscribe(o)}}}),c("23cfA",function(e,t){i(e.exports,"switchMap",function(){return a});var r=u("b7gpN"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return(0,n.operate)(function(n,i){var a=null,o=0,l=!1,u=function(){return l&&!a&&i.complete()};n.subscribe((0,s.createOperatorSubscriber)(i,function(n){null==a||a.unsubscribe();var l=0,c=o++;(0,r.innerFrom)(e(n,c)).subscribe(a=(0,s.createOperatorSubscriber)(i,function(e){return i.next(t?t(n,e,c,l++):e)},function(){a=null,u()}))},function(){l=!0,u()}))})}}),c("2jrJe",function(e,t){i(e.exports,"takeUntil",function(){return o});var r=u("jSzwf"),n=u("iNetn"),s=u("b7gpN"),a=u("f1euv");function o(e){return(0,r.operate)(function(t,r){(0,s.innerFrom)(e).subscribe((0,n.createOperatorSubscriber)(r,function(){return r.complete()},a.noop)),r.closed||t.subscribe(r)})}}),c("86b1c",function(e,t){let r,n,s,a,o,l,c,h,d,m,g,f,p,C,_,y,R,E,b,I,N,S,A,v,T,w,M,O,x,U,D,V,L,P,k;i(e.exports,"BooleanValue",function(){return J}),i(e.exports,"isInDirtyRange",function(){return er}),i(e.exports,"ErrorType",function(){return en}),i(e.exports,"ERROR_TYPE_SET",function(){return ei}),i(e.exports,"FunctionType",function(){return ea}),i(e.exports,"operatorToken",function(){return eo}),i(e.exports,"compareToken",function(){return el}),i(e.exports,"matchToken",function(){return ed}),i(e.exports,"isFormulaLexerToken",function(){return eC}),i(e.exports,"includeFormulaLexerToken",function(){return e_}),i(e.exports,"normalizeSheetName",function(){return ey}),i(e.exports,"matchRefDrawToken",function(){return eR}),i(e.exports,"isReferenceString",function(){return e$}),i(e.exports,"convertUnitDataToRuntime",function(){return eH}),i(e.exports,"RegisterFunctionMutation",function(){return eW}),i(e.exports,"SetArrayFormulaDataMutation",function(){return eG}),i(e.exports,"getAbsoluteRefTypeWithSingleString",function(){return eX}),i(e.exports,"getAbsoluteRefTypeWitString",function(){return eq}),i(e.exports,"serializeRange",function(){return eQ}),i(e.exports,"serializeRangeWithSheet",function(){return eZ}),i(e.exports,"serializeRangeWithSpreadsheet",function(){return eJ}),i(e.exports,"serializeRangeToRefString",function(){return e0}),i(e.exports,"singleReferenceToGrid",function(){return e1}),i(e.exports,"handleRefStringInfo",function(){return e2}),i(e.exports,"deserializeRangeWithSheet",function(){return e5}),i(e.exports,"isReferenceStringWithEffectiveColumn",function(){return e4}),i(e.exports,"getRangeWithRefsString",function(){return e9}),i(e.exports,"isReferenceStrings",function(){return e8}),i(e.exports,"DefinedNamesService",function(){return ti}),i(e.exports,"IDefinedNamesService",function(){return ts}),i(e.exports,"SetDefinedNameMutationFactory",function(){return ta}),i(e.exports,"SetDefinedNameMutation",function(){return to}),i(e.exports,"RemoveDefinedNameMutation",function(){return tl}),i(e.exports,"SetFeatureCalculationMutation",function(){return tu}),i(e.exports,"RemoveFeatureCalculationMutation",function(){return tc}),i(e.exports,"SetFormulaCalculationStartMutation",function(){return th}),i(e.exports,"SetFormulaCalculationStopMutation",function(){return td}),i(e.exports,"SetFormulaCalculationNotificationMutation",function(){return tm}),i(e.exports,"SetFormulaCalculationResultMutation",function(){return tg}),i(e.exports,"SetFormulaDataMutation",function(){return tf}),i(e.exports,"SetOtherFormulaMutation",function(){return tp}),i(e.exports,"RemoveOtherFormulaMutation",function(){return tC}),i(e.exports,"SetSuperTableMutation",function(){return t_}),i(e.exports,"RemoveSuperTableMutation",function(){return ty}),i(e.exports,"SetSuperTableOptionMutation",function(){return tR}),i(e.exports,"deserializeRangeWithSheetWithCache",function(){return tv}),i(e.exports,"sequenceNodeType",function(){return tT}),i(e.exports,"generateStringWithSequence",function(){return tw}),i(e.exports,"LexerNode",function(){return tM}),i(e.exports,"LexerTreeBuilder",function(){return tU}),i(e.exports,"FormulaDataModel",function(){return tL}),i(e.exports,"initSheetFormulaData",function(){return tP}),i(e.exports,"ENGINE_FORMULA_PLUGIN_CONFIG_KEY",function(){return t$}),i(e.exports,"ENGINE_FORMULA_CYCLE_REFERENCE_COUNT",function(){return tH}),i(e.exports,"SheetRowFilteredService",function(){return tG}),i(e.exports,"ISheetRowFilteredService",function(){return tY}),i(e.exports,"FormulaCurrentConfigService",function(){return tq}),i(e.exports,"IFormulaCurrentConfigService",function(){return tK}),i(e.exports,"Lexer",function(){return tJ}),i(e.exports,"handleNumfmtInCell",function(){return t3}),i(e.exports,"BaseValueObject",function(){return ri}),i(e.exports,"ErrorValueObject",function(){return ra}),i(e.exports,"strip",function(){return n$}),i(e.exports,"stripErrorMargin",function(){return nH}),i(e.exports,"NumberValueObject",function(){return nX}),i(e.exports,"StringValueObject",function(){return nK}),i(e.exports,"BooleanValueObject",function(){return nz}),i(e.exports,"NullValueObject",function(){return nG}),i(e.exports,"ValueObjectFactory",function(){return n1}),i(e.exports,"ArrayValueObject",function(){return n0}),i(e.exports,"BaseReferenceObject",function(){return n5}),i(e.exports,"AsyncObject",function(){return n3}),i(e.exports,"AsyncArrayObject",function(){return n4}),i(e.exports,"RangeReferenceObject",function(){return n6}),i(e.exports,"HyperlinkEngineFormulaService",function(){return id}),i(e.exports,"IHyperlinkEngineFormulaService",function(){return im}),i(e.exports,"FormulaExecuteStageType",function(){return iC}),i(e.exports,"FormulaExecutedStateType",function(){return i_}),i(e.exports,"FormulaRuntimeService",function(){return iy}),i(e.exports,"IFormulaRuntimeService",function(){return iR}),i(e.exports,"AstRootNodeFactory",function(){return iv}),i(e.exports,"generateAstNode",function(){return iw}),i(e.exports,"IFunctionService",function(){return iO}),i(e.exports,"FunctionService",function(){return ix}),i(e.exports,"PrefixNodeFactory",function(){return iP}),i(e.exports,"FunctionNodeFactory",function(){return iH}),i(e.exports,"Interpreter",function(){return iG}),i(e.exports,"generateExecuteAstNodeData",function(){return iX}),i(e.exports,"LambdaValueObjectObject",function(){return iq}),i(e.exports,"LambdaNodeFactory",function(){return iJ}),i(e.exports,"LambdaParameterNodeFactory",function(){return i1}),i(e.exports,"FUNCTION_NAMES_MATH",function(){return i5}),i(e.exports,"FUNCTION_NAMES_TEXT",function(){return i3}),i(e.exports,"OperatorNodeFactory",function(){return i9}),i(e.exports,"ReferenceNodeFactory",function(){return st}),i(e.exports,"SuffixNodeFactory",function(){return ss}),i(e.exports,"UnionNodeFactory",function(){return sl}),i(e.exports,"ValueNodeFactory",function(){return sc}),i(e.exports,"AstTreeBuilder",function(){return sm}),i(e.exports,"DependencyManagerBaseService",function(){return sg}),i(e.exports,"DependencyManagerService",function(){return sf}),i(e.exports,"IDependencyManagerService",function(){return sp}),i(e.exports,"FeatureCalculationManagerService",function(){return sC}),i(e.exports,"IFeatureCalculationManagerService",function(){return s_}),i(e.exports,"OtherFormulaManagerService",function(){return sy}),i(e.exports,"IOtherFormulaManagerService",function(){return sR}),i(e.exports,"FormulaDependencyTreeType",function(){return sE}),i(e.exports,"FormulaDependencyTreeVirtual",function(){return sI}),i(e.exports,"FormulaDependencyTree",function(){return sN}),i(e.exports,"generateRandomDependencyTreeId",function(){return sv}),i(e.exports,"IFormulaDependencyGenerator",function(){return sT}),i(e.exports,"FormulaDependencyGenerator",function(){return sw}),i(e.exports,"DEFAULT_INTERVAL_COUNT",function(){return sx}),i(e.exports,"ICalculateFormulaService",function(){return sU}),i(e.exports,"CalculateFormulaService",function(){return sD}),i(e.exports,"CalculateController",function(){return sP}),i(e.exports,"deserializeRangeForR1C1",function(){return sB}),i(e.exports,"BaseFunction",function(){return sX}),i(e.exports,"FUNCTION_NAMES_ARRAY",function(){return sq}),i(e.exports,"functionArray",function(){return sK}),i(e.exports,"FUNCTION_NAMES_COMPATIBILITY",function(){return os}),i(e.exports,"functionCompatibility",function(){return oa}),i(e.exports,"functionCube",function(){return oo}),i(e.exports,"FUNCTION_NAMES_CUBE",function(){return ol}),i(e.exports,"CustomFunction",function(){return ou}),i(e.exports,"AsyncCustomFunction",function(){return oc}),i(e.exports,"FUNCTION_NAMES_DATABASE",function(){return of}),i(e.exports,"functionDatabase",function(){return op}),i(e.exports,"FUNCTION_NAMES_DATE",function(){return oj}),i(e.exports,"functionDate",function(){return oB}),i(e.exports,"FUNCTION_NAMES_ENGINEERING",function(){return oH}),i(e.exports,"functionEngineering",function(){return oW}),i(e.exports,"FUNCTION_NAMES_FINANCIAL",function(){return oG}),i(e.exports,"functionFinancial",function(){return le}),i(e.exports,"FUNCTION_NAMES_INFORMATION",function(){return lt}),i(e.exports,"functionInformation",function(){return lr}),i(e.exports,"FUNCTION_NAMES_LOGICAL",function(){return ln}),i(e.exports,"functionLogical",function(){return ls}),i(e.exports,"FUNCTION_NAMES_LOOKUP",function(){return la}),i(e.exports,"functionLookup",function(){return lo}),i(e.exports,"functionMath",function(){return lc}),i(e.exports,"functionMeta",function(){return ld}),i(e.exports,"FUNCTION_NAMES_STATISTICAL",function(){return lg}),i(e.exports,"functionStatistical",function(){return lp}),i(e.exports,"functionText",function(){return l$}),i(e.exports,"functionUniver",function(){return lH}),i(e.exports,"FUNCTION_NAMES_UNIVER",function(){return lW}),i(e.exports,"SuperTableService",function(){return lG}),i(e.exports,"ISuperTableService",function(){return lY}),i(e.exports,"getObjectValue",function(){return lX}),i(e.exports,"FUNCTION_NAMES_WEB",function(){return lq}),i(e.exports,"functionWeb",function(){return lK}),i(e.exports,"GlobalComputingStatusService",function(){return lQ}),i(e.exports,"ActiveDirtyManagerService",function(){return ua}),i(e.exports,"IActiveDirtyManagerService",function(){return uo}),i(e.exports,"UniverFormulaEnginePlugin",function(){return uc});var F,j,B=u("7yNYd"),$=u("dqRu2"),H=u("5LPkb"),W=u("5K4WI"),G=u("arCqp"),Y=u("hciHF"),z=u("1O3Nt"),X=u("c3hg1"),q=u("1mjSk"),K=u("k2g5B"),Q=Object.defineProperty,Z=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?Q(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r},J=((r=J||{}).FALSE="FALSE",r.TRUE="TRUE",r),ee=((n=ee||{})[n.SUCCESS=0]="SUCCESS",n[n.ERROR=1]="ERROR",n),et=((s=et||{})[s.FRONT=0]="FRONT",s[s.BACK=1]="BACK",s);function er(e,t,r,n,i){for(let s=0,a=e.length;s<a;s++){let a=e[s];if(t!==a.unitId||r!==a.sheetId)continue;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=a.range;if(n>=o&&n<=u&&i>=l&&i<=c)return!0}return!1}var en=((a=en||{}).DIV_BY_ZERO="#DIV/0!",a.NAME="#NAME?",a.VALUE="#VALUE!",a.NUM="#NUM!",a.NA="#N/A",a.CYCLE="#CYCLE!",a.REF="#REF!",a.SPILL="#SPILL!",a.CALC="#CALC!",a.ERROR="#ERROR!",a.CONNECT="#GETTING_DATA",a.NULL="#NULL!",a);let ei=new Set(Object.values(en)),es=[...new Set(Object.values(en).map(e=>e.length))];var ea=((o=ea||{})[o.Financial=0]="Financial",o[o.Date=1]="Date",o[o.Math=2]="Math",o[o.Statistical=3]="Statistical",o[o.Lookup=4]="Lookup",o[o.Database=5]="Database",o[o.Text=6]="Text",o[o.Logical=7]="Logical",o[o.Information=8]="Information",o[o.Engineering=9]="Engineering",o[o.Cube=10]="Cube",o[o.Compatibility=11]="Compatibility",o[o.Web=12]="Web",o[o.Array=13]="Array",o[o.Univer=14]="Univer",o[o.User=15]="User",o[o.DefinedName=16]="DefinedName",o),eo=((l=eo||{}).PLUS="+",l.MINUS="-",l.MULTIPLY="*",l.DIVIDED="/",l.CONCATENATE="&",l.POWER="^",l.EQUALS="=",l.NOT_EQUAL="<>",l.GREATER_THAN=">",l.GREATER_THAN_OR_EQUAL=">=",l.LESS_THAN="<",l.LESS_THAN_OR_EQUAL="<=",l),el=((c=el||{}).EQUALS="=",c.NOT_EQUAL="<>",c.GREATER_THAN=">",c.GREATER_THAN_OR_EQUAL=">=",c.LESS_THAN="<",c.LESS_THAN_OR_EQUAL="<=",c);let eu=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),ec=new Set(eu.keys()),eh=new Set(["=","<>",">",">=","<","<="]);var ed=((h=ed||{}).OPEN_BRACKET="(",h.CLOSE_BRACKET=")",h.COMMA=",",h.SINGLE_QUOTATION="'",h.DOUBLE_QUOTATION='"',h.OPEN_BRACES="{",h.CLOSE_BRACES="}",h.COLON=":",h.OPEN_SQUARE_BRACKET="[",h.CLOSE_SQUARE_BRACKET="]",h),em=((d=em||{}).PERCENTAGE="%",d.POUND="#",d);let eg=new Set(["%","#"]);var ef=((m=ef||{}).AT="@",m.MINUS="-",m.PLUS="+",m);let ep=[...Object.values(el),...Object.values(eo),...Object.values(ed),...Object.values(em),...Object.values(ef)];function eC(e){return ep.includes(e)}function e_(e){for(let t of ep)if(e.indexOf(t)>-1)return!0;return!1}function ey(e){return"'"===e[0]&&"'"===e[e.length-1]?e.substring(1,e.length-1):e}function eR(e){return eC(e)&&e!==ed.CLOSE_BRACES&&e!==ed.CLOSE_BRACKET&&e!==ed.SINGLE_QUOTATION&&e!==ed.DOUBLE_QUOTATION||" "===e}let eE=new Set([eo.PLUS,eo.MINUS,eo.MULTIPLY,eo.DIVIDED,eo.CONCATENATE,eo.POWER,eo.EQUALS,eo.NOT_EQUAL,eo.GREATER_THAN,eo.GREATER_THAN_OR_EQUAL,eo.LESS_THAN,eo.LESS_THAN_OR_EQUAL,ed.OPEN_BRACKET,ed.COMMA,ed.COLON,ed.OPEN_BRACES,ed.OPEN_SQUARE_BRACKET]),eb=new Set([eo.PLUS,eo.MINUS,eo.MULTIPLY,eo.DIVIDED,eo.CONCATENATE,eo.POWER,eo.EQUALS,eo.NOT_EQUAL,eo.GREATER_THAN,eo.GREATER_THAN_OR_EQUAL,eo.LESS_THAN,eo.LESS_THAN_OR_EQUAL,ed.OPEN_BRACKET,ed.COMMA,ed.COLON,ed.OPEN_BRACES,ed.OPEN_SQUARE_BRACKET,em.PERCENTAGE,em.POUND]),eI='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',eN=new RegExp(eI),eS="\\s*?:\\s*?",eA="[A-Za-z]+",ev="[1-9][0-9]*",eT=`'?(${eI})?(((?![\\[\\]\\/?*\\\\]).)*!)?'?`,ew=`\\$?${eA}\\$?${ev}`,eM=RegExp(`^(${ef.AT})?${eT}${ew}${eS}${ew}$`),eO=RegExp(`^${eT}\\s*?${ew}(${em.POUND})?$`),ex=RegExp(`^${eT}\\$?${ev}${eS}\\$?${ev}$`),eU=RegExp(`^${eT}\\$?${eA}${eS}\\$?${eA}$`),eD=RegExp(`^${eT}\\s*?\\$?${ev}$`),eV=RegExp(`^${eT}\\s*?\\$?${eA}$`),eL=RegExp("{.*?}","g");function eP(e){return eO.lastIndex=0,eO.test(e)}function ek(e){return ex.lastIndex=0,ex.test(e)}function eF(e){return eU.lastIndex=0,eU.test(e)}function ej(e){return eD.lastIndex=0,eD.test(e)}function eB(e){return eV.lastIndex=0,eV.test(e)}function e$(e){return eP(e)||(eM.lastIndex=0,eM.test(e))||ek(e)||eF(e)}function eH(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];if(null==n)return!0;null==t[r]&&(t[r]={}),Object.keys(n).forEach(e=>{let i=n[e];t[r][e]=new(0,B.ObjectMatrix)(i)})}),t}let eW={id:"formula.mutation.register-function",type:B.CommandType.MUTATION,handler:()=>!0},eG={id:"formula.mutation.set-array-formula-data",type:B.CommandType.MUTATION,handler:(e,t)=>!0},eY=/[^0-9]/g,ez=/[^A-Za-z]/g;function eX(e){let t="$"===e[0],r=e.substring(1),n=r.indexOf("$")>-1;return B.Tools.isStringNumber(r)&&t&&!n&&(t=!1,n=!0),t&&n?B.AbsoluteRefType.ALL:t?B.AbsoluteRefType.COLUMN:n?B.AbsoluteRefType.ROW:B.AbsoluteRefType.NONE}function eq(e){let t=e.split("!");t.length>1&&(e=t[t.length-1]);let r=e.split(":");return r.length>1?{startAbsoluteRefType:eX(r[0]),endAbsoluteRefType:eX(r[1])}:{startAbsoluteRefType:eX(r[0])}}function eK(e=B.AbsoluteRefType.NONE){let t="",r="";return e===B.AbsoluteRefType.ROW?t="$":e===B.AbsoluteRefType.COLUMN?r="$":e===B.AbsoluteRefType.ALL&&(t="$",r="$"),{rowAbsoluteString:t,columnAbsoluteString:r}}function eQ(e){let{startColumn:t,startRow:r,endColumn:n,endRow:i,startAbsoluteRefType:s,endAbsoluteRefType:a,rangeType:o=B.RANGE_TYPE.NORMAL}=e,l=eK(s),u=eK(a);if(o===B.RANGE_TYPE.ROW||o===B.RANGE_TYPE.ALL){let e=`${l.rowAbsoluteString}${r+1}`,t=`${u.rowAbsoluteString}${i+1}`;return`${e}:${t}`}if(o===B.RANGE_TYPE.COLUMN){let e=`${l.columnAbsoluteString}${B.Tools.chatAtABC(t)}`,r=`${u.columnAbsoluteString}${B.Tools.chatAtABC(n)}`;return`${e}:${r}`}let c=`${l.columnAbsoluteString}${B.Tools.chatAtABC(t)}${l.rowAbsoluteString}${r+1}`,h=`${u.columnAbsoluteString}${B.Tools.chatAtABC(n)}${u.rowAbsoluteString}${i+1}`;return c===h?c:`${c}:${h}`}function eZ(e,t){return`${te(e)}!${eQ(t)}`}function eJ(e,t,r){return e7(e)||e7(t)?`'[${tt(e)}]${tt(t)}'!${eQ(r)}`:`[${e}]${t}!${eQ(r)}`}function e0(e){let{unitId:t,sheetName:r,range:n}=e;return null!=t&&t.length>0&&null!=r&&r.length>0?eJ(t,r,n):null!=r&&r.length>0?eZ(r,n):eQ(n)}function e1(e){let t=Number.parseInt(e.replace(eY,""))-1;return{row:t,column:B.Tools.ABCatNum(e.replace(ez,"")),absoluteRefType:eX(e)}}function e2(e){let t=eN.exec(e),r="";null!=t&&(r=tr((r=t[0].trim()).slice(1,r.length-1)),e=e.replace(eN,""));let n=e.indexOf("!"),i="",s="";return n>-1?("'"===(i=e.substring(0,n))[0]&&"'"===i[i.length-1]&&(i=i.substring(1,i.length-1)),i=tr(i),s=e.substring(n+1)):s=e,{refBody:s,sheetName:i,unitId:r}}function e5(e){let{refBody:t,sheetName:r,unitId:n}=e2(e),i=t.indexOf(":");if(-1===i){let e=e1(t),i=e.row,s=e.column,a=e.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:i,startColumn:s,endRow:i,endColumn:s,startAbsoluteRefType:a,endAbsoluteRefType:a}}}let s=t.substring(0,i),a=t.substring(i+1),o=e1(s),l=e1(a),u=o.row>l.row?l.row:o.row,c=o.column>l.column?l.column:o.column,h=o.row>l.row?o.row:l.row,d=o.column>l.column?o.column:l.column,m=B.RANGE_TYPE.NORMAL;return Number.isNaN(u)&&Number.isNaN(h)?m=B.RANGE_TYPE.COLUMN:Number.isNaN(c)&&Number.isNaN(d)&&(m=B.RANGE_TYPE.ROW),{unitId:n,sheetName:r,range:{startRow:u,startColumn:c,endRow:h,endColumn:d,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:l.absoluteRefType,rangeType:m}}}let e3=["LOG10"];function e4(e){let t=e6(e);if(!e$(t)||e3.includes(t.toUpperCase().trim()))return!1;let{range:r}=e5(t);return!(r.endColumn>=16384)}function e6(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(" "!==i||r){if(!r&&(i===ef.AT||i===ef.MINUS||i===ef.PLUS))continue;t.push(i),r=!0}else t.push(i)}return t.join("")}function e9(e,t){let r=(null==e?void 0:e.split(","))||[];return""===e||0===r.length?[]:e8(e)?r.map(e=>{let r=e5(e);return{unitId:r.unitId,sheetId:t(r.sheetName),range:r.range,sheetName:r.sheetName}}):[]}function e8(e){return((null==e?void 0:e.split(","))||[]).every(e=>e4(e.trim()))}function e7(e){var t,r;return 0!==e.length&&!!(e_(e)||function(e){let t=e.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(e)&&null!==t}(e)||(t=e,/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(t))||(r=e,!RegExp("^\\p{Letter}","u").test(r.charAt(0)))||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?]/.test(e))}function te(e){return e7(e)?`'${tt(e)}'`:e}function tt(e){return e.replace(/'/g,"''")}function tr(e){return e.replace(/''/g,"'")}var tn=Object.getOwnPropertyDescriptor;let ti=class extends B.Disposable{constructor(e){super(),Z(this,"_definedNameMap",{}),Z(this,"_nameCacheMap",{}),Z(this,"_update$",new(0,q.Subject)),Z(this,"update$",this._update$.asObservable()),Z(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),Z(this,"_currentRange$",new(0,q.Subject)),Z(this,"currentRange$",this._currentRange$.asObservable()),Z(this,"_focusRange$",new(0,q.Subject)),Z(this,"focusRange$",this._focusRange$.asObservable()),this._univerInstanceService=e}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(e,t){var r;let{sheetName:n}=e2(t);return null==(r=this._univerInstanceService.getUnit(e))?void 0:r.getSheetBySheetName(n)}focusRange(e,t){let r=this.getValueById(e,t);void 0!==r&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return eQ(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._updateCache(e),this._update()}registerDefinedName(e,t){void 0===this._definedNameMap[e]&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._updateCache(e),this._update()}removeDefinedName(e,t){var r;null==(r=this._definedNameMap[e])||delete r[t],this._updateCache(e),this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._updateCache(e),this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){let r=this._nameCacheMap[e];if(r)return r[t]||null;let n=this._definedNameMap[e];if(void 0===n)return null;let i=null;for(let e of Object.values(n))if(e.name===t){i=e;break}return i&&(this._nameCacheMap[e]=this._nameCacheMap[e]||{},this._nameCacheMap[e][t]=i),i}getValueById(e,t){var r;return null==(r=this._definedNameMap[e])?void 0:r[t]}hasDefinedName(e){return void 0!==this._definedNameMap[e]&&0!==(Array.from(Object.values(this._definedNameMap[e])).length||0)}_update(){this._update$.next(null)}_updateCache(e){let t=this._definedNameMap[e];if(void 0===t)return void delete this._nameCacheMap[e];for(let r of(this._nameCacheMap[e]={},Object.values(t)))this._nameCacheMap[e][r.name]=r}};ti=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tn(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(g=B.IUniverInstanceService,(e,t)=>g(e,t,0))],ti);let ts=(0,$.createIdentifier)("univer.formula.defined-names.service"),ta=(e,t)=>{let{unitId:r,id:n}=t;return{...e.get(ts).getValueById(r,n),unitId:r}},to={id:"formula.mutation.set-defined-name",type:B.CommandType.MUTATION,handler:(e,t)=>{if(null==t)return!1;let r=e.get(ts),{id:n,unitId:i,name:s,formulaOrRefString:a,comment:o,hidden:l,localSheetId:u}=t;return r.registerDefinedName(i,{id:n,name:s.trim(),formulaOrRefString:a.trim(),comment:null==o?void 0:o.trim(),hidden:l,localSheetId:u}),!0}},tl={id:"formula.mutation.remove-defined-name",type:B.CommandType.MUTATION,handler:(e,t)=>{if(null==t)return!1;let r=e.get(ts),{unitId:n,id:i}=t;return r.removeDefinedName(n,i),!0}},tu={id:"formula.mutation.set-feature-calculation",type:B.CommandType.MUTATION,handler:()=>!0},tc={id:"formula.mutation.remove-feature-calculation",type:B.CommandType.MUTATION,handler:()=>!0},th={id:"formula.mutation.set-formula-calculation-start",type:B.CommandType.MUTATION,handler:()=>!0},td={id:"formula.mutation.set-formula-calculation-stop",type:B.CommandType.MUTATION,handler:()=>!0},tm={id:"formula.mutation.set-formula-calculation-notification",type:B.CommandType.MUTATION,handler:()=>!0},tg={id:"formula.mutation.set-formula-calculation-result",type:B.CommandType.MUTATION,handler:()=>!0},tf={id:"formula.mutation.set-formula-data",type:B.CommandType.MUTATION,handler:(e,t)=>!0},tp={id:"formula.mutation.set-other-formula",type:B.CommandType.MUTATION,handler:()=>!0},tC={id:"formula.mutation.remove-other-formula",type:B.CommandType.MUTATION,handler:()=>!0},t_={id:"formula.mutation.set-super-table",type:B.CommandType.MUTATION,handler:()=>!0},ty={id:"formula.mutation.remove-super-table",type:B.CommandType.MUTATION,handler:()=>!0},tR={id:"formula.mutation.set-super-table-option",type:B.CommandType.MUTATION,handler:()=>!0};class tE{constructor(e){Z(this,"_cache"),this._cache=new(0,B.LRUMap)(e)}set(e,t){let r=this._hash(e);this._cache.set(r,t)}get(e){let t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}delete(e){this._cache.delete(this._hash(e))}forEach(e,t){this._cache.forEach(e,t)}_hash(e){return e.length<=64?e:(0,B.hashAlgorithm)(e).toString()}}let tb="LR_1",tI="LO_1",tN="LAMBDA",tS=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),tA=new tE(1e5);function tv(e){let t=tA.get(e);if(t)return t;let r=e5(e);return tA.set(e,r),e5(e)}var tT=((f=tT||{})[f.NORMAL=0]="NORMAL",f[f.NUMBER=1]="NUMBER",f[f.STRING=2]="STRING",f[f.FUNCTION=3]="FUNCTION",f[f.REFERENCE=4]="REFERENCE",f[f.ARRAY=5]="ARRAY",f[f.DEFINED_NAME=6]="DEFINED_NAME",f);function tw(e){let t="";for(let r of e)"string"==typeof r?t+=r:t+=r.token;return t}class tM{constructor(){Z(this,"_parent"),Z(this,"_token","R_1"),Z(this,"_children",[]),Z(this,"_lambdaId"),Z(this,"_functionDefinitionPrivacyVar"),Z(this,"_lambdaParameter",""),Z(this,"_startIndex",-1),Z(this,"_endIndex",-1),Z(this,"_definedNames",[])}dispose(){var e;this._children.forEach(e=>{"string"!=typeof e&&e.dispose()}),null==(e=this._functionDefinitionPrivacyVar)||e.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){let r=this._getIndexInParent(e);null!=r&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){let t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){let t=this._getIndexInParent(e);null!=t&&this.getChildren().splice(t,1)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];n instanceof tM?r.push(n.serialize()):r.push(n)}return{token:e,st:this._startIndex,ed:this._endIndex,children:r}}_getIndexInParent(e){let t=this.getChildren(),r=t.length;for(let n=0;n<r;n++)if(t[n]===e)return n}}let tO=new tE(2e3),tx=new tE(2e3);class tU extends B.Disposable{constructor(){super(...arguments),Z(this,"_currentLexerNode",new tM),Z(this,"_upLevel",0),Z(this,"_segment",""),Z(this,"_bracketState",[]),Z(this,"_squareBracketState",0),Z(this,"_bracesState",0),Z(this,"_singleQuotationState",0),Z(this,"_doubleQuotationState",0),Z(this,"_lambdaState",!1),Z(this,"_colonState",!1),Z(this,"_formulaErrorCount",0),Z(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),tO.clear(),tx.clear()}getUpLevel(){return this._upLevel}isColonClose(){return!1===this._colonState}isColonOpen(){return!0===this._colonState}isDoubleQuotationClose(){return 0===this._doubleQuotationState}isLambdaOpen(){return!0===this._lambdaState}isLambdaClose(){return!1===this._lambdaState}isSingleQuotationClose(){return 0===this._singleQuotationState}isBracesClose(){return 0===this._bracesState}isBracketClose(){return 0===this._bracketState.length}isSquareBracketClose(){return 0===this._squareBracketState}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){let r=this._getCurrentParamIndex(e,t);if(null==r||r===en.VALUE)return;let n=r[0];if("string"==typeof n)return;let i=n.getParent(),s=n;for(;i;){let e=i.getToken();if("P_1"!==e&&!eC(e)&&-1!==i.getStartIndex())return{functionName:e,paramIndex:i.getChildren().indexOf(s)};s=i,i=i.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===ed.CLOSE_BRACKET||" "===n)&&r>=0;)n===ed.CLOSE_BRACKET&&t++,n=e[--r];let i=this._getCurrentParamIndex(e,e.length-2);if(null==i||i===en.VALUE)return 0;let s=i[0];if("string"==typeof s)return 0;let a=s.getParent(),o=0;for(i[1]===ed.OPEN_BRACKET&&o++;a;){let e=a.getToken();"P_1"!==e&&e!==ed.COLON&&-1!==a.getStartIndex()&&e.toUpperCase()!==tN&&(0===t?o+=1:t--),a=a.getParent()}return o}sequenceNodesBuilder(e){let t=tx.get(e);if(t)return[...t];let r=this._getSequenceArray(e);if(0===r.length)return;let n=this.getSequenceNode(r);return tx.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){let i=this.sequenceNodesBuilder(e);if(null==i)return e;let s="";e.substring(0,1)===eo.EQUALS&&(s=eo.EQUALS);for(let e=0,s=i.length;e<s;e++){let a=i[e];if("string"!=typeof a&&a.nodeType===tT.REFERENCE){let{token:o,endIndex:l}=a,u=tv(o);if(null==u)continue;let{range:c,sheetName:h,unitId:d}=u,m=e0({range:{...c,startAbsoluteRefType:t,endAbsoluteRefType:r},unitId:d,sheetName:h||n}),g=m.length-o.length;i[e]={...a,token:m,endIndex:l+g};for(let t=e+1;t<s;t++){let e=i[t];"string"!=typeof e&&(e.startIndex+=g,e.endIndex+=g)}}}return`${s}${tw(i)}`}moveFormulaRefOffset(e,t,r,n=!1){let i=this.sequenceNodesBuilder(e);if(null==i)return e;let s=[];for(let e=0,a=i.length;e<a;e++){let a=i[e];if("string"==typeof a||a.nodeType!==tT.REFERENCE){s.push(a);continue}let{token:o}=a,l=tv(o),{sheetName:u,unitId:c}=l,h=l.range;if(n||h.startAbsoluteRefType!==B.AbsoluteRefType.ALL||h.endAbsoluteRefType!==B.AbsoluteRefType.ALL)h=(0,B.moveRangeByOffset)(h,t,r,n);else{s.push(a);continue}let d="";d=(0,B.isValidRange)(h)?e0({range:h,unitId:c,sheetName:u}):en.REF,s.push({...a,token:d})}return`=${tw(s)}`}_formulaSpellCheck(){if(0===this._currentLexerNode.getChildren().length)return!0;let e=this._currentLexerNode.getChildren()[0];return!!(e instanceof tM||ec.has(e)||eg.has(e)||e===ef.AT||e===ed.COMMA||e===ed.COLON||e===ed.OPEN_BRACKET)}getSequenceNode(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let s=e[n],a=e[n-1],{segment:o,currentString:l}=s;if(l===ed.DOUBLE_QUOTATION&&(r=!0),(""!==o||0===n)&&n!==i-1){t.push(l);continue}let u=(null==a?void 0:a.segment)||"",c=n-u.length,h=n-1,d=n-1;if(n===i-1&&this._isLastMergeString(l)&&(u+=l,h+=1),""===u||eu.has(u)){t.push(l);continue}let m=u.trim(),g=e6(m);!0===r&&m[m.length-1]===ed.DOUBLE_QUOTATION&&m[0]!==ed.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,tT.STRING,u,c,h,d)):eP(g)&&e4(g)?this._processPushSequenceNode(t,tT.REFERENCE,u,c,h,d):B.Tools.isStringNumber(m)?this._processPushSequenceNode(t,tT.NUMBER,u,c,h,d):m.length>0&&this._processPushSequenceNode(t,tT.FUNCTION,u,c,h,d),n===i-1&&this._isLastMergeString(l)||t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,i,s){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:i},s)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===ed.DOUBLE_QUOTATION||B.Tools.isStringNumber(e)||!eC(e)}_mergeSequenceNodeReference(e){let t=[],r=e.length,n=0;for(;n<r;){let r=e[n];if("string"==typeof r){let i=e[n-1];if(r.trim()===ed.CLOSE_BRACES&&null!=i&&"string"!=typeof i&&i.nodeType===tT.FUNCTION&&i.token.trim().substring(0,1)===ed.OPEN_BRACES){i.nodeType=tT.ARRAY,i.token+=r,i.endIndex+=r.length,n++;continue}t.push(r)}else{let i=e[n+1],s=e[n+2];i===ed.COLON&&"string"!=typeof r&&null!=s&&"string"!=typeof s&&e4((r.token+i+s.token).trim())&&(r.nodeType=tT.REFERENCE,r.token+=i+s.token,r.endIndex=s.endIndex,n+=2),t.push(r)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){let t=[];for(let r of e){if("string"!=typeof r){let e=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(e){let n=e[1],i=e[3];if(e4(i.trim())){let e=n.length,s=r.startIndex,a=r.startIndex+e-1,o={nodeType:tT.NORMAL,token:n,startIndex:s,endIndex:a},l={nodeType:tT.REFERENCE,token:i,startIndex:a+1,endIndex:r.endIndex};t.push(o),t.push(l);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){let n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,n){if(!0===t){let t=tO.get(e),r=null==n?void 0:n(e);if(t&&!r)return t}this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1");let i=[],s=this._nodeMaker(e,i);if(s===en.VALUE||0===i.length)return s;let a=!1,o="",l=[];if(r){let{hasDefinedName:e,sequenceString:t,definedNames:n}=r(i);a=e,o=t,l=n}if(a&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1"),(s=this._nodeMaker(`=${o}`))===en.VALUE))return s;let u=this._getTopNode(this._currentLexerNode);if(u&&(this._currentLexerNode=u),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return en.VALUE;tO.set(e,this._currentLexerNode)}return a&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_suffixExpressionHandler(e){var t;let r=e.getChildren();if(!r)return!1;let n=r.length,i=[],s=[],a=!0;for(let e=0;e<n;e++){let n=r[e];if(n instanceof tM)a=this._suffixExpressionHandler(n),i.push(n);else{let a=n.trim();if(""===a)continue;if(ec.has(a)){if(a===eo.PLUS&&this._deletePlusForPreNode(r[e-1]))continue;if(a!==eo.PLUS&&a!==eo.MINUS&&this._deletePlusForPreNode(r[e-1]))return!1;for(;s.length>0;){let e=null==(t=s[s.length-1])?void 0:t.trim();if(!e||e===ed.OPEN_BRACKET)break;let r=eu.get(e),n=eu.get(a);if(void 0===r||void 0===n)break;if(n>=r)i.push(s.pop());else break}s.push(n)}else if(a===ed.OPEN_BRACKET)s.push(n);else if(a===ed.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(i,s,r,e);else{if(this._checkCloseBracket(r[e-1]))return!1;i.push(n)}}}return!!a&&this._processSuffixExpressionRemain(i,s,e)}_processSuffixExpressionRemain(e,t,r){let n=e.length,i=e[n-1];for(;t.length>0;){let r=t.pop();if(!(i instanceof tM)&&(r===ed.OPEN_BRACKET||r===ed.CLOSE_BRACKET))return!1;e.push(r)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var i;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){let r=null==(i=t[t.length-1])?void 0:i.trim();if(!r)break;if(r===ed.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===ed.CLOSE_BRACKET||e instanceof tM}_checkOpenBracket(e){return e===ed.OPEN_BRACKET}_checkOperator(e){return null!=e&&!(e instanceof tM)&&ec.has(e)}_deletePlusForPreNode(e){if(null==e)return!0;if(!(e instanceof tM)){let t=e.trim();if(ec.has(t)||t===ed.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new tM}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){let e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){let t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){let e=this._currentLexerNode.getChildren();if(e&&e.length>0){let t=e[e.length-1];if(t instanceof tM)return t}return!1}_getLastChildCurrent(){let e=this._currentLexerNode.getChildren();return!!e&&e.length>0&&e[e.length-1]}_setParentCurrentLexerNode(){let e=this._currentLexerNode.getParent();return!!e&&(this._currentLexerNode=e,!0)}_setAncestorCurrentLexerNode(){var e,t,r,n,i,s;let a=null==(e=this._currentLexerNode)?void 0:e.getParent(),o=!1;if(a&&"L_1"===a.getToken()){if(null!=(t=null==a?void 0:a.getParent())&&t.getParent()){let e=null==(n=null==(r=this._currentLexerNode.getParent())?void 0:r.getParent())?void 0:n.getParent();e&&(this._currentLexerNode=e),o=!0}}else if(null!=a&&a.getParent()){let e=null==(i=this._currentLexerNode.getParent())?void 0:i.getParent();e&&(this._currentLexerNode=e),o=!0}for(let e=0;e<this._upLevel;e++){let e=null==(s=this._currentLexerNode)?void 0:s.getParent();e&&(this._currentLexerNode=e),o=!!this._currentLexerNode}return o}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(""!==r){let e=this._currentLexerNode.getChildren();if(!(r instanceof tM)&&this.isColonOpen()){let e=new tM;e.setToken(r),e.setParent(this._currentLexerNode),r=e}t?e.unshift(r):e.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){let n=new tM;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){let r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&eE.has(r))return!0;if(eg.has(r)){let r=this._findSecondLastNonSpaceToken(e,t);if(null==r||eb.has(r))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){let t=e[r];if(" "!==t&&2==++n)return t;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===ed.OPEN_BRACKET||e===ed.COMMA||e===eo.EQUALS||""===e}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!ec.has(e)}_getSequenceArray(e){let t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new tM,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==em.POUND)return!0;let i=r[++n];for(;" "===i;)i=r[++n];return!!eC(i)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<es.length;r++){let n=es[r],i=t.slice(e,e+n).join("").toUpperCase();if(ei.has(i))return i}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===eo.EQUALS&&(n=n.substring(1));let i=n.split(""),s=i.length;this._resetTemp(),this._formulaErrorLastTokenCheck(i,s-1)&&this._formalErrorOccurred();let a=0;for(;a<s;){let e=i[a];if(r===a)return[this._currentLexerNode,e];if(e===em.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(a,i)){let e=this._findErrorObject(a,i);if(null==e)return en.VALUE;this._pushNodeToChildren(e);for(let r=0;r<e.length;r++){let e=i[a];this._pushSegment(e),this._addSequenceArray(t,e,a),a++}this._resetSegment();continue}if(e===ed.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,a),this._resetSegment()),this._openBracket(1),this._closeLambda();let r=i[a+1];if(r&&r===ed.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return en.VALUE;this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,r,a),a++,this._closeBracket();continue}r&&this._newAndPushCurrentLexerNode("P_1",a)}else this._pushNodeToChildren(e),this._openBracket(0),this._resetSegment();else if(e===ed.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();let t=this._getCurrentBracket();if(0===t)this._pushNodeToChildren(e);else{if(1!==t)return en.VALUE;let e=i[a+1];if(e&&e===ed.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return en.VALUE;this._newAndPushCurrentLexerNode("L_1",a,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&a!==s-1)return en.VALUE}this._closeBracket()}else if(e===ed.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(e),this._openBraces(),!this._formulaSpellCheck())return en.VALUE}else if(e===ed.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(e),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(e===ed.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(e),this._openSquareBracket();else if(e===ed.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(e),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(e);else if(e===ed.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{let e=i[a+1];e&&e===ed.DOUBLE_QUOTATION?a++:this._closeDoubleQuotation()}this._pushSegment(e)}else if(e===ed.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),0===this._segmentCount()&&this._resetSegment();else{let r=i[a+1];if(r&&r===ed.SINGLE_QUOTATION){this._pushSegment(e),this._addSequenceArray(t,e,a),a++,this._pushSegment(r),this._addSequenceArray(t,r,a),a++;continue}this._closeSingleQuotation()}this._pushSegment(e)}else if(e===ed.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred();let e=this._getCurrentBracket();if(1===e||null==e){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&a!==s-1&&null!=e)return en.VALUE;this._newAndPushCurrentLexerNode("P_1",a)}else{let e=new tM;e.setToken("CUBE");let t=new tM;t.setToken("P_1"),t.changeToParent(e);let r=this._currentLexerNode.getParent();if(!r||r.getToken()!==ed.COLON)return en.VALUE;{let n=r.getParent();if(!n)return en.VALUE;r.changeToParent(t),n.setChildren([]),e.changeToParent(n)}this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=e,this._newAndPushCurrentLexerNode("P_1",a)}}else if(e===ed.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let t=new tM;t.setToken(e);let r=new tM;r.setToken("P_1"),r.setParent(t);let n=new tM;n.setToken("P_1"),n.setParent(t),t.getChildren().push(r,n);let i=t,s=0;if(this._segmentCount()>0){let e,n,a=0,o=this._segment.trim(),l=o[0],u=o[1];if(l===ef.MINUS&&((e=new tM).setToken(ef.MINUS),a++),(l===ef.AT||u===ef.AT)&&((n=new tM).setToken(ef.AT),e&&(e.addChildren(n),n.setParent(e)),a++),a>0&&(this._segment=o.slice(a)),s=a,n)if(n.addChildren(t),t.setParent(n),n.getParent()){let e=n.getParent();e&&(i=e)}else i=n;else e&&(i=e,e.addChildren(t),t.setParent(e));let c=new tM;c.setToken(this._segment),c.setParent(r),r.getChildren().push(c),this._resetSegment()}else{let e=this._getLastChildCurrentLexerNode();e&&e.changeToParent(r)}this._setCurrentLexerNode(i),this._currentLexerNode=n,this._openColon(s)}else if(eg.has(e)&&this._checkSimilarErrorToken(e,a,i)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);let t=new tM;t.setToken(e);let r=this._getLastChildCurrent();r instanceof tM?r.changeToParent(t):!1!==r&&(t.getChildren().push(r),this._removeLastChild()),this._pushNodeToChildren(t),t.setParent(this._currentLexerNode),this._resetSegment()}else if(ec.has(e)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let r=this._segment.trim();if(e===eo.MINUS&&""===r){let r=this._findPreviousToken(i,a-1)||"",n=this._findNextToken(i,a+1)||"";if(this._unexpectedEndingTokenExcludeOperator(r)&&this._isOperatorToken(n)){this._pushNodeToChildren("0"),this._pushNodeToChildren(eo.MINUS),this._addSequenceArray(t,e,a),this._resetSegment(),a++;continue}if(this._unexpectedEndingToken(r))if(n===eo.PLUS){this._pushSegment(eo.MINUS),this._addSequenceArray(t,e,a),this._addSequenceArray(t,eo.PLUS,a+1),a+=2;continue}else{this._pushSegment(eo.MINUS),this._addSequenceArray(t,e,a),a++;continue}}else if(this._segment.length>0&&this._isScientificNotation(i,a,e)){this._pushSegment(e),this._addSequenceArray(t,e,a),a++;continue}else this._segment.length>0&&""===r?r=this._segment:(this._pushNodeToChildren(this._segment),r="");if(e===eo.LESS_THAN||e===eo.GREATER_THAN){let n=i[a+1];if(n&&ec.has(e+n)){this._pushNodeToChildren(r+e+n),this._resetSegment(),this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,n,a),a++;continue}this._pushNodeToChildren(r+e)}else this._pushNodeToChildren(r+e);this._resetSegment()}else(""!==this._segment||" "!==e)&&this._pushSegment(e);this._addSequenceArray(t,e,a),a++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return en.VALUE}_isScientificNotation(e,t,r){let n=e[t-2];if(n&&Number.isNaN(Number(n))||r!==eo.MINUS&&r!==eo.PLUS)return!1;let i=e[t+1];if(i&&Number.isNaN(Number(i)))return!1;let s=e[t-1];return s&&"E"===s.toUpperCase()}_addSequenceArray(e,t,r){null==e||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}}var tD=Object.getOwnPropertyDescriptor,tV=(e,t)=>(r,n)=>t(r,n,e);let tL=class extends B.Disposable{constructor(e,t){super(),Z(this,"_arrayFormulaRange",{}),Z(this,"_arrayFormulaCellData",{}),this._univerInstanceService=e,this._lexerTreeBuilder=t}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{var n,i,s,a;let o=r[e],l=null==(i=null==(n=this._arrayFormulaRange)?void 0:n[t])?void 0:i[e];if(null==l)return!0;let u=new(0,B.ObjectMatrix)(l),c=new(0,B.ObjectMatrix);(null==(s=this._arrayFormulaCellData[t])?void 0:s[e])!=null&&(c=new(0,B.ObjectMatrix)(null==(a=this._arrayFormulaCellData[t])?void 0:a[e])),o.forValue((e,t)=>{let r=u.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=r;for(let e=n;e<=s;e++)for(let t=i;t<=a;t++)c.setValue(e,t,null);u.realDeleteValue(e,t)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;null==this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t]={}),null==this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(e=>{var n,i;let s=r[e],a=new(0,B.ObjectMatrix)(null==(n=this._arrayFormulaRange[t])?void 0:n[e]),o=new(0,B.ObjectMatrix)(null==(i=this._arrayFormulaCellData[t])?void 0:i[e]);s.forValue((e,t)=>{let r=null==a?void 0:a.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:l}=r;for(let e=n;e<=s;e++)for(let t=i;t<=l;t++)o.setValue(e,t,null)}),s.forValue((e,t,r)=>{o.setValue(e,t,r)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=o.getData())})})}getFormulaData(){let e={},t=this._univerInstanceService.getAllUnitsForType(B.UniverInstanceType.UNIVER_SHEET);return 0===t.length||t.forEach(t=>{let r=t.getUnitId();e[r]={},t.getSheets().forEach(t=>{let n=t.getCellMatrix();tP(e,r,t.getSheetId(),n)})}),e}getSheetFormulaData(e,t){let r={},n=this._univerInstanceService.getUnit(e);if(null==n)return{};r[e]={};let i=n.getSheetBySheetId(t);return null==i?{}:(tP(r,e,t,i.getCellMatrix()),r[e][t])}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(e=>{var n;let i=new(0,B.ObjectMatrix)(r[e]),s=new(0,B.ObjectMatrix)(null==(n=this._arrayFormulaRange[t])?void 0:n[e]);i.forValue((e,t,r)=>{s.setValue(e,t,r)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][e]=s.getData())})})}deleteArrayFormulaRange(e,t,r,n){var i;let s=null==(i=this._arrayFormulaRange[e])?void 0:i[t];if(null==s)return;let a=new(0,B.ObjectMatrix)(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}getCalculateData(){let e=this._univerInstanceService.getAllUnitsForType(B.UniverInstanceType.UNIVER_SHEET),t={},r={},n={};for(let i of e){let e=i.getUnitId(),s=i.getSheets(),a={},o={};for(let e of s){let t=e.getSheetId(),r=e.getConfig();a[t]={cellData:new(0,B.ObjectMatrix)(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},o[e.getName()]=e.getSheetId()}t[e]=a,r[e]=i.getStyles(),n[e]=o}return{allUnitData:t,unitStylesData:r,unitSheetNameMap:n}}getHiddenRowsFiltered(){let e=this._univerInstanceService.getAllUnitsForType(B.UniverInstanceType.UNIVER_SHEET),t={};for(let r of e){let e=r.getUnitId(),n=r.getSheets();for(let r of(t[e]={},n)){let n=r.getSheetId();t[e][n]={};let i=r.getRowCount()-1,s={};for(let e=0;e<=i;e++)r.getRowVisible(e)||(s[e]={hd:B.BooleanNumber.TRUE});t[e][n]=s}}return t}updateFormulaData(e,t,r){let n=new(0,B.ObjectMatrix)(r),i=this._getSheetFormulaIdMap(e,t),s=new Map,a=this.getFormulaData();null==a[e]&&(a[e]={});let o=a[e];null==o[t]&&(o[t]={});let l=new(0,B.ObjectMatrix)(o[t]||{}),u=new(0,B.ObjectMatrix);return n.forValue((e,t,r)=>{!function(e,t,r,n,i,s,a){let o=(null==a?void 0:a.f)||"",l=(null==a?void 0:a.si)||"",u=(0,B.isFormulaString)(o),c=(0,B.isFormulaId)(l),h=e.getValue(i,s),d=(null==h?void 0:h.f)||"",m=(null==h?void 0:h.si)||"";function g(){var e;if((0,B.isFormulaString)(d)&&(0,B.isFormulaId)(m)){let t=null==(e=null==r?void 0:r[m])?void 0:e.f;t?n.set(m,t):n.set(m,d)}}u&&c?(m!==l&&g(),e.setValue(i,s,{f:o,si:l}),r[l]={f:o,r:i,c:s},t.setValue(i,s,{f:o,si:l})):u&&!c?(d!==o&&g(),e.setValue(i,s,{f:o}),t.setValue(i,s,{f:o})):!u&&c?(m!==l&&g(),e.setValue(i,s,{f:"",si:l})):!u&&!c&&e.getValue(i,s)&&(g(),e.realDeleteValue(i,s),t.setValue(i,s,null))}(l,u,i,s,e,t,r)}),l.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,B.isFormulaId)(a)){let o=null==i?void 0:i[a],c=s.get(a);if(o&&!(0,B.isFormulaString)(n)){let r=o.f,n=t-o.c,i=e-o.r;l.setValue(e,t,{f:r,si:a,x:n,y:i}),u.setValue(e,t,{f:r,si:a,x:n,y:i})}else if("string"==typeof c){let n=(null==r?void 0:r.x)||0,i=(null==r?void 0:r.y)||0,o=this._lexerTreeBuilder.moveFormulaRefOffset(c,n,i);s.set(a,{r:e,c:t,f:o}),l.setValue(e,t,{f:o,si:a}),u.setValue(e,t,{f:o,si:a})}else if("object"==typeof c){let r=t-c.c,n=e-c.r;l.setValue(e,t,{f:c.f,si:a,x:r,y:n}),u.setValue(e,t,{f:c.f,si:a,x:r,y:n})}}}),u.getMatrix()}updateArrayFormulaRange(e,t,r){var n;let i=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!i)return;let s=new(0,B.ObjectMatrix)(i);new(0,B.ObjectMatrix)(r).forValue((e,t,r)=>{s.realDeleteValue(e,t)})}updateArrayFormulaCellData(e,t,r){var n,i;let s=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!s)return;let a=new(0,B.ObjectMatrix)(s),o=null==(i=this._arrayFormulaCellData[e])?void 0:i[t];if(!o)return;let l=new(0,B.ObjectMatrix)(o);new(0,B.ObjectMatrix)(r).forValue((e,t,r)=>{!function(e,t,r,n){let i=null==e?void 0:e.getValue(r,n);if(null==i)return;let s=[];e.forValue((e,t,a)=>{e===r&&t===n||B.Rectangle.intersects(a,i)&&s.push(a)});let{startRow:a,startColumn:o,endRow:l,endColumn:u}=i;for(let e=a;e<=l;e++)for(let r=o;r<=u;r++){let n=!1,i=(0,B.cellToRange)(e,r);s.some(e=>!!B.Rectangle.contains(e,i)&&(n=!0,!0)),n||t.realDeleteValue(e,r)}}(a,l,e,t)})}getFormulaStringByCell(e,t,r,n){let i=this._univerInstanceService.getUnit(n);if(null==i)return null;let s=i.getSheetBySheetId(r);if(null==s)return null;let a=s.getCellMatrix(),o=a.getValue(e,t);if(null==o)return null;let{f:l,si:u}=o;if((0,B.isFormulaString)(l))return l;if((0,B.isFormulaId)(u)){let r=null;return a.forValue((n,i,s)=>{if(null==s)return!0;let{f:a,si:o}=s;if((0,B.isFormulaString)(a)&&u===o)return r=this._lexerTreeBuilder.moveFormulaRefOffset(a,t-i,e-n),!1}),r}return null}getFormulaDirtyRanges(){let e=this.getFormulaData(),t=[];for(let r in e){let n=e[r];if(!n)continue;let i=this._univerInstanceService.getUnit(r);if(i)for(let e in n){let s=n[e];if(!s)continue;let a=i.getSheetBySheetId(e);if(!a)continue;let o={};for(let e of Object.keys(s)){let t=Number(e);for(let e in s[t]){let r=Number(e),n=a.getCellRaw(t,r),i=(0,B.isFormulaString)(null==n?void 0:n.f)||(0,B.isFormulaId)(null==n?void 0:n.si),s=(null==n?void 0:n.v)===void 0;if(!(i&&s))continue;o[r]||(o[r]=[]);let l=o[r].slice(-1)[0];l&&l.endRow===t-1?l.endRow=t:o[r].push({startRow:t,endRow:t})}}for(let n in o){let i=o[n];for(let s=0;s<i.length;s++){let a=i[s];t.push({unitId:r,sheetId:e,range:{rangeType:B.RANGE_TYPE.NORMAL,startRow:a.startRow,endRow:a.endRow,startColumn:Number(n),endColumn:Number(n)}})}}}}return t}_getSheetFormulaIdMap(e,t){let r={},n=this._univerInstanceService.getUnit(e);if(null==n)return r;let i=n.getSheetBySheetId(t);return null==i||i.getCellMatrix().forValue((e,t,n)=>{if(null==n)return!0;let{f:i,si:s}=n;(0,B.isFormulaString)(i)&&(0,B.isFormulaId)(s)&&(r[s]={f:i,r:e,c:t})}),r}};function tP(e,t,r,n){e[t]||(e[t]={}),e[t][r]||(e[t][r]={});let i=new Map,s=new(0,B.ObjectMatrix)(e[t][r]);return n.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"",o=(0,B.isFormulaString)(n),l=(0,B.isFormulaId)(a);o&&l?(s.setValue(e,t,{f:n,si:a}),i.set(a,{f:n,r:e,c:t})):o&&!l?s.setValue(e,t,{f:n}):!o&&l&&s.setValue(e,t,{f:"",si:a})}),s.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,B.isFormulaId)(a)&&!(0,B.isFormulaString)(n)){let r=i.get(a);if(r){let n=r.f,i=t-r.c,o=e-r.r;s.setValue(e,t,{f:n,si:a,x:i,y:o})}else s.realDeleteValue(e,t)}}),{[t]:{[r]:s.getMatrix()}}}tL=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tV(0,B.IUniverInstanceService),tV(1,(0,$.Inject)(tU))],tL);let tk=class e{constructor(e,t){this.low=e,this.high=t}clone(){return new e(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equal_to(e){return this.low===e.low&&this.high===e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(t){return new e(void 0===this.low?t.low:this.low<t.low?this.low:t.low,void 0===this.high?t.high:this.high>t.high?this.high:t.high)}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}};class tF{constructor(e,t,r=null,n=null,i=null,s=1){if(this.left=r,this.right=n,this.parent=i,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&2===e.length&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])){let[t,r]=e;t>r&&([t,r]=[r,t]),this.item.key=new tk(t,r)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&1===this.color}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value===e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){return(0,this.item.key.constructor.comparable_less_than)(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,r=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}}class tj{constructor(){this.root=null,this.nil_node=new tF}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return null==this.root||this.root===this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let r=new tF(e,t,this.nil_node,this.nil_node,null,0);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new tF(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new tF(e,t),n=this.tree_search(this.root,r);return n&&this.tree_delete(n),n}search(e,t=(e,t)=>e===t?t.output():e){let r=new tF(e),n=[];return this.tree_search_interval(this.root,r,n),n.map(e=>t(e.item.value,e.item.key))}intersect_any(e){let t=new tF(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new tj;return this.tree_walk(this.root,r=>t.insert(r.item.key,e(r.item.value,r.item.key))),t}*iterate(e,t=(e,t)=>e===t?t.output():e){let r;for(e?r=this.tree_search_nearest_forward(this.root,new tF(e)):this.root&&(r=this.local_minimum(this.root));r;)yield t(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(null==this.root||this.root===this.nil_node)this.root=e;else{for(;t!==this.nil_node;)r=t,t=e.less_than(t)?t.left:t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!==this.root&&0===t.parent.color;)t.parent===t.parent.parent.left?0===(r=t.parent.parent.right).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_right(t.parent.parent)):0===(r=t.parent.parent.left).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_left(t.parent.parent));this.root.color=1}tree_delete(e){let t,r;(r=(t=e.left===this.nil_node||e.right===this.nil_node?e:this.tree_successor(e)).left!==this.nil_node?t.left:t.right).parent=t.parent,t===this.root?this.root=r:(t===t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!==e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),1===t.color&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!==this.root&&null!=t.parent&&1===t.color;)t===t.parent.left?(0===(r=t.parent.right).color&&(r.color=1,t.parent.color=0,this.rotate_left(t.parent),r=t.parent.right),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.right.color&&(r.color=0,r.left.color=1,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=1,r.right.color=1,this.rotate_left(t.parent),t=this.root)):(0===(r=t.parent.left).color&&(r.color=1,t.parent.color=0,this.rotate_right(t.parent),r=t.parent.left),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.left.color&&(r.color=0,r.right.color=1,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=1,r.left.color=1,this.rotate_right(t.parent),t=this.root));t.color=1}tree_search(e,t){if(null!=e&&e!==this.nil_node)return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_nearest_forward(e,t){let r,n=e;for(;n&&n!==this.nil_node;)n.less_than(t)?n.intersect(t)?(r=n,n=n.left):n=n.right:((!r||n.less_than(r))&&(r=n),n=n.left);return r||null}tree_search_interval(e,t,r){null!=e&&e!==this.nil_node&&(e.left===this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right===this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return null!=e&&e!==this.nil_node&&(e.left===this.nil_node||e.not_intersect_left_subtree(t)||(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),r||e.right===this.nil_node||e.not_intersect_right_subtree(t)||(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;null!=t.left&&t.left!==this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!==this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,n;if(e.right!==this.nil_node)t=this.local_minimum(e.right);else{for(r=e,n=e.parent;null!=n&&n.right===r;)r=n,n=n.parent;t=n}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!==this.nil_node&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!==this.nil_node&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!==e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!==this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){0===t.color&&(1===t.left.color&&1===t.right.color||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0;if(1===e.color&&t++,(r=e.left!==this.nil_node?this.testBlackHeightProperty(e.left):1)!==(e.right!==this.nil_node?this.testBlackHeightProperty(e.right):1))throw Error("Red-black height property violated");return t+r}}let tB=new class{constructor(){Z(this,"_cache",new Map),Z(this,"_continueBuildingCache",new Map)}set(e,t,r,n,i,s=!1){if(!this.shouldContinueBuildingCache(e,t,r,i)&&!s)return;let a=this._cache.get(e);null==a&&(a=new Map,this._cache.set(e,a));let o=a.get(t);null==o&&(o=new Map,a.set(t,o));let l=o.get(r);if(null==l&&(l=new Map,o.set(r,l)),s){for(let[e,t]of l)if(t.has(i)){t.delete(i);break}}let u=l.get(n);null==u&&(u=new Set,l.set(n,u)),u.add(i)}getCellValuePositions(e,t,r){var n,i;return null==(i=null==(n=this._cache.get(e))?void 0:n.get(t))?void 0:i.get(r)}getCellPositions(e,t,r,n,i){var s,a,o;let l=null==(o=null==(a=null==(s=this._cache.get(e))?void 0:s.get(t))?void 0:a.get(r))?void 0:o.get(n);return l&&[...l].filter(e=>i.some(([t,r])=>e>=t&&e<=r))}setContinueBuildingCache(e,t,r,n,i){if(-1===r||-1===n||-1===i)return;let s=this._continueBuildingCache.get(e);null==s&&(s=new Map,this._continueBuildingCache.set(e,s));let a=s.get(t);null==a&&(a=new Map,s.set(t,a));let o=a.get(r);if(null==o){(o=new tj).insert([n,i]),a.set(r,o);return}this._handleNewInterval(o,n,i)}shouldContinueBuildingCache(e,t,r,n){var i,s;if(-1===r||-1===n)return!1;let a=null==(s=null==(i=this._continueBuildingCache.get(e))?void 0:i.get(t))?void 0:s.get(r);return!a||0===a.search([n,n]).length}canUseCache(e,t,r,n,i){var s,a;let o=null==(a=null==(s=this._continueBuildingCache.get(e))?void 0:s.get(t))?void 0:a.get(r);if(-1===r||-1===n||-1===i||!o)return{rowsInCache:[],rowsNotInCache:[]};let l=o.search([n,i]);if(0===l.length)return{rowsInCache:[],rowsNotInCache:[]};l.sort((e,t)=>e[0]-t[0]);let u=[],c=[],h=n;for(let e=0;e<l.length;e++){let[t,r]=l[e];if(h>=t){if(i<=r){u.push([h,i]);break}u.push([h,r]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i])}else{if(i>r){u.push([t,r]),c.push([h,t-1]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i]);continue}u.push([t,i]),c.push([h,t-1])}}return{rowsInCache:u,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(e,t,r){let n=e.search([t,r]);if(0===n.length){let i=[t-1<0?0:t-1,r+1];if(0===(n=e.search(i)).length)return void e.insert([t,r])}let i=t,s=r;for(let t of n)i=Math.min(i,t[0]),s=Math.max(s,t[1]),e.remove(t);e.insert([i,s])}},t$="engine-formula.config",tH="CYCLE_REFERENCE_COUNT",tW={};class tG extends B.Disposable{constructor(){super(...arguments),Z(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return!!this._getRowFilteredCallback&&null!=(n=this._getRowFilteredCallback(e,t,r))&&n}}let tY=(0,$.createIdentifier)("univer.formula.sheet-row-filtered.service");var tz=Object.getOwnPropertyDescriptor,tX=(e,t)=>(r,n)=>t(r,n,e);let tq=class extends B.Disposable{constructor(e,t,r,n){super(),Z(this,"_unitData",{}),Z(this,"_unitStylesData",{}),Z(this,"_arrayFormulaCellData",{}),Z(this,"_arrayFormulaRange",{}),Z(this,"_formulaData",{}),Z(this,"_sheetNameMap",{}),Z(this,"_forceCalculate",!1),Z(this,"_clearDependencyTreeCache",{}),Z(this,"_dirtyRanges",[]),Z(this,"_dirtyNameMap",{}),Z(this,"_dirtyDefinedNameMap",{}),Z(this,"_dirtyUnitFeatureMap",{}),Z(this,"_dirtyUnitOtherFormulaMap",{}),Z(this,"_excludedCell"),Z(this,"_sheetIdToNameMap",{}),Z(this,"_executeUnitId",""),Z(this,"_executeSubUnitId",""),this._univerInstanceService=e,this._localeService=t,this._formulaDataModel=r,this._sheetRowFilteredService=n}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return null==this._sheetIdToNameMap[e]?"":this._sheetIdToNameMap[e][t]||""}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){let{id:e,sheetOrder:t}=this._univerInstanceService.getCurrentUnitForType(B.UniverInstanceType.UNIVER_SHEET).getSnapshot();return{sheetOrder:t,sheetNameMap:this._sheetIdToNameMap[e]}}getSheetRowColumnCount(e,t){let r=this._univerInstanceService.getUnit(e),n=null==r?void 0:r.getSheetBySheetId(t),i=null==n?void 0:n.getSnapshot();if(!i)return{rowCount:0,columnCount:0};let{rowCount:s,columnCount:a}=i;return{rowCount:s,columnCount:a}}getFilteredOutRows(e,t,r,n){let i=[];for(let s=r;s<=n;s++)this._sheetRowFilteredService.getRowFiltered(e,t,s)&&i.push(s);return i}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{let{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}e.rowData&&this._applyUnitRowData(e.rowData),this._formulaData=e.formulaData,this._arrayFormulaCellData=eH(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{null==e[r]&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(r=>{null==this._sheetIdToNameMap[t]&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][e[t][r]]=r})})}_loadSheetData(){let e=this._univerInstanceService.getCurrentUnitForType(B.UniverInstanceType.UNIVER_SHEET),t=null==e?void 0:e.getActiveSheet();return this._executeUnitId=null==e?void 0:e.getUnitId(),this._executeSubUnitId=null==t?void 0:t.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(e){for(let t in e)if(null!=e[t])for(let r in e[t])null!=e[t][r]&&(null==this._unitData[t]&&(this._unitData[t]={}),null==this._unitData[t][r]&&(this._unitData[t][r]={cellData:new(0,B.ObjectMatrix)({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[t][r].rowData=e[t][r])}};tq=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tz(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tX(0,B.IUniverInstanceService),tX(1,(0,$.Inject)(B.LocaleService)),tX(2,(0,$.Inject)(tL)),tX(3,(0,$.Inject)(tY))],tq);let tK=(0,$.createIdentifier)("univer.formula.current-data.service");var tQ=Object.getOwnPropertyDescriptor,tZ=(e,t)=>(r,n)=>t(r,n,e);let tJ=class extends B.Disposable{constructor(e,t,r){super(),this._definedNamesService=e,this._lexerTreeBuilder=t,this._formulaCurrentConfigService=r}treeBuilder(e,t=!0){return this._lexerTreeBuilder.treeBuilder(e,t,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++){let r=n[t];if(e.indexOf(r)>-1)return!0}}return!1}_checkDefinedNameDirty(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++)if(n[t]===e)return!0}return!1}_injectDefinedName(e){let t=this._formulaCurrentConfigService.getExecuteUnitId();if(null==t)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};let r=this._lexerTreeBuilder.getSequenceNode(e),n="",i=!1,s=[];for(let e=0,a=r.length;e<a;e++){let a=r[e];if("string"==typeof a){n+=a;continue}let{nodeType:o,token:l}=a;if(o===tT.REFERENCE||o===tT.FUNCTION){let e=this._definedNamesService.getValueByName(t,l);if(e){let t=e.formulaOrRefString;t.substring(0,1)===eo.EQUALS&&(t=t.substring(1)),n+=t,s.push(e.name),i=!0}else this._checkDefinedNameDirty(l)?(n+=en.NAME,i=!0,s.push(l)):n+=l}else n+=l}return{sequenceString:n,hasDefinedName:i,definedNames:s}}};function t0(e){if(null==e)return!0;let{v:t,f:r,si:n,p:i}=e;return!(null!=t&&("string"!=typeof t||0!==t.length)||null!=r&&r.length>0||null!=n&&n.length>0||null!=i)}function t1(e,t,r,n,i){var s;for(let a of Object.keys(i)){let o=i[a],l=null==(s=null==o?void 0:o[n])?void 0:s[r];if(null==l)continue;let u=l.getValue(e,t);if(null!=u)return u}}tJ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tQ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tZ(0,ts),tZ(1,(0,$.Inject)(tU)),tZ(2,tK)],tJ);let t2=["$","","","","","","","","","","","","","","","","","","","","","","","","","",""],t5={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function t3(e,t,r){var n,i;if(null==e||null==t)return t;let s=(null==r?void 0:r.getStyleByCell(e))||e.s,a=(null==r?void 0:r.getStyleByCell(t))||t.s;if(null==s||null==a||"object"!=typeof s||"object"!=typeof a)return t;let o=null==(n=null==s?void 0:s.n)?void 0:n.pattern,l=null==(i=null==a?void 0:a.n)?void 0:i.pattern;return null==o||null==l||(a.n.pattern=o||l),t}let t4=new tE(1e5);function t6(e){var t,r;let n=t4.get(e);if(void 0!==n)return n;let i=(r=t=e,t2.find(e=>r.includes(e))&&r.startsWith("_("))?3:t5[B.numfmt.getFormatInfo(t).type||"unknown"];return t4.set(e,i),i}function t9(e,t,r){if(""===e)return t;if(""===t)return e;let n=t6(e),i=t6(t);return r===eo.PLUS||r===eo.MINUS?4===n&&4===i||11===n&&11===i?"":t:r===eo.MULTIPLY||r===eo.DIVIDED?6===n&&6===i||7===n&&7===i||8===n&&8===i||9===n&&9===i?t:"":e||t}let t8=new Map([[B.LocaleType.EN_US,"$"],[B.LocaleType.RU_RU,""],[B.LocaleType.VI_VN,""],[B.LocaleType.ZH_CN,""],[B.LocaleType.ZH_TW,"NT$"]]);function t7(e){return t8.get(e)||"$"}function re(e,t=2){let r=t;t>127&&(r=127);let n="";return r>0&&(n=`.${"0".repeat(r)}`),`"${t7(e)}"#,##0${n}_);[Red]("${t7(e)}"#,##0${n})`}let rt=new tE(1e5);function rr(e,t,r){return rt.set(e,{value:t,pattern:r}),{isNumberPattern:!0,value:t,pattern:r}}class rn{constructor(){Z(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}}class ri extends rn{constructor(e){super(),Z(this,"_customData"),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}isHyperlink(){return!1}sum(){return ra.create(en.VALUE)}max(){return ra.create(en.VALUE)}min(){return ra.create(en.VALUE)}count(){return ra.create(en.VALUE)}countA(){return ra.create(en.VALUE)}countBlank(){return ra.create(en.VALUE)}getNegative(){return ra.create(en.VALUE)}getReciprocal(){return ra.create(en.VALUE)}plus(e){return ra.create(en.VALUE)}minus(e){return ra.create(en.VALUE)}multiply(e){return ra.create(en.VALUE)}divided(e){return ra.create(en.VALUE)}mod(e){return ra.create(en.VALUE)}map(e){return ra.create(en.NAME)}mapValue(e){return ra.create(en.NAME)}compare(e,t,r=!1){return ra.create(en.NAME)}isEqual(e){return this.compare(e,el.EQUALS)}isNotEqual(e){return this.compare(e,el.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,el.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,el.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,el.LESS_THAN)}isGreaterThan(e){return this.compare(e,el.GREATER_THAN)}concatenateFront(e){return ra.create(en.NAME)}concatenateBack(e){return ra.create(en.NAME)}plusBy(e){return ra.create(en.VALUE)}minusBy(e){return ra.create(en.VALUE)}multiplyBy(e){return ra.create(en.VALUE)}dividedBy(e){return ra.create(en.VALUE)}modInverse(e){return ra.create(en.VALUE)}compareBy(e,t){return ra.create(en.NAME)}concatenate(e,t=et.FRONT){let r=this.getValue().toString();if("string"==typeof e)t===et.FRONT?r=e+r:r+=e;else if("number"==typeof e)t===et.FRONT?r=e.toString()+r:r+=e.toString();else if("boolean"==typeof e){let n=e?"TRUE":"FALSE";t===et.FRONT?r=n+r:r+=n}return r}pow(e){return ra.create(en.VALUE)}powInverse(e){return ra.create(en.VALUE)}sqrt(){return ra.create(en.VALUE)}cbrt(){return ra.create(en.VALUE)}cos(){return ra.create(en.VALUE)}cosh(){return ra.create(en.VALUE)}acos(){return ra.create(en.VALUE)}acosh(){return ra.create(en.VALUE)}sin(){return ra.create(en.VALUE)}sinh(){return ra.create(en.VALUE)}asin(){return ra.create(en.VALUE)}asinh(){return ra.create(en.VALUE)}tan(){return ra.create(en.VALUE)}tanh(){return ra.create(en.VALUE)}atan(){return ra.create(en.VALUE)}atan2(e){return ra.create(en.VALUE)}atan2Inverse(e){return ra.create(en.VALUE)}atanh(){return ra.create(en.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return ra.create(en.VALUE)}log10(){return ra.create(en.VALUE)}exp(){return ra.create(en.VALUE)}abs(){return ra.create(en.VALUE)}round(e){return ra.create(en.VALUE)}roundInverse(e){return ra.create(en.VALUE)}floor(e){return ra.create(en.VALUE)}floorInverse(e){return ra.create(en.VALUE)}ceil(e){return ra.create(en.VALUE)}ceilInverse(e){return ra.create(en.VALUE)}convertToNumberObjectValue(){return ra.create(en.VALUE)}convertToBooleanObjectValue(){return ra.create(en.VALUE)}}let rs=new tE(1e3);class ra extends ri{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(e,t=""){let r=`${e}-${t}`,n=rs.get(r);if(n)return n;let i=new ra(e,t);return rs.set(r,i),i}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}}var ro=((p=ro||{})[p.MIN=0]="MIN",p[p.MAX=1]="MAX",p),rl=((C=rl||{})[C.NORMAL=0]="NORMAL",C[C.MIN=1]="MIN",C[C.MAX=2]="MAX",C);function ru(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(e,t)=>e.localeCompare(t)}function rc(e,t){let r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/~?[*?]/g,e=>e.startsWith("~")?`\\${e.substring(1)}`:"*"===e?".*":"?"===e?".":e);return RegExp(`^${r}$`).test(e)}function rh(e){return e.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function rd(e){switch(e){case 1:return 2;case 0:default:return 0;case -1:return 1}}function rm(e){let t;switch(e){case el.EQUALS:t=el.EQUALS;break;case el.GREATER_THAN:t=el.LESS_THAN;break;case el.GREATER_THAN_OR_EQUAL:t=el.LESS_THAN_OR_EQUAL;break;case el.LESS_THAN:t=el.GREATER_THAN;break;case el.LESS_THAN_OR_EQUAL:t=el.GREATER_THAN_OR_EQUAL;break;case el.NOT_EQUAL:t=el.NOT_EQUAL}return t}var rg,rf,rp="0123456789abcdef",rC="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",r_="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ry={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},rR=!0,rE="[DecimalError] ",rb=rE+"Invalid argument: ",rI=rE+"Precision limit exceeded",rN=rE+"crypto unavailable",rS="[object Decimal]",rA=Math.floor,rv=Math.pow,rT=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,rw=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rM=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,rO=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,rx=rC.length-1,rU=r_.length-1,rD={toStringTag:rS};function rV(e){var t,r,n,i=e.length-1,s="",a=e[0];if(i>0){for(s+=a,t=1;t<i;t++)(r=7-(n=e[t]+"").length)&&(s+=rY(r)),s+=n;(r=7-(n=(a=e[t])+"").length)&&(s+=rY(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}function rL(e,t,r){if(e!==~~e||e<t||e>r)throw Error(rb+e)}function rP(e,t,r,n){var i,s,a,o;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=7,i=0):(i=Math.ceil((t+1)/7),t%=7),s=rv(10,7-t),o=e[i]%s|0,null==n?t<3?(0==t?o=o/100|0:1==t&&(o=o/10|0),a=r<4&&99999==o||r>3&&49999==o||5e4==o||0==o):a=(r<4&&o+1==s||r>3&&o+1==s/2)&&(e[i+1]/s/100|0)==rv(10,t-2)-1||(o==s/2||0==o)&&(e[i+1]/s/100|0)==0:t<4?(0==t?o=o/1e3|0:1==t?o=o/100|0:2==t&&(o=o/10|0),a=(n||r<4)&&9999==o||!n&&r>3&&4999==o):a=((n||r<4)&&o+1==s||!n&&r>3&&o+1==s/2)&&(e[i+1]/s/1e3|0)==rv(10,t-3)-1,a}function rk(e,t,r){for(var n,i,s=[0],a=0,o=e.length;a<o;){for(i=s.length;i--;)s[i]*=t;for(s[0]+=rp.indexOf(e.charAt(a++)),n=0;n<s.length;n++)s[n]>r-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}rD.absoluteValue=rD.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),rj(e)},rD.ceil=function(){return rj(new this.constructor(this),this.e+1,2)},rD.clampedTo=rD.clamp=function(e,t){var r=this.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(rb+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new r(this)},rD.comparedTo=rD.cmp=function(e){var t,r,n,i,s=this.d,a=(e=new this.constructor(e)).d,o=this.s,l=e.s;if(!s||!a)return o&&l?o!==l?o:s===a?0:!s^o<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?o:a[0]?-l:0;if(o!==l)return o;if(this.e!==e.e)return this.e>e.e^o<0?1:-1;for(n=s.length,i=a.length,t=0,r=n<i?n:i;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^o<0?1:-1;return n===i?0:n>i^o<0?1:-1},rD.cosine=rD.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n,i;if(t.isZero())return t;(n=t.d.length)<32?i=(1/r1(4,r=Math.ceil(n/3))).toString():(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=r0(e,1,t.times(i),new e(1));for(var s=r;s--;){var a=t.times(t);t=a.times(a).minus(a).times(8).plus(1)}return e.precision-=r,t}(n,r2(n,r)),n.precision=e,n.rounding=t,rj(2==rf||3==rf?r.neg():r,e,t,!0)):new n(1):new n(NaN)},rD.cubeRoot=rD.cbrt=function(){var e,t,r,n,i,s,a,o,l,u,c=this.constructor;if(!this.isFinite()||this.isZero())return new c(this);for(rR=!1,(s=this.s*rv(this.s*this,1/3))&&Math.abs(s)!=1/0?n=new c(s.toString()):(r=rV(this.d),(s=((e=this.e)-r.length+1)%3)&&(r+=1==s||-2==s?"0":"00"),s=rv(r,1/3),e=rA((e+1)/3)-(e%3==(e<0?-1:2)),(n=new c(r=s==1/0?"5e"+e:(r=s.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=this.s),a=(e=c.precision)+3;;)if(n=rF((u=(l=(o=n).times(o).times(o)).plus(this)).plus(this).times(o),u.plus(l),a+2,1),rV(o.d).slice(0,a)===(r=rV(n.d)).slice(0,a))if("9999"!=(r=r.slice(a-3,a+1))&&(i||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(rj(n,e+1,1),t=!n.times(n).times(n).eq(this));break}else{if(!i&&(rj(o,e+1,0),o.times(o).times(o).eq(this))){n=o;break}a+=4,i=1}return rR=!0,rj(n,e,c.rounding,t)},rD.decimalPlaces=rD.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-rA(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},rD.dividedBy=rD.div=function(e){return rF(this,new this.constructor(e))},rD.dividedToIntegerBy=rD.divToInt=function(e){var t=this.constructor;return rj(rF(this,new t(e),0,1,1),t.precision,t.rounding)},rD.equals=rD.eq=function(e){return 0===this.cmp(e)},rD.floor=function(){return rj(new this.constructor(this),this.e+1,3)},rD.greaterThan=rD.gt=function(e){return this.cmp(e)>0},rD.greaterThanOrEqualTo=rD.gte=function(e){var t=this.cmp(e);return 1==t||0===t},rD.hyperbolicCosine=rD.cosh=function(){var e,t,r,n,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;r=a.precision,n=a.rounding,a.precision=r+Math.max(s.e,s.sd())+4,a.rounding=1,(i=s.d.length)<32?t=(1/r1(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),s=r0(a,1,s.times(t),new a(1),!0);for(var l,u=e,c=new a(8);u--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return rj(s,a.precision=r,a.rounding=n,!0)},rD.hyperbolicSine=rD.sinh=function(){var e,t,r,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(t=s.precision,r=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<3)i=r0(s,2,i,i,!0);else{e=(e=1.4*Math.sqrt(n))>16?16:0|e,i=r0(s,2,i=i.times(1/r1(5,e)),i,!0);for(var a,o=new s(5),l=new s(16),u=new s(20);e--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(u))))}return s.precision=t,s.rounding=r,rj(i,t,r,!0)},rD.hyperbolicTangent=rD.tanh=function(){var e,t,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,rF(this.sinh(),this.cosh(),r.precision=e,r.rounding=t)):new r(this.s)},rD.inverseCosine=rD.acos=function(){var e=this,t=e.constructor,r=e.abs().cmp(1),n=t.precision,i=t.rounding;return -1!==r?0===r?e.isNeg()?rW(t,n,i):new t(0):new t(NaN):e.isZero()?rW(t,n+4,i).times(.5):(t.precision=n+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=n,t.rounding=i,e.times(2))},rD.inverseHyperbolicCosine=rD.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,rR=!1,r=r.times(r).minus(1).sqrt().plus(r),rR=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)},rD.inverseHyperbolicSine=rD.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,rR=!1,r=r.times(r).plus(1).sqrt().plus(r),rR=!0,n.precision=e,n.rounding=t,r.ln())},rD.inverseHyperbolicTangent=rD.atanh=function(){var e,t,r,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,t=s.rounding,Math.max(n=i.sd(),e)<-(2*i.e)-1?rj(new s(i),e,t,!0):(s.precision=r=n-i.e,i=rF(i.plus(1),new s(1).minus(i),r+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=t,i.times(.5))):new s(NaN)},rD.inverseSine=rD.asin=function(){var e,t,r,n,i=this,s=i.constructor;return i.isZero()?new s(i):(t=i.abs().cmp(1),r=s.precision,n=s.rounding,-1!==t?0===t?((e=rW(s,r+4,n).times(.5)).s=i.s,e):new s(NaN):(s.precision=r+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=r,s.rounding=n,i.times(2)))},rD.inverseTangent=rD.atan=function(){var e,t,r,n,i,s,a,o,l,u=this,c=u.constructor,h=c.precision,d=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=rU)return(a=rW(c,h+4,d).times(.25)).s=u.s,a}else{if(!u.s)return new c(NaN);if(h+4<=rU)return(a=rW(c,h+4,d).times(.5)).s=u.s,a}for(c.precision=o=h+10,c.rounding=1,e=r=Math.min(28,o/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(rR=!1,t=Math.ceil(o/7),n=1,l=u.times(u),a=new c(u),i=u;-1!==e;)if(i=i.times(l),s=a.minus(i.div(n+=2)),i=i.times(l),void 0!==(a=s.plus(i.div(n+=2))).d[t])for(e=t;a.d[e]===s.d[e]&&e--;);return r&&(a=a.times(2<<r-1)),rR=!0,rj(a,c.precision=h,c.rounding=d,!0)},rD.isFinite=function(){return!!this.d},rD.isInteger=rD.isInt=function(){return!!this.d&&rA(this.e/7)>this.d.length-2},rD.isNaN=function(){return!this.s},rD.isNegative=rD.isNeg=function(){return this.s<0},rD.isPositive=rD.isPos=function(){return this.s>0},rD.isZero=function(){return!!this.d&&0===this.d[0]},rD.lessThan=rD.lt=function(e){return 0>this.cmp(e)},rD.lessThanOrEqualTo=rD.lte=function(e){return 1>this.cmp(e)},rD.logarithm=rD.log=function(e){var t,r,n,i,s,a,o,l=this.constructor,u=l.precision,c=l.rounding;if(null==e)e=new l(10),t=!0;else{if(r=(e=new l(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new l(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(t)if(r.length>1)i=!0;else{for(n=r[0];n%10==0;)n/=10;i=1!==n}if(rR=!1,rP((o=rF(s=rQ(this,a=u+5),t?rH(l,a+10):rQ(e,a),a,1)).d,n=u,c))do if(a+=10,o=rF(s=rQ(this,a),t?rH(l,a+10):rQ(e,a),a,1),!i){+rV(o.d).slice(n+1,n+15)+1==1e14&&(o=rj(o,u+1,0));break}while(rP(o.d,n+=10,c))return rR=!0,rj(o,u,c)},rD.minus=rD.sub=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.constructor;if(e=new m(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new m(e.d||this.s!==e.s?this:NaN):e=new m(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(u=this.d,d=e.d,o=m.precision,l=m.rounding,!u[0]||!d[0]){if(d[0])e.s=-e.s;else{if(!u[0])return new m(3===l?-0:0);e=new m(this)}return rR?rj(e,o,l):e}if(r=rA(e.e/7),c=rA(this.e/7),u=u.slice(),s=c-r){for((h=s<0)?(t=u,s=-s,a=d.length):(t=d,r=c,a=u.length),s>(n=Math.max(Math.ceil(o/7),a)+2)&&(s=n,t.length=1),t.reverse(),n=s;n--;)t.push(0);t.reverse()}else{for((h=(n=u.length)<(a=d.length))&&(a=n),n=0;n<a;n++)if(u[n]!=d[n]){h=u[n]<d[n];break}s=0}for(h&&(t=u,u=d,d=t,e.s=-e.s),a=u.length,n=d.length-a;n>0;--n)u[a++]=0;for(n=d.length;n>s;){if(u[--n]<d[n]){for(i=n;i&&0===u[--i];)u[i]=1e7-1;--u[i],u[n]+=1e7}u[n]-=d[n]}for(;0===u[--a];)u.pop();for(;0===u[0];u.shift())--r;return u[0]?(e.d=u,e.e=r$(u,r),rR?rj(e,o,l):e):new m(3===l?-0:0)},rD.modulo=rD.mod=function(e){var t,r=this.constructor;return e=new r(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(rR=!1,9==r.modulo?(t=rF(this,e.abs(),0,3,1),t.s*=e.s):t=rF(this,e,0,r.modulo,1),t=t.times(e),rR=!0,this.minus(t)):rj(new r(this),r.precision,r.rounding):new r(NaN)},rD.naturalExponential=rD.exp=function(){return rK(this)},rD.naturalLogarithm=rD.ln=function(){return rQ(this)},rD.negated=rD.neg=function(){var e=new this.constructor(this);return e.s=-e.s,rj(e)},rD.plus=rD.add=function(e){var t,r,n,i,s,a,o,l,u,c,h=this.constructor;if(e=new h(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new h(e.d||this.s===e.s?this:NaN)):e=new h(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(u=this.d,c=e.d,o=h.precision,l=h.rounding,!u[0]||!c[0])return c[0]||(e=new h(this)),rR?rj(e,o,l):e;if(s=rA(this.e/7),n=rA(e.e/7),u=u.slice(),i=s-n){for(i<0?(r=u,i=-i,a=c.length):(r=c,n=s,a=u.length),i>(a=(s=Math.ceil(o/7))>a?s+1:a+1)&&(i=a,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((a=u.length)-(i=c.length)<0&&(i=a,r=c,c=u,u=r),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/1e7|0,u[i]%=1e7;for(t&&(u.unshift(t),++n),a=u.length;0==u[--a];)u.pop();return e.d=u,e.e=r$(u,n),rR?rj(e,o,l):e},rD.precision=rD.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(rb+e);return this.d?(t=rG(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},rD.round=function(){var e=this.constructor;return rj(new e(this),this.e+1,e.rounding)},rD.sine=rD.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:r0(e,2,t,t);r=(r=1.4*Math.sqrt(n))>16?16:0|r,t=r0(e,2,t=t.times(1/r1(5,r)),t);for(var i,s=new e(5),a=new e(16),o=new e(20);r--;)i=t.times(t),t=t.times(s.plus(i.times(a.times(i).minus(o))));return t}(n,r2(n,r)),n.precision=e,n.rounding=t,rj(rf>2?r.neg():r,e,t,!0)):new n(NaN)},rD.squareRoot=rD.sqrt=function(){var e,t,r,n,i,s,a=this.d,o=this.e,l=this.s,u=this.constructor;if(1!==l||!a||!a[0])return new u(!l||l<0&&(!a||a[0])?NaN:a?this:1/0);for(rR=!1,0==(l=Math.sqrt(+this))||l==1/0?(((t=rV(a)).length+o)%2==0&&(t+="0"),l=Math.sqrt(t),o=rA((o+1)/2)-(o<0||o%2),n=new u(t=l==1/0?"5e"+o:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+o)):n=new u(l.toString()),r=(o=u.precision)+3;;)if(n=(s=n).plus(rF(this,s,r+2,1)).times(.5),rV(s.d).slice(0,r)===(t=rV(n.d)).slice(0,r))if("9999"!=(t=t.slice(r-3,r+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(rj(n,o+1,1),e=!n.times(n).eq(this));break}else{if(!i&&(rj(s,o+1,0),s.times(s).eq(this))){n=s;break}r+=4,i=1}return rR=!0,rj(n,o,u.rounding,e)},rD.tangent=rD.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,(r=r.sin()).s=1,r=rF(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,rj(2==rf||4==rf?r.neg():r,e,t,!0)):new n(NaN)},rD.times=rD.mul=function(e){var t,r,n,i,s,a,o,l,u,c=this.constructor,h=this.d,d=(e=new c(e)).d;if(e.s*=this.s,!h||!h[0]||!d||!d[0])return new c(!e.s||h&&!h[0]&&!d||d&&!d[0]&&!h?NaN:!h||!d?e.s/0:0*e.s);for(r=rA(this.e/7)+rA(e.e/7),(l=h.length)<(u=d.length)&&(s=h,h=d,d=s,a=l,l=u,u=a),s=[],n=a=l+u;n--;)s.push(0);for(n=u;--n>=0;){for(t=0,i=l+n;i>n;)o=s[i]+d[n]*h[i-n-1]+t,s[i--]=o%1e7|0,t=o/1e7|0;s[i]=(s[i]+t)%1e7|0}for(;!s[--a];)s.pop();return t?++r:s.shift(),e.d=s,e.e=r$(s,r),rR?rj(e,c.precision,c.rounding):e},rD.toBinary=function(e,t){return r5(this,2,e,t)},rD.toDecimalPlaces=rD.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),void 0===e?r:(rL(e,0,1e9),void 0===t?t=n.rounding:rL(t,0,8),rj(r,e+r.e+1,t))},rD.toExponential=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rB(n,!0):(rL(e,0,1e9),void 0===t?t=i.rounding:rL(t,0,8),r=rB(n=rj(new i(n),e+1,t),!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r},rD.toFixed=function(e,t){var r,n,i=this.constructor;return void 0===e?r=rB(this):(rL(e,0,1e9),void 0===t?t=i.rounding:rL(t,0,8),r=rB(n=rj(new i(this),e+this.e+1,t),!1,e+n.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},rD.toFraction=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.d,g=this.constructor;if(!m)return new g(this);if(u=r=new g(1),n=l=new g(0),a=(s=(t=new g(n)).e=rG(m)-this.e-1)%7,t.d[0]=rv(10,a<0?7+a:a),null==e)e=s>0?t:u;else{if(!(o=new g(e)).isInt()||o.lt(u))throw Error(rb+o);e=o.gt(t)?s>0?t:u:o}for(rR=!1,o=new g(rV(m)),c=g.precision,g.precision=s=7*m.length*2;h=rF(o,t,0,1,1),1!=(i=r.plus(h.times(n))).cmp(e);)r=n,n=i,i=u,u=l.plus(h.times(i)),l=i,i=t,t=o.minus(h.times(i)),o=i;return i=rF(e.minus(r),n,0,1,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=this.s,d=1>rF(u,n,s,1).minus(this).abs().cmp(rF(l,r,s,1).minus(this).abs())?[u,n]:[l,r],g.precision=c,rR=!0,d},rD.toHexadecimal=rD.toHex=function(e,t){return r5(this,16,e,t)},rD.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),null==e){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),void 0===t?t=n.rounding:rL(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(rR=!1,r=rF(r,e,0,t,1).times(e),rR=!0,rj(r)):(e.s=r.s,r=e),r},rD.toNumber=function(){return+this},rD.toOctal=function(e,t){return r5(this,8,e,t)},rD.toPower=rD.pow=function(e){var t,r,n,i,s,a,o=this,l=o.constructor,u=+(e=new l(e));if(!o.d||!e.d||!o.d[0]||!e.d[0])return new l(rv(+o,u));if((o=new l(o)).eq(1))return o;if(n=l.precision,s=l.rounding,e.eq(1))return rj(o,n,s);if((t=rA(e.e/7))>=e.d.length-1&&(r=u<0?-u:u)<=0x1fffffffffffff)return i=rz(l,o,r,n),e.s<0?new l(1).div(i):rj(i,n,s);if((a=o.s)<0){if(t<e.d.length-1)return new l(NaN);if((1&e.d[t])==0&&(a=1),0==o.e&&1==o.d[0]&&1==o.d.length)return o.s=a,o}return(t=0!=(r=rv(+o,u))&&isFinite(r)?new l(r+"").e:rA(u*(Math.log("0."+rV(o.d))/Math.LN10+o.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?a/0:0):(rR=!1,l.rounding=o.s=1,r=Math.min(12,(t+"").length),(i=rK(e.times(rQ(o,n+r)),n)).d&&rP((i=rj(i,n+5,1)).d,n,s)&&(t=n+10,+rV((i=rj(rK(e.times(rQ(o,t+r)),t),t+5,1)).d).slice(n+1,n+15)+1==1e14&&(i=rj(i,n+1,0))),i.s=a,rR=!0,l.rounding=s,rj(i,n,s))},rD.toPrecision=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rB(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(rL(e,1,1e9),void 0===t?t=i.rounding:rL(t,0,8),r=rB(n=rj(new i(n),e,t),e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r},rD.toSignificantDigits=rD.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(rL(e,1,1e9),void 0===t?t=r.rounding:rL(t,0,8)),rj(new r(this),e,t)},rD.toString=function(){var e=this.constructor,t=rB(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},rD.truncated=rD.trunc=function(){return rj(new this.constructor(this),this.e+1,1)},rD.valueOf=rD.toJSON=function(){var e=this.constructor,t=rB(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t};var rF=function(){function e(e,t,r){var n,i=0,s=e.length;for(e=e.slice();s--;)n=e[s]*t+i,e[s]=n%r|0,i=n/r|0;return i&&e.unshift(i),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=+(e[r]<t[r]),e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(n,i,s,a,o,l){var u,c,h,d,m,g,f,p,C,_,y,R,E,b,I,N,S,A,v,T,w=n.constructor,M=n.s==i.s?1:-1,O=n.d,x=i.d;if(!O||!O[0]||!x||!x[0])return new w(!n.s||!i.s||(O?x&&O[0]==x[0]:!x)?NaN:O&&0==O[0]||!x?0*M:M/0);for(l?(m=1,c=n.e-i.e):(l=1e7,m=7,c=rA(n.e/m)-rA(i.e/m)),v=x.length,S=O.length,_=(C=new w(M)).d=[],h=0;x[h]==(O[h]||0);h++);if(x[h]>(O[h]||0)&&c--,null==s?(b=s=w.precision,a=w.rounding):b=o?s+(n.e-i.e)+1:s,b<0)_.push(1),g=!0;else{if(b=b/m+2|0,h=0,1==v){for(d=0,x=x[0],b++;(h<S||d)&&b--;h++)I=d*l+(O[h]||0),_[h]=I/x|0,d=I%x|0;g=d||h<S}else{for((d=l/(x[0]+1)|0)>1&&(x=e(x,d,l),O=e(O,d,l),v=x.length,S=O.length),N=v,R=(y=O.slice(0,v)).length;R<v;)y[R++]=0;(T=x.slice()).unshift(0),A=x[0],x[1]>=l/2&&++A;do d=0,(u=t(x,y,v,R))<0?(E=y[0],v!=R&&(E=E*l+(y[1]||0)),(d=E/A|0)>1?(d>=l&&(d=l-1),p=(f=e(x,d,l)).length,R=y.length,1==(u=t(f,y,p,R))&&(d--,r(f,v<p?T:x,p,l))):(0==d&&(u=d=1),f=x.slice()),(p=f.length)<R&&f.unshift(0),r(y,f,R,l),-1==u&&(R=y.length,(u=t(x,y,v,R))<1&&(d++,r(y,v<R?T:x,R,l))),R=y.length):0===u&&(d++,y=[0]),_[h++]=d,u&&y[0]?y[R++]=O[N]||0:(y=[O[N]],R=1);while((N++<S||void 0!==y[0])&&b--)g=void 0!==y[0]}_[0]||_.shift()}if(1==m)C.e=c,rg=g;else{for(h=1,d=_[0];d>=10;d/=10)h++;C.e=h+c*m-1,rj(C,o?s+C.e+1:s,a,g)}return C}}();function rj(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor;e:if(null!=t){if(!(h=e.d))return e;for(i=1,o=h[0];o>=10;o/=10)i++;if((s=t-i)<0)s+=7,a=t,l=(c=h[d=0])/rv(10,i-a-1)%10|0;else if((d=Math.ceil((s+1)/7))>=(o=h.length))if(n){for(;o++<=d;)h.push(0);c=l=0,i=1,s%=7,a=s-7+1}else break e;else{for(c=o=h[d],i=1;o>=10;o/=10)i++;s%=7,l=(a=s-7+i)<0?0:c/rv(10,i-a-1)%10|0}if(n=n||t<0||void 0!==h[d+1]||(a<0?c:c%rv(10,i-a-1)),u=r<4?(l||n)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||n||6==r&&(s>0?a>0?c/rv(10,i-a):0:h[d-1])%10&1||r==(e.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=e.e+1,h[0]=rv(10,(7-t%7)%7),e.e=-t||0):h[0]=e.e=0,e;if(0==s?(h.length=d,o=1,d--):(h.length=d+1,o=rv(10,7-s),h[d]=a>0?(c/rv(10,i-a)%rv(10,a)|0)*o:0),u)for(;;)if(0==d){for(s=1,a=h[0];a>=10;a/=10)s++;for(a=h[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(e.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[d]+=o,1e7!=h[d])break;h[d--]=0,o=1}for(s=h.length;0===h[--s];)h.pop()}return rR&&(e.e>m.maxE?(e.d=null,e.e=NaN):e.e<m.minE&&(e.e=0,e.d=[0])),e}function rB(e,t,r){if(!e.isFinite())return rZ(e);var n,i=e.e,s=rV(e.d),a=s.length;return t?(r&&(n=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+rY(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+rY(-i-1)+s,r&&(n=r-a)>0&&(s+=rY(n))):i>=a?(s+=rY(i+1-a),r&&(n=r-i-1)>0&&(s=s+"."+rY(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),r&&(n=r-a)>0&&(i+1===a&&(s+="."),s+=rY(n))),s}function r$(e,t){var r=e[0];for(t*=7;r>=10;r/=10)t++;return t}function rH(e,t,r){if(t>rx)throw rR=!0,r&&(e.precision=r),Error(rI);return rj(new e(rC),t,1,!0)}function rW(e,t,r){if(t>rU)throw Error(rI);return rj(new e(r_),t,r,!0)}function rG(e){var t=e.length-1,r=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function rY(e){for(var t="";e--;)t+="0";return t}function rz(e,t,r,n){var i,s=new e(1),a=Math.ceil(n/7+4);for(rR=!1;;){if(r%2&&r3((s=s.times(t)).d,a)&&(i=!0),0===(r=rA(r/2))){r=s.d.length-1,i&&0===s.d[r]&&++s.d[r];break}r3((t=t.times(t)).d,a)}return rR=!0,s}function rX(e){return 1&e.d[e.d.length-1]}function rq(e,t,r){for(var n,i,s=new e(t[0]),a=0;++a<t.length;){if(!(i=new e(t[a])).s){s=i;break}((n=s.cmp(i))===r||0===n&&s.s===r)&&(s=i)}return s}function rK(e,t){var r,n,i,s,a,o,l,u=0,c=0,h=0,d=e.constructor,m=d.rounding,g=d.precision;if(!e.d||!e.d[0]||e.e>17)return new d(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(rR=!1,l=g):l=t,o=new d(.03125);e.e>-2;)e=e.times(o),h+=5;for(l+=n=Math.log(rv(2,h))/Math.LN10*2+5|0,r=s=a=new d(1),d.precision=l;;){if(s=rj(s.times(e),l,1),r=r.times(++c),rV((o=a.plus(rF(s,r,l,1))).d).slice(0,l)===rV(a.d).slice(0,l)){for(i=h;i--;)a=rj(a.times(a),l,1);if(null!=t)return d.precision=g,a;if(!(u<3&&rP(a.d,l-n,m,u)))return rj(a,d.precision=g,m,rR=!0);d.precision=l+=10,r=s=o=new d(1),c=0,u++}a=o}}function rQ(e,t){var r,n,i,s,a,o,l,u,c,h,d,m=1,g=e,f=g.d,p=g.constructor,C=p.rounding,_=p.precision;if(g.s<0||!f||!f[0]||!g.e&&1==f[0]&&1==f.length)return new p(f&&!f[0]?-1/0:1!=g.s?NaN:f?0:g);if(null==t?(rR=!1,c=_):c=t,p.precision=c+=10,n=(r=rV(f)).charAt(0),!(15e14>Math.abs(s=g.e)))return u=rH(p,c+2,_).times(s+""),g=rQ(new p(n+"."+r.slice(1)),c-10).plus(u),p.precision=_,null==t?rj(g,_,C,rR=!0):g;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=rV((g=g.times(e)).d)).charAt(0),m++;for(s=g.e,n>1?(g=new p("0."+r),s++):g=new p(n+"."+r.slice(1)),h=g,l=a=g=rF(g.minus(1),g.plus(1),c,1),d=rj(g.times(g),c,1),i=3;;){if(a=rj(a.times(d),c,1),rV((u=l.plus(rF(a,new p(i),c,1))).d).slice(0,c)===rV(l.d).slice(0,c))if(l=l.times(2),0!==s&&(l=l.plus(rH(p,c+2,_).times(s+""))),l=rF(l,new p(m),c,1),null!=t)return p.precision=_,l;else{if(!rP(l.d,c-10,C,o))return rj(l,p.precision=_,C,rR=!0);p.precision=c+=10,u=a=g=rF(h.minus(1),h.plus(1),c,1),d=rj(g.times(g),c,1),i=o=1}l=u,i+=2}}function rZ(e){return String(e.s*e.s/0)}function rJ(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;48===t.charCodeAt(n);n++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(n,i)){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%7,r<0&&(n+=7),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=7;n<i;)e.d.push(+t.slice(n,n+=7));n=7-(t=t.slice(n)).length}else n-=i;for(;n--;)t+="0";e.d.push(+t),rR&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function r0(e,t,r,n,i){var s,a,o,l,u=e.precision,c=Math.ceil(u/7);for(rR=!1,l=r.times(r),o=new e(n);;){if(a=rF(o.times(l),new e(t++*t++),u,1),o=i?n.plus(a):n.minus(a),n=rF(a.times(l),new e(t++*t++),u,1),void 0!==(a=o.plus(n)).d[c]){for(s=c;a.d[s]===o.d[s]&&s--;);if(-1==s)break}s=o,o=n,n=a,a=s}return rR=!0,a.d.length=c+1,a}function r1(e,t){for(var r=e;--t;)r*=e;return r}function r2(e,t){var r,n=t.s<0,i=rW(e,e.precision,1),s=i.times(.5);if((t=t.abs()).lte(s))return rf=n?4:1,t;if((r=t.divToInt(i)).isZero())rf=n?3:2;else{if((t=t.minus(r.times(i))).lte(s))return rf=rX(r)?n?2:3:n?4:1,t;rf=rX(r)?n?1:4:n?3:2}return t.minus(i).abs()}function r5(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor,g=void 0!==r;if(g?(rL(r,1,1e9),void 0===n?n=m.rounding:rL(n,0,8)):(r=m.precision,n=m.rounding),e.isFinite()){for(a=(c=rB(e)).indexOf("."),g?(i=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):i=t,a>=0&&(c=c.replace(".",""),(d=new m(1)).e=c.length-a,d.d=rk(rB(d),10,i),d.e=d.d.length),s=l=(h=rk(c,10,i)).length;0==h[--l];)h.pop();if(h[0]){if(a<0?s--:((e=new m(e)).d=h,e.e=s,h=(e=rF(e,d,r,n,0,i)).d,s=e.e,u=rg),a=h[r],o=i/2,u=u||void 0!==h[r+1],u=n<4?(void 0!==a||u)&&(0===n||n===(e.s<0?3:2)):a>o||a===o&&(4===n||u||6===n&&1&h[r-1]||n===(e.s<0?8:7)),h.length=r,u)for(;++h[--r]>i-1;)h[r]=0,r||(++s,h.unshift(1));for(l=h.length;!h[l-1];--l);for(a=0,c="";a<l;a++)c+=rp.charAt(h[a]);if(g){if(l>1)if(16==t||8==t){for(a=16==t?4:3,--l;l%a;l++)c+="0";for(l=(h=rk(c,i,t)).length;!h[l-1];--l);for(a=1,c="1.";a<l;a++)c+=rp.charAt(h[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}else c=g?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=rZ(e);return e.s<0?"-"+c:c}function r3(e,t){if(e.length>t)return e.length=t,!0}function r4(e){return new this(e).abs()}function r6(e){return new this(e).acos()}function r9(e){return new this(e).acosh()}function r8(e,t){return new this(e).plus(t)}function r7(e){return new this(e).asin()}function ne(e){return new this(e).asinh()}function nt(e){return new this(e).atan()}function nr(e){return new this(e).atanh()}function nn(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,s=n+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?rW(this,n,i):new this(0)).s=e.s:!e.d||t.isZero()?(r=rW(this,s,1).times(.5)).s=e.s:t.s<0?(this.precision=s,this.rounding=1,r=this.atan(rF(e,t,s,1)),t=rW(this,s,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(rF(e,t,s,1)):(r=rW(this,s,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function ni(e){return new this(e).cbrt()}function ns(e){return rj(e=new this(e),e.e+1,2)}function na(e,t,r){return new this(e).clamp(t,r)}function no(e){if(!e||"object"!=typeof e)throw Error(rE+"Object expected");var t,r,n,i=!0===e.defaults,s=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<s.length;t+=3)if(r=s[t],i&&(this[r]=ry[r]),void 0!==(n=e[r]))if(rA(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(rb+r+": "+n);if(r="crypto",i&&(this[r]=ry[r]),void 0!==(n=e[r]))if(!0===n||!1===n||0===n||1===n)if(n)if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(rN);else this[r]=!1;else throw Error(rb+r+": "+n);return this}function nl(e){return new this(e).cos()}function nu(e){return new this(e).cosh()}function nc(e,t){return new this(e).div(t)}function nh(e){return new this(e).exp()}function nd(e){return rj(e=new this(e),e.e+1,3)}function nm(){var e,t,r=new this(0);for(rR=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return rR=!0,new this(1/0);r=t}return rR=!0,r.sqrt()}function ng(e){return e instanceof nV||e&&e.toStringTag===rS||!1}function nf(e){return new this(e).ln()}function np(e,t){return new this(e).log(t)}function nC(e){return new this(e).log(2)}function n_(e){return new this(e).log(10)}function ny(){return rq(this,arguments,-1)}function nR(){return rq(this,arguments,1)}function nE(e,t){return new this(e).mod(t)}function nb(e,t){return new this(e).mul(t)}function nI(e,t){return new this(e).pow(t)}function nN(e){var t,r,n,i,s=0,a=new this(1),o=[];if(void 0===e?e=this.precision:rL(e,1,1e9),n=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));s<n;)(i=t[s])>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);s<n;)(i=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((127&t[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,s):(o.push(i%1e7),s+=4);s=n/4}else throw Error(rN);else for(;s<n;)o[s++]=1e7*Math.random()|0;for(n=o[--s],e%=7,n&&e&&(i=rv(10,7-e),o[s]=(n/i|0)*i);0===o[s];s--)o.pop();if(s<0)r=0,o=[0];else{for(r=-1;0===o[0];r-=7)o.shift();for(n=1,i=o[0];i>=10;i/=10)n++;n<7&&(r-=7-n)}return a.e=r,a.d=o,a}function nS(e){return rj(e=new this(e),e.e+1,this.rounding)}function nA(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function nv(e){return new this(e).sin()}function nT(e){return new this(e).sinh()}function nw(e){return new this(e).sqrt()}function nM(e,t){return new this(e).sub(t)}function nO(){var e=0,t=arguments,r=new this(t[0]);for(rR=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return rR=!0,rj(r,this.precision,this.rounding)}function nx(e){return new this(e).tan()}function nU(e){return new this(e).tanh()}function nD(e){return rj(e=new this(e),e.e+1,1)}rD[Symbol.for("nodejs.util.inspect.custom")]=rD.toString,rD[Symbol.toStringTag]="Decimal";var nV=rD.constructor=function e(t){var r,n,i;function s(e){var t,r,n;if(!(this instanceof s))return new s(e);if(this.constructor=s,ng(e)){this.s=e.s,rR?!e.d||e.e>s.maxE?(this.e=NaN,this.d=null):e.e<s.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(n=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;rR?t>s.maxE?(this.e=NaN,this.d=null):t<s.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return rJ(this,e.toString())}if("string"===n)return 45===(r=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===r&&(e=e.slice(1)),this.s=1),rO.test(e)?rJ(this,e):function(e,t){var r,n,i,s,a,o,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),rO.test(t))return rJ(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(rw.test(t))r=16,t=t.toLowerCase();else if(rT.test(t))r=2;else if(rM.test(t))r=8;else throw Error(rb+t);for((s=t.search(/p/i))>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),a=(s=t.indexOf("."))>=0,n=e.constructor,a&&(s=(o=(t=t.replace(".","")).length)-s,i=rz(n,new n(r),s,2*s)),s=c=(u=rk(t,r,1e7)).length-1;0===u[s];--s)u.pop();return s<0?new n(0*e.s):(e.e=r$(u,c),e.d=u,rR=!1,a&&(e=rF(e,i,4*o)),l&&(e=e.times(54>Math.abs(l)?rv(2,l):nV.pow(2,l))),rR=!0,e)}(this,e);if("bigint"===n)return e<0?(e=-e,this.s=-1):this.s=1,rJ(this,e.toString());throw Error(rb+e)}if(s.prototype=rD,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=no,s.clone=e,s.isDecimal=ng,s.abs=r4,s.acos=r6,s.acosh=r9,s.add=r8,s.asin=r7,s.asinh=ne,s.atan=nt,s.atanh=nr,s.atan2=nn,s.cbrt=ni,s.ceil=ns,s.clamp=na,s.cos=nl,s.cosh=nu,s.div=nc,s.exp=nh,s.floor=nd,s.hypot=nm,s.ln=nf,s.log=np,s.log10=n_,s.log2=nC,s.max=ny,s.min=nR,s.mod=nE,s.mul=nb,s.pow=nI,s.random=nN,s.round=nS,s.sign=nA,s.sin=nv,s.sinh=nT,s.sqrt=nw,s.sub=nM,s.sum=nO,s.tan=nx,s.tanh=nU,s.trunc=nD,void 0===t&&(t={}),t&&!0!==t.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<i.length;)t.hasOwnProperty(n=i[r++])||(t[n]=this[n]);return s.config(t),s}(ry);function nL(e,t){let r=e*t;return Number.isSafeInteger(r)?r:new nV(e).mul(t).toNumber()}function nP(e,t){let r=10**Math.trunc(t),n=nj(e,r);return Math.round(nL(e,r)+n)/r}function nk(e,t){let r=10**Math.trunc(t),n=nj(e,r);return Math.floor(nL(e,r)+n)/r}function nF(e,t){let r=10**Math.trunc(t),n=nj(e,r);return Math.ceil(nL(e,r)-n)/r}function nj(e,t){return Number.EPSILON*Math.max(1,Math.abs(nL(e,t)))}function nB(e,t){return e-t*Math.floor(e/t)}rC=new nV(rC),r_=new nV(r_);function n$(e,t=15){return Math.floor(Math.abs(e)).toString().length>=t?e:Number.parseFloat(e.toPrecision(t))}function nH(e,t=12,r=1e-10){let n=n$(e,t);return!function(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}(e,n,r)?n$(e):n}let nW=class e extends ri{static create(){return this._instance=this._instance||new e(0),this._instance}isNull(){return!0}plus(e){return nX.create(0).plus(e)}minus(e){return nX.create(0).minus(e)}multiply(e){return nX.create(0).multiply(e)}divided(e){return nX.create(0).divided(e)}mod(e){return nX.create(0).mod(e)}compare(e,t){return e.isString()?nK.create("").compare(e,t):e.isBoolean()?nz.create(!1).compare(e,t):nX.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(nK.create("")):nK.create(this.concatenate(e.getValue(),et.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(nK.create("")):nK.create(this.concatenate(e.getValue(),et.BACK))}plusBy(e){return nX.create(0).plusBy(e)}minusBy(e){return nX.create(0).minusBy(e)}multiplyBy(e){return nX.create(0).multiplyBy(e)}dividedBy(e){return nX.create(0).dividedBy(e)}compareBy(e,t){return"string"==typeof e?nK.create("").compareBy(e,t):"boolean"==typeof e?nz.create(!1).compareBy(e,t):nX.create(0).compareBy(e,t)}pow(e){return nX.create(0).pow(e)}sqrt(){return nX.create(0).sqrt()}cbrt(){return nX.create(0).cbrt()}cos(){return nX.create(0).cos()}cosh(){return nX.create(0).cosh()}acos(){return nX.create(0).acos()}acosh(){return nX.create(0).acosh()}sin(){return nX.create(0).sin()}sinh(){return nX.create(0).sinh()}asin(){return nX.create(0).asin()}asinh(){return nX.create(0).asinh()}tan(){return nX.create(0).tan()}tanh(){return nX.create(0).tanh()}atan(){return nX.create(0).atan()}atan2(e){return nX.create(0).atan2(e)}atanh(){return nX.create(0).atanh()}log(){return ra.create(en.NUM)}log10(){return ra.create(en.NUM)}exp(){return nX.create(0).exp()}abs(){return nX.create(0).abs()}round(e){return nX.create(0).round(e)}floor(e){return nX.create(0).floor(e)}ceil(e){return nX.create(0).ceil(e)}convertToNumberObjectValue(){return nX.create(0)}convertToBooleanObjectValue(){return nz.create(!1)}};Z(nW,"_instance");let nG=nW,nY=class e extends ri{constructor(e){super(e),Z(this,"_value",!1),this._value=e}static create(t){return t?(this._instanceTrue=this._instanceTrue||new e(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new e(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){let e=this.getValue(),t=0;return e&&(t=1),nX.create(-t)}getReciprocal(){return this.getValue()?nX.create(1):ra.create(en.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,rm(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(t,r){let n=!1;if("string"==typeof t||"number"==typeof t)n=this._compareString(r);else if("boolean"==typeof t){let e=nX.create(+!!t);return this._convertToNumber().compare(e,r)}return e.create(n)}_compareString(e){switch(e){case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:return!0;case el.EQUALS:case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:case el.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){let e=this.getValue(),t=0;return e&&(t=1),nX.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return nZ(this.getValue())}convertToBooleanObjectValue(){return this}};Z(nY,"_instanceTrue"),Z(nY,"_instanceFalse");let nz=nY;class nX extends ri{constructor(e){super(e),Z(this,"_value",0),this._value=Number(e)}static create(e,t=""){let r=new nX(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return nX.create(0).minus(this)}getReciprocal(){return nX.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=this.plusBy(e.getValue());if(t.isError())return t;let r=t9(this.getPattern(),e.getPattern(),eo.PLUS);return nX.create(Number(t.getValue()),r)}equalZero(){return 0===this._value}minus(e){if(e.isArray()){let t=e.getNegative();return t.isError()?t:t.plus(this)}let t=this.minusBy(e.getValue());if(t.isError())return t;let r=t9(this.getPattern(),e.getPattern(),eo.MINUS);return nX.create(Number(t.getValue()),r)}multiply(e){if(e.isArray())return e.multiply(this);let t=this.multiplyBy(e.getValue());if(t.isError())return t;let r=t9(this.getPattern(),e.getPattern(),eo.MULTIPLY);return nX.create(Number(t.getValue()),r)}divided(e){if(e.isArray()){let t=e.getReciprocal();return t.isError()?t:t.multiply(this)}let t=this.dividedBy(e.getValue());if(t.isError())return t;let r=t9(this.getPattern(),e.getPattern(),eo.DIVIDED);return nX.create(Number(t.getValue()),r)}mod(e){if(e.isArray())return e.modInverse(this);let t=this.getValue(),r=e.getValue();if(e.isNull())return ra.create(en.DIV_BY_ZERO);if("string"==typeof r)return ra.create(en.VALUE);if("number"==typeof r){if(0===r)return ra.create(en.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||11259e8*Math.abs(r)<=Math.abs(t))return ra.create(en.NUM);let e=nB(t,r);return Number.isFinite(e)?nX.create(e):ra.create(en.NUM)}if("boolean"==typeof r){let e=+!!r;return 0===e?ra.create(en.DIV_BY_ZERO):nX.create(nB(t,e))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nK.create(this.concatenate(e.getValue(),et.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nK.create(this.concatenate(e.getValue(),et.BACK))}compare(e,t){return e.isArray()?e.compare(this,rm(t)):this.compareBy(e.getValue(),t)}plusBy(e){if("string"==typeof e&&""===e.trim())return ra.create(en.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ra.create(en.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let n=function(e,t){let r=e+t;return Number.isSafeInteger(r)?r:new nV(e).add(t).toNumber()}(t,r);return Number.isFinite(n)?nX.create(n):ra.create(en.NUM)}minusBy(e){if("string"==typeof e&&""===e.trim())return ra.create(en.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ra.create(en.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let n=function(e,t){let r=e-t;return Number.isSafeInteger(r)?r:new nV(e).sub(t).toNumber()}(t,r);return Number.isFinite(n)?nX.create(n):ra.create(en.NUM)}multiplyBy(e){if("string"==typeof e&&""===e.trim())return ra.create(en.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ra.create(en.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let n=nL(t,r);return Number.isFinite(n)?nX.create(n):ra.create(en.NUM)}dividedBy(e){if("string"==typeof e&&""===e.trim())return ra.create(en.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ra.create(en.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);if(0===r)return ra.create(en.DIV_BY_ZERO);let n=function(e,t){let r=e/t;return Number.isSafeInteger(r)?r:new nV(e).div(t).toNumber()}(t,r);return Number.isFinite(n)?nX.create(n):ra.create(en.NUM)}compareBy(e,t){let r=this.getValue(),n=!1;return"string"==typeof e?n=this._compareString(t):"number"==typeof e?n=this._compareNumber(r,e,t):"boolean"==typeof e&&(n=this._compareBoolean(t)),nz.create(n)}_compareString(e){switch(e){case el.EQUALS:case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:return!1;case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:case el.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return Number.isFinite(e)&&Number.isFinite(t)?this._compareFiniteNumber(e,t,r):this._compareInfinity(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case el.EQUALS:return e===t;case el.GREATER_THAN:return e>t;case el.GREATER_THAN_OR_EQUAL:return e>=t;case el.LESS_THAN:return e<t;case el.LESS_THAN_OR_EQUAL:return e<=t;case el.NOT_EQUAL:return e!==t}}_compareBoolean(e){switch(e){case el.EQUALS:case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:return!1;case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:case el.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;let t=this.getValue(),r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;let n=+r.getValue();if(Number.isNaN(n))return ra.create(en.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return ra.create(en.NUM);if(0===t)return n<0?ra.create(en.DIV_BY_ZERO):0===n?ra.create(en.NUM):nX.create(0);let i=t**n;return Number.isFinite(i)?nX.create(i):ra.create(en.NUM)}sqrt(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.sqrt(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}cbrt(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.cbrt(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}cos(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.cos(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}cosh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.cosh(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}acos(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.acos(e);return Number.isNaN(t)?ra.create(en.NUM):nX.create(t)}acosh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.acosh(e);return Number.isNaN(t)?ra.create(en.NUM):nX.create(t)}sin(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.sin(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}sinh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.sinh(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}asin(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.asin(e);return Number.isNaN(t)?ra.create(en.NUM):nX.create(t)}asinh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.asinh(e);return Number.isNaN(t)?ra.create(en.NUM):nX.create(t)}tan(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.tan(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}tanh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.tanh(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}atan(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.atan(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ra.create(en.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);if(0===t&&0===r)return ra.create(en.DIV_BY_ZERO);let e=Math.atan2(t,r);return Number.isFinite(e)?nX.create(e):ra.create(en.NUM)}return"boolean"==typeof r?nX.create(Math.atan2(t,+!!r)):this}atanh(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.atanh(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}log(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return ra.create(en.NUM);let t=Math.log(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}log10(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return ra.create(en.NUM);let t=Math.log10(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}exp(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.exp(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}abs(){let e=this.getValue();if(!Number.isFinite(e))return ra.create(en.NUM);let t=Math.abs(e);return Number.isFinite(t)?nX.create(t):ra.create(en.NUM)}round(e){if(e.isArray())return e.roundInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ra.create(en.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let e=t<0?-nP(Math.abs(t),r):nP(t,r);return Number.isFinite(e)?nX.create(e):ra.create(en.NUM)}return"boolean"==typeof r?nX.create(nP(t,+!!r)):this}floor(e){if(e.isArray())return e.floorInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ra.create(en.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let e=t<0?-nk(Math.abs(t),r):nk(t,r);return Number.isFinite(e)?nX.create(e):ra.create(en.NUM)}return"boolean"==typeof r?nX.create(nk(t,+!!r)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ra.create(en.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ra.create(en.NUM);let e=t<0?-nF(Math.abs(t),r):nF(t,r);return Number.isFinite(e)?nX.create(e):ra.create(en.NUM)}return"boolean"==typeof r?nX.create(nF(t,+!!r)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return nQ(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case el.EQUALS:n=e===t;break;case el.GREATER_THAN:n=e>t;break;case el.GREATER_THAN_OR_EQUAL:n=e>=t;break;case el.LESS_THAN:n=e<t;break;case el.LESS_THAN_OR_EQUAL:n=e<=t;break;case el.NOT_EQUAL:n=e!==t}return n}}let nq=new tE(1e5);class nK extends ri{constructor(e){super(e),Z(this,"_value"),Z(this,"_isHyperlink",!1),Z(this,"_hyperlinkUrl",""),this._value=e}static create(e,t){var r;let n=nq.get(e);if(n&&t&&this.checkCacheByOptions(n,t))return n;let i=new nK(e);return null!=t&&t.isHyperlink&&(i._isHyperlink=t.isHyperlink,i._hyperlinkUrl=null!=(r=t.hyperlinkUrl)?r:""),nq.set(e,i),i}static checkCacheByOptions(e,t){return e.isHyperlink()===t.isHyperlink&&e.getHyperlinkUrl()===t.hyperlinkUrl}getValue(){return this._value}isString(){return!0}isHyperlink(){return this._isHyperlink}getHyperlinkUrl(){return this._hyperlinkUrl}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nK.create(this.concatenate(e.getValue(),et.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nK.create(this.concatenate(e.getValue(),et.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,rm(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),i=!1;if("string"==typeof e){var s;let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),(s=a).indexOf("*")>-1||s.indexOf("?")>-1)return this._checkWildcard(a,t);i=this._compareString(n,a,t)}else"number"==typeof e?i=this._compareNumber(t):"boolean"==typeof e&&(i=this._compareBoolean(t));return nz.create(i)}_compareString(e,t,r){switch(r){case el.EQUALS:return e===t;case el.GREATER_THAN:return e>t;case el.GREATER_THAN_OR_EQUAL:return e>=t;case el.LESS_THAN:return e<t;case el.LESS_THAN_OR_EQUAL:return e<=t;case el.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case el.NOT_EQUAL:case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:return!0;case el.EQUALS:case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case el.EQUALS:case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:return!1;case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:case el.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return nZ(this.getValue())}convertToBooleanObjectValue(){return nz.create(!0)}_checkWildcard(e,t){let r=function(e,t,r){let n=!1;switch(r){case el.EQUALS:n=rc(e,t);break;case el.NOT_EQUAL:n=!rc(e,t);break;case el.GREATER_THAN:case el.GREATER_THAN_OR_EQUAL:n=rc(e,t)||e>rh(t);break;case el.LESS_THAN:case el.LESS_THAN_OR_EQUAL:n=e<rh(t)}return n}(this.getValue().toLocaleLowerCase(),e,t);return nz.create(r)}}function nQ(e){if("boolean"==typeof e)return nz.create(e);let t=!1;if("string"==typeof e){let r=e.toLocaleUpperCase();r===J.TRUE?t=!0:r===J.FALSE&&(t=!1)}else t=1===e;return nz.create(t)}function nZ(e,t=""){if("boolean"==typeof e){let r=0;return e&&(r=1),nX.create(r,t)}return"number"==typeof e?Number.isFinite(e)?nX.create(e,t):ra.create(en.NUM):(0,B.isRealNum)(e)?nX.create(Number(e),t):ra.create(en.VALUE)}function nJ(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];t[r][e]=n1.create(i)}}return t}class n0 extends ri{constructor(e){super("string"==typeof e?e:""),Z(this,"_values",[]),Z(this,"_rowCount",-1),Z(this,"_columnCount",-1),Z(this,"_unitId",""),Z(this,"_sheetId",""),Z(this,"_currentRow",-1),Z(this,"_currentColumn",-1),Z(this,"_sliceCache",new Map),Z(this,"_flattenCache"),Z(this,"_defaultValue",null),Z(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(e){return new n0(e)}static createByArray(e){return new n0({calculateValueList:nJ(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1})}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return(null==(r=this._values[e])?void 0:r[t])||this._defaultValue}getRealValue(e,t){let r=this._values[e];if(null==r)return null;let n=r[t];return null==n?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){return{startRow:0,endRow:this.getRowCount()-1,startColumn:0,endColumn:this.getColumnCount()-1}}iterator(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=r;o<=n;o++)for(let r=i;r<=s;r++)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}iteratorReverse(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=n;o>=r;o--)for(let r=s;r>=i;r--)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nG.create()}getLastCell(){let{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nG.create()}pick(e){let t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){let t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[nG.create()]];let n=[];n[0]=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.get(i,t);if(!(null==r||r.isError())&&!0===r.getValue()){let e=this.get(i,t);n[0].push(e)}}return n}flatten(){if(null!=this._flattenCache)return this._flattenCache;let e=[];e[0]=[];for(let t=0;t<this._rowCount;t++)for(let r=0;r<this._columnCount;r++){let n=this.get(t,r);e[0].push(n)}let t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(null!=this._flattenPosition)return this._flattenPosition;let e=[],t=[],r=[],n=[],i=0;for(let s=0;s<this._rowCount;s++)for(let a=0;a<this._columnCount;a++){let o=this.get(s,a);if(null==o||o.isError()||o.isNull()){i++;continue}o.isString()?(e.push(o),r.push(i++)):(t.push(o),n.push(i++))}let s={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=s,s}slice(e,t){let r=0,n=this._rowCount,i=1,s=0,a=this._columnCount,o=1;if(null!=e&&(r=e[0]||0,n=e[1]||this._rowCount,i=e[2]||1),null!=t&&(s=t[0]||0,a=t[1]||this._columnCount,o=t[2]||1),r>=this._rowCount||s>=this._columnCount)return;let l=`${r}_${n}_${i}_${s}_${a}_${o}`,u=this._sliceCache.get(l);if(null!=u)return u;let c=[],h=this._values,d=0,m=0;for(let e=r;e<n;e+=i){m=0,null==c[d]&&(c[d]=[]);for(let t=s;t<a;t+=o){if(!h[e])return;let r=h[e][t]||this._defaultValue;null==r&&(r=nG.create()),c[d][m]=r,m++}d++}if(0===c.length||0===c[0].length)return;let g=i>1?-1:r+this._currentRow,f=o>1?-1:s+this._currentColumn,p=this._createNewArray(c,c.length,c[0].length,g,f);return p.setDefaultValue(this._defaultValue),this._sliceCache.set(l,p),p}sortByRow(e){let t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){let e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=rl.MIN,r=!1,n=!1){let i,s,a,o,l=(r,l,u)=>{let c;return null==r||((null==(c=!0===n?r.compare(e,el.EQUALS):r.isEqual(e))?void 0:c.getValue())===!0?(i=r,a={row:l,column:u},!1):void(t===rl.MAX?!0===r.isGreaterThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u}):t===rl.MIN&&!0===r.isLessThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u})))};return(r?this.iteratorReverse((e,t,r)=>l(e,t,r)):this.iterator((e,t,r)=>l(e,t,r)),null!=i)?a:null!=s?o:void 0}binarySearch(e,t=ro.MIN,r=rl.MIN){if(e.isError())return;let{stringArray:n,stringPosition:i,numberArray:s,numberPosition:a}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,i,t,r):this._binarySearch(e,s,a,t,r)}_binarySearch(e,t,r,n=ro.MIN,i=rl.MIN){let s=ru(),a=Number(e.getValue()),o=!Number.isNaN(a),l=0,u=t.length-1,c=-1,h=-1,d=-1;for(;l<=u;){let r,i=Math.floor((l+u)/2),m=t[i];if(m.isNull())r=n===ro.MIN?1:-1;else{let t=m.getValue();if(o){let e=Number(t);r=Number.isNaN(e)?1:Math.sign(e-a)}else r=s(t.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===ro.MAX&&(r=-r),0===r){c=i;break}r<0?(h=i,l=i+1):(d=i,u=i-1)}return i===rl.NORMAL?-1!==c?r[c]:void 0:i===rl.MIN?-1!==c?r[c]:n===ro.MIN?r[h]:r[d]:i===rl.MAX?-1!==c?r[c]:n===ro.MIN?r[d]:r[h]:void 0}sum(){let e=nX.create(0);return this.iterator(t=>!!(null==t||t.isString()||t.isBoolean()||t.isNull())||(t.isError()?(e=t,!1):void(e=e.plus(t)))),e}max(){let e=nX.create(-1/0);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isLessThan(t).getValue()&&(e=t)))),e}min(){let e=nX.create(1/0);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isGreaterThan(t).getValue()&&(e=t)))),e}count(){let e=nX.create(0);return this.iterator(t=>{if(null==t||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=nX.create(0);return this.iterator(t=>{if(null==t||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=nX.create(0);return this.iterator(t=>{(null==t||t.isNull()||""===t.getValue())&&(e=e.plusBy(1))}),e}getNegative(){return n0.create("{0}").minus(this)}getReciprocal(){return n0.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){return this.mapValue((t,r,n)=>null==t?nG.create():t.isError()?t:e(t,r,n))}mapValue(e){var t;let r=this._rowCount,n=this._columnCount,i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=null==(t=this._values)?void 0:t[s];if(null==n)r[i]=ra.create(en.VALUE);else{let t=n[i]||this._defaultValue;t?r[i]=e(t,s,i):r[i]=nG.create()}}i.push(r)}return this._createNewArray(i,r,n)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){let t=this.sum(),r=this.count();return t.divided(0===e?r:r.minusBy(1))}median(){let e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||nG.create();if(t.sortByRow(0),r%2==0){let e=t.get(0,r/2)||nG.create(),n=t.get(0,r/2-1)||nG.create();return e.plus(n).divided(nX.create(2))}return t.get(0,(r-1)/2)||nG.create()}var(e=0){let t=this.mean(),r=[[]];this.iterator(e=>{if(null==e||e.isError()||e.isString()||e.isBoolean()||e.isNull())return;let n=e.minus(t).pow(nX.create(2));n.isError()||r[0].push(n)});let{_unitId:n,_sheetId:i,_currentRow:s,_currentColumn:a}=this;return n0.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:i,row:s,column:a}).mean(e)}std(e=0){let t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return function(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];null==i?t[r][e]=null:i.isError()?t[r][e]=i.getErrorType():t[r][e]=i.getValue()}}return t}(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){let t=ru();return(r,n)=>{let i=r[e],s=n[e];return null==i?1:null==s?-1:i.isError()&&i.isError()?0:i.isError()?1:s.isError()?-1:t(i.getValue(),s.getValue())}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_batchOperator(e,t,r,n){let i=[],s=this._rowCount,a=this._columnCount;if(e.isArray()){let o=e.getRowCount(),l=e.getColumnCount();if(s=Math.max(o,s),a=Math.max(l,a),1===o&&1===l){let t=e.getFirstCell();for(let e=0;e<a;e++)i.push(t)}else{if(1!==o||!(this._columnCount>1))return this._batchOperatorArray(e,t,r,n);let s=e.getArrayValue();for(let e=0;e<a;e++)i.push(s[0][e])}}else for(let t=0;t<a;t++)i.push(e);let o=[];for(let e=0;e<a;e++){let s=i[e];this._batchOperatorValue(s,e,o,t,r,n)}let l=this._createNewArray(o,s,a);return l.setDefaultValue(nz.create(!1)),l}_batchOperatorValue(e,t,r,n,i,s){let a=this._rowCount,o=this.getUnitId(),l=this.getSheetId(),u=this.getCurrentRow(),c=this.getCurrentColumn();if(5===n){let{rowsInCache:h,rowsNotInCache:d}=tB.canUseCache(o,l,t+c,u,u+a-1);if(h.length>0){if(i===el.EQUALS){let n=tB.getCellPositions(o,l,t+c,e.getValue(),h);null!=n&&n.forEach(e=>{if(e<u||e>u+a-1)return;let n=e-u;null==r[n]&&(r[n]=[]),r[n][t]=nz.create(!0)})}else{let n=tB.getCellValuePositions(o,l,t+c);null!=n&&n.forEach((n,o)=>{let l,c=nG.create();ei.has(o)?c=ra.create(o):"string"==typeof o?c=nK.create(o):"number"==typeof o?c=nX.create(o):"boolean"==typeof o&&(c=nz.create(o)),((l=c.isError()?c:e.isError()?e:c.compare(e,i,s)).isError()||!0===l.getValue())&&n.forEach(e=>{e>=u&&e<=u+a-1&&(null==r[e-u]&&(r[e-u]=[]),r[e-u][t]=l)})})}if(d.length>0)for(let a of d){let[h,d]=a;for(let a=h;a<=d;a++)this.__batchOperatorRowValue(e,t,r,n,a-u,o,l,u,c,i,s);tB.setContinueBuildingCache(o,l,t+c,h,d)}return}}for(let h=0;h<a;h++)this.__batchOperatorRowValue(e,t,r,n,h,o,l,u,c,i,s);tB.setContinueBuildingCache(o,l,t+c,u,u+a-1)}__batchOperatorRowValue(e,t,r,n,i,s,a,o,l,u,c){let h=this.getValueOrDefault(i,t);if(null==r[i]&&(r[i]=[]),h&&e)if(h.isError())r[i][t]=h;else if(e.isError())r[i][t]=e;else switch(n){case 1:r[i][t]=h.plus(e);break;case 0:r[i][t]=h.minus(e);break;case 2:r[i][t]=h.multiply(e);break;case 3:r[i][t]=h.divided(e);break;case 4:r[i][t]=h.mod(e);break;case 5:u?r[i][t]=h.compare(e,u,c):r[i][t]=ra.create(en.VALUE);break;case 6:r[i][t]=h.concatenateFront(e);break;case 7:r[i][t]=h.concatenateBack(e);break;case 8:r[i][t]=h.pow(e);break;case 9:r[i][t]=h.round(e);break;case 10:r[i][t]=h.floor(e);break;case 12:r[i][t]=h.atan2(e);break;case 11:r[i][t]=h.ceil(e)}else r[i][t]=ra.create(en.NA);null!=h&&(h.isError()?tB.set(s,a,t+l,h.getErrorType(),i+o):tB.set(s,a,t+l,h.getValue(),i+o))}_batchOperatorArray(e,t,r,n){let i=e.getRowCount(),s=e.getColumnCount();i<this._rowCount&&(i=this._rowCount),s<this._columnCount&&(s=this._columnCount);let a=[],o=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let u=0;u<i;u++){let i=[];for(let a=0;a<s;a++){let s,c;if(s=3===o?this.getValueOrDefault(0,0):1===o?this.getValueOrDefault(0,a):2===o?this.getValueOrDefault(u,0):this.getValueOrDefault(u,a),c=3===l?e.getValueOrDefault(0,0):1===l?e.getValueOrDefault(0,a):2===l?e.getValueOrDefault(u,0):e.getValueOrDefault(u,a),s&&c)if(s.isError())i[a]=s;else if(c.isError())i[a]=c;else switch(t){case 1:i[a]=s.plus(c);break;case 0:i[a]=s.minus(c);break;case 2:i[a]=s.multiply(c);break;case 3:i[a]=s.divided(c);break;case 4:i[a]=s.mod(c);break;case 5:r?i[a]=s.compare(c,r,n):i[a]=ra.create(en.VALUE);break;case 6:i[a]=s.concatenateFront(c);break;case 7:i[a]=s.concatenateBack(c);break;case 8:i[a]=s.pow(c);break;case 9:i[a]=s.round(c);break;case 12:i[a]=s.atan2(c);break;case 10:i[a]=s.floor(c);break;case 11:i[a]=s.ceil(c)}else i[a]=ra.create(en.NA)}a.push(i)}return this._createNewArray(a,i,s)}_checkArrayCalculateType(e){return 1===e.getRowCount()&&1===e.getColumnCount()?3:1===e.getRowCount()?1:2*(1===e.getColumnCount())}_formatValue(e){if("string"!=typeof e)return this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;let t=(e=e.slice(1,-1)).split(";"),r=t.length,n=[],i=0;for(let e=0;e<r;e++){let r=t[e].split(","),s=r.length;i<s&&(i=s);let a=[];for(let e=0;e<s;e++){let t=r[e].trim();a.push(n1.create(t))}n.push(a)}return this._rowCount=r,this._columnCount=i,n}_createNewArray(e,t,r,n=-1,i=-1){(-1===this._currentColumn||-1===this._currentRow)&&(n=-1,i=-1);let s={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:i};return n0.create(s)}}class n1{static create(e,t=!1){if(null==e)return nG.create();if("boolean"==typeof e)return nz.create(e);if("string"==typeof e){let r,n=e.toLocaleUpperCase().trim();if(ei.has(n))return ra.create(n);if(n===J.TRUE||n===J.FALSE)return nQ(e);if((0,B.isRealNum)(e))return nX.create(Number(e));if(!t){let{isNumberPattern:t,value:r,pattern:n}=function(e){let t=e;t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let r=rt.get(t);if(r)return{isNumberPattern:!0,value:r.value,pattern:r.pattern};let n=B.numfmt.parseNumber(t);if(n&&n.z)return rr(t,n.v,n.z);let i=B.numfmt.parseDate(t);if(i&&i.z)return rr(t,i.v,i.z);let s=B.numfmt.parseTime(t);return s&&s.z?rr(t,s.v,s.z):{isNumberPattern:!1}}(e);if(t)return nX.create(r,n)}let i=e.replace(/\n/g,"").replace(/\r/g,"");return!function(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')}(i)&&(eL.lastIndex=0,eL.test(i))?n0.create(i):('"'===(r=e.toString()).charAt(0)&&'"'===r.charAt(r.length-1)&&(r=(r=r.slice(1,-1)).replace(/""/g,'"')),nK.create(r))}return"number"==typeof e?nZ(e):ra.create(en.VALUE)}}let n2=new tE(1e4);class n5 extends rn{constructor(e){super(),Z(this,"_forcedSheetId",""),Z(this,"_forcedSheetName",""),Z(this,"_defaultSheetId",""),Z(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),Z(this,"_unitData",{}),Z(this,"_unitStylesData",{}),Z(this,"_filteredOutRows",[]),Z(this,"_defaultUnitId",""),Z(this,"_forcedUnitId",""),Z(this,"_runtimeData",{}),Z(this,"_arrayFormulaCellData",{}),Z(this,"_runtimeArrayFormulaCellData",{}),Z(this,"_runtimeFeatureCellData",{}),Z(this,"_refOffsetX",0),Z(this,"_refOffsetY",0),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:n}=(0,B.moveRangeByOffset)(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(n)&&(n=this.getActiveSheetColumnCount()-1),{...this._rangeData,startRow:e,endRow:r,startColumn:t,endColumn:n}}isReferenceObject(){return!0}iterator(e){let{startRow:t,endRow:r,startColumn:n,endColumn:i}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(ra.create(en.VALUE),t,n);let s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId;for(let o=t;o<=r;o++)for(let r=n;r<=i;r++){if(o<0||r<0)return e(ra.create(en.REF),o,r);let i=this.getCellData(o,r);if(t0(i)){e(null,o,r);continue}let l=this.getCellValueObject(i);if(o===t&&r===n){let e=this.getCellPattern(s,a,o,r);if(e&&l.isNumber()){let t=Number(l.getValue());l=nX.create(t,e)}}if(!1===e(l,o,r))return}}getFirstCell(){if(this._checkIfWorksheetMiss())return ra.create(en.VALUE);let{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return nX.create(0);let n=this.getCellValueObject(r),i=this._forcedUnitId||this._defaultUnitId,s=this._forcedSheetId||this._defaultSheetId,a=this.getCellPattern(i,s,e,t);if(a&&n.isNumber()){let e=Number(n.getValue());n=nX.create(e,a)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=null==(t=e[this.getUnitId()])?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowData)||{}}getColumnData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return ra.create(en.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){let t=function(e){var t;if(null===e)return 0;if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return 0;let r=t.dataStream;return B.BuildTextUtils.transform.getPlainText(r)}return null!=(t=null==e?void 0:e.v)?t:0}(e);if(ei.has(t))return ra.create(t);if(e.t===B.CellValueType.NUMBER){let r=this._getPatternByCell(e);return(0,B.isTextFormat)(r)?nK.create(t.toString()):nZ(t,r)}return e.t===B.CellValueType.STRING||e.t===B.CellValueType.FORCE_STRING?nK.create(t.toString()):e.t===B.CellValueType.BOOLEAN?nQ(t):n1.create(t)}_getPatternByCell(e){var t;let r=this._unitStylesData[this.getUnitId()];if(!r)return"";let n=r.getStyleByCell(e);return(null==(t=null==n?void 0:n.n)?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return null==(e=this._unitData[this.getUnitId()])?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return null==(t=null==(e=this._runtimeData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._arrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._runtimeArrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCellData(e,t){let r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),i=this.getCurrentActiveArrayFormulaCellData(),s=this.getCurrentRuntimeActiveArrayFormulaCellData();return(null==n?void 0:n.getValue(e,t))||(null==s?void 0:s.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(null==i?void 0:i.getValue(e,t))||(null==r?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return t1(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;r||(r=this._rangeData.startRow),n||(n=this._rangeData.startColumn);let i=this.getCellData(r,n);return i?this.getCellValueObject(i):ra.create(en.VALUE)}getCellPattern(e,t,r,n){var i,s,a,o;let l=this._unitStylesData[e];if(!l)return"";let u=null==(a=null==(s=null==(i=this._unitData[e])?void 0:i[t])?void 0:s.cellData)?void 0:a.getValue(r,n);if(!u)return"";let c=l.getStyleByCell(u);return(null==(o=null==c?void 0:c.n)?void 0:o.pattern)||""}toArrayValueObject(e=!0){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${r}_${n}_${i}_${s}`,o=n2.get(a);if(o&&e)return o;let l=n-r+1,u=s-i+1;if(l<0||u<0)return this._getBlankArrayValueObject();let c=Array(l);this.iterator((e,t,n)=>{let s=t-r,a=n-i;c[s]||(c[s]=Array(u)),null==e&&(e=nG.create()),c[s][a]=e});let h={calculateValueList:c,rowCount:c.length,columnCount:(null==(t=c[0])?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:i},d=n0.create(h);return e&&n2.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(null==this._forcedSheetId||0===this._forcedSheetId.length)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){let e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return n0.create(e)}}class n3 extends rn{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}}class n4 extends rn{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;let t=[];for(let e=0;e<this._promiseList.length;e++){let r=this._promiseList[e];null==t[e]&&(t[e]=[]);for(let n=0;n<r.length;n++){let i=r[n];i.isAsyncObject()?t[e][n]=await i.getValue():t[e][n]=i}}let r={calculateValueList:t,rowCount:t.length,columnCount:(null==(e=t[0])?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return n0.create(r)}}class n6 extends n5{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}}class n9 extends n5{constructor(e){super(e);let t=tv(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return ra.create(en.REF);let t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(e,t){let r=e.startRow,n=e.startColumn,i=t.startRow,s=t.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>i?(a.startRow=i,a.endRow=r):(a.startRow=r,a.endRow=i),n>s?(a.startColumn=s,a.endColumn=n):(a.startColumn=n,a.endColumn=s),e.startAbsoluteRefType&&(a.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(a.endAbsoluteRefType=t.startAbsoluteRefType),a}_createRange(e){let t=new n6(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());let{x:r,y:n}=this.getRefOffset();t.setRefOffset(r,n);let i=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),null!=i&&t.setForcedSheetIdDirect(i);let s=this.getForcedUnitId();return s&&t.setForcedUnitIdDirect(s),t}}class n8 extends n5{constructor(e){super(e);let t=tv(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:t.range.startColumn,startRow:NaN,endColumn:t.range.endColumn,endRow:NaN,rangeType:B.RANGE_TYPE.COLUMN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return ra.create(en.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;let i=t.startColumn;return n>i?t.endColumn=n:(t.startColumn=n,t.endColumn=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=B.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${ed.COLON}${e.getToken()}`),this}}class n7 extends n5{constructor(e){super(e);let t=tv(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:NaN,startRow:t.range.startRow,endColumn:NaN,endRow:t.range.endRow,rangeType:B.RANGE_TYPE.ROW};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return ra.create(en.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;let i=t.startRow;return n>i?t.endRow=n:(t.startRow=n,t.endRow=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=B.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${ed.COLON}${e.getToken()}`),this}}function ie(e,t,r,n){let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1,a=[];for(let o=0;o<e;o++){let e=[];for(let a=0;a<t;a++){if(1===i&&1===s){let t=r.isArray()?r.get(0,0):r;e.push(t);continue}if(1===i&&a<s){let t=r.get(0,a);e.push(t);continue}if(1===s&&o<i){let t=r.get(o,0);e.push(t);continue}if(o>=i||a>=s){e.push(null!=n?n:nG.create());continue}let t=r.get(o,a);e.push(t)}a.push(e)}return it(a,e,t)}function it(e,t,r,n="",i=""){return n0.create({calculateValueList:e,rowCount:t,columnCount:r,unitId:n,sheetId:i,row:-1,column:-1})}function ir(e){for(let t of[el.EQUALS,el.NOT_EQUAL,el.GREATER_THAN_OR_EQUAL,el.GREATER_THAN,el.LESS_THAN_OR_EQUAL,el.LESS_THAN])if(e.startsWith(t)){let r=e.substring(t.length);return[t,n1.create(r)]}return[el.EQUALS,n1.create(e)]}function ii(e,t,r,n){if(!r)if(t.isString()){let[e,n]=ir(`${t.getValue()}`);r=e,t=n}else r=el.EQUALS;return e.compare(t,r,n)}function is(e){return!!e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()||(e.isReferenceObject()?!!(e.isCell()||1===e.getRowCount()&&1===e.getColumnCount()):!!(e.isString()||e.isNumber()||e.isBoolean()||e.isError()||e.isNull()))}function ia(e){let t=0,r=0;return e.forEach((e,n)=>{n%2==1&&(e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1)))}),{maxRowLength:t,maxColumnLength:r}}function io(e,t,r,n){let i=t.getRowCount(),s=t.getColumnCount();for(let t=0;t<e.length;t++){if(t%2==1)continue;let a=e[t],o=a.getRowCount(),l=a.getColumnCount();if(o!==i||l!==s)return ie(r,n,ra.create(en.VALUE))}return null}function il(e,t,r,n=!1){let i=[];for(let s=0;s<e.length;s++){if(s%2==1)continue;let a=e[s];ie(t,r,e[s+1],ra.create(en.NA)).iterator((e,t,r)=>{if(!e)return;let s=ii(a,e);if(n&&(s=iu(s,a,e)),void 0===i[t]&&(i[t]=[]),void 0===i[t][r]){i[t][r]=s;return}i[t][r]=function(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t);return i.mapValue((e,t,r)=>{let n=s.get(t,r);return null!=e&&e.isError()?e:null!=n&&n.isError()?n:null!=e&&e.isBoolean()&&null!=n&&n.isBoolean()?nQ(e.getValue()&&n.getValue()):nz.create(!1)})}(i[t][r],s)})}return i}function iu(e,t,r){let[n,i]=ir(`${r.getValue()}`);return e.mapValue((e,r,s)=>{let a=t.get(r,s);if(a&&function(e,t){if(e.isNumber()&&t.isNumber()||e.isBoolean()&&t.isBoolean())return!0;let r=e.isString()&&""===e.getValue(),n=t.isString()&&""===t.getValue();return!!((r||e.isNull())&&(n||t.isNull())||e.isString()&&!r&&t.isString()&&!n)}(a,i))return e;if(null!=a&&a.isError()&&i.isError()&&a.getValue()===i.getValue())return nz.create(!0);if(n===el.EQUALS||n===el.NOT_EQUAL){if(null!=a&&a.isNumber()&&i.isString()){let e=i.convertToNumberObjectValue();if(e.isNumber())return a.compare(e,n)}if(i.isNumber()&&null!=a&&a.isString()){let e=a.convertToNumberObjectValue();if(e.isNumber())return e.compare(i,n)}if(n===el.EQUALS)return nz.create(!1);if(n===el.NOT_EQUAL)return nz.create(!0)}return nz.create(!1)})}var ic=((_=ic||{})[_.CELL=0]="CELL",_[_.COLUMN=1]="COLUMN",_[_.ROW=2]="ROW",_),ih=Object.getOwnPropertyDescriptor;let id=class extends B.Disposable{constructor(e){super(),this._univerInstanceService=e}generateCellValue(e,t){if(""===t.trim())return{v:""};let r=e;if(e.startsWith("#")&&e$(e.slice(1))){let{unitId:t,sheetName:n,range:i}=e5(e.slice(1)),s=this._univerInstanceService.getCurrentUnitOfType(B.UniverInstanceType.UNIVER_SHEET);if(""===t||t===s.getUnitId())if(""===n)r=`#gid=${s.getActiveSheet().getSheetId()}&range=${eQ(i)}`;else{let e=s.getSheetBySheetName(n);e&&(r=`#gid=${e.getSheetId()}&range=${eQ(i)}`)}}else B.Tools.isLegalUrl(e)&&(r=B.Tools.normalizeUrl(e));return{p:B.RichTextBuilder.create().insertLink(t,r).getData()}}};id=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ih(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(y=B.IUniverInstanceService,(e,t)=>y(e,t,0))],id);let im=(0,$.createIdentifier)("univer.formula.hyperlink-engine-formula.service");var ig=Object.getOwnPropertyDescriptor,ip=(e,t)=>(r,n)=>t(r,n,e),iC=((R=iC||{})[R.IDLE=0]="IDLE",R[R.START=1]="START",R[R.START_DEPENDENCY=2]="START_DEPENDENCY",R[R.START_CALCULATION=3]="START_CALCULATION",R[R.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",R[R.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",R[R.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",R[R.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",R[R.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",R),i_=((E=i_||{})[E.INITIAL=0]="INITIAL",E[E.STOP_EXECUTION=1]="STOP_EXECUTION",E[E.NOT_EXECUTED=2]="NOT_EXECUTED",E[E.SUCCESS=3]="SUCCESS",E);let iy=class extends B.Disposable{constructor(e,t){super(),Z(this,"_formulaExecuteStage",0),Z(this,"_stopState",!1),Z(this,"_currentRow",-1),Z(this,"_currentColumn",-1),Z(this,"_currentRowCount",-1/0),Z(this,"_currentColumnCount",-1/0),Z(this,"_currentSubUnitId",""),Z(this,"_currentUnitId",""),Z(this,"_runtimeData",{}),Z(this,"_runtimeOtherData",{}),Z(this,"_unitArrayFormulaRange",{}),Z(this,"_runtimeArrayFormulaCellData",{}),Z(this,"_runtimeClearArrayFormulaCellData",{}),Z(this,"_runtimeFeatureRange",{}),Z(this,"_runtimeFeatureCellData",{}),Z(this,"_functionsExecutedState",0),Z(this,"_functionDefinitionPrivacyVar",new Map),Z(this,"_totalFormulasToCalculate",0),Z(this,"_completedFormulasCount",0),Z(this,"_totalArrayFormulasToCalculate",0),Z(this,"_completedArrayFormulasCount",0),Z(this,"_formulaCycleIndex",0),Z(this,"_isCycleDependency",!1),this._currentConfigService=e,this._hyperlinkEngineFormulaService=t}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){t4.clear(),rt.clear(),tA.clear()}setCurrent(e,t,r,n,i,s){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=i,this._currentUnitId=s}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){let i=this._currentSubUnitId,s=this._currentUnitId;void 0===this._runtimeOtherData[s]&&(this._runtimeOtherData[s]={});let a=this._runtimeOtherData[s];(void 0===a[i]||null===a[i])&&(a[i]={});let o=a[i],l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){let{startRow:e,startColumn:t}=n.getRangePosition();n.iterator((r,n,i)=>{let s=this._getValueObjectOfRuntimeData(r),a=n-e;null==l[a]&&(l[a]=[]),l[a][i-t]=s})}else l=[[this._getValueObjectOfRuntimeData(n)]];(void 0===o[e]||null===o[e])&&(o[e]={}),(void 0===o[e][r]||null===o[e][r])&&(o[e][r]={}),o[e][r][t]=l}setRuntimeData(e){let t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,i=this.currentColumnCount,s=this._currentSubUnitId,a=this._currentUnitId;null==this._runtimeData[a]&&(this._runtimeData[a]={});let o=this._runtimeData[a];null==o[s]&&(o[s]=new(0,B.ObjectMatrix)),null==this._unitArrayFormulaRange[a]&&(this._unitArrayFormulaRange[a]={});let l=this._unitArrayFormulaRange[a];(null===l[s]||void 0===l[s])&&(l[s]={});let u=new(0,B.ObjectMatrix)(l[s]);void 0===this._runtimeArrayFormulaCellData[a]&&(this._runtimeArrayFormulaCellData[a]={});let c=this._runtimeArrayFormulaCellData[a];null==c[s]&&(c[s]=new(0,B.ObjectMatrix)),void 0===this._runtimeClearArrayFormulaCellData[a]&&(this._runtimeClearArrayFormulaCellData[a]={});let h=this._runtimeClearArrayFormulaCellData[a];null==h[s]&&(h[s]=new(0,B.ObjectMatrix));let d=o[s],m=c[s],g=h[s];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){let{startRow:o,startColumn:l,endRow:c,endColumn:h}=e.getRangePosition();if(o===c&&l===h){let n=e.getFirstCell(),i=this._getValueObjectOfRuntimeData(n);d.setValue(t,r,i),g.setValue(t,r,i),tB.set(a,s,r,n.getValue(),t,!0);return}let f={startRow:t,startColumn:r,endRow:c-o+t,endColumn:h-l+r};if(u.setValue(t,r,f),this._checkIfArrayFormulaRangeHasData(a,s,t,r,f)||this._checkIfArrayFormulaExceeded(n,i,f)){let n=this._getValueObjectOfRuntimeData(ra.create(en.SPILL));d.setValue(t,r,n),g.setValue(t,r,n),tB.set(a,s,r,en.SPILL,t,!0);let i=this._currentConfigService.getUnitData();e.iterator((e,u,c)=>{var h,d;let g=u-o+t,f=c-l+r,p=null==(d=null==(h=i[a])?void 0:h[s])?void 0:d.cellData.getValue(g,f);if(u===o&&c===l)m.setValue(t,r,n);else if(null!=p)null==p.v&&(p.v=""),m.setValue(g,f,p);else{if(this._isInOtherArrayFormulaRange(a,s,t,r,g,f))return!0;m.setValue(g,f,{v:""})}})}else{let n=ra.create(en.SPILL);e.iterator((e,i,u)=>{tB.set(a,s,r-l+u,e?e.getValue():0,t-o+i,!0);let c=this._getValueObjectOfRuntimeData(e);if(i===o&&u===l){if(null!=e&&e.isError()&&e.isEqualType(n))return g.setValue(t,r,{}),d.setValue(t,r,{...this._getValueObjectOfRuntimeData(n)}),!1;d.setValue(t,r,{...c})}let h=i-o+t,f=u-l+r;m.setValue(h,f,c)})}}else{let n=this._getValueObjectOfRuntimeData(e);d.setValue(t,r,n),tB.set(a,s,r,e.getValue(),t,!0),g.setValue(t,r,n)}}_getValueObjectOfRuntimeData(e){return null!=e&&e.isString()&&e.isHyperlink()?this._hyperlinkEngineFormulaService.generateCellValue(e.getHyperlinkUrl(),e.getValue()):function(e){let t=null==e?void 0:e.getPattern(),r={},n={};if(t&&(r={s:{n:{pattern:t}}}),null!=e&&e.getCustomData()&&(n={custom:e.getCustomData()}),null==e)return{v:null,...r};if(e.isError())return{v:e.getErrorType(),t:B.CellValueType.STRING,...r,...n};if(e.isValueObject()){let t=e.getValue();return e.isNumber()?{v:t,t:B.CellValueType.NUMBER,...r,...n}:e.isBoolean()?{v:+!!t,t:B.CellValueType.BOOLEAN,...r,...n}:e.isString()?{v:t,t:B.CellValueType.STRING,...r,...n}:e.isNull()?{v:null,...r,...n}:{v:t,t:B.CellValueType.STRING,...r,...n}}}(e)}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,n,i){var s,a,o,l,u,c,h,d,m,g,f;let{startRow:p,startColumn:C,endRow:_,endColumn:y}=i,R=this._currentConfigService.getUnitData(),E=this._currentConfigService.getArrayFormulaCellData();null==(o=null==(a=null==(s=this._unitArrayFormulaRange[e])?void 0:s[t])?void 0:a[r])||o[n];for(let i=p;i<=_;i++)for(let s=C;s<=y;s++){if(i===r&&n===s)continue;let a=null==(c=null==(u=null==(l=this._runtimeData)?void 0:l[e])?void 0:u[t])?void 0:c.getValue(i,s);null==(d=null==(h=null==E?void 0:E[e])?void 0:h[t])||d.getValue(i,s);let o=null==(f=null==(g=null==(m=null==R?void 0:R[e])?void 0:m[t])?void 0:g.cellData)?void 0:f.getValue(i,s),p=this._getRuntimeFeatureCellValue(i,s,t,e);if(!t0(a)||this._isInOtherArrayFormulaRange(e,t,r,n,i,s)||!t0(o)||!t0(p))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return t1(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return null!=e&&void 0!==e.v}_isInOtherArrayFormulaRange(e,t,r,n,i,s){var a;let o=null==(a=this._currentConfigService.getArrayFormulaRange()[e])?void 0:a[t];if(null==o)return!1;let l=!1;return new(0,B.ObjectMatrix)(o).forValue((a,o,u)=>{var c,h;if(a===r&&o===n)return;let d=this._isInArrayFormulaRange(u,i,s),m=null==(h=null==(c=this._runtimeData[e])?void 0:c[t])?void 0:h.getValue(a,o);d&&(null==m?void 0:m.v)!==en.SPILL&&(l=!0)}),l}_isInArrayFormulaRange(e,t,r){if(null==e)return!1;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return t>=n&&t<=s&&r>=i&&r<=a}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){let i=this._currentConfigService.getDirtyRanges();return 0===i.length||er(i,e,t,r,n)}};iy=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ig(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ip(0,tK),ip(1,im)],iy);let iR=(0,$.createIdentifier)("univer.formula.runtime.service");var iE=((b=iE||{})[b.REFERENCE=1]="REFERENCE",b[b.VALUE=2]="VALUE",b[b.OPERATOR=3]="OPERATOR",b[b.FUNCTION=4]="FUNCTION",b[b.LAMBDA=5]="LAMBDA",b[b.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",b[b.ERROR=7]="ERROR",b[b.BASE=8]="BASE",b[b.ROOT=9]="ROOT",b[b.UNION=10]="UNION",b[b.PREFIX=11]="PREFIX",b[b.SUFFIX=12]="SUFFIX",b[b.NULL=13]="NULL",b);let ib=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class iI{constructor(e){Z(this,"_children",[]),Z(this,"_definedNames"),Z(this,"_parent"),Z(this,"_valueObject"),Z(this,"_calculateState",!1),Z(this,"_async",!1),Z(this,"_address",!1),Z(this,"_isForcedCalculateFunction",!1),this._token=e}dispose(){var e;this._children.forEach(e=>{e.dispose()}),null==(e=this._valueObject)||e.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return iE.BASE}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}async executeAsync(){return Promise.resolve(ee.SUCCESS)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];r.push(n.serialize())}let i={token:e,nodeType:this.nodeType};return n>0&&(i.children=r),i}hasDefinedName(e){var t;return(null==(t=this._definedNames)?void 0:t.includes(e))||!1}setDefinedNames(e){this._definedNames=e}getDefinedNames(){return this._definedNames}}class iN extends iI{constructor(e){super(e),Z(this,"_errorValueObject"),this._errorValueObject=ra.create(e)}get nodeType(){return iE.ERROR}static create(e){return new iN(e)}getValue(){return this._errorValueObject}}class iS{get zIndex(){return 0}dispose(){}create(e,t,r){return new iI(e instanceof tM?e.getToken():e)}}class iA extends iI{get nodeType(){return iE.ROOT}execute(){let e=this.getChildren();if(e.length>1)return void this.setValue(ra.create(en.VALUE));let t=e[0];null==t?this.setValue(ra.create(en.VALUE)):this.setValue(t.getValue())}}class iv extends iS{get zIndex(){return ib.get(iE.ROOT)||100}checkAndCreateNodeType(e){if(e instanceof tM&&"R_1"===e.getToken())return new iA("R_1")}}let iT=new tE(5e3);function iw(e,t,r,n,i){let s=iT.get(`${e}${t}`);if(s&&!iM(s,i))return s;let a=r.treeBuilder(t);if(ei.has(a))return iN.create(a);if(null==(s=n.parse(a)))throw Error("astNode is null");return iT.set(`${e}${t}`,s),s}function iM(e,t){let r=t.getDirtyDefinedNameMap(),n=t.getExecuteUnitId();if(null!=n&&null!=r[n]){let t=Object.keys(r[n]);for(let r=0,n=t.length;r<n;r++){let n=t[r];if(e.hasDefinedName(n))return!0}}return!1}let iO=(0,$.createIdentifier)("univer.formula-function.service");class ix extends B.Disposable{constructor(){super(...arguments),Z(this,"_functionExecutors",new Map),Z(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.set(r.functionName,r)}return(0,B.toDisposable)(()=>{for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){iT.forEach((t,r)=>{e.forEach(e=>{r.includes(e)&&iT.delete(r)})})}}var iU=((I=iU||{}).COMPARE="COMPARE",I.DIVIDED="DIVIDED",I.MINUS="MINUS",I.MULTIPLY="MULTIPLY",I.PLUS="PLUS",I.UNION="UNION",I.CUBE="CUBE",I),iD=Object.getOwnPropertyDescriptor,iV=(e,t)=>(r,n)=>t(r,n,e);class iL extends iI{constructor(e,t,r){super(t),this._runtimeService=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return iE.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");this._operatorString===ef.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(nX.create(0),e)):t=this._operatorString===ef.AT?this._handlerAT(e):ra.create(en.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject()||e.isCell())return ra.create(en.VALUE);let t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,{startRow:i,startColumn:s,endRow:a,endColumn:o}=e.getRangePosition();return o!==s&&a!==i||i===a&&s===o?ra.create(en.VALUE):a===i&&n>=s&&n<=o?e.getCellByColumn(n):s===o&&r>=i&&r<=a?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):ra.create(en.VALUE)}}let iP=class extends iS{constructor(e,t){super(),this._functionService=e,this._runtimeService=t}get zIndex(){return ib.get(iE.PREFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tM))return;let t=e.getToken(),r=t.trim();if('"'===r.charAt(0)&&'"'===r.charAt(r.length-1))return;let n="";if(r!==ef.MINUS)return r===ef.AT?new iL(this._runtimeService,r):void 0;n=iU.MINUS;let i=this._functionService.getExecutor(n);return i?new iL(this._runtimeService,r,i):(console.error(`No function ${t}`),iN.create(en.NAME))}};function ik(e,t,r){let n,i,s=e,a=s.slice(0,2),o=0;if(a[0]===ef.MINUS){let e=t.getExecutor(iU.MINUS);n=new iL(r,ef.MINUS,e),o++}return a[0]===ef.AT&&(i=new iL(r,ef.AT),n&&i.setParent(n),o++),o>0&&(s=s.slice(o)),{tokenTrim:s,minusPrefixNode:n,atPrefixNode:i}}iP=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([iV(0,iO),iV(1,iR)],iP),RegExp(ef.MINUS,"g"),RegExp(ef.AT,"g");var iF=Object.getOwnPropertyDescriptor,ij=(e,t)=>(r,n)=>t(r,n,e);class iB extends iI{constructor(e,t,r,n,i,s){super(e),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=n,this._definedNamesService=i,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return iE.FUNCTION}async executeAsync(){let e,t=[],r=this.getChildren(),n=r.length;this._compatibility();for(let e=0;e<n;e++){let n=r[e].getValue();null!=n&&(n.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?t.push(n.toArrayValueObject()):t.push(n))}let i=await this._calculateAsync(t);return e=i.isAsyncObject()||i.isAsyncArrayObject()?await i.getValue():i,this._setRefData(e),this.setValue(e),Promise.resolve(ee.SUCCESS)}execute(){let e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let n=0;n<r;n++){let r=t[n].getValue();null!=r&&(r.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(r),r.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(r.toArrayValueObject()):e.push(r))}let n=this._calculate(e);this._setRefData(n),this.setValue(n)}isFunctionExecutorArgumentsIgnoreNumberPattern(){return this._functionExecutor.isArgumentsIgnoreNumberPattern()}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){let e,t,r=this.getChildren(),n=r.length;if(!this._functionExecutor.needsExpandParams||3!==n)return;let i=r[1].getValue(),s=r[2].getValue();if(!(null!=i&&i.isReferenceObject())&&!(null!=s&&s.isReferenceObject()))return;if(null!=i&&i.isReferenceObject()){let{startRow:r,startColumn:n,endRow:s,endColumn:a}=i.getRangeData();e=s-r+1,t=a-n+1}else e=null!=i&&i.isArray()?i.getRowCount():1,t=null!=i&&i.isArray()?i.getColumnCount():1;let a=s.getRangeData(),{startRow:o,startColumn:l,endRow:u,endColumn:c}=a,h=u-o+1,d=c-l+1;e!==h&&(a.endRow+=e-h),t!==d&&(a.endColumn+=t-d)}_handleCustomResult(e){var t;if("object"!=typeof e||null==e)return n1.create(e);let r=nJ(e);return n0.create({calculateValueList:r,rowCount:r.length,columnCount:(null==(t=r[0])?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(e){return e.map(e=>e.isArray()?e.toValue():e.isLambda()?e:e.getValue())}_calculate(e){let t,{minParams:r,maxParams:n}=this._functionExecutor;if(-1!==r&&-1!==n&&(e.length<r||e.length>n))return ra.create(en.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let r=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));t=this._handleCustomResult(r)}else this._handleAddressFunction(),t=this._functionExecutor.calculate(...e);return t}async _calculateAsync(e){let t,{minParams:r,maxParams:n}=this._functionExecutor;if(-1!==r&&-1!==n&&(e.length<r||e.length>n))return ra.create(en.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let r=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));t=this._handleCustomResult(r)}else this._handleAddressFunction(),t=this._functionExecutor.calculate(...e);return t}_setDefinedNamesForFunction(){let e=this._currentConfigService.getExecuteUnitId();if(null==e)return;let t=this._definedNamesService.getDefinedNameMap(e);null!=t&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){let{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:n}=this._runtimeService;if(this._functionExecutor.setRefInfo(e,t,r,n),this._functionExecutor.needsSheetRowColumnCount){let{rowCount:r,columnCount:n}=this._currentConfigService.getSheetRowColumnCount(e,t);this._functionExecutor.setSheetRowColumnCount(r,n)}}_setRefData(e){e.isReferenceObject()&&(e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData()))}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(e){let{startRow:t,endRow:r}=e.getRangePosition(),n=this._currentConfigService.getFilteredOutRows(e.getUnitId(),e.getSheetId(),t,r);e.setFilteredOutRows(n)}}class i$ extends iI{constructor(e="Error"){super(e)}get nodeType(){return iE.FUNCTION}async executeAsync(){return this.setValue(ra.create(en.NAME)),Promise.resolve(ee.SUCCESS)}execute(){this.setValue(ra.create(en.NAME))}}let iH=class extends iS{constructor(e,t,r,n,i,s){super(),this._functionService=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._injector=i,this._formulaDataModel=s}get zIndex(){return ib.get(iE.FUNCTION)||100}create(e){let t=this._functionService.getExecutor(e);return t?new iB(e,t,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${e}`),iN.create(en.NAME))}checkAndCreateNodeType(e){if("string"==typeof e)return;let{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=ik(e.getToken().trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(e))return iN.create(en.VALUE);let i=t.toUpperCase();if(this._functionService.hasExecutor(i)){let e=this.create(i);return n?e.setParent(n):r&&e.setParent(r),e}}_isParentUnionNode(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken())===ed.COLON}};iH=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iF(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ij(0,iO),ij(1,tK),ij(2,iR),ij(3,ts),ij(4,(0,$.Inject)($.Injector)),ij(5,(0,$.Inject)(tL))],iH);var iW=Object.getOwnPropertyDescriptor;let iG=class extends B.Disposable{constructor(e){super(),this._runtimeService=e}async executeAsync(e){if(!e||!e.node)return Promise.resolve(ra.create(en.VALUE));let t=e.node,r=e.refOffsetX,n=e.refOffsetY;await this._executeAsync(t,r,n);let i=t.getValue();return null==i?Promise.resolve(ra.create(en.VALUE)):Promise.resolve(i)}execute(e){if(!e||!e.node)return ra.create(en.VALUE);let t=e.node,r=e.refOffsetX,n=e.refOffsetY;this._execute(t,r,n);let i=t.getValue();return null==i?ra.create(en.VALUE):i}executePreCalculateNode(e){return e.execute(),e.getValue()}checkAsyncNode(e){if(null==e)return!1;let t=[];this._checkAsyncNode(e,t);for(let e=0,r=t.length;e<r;e++)if(!0===t[e])return!0;return!1}_checkAsyncNode(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];t.push(n.isAsync()),this._checkAsyncNode(n,t)}}async _executeAsync(e,t=0,r=0){if(this._runtimeService.isStopExecution())return Promise.resolve(ee.ERROR);let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===tN&&i.isEmptyParamFunction()){i.execute();continue}await this._executeAsync(i,t,r)}return e.nodeType===iE.REFERENCE&&e.setRefOffset(t,r),e.nodeType===iE.FUNCTION&&e.isAsync()?await e.executeAsync():e.execute(),Promise.resolve(ee.SUCCESS)}_execute(e,t=0,r=0){if(this._runtimeService.isStopExecution())return ee.ERROR;let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===tN&&i.isEmptyParamFunction()){i.execute();continue}this._execute(i,t,r)}return e.nodeType===iE.REFERENCE&&e.setRefOffset(t,r),e.execute(),ee.SUCCESS}};function iY(e){return e instanceof tM&&"L_1"===e.getToken()}function iz(e,t,r){let n=e.getChildren(),i=n.length,s=n[0];for(let e=0;e<i;e++){let i=n[e];if(!(iY(s)&&0!==e))if(i instanceof tM)iz(i,t,r);else{let s=i.trim();if(r.has(s)){let i=new tM;i.setToken(tb),i.setLambdaId(t),i.setLambdaPrivacyVar(r),i.setLambdaParameter(s),n[e]=i}}}}function iX(e,t=0,r=0){return{node:e,refOffsetX:t,refOffsetY:r}}iG=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iW(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iR(e,t,0)],iG);class iq extends ri{constructor(e,t,r){super(0),Z(this,"_lambdaPrivacyValueMap",new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new iq(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){let t,r=this._lambdaPrivacyVarKeys.length;if(e.length!==r||!this._interpreter||!this._lambdaNode)return ra.create(en.VALUE);if(this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1),this._interpreter.checkAsyncNode(this._lambdaNode))t=new n3(this._interpreter.executeAsync(iX(this._lambdaNode)));else{let e=this._interpreter.execute(iX(this._lambdaNode));t=e.isReferenceObject()?e.toArrayValueObject():e}return this._lambdaNode.setNotEmpty(!0),t}executeCustom(...e){let t=e.map(e=>n1.create(e));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken()===tb){let e=r.getLambdaParameter(),t=this._lambdaPrivacyValueMap.get(e);if(t)r.setValue(t);else{let t=function e(t){if(!t)return;if(t.getToken()!==tb)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(!r)return;let i=r.get(n);return null==i&&t.getValue()?t:e(i)}(r.getCurrentLambdaPrivacyVar().get(e));null!=t&&r.setValue(t.getValue())}continue}this._setLambdaNodeValue(r)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){let r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var iK=Object.getOwnPropertyDescriptor,iQ=(e,t)=>(r,n)=>t(r,n,e);class iZ extends iI{constructor(e,t,r,n){super(e),Z(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n}get nodeType(){return iE.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return null===this._lambdaId}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(iq.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{let e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}}let iJ=class extends iS{constructor(e,t){super(),this._runtimeService=e,this._interpreter=t}get zIndex(){return ib.get(iE.LAMBDA)||100}create(e){let t=e.getChildren(),r=t[0],n=t.slice(1,-1),i=t[t.length-1];if(!(r instanceof tM&&i instanceof tM))return iN.create(en.NAME);if("L_1"===r.getToken()){let e=r.getChildren();if(n.length!==e.length)return iN.create(en.VALUE)}else n=t.slice(0,-1);let s=(0,B.generateRandomId)(8),a=new Map;for(let e=0;e<n.length;e++){let t=n[e];if(!(t instanceof tM))return iN.create(en.VALUE);{let e=t.getChildren()[0];t.setToken(tI),a.set(e.trim(),void 0)}}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(i,s,a),new iZ(e.getToken(),s,this._interpreter,[...a.keys()])}checkAndCreateNodeType(e){if(e instanceof tM&&e.getToken().trim().toUpperCase()===tN)return this.create(e)}_updateLambdaStatement(e,t,r){iz(e,t,r)}};iJ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iK(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([iQ(0,iR),iQ(1,(0,$.Inject)(iG))],iJ);class i0 extends iI{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return iE.LAMBDA_PARAMETER}execute(){let e=function e(t){if(!t)return;if(t.getToken()!==tb)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(r)return e(r.get(n))}(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{let e=this.getValue();(null==e||e.isError())&&this.setValue(ra.create(en.NAME))}}}class i1 extends iS{get zIndex(){return ib.get(iE.LAMBDA_PARAMETER)||100}create(e){let t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new i0(e.getToken(),r,t):new iN(en.NAME)}checkAndCreateNodeType(e){if(e instanceof tM&&e.getToken().trim()===tb)return this.create(e)}}class i2 extends iI{constructor(e){super(e),this._operatorString=e}get nodeType(){return iE.NULL}execute(){this.setValue(nG.create())}}var i5=((N=i5||{}).ABS="ABS",N.ACOS="ACOS",N.ACOSH="ACOSH",N.ACOT="ACOT",N.ACOTH="ACOTH",N.AGGREGATE="AGGREGATE",N.ARABIC="ARABIC",N.ASIN="ASIN",N.ASINH="ASINH",N.ATAN="ATAN",N.ATAN2="ATAN2",N.ATANH="ATANH",N.BASE="BASE",N.CEILING="CEILING",N.CEILING_MATH="CEILING.MATH",N.CEILING_PRECISE="CEILING.PRECISE",N.COMBIN="COMBIN",N.COMBINA="COMBINA",N.COS="COS",N.COSH="COSH",N.COT="COT",N.COTH="COTH",N.CSC="CSC",N.CSCH="CSCH",N.DECIMAL="DECIMAL",N.DEGREES="DEGREES",N.EVEN="EVEN",N.EXP="EXP",N.FACT="FACT",N.FACTDOUBLE="FACTDOUBLE",N.FLOOR="FLOOR",N.FLOOR_MATH="FLOOR.MATH",N.FLOOR_PRECISE="FLOOR.PRECISE",N.GCD="GCD",N.INT="INT",N.ISO_CEILING="ISO.CEILING",N.LCM="LCM",N.LET="LET",N.LN="LN",N.LOG="LOG",N.LOG10="LOG10",N.MDETERM="MDETERM",N.MINVERSE="MINVERSE",N.MMULT="MMULT",N.MOD="MOD",N.MROUND="MROUND",N.MULTINOMIAL="MULTINOMIAL",N.MUNIT="MUNIT",N.ODD="ODD",N.PI="PI",N.POWER="POWER",N.PRODUCT="PRODUCT",N.QUOTIENT="QUOTIENT",N.RADIANS="RADIANS",N.RAND="RAND",N.RANDARRAY="RANDARRAY",N.RANDBETWEEN="RANDBETWEEN",N.ROMAN="ROMAN",N.ROUND="ROUND",N.ROUNDBANK="ROUNDBANK",N.ROUNDDOWN="ROUNDDOWN",N.ROUNDUP="ROUNDUP",N.SEC="SEC",N.SECH="SECH",N.SERIESSUM="SERIESSUM",N.SEQUENCE="SEQUENCE",N.SIGN="SIGN",N.SIN="SIN",N.SINH="SINH",N.SQRT="SQRT",N.SQRTPI="SQRTPI",N.SUBTOTAL="SUBTOTAL",N.SUM="SUM",N.SUMIF="SUMIF",N.SUMIFS="SUMIFS",N.SUMPRODUCT="SUMPRODUCT",N.SUMSQ="SUMSQ",N.SUMX2MY2="SUMX2MY2",N.SUMX2PY2="SUMX2PY2",N.SUMXMY2="SUMXMY2",N.TAN="TAN",N.TANH="TANH",N.TRUNC="TRUNC",N),i3=((S=i3||{}).ASC="ASC",S.ARRAYTOTEXT="ARRAYTOTEXT",S.BAHTTEXT="BAHTTEXT",S.CHAR="CHAR",S.CLEAN="CLEAN",S.CODE="CODE",S.CONCAT="CONCAT",S.CONCATENATE="CONCATENATE",S.DBCS="DBCS",S.DOLLAR="DOLLAR",S.EXACT="EXACT",S.FIND="FIND",S.FINDB="FINDB",S.FIXED="FIXED",S.LEFT="LEFT",S.LEFTB="LEFTB",S.LEN="LEN",S.LENB="LENB",S.LOWER="LOWER",S.MID="MID",S.MIDB="MIDB",S.NUMBERSTRING="NUMBERSTRING",S.NUMBERVALUE="NUMBERVALUE",S.PHONETIC="PHONETIC",S.PROPER="PROPER",S.REGEXEXTRACT="REGEXEXTRACT",S.REGEXMATCH="REGEXMATCH",S.REGEXREPLACE="REGEXREPLACE",S.REPLACE="REPLACE",S.REPLACEB="REPLACEB",S.REPT="REPT",S.RIGHT="RIGHT",S.RIGHTB="RIGHTB",S.SEARCH="SEARCH",S.SEARCHB="SEARCHB",S.SUBSTITUTE="SUBSTITUTE",S.T="T",S.TEXT="TEXT",S.TEXTAFTER="TEXTAFTER",S.TEXTBEFORE="TEXTBEFORE",S.TEXTJOIN="TEXTJOIN",S.TEXTSPLIT="TEXTSPLIT",S.TRIM="TRIM",S.UNICHAR="UNICHAR",S.UNICODE="UNICODE",S.UPPER="UPPER",S.VALUE="VALUE",S.VALUETOTEXT="VALUETOTEXT",S.CALL="CALL",S.EUROCONVERT="EUROCONVERT",S.REGISTER_ID="REGISTER.ID",S),i4=Object.getOwnPropertyDescriptor;class i6 extends iI{constructor(e,t){super(e),this._functionExecutor=t}get nodeType(){return iE.OPERATOR}execute(){let e=this.getChildren();this._functionExecutor.name===iU.COMPARE&&this._functionExecutor.setCompareType(this.getToken());let t=e[0],r=e[1],n=null==t?void 0:t.getValue(),i=null==r?void 0:r.getValue(),s=this.getToken();if((null==n||null==i)&&s!==eo.MINUS&&s!==eo.PLUS)return void this.setValue(ra.create(en.VALUE));null==n&&(n=nG.create()),null==i&&(i=nG.create()),n.isReferenceObject()&&(n=n.toArrayValueObject()),i.isReferenceObject()&&(i=i.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(n,i))}}let i9=class extends iS{constructor(e){super(),this._functionService=e}get zIndex(){return ib.get(iE.OPERATOR)||100}create(e){let t="";e===eo.PLUS?t=iU.PLUS:e===eo.MINUS?t=iU.MINUS:e===eo.MULTIPLY?t=iU.MULTIPLY:e===eo.DIVIDED?t=iU.DIVIDED:e===eo.CONCATENATE?t=i3.CONCATENATE:e===eo.POWER?t=i5.POWER:eh.has(e)&&(t=iU.COMPARE);let r=this._functionService.getExecutor(t);return r?new i6(e,r):(console.error(`No function ${e}`),iN.create(en.NAME))}checkAndCreateNodeType(e){if(e instanceof tM)return;let t=e.trim();if(('"'!==t.charAt(0)||'"'!==t.charAt(t.length-1))&&ec.has(t))return this.create(t)}};i9=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i4(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iO(e,t,0)],i9);var i8=Object.getOwnPropertyDescriptor,i7=(e,t)=>(r,n)=>t(r,n,e);class se extends iI{constructor(e,t,r,n,i=!1){super(r),Z(this,"_refOffsetX",0),Z(this,"_refOffsetY",0),this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=i}get nodeType(){return iE.REFERENCE}execute(){let e=this._currentConfigService,t=this._runtimeService,r=function(e,t){let r;switch(t){case 0:r=new n9(e);break;case 1:r=new n8(e);break;case 2:r=new n7(e);break;default:throw Error("Unknown reference object type")}return r}(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());let{x:n,y:i}=this.getRefOffset();r.setRefOffset(n,i),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(ra.create(en.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}let st=class extends iS{constructor(e,t,r){super(),this._currentConfigService=e,this._formulaRuntimeService=t,this._functionService=r}get zIndex(){return ib.get(iE.REFERENCE)||100}checkAndCreateNodeType(e){var t,r;let n,i=!1,s,a=!1;e instanceof tM?(i=!0,s=e.getToken().trim(),(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ed.COLON&&(a=!0)):s=e.trim();let o=this._currentConfigService,l=this._formulaRuntimeService,{tokenTrim:u,minusPrefixNode:c,atPrefixNode:h}=ik(s,this._functionService,l);if((i||'"'!==u.charAt(0)||'"'!==u.charAt(u.length-1))&&(eP(u)?n=new se(o,l,u,ic.CELL,a):i&&this._checkParentIsUnionOperator(e)&&(ej(u)?n=new se(o,l,u,ic.ROW,a):eB(u)&&(n=new se(o,l,u,ic.COLUMN,a))),n))return h?n.setParent(h):c&&n.setParent(c),n}_checkParentIsUnionOperator(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ed.COLON}};st=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i8(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([i7(0,tK),i7(1,iR),i7(2,iO)],st);var sr=Object.getOwnPropertyDescriptor,sn=(e,t)=>(r,n)=>t(r,n,e);class si extends iI{constructor(e,t,r,n){super(r),this._currentConfigService=e,this._lexer=t,this._operatorString=r,this._functionExecutor=n}get nodeType(){return iE.SUFFIX}execute(){var e;let t=null==(e=this.getChildren()[0])?void 0:e.getValue(),r;if(null==t)return void this.setValue(ra.create(en.ERROR));if(this._operatorString===em.PERCENTAGE){if(t.isReferenceObject()&&(t=t.toArrayValueObject()),(r=this._functionExecutor.calculate(t,nX.create(100))).isNumber()){let e=Number(r.getValue());r=nX.create(e,"0.00%")}}else r=this._operatorString===em.POUND?this._handlerPound(t):ra.create(en.VALUE);this.setValue(r)}_handlerPound(e){var t,r,n,i;if(!e.isReferenceObject()||!e.isCell())return ra.create(en.VALUE);let s=e.getRangePosition(),a=e.getUnitId(),o=e.getSheetId(),l=this._currentConfigService.getFormulaData(),u=null==(i=null==(n=null==(r=null==(t=null==l?void 0:l[a])?void 0:t[o])?void 0:r[s.startRow])?void 0:n[s.startColumn])?void 0:i.f;return u&&this._lexer.treeBuilder(u),ra.create(en.VALUE)}}let ss=class extends iS{constructor(e,t,r){super(),this._functionService=e,this._lexer=t,this._currentConfigService=r}get zIndex(){return ib.get(iE.SUFFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tM))return;let t=e.getToken().trim();if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return;let r="";if(t!==em.PERCENTAGE)return t===em.POUND?new si(this._currentConfigService,this._lexer,t):void 0;r=iU.DIVIDED;let n=this._functionService.getExecutor(r);return n?new si(this._currentConfigService,this._lexer,t,n):(console.error(`No function ${e}`),iN.create(en.NAME))}};ss=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sr(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sn(0,iO),sn(1,(0,$.Inject)(tJ)),sn(2,tK)],ss);var sa=Object.getOwnPropertyDescriptor;class so extends iI{constructor(e){super(e)}get nodeType(){return iE.UNION}execute(){let e,t=this.getChildren(),r=t[0],n=t[1],i=r.getValue(),s=n.getValue();if(null==i||null==s)throw Error("leftNode and rightNode");e=this.getToken()===ed.COLON?this._unionFunction(i,s):ra.create(en.NAME),this.setValue(e)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?ra.create(en.REF):e.isCell()&&t.isCell()||e.isRow()&&t.isRow()||e.isColumn()&&t.isColumn()?e.unionBy(t):ra.create(en.NAME)}}let sl=class extends iS{constructor(e){super(),this._functionService=e}get zIndex(){return ib.get(iE.UNION)||100}create(e){return new so(e)}checkAndCreateNodeType(e){if(!(e instanceof tM))return;let t=e.getToken().trim();if(('"'!==t.charAt(0)||'"'!==t.charAt(t.length-1))&&t===ed.COLON)return this.create(t)}};sl=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sa(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iO(e,t,0)],sl);class su extends iI{constructor(e){super(e)}get nodeType(){return iE.VALUE}execute(){var e;let t=(null==(e=this.getParent())?void 0:e.nodeType)===iE.FUNCTION&&this.getParent().isFunctionExecutorArgumentsIgnoreNumberPattern();this.setValue(n1.create(this.getToken(),t))}}class sc extends iS{get zIndex(){return ib.get(iE.VALUE)||100}_checkValueNode(e){if(!Number.isNaN(Number(e)))return this.create(e);{let t=e.trim(),r=t.charAt(0),n=t.charAt(t.length-1);if(ei.has(t)||'"'===r&&'"'===n||"{"===r&&"}"===n)return this.create(t);let i=t.toUpperCase();if(i===J.TRUE||i===J.FALSE)return this.create(i)}}create(e){return new su(e)}checkAndCreateNodeType(e){if(!(e instanceof tM))return this._checkValueNode(e)}}var sh=Object.getOwnPropertyDescriptor,sd=(e,t)=>(r,n)=>t(r,n,e);let sm=class extends B.Disposable{constructor(e,t,r,n,i,s,a,o,l,u,c){super(),Z(this,"_astNodeFactoryList",[]),this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=i,this._operatorNodeFactory=s,this._prefixNodeFactory=a,this._referenceNodeFactory=o,this._suffixNodeFactory=l,this._unionNodeFactory=u,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){let t=new iA("R_1"),r=this._parse(e,t);return e.hasDefinedNames()&&(null==r||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(null==t.getLambdaId)return iN.create(en.VALUE);let r=t.getLambdaId(),n=new iA("R_1"),i=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!i)return!1;let s=[...i.keys()],a=e.getChildren(),o=a.length;for(let e=0;e<o;e++){let t=a[e];if(!(t instanceof tM))return!1;{iz(t,r,i),this._parse(t,n);let a=n.getChildren()[e];null!=a&&i.set(s[e],a)}}return n.setParent(t),t}_changeLetToLambda(e){let t=e.getChildren(),r=t.length;if(r%2!=1||0===r)return;let n=new tM;n.setToken(tN);let i=new tM;i.setToken("L_1");let s=[...t];for(let e=0;e<r;e++){let t=s[e];if(!(t instanceof tM))return;e%2==0?t.changeToParent(n):t.changeToParent(i)}n.addChildrenFirst(i),i.setParent(n);let a=e.getParent();return null==a||a.replaceChild(e,n),n}_parse(e,t){var r;let n=e.getChildren(),i=n.length,s=[],a=null,o=e.getToken().trim().toUpperCase();if("LET"===o){let r=this._changeLetToLambda(e);return null!=r?this._parse(r,t):iN.create(en.ERROR)}if("P_1"===o){if(a=t,0===i)return new i2("R_1").setParent(t),a}else{if("L_1"===o){let r=this._lambdaParameterHandler(e,t);return!1===r&&(r=iN.create(en.ERROR)),r}if(null==(a=this._checkAstNode(e)))return iN.create(en.NAME)}let l=n[0];for(let e=0;e<i;e++){let t=n[e];if(iY(l)){if(0!==e&&e!==i-1)continue}else if(t instanceof tM&&t.getToken()===tI&&e!==i-1)continue;let o=null;if(t instanceof tM){if("P_1"===t.getToken()&&0===t.getChildren().length){let e=null==(r=t.getParent())?void 0:r.getChildren();if(e&&1===e.length)return iN.create(en.NAME)}if((o=this._parse(t,a))===a)continue}else o=this._checkAstNode(t);if(null==o)return iN.create(en.NAME);if(null==(o=function(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}(o))||(null==o?void 0:o.nodeType)===iE.ERROR)return o;switch(o.nodeType){case iE.FUNCTION:{let e=o.getToken().trim().toUpperCase();tS.has(e)&&o.setForcedCalculateFunction(),s.push(o);break}case iE.LAMBDA:case iE.LAMBDA_PARAMETER:s.push(o);break;case iE.OPERATOR:{let e=s.pop(),t=s.pop();t&&t.setParent(o),e&&e.setParent(o),s.push(o);break}case iE.REFERENCE:case iE.ROOT:case iE.UNION:case iE.VALUE:case iE.PREFIX:case iE.SUFFIX:s.push(o)}}let u=s.length;for(let e=0;e<u;e++)s[e].setParent(a);return a}_checkAstNode(e){let t=null,r=this._astNodeFactoryList.length;for(let n=0;n<r&&null==(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e));n++);return null==t?new i$:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(B.sortRules)}};sm=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sh(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sd(0,iR),sd(1,(0,$.Inject)(iv)),sd(2,(0,$.Inject)(iH)),sd(3,(0,$.Inject)(iJ)),sd(4,(0,$.Inject)(i1)),sd(5,(0,$.Inject)(i9)),sd(6,(0,$.Inject)(iP)),sd(7,(0,$.Inject)(st)),sd(8,(0,$.Inject)(ss)),sd(9,(0,$.Inject)(sl)),sd(10,(0,$.Inject)(sc))],sm);class sg extends B.Disposable{constructor(){super(...arguments),Z(this,"_otherFormulaData",new Map),Z(this,"_featureFormulaData",new Map),Z(this,"_formulaData",new Map),Z(this,"_definedNameMap",new Map),Z(this,"_otherFormulaDataMainData",new Set),Z(this,"_dependencyRTreeCache",new(0,B.RTree)),Z(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw Error("Method not implemented.")}getTreeById(e){throw Error("Method not implemented.")}getAllTree(){throw Error("Method not implemented.")}reset(){throw Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw Error("Method not implemented.")}addFormulaDependency(e,t,r,n,i){throw Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}clearFormulaDependency(e,t){throw Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._otherFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._featureFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}getFormulaDependency(e,t,r,n){var i,s;return null==(s=null==(i=this._formulaData.get(e))?void 0:i.get(t))?void 0:s.getValue(r,n)}addDependencyRTreeCache(e){let t=[];for(let r=0;r<e.rangeList.length;r++){let{unitId:n,sheetId:i,range:s}=e.rangeList[r];t.push({unitId:n,sheetId:i,range:s,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){let e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);let n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){let r=e.treeId;for(let n of(null==t?void 0:t.getDefinedNames())||[])this._addDefinedName(e.unitId,n,r)}}class sf extends sg{constructor(){super(...arguments),Z(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){let r=this.getAllTree();return 0===e.length?this._buildReverseDependency(r,t):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e)),r}_buildDependencyTree(e,t){let r=new Map;for(let e=0;e<t.length;e++){let n=t[e];r.set(n.treeId,n)}for(let t=0;t<e.length;t++){let n=e[t],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}_buildReverseDependency(e,t){let r=new Map;for(let t=0;t<e.length;t++){let n=e[t];r.set(n.treeId,n)}for(let e=0;e<t.length;e++){let n=t[e],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}getAllTree(){let e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);let i=this._otherFormulaData.get(e);i.has(t)||i.set(t,new Map);let s=i.get(t);s.has(r)||s.set(r,new(0,B.ObjectMatrix)),s.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){let n=this._otherFormulaData.get(e);if(n&&n.has(t)){let i=n.get(t);r.forEach(e=>{let t=i.get(e);null!=t&&(t.forValue((e,t,r)=>{this._removeDependencyRTreeCache(r),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),i.delete(e),this._otherFormulaDataMainData.delete(e))}),0===i.size&&n.delete(t),0===n.size&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){let r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}n.clear()}else if(r){for(let t of r.keys()){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);let i=this._featureFormulaData.get(e);i.has(t)||i.set(t,new Map),i.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){let n=this._featureFormulaData.get(e);if(n&&n.has(t)){let e=n.get(t);r.forEach(t=>{let r=e.get(t);null!=r&&(this._removeDependencyRTreeCache(r),e.delete(t),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r))})}}clearFeatureFormulaDependency(e,t){let r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))}),n.clear()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,i){this._formulaData.has(e)||this._formulaData.set(e,new Map);let s=this._formulaData.get(e);s.has(t)||s.set(t,new(0,B.ObjectMatrix)),s.get(t).setValue(r,n,i.treeId),this._addAllTreeMap(i)}removeFormulaDependency(e,t,r,n){let i=this._formulaData.get(e);if(i&&i.has(t)){let e=i.get(t),s=e.getValue(r,n);if(null==s)return;this._removeDependencyRTreeCache(s),e.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s)}}clearFormulaDependency(e,t){let r=this._formulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),n.reset()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(null==e)return;let t=e.parents,r=e.children,n=this._allTreeMap;for(let r of t){let t=n.get(r);null==t||t.children.delete(e.treeId)}for(let t of r){let r=n.get(t);null==r||r.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(null==e)return;let t=this._allTreeMap.get(e);if(t){let r=[];for(let n=0;n<t.rangeList.length;n++){let{unitId:i,sheetId:s,range:a}=t.rangeList[n];r.push({unitId:i,sheetId:s,range:a,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){let r=this._definedNameMap.get(e);if(r){let e=r.get(t);if(e){for(let t of e)this._removeDependencyRTreeCache(t),this.clearDependencyForTree(this._allTreeMap.get(t)),this._removeAllTreeMap(t);e.clear()}}}_removeAllTreeMap(e){null!=e&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}let sp=(0,$.createIdentifier)("univer.formula.dependency-manager.service");class sC extends B.Disposable{constructor(){super(...arguments),Z(this,"_referenceExecutorMap",new Map),Z(this,"_onChanged$",new(0,q.Subject)),Z(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(r=>{var n,i;null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))||i.delete(r)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,i;return null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))?void 0:i.get(r)}has(e,t,r){var n,i;return!!(null!=(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))&&i.has(r))}register(e,t,r,n){let i=this._referenceExecutorMap.get(e);i||(i=new Map,this._referenceExecutorMap.set(e,i));let s=i.get(t);s||(s=new Map,i.set(t,s)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),s.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}let s_=(0,$.createIdentifier)("univer.formula.feature-calculation-manager.service");class sy extends B.Disposable{constructor(){super(...arguments),Z(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var t,r,n;let{unitId:i,subUnitId:s,formulaId:a}=e;null==(n=null==(r=null==(t=this._otherFormulaData)?void 0:t[i])?void 0:r[s])||delete n[a]}get(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s]}has(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return(null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s])!=null}register(e){let{unitId:t,subUnitId:r,formulaId:n,item:i}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=i}batchRegister(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{let i=n[r];if(null==i)return!0;this.register({unitId:t,subUnitId:e,formulaId:r,item:i})})})})}batchRemove(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{this.remove({unitId:t,subUnitId:e,formulaId:r})})})})}getOtherFormulaData(){return this._otherFormulaData}}let sR=(0,$.createIdentifier)("univer.formula.other-formula-manager.service");var sE=((A=sE||{})[A.NORMAL_FORMULA=0]="NORMAL_FORMULA",A[A.OTHER_FORMULA=1]="OTHER_FORMULA",A[A.FEATURE_FORMULA=2]="FEATURE_FORMULA",A);class sb{constructor(){Z(this,"_state",0),Z(this,"treeId"),Z(this,"children",new Set),Z(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return 1===this._state}setSkip(){this._state=2}isSkip(){return 2===this._state}pushChildren(e){this.children.add(e.treeId),e._pushParent(this)}hasChildren(e){return this.children.has(e)}_pushParent(e){this.parents.add(e.treeId)}}class sI extends sb{constructor(){super(...arguments),Z(this,"refTree"),Z(this,"refOffsetX",-1),Z(this,"refOffsetY",-1),Z(this,"isCache",!1),Z(this,"isDirty",!1),Z(this,"addressFunctionNodes",[]),Z(this,"getDirtyData"),Z(this,"featureId")}get isVirtual(){return!0}get row(){return null==this.refTree?-1:this.refTree.row+this.refOffsetY}get column(){return null==this.refTree?-1:this.refTree.column+this.refOffsetX}get rowCount(){return null==this.refTree?0:this.refTree.rowCount}get columnCount(){return null==this.refTree?0:this.refTree.columnCount}get unitId(){return null==this.refTree?"":this.refTree.unitId}get subUnitId(){return null==this.refTree?"":this.refTree.subUnitId}get formula(){var e,t;return null!=(t=null==(e=this.refTree)?void 0:e.formula)?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return null==(e=this.refTree)?void 0:e.node}dispose(){this.refTree=null}get rangeList(){let e=[];if(null==this.refTree)return[];for(let t=0;t<this.refTree.rangeList.length;t++){let r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:(0,B.moveRangeByOffset)(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){return null!=this.refTree&&this.refTree.dependencySheetName(e)}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=1/0),Number.isNaN(h)&&(h=1/0);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}get formulaId(){return null==this.refTree?"":this.refTree.formulaId}}class sN extends sb{constructor(e){super(),Z(this,"isCache",!1),Z(this,"featureId"),Z(this,"featureDirtyRanges",[]),Z(this,"refOffsetX",0),Z(this,"refOffsetY",0),Z(this,"type",0),Z(this,"formulaId"),Z(this,"subUnitId",""),Z(this,"unitId",""),Z(this,"rangeList",[]),Z(this,"formula",""),Z(this,"row",-1),Z(this,"column",-1),Z(this,"rowCount",-1/0),Z(this,"columnCount",-1/0),Z(this,"isDirty",!1),Z(this,"node"),Z(this,"addressFunctionNodes",[]),Z(this,"getDirtyData"),this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){var t;let r=this.rangeList;if(0===r.length||null==e)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s}=r[n];if((null==(t=e[i])?void 0:t[s])!=null)return!0}return!1}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=1/0),Number.isNaN(h)&&(h=1/0);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return 0===this.rangeList.length&&2!==this.type}toRTreeItem(){if(null!=this.featureId)return this.featureDirtyRanges;let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var sS=Object.getOwnPropertyDescriptor,sA=(e,t)=>(r,n)=>t(r,n,e);function sv(e){return e.getLastTreeId()||0}let sT=(0,$.createIdentifier)("engine-formula.dependency-generator"),sw=class extends B.Disposable{constructor(e,t,r,n,i,s,a,o){super(),Z(this,"_updateRangeFlattenCache",new Map),Z(this,"_dependencyRTreeCacheForAddressFunction",new(0,B.RTree)),Z(this,"_executedAddressFunctionNodeIds",new Set),this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=i,this._astTreeBuilder=s,this._lexer=a,this._dependencyManagerService=o}dispose(){this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),iT.clear()}async generate(){this._updateRangeFlatten();let e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();null!=r&&Object.keys(r).forEach(e=>{null!=e&&Object.keys(r[e]).forEach(t=>{null!=t&&(this._dependencyManagerService.clearOtherFormulaDependency(e,t),this._dependencyManagerService.clearFeatureFormulaDependency(e,t),this._dependencyManagerService.clearFormulaDependency(e,t))})});let n=this._currentConfigService.getUnitData(),i=await this._generateTreeList(e,t,n),s=this._getUpdateTreeListAndMakeDependency(i),a=this._calculateRunList(s);return this._dependencyFeatureCalculation(a)&&(a.forEach(e=>{e.resetState()}),a=this._calculateRunList(a)),this._checkIsCycleDependency(a)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),Promise.resolve(a)}_dependencyFeatureCalculation(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();if(0===t.size)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((t,n)=>{t.forEach((t,n)=>{t.forEach((t,n)=>{let{unitId:i,subUnitId:s,getDirtyData:a}=t,o=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),l=this._convertDirtyRangesToUnitRange(o.dirtyRanges),u=this._intersectFeatureCalculation(l,e,{unitId:i,subUnitId:s,featureId:n});if(u.length>0){let a=this._getExistTreeList({unitId:i,subUnitId:s,featureId:n},e);null==a&&(a=this._getFeatureFormulaTree(n,sv(this._dependencyManagerService),t),e.push(a)),a.parents=new Set,u.forEach(e=>{e.hasChildren(a.treeId)||e.pushChildren(a)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(e=>{var r,n,i,s;let a=new Set;for(let i of e.children){let s=this._dependencyManagerService.getTreeById(i);s&&(s.featureId&&null!=(n=null==(r=t.get(e.unitId))?void 0:r.get(e.subUnitId))&&n.has(s.featureId)||a.add(i))}e.children=a;let o=new Set;for(let r of e.parents){let n=this._dependencyManagerService.getTreeById(r);n&&(n.featureId&&null!=(s=null==(i=t.get(e.unitId))?void 0:i.get(e.subUnitId))&&s.has(n.featureId)||o.add(r))}e.parents=o})}_convertDirtyRangesToUnitRange(e){let t=[];for(let r in e){let n=e[r];for(let e in n)for(let i of n[e])t.push({unitId:r,sheetId:e,range:i})}return t}_intersectFeatureCalculation(e,t,r){let n=[],i=this._dependencyManagerService.searchDependency(e);for(let e=0,s=t.length;e<s;e++){let s=t[e];(s.unitId!==r.unitId||s.subUnitId!==r.subUnitId||s.featureId!==r.featureId)&&i.has(s.treeId)&&n.push(s)}return n}_getExistTreeList(e,t){let{unitId:r,subUnitId:n,featureId:i}=e;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s.unitId===r&&s.subUnitId===n&&s.featureId===i)return s}}_isCyclicUtil(e,t,r){let n=this._dependencyManagerService.getTreeById(e);if(null==n)return!1;if(!t.has(n.treeId)){for(let e of(t.add(n.treeId),r.add(n.treeId),n.children))if(!t.has(e)&&this._isCyclicUtil(e,t,r)||r.has(e))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){let t=new Set,r=new Set;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(!0===this._isCyclicUtil(i.treeId,t,r))return!0}return!1}async _generateTreeList(e,t,r){let n=Object.keys(e),i=Object.keys(t),s=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,s),this._registerOtherFormulas(t,i,s),this._registerFeatureFormulas(s);for(let e=0,t=s.length;e<t;e++){let t=s[e];if(!t.formula)continue;let r=this._getTreeNode(t);t.isDirty=this._includeTree(t,r);let n=this._getAddressFunctionNodeList(r);if(n.length>0&&(t.addressFunctionNodes=n),t.isVirtual)continue;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let i=await this._getRangeListByNode({node:r,refOffsetX:t.refOffsetX,refOffsetY:t.refOffsetY});t.pushRangeList(i)}for(let e=0,t=s.length;e<t;e++){let t=s[e];t.isCache||this._dependencyManagerService.addDependencyRTreeCache(t)}return await this._calculateListByFunctionRefNode(s),s}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((t,r)=>{t.forEach((t,r)=>{t.forEach((t,r)=>{let n=this._dependencyManagerService.getFeatureFormulaDependency(t.unitId,t.subUnitId,r);e.push(this._getFeatureFormulaTree(r,n,t))})})})}_getFeatureFormulaTree(e,t,r){let{unitId:n,subUnitId:i,dependencyRanges:s,getDirtyData:a}=r,o=new sN(t||sv(this._dependencyManagerService));o.unitId=n,o.subUnitId=i,o.rangeList=s,o.getDirtyData=a;let l=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());return o.featureDirtyRanges=this._convertDirtyRangesToUnitRange(l.dirtyRanges),o.featureId=e,o.type=sE.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,i,e,o),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(o.isCache=!0),o}_registerOtherFormulas(e,t,r){for(let n of t){let t=e[n];if(null!=t)for(let e of Object.keys(t)){let i=t[e];if(null!=i)for(let t of Object.keys(i)){let s=this._dependencyManagerService.hasOtherFormulaDataMainData(t),{f:a,ranges:o}=i[t],l=!1;s&&(l=!0);let u=iw(n,a,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:c,firstColumn:h}=this._getFirstCellOfRange(o),d=this._dependencyManagerService.getOtherFormulaDependency(n,e,t),m=new sN((null==d?void 0:d.getValue(0,0))||sv(this._dependencyManagerService));for(let i=0;i<o.length;i++){let{startRow:s,startColumn:g,endRow:f,endColumn:p}=o[i];for(let i=s;i<=f;i++)for(let s=g;s<=p;s++){let o=s-h,g=i-c;if(0===o&&0===g){m.node=u,m.formula=a,m.unitId=n,m.subUnitId=e,m.formulaId=t,m.type=sE.OTHER_FORMULA,m.isCache=l,r.push(m),this._dependencyManagerService.addOtherFormulaDependency(n,e,t,m),this._dependencyManagerService.addFormulaDependencyByDefinedName(m);continue}let f=new sI;f.treeId=(null==d?void 0:d.getValue(o,g))||sv(this._dependencyManagerService),f.refTree=m,f.refOffsetX=o,f.refOffsetY=g,f.isCache=l,this._dependencyManagerService.addOtherFormulaDependency(n,e,t,f),this._dependencyManagerService.addFormulaDependencyByDefinedName(f),r.push(f)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(t)}}}}_getFirstCellOfRange(e){let t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(let i of e){let e=t[i];if(null!=e)for(let t of Object.keys(e)){let s=new(0,B.ObjectMatrix)(e[t]||{}),a=new Map;s.forValue((e,s,o)=>{if(null==o)return!0;let{x:l=0,y:u=0,si:c}=o;if(0!==l||0!==u||null==c)return!0;let h=this._createFDtree(i,t,e,s,r,o),d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?h.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,h),this._dependencyManagerService.addFormulaDependencyByDefinedName(h)),a.set(c,h),n.push(h)}),s.forValue((e,s,o)=>{let l;if(null==o)return!0;let{x:u=0,y:c=0,si:h}=o;if(0===u&&0===c&&null!=h)return!0;if(h&&a.has(h)){let e=a.get(h);l=this._createVirtualFDtree(e,o)}else l=this._createFDtree(i,t,e,s,r,o);let d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?l.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,l),this._dependencyManagerService.addFormulaDependencyByDefinedName(l)),n.push(l)}),a.clear()}}}_createFDtree(e,t,r,n,i,s){let{f:a,x:o=0,y:l=0}=s,u=new sN(sv(this._dependencyManagerService)),c=i[e][t];return u.node=iw(e,a,this._lexer,this._astTreeBuilder,this._currentConfigService),u.formula=a,u.unitId=e,u.subUnitId=t,u.row=r,u.column=n,u.rowCount=c.rowCount,u.columnCount=c.columnCount,u}_createVirtualFDtree(e,t){let{x:r=0,y:n=0}=t,i=new sI;return i.treeId=sv(this._dependencyManagerService),i.refTree=e,i.refOffsetX=r,i.refOffsetY=n,i}_updateRangeFlatten(){let e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let e=0;e<t.length;e++){let r=t[e],n=r.range,i=r.sheetId,s=r.unitId;this._addFlattenCache(s,i,n)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);null==n&&(n=new Map,this._updateRangeFlattenCache.set(e,n));let i=n.get(t);null==i&&(i=[],n.set(t,i)),i.push(r)}_isPreCalculateNode(e){return e.nodeType===iE.UNION||e.nodeType===iE.PREFIX&&e.getToken()===ef.AT||e.nodeType===iE.SUFFIX&&e.getToken()===em.POUND}_nodeTraversalRef(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(this._isPreCalculateNode(n)){if(t.push(n),n.nodeType===iE.UNION)for(let e of n.getChildren())e.nodeType===iE.FUNCTION&&e.isAddress()&&this._nodeTraversalRef(e,t);continue}n.nodeType===iE.REFERENCE&&t.push(n),this._nodeTraversalRef(n,t)}}_nodeTraversalReferenceFunction(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(n.nodeType===iE.FUNCTION&&n.isAddress()){t.push(n);continue}this._nodeTraversalReferenceFunction(n,t)}}async _executeNode(e,t=0,r=0){let n={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?await this._interpreter.executeAsync(n):this._interpreter.execute(n)}async _getRangeListByNode(e){let t=[],r=e.refOffsetX,n=e.refOffsetY,i=e.node;if(null==i)return[];this._nodeTraversalRef(i,t);let s=[];for(let e=0,i=t.length;e<i;e++){let i=t[e],a=(await this._executeNode(i,r,n)).toUnitRange();s.push(a),i.setValue(null)}return s}_getAddressFunctionNodeList(e){let t=[];return null==e?[]:(this._nodeTraversalReferenceFunction(e,t),t)}_getTreeNode(e){return e.node}async _buildDirtyRangesByAddressFunction(e,t){let r=t.addressFunctionNodes;if(0===r.length)return;let n=t.refOffsetX,i=t.refOffsetY,s=await this._getRangeListByFunctionRefNode(r,n,i);t.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(t,s);let a=e.bulkSearch(s),o=this._buildTreeNodeById(a);0!==o.length&&await this._calculateAddressFunctionRuntimeData(e,o)}async _calculateListByFunctionRefNode(e){let t=new(0,B.RTree);for(let r=0,n=e.length;r<n;r++){let n=e[r];t.insert({unitId:n.unitId,sheetId:n.subUnitId,range:{startRow:n.row,startColumn:n.column,endRow:n.row,endColumn:n.column},id:n.treeId})}this._executedAddressFunctionNodeIds.clear();for(let r=0,n=e.length;r<n;r++){let n=e[r];await this._calculateAddressFunction(t,n)}}async _calculateAddressFunction(e,t){let r=t.addressFunctionNodes;if(0===r.length)return;let n=t.refOffsetX,i=t.refOffsetY;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let s=[];for(let e=0,t=r.length;e<t;e++){let t=await this._getRangeListByNode({node:r[e],refOffsetX:n,refOffsetY:i});s.push(...t)}let a=new Set;this._searchDependencyByAddressFunction(e,s,a);let o=this._buildTreeNodeById(a);if(0===o.length)return void await this._buildDirtyRangesByAddressFunction(e,t);await this._calculateAddressFunctionRuntimeData(e,o),await this._buildDirtyRangesByAddressFunction(e,t)}async _calculateAddressFunctionRuntimeData(e,t){for(;t.length>0;){let r,n=t.pop(),i={node:this._getTreeNode(n),refOffsetX:n.refOffsetX,refOffsetY:n.refOffsetY};await this._calculateAddressFunction(e,n),this._runtimeService.setCurrent(n.row,n.column,n.rowCount,n.columnCount,n.subUnitId,n.unitId),r=this._interpreter.checkAsyncNode(i.node)?await this._interpreter.executeAsync(i):this._interpreter.execute(i),null!=n.formulaId?this._runtimeService.setRuntimeOtherData(n.formulaId,n.refOffsetX,n.refOffsetY,r):this._runtimeService.setRuntimeData(r)}}_buildTreeNodeById(e){let t=[];for(let r of e){let e=this._getTreeById(r);!e||this._executedAddressFunctionNodeIds.has(r)||(this._executedAddressFunctionNodeIds.add(r),t.push(e))}return t}_searchDependencyByAddressFunction(e,t,r){let n=e.bulkSearch(t);for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(t))r.has(e)||r.add(e);let i=[];for(let e of n){let t=this._getTreeById(e);t&&!r.has(e)&&(i.push(...t.rangeList),r.add(e))}return i.length>0&&this._searchDependencyByAddressFunction(e,i,r),r}_getTreeById(e){return this._dependencyManagerService.getTreeById(e)}_addDependencyTreeByAddressFunction(e,t){let r=[];for(let n=0;n<t.length;n++){let{unitId:i,sheetId:s,range:a}=t[n];r.push({unitId:i,sheetId:s,range:a,id:e.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(r)}async _getRangeListByFunctionRefNode(e,t,r){let n=[];for(let i=0,s=e.length;i<s;i++){let s=e[i],a=(await this._executeNode(s,t,r)).toUnitRange();n.push(a),s.setValue(null)}return n}_getUpdateTreeListAndMakeDependency(e){let t=[],r=new Set,n=this._currentConfigService.isForceCalculate(),i=this._currentConfigService.getDirtyRanges(),s=this._dependencyManagerService.searchDependency(i);for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(i))s.add(e);for(let i of this._dependencyManagerService.buildDependencyTree(e)){let e=i.treeId;(n||i.isDirty||i.dependencySheetName(this._currentConfigService.getDirtyNameMap())||s.has(e)&&!i.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(e)&&(t.push(i),r.add(e))}return t}_includeTreeFeature(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.featureId;if(null!=s){let e=this._currentConfigService.getDirtyUnitFeatureMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_includeOtherFormula(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.formulaId;if(null!=s){let e=this._currentConfigService.getDirtyUnitOtherFormulaMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return null!=t&&this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;let t=e.getChildren();for(let e=0,r=t.length;e<r;e++){let r=t[e];if(this._detectForcedRecalculationNodeRecursion(r))return!0}return!1}_includeTree(e,t){var r,n,i,s;let a=e.unitId,o=e.subUnitId;if(!0===this._detectForcedRecalculationNode(e,t)||!0===this._includeTreeFeature(e)||!0===this._includeOtherFormula(e)||!0==(s=this._currentConfigService,!!(null!=t&&iM(t,s))))return!0;let l=null==(n=null==(r=this._currentConfigService.getExcludedRange())?void 0:r[a])?void 0:n[o];if((null==l?void 0:l.getValue(e.row,e.column))!=null)return!1;if((null==(i=this._currentConfigService.getDirtyNameMap()[a])?void 0:i[o])!=null)return!0;if(!this._updateRangeFlattenCache.has(a))return!1;let u=this._updateRangeFlattenCache.get(a);if(!u.has(o))return!1;for(let t of u.get(o))if(e.inRangeData(t))return!0;return!1}_calculateRunList(e){e.length;let t=[],r=[];for(;e.length>0;){let n=e.pop();if(!(void 0===n||n.isSkip())){if(n.isAdded()){t.push(n),n.setSkip();continue}for(let e of(r.length=0,n.parents)){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||n.isSkip()||r.push(t)}for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(n.toRTreeItem())){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||n.isSkip()||r.push(t)}0===r.length?(t.push(n),n.setSkip()):(n.setAdded(),e.push(n,...r))}}return t}};sw=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sS(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sA(0,tK),sA(1,iR),sA(2,sR),sA(3,s_),sA(4,(0,$.Inject)(iG)),sA(5,(0,$.Inject)(sm)),sA(6,(0,$.Inject)(tJ)),sA(7,sp)],sw);var sM=Object.getOwnPropertyDescriptor,sO=(e,t)=>(r,n)=>t(r,n,e);let sx=500,sU=(0,$.createIdentifier)("engine-formula.calculate-formula.service"),sD=class extends B.Disposable{constructor(e,t,r,n,i,s,a){super(),Z(this,"_executionInProgressListener$",new(0,q.Subject)),Z(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),Z(this,"_executionCompleteListener$",new(0,q.Subject)),Z(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),Z(this,"_executeLock",new(0,B.AsyncLock)),this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=i,this._interpreter=s,this._astTreeBuilder=a}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),n2.clear(),tB.clear(),rs.clear(),nq.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(iC.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();let t=e.maxIteration||1;this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let e=0;e<t&&(this._runtimeService.setFormulaCycleIndex(e),await this._executeStep(),n2.clear(),this._runtimeService.isCycleDependency());e++);this._runtimeService.setFormulaExecuteStage(iC.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),tB.clear(),this._runtimeService.reset()})}async _executeStep(){let e=await this._apply();if(null==e)return;let{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:i}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return null==n||0===n.length||(this._currentConfigService.loadDirtyRangesAndExcludedCell(n,i),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){let r=[],n={};return Object.keys(e).forEach(t=>{let i=e[t];if(null==i)return!0;Object.keys(i).forEach(e=>{let s=new(0,B.ObjectMatrix)(i[e]);if(null==s)return!0;let a=new(0,B.ObjectMatrix);s.forValue((n,i,s)=>{a.setValue(n,i,!0),r.push({unitId:t,sheetId:e,range:s})}),null==n[t]&&(n[t]={}),n[t][e]=a})}),Object.keys(t).forEach(e=>{let n=t[e];Object.keys(n).forEach(e=>{let t=n[e];if(null==t)return!0;Object.keys(t).forEach(n=>{let i=t[n];if(null==i)return!0;for(let t of i)r.push({unitId:e,sheetId:n,range:t})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(iC.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(iC.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(iC.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(iC.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[],i=this._configService.getConfig(t$),s=(null==i?void 0:i.intervalCount)||sx,a=t.length;for(let i=0;i<a;i++){let a,o=t[i],l=o.nodeData,u=o.getDirtyData;if(i%s==0&&(await new Promise(e=>{let t=(0,B.requestImmediateMacroTask)(e);n.push(t)}),e?(this._runtimeService.setFormulaExecuteStage(iC.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(i+1)):(this._runtimeService.setFormulaExecuteStage(iC.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(i+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||null==l&&null==u)){this._runtimeService.setFormulaExecuteStage(iC.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}if(this._runtimeService.setCurrent(o.row,o.column,o.rowCount,o.columnCount,o.subUnitId,o.unitId),null!=u&&null!=o.featureId){let{runtimeCellData:e,dirtyRanges:t}=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(o.featureId,e),this._runtimeService.setRuntimeFeatureRange(o.featureId,t)}else null!=l&&(a=r.checkAsyncNode(l.node)?await r.executeAsync(l):r.execute(l),null!=o.formulaId?this._runtimeService.setRuntimeOtherData(o.formulaId,o.refOffsetX,o.refOffsetY,a):this._runtimeService.setRuntimeData(a))}return n.forEach(e=>e()),n=[],a>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){let r=this._lexer.treeBuilder(e,t);if(Object.values(en).includes(r))return iN.create(r);let n=this._astTreeBuilder.parse(r);null==n||n.serialize()}};sD=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sM(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sO(0,B.IConfigService),sO(1,(0,$.Inject)(tJ)),sO(2,tK),sO(3,iR),sO(4,sT),sO(5,(0,$.Inject)(iG)),sO(6,(0,$.Inject)(sm))],sD);var sV=Object.getOwnPropertyDescriptor,sL=(e,t)=>(r,n)=>t(r,n,e);let sP=class extends B.Disposable{constructor(e,t,r){super(),this._commandService=e,this._calculateFormulaService=t,this._formulaDataModel=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===td.id)this._calculateFormulaService.stopFormulaExecution();else if(e.id===th.id)this._calculate(e.params);else if(e.id===eG.id){let t=e.params;if(null==t)return;let{arrayFormulaRange:r,arrayFormulaCellData:n}=t;this._formulaDataModel.setArrayFormulaRange(r),this._formulaDataModel.setArrayFormulaCellData(n)}}))}async _calculate(e){let{forceCalculation:t=!1,dirtyRanges:r=[],dirtyNameMap:n={},dirtyDefinedNameMap:i={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:o={},maxIteration:l=1,rowData:u}=e,c=this._formulaDataModel.getFormulaData(),h=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:c,arrayFormulaCellData:h,arrayFormulaRange:d,forceCalculate:t,dirtyRanges:r,dirtyNameMap:n,dirtyDefinedNameMap:i,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:o,maxIteration:l,rowData:u})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(e=>{let t=e.functionsExecutedState;switch(t){case i_.NOT_EXECUTED:case i_.STOP_EXECUTION:break;case i_.SUCCESS:this._applyResult(e);case i_.INITIAL:}this._commandService.executeCommand(tm.id,{functionsExecutedState:t},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(e=>{this._commandService.executeCommand(tm.id,{stageInfo:e},{onlyLocal:!0})})}async _applyResult(e){let{unitData:t,unitOtherData:r,arrayFormulaRange:n,arrayFormulaCellData:i,clearArrayFormulaCellData:s}=e;if(!t)return void console.error("No sheetData from Formula Engine!");n&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(i),this._formulaDataModel.mergeArrayFormulaRange(n),this._commandService.executeCommand(eG.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(tg.id,{unitData:function(e){let t={};for(let r in e){let n=e[r];if(null!=n)for(let e in null==t[r]&&(t[r]={}),n){let i=n[e],s={};i.forValue((e,t,r)=>{void 0===s[e]&&(s[e]={}),s[e][t]=r}),t[r][e]=s}}return t}(t),unitOtherData:r},{onlyLocal:!0})}};sP=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sV(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sL(0,B.ICommandService),sL(1,sU),sL(2,(0,$.Inject)(tL))],sP);let sk=/[\[\]]/g;function sF(e,t){return sk.test(e)?t+Number(e.replace(sk,"")):Number(e)-1}function sj(e,t=0,r=0){let n=(e=e.toLocaleUpperCase()).split(/[RC]/),i=n[1],s=n[2];return{row:sF(i,t),column:sF(s,r),absoluteRefType:B.AbsoluteRefType.NONE}}function sB(e,t=0,r=0){let{refBody:n,sheetName:i,unitId:s}=e2(e),a=n.indexOf(":");if(-1===a){let e=sj(n,t,r),a=e.row,o=e.column,l=e.absoluteRefType;return{unitId:s,sheetName:i,range:{startRow:a,startColumn:o,endRow:a,endColumn:o,startAbsoluteRefType:l,endAbsoluteRefType:l}}}let o=n.substring(0,a),l=n.substring(a+1),u=sj(o,t,r),c=sj(l,t,r),h=u.row,d=u.column;return{unitId:s,sheetName:i,range:{startRow:h,startColumn:d,endRow:c.row,endColumn:c.column,startAbsoluteRefType:u.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}function s$(e,t=B.AbsoluteRefType.ALL,r){switch(e+=1,t){case B.AbsoluteRefType.ALL:return`${e}`;case B.AbsoluteRefType.ROW:return r?`${e}`:`[${e}]`;case B.AbsoluteRefType.COLUMN:return r?`[${e}]`:`${e}`;case B.AbsoluteRefType.NONE:return`[${e}]`}}function sH(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return ra.create(en.VALUE);t=e.get(0,0)}return t.isError(),t}function sW(...e){for(let t=0;t<e.length;t++){let r=sH(e[t]);if(r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}function sG(...e){for(let t=0;t<e.length;t++){let r=sH(e[t]);if(r.isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sY(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return{isError:!0,errorObject:r};if(r.isNull())return{isError:!0,errorObject:ra.create(en.NA)};if((r=sH(e[t])).isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sz(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}class sX{constructor(e){Z(this,"_unitId"),Z(this,"_subUnitId"),Z(this,"_row",-1),Z(this,"_column",-1),Z(this,"_definedNames"),Z(this,"_locale"),Z(this,"_sheetOrder"),Z(this,"_sheetNameMap"),Z(this,"_formulaDataModel"),Z(this,"_rowCount",-1),Z(this,"_columnCount",-1),Z(this,"needsExpandParams",!1),Z(this,"needsReferenceObject",!1),Z(this,"needsLocale",!1),Z(this,"needsSheetsInfo",!1),Z(this,"needsFormulaDataModel",!1),Z(this,"needsSheetRowColumnCount",!1),Z(this,"needsFilteredOutRows",!1),Z(this,"minParams",-1),Z(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(e){var t;let r=this._definedNames;return null==r?null:null==(t=Array.from(Object.values(r)).filter(t=>t.name===e))?void 0:t[0]}setDefinedNames(e){this._definedNames=e}getLocale(){return this._locale}setLocale(e){this._locale=e}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:e,sheetNameMap:t}){this._sheetOrder=e,this._sheetNameMap=t}setFormulaDataModel(e){this._formulaDataModel=e}setSheetRowColumnCount(e,t){this._rowCount=e,this._columnCount=t}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}isArgumentsIgnoreNumberPattern(){return!1}setRefInfo(e,t,r,n){this._unitId=e,this._subUnitId=t,this._row=r,this._column=n}calculateCustom(){return null}calculate(){return ra.create(en.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return!1===r.getValue()?ra.create(en.VALUE):t;if(r.isString()){let e=Number(r.getValue());return Number.isNaN(e)?ra.create(en.REF):e}return r.isNumber()?r.getValue():ra.create(en.VALUE)}getZeroOrOneByOneDefault(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;e.isNumber()&&0===e.getValue()&&(t=0)}return t}getMatchTypeValue(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;if(e.isNumber()){let r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,n,i){let s,a=t.binarySearch(e,n,i);return null==a?ra.create(en.NA):(s=1===r.getRowCount()?r.get(0,a)||nG.create():r.get(a,0)||nG.create()).isNull()?nX.create(0):s}_getOneFirstByRaw(e){return 0===e.length?ra.create(en.NA):e[0][0]||ra.create(en.NA)}_getOneLastByRaw(e){return 0===e.length?ra.create(en.NA):e[e.length-1][e[0].length-1]||ra.create(en.NA)}equalSearch(e,t,r,n=!0){let i=r.pickRaw(t.isEqual(e));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}fuzzySearch(e,t,r,n=!0){let i=r.pickRaw(t.compare(e,el.EQUALS));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}orderSearch(e,t,r,n=rl.MIN,i=!1){let s=t.orderSearch(e,n,i);if(null==s)return ra.create(en.NA);let a=r.get(s.row,s.column)||nG.create();return a.isNull()?ra.create(en.NA):a}binarySearchExpand(e,t,r,n=0,i,s){let a=t.binarySearch(e,i,s);return null==a?ra.create(en.NA):0===n?r.slice([a,a+1]):r.slice(void 0,[a,a+1])}equalSearchExpand(e,t,r,n=!0,i=0){let s,a=t.isEqual(e);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?ra.create(en.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}fuzzySearchExpand(e,t,r,n=!0,i=0){let s,a=t.compare(e,el.EQUALS);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?ra.create(en.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}orderSearchExpand(e,t,r,n=rl.MIN,i=!1,s=0){let a=t.orderSearch(e,n,i);return null==a?ra.create(en.NA):0===s?r.slice([a.row,a.row+1]):r.slice(void 0,[a.column,a.column+1])}flattenArray(e,t=!0){let r=[];r[0]=[];for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean()||i.isNull())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){let e;if(i.iterator(n=>!!(null==n||n.isNull()||t&&(n.isString()||n.isBoolean()))||((n=this._includingLogicalValuesAndText(n)).isError()?(e=n,!1):void r[0].push(n))),null!=e&&e.isError())return e}else r[0].push(i)}return it(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=function(e){let t=e.getValue(),r=0;return t&&(r=1),nX.create(r)}(e)),e.isString()){let t=Number(e.getValue());e=nX.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){let r,n=e.getForcedUnitId(),i=e.getForcedSheetId()||"",s=e0({unitId:n,sheetName:e.getForcedSheetName(),range:t});return r=eP(s)?new n9(s):ej(s)?new n7(s):eB(s)?new n8(s):new n6(t,i,n),this._setReferenceDefault(e,r)}_setReferenceDefault(e,t){return null==this.unitId||null==this.subUnitId?ra.create(en.REF):(t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(e.getRuntimeArrayFormulaCellData()),t)}}var sq=((v=sq||{}).ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",v.FLATTEN="FLATTEN",v);let sK=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;let{isError:n,errorObject:i,variants:s}=sW(t,r);if(n)return i;let{isError:a,errorObject:o,variants:l}=sz(...s);if(a)return o;let[u,c]=l,h=Math.floor(+u.getValue()),d=Math.floor(+c.getValue());if(h<0||d<0)return ra.create(en.NUM);if(0===h||0===d)return ra.create(en.REF);let m=e.isArray()?e.getRowCount():1,g=e.isArray()?e.getColumnCount():1;return 1===m&&1===g?e.isArray()?e.get(0,0):e:e.slice([0,h>m?m:h],[0,d>g?g:d])}},sq.ARRAY_CONSTRAIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r],i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<i;e++)for(let r=0;r<s;r++){let i=n.isArray()?n.get(e,r):n;t.push([i])}}return n0.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},sq.FLATTEN]];function sQ(e){return/^[01]{1,10}$/.test(e)}function sZ(e){return/^[0-7]{1,10}$/.test(e)}function sJ(e){return/^[0-9A-Fa-f]{1,10}$/.test(e)}function s0(e){if(0===e)return 0;let t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-946595344482036e-18,366839497852761e-18,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],r=e,n=!1;r<0&&(r=-r,n=!0);let i=2/(2+r),s=4*i-2,a=0,o=0,l;for(let e=t.length-1;e>0;e--)l=a,a=s*a-o+t[e],o=l;let u=i*Math.exp(-r*r+.5*(t[0]+s*a)-o);return n?u-1:1-u}function s1(e,t=1){let r=Math.floor(e);if(e<0)return NaN;let n=1;for(;r>1&&Number.isFinite(n);)n*=r,r-=t;return n}function s2(e,t){let r=Math.min(e-t,t),n=1;for(let t=1;t<=r&&Number.isFinite(n);t++)n*=e-t+1,n/=t;return n}function s5(e,t){let r=Math.floor(e),n=Math.floor(t);for(;0!==n;){let e=n;n=r%n,r=e}return r}function s3(e,t){let r=s5(e,t);return 0===r?0:Math.abs(e*t)/r}function s4(e){let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let{rowSwap:r,smallPivotDetected:n,luMatrix:i,permutation:s}=s8(e);if(n)return 0;let a=r?1:-1;for(let e=0;e<s.length;e++)a*=i[e][e];return 0===a?0:a}function s6(e,t){return e.map(e=>t[0].map((r,n)=>e.reduce((e,r,i)=>e+r*t[i][n],0)))}function s9(e){return e[0].map((t,r)=>e.map(e=>e[r]))}function s8(e){let t=s9(e),r=t.length,n=t[0].length,i=!0,s=!1,a=s7(r,n,0),o=Array(n).fill(0).map((e,t)=>t);for(let e=0;e<n;e++){for(let r=0;r<e;r++){let n=t[r][e];for(let t=0;t<r;t++)n-=a[r][t]*a[t][e];a[r][e]=n}let n=-1/0,l=e;for(let i=e;i<r;i++){let r=t[i][e];for(let t=0;t<e;t++)r-=a[i][t]*a[t][e];a[i][e]=r;let s=Math.abs(r);s>n&&(n=s,l=i)}if(1e-11>Math.abs(a[l][e])){s=!0;break}l!==e&&([a[e],a[l]]=[a[l],a[e]],[t[e],t[l]]=[t[l],t[e]],[o[e],o[l]]=[o[l],o[e]],i=!i);let u=a[e][e];for(let t=e+1;t<r;t++)a[t][e]/=u}return{rowSwap:i,smallPivotDetected:s,luMatrix:a,permutation:o}}function s7(e,t,r){let n=[];for(let i=0;i<e;i++){n[i]=[];for(let e=0;e<t;e++)n[i].push(r)}return n}function ae(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0!==t?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}function at(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[a][n]*e[a][i];return s}function ar(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[n][a]*e[i][a];return s}(e=>{function t(e,t){let r=0;for(let n=0;n<e.length;++n)r=t*r+e[n];return r}function r(e,t,r,n,i){if(0===t)return r;if(1===t)return n;let s=2/e,a=r,o=n,l=n;for(let e=1;e<t;++e)l=o*e*s+i*a,a=o,o=l;return l}function n(e,t,n,i){return function(s,a){if(n){if(0===s)return 1===n?-1/0:1/0;if(s<0)return NaN}if(0===a)return e(s);if(1===a)return t(s);if(a<0)return NaN;let o=e(s),l=t(s);return r(s,0|a,o,l,i)}}e.besselj=(()=>{let e=[-184.9052456,77392.33017,-11214424.18,651619640.7,-0x31c78f292,0xd6759744e],n=[1,267.8532712,59272.64853,9494680.718,0x3d5d6d39,0xd675973ab],i=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],s=[-934935152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function a(r){let a=0,o=0,l=r*r;if(r<8)a=(o=t(e,l))/t(n,l);else{let e=r-.785398164;a=Math.sqrt(.636619772/r)*(Math.cos(e)*(o=t(i,l=64/l))-Math.sin(e)*t(s,l)*8/r)}return a}let o=[-30.16036606,15704.4826,-2972611.439,242396853.1,-0x1d6950b23,0x10d925ddd8],l=[1,376.9991397,99447.43394,18583304.74,0x891f618a,0x21b24bbb9a],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function h(e){let r=0,n=0,i=e*e,s=Math.abs(e)-2.356194491;return 8>Math.abs(e)?r=(n=e*t(o,i))/t(l,i):(r=Math.sqrt(.636619772/Math.abs(e))*(Math.cos(s)*(n=t(u,i=64/i))-Math.sin(s)*t(c,i)*8/Math.abs(e)),e<0&&(r=-r)),r}return function e(t,n){let i=Math.round(n);if(!Number.isFinite(t))return Number.isNaN(t)?t:0;if(i<0)return(i%2?-1:1)*e(t,-i);if(t<0)return(i%2?-1:1)*e(-t,i);if(0===i)return a(t);if(1===i)return h(t);if(0===t)return 0;let s=0;if(t>i)s=r(t,i,a(t),h(t),-1);else{let e=2*Math.floor((i+Math.floor(Math.sqrt(40*i)))/2),r=!1,n=0,a=0,o=1,l=0,u=2/t;for(let t=e;t>0;t--)if(l=t*u*o-n,n=o,Math.abs(o=l)>1e10&&(o*=1e-10,n*=1e-10,s*=1e-10,a*=1e-10),r&&(a+=o),r=!r,t===i&&(s=n),e-t>100&&0===s)return NaN;s/=a=2*a-o}return s}})(),e.bessely=(()=>{let r=[228.4622733,-86327.92757,10879881.29,-512359803.6,0x1a4fa4b91,-0xb04cc5cd],i=[1,226.1030244,47447.2647,7189466.438,745249964.8,0x954bf890d],s=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],a=[-934945152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995],o=[8511.937935,-4237922.726,734926455.1,-0xbffb0414e,127527439e4,-4900604943e3],l=[1,354.9632885,102042.605,22459040.02,0xde8afbbf,0x62d2b66f40,249958057e5],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];return n(function(n){let o=0,l=n*n,u=n-.785398164;return n<8?(o=t(r,l))/t(i,l)+.636619772*(0,e.besselj)(n,0)*Math.log(n):Math.sqrt(.636619772/n)*(Math.sin(u)*(o=t(s,l=64/l))+Math.cos(u)*t(a,l)*8/n)},function(r){let n=0,i=r*r,s=r-2.356194491;return r<8?(n=r*t(o,i))/t(l,i)+.636619772*((0,e.besselj)(r,1)*Math.log(r)-1/r):Math.sqrt(.636619772/r)*(Math.sin(s)*(n=t(u,i=64/i))+Math.cos(s)*t(c,i)*8/r)},1,-1)})(),e.besseli=(()=>{let e=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],r=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228],n=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],i=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];return function s(a,o){let l=Math.round(o);if(0===l)return a<=3.75?t(e,a*a/14.0625):Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(r,3.75/Math.abs(a));if(1===l)return a<3.75?a*t(n,a*a/14.0625):(a<0?-1:1)*Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(i,3.75/Math.abs(a));if(l<0)return NaN;if(0===Math.abs(a))return 0;if(a===1/0)return 1/0;let u=0,c,h=2/Math.abs(a),d=0,m=1,g=0,f=2*Math.round((l+Math.round(Math.sqrt(40*l)))/2);for(c=f;c>0;c--)if(g=c*h*m+d,d=m,Math.abs(m=g)>1e10&&(m*=1e-10,d*=1e-10,u*=1e-10),c===l&&(u=d),f-c>100&&0===u)return NaN;return u*=s(a,0)/m,a<0&&l%2?-u:u}})(),e.besselk=(()=>{let r=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],i=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414],s=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],a=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];return n(function(n){return n<=2?-Math.log(n/2)*(0,e.besseli)(n,0)+t(r,n*n/4):Math.exp(-n)/Math.sqrt(n)*t(i,2/n)},function(r){return r<=2?Math.log(r/2)*(0,e.besseli)(r,1)+1/r*t(s,r*r/4):Math.exp(-r)/Math.sqrt(r)*t(a,2/r)},2,1)})()})(F||(F={}));let an=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),ai=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),as=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function aa(e,t,r){return e<=0?0:e>=1?1:al(e,t,r)}function ao(e,t,r){let n,i,s;if(e<=0)return 0;if(e>=1)return 1;if(t>=1&&r>=1){let i=Math.sqrt(-2*Math.log(e<.5?e:1-e));n=(2.30753+.27061*i)/(1+i*(.99229+.04481*i))-i,e<.5&&(n=-n);let s=(n*n-3)/6,a=2/(1/(2*t-1)+1/(2*r-1)),o=n*Math.sqrt(s+a)/a-(1/(2*r-1)-1/(2*t-1))*(s+5/6-2/(3*a));n=t/(t+r*Math.exp(2*o))}else{let i=Math.exp(t*Math.log(t/(t+r)))/t,s=i+Math.exp(r*Math.log(r/(t+r)))/r;n=e<i/s?(t*s*e)**(1/t):1-(r*s*(1-e))**(1/r)}let a=-ah(t,r);for(let o=0;o<10&&!(0===n||1===n||(s=(al(n,t,r)-e)/(i=Math.exp((t-1)*Math.log(n)+(r-1)*Math.log(1-n)+a)),(n-=i=s/(1-.5*Math.min(1,s*((t-1)/n-(r-1)/(1-n)))))<=0&&(n=.5*(n+i)),n>=1&&(n=.5*(n+i+1)),Math.abs(i)<1e-8*n&&o>0));o++);return n}function al(e,t,r){let n=0===e||1===e?0:Math.exp(aR(t+r)-aR(t)-aR(r)+t*Math.log(e)+r*Math.log(1-e));return e<(t+1)/(t+r+2)?n*au(e,t,r)/t:1-n*au(1-e,r,t)/r}function au(e,t,r){let n=1-(t+r)*e/(t+1);1e-8>Math.abs(n)&&(n=1e-8);let i=1,s=n=1/n;for(let a=1;a<=100;a++){let o=a*(r-a)*e/((t-1+2*a)*(t+2*a));if(1e-8>Math.abs(n=1+o*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n=1+(o=-(t+a)*(t+r+a)*e/((t+2*a)*(t+1+2*a)))*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n*i-1))break}return s}function ac(e,t){return e+t>170?Math.exp(ah(e,t)):ay(e)*ay(t)/ay(e+t)}function ah(e,t){return aR(e)+aR(t)-aR(e+t)}function ad(e,t,r){if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return NaN;let n=0;for(let i=0;i<=e;i++)n+=am(i,t,r);return n}function am(e,t,r){return 0===r||1===r?+(t*r===e):s2(t,e)*r**e*(1-r)**(t-e)}function ag(e,t){return e<=0?0:aE(t/2,e/2)}function af(e,t){return e<=0?0:e>=1?1/0:2*ab(e,t/2)}function ap(e,t,r){return e<0?0:al(t*e/(t*e+r),t/2,r/2)}function aC(e,t,r){return e<=0?0:e>=1?1/0:r/(t*(1/ao(e,t/2,r/2)-1))}function a_(e,t,r){let n=t.length,i=0,s=0;for(let e=0;e<n;e++)i+=t[e],s+=r[e];let a=i/n,o=s/n,l=0,u=0;for(let e=0;e<n;e++)l+=(t[e]-a)*(r[e]-o),u+=(r[e]-o)**2;if(0===u)return 1/0;let c=l/u;return a-c*o+c*e}function ay(e){let t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],n=0,i=e;if(e>171.6243769536076)return 1/0;if(i<=0){let e=i%1+36e-17;if(!e)return 1/0;n=(1&i?-1:1)*Math.PI/Math.sin(Math.PI*e),i=1-i}let s=i,a=0,o;o=i<1?i++:(i-=a=(0|i)-1)-1;let l=0,u=0;for(let e=0;e<8;++e)l=(l+t[e])*o,u=u*o+r[e];let c=l/u+1;if(s<i)c/=s;else if(s>i)for(let e=0;e<a;++e)c*=i,i++;return n&&(c=n/c),c}function aR(e){let t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=e,n=e+5.5;n-=(e+.5)*Math.log(n);let i=1.000000000190015;for(let e=0;e<6;e++)i+=t[e]/++r;return-n+Math.log(2.5066282746310007*i/e)}function aE(e,t){if(t<0||e<=0)return NaN;let r=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17),n=aR(e),i=Math.exp(-t+e*Math.log(t)-n),s=e,a=1/e,o=a;if(t<e+1){if(0===i)return 0;for(let e=1;e<=r&&(a+=o*=t/++s,!(Math.abs(o)<1e-30*Math.abs(a)));e++);return a*i}if(0===i)return 1;let l=t+1-e,u=9999999999999999e14,c=1/l,h=c;for(let t=1;t<=r;t++){let r=-t*(t-e);if(l+=2,1e-30>Math.abs(c=r*c+l)&&(c=1e-30),1e-30>Math.abs(u=l+r/u)&&(u=1e-30),h*=(c=1/c)*u,1e-30>Math.abs(c*u-1))break}return 1-h*i}function ab(e,t){let r,n,i;if(e<=0)return 0;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(t>1){let n=Math.sqrt(-2*Math.log(e<.5?e:1-e));r=(2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n,e<.5&&(r=-r),r=Math.max(.001,t*(1-1/(9*t)-r/(3*Math.sqrt(t)))**3)}else{let n=1-t*(.253+.12*t);r=e<n?(e/n)**(1/t):1-Math.log(1-(e-n)/(1-n))}let s=aR(t);for(let a=0;a<12;a++){if(r<=0)return 0;if(n=aE(t,r)-e,0!==(i=t>1?Math.exp((t-1)*(Math.log(t-1)-1)-s)*Math.exp(-(r-(t-1))+(t-1)*(Math.log(r)-Math.log(t-1))):Math.exp(-r+(t-1)*Math.log(r)-s))&&(i=n/i/(1-.5*Math.min(1,n/i*((t-1)/r-1)))),(r-=i)<=0&&(r=.5*(r+i)),Math.abs(i)<1e-8*r)break}return r}function aI(e,t,r,n){return t-e>n-r?0:s2(r,e)*s2(n-r,t-e)/s2(n,t)}function aN(e,t,r){return e<0?0:.5+.5*s0((Math.log(e)-t)/Math.sqrt(2*r*r))}function aS(e,t,r){return e<0?0:s2(e+t-1,t-1)*r**t*(1-r)**e}function aA(e,t,r){return .5*(1+s0((e-t)/Math.sqrt(2*r*r)))}function av(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-(e-t)**2/(2*r*r))}function aT(e,t,r){return -1.4142135623730951*r*function(e){if(e>=2)return -100;if(e<=0)return 100;let t=e<1?e:2-e,r=Math.sqrt(-2*Math.log(t/2)),n=-.70711*((2.30753+.27061*r)/(1+r*(.99229+.04481*r))-r);for(let e=0;e<2;e++){let e=1-s0(n)-t;n+=e/(1.1283791670955126*Math.exp(-n*n)-n*e)}return e<1?n:-n}(2*e)+t}function aw(e,t){return Math.exp(-t)*t**e/s1(e)}function aM(e,t){let r=.5*al(t/(e**2+t),t/2,.5);return e<0?r:1-r}function aO(e,t){let r=ao(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}function ax(e,t,r,n,i){let s=[],a=[],o=!0;for(let l=0;l<r;l++){let r=Math.floor(l/n),u=l%n,c=Math.floor(l/i),h=l%i,d=e.isArray()?e.get(r,u):e,m=t.isArray()?t.get(c,h):t;if(d.isError())return{isError:!0,errorObject:d,array1Values:s,array2Values:a,noCalculate:o};if(m.isError())return{isError:!0,errorObject:m,array1Values:s,array2Values:a,noCalculate:o};if(d.isNull()||m.isNull()||d.isBoolean()||m.isBoolean())continue;let g=d.getValue(),f=m.getValue();(0,B.isRealNum)(g)&&(0,B.isRealNum)(f)&&(s.push(+g),a.push(+f),o=!1)}return{isError:!1,errorObject:null,array1Values:s,array2Values:a,noCalculate:o}}function aU(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=n,a=i;if(t&&!t.isNull()&&(s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,1===n&&a!==i||1===i&&s!==n||1!==n&&1!==i&&(s!==n||a!==i)))return{isError:!0,errorObject:ra.create(en.REF)};if(r&&!r.isNull()){let e=r.isArray()?r.getRowCount():1,t=r.isArray()?r.getColumnCount():1;if(1===n&&s>1&&e!==s||1===i&&a>1&&t!==a)return{isError:!0,errorObject:ra.create(en.REF)}}return{isError:!1,errorObject:null}}function aD(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){n[i]=[];for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError()||r.isNull()||r.isBoolean()||r.isString())return ra.create(en.VALUE);n[i].push(+r.getValue())}}return n}function aV(e,t){let r=[],n=1;for(let i=0;i<e;i++){r[i]=[];for(let e=0;e<t;e++)r[i].push(n++)}return r}function aL(e,t,r,n){let i,s,a=t;return n&&(a=t.map(e=>Math.log(e))),r?{slope:i,intercept:s}=function(e,t){let r=t.length,n=0,i=0,s=0,a=0;for(let o=0;o<r;o++)n+=e[o],i+=t[o],s+=e[o]*e[o],a+=e[o]*t[o];let o=(r*a-n*i)/(r*s-n*n),l=1/r*i-1/r*o*n;return{slope:o,intercept:l}}(e,a):{slope:i,intercept:s}=function(e,t){let r=[[...e]],n=[...t],i=r.length,s=r[0].length,a=Math.min(i,s),o=Array(a).fill(0);for(let e=0;e<a;e++){let t=r[e],n=0;for(let e=0;e<s;e++)n+=t[e]**2;let a=t[e]<0?Math.sqrt(n):-Math.sqrt(n);if(o[e]=a,0!==a){t[e]-=a;for(let n=e+1;n<i;n++){let i=0;for(let a=e;a<s;a++)i-=r[n][a]*t[a];i/=a*t[e];for(let a=e;a<s;a++)r[n][a]-=i*t[a]}}}a=Math.min(i=r.length,s=r[0].length);let l=Array(i).fill(0);for(let e=0;e<a;e++){let t=r[e],i=0;for(let e=0;e<s;e++)i+=n[e]*t[e];i/=o[e]*t[e];for(let e=0;e<s;e++)n[e]+=i*t[e]}for(let e=o.length-1;e>=0;e--){n[e]/=o[e];let t=n[e],i=r[e];l[e]=t;for(let r=0;r<e;r++)n[r]-=t*i[r]}return{slope:l[0],intercept:0}}(e,a),n&&(i=Math.exp(i),s=Math.exp(s)),Number.isNaN(i)&&!r&&(i=0),{slope:i,intercept:s,Y:a}}function aP(e,t,r,n,i){let s=1===e.length&&e[0].length>1,a=e;i&&(a=e.map(e=>e.map(e=>Math.log(e))));let o=t,l=r;s&&(a=s9(a),o=s9(o),l=s9(l)),n&&(o=o.map(e=>[...e,1]));let u=s9(o),c=s6(u,o),h=s6(u,a),d=function(e){let{smallPivotDetected:t,luMatrix:r,permutation:n}=s8(e);return t?null:function(e,t){let r=t.length,n=s7(r,r,0);for(let e=0;e<r;e++)n[e][e]=1;let i=s7(r,r,0);for(let e=0;e<r;e++){let s=t[e];for(let t=0;t<r;t++)i[e][t]=n[s][t]}for(let t=0;t<r;t++){let n=i[t];for(let s=t+1;s<r;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}for(let t=r-1;t>=0;t--){let n=i[t],s=e[t][t];for(let e=0;e<r;e++)n[e]/=s;for(let s=0;s<t;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}return i}(r,n)}(c);if(!d&&!(d=function(e){let t=function(e){let t=s9(e),r=t.length,n=t[0].length;if(r<n)return null;let i=Array(n).fill(0),s=Array(n).fill(0),a=Array.from({length:n},()=>Array(n).fill(0)),o=Number.EPSILON,l=0,u=0,c=0;for(let e=0;e<n;e++){if(i[e]=l,(u=at(t,e,r,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e]>=0&&(l=-l);let i=t[e][e]*l-u;t[e][e]-=l;for(let s=e+1;s<n;s++){u=at(t,e,r,e,s);for(let n=e;n<r;n++)t[n][s]+=u/i*t[n][e]}}if(s[e]=l,(u=ar(t,e+1,n,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e+1]>=0&&(l=-l);let s=t[e][e+1]*l-u;t[e][e+1]-=l;for(let r=e+1;r<n;r++)i[r]=t[e][r]/s;for(let s=e+1;s<r;s++){u=ar(t,e+1,n,s,e);for(let r=e+1;r<n;r++)t[s][r]+=u*i[r]}}let a=Math.abs(s[e])+Math.abs(i[e]);a>c&&(c=a)}let h=0;for(let e=n-1;e>=0;e--){if(0!==l){for(let r=h;r<n;r++)a[r][e]=t[e][r]/(l*t[e][e+1]);for(let r=h;r<n;r++){u=0;for(let i=h;i<n;i++)u+=t[e][i]*a[i][r];for(let t=h;t<n;t++)a[t][r]+=u*a[t][e]}}for(let t=h;t<n;t++)a[e][t]=0,a[t][e]=0;a[e][e]=1,l=i[e],h=e}for(let e=n-1;e>=0;e--){l=s[e];for(let r=e+1;r<n;r++)t[e][r]=0;if(0!==l){for(let i=e+1;i<n;i++){u=at(t,e+1,r,e,i);for(let n=e;n<r;n++)t[n][i]+=u/(t[e][e]*l)*t[n][e]}for(let n=e;n<r;n++)t[n][e]/=l}else for(let n=e;n<r;n++)t[n][e]=0;t[e][e]+=1}o*=c;let d=0,m=0,g=0;for(let e=n-1;e>=0;e--)for(let l=0;l<50;l++){let u=!1,c=e;for(;c>=0;c--){if(Math.abs(i[c])<=o){u=!0;break}if(Math.abs(s[c-1])<=o)break}if(!u){let n=0,a=1;for(let l=c;l<e+1&&(d=a*i[l],m=s[l],i[l]*=n,!(Math.abs(d)<=o));l++){g=ae(d,m),s[l]=g,n=m/g,a=-d/g;for(let e=0;e<r;e++){let r=t[e][c-1],i=t[e][l];t[e][c-1]=r*n+i*a,t[e][l]=-r*a+i*n}}}if(c===e){if(s[e]<0){s[e]=-s[e];for(let t=0;t<n;t++)a[t][e]=-a[t][e]}break}if(l>=49)return null;let h=s[c];g=ae(d=((s[e-1]-s[e])*(s[e-1]+s[e])+(i[e-1]-i[e])*(i[e-1]+i[e]))/(2*i[e]*s[e-1]),1),d=d<0?((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d-g)-i[e]))/h:((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d+g)-i[e]))/h;let f=1,p=1;for(let o=c+1;o<e+1;o++){let e=i[o],l=s[o];m=p*e,e*=f,g=ae(d,m),i[o-1]=g,d=h*(f=d/g)+e*(p=m/g),m=l*p,e=-h*p+e*f,l*=f;for(let e=0;e<n;e++){let t=a[e][o-1],r=a[e][o];a[e][o-1]=t*f+r*p,a[e][o]=-t*p+r*f}g=ae(d,m),s[o-1]=g,d=(f=d/g)*e+(p=m/g)*l,h=-p*e+f*l;for(let e=0;e<r;e++){let r=t[e][o-1],n=t[e][o];t[e][o-1]=r*f+n*p,t[e][o]=-r*p+n*f}}i[c]=0,i[e]=d,s[e]=h}for(let e=0;e<s.length;e++)s[e]<o&&(s[e]=0);for(let e=0;e<n;e++)for(let r=e-1;r>=0;r--)if(s[r]<s[e]){let n=s[r];s[r]=s[e],s[e]=n;for(let n=0;n<t.length;n++){let i=t[n][e];t[n][e]=t[n][r],t[n][r]=i}for(let t=0;t<a.length;t++){let n=a[t][e];a[t][e]=a[t][r],a[t][r]=n}e=r}return{matrixU:t,matrixS:s,matrixV:a}}(e);if(!t)return null;let{matrixU:r,matrixS:n,matrixV:i}=t,s=s9(r),a=Array.from({length:n.length},()=>Array(e[0].length).fill(0)),o=Math.max(e.length,e[0].length)*Number.EPSILON*n[0];for(let e=0;e<n.length;e++)Math.abs(n[e])>o&&(a[e][e]=1/n[e]);return s6(i,s6(a,s))}(c)))return ra.create(en.NA);let m=s6(d,h);n||m.push([0]);let g=(m=s9(m))[0].pop();if(m[0].reverse(),m[0].push(g),i)for(let e=0;e<m[0].length;e++)m[0][e]=Math.exp(m[0][e]);return{coefficients:m,Y:a,X:o,newX:l,XTXInverse:d}}class ak extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(1);s.isNull()&&(s=nX.create(0)),a.isNull()&&(a=nX.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<=0||m>=1||p>=C)return ra.create(en.NUM);let _=ao(m,g,f)*(C-p)+p;return nX.create(_)}}class aF extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||d>m||g<0||g>1?ra.create(en.NUM):(i=f?ad(d,m,g):am(d,m,g),nX.create(i))}}class aj extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=+o.getValue(),h=+l.getValue();if(u<0||c<=0||c>=1||h<=0||h>=1)return ra.create(en.NUM);let d=0;for(;d<=u&&!(ad(d,u,c)>=h);)d++;return nX.create(d)}}class aB extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return ra.create(en.NUM);let u=1-ag(o,l);return nX.create(u)}}class a$ extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return ra.create(en.NUM);let u=af(1-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}}class aH extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ra.create(en.VALUE):ra.create(en.NA);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h,r,n)}_getResult(e,t,r,n){let i=0;for(let r=0;r<e.length;r++){if(0===t[r])return ra.create(en.DIV_BY_ZERO);i+=(e[r]-t[r])**2/t[r]}let s=(r-1)*(n-1);1===r?s=n-1:1===n&&(s=r-1);let a=1-ag(i,s);return nX.create(a)}}class aW extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sz(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return ra.create(en.NUM);let p=Math.abs(aT(m/2,0,1)*g/Math.sqrt(f));return nX.create(p)});return 1===n&&1===i?l.get(0,0):l}}class aG extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ra.create(en.VALUE);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return ra.create(en.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nX.create(o/r)}}class aY extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=+l.getValue(),d=+u.getValue();return c<0||h<=0?ra.create(en.NUM):(d?n=c<0?0:1-Math.exp(-h*c):n=c<0?0:h*Math.exp(-h*c),nX.create(n))}}class az extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>1e10)return ra.create(en.NUM);let d=1-ap(u,c,h);return nX.create(d)}}class aX extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return ra.create(en.NUM);let d=aC(1-u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}}class aq extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variance:i,ns1:s}=this._getValues(e);if(r)return n;let{isError:a,errorObject:o,variance:l,ns1:u}=this._getValues(t);if(a)return o;let c=2*(1-ap(i/l,s,u));return c>1&&(c=2-c),nX.create(c)}_getValues(e){let t=0,r=0,n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(1===n&&1===i){let n=e.isArray()?e.get(0,0):e;return n.isError()?{isError:!0,errorObject:n,variance:t,ns1:r}:n.isNull()?{isError:!0,errorObject:ra.create(en.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),variance:t,ns1:r}}let s=[],a=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(o,n):e;if(i.isError())return{isError:!0,errorObject:i,variance:t,ns1:r};if(i.isNull()||i.isBoolean())continue;let l=i.getValue();(0,B.isRealNum)(l)&&(s.push(+l),a+=+l)}if(s.length<=1)return{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),variance:t,ns1:r};let o=a/s.length,l=0;for(let e=0;e<s.length;e++)l+=(s[e]-o)**2;return 0==(t=l/(r=s.length-1))?{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class aK extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<0||m<=0||g<=0?ra.create(en.NUM):(f?i=d<=0?0:aE(m,d/g):i=d<0?0:0===d&&1===m?1/g:Math.exp((m-1)*Math.log(d)-d/g-aR(m)-m*Math.log(g)),nX.create(i))}}class aQ extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<0||u>1||c<=0||h<=0)return ra.create(en.NUM);let d=u<=0?0:u>=1?1/0:h*ab(u,c);return Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}}class aZ extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return ra.create(en.NUM);let d=Math.exp(aT(u,c,h));return Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}}class aJ extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,B.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new ra(en.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return nX.create(r[0])}}class a0 extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return g<=0?ra.create(en.NUM):(i=f?aA(d,m,g):av(d,m,g),nX.create(i))}}class a1 extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return ra.create(en.NUM);let d=aT(u,c,h);return nX.create(d)}}class a2 extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0||s>=1)return ra.create(en.NUM);let a=aT(s,0,1);return nX.create(a)}}class a5 extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<0||a>1)return ra.create(en.NUM);let l=a*(o-1),u=Math.floor(l),c=l-u;if(0===c)return nX.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nX.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}}class a3 extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nX.create(3);i.isNull()&&(i=nX.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,t,ra.create(en.NA)),l=ie(s,a,i,ra.create(en.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof ra)return e;let{isError:n,errorObject:i,variants:s}=sz(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return ra.create(en.NA);if(1===c)return l===e[0]?nX.create(1):ra.create(en.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=m/(c-1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+(l-e[m])/(e[m+1]-e[m]))/(c-1),d=!0),m++;return d?u<1?ra.create(en.NUM):(h=nk(h,u),nX.create(h)):ra.create(en.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}}class a4 extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=Math.floor(+o.getValue()),h=+l.getValue(),d=+u.getValue();return c<0||h<0?ra.create(en.NUM):(n=d?function(e,t){let r=0;for(let n=0;n<=e;n++)r+=aw(n,t);return r}(c,h):aw(c,h),nX.create(n))}}class a6 extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>4)return ra.create(en.NUM);let o=a/4*(e.length-1),l=Math.floor(o),u=o-l;if(0===u)return nX.create(e[l]);let c=e[l]+u*(e[l+1]-e[l]);return nX.create(c)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}}class a9 extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std()}}class a8 extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class a7 extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return ra.create(en.NUM);let u=Math.abs(aO(o/2,l));return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}}class oe extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,array1Values:a,array2Values:o}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),u=this._getArrayValues(t),c=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),h=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),d=ie(c,h,r,ra.create(en.NA)),m=ie(c,h,n,ra.create(en.NA)),g=d.mapValue((r,n,c)=>{let h=m.get(n,c);if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(h.isError())return h;let{isError:d,errorObject:g,variants:f}=sz(r,h);if(d)return g;let[p,C]=f,_=Math.floor(+p.getValue()),y=Math.floor(+C.getValue());return[1,2].includes(_)&&[1,2,3].includes(y)?1===y&&i?s:1!==y&&l instanceof ra?l:1!==y&&u instanceof ra?u:this._handleSignleObject(1===y?a:l,1===y?o:u,_,y):ra.create(en.NUM)});return 1===c&&1===h?g.get(0,0):g}_handleSignleObject(e,t,r,n){if(e.length<2||t.length<2)return ra.create(en.DIV_BY_ZERO);let{isError:i,errorObject:s,x:a,degFreedom:o}=this._getTDistParamByArrayValues(e,t,n);if(i)return s;let l=aM(-a,o);return 2===r&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?ra.create(en.NUM):nX.create(l)}_getArrayValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let s=0;s<r;s++){let a=e.isArray()?e.get(i,s):e;if(a.isError())return a;if(a.isNull()){if(t*r==1)return ra.create(en.VALUE);continue}a.isBoolean()||a.isString()||n.push(+a.getValue())}return n}_handleArray1AndArray2(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,array1Values:[],array2Values:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,array1Values:[],array2Values:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:ra.create(en.VALUE),array1Values:[],array2Values:[]};if(r*n!=i*s)return{isError:!0,errorObject:ra.create(en.NA),array1Values:[],array2Values:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,array1Values:[],array2Values:[]}:d||c.length<2?{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:c,array2Values:h}}_getTDistParamByArrayValues(e,t,r){return 1===r?this._getTDistParamByType1(e,t):2===r?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){let r=e.length,n=0,i=0,s=0;for(let a=0;a<r;a++)n+=e[a],i+=t[a],s+=(e[a]-t[a])**2;let a=n-i,o=r*s-a**2,l=r-1;return 0===o?{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(a)*Math.sqrt(l/o),degFreedom:l}}_getTDistParamByType2(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=Math.sqrt(s-i**2/r+(o-a**2/n));if(0===l)return{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),x:0,degFreedom:0};let u=r-1+n-1,c=Math.sqrt(r*n*u/(r+n));return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/l*c,degFreedom:u}}_getTDistParamByType3(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=(s-i**2/r)/(r*(r-1)),u=(o-a**2/n)/(n*(n-1));if(l+u===0)return{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),x:0,degFreedom:0};let c=l/(l+u);return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/Math.sqrt(l+u),degFreedom:1/(c**2/(r-1)+(1-c)**2/(n-1))}}}class ot extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var()}}class or extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class on extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();if(d<0||m<=0||g<=0)return ra.create(en.NUM);let p=Math.exp(-((d/g)**m));return Number.isNaN(i=f?1-p:m/g**m*d**(m-1)*p)||!Number.isFinite(i)?ra.create(en.NUM):nX.create(i)}}class oi extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=this._getArrayValues(e),i=Math.max(t.isArray()?t.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(t.isArray()?t.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=ie(i,s,t,ra.create(en.NA)),o=r?ie(i,s,r,ra.create(en.NA)):void 0,l=a.mapValue((e,t,i)=>{if(n instanceof ra)return n;if(e.isError())return e;let s=r?o.get(t,i):void 0;return null!=s&&s.isError()?s:0===n.length?ra.create(en.NA):1===n.length?ra.create(en.DIV_BY_ZERO):this._handleSignleObject(n,e,s)});return 1===i&&1===s?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.length,u=0,c=0;for(let t=0;t<l;t++)u+=e[t],c+=e[t]**2;let h=0;if(void 0!==r){let{isError:e,errorObject:t,variants:n}=sz(r);if(e)return t;let[i]=n;h=+i.getValue()}else{let e=u/l;h=Math.sqrt((c-2*e*u+l*e**2)/(l-1))}if(h<=0)return ra.create(en.NUM);let d=1-aA((u/l-o)/(h/Math.sqrt(l)),0,1);return Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}_getArrayValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;if(n.isNull()||n.isBoolean()||n.isString())continue;let s=n.getValue();(0,B.isRealNum)(s)&&t.push(+s)}return t}}var os=((T=os||{}).BETADIST="BETADIST",T.BETAINV="BETAINV",T.BINOMDIST="BINOMDIST",T.CHIDIST="CHIDIST",T.CHIINV="CHIINV",T.CHITEST="CHITEST",T.CONFIDENCE="CONFIDENCE",T.COVAR="COVAR",T.CRITBINOM="CRITBINOM",T.EXPONDIST="EXPONDIST",T.FDIST="FDIST",T.FINV="FINV",T.FTEST="FTEST",T.GAMMADIST="GAMMADIST",T.GAMMAINV="GAMMAINV",T.HYPGEOMDIST="HYPGEOMDIST",T.LOGINV="LOGINV",T.LOGNORMDIST="LOGNORMDIST",T.MODE="MODE",T.NEGBINOMDIST="NEGBINOMDIST",T.NORMDIST="NORMDIST",T.NORMINV="NORMINV",T.NORMSDIST="NORMSDIST",T.NORMSINV="NORMSINV",T.PERCENTILE="PERCENTILE",T.PERCENTRANK="PERCENTRANK",T.POISSON="POISSON",T.QUARTILE="QUARTILE",T.RANK="RANK",T.STDEV="STDEV",T.STDEVP="STDEVP",T.TDIST="TDIST",T.TINV="TINV",T.TTEST="TTEST",T.VAR="VAR",T.VARP="VARP",T.WEIBULL="WEIBULL",T.ZTEST="ZTEST",T);let oa=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(1);s.isNull()&&(s=nX.create(0)),a.isNull()&&(a=nX.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sz(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<p||m>C||p===C)return ra.create(en.NUM);let _=aa((m-p)/(C-p),g,f);return nX.create(_)}},os.BETADIST],[ak,os.BETAINV],[aF,os.BINOMDIST],[aB,os.CHIDIST],[a$,os.CHIINV],[aH,os.CHITEST],[aW,os.CONFIDENCE],[aG,os.COVAR],[aj,os.CRITBINOM],[aY,os.EXPONDIST],[az,os.FDIST],[aX,os.FINV],[aq,os.FTEST],[aK,os.GAMMADIST],[aQ,os.GAMMAINV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||h>d||h>m||h<d-g+m||d<=0||d>g||m<=0||m>g||g<=0)return ra.create(en.NUM);let f=aI(h,d,m,g);return Number.isNaN(f)&&(f=0),nX.create(f)}},os.HYPGEOMDIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||h<=0)return ra.create(en.NUM);let d=aN(u,c,h);return nX.create(d)}},os.LOGNORMDIST],[aZ,os.LOGINV],[aJ,os.MODE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue()),h=+l.getValue();if(u<0||c<1||h<=0||h>=1)return ra.create(en.NUM);let d=aS(u,c,h);return nX.create(d)}},os.NEGBINOMDIST],[a0,os.NORMDIST],[a1,os.NORMINV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=aA(+i.getValue(),0,1);return nX.create(s)}},os.NORMSDIST],[a2,os.NORMSINV],[a5,os.PERCENTILE],[a3,os.PERCENTRANK],[a4,os.POISSON],[a6,os.QUARTILE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nX.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,n,ra.create(en.NA)),h=ie(l,u,o,ra.create(en.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ra.create(en.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ra.create(en.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?ra.create(en.NA):nX.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=ra.create(en.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},os.RANK],[a8,os.STDEV],[a9,os.STDEVP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>2)return ra.create(en.NUM);let d=aM(-u,c);return 2===h&&(d*=2),Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}},os.TDIST],[a7,os.TINV],[oe,os.TTEST],[or,os.VAR],[ot,os.VARP],[on,os.WEIBULL],[oi,os.ZTEST]],oo=[];var ol=((w=ol||{}).CUBEKPIMEMBER="CUBEKPIMEMBER",w.CUBEMEMBER="CUBEMEMBER",w.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",w.CUBERANKEDMEMBER="CUBERANKEDMEMBER",w.CUBESET="CUBESET",w.CUBESETCOUNT="CUBESETCOUNT",w.CUBEVALUE="CUBEVALUE",w);class ou extends sX{isCustom(){return!0}}class oc extends ou{isAsync(){return!0}}function oh(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,databaseValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:ra.create(en.VALUE),databaseValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()&&(s=s.toLocaleUpperCase()),n.isNumber()||(0,B.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,databaseValues:t}}function od(e,t){let r=-1;if(e.isError())return{isError:!0,errorObject:e,fieldIndex:r};let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(n>1||i>1)return{isError:!0,errorObject:ra.create(en.VALUE),fieldIndex:r};let s=e.isArray()?e.get(0,0):e,a=`${s.getValue()}`;if(s.isNull()?a=0:s.isBoolean()?a=+!!s.getValue():(s.isNumber()||(0,B.isRealNum)(a))&&(a=Math.floor(+a)),"number"==typeof a){if(a<1||a>t[0].length)return{isError:!0,errorObject:ra.create(en.VALUE),fieldIndex:r};r=a-1}else if(-1===(r=t[0].findIndex(e=>null!==e&&`${e}`.toLocaleLowerCase()===a.toLocaleLowerCase())))return{isError:!0,errorObject:ra.create(en.VALUE),fieldIndex:r};return{isError:!1,errorObject:null,fieldIndex:r}}function om(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,criteriaValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:ra.create(en.VALUE),criteriaValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()){r.push(+!!n.getValue());continue}if(n.isNumber()||(0,B.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,criteriaValues:t}}function og(e,t,r){let n=e.length,i=e[0].length,s={},a=!1;for(let o=1;o<n;o++){let n=!0;for(let a=0;a<i;a++){let i=e[o][a];if(null===i)continue;let l=s[a];if(void 0===l){let r=e[0][a];l=t[0].findIndex(e=>null!==e&&null!==r&&`${e}`.toLocaleLowerCase()===`${r}`.toLocaleLowerCase()),s[a]=l}if(-1===l&&("string"==typeof i||0===i)){n=!1;break}if(l>-1){let e=t[r][l];if(null===e){n=!1;break}let[s,a]=ir(`${i}`);if(!n1.create(`${e}`).compare(a,s).getValue()){n=!1;break}}}if(n){a=!0;break}}return a}var of=((M=of||{}).DAVERAGE="DAVERAGE",M.DCOUNT="DCOUNT",M.DCOUNTA="DCOUNTA",M.DGET="DGET",M.DMAX="DMAX",M.DMIN="DMIN",M.DPRODUCT="DPRODUCT",M.DSTDEV="DSTDEV",M.DSTDEVP="DSTDEVP",M.DSUM="DSUM",M.DVAR="DVAR",M.DVARP="DVARP",M);let op=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d+=t,m++)}return 0===m?ra.create(en.DIV_BY_ZERO):nX.create(d/m)}},of.DAVERAGE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)"number"==typeof s[e][l]&&og(h,s,e)&&d++;return nX.create(d)}},of.DCOUNT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&og(h,s,e)&&d++;return nX.create(d)}},of.DCOUNTA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&og(h,s,e)&&(d++,m=e);return 0===d?ra.create(en.VALUE):d>1?ra.create(en.NUM):e.get(m,l)}},of.DGET],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=-1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d=Math.max(d,t),m++)}return 0===m?nX.create(0):nX.create(d)}},of.DMAX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d=Math.min(d,t),m++)}return 0===m?nX.create(0):nX.create(d)}},of.DMIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=1,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d*=t,m++)}return 0===m?nX.create(0):nX.create(d)}},of.DPRODUCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return ra.create(en.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/(g-1));return nX.create(C)}},of.DSTDEV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return ra.create(en.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/g);return nX.create(C)}},of.DSTDEVP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d+=t)}return nX.create(d)}},of.DSUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return ra.create(en.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/(g-1);return nX.create(C)}},of.DVAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oh(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=od(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=om(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&og(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return ra.create(en.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/g;return nX.create(C)}},of.DVARP]],oC="yyyy/mm/dd;@";function o_(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),i=(n-t.getTime())/864e5;return n>r.getTime()&&(i+=1),Math.floor(i)+1}function oy(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=(e.getTime()-t.getTime())/864e5;return e>r&&(n+=1),n+1}function oR(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Math.floor(e)-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),new Date(t.getTime()+864e5*n)}function oE(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=e-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),n<0&&(n=e),new Date(t.getTime()+864e5*n)}function ob(e){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let t=e.replace(/-/g,"/").replace(/T.+/,""),r=new Date(`${t}`);if(Number.isNaN(r.getTime()))return!1;let n=r.getFullYear(),i=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0"),a=`${n}-${i}-${s}`;return e.replace(/\//g,"-").split("-").map(e=>e.padStart(2,"0")).join("-")===a}function oI(e){return B.numfmt.parseDate(e)}function oN(e){return B.numfmt.parseTime(e)}function oS(e){return B.numfmt.getFormatInfo(e).isDate}let oA={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function ov(e){return!!("string"==typeof e&&/^[0|1]{7}/.test(e)||oA[Number(e)])}function oT(e){if(!ov(e))return[];if("string"==typeof e&&/^[0|1]{7}/.test(e)){let t=[];for(let r=1;r<=e.length;r++)"1"==`${e[r-1]}`&&(r===e.length?t.push(0):t.push(r));return t}return oA[Number(e)]||[]}function ow(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=Math.floor(t),o=a>s?s:a,l=0,u=Math.abs(Math.floor(t)-Math.floor(e))+1;for(let e=0;e<u;e++){let t=o+e;if(n&&n.length>0&&n.some(e=>Math.floor(e)===t))continue;let r=ox(t);i.includes(r)||l++}return a>=s?l:-l}function oM(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=s,o=Math.abs(t);for(let e=1;e<=o;e++){let r=t<0?s-e:s+e;if(r<0)return ra.create(en.NUM);if(n&&n.length>0&&n.some(e=>Math.floor(e)===r)){o++;continue}let l=ox(r);if(i.includes(l)){o++;continue}a=r}return a}function oO(e){if(e.isError())return e;let t=e.getValue();if(e.isString()){let e;if(oI(`${t}`))e=oI(`${t}`).v;else if(oN(`${t}`))e=oN(`${t}`).v;else{if(!(0,B.isRealNum)(t))return ra.create(en.VALUE);e=+t}return e instanceof Date&&(e=oy(e)),0>+e||+e>2958465?ra.create(en.NUM):+e}{let t=+e.getValue();return t<0||t>2958465?ra.create(en.NUM):t}}function ox(e){let t=60===Math.floor(e),r=oR(e),n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getTime(),i=new Date(Date.UTC(1900,1,28)).getTime();return!t&&n<=i&&(r=new Date(n-864e5)),new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getUTCDay()}function oU(e,t,r){switch(r){case 0:return function(e,t){let r=oR(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oR(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 2===i?oR(e+1).getUTCMonth()+1===3&&(s=30):31===s&&(s=30),31===u&&(s<30?(o=(a=oR(t+1)).getUTCFullYear(),l=a.getUTCMonth()+1,u=a.getUTCDate()):u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t);case 1:return function(e,t){let r,n,i=oR(e),s=e>0?i.getUTCFullYear():1900,a=oR(t),o=t>0?a.getUTCFullYear():1900,l=Math.abs(t-e),u=Math.abs(o-s)+1;if(o<s){let e=new Date(Date.UTC(o,0,1)),t=new Date(Date.UTC(s,11,31));r=o_(e),n=o_(t),1900===o&&(r+=1)}else{let e=new Date(Date.UTC(s,0,1)),t=new Date(Date.UTC(o,11,31));r=o_(e),n=o_(t),1900===s&&(r+=1)}return{days:l,yearDays:(n-r+1)/u}}(e,t);case 2:return{days:Math.abs(t-e),yearDays:360};case 3:default:return{days:Math.abs(t-e),yearDays:365};case 4:return function(e,t){let r=oR(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oR(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 31===s&&(s=30),31===u&&(u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t)}}let oD=[31,29,31,30,31,30,31,31,30,31,30,31],oV=[31,28,31,30,31,30,31,31,30,31,30,31];function oL(e,t){return e%4==0&&e%100!=0||e%400==0?oD[t]:oV[t]}function oP(e){return e%4==0&&e%100!=0||e%400==0||1900===e?366:365}function ok(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return oP(oR(e).getUTCFullYear());case 3:return 365;default:return -1}}function oF(e,t){let r=e.getUTCFullYear(),n=e.getUTCMonth(),i=e.getUTCDate();return oL(r,n)===i?(e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),r=e.getUTCFullYear(),n=e.getUTCMonth(),e.setUTCDate(oL(r,n))):e.setUTCMonth(e.getUTCMonth()+t),e}var oj=((O=oj||{}).DATE="DATE",O.DATEDIF="DATEDIF",O.DATEVALUE="DATEVALUE",O.DAY="DAY",O.DAYS="DAYS",O.DAYS360="DAYS360",O.EDATE="EDATE",O.EOMONTH="EOMONTH",O.EPOCHTODATE="EPOCHTODATE",O.HOUR="HOUR",O.ISOWEEKNUM="ISOWEEKNUM",O.MINUTE="MINUTE",O.MONTH="MONTH",O.NETWORKDAYS="NETWORKDAYS",O.NETWORKDAYS_INTL="NETWORKDAYS.INTL",O.NOW="NOW",O.SECOND="SECOND",O.TIME="TIME",O.TIMEVALUE="TIMEVALUE",O.TO_DATE="TO_DATE",O.TODAY="TODAY",O.WEEKDAY="WEEKDAY",O.WEEKNUM="WEEKNUM",O.WORKDAY="WORKDAY",O.WORKDAY_INTL="WORKDAY.INTL",O.YEAR="YEAR",O.YEARFRAC="YEARFRAC",O);let oB=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e),a=ie(n,i,t),o=ie(n,i,r);return s.map((e,t,r)=>{let n=a.get(t,r)||nG.create(),i=o.get(t,r)||nG.create();if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;if(e.isString()||n.isString()||i.isString())return ra.create(en.VALUE);let s=+e.getValue(),l=Math.floor(+n.getValue()),u=+i.getValue();if(s<0||s>9999)return ra.create(en.NUM);s>=0&&s<1899&&(s+=1900);let c=o_(new Date(s,l-1,u));return c<0?ra.create(en.NUM):nX.create(c,oC)})}},oj.DATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t,s=r;if(n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),s.isArray()&&(s=s.get(0,0)),n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=oO(n);if("number"!=typeof a)return a;let o=oO(i);return"number"!=typeof o?o:o<a||!s.isString()?ra.create(en.NUM):this._getResultByUnit(a,o,s)}_getResultByUnit(e,t,r){let n=oR(e),i=n.getUTCFullYear(),s=n.getUTCMonth()+1,a=n.getUTCDate(),o=oR(t),l=o.getUTCFullYear(),u=o.getUTCMonth()+1,c=o.getUTCDate(),h=`${r.getValue()}`.toLocaleUpperCase(),d=0,m;switch(h){case"Y":d=l-i,(u<s||u===s&&c<a)&&(d-=1);break;case"M":d=(l-i)*12+u-s,c<a&&(d-=1);break;case"D":d=Math.floor(t)-Math.floor(e);break;case"MD":d=c-a,c<a&&(d+=oL((m=new Date(Date.UTC(l,u-1,0))).getUTCFullYear(),m.getUTCMonth()));break;case"YM":d=u-s,(u<s||u===s&&c<a)&&(d+=12),c<a&&(d-=1);break;case"YD":m=new Date(Date.UTC(i,u-1,c)),(u<s||u===s&&c<a)&&(m=new Date(Date.UTC(i+1,u-1,c))),d=Math.floor(o_(m))-Math.floor(e);break;default:return ra.create(en.NUM)}return nX.create(d)}},oj.DATEDIF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=`${e.getValue()}`,r=oI(t);if(null===r&&(r=oN(t)),r){let{v:e,z:t}=r;if(t&&oS(t))return e instanceof Date&&(e=oy(e)),nX.create(Math.trunc(+e))}}return ra.create(en.VALUE)}},oj.DATEVALUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t,r=e.getValue();if(e.isString()){if(!ob(`${r}`))return ra.create(en.VALUE);t=new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return ra.create(en.NUM);if(0===r)return nX.create(0);t=oR(r)}let n=t.getDate();return nX.create(n)}},oj.DAY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let i=oO(e);if("number"!=typeof i)return i;let a=oO(n);if("number"!=typeof a)return a;let o=Math.floor(i)-Math.floor(a);return nX.create(o)});return 1===r&&1===n?a.get(0,0):a}},oj.DAYS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nz.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);if(e.isError())return e;let s=oO(e);if("number"!=typeof s)return s;if(n.isError())return n;let a=oO(n);if("number"!=typeof a)return a;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let{days:u}=oU(s,a,4*!!+i.getValue());return nX.create(a>=s?u:-u)});return 1===i&&1===s?u.get(0,0):u}},oj.DAYS360],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t);return i.map((e,t,r)=>{let n=s.get(t,r)||nG.create();if(e.isError())return e;if(n.isError())return n;if(e.isString()||e.isBoolean()||n.isString()||n.isBoolean())return ra.create(en.VALUE);let i=+e.getValue();if(i<0)return ra.create(en.NUM);let a=Math.floor(+n.getValue()),o=oR(i),l=o.getUTCFullYear(),u=o_(new Date(Date.UTC(l,o.getUTCMonth()+a,o.getUTCDate())));return nX.create(u,oC)})}},oj.EDATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);r=r.get(0,0)}if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;let i=oO(r);if("number"!=typeof i)return i;if(n.isBoolean())return ra.create(en.VALUE);let s=oR(i),a=i>0?s.getUTCFullYear():1900,o=i>0?s.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return ra.create(en.VALUE);let u=o_(new Date(Date.UTC(a,o+l+1,0)));return nX.create(u)}},oj.EOMONTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2),Z(this,"needsReferenceObject",!0)}calculate(e,t){let r=null!=t?t:nX.create(1),{isError:n,errorObject:i,timestampIsReferenceObject:s,timestampObject:a,unitObject:o}=this._checkVariants(e,r);if(n)return i;if(a.isNull()||a.isBoolean()||a.isString()||!s&&a.isNumber()&&""!==a.getPattern())return ra.create(en.VALUE);let l=+a.getValue(),{isError:u,errorObject:c,variants:h}=sz(o);if(u)return c;let[d]=h,m=Math.floor(+d.getValue());if(l<0||m<1||m>3)return ra.create(en.NUM);1===m&&(l*=1e3),3===m&&(l/=1e3);let g=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(g.getTime())){let e=25569+l/864e5;return nX.create(e)}{let e=oy(g);return nX.create(e,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){let r=e.isReferenceObject(),n=t.isReferenceObject(),i=e;if(r&&(i=e.toArrayValueObject()),i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ra.create(en.VALUE)};i=i.get(0,0)}if(i.isError())return{isError:!0,errorObject:i};let s=t;if(n&&(s=t.toArrayValueObject()),s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ra.create(en.VALUE)};s=s.get(0,0)}return s.isError()?{isError:!0,errorObject:s}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:i,unitIsReferenceObject:n,unitObject:s}}},oj.EPOCHTODATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nX.create(0);let r=oE(t).getUTCHours();return nX.create(r)}},oj.HOUR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;let r=oR(t),n=t>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=o_(i),a=ox(s),o;t<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=o_(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));let l=Math.ceil((t-o+1)/7);return nX.create(l)}},oj.ISOWEEKNUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nX.create(0);let r=oE(t).getUTCMinutes();return nX.create(r)}},oj.MINUTE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!ob(`${r}`))return ra.create(en.VALUE);t=new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return ra.create(en.NUM);if(0===r)return nX.create(1);t=oR(r)}let n=t.getUTCMonth()+1;return nX.create(n)}},oj.MONTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return ra.create(en.VALUE);let s=oO(n);if("number"!=typeof s)return s;let a=oO(i);if("number"!=typeof a)return a;if(r)return this._getResultByHolidays(s,a,r);let o=ow(s,a);return nX.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return ra.create(en.VALUE);let s=oO(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return ra.create(en.VALUE);let e=oO(r);if("number"!=typeof e)return e;n.push(e)}let i=ow(e,t,1,n);return nX.create(i)}},oj.NETWORKDAYS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=e,s=t;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);i=i.get(0,0)}if(i.isError())return i;if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);s=s.get(0,0)}if(s.isError())return s;let a=1;if(r){if(a=r.getValue(),r.isBoolean()&&(a*=1),r.isString()&&!ov(a))return ra.create(en.VALUE);if(!ov(a))return ra.create(en.NUM)}if(i.isBoolean()||s.isBoolean())return ra.create(en.VALUE);let o=oO(i);if("number"!=typeof o)return o;let l=oO(s);if("number"!=typeof l)return l;if(n)return this._getResultByHolidays(o,l,a,n);let u=ow(o,l,a);return nX.create(u)}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return ra.create(en.VALUE);let s=oO(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return ra.create(en.VALUE);let e=oO(n);if("number"!=typeof e)return e;i.push(e)}let s=ow(e,t,r,i);return nX.create(s)}},oj.NETWORKDAYS_INTL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){let e=new Date,t=oy(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())));return nX.create(t,"yyyy/mm/dd hh:mm")}},oj.NOW],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nX.create(0);let r=oE(t).getUTCSeconds();return nX.create(r)}},oj.SECOND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e),a=ie(n,i,t),o=ie(n,i,r);return s.map((e,t,r)=>this._calculateTime(e,a,o,t,r))}_calculateTime(e,t,r,n,i){let s=e,a=t.get(n,i)||nG.create(),o=r.get(n,i)||nG.create();if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),(a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(o.isString()||o.isBoolean())&&(o=o.convertToNumberObjectValue()),s.isError())return s;if(a.isError())return a;if(o.isError())return o;let l=Math.floor(+s.getValue()),u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue());if(l<0||u<0||c<0||l>32767||u>32767||c>32767)return ra.create(en.NUM);u+=Math.floor(c/60),c%=60,l+=Math.floor(u/60);let h=(3600*(l%=24)+60*(u%=60)+c)/86400;return nX.create(h,"h:mm A/P")}},oj.TIME],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){var t,r;let n=(t=`${e.getValue()}`,B.numfmt.parseValue(t));if(n){let{v:e,z:t}=n;if(t&&oS(t))return e instanceof Date&&(e=oy(e)),nX.create((r=+e)-Math.trunc(r))}}return ra.create(en.VALUE)}},oj.TIMEVALUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0)}calculate(e){let t=e.isReferenceObject(),r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&""!==r.getPattern())return r;let n=+r.getValue();return nX.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}},oj.TO_DATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){let e=o_(new Date);return nX.create(e,oC)}},oj.TODAY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2),Z(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){let r=null!=t?t:nX.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r);return this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;let n=oO(e);if("number"!=typeof n)return n;if(r.isString()&&(r=r.convertToNumberObjectValue()).isError())return r;let i=Math.floor(+r.getValue());if(!this._returnTypeMap[i])return ra.create(en.NUM);let s=ox(n),a=this._returnTypeMap[i][s];return nX.create(a)}},oj.WEEKDAY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2),Z(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=null!=t?t:nX.create(1);if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return ra.create(en.VALUE);let i=oO(r);if("number"!=typeof i)return i;if(n.isBoolean())return ra.create(en.VALUE);let s=Math.floor(+n.getValue());return Number.isNaN(s)?ra.create(en.VALUE):s in this._returnTypeMap?this._getResult(i,s):ra.create(en.NUM)}_getResult(e,t){let r=oR(e),n=e>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=o_(i),a=ox(s),o;if(21===t)e<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=o_(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));else{let e=this._returnTypeMap[t];o=a<e?s-(a+7-e):s-(a-e)}let l=Math.ceil((e-o+1)/7);return nX.create(l)}},oj.WEEKNUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return ra.create(en.VALUE);let s=oO(n);if("number"!=typeof s)return s;let a=+i.getValue();if(Number.isNaN(a))return ra.create(en.VALUE);if(r)return this._getResultByHolidays(s,a,r);let o=oM(s,a);return"number"!=typeof o?o:nX.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return ra.create(en.VALUE);let s=oO(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return ra.create(en.VALUE);let e=oO(r);if("number"!=typeof e)return e;n.push(e)}let i=oM(e,t,1,n);return"number"!=typeof i?i:nX.create(i)}},oj.WORKDAY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=null!=r?r:nX.create(1),s=this._checkArrayError(e);if(s.isError())return s;let a=this._checkArrayError(t);if(a.isError())return a;if(s.isBoolean()||a.isBoolean())return ra.create(en.VALUE);let o=oO(e);if("number"!=typeof o)return o;let l=+t.getValue();if(Number.isNaN(l))return ra.create(en.VALUE);let u=i.getValue();if(i.isBoolean()&&(u*=1),i.isString()&&(!ov(u)||"1111111"===u))return ra.create(en.VALUE);if(!ov(u))return ra.create(en.NUM);if(n)return this._getResultByHolidays(o,l,u,n);let c=oM(o,l,u);return"number"!=typeof c?c:nX.create(c)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return ra.create(en.VALUE);let s=oO(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return ra.create(en.VALUE);let e=oO(n);if("number"!=typeof e)return e;i.push(e)}let s=oM(e,t,r,i);return"number"!=typeof s?s:nX.create(s)}},oj.WORKDAY_INTL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!ob(`${r}`))return ra.create(en.VALUE);t=new Date(`${r}`)}else{let e=+r;if(e<0)return ra.create(en.NUM);if(0===e)return nX.create(1900);t=oR(e)}let n=t.getUTCFullYear();return nX.create(n)}},oj.YEAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(0),i=sH(e);if(i.isError())return i;let s=sH(t);if(s.isError())return s;if((n=sH(n)).isError())return n;if(i.isBoolean()||s.isBoolean()||n.isBoolean())return ra.create(en.VALUE);let a=oO(i);if("number"!=typeof a)return a;let o=oO(s);if("number"!=typeof o)return o;let l=Math.floor(+n.getValue());if(Number.isNaN(l))return ra.create(en.VALUE);if(l<0||l>4)return ra.create(en.NUM);let{days:u,yearDays:c}=oU(a,o,l);return nX.create(u/c)}},oj.YEARFRAC]];nV.prototype.cos=function(){return new nV(Math.cos(this.toNumber()))};let o$=class e{constructor(e){if(Z(this,"_inumber",""),Z(this,"_realNum",0),Z(this,"_iNum",0),Z(this,"_suffix",""),Z(this,"_isError",!1),""===`${e}`.trim()){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){let n,i=new nV(e).toSignificantDigits(15).toNumber(),s=new nV(t).toSignificantDigits(15).toNumber(),a=""===r?"i":r;if(0===i&&0===s)n=0;else if(0===i)n=1===s?a:`${s}${a}`;else if(0===s)n=i;else{let e=1===s?a:`${s}${a}`;n=`${i}${s>0?"+":""}${e}`}return n}static createByComplexStr(t,r,n){let i=e.getComplex(t,r,n);return new e(i)}_getImReal(){if(0===this._inumber||"0"===this._inumber){this._realNum=0;return}let e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(0===this._inumber||"0"===this._inumber){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-e.substring(r+1,e.length-1)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){let e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix="i"===t||"j"===t?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return e.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){let t=e.getSuffix();return""!==this._suffix&&""!==t&&this._suffix!==t}Abs(){return nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){let e=nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))),t=nV.acos(new nV(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return e.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){let t=nV.cos(this._realNum).mul(nV.cosh(this._iNum)).toNumber(),r=nV.sin(this._realNum).mul(nV.sinh(this._iNum)).negated().toNumber();return e.getComplex(t,r,this._suffix)}{let t=nV.cos(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nV.cosh(this._realNum).mul(nV.cos(this._iNum)).toNumber(),r=nV.sinh(this._realNum).mul(nV.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nV.cosh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cot(){if(this._iNum){let t=nV.cosh(2*this._iNum).sub(nV.cos(2*this._realNum)),r=nV.sin(2*this._realNum).div(t).toNumber(),n=nV.sinh(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.tan(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nV.cosh(2*this._realNum).sub(nV.cos(2*this._iNum)),r=nV.sinh(2*this._realNum).div(t).toNumber(),n=nV.sin(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.tanh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csc(){if(this._iNum){let t=nV.cosh(2*this._iNum).sub(nV.cos(2*this._realNum)),r=nV.sin(this._realNum).mul(nV.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nV.cos(this._realNum).mul(nV.sinh(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.sin(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nV.cosh(2*this._realNum).sub(nV.cos(2*this._iNum)),r=nV.sinh(this._realNum).mul(nV.cos(this._iNum)).mul(2).div(t).toNumber(),n=nV.cosh(this._realNum).mul(nV.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.sinh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Div(t){let r=new nV(this._realNum),n=new nV(this._iNum),i=new nV(t.getRealNum()),s=new nV(t.getINum()),a=i.mul(i).add(s.mul(s)),o=r.mul(i).add(n.mul(s)).div(a).toNumber(),l=n.mul(i).sub(r.mul(s)).div(a).toNumber(),u=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(o,l,u)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";let t=nV.exp(this._realNum).mul(nV.cos(this._iNum)).toNumber(),r=nV.exp(this._realNum).mul(nV.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}Ln(){let t=nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))),r=nV.ln(t).toNumber(),n=nV.acos(new nV(this._realNum).div(t)).toNumber();return e.getComplex(r,n,this._suffix)}Log(t){let r=nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))),n=nV.ln(r),i=nV.acos(new nV(this._realNum).div(r));this._iNum<0&&(i=i.negated());let s=nV.ln(t),a=new nV(0),o=s.mul(s).add(a.mul(a));if(o.eq(0))return this._isError=!0,"";let l=n.mul(s).add(i.mul(a)).div(o).toNumber(),u=i.mul(s).sub(n.mul(a)).div(o).toNumber();return e.getComplex(l,u,this._suffix)}Power(t){if(0===this._realNum&&0===this._iNum)return t>0?e.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let r=nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))),n=nV.acos(new nV(this._realNum).div(r));this._iNum<0&&(n=n.negated()),r=nV.pow(r,t),n=n.mul(t);let i=nV.cos(n).mul(r).toNumber(),s=nV.sin(n).mul(r).toNumber();return Number.isFinite(i)&&Number.isFinite(s)?e.getComplex(i,s,this._suffix):(this._isError=!0,"")}Product(t){let r=new nV(this._realNum),n=new nV(this._iNum),i=new nV(t.getRealNum()),s=new nV(t.getINum()),a=r.mul(i).sub(n.mul(s)).toNumber(),o=r.mul(s).add(n.mul(i)).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sec(){if(this._iNum){let t=nV.cosh(2*this._iNum).add(nV.cos(2*this._realNum)),r=nV.cos(this._realNum).mul(nV.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nV.sin(this._realNum).mul(nV.sinh(this._iNum)).mul(2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.cos(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(2*this._realNum))||!Number.isFinite(Math.cosh(2*this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nV.cosh(2*this._realNum).add(nV.cos(2*this._iNum)),r=nV.cosh(this._realNum).mul(nV.cos(this._iNum)).mul(2).div(t).toNumber(),n=nV.sinh(this._realNum).mul(nV.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nV(1).div(nV.cosh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sin(){if(this._iNum){let t=nV.sin(this._realNum).mul(nV.cosh(this._iNum)).toNumber(),r=nV.cos(this._realNum).mul(nV.sinh(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nV.sin(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nV.sinh(this._realNum).mul(nV.cos(this._iNum)).toNumber(),r=nV.cosh(this._realNum).mul(nV.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nV.sinh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sqrt(){let t=nV.sqrt(nV.pow(this._realNum,2).add(nV.pow(this._iNum,2))),r=nV.sqrt(t),n=nV.acos(new nV(this._realNum).div(t));this._iNum<0&&(n=n.negated());let i=r.mul(nV.cos(n.div(2).toNumber())).toNumber(),s=r.mul(nV.sin(n.div(2))).toNumber();return e.getComplex(i,s,this._suffix)}Sub(t){let r=new nV(this._realNum),n=new nV(this._iNum),i=new nV(t.getRealNum()),s=new nV(t.getINum()),a=r.sub(i).toNumber(),o=n.sub(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sum(t){let r=new nV(this._realNum),n=new nV(this._iNum),i=new nV(t.getRealNum()),s=new nV(t.getINum()),a=r.add(i).toNumber(),o=n.add(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Tan(){if(this._iNum){let t=nV.cos(2*this._realNum).add(nV.cosh(2*this._iNum)),r=nV.sin(2*this._realNum).div(t).toNumber(),n=nV.sinh(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nV.tan(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nV.cosh(2*this._realNum).add(nV.cos(2*this._iNum)),r=nV.sinh(2*this._realNum).div(t).toNumber(),n=nV.sin(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nV.tanh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}};var oH=((x=oH||{}).BESSELI="BESSELI",x.BESSELJ="BESSELJ",x.BESSELK="BESSELK",x.BESSELY="BESSELY",x.BIN2DEC="BIN2DEC",x.BIN2HEX="BIN2HEX",x.BIN2OCT="BIN2OCT",x.BITAND="BITAND",x.BITLSHIFT="BITLSHIFT",x.BITOR="BITOR",x.BITRSHIFT="BITRSHIFT",x.BITXOR="BITXOR",x.COMPLEX="COMPLEX",x.CONVERT="CONVERT",x.DEC2BIN="DEC2BIN",x.DEC2HEX="DEC2HEX",x.DEC2OCT="DEC2OCT",x.DELTA="DELTA",x.ERF="ERF",x.ERF_PRECISE="ERF.PRECISE",x.ERFC="ERFC",x.ERFC_PRECISE="ERFC.PRECISE",x.GESTEP="GESTEP",x.HEX2BIN="HEX2BIN",x.HEX2DEC="HEX2DEC",x.HEX2OCT="HEX2OCT",x.IMABS="IMABS",x.IMAGINARY="IMAGINARY",x.IMARGUMENT="IMARGUMENT",x.IMCONJUGATE="IMCONJUGATE",x.IMCOS="IMCOS",x.IMCOSH="IMCOSH",x.IMCOT="IMCOT",x.IMCOTH="IMCOTH",x.IMCSC="IMCSC",x.IMCSCH="IMCSCH",x.IMDIV="IMDIV",x.IMEXP="IMEXP",x.IMLN="IMLN",x.IMLOG="IMLOG",x.IMLOG10="IMLOG10",x.IMLOG2="IMLOG2",x.IMPOWER="IMPOWER",x.IMPRODUCT="IMPRODUCT",x.IMREAL="IMREAL",x.IMSEC="IMSEC",x.IMSECH="IMSECH",x.IMSIN="IMSIN",x.IMSINH="IMSINH",x.IMSQRT="IMSQRT",x.IMSUB="IMSUB",x.IMSUM="IMSUM",x.IMTAN="IMTAN",x.IMTANH="IMTANH",x.OCT2BIN="OCT2BIN",x.OCT2DEC="OCT2DEC",x.OCT2HEX="OCT2HEX",x);let oW=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);let u=F.besseli(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},oH.BESSELI],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);let u=F.besselj(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},oH.BESSELJ],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);let u=F.besselk(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},oH.BESSELK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);let u=F.bessely(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},oH.BESSELY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t,{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=`${s.getValue()}`;return sQ(a)?(t=10===a.length&&"1"===a.substring(0,1)?Number.parseInt(a.substring(1),2)-512:Number.parseInt(a,2),nX.create(t)):ra.create(en.NUM)}},oH.BIN2DEC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return ra.create(en.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0xfffffffe00+Number.parseInt(l.substring(1),2)).toString(16);else if(r=Number.parseInt(l,2).toString(16),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r.toLocaleUpperCase())}},oH.BIN2HEX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return ra.create(en.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0x3ffffe00+Number.parseInt(l.substring(1),2)).toString(8);else if(r=Number.parseInt(l,2).toString(8),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.BIN2OCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?ra.create(en.NUM):nX.create(a&o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITAND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return ra.create(en.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)<<BigInt(o):BigInt(a)>>BigInt(-o));return l>0xffffffffffff?ra.create(en.NUM):nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITLSHIFT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff)return ra.create(en.NUM);let l=Number(BigInt(a)|BigInt(o));return nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITOR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return ra.create(en.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)>>BigInt(o):BigInt(a)<<BigInt(-o));return l>0xffffffffffff?ra.create(en.NUM):nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITRSHIFT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?ra.create(en.NUM):nX.create(a^o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITXOR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sG(e,t,null!=r?r:nK.create("i"));if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=`${l.getValue()}`;if(Number.isNaN(u)||Number.isNaN(c)||"i"!==h&&"j"!==h)return ra.create(en.VALUE);let d=o$.getComplex(u,c,h);return"number"==typeof d?nX.create(d):nK.create(d)}},oH.COMPLEX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3),Z(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ngstrm","",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ngstrm","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,0x17a9e9bc0],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,0x219c7bf72246c0],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,0x11de784a],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestrke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ngstrm","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,0x1e187e0]]),Z(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,0x10000000000,"Ti","tera"],Gi:["gibi",30,0x40000000,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),Z(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sG(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=`${l.getValue()}`,d=`${u.getValue()}`;if(Number.isNaN(c))return ra.create(en.VALUE);let m,g=1,f,p=1,{_from:C,_to:_}=this._lookupFromAndToUnits(h,d);if(m=C,f=_,null===m){let{_from:e,_fromMultiplier:t}=this._lookupFromPrefix(h);m=e,g=t}if(null===f){let{_to:e,_toMultiplier:t}=this._lookupToPrefix(d);f=e,p=t}return null===m||null===f||m[3]!==f[3]?ra.create(en.NA):(n="temperature"===m[3]?+(n=this._getTemperatureConversion(c,m[1],f[1])).toFixed(2):c*m[6]*g/(f[6]*p),nX.create(n))}_lookupFromAndToUnits(e,t){let r=null,n=null,i;for(let s=0;s<this._units.length;s++)i=null===this._units[s][2]?[]:this._units[s][2],(this._units[s][1]===e||i.indexOf(e)>=0)&&(r=this._units[s]),(this._units[s][1]===t||i.indexOf(t)>=0)&&(n=this._units[s]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return 9*e/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return 4*e/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return 9*e/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return 5*e/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return 5*e/4;case"F":return 9*e/4+32;case"K":return 5*e/4+273.15;case"Rank":return 9*e/4+491.67;default:return e}}},oH.CONVERT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ra.create(en.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${l}`)||l<-512||l>511)return ra.create(en.NUM);if(l<0){let e=(512+l).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=Number.parseInt(`${l}`,10).toString(2),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.DEC2BIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ra.create(en.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${l}`)||l<-0x8000000000||l>0x7fffffffff)return ra.create(en.NUM);if(l<0)r=(0x10000000000+l).toString(16);else if(r=Number.parseInt(`${l}`,10).toString(16),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r.toLocaleUpperCase())}},oH.DEC2HEX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ra.create(en.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${l}`)||l<-0x20000000||l>0x1fffffff)return ra.create(en.NUM);if(l<0)r=(0x40000000+l).toString(8);else if(r=Number.parseInt(`${l}`,10).toString(8),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.DEC2OCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,null!=t?t:nX.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?ra.create(en.VALUE):nX.create(+(o===l))}},oH.DELTA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(t){let{isError:n,errorObject:i,variants:s}=sG(e,t);if(n)return i;let[a,o]=s,l=+a.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ra.create(en.VALUE);r=s0(u)-s0(l)}else{let{isError:t,errorObject:n,variants:i}=sG(e);if(t)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return ra.create(en.VALUE);r=s0(a)}return nX.create(r)}},oH.ERF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ra.create(en.VALUE);let a=s0(s);return nX.create(a)}},oH.ERF_PRECISE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ra.create(en.VALUE);let a=1-s0(s);return nX.create(a)}},oH.ERFC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ra.create(en.VALUE);let a=1-s0(s);return nX.create(a)}},oH.ERFC_PRECISE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,null!=t?t:nX.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?ra.create(en.VALUE):nX.create(+(o>=l))}},oH.GESTEP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sJ(l))return ra.create(en.NUM);let u=10===l.length&&"F"===l.substring(0,1).toLocaleUpperCase(),c=u?Number.parseInt(l,16)-0x10000000000:Number.parseInt(l,16);if(c<-512||c>511)return ra.create(en.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.HEX2BIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sJ(s))return ra.create(en.NUM);let a=Number.parseInt(s,16);return a>=0x8000000000&&(a-=0x10000000000),nX.create(a)}},oH.HEX2DEC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sJ(l))return ra.create(en.NUM);let u=Number.parseInt(l,16);if(u>0x1fffffff&&u<0xffe0000000)return ra.create(en.NUM);if(u>=0xffe0000000)r=(u-0xffc0000000).toString(8);else if(r=u.toString(8),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.HEX2OCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Abs();return nX.create(a)}},oH.IMABS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.getINum();return nX.create(a)}},oH.IMAGINARY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);if(0===s.getRealNum()&&0===s.getINum())return ra.create(en.DIV_BY_ZERO);let a=s.Argument();return nX.create(a)}},oH.IMARGUMENT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Conjugate();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCONJUGATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Cos();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCOS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Cosh();return s.isError()?ra.create(en.NUM):"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCOSH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Cot();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCOT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Coth();return s.isError()?ra.create(en.NUM):"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCOTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Csc();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCSC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Csch();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMCSCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c)||0===c.getRealNum()&&0===c.getINum())return ra.create(en.NUM);let h=u.Div(c);return"number"==typeof h||(0,B.isRealNum)(h)?nX.create(+h):nK.create(h)}},oH.IMDIV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Exp();return s.isError()?ra.create(en.NUM):"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMEXP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Ln();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMLN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=null!=t?t:nX.create(10);if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);a=a.get(0,0)}let{isError:o,errorObject:l,variants:u}=sz(a);if(o)return l;let[c]=u,h=`${s.getValue()}`,d=+c.getValue(),m=new o$(h);if(m.isError()||0===m.getRealNum()&&0===m.getINum()||d<=0)return ra.create(en.NUM);let g=m.Log(d);return m.isError()?ra.create(en.NUM):"number"==typeof g||(0,B.isRealNum)(g)?nX.create(+g):nK.create(g)}},oH.IMLOG],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Log(10);return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMLOG10],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ra.create(en.NUM);let a=s.Log(2);return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMLOG2],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=new o$(`${s.getValue()}`);if(o.isError())return ra.create(en.NUM);let l=+a.getValue();if(Number.isNaN(l))return ra.create(en.VALUE);let u=o.Power(l);return o.isError()?ra.create(en.NUM):"number"==typeof u||(0,B.isRealNum)(u)?nX.create(+u):nK.create(u)}},oH.IMPOWER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof ra)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof ra)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof ra?t:"number"==typeof t||(0,B.isRealNum)(t)?nX.create(+t):nK.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return ra.create(en.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return ra.create(en.NUM);if(e.isDifferentSuffixes(i))return ra.create(en.VALUE);r=e.Product(i)}else{let e=new o$(n);if(e.isError())return ra.create(en.NUM);r=e.toString()}return r}},oH.IMPRODUCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.getRealNum();return nX.create(a)}},oH.IMREAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Sec();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMSEC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Sech();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMSECH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Sin();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMSIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Sinh();return s.isError()?ra.create(en.NUM):"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMSINH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);if(0===s.getRealNum()&&0===s.getINum())return nX.create(0);let a=s.Sqrt();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMSQRT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c))return ra.create(en.NUM);let h=u.Sub(c);return"number"==typeof h||(0,B.isRealNum)(h)?nX.create(+h):nK.create(h)}},oH.IMSUB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof ra)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof ra)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof ra?t:"number"==typeof t||(0,B.isRealNum)(t)?nX.create(+t):nK.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return ra.create(en.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return ra.create(en.NUM);if(e.isDifferentSuffixes(i))return ra.create(en.VALUE);r=e.Sum(i)}else{let e=new o$(n);if(e.isError())return ra.create(en.NUM);r=e.toString()}return r}},oH.IMSUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Tan();return"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMTAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ra.create(en.NUM);let a=s.Tanh();return s.isError()?ra.create(en.NUM):"number"==typeof a||(0,B.isRealNum)(a)?nX.create(+a):nK.create(a)}},oH.IMTANH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return ra.create(en.NUM);let u=10===l.length&&"7"===l.substring(0,1),c=u?Number.parseInt(l,8)-0x40000000:Number.parseInt(l,8);if(c<-512||c>511)return ra.create(en.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r)}},oH.OCT2BIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sG(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sZ(s))return ra.create(en.NUM);let a=Number.parseInt(s,8);return a>=0x20000000&&(a-=0x40000000),nX.create(a)}},oH.OCT2DEC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ra.create(en.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sG(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ra.create(en.VALUE);if(n<0||n>10)return ra.create(en.NUM)}let{isError:i,errorObject:s,variants:a}=sG(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return ra.create(en.NUM);let u=Number.parseInt(l,8);if(u>=0x20000000)r=`ff${(u+0xc0000000).toString(16)}`;else if(r=u.toString(16),t){if(n<r.length)return ra.create(en.NUM);r="0".repeat(n-r.length)+r}return nK.create(r.toLocaleUpperCase())}},oH.OCT2HEX]];var oG=((U=oG||{}).ACCRINT="ACCRINT",U.ACCRINTM="ACCRINTM",U.AMORDEGRC="AMORDEGRC",U.AMORLINC="AMORLINC",U.COUPDAYBS="COUPDAYBS",U.COUPDAYS="COUPDAYS",U.COUPDAYSNC="COUPDAYSNC",U.COUPNCD="COUPNCD",U.COUPNUM="COUPNUM",U.COUPPCD="COUPPCD",U.CUMIPMT="CUMIPMT",U.CUMPRINC="CUMPRINC",U.DB="DB",U.DDB="DDB",U.DISC="DISC",U.DOLLARDE="DOLLARDE",U.DOLLARFR="DOLLARFR",U.DURATION="DURATION",U.EFFECT="EFFECT",U.FV="FV",U.FVSCHEDULE="FVSCHEDULE",U.INTRATE="INTRATE",U.IPMT="IPMT",U.IRR="IRR",U.ISPMT="ISPMT",U.MDURATION="MDURATION",U.MIRR="MIRR",U.NOMINAL="NOMINAL",U.NPER="NPER",U.NPV="NPV",U.ODDFPRICE="ODDFPRICE",U.ODDFYIELD="ODDFYIELD",U.ODDLPRICE="ODDLPRICE",U.ODDLYIELD="ODDLYIELD",U.PDURATION="PDURATION",U.PMT="PMT",U.PPMT="PPMT",U.PRICE="PRICE",U.PRICEDISC="PRICEDISC",U.PRICEMAT="PRICEMAT",U.PV="PV",U.RATE="RATE",U.RECEIVED="RECEIVED",U.RRI="RRI",U.SLN="SLN",U.SYD="SYD",U.TBILLEQ="TBILLEQ",U.TBILLPRICE="TBILLPRICE",U.TBILLYIELD="TBILLYIELD",U.VDB="VDB",U.XIRR="XIRR",U.XNPV="XNPV",U.YIELD="YIELD",U.YIELDDISC="YIELDDISC",U.YIELDMAT="YIELDMAT",U);function oY(e,t,r,n){let{days:i}=oU(oK(e,t,r),e,n);return i}function oz(e,t,r,n){let i;if(1===n){let n=oK(e,t,r),s=oR(n),a=o_(s=oF(s,12/r));i=n<0&&1===r?365:a-n}else i=3===n?365/r:360/r;return i}function oX(e,t,r){let n=oR(e),i=oR(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=oF(i,-12/r);return o_(i=oF(i,12/r))}function oq(e,t,r){let n=0,i=oR(e),s=oR(t);for(;s>i;)s=oF(s,-12/r),n++;return n}function oK(e,t,r){let n=oR(e),i=oR(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=oF(i,-12/r);return o_(i)}function oQ(e,t,r,n,i,s){let a=oY(e,t,i,s),o=oz(e,t,i,s),l=oq(e,t,i),u=(o-a)/o-1,c=n/i+1,h=100*r/i,d=0,m=0;for(let e=1;e<=l;e++){let t=e+u,r=h/c**t;d+=t*r,m+=r}let g=l+u,f=100/c**g;return(d+=g*f)/(m+=f)/i}function oZ(e,t,r,n,i){let s;if(0===e)s=(r+n)/t;else{let a=(1+e)**t;s=1===i?(n*e/(a-1)+r*e/(1-1/a))/(1+e):n*e/(a-1)+r*e/(1-1/a)}return-s}function oJ(e,t,r,n,i){let s;if(0===e)s=n+r*t;else{if(-1===e&&0===t)return NaN;let a=(1+e)**t;s=1===i?n*a+r*(1+e)*(a-1)/e:n*a+r*(a-1)/e}return-s}function o0(e,t,r,n,i,s){let a=oZ(e,r,n,i,s);return(1===t?1===s?0:-n:1===s?oJ(e,t-2,a,n,1)-a:oJ(e,t-1,a,n,0))*e}function o1(e,t){let r=0;for(let n=1;n<=t.length;n++)r+=t[n-1]/(1+e)**n;return r}function o2(e,t,r,n,i,s,a,o,l){let u=o5(r,n,l),c=oz(e,n,o,l);return u<c?function(e,t,r,n,i,s,a,o,l,u,c){let h=0,d=oq(e,t,o),m=o5(e,n,l);h+=a/(1+s/o)**(d-1+m/c)+100*i/o*u/c/(1+s/o)**(m/c);for(let e=2;e<=d;e++)h+=100*i/o/(1+s/o)**(e-1+m/c);return h-100*i/o*o5(r,e,l)/c}(e,t,r,n,i,s,a,o,l,u,c):function(e,t,r,n,i,s,a,o,l,u){let c,h=0,d=oq(n,t,o),m=function(e,t,r,n){let i=oR(e),s=oR(t),a=i.getUTCFullYear(),o=i.getUTCMonth(),l=i.getUTCDate(),u=s.getUTCFullYear(),c=s.getUTCMonth(),h=s.getUTCDate(),d=oL(a,o)===l,m=!d&&1!==o&&l>28&&l<oL(a,o)?oL(u,c)===h:d,g=o6(t,0,m),f=1+ +(t<g),p=o6(g,r,m);for(;!(r>0?p>=t:p<=t);)p=o6(p,r,m),f++;return f}(n,e,12/o);if(2===l||3===l){let t=oX(e,n,o);c=o5(e,t,l)}else{let{days:t}=oU(oK(e,n,o),e,l);c=u-t}h+=a/(1+s/o)**(d+m+c/u);let g=oq(r,n,o),f=n,p=0,C=0;for(let t=g;t>=1;t--){let n=o6(f,-12/o,!1),i=1===l?o5(n,f,l):u;p+=(t>1?i:o5(r,f,l))/i,C+=o5(r>n?r:n,e<f?e:f,l)/i,f=n}h+=100*i/o*p/(1+s/o)**(m+c/u);for(let e=1;e<=d;e++)h+=100*i/o/(1+s/o)**(e+m+c/u);return h-100*i/o*C}(e,t,r,n,i,s,a,o,l,c)}function o5(e,t,r){let{days:n}=oU(e,t,r);return e<t?n:0}function o3(e,t,r){let n=oR(e),i=n.getUTCFullYear(),s=n.getUTCMonth(),a=n.getUTCDate(),o=oL(i,s)===a,l=oR(t),u=l.getUTCFullYear(),c=l.getUTCMonth(),h=l.getUTCDate(),d=oL(u,c)===h;return!(a!==h&&!(o&&d)||Math.abs((u-i)*12+(c-s))%(12/r)!=0)}function o4(e,t,r){return oK(e,t,r)>=0}function o6(e,t,r){let n=oR(e);if(n=oF(n,t),r){let e=oL(n.getUTCFullYear(),n.getUTCMonth());n.setUTCDate(e)}return o_(n)}function o9(e,t){let r=1,n=0,i=e,s;for(;r>1e-7&&n<500;){let e=(t(i+1e-7)-t(i-1e-7))/2e-7;s=i-t(i)/e,n++,r=Math.abs(s-i),i=s}return Number.isNaN(i)||Math.abs(i)===1/0||500===n?function(e,t){let r,n,i=Number.MAX_VALUE,s=e-.01<=-1?-1+1e-7:e-.01,a=e+.01>=i?i-1e-7:e+.01,o,l,u=0;if(e<=-1||e>=i)return ra.create(en.NUM);for(let e=0;e<60;e++){o=s<=-1?-1+1e-7:s,l=a>=i?i-1e-7:a;let r=t(o),n=t(l);if(r*n<=0)break;if(!(r*n>0))return ra.create(en.NUM);if(s=o+1.6*(o-l),a=l+1.6*(l-o),59===e)return ra.create(en.NUM)}let c=t(o),h=t(l);if(1e-7>Math.abs(c)||1e-7>Math.abs(h))return ra.create(en.NUM);do c*(r=t(n=o+(l-o)/2))<0?l=n:o=n,c=t(o),u++;while(Math.abs(r)>1e-7&&u<60)return n}(e,t):i}function o8(e,t,r,n,i,s,a){let o=oq(e,t,s),l=oz(e,t,s,a),u=oY(e,t,s,a);if(1===o)return(100*r/s+i)/(n/s*(l-u)/l+1)-100*r/s*u/l;let c=l-u,h=i/(1+n/s)**(o-1+c/l);for(let e=1;e<=o;e++)h+=100*r/s/(1+n/s)**(e-1+c/l);return h-100*r/s*u/l}function o7(e,t,r,n,i){let s=0,a=i/r;a>=1?(a=1,s=1===n?e:0):s=e*(1-a)**(n-1);let o=e*(1-a)**n,l=0;return(l=o<t?s-t:s-o)<0&&(l=0),l}let le=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=a?a:nX.create(0),u=null!=o?o:nz.create(!0),{isError:c,errorObject:h,variants:d}=sG(e,t,r,n,i,s,l);if(c)return h;let[m,g,f,p,C,_,y]=d,R=oO(m);if("number"!=typeof R)return R;let E=oO(g);if("number"!=typeof E)return E;let b=oO(f);if("number"!=typeof b)return b;let I=+p.getValue(),N=+C.getValue(),S=Math.floor(+_.getValue()),A=Math.floor(+y.getValue()),v=+u.getValue();return Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v)?ra.create(en.VALUE):I<=0||N<=0||![1,2,4].includes(S)||A<0||A>4||Math.floor(R)>=Math.floor(b)?ra.create(en.NUM):this._getResult(R,E,b,I,N,S,A,v)}_getResult(e,t,r,n,i,s,a,o){let l=oK(e,t,s);if(l<=0)return nX.create(0);l=oK(r,t,s);let u=12/s,c=oR(t),h=c.getUTCFullYear(),d=c.getUTCMonth(),m=c.getUTCDate(),g=oL(h,d)===m,f=o6(t,-u,g);if(r>t&&o)for(f=t;f<r;)f=o6(f,u,g);let p=e>f?e:f,{days:C}=oU(p,r,a);if(l>=e){let{days:e}=oU(p,r,4*!!a);C=e}r<p&&(C=-C);let _=oz(f,t,s,a),y=C/_,R=f,E=e;for(;R>e;){E=R;let{days:t}=oU(p=e>(R=o6(R,-u,g))?e:R,E,a);if(0===a)C=E>=p||e<=R?t:-t,_=oz(R,E,s,a);else if(C=E<p?-t:t,3===a)_=365/s;else{let{days:e}=oU(R,E,a);_=E<R?-e:e}y+=e<=R?+!!o:C/_}let b=i*n/s*y;return nX.create(b)}},oG.ACCRINT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nX.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ra.create(en.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>Math.floor(g))return ra.create(en.NUM);if(Math.floor(m)===Math.floor(g))return nX.create(0);let{days:_,yearDays:y}=oU(m,g,C);return nX.create(p*f*_/y)}},oG.ACCRINTM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,s,null!=a?a:nX.create(0));if(o)return l;let[c,h,d,m,g,f,p]=u,C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+c.getValue(),R=+m.getValue(),E=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue());return Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(I)?ra.create(en.VALUE):y<=0||R<0||y<R||Math.floor(C)>Math.floor(_)||E<0||b<=0||![0,1,3,4].includes(I)?ra.create(en.NUM):(E=E>1?Math.floor(E):Math.ceil(E),this._getResult(y,C,_,R,E,b,I))}_getResult(e,t,r,n,i,s,a){let o=e-n,l=e*s,{days:u,yearDays:c}=oU(t,r,a),h=u/c,d=Math.ceil(o/l-h);if(d<0)return nX.create(0);let m=l;return 0===i?m=l*h:i===d?m=o-l*(h+i-1):i>d&&(m=0),nX.create(m)}},oG.AMORLINC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ra.create(en.NUM);let f=oY(h,d,m,g);return nX.create(f)}},oG.COUPDAYBS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ra.create(en.NUM);let f=oz(h,d,m,g);return nX.create(f)}},oG.COUPDAYS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ra.create(en.NUM);let f=oR(h),p=oR(d);for(p.setUTCFullYear(f.getUTCFullYear()),p<f&&p.setUTCFullYear(p.getUTCFullYear()+1);p>f;)p.setUTCMonth(p.getUTCMonth()-12/m);p.setUTCMonth(p.getUTCMonth()+12/m);let{days:C}=oU(h,o_(p),g);return nX.create(C)}},oG.COUPDAYSNC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ra.create(en.NUM);let f=oX(h,d,m);return nX.create(f)}},oG.COUPNCD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d)||0>oK(h,d,m))return ra.create(en.NUM);let f=oq(h,d,m);return nX.create(f)}},oG.COUPNUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sG(e,t,r,null!=n?n:nX.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ra.create(en.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ra.create(en.NUM);let f=oK(h,d,m);return f<0&&(f=0),nX.create(f)}},oG.COUPPCD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),R=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(R)?ra.create(en.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||_>p||y>p||![0,1].includes(R)?ra.create(en.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nX.create(0):this._getResult(f,p,C,_,y,R)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(0===s&&(o=-r),l++);let u=!1;for(let t=l;t<=i;t++){let n=1===s?oJ(e,t-2,a,r,1):oJ(e,t-1,a,r,0);if(0===n){u=!0;break}o+=1===s?n-a:n}return((o*=e)<a*(i-n+1)||u)&&(o=a*(i-n+1)),nX.create(o)}},oG.CUMIPMT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),R=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(R)?ra.create(en.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||![0,1].includes(R)?ra.create(en.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nX.create(0):this._getResult(f,p,C,_,y,R)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(o=0===s?a+r*e:a,l++);for(let t=l;t<=i;t++)o+=1===s?a-(oJ(e,t-2,a,r,1)-a)*e:a-oJ(e,t-1,a,r,0)*e;return nX.create(o)}},oG.CUMPRINC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nX.create(12);s.isNull()&&(s=nX.create(12));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=ie(a,o,e,ra.create(en.NA)),u=ie(a,o,t,ra.create(en.NA)),c=ie(a,o,r,ra.create(en.NA)),h=ie(a,o,n,ra.create(en.NA)),d=ie(a,o,s,ra.create(en.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),i=c.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,h.get(t,r),d.get(t,r));if(s)return a;let[l,m,g,f,p]=o,C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),R=+f.getValue(),E=Math.floor(+p.getValue());return C<0||_<0||y<=0||R<=0||Math.floor(R)>Math.floor(y)||E<1||E>12?ra.create(en.NUM):(R<1&&(R=1),R=Math.floor(R),this._getResult(C,_,y,R,E,t,r))});return 1===a&&1===o?m.get(0,0):m}_getResult(e,t,r,n,i,s,a){let o,l=+(1-(t/e)**(1/r)).toFixed(3),u=e*l*i/12,c=u,h=0,d=n===r?r-1:n;for(let t=2;t<=d;t++)h=(e-c)*l,c+=h;return Number.isNaN(o=1===n?u:n===r?(e-c)*l:h)||!Number.isFinite(o)?ra.create(en.NUM):0===s&&0===a?nX.create(o,re(this.getLocale())):nX.create(o)}},oG.DB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nX.create(2);s.isNull()&&(s=nX.create(2));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=ie(a,o,e,ra.create(en.NA)),u=ie(a,o,t,ra.create(en.NA)),c=ie(a,o,r,ra.create(en.NA)),h=ie(a,o,n,ra.create(en.NA)),d=ie(a,o,s,ra.create(en.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),i=c.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,h.get(t,r),d.get(t,r));if(s)return a;let[l,m,g,f,p]=o,C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),R=+f.getValue(),E=+p.getValue();if(C<0||_<0||y<=0||R<=0||R>y||E<=0)return ra.create(en.NUM);let b=o7(C,_,y,R,E);return Number.isNaN(b)||!Number.isFinite(b)?ra.create(en.NUM):0===t&&0===r?nX.create(b,re(this.getLocale())):nX.create(b)});return 1===a&&1===o?m.get(0,0):m}},oG.DDB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nX.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ra.create(en.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return ra.create(en.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nX.create((p-f)/p*(y/_))}},oG.DISC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);if(l>=0&&l<1)return ra.create(en.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);u+=o%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;let c=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return u=Math.round(u*c)/c,nX.create(u)}},oG.DOLLARDE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(l<0)return ra.create(en.NUM);if(l>=0&&l<1)return ra.create(en.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);return u+=o%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,nX.create(u)}},oG.DOLLARFR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nX.create(0);a.isNull()&&(a=nX.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),R=Math.floor(+g.getValue()),E=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(E))return ra.create(en.VALUE);if(_<0||y<0||![1,2,4].includes(R)||E<0||E>4||Math.floor(p)>=Math.floor(C)||p<=0||C<=366)return ra.create(en.NUM);let b=oQ(p,C,_,y,R,E);return nX.create(b)}},oG.DURATION],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(o<=0||l<1)return ra.create(en.NUM);l=Number.parseInt(`${l}`,10);let u=(1+o/l)**l-1;return nX.create(u)}},oG.EFFECT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),R=oJ(C,_,y,+f.getValue(),+!!+p.getValue());return Number.isNaN(R)||!Number.isFinite(R)?ra.create(en.NUM):0===t&&0===r?nX.create(R,re(this.getLocale())):nX.create(R)});return 1===o&&1===l?g.get(0,0):g}},oG.FV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e);if(r)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return ra.create(en.VALUE);let o=a;if(t.isArray()){let e=t.getArrayValue().flat();for(let t=0;t<e.length;t++){let r=e[t];if(r.isBoolean())return ra.create(en.VALUE);let n=+r.getValue();if(Number.isNaN(n))return ra.create(en.VALUE);o*=1+n}}else{if(t.isBoolean())return ra.create(en.VALUE);let e=+t.getValue();if(Number.isNaN(e))return ra.create(en.VALUE);o*=1+e}return nX.create(o)}},oG.FVSCHEDULE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sG(e,t,r,n,null!=i?i:nX.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ra.create(en.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return ra.create(en.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nX.create((p-f)/f*(y/_))}},oG.INTRATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",6),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nX.create(0),o=null!=s?s:nX.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,e,ra.create(en.NA)),h=ie(l,u,t,ra.create(en.NA)),d=ie(l,u,r,ra.create(en.NA)),m=ie(l,u,n,ra.create(en.NA)),g=ie(l,u,a,ra.create(en.NA)),f=ie(l,u,o,ra.create(en.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),{isError:a,errorObject:o,variants:l}=sz(e,n,i,s,g.get(t,r),f.get(t,r));if(a)return o;let[u,c,p,C,_,y]=l,R=+u.getValue(),E=+c.getValue(),b=+p.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();if(E<1||Math.floor(E)>Math.ceil(b))return ra.create(en.NUM);let A=o0(R,E,b,I,N,+!!S);return Number.isNaN(A)||!Number.isFinite(A)?ra.create(en.NUM):0===t&&0===r?nX.create(A,re(this.getLocale())):nX.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.IPMT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(.1);return r.isNull()&&(r=nX.create(.1)),r.isArray()?r.map((t,r,n)=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return ra.create(en.VALUE);if(!e.isArray())return ra.create(en.NUM);let{_values:i,valuesHasError:s}=this._getValues(e);if(s)return ra.create(en.VALUE);let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()).isError())return a;let o=+a.getValue(),{positive:l,negative:u}=this._checkValues(i);if(!l||!u)return ra.create(en.NUM);let c=o9(o,e=>o1(e,i));return"number"!=typeof c?c:0===r&&0===n?nX.create(c,"0%"):nX.create(c)}_getValues(e){let t=[],r=!1;return e.iterator(e=>{if(e.isError())return r=!0,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;t.push(n)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}},oG.IRR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.map((e,t,r)=>{let n=o.get(t,r),{isError:i,errorObject:s,variants:a}=sz(e,n,l.get(t,r),u.get(t,r));if(i)return s;let[c,h,d,m]=a,g=+c.getValue(),f=+h.getValue(),p=+d.getValue(),C=+m.getValue();return 0===p?ra.create(en.DIV_BY_ZERO):nX.create(C*g*(f/p-1))});return 1===i&&1===s?c.get(0,0):c}},oG.ISPMT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nX.create(0);a.isNull()&&(a=nX.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),R=Math.floor(+g.getValue()),E=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(E))return ra.create(en.VALUE);if(_<0||y<0||![1,2,4].includes(R)||E<0||E>4||Math.floor(p)>=Math.floor(C))return ra.create(en.NUM);let b=oQ(p,C,_,y,R,E);return b/=1+y/R,nX.create(b)}},oG.MDURATION],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{_values:n,numberValues:i,positive:s,negative:a}=this._getValues(e),o=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=ie(o,l,t,ra.create(en.NA)),c=ie(o,l,r,ra.create(en.NA)),h=u.map((t,r,o)=>{let l=c.get(r,o);if(e.isError())return e;if(l.isError())return l;if(n.isError())return n;if(!s||!a)return ra.create(en.DIV_BY_ZERO);let u=+t.getValue(),h=+l.getValue();if(Number.isNaN(u)||Number.isNaN(h))return ra.create(en.VALUE);if(-1===h)return ra.create(en.DIV_BY_ZERO);let d=this._getResult(i,u,h);return 0===r&&0===o?nX.create(d,"0%"):nX.create(d)});return 1===o&&1===l?h.get(0,0):h}_getValues(e){let t=e,r=[],n=!1,i=!1;if(!e.isError())if(e.isNull())t=ra.create(en.VALUE);else if(e.isArray()){let{numberValues:s,valuesHasError:a,errorObject:o,positive:l,negative:u}=this._checkValues(e);a&&(t=o),r=s,n=l,i=u}else t=ra.create(en.DIV_BY_ZERO);return{_values:t,numberValues:r,positive:n,negative:i}}_checkValues(e){let t=[],r=!1,n=ra.create(en.VALUE),i=!1,s=!1;return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return!0;let a=+e.getValue();if(Number.isNaN(a))return!0;a>0&&(i=!0),a<0&&(s=!0),t.push(a)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:i,negative:s}}_getResult(e,t,r){let n=e.length,i=[],s=[];for(let t=0;t<n;t++)e[t]>0?s.push(e[t]):e[t]<0&&i.push(e[t]);let a=this._npv(r,e,"positive"),o=this._npv(t,e,"negative"),l=-a*(1+r)**n,u=o*(1+t);return(l/u)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let i=1;i<=t.length;i++){let s=t[i-1];("positive"===r&&s>0||"negative"===r&&s<0)&&(n+=s/(1+e)**i)}return n}},oG.MIRR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(o<=0||l<1)return ra.create(en.NUM);l=Number.parseInt(`${l}`,10);let u=((o+1)**(1/l)-1)*l;return nX.create(u)}},oG.NOMINAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.map((e,t,r)=>{let n,i=c.get(t,r),s=h.get(t,r),{isError:a,errorObject:o,variants:l}=sz(e,i,s,d.get(t,r),m.get(t,r));if(a)return o;let[u,g,f,p,C]=l,_=+u.getValue(),y=+g.getValue(),R=+f.getValue(),E=+p.getValue(),b=+C.getValue();return(b=+!!b,0===_&&0===y)?ra.create(en.DIV_BY_ZERO):Number.isNaN(n=0===_?-(R+E)/y:Math.log((y*(1+_*b)-E*_)/(R*_+y*(1+_*b)))/Math.log(1+_))||!Number.isFinite(n)?ra.create(en.NUM):nX.create(n)});return 1===o&&1===l?g.get(0,0):g}},oG.NPER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255),Z(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;let{isError:r,errorObject:n,values:i}=this._getValues(t);return e.isArray()?e.map((e,t,s)=>this._handleSingleObject(e,r,n,i,t,s)):this._handleSingleObject(e,r,n,i)}_handleSingleObject(e,t,r,n,i=0,s=0){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(t)return r;let o=o1(+e.getValue(),n);return Number.isNaN(o)||Math.abs(o)===1/0?ra.create(en.DIV_BY_ZERO):0===i&&0===s?nX.create(o,re(this.getLocale())):nX.create(o)}_getValues(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let e=!1,r=ra.create(en.VALUE);if(n.iterator(n=>{if(n.isError())return e=!0,r=n,!1;if(n.isNull()||n.isBoolean())return!0;let i=+n.getValue();if(Number.isNaN(i))return!0;t.push(i)}),e)return{isError:e,errorObject:r}}else{let e=+n.getValue();if(Number.isNaN(e))return{isError:!0,errorObject:ra.create(en.VALUE)};t.push(e)}}return{isError:!1,values:t}}},oG.NPV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",8),Z(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nX.create(0);u.isNull()&&(u=nX.create(0));let{isError:c,errorObject:h,variants:d}=sY(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,R,E]=d,b=oO(m);if("number"!=typeof b)return b;let I=oO(g);if("number"!=typeof I)return I;let N=oO(f);if("number"!=typeof N)return N;let S=oO(p);if("number"!=typeof S)return S;let A=+C.getValue(),v=+_.getValue(),T=+y.getValue(),w=Math.floor(+R.getValue()),M=Math.floor(+E.getValue());if(Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(T)||Number.isNaN(w)||Number.isNaN(M))return ra.create(en.VALUE);if(A<0||v<0||T<=0||![1,2,4].includes(w)||M<0||M>4||!this._validDate(I,S,b,N,w))return ra.create(en.NUM);let O=o2(b,I,N,S,A,v,T,w,M);return nX.create(O)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}},oG.ODDFPRICE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",8),Z(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nX.create(0);u.isNull()&&(u=nX.create(0));let{isError:c,errorObject:h,variants:d}=sY(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,R,E]=d,b=oO(m);if("number"!=typeof b)return b;let I=oO(g);if("number"!=typeof I)return I;let N=oO(f);if("number"!=typeof N)return N;let S=oO(p);if("number"!=typeof S)return S;let A=+C.getValue(),v=+_.getValue(),T=+y.getValue(),w=Math.floor(+R.getValue()),M=Math.floor(+E.getValue());return Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(T)||Number.isNaN(w)||Number.isNaN(M)?ra.create(en.VALUE):A<0||v<=0||T<=0||![1,2,4].includes(w)||M<0||M>4||!this._validDate(I,S,b,N,w)?ra.create(en.NUM):this._getResult(b,I,N,S,A,v,T,w,M)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,i,s,a,o,l){let{days:u}=oU(e,t,l),c=o9((i*u*100-(s-100))/((s-100)*.25*(1+2*u)+100*u),u=>s-o2(e,t,r,n,i,u,a,o,l));return"number"!=typeof c?c:nX.create(c)}},oG.ODDFYIELD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",7),Z(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nX.create(0);l.isNull()&&(l=nX.create(0));let{isError:u,errorObject:c,variants:h}=sY(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,R=oO(d);if("number"!=typeof R)return R;let E=oO(m);if("number"!=typeof E)return E;let b=oO(g);if("number"!=typeof b)return b;let I=+f.getValue(),N=+p.getValue(),S=+C.getValue(),A=Math.floor(+_.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v))return ra.create(en.VALUE);if(I<0||N<0||S<=0||![1,2,4].includes(A)||v<0||v>4||!this._validDate(E,R,b,A))return ra.create(en.NUM);let T=this._getResult(R,E,b,I,N,S,A,v);return nX.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(s*a+100*n*(c-u*(1+i*h/a)))/(i*h+a)}_getCoupDate(e,t,r){let n=oR(e),i=oR(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return o_(i)}_getFrac(e,t,r,n,i){let s=oR(e),a=oR(t),o=oR(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=o_(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=o_(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oR(u),m=oR(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=o_(d),u=o_(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLPRICE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",8),Z(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nX.create(0);l.isNull()&&(l=nX.create(0));let{isError:u,errorObject:c,variants:h}=sY(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,R=oO(d);if("number"!=typeof R)return R;let E=oO(m);if("number"!=typeof E)return E;let b=oO(g);if("number"!=typeof b)return b;let I=+f.getValue(),N=+p.getValue(),S=+C.getValue(),A=Math.floor(+_.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v))return ra.create(en.VALUE);if(I<0||N<=0||S<=0||![1,2,4].includes(A)||v<0||v>4||!this._validDate(E,R,b,A))return ra.create(en.NUM);let T=this._getResult(R,E,b,I,N,S,A,v);return nX.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(a*(s-i)+100*n*(c-u))/(h*i+100*n*u*h/a)}_getCoupDate(e,t,r){let n=oR(e),i=oR(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return o_(i)}_getFrac(e,t,r,n,i){let s=oR(e),a=oR(t),o=oR(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=o_(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=o_(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oR(u),m=oR(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=o_(d),u=o_(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLYIELD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sz(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=-1)return ra.create(en.NUM);let g=(Math.log(m)-Math.log(d))/Math.log(1+h);return Number.isNaN(g)||!Number.isFinite(g)?ra.create(en.NUM):nX.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.PDURATION],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),R=+f.getValue(),E=+p.getValue();if(C<=-1)return ra.create(en.NUM);let b=oZ(C,_,y,R,+!!E);return Number.isNaN(b)||!Number.isFinite(b)?ra.create(en.NUM):0===t&&0===r?nX.create(b,re(this.getLocale())):nX.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PMT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",6),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nX.create(0),o=null!=s?s:nX.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,e,ra.create(en.NA)),h=ie(l,u,t,ra.create(en.NA)),d=ie(l,u,r,ra.create(en.NA)),m=ie(l,u,n,ra.create(en.NA)),g=ie(l,u,a,ra.create(en.NA)),f=ie(l,u,o,ra.create(en.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),{isError:a,errorObject:o,variants:l}=sz(e,n,i,s,g.get(t,r),f.get(t,r));if(a)return o;let[u,c,p,C,_,y]=l,R=+u.getValue(),E=+c.getValue(),b=+p.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();if(E<1||Math.floor(E)>Math.ceil(b)||E-b>=1)return ra.create(en.NUM);let A=oZ(R,b,I,N,+!!S)-o0(R,E,b,I,N,+!!S);return Number.isNaN(A)||!Number.isFinite(A)?ra.create(en.NUM):0===t&&0===r?nX.create(A,re(this.getLocale())):nX.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.PPMT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nX.create(0);o.isNull()&&(o=nX.create(0));let{isError:l,errorObject:u,variants:c}=sY(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=oO(h);if("number"!=typeof _)return _;let y=oO(d);if("number"!=typeof y)return y;let R=+m.getValue(),E=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue()),N=Math.floor(+C.getValue());if(Number.isNaN(R)||Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(I)||Number.isNaN(N))return ra.create(en.VALUE);if(R<0||E<0||b<=0||![1,2,4].includes(I)||N<0||N>4||_>=y||!o4(_,y,I))return ra.create(en.NUM);let S=o8(_,y,R,E,b,I,N);return nX.create(S)}},oG.PRICE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nX.create(0);s.isNull()&&(s=nX.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ra.create(en.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ra.create(en.NUM);let{days:y,yearDays:R}=oU(g,f,_);return nX.create(C-p*C*y/R)}},oG.PRICEDISC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nX.create(0);a.isNull()&&(a=nX.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+m.getValue(),R=+g.getValue(),E=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(E))return ra.create(en.VALUE);let b=this._getDateCorrectOrder(C,p,_);if(y<0||R<0||E<0||E>4||!b)return ra.create(en.NUM);let I=ok(p,E),{days:N}=oU(p,C,E),{days:S}=oU(_,C,E),{days:A}=oU(_,p,E),v=(100+S/I*y*100)/(1+N/I*R)-A/I*y*100;return nX.create(v)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.PRICEMAT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nX.create(0),a=null!=i?i:nX.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,e,ra.create(en.NA)),c=ie(o,l,t,ra.create(en.NA)),h=ie(o,l,r,ra.create(en.NA)),d=ie(o,l,s,ra.create(en.NA)),m=ie(o,l,a,ra.create(en.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sz(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),R=+f.getValue(),E=+p.getValue();E=+!!E;let b=0===C?-y*_-R:((1-(1+C)**_)/C*y*(1+C*E)-R)/(1+C)**_;return Number.isNaN(b)||!Number.isFinite(b)?ra.create(en.NUM):0===t&&0===r?nX.create(b,re(this.getLocale())):nX.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=n?n:nX.create(0),o=null!=i?i:nX.create(0),l=null!=s?s:nX.create(.1),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ie(u,c,e,ra.create(en.NA)),d=ie(u,c,t,ra.create(en.NA)),m=ie(u,c,r,ra.create(en.NA)),g=ie(u,c,a,ra.create(en.NA)),f=ie(u,c,o,ra.create(en.NA)),p=ie(u,c,l,ra.create(en.NA)),C=h.map((e,t,r)=>{let n=d.get(t,r),i=m.get(t,r),s=g.get(t,r),{isError:a,errorObject:o,variants:l}=sz(e,n,i,s,f.get(t,r),p.get(t,r));if(a)return o;let[u,c,h,C,_,y]=l,R=+u.getValue(),E=+c.getValue(),b=+h.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();return N=+!!N,R<=0||E>=0?ra.create(en.NUM):this._getResult(R,E,b,I,N,S,t,r)});return 1===u&&1===c?C.get(0,0):C}_getResult(e,t,r,n,i,s,a,o){let l=s;for(let s=0;s<20;s++){let s,a,o;if(l<=-1)return ra.create(en.NUM);if(1e-10>Math.abs(s=1e-10>Math.abs(l)?r*(1+e*l)+t*(1+l*i)*e+n:r*(a=(1+l)**e)+t*(1/l+i)*(a-1)+n))break;if(1e-10>Math.abs(l))o=r*e+t*i*e;else{a=(1+l)**e;let n=e*(1+l)**(e-1);o=r*n+t*(1/l+i)*n+-1/(l*l)*t*(a-1)}l-=s/o}return 0===a&&0===o?nX.create(l,"0%"):nX.create(l)}},oG.RATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nX.create(0);s.isNull()&&(s=nX.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ra.create(en.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ra.create(en.NUM);let{days:y,yearDays:R}=oU(g,f,_),E=p/(1-C*y/R);return E<0?ra.create(en.NUM):nX.create(E)}},oG.RECEIVED],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",6)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sz(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=0)return ra.create(en.NUM);if(0===d&&0===m)return nX.create(0);let g=(m/d)**(1/h)-1;return Number.isNaN(g)||!Number.isFinite(g)||m/d<0?ra.create(en.NUM):nX.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.RRI],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3),Z(this,"needsLocale",!0)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.map((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(n.isError())return n;if(i.isError())return i;let s=+e.getValue(),l=+n.getValue(),u=+i.getValue();if(Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(u))return ra.create(en.VALUE);if(0===u)return ra.create(en.DIV_BY_ZERO);let c=(s-l)/u;return 0===t&&0===r?nX.create(c,re(this.getLocale())):nX.create(c)});return 1===n&&1===i?l.get(0,0):l}},oG.SLN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4),Z(this,"needsLocale",!0)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=+e.getValue(),c=+n.getValue(),h=+i.getValue(),d=+s.getValue();if(Number.isNaN(a)||Number.isNaN(c)||Number.isNaN(h)||Number.isNaN(d))return ra.create(en.VALUE);if(c<0||h<=0||d>h)return ra.create(en.NUM);let m=(a-c)*(h-d+1)*2/(h*(h+1));return 0===t&&0===r?nX.create(m,re(this.getLocale())):nX.create(m)});return 1===i&&1===s?c.get(0,0):c}},oG.SYD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ra.create(en.VALUE);if(h<=0||u>=c)return ra.create(en.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oR(u).getUTCFullYear()))return ra.create(en.NUM);let m=365*h/(360-h*d);if(d>182){let e=d/365;if(Number.isNaN(m=(-e+Math.sqrt(e*e-(2*e-1)*(1-100/(100*(1-h*d/360)))))/(e-.5)))return ra.create(en.NUM)}return m<0?ra.create(en.NUM):nX.create(m)}},oG.TBILLEQ],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3),Z(this,"needsLocale",!0)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ra.create(en.VALUE);if(h<=0||u>=c)return ra.create(en.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oR(u).getUTCFullYear()))return ra.create(en.NUM);let m=100*(1-h*d/360);return m<0?ra.create(en.NUM):nX.create(m,re(this.getLocale()))}},oG.TBILLPRICE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ra.create(en.VALUE);if(h<=0||u>=c)return ra.create(en.NUM);let d=Math.floor(c)-Math.floor(u);return d>oP(oR(u).getUTCFullYear())?ra.create(en.NUM):nX.create((100-h)/h*360/d)}},oG.TBILLYIELD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",7),Z(this,"needsLocale",!0)}calculate(e,t,r,n,i,s,a){let o=null!=s?s:nX.create(2);o.isNull()&&(o=nX.create(2));let l=null!=a?a:nz.create(!1);l.isNull()&&(l=nz.create(!1));let u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ie(u,c,e,ra.create(en.NA)),d=ie(u,c,t,ra.create(en.NA)),m=ie(u,c,r,ra.create(en.NA)),g=ie(u,c,n,ra.create(en.NA)),f=ie(u,c,i,ra.create(en.NA)),p=ie(u,c,o,ra.create(en.NA)),C=ie(u,c,l,ra.create(en.NA));return this._getResultArray(h,d,m,g,f,p,C,u,c)}_getResultArray(e,t,r,n,i,s,a,o,l){let u=e.map((e,o,l)=>{let u=t.get(o,l),c=r.get(o,l),h=n.get(o,l),d=i.get(o,l),{isError:m,errorObject:g,variants:f}=sz(e,u,c,h,d,s.get(o,l),a.get(o,l));if(m)return g;let[p,C,_,y,R,E,b]=f,I=+p.getValue(),N=+C.getValue(),S=+_.getValue(),A=+y.getValue(),v=+R.getValue(),T=+E.getValue(),w=+b.getValue();if(I<0||N<0||S<0||A<0||v<0||v>S||A>v||T<0)return ra.create(en.NUM);if(0===S&&0===A&&0===v)return ra.create(en.DIV_BY_ZERO);let M=this._getResult(I,N,S,A,v,T,w);return 0===o&&0===l?nX.create(M,re(this.getLocale())):nX.create(M)});return 1===o&&1===l?u.get(0,0):u}_getResult(e,t,r,n,i,s,a){let o=Math.floor(n),l=Math.ceil(i),u=0;if(e<t){if(n>=1||a)return u;let r=Math.abs(e-t);return-(u=r*(i-n)>r?r:r*(i-n))}if(a)for(let a=o+1;a<=l;a++){let c=o7(e,t,r,a,s);a===o+1?c*=Math.min(i,o+1)-n:a===l&&(c*=i+1-l),u+=c}else{let a=e-this._getVdb(e,t,r,r,n,s);u=this._getVdb(a,t,r,r-n,i-n,s)}return u}_getVdb(e,t,r,n,i,s){let a=Math.ceil(i),o=0,l=e-t,u=0,c=0,h=!1;for(let d=1;d<=a;d++){if(h)c=u;else{let i=o7(e,t,r,d,s);(u=l/(n-(d-1)))>i?(c=u,h=!0):(c=i,l-=i)}d===a&&(c*=i+1-a),o+=c}return o}},oG.VDB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return ra.create(en.NA);let{isError:n,errorObejct:i,_values:s,_dates:a}=this._checkErrors(e,t);if(n)return i;let o=null!=r?r:nX.create(.1);o.isNull()&&(o=nX.create(.1));let{isError:l,errorObject:u,variants:c}=sG(o);if(l)return u;let[h]=c,d=+h.getValue();if(Number.isNaN(d))return ra.create(en.VALUE);let{positive:m,negative:g}=this._checkValues(s);if(!m||!g||(null==s?void 0:s.length)!==(null==a?void 0:a.length)||d<0)return ra.create(en.NUM);let f=o9(d,e=>this._iterF(s,a,e));return"number"!=typeof f?f:nX.create(f)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isBoolean())return r=!0,n=ra.create(en.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=ra.create(en.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ra.create(en.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,B.isRealNum)(t)?{isError:!0,errorObejct:ra.create(en.VALUE)}:{isError:!0,errorObejct:ra.create(en.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);return e.iterator(e=>{if(null!=e&&e.isError())return r=!0,n=e,!1;if(null!=e&&e.isBoolean())return r=!0,n=ra.create(en.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=ra.create(en.VALUE),!1):i<0?(r=!0,n=ra.create(en.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ra.create(en.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,B.isRealNum)(t)?{isError:!0,errorObejct:ra.create(en.VALUE)}:0>+t?{isError:!0,errorObejct:ra.create(en.NUM)}:{isError:!0,errorObejct:ra.create(en.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((e,n,i)=>e+n/(1+r)**((t[i]-t[0])/365),0)}},oG.XIRR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return ra.create(en.NA);let{isError:n,errorObject:i,variants:s}=sG(e);if(n)return i;let[a]=s,o=+a.getValue();if(Number.isNaN(o))return ra.create(en.VALUE);let{isError:l,errorObejct:u,_values:c,_dates:h}=this._checkErrors(t,r);if(l)return u;if(o<0||c.length!==h.length)return ra.create(en.NUM);let d=0,m=h[0];for(let e=0;e<h.length;e++){let t=h[e];d+=c[e]/(1+o)**((t-m)/365)}return nX.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=ra.create(en.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=ra.create(en.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ra.create(en.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,B.isRealNum)(t)?{isError:!0,errorObejct:ra.create(en.VALUE)}:{isError:!0,errorObejct:ra.create(en.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=ra.create(en.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=ra.create(en.VALUE),!1):i<0?(r=!0,n=ra.create(en.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ra.create(en.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,B.isRealNum)(t)?{isError:!0,errorObejct:ra.create(en.VALUE)}:0>+t?{isError:!0,errorObejct:ra.create(en.NUM)}:{isError:!0,errorObejct:ra.create(en.NA)}}}},oG.XNPV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",6),Z(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nX.create(0);o.isNull()&&(o=nX.create(0));let{isError:l,errorObject:u,variants:c}=sY(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=oO(h);if("number"!=typeof _)return _;let y=oO(d);if("number"!=typeof y)return y;let R=+m.getValue(),E=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue()),N=Math.floor(+C.getValue());if(Number.isNaN(R)||Number.isNaN(E)||Number.isNaN(b)||Number.isNaN(I)||Number.isNaN(N))return ra.create(en.VALUE);if(R<0||E<=0||b<=0||![1,2,4].includes(I)||N<0||N>4||_>=y||!o4(_,y,I))return ra.create(en.NUM);let S=this._getResult(_,y,R,E,b,I,N);return nX.create(S)}_getResult(e,t,r,n,i,s,a){if(oq(e,t,s)>1){let o=r||.01,l=o8(e,t,r,o,i,s,a),u=l-n;for(let c=0;c<100&&Math.abs(u)>1e-7;c++)l=o8(e,t,r,1.01*o,i,s,a),o+=-u/(l-n-u)*o*.01,u=o8(e,t,r,o,i,s,a)-n;return o}let o=oY(e,t,s,a),l=oz(e,t,s,a),{days:u}=oU(e,t,a),c=n/100+o/l*r/s;return(i/100+r/s-c)/c*s*l/u}},oG.YIELD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nX.create(0);s.isNull()&&(s=nX.create(0));let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ra.create(en.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ra.create(en.NUM);let{days:y,yearDays:R}=oU(g,f,_);return nX.create((C/p-1)/(y/R))}},oG.YIELDDISC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nX.create(0);a.isNull()&&(a=nX.create(0));let{isError:o,errorObject:l,variants:u}=sY(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+m.getValue(),R=+g.getValue(),E=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(E))return ra.create(en.VALUE);let b=this._getDateCorrectOrder(C,p,_);if(y<0||R<=0||E<0||E>4||!b)return ra.create(en.NUM);let I=ok(p,E),{days:N}=oU(p,C,E),{days:S}=oU(_,C,E),{days:A}=oU(_,p,E),v=((1+S/I*y)/(R/100+A/I*y)-1)/(N/I);return nX.create(v)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.YIELDMAT]];var lt=((D=lt||{}).CELL="CELL",D.ERROR_TYPE="ERROR.TYPE",D.INFO="INFO",D.ISBETWEEN="ISBETWEEN",D.ISBLANK="ISBLANK",D.ISDATE="ISDATE",D.ISEMAIL="ISEMAIL",D.ISERR="ISERR",D.ISERROR="ISERROR",D.ISEVEN="ISEVEN",D.ISFORMULA="ISFORMULA",D.ISLOGICAL="ISLOGICAL",D.ISNA="ISNA",D.ISNONTEXT="ISNONTEXT",D.ISNUMBER="ISNUMBER",D.ISODD="ISODD",D.ISOMITTED="ISOMITTED",D.ISREF="ISREF",D.ISTEXT="ISTEXT",D.ISURL="ISURL",D.N="N",D.NA="NA",D.SHEET="SHEET",D.SHEETS="SHEETS",D.TYPE="TYPE",D);let lr=[[class extends sX{constructor(){super(...arguments),Z(this,"needsReferenceObject",!0),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),n=r.getColumnCount();if(1===e&&1===n){let e=r.get(0,0);return this._handleSingleObject(e,t)}return r.map(e=>e.isError()?e:this._handleSingleObject(e,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n,i=t;if(i.isError())return i;if(!i.isReferenceObject())return ra.create(en.NA);let{columnData:s,defaultColumnWidth:a}=i.getCurrentActiveSheetData(),o=(i=i.toArrayValueObject()).getCurrentRow(),l=i.getCurrentColumn();switch(i=i.getFirstCell(),`${e.getValue()}`.toLocaleLowerCase()){case"address":return nK.create(`$${B.Tools.chatAtABC(l)}$${o+1}`);case"col":return nX.create(l+1);case"color":case"parentheses":return nX.create(0);case"contents":return i;case"filename":default:return ra.create(en.VALUE);case"format":return nK.create("G");case"prefix":return nK.create("");case"protect":return nX.create(1);case"row":return nX.create(o+1);case"type":return n="v",i.isNull()&&(n="b"),i.isString()&&(n="l"),nK.create(n);case"width":return this._getWidthResult(s,a,l,r)}}_getWidthResult(e,t,r,n){var i;let s=null==(i=e[r])?void 0:i.w;if(s||0===s||(s=t),n)return nX.create(s);let a=[[s,s===t]];return n0.createByArray(a)}},lt.CELL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"_errorTypeValueMap",new Map([[en.NULL,1],[en.DIV_BY_ZERO,2],[en.VALUE,3],[en.REF,4],[en.NAME,5],[en.NUM,6],[en.NA,7],[en.CONNECT,8],[en.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?nX.create(r):ra.create(en.NA)}},lt.ERROR_TYPE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sW(e,t,r,null!=n?n:nz.create(!0),null!=i?i:nz.create(!0));if(s)return a;let[l,u,c,h,d]=o;if(h.isString()||d.isString())return ra.create(en.VALUE);if(!0===u.compare(c,">").getValue())return ra.create(en.NUM);let m=+h.getValue(),g=+d.getValue();return!1===l.compare(u,m?">=":">").getValue()||!1===l.compare(c,g?"<=":"<").getValue()?nz.create(!1):nz.create(!0)}},lt.ISBETWEEN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isNull()?nz.create(!0):e.isArray()?e.mapValue(e=>e.isNull()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISBLANK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&""!==t.getPattern()?nz.create(oS(t.getPattern())):t.isString()&&(oI(`${t.getValue()}`)||oN(`${t.getValue()}`))?nz.create(!0):nz.create(!1)}},lt.ISDATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nz.create(!1);let r=`${t.getValue()}`;if(r.length>254)return nz.create(!1);let n=B.Tools.topLevelDomainCombiningString(),i=RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return nz.create(i.test(r))}},lt.ISEMAIL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.getValue()===en.NA?nz.create(!1):e.isError()?nz.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===en.NA?nz.create(!1):e.isError()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISERR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?nz.create(!0):e.isArray()?e.mapValue(e=>e.isError()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISERROR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return ra.create(en.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?ra.create(en.VALUE):nz.create(r%2==0)}},lt.ISEVEN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return ra.create(en.NA);let r=null==(t=e.getCurrentActiveSheetData())?void 0:t.cellData.getMatrix(),{startRow:n,startColumn:i}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((e,t,s)=>{var a;let o=null==(a=null==r?void 0:r[n+t])?void 0:a[i+s];return null!=o&&o.f||null!=o&&o.si?nz.create(!0):nz.create(!1)});return 1===s.getRowCount()&&1===s.getColumnCount()?a.get(0,0):a}},lt.ISFORMULA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isBoolean()?nz.create(!0):e.isArray()?e.mapValue(e=>e.isBoolean()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISLOGICAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.getValue()===en.NA?nz.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===en.NA?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISNA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()||e.isString()?e.isArray()?e.mapValue(e=>e.isString()?nz.create(!1):nz.create(!0)):nz.create(!1):nz.create(!0)}},lt.ISNONTEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isNumber()?nz.create(!0):e.isArray()?e.mapValue(e=>e.isNumber()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISNUMBER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return ra.create(en.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?ra.create(en.VALUE):nz.create(r%2!=0)}},lt.ISODD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nz.create(!0):nz.create(!1)}},lt.ISREF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isString()?nz.create(!0):e.isArray()?e.mapValue(e=>e.isString()?nz.create(!0):nz.create(!1)):nz.create(!1)}},lt.ISTEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nz.create(!1);let r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return nz.create(!1);let n=B.Tools.topLevelDomainCombiningString(),i=RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return nz.create(i.test(r))}},lt.ISURL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return nX.create(0);let r=+t.getValue();return nX.create(r)}},lt.N],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){return ra.create(en.NA)}},lt.NA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0),Z(this,"needsSheetsInfo",!0)}calculate(e){var t;if(null!=e&&e.isError())return e;let{sheetOrder:r,sheetNameMap:n}=this.getSheetsInfo();if(!e){let e=r.findIndex(e=>e===this.subUnitId);return nX.create(e+1)}if(e.isReferenceObject()){let t=e.getForcedSheetId(),n=e.getDefaultSheetId(),i=r.findIndex(e=>t?e===t:e===n);return nX.create(i+1)}if(e.isArray())return ra.create(en.NA);let i=`${e.getValue()}`.toLocaleLowerCase(),s=null==(t=Object.entries(n).find(([e,t])=>t.toLocaleLowerCase()===i))?void 0:t[0];if(!s)return ra.create(en.NA);let a=r.findIndex(e=>e===s);return nX.create(a+1)}},lt.SHEET],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0),Z(this,"needsSheetsInfo",!0)}calculate(){let{sheetOrder:e}=this.getSheetsInfo();return nX.create(e.length)}},lt.SHEETS],[class extends sX{constructor(){super(...arguments),Z(this,"needsReferenceObject",!0),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){let t=e.getRowCount(),r=e.getColumnCount();if(1!==t||1!==r)return nX.create(64);{let t=e.getFirstCell();if(t.isError())return nX.create(16);if(t.isBoolean())return nX.create(4);if(t.isString())return nX.create(2);if(t.isNumber()||t.isNull())return nX.create(1)}}else{if(e.isArray())return nX.create(64);if(e.isError())return nX.create(16);if(e.isBoolean())return nX.create(4);if(e.isString())return nX.create(2);if(e.isNumber()||e.isNull())return nX.create(1)}return nX.create(128)}},lt.TYPE]];var ln=((V=ln||{}).AND="AND",V.BYCOL="BYCOL",V.BYROW="BYROW",V.FALSE="FALSE",V.IF="IF",V.IFERROR="IFERROR",V.IFNA="IFNA",V.IFS="IFS",V.LAMBDA="LAMBDA",V.LET="LET",V.MAKEARRAY="MAKEARRAY",V.MAP="MAP",V.NOT="NOT",V.OR="OR",V.REDUCE="REDUCE",V.SCAN="SCAN",V.SWITCH="SWITCH",V.TRUE="TRUE",V.XOR="XOR",V);let li=class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255),Z(this,"needsReferenceObject",!0)}calculate(...e){let t=[],r=null,n=0,i=0;for(let s=0;s<e.length;s++){let a=e[s],o=a;if(o.isReferenceObject()&&(o=a.toArrayValueObject()),o.isError())return o;if(s===e.length-1){if(!(a.isValueObject()&&a.isLambda()))return ra.create(en.VALUE);r=a}else t.push(a),n=Math.max(n,o.isArray()?o.getRowCount():1),i=Math.max(i,o.isArray()?o.getColumnCount():1)}let s=this._getResultArray(t,r,n,i);return s instanceof ra?s:1===n&&1===i?s[0][0]:n0.create({calculateValueList:s,rowCount:n,columnCount:i,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){let i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=[],a=!1;for(let t=0;t<e.length;t++){let o=e[t],l=null;if(o.isReferenceObject()&&(l=o,o=o.toArrayValueObject()),!o.isArray())if(0===s&&0===i){n.push(l||o);continue}else{r.push(ra.create(en.NA)),a=!0;break}let u=o.get(s,i);if(!u){r.push(ra.create(en.NA)),a=!0;break}if(l){let{startRow:e,startColumn:t}=l.getRangePosition(),r={startRow:e+s,startColumn:t+i,endRow:e+s,endColumn:t+i};u=this.createReferenceObject(l,r)}n.push(u)}if(a||0===n.length)continue;let o=t.execute(...n);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return ra.create(en.CALC);o=o.get(0,0)}o.isNull()&&(o=nX.create(0)),r.push(o)}i.push(r)}return i}},ls=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t&&!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t&&!!i.getValue(),r=!1)}return r?ra.create(en.VALUE):nz.create(t)}},ln.AND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2),Z(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return ra.create(en.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=ie(i,s,r);let a=[[]];for(let e=0;e<s;e++){let s=[];for(let t=0;t<i;t++){let n=r.get(t,e);s.push([n])}let o=n0.create({calculateValueList:s,rowCount:i,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),s={startRow:t,startColumn:r+e,endRow:t+i-1,endColumn:r+e};o=this.createReferenceObject(n,s)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return ra.create(en.CALC);l=l.get(0,0)}l.isNull()&&(l=nX.create(0)),a[0].push(l)}return 1===s?a[0][0]:n0.create({calculateValueList:a,rowCount:1,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYCOL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2),Z(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return ra.create(en.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=ie(i,s,r);let a=[];for(let e=0;e<i;e++){let i=[[]];for(let t=0;t<s;t++){let n=r.get(e,t);i[0].push(n)}let o=n0.create({calculateValueList:i,rowCount:1,columnCount:s,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),i={startRow:t+e,startColumn:r,endRow:t+e,endColumn:r+s-1};o=this.createReferenceObject(n,i)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return ra.create(en.CALC);l=l.get(0,0)}l.isNull()&&(l=nX.create(0)),a.push([l])}return 1===i?a[0][0]:n0.create({calculateValueList:a,rowCount:i,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYROW],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){return nz.create(!1)}},ln.FALSE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r=nz.create(!1)){let n=this._getSingleValueObject(e);if(n.isError())return n;if(!n.isArray())return n.getValue()?t:r;let i=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=ie(i,s,n),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA));return a.map((e,t,r)=>{if(e.isNull())return ra.create(en.NA);{let n=o.get(t,r)||nG.create(),i=l.get(t,r)||nG.create();return this._calculateSingleCell(e,n,i)}})}_getSingleValueObject(e){return e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?ra.create(en.NA):e.getValue()?t.isNull()?ra.create(en.NA):t:r.isNull()?ra.create(en.NA):r}},ln.IF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&i.set(t,r,s.get(t,r))}),i}},ln.IFERROR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==en.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===en.NA?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&e.getErrorType()===en.NA&&i.set(t,r,s.get(t,r))}),i}},ln.IFNA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255)}calculate(...e){if(e.length%2!=0)return ra.create(en.NA);for(let t=0;t<e.length;t++)if(e[t].isError())return e[t];let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),n=e.map(e=>ie(t,r,e,ra.create(en.NA))),i=n[0].map((e,t,r)=>{for(let e=0;e<n.length;e+=2){let i=n[e].get(t,r)||nG.create(),s=n[e+1].get(t,r)||nG.create();if(i.isNull())continue;if(i.isError())return i;let a=i.getValue();if(i.isString()){if("TRUE"===`${a}`.toLocaleUpperCase())return s;if("FALSE"===`${a}`.toLocaleUpperCase())continue;return ra.create(en.VALUE)}if(+a)return s.isNull()?ra.create(en.NA):s}return ra.create(en.NA)});return 1===t&&1===r?i.get(0,0):i}},ln.IFS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(){return ra.create(en.VALUE)}},ln.LAMBDA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(){return ra.create(en.VALUE)}},ln.LET],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(...e){let t=this.getIndexNumValue(e[0]);if("number"!=typeof t)return t;let r=this.getIndexNumValue(e[1]);if("number"!=typeof r)return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return ra.create(en.VALUE);let n=e[2],i=[];for(let e=0;e<t;e++){null==i[e]&&(i[e]=[]);for(let t=0;t<r;t++){let r=n.execute(nX.create(e+1),nX.create(t+1));r.isArray()&&(r=r.get(0,0)),i[e][t]=r}}return new n4(i)}isAsync(){return!0}},ln.MAKEARRAY],[li,ln.MAP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=+e.getValue();return Number.isNaN(t)?ra.create(en.VALUE):nz.create(!t)}},ln.NOT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t||!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t||!!i.getValue(),r=!1)}return r?new ra(en.VALUE):new nz(t)}},ln.OR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,i,s,a;return e.isReferenceObject()?(n=e.toArrayValueObject(),i=e):(n=e,i=null),t.isReferenceObject()?(s=t.toArrayValueObject(),a=t):(s=t,a=null),n.isArray()?n.mapValue(e=>this._handleSingleValueObject(e,s,r,i,a)):this._handleSingleValueObject(n,s,r,i,a)}_handleSingleValueObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return ra.create(en.VALUE);let s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,o=e;n&&(o=n);for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=t.isArray()?t.get(e,n):t;if(s.isError())return s;if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),a={startRow:t+e,startColumn:r+n,endRow:t+e,endColumn:r+n};s=this.createReferenceObject(i,a)}let a=r.execute(o,s);if(a.isError())return a;a.isNull()&&(a=nX.create(0)),o=a}return o.isReferenceObject()?o.toArrayValueObject():o}},ln.REDUCE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,i=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),i=e);let s=t,a=null;if(t.isReferenceObject()&&(s=t.toArrayValueObject(),a=t),n.isError())return n;if(s.isError())return s;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return ra.create(en.VALUE);if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.CALC);n=n.get(0,0)}return this._getResult(n,s,r,i,a)}_getResult(e,t,r,n,i){let s=[],a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,l=e;n&&(l=n);for(let e=0;e<a;e++){let n=[];for(let s=0;s<o;s++){if(l.isError()){n.push(l);continue}let a=t.isArray()?t.get(e,s):t;if(a.isError()){l=a,n.push(a);continue}if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),n={startRow:t+e,startColumn:r+s,endRow:t+e,endColumn:r+s};a=this.createReferenceObject(i,n)}let o=r.execute(l,a);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return ra.create(en.CALC);o=o.get(0,0)}o.isNull()&&(o=nX.create(0)),l=o,n.push(o)}s.push(n)}return 1===a&&1===o?s[0][0]:n0.create({calculateValueList:s,rowCount:a,columnCount:o,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.SCAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;let r=t.length%2!=0,n=r?t[t.length-1]:nG.create();return e.isArray()||t.some(e=>e.isArray())?this._handleArrayInputs(e,t,n,r):this._handleNonArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let r=0;r<t.length-!!n;r+=2){let n=t[r],i=t[r+1];if(!n.isNull()){if(n.isError())return n;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return i.isNull()?ra.create(en.NA):i}}return r.isNull()?ra.create(en.NA):r}_handleArrayInputs(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,...t.map(e=>e.isArray()?e.getRowCount():1),r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,...t.map(e=>e.isArray()?e.getColumnCount():1),r.isArray()?r.getColumnCount():1),a=ie(i,s,e),o=t.map(e=>ie(i,s,e,ra.create(en.NA))),l=ie(i,s,r,ra.create(en.NA));return a.map((e,t,r)=>{for(let i=0;i<o.length-!!n;i+=2){let n=o[i].get(t,r)||nG.create(),s=o[i+1].get(t,r)||nG.create();if(!n.isNull()){if(n.isError()||e.isError())return n.isError()?n:e;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return s.isNull()?ra.create(en.NA):s}}let i=l.get(t,r)||nG.create();return i.isNull()?ra.create(en.NA):i})}},ln.SWITCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){return nz.create(!0)}},ln.TRUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(e.getValue()&&t++,r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(i.getValue()&&t++,r=!1)}return r?ra.create(en.VALUE):nz.create(t%2==1)}},ln.XOR]];var la=((L=la||{}).ADDRESS="ADDRESS",L.AREAS="AREAS",L.CHOOSE="CHOOSE",L.CHOOSECOLS="CHOOSECOLS",L.CHOOSEROWS="CHOOSEROWS",L.COLUMN="COLUMN",L.COLUMNS="COLUMNS",L.DROP="DROP",L.EXPAND="EXPAND",L.FILTER="FILTER",L.FORMULATEXT="FORMULATEXT",L.GETPIVOTDATA="GETPIVOTDATA",L.HLOOKUP="HLOOKUP",L.HSTACK="HSTACK",L.HYPERLINK="HYPERLINK",L.IMAGE="IMAGE",L.INDEX="INDEX",L.INDIRECT="INDIRECT",L.LOOKUP="LOOKUP",L.MATCH="MATCH",L.OFFSET="OFFSET",L.ROW="ROW",L.ROWS="ROWS",L.RTD="RTD",L.SORT="SORT",L.SORTBY="SORTBY",L.TAKE="TAKE",L.TOCOL="TOCOL",L.TOROW="TOROW",L.TRANSPOSE="TRANSPOSE",L.UNIQUE="UNIQUE",L.VLOOKUP="VLOOKUP",L.VSTACK="VSTACK",L.WRAPCOLS="WRAPCOLS",L.WRAPROWS="WRAPROWS",L.XLOOKUP="XLOOKUP",L.XMATCH="XMATCH",L);let lo=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",5)}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=r?r:nX.create(1),a=null!=n?n:nz.create(!0),o=null!=i?i:nK.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,e,ra.create(en.NA)),h=ie(l,u,t,ra.create(en.NA)),d=ie(l,u,s,ra.create(en.NA)),m=ie(l,u,a,ra.create(en.NA)),g=ie(l,u,o,ra.create(en.NA));return c.map((e,t,r)=>{let n=h.get(t,r)||ra.create(en.NA),i=d.get(t,r)||ra.create(en.NA),s=m.get(t,r)||ra.create(en.NA),a=g.get(t,r)||ra.create(en.NA);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._calculateSingleCell(e,n,i,s,a)})}_calculateSingleCell(e,t,r,n,i){let s=Number.parseInt(`${Number(e.getValue())-1}`),a=Number.parseInt(`${Number(t.getValue())-1}`),o=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(s)||Number.isNaN(a)||Number.isNaN(o)||o<1||o>4)return ra.create(en.VALUE);let l=function(e){switch(e){case 1:default:return B.AbsoluteRefType.ALL;case 2:return B.AbsoluteRefType.ROW;case 3:return B.AbsoluteRefType.COLUMN;case 4:return B.AbsoluteRefType.NONE}}(o),u=this.getZeroOrOneByOneDefault(n),c=te(`${i.getValue()}`),h={startRow:s,startColumn:a,endRow:s,endColumn:a,startAbsoluteRefType:l,endAbsoluteRefType:l},d=n&&!u?function(e){let t=s$(e.startRow,e.startAbsoluteRefType,!0),r=s$(e.startColumn,e.startAbsoluteRefType,!1),n=s$(e.endRow,e.endAbsoluteRefType,!0),i=s$(e.endColumn,e.endAbsoluteRefType,!1);return t===n&&r===i?`R${t}C${r}`:`R${t}C${r}:R${n}C${i}`}(h):eQ(h);return nK.create(""!==c?`${c}!${d}`:d)}},la.ADDRESS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nX.create(1):ra.create(en.VALUE)}},la.AREAS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255),Z(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){let e=r.convertToNumberObjectValue();return e.isError()?e:t[Math.trunc(+e.getValue())-1]||ra.create(en.VALUE)}let n=r.isArray()?r.getRowCount():1,i=r.isArray()?r.getColumnCount():1;t.forEach((e,t)=>{e.isArray()?(n=Math.max(n,e.getRowCount()),i=Math.max(i,e.getColumnCount())):(n=Math.max(n,1),i=Math.max(i,1))});let s=ie(n,i,r,ra.create(en.NA)),a=t.map(e=>{let t=e;return t.isReferenceObject()&&(t=t.toArrayValueObject()),ie(n,i,t,ra.create(en.NA))});return s.map((e,t,r)=>{if(e.isError())return e;let n=e.convertToNumberObjectValue();if(n.isError())return n;let i=a[Math.trunc(+n.getValue())-1],s=(null==i?void 0:i.get(t,r))||ra.create(en.VALUE);return null!=s&&s.isNull()&&(s=nX.create(0)),s})}},la.CHOOSE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=Math.trunc(+a.getValue());if(0===o||Math.abs(o)>n)return ra.create(en.VALUE);let l=e;n>1&&(l=o<0?e.slice(void 0,[o+n,o+1+n]):e.slice(void 0,[o-1,o]));for(let t=0;t<r;t++)i[t]||(i[t]=[]),e.isArray()?i[t].push(l.get(t,0)):i[t].push(e)}return n0.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSECOLS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=[];for(let i=0;i<t.length;i++){let s=t[i];if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);s=s.get(0,0)}if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.trunc(+s.getValue());if(0===a||Math.abs(a)>r)return ra.create(en.VALUE);let o=e;r>1&&(o=a<0?e.slice([a+r,a+1+r]):e.slice([a-1,a])),e.isArray()?n.push(o.getArrayValue()[0]):n.push([e])}return n0.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSEROWS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",1)}calculate(e){if(null==e)return nX.create(this.column+1);if(e.isError())return e;if(!e.isArray())return ra.create(en.NA);let t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let e=0;e<r;e++)n.push(nX.create(t+e+1));let i={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(i)}},la.COLUMN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nX.create(1);if(!e.isArray())return ra.create(en.NA);let t=e.getColumnCount();return nX.create(t)}},la.COLUMNS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(0),i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ie(a,o,t,ra.create(en.NA)),u=ie(a,o,n,ra.create(en.NA));if(a>1||o>1)return l.mapValue((t,r,n)=>{let a=u.get(r,n);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,i,s);return o?l:e.isArray()?ra.create(en.VALUE):e});if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let c=t.isArray()?t.get(0,0):t,h=n.isArray()?n.get(0,0):n,{isError:d,errorObject:m,rowsValue:g,columnsValue:f}=this._checkRowsColumns(c,h,i,s);return d?m:this._getResultArray(e,g,f,i,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:ra.create(en.VALUE)}:Math.abs(i)>=r||Math.abs(s)>=n?{isError:!0,errorObject:ra.create(en.CALC)}:{isError:!1,rowsValue:i,columnsValue:s}}_getResultArray(e,t,r,n,i){let s,a=t>=0?[t,n]:[0,n+t],o=r>=0?[r,i]:[0,i+r];return s=(s=0===t&&0===r?e:0===t?e.slice(void 0,o):0===r?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nX.create(0):e),n-t==1&&i-r==1?s.get(0,0):s}},la.DROP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t,o=null!=r?r:nX.create(s),l=null!=n?n:ra.create(en.NA);t.isNull()&&(a=nX.create(i)),o.isNull()&&(o=nX.create(s));let u=Math.max(a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),c=Math.max(a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),h=ie(u,c,a,ra.create(en.NA)),d=ie(u,c,o,ra.create(en.NA));if(u>1||c>1)return h.mapValue((t,r,n)=>{let a=d.get(r,n);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let{isError:o,errorObject:u}=this._checkRowsColumnsPadWith(t,a,l,i,s);return o?u:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let m=a.isArray()?a.get(0,0):a,g=o.isArray()?o.get(0,0):o,{isError:f,errorObject:p,rowsValue:C,columnsValue:_,padWithObject:y}=this._checkRowsColumnsPadWith(m,g,l,i,s);return f?p:this._getResultArray(e,C,_,y,i,s)}_checkRowsColumnsPadWith(e,t,r,n,i){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());if(Number.isNaN(s)||Number.isNaN(a)||Math.abs(s)<n||Math.abs(a)<i)return{isError:!0,errorObject:ra.create(en.VALUE)};let o=r;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ra.create(en.VALUE)};o=r.get(0,0)}return{isError:!1,rowsValue:s,columnsValue:a,padWithObject:o}}_getResultArray(e,t,r,n,i,s){let a=[];a=e.isArray()?e.map(e=>e.isNull()?nX.create(0):e).getArrayValue():[[e]];let o=Math.max(0,t-i),l=Math.max(0,r-s);for(let e=0;e<o;e++)a.push(Array(s).fill(n));for(let e=0;e<l;e++)a.forEach(e=>{e.push(n)});return 1===t&&1===r?a[0][0]:n0.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.EXPAND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ra.create(en.CALC);if(e.isError())return e;if(t.isError())return t;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1;return a>1&&o>1||1===a&&o!==s||1===o&&a!==i?ra.create(en.VALUE):1===i&&1===s?this._getResultArrayByR1C1(e,t,n):1===a?o!==s?ra.create(en.VALUE):this._getResultArrayByR1(i,s,e,t,n):1===o?a!==i?ra.create(en.VALUE):this._getResultArrayByC1(i,s,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,i=t;return n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),i.isString()&&(i=i.convertToNumberObjectValue()),i.isError()?i:+i.getValue()?n:r}_getResultArrayByR1(e,t,r,n,i){let s=[];for(let i=0;i<t;i++){let t=n.get(0,i);if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;if(+t.getValue())for(let t=0;t<e;t++){s[t]||(s[t]=[]);let e=r.get(t,i);s[t].push(e)}}return 0===s.length?i:n0.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,i){let s=[];for(let i=0;i<e;i++){let e=n.get(i,0);if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return e;if(!+e.getValue())continue;let a=[];for(let e=0;e<t;e++){let t=r.get(i,e);a.push(t)}s.push(a)}return 0===s.length?i:n0.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.FILTER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0),Z(this,"needsFormulaDataModel",!0)}calculate(e){var t,r;if(!e.isReferenceObject())return ra.create(en.NA);let n=e.getUnitId(),i=e.getSheetId(),s=null==(r=null==(t=e.getUnitData()[n])?void 0:t[i])?void 0:r.cellData,{startRow:a,startColumn:o}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((e,t,r)=>{let l=s.getValue(a+t,o+r);if(null!=l&&l.f||null!=l&&l.si){let e=this._formulaDataModel.getFormulaStringByCell(a+t,o+r,i,n);return nK.create(e)}return ra.create(en.NA)});return 1===l.getRowCount()&&1===l.getColumnCount()?l.get(0,0):l}},la.FORMULATEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return ra.create(en.REF);if(!t.isArray()||r.isError()||null!=n&&n.isError())return ra.create(en.NA);let i=this.getZeroOrOneByOneDefault(n);if(null==i)return ra.create(en.VALUE);let s=this.getIndexNumValue(r);if(s instanceof ra)return s;let a=t.slice([0,1]),o=t.slice([s-1,s]);return null==a||null==o?ra.create(en.REF):e.isArray()?e.map(e=>this._handleSingleObject(e,a,o,i)):this._handleSingleObject(e,a,o,i)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.HLOOKUP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<t;e++){r[e]||(r[e]=[]);for(let t=0;t<a;t++){let n=i;i.isArray()&&(n=i.get(e,t)),e>s-1||!n?r[e].push(ra.create(en.NA)):r[e].push(n)}}}return n0.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.HSTACK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(e.isArray()&&(r=e.get(0,0)),r.isError())return r;let n=t;if(null!=t&&t.isArray()&&(n=t.get(0,0)),null!=n&&n.isError())return n;let i=`${r.getValue()}`;r.isNull()&&(i="");let s=i;return n&&(s=`${n.getValue()}`,n.isNull()?s="0":n.isBoolean()&&(s=s.toLocaleUpperCase())),nK.create(s,{isHyperlink:!0,hyperlinkUrl:i})}},la.HYPERLINK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",4),Z(this,"needsReferenceObject",!0)}calculate(e,t,r,n){if(e.isError())return e;let i=this._getReferenceCounts(e),s=t;t.isReferenceObject()&&(s=t.toArrayValueObject());let a=r;null!=a&&a.isReferenceObject()&&(a=r.toArrayValueObject());let o=null!=n?n:nX.create(1);o.isReferenceObject()&&(o=n.toArrayValueObject());let l=Math.max(s.isArray()?s.getRowCount():1,null!=a&&a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(s.isArray()?s.getColumnCount():1,null!=a&&a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1);if(1===l&&1===u)return this._handleSingleObject(e,s.isArray()?s.get(0,0):s,a?a.isArray()?a.get(0,0):a:void 0,o.isArray()?o.get(0,0):o,i);{let t=ie(l,u,s,ra.create(en.NA)),r=a?ie(l,u,a,ra.create(en.NA)):[],n=ie(l,u,o,ra.create(en.NA));return t.mapValue((t,s,o)=>{let l=a?r.get(s,o):void 0,u=n.get(s,o),c=this._handleSingleObject(e,t,l,u,i);return c.isReferenceObject()?c.getCellByPosition():c})}}_handleSingleObject(e,t,r,n,i){let s,a,o;if(r){let{isError:e,errorObject:i,variants:l}=sz(t,r,n);if(e)return i;s=l[0],a=l[1],o=l[2]}else{let{isError:e,errorObject:r,variants:i}=sz(t,n);if(e)return r;s=i[0],o=i[1]}let l=Math.floor(+o.getValue());if(l<0)return ra.create(en.VALUE);if(l>i.length)return ra.create(en.REF);let u=i[l-1],c=0,h=0;if(1!==u.rowCount||r?(c=Math.floor(+s.getValue()),r&&(h=Math.floor(+a.getValue()))):h=Math.floor(+s.getValue()),c<0||h<0)return ra.create(en.VALUE);if(c>u.rowCount||h>u.columnCount)return ra.create(en.REF);let d=e;return l>1&&(d=e.getCubeValues()[l-1]),d.isReferenceObject()?this._calculateReferenceObject(d,c,h):this._calculateArrayObject(d,c,h)}_getReferenceCounts(e){let t=[{rowCount:1,columnCount:1}];return e.isReferenceObject()?t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]:e.isCube()?t=e.getCubeValues().map(e=>({rowCount:e.getRowCount(),columnCount:e.getColumnCount()})):e.isArray()&&(t=[{rowCount:e.getRowCount(),columnCount:e.getColumnCount()}]),t}_calculateReferenceObject(e,t,r){let{startRow:n,endRow:i,startColumn:s,endColumn:a}=e.getRangePosition(),o=0,l=0,u=0,c=0;if(0===t?(o=n,l=i):o=l=n+t-1,0===r?(u=s,c=a):u=c=s+r-1,o>i||u>a)return ra.create(en.REF);let h={startRow:o,startColumn:u,endRow:l,endColumn:c};return this.createReferenceObject(e,h)}_calculateArrayObject(e,t,r){return e.isArray()&&(0!==t||0!==r)?0===t?e.slice(void 0,[r-1,r]):0===r?e.slice([t-1,t],void 0):e.get(t-1,r-1):e}},la.INDEX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);null==r&&(r=1);let n=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return e.map(()=>ra.create(en.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){let r=`${e.getValue()}`;if(""===r.trim())return ra.create(en.REF);let n=this._convertToDefinedName(r);if(0===t){let{range:e,sheetName:t,unitId:r}=sB(n),i=new n6(e);return i.setForcedUnitIdDirect(r),i.setForcedSheetName(t),this._setDefault(i)}if(eP(n))return this._setDefault(new n9(n));if(ek(n))return this._setDefault(new n7(n));if(eF(n))return this._setDefault(new n8(n));let{range:i,sheetName:s,unitId:a}=tv(n);if(Number.isNaN(i.startRow)||i.endRow+1>1048576||Number.isNaN(i.startColumn)||i.endColumn+1>16384)return ra.create(en.REF);let o=new n6(i);return o.setForcedUnitIdDirect(a),o.setForcedSheetName(s),this._setDefault(o)}_setDefault(e){return null==this.unitId||null==this.subUnitId?ra.create(en.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){let t=this.getDefinedName(e);if(null==t)return e;let r=t.formulaOrRefString;return null==r?e:r.startsWith(eo.EQUALS)?r.slice(1):r}},la.INDIRECT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?ra.create(en.REF):t.isArray()?null!=r&&r.isError()?r:1===t.getColumnCount()||1===t.getRowCount()?null==r||r.isArray()?this._handleVector(e,t,r):ra.create(en.REF):this._handleArray(e,t):ra.create(en.VALUE)}_handleVector(e,t,r){let n=r;if(null==n)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return ra.create(en.REF);return e.isArray()?e.map(e=>this.binarySearch(e,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){let r,n,i=t.getRowCount(),s=t.getColumnCount();return s>i?(r=t.slice([0,1]),n=t.slice([i-1,i])):(r=t.slice(void 0,[0,1]),n=t.slice(void 0,[s-1,s])),null==r||null==n?ra.create(en.VALUE):e.isArray()?e.map(e=>this.binarySearch(e,r,n)):this.binarySearch(e,r,n)}},la.LOOKUP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return ra.create(en.REF);if(!t.isArray())return ra.create(en.VALUE);let n=t.getRowCount(),i=t.getColumnCount();if(1!==n&&1!==i||null!=r&&r.isError())return ra.create(en.NA);let s=this.getMatchTypeValue(r);return null==s?ra.create(en.VALUE):e.isArray()?e.map(e=>this._handleSingleObject(e,t,s)):this._handleSingleObject(e,t,s)}_handleSingleObject(e,t,r){let n=this._getSearchModeValue(r),i=t.orderSearch(e,n);if(null==i)return ra.create(en.NA);if(i instanceof ra)return i;let s=1===t.getRowCount()?i.column+1:i.row+1;return nX.create(s)}_getSearchModeValue(e){switch(e){case 1:return rl.MIN;case 0:return rl.NORMAL;case -1:return rl.MAX}}},la.MATCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",5),Z(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;if(!e.isReferenceObject())return ra.create(en.VALUE);let s=e.getRowCount(),a=e.getColumnCount(),o=t;o.isReferenceObject()&&(o=o.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let u=null!=n?n:nX.create(s);u.isReferenceObject()&&(u=u.toArrayValueObject()),u.isNull()&&(u=nX.create(s));let c=null!=i?i:nX.create(a);c.isReferenceObject()&&(c=c.toArrayValueObject()),c.isNull()&&(c=nX.create(a));let h=Math.max(o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(1===h&&1===d)return o=o.isArray()?o.get(0,0):o,l=l.isArray()?l.get(0,0):l,u=u.isArray()?u.get(0,0):u,c=c.isArray()?c.get(0,0):c,this._handleSingleObject(e,o,l,u,c);let m=ie(h,d,o,ra.create(en.NA)),g=ie(h,d,l,ra.create(en.NA)),f=ie(h,d,u,ra.create(en.NA)),p=ie(h,d,c,ra.create(en.NA));return m.mapValue((t,r,n)=>{let i=g.get(r,n),s=f.get(r,n),a=p.get(r,n);return t.isError()?t:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSingleObject(e,t,i,s,a,!0)})}_handleSingleObject(e,t,r,n,i,s=!1){let{startRow:a,startColumn:o}=e.getRangePosition(),l=t;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;let u=r;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+l.getValue(),h=+u.getValue();if("number"!=typeof c||"number"!=typeof h)return ra.create(en.VALUE);let d=a+c,m=o+h;if(d<0||m<0)return ra.create(en.REF);let g=this.getIndexNumValue(n),f=this.getIndexNumValue(i);if("number"!=typeof g||"number"!=typeof f)return ra.create(en.VALUE);if(0===g||0===f)return ra.create(en.REF);let p=g>0?d+g-1:d+g+1,C=f>0?m+f-1:m+f+1;return p<0||C<0?ra.create(en.REF):s?ra.create(en.VALUE):this.createReferenceObject(e,{startRow:d<p?d:p,startColumn:m<C?m:C,endRow:d>p?d:p,endColumn:m>C?m:C})}},la.OFFSET],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",1)}calculate(e){if(null==e)return nX.create(this.row+1);if(e.isError())return e;if(!e.isArray())return ra.create(en.NA);let t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let e=0;e<r;e++)n.push([nX.create(t+e+1)]);let i={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(i)}},la.ROW],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nX.create(1);if(!e.isArray())return ra.create(en.NA);let t=e.getRowCount();return nX.create(t)}},la.ROWS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=t?t:nX.create(1),s=null!=r?r:nX.create(1),a=null!=n?n:nz.create(!1);if(a.isArray()){let t=a.getRowCount(),r=a.getColumnCount();if(1===t&&1===r){let t=a.get(0,0);return this._handleSingleObject(e,i,s,t)}return a.map(t=>{let r=this._handleSingleObject(e,i,s,t);return r.isArray()?r.get(0,0):r})}return this._handleSingleObject(e,i,s,a)}_handleSingleObject(e,t,r,n){if(e.isError())return e;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=this._checkArrayError(t);if(a.isError())return a;let o=Math.floor(+a.getValue());if(o<1)return ra.create(en.VALUE);let l=this._checkArrayError(r);if(l.isError())return l;let u=Math.floor(+l.getValue());if(-1!==u&&1!==u)return ra.create(en.VALUE);let c=n;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!e.isArray()||1===i&&1===s)return e;let h=+c.getValue();return this._getResult(e,o,u,h,i,s)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,i,s){if(n){if(t>i)return ra.create(en.VALUE);let n=e.transpose().getArrayValue();return n.sort(this._sort(t-1,r)),n0.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}{if(t>s)return ra.create(en.VALUE);let n=e.getArrayValue();return n.sort(this._sort(t-1,r)),n0.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){let r=ru();return 1===t?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return 1;if(s.isError())return -1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?1:s.isBoolean()&&!0===o?-1:i.isBoolean()&&!1===a?1:s.isBoolean()&&!1===o?-1:i.isNumber()&&s.isNumber()?a-o:t(a,o)}}_sortDesc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return -1;if(s.isError())return 1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?-1:s.isBoolean()&&!0===o?1:i.isBoolean()&&!1===a?-1:s.isBoolean()&&!1===o?1:i.isNumber()&&s.isNumber()?o-a:t(o,a)}}},la.SORT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255)}calculate(e,...t){1===t.length&&t.push(nX.create(1));let r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:i}=ia(t);if(r.isError()){let e=ie(n,i,r);return 1===n&&1===i?e.get(0,0):e}let s=t.map((e,t)=>t%2==0?e:ie(n,i,e,ra.create(en.NA))),a=this._getResultArray(e,s,n,i);return 1===n&&1===i?a[0][0]:n0.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let e=0;e<t.length;e++){let r=t[e];if(r.isError())return r}if(t.length<2||t.length%2!=0)return ra.create(en.VALUE);let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t[0].isArray()?t[0].getRowCount():1,s=t[0].isArray()?t[0].getColumnCount():1;if((i>1||s>1)&&(i>1&&s>1||1===i&&s!==n||1===s&&i!==r))return ra.create(en.VALUE);for(let e=2;e<t.length;e++){if(e%2==1)continue;let r=t[e].isArray()?t[e].getRowCount():1,n=t[e].isArray()?t[e].getColumnCount():1;if(r!==i||n!==s)return ra.create(en.VALUE)}return nz.create(!0)}_getResultArray(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t[0].isArray()?t[0].getRowCount():1,o=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let u=0;u<r;u++){l[u]=[];for(let c=0;c<n;c++){let{isError:h,errorObject:d,byArrays:m,sortOrders:g}=this._getByArraysAndSortOrders(t,u,c,o);if(h){l[u].push(d);continue}if(!e.isArray()||1===i&&1===s){l[u].push(e);continue}let f=e.getArrayValue();1===a&&1===o||(1===a?(f=f.concat(m),(f=this._transposeArray(f)).sort(this._sort(i,g)),f=this._transposeArray(f).slice(0,i)):1===o&&(f=(f=this._transposeArray(f)).concat(m),(f=this._transposeArray(f)).sort(this._sort(s,g)),f=f.map(e=>e.slice(0,s))));let p=n0.create({calculateValueList:f,rowCount:f.length,columnCount:f[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[u].push(p.get(0,0));continue}l[u].push(p)}}return l}_getByArraysAndSortOrders(e,t,r,n){let i=[],s=[],a=!1,o=null;for(let l=0;l<e.length;l++){if(l%2==1)continue;let u=e[l],c=e[l+1].get(t,r);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()){a=!0,o=c;break}let h=Math.floor(+c.getValue());if(-1!==h&&1!==h){a=!0,o=ra.create(en.VALUE);break}if(s.push(h),u.isArray()){let e=u.getArrayValue();1===n&&(e=this._transposeArray(e)),i.push(e[0])}else i.push([u])}return{isError:a,errorObject:o,byArrays:i,sortOrders:s}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_sort(e,t){let r=ru();return(n,i)=>{let s=n[e],a=i[e],o=this._compare(s,a,t[0],r);if(0===o&&t.length>1)for(let l=1;l<t.length&&(s=n[e+l],a=i[e+l],0===(o=this._compare(s,a,t[l],r)));l++);return o}}_compare(e,t,r,n){return 1===r?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return -1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?1:t.isBoolean()&&!0===i?-1:e.isBoolean()&&!1===n?1:t.isBoolean()&&!1===i?-1:e.isNumber()&&t.isNumber()?n-i:r(n,i)}_desc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return -1;if(t.isError())return 1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?-1:t.isBoolean()&&!0===i?1:e.isBoolean()&&!1===n?-1:t.isBoolean()&&!1===i?1:e.isNumber()&&t.isNumber()?i-n:r(i,n)}},la.SORTBY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t,a=null!=r?r:nX.create(i);t.isNull()&&(s=nX.create(n)),a.isNull()&&(a=nX.create(i));let o=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ie(o,l,s,ra.create(en.NA)),c=ie(o,l,a,ra.create(en.NA));if(o>1||l>1)return u.mapValue((t,r,s)=>{let a=c.get(r,s);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,n,i);return o?l:e.isArray()?ra.create(en.VALUE):e});if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let h=s.isArray()?s.get(0,0):s,d=a.isArray()?a.get(0,0):a,{isError:m,errorObject:g,rowsValue:f,columnsValue:p}=this._checkRowsColumns(h,d,n,i);return m?g:this._getResultArray(e,f,p,n,i)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:ra.create(en.VALUE)}:0===Math.abs(i)||0===Math.abs(s)?{isError:!0,errorObject:ra.create(en.CALC)}:(i>r&&(i=r),s>n&&(s=n),{isError:!1,rowsValue:i,columnsValue:s})}_getResultArray(e,t,r,n,i){let s;if(!e.isArray())return e;let a=t>=0?[0,t]:[n+t,n],o=r>=0?[0,r]:[i+r,i];return s=(s=t===n&&r===i?e:t===n?e.slice(void 0,o):r===i?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nX.create(0):e),1===t&&1===r?s.get(0,0):s}},la.TAKE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nX.create(0),i=null!=r?r:nz.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,n,ra.create(en.NA)),l=ie(s,a,i,ra.create(en.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u))return ra.create(en.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?ra.create(en.CALC):s>1||a>1||1===c.length?c[0]:n0.create({calculateValueList:c.map(e=>[e]),rowCount:c.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nX.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nX.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOCOL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nX.create(0),i=null!=r?r:nz.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,n,ra.create(en.NA)),l=ie(s,a,i,ra.create(en.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u)||e.isNull())return ra.create(en.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?ra.create(en.CALC):s>1||a>1||1===c.length?c[0]:n0.create({calculateValueList:[c],rowCount:1,columnCount:c.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nX.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nX.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOROW],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return 1===t&&1===r?e.get(0,0):e.transpose()}return e}},la.TRANSPOSE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nz.create(!1),i=null!=r?r:nz.create(!1),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),u=ie(o,l,n,ra.create(en.NA)),c=ie(o,l,i,ra.create(en.NA)),h=u.map((t,r,n)=>{let i,u=t,h=c.get(r,n);if(e.isError())return e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let d=+u.getValue(),m=+h.getValue();return i=!d&&1===s||d&&1===a?e:this._getResult(e,d,m),(o>1||l>1)&&null!=i&&i.isArray()?i.get(0,0):i});return 1===o&&1===l?h.get(0,0):h}_getResult(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=e.getArrayValue(),a=n,o=i;t&&(s=this._transposeArray(s),a=i,o=n);let l=this._getRepeatRows(s,a,o);if(l.length>0){let e=[];l.forEach(t=>{t.forEach((t,n)=>{(0!==n||r)&&e.push(t)})}),s=s.filter((t,r)=>!e.includes(r))}return 0===s.length?ra.create(en.CALC):(t&&(s=this._transposeArray(s)),n0.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let i=0;i<r;i++)if(0===i){let r=Array(t).fill(null).map((t,r)=>({r:r,valueObject:e[r][i]}));n=this._getRepeatRowsByObjects(r)}else{if(0===n.length)break;let t=[];n.forEach(r=>{let n=r.map(t=>({r:t,valueObject:e[t][i]})),s=this._getRepeatRowsByObjects(n);t=t.concat(s)}),n=t}return n}_getRepeatRowsByObjects(e){let t=new Map;return e.forEach(e=>{let r=e.r,n=e.valueObject,i=n.getValue();if(n.isNull()?i=null:n.isString()&&(0,B.isRealNum)(i)&&(i*=1),t.has(i)){let e=t.get(i);e.push(r),t.set(i,e)}else t.set(i,[r])}),Array.from(t.values()).filter(e=>e.length>1)}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}},la.UNIQUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return ra.create(en.VALUE);if(r.isError())return r;if(null!=n&&n.isError())return n;let i=null!=n?n:nz.create(!0);return is(e)&&is(i)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,i):this._handleNonArrayColIndexNum(e,t,r,i)}_handleArrayColIndexNum(e,t,r,n){let i,s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(null==a)return ra.create(en.VALUE);let o=[];return r.iterator((e,r,n)=>{if(null==e)return i=ra.create(en.VALUE),!1;let l=this._handleTableArray(s,t,e,a);if(l.isError())return i=l,!1;void 0===o[r]&&(o[r]=[]),o[r][n]=l}),i||it(o,o.length,o[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e),o=ie(i,s,n);return a.map((e,n,i)=>{if(e.isError())return e;let s=o.get(n,i);if(null==s)return ra.create(en.VALUE);if(s.isError())return s;let a=this.getZeroOrOneByOneDefault(s);return null==a?ra.create(en.VALUE):this._handleTableArray(e,t,r,a)})}_handleTableArray(e,t,r,n){let i=this.getIndexNumValue(r);if(i instanceof ra)return i;if((i=Math.floor(i))<1)return ra.create(en.VALUE);let s=t.slice(void 0,[0,1]);if(null==s)return ra.create(en.VALUE);let a=t.slice(void 0,[i-1,i]);return null==a?ra.create(en.REF):this._handleSingleObject(e,s,a,n)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.VLOOKUP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++){let n=[];for(let r=0;r<t;r++){let t=i;i.isArray()&&(t=i.get(e,r)),r>a-1||!t?n.push(ra.create(en.NA)):n.push(t)}r.push(n)}}return n0.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.VSTACK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ra.create(en.NA);n.isNull()&&(n=ra.create(en.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ie(a,o,t,ra.create(en.NA)),u=ie(a,o,n,ra.create(en.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return ra.create(en.VALUE);if(c<1)return ra.create(en.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:n0.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++)for(let n=0;n<i;n++){s[n]||(s[n]=[]);let a=t*i+n;a<e.length?s[n].push(e[a].isNull()?nX.create(0):e[a]):s[n].push(r)}return s}},la.WRAPCOLS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ra.create(en.NA);n.isNull()&&(n=ra.create(en.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ie(a,o,t,ra.create(en.NA)),u=ie(a,o,n,ra.create(en.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return ra.create(en.VALUE);if(c<1)return ra.create(en.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:n0.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++){let n=[];for(let s=0;s<i;s++){let a=t*i+s;a<e.length?n.push(e[a].isNull()?nX.create(0):e[a]):n.push(r)}s.push(n)}return s}},la.WRAPROWS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=n?n:ra.create(en.NA);null!=n&&n.isNull()&&(a=ra.create(en.NA));let o=null!=i?i:nX.create(0);null!=i&&i.isNull()&&(o=nX.create(0));let l=null!=s?s:nX.create(1);if(null!=s&&s.isNull()&&(l=nX.create(1)),e.isError())return e;if(t.isError()||r.isError())return ra.create(en.REF);if(!t.isArray()||!r.isArray())return ra.create(en.VALUE);let u=t.getRowCount(),c=t.getColumnCount(),h=r.getRowCount(),d=r.getColumnCount();if(1!==u&&1!==c||1===u&&c>1&&c!==d||1===c&&u>1&&u!==h)return ra.create(en.VALUE);if(o.isError())return o;if(l.isError())return l;let m=this.getIndexNumValue(o);if(m instanceof ra)return m;let g=this.getIndexNumValue(l);return g instanceof ra?g:this._getResult(e,t,r,a,m,g,u,c,h,d)}_getResult(e,t,r,n,i,s,a,o,l,u){let c=e.isArray()?e.getRowCount():1,h=e.isArray()?e.getColumnCount():1;if(c>1||h>1){let o;return null==(o=1===a?r.slice([0,1]):r.slice(void 0,[0,1]))?ra.create(en.NA):e.map(e=>{let r=this._checkErrorCombination(i,s);if(r)return r;let a=this._handleSingleObject(e,t,o,i,s);return a.isError()?n:a})}let d=e.isArray()?e.get(0,0):e;if(o===u&&a===l){let e=this._checkErrorCombination(i,s);if(e)return e;let a=this._handleSingleObject(d,t,r,i,s);return a.isError()?n:a}let m=0;o===u&&(m=1);let g=this._handleExpandObject(d,t,r,i,s,m);return null==g?ra.create(en.NA):g}_handleExpandObject(e,t,r,n,i,s=0){if((2===i||-2===i)&&2!==n){let a=rd(n);return this.binarySearchExpand(e,t,r,s,+(-2===i),a)}return 2===n?this.fuzzySearchExpand(e,t,r,-1!==i,s):-1===n||1===n?this.orderSearchExpand(e,t,r,1===n?rl.MAX:rl.MIN,-1===i,s):this.equalSearchExpand(e,t,r,-1!==i,s)}_handleSingleObject(e,t,r,n,i){if((2===i||-2===i)&&2!==n){let s=rd(n);return this.binarySearch(e,t,r,+(-2===i),s)}return 2===n?this.fuzzySearch(e,t,r,-1!==i):-1===n||1===n?this.orderSearch(e,t,r,1===n?rl.MAX:rl.MIN,-1===i):this.equalSearch(e,t,r,-1!==i)}_checkErrorCombination(e,t){return 2===e&&(-2===t||2===t)?ra.create(en.VALUE):null}},la.XLOOKUP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return ra.create(en.REF);if(!t.isArray())return ra.create(en.VALUE);let i=t.getRowCount(),s=t.getColumnCount();if(1!==i&&1!==s)return ra.create(en.VALUE);if(null!=r&&r.isError()||null!=n&&n.isError())return ra.create(en.NA);let a=this.getIndexNumValue(r||nX.create(0));if(a instanceof ra)return a;let o=this.getIndexNumValue(n||nX.create(1));return o instanceof ra?o:e.isArray()?e.map(e=>this._handleSingleObject(e,t,a,o)):this._handleSingleObject(e,t,a,o)}_handleSingleObject(e,t,r,n){let i;if((2===n||-2===n)&&2!==r){let s=rd(r);i=t.binarySearch(e,+(-2===n),s)}else if(2===r){let r,s=t.compare(e,el.EQUALS);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return ra.create(en.NA);i=1===t.getRowCount()?r.column:r.row}else if(-1===r||1===r){let s=t.orderSearch(e,1===r?rl.MAX:rl.MIN,-1===n);if(null==s)return ra.create(en.NA);if(s instanceof ra)return s;i=1===t.getRowCount()?s.column:s.row}else{let r,s=t.isEqual(e);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return ra.create(en.NA);i=1===t.getRowCount()?r.column:r.row}return null==i?ra.create(en.NA):nX.create(i+1)}},la.XMATCH]];function ll(e){let t=e.getValue();if(e.isBoolean()&&(t=+!!t),!Number.isFinite(t))return ra.create(en.VALUE);let r=Math.atan(1/(t=Number(t)));return t<0&&(r+=Math.PI),Number.isNaN(r)?ra.create(en.VALUE):nX.create(r)}function lu(e){let t=e.getValue();if(e.isBoolean()&&(t=+!!t),!Number.isFinite(t))return ra.create(en.VALUE);if(1>=Math.abs(t=Number(t)))return ra.create(en.NUM);let r=.5*Math.log((t+1)/(t-1));return Number.isNaN(r)?ra.create(en.VALUE):nX.create(r)}let lc=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}},i5.ABS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}},i5.ACOS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}},i5.ACOSH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:ll(e)):ll(t)}},i5.ACOT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:lu(e)):lu(t)}},i5.ACOTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nX.create(0);if(e.isBoolean()||e.isNumber())return ra.create(en.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return ra.create(en.VALUE);let r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let e=0;e<t.length;e++){let r=an.get(t[e])||0,i=an.get(t[e+1])||0,s=an.get(t[e+2])||0,a=an.get(t[e+3])||0;if(!r||s>=i&&s>r||r===i&&r===s&&r===a||r===i/2)return ra.create(en.VALUE);r<i?n-=r:n+=r}return nX.create(r?-n:n)}},i5.ARABIC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}},i5.ASIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}},i5.ASINH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}},i5.ATAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}},i5.ATAN2],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}},i5.ATANH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return this._handleSingleObject(e,n,i)});return 1===u.getRowCount()&&1===u.getColumnCount()?u.getArrayValue()[0][0]:u}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=t;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=r;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue()),l=Math.floor(+s.getValue());if(a<0||a>=0x20000000000000||o<2||o>36||l<0)return ra.create(en.NUM);let u=a.toString(o);return u.length<l&&(u=Array(l-u.length+1).join("0")+u),nK.create(u.toLocaleUpperCase())}},i5.BASE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a>0&&o<0)return ra.create(en.NUM);if(0===a||0===o)return nX.create(0);let l=nF(a/o,0)*o;return nX.create(l)});return 1===a.getRowCount()&&1===a.getColumnCount()?a.getArrayValue()[0][0]:a}},i5.CEILING],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nX.create(1),i=null!=r?r:nX.create(0);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,n,ra.create(en.NA)),u=ie(s,a,i,ra.create(en.NA)),c=o.map((e,t,r)=>{let n=e,i=l.get(t,r),s=u.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=+n.getValue(),o=+i.getValue(),c=+s.getValue();return 0===a||0===o?nX.create(0):this._getResult(a,o,c)});return 1===s&&1===a?c.get(0,0):c}_getResult(e,t,r){let n;return n=e<0&&0!==r?(t<0?nF(Math.abs(e)/Math.abs(t),0):-nF(Math.abs(e)/t,0))*t:(t<0?-nF(e/Math.abs(t),0):nF(e/t,0))*t,nX.create(n)}},i5.CEILING_MATH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nX.create(0);let l=(o<0?-nF(s/Math.abs(o),0):nF(s/o,0))*o;return nX.create(l)});return 1===n&&1===i?o.get(0,0):o}},i5.CEILING_PRECISE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||a<o)return ra.create(en.NUM);let l=s2(a,o);return Number.isNaN(l)||!Number.isFinite(l)?ra.create(en.NUM):nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},i5.COMBIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||0===a&&a<o)return ra.create(en.NUM);let l=s2(a+o-1,a-1);return Number.isNaN(l)||!Number.isFinite(l)?ra.create(en.NUM):nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},i5.COMBINA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}},i5.COS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}},i5.COSH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?ra.create(en.NUM):0===r?ra.create(en.DIV_BY_ZERO):t.tan().getReciprocal()}},i5.COT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:0==+t.getValue()?ra.create(en.DIV_BY_ZERO):t.tanh().getReciprocal()}},i5.COTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?ra.create(en.NUM):0===r?ra.create(en.DIV_BY_ZERO):t.sin().getReciprocal()}},i5.CSC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return 0===r?ra.create(en.DIV_BY_ZERO):Number.isNaN(r)||Number.isFinite(Math.sinh(r))?t.sinh().getReciprocal():nX.create(0)}},i5.CSCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=`${e.getValue()}`,a=Math.floor(+n.getValue());if((0,B.isRealNum)(i)&&(0>+i||+i>=0x20000000000000||!Number.isInteger(+i))||"true"===i.toLocaleLowerCase()||"false"===i.toLocaleLowerCase()||a<2||a>36)return ra.create(en.NUM);if(""===i.replace(/\s/g,""))return nX.create(0);if(!this._isValidCharForRadix(i,a))return ra.create(en.NUM);let o=Number.parseInt(i,a);return Number.isNaN(o)?ra.create(en.NUM):nX.create(o)});return 1===r&&1===n?a.get(0,0):a}_isValidCharForRadix(e,t){for(let r of e){let e=r.toUpperCase().charCodeAt(0);if(t<=10&&!(e>=48&&e<48+t)||t>10&&!(e>=48&&e<58||e>=65&&e<65+t-10))return!1}return!0}},i5.DECIMAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ra.create(en.VALUE);let n=180/Math.PI*r;return Number.isNaN(n)?ra.create(en.VALUE):nX.create(n)}},i5.DEGREES],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ra.create(en.VALUE);let n=(r<0?-nF(Math.abs(r)/2,0):nF(r/2,0))*2;return Number.isNaN(n)?ra.create(en.VALUE):0===n?nX.create(0):nX.create(n)}},i5.EVEN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}},i5.EXP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s1(Math.floor(+t.getValue()));return Number.isNaN(r)||!Number.isFinite(r)?ra.create(en.NUM):nX.create(r)}},i5.FACT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return ra.create(en.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s1(Math.floor(+t.getValue()),2);return Number.isNaN(r)||!Number.isFinite(r)?ra.create(en.NUM):nX.create(r)}},i5.FACTDOUBLE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=+i.getValue(),o=+n.getValue();if(a>0&&o<0)return ra.create(en.NUM);if(0===a)return nX.create(0);if(0===o)return ra.create(en.DIV_BY_ZERO);let l=nk(a/o,0)*o;return nX.create(l)});return 1===r&&1===n?a.get(0,0):a}},i5.FLOOR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nX.create(1),i=null!=r?r:nX.create(0),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,n,ra.create(en.NA)),u=ie(s,a,i,ra.create(en.NA)),c=o.map((e,t,r)=>{let n,i=e,s=l.get(t,r),a=u.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=+i.getValue(),c=+s.getValue(),h=+a.getValue();return 0===o||0===c?nX.create(0):(n=o<0&&0!==h?(c<0?nk(Math.abs(o)/Math.abs(c),0):-nk(Math.abs(o)/c,0))*c:(c<0?-nk(o/Math.abs(c),0):nk(o/c,0))*c,nX.create(n))});return 1===s&&1===a?c.get(0,0):c}},i5.FLOOR_MATH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nX.create(0);let l=(o<0?-nk(s/Math.abs(o),0):nk(s/o,0))*o;return nX.create(l)});return 1===n&&1===i?o.get(0,0):o}},i5.FLOOR_PRECISE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull())if(n.isArray()){let e=!1,r=ra.create(en.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:a}=this._handleSingleObject(n);if(i)return e=!0,r=s,!1;t=s5(t,a)}),e)return r}else{let{isError:e,errorObject:r,number:i}=this._handleSingleObject(n);if(e)return r;t=s5(t,i)}}return nX.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0||r>=0x20000000000000?{isError:!0,errorObject:ra.create(en.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i5.GCD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());return nX.create(r)}},i5.INT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull())if(i.isArray()){let e=!1,n=ra.create(en.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);if(s)return e=!0,n=a,!1;t=s3(t,o),r=!1}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;t=s3(t,s),r=!1}}return r?nX.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=0x20000000000000?ra.create(en.VALUE):nX.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:ra.create(en.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i5.LCM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}},i5.LN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(10);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(s<=0||o<=0)return ra.create(en.NUM);let l=Math.log(o);if(0===l)return ra.create(en.DIV_BY_ZERO);let u=Math.log(s)/l;return nX.create(u)});return 1===n&&1===i?o.get(0,0):o}},i5.LOG],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}},i5.LOG10],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ra.create(en.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return ra.create(en.VALUE);let i=s4(n);return nX.create(i)}},i5.MDETERM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ra.create(en.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return ra.create(en.VALUE);let i=function(e){let t=s4(e);return 0===t?null:1===e.length?[[1/t]]:(function(e){let t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let n=0;n<t;n++)for(let i=0;i<t;i++){let t=((n+i)%2==0?1:-1)*s4(function(e,t,r){return e.filter((e,r)=>r!==t).map(e=>e.filter((e,t)=>t!==r))}(e,n,i));r[i][n]=0===t?0:t}return r})(e).map(e=>e.map(e=>e/t))}(n);return null===i?ra.create(en.NUM):n0.createByArray(i)}},i5.MINVERSE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(n!==i)return ra.create(en.VALUE);let a=this._getMatrix(e,r,n),o=this._getMatrix(t,i,s);if(a instanceof ra)return a;if(o instanceof ra)return o;let l=s6(a,o);return n0.createByArray(l)}_getMatrix(e,t,r){let n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ra.create(en.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}return n}},i5.MMULT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}},i5.MOD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return ra.create(en.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return ra.create(en.VALUE);if(0===s)return nX.create(0);if(i>0&&s<0||i<0&&s>0)return ra.create(en.NUM);let a=nP(i/s,0)*s;return nX.create(a)}},i5.MROUND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull())if(i.isArray()){let e=!1,n=ra.create(en.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);return s?(e=!0,n=a,!1):(t+=o)>170?(e=!0,n=ra.create(en.NUM),!1):void(r*=s1(o))}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;if((t+=s)>170)return ra.create(en.NUM);r*=s1(s)}}let n=s1(t)/r;return nX.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:ra.create(en.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i5.MULTINOMIAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(e=>{let n=this._handleSingleObject(e);return n.isError()?n:t>1||r>1?n.get(0,0):n});return 1===t&&1===r?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());if(r<=0)return ra.create(en.VALUE);let n=[];for(let e=0;e<r;e++){n[e]=[];for(let t=0;t<r;t++)n[e][t]=+(e===t)}return n0.createByArray(n)}},i5.MUNIT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ra.create(en.VALUE);let n=r<0?-nF(Math.abs(r),0):nF(r,0);return Number.isNaN(n)?ra.create(en.VALUE):(Math.abs(n)%2==0&&(r<0?n--:n++),nX.create(n))}},i5.ODD],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){return nX.create(Math.PI)}},i5.PI],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}},i5.POWER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(1),r=!0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isArray()){let e=!1,n=null;if(i.iterator(i=>null!=i&&i.isError()?(e=!0,n=i,!1):!!(!i||i.isNull()||i.isString()||i.isBoolean())||void(t=t.multiply(i),r=!1)),e)return n}else{if(i.isNull())continue;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;t=t.multiply(i),r=!1}if(t.isError())return t}return r?nX.create(0):t}},i5.PRODUCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sG(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();if(Number.isNaN(o)||Number.isNaN(l))return ra.create(en.VALUE);if(0===l)return ra.create(en.DIV_BY_ZERO);let u=Math.trunc(o/l);return nX.create(u)}},i5.QUOTIENT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ra.create(en.VALUE);let n=Math.PI/180*r;return Number.isNaN(n)?ra.create(en.VALUE):nX.create(n)}},i5.RADIANS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",0)}calculate(){return nX.create(Math.random())}},i5.RAND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",0),Z(this,"maxParams",5),Z(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,i){if(null!=e&&e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=e?e:nX.create(1),a=null!=t?t:nX.create(1),o=null!=r?r:nX.create(0),l=null!=n?n:nX.create(1),u=null!=i?i:nX.create(0);return this._calculateResult(s,a,o,l,u)}_calculateResult(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1);if(1===s&&1===a)return this._calculateSingleCell(e,t,r,n,i);let o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,t,ra.create(en.NA)),u=ie(s,a,r,ra.create(en.NA)),c=ie(s,a,n,ra.create(en.NA)),h=ie(s,a,i,ra.create(en.NA));return o.map((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r),o=this._handleError(e,n,i,s,a);if(o.errorObject)return o.errorObject;let{minValue:d,maxValue:m,wholeNumberValue:g}=o,f;return g?(d=Math.ceil(d),f=Math.floor(Math.random()*((m=Math.floor(m))-d+1))+d):f=Math.random()*(m-d)+d,f<d||f>m?ra.create(en.VALUE):nX.create(f)})}_calculateSingleCell(e,t,r,n,i){let s=e;s.isArray()&&(s=s.get(0,0));let a=t;a.isArray()&&(a=a.get(0,0));let o=r;o.isArray()&&(o=o.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let u=i;u.isArray()&&(u=u.get(0,0));let c=this._handleError(s,a,o,l,u);if(c.errorObject)return c.errorObject;let{rowsValue:h,columnsValue:d,minValue:m,maxValue:g,wholeNumberValue:f}=c;if(f&&(m=Math.ceil(m))>(g=Math.floor(g)))return ra.create(en.VALUE);let p=[];for(let e=0;e<h;e++){let e=[];for(let t=0;t<d;t++)f?e.push(Math.floor(Math.random()*(g-m+1))+m):e.push(Math.random()*(g-m)+m);p.push(e)}return 1===h&&1===d?nX.create(p[0][0]):n0.createByArray(p)}_handleError(e,t,r,n,i){let s=e;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return{errorObject:s};let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let o=r;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return{errorObject:o};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let u=i;return u.isString()&&(u=u.convertToNumberObjectValue()),u.isError()?{errorObject:u}:this._getValue(s,a,o,l,u)}_getValue(e,t,r,n,i){let s=Math.floor(+e.getValue()),a=Math.floor(+t.getValue());if(0===s||0===a)return{errorObject:ra.create(en.CALC)};let o=this._rowCount-this.row,l=this._columnCount-this.column;if(s<0||a<0||s*a>1e7)return{errorObject:ra.create(en.VALUE)};if(s>o||a>l)return{errorObject:ra.create(en.REF)};let u=+r.getValue(),c=+n.getValue(),h=+i.getValue();return u>c?{errorObject:ra.create(en.VALUE)}:!h||Number.isInteger(u)&&Number.isInteger(c)?{rowsValue:s,columnsValue:a,minValue:u,maxValue:c,wholeNumberValue:h}:{errorObject:ra.create(en.VALUE)}}},i5.RANDARRAY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return ra.create(en.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return ra.create(en.VALUE);if(i>s)return ra.create(en.NUM);i=Math.ceil(i);let a=Math.floor(Math.random()*((s=Math.floor(s))-i+1))+i;return nX.create(a)}},i5.RANDBETWEEN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e);if(r)return n;let[s]=i,a=Math.floor(+s.getValue()),o=t;if(o.isString()&&(o=o.convertToNumberObjectValue()).isError())return o;let l=Math.floor(+o.getValue());if(o.isBoolean()&&(l=4*!o.getValue()),a<0||a>3999||l<0||l>4)return ra.create(en.VALUE);let u=as[l],c=u.length-1,h="";for(;a>0;){c=this._binarySearch(a,0,c,u);let e=u[c];a-=e,h+=ai.get(e)}return nK.create(h)}_binarySearch(e,t,r,n){let i=t,s=r;for(;s-i>1;){let t=Math.floor((i+s)/2),r=n[t];if(r===e)return t;r>e?s=t:i=t}return i!==s&&n[s]<=e?s:i}},i5.ROMAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}},i5.ROUND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=+l.getValue(),h=Math.trunc(+u.getValue()),d=this._roundBank(c,h);return nX.create(d)});return 1===r&&1===n?a.get(0,0):a}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;let r=10**t,n=+(e*r).toFixed(8),i=Math.floor(n),s=n-i,a=Math.round(n);return s>.49999999&&s<.50000001&&(a=i%2==0?i:i+1),t?a/r:a}},i5.ROUNDBANK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}},i5.ROUNDDOWN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}},i5.ROUNDUP],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())?t:Math.abs(+t.getValue())>=0x8000000?ra.create(en.NUM):t.cos().getReciprocal()}},i5.SEC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=0x8000000?ra.create(en.NUM):t.cosh().getReciprocal():nX.create(0)}},i5.SECH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return ra.create(en.NA);let{isError:i,errorObject:s,variants:a}=sG(e,t,r);if(i)return s;let{isError:o,errorObject:l,variants:u}=sz(...a);if(o)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=+d.getValue(),p=[];if(n.isArray()){let e=!1,t=ra.create(en.VALUE);if(n.iterator(r=>{let{isError:n,errorObject:i,coefficientsObject:s}=this._handleSingleObject(r);if(n)return e=!0,t=i,!1;let a=+s.getValue();p.push(a)}),e)return t}else{let{isError:e,errorObject:t,coefficientsObject:r}=this._handleSingleObject(n);if(e)return t;let i=+r.getValue();p.push(i)}let C=0;for(let e=0;e<p.length;e++)C+=p[e]*m**(g+e*f);return Number.isNaN(C)||!Number.isFinite(C)?ra.create(en.NUM):nX.create(C)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(null!=e&&e.isBoolean())return{isError:!0,errorObject:ra.create(en.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}},i5.SERIESSUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4),Z(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let i=e,s=null!=t?t:nX.create(1),a=null!=r?r:nX.create(1),o=null!=n?n:nX.create(1);i.isNull()&&(i=nX.create(1)),s.isNull()&&(s=nX.create(1)),a.isNull()&&(a=nX.create(1)),o.isNull()&&(o=nX.create(1));let l=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,i,ra.create(en.NA)),h=ie(l,u,s,ra.create(en.NA)),d=ie(l,u,a,ra.create(en.NA)),m=ie(l,u,o,ra.create(en.NA)),g=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._getResult(e,n,i,s,l,u)});return 1===l&&1===u?g.get(0,0):g}_getResult(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sz(e,t,r,n);if(a)return o;let[u,c,h,d]=l,m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue(),p=+d.getValue();if(m<0||g<0||m*g>1e7)return ra.create(en.VALUE);if(0===m||0===g)return ra.create(en.CALC);let C=this._rowCount-this.row,_=this._columnCount-this.column;if(m>C||g>_)return ra.create(en.REF);let y=[];for(let e=0;e<m;e++){y[e]=[];for(let t=0;t<g;t++)y[e][t]=f+(e*g+t)*p}return i>1||s>1?nX.create(y[0][0]):n0.createByArray(y)}},i5.SEQUENCE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();return s>0?nX.create(1):s<0?nX.create(-1):nX.create(0)}},i5.SIGN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}},i5.SIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}},i5.SINH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}},i5.SQRT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ra.create(en.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(r<0)return ra.create(en.NUM);let n=Math.sqrt(r*Math.PI);return nX.create(n)}},i5.SQRTPI],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255),Z(this,"needsReferenceObject",!0),Z(this,"needsFilteredOutRows",!0),Z(this,"needsFormulaDataModel",!0)}calculate(e,...t){return e.isError()?e:e.isReferenceObject()?e.toArrayValueObject().mapValue(e=>this._handleSingleObject(e,...t)):this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){let r,n=this._getIndexNumValue(e);if(n instanceof ra)return n;switch(n){case 1:r=this._average(!1,...t);break;case 2:r=this._count(!1,...t);break;case 3:r=this._counta(!1,...t);break;case 4:r=this._max(!1,...t);break;case 5:r=this._min(!1,...t);break;case 6:r=this._product(!1,...t);break;case 7:r=this._stdev(!1,...t);break;case 8:r=this._stdevp(!1,...t);break;case 9:r=this._sum(!1,...t);break;case 10:r=this._var(!1,...t);break;case 11:r=this._varp(!1,...t);break;case 101:r=this._average(!0,...t);break;case 102:r=this._count(!0,...t);break;case 103:r=this._counta(!0,...t);break;case 104:r=this._max(!0,...t);break;case 105:r=this._min(!0,...t);break;case 106:r=this._product(!0,...t);break;case 107:r=this._stdev(!0,...t);break;case 108:r=this._stdevp(!0,...t);break;case 109:r=this._sum(!0,...t);break;case 110:r=this._var(!0,...t);break;case 111:r=this._varp(!0,...t);break;default:r=ra.create(en.VALUE)}return r}_getIndexNumValue(e){let t=e?Number(e.getValue()):0;if(Number.isNaN(t))return ra.create(en.VALUE);let r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:ra.create(en.VALUE)}_average(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=nX.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return ra.create(en.VALUE);let s=i.getFilteredOutRows(),a=i.getRowData();i.iterator((t,n)=>{if(s.includes(n)||e&&this._isRowHidden(a,n))return!0;null!=t&&t.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=nX.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return ra.create(en.VALUE);let s=i.getFilteredOutRows(),a=i.getRowData();i.iterator((t,n)=>{if(s.includes(n)||e&&this._isRowHidden(a,n)||null==t||t.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nX.create(0):r.max()}_min(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nX.create(0):r.min()}_product(e,...t){let r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return nX.create(0);let n=nX.create(1);return r.iterator(e=>{n=n.multiply(e)}),n}_stdev(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ra.create(en.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ra.create(en.DIV_BY_ZERO):r.std()}_sum(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ra.create(en.DIV_BY_ZERO):r.var(1)}_varp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ra.create(en.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){var r,n;let i=[];i[0]=[];for(let s=0;s<t.length;s++){let a,o=t[s];if(o.isError())return o;if(!o.isReferenceObject())return ra.create(en.VALUE);let l=o.getFilteredOutRows(),u=o.getRowData(),c=o.getUnitId(),h=o.getSheetId(),d=null==(n=null==(r=o.getUnitData()[c])?void 0:r[h])?void 0:n.cellData;if(o.iterator((t,r,n)=>{if(l.includes(r)||e&&this._isRowHidden(u,r))return!0;let s=d.getValue(r,n);if(null!=s&&s.f||null!=s&&s.si){let e=this._formulaDataModel.getFormulaStringByCell(r,n,h,c);if(e&&e.indexOf(`${this.name}(`)>-1)return!0}return!!(null==t||t.isNull()||t.isString()||t.isBoolean())||(t.isError()?(a=t,!1):void i[0].push(t))}),null!=a&&a.isError())return a}return it(i,1,i[0].length)}_isRowHidden(e,t){let r=e[t];return!!r&&r.hd===B.BooleanNumber.TRUE}_isBlankArrayObject(e){return 0===e.getArrayValue()[0].length}},i5.SUBTOTAL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if((t=t.plus(n)).isError())break}return t}},i5.SUM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){let t=n.mapValue(t=>this._handleSingleObject(e,t,r));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(!e.isReferenceObject()||r&&!r.isReferenceObject())return ra.create(en.VALUE);let n=e.toArrayValueObject(),i=ii(n,t);i=iu(i,n,t);let s=n.getRowCount(),a=n.getColumnCount(),o=n;if(r){let e=(o=r.toArrayValueObject()).getRowCount(),t=o.getColumnCount();if(s!==e||a!==t){let e=r.getRangeData();e.endRow=e.startRow+s-1,e.endColumn=e.startColumn+a-1,r.setRangeData(e),o=r.toArrayValueObject()}}return o.pick(i).sum()}},i5.SUMIF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ra.create(en.VALUE);let{maxRowLength:r,maxColumnLength:n}=ia(t),i=io(t,e,r,n);if(i)return i;let s=il(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>e.pick(t).sum())),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(n)}},i5.SUMIFS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=this._initArray1(e);if(!(t.length>0))return r.sum();{let e=r.getRowCount(),n=r.getColumnCount(),i=this._getResultArrayByArray1(e,n,r);if(i instanceof ra)return i;for(let r=0;r<t.length;r++){if(t[r].isError())return t[r];let s=1,a=1;if(t[r].isArray()&&(s=t[r].getRowCount(),a=t[r].getColumnCount()),s!==e||a!==n)return ra.create(en.VALUE);for(let s=0;s<e;s++){let e=[];for(let a=0;a<n;a++){let n=t[r];if(t[r].isArray()&&(n=t[r].get(s,a)),n.isError())return n;let o=n.getValue();o&&(0,B.isRealNum)(o)?e.push(o*i[s][a]):e.push(0)}i[s]=e}}let s=i.reduce((e,t)=>e.concat(t)).reduce((e,t)=>e+t,0);return nX.create(s)}}_initArray1(e){let t=e;return t.isArray()||(t=n0.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){let n=[];for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.get(i,n);if(t.isError())return t;let s=t.getValue();s&&(0,B.isRealNum)(s)?e.push(+s):e.push(0)}n.push(e)}return n}},i5.SUMPRODUCT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0),r=nX.create(2);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()?i.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.plus(e.pow(r))))):t=t.plus(i.pow(r)),t.isError())break}return t}},i5.SUMSQ],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ra.create(en.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nG.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2-c**2}),i.isError()?i:0===s.length||0===a.length?ra.create(en.DIV_BY_ZERO):nX.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ra.create(en.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,B.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,B.isRealNum)(s)||n.isBoolean())return ra.create(en.DIV_BY_ZERO);let a=i**2-s**2;return nX.create(a)}},i5.SUMX2MY2],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ra.create(en.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nG.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2+c**2}),i.isError()?i:0===s.length||0===a.length?ra.create(en.DIV_BY_ZERO):nX.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ra.create(en.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,B.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,B.isRealNum)(s)||n.isBoolean())return ra.create(en.DIV_BY_ZERO);let a=i**2+s**2;return nX.create(a)}},i5.SUMX2PY2],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ra.create(en.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nG.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=(u-c)**2}),i.isError()?i:0===s.length||0===a.length?ra.create(en.DIV_BY_ZERO):nX.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ra.create(en.VALUE);let i=+r.getValue(),s=+n.getValue();return r.isString()&&!(0,B.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,B.isRealNum)(s)||n.isBoolean()?ra.create(en.DIV_BY_ZERO):nX.create((i-s)**2)}},i5.SUMXMY2],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}},i5.TAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}},i5.TANH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue(),l=10**Math.trunc(o),u=nj(s,l),c=Math.trunc(nL(s,l)+u)/l;return nX.create(c)});return 1===n&&1===i?o.get(0,0):o}},i5.TRUNC]];class lh extends ri{constructor(e){super(""),Z(this,"_values",[]),this._values=e}static create(e){return new lh(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}getCubeValues(){return this._values}getCubeCount(){return this._values.length}sum(){let e=nX.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=nX.create(-1/0);return this._values.forEach(t=>{let r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=nX.create(1/0);return this._values.forEach(t=>{let r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){let e=nX.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){let e=nX.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){let e=nX.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}let ld=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2),Z(this,"_compareType",el.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}},iU.COMPARE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:t.isArray()||0!==t.getValue()?e.divided(t):ra.create(en.DIV_BY_ZERO)}},iU.DIVIDED],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}},iU.MINUS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}},iU.MULTIPLY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}},iU.PLUS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return n;if(!n.isArray())return ra.create(en.VALUE);t.push(n)}return lh.create(t)}},iU.CUBE]];class lm extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=r.isArray()?r.getRowCount():1,a=r.isArray()?r.getColumnCount():1,o=t;t.isArray()&&1===n&&1===i&&(o=t.get(0,0));let l=r;return r.isArray()&&1===s&&1===a&&(l=r.get(0,0)),e.isArray()?e.mapValue(e=>this._handleSignleObject(e,o,l,n,i,s,a)):this._handleSignleObject(e,o,l,n,i,s,a)}_handleSignleObject(e,t,r,n,i,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let o=e;if(e.isString()&&(o=e.convertToNumberObjectValue()),o.isError())return o;let l=+o.getValue();if((n*i==1||s*a==1)&&(t.isNull()||r.isNull()))return ra.create(en.VALUE);if(n*i!=s*a)return ra.create(en.NA);let{isError:u,errorObject:c,array1Values:h,array2Values:d,noCalculate:m}=ax(t,r,n*i,i,a);if(u)return c;if(m)return ra.create(en.DIV_BY_ZERO);let g=a_(l,h,d);return Number.isFinite(g)?nX.create(g):ra.create(en.DIV_BY_ZERO)}}var lg=((P=lg||{}).AVEDEV="AVEDEV",P.AVERAGE="AVERAGE",P.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",P.AVERAGEA="AVERAGEA",P.AVERAGEIF="AVERAGEIF",P.AVERAGEIFS="AVERAGEIFS",P.BETA_DIST="BETA.DIST",P.BETA_INV="BETA.INV",P.BINOM_DIST="BINOM.DIST",P.BINOM_DIST_RANGE="BINOM.DIST.RANGE",P.BINOM_INV="BINOM.INV",P.CHISQ_DIST="CHISQ.DIST",P.CHISQ_DIST_RT="CHISQ.DIST.RT",P.CHISQ_INV="CHISQ.INV",P.CHISQ_INV_RT="CHISQ.INV.RT",P.CHISQ_TEST="CHISQ.TEST",P.CONFIDENCE_NORM="CONFIDENCE.NORM",P.CONFIDENCE_T="CONFIDENCE.T",P.CORREL="CORREL",P.COUNT="COUNT",P.COUNTA="COUNTA",P.COUNTBLANK="COUNTBLANK",P.COUNTIF="COUNTIF",P.COUNTIFS="COUNTIFS",P.COVARIANCE_P="COVARIANCE.P",P.COVARIANCE_S="COVARIANCE.S",P.DEVSQ="DEVSQ",P.EXPON_DIST="EXPON.DIST",P.F_DIST="F.DIST",P.F_DIST_RT="F.DIST.RT",P.F_INV="F.INV",P.F_INV_RT="F.INV.RT",P.F_TEST="F.TEST",P.FISHER="FISHER",P.FISHERINV="FISHERINV",P.FORECAST="FORECAST",P.FORECAST_ETS="FORECAST.ETS",P.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",P.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",P.FORECAST_ETS_STAT="FORECAST.ETS.STAT",P.FORECAST_LINEAR="FORECAST.LINEAR",P.FREQUENCY="FREQUENCY",P.GAMMA="GAMMA",P.GAMMA_DIST="GAMMA.DIST",P.GAMMA_INV="GAMMA.INV",P.GAMMALN="GAMMALN",P.GAMMALN_PRECISE="GAMMALN.PRECISE",P.GAUSS="GAUSS",P.GEOMEAN="GEOMEAN",P.GROWTH="GROWTH",P.HARMEAN="HARMEAN",P.HYPGEOM_DIST="HYPGEOM.DIST",P.INTERCEPT="INTERCEPT",P.KURT="KURT",P.LARGE="LARGE",P.LINEST="LINEST",P.LOGEST="LOGEST",P.LOGNORM_DIST="LOGNORM.DIST",P.LOGNORM_INV="LOGNORM.INV",P.MARGINOFERROR="MARGINOFERROR",P.MAX="MAX",P.MAXA="MAXA",P.MAXIFS="MAXIFS",P.MEDIAN="MEDIAN",P.MIN="MIN",P.MINA="MINA",P.MINIFS="MINIFS",P.MODE_MULT="MODE.MULT",P.MODE_SNGL="MODE.SNGL",P.NEGBINOM_DIST="NEGBINOM.DIST",P.NORM_DIST="NORM.DIST",P.NORM_INV="NORM.INV",P.NORM_S_DIST="NORM.S.DIST",P.NORM_S_INV="NORM.S.INV",P.PEARSON="PEARSON",P.PERCENTILE_EXC="PERCENTILE.EXC",P.PERCENTILE_INC="PERCENTILE.INC",P.PERCENTRANK_EXC="PERCENTRANK.EXC",P.PERCENTRANK_INC="PERCENTRANK.INC",P.PERMUT="PERMUT",P.PERMUTATIONA="PERMUTATIONA",P.PHI="PHI",P.POISSON_DIST="POISSON.DIST",P.PROB="PROB",P.QUARTILE_EXC="QUARTILE.EXC",P.QUARTILE_INC="QUARTILE.INC",P.RANK_AVG="RANK.AVG",P.RANK_EQ="RANK.EQ",P.RSQ="RSQ",P.SKEW="SKEW",P.SKEW_P="SKEW.P",P.SLOPE="SLOPE",P.SMALL="SMALL",P.STANDARDIZE="STANDARDIZE",P.STDEV_P="STDEV.P",P.STDEV_S="STDEV.S",P.STDEVA="STDEVA",P.STDEVPA="STDEVPA",P.STEYX="STEYX",P.T_DIST="T.DIST",P.T_DIST_2T="T.DIST.2T",P.T_DIST_RT="T.DIST.RT",P.T_INV="T.INV",P.T_INV_2T="T.INV.2T",P.T_TEST="T.TEST",P.TREND="TREND",P.TRIMMEAN="TRIMMEAN",P.VAR_P="VAR.P",P.VAR_S="VAR.S",P.VARA="VARA",P.VARPA="VARPA",P.WEIBULL_DIST="WEIBULL.DIST",P.Z_TEST="Z.TEST",P);class lf extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0)return ra.create(en.NUM);let a=aR(s);return 1e-15>Math.abs(a)?nX.create(0):nX.create(a)}}let lp=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0),r=nX.create(0);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((i=function(e){let t=[];t[0]=[];let r=null;return e.iterator((e,n,i)=>{if(null!=e&&e.isError())return r=e,!1;null!=e&&e.isNumber()&&t[0].push(e)}),r||it(t,1,t[0].length)}(i)).isError())return i;if(e[n]=i,(t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nX.create(1)))}if(0===r.getValue())return ra.create(en.NUM);let n=t.divided(r);if(n.isError())return n;let i=nX.create(0);for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;if(r.isArray()){if((i=i.plus(r.minus(n).abs().sum())).isError())return i}else r.isNull()||(i=i.plus(r.minus(n).abs()))}return i.divided(r)}},lg.AVEDEV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0),r=nX.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nX.create(1)))}return t.divided(r)}},lg.AVERAGE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!=0&&(t=!0,r=ra.create(en.NA));let n=[],i=[];for(let s=0;s<e.length;s+=2){let a=e[s],o=a.isArray()?a.getRowCount():1,l=a.isArray()?a.getColumnCount():1;for(let e=0;e<o;e++)for(let r=0;r<l;r++){let i=a.isArray()?a.get(e,r):a;if(i.isError())return i;if(t)continue;let s=i.isNull()?"":i.getValue();n.push(s)}if(s+1>=e.length)continue;let u=e[s+1],c=u.isArray()?u.getRowCount():1,h=u.isArray()?u.getColumnCount():1;(c!==o||h!==l)&&(t=!0,r=ra.create(en.VALUE));for(let e=0;e<c;e++)for(let r=0;r<h;r++){let n=u.isArray()?u.get(e,r):u;if(n.isError())return n;if(t)continue;let s=n.isNull()?"":n.getValue();i.push(s)}}return t?r:this._getResult(n,i)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++){let r=e[s],a=t[s];if("number"==typeof r||"number"==typeof a){if("number"!=typeof r||"number"!=typeof a||a<0)return ra.create(en.VALUE);n+=r*a,i+=a}}if(0===i)return ra.create(en.DIV_BY_ZERO);let s=n/i;return nX.create(s)}},lg.AVERAGE_WEIGHTED],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0),r=nX.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null==e||e.isNull())return!0;let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()).isError()&&(n=nX.create(0)),n.isBoolean()&&(n=n.convertToNumberObjectValue()),n.isError())return t=n,!1;t=t.plus(n),r=r.plus(nX.create(1))}),t.isError())return t}else i.isNull()||(t=t.plus(i),r=r.plus(nX.create(1)))}return t.divided(r)}},lg.AVERAGEA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject()),n.isArray()||(n=it([[n]],1,1));let i=t;return i.isReferenceObject()&&(i=i.toArrayValueObject()),r&&!(null!=r&&r.isReferenceObject())?ra.create(en.NA):i.isArray()?i.map(e=>this._handleSingleObject(n,e,r)):this._handleSingleObject(n,i,r)}_handleSingleObject(e,t,r){let n=ii(e,t);n=iu(n,e,t);let i=r?this._createRangeReferenceObject(r,e):e;if(!i)return ra.create(en.VALUE);if(i.isError())return i;i.isReferenceObject()&&(i=i.toArrayValueObject());let s=i.pick(n),a=s.sum(),o=s.count();return a.divided(o)}_createRangeReferenceObject(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(r===i&&n===s)return e;let{startRow:a,startColumn:o}=e.getRangePosition();return this.createReferenceObject(e,{startRow:a,startColumn:o,endRow:a+i-1,endColumn:o+s-1})}},lg.AVERAGEIF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ra.create(en.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ra.create(en.VALUE);let{maxRowLength:r,maxColumnLength:n}=ia(t),i=io(t,e,r,n);if(i)return i;let s=il(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t),n=r.sum(),i=r.count();return n.divided(i)})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(n)}},lg.AVERAGEIFS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=i?i:nX.create(0),o=null!=s?s:nX.create(1);a.isNull()&&(a=nX.create(0)),o.isNull()&&(o=nX.create(1));let l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,e,ra.create(en.NA)),h=ie(l,u,t,ra.create(en.NA)),d=ie(l,u,r,ra.create(en.NA)),m=ie(l,u,n,ra.create(en.NA)),g=ie(l,u,a,ra.create(en.NA)),f=ie(l,u,o,ra.create(en.NA)),p=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),a=g.get(t,r),o=f.get(t,r);return this._handleSignleObject(e,n,i,s,a,o)});return 1===l&&1===u?p.get(0,0):p}_handleSignleObject(e,t,r,n,i,s){var a;let o;if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let{isError:l,errorObject:u,variants:c}=sz(e,t,r,n,i,s);if(l)return u;let[h,d,m,g,f,p]=c,C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),R=+g.getValue(),E=+f.getValue(),b=+p.getValue();return _<=0||y<=0||C<E||C>b||E===b?ra.create(en.NUM):(o=R?aa((C-E)/(b-E),_,y):((a=(C-E)/(b-E))<=0||a>=1?0:1===_&&1===y?1:_<512&&y<512?a**(_-1)*(1-a)**(y-1)/ac(_,y):Math.exp((_-1)*Math.log(a)+(y-1)*Math.log(1-a)-ah(_,y)))/(b-E),nX.create(o))}},lg.BETA_DIST],[ak,lg.BETA_INV],[aF,lg.BINOM_DIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=n?n:r;i.isNull()&&(i=r);let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,t,ra.create(en.NA)),u=ie(s,a,r,ra.create(en.NA)),c=ie(s,a,i,ra.create(en.NA)),h=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===s&&1===a?h.get(0,0):h}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||d<0||d>1||m<0||m>h||g<0||g<m||g>h)return ra.create(en.NUM);let f=0;for(let e=m;e<=g;e++)f+=am(e,h,d);return nX.create(f)}},lg.BINOM_DIST_RANGE],[aj,lg.BINOM_INV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return c<0||h<1||h>1e10?ra.create(en.NUM):(d?n=ag(c,h):n=c<0?0:0===c&&2===h?.5:Math.exp((h/2-1)*Math.log(c)-c/2-h/2*Math.log(2)-aR(h/2)),nX.create(n))}},lg.CHISQ_DIST],[aB,lg.CHISQ_DIST_RT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return ra.create(en.NUM);let u=af(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},lg.CHISQ_INV],[a$,lg.CHISQ_INV_RT],[aH,lg.CHISQ_TEST],[aW,lg.CONFIDENCE_NORM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sz(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return ra.create(en.NUM);if(1===f)return ra.create(en.DIV_BY_ZERO);let p=Math.abs(aO(m/2,f-1)*g/Math.sqrt(f));return nX.create(p)});return 1===n&&1===i?l.get(0,0):l}},lg.CONFIDENCE_T],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ra.create(en.VALUE):ra.create(en.DIV_BY_ZERO);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++){let r=e[n]-s,i=t[n]-a;o+=r*i,l+=r**2,u+=i**2}let c=Math.sqrt(l*u);return 0===c?ra.create(en.DIV_BY_ZERO):nX.create(o/c)}},lg.CORREL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0);for(let r=0;r<e.length;r++){let n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(nX.create(1))):n.isNull()||(t=t.plus(nX.create(1))))}return t}},lg.COUNT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(nX.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(nX.create(1)))}return t}},lg.COUNTA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isError()?e:""===e.getValue()||e.isNull()?nX.create(1):e.isArray()?e.countBlank():nX.create(0)}},lg.COUNTBLANK],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?ra.create(en.NA):e.isArray()?t.isArray()?t.mapValue(t=>this._handleSingleObject(e,t)):this._handleSingleObject(e,t):ra.create(en.VALUE)}_handleSingleObject(e,t){let r=ii(e,t);r=iu(r,e,t);let n=e.pick(r);return this._countA(n)}_countA(e){let t=nX.create(0);return e.iterator(e=>{if(null==e)return!0;t=t.plusBy(1)}),t}},lg.COUNTIF],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",255)}calculate(...e){if(e.length%2!=0||e.some((e,t)=>t%2==0&&!e.isArray()))return ra.create(en.VALUE);let{maxRowLength:t,maxColumnLength:r}=ia(e),n=io(e,e[0],t,r);if(n)return n;let i=il(e,t,r,!0);return this._aggregateResults(i)}_aggregateResults(e){let t=e.map(e=>e.map(e=>{let t;return t=0,e.iterator(e=>{null!=e&&e.isBoolean()&&!0===e.getValue()&&t++}),nX.create(t)})),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(r)}},lg.COUNTIFS],[aG,lg.COVARIANCE_P],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ra.create(en.VALUE);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(e.length<=1)return ra.create(en.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nX.create(o/(r-1))}},lg.COVARIANCE_S],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[],r=0,n=!0;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ra.create(en.VALUE);if(s.iterator(s=>{let a=this._handleSingleObject(s);if(a.isError())return e=!0,i=a,!1;if(a.isNull())return!0;let o=a.getValue();t.push(o),r+=o,n=!1}),e)return i}else{let e=this._handleSingleObject(s);if(e.isError())return e;if(e.isNull())continue;let i=e.getValue();t.push(i),r+=i,n=!1}}if(n)return ra.create(en.NUM);let i=r/t.length,s=0;for(let e=0;e<t.length;e++)s+=(t[e]-i)**2;return nX.create(s)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return nG.create();let t=e.getValue();return(0,B.isRealNum)(t)?nX.create(+t):nG.create()}},lg.DEVSQ],[aY,lg.EXPON_DIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue();return d<0||m<1||m>1e10||g<1||g>1e10||Number.isNaN(i=f?ap(d,m,g):function(e,t,r){if(e<0)return 0;if(0===e&&t<2)return 1/0;if(0===e&&2===t)return 1;let n=1/ac(t/2,r/2);return(t/r)**(t/2)*e**(t/2-1)*(1+t/r*e)**(-(t+r)/2)*n}(d,m,g))||!Number.isFinite(i)?ra.create(en.NUM):nX.create(i)}},lg.F_DIST],[az,lg.F_DIST_RT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return ra.create(en.NUM);let d=aC(u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?ra.create(en.NUM):nX.create(d)}},lg.F_INV],[aX,lg.F_INV_RT],[aq,lg.F_TEST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=i.getValue();if(s<=-1||s>=1)return ra.create(en.NUM);let a=Math.log((1+s)/(1-s))/2;return nX.create(a)}},lg.FISHER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(2*s)-1,o=Math.exp(2*s)+1;return!Number.isFinite(a)&&a>0&&!Number.isFinite(o)&&o>0?nX.create(1):nX.create(a/o)}},lg.FISHERINV],[lm,lg.FORECAST],[lm,lg.FORECAST_LINEAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,values:i}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return ra.create(en.VALUE);let{values:s}=this._getValues(t,!0);0===s.length&&(s=[0]);let a=this._getNewBinsArrayValues(s),o=Array(a.length).fill(0);for(let e=0;e<i.length;e++){let t=i[e],r=a.findIndex(e=>t>e.start&&t<=e.end);o[r]++}return n0.createByArray(o.map(e=>[e]))}_getValues(e,t=!1){let r=[],n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;for(let s=0;s<n;s++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(s,n):e;if(i.isError()){if(!t)return{isError:!0,errorObject:i,values:r};continue}if(i.isNull()||i.isBoolean())continue;let a=i.getValue();(0,B.isRealNum)(a)&&r.push(+a)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){let t=e.map((e,t)=>({value:e,index:t})).sort((e,t)=>e.value-t.value),r=[];for(let e=0;e<t.length;e++){let n=t[e].index;if(0===e){r[n]={start:-1/0,end:t[e].value};continue}r[n]={start:t[e-1].value,end:t[e].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}},lg.FREQUENCY],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue();if(0===s||s<0&&s%1==0)return ra.create(en.NUM);let a=ay(s);return Number.isNaN(a)||!Number.isFinite(a)?ra.create(en.NUM):nX.create(a)}},lg.GAMMA],[aK,lg.GAMMA_DIST],[aQ,lg.GAMMA_INV],[lf,lg.GAMMALN],[lf,lg.GAMMALN_PRECISE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=aA(+i.getValue(),0,1)-.5;return nX.create(s)}},lg.GAUSS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ra.create(en.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,B.isRealNum)(a))return!0;0>=+a&&(n=!0),t*=a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,B.isRealNum)(e))continue;0>=+e&&(n=!0),t*=e,r++}}if(0===r||n)return ra.create(en.NUM);let i=t**(1/r);return nX.create(i)}},lg.GEOMEAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t,r);if(i)return s;let a=aD(e);if(a instanceof ra)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ra)return o;let l=this._getNewXsValues(o,r);if(l instanceof ra)return l;let u=null!=n?n:nz.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?ra.create(en.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aP(e,t,r,n,!0);if(s instanceof ra)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t*=a[0][l-2-r]**o[e][r];c[e].push(t)}return i&&(c=s9(c)),n0.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aL(t.flat(),i,n,!0),o=r.map(e=>e.map(e=>a*s**e));return n0.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aD(t)}},lg.GROWTH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ra.create(en.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,B.isRealNum)(a))return!0;0>=+a&&(n=!0),t+=1/a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,B.isRealNum)(e))continue;0>=+e&&(n=!0),t+=1/e,r++}}if(0===r)return ra.create(en.NA);if(n)return ra.create(en.NUM);let i=r/t;return nX.create(i)}},lg.HARMEAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",5),Z(this,"maxParams",5)}calculate(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,t,ra.create(en.NA)),u=ie(s,a,r,ra.create(en.NA)),c=ie(s,a,n,ra.create(en.NA)),h=ie(s,a,i,ra.create(en.NA)),d=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSignleObject(e,n,i,s,a)});return 1===s&&1===a?d.get(0,0):d}_handleSignleObject(e,t,r,n,i){let s,{isError:a,errorObject:o,variants:l}=sz(e,t,r,n,i);if(a)return o;let[u,c,h,d,m]=l,g=Math.floor(+u.getValue()),f=Math.floor(+c.getValue()),p=Math.floor(+h.getValue()),C=Math.floor(+d.getValue()),_=+m.getValue();return g<0||g>f||g>p||g<f-C+p||f<=0||f>C||p<=0||p>C||C<=0?ra.create(en.NUM):(Number.isNaN(s=_?function(e,t,r,n){let i=0;for(let s=0;s<=e;s++)i+=aI(s,t,r,n);return i}(g,f,p,C):aI(g,f,p,C))&&(s=0),nX.create(s))}},lg.HYPGEOM_DIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ra.create(en.VALUE):ra.create(en.DIV_BY_ZERO);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=a_(0,e,t);return Number.isFinite(r)?nX.create(r):ra.create(en.DIV_BY_ZERO)}},lg.INTERCEPT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,B.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=3?ra.create(en.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return ra.create(en.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**4;let o=r*(r+1)/((r-1)*(r-2)*(r-3))*a-3*(r-1)**2/((r-2)*(r-3));return nX.create(o)}},lg.KURT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?ra.create(en.NUM):(a=Math.ceil(a),nX.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>t-e)}},lg.LARGE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t);if(i)return s;let a=aD(e);if(a instanceof ra)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ra)return o;let l=null!=r?r:nz.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nz.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sz(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?ra.create(en.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aP(e,t,t,r,!1);if(i instanceof ra)return i;let{coefficients:s,X:a,XTXInverse:o}=i,l=[];if(n){let t=e.flat(),n=t.length,i=r?t.reduce((e,t)=>e+t,0)/n:0,u=o.length,c=n-u,h=s[0].length,d=Array(h-2).fill(en.NA),m=s[0][h-1],g=[];for(let e=0;e<a.length;e++){let t=m;for(let r=h-2;r>=0;r--)t+=s[0][h-2-r]*a[e][r];g.push(t)}let f=0,p=0;for(let e=0;e<n;e++)f+=(t[e]-i)**2,p+=(t[e]-g[e])**2;let C=f-p,_=0===f?0:C/f,y=[];for(let e=u-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*o[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(en.NA);let R=c>0?Math.sqrt(p/c):0,E=c>0?C/(h-1)/(p/c):en.NUM;l=[s[0],[...y],[_,R,...d],[E,c,...d],[C,p,...d]]}else l=[s[0]];return n0.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o}=aL(s,i,r,!1);if(Number.isNaN(a))return ra.create(en.NA);let l=[];if(n){let e=i.length,t=0,n=0,u=e-1;if(r){let r=0,a=0;for(let t=0;t<e;t++)r+=i[t],a+=s[t];t=r/e,n=a/e,u=e-2}let c=0,h=0,d=0;for(let r=0;r<e;r++)c+=(i[r]-t)**2,h+=(i[r]-(a*s[r]+o))**2,d+=(s[r]-n)**2;let m=c-h,g=m===c?1:m/c,f=0,p=0,C=0;u>0&&(d>0&&(f=Math.sqrt(h/u/d),p=Math.sqrt(h/u*(1/e+n**2/d))),C=Math.sqrt(h/u));let _=u>0?m/1/(h/u):en.NUM;r||(p=en.NA),l=[[a,o],[f,p],[g,C],[_,u],[m,h]]}else l=[[a,o]];return n0.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}},lg.LINEST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t);if(i)return s;let a=aD(e);if(a instanceof ra)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ra)return o;let l=null!=r?r:nz.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nz.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sz(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?ra.create(en.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aP(e,t,t,r,!0);if(i instanceof ra)return i;let{coefficients:s,Y:a,X:o,XTXInverse:l}=i,u=[];if(n){let e=a.flat(),t=e.length,n=r?e.reduce((e,t)=>e+t,0)/t:0,i=l.length,c=t-i,h=s[0].length,d=Array(h-2).fill(en.NA),m=s[0][h-1],g=[];for(let e=0;e<o.length;e++){let t=m;for(let r=h-2;r>=0;r--)t*=s[0][h-2-r]**o[e][r];g.push(Math.log(t))}let f=0,p=0;for(let i=0;i<t;i++)f+=(e[i]-n)**2,(r||Number.isFinite(g[i]))&&(p+=(e[i]-g[i])**2);Number.isFinite(p)||(p=0);let C=f-p,_=0===f?0:C/f,y=[];for(let e=i-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*l[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(en.NA);let R=c>0?Math.sqrt(p/c):0,E=c>0?C/(h-1)/(p/c):en.NUM;u=[s[0],[...y],[_,R,...d],[E,c,...d],[C,p,...d]]}else u=[s[0]];return n0.createByArray(u)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o,Y:l}=aL(s,i,r,!0);if(Number.isNaN(a))return ra.create(en.NA);let u=[];if(n){let e=l.length,t=0,n=0,i=e-1;if(r){let r=0,a=0;for(let t=0;t<e;t++)r+=l[t],a+=s[t];t=r/e,n=a/e,i=e-2}let c=0,h=0,d=0;for(let r=0;r<e;r++)c+=(l[r]-t)**2,h+=(l[r]-Math.log(o*a**s[r]))**2,d+=(s[r]-n)**2;let m=c-h,g=0===c?0:m/c,f=0,p=0,C=0,_=0;i>0&&(d>0&&(f=Math.sqrt(h/i/d),p=Math.sqrt(h/i*(1/e+n**2/d))),C=Math.sqrt(h/i),_=m/1/(h/i)),r||(p=en.NA),u=[[a,o],[f,p],[g,C],[_,i],[m,h]]}else u=[[a,o]];return n0.createByArray(u)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}},lg.LOGEST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<=0||g<=0?ra.create(en.NUM):(f?i=aN(d,m,g):i=d<=0?0:Math.exp(-Math.log(d)-.5*Math.log(2*Math.PI)-Math.log(g)-(Math.log(d)-m)**2/(2*g*g)),nX.create(i))}},lg.LOGNORM_DIST],[aZ,lg.LOGNORM_INV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getRangeValues(e);if(r instanceof ra)return r;let n=sH(t);if(n.isError())return n;let{isError:i,errorObject:s,variants:a}=sz(n);if(i)return s;let[o]=a,l=+o.getValue();if(l<=0||l>=1)return ra.create(en.NUM);if(r.length<2)return ra.create(en.DIV_BY_ZERO);let u=r.length,c=r.reduce((e,t)=>e+t,0)/u,h=Math.sqrt(r.reduce((e,t)=>e+(t-c)**2,0)/(u-1));if(h<=0)return ra.create(en.NUM);let d=Math.abs(aO((1-l)/2,u-1)*h/Math.sqrt(u));return nX.create(d)}_getRangeValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;n.isNull()||n.isBoolean()||n.isString()||t.push(+n.getValue())}return t}},lg.MARGINOFERROR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(-1/0);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===-1/0?nX.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(-1/0);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nX.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===-1/0?nX.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAXA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ra.create(en.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ra.create(en.VALUE);let{maxRowLength:r,maxColumnLength:n}=ia(t),i=io(t,e,r,n);if(i)return i;let s=il(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?n0.create("0"):r.max()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(n)}},lg.MAXIFS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isArray()){let e=!1,r=ra.create(en.VALUE);if(n.iterator(n=>{if(null!=n&&n.isError())return e=!0,r=n,!1;if(null!=n&&n.isNull()||null!=n&&n.isBoolean())return!0;let i=n.getValue();if(!(0,B.isRealNum)(i))return!0;t.push(+i)}),e)return r}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){let e=n.convertToNumberObjectValue();if(e.isError())return e}let e=n.getValue();if(!(0,B.isRealNum)(e))continue;t.push(+e)}}return 0===t.length?ra.create(en.NUM):this._getResult(t.sort((e,t)=>e-t))}_getResult(e){let t,r=e.length;if(r%2==0){let n=r/2;t=(e[n-1]+e[n])/2}else t=e[Math.floor(r/2)];return nX.create(t)}},lg.MEDIAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(1/0);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===1/0?nX.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=nX.create(1/0);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nX.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===1/0?nX.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MINA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ra.create(en.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ra.create(en.VALUE);let{maxRowLength:r,maxColumnLength:n}=ia(t),i=io(t,e,r,n);if(i)return i;let s=il(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?n0.create("0"):r.min()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n0.create(n)}},lg.MINIFS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,B.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new ra(en.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return 1===r.length?nX.create(r[0]):n0.createByArray(r.map(e=>[e]))}},lg.MODE_MULT],[aJ,lg.MODE_SNGL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sz(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||m<1||g<=0||g>=1?ra.create(en.NUM):(i=f?function(e,t,r){if(e<0)return 0;let n=0;for(let i=0;i<=e;i++)n+=aS(i,t,r);return n}(d,m,g):aS(d,m,g),nX.create(i))}},lg.NEGBINOM_DIST],[a0,lg.NORM_DIST],[a1,lg.NORM_INV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let r,{isError:n,errorObject:i,variants:s}=sz(e,t);if(n)return i;let[a,o]=s,l=+a.getValue();return r=+o.getValue()?aA(l,0,1):av(l,0,1),nX.create(r)}},lg.NORM_S_DIST],[a2,lg.NORM_S_INV],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ra.create(en.VALUE):ra.create(en.DIV_BY_ZERO);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return ra.create(en.DIV_BY_ZERO);let c=o/Math.sqrt(l*u);return nX.create(c)}},lg.PEARSON],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<1/(o+1)||a>1-1/(o+1))return ra.create(en.NUM);let l=a*(o+1)-1,u=Math.floor(l),c=l-u;if(0===c)return nX.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nX.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}},lg.PERCENTILE_EXC],[a5,lg.PERCENTILE_INC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nX.create(3);i.isNull()&&(i=nX.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,t,ra.create(en.NA)),l=ie(s,a,i,ra.create(en.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof ra)return e;let{isError:n,errorObject:i,variants:s}=sz(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return ra.create(en.NA);if(1===c)return l===e[0]?nX.create(1):ra.create(en.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=(m+1)/(c+1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+1+(l-e[m])/(e[m+1]-e[m]))/(c+1),d=!0),m++;return d?u<1?ra.create(en.NUM):(h=nk(h,u),nX.create(h)):ra.create(en.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}},lg.PERCENTRANK_EXC],[a3,lg.PERCENTRANK_INC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0||c<h)return ra.create(en.NUM);let d=1;for(let e=c-h+1;e<=c;e++)d*=e;return Number.isFinite(d)?nX.create(d):ra.create(en.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sz(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0)return ra.create(en.NUM);if(0===c)return 0===h?nX.create(1):nX.create(0);let d=c**h;return Number.isFinite(d)?nX.create(d):ra.create(en.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUTATIONA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(-.5*s*s)/Math.sqrt(2*Math.PI);return nX.create(a)}},lg.PHI],[a4,lg.POISSON_DIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,xRangeValues:a,probRangeValues:o}=this._handleXRangeAndProbRange(e,t),l=null!=n?n:r;null!=n&&n.isNull()&&(l=r);let u=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ie(u,c,r,ra.create(en.NA)),d=ie(u,c,l,ra.create(en.NA)),m=h.mapValue((r,n,l)=>{let u=d.get(n,l);return e.isError()?e:t.isError()?t:r.isError()?r:u.isError()?u:i?s:this._handleSignleObject(a,o,r,u)});return 1===u&&1===c?m.get(0,0):m}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(r,n);if(i)return s;let[o,l]=a,u=+o.getValue(),c=+l.getValue();if(1!==t.reduce((e,t)=>e+t,0))return ra.create(en.NUM);let h=0;for(let r=0;r<e.length;r++)e[r]>=u&&e[r]<=c&&(h+=t[r]);return nX.create(h)}_handleXRangeAndProbRange(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,xRangeValues:[],probRangeValues:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,xRangeValues:[],probRangeValues:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:ra.create(en.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!=i*s)return{isError:!0,errorObject:ra.create(en.NA),xRangeValues:[],probRangeValues:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,xRangeValues:[],probRangeValues:[]}:d?{isError:!0,errorObject:ra.create(en.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:c,probRangeValues:h}}},lg.PROB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<=0||a>=4)return ra.create(en.NUM);let o=a/4,l=e.length;if(o<1/(l+1)||o>1-1/(l+1))return ra.create(en.NUM);let u=o*(l+1)-1,c=Math.floor(u),h=u-c;if(0===h)return nX.create(e[c]);let d=e[c]+h*(e[c+1]-e[c]);return nX.create(d)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}},lg.QUARTILE_EXC],[a6,lg.QUARTILE_INC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nX.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,n,ra.create(en.NA)),h=ie(l,u,o,ra.create(en.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ra.create(en.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();return Number.isNaN(l)||Number.isNaN(u)?ra.create(en.VALUE):this._getResult(l,u,a)});return 1===l&&1===u?d.get(0,0):d}_getResult(e,t,r){let n=r.sort((e,r)=>t?e-r:r-e),i=n.indexOf(e),s=[];for(;i>=0;){let t=i+1;s.push(t),i=n.indexOf(e,t)}if(0===s.length)return ra.create(en.NA);let a=s.reduce((e,t)=>e+t,0)/s.length;return nX.create(a)}_checkRefReferenceObject(e){let t=!1,r=ra.create(en.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_AVG],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3),Z(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nX.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ie(l,u,n,ra.create(en.NA)),h=ie(l,u,o,ra.create(en.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ra.create(en.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ra.create(en.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?ra.create(en.NA):nX.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=ra.create(en.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_EQ],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ra.create(en.VALUE);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return ra.create(en.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return ra.create(en.DIV_BY_ZERO);let c=(o/Math.sqrt(l*u))**2;return nX.create(c)}},lg.RSQ],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,B.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?ra.create(en.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return ra.create(en.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=r/((r-1)*(r-2))*a;return nX.create(o)}},lg.SKEW],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,B.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?ra.create(en.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/r);if(0===s)return ra.create(en.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=a/r;return nX.create(o)}},lg.SKEW_P],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ra.create(en.VALUE):ra.create(en.DIV_BY_ZERO);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(t[n]-a)**2;if(0===l)return ra.create(en.DIV_BY_ZERO);let u=o/l;return nX.create(u)}},lg.SLOPE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?ra.create(en.NUM):(a=Math.floor(a),nX.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}},lg.SMALL],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();return h<=0?ra.create(en.NUM):nX.create((u-c)/h)}},lg.STANDARDIZE],[a9,lg.STDEV_P],[a8,lg.STDEV_S],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}},lg.STDEVA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std()}},lg.STDEVPA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ra.create(en.VALUE);if(r*n!=i*s)return ra.create(en.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=ax(e,t,r*n,n,s);return l?u:d?ra.create(en.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length;if(r<=2)return ra.create(en.DIV_BY_ZERO);let n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===u)return ra.create(en.DIV_BY_ZERO);let c=Math.sqrt((l-o**2/u)/(r-2));return Number.isNaN(c)||!Number.isFinite(c)?ra.create(en.NUM):nX.create(c)}},lg.STEYX],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sz(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return h<1?ra.create(en.NUM):(d?n=aM(c,h):n=1/(Math.sqrt(h)*ac(.5,h/2))*(1+c**2/h)**(-(h+1)/2),Number.isNaN(n)||!Number.isFinite(n)?ra.create(en.NUM):nX.create(n))}},lg.T_DIST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return ra.create(en.NUM);let u=2*aM(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},lg.T_DIST_2T],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(l<1||l>1e10)return ra.create(en.NUM);let u=aM(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},lg.T_DIST_RT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return ra.create(en.NUM);let u=aO(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ra.create(en.NUM):nX.create(u)}},lg.T_INV],[a7,lg.T_INV_2T],[oe,lg.T_TEST],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=aU(e,t,r);if(i)return s;let a=aD(e);if(a instanceof ra)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ra)return o;let l=this._getNewXsValues(o,r);if(l instanceof ra)return l;let u=null!=n?n:nz.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?ra.create(en.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aP(e,t,r,n,!1);if(s instanceof ra)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t+=a[0][l-2-r]*o[e][r];c[e].push(t)}return i&&(c=s9(c)),n0.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aL(t.flat(),i,n,!1);if(Number.isNaN(s))return ra.create(en.NA);let o=r.map(e=>e.map(e=>s*e+a));return n0.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aV(e.length,e[0].length):aD(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aD(t)}},lg.TREND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ra)return e;let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=+s.getValue();if(a<0||a>=1)return ra.create(en.NUM);let o=2*nk(e.length*a/2,0),l=e.slice(o/2,e.length-o/2),u=l.reduce((e,t)=>e+t,0)/l.length;return nX.create(u)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,B.isRealNum)(s)&&n.push(+s)}return 0===n.length?ra.create(en.NUM):n.sort((e,t)=>e-t)}},lg.TRIMMEAN],[ot,lg.VAR_P],[or,lg.VAR_S],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}},lg.VARA],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var()}},lg.VARPA],[on,lg.WEIBULL_DIST],[oi,lg.Z_TEST]],lC=Object.values(B.DataStreamTreeTokenType).filter(e=>[B.DataStreamTreeTokenType.TABLE_START,B.DataStreamTreeTokenType.TABLE_ROW_START,B.DataStreamTreeTokenType.TABLE_CELL_START,B.DataStreamTreeTokenType.TABLE_CELL_END,B.DataStreamTreeTokenType.TABLE_ROW_END,B.DataStreamTreeTokenType.TABLE_END,B.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(e)),l_=(e,t)=>B.numfmt.format(e,t,{throws:!1}),ly=e=>{let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),e.isNumber()&&(t=""!==e.getPattern()?l_(e.getPattern(),+e.getValue()):`${nH(+e.getValue())}`),t};function lR(e){let t=0;for(let r=0;r<e.length;r++)t+=lE(e,r);return t}function lE(e,t,r="ltr"){return function(e,t,r="ltr"){let n=e.charCodeAt(t);if("ltr"===r&&lb(n)&&t+1<e.length){let r=e.charCodeAt(t+1);if(lI(r))return lN(n,r)}if("rtl"===r&&lI(n)&&t-1>=0){let r=e.charCodeAt(t-1);if(lb(r))return lN(r,n)}return n}(e,t,r)>255?2:1}function lb(e){return e>=55296&&e<=56319}function lI(e){return e>=56320&&e<=57343}function lN(e,t){return((1023&e)<<10)+(1023&t)+65536}let lS=["","","","","","","","","",""],lA=["","","","","","","","","",""],lv=["","","",""],lT=["","","",""],lw=["","","",""],lM=()=>[{type:4,from:48,to:57}],lO=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],lx=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],lU=()=>({type:3,set:lO(),not:!1}),lD=()=>({type:3,set:lO(),not:!0}),lV=()=>({type:3,set:lM(),not:!1}),lL=()=>({type:3,set:lM(),not:!0}),lP=()=>({type:3,set:lx(),not:!1}),lk=()=>({type:3,set:lx(),not:!0}),lF=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function lj(e,t){var r;if(r=e,/\(\?<=.*?\)/g.test(r)&&!/\[.*?(\?<=.*?)\]/g.test(r)||/\(\?<!.*?\)/g.test(r)&&!/\[.*?(\?<!.*?)\]/g.test(r))return{isError:!0,regExp:null};try{let r=new RegExp(e,t?"ug":"u");return!function(e,t){let r,n;"[object RegExp]"===Object.prototype.toString.call(e)?r=e.source:e&&"string"!=typeof e&&(r=`${e}`);try{n=function(e){let t={type:0,stack:[]},r=t,n=t.stack,i=[],s=[],a=0,o=t=>{throw SyntaxError(`Invalid regular expression: /${e}/: Nothing to repeat at column ${t-1}`)},l=e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(e,t,r,n,i,s,a)=>{if(r)return e;let o=String.fromCharCode(t?8:n?Number.parseInt(n,16):i?Number.parseInt(i,16):s?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):({0:0,t:9,n:10,v:11,f:12,r:13})[a]);return/[[\]{}^$.|?*+()]/.test(o)?`\\${o}`:o}),u=0,c;for(;u<l.length;)switch(c=l[u++]){case"\\":if(u===l.length)throw SyntaxError(`Invalid regular expression: /${e}/: \\ at end of pattern`);switch(c=l[u++]){case"b":n.push({type:2,value:"b"});break;case"B":n.push({type:2,value:"B"});break;case"w":n.push(lU());break;case"W":n.push(lD());break;case"d":n.push(lV());break;case"D":n.push(lL());break;case"s":n.push(lP());break;case"S":n.push(lk());break;default:if(/\d/.test(c)){for(;/\d/.test(l[u])&&u<l.length;)c+=l[u++];let e=Number.parseInt(c,10);n.push({type:6,value:e}),s.push({reference:{type:6,value:e},stack:n,index:n.length-1})}else n.push({type:7,value:c.charCodeAt(0)})}break;case"^":n.push({type:2,value:"^"});break;case"$":n.push({type:2,value:"$"});break;case"[":{let t="^"===l[u];t&&u++;let r=function(e,t){let r,n=[],i=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;null!==(r=i.exec(e));){let e=null,[,t,s,a,o,l,u,c,h,d,m]=r;if(t||s||a||o||l||u?e=(()=>{let e={type:3,set:[],not:!1};return t?e=lU():s?e=lV():a?e=lP():o?e=lD():l?e=lL():u&&(e=lk()),e})():c&&m?e={type:4,from:(h||d).charCodeAt(0),to:m.charCodeAt(m.length-1)}:r[16]&&(e={type:7,value:r[16].charCodeAt(0)}),!e)return[n,i.lastIndex];n.push(e)}throw SyntaxError(`Invalid regular expression: /${t}/: Unterminated character class`)}(l.slice(u),e);u+=r[1],n.push({type:3,set:r[0],not:t});break}case".":n.push(lF());break;case"(":{let t={type:1,stack:[],remember:!0};if("?"===l[u]){let r=l[u+1];if(u+=2,"="===r)t.followedBy=!0;else if("!"===r)t.notFollowedBy=!0;else if(":"!==r)throw SyntaxError(`Invalid regular expression: /${e}/: Invalid group, character '${r}' after '?' at column ${u-1}`);t.remember=!1}else a+=1;n.push(t),i.push(r),r=t,n=t.stack;break}case")":if(0===i.length)throw SyntaxError(`Invalid regular expression: /${e}/: Unmatched ) at column ${u-1}`);n=(r=i.pop()).options?r.options[r.options.length-1]:r.stack;break;case"|":{r.options||(r.options=[r.stack],delete r.stack);let e=[];r.options.push(e),n=e;break}case"{":{let e=/^(\d+)(,(\d+)?)?\}/.exec(l.slice(u));if(e){0===n.length&&o(u);let t=Number.parseInt(e[1],10),r=e[2]?e[3]?Number.parseInt(e[3],10):1/0:t;u+=e[0].length,n.push({type:5,min:t,max:r,value:n.pop()})}else n.push({type:7,value:123});break}case"?":0===n.length&&o(u),n.push({type:5,min:0,max:1,value:n.pop()});break;case"+":0===n.length&&o(u),n.push({type:5,min:1,max:1/0,value:n.pop()});break;case"*":0===n.length&&o(u),n.push({type:5,min:0,max:1/0,value:n.pop()});break;default:n.push({type:7,value:c.charCodeAt(0)})}if(i.length>0)throw SyntaxError(`Invalid regular expression: /${e}/: Unterminated group`);return function(e,t){for(let r of e.reverse()){let e=r.reference.value;if(t<e){r.reference.type=7;let t=e.toString();if(r.reference.value=Number.parseInt(t,8),!/^[0-7]+$/.test(t)){let e=0;for(;"8"!==t[e]&&"9"!==t[e]&&e<t.length;)e+=1;if(0===e?(r.reference.value=t.charCodeAt(0),e+=1):r.reference.value=Number.parseInt(t.slice(0,e),8),t.length>e){let n=r.stack.splice(r.index+1);for(let n of t.slice(e))r.stack.push({type:7,value:n.charCodeAt(0)});r.stack.push(...n)}}}}}(s,a),t}(r)}catch{return!1}let i=0,s=(e,t)=>{let r=t;if(5===e.type&&(r++,i++,r>1||i>25))return!1;if(e.options){for(let t of e.options)if(!s({stack:t},r))return!1}let n=e.stack||e.value&&e.value.stack;if(!n)return!0;for(let e of n)if(!s(e,r))return!1;return!0};return s(n,0)}(r)?{isError:!0,regExp:null}:{isError:!1,regExp:r}}catch{return{isError:!0,regExp:null}}}let lB=Object.values(B.DataStreamTreeTokenType).filter(e=>[B.DataStreamTreeTokenType.TABLE_START,B.DataStreamTreeTokenType.TABLE_ROW_START,B.DataStreamTreeTokenType.TABLE_CELL_START,B.DataStreamTreeTokenType.TABLE_CELL_END,B.DataStreamTreeTokenType.TABLE_ROW_END,B.DataStreamTreeTokenType.TABLE_END,B.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(e)),l$=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString(),r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);12288===n?n=32:n>=65281&&n<=65374&&(n-=65248),r+=String.fromCharCode(n)}return nK.create(r)}},i3.ASC],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(0);if(null!=t&&t.isNull()&&(r=nX.create(0)),r.isArray()){let t=r.mapValue(t=>this._handleSingleObject(e,t));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){let r=this._checkArray(e);if(r.isError())return r;let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,c="";for(let t=0;t<l;t++)for(let r=0;r<u;r++){let n=e.isArray()?e.get(t,r):e,i=`${n.getValue()}`;n.isNull()&&(i=""),n.isBoolean()&&(i=i.toLocaleUpperCase()),n.isString()&&o?c+=`"${i}"`:c+=i,t===l-1&&r===u-1||(o?r===u-1?c+=";":c+=",":c+=", ")}return o&&(c=`{${c}}`),c.length>32767?ra.create(en.CALC):nK.create(c)}_checkArray(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}},i3.ARRAYTOTEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.abs(Number.parseInt(s.toString(),10)),o=Number.parseFloat((Math.abs(s)-a).toFixed(2)),l="";return l=0===a?0!==o?`${s<0?"":""}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`:"":0===o?`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}\u{E16}\u{E49}\u{E27}\u{E19}`:`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`,nK.create(l)}_convertNumberToThaiText(e){let t=["","","","","","",""],r=["","","","","","","","","",""],n=e.toString(),i=n.length,s="";for(let e=i;e>0;e--){let a=Number.parseInt(n.charAt(i-e),10),o=r[a],l=e>1?(e-1)%6:6;if(1===l&&2===a&&(o=""),1===a)switch(l){case 0:case 6:s+=e<i?"":o;break;case 1:break;default:s+=o}else if(0===a){0===l&&(s+=t[l]);continue}else s+=o;s+=t[l]}return s}},i3.BAHTTEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<=0)return ra.create(en.VALUE);let a=String.fromCharCode(s);return lC.some(e=>e===a)&&(a="\x01"),nK.create(a)}},i3.CHAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return nK.create("");let t=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return nK.create(t)}},i3.CLEAN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),""===t)return ra.create(en.VALUE);let r=t.charCodeAt(0);return nX.create(r)}},i3.CODE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t="",r=null;for(let n of e)if(n.isArray()){if(n.iterator(e=>!!(null==e||e.isNull())||(e.isError()?(r=e,!1):void(e.isBoolean()?t+=`${e.getValue()}`.toLocaleUpperCase():(e.isString()||e.isNumber())&&(t+=e.getValue())))),r)return r}else n.isError()||n.isNull()||(t+=n.getValue());return nK.create(t)}},i3.CONCAT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(e=>{e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1))});let n=null;for(let i of e)n=ie(t,r,i,ra.create(en.NA)).mapValue((e,t,r)=>{let i=n&&n.get(t,r);if(null!=i&&i.isError())return i;if(e.isError())return e;let s=null==i?void 0:i.getValue(),a=null==e?void 0:e.getValue();null!=i&&i.isBoolean()&&(s=`${s}`.toLocaleUpperCase()),null!=e&&e.isBoolean()&&(a=`${a}`.toLocaleUpperCase());let o=null!=i&&i.isNull()?"":null!=s?s:"",l=null!=e&&e.isNull()?"":null!=a?a:"";return nK.create(`${o}${l}`)});return n||ra.create(en.VALUE)}},i3.CONCATENATE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nK.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);n>=33&&n<=126?r+=String.fromCharCode(n+65248):32===n?r+="":r+=t.charAt(e)}return nK.create(r)}},i3.DBCS],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2),Z(this,"needsLocale",!0)}calculate(e,t){let r=null!=t?t:nX.create(2);r.isNull()&&(r=nX.create(2));let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.trunc(+a.getValue());if(l>127)return ra.create(en.VALUE);l<0&&(o=`${o}`.length<Math.abs(l)?0:o<0?-nP(Math.abs(o),l):nP(o,l),l=0);let u=function(e,t,r=2){return B.numfmt.format(re(e,r),t)}(this.getLocale(),o,l);return nK.create(u)}},i3.DOLLAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,nG.create()),s=ie(r,n,t,nG.create()),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){let r=e.isNull()&&t.isNull();return nz.create(r)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());let i=r===n;return nz.create(i)}},i3.EXACT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ra.create(en.VALUE);if(e.isNull()||0===n.length)return nX.create(u);let c=i.indexOf(n,u-1);return -1===c?ra.create(en.VALUE):nX.create(c+1)}},i3.FIND],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ra.create(en.VALUE);if(e.isNull()||0===n.length)return nX.create(u);let c=i.indexOf(n,u-1);if(-1===c)return ra.create(en.VALUE);let h=lR(i.substring(0,c))+1;return nX.create(h)}},i3.FINDB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nX.create(2);n.isNull()&&(n=nX.create(2));let i=null!=r?r:nz.create(!1);i.isNull()&&(i=nz.create(!1));let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ie(s,a,e,ra.create(en.NA)),l=ie(s,a,n,ra.create(en.NA)),u=ie(s,a,i,ra.create(en.NA)),c=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===s&&1===a?c.get(0,0):c}_handleSingleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sz(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.trunc(+o.getValue()),h=+l.getValue();if(c>127)return ra.create(en.VALUE);c<0&&(u=`${u}`.length<Math.abs(c)?0:u<0?-nP(Math.abs(u),c):nP(u,c),c=0);let d=h?"###0":"#,##0";c>0&&(d+=`.${"0".repeat(c)}`);let m=l_(d,u);return nK.create(m)}},i3.FIXED],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ra.create(en.VALUE);if(e.isNull()||0===o)return nK.create("");if(o>=r.length)return nK.create(r);let l=r.substring(0,o);return nK.create(l)}},i3.LEFT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,nG.create()),a=ie(n,i,r,nG.create()),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ra.create(en.VALUE);if(e.isNull()||0===o)return nK.create("");let l=0,u=0,c="";for(;u<o&&l<r.length;)u+=lE(r,l),c+=r.charAt(l),l++;return nK.create(c)}},i3.LEFTB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=ly(e);return nX.create(t.length)}},i3.LEN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=lR(ly(e));return nX.create(t)}},i3.LENB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nK.create("");let t=`${e.getValue()}`.toLocaleLowerCase();return nK.create(t)}},i3.LOWER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ra.create(en.VALUE);if(e.isNull()||u>n.length||0===c)return nK.create("");let h=n.substring(u-1,u-1+c);return nK.create(h)}},i3.MID],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,t,ra.create(en.NA)),o=ie(n,i,r,ra.create(en.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ra.create(en.VALUE);if(e.isNull()||u>n.length||0===c)return nK.create("");n=n.substring(u-1);let h=0,d=0,m="";for(;d<c&&h<n.length;)d+=lE(n,h),m+=n.charAt(h),h++;return nK.create(m)}},i3.MIDB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSingleObject(e,t){let r=e.convertToNumberObjectValue();if(r.isError())return r;let n=t.convertToNumberObjectValue();if(n.isError())return n;let i=r.getValue(),s=Math.trunc(n.getValue());if(i<0||![1,2,3].includes(s))return ra.create(en.NUM);let a=(i=Math.round(i)).toString(),o=a.length,l="",u=!1;for(let e=0;e<o;e++){let t=Number(a[e]);if(1===o&&0===t){l+=2===s?lA[0]:lS[0];break}if(3===s){l+=lS[t];continue}let r=o-e-1,n=r%4,i=Math.trunc(r/4);if(o>=17&&i>2){if(l+=1===s?lS[t]:lA[t],i>3)continue}else 0===t?u=0!==n:(u&&(l+=1===s?lS[0]:lA[0],u=!1),l+=1===s?lS[t]+lv[n]:lA[t]+lT[n]);0===n&&i>0&&"0000"!==a.slice(Math.max(0,e-3),e+1)&&(l+=lw[i])}return nK.create(l)}},i3.NUMBERSTRING],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nK.create("."),i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,n,ra.create(en.NA)),l=r?ie(i,s,r,ra.create(en.NA)):void 0,u=a.mapValue((e,t,n)=>{let i=o.get(t,n),s=r?l.get(t,n):void 0;return e.isError()?e:i.isError()?i:null!=s&&s.isError()?s:i.isNull()||null!=s&&s.isNull()?ra.create(en.VALUE):e.isNull()?nX.create(0):this._handleSingleObject(e,i,s)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n,i=`${e.getValue()}`;i=i.replace(/\s+/g,"");let s=`${t.getValue()}`;if(t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0),r&&(n=`${r.getValue()}`,r.isBoolean()&&(n=n.toLocaleUpperCase()),s===(n=n.charAt(0))))return ra.create(en.VALUE);if(""===i.trim())return nX.create(0);if(!i.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return ra.create(en.VALUE);let a=i.split(s);if(a.length>2)return ra.create(en.VALUE);let o=a[0].replace(/,/g,"");r&&(o=o.split(n).join(""));let l=0;if(1===a.length){","===s&&(o=o.replace(/\./g,""));let e=0;for(;o.endsWith("%");)o=o.slice(0,-1),e++;l=e>0?o/100**e:+o}else{if(!(0,B.isRealNum)(o))return ra.create(en.VALUE);let e=a[1],t=0;for(;e.endsWith("%");)e=e.slice(0,-1),t++;let r=`${o}.${e}`;if(!(0,B.isRealNum)(r))return ra.create(en.VALUE);l=t>0?r/100**t:+r}return Number.isNaN(l)?ra.create(en.VALUE):nX.create(l)}},i3.NUMBERVALUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lj(l=`${l}`,!1);if(u)return ra.create(en.REF);let h=o.match(c);if(null===h)return ra.create(en.NA);if(h.length>1){let e=h.slice(1).map(e=>nK.create(e));return e.length>1?n0.create({calculateValueList:[e],rowCount:1,columnCount:e.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):e[0]}return nK.create(h[0])}},i3.REGEXEXTRACT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lj(l=`${l}`,!1);return u?ra.create(en.REF):null===o.match(c)?nz.create(!1):nz.create(!0)}},i3.REGEXMATCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sW(e,t,r);if(n)return i;let[a,o,l]=s,u=a.getValue();a.isNull()&&(u=""),a.isBoolean()&&(u=u?"TRUE":"FALSE"),u=`${u}`;let c=o.getValue();o.isNull()&&(c=""),o.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let h=l.getValue();l.isNull()&&(h=""),l.isBoolean()&&(h=h?"TRUE":"FALSE"),h=`${h}`;let{isError:d,regExp:m}=lj(c,!0);if(d)return ra.create(en.REF);let g=u.replace(m,h);return nK.create(g)}},i3.REGEXREPLACE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,e=>e.toLocaleUpperCase());return nK.create(t)}},i3.PROPER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ra.create(en.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1)+d+h.substring(u-1+c);return nK.create(m)}},i3.REPLACE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",4),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=ie(i,s,n,ra.create(en.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sz(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ra.create(en.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1);h=h.substring(u-1);let g=0,f=0;for(;f<c&&g<h.length;)f+=lE(h,g),g++;return m+=d+h.substring(g),nK.create(m)}},i3.REPLACEB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e,ra.create(en.NA)),s=ie(r,n,t,ra.create(en.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;let i=e.getValue();if(e.isNull()&&(i=""),e.isBoolean()&&(i=i?"TRUE":"FALSE"),i+="",n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=Math.floor(+n.getValue());if(a<0||a>32767/i.length)return ra.create(en.VALUE);let o=i.repeat(a);return nK.create(o)});return 1===r&&1===n?a.get(0,0):a}},i3.REPT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ra.create(en.VALUE);if(e.isNull()||0===o)return nK.create("");if(o>=r.length)return nK.create(r);let l=r.substring(r.length-o);return nK.create(l)}},i3.RIGHT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ra.create(en.VALUE);if(e.isNull()||0===o)return nK.create("");let l=r.length-1,u=0,c="";for(;u<o&&l>=0;)u+=lE(r,l,"rtl"),c=r.charAt(l)+c,l--;return nK.create(c)}},i3.RIGHTB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ra.create(en.VALUE);if(e.isNull()||0===n.length)return nX.create(u);let c=i.indexOf(n,u-1);return -1===c?ra.create(en.VALUE):nX.create(c+1)}},i3.SEARCH],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nX.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,n,ra.create(en.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sz(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ra.create(en.VALUE);if(e.isNull()||0===n.length)return nX.create(u);let c=i.indexOf(n,u-1);if(-1===c)return ra.create(en.VALUE);let h=lR(i.substring(0,c))+1;return nX.create(h)}},i3.SEARCHB],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,null!=n&&n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,null!=n&&n.isArray()?n.getColumnCount():1),a=ie(i,s,e,ra.create(en.NA)),o=ie(i,s,t,ra.create(en.NA)),l=ie(i,s,r,ra.create(en.NA)),u=n?ie(i,s,n,ra.create(en.NA)):void 0,c=a.mapValue((e,t,r)=>{let i=o.get(t,r),s=l.get(t,r),a=n?u.get(t,r):void 0;return e.isError()?e:i.isError()?i:s.isError()?s:null!=a&&a.isError()?a:null!=a&&a.isNull()||null!=a&&a.isBoolean()?ra.create(en.VALUE):(null!=a&&a.isString()&&(a=a.convertToNumberObjectValue()),null!=a&&a.isError()?a:this._handleSingleObject(e,i,s,a))});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let i=this._getObjectString(e),s=this._getObjectString(t),a=this._getObjectString(r),o=n?Math.floor(+n.getValue()):void 0;if(n&&o<=0)return ra.create(en.VALUE);if(""===s)return nK.create(i);let l="",u=0;for(let e=0;e<i.length;e++){let t=i.substr(e,s.length);if(t===s||t.length===s.length&&t.trim()===s.trim()){if(++u===o){l=i.substr(0,e)+a+i.substr(e+s.length);break}void 0===o&&(l+=a),e+=s.length-1}else void 0===o&&(l+=i[e])}return o&&u<o&&(l=i),nK.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}},i3.SUBSTITUTE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1),Z(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?nK.create(""):e}},i3.T],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",2)}isArgumentsIgnoreNumberPattern(){return!0}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ie(r,n,e),s=ie(r,n,t),a=i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r)||nK.create(" ");if(n.isError())return n;if(n.isBoolean())return ra.create(en.VALUE);if(e.isBoolean())return e;let i=e.getValue();if(e.isNull()&&(i=0),e.isString()){if(!(0,B.isRealNum)(i))return e;i=Number(i)}n.isNull()&&(n=nK.create(" "));let a=`${n.getValue()}`,o=l_(a,i);return nK.create(" "===a?o.trimEnd():o)});return 1===a.getRowCount()&&1===a.getColumnCount()?a.get(0,0):a}},i3.TEXT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nX.create(1);o.isNull()&&(a=!0,o=nX.create(1));let l=null!=n?n:nX.create(0),u=null!=i?i:nX.create(0),c=null!=s?s:ra.create(en.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=ie(h,d,e,ra.create(en.NA)),g=ie(h,d,o,ra.create(en.NA)),f=ie(h,d,l,ra.create(en.NA)),p=ie(h,d,u,ra.create(en.NA)),C=ie(h,d,c,ra.create(en.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof ra)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof ra)return C;let[_,y,R]=C;return 0===_||y<0||y>1||R<0||R>1?ra.create(en.VALUE):p.includes("")?_>0?nK.create(f):nK.create(""):!a&&Math.abs(_)>f.length?ra.create(en.VALUE):p.every(e=>e.length>f.length)?ra.create(en.NA):this._getResult(f,p,_,y,R,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nz.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),h=e.length,c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return ra.create(en.NA);if(!c||c<Math.abs(r))return i?r>0?nK.create(""):nK.create(e):s;let d=e.substr(u+h);return nK.create(d)}},i3.TEXTAFTER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nX.create(1);o.isNull()&&(a=!0,o=nX.create(1));let l=null!=n?n:nX.create(0),u=null!=i?i:nX.create(0),c=null!=s?s:ra.create(en.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=ie(h,d,e,ra.create(en.NA)),g=ie(h,d,o,ra.create(en.NA)),f=ie(h,d,l,ra.create(en.NA)),p=ie(h,d,u,ra.create(en.NA)),C=ie(h,d,c,ra.create(en.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof ra)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof ra)return C;let[_,y,R]=C;return 0===_||y<0||y>1||R<0||R>1?ra.create(en.VALUE):p.includes("")?_>0?nK.create(""):nK.create(f):!a&&Math.abs(_)>f.length?ra.create(en.VALUE):p.every(e=>e.length>f.length)?ra.create(en.NA):this._getResult(f,p,_,y,R,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nz.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=ra.create(en.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return ra.create(en.NA);if(!c||c<Math.abs(r))return i?r>0?nK.create(e):nK.create(""):s;let d=e.substr(0,u);return nK.create(d)}},i3.TEXTBEFORE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",3),Z(this,"maxParams",255)}calculate(e,t,...r){let n=this._getDelimiterValues(e),i=this._getTextValues(r);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(n,e,i));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}if(t.isString()){let e=`${t.getValue()}`.toLocaleUpperCase();if("TRUE"===e)return this._handleSingleObject(n,nz.create(!0),i);if("FALSE"===e)return this._handleSingleObject(n,nz.create(!1),i)}return this._handleSingleObject(n,t,i)}_handleSingleObject(e,t,r){if(e instanceof ra)return e;let{isError:n,errorObject:i,variants:s}=sz(t);if(n)return i;if(r instanceof ra)return r;let[a]=s,o=+a.getValue(),l=r;o&&(l=r.filter(e=>null!==e));let u="";for(let t=0;t<l.length;t++)null!==l[t]&&(u+=l[t]),t<l.length-1&&(u+=e[t%e.length]);return nK.create(u)}_getDelimiterValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;let s=`${n.getValue()}`;n.isNull()&&(s=""),n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}return t}_getTextValues(e){let t=[];for(let r of e){let e=r.isArray()?r.getRowCount():1,n=r.isArray()?r.getColumnCount():1;for(let i=0;i<e;i++)for(let e=0;e<n;e++){let n=r.isArray()?r.get(i,e):r;if(n.isError())return n;if(n.isNull()){t.push(null);continue}let s=`${n.getValue()}`;n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}}return t}},i3.TEXTJOIN],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",2),Z(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=r?r:nK.create("\\s"),o=null!=n?n:nX.create(0),l=null!=i?i:nX.create(0),u=null!=s?s:nK.create(en.NA),{_variant:c,values:h}=this._getStringValues(t),{_variant:d,values:m}=this._getStringValues(a,!1);a=d;let g=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),p=ie(g,f,e,ra.create(en.NA)),C=ie(g,f,o,ra.create(en.NA)),_=ie(g,f,l,ra.create(en.NA)),y=this._getResultArray(p,c,a,C,_,u,h,m);return 1===g&&1===f?y.get(0,0):y.map(e=>e.get(0,0))}_getStringValues(e,t=!0){let r=e,n=[];if(r.isArray())r.iterator(e=>{if(null!=e&&e.isError())return r=e,!1;if(null!=e&&e.isNull()&&t)return r=ra.create(en.VALUE),!1;let i=this._getRegExpStringValue(e);if(""===i)return r=ra.create(en.VALUE),!1;n.push(i)});else{r.isNull()&&t&&(r=ra.create(en.VALUE));let e=this._getRegExpStringValue(r);""===e&&(r=ra.create(en.VALUE)),n.push(e)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=n.get(l,u),h=i.get(l,u),d=this._checkVariantsError(e,t,r,c,h);if(d.isError())return d;if(e.isNull())return ra.create(en.VALUE);let m=s;if(m.isArray()){let e=m.getRowCount(),t=m.getColumnCount();if(e>1||t>1)return ra.create(en.VALUE);m=m.get(0,0)}let g=`${e.getValue()}`;if(e.isBoolean()&&(g=g.toLocaleUpperCase()),c.isString()&&(c=c.convertToNumberObjectValue()).isError())return c;let f=Math.floor(+c.getValue());if(h.isString()&&(h=h.convertToNumberObjectValue()).isError())return h;let p=Math.floor(+h.getValue());if(p<0||p>1)return ra.create(en.VALUE);let C=`${m.getValue()}`;return m.isBoolean()&&(C=C.toLocaleUpperCase()),this._getResult(g,a,o,f,p,C)})}_getResult(e,t,r,n,i,s){let a=RegExp(r.join("|"),`g${i?"i":""}`),o=RegExp(t.join("|"),`g${i?"i":""}`),l=e.split(a),u=1,c=l.map(e=>{let t=e.split(o);return n&&(t=t.filter(e=>""!==e)),u=Math.max(u,t.length),t});return c=c.map(e=>{let t=e;return t.length<u&&(t=t.concat(Array(u-t.length).fill(s))),t}),n0.createByArray(c)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nz.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},i3.TEXTSPLIT],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nK.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),nK.create(t)}},i3.TRIM],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sz(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<1||s>1114111)return ra.create(en.VALUE);if(1114111===s||1114110===s)return ra.create(en.NA);let a=String.fromCharCode(s);return lB.some(e=>e===a)&&(a="\x01"),nK.create(a)}},i3.UNICHAR],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return ra.create(en.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());let r=t.charCodeAt(0);return nX.create(r)}},i3.UNICODE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nK.create("");let t=`${e.getValue()}`.toLocaleUpperCase();return nK.create(t)}},i3.UPPER],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return ra.create(en.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()).isError())return t;let r=+t.getValue();return nX.create(r)}},i3.VALUE],[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nX.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ie(n,i,e,ra.create(en.NA)),a=ie(n,i,r,ra.create(en.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sz(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>1)return ra.create(en.VALUE);if(e.isNull())return nK.create("");if(e.isBoolean())return e;if(e.isNumber())return nX.create(e.getValue());let o=a?`"${e.getValue()}"`:`${e.getValue()}`;return nK.create(o)}},i3.VALUETOTEXT]],lH=[];var lW=lW||{};class lG extends B.Disposable{constructor(){super(...arguments),Z(this,"_tableMap",new Map),Z(this,"_tableOptionMap",new Map)}dispose(){super.dispose(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;null==(r=this._tableMap.get(e))||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;null==this._tableMap.get(e)&&this._tableMap.set(e,new Map),null==(n=this._tableMap.get(e))||n.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}}let lY=(0,$.createIdentifier)("univer.formula.super-table.service");function lz(e){return e.map(e=>e.map(e=>"number"==typeof e?nH(e):e))}function lX(e,t=!1){if(e.isReferenceObject()){let r=e.toArrayValueObject().toValue();return t?lz(r):r}if(e.isArray()){let r=e.toValue();return t?lz(r):r}if(e.isNumber()){let r=e.getValue();return t?nH(r):r}return e.getValue()}var lq=((k=lq||{}).ENCODEURL="ENCODEURL",k.FILTERXML="FILTERXML",k.WEBSERVICE="WEBSERVICE",k);let lK=[[class extends sX{constructor(){super(...arguments),Z(this,"minParams",1),Z(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=encodeURIComponent(ly(e)).replace(/[!~'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return nK.create(t)}},lq.ENCODEURL]];class lQ extends B.Disposable{constructor(){super(...arguments),Z(this,"_allSubjects",[]),Z(this,"_computingStatus$",new(0,H.BehaviorSubject)(!0)),Z(this,"computingStatus$",this._computingStatus$.pipe((0,G.distinctUntilChanged)())),Z(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),null==(e=this._computingSubscription)||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(e=>{e.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{let t=this._allSubjects.indexOf(e);-1!==t&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if(null==(e=this._computingSubscription)||e.unsubscribe(),0===this._allSubjects.length)return void this._computingStatus$.next(!0);this._computingSubscription=(0,W.combineLatest)(this._allSubjects).pipe((0,Y.map)(e=>e.every(e=>e))).subscribe(e=>this._computingStatus$.next(e))}}var lZ=Object.getOwnPropertyDescriptor,lJ=(e,t)=>(r,n)=>t(r,n,e);let l0=class extends B.Disposable{constructor(e,t){super(),Z(this,"_computingCompleted$",new(0,z.Observable)(e=>{this._commandService.onCommandExecuted(t=>{if(t.id!==tm.id)return;let r=t.params;if(r.stageInfo)return e.next(r.stageInfo.stage===iC.IDLE||r.stageInfo.stage===iC.CALCULATION_COMPLETED)})}).pipe((0,G.distinctUntilChanged)(),(0,X.shareReplay)())),this._commandService=e,this._globalComputingSrv=t;let r=new(0,B.DisposableCollection),n=new(0,H.BehaviorSubject)(!0);r.add(this._globalComputingSrv.pushComputingStatusSubject(n)),r.add(this._computingCompleted$.subscribe(e=>n.next(e))),r.add(()=>n.complete()),this.disposeWithMe(r)}};l0=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?lZ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([lJ(0,B.ICommandService),lJ(1,(0,$.Inject)(lQ))],l0);var l1=Object.getOwnPropertyDescriptor,l2=(e,t)=>(r,n)=>t(r,n,e);let l5=class extends B.Disposable{constructor(e,t,r,n){super(),this._commandService=e,this._functionService=t,this._configService=r,this._dataSyncPrimaryController=n,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[tf,eG,th,td,tm,tg,to,tl,tu,tc,tp,tC,t_,ty,tR,eW].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)})}_registerFunctions(){var e;let t=this._configService.getConfig(t$),r=[...sK,...oa,...oo,...op,...oB,...oW,...le,...lr,...ls,...lo,...lc,...ld,...lp,...l$,...lH,...lK].concat(null!=(e=null==t?void 0:t.function)?e:[]).map(e=>new e[0](e[1]));this._functionService.registerExecutors(...r)}};l5=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l2(0,B.ICommandService),l2(1,iO),l2(2,B.IConfigService),l2(3,(0,$.Optional)(K.DataSyncPrimaryController))],l5);var l3=Object.getOwnPropertyDescriptor,l4=(e,t)=>(r,n)=>t(r,n,e);let l6=class extends B.Disposable{constructor(e,t,r){super(),this._commandService=e,this._dependencyManagerService=t,this._featureCalculationManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(e=>{let{unitId:t,subUnitId:r,featureIds:n}=e;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,n)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tc.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._dependencyManagerService.removeFeatureFormulaDependency(n,i,r)}else if(e.id===tu.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._dependencyManagerService.removeFeatureFormulaDependency(i,s,[r])}else if(e.id===tC.id){let t=e.params;if(null==t)return;this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,t.formulaIdList)}else if(e.id===tp.id){let t=e.params;if(null==t)return;let r=t.formulaMap,n=[];Object.keys(r).forEach(e=>{n.push(e)}),this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,n)}else if(e.id===tf.id){let t=e.params.formulaData;Object.keys(t).forEach(e=>{let r=t[e];if(void 0!==r){if(null===r)return void this._dependencyManagerService.clearFormulaDependency(e);Object.keys(r).forEach(t=>{let n=r[t];if(void 0!==n){if(null===n)return this._dependencyManagerService.clearFormulaDependency(e,t),!0;new(0,B.ObjectMatrix)(n).forValue((r,n)=>{this._dependencyManagerService.removeFormulaDependency(e,t,r,n)})}})}})}else e.id===to.id&&this._handleSetDefinedName(e)}))}_handleSetDefinedName(e){let t=e.params;if(null==t)return;let{unitId:r,name:n}=t;this._dependencyManagerService.removeFormulaDependencyByDefinedName(r,n)}};l6=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l3(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l4(0,B.ICommandService),l4(1,s_),l4(1,sp),l4(2,s_)],l6);var l9=Object.getOwnPropertyDescriptor,l8=(e,t)=>(r,n)=>t(r,n,e);let l7=class extends B.Disposable{constructor(e,t){super(),this._commandService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tu.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._featureCalculationManagerService.register(i,s,r,n)}else if(e.id===tc.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._featureCalculationManagerService.remove(n,i,r)}}))}};l7=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l9(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l8(0,B.ICommandService),l8(1,s_)],l7);var ue=Object.getOwnPropertyDescriptor,ut=(e,t)=>(r,n)=>t(r,n,e);let ur=class extends B.Disposable{constructor(e,t,r){super(),this._commandService=e,this._otherFormulaManagerService=t,this._dependencyManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tp.id){let t=e.params;if(null==t)return;let r={[t.unitId]:{[t.subUnitId]:t.formulaMap}};this._otherFormulaManagerService.batchRegister(r)}else if(e.id===tC.id){let t=e.params;if(null==t)return;let r={};t.formulaIdList.forEach(e=>r[e]=!0);let n={[t.unitId]:{[t.subUnitId]:r}};this._otherFormulaManagerService.batchRemove(n)}}))}};ur=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ue(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ut(0,B.ICommandService),ut(1,sR),ut(2,sp)],ur);var un=Object.getOwnPropertyDescriptor,ui=(e,t)=>(r,n)=>t(r,n,e);let us=class extends B.Disposable{constructor(e,t){super(),this._commandService=e,this._superTableService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===to.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n,reference:i}=t;this._superTableService.registerTable(r,n,i)}else if(e.id===tl.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n}=t;this._superTableService.remove(r,n)}else if(e.id===tR.id){let t=e.params;if(null==t)return;let{tableOption:r,tableOptionType:n}=t;this._superTableService.registerTableOptionMap(r,n)}}))}};us=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?un(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ui(0,B.ICommandService),ui(1,lY)],us);class ua extends B.Disposable{constructor(){super(...arguments),Z(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}let uo=(0,$.createIdentifier)("univer.formula.active-dirty-manager.service");var ul=Object.getOwnPropertyDescriptor,uu=(e,t)=>(r,n)=>t(r,n,e);let uc=(Z(j=class extends B.Plugin{constructor(e=tW,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=(0,B.merge)({},tW,this._config);this._configService.setConfig(t$,n)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var e;(0,B.touchDependencies)(this._injector,[[l5],[us]]),null!=(e=this._config)&&e.notExecuteFormula||(0,B.touchDependencies)(this._injector,[[ur],[l7],[l6],[sP]])}onRendered(){var e;null!=(e=this._config)&&e.notExecuteFormula||(0,B.touchDependencies)(this._injector,[[sU],[sT]])}_initialize(){let e=!this._config.notExecuteFormula,t=[[iO,{useClass:ix}],[ts,{useClass:ti}],[uo,{useClass:ua}],[im,{useClass:id}],[tY,{useClass:tG}],[lY,{useClass:lG}],[lQ],[tL],[tU],[l5],[us],[l0]];e&&t.push([sR,{useClass:sy}],[iR,{useClass:iy}],[tK,{useClass:tq}],[s_,{useClass:sC}],[sP],[ur],[l6],[l7],[iG],[sm],[tJ],[iv],[iH],[iJ],[i1],[i9],[iP],[st],[ss],[sl],[sc]),t.forEach(e=>this._injector.add(e))}_initializeWithOverride(){var e;null!=(e=this._config)&&e.notExecuteFormula||[[sU,{useClass:sD}],[sp,{useClass:sf}],[sT,{useClass:sw}]].forEach(e=>this._injector.add(e))}},"pluginName","UNIVER_ENGINE_FORMULA_PLUGIN"),j);uc=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ul(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([uu(1,(0,$.Inject)($.Injector)),uu(2,B.IConfigService)],uc)}),c("k2g5B",function(e,t){i(e.exports,"RemoteSyncServiceName",function(){return E}),i(e.exports,"IRemoteSyncService",function(){return b}),i(e.exports,"RemoteSyncPrimaryService",function(){return I}),i(e.exports,"RemoteInstanceServiceName",function(){return N}),i(e.exports,"IRemoteInstanceService",function(){return S}),i(e.exports,"WebWorkerRemoteInstanceService",function(){return A}),i(e.exports,"fromModule",function(){return v}),i(e.exports,"toModule",function(){return T}),i(e.exports,"ChannelClient",function(){return w}),i(e.exports,"ChannelServer",function(){return M}),i(e.exports,"IRPCChannelService",function(){return O}),i(e.exports,"ChannelService",function(){return x}),i(e.exports,"DataSyncPrimaryController",function(){return V}),i(e.exports,"DataSyncReplicaController",function(){return k}),i(e.exports,"UniverRPCMainThreadPlugin",function(){return G}),i(e.exports,"UniverRPCWorkerThreadPlugin",function(){return Y});var r,n=u("7yNYd"),s=u("dqRu2"),a=u("lMvMU"),o=u("9z4na"),l=u("2jrJe"),c=u("5LPkb"),h=u("dBx9C"),d=u("hRiv7"),m=u("1O3Nt"),g=u("3yupB"),f=u("c3hg1"),p=Object.defineProperty,C=(e,t,r)=>{let n;return(n="symbol"!=typeof t?t+"":t)in e?p(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r},_=Object.getOwnPropertyDescriptor,y=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?_(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s},R=(e,t)=>(r,n)=>t(r,n,e);let E="rpc.remote-sync.service",b=(0,s.createIdentifier)(E),I=class{constructor(e){this._commandService=e}async syncMutation(e){return this._commandService.syncExecuteCommand(e.mutationInfo.id,e.mutationInfo.params,{onlyLocal:!0,fromSync:!0})}};I=y([R(0,n.ICommandService)],I);let N="univer.remote-instance-service",S=(0,s.createIdentifier)(N),A=class{constructor(e,t,r){this._univerInstanceService=e,this._commandService=t,this._logService=r}whenReady(){return Promise.resolve(!0)}async syncMutation(e){return this._applyMutation(e.mutationInfo)}async createInstance(e){let{type:t,snapshot:r}=e;try{if(t===n.UniverInstanceType.UNIVER_SHEET)return this._univerInstanceService.createUnit(n.UniverInstanceType.UNIVER_SHEET,r),!0;throw Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${t}.`)}catch(e){throw e instanceof Error?e:TypeError(`${e}`)}}async disposeInstance(e){return this._univerInstanceService.disposeUnit(e.unitID)}_applyMutation(e){let{id:t,params:r}=e;return this._commandService.syncExecuteCommand(t,r,{onlyLocal:!0,fromSync:!0})}};function v(e){return new class{call(t,r){let n=e[t];if("function"==typeof n){let t=r?n.apply(e,r):n.call(e);return t instanceof Promise||(t=Promise.resolve(t)),t}throw Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){let n=e[t];if("function"==typeof n){let t=r?n.apply(e,r):n.call(e);return(0,d.isObservable)(t)?t:(0,g.of)(t)}throw Error(`[RPC]: observable method not found for ${t}!`)}}}function T(e){return new Proxy({},{get(t,r){if("dispose"!==r)return function(...t){return r.endsWith("$")?e.subscribe(r,t):e.call(r,t)}}})}A=y([R(0,n.IUniverInstanceService),R(1,n.ICommandService),R(2,n.ILogService)],A);class w extends n.RxDisposable{constructor(e){super(),C(this,"_initialized",new(0,c.BehaviorSubject)(!1)),C(this,"_lastRequestCounter",0),C(this,"_pendingRequests",new Map),this._protocol=e,this._protocol.send({type:50}),this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onMessage(e))}dispose(){this._pendingRequests.clear()}getChannel(e){let t=this;return{call:(r,n)=>t._disposed?Promise.reject():t._remoteCall(e,r,n),subscribe(r,n){if(t._disposed)throw Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,n)}}}_whenReady(){return(0,h.firstValueFrom)(this._initialized.pipe((0,a.filter)(e=>e),(0,o.take)(1)))}async _remoteCall(e,t,r){await this._whenReady();let n=++this._lastRequestCounter,i={seq:n,type:100,channelName:e,method:t,args:r},s=this;return new Promise((e,t)=>{this._pendingRequests.set(n,{handle(r){switch(r.type){case 201:s._pendingRequests.delete(n),e(r.data);break;case 202:s._pendingRequests.delete(n),t(r.data);break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(i)})}_remoteSubscribe(e,t,r){return new(0,m.Observable)(n=>{let i=-1;return this._whenReady().then(()=>{let s={seq:i=++this._lastRequestCounter,type:101,channelName:e,method:t,args:r};this._pendingRequests.set(i,{handle(e){switch(e.type){case 300:n.next(e.data);break;case 301:n.error(e.data);break;case 302:n.complete();break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(s)}),()=>{if(-1===i)return;let r={type:102,seq:i,channelName:e,method:t};this._sendRequest(r)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;switch(e.type){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:null==(t=this._pendingRequests.get(e.seq))||t.handle(e)}}}class M extends n.RxDisposable{constructor(e){super(),C(this,"_channels",new Map),C(this,"_subscriptions",new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onRequest(e)),this._sendInitialize()}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 50:this._sendInitialize();break;case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e)}}_sendInitialize(){this._sendResponse({seq:-1,type:0})}_onMethodCall(e){let t,{channelName:r,method:n,args:i}=e,s=this._channels.get(r);try{if(!s)throw Error(`[ChannelServer]: Channel ${r} not found!`);t=i?s.call(n,i):s.call(n)}catch(e){t=Promise.reject(e)}t.then(t=>{this._sendResponse({seq:e.seq,type:201,data:t})}).catch(t=>{t instanceof Error?this._sendResponse({seq:e.seq,type:202,data:t.message}):this._sendResponse({seq:e.seq,type:202,data:String(t)})})}_onSubscribe(e){let{channelName:t,seq:r}=e,n=this._channels.get(t);try{if(!n)throw Error(`[ChannelServer]: Channel ${t} not found!`);let i=n.subscribe(e.method,e.args).subscribe({next:e=>{this._sendResponse({seq:r,type:300,data:e})},error:e=>{this._sendResponse({seq:r,type:301,data:e.message}),this._sendResponse({seq:r,type:302})},complete:()=>{this._sendResponse({seq:r,type:302})}});this._subscriptions.set(e.seq,i)}catch(t){t instanceof Error?this._sendResponse({seq:e.seq,type:301,data:t.message}):this._sendResponse({seq:e.seq,type:301,data:String(t)})}}_onUnsubscribe(e){let t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}}let O=(0,s.createIdentifier)("IRPCChannelService");class x{constructor(e){C(this,"_client"),C(this,"_server"),this._client=new w(e),this._server=new M(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}}var U=Object.getOwnPropertyDescriptor,D=(e,t)=>(r,n)=>t(r,n,e);let V=class extends n.RxDisposable{constructor(e,t,r,n,i){super(),C(this,"_remoteInstanceService"),C(this,"_syncingUnits",new Set),C(this,"_syncingMutations",new Set),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._rpcChannelService=n,this._remoteSyncService=i,this._initRPCChannels(),this._init()}registerSyncingMutations(e){this._syncingMutations.add(e.id)}syncUnit(e){return this._syncingUnits.add(e),(0,n.toDisposable)(()=>this._syncingUnits.delete(e))}_initRPCChannels(){this._rpcChannelService.registerChannel(E,v(this._remoteSyncService)),this._injector.add([S,{useFactory:()=>T(this._rpcChannelService.requestChannel(N))}]),this._remoteInstanceService=this._injector.get(S)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(n.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.add(e.getUnitId()),this._remoteInstanceService.createInstance({unitID:e.getUnitId(),type:n.UniverInstanceType.UNIVER_SHEET,snapshot:e.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(n.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.delete(e.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:e.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{let{type:r,params:i,id:s}=e,a=(null==i?void 0:i.unitId)||"";r===n.CommandType.MUTATION&&(!a||this._syncingUnits.has(a))&&!(null!=t&&t.fromSync)&&this._syncingMutations.has(s)&&this._remoteInstanceService.syncMutation({mutationInfo:e})}))}};V=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?U(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([D(0,(0,s.Inject)(s.Injector)),D(1,n.ICommandService),D(2,n.IUniverInstanceService),D(3,O),D(4,b)],V);var L=Object.getOwnPropertyDescriptor,P=(e,t)=>(r,n)=>t(r,n,e);let k=class extends n.Disposable{constructor(e,t,r,n){super(),C(this,"_remoteSyncService"),this._injector=e,this._remoteInstanceService=t,this._commandService=r,this._rpcChannelService=n,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(N,v(this._remoteInstanceService)),this._injector.add([b,{useFactory:()=>T(this._rpcChannelService.requestChannel(E))}]),this._remoteSyncService=this._injector.get(b)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{e.type!==n.CommandType.MUTATION||null!=t&&t.fromSync||this._remoteSyncService.syncMutation({mutationInfo:e})}))}};k=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?L(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([P(0,(0,s.Inject)(s.Injector)),P(1,S),P(2,n.ICommandService),P(3,O)],k);let F={},j={};var B,$=Object.getOwnPropertyDescriptor,H=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?$(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s},W=(e,t)=>(r,n)=>t(r,n,e);let G=(B=class extends n.Plugin{constructor(e=F,t,r){super(),C(this,"_internalWorker",null),this._config=e,this._injector=t,this._configService=r;let{...i}=(0,n.merge)({},F,this._config);this._configService.setConfig("rpc.main-thread.config",i)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){let{workerURL:e}=this._config;if(!e)throw Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");let t=e instanceof Worker?e:new Worker(e);this._internalWorker=e instanceof Worker?null:t;let r={send(e){t.postMessage(e)},onMessage:new(0,m.Observable)(e=>{let r=t=>{e.next(t.data)};return t.addEventListener("message",r),()=>t.removeEventListener("message",r)}).pipe((0,f.shareReplay)(1))};[[O,{useFactory:()=>new x(r)}],[V],[b,{useClass:I}]].forEach(e=>this._injector.add(e)),this._injector.get(V)}},C(B,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),B);G=H([W(1,(0,s.Inject)(s.Injector)),W(2,n.IConfigService)],G);let Y=(C(r=class extends n.Plugin{constructor(e=j,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...i}=(0,n.merge)({},j,this._config);this._configService.setConfig("rpc.worker-thread.config",i)}onStarting(){[[k],[O,{useFactory:()=>new x({send(e){postMessage(e)},onMessage:new(0,m.Observable)(e=>{let t=t=>{e.next(t.data)};return addEventListener("message",t),()=>removeEventListener("message",t)}).pipe((0,f.shareReplay)(1))})}],[S,{useClass:A}]].forEach(e=>this._injector.add(e)),this._injector.get(k)}},"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),r);Y=H([W(1,(0,s.Inject)(s.Injector)),W(2,n.IConfigService)],Y)}),c("hRiv7",function(e,t){i(e.exports,"isObservable",function(){return s});var r=u("1O3Nt"),n=u("3IQI0");function s(e){return!!e&&(e instanceof r.Observable||(0,n.isFunction)(e.lift)&&(0,n.isFunction)(e.subscribe))}}),c("fSY9V",function(e,t){e.exports=Promise.all([s("l1kQv"),s("fd2QQ")]).then(()=>u("61myN"))}),c("DdidE",function(e,t){e.exports=Promise.all([s("l1kQv"),s("1BRsM")]).then(()=>u("bzE9m"))}),c("4w8lL",function(e,t){e.exports=s("1LVG9").then(()=>u("jF4AZ"))}),c("gIy6A",function(e,t){e.exports=s("6AK23").then(()=>u("02bSp"))}),Object.assign(u.i??={},{fd2QQ:"es.795cc573.js",l1kQv:"es.696961ee.js","1BRsM":"preset-sheets-core.8688a247.js","1LVG9":"en-US.3cf8a783.js","6AK23":"v4-mini.792673ef.js"});var h=u("7yNYd"),d=u("ejawP");const m=u("fSY9V"),g=u("DdidE"),f=u("4w8lL"),p=u("gIy6A"),C=window?.location?.search?.includes("_debug_spreadsheet");class _{static{this.MAX_COLS=1e9}static getCellIndex(e,t){return e*_.MAX_COLS+t}insert(e,t,r){let n=_.getCellIndex(e,t);this.ids[n]=r}get(e,t){let r=_.getCellIndex(e,t);return this.ids[r]}constructor(){this.ids=[]}}async function y(e,t){let{cellData:r,rowCount:n,columnCount:i,cellIdMap:s}=await R(e);return{worksheet:{id:"sqlpage",name:t.sheet_name,defaultColumnWidth:t.column_width,defaultRowHeight:t.row_height,showGridlines:+t.show_grid,freeze:{startRow:t.freeze_y,startColumn:t.freeze_x,xSplit:t.freeze_x,ySplit:t.freeze_y},rowCount:n,columnCount:i,cellData:r},cellIdMap:s}}async function R(e){let t={},r=new _,n=1e3,i=26,s=A(await p);for(let a of e){let[e,o,l,...u]=s.parse(a),c={v:l};if(u.length){let{s:t,customId:n}=function(e){let t,r={};for(let n=0;n<e.length;n++){let i=e[n];if(1===i)r.bl=1;else if(2===i)r.it=1;else if(3===i){let t=e[++n].toString();r.bg={rgb:N.getPropertyValue(`--tblr-${t}`)||t}}else if(4===i)r.ht=h.HorizontalAlign.CENTER;else if(5===i)r.ht=h.HorizontalAlign.RIGHT;else if(6===i)r.ht=h.HorizontalAlign.JUSTIFIED;else if(7===i)r.ht=h.HorizontalAlign.DISTRIBUTED;else if(8===i)r.n={pattern:e[++n].toString()};else if(9===i)t=e[++n].toString();else if(10===i)r.ff=e[++n].toString();else if(11===i)r.fs=Number(e[++n]);else if(12===i)r.ul={s:1};else if(13===i)r.st={s:1};else if(14===i){let t=e[++n].toString();r.cl={rgb:N.getPropertyValue(`--tblr-${t}`)||t}}else 15===i?r.vt=h.VerticalAlign.TOP:16===i?r.vt=h.VerticalAlign.MIDDLE:17===i?r.vt=h.VerticalAlign.BOTTOM:18===i?r.tb=h.WrapStrategy.OVERFLOW:19===i?r.tb=h.WrapStrategy.CLIP:20===i?r.tb=h.WrapStrategy.WRAP:21===i&&(r.td=h.TextDirection.RIGHT_TO_LEFT)}return{s:r,customId:t}}(u);c.s=t,n&&r.insert(o,e,n)}"number"==typeof l&&(c.t=2);let d=t[o];d?d[e]=c:t[o]={[e]:c},n=Math.max(n,o),i=Math.max(i,e)}return{cellData:t,rowCount:n,columnCount:i,cellIdMap:r}}async function E(e){let{LocaleType:t,createUniver:r,defaultTheme:n}=await m,{UniverSheetsCorePreset:i}=await g,{default:s}=await f,{univerAPI:a}=r({locale:t.EN_US,locales:{[t.EN_US]:s},logLevel:3*!!C,theme:n,presets:[i({container:e})]});return e.className="sqlpage_spreadsheet",a}const b=async e=>{let{update_link:t,x:r,y:n,value:i,customId:s,errorModal:a}=e;if(!t)return;let o=new URL(t,window.location.href);o.searchParams.append("_sqlpage_embed","");let l=new URLSearchParams;l.append("x",r.toString()),l.append("y",n.toString()),null!=i&&l.append("value",i.toString()),null!=s&&l.append("id",s);let u=await fetch(o,{method:"POST",body:l}),c=await u.text();200===u.status||c||(c=u.statusText),c&&a(c)},I=(r=async function(e){!function(e,t){let r=new Map,n=0;for(let i=0;i<e.length;i++){let s=e[i],a=t(s),o=r.get(a)??n++;r.set(a,o),e[o]=s}e.length=n}(e,({x:e,y:t})=>_.getCellIndex(t,e)),await Promise.all(e.map(b))},e=null,t=[],n=>{t.push(n),null===e&&(e=setTimeout(()=>{r(t),t=[],e=null},50))}),N=getComputedStyle(document.documentElement);async function S(e,t,r){let n=e.querySelector(".modal");if(!(n instanceof HTMLElement))throw Error("modal not found");let i=function(e){let t=window.alert;try{if(!e)throw Error("resp_modal not found");let t=e.querySelector(".modal-body");if(!t)throw Error("resp_modal_body not found");let r=window?.tabler?.Modal;if(!r)throw Error("tabler.Modal not found");return n=>{t.innerHTML=n,new r(e).show()}}catch(e){return console.error("Error setting up error modal",e),t}}(n),{worksheet:s,cellIdMap:a}=await y(r,t),o=await E(e),l={sheetOrder:["sqlpage"],name:"sqlpage",appVersion:"0.2.14",sheets:{sqlpage:s}};C&&console.log("sqlpage-spreadsheet: creating sheet",l),o.createWorkbook(l);let{update_link:u}=t;o.addEvent("CommandExecuted",({id:e,params:t})=>{u&&e===d.SetRangeValuesMutation.id&&function(e,t,r,n){let{cellValue:i}=e;if(i)for(let e in i){let s=i[e];for(let i in s){let a=s[i];if(!a)continue;let o=a.v;null==o&&a.p&&(o=a.p.body?.dataStream?.trimEnd());let l=Number.parseInt(e),u=Number.parseInt(i),c=n.get(l,u);I({update_link:t,x:u,y:l,value:o,customId:c,errorModal:r})}}}(t,u,i,a)})}const A=e=>e.tuple([e.number().check(e.int(),e.nonnegative()),e.number().check(e.int(),e.nonnegative()),e.union([e.string(),e.number(),e.null()])],e.union([e.string(),e.number()]));async function v(e){try{let t,r=e.dataset;if(!r)throw Error("Props not found");let n=JSON.parse(r?.cells||"[]");if(!Array.isArray(n))throw Error(`Invalid cells${r?.cells}`);let i=(t=await p).object({update_link:t.optional(t.string()),sheet_name:t._default(t.string(),"SQLPage Data"),freeze_x:t._default(t.number().check(t.int(),t.nonnegative()),0),freeze_y:t._default(t.number().check(t.int(),t.nonnegative()),0),column_width:t._default(t.number().check(t.int(),t.nonnegative()),100),row_height:t._default(t.number().check(t.int(),t.nonnegative()),20),show_grid:t._default(t.boolean(),!0)}).parse(JSON.parse(r?.props||"{}"));S(e,i,n)}catch(e){alert(`Invalid properties passed to the spreadsheet component: ${e}`)}}const T=document.getElementsByClassName("sqlpage_spreadsheet"),w=T[T.length-1];if(!(w instanceof HTMLElement))throw Error("No spreadsheet elements found");v(w);
//# sourceMappingURL=spreadsheet_component.3540ef71.js.map
