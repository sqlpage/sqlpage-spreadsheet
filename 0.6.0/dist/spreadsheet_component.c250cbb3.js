let e,t;var r,n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{};function i(e,t,r,n){Object.defineProperty(e,t,{get:r,set:n,enumerable:!0,configurable:!0})}function s(e){return import(a+(e=u.i?.[e]||e))}var a="./",o={},l={},u=n.parcelRequire26fc;null==u&&((u=function(e){if(e in o)return o[e].exports;if(e in l){var t=l[e];delete l[e];var r={id:e,exports:{}};return o[e]=r,t.call(r.exports,r,r.exports),r.exports}var n=Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}).register=function(e,t){l[e]=t},n.parcelRequire26fc=u);var c=u.register;c("7yNYd",function(e,t){let r,s,a,o,l,c,h,d,m,g,f,p,C,_,y,E,R,b,I,N,S,A,v,T,w,M,O,x,U,D,V,L,P,F,k,j,B,$,H,W,G,Y,z,X,q,K,Q,Z,J,ee,et,er,en,ei,es,ea,eo,el,eu,ec,eh,ed,em,eg,ef,ep,eC,e_,ey,eE,eR,eb,eI,eN,eS,eA,ev,eT,ew,eM,eO,ex,eU,eD,eV,eL,eP,eF,ek,ej,eB,e$,eH,eW,eG,eY,ez,eX,eq,eK,eQ,eZ;i(e.exports,"remove",function(){return tb}),i(e.exports,"dedupe",function(){return tI}),i(e.exports,"dedupeBy",function(){return tN}),i(e.exports,"rotate",function(){return tS}),i(e.exports,"groupBy",function(){return tA}),i(e.exports,"makeArray",function(){return tv}),i(e.exports,"registerDependencies",function(){return tT}),i(e.exports,"touchDependencies",function(){return tw}),i(e.exports,"CustomCommandExecutionError",function(){return tM}),i(e.exports,"CanceledError",function(){return tO}),i(e.exports,"sequenceAsync",function(){return tx}),i(e.exports,"sequence",function(){return tU}),i(e.exports,"toDisposable",function(){return tD}),i(e.exports,"fromObservable",function(){return tV}),i(e.exports,"DisposableCollection",function(){return tL}),i(e.exports,"Disposable",function(){return tP}),i(e.exports,"RxDisposable",function(){return tF}),i(e.exports,"RCDisposable",function(){return tk}),i(e.exports,"IContextService",function(){return tj}),i(e.exports,"ContextService",function(){return tB}),i(e.exports,"LogLevel",function(){return t$}),i(e.exports,"ILogService",function(){return tH}),i(e.exports,"DesktopLogService",function(){return tW}),i(e.exports,"CommandType",function(){return tz}),i(e.exports,"ICommandService",function(){return tX}),i(e.exports,"NilCommand",function(){return tK}),i(e.exports,"CommandService",function(){return tQ}),i(e.exports,"sequenceExecute",function(){return tJ}),i(e.exports,"sequenceExecuteAsync",function(){return t0}),i(e.exports,"fromCallback",function(){return t1}),i(e.exports,"takeAfter",function(){return t2}),i(e.exports,"bufferDebounceTime",function(){return t5}),i(e.exports,"afterTime",function(){return t3}),i(e.exports,"convertObservableToBehaviorSubject",function(){return t4}),i(e.exports,"afterInitApply",function(){return t6}),i(e.exports,"searchInOrderedArray",function(){return t9}),i(e.exports,"binarySearchArray",function(){return t8}),i(e.exports,"binSearchFirstGreaterThanTarget",function(){return t7}),i(e.exports,"searchArray",function(){return re}),i(e.exports,"codeToBlob",function(){return rt}),i(e.exports,"MOVE_BUFFER_VALUE",function(){return rr}),i(e.exports,"ROTATE_BUFFER_VALUE",function(){return rn}),i(e.exports,"checkIfMove",function(){return ri}),i(e.exports,"AutoFillSeries",function(){return rs}),i(e.exports,"BorderStyleTypes",function(){return ra}),i(e.exports,"BorderType",function(){return ro}),i(e.exports,"ColorType",function(){return rl}),i(e.exports,"CommonHideTypes",function(){return ru}),i(e.exports,"CopyPasteType",function(){return rc}),i(e.exports,"DeleteDirection",function(){return rh}),i(e.exports,"DeveloperMetadataVisibility",function(){return rd}),i(e.exports,"Dimension",function(){return rm}),i(e.exports,"Direction",function(){return rg}),i(e.exports,"getReverseDirection",function(){return rf}),i(e.exports,"InterpolationPointType",function(){return rp}),i(e.exports,"LocaleType",function(){return rC}),i(e.exports,"MentionType",function(){return r_}),i(e.exports,"ProtectionType",function(){return ry}),i(e.exports,"BasicShapes",function(){return rE}),i(e.exports,"ArrowsAndMarkersShapes",function(){return rR}),i(e.exports,"OtherShapes",function(){return rb}),i(e.exports,"SpecialShapes",function(){return rI}),i(e.exports,"RelativeDate",function(){return rN}),i(e.exports,"SheetTypes",function(){return rS}),i(e.exports,"TextDirection",function(){return rA}),i(e.exports,"TextDecoration",function(){return rv}),i(e.exports,"HorizontalAlign",function(){return rT}),i(e.exports,"VerticalAlign",function(){return rw}),i(e.exports,"WrapStrategy",function(){return rM}),i(e.exports,"FontItalic",function(){return rO}),i(e.exports,"FontWeight",function(){return rx}),i(e.exports,"BaselineOffset",function(){return rU}),i(e.exports,"BooleanNumber",function(){return rD}),i(e.exports,"CellValueType",function(){return rV}),i(e.exports,"ThemeColorType",function(){return rL}),i(e.exports,"ThemeColors",function(){return rP}),i(e.exports,"Tools",function(){return rq}),i(e.exports,"generateRandomId",function(){return rK}),i(e.exports,"composeStyles",function(){return rQ}),i(e.exports,"isNodeEnv",function(){return rZ}),i(e.exports,"getBodySliceHtml",function(){return rJ}),i(e.exports,"covertTextRunToHtml",function(){return r1}),i(e.exports,"convertBodyToHtml",function(){return r0}),i(e.exports,"THEME_COLORS",function(){return r2}),i(e.exports,"ColorBuilder",function(){return r5}),i(e.exports,"RgbColor",function(){return r9}),i(e.exports,"ThemeColor",function(){return r7}),i(e.exports,"Color",function(){return r3}),i(e.exports,"HLSColor",function(){return r4}),i(e.exports,"RGB_PAREN",function(){return ne}),i(e.exports,"RGBA_PAREN",function(){return nt}),i(e.exports,"COLORS",function(){return nr}),i(e.exports,"ColorKit",function(){return nn}),i(e.exports,"isBlackColor",function(){return ny}),i(e.exports,"isWhiteColor",function(){return nE}),i(e.exports,"UpdateDocsAttributeType",function(){return nR}),i(e.exports,"isICellData",function(){return nb}),i(e.exports,"getCellValueType",function(){return nI}),i(e.exports,"isNullCell",function(){return nN}),i(e.exports,"isCellV",function(){return nS}),i(e.exports,"RANGE_TYPE",function(){return nA}),i(e.exports,"AbsoluteRefType",function(){return nv}),i(e.exports,"selectionToArray",function(){return nT}),i(e.exports,"RANGE_DIRECTION",function(){return nw}),i(e.exports,"DOC_RANGE_TYPE",function(){return nM}),i(e.exports,"getCellInfoInMergeData",function(){return nO}),i(e.exports,"CellModeEnum",function(){return nx}),i(e.exports,"convertCellToRange",function(){return nU}),i(e.exports,"makeCellToSelection",function(){return nD}),i(e.exports,"makeCellRangeToRangeData",function(){return nV}),i(e.exports,"isEmptyCell",function(){return nL}),i(e.exports,"isCellCoverable",function(){return nP}),i(e.exports,"getColorStyle",function(){return nF}),i(e.exports,"isFormulaString",function(){return nk}),i(e.exports,"isFormulaId",function(){return nj}),i(e.exports,"handleStyleToString",function(){return nB}),i(e.exports,"getBorderStyleType",function(){return nH}),i(e.exports,"getDocsUpdateBody",function(){return nW}),i(e.exports,"isValidRange",function(){return nG}),i(e.exports,"cellToRange",function(){return nY}),i(e.exports,"deepCompare",function(){return nz}),i(e.exports,"isSameStyleTextRun",function(){return nX}),i(e.exports,"checkForSubstrings",function(){return nq}),i(e.exports,"dayjs",function(){return nJ}),i(e.exports,"horizontalLineSegmentsSubtraction",function(){return i5}),i(e.exports,"checkParagraphHasBullet",function(){return i3}),i(e.exports,"checkParagraphHasIndent",function(){return i4}),i(e.exports,"checkParagraphHasIndentByStyle",function(){return i6}),i(e.exports,"insertTextToContent",function(){return i9}),i(e.exports,"deleteContent",function(){return i8}),i(e.exports,"isRealNum",function(){return i7}),i(e.exports,"hashAlgorithm",function(){return se}),i(e.exports,"LRUMap",function(){return so}),i(e.exports,"LRUHelper",function(){return sl}),i(e.exports,"numfmt",function(){return sh}),i(e.exports,"getArrayLength",function(){return sd}),i(e.exports,"insertMatrixArray",function(){return sm}),i(e.exports,"spliceArray",function(){return sg}),i(e.exports,"concatMatrixArray",function(){return sf}),i(e.exports,"sliceMatrixArray",function(){return sp}),i(e.exports,"moveMatrixArray",function(){return sC}),i(e.exports,"ObjectMatrix",function(){return s_}),i(e.exports,"DOCS_NORMAL_EDITOR_UNIT_ID_KEY",function(){return sE}),i(e.exports,"DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY",function(){return sR}),i(e.exports,"DOCS_ZEN_EDITOR_UNIT_ID_KEY",function(){return sb}),i(e.exports,"DEFAULT_EMPTY_DOCUMENT_VALUE",function(){return sI}),i(e.exports,"IS_ROW_STYLE_PRECEDE_COLUMN_STYLE",function(){return sN}),i(e.exports,"AUTO_HEIGHT_FOR_MERGED_CELLS",function(){return sS}),i(e.exports,"createInternalEditorID",function(){return sA}),i(e.exports,"isInternalEditorID",function(){return sv}),i(e.exports,"DocStyleType",function(){return sT}),i(e.exports,"FollowNumberWithType",function(){return sw}),i(e.exports,"ListGlyphType",function(){return sM}),i(e.exports,"BulletAlignment",function(){return sO}),i(e.exports,"CustomRangeType",function(){return sx}),i(e.exports,"CustomDecorationType",function(){return sU}),i(e.exports,"BlockType",function(){return sD}),i(e.exports,"DocumentFlavor",function(){return sV}),i(e.exports,"GridType",function(){return sL}),i(e.exports,"SectionType",function(){return sP}),i(e.exports,"ColumnSeparatorType",function(){return sF}),i(e.exports,"TextDirectionType",function(){return sk}),i(e.exports,"ParagraphElementType",function(){return sj}),i(e.exports,"WrapTextType",function(){return sB}),i(e.exports,"PositionedObjectLayoutType",function(){return s$}),i(e.exports,"NamedStyleType",function(){return sH}),i(e.exports,"SpacingRule",function(){return sW}),i(e.exports,"DashStyleType",function(){return sG}),i(e.exports,"TabStopAlignment",function(){return sY}),i(e.exports,"TableSizeType",function(){return sz}),i(e.exports,"TableAlignmentType",function(){return sX}),i(e.exports,"TableLayoutType",function(){return sq}),i(e.exports,"TableTextWrapType",function(){return sK}),i(e.exports,"TableRowHeightRule",function(){return sQ}),i(e.exports,"VerticalAlignmentType",function(){return sZ}),i(e.exports,"FontStyleType",function(){return sJ}),i(e.exports,"ObjectRelativeFromH",function(){return s0}),i(e.exports,"ObjectRelativeFromV",function(){return s1}),i(e.exports,"NumberUnitType",function(){return s2}),i(e.exports,"AlignTypeH",function(){return s5}),i(e.exports,"AlignTypeV",function(){return s3}),i(e.exports,"characterSpacingControlType",function(){return s4}),i(e.exports,"PageOrientType",function(){return s6}),i(e.exports,"PaperType",function(){return s9}),i(e.exports,"PAPER_TYPES",function(){return s8}),i(e.exports,"ArrangeTypeEnum",function(){return s7}),i(e.exports,"DrawingTypeEnum",function(){return ae}),i(e.exports,"PageType",function(){return at}),i(e.exports,"PageElementType",function(){return ar}),i(e.exports,"RelativeSlideLink",function(){return an}),i(e.exports,"DEFAULT_RANGE_ARRAY",function(){return ai}),i(e.exports,"DEFAULT_RANGE",function(){return as}),i(e.exports,"DEFAULT_SELECTION",function(){return aa}),i(e.exports,"DEFAULT_CELL",function(){return ao}),i(e.exports,"DEFAULT_STYLES",function(){return al}),i(e.exports,"DEFAULT_SLIDE",function(){return au}),i(e.exports,"SHEET_EDITOR_UNITS",function(){return ac}),i(e.exports,"NAMED_STYLE_MAP",function(){return ah}),i(e.exports,"NAMED_STYLE_SPACE_MAP",function(){return ad}),i(e.exports,"PRINT_CHART_COMPONENT_KEY",function(){return am}),i(e.exports,"DOC_DRAWING_PRINTING_COMPONENT_KEY",function(){return ag}),i(e.exports,"EXTENSION_NAMES",function(){return af}),i(e.exports,"PAGE_SIZE",function(){return ap}),i(e.exports,"Range",function(){return ay}),i(e.exports,"RBush",function(){return aR}),i(e.exports,"moveRangeByOffset",function(){return aU}),i(e.exports,"splitIntoGrid",function(){return aV}),i(e.exports,"Rectangle",function(){return aj}),i(e.exports,"getIntersectRange",function(){return aL}),i(e.exports,"queryObjectMatrix",function(){return aB}),i(e.exports,"RefAlias",function(){return a$}),i(e.exports,"createRowColIter",function(){return aH}),i(e.exports,"ABCToNumber",function(){return aW}),i(e.exports,"numberToABC",function(){return aG}),i(e.exports,"repeatStringNumTimes",function(){return aY}),i(e.exports,"numberToListABC",function(){return az}),i(e.exports,"sortRules",function(){return aX}),i(e.exports,"sortRulesByDesc",function(){return aq}),i(e.exports,"sortRulesFactory",function(){return aK}),i(e.exports,"DataStreamTreeNodeType",function(){return aQ}),i(e.exports,"DataStreamTreeTokenType",function(){return aZ}),i(e.exports,"makeCustomRangeStream",function(){return aJ}),i(e.exports,"getPlainText",function(){return a1}),i(e.exports,"get",function(){return lC}),i(e.exports,"debounce",function(){return lx}),i(e.exports,"mergeWith",function(){return lL}),i(e.exports,"merge",function(){return lP}),i(e.exports,"set",function(){return lF}),i(e.exports,"textDiff",function(){return lk}),i(e.exports,"isBooleanString",function(){return lB}),i(e.exports,"AsyncLock",function(){return l$}),i(e.exports,"shallowEqual",function(){return lH}),i(e.exports,"UniverInstanceType",function(){return lW}),i(e.exports,"UnitModel",function(){return lz}),i(e.exports,"JSON1",function(){return uI}),i(e.exports,"TextXActionType",function(){return uN}),i(e.exports,"normalizeTextRuns",function(){return uS}),i(e.exports,"QuickListType",function(){return uB}),i(e.exports,"PresetListType",function(){return u$}),i(e.exports,"PRESET_LIST_TYPE",function(){return uz}),i(e.exports,"QuickListTypeMap",function(){return uq}),i(e.exports,"SliceBodyType",function(){return uQ}),i(e.exports,"getTextRunSlice",function(){return uZ}),i(e.exports,"getTableSlice",function(){return uJ}),i(e.exports,"getParagraphsSlice",function(){return u0}),i(e.exports,"getSectionBreakSlice",function(){return u1}),i(e.exports,"getCustomBlockSlice",function(){return u2}),i(e.exports,"getBodySlice",function(){return u5}),i(e.exports,"getCustomDecorationSlice",function(){return u6}),i(e.exports,"getCustomRangeSlice",function(){return u4}),i(e.exports,"normalizeBody",function(){return u3}),i(e.exports,"composeBody",function(){return u9}),i(e.exports,"ActionIterator",function(){return u8}),i(e.exports,"MemoryCursor",function(){return u7}),i(e.exports,"updateAttributeByDelete",function(){return ce}),i(e.exports,"updateAttributeByInsert",function(){return ct}),i(e.exports,"TextX",function(){return cs}),i(e.exports,"JSONX",function(){return co}),i(e.exports,"DEFAULT_DOC",function(){return cl}),i(e.exports,"DocumentDataModel",function(){return cc}),i(e.exports,"BuildTextUtils",function(){return c_}),i(e.exports,"TextStyleValue",function(){return cE}),i(e.exports,"TextDecorationBuilder",function(){return cb}),i(e.exports,"TextStyleBuilder",function(){return cR}),i(e.exports,"ParagraphStyleValue",function(){return cI}),i(e.exports,"ParagraphStyleBuilder",function(){return cN}),i(e.exports,"RichTextValue",function(){return cS}),i(e.exports,"RichTextBuilder",function(){return cA}),i(e.exports,"throttle",function(){return cv}),i(e.exports,"InterceptorEffectEnum",function(){return cT}),i(e.exports,"createInterceptorKey",function(){return cw}),i(e.exports,"composeInterceptors",function(){return cM}),i(e.exports,"InterceptorManager",function(){return cO}),i(e.exports,"createAsyncInterceptorKey",function(){return cx}),i(e.exports,"AsyncInterceptorManager",function(){return cD}),i(e.exports,"mixinClass",function(){return cV}),i(e.exports,"isNumeric",function(){return cL}),i(e.exports,"isSafeNumeric",function(){return cP}),i(e.exports,"Registry",function(){return cF}),i(e.exports,"RegistryAsMap",function(){return ck}),i(e.exports,"requestImmediateMacroTask",function(){return cj}),i(e.exports,"mergeSets",function(){return cB}),i(e.exports,"replaceInDocumentBody",function(){return c$}),i(e.exports,"DEFAULT_DOCUMENT_SUB_COMPONENT_ID",function(){return cH}),i(e.exports,"EventState",function(){return cW}),i(e.exports,"EventSubject",function(){return cG}),i(e.exports,"fromEventSubject",function(){return cY}),i(e.exports,"IResourceManagerService",function(){return cz}),i(e.exports,"createDefaultUser",function(){return cq}),i(e.exports,"UserManagerService",function(){return cQ}),i(e.exports,"AuthzIoLocalService",function(){return c0}),i(e.exports,"IAuthzIoService",function(){return c1}),i(e.exports,"MentionIOLocalService",function(){return c5}),i(e.exports,"IMentionIOService",function(){return c3}),i(e.exports,"IConfigService",function(){return c4}),i(e.exports,"ConfigService",function(){return c6}),i(e.exports,"FOCUSING_UNIT",function(){return c9}),i(e.exports,"FOCUSING_SHEET",function(){return c8}),i(e.exports,"FOCUSING_DOC",function(){return c7}),i(e.exports,"FOCUSING_SLIDE",function(){return he}),i(e.exports,"FOCUSING_EDITOR_BUT_HIDDEN",function(){return ht}),i(e.exports,"EDITOR_ACTIVATED",function(){return hr}),i(e.exports,"FOCUSING_EDITOR_INPUT_FORMULA",function(){return hn}),i(e.exports,"FOCUSING_FX_BAR_EDITOR",function(){return hi}),i(e.exports,"FOCUSING_UNIVER_EDITOR",function(){return hs}),i(e.exports,"FOCUSING_EDITOR_STANDALONE",function(){return ha}),i(e.exports,"FOCUSING_PANEL_EDITOR",function(){return ho}),i(e.exports,"FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",function(){return hl}),i(e.exports,"FOCUSING_COMMON_DRAWINGS",function(){return hu}),i(e.exports,"FORMULA_EDITOR_ACTIVATED",function(){return hc}),i(e.exports,"ErrorService",function(){return hh}),i(e.exports,"Styles",function(){return hd}),i(e.exports,"isRangesEqual",function(){return hm}),i(e.exports,"isUnitRangesEqual",function(){return hg}),i(e.exports,"createDocumentModelWithStyle",function(){return hC}),i(e.exports,"addLinkToDocumentModel",function(){return hy}),i(e.exports,"isNotNullOrUndefined",function(){return hE}),i(e.exports,"DEFAULT_WORKSHEET_ROW_COUNT_KEY",function(){return hS}),i(e.exports,"DEFAULT_WORKSHEET_ROW_COUNT",function(){return hA}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_COUNT_KEY",function(){return hv}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_COUNT",function(){return hT}),i(e.exports,"DEFAULT_WORKSHEET_ROW_HEIGHT_KEY",function(){return hw}),i(e.exports,"DEFAULT_WORKSHEET_ROW_HEIGHT",function(){return hM}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH_KEY",function(){return hO}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_WIDTH",function(){return hx}),i(e.exports,"DEFAULT_WORKSHEET_ROW_TITLE_WIDTH_KEY",function(){return hU}),i(e.exports,"DEFAULT_WORKSHEET_ROW_TITLE_WIDTH",function(){return hD}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT_KEY",function(){return hV}),i(e.exports,"DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT",function(){return hL}),i(e.exports,"mergeWorksheetSnapshotWithDefault",function(){return hP}),i(e.exports,"SheetViewModel",function(){return hk}),i(e.exports,"Worksheet",function(){return hB}),i(e.exports,"extractPureTextFromCell",function(){return h$}),i(e.exports,"getOriginCellValue",function(){return hH}),i(e.exports,"getWorksheetUID",function(){return hG}),i(e.exports,"Workbook",function(){return hY}),i(e.exports,"SlideDataModel",function(){return hz}),i(e.exports,"IUniverInstanceService",function(){return hK}),i(e.exports,"UniverInstanceService",function(){return hQ}),i(e.exports,"LifecycleStages",function(){return hZ}),i(e.exports,"LifecycleService",function(){return h1}),i(e.exports,"ILocalStorageService",function(){return h5}),i(e.exports,"LocaleService",function(){return h3}),i(e.exports,"PermissionStatus",function(){return h4}),i(e.exports,"IPermissionService",function(){return h6}),i(e.exports,"PermissionService",function(){return h9}),i(e.exports,"Plugin",function(){return dt}),i(e.exports,"DependentOn",function(){return dn}),i(e.exports,"PluginService",function(){return di}),i(e.exports,"mergeOverrideWithDependencies",function(){return ds}),i(e.exports,"IResourceLoaderService",function(){return da}),i(e.exports,"ResourceManagerService",function(){return dl}),i(e.exports,"ThemeService",function(){return du}),i(e.exports,"IUndoRedoService",function(){return dd}),i(e.exports,"RedoCommandId",function(){return dg}),i(e.exports,"UndoCommandId",function(){return df}),i(e.exports,"UndoCommand",function(){return dp}),i(e.exports,"RedoCommand",function(){return dC}),i(e.exports,"LocalUndoRedoService",function(){return d_}),i(e.exports,"nameCharacterCheck",function(){return dy}),i(e.exports,"awaitTime",function(){return dE}),i(e.exports,"delayAnimationFrame",function(){return dR}),i(e.exports,"ImageSourceType",function(){return db}),i(e.exports,"ImageUploadStatusType",function(){return dI}),i(e.exports,"IImageIoService",function(){return dN}),i(e.exports,"ImageCacheMap",function(){return dS}),i(e.exports,"skipParseTagNames",function(){return dA}),i(e.exports,"DataValidationErrorStyle",function(){return dv}),i(e.exports,"DataValidationImeMode",function(){return dT}),i(e.exports,"DataValidationOperator",function(){return dw}),i(e.exports,"DataValidationRenderMode",function(){return dM}),i(e.exports,"DataValidationStatus",function(){return dO}),i(e.exports,"DataValidationType",function(){return dx}),i(e.exports,"Skeleton",function(){return dD}),i(e.exports,"SheetSkeleton",function(){return dP}),i(e.exports,"getCellWithCoordByIndexCore",function(){return dj}),i(e.exports,"getTransformOffsetY",function(){return d$}),i(e.exports,"getTransformOffsetX",function(){return dB}),i(e.exports,"getCellCoordByIndexSimple",function(){return dF}),i(e.exports,"getCellPositionByIndexSimple",function(){return dk}),i(e.exports,"RTree",function(){return dX}),i(e.exports,"Univer",function(){return dZ}),i(e.exports,"invertColorByMatrix",function(){return d2}),i(e.exports,"invertColorByHSL",function(){return d9});var eJ,e0,e1,e2,e5,e3,e4,e6,e9=u("5LPkb"),e8=u("5K4WI"),e7=u("bXJOC"),te=u("arCqp"),tt=u("lMvMU"),tr=u("dBx9C"),tn=u("hciHF"),ti=u("i54iF"),ts=u("1O3Nt"),ta=u("3yupB"),to=u("3rvNF"),tl=u("9GqS8"),tu=u("1mjSk"),tc=u("e1VZ5"),th=u("9z4na"),td=u("b7wVW"),tm=u("aMpZj"),e7=u("bXJOC"),tt=u("lMvMU"),tg=u("bDEN0"),tn=u("hciHF"),tf=u("1ZKGP"),tp=u("hBGpS"),tC=u("8L69c"),t_=Object.defineProperty,ty=(e,t,r)=>t in e?t_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,tE=(e,t,r)=>ty(e,"symbol"!=typeof t?t+"":t,r);let tR="u">typeof n?n:"u">typeof self?self:window;function tb(e,t){let r=e.indexOf(t);return r>-1&&(e.splice(r,1),!0)}function tI(e){let t=new Set,r=[];for(let n of e)t.has(n)||(t.add(n),r.push(n));return r}function tN(e,t){let r=new Set,n=[];for(let i of e){let e=t(i);r.has(e)||(r.add(e),n.push(i))}return n}function tS(e,t){if(0===e.length)return e;let r=t%e.length;return e.slice(r).concat(e.slice(0,r))}function tA(e,t){let r=new Map;return e.forEach(e=>{let n=t(e),i=r.get(n);r.has(n)||(i=[],r.set(n,i)),i.push(e)}),r}function tv(e){return Array.isArray(e)?e:[e]}function tT(e,t){t.forEach(t=>e.add(t))}function tw(e,t){t.forEach(([t])=>{e.has(t)&&e.get(t)})}class tM extends Error{constructor(e){super(e),this.name="CustomCommandExecutionError"}}class tO extends Error{constructor(){super("Canceled by facade"),this.name="CanceledError"}}async function tx(e){for(let[t,r]of e.entries())try{if(!await r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}function tU(e){for(let[t,r]of e.entries())try{if(!r())return{index:t,result:!1}}catch(e){return{index:t,result:!1,error:e}}return{result:!0,index:-1}}function tD(e){let t=!1;return e?e instanceof tc.Subscription||e instanceof tu.Subject||e&&"closed"in e&&"u">typeof e.unsubscribe?{dispose:()=>e.unsubscribe()}:"function"==typeof e?{dispose:()=>{t||(t=!0,e())}}:e:tD(()=>{})}function tV(e){return tD(()=>{e.unsubscribe()})}class tL{constructor(){tE(this,"_disposables",new Set)}add(e){let t=tD(e);return this._disposables.add(t),{dispose:(e=!1)=>{e||t.dispose(),this._disposables.delete(t)}}}dispose(){this._disposables.forEach(e=>{e.dispose()}),this._disposables.clear()}}class tP{constructor(){tE(this,"_disposed",!1),tE(this,"_collection",new tL)}disposeWithMe(e){return this._collection.add(e)}ensureNotDisposed(){if(this._disposed)throw Error("[Disposable]: object is disposed!")}dispose(){this._disposed||(this._disposed=!0,this._collection.dispose())}}class tF extends tP{constructor(){super(...arguments),tE(this,"dispose$",new(0,tu.Subject))}dispose(){super.dispose(),this.dispose$.next(),this.dispose$.complete()}}class tk extends tP{constructor(e){super(),tE(this,"_ref",0),this._rootDisposable=e}inc(){if(this._disposed)throw Error("[RCDisposable]: should not ref to a disposed.");this._ref+=1}dec(){this._ref-=1,0===this._ref&&(this._rootDisposable.dispose(),this.dispose())}}let tj=(0,tf.createIdentifier)("univer.context-service");class tB extends tP{constructor(){super(...arguments),tE(this,"_contextChanged$",new(0,tu.Subject)),tE(this,"contextChanged$",this._contextChanged$.asObservable()),tE(this,"_contextMap",new Map)}dispose(){super.dispose(),this._contextChanged$.complete()}getContextValue(e){var t;return null!=(t=this._contextMap.get(e))&&t}setContextValue(e,t){this._contextMap.set(e,t),this._contextChanged$.next({[e]:t})}subscribeContextValue$(e){return new(0,ts.Observable)(t=>{let r=this._contextChanged$.pipe((0,tt.filter)(t=>"u">typeof t[e])).subscribe(r=>t.next(r[e]));return this._contextMap.has(e)&&t.next(this._contextMap.get(e)),()=>r.unsubscribe()})}}var t$=((r=t$||{})[r.SILENT=0]="SILENT",r[r.ERROR=1]="ERROR",r[r.WARN=2]="WARN",r[r.INFO=3]="INFO",r[r.VERBOSE=4]="VERBOSE",r);let tH=(0,tf.createIdentifier)("univer.log");class tW extends tP{constructor(){super(...arguments),tE(this,"_logLevel",3),tE(this,"_deduction",new Set)}debug(...e){this._logLevel>=4&&this._log(console.debug,...e)}log(...e){this._logLevel>=3&&this._log(console.log,...e)}warn(...e){this._logLevel>=2&&this._log(console.warn,...e)}error(...e){this._logLevel>=1&&this._log(console.error,...e)}deprecate(...e){this._logLevel>=2&&this._logWithDeduplication(console.error,...e)}setLogLevel(e){this._logLevel=e}_log(e,...t){let r=t[0];/^\[(.*?)\]/g.test(r)?e(`\x1b[97;104m${r}\x1b[0m`,...t.slice(1)):e(...t)}_logWithDeduplication(e,...t){let r=function(...e){return e.map(e=>JSON.stringify(e)).join("")}(...t);this._deduction.has(r)||(this._deduction.add(r),this._log(e,...t))}}var tG=Object.getOwnPropertyDescriptor,tY=(e,t)=>(r,n)=>t(r,n,e),tz=((s=tz||{})[s.COMMAND=0]="COMMAND",s[s.OPERATION=1]="OPERATION",s[s.MUTATION=2]="MUTATION",s);let tX=(0,tf.createIdentifier)("univer.core.command-service");class tq{constructor(){tE(this,"_commands",new Map),tE(this,"_commandTypes",new Map)}registerCommand(e){if(this._commands.has(e.id))throw Error(`[CommandRegistry]: command "${e.id}" has been registered before.`);return this._commands.set(e.id,e),this._commandTypes.set(e.id,e.type),tD(()=>{this.unregisterCommand(e.id)})}unregisterCommand(e){this._commands.delete(e),this._commandTypes.delete(e)}hasCommand(e){return this._commands.has(e)}getCommand(e){return this._commands.has(e)?[this._commands.get(e)]:null}getCommandType(e){return this._commandTypes.get(e)}}let tK={id:"nil",type:0,handler:()=>!0},tQ=class extends tP{constructor(e,t){super(),tE(this,"_commandRegistry"),tE(this,"_beforeCommandExecutionListeners",[]),tE(this,"_commandExecutedListeners",[]),tE(this,"_multiCommandDisposables",new Map),tE(this,"_commandExecutingLevel",0),tE(this,"_commandExecutionStack",[]),this._injector=e,this._logService=t,this._commandRegistry=new tq,this.registerCommand(tK)}dispose(){super.dispose(),this._commandExecutedListeners.length=0,this._beforeCommandExecutionListeners.length=0}hasCommand(e){return this._commandRegistry.hasCommand(e)}registerCommand(e){return this._commandRegistry.registerCommand(e)}unregisterCommand(e){var t;this._commandRegistry.unregisterCommand(e),null==(t=this._multiCommandDisposables.get(e))||t.dispose()}registerMultipleCommand(e){return this._registerMultiCommand(e)}beforeCommandExecuted(e){if(-1===this._beforeCommandExecutionListeners.indexOf(e))return this._beforeCommandExecutionListeners.push(e),tD(()=>{let t=this._beforeCommandExecutionListeners.indexOf(e);this._beforeCommandExecutionListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}onCommandExecuted(e){if(-1===this._commandExecutedListeners.indexOf(e))return this._commandExecutedListeners.push(e),tD(()=>{let t=this._commandExecutedListeners.indexOf(e);this._commandExecutedListeners.splice(t,1)});throw Error("[CommandService]: could not add a listener twice.")}async executeCommand(e,t,r){try{let n=this._commandRegistry.getCommand(e);if(n){let[e]=n,i={id:e.id,type:e.type,params:t},s=this._pushCommandExecutionStack(i);this._beforeCommandExecutionListeners.forEach(e=>e(i,r));let a=await this._execute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(i,r)),s.dispose(),a}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof tM)return!1;throw e}}syncExecuteCommand(e,t,r){var n;try{let i=this._commandRegistry.getCommand(e);if(i){let[e]=i,s={id:e.id,type:e.type,params:t};if(2===e.type){let e=function(e,t){for(let r=e.length-1;r>-1;r--){let n=e[r];if(t(n,r))return n}return null}(this._commandExecutionStack,e=>0===e.type);e&&(s.params=null!=(n=s.params)?n:{},s.params.trigger=e.id)}let a=this._pushCommandExecutionStack(s);this._beforeCommandExecutionListeners.forEach(e=>e(s,r));let o=this._syncExecute(e,t,r);return this._commandExecutedListeners.forEach(e=>e(s,r)),a.dispose(),o}throw Error(`[CommandService]: command "${e}" is not registered.`)}catch(e){if(e instanceof tM)return!1;throw e}}_pushCommandExecutionStack(e){return this._commandExecutionStack.push(e),tD(()=>tb(this._commandExecutionStack,e))}_registerMultiCommand(e){let t,r=this._commandRegistry.getCommand(e.id);if(r){if(!0!==r[0].multi)throw Error("Command has registered as a single command.");t=r[0]}else{t=new tZ(e.id);let r=new tL;r.add(this._commandRegistry.registerCommand(t)),r.add(tD(()=>{this._multiCommandDisposables.delete(e.id)})),this._multiCommandDisposables.set(e.id,r)}let n=t.registerImplementation(e);return tD(()=>{var r;n.dispose(),t.hasImplementations()||null==(r=this._multiCommandDisposables.get(e.id))||r.dispose()})}async _execute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(this._commandExecutingLevel,0))}executing command "${e.id}"`),this._commandExecutingLevel++;try{n=await this._injector.invoke(e.handler,t,r),this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}_syncExecute(e,t,r){let n;this._logService.debug("[CommandService]",`${"|-".repeat(Math.max(0,this._commandExecutingLevel))}executing command "${e.id}".`),this._commandExecutingLevel++;try{if((n=this._injector.invoke(e.handler,t,r))instanceof Promise)throw TypeError("[CommandService]: Command handler should not return a promise.");this._commandExecutingLevel--}catch(e){throw n=!1,this._commandExecutingLevel=0,e}return n}};tQ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tG(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tY(0,(0,tf.Inject)(tf.Injector)),tY(1,tH)],tQ);class tZ{constructor(e){tE(this,"name"),tE(this,"multi",!0),tE(this,"type",0),tE(this,"priority",0),tE(this,"_implementations",[]),tE(this,"handler",async(e,t)=>{if(!this._implementations.length)return!1;let r=e.get(tH),n=e.get(tj),i=e.get(tf.Injector);for(let e of this._implementations){let s=e.command.preconditions;if((!s||s&&s(n))&&(r.debug("[MultiCommand]",`executing implementation "${e.command.name}".`),await i.invoke(e.command.handler,t)))return!0}return!1}),this.id=e,this.name=e}registerImplementation(e){let t={command:e};return this._implementations.push(t),this._implementations.sort((e,t)=>t.command.priority-e.command.priority),tD(()=>{let e=this._implementations.indexOf(t);this._implementations.splice(e,1)})}hasImplementations(){return this._implementations.length>0}}function tJ(e,t,r){return tU(e.map(e=>()=>t.syncExecuteCommand(e.id,e.params,r)))}function t0(e,t,r){return tx(e.map(e=>()=>t.executeCommand(e.id,e.params,r)))}function t1(e){return new(0,ts.Observable)(t=>{let r=e((...e)=>t.next(e));return()=>null==r?void 0:r.dispose()})}function t2(e){return function(t){return new(0,ts.Observable)(r=>(t.subscribe({next:t=>{r.next(t),e(t)&&r.complete()},complete:()=>r.complete(),error:e=>r.error(e)}),()=>r.unsubscribe()))}}function t5(e=0){return t=>{let r=[];return t.pipe((0,td.tap)(e=>r.push(e)),(0,e7.debounceTime)(e),(0,tn.map)(()=>r),(0,td.tap)(()=>r=[]))}}function t3(e){let t=new(0,to.ReplaySubject)(1);return setTimeout(()=>t.next(),e),t.pipe((0,th.take)(1))}function t4(e,t){let r=new(0,e9.BehaviorSubject)(t);return e.subscribe(r),r}let t6=e=>new Promise(t=>{(0,ti.merge)(t1(e.onCommandExecuted.bind(e)).pipe((0,tt.filter)(([e])=>e.type===tz.MUTATION)),(0,tm.timer)(300)).pipe((0,e7.debounceTime)(16),(0,tg.first)()).subscribe(()=>{t()})});function t9(e,t){let r=0,n=e.length-1;if(t<e[0])return 0;if(t>=e[e.length-1])return e.length-1;for(;r<=n;){if(e[r]===t){for(;r<e.length&&e[r]===t;)r++;return r}if(t>e[r]&&t<e[r+1])return r+1;if(e[n]===t){for(;n<e.length&&e[n]===t;)n++;return n}if(t>e[n-1]&&t<e[n])return n;r++,n--}return -1}function t8(e,t){let r=0,n=e.length-1;for(;r<=n;){let i=Math.floor((n+r)/2);if(t<e[i]&&(0===i||t>=e[i-1]))return i;if(t>=e[i])r=i+1;else if(t<e[i])n=i-1;else break}return -1}function t7(e,t){let r=0,n=e.length;for(;r<n;){let i=Math.floor((r+n)/2);e[i]<=t?r=i+1:n=i}return r<e.length?r:e.length-1}function re(e,t,r=!1){let n=e.length-1;if(t<0||t<e[0])return 0;if(n=e.length<40||t<=e[20]||t>=e[n-20]?t9(e,t):t7(e,t),r){let t=e[n];return e.indexOf(t)}return n}function rt(e){let t=new Blob([e],{type:"text/javascript"});return window.URL.createObjectURL(t)}let rr=2,rn=1;function ri(e,t){if(null==t||null==e)return!0;let{left:r=0,top:n=0,height:i=0,width:s=0,angle:a=0}=t,{left:o=0,top:l=0,height:u=0,width:c=0,angle:h=0}=e;return Math.abs(o-r)>rr||Math.abs(l-n)>rr||Math.abs(c-s)>rr||Math.abs(u-i)>rr||Math.abs(h-a)>rn}var rs=((a=rs||{})[a.DEFAULT_SERIES=0]="DEFAULT_SERIES",a[a.ALTERNATE_SERIES=1]="ALTERNATE_SERIES",a),ra=((o=ra||{})[o.NONE=0]="NONE",o[o.THIN=1]="THIN",o[o.HAIR=2]="HAIR",o[o.DOTTED=3]="DOTTED",o[o.DASHED=4]="DASHED",o[o.DASH_DOT=5]="DASH_DOT",o[o.DASH_DOT_DOT=6]="DASH_DOT_DOT",o[o.DOUBLE=7]="DOUBLE",o[o.MEDIUM=8]="MEDIUM",o[o.MEDIUM_DASHED=9]="MEDIUM_DASHED",o[o.MEDIUM_DASH_DOT=10]="MEDIUM_DASH_DOT",o[o.MEDIUM_DASH_DOT_DOT=11]="MEDIUM_DASH_DOT_DOT",o[o.SLANT_DASH_DOT=12]="SLANT_DASH_DOT",o[o.THICK=13]="THICK",o),ro=((l=ro||{}).TOP="top",l.BOTTOM="bottom",l.LEFT="left",l.RIGHT="right",l.NONE="none",l.ALL="all",l.OUTSIDE="outside",l.INSIDE="inside",l.HORIZONTAL="horizontal",l.VERTICAL="vertical",l.TLBR="tlbr",l.TLBC_TLMR="tlbc_tlmr",l.TLBR_TLBC_TLMR="tlbr_tlbc_tlmr",l.BLTR="bl_tr",l.MLTR_BCTR="mltr_bctr",l),rl=((c=rl||{})[c.UNSUPPORTED=0]="UNSUPPORTED",c[c.RGB=1]="RGB",c[c.HEX=2]="HEX",c[c.THEME=3]="THEME",c),ru=((h=ru||{})[h.ON=0]="ON",h[h.OFF=1]="OFF",h),rc=((d=rc||{})[d.PASTE_NORMAL=0]="PASTE_NORMAL",d[d.PASTE_NO_BORDERS=1]="PASTE_NO_BORDERS",d[d.PASTE_FORMAT=2]="PASTE_FORMAT",d[d.PASTE_FORMULA=3]="PASTE_FORMULA",d[d.PASTE_DATA_VALIDATION=4]="PASTE_DATA_VALIDATION",d[d.PASTE_VALUES=5]="PASTE_VALUES",d[d.PASTE_CONDITIONAL_FORMATTING=6]="PASTE_CONDITIONAL_FORMATTING",d[d.PASTE_COLUMN_WIDTHS=7]="PASTE_COLUMN_WIDTHS",d),rh=((m=rh||{})[m.LEFT=0]="LEFT",m[m.RIGHT=1]="RIGHT",m),rd=((g=rd||{})[g.DOCUMENT=0]="DOCUMENT",g[g.PROJECT=1]="PROJECT",g),rm=((f=rm||{})[f.COLUMNS=0]="COLUMNS",f[f.ROWS=1]="ROWS",f),rg=((p=rg||{})[p.UP=0]="UP",p[p.RIGHT=1]="RIGHT",p[p.DOWN=2]="DOWN",p[p.LEFT=3]="LEFT",p);function rf(e){switch(e){case 3:return 1;case 1:return 3;case 0:return 2;case 2:return 0}}var rp=((C=rp||{})[C.INTERPOLATION_POINT_TYPE_UNSPECIFIED=0]="INTERPOLATION_POINT_TYPE_UNSPECIFIED",C[C.MIN=1]="MIN",C[C.MAX=2]="MAX",C[C.NUMBER=3]="NUMBER",C[C.PERCENT=4]="PERCENT",C[C.PERCENTILE=5]="PERCENTILE",C),rC=((_=rC||{}).EN_US="enUS",_.FR_FR="frFR",_.ZH_CN="zhCN",_.RU_RU="ruRU",_.ZH_TW="zhTW",_.VI_VN="viVN",_.FA_IR="faIR",_),r_=((y=r_||{})[y.PERSON=0]="PERSON",y[y.FILE=1]="FILE",y[y.DATE=2]="DATE",y[y.LOCATION=3]="LOCATION",y[y.EVENT=4]="EVENT",y),ry=((E=ry||{})[E.RANGE=0]="RANGE",E[E.SHEET=1]="SHEET",E),rE=((R=rE||{}).Line="line",R.LineInv="lineInv",R.Triangle="triangle",R.RtTriangle="rtTriangle",R.Rect="rect",R.Diamond="diamond",R.Parallelogram="parallelogram",R.Trapezoid="trapezoid",R.NonIsocelesTrapezoid="nonIsocelesTrapezoid",R.Pentagon="pentagon",R.Hexagon="hexagon",R.Heptagon="heptagon",R.Octagon="octagon",R.Decagon="decagon",R.Dodecagon="dodecagon",R.Star4="star4",R.Star5="star5",R.Star6="star6",R.Star7="star7",R.Star8="star8",R.Star10="star10",R.Star12="star12",R.Star16="star16",R.Star24="star24",R.Star32="star32",R.RoundRect="roundRect",R.Round1Rect="round1Rect",R.Round2SameRect="round2SameRect",R.Round2DiagRect="round2DiagRect",R.Ellipse="ellipse",R),rR=((b=rR||{}).RightArrow="rightArrow",b.LeftArrow="leftArrow",b.UpArrow="upArrow",b.DownArrow="downArrow",b.LeftRightArrow="leftRightArrow",b.UpDownArrow="upDownArrow",b.QuadArrow="quadArrow",b.LeftRightUpArrow="leftRightUpArrow",b.BentArrow="bentArrow",b.UturnArrow="uturnArrow",b.CircularArrow="circularArrow",b.NotchedRightArrow="notchedRightArrow",b.HomePlate="homePlate",b.Chevron="chevron",b.LeftCircularArrow="leftCircularArrow",b.LeftRightCircularArrow="leftRightCircularArrow",b),rb=((I=rb||{}).Plaque="plaque",I.Can="can",I.Cube="cube",I.Bevel="bevel",I.Donut="donut",I.NoSmoking="noSmoking",I.BlockArc="blockArc",I.FoldedCorner="foldedCorner",I),rI=((N=rI||{}).SmileyFace="smileyFace",N.Heart="heart",N.LightningBolt="lightningBolt",N.Sun="sun",N.Moon="moon",N.Cloud="cloud",N.Arc="arc",N.Backpack="backpack",N.Frame="frame",N.HalfFrame="halfFrame",N.Corner="corner",N.Chord="chord",N.Pie="pie",N.Teardrop="teardrop",N.WedgeRectCallout="wedgeRectCallout",N.WedgeRRectCallout="wedgeRRectCallout",N.WedgeEllipseCallout="wedgeEllipseCallout",N.CloudCallout="cloudCallout",N.BorderCallout1="borderCallout1",N.BorderCallout2="borderCallout2",N.BorderCallout3="borderCallout3",N.AccentCallout1="accentCallout1",N.AccentCallout2="accentCallout2",N.AccentCallout3="accentCallout3",N.Callout1="callout1",N.Callout2="callout2",N.Callout3="callout3",N.ActionButtonBackPrevious="actionButtonBackPrevious",N.ActionButtonEnd="actionButtonEnd",N.ActionButtonForwardNext="actionButtonForwardNext",N.ActionButtonHelp="actionButtonHelp",N.ActionButtonHome="actionButtonHome",N.ActionButtonInformation="actionButtonInformation",N.ActionButtonMovie="actionButtonMovie",N.ActionButtonReturn="actionButtonReturn",N.ActionButtonSound="actionButtonSound",N),rN=((S=rN||{})[S.RELATIVE_DATE_UNSPECIFIED=0]="RELATIVE_DATE_UNSPECIFIED",S[S.PAST_YEAR=1]="PAST_YEAR",S[S.PAST_MONTH=2]="PAST_MONTH",S[S.PAST_WEEK=3]="PAST_WEEK",S[S.YESTERDAY=4]="YESTERDAY",S[S.TODAY=5]="TODAY",S[S.TOMORROW=6]="TOMORROW",S),rS=((A=rS||{})[A.GRID=0]="GRID",A[A.KANBAN=1]="KANBAN",A[A.GANTT=2]="GANTT",A),rA=((v=rA||{})[v.UNSPECIFIED=0]="UNSPECIFIED",v[v.LEFT_TO_RIGHT=1]="LEFT_TO_RIGHT",v[v.RIGHT_TO_LEFT=2]="RIGHT_TO_LEFT",v),rv=((T=rv||{})[T.DASH=0]="DASH",T[T.DASH_DOT_DOT_HEAVY=1]="DASH_DOT_DOT_HEAVY",T[T.DASH_DOT_HEAVY=2]="DASH_DOT_HEAVY",T[T.DASHED_HEAVY=3]="DASHED_HEAVY",T[T.DASH_LONG=4]="DASH_LONG",T[T.DASH_LONG_HEAVY=5]="DASH_LONG_HEAVY",T[T.DOT_DASH=6]="DOT_DASH",T[T.DOT_DOT_DASH=7]="DOT_DOT_DASH",T[T.DOTTED=8]="DOTTED",T[T.DOTTED_HEAVY=9]="DOTTED_HEAVY",T[T.DOUBLE=10]="DOUBLE",T[T.NONE=11]="NONE",T[T.SINGLE=12]="SINGLE",T[T.THICK=13]="THICK",T[T.WAVE=14]="WAVE",T[T.WAVY_DOUBLE=15]="WAVY_DOUBLE",T[T.WAVY_HEAVY=16]="WAVY_HEAVY",T[T.WORDS=17]="WORDS",T),rT=((w=rT||{})[w.UNSPECIFIED=0]="UNSPECIFIED",w[w.LEFT=1]="LEFT",w[w.CENTER=2]="CENTER",w[w.RIGHT=3]="RIGHT",w[w.JUSTIFIED=4]="JUSTIFIED",w[w.BOTH=5]="BOTH",w[w.DISTRIBUTED=6]="DISTRIBUTED",w),rw=((M=rw||{})[M.UNSPECIFIED=0]="UNSPECIFIED",M[M.TOP=1]="TOP",M[M.MIDDLE=2]="MIDDLE",M[M.BOTTOM=3]="BOTTOM",M),rM=((O=rM||{})[O.UNSPECIFIED=0]="UNSPECIFIED",O[O.OVERFLOW=1]="OVERFLOW",O[O.CLIP=2]="CLIP",O[O.WRAP=3]="WRAP",O),rO=((x=rO||{})[x.NORMAL=0]="NORMAL",x[x.ITALIC=1]="ITALIC",x),rx=((U=rx||{})[U.NORMAL=0]="NORMAL",U[U.BOLD=1]="BOLD",U),rU=((D=rU||{})[D.NORMAL=1]="NORMAL",D[D.SUBSCRIPT=2]="SUBSCRIPT",D[D.SUPERSCRIPT=3]="SUPERSCRIPT",D),rD=((V=rD||{})[V.FALSE=0]="FALSE",V[V.TRUE=1]="TRUE",V),rV=((L=rV||{})[L.STRING=1]="STRING",L[L.NUMBER=2]="NUMBER",L[L.BOOLEAN=3]="BOOLEAN",L[L.FORCE_STRING=4]="FORCE_STRING",L),rL=((P=rL||{})[P.DARK1=0]="DARK1",P[P.LIGHT1=1]="LIGHT1",P[P.DARK2=2]="DARK2",P[P.LIGHT2=3]="LIGHT2",P[P.ACCENT1=4]="ACCENT1",P[P.ACCENT2=5]="ACCENT2",P[P.ACCENT3=6]="ACCENT3",P[P.ACCENT4=7]="ACCENT4",P[P.ACCENT5=8]="ACCENT5",P[P.ACCENT6=9]="ACCENT6",P[P.HYPERLINK=10]="HYPERLINK",P[P.FOLLOWED_HYPERLINK=11]="FOLLOWED_HYPERLINK",P),rP=((F=rP||{}).OFFICE="Office",F.OFFICE_2007_2010="Office 2007-2010",F.GRAYSCALE="Grayscale",F.BLUE_WARM="Blue Warm",F.BLUE="Blue",F.BLUE_II="Blue II",F.BLUE_GREEN="Blue Green",F.GREEN="Green",F.GREEN_YELLOW="Green Yellow",F.YELLOW="Yellow",F.YELLOW_ORANGE="Yellow Orange",F.ORANGE="Orange",F.ORANGE_RED="Orange Red",F.RED_ORANGE="Red Orange",F.RED="Red",F.RED_VIOLET="Red Violet",F.VIOLET="Violet",F.VIOLET_II="Violet II",F.MEDIAN="Median",F.PAPER="Paper",F.MARQUEE="Marquee",F.SLIPSTREAM="Slipstream",F.Aspect="Aspect",F);let rF=e=>crypto.getRandomValues(new Uint8Array(e)),rk=(e,t,r)=>{let n=(2<<Math.log2(e.length-1))-1,i=-~(1.6*n*t/e.length);return (s=t)=>{let a="";for(;;){let t=r(i),o=0|i;for(;o--;)if((a+=e[t[o]&n]||"").length>=s)return a}}},rj=(e,t=21)=>rk(e,0|t,rF),rB=(e=21)=>{let t="",r=crypto.getRandomValues(new Uint8Array(e|=0));for(;e--;)t+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[63&r[e]];return t},r$=new Set(["ac","ad","ae","aero","af","ag","ai","al","am","ao","aq","ar","arpa","as","asia","at","au","aw","ax","az","ba","bb","bd","be","bf","bg","bh","bi","biz","bj","bm","bn","bo","br","bs","bt","bv","bw","by","bz","ca","cat","cc","cd","cf","cg","ch","ci","ck","cl","cm","cn","co","com","coop","cr","cu","cv","cw","cx","cy","cz","de","dj","dk","dm","do","dz","ec","edu","ee","eg","er","es","et","eu","fi","fj","fk","fm","fo","fr","ga","gb","gd","ge","gf","gg","gh","gi","gl","gm","gn","gov","gp","gq","gr","gs","gt","gu","gw","gy","hk","hm","hn","hr","ht","hu","id","ie","il","im","in","info","int","io","iq","ir","is","it","je","jm","jo","jobs","jp","ke","kg","kh","ki","km","kn","kp","kr","kw","ky","kz","la","lb","lc","li","lk","lr","ls","lt","lu","lv","ly","ma","mc","md","me","mg","mh","mil","mk","ml","mm","mn","mo","mobi","mp","mq","mr","ms","mt","mu","museum","mv","mw","mx","my","mz","na","name","nc","ne","net","nf","ng","ni","nl","no","np","nr","nu","nz","om","onion","org","pa","pe","pf","pg","ph","pk","pl","pm","pn","post","pr","pro","ps","pt","pw","py","qa","re","ro","rs","ru","rw","sa","sb","sc","sd","se","sg","sh","si","sj","sk","sl","sm","sn","so","sr","ss","st","su","sv","sx","sy","sz","tc","td","tel","tf","tg","th","tj","tk","tl","tm","tn","to","tr","tt","tv","tw","tz","ua","ug","uk","us","uy","uz","va","vc","ve","vg","vi","vn","vu","wf","ws","yt","za","zm","zw"]),rH=RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)?(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");function rW(e){return/^[a-zA-Z]+:\/\//.test(e)}function rG(e){return rW(e)?e:/^[\w-\.]+@([\w-]+\.)+[\w-]{2,4}$/.test(e)?`mailto://${e}`:`https://${e}`}let rY=/^-ms-/,rz=/-([a-z])/g,rX=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];class rq{static deleteNull(e){for(let t in e)(null===e[t]||void 0===e[t])&&delete e[t];return e}static stringAt(e){let t="",r=e;for(;r>=rX.length;)r/=rX.length,r-=1,t+=rX[r%rX.length];let n=e%rX.length;return t+rX[n]}static indexAt(e){let t=0;for(let r=0;r<e.length-1;r+=1){let n=e.charCodeAt(r)-65,i=e.length-1-r;t+=rX.length**i+rX.length*n}return t+(e.charCodeAt(e.length-1)-65)}static deleteBlank(e){return rq.isString(e)?e.replace(/\s/g,""):e}static getSystemType(){let e=navigator.userAgent,t="Win32"===navigator.platform||"Windows"===navigator.platform,r="Mac68K"===navigator.platform||"MacPPC"===navigator.platform||"Macintosh"===navigator.platform||"MacIntel"===navigator.platform;if(r)return"Mac";if("X11"===navigator.platform&&!t&&!r)return"Unix";if(String(navigator.platform).indexOf("Linux")>-1)return"Linux";if(t){if(e.indexOf("Windows NT 5.0")>-1||e.indexOf("Windows 2000")>-1)return"Windows 2000";if(e.indexOf("Windows NT 5.1")>-1||e.indexOf("Windows XP")>-1)return"Windows XP";if(e.indexOf("Windows NT 5.2")>-1||e.indexOf("Windows 2003")>-1)return"Windows 2003";if(e.indexOf("Windows NT 6.0")>-1||e.indexOf("Windows Vista")>-1)return"Windows Vista";if(e.indexOf("Windows NT 6.1")>-1||e.indexOf("Windows 7")>-1)return"Windows 7";if(e.indexOf("Windows NT 10")>-1||e.indexOf("Windows 10")>-1)return"Windows 10";if(e.indexOf("Windows NT 11")>-1||e.indexOf("Windows 11")>-1)return"Windows 11"}return"Unknown system"}static getBrowserType(){let e=navigator.userAgent,t=e.indexOf("Opera")>-1,r=e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!t,n=e.indexOf("Trident")>-1&&e.indexOf("rv:11.0")>-1,i=e.indexOf("Edge")>-1,s=e.indexOf("Firefox")>-1,a=e.indexOf("Safari")>-1&&-1===e.indexOf("Chrome"),o=e.indexOf("Chrome")>-1&&e.indexOf("Safari")>-1;if(r){RegExp("MSIE (\\d+\\.\\d+);").test(e);let t=Number.parseFloat(RegExp.$1);return 7===t?"IE7":8===t?"IE8":9===t?"IE9":10===t?"IE10":"0"}return s?"FF":t?"Opera":a?"Safari":o?"Chrome":i?"Edge":n?"IE11":"Unknown browser"}static generateRandomId(e=21,t){return rK(e,t)}static getClassName(e){return e.constructor.name}static deepMerge(e,...t){function r(e,t){e.forEach((e,i)=>{var s,a;if(rq.isArray(e)){let n=null!=(s=t[i])?s:[];t[i]=n,r(e,n);return}if(rq.isObject(e)){let r=null!=(a=t[i])?a:{};t[i]=r,n(e,r);return}t[i]=e})}function n(e,t){Object.keys(e).forEach(i=>{var s,a;let o=e[i];if(rq.isObject(o)){let e=null!=(s=t[i])?s:{};t[i]=e,n(o,e);return}if(rq.isArray(o)){let e=null!=(a=t[i])?a:[];t[i]=e,r(o,e);return}t[i]=o})}return t.forEach(t=>{var i;return t&&void Object.keys(i=t).forEach(t=>{var s,a;let o=i[t];if(rq.isArray(o)){let n=null!=(s=e[t])?s:[];e[t]=n,r(o,n);return}if(rq.isObject(o)){let r=null!=(a=e[t])?a:{};e[t]=r,n(o,r);return}e[t]=o})}),e}static numberFixed(e,t){return Number(Number(e).toFixed(t))}static diffValue(e,t){return function e(t,r){return rq.getValueType(t)===rq.getValueType(r)&&(rq.isArray(t)?function(t,r){if(t.length!==r.length)return!1;for(let n=0,i=t.length;n<i;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):rq.isObject(t)?function(t,r){let n=Object.keys(t),i=Object.keys(r);if(n.length!==i.length)return!1;for(let s of n)if(!i.includes(s)||!e(t[s],r[s]))return!1;return!0}(t,r):rq.isDate(t)?t.getTime()===r.getTime():rq.isRegExp(t)?t.toString()===r.toString():t===r)}(e,t)}static deepClone(e){if(!this.isDefine(e))return e;if(this.isRegExp(e))return new RegExp(e);if(this.isDate(e))return new Date(e);if(this.isArray(e)){let t=[];return e.forEach((e,r)=>{t[r]=rq.deepClone(e)}),t}if(this.isObject(e)){let t={};return Object.keys(e).forEach(r=>{let n=e[r];t[r]=rq.deepClone(n)}),Object.setPrototypeOf(t,Object.getPrototypeOf(e)),t}return e}static getLanguage(){return globalThis.navigator&&(navigator.languages&&navigator.languages[0]||navigator.language)||"en-US"}static getValueType(e){return Object.prototype.toString.apply(e)}static isDefine(e){return null!=e}static isBlank(e){return!this.isDefine(e)||!!this.isString(e)&&""===e.trim()}static isBoolean(e){return"[object Boolean]"===this.getValueType(e)}static isPlainObject(e){return!!this.isDefine(e)&&Object.getPrototypeOf(e)===Object.getPrototypeOf({})}static isFunction(e){return"[object Function]"===this.getValueType(e)}static isDate(e){return"[object Date]"===this.getValueType(e)}static isRegExp(e){return"[object RegExp]"===this.getValueType(e)}static isArray(e){return"[object Array]"===this.getValueType(e)}static isString(e){return"[object String]"===this.getValueType(e)}static isNumber(e){return"[object Number]"===this.getValueType(e)}static isStringNumber(e){return!isNaN(Number.parseFloat(e))&&isFinite(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isEmptyObject(e){for(let t in e)return!1;return!0}static isMobile(){let e=0,t=0;return document.body.clientWidth&&(e=document.body.clientWidth),document.body.clientHeight&&(t=document.body.clientHeight),this.isAndroid()||this.isIPhone()||this.isTablet()||e<350&&t<500}static isTablet(){return/ipad|android|android 3.0|xoom|sch-i800|playbook|tablet|kindle/i.test(navigator.userAgent.toLowerCase())}static isWeChat(){return"micromessenger"===String(navigator.userAgent.toLowerCase().match(/MicroMessenger/i))}static isAndroid(){let e=navigator.userAgent;return e.indexOf("Android")>-1||e.indexOf("Linux")>-1}static isIPhone(){return/iPhone/i.test(navigator.userAgent)}static isLegalUrl(e){if(!Number.isNaN(+e))return!1;if(e.startsWith("http://localhost:3002")||e.startsWith("localhost:3002"))return!0;if(rH.test(e)){if(rW(e))return!0;try{let t=new URL(rG(e)).hostname.split(".").pop();if(t&&r$.has(t))return!0}catch{}}return!1}static normalizeUrl(e){return rG(e)}static topLevelDomainCombiningString(){return[...r$].join("|")}static itCount(e){return t=>{for(let r=0;r<e;r++)t&&t()}}static hasLength(e,t){return!!rq.isDefine(e)&&(rq.isDefine(t)?e.length===t:e.length>0)}static capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}static fCamelCase(e,t){return t.toUpperCase()}static camelCase(e){return e.replace(rY,"ms-").replace(rz,this.fCamelCase)}static removeNull(e){return this.isObject(e)&&Object.keys(e).forEach(t=>{let r=e[t];null==r?delete e[t]:rq.removeNull(r)}),e}static fillTwoDimensionalArray(e,t,r){return Array(e).fill(r).map(e=>Array(t).fill(r))}static numToWord(e){let t="";for(;e>0;){let r=e%26;t=String.fromCharCode(96+(r=0===r?r=26:r))+t,e=(e-r)/26}return t.toLocaleUpperCase()}static ABCatNum(e){if(null==e||0===e.length)return Number.NaN;let t=e.toLowerCase().split(""),r=t.length,n=0,i=0;for(let e=0;e<r;e++)n+=(t[e].charCodeAt(0)-96)*26**(r-e-1);return 0===n?Number.NaN:n-1}static chatAtABC(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+97)+t,e=Math.floor(e/26)-1;return t.toUpperCase()}static randSort(e){for(let t=0,r=e.length;t<r;t++){let n=Number.parseInt((Math.random()*r).toString()),i=e[n];e[n]=e[t],e[t]=i}return e}static commonExtend(e,t){let r={};for(let t in e)r[t]=e[t];for(let e in t)null!=t[e]&&(r[e]=t[e]);return r}static commonExtend1(e,t){for(let r in e)null==t[r]&&(t[r]=e[r]);return t}static arrayToObject(e){let t={};return e.forEach((e,r)=>{t[r]={},e.forEach((e,n)=>{t[r][n]=e})}),t}static hasIntersectionBetweenTwoRanges(e,t,r,n){return t>=r&&n>=e}static isStartValidPosition(e){return/^[A-Za-z_]/.test(e)}static isValidParameter(e){let t=/[~!@#$%^&*()+=\-{}\[\]\|:;"'<>,?\/ ]+/.test(e),r=e.length<=255;return!t&&r}static clamp(e,t,r){return Math.max(t,Math.min(r,e))}static now(){return performance&&performance.now?performance.now():Date.now()}}function rK(e=21,t){return t?rj(t,e)():rB(e)}function rQ(...e){let t={},r=e.length;for(let n=r-1;n>=0;n--){let r=e[n];if(r)for(let e of Object.keys(r))void 0===t[e]&&(t[e]=r[e])}return t}let rZ=()=>!1;function rJ(e,t,r){let{dataStream:n,textRuns:i=[]}=e,s=t,a=[];for(let e of i){let{st:i,ed:o}=e;rq.hasIntersectionBetweenTwoRanges(t,r,i,o)&&(i>s?(a.push(n.slice(s,i)),a.push(r1(n,{...e,ed:Math.min(o,r)}))):a.push(r1(n,{...e,st:s,ed:Math.min(o,r)}))),s=Math.max(t,Math.min(o,r))}return s!==r&&a.push(n.slice(s,r)),a.join("")}function r0(e,t=!0){var r;if(!t||null==(r=e.paragraphs)||!r.length)return rJ(e,0,e.dataStream.length);{let{dataStream:t,paragraphs:r=[]}=e,n="",i=-1;for(let t of r){let{startIndex:r,paragraphStyle:s={}}=t,{spaceAbove:a,spaceBelow:o,lineSpacing:l}=s,u=[];null!=a&&("number"==typeof a?u.push(`margin-top: ${a}px`):u.push(`margin-top: ${a.v}px`)),null!=o&&("number"==typeof o?u.push(`margin-bottom: ${o}px`):u.push(`margin-bottom: ${o.v}px`)),null!=l&&u.push(`line-height: ${l}`),r>i+1?n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}>${rJ(e,i+1,r)}</p>`:n+=`<p class="UniverNormal" ${u.length?`style="${u.join("; ")};"`:""}></p>`,i=r}return i!==t.length&&(n+=rJ(e,i,t.length)),n}}function r1(e,t){let{st:r,ed:n,ts:i={}}=t,{ff:s,fs:a,it:o,bl:l,ul:u,st:c,ol:h,bg:d,cl:m,va:g}=i,f=e.slice(r,n),p=[];return o===rD.TRUE&&(f=`<i>${f}</i>`),g===rU.SUPERSCRIPT?f=`<sup>${f}</sup>`:g===rU.SUBSCRIPT&&(f=`<sub>${f}</sub>`),(null==u?void 0:u.s)===rD.TRUE&&(f=`<u>${f}</u>`),(null==c?void 0:c.s)===rD.TRUE&&(f=`<s>${f}</s>`),l===rD.TRUE&&(f=`<strong>${f}</strong>`),s&&p.push(`font-family: ${s}`),m&&p.push(`color: ${m.rgb}`),a&&p.push(`font-size: ${a}pt`),h&&p.push("text-decoration: overline"),d&&p.push(`background: ${d.rgb}`),p.length?`<span style="${p.join("; ")};">${f}</span>`:f}let r2={[rP.OFFICE]:{[rL.ACCENT1]:"#4472C4",[rL.ACCENT2]:"#ED7D31",[rL.ACCENT3]:"#A5A5A5",[rL.ACCENT4]:"#70AD47",[rL.ACCENT5]:"#5B9BD5",[rL.ACCENT6]:"#70AD47",[rL.DARK1]:"#000000",[rL.DARK2]:"#44546A",[rL.LIGHT1]:"#FFFFFF",[rL.LIGHT2]:"#E7E6E6",[rL.HYPERLINK]:"#0563C1",[rL.FOLLOWED_HYPERLINK]:"#954F72"}};class r5{constructor(){tE(this,"_themeValue",rL.LIGHT1),tE(this,"_themeColors"),tE(this,"_themeTint"),tE(this,"_rgbValue",""),tE(this,"_colorType"),this._colorType=rl.UNSUPPORTED,this._themeColors=rP.OFFICE,this._themeTint=0}asRgbColor(){return new r9(this._rgbValue,this)}asThemeColor(){return new r7(this._themeValue,this._themeTint,this._themeColors,this)}build(){switch(this._colorType){case rl.THEME:return this.asThemeColor();case rl.RGB:return this.asRgbColor();case rl.UNSUPPORTED:throw Error("unsupported color type")}}setRgbColor(e){return this._colorType=rl.RGB,this._rgbValue=e,this}setThemeColors(e){this._colorType=rl.THEME,this._themeColors=e}setThemeTint(e){this._colorType=rl.THEME,this._themeTint=e}setThemeColor(e){return this._colorType=rl.THEME,this._themeValue=e,this}getColorType(){return this._colorType}}class r3{constructor(e){tE(this,"_builder"),this._builder=e}static rgbColorToHexValue(e){return`#${(0x1000000+(e.getRed()<<16)+(e.getGreen()<<8)+e.getBlue()).toString(16).slice(1)}`}static hexValueToRgbColor(e){e?e.indexOf("#")>-1&&(e=e.substring(1)):e="#000000";let t=+`0x${e[0]}${e[1]}`,r=+`0x${e[2]}${e[3]}`,n=+`0x${e[4]}${e[5]}`;return new r5().setRgbColor(`rgb(${t},${r},${n})`).asRgbColor()}static hexToRgbString(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(e,t,r,n)=>t+t+r+r+n+n);let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=null;if(t){let e=Number.parseInt(t[1],16),n=Number.parseInt(t[2],16),i=Number.parseInt(t[3],16);r=`rgba(${e},${n},${i})`}return r}asRgbColor(){return this._builder.asRgbColor()}asThemeColor(){return this._builder.asThemeColor()}getColorType(){return this._builder.getColorType()}clone(){return new r3(this._builder)}equals(e){return!1}}class r4{constructor(e){tE(this,"_saturation",0),tE(this,"_hue",0),tE(this,"_lightness",0),tE(this,"_alpha",0);let t=e.getRed()/255,r=e.getGreen()/255,n=e.getBlue()/255,i=e.getAlpha()/255,s=Math.min(t,Math.min(r,n)),a=Math.max(t,Math.max(r,n)),o=a-s;if(a===s){this._hue=0,this._saturation=0,this._lightness=a;return}this._lightness=(s+a)/2,this._lightness<.5?this._saturation=o/(a+s):this._saturation=o/(2-a-s),t===a&&(this._hue=(r-n)/o),r===a&&(this._hue=2+(n-t)/o),n===a&&(this._hue=4+(t-r)/o),this._hue*=60,this._hue<0&&(this._hue+=360),this._alpha=i}asRgbColor(){let e,t=new r5;if(0===this._saturation)return t.setRgbColor(`rgba(${255*this._lightness},${255*this._lightness},${255*this._lightness},${255*this._alpha})`),t.asRgbColor();e=this._lightness<.5?this._lightness*(1+this._saturation):this._lightness+this._saturation-this._lightness*this._saturation;let r=2*this._lightness-e,n=this._hue/360,i=this.setColor(e,r,n+1/3),s=this.setColor(e,r,n),a=this.setColor(e,r,n-1/3);return t.setRgbColor(`rgba(${Math.round(255*i)},${Math.round(255*s)},${Math.round(255*a)},${255*this._alpha})`),t.asRgbColor()}getLightness(){return this._lightness}getHue(){return this._hue}getSaturation(){return this._saturation}getAlpha(){return this._alpha}setColor(e,t,r){return r<0&&(r+=1),r>1&&(r-=1),6*r<1?t+(e-t)*6*r:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}setLightness(e){this._lightness=e}}let r6=class e extends r3{constructor(t,r){super(r),tE(this,"_cssString"),tE(this,"_red"),tE(this,"_green"),tE(this,"_blue"),tE(this,"_alpha");let n=t.match(e.RGBA_EXTRACT);if(n){let e=+n[1],r=+n[2],i=+n[3],s=+n[4];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=s;return}if(n=t.match(e.RGB_EXTRACT)){let e=+n[1],r=+n[2],i=+n[3];this._cssString=t,this._red=e,this._green=r,this._blue=i,this._alpha=1;return}throw Error("Invalid rgba or rgb color")}asHexString(){return r3.rgbColorToHexValue(this)}getRed(){let t=this._red+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getGreen(){let t=this._green+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getBlue(){let t=this._blue+e.RGB_COLOR_AMT;return t>255?t=255:t<0&&(t=0),t}getAlpha(){return this._alpha}getColorType(){return rl.RGB}clone(){return new e(this._cssString,this._builder)}asThemeColor(){throw Error("rgb color not support to themeColor")}equals(t){return t instanceof e&&t._red===this._red&&t._blue===this._blue&&t._green===this._green&&t._alpha===this._alpha}getCssString(){return this._cssString}};tE(r6,"RGB_COLOR_AMT",0),tE(r6,"RGBA_EXTRACT",RegExp("\\s*rgba\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d.\\d|\\d\\s*)\\)\\s*")),tE(r6,"RGB_EXTRACT",RegExp("\\s*rgb\\s*\\((\\s*\\d+\\s*),(\\s*\\d+\\s*),(\\s*\\d+\\s*)\\)\\s*"));let r9=r6,r8=class e extends r3{constructor(e,t,r,n){super(n),tE(this,"_themeColorType"),tE(this,"_themeTint"),tE(this,"_themeColors"),this._themeColorType=e,this._themeTint=t,this._themeColors=r}lumValue(e,t){return null==e?t:e<0?t*(1+e):t*(1-e)+(255-255*(1-e))}asRgbColor(){let t,r=r2[this._themeColors];if(null==r)throw Error("not find themeColors type");let n=r[this._themeColorType];if(null==n)throw Error("not find themeColors value");if(e._cacheThemeColor.has(this._themeColors)){if((t=e._cacheThemeColor.get(this._themeColors)).has(this._themeColorType))return t.get(this._themeColorType)}else t=new Map,e._cacheThemeColor.set(this._themeColors,t);let i=new r4(r3.hexValueToRgbColor(n));i.setLightness(this.lumValue(this._themeTint,255*i.getLightness())/255);let s=i.asRgbColor();return t.set(this._themeColorType,s),s}clone(){return new e(this._themeColorType,this._themeTint,this._themeColors,this._builder)}equals(t){return t instanceof e&&t._themeColorType===this._themeColorType}getColorType(){return rl.THEME}getThemeColorType(){return this._themeColorType}};tE(r8,"_cacheThemeColor",new Map);let r7=r8,ne="rgb(",nt="rgba(",nr={aliceBlue:[240,248,255],antiqueWhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blancheAlmond:[255,235,205],blue:[0,0,255],blueViolet:[138,43,226],brown:[165,42,42],burlyWood:[222,184,135],cadetBlue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornFlowerBlue:[100,149,237],cornSilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkCyan:[0,139,139],darkGoldenrod:[184,132,11],darkGray:[169,169,169],darkGreen:[0,100,0],darkGrey:[169,169,169],darkKhaki:[189,183,107],darkMagenta:[139,0,139],darkOliveGreen:[85,107,47],darkOrange:[255,140,0],darkOrchid:[153,50,204],darkRed:[139,0,0],darkSalmon:[233,150,122],darkSeaGreen:[143,188,143],darkSlateBlue:[72,61,139],darkSlateGray:[47,79,79],darkSlateGrey:[47,79,79],darkTurquoise:[0,206,209],darkViolet:[148,0,211],deepPink:[255,20,147],deepSkyBlue:[0,191,255],dimGray:[105,105,105],dimGrey:[105,105,105],dodgerBlue:[30,144,255],firebrick:[178,34,34],floralWhite:[255,255,240],forestGreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostWhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenYellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotPink:[255,105,180],indianRed:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderBlush:[255,240,245],lawnGreen:[124,252,0],lemonChiffon:[255,250,205],lightblue:[173,216,230],lightCoral:[240,128,128],lightCyan:[224,255,255],lightGoldenrodYellow:[250,250,210],lightGray:[211,211,211],lightGreen:[144,238,144],lightGrey:[211,211,211],lightPink:[255,182,193],lightSalmon:[255,160,122],lightSeaGreen:[32,178,170],lightSkyBlue:[135,206,250],lightSlateGray:[119,136,153],lightSlateGrey:[119,136,153],lightSteelBlue:[176,196,222],lightYellow:[255,255,224],lime:[0,255,0],limeGreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumAquamarine:[102,205,170],mediumBlue:[0,0,205],mediumOrchid:[186,85,211],mediumPurple:[147,112,219],mediumSeaGreen:[60,179,113],mediumSlateBlue:[123,104,238],mediumSpringGreen:[0,250,154],mediumTurquoise:[72,209,204],mediumVioletRed:[199,21,133],midBightBlue:[25,25,112],mintCream:[245,255,250],mistyRose:[255,228,225],moccasin:[255,228,181],navajoWhite:[255,222,173],navy:[0,0,128],oldLace:[253,245,230],olive:[128,128,0],oliveDrab:[107,142,35],orange:[255,165,0],orangeRed:[255,69,0],orchid:[218,112,214],paleGoldenrod:[238,232,170],paleGreen:[152,251,152],paleTurquoise:[175,238,238],paleVioletRed:[219,112,147],papayaWhip:[255,239,213],peachPuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderBlue:[176,224,230],purple:[128,0,128],rebeccaPurple:[102,51,153],red:[255,0,0],rosyBrown:[188,143,143],royalBlue:[65,105,225],saddleBrown:[139,69,19],salmon:[250,128,114],sandyBrown:[244,164,96],seaGreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyBlue:[135,206,235],slateBlue:[106,90,205],slateGray:[119,128,144],slateGrey:[119,128,144],snow:[255,255,250],springGreen:[0,255,127],steelBlue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],transparent:[255,255,255,0],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whiteSmoke:[245,245,245],yellow:[255,255,0],yellowGreen:[154,205,5]};class nn{constructor(e){if(tE(this,"_color"),tE(this,"_rgbColor"),tE(this,"_isValid",!1),null==e)return void this._setNullColor();if(e instanceof nn){this._color={...e._color},this._rgbColor={...e._rgbColor};return}let t=na(e);if(null==t)return void this._setNullColor();this._color=t;let r=nh(this._color);if(null==r)return void this._setNullColor();this._rgbColor=r,this._isValid=!0}static mix(e,t,r){var n,i;r=Math.min(1,Math.max(0,r));let s=new nn(e).toRgb(),a=new nn(t).toRgb(),o=null!=(n=s.a)?n:1,l=null!=(i=a.a)?i:1;return new nn({r:(a.r-s.r)*r+s.r,g:(a.g-s.g)*r+s.g,b:(a.b-s.b)*r+s.b,a:(l-o)*r+o})}static getContrastRatio(e,t){let r=new nn(e).getLuminance(),n=new nn(t).getLuminance();return(Math.max(r,n)+.05)/(Math.min(r,n)+.05)}get isValid(){return this._isValid}toRgb(){return this._rgbColor}toRgbString(){let{r:e,g:t,b:r,a:n=1}=this.toRgb(),i=n<1;return`rgb${i?"a":""}(${e},${t},${r}${i?`,${n}`:""})`}toString(){return this.toRgbString()}toHexString(e){let{r:t,g:r,b:n,a:i=1}=this.toRgb(),s=i<1,a=[ni(Math.round(t).toString(16)),ni(Math.round(r).toString(16)),ni(Math.round(n).toString(16)),ni(Math.round(255*i).toString(16))];return e&&a[0][0]===a[0][1]&&a[1][0]===a[1][1]&&a[2][0]===a[2][1]&&a[3][0]===a[3][1]?s?`#${a[0][0]}${a[1][0]}${a[2][0]}${a[3][0]}`:`#${a[0][0]}${a[1][0]}${a[2][0]}`:s?`#${a[0]}${a[1]}${a[2]}${a[3]}`:`#${a[0]}${a[1]}${a[2]}`}toHsv(){return np(this.toRgb())}toHsl(){return nf(this.toRgb())}lighten(e=10){let t=this.toHsl();return t.l+=e,t.l=Math.min(Math.max(t.l,0),100),new nn(t)}darken(e=10){let t=this.toHsl();return t.l-=e,t.l=Math.min(Math.max(t.l,0),100),new nn(t)}setAlpha(e){return new nn({...this._rgbColor,a:e})}getLuminance(){let{r:e,g:t,b:r}=this.toRgb();return e=ns(e),Number((.2126*e+.7152*(t=ns(t))+.0722*(r=ns(r))).toFixed(3))}getBrightness(){let{r:e,g:t,b:r}=this.toRgb();return(299*e+587*t+114*r)/1e3}getAlpha(){var e;return null!=(e=this._color.a)?e:1}isDark(){return 128>this.getBrightness()}isLight(){return!this.isDark()}_setNullColor(){this._isValid=!1,this._color={r:0,g:0,b:0,a:0},this._rgbColor={r:0,g:0,b:0,a:0}}}let ni=e=>1===e.length?`0${e}`:e,ns=e=>(e/=255)<=.03928?e/12.92:((e+.055)/1.055)**2.4,na=e=>{if(n_(e)){if("r"in e){let t={r:Math.round(e.r),g:Math.round(e.g),b:Math.round(e.b)};return void 0!==e.a&&(t.a=e.a),t}if("l"in e){let t={h:Math.round(e.h),s:e.s,l:e.l};return void 0!==e.a&&(t.a=e.a),t}let t={h:Math.round(e.h),s:e.s,v:e.v};return void 0!==e.a&&(t.a=e.a),t}let t=e.trim();if(nr[t]){let e=nr[t],r={r:Math.round(e[0]),g:Math.round(e[1]),b:Math.round(e[2])};return r.a=e[3]||1,r}return t.startsWith("#")?no(t):t.startsWith("rgb")?nl(t):t.startsWith("hsl")?nu(t):t.startsWith("hsv")?nc(t):void 0},no=e=>{let t=e.substring(1),r=RegExp(`.{1,${t.length>=6?2:1}}`,"g"),n=t.match(r);if(!n||n.length<3)throw Error(`The color '${e}' is illegal hex color`);1===n[0].length&&(n=n.map(e=>e+e));let i={r:Number.parseInt(n[0],16),g:Number.parseInt(n[1],16),b:Number.parseInt(n[2],16)};return n.length>3&&(i.a=Number.parseInt(n[3],16)/255),i},nl=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal rgb color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal rgb color`);let n={r:Number.parseInt(r[0],10),g:Number.parseInt(r[1],10),b:Number.parseInt(r[2],10)};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},nu=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsl color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsl color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),l:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},nc=e=>{let t=e.indexOf("(");if(-1===t)throw Error(`The color '${e}' is illegal hsv color`);let r=e.substring(t+1,e.length-1).split(",");if(r.length<3)throw Error(`The color '${e}' is illegal hsv color`);let n={h:Number.parseInt(r[0],10),s:Number.parseFloat(r[1]),v:Number.parseFloat(r[2])};return r.length>3&&(n.a=Number.parseFloat(r[3])),n},nh=e=>{let t=na(e);if(null!=t)return"r"in t?t:"l"in t?nm(t):ng(t)},nd=(e,t,r)=>(r<0&&(r+=1),r>1&&(r-=1),r<1/6?e+(t-e)*6*r:r<.5?t:r<2/3?e+(t-e)*(2/3-r)*6:e),nm=e=>{let{h:t,s:r,l:n}=e;t/=360,r/=100,n/=100;let i=0,s=0,a=0;if(0===r)i=s=a=n;else{let e=n<.5?n*(1+r):n+r-n*r,o=2*n-e;i=nd(o,e,t+1/3),s=nd(o,e,t),a=nd(o,e,t-1/3)}let o={r:Math.round(255*i),g:Math.round(255*s),b:Math.round(255*a)};return void 0!==e.a&&(o.a=e.a),o},ng=e=>{let{h:t,s:r,v:n}=e;t=t/360*6,r/=100,n/=100;let i=Math.floor(t),s=t-i,a=n*(1-r),o=n*(1-s*r),l=n*(1-(1-s)*r),u=i%6,c={r:255*[n,o,a,a,l,n][u],g:255*[l,n,n,o,a,a][u],b:255*[a,a,l,n,n,o][u]};return void 0!==e.a&&(c.a=e.a),c},nf=e=>{let t,r,{r:n,g:i,b:s}=e;n/=255;let a=Math.max(n,i/=255,s/=255),o=Math.min(n,i,s),l=(a+o)/2;if(a===o)t=r=0;else{let e=a-o;switch(r=l>.5?e/(2-a-o):e/(a+o),a){case n:t=(i-s)/e+6*(i<s);break;case i:t=(s-n)/e+2;break;default:t=(n-i)/e+4}t/=6}let u={h:Math.round(360*t),s:Math.round(100*r),l:Math.round(100*l)};return void 0!==e.a&&(u.a=e.a),u},np=e=>{let t,{r:r,g:n,b:i}=e;r/=255;let s=Math.max(r,n/=255,i/=255),a=Math.min(r,n,i),o=s-a;if(s===a)t=0;else{switch(s){case r:t=(n-i)/o+6*(n<i);break;case n:t=(i-r)/o+2;break;default:t=(r-n)/o+4}t/=6}let l={h:Math.round(360*t),s:Math.round(100*(0===s?0:o/s)),v:Math.round(100*s)};return void 0!==e.a&&(l.a=e.a),l},nC=e=>null==e,n_=e=>!nC(e)&&"object"==typeof e;function ny(e){return!!(/^#(?:[0]{3}|[0]{6})\b/.test(e)||/^rgb\s*\(\s*0+\s*,\s*0+\s*,\s*0+\s*\)$/.test(e)||/^rgba\s*\(\s*0+\s*,\s*0+\s*,\s*0+\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e)||/^hsl\s*\(\s*0*\s*,\s*0%*\s*,\s*0%*\s*\)$/.test(e)||/^hsla\s*\(\s*0*\s*,\s*0%*\s*,\s*0%*\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e))}function nE(e){return!!(/^#(?:[Ff]{3}|[Ff]{6})\b/.test(e)||/^rgb\s*\(\s*255\s*,\s*255\s*,\s*255\s*\)$/.test(e)||/^rgba\s*\(\s*255\s*,\s*255\s*,\s*255\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e)||/^hsl\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*\)$/.test(e)||/^hsla\s*\(\s*0*\s*,\s*0%*\s*,\s*100%*\s*,\s*(1|1\.0*|0?\.\d+)\)$/.test(e))}var nR=((k=nR||{})[k.COVER=0]="COVER",k[k.REPLACE=1]="REPLACE",k);function nb(e){return e&&(void 0!==e.s||void 0!==e.p||void 0!==e.v||void 0!==e.t||void 0!==e.f||void 0!==e.si||void 0!==e.custom)}function nI(e){return void 0!==e.t?e.t:"string"==typeof e.v?rV.STRING:"number"==typeof e.v?rV.NUMBER:"boolean"==typeof e.v?rV.BOOLEAN:void 0}function nN(e){if(null==e)return!0;let{v:t,f:r,si:n,p:i,custom:s}=e;return!(null!=t&&("string"!=typeof t||0!==t.length)||null!=r&&r.length>0||null!=n&&n.length>0||null!=i||null!=s)}function nS(e){return null!=e&&("string"==typeof e||"number"==typeof e||"boolean"==typeof e)}var nA=((j=nA||{})[j.NORMAL=0]="NORMAL",j[j.ROW=1]="ROW",j[j.COLUMN=2]="COLUMN",j[j.ALL=3]="ALL",j),nv=((B=nv||{})[B.NONE=0]="NONE",B[B.ROW=1]="ROW",B[B.COLUMN=2]="COLUMN",B[B.ALL=3]="ALL",B);function nT(e){return[e.startRow,e.startColumn,e.endRow,e.endColumn]}var nw=(($=nw||{}).NONE="none",$.BACKWARD="backward",$.FORWARD="forward",$),nM=((H=nM||{}).RECT="RECT",H.TEXT="TEXT",H);function nO(e,t,r){let n=!1,i=!1,s=e,a=t,o=e,l=t;if(null==r)return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l};for(let u=0;u<r.length;u++){let{startRow:c,endRow:h,startColumn:d,endColumn:m}=r[u];if(e===c&&t===d){s=h,a=m,o=c,l=d,i=!0;break}if(e>=c&&e<=h&&t>=d&&t<=m){s=h,a=m,o=c,l=d,n=!0;break}}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}var nx=((W=nx||{}).Raw="raw",W.Intercepted="intercepted",W.Both="both",W);function nU(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,mergeInfo:s}=e,{startY:a,endY:o,startX:l,endX:u}=e,c=t,h=r,d=t,m=r;if(n&&s){let{startRow:e,startColumn:t,endRow:r,endColumn:n,startY:i,endY:g,startX:f,endX:p}=s;c=e,h=t,d=r,m=n,a=i,o=g,l=f,u=p}return i&&(a=s.startY,o=s.endY,l=s.startX,u=s.endX,d=s.endRow,m=s.endColumn),{startRow:c,startColumn:h,endRow:d,endColumn:m,startY:a,endY:o,startX:l,endX:u}}let nD=nU;function nV(e){if(!e)return;let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,startRow:s,startColumn:a,endRow:o,endColumn:l}=e,u=t,c=r,h=t,d=r;return(n||i)&&(u=s,c=a,h=o,d=l),{startRow:u,startColumn:c,endRow:h,endColumn:d}}function nL(e){var t;return!e||0===((null==(t=null==e?void 0:e.v)?void 0:t.toString())||"").length&&!e.p}function nP(e){return nL(e)&&(null==e?void 0:e.coverable)!==!1}function nF(e){if(e){if(e.rgb)return e.rgb;if(e.th)return new r5().setThemeColor(e.th).asThemeColor().asRgbColor().getCssString()}return null}function nk(e){return rq.isString(e)&&"="===e.substring(0,1)&&e.length>1}function nj(e){return rq.isString(e)&&e.length>0}function nB(e,t=!1){var r;let n="",i=new Map([["ff",()=>{e.ff&&(n+=`font-family: ${e.ff}; `)}],["fs",()=>{if(e.fs){let t=e.fs;e.va&&(t/=2),n+=`font-size: ${t}pt; `}}],["it",()=>{e.it&&(n+="font-style: italic; ")}],["bl",()=>{e.bl&&(n+="font-weight: bold; ")}],["ul",()=>{var t;null!=(t=e.ul)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} underline`):n+="text-decoration: underline; ",e.ul.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${nF(e.ul.cl)}; `),e.ul.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ul.t} `))}],["st",()=>{var t;null!=(t=e.st)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} line-through`):n+="text-decoration-line: line-through; ",e.st.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${nF(e.st.cl)}; `),e.st.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.st.t} `))}],["ol",()=>{var t;null!=(t=e.ol)&&t.s&&(n.indexOf("text-decoration-line")>-1?n=n.replace(/(text-decoration-line:\s*[^;]+)(?=;)/g,(e,t)=>`${t} overline`):n+="text-decoration-line: overline; ",e.ol.cl&&-1===n.indexOf("text-decoration-color")&&(n+=`text-decoration-color: ${nF(e.ol.cl)}; `),e.ol.t&&-1===n.indexOf("text-decoration-style")&&(n+=`text-decoration-style: ${e.ol.t} `))}],["bg",()=>{e.bg&&(n+=`background: ${nF(e.bg)}; `)}],["bd",()=>{var t,r,i,s,a,o,l,u,c,h,d,m;null!=(t=e.bd)&&t.b&&(n+=`border-bottom: ${n$(null==(r=e.bd)?void 0:r.b.s)} ${null!=(i=nF(e.bd.b.cl))?i:""}; `),null!=(s=e.bd)&&s.t&&(n+=`border-top: ${n$(null==(a=e.bd)?void 0:a.t.s)} ${null!=(o=nF(e.bd.t.cl))?o:""}; `),null!=(l=e.bd)&&l.r&&(n+=`border-right: ${n$(null==(u=e.bd)?void 0:u.r.s)} ${null!=(c=nF(e.bd.r.cl))?c:""}; `),null!=(h=e.bd)&&h.l&&(n+=`border-left: ${n$(null==(d=e.bd)?void 0:d.l.s)} ${null!=(m=nF(e.bd.l.cl))?m:""}; `)}],["cl",()=>{e.cl&&(n+=`color: ${nF(e.cl)}; `)}],["va",()=>{e.va===rU.SUBSCRIPT?n+="vertical-align: sub; ":e.va===rU.SUPERSCRIPT&&(n+="vertical-align: super; ")}],["td",()=>{e.td===rA.LEFT_TO_RIGHT?n+="direction: ltr; ":e.td===rA.RIGHT_TO_LEFT&&(n+="direction: rtl; ")}],["tr",()=>{var t,r,i;e.tr&&(n+=`--data-rotate: (${null==(t=e.tr)?void 0:t.a}deg${null!=(r=e.tr)&&r.v?` ,${null==(i=e.tr)?void 0:i.v}`:""});`)}],["ht",()=>{e.ht===rT.LEFT?n+="text-align: left; ":e.ht===rT.RIGHT?n+="text-align: right; ":e.ht===rT.CENTER?n+="text-align: center; ":e.ht===rT.JUSTIFIED&&(n+="text-align: justify; ")}],["vt",()=>{e.vt===rw.BOTTOM?n+="vertical-align: bottom; ":e.vt===rw.TOP?n+="vertical-align: top; ":e.vt===rw.MIDDLE&&(n+="vertical-align: middle; ")}],["tb",()=>{e.tb===rM.CLIP?n+="white-space: nowrap; overflow-x: hidden; ":e.tb===rM.WRAP&&(n+="white-space: normal;")}],["pd",()=>{var t,r,i,s,a,o,l,u;let c=`${null==(t=e.pd)?void 0:t.b}pt`,h=`${null==(r=e.pd)?void 0:r.t}pt`,d=`${null==(i=e.pd)?void 0:i.l}pt`,m=`${null==(s=e.pd)?void 0:s.r}pt`;null!=(a=e.pd)&&a.b&&(n+=`padding-bottom: ${c}; `),null!=(o=e.pd)&&o.t&&(n+=`padding-top: ${h}; `),null!=(l=e.pd)&&l.l&&(n+=`padding-left: ${d}; `),null!=(u=e.pd)&&u.r&&(n+=`padding-right: ${m}; `)}]]),s=["bd","tr","tb"];for(let n in e)t&&s.includes(n)||null==(r=i.get(n))||r();return n}function n$(e){let t="";return e===ra.NONE?t="none":e===ra.THIN?t="0.5pt solid":e===ra.HAIR?t="0.5pt double":e===ra.DOTTED?t="0.5pt dotted":e===ra.DASHED||e===ra.DASH_DOT?t="0.5pt dashed":e===ra.DASH_DOT_DOT?t="0.5pt dotted":e===ra.DOUBLE?t="0.5pt double":e===ra.MEDIUM?t="1pt solid":e===ra.MEDIUM_DASHED||e===ra.MEDIUM_DASH_DOT?t="1pt dashed":e===ra.MEDIUM_DASH_DOT_DOT?t="1pt dotted":e===ra.SLANT_DASH_DOT?t="0.5pt dashed":e===ra.THICK&&(t="1.5pt solid"),t}function nH(e){let t=0;if("none"===(e=e.trim()))t=ra.NONE;else if("0.5pt solid"===e)t=ra.THIN;else if("0.5pt double"===e)t=ra.HAIR;else if("0.5pt dotted"===e)t=ra.DOTTED;else if("0.5pt dashed"===e)t=ra.DASHED;else if("1pt solid"===e)t=ra.MEDIUM;else if("1pt dashed"===e)t=ra.MEDIUM_DASHED;else if("1pt dotted"===e)t=ra.MEDIUM_DASH_DOT_DOT;else if("1.5pt solid"===e)t=ra.THICK;else{if(e.includes("none"))return ra.NONE;t=ra.THIN}return t}function nW(e,t){let r=e.body;if(t){let{headers:n,footers:i}=e;null!=n&&n[t]?r=n[t].body:null!=i&&i[t]&&(r=i[t].body)}return r}function nG(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s,rangeType:a}=e;if(r<0||i<0||n<0||s<0||!(Number.isNaN(r)&&Number.isNaN(n))&&a===nA.COLUMN||!(Number.isNaN(i)&&Number.isNaN(s))&&a===nA.ROW||a!==nA.ROW&&a!==nA.COLUMN&&(Number.isNaN(i)||Number.isNaN(r)||Number.isNaN(s)||Number.isNaN(n)))return!1;if(t){let e=t.getRowCount(),r=t.getColumnCount();if(n>=e||s>=r)return!1}return!0}function nY(e,t){return{startRow:e,endRow:e,startColumn:t,endColumn:t}}function nz(e,t){return Object.prototype.toString.call(e)===Object.prototype.toString.call(t)&&("[object Object]"===Object.prototype.toString.call(e)||"[object Array]"===Object.prototype.toString.call(e)?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).every(r=>nz(e[r],t[r])):e===t)}function nX(e,t){let r=e.ts||{},n=t.ts||{};return e.sId===t.sId&&nz(r,n)}function nq(e,t){return t.some(t=>e.indexOf(t)>-1)}function nK(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var nQ,nZ={exports:{}};nZ.exports;let nJ=nK((nQ||(nQ=1,n0="millisecond",n1="second",n2="minute",n5="hour",n3="week",n4="month",n6="quarter",n9="year",n8="date",n7="Invalid Date",ie=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,it=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,ir=function(e,t,r){var n=String(e);return!n||n.length>=t?e:""+Array(t+1-n.length).join(r)+e},(is={})[ii="en"]={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],r=e%100;return"["+e+(t[(r-20)%10]||t[r]||t[0])+"]"}},ia="$isDayjsObject",io=function(e){return e instanceof ih||!(!e||!e[ia])},il=function e(t,r,n){var i;if(!t)return ii;if("string"==typeof t){var s=t.toLowerCase();is[s]&&(i=s),r&&(is[s]=r,i=s);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var o=t.name;is[o]=t,i=o}return!n&&i&&(ii=i),i||!n&&ii},iu=function(e,t){if(io(e))return e.clone();var r="object"==typeof t?t:{};return r.date=e,r.args=arguments,new ih(r)},(ic={s:ir,z:function(e){var t=-e.utcOffset(),r=Math.abs(t);return(t<=0?"+":"-")+ir(Math.floor(r/60),2,"0")+":"+ir(r%60,2,"0")},m:function e(t,r){if(t.date()<r.date())return-e(r,t);var n=12*(r.year()-t.year())+(r.month()-t.month()),i=t.clone().add(n,n4),s=r-i<0,a=t.clone().add(n+(s?-1:1),n4);return+(-(n+(r-i)/(s?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return({M:n4,y:n9,w:n3,d:"day",D:n8,h:n5,m:n2,s:n1,ms:n0,Q:n6})[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}}).l=il,ic.i=io,ic.w=function(e,t){return iu(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})},id=(ih=function(){function e(e){this.$L=il(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[ia]=!0}var t=e.prototype;return t.parse=function(e){this.$d=function(e){var t=e.date,r=e.utc;if(null===t)return new Date(NaN);if(ic.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var n=t.match(ie);if(n){var i=n[2]-1||0,s=(n[7]||"0").substring(0,3);return r?new Date(Date.UTC(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)):new Date(n[1],i,n[3]||1,n[4]||0,n[5]||0,n[6]||0,s)}}return new Date(t)}(e),this.init()},t.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},t.$utils=function(){return ic},t.isValid=function(){return this.$d.toString()!==n7},t.isSame=function(e,t){var r=iu(e);return this.startOf(t)<=r&&r<=this.endOf(t)},t.isAfter=function(e,t){return iu(e)<this.startOf(t)},t.isBefore=function(e,t){return this.endOf(t)<iu(e)},t.$g=function(e,t,r){return ic.u(e)?this[t]:this.set(r,e)},t.unix=function(){return Math.floor(this.valueOf()/1e3)},t.valueOf=function(){return this.$d.getTime()},t.startOf=function(e,t){var r=this,n=!!ic.u(t)||t,i=ic.p(e),s=function(e,t){var i=ic.w(r.$u?Date.UTC(r.$y,t,e):new Date(r.$y,t,e),r);return n?i:i.endOf("day")},a=function(e,t){return ic.w(r.toDate()[e].apply(r.toDate("s"),(n?[0,0,0,0]:[23,59,59,999]).slice(t)),r)},o=this.$W,l=this.$M,u=this.$D,c="set"+(this.$u?"UTC":"");switch(i){case n9:return n?s(1,0):s(31,11);case n4:return n?s(1,l):s(0,l+1);case n3:var h=this.$locale().weekStart||0,d=(o<h?o+7:o)-h;return s(n?u-d:u+(6-d),l);case"day":case n8:return a(c+"Hours",0);case n5:return a(c+"Minutes",1);case n2:return a(c+"Seconds",2);case n1:return a(c+"Milliseconds",3);default:return this.clone()}},t.endOf=function(e){return this.startOf(e,!1)},t.$set=function(e,t){var r,n=ic.p(e),i="set"+(this.$u?"UTC":""),s=((r={}).day=i+"Date",r[n8]=i+"Date",r[n4]=i+"Month",r[n9]=i+"FullYear",r[n5]=i+"Hours",r[n2]=i+"Minutes",r[n1]=i+"Seconds",r[n0]=i+"Milliseconds",r)[n],a="day"===n?this.$D+(t-this.$W):t;if(n===n4||n===n9){var o=this.clone().set(n8,1);o.$d[s](a),o.init(),this.$d=o.set(n8,Math.min(this.$D,o.daysInMonth())).$d}else s&&this.$d[s](a);return this.init(),this},t.set=function(e,t){return this.clone().$set(e,t)},t.get=function(e){return this[ic.p(e)]()},t.add=function(e,t){var r,n=this;e=Number(e);var i=ic.p(t),s=function(t){var r=iu(n);return ic.w(r.date(r.date()+Math.round(t*e)),n)};if(i===n4)return this.set(n4,this.$M+e);if(i===n9)return this.set(n9,this.$y+e);if("day"===i)return s(1);if(i===n3)return s(7);var a=((r={})[n2]=6e4,r[n5]=36e5,r[n1]=1e3,r)[i]||1,o=this.$d.getTime()+e*a;return ic.w(o,this)},t.subtract=function(e,t){return this.add(-1*e,t)},t.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return r.invalidDate||n7;var n=e||"YYYY-MM-DDTHH:mm:ssZ",i=ic.z(this),s=this.$H,a=this.$m,o=this.$M,l=r.weekdays,u=r.months,c=r.meridiem,h=function(e,r,i,s){return e&&(e[r]||e(t,n))||i[r].slice(0,s)},d=function(e){return ic.s(s%12||12,e,"0")},m=c||function(e,t,r){var n=e<12?"AM":"PM";return r?n.toLowerCase():n};return n.replace(it,function(e,n){return n||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return ic.s(t.$y,4,"0");case"M":return o+1;case"MM":return ic.s(o+1,2,"0");case"MMM":return h(r.monthsShort,o,u,3);case"MMMM":return h(u,o);case"D":return t.$D;case"DD":return ic.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return h(r.weekdaysMin,t.$W,l,2);case"ddd":return h(r.weekdaysShort,t.$W,l,3);case"dddd":return l[t.$W];case"H":return String(s);case"HH":return ic.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return m(s,a,!0);case"A":return m(s,a,!1);case"m":return String(a);case"mm":return ic.s(a,2,"0");case"s":return String(t.$s);case"ss":return ic.s(t.$s,2,"0");case"SSS":return ic.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")})},t.utcOffset=function(){return-(15*Math.round(this.$d.getTimezoneOffset()/15))},t.diff=function(e,t,r){var n,i=this,s=ic.p(t),a=iu(e),o=(a.utcOffset()-this.utcOffset())*6e4,l=this-a,u=function(){return ic.m(i,a)};switch(s){case n9:n=u()/12;break;case n4:n=u();break;case n6:n=u()/3;break;case n3:n=(l-o)/6048e5;break;case"day":n=(l-o)/864e5;break;case n5:n=l/36e5;break;case n2:n=l/6e4;break;case n1:n=l/1e3;break;default:n=l}return r?n:ic.a(n)},t.daysInMonth=function(){return this.endOf(n4).$D},t.$locale=function(){return is[this.$L]},t.locale=function(e,t){if(!e)return this.$L;var r=this.clone(),n=il(e,t,!0);return n&&(r.$L=n),r},t.clone=function(){return ic.w(this.$d,this)},t.toDate=function(){return new Date(this.valueOf())},t.toJSON=function(){return this.isValid()?this.toISOString():null},t.toISOString=function(){return this.$d.toISOString()},t.toString=function(){return this.$d.toUTCString()},e}()).prototype,iu.prototype=id,[["$ms",n0],["$s",n1],["$m",n2],["$H",n5],["$W","day"],["$M",n4],["$y",n9],["$D",n8]].forEach(function(e){id[e[1]]=function(t){return this.$g(t,e[0],e[1])}}),iu.extend=function(e,t){return e.$i||(e(t,ih,iu),e.$i=!0),iu},iu.locale=il,iu.isDayjs=io,iu.unix=function(e){return iu(1e3*e)},iu.en=is[ii],iu.Ls=is,iu.p={},nZ.exports=iu),nZ.exports));var n0,n1,n2,n5,n3,n4,n6,n9,n8,n7,ie,it,ir,ii,is,ia,io,il,iu,ic,ih,id,im,ig={exports:{}};ig.exports;let ip=nK((im||(im=1,ig.exports=function(e,t){var r=t.prototype,n=r.format;r.format=function(e){var t=this,r=this.$locale();if(!this.isValid())return n.bind(this)(e);var i=this.$utils(),s=(e||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,function(e){switch(e){case"Q":return Math.ceil((t.$M+1)/3);case"Do":return r.ordinal(t.$D);case"gggg":return t.weekYear();case"GGGG":return t.isoWeekYear();case"wo":return r.ordinal(t.week(),"W");case"w":case"ww":return i.s(t.week(),"w"===e?1:2,"0");case"W":case"WW":return i.s(t.isoWeek(),"W"===e?1:2,"0");case"k":case"kk":return i.s(String(0===t.$H?24:t.$H),"k"===e?1:2,"0");case"X":return Math.floor(t.$d.getTime()/1e3);case"x":return t.$d.getTime();case"z":return"["+t.offsetName()+"]";case"zzz":return"["+t.offsetName("long")+"]";default:return e}});return n.bind(this)(s)}}),ig.exports));var iC,i_={exports:{}};i_.exports;let iy=nK((iC||(iC=1,iE={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},iR=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|Q|YYYY|YY?|ww?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,ib=/\d/,iI=/\d\d/,iN=/\d\d?/,iS=/\d*[^-_:/,()\s\d]+/,iA={},iv=function(e){return(e*=1)+(e>68?1900:2e3)},iT=function(e){return function(t){this[e]=+t}},iw=[/[+-]\d\d:?(\d\d)?|Z/,function(e){(this.zone||(this.zone={})).offset=function(e){if(!e||"Z"===e)return 0;var t=e.match(/([+-]|\d\d)/g),r=60*t[1]+(+t[2]||0);return 0===r?0:"+"===t[0]?-r:r}(e)}],iM=function(e){var t=iA[e];return t&&(t.indexOf?t:t.s.concat(t.f))},iO=function(e,t){var r,n=iA.meridiem;if(n){for(var i=1;i<=24;i+=1)if(e.indexOf(n(i,0,t))>-1){r=i>12;break}}else r=e===(t?"pm":"PM");return r},ix={A:[iS,function(e){this.afternoon=iO(e,!1)}],a:[iS,function(e){this.afternoon=iO(e,!0)}],Q:[ib,function(e){this.month=3*(e-1)+1}],S:[ib,function(e){this.milliseconds=100*e}],SS:[iI,function(e){this.milliseconds=10*e}],SSS:[/\d{3}/,function(e){this.milliseconds=+e}],s:[iN,iT("seconds")],ss:[iN,iT("seconds")],m:[iN,iT("minutes")],mm:[iN,iT("minutes")],H:[iN,iT("hours")],h:[iN,iT("hours")],HH:[iN,iT("hours")],hh:[iN,iT("hours")],D:[iN,iT("day")],DD:[iI,iT("day")],Do:[iS,function(e){var t=iA.ordinal,r=e.match(/\d+/);if(this.day=r[0],t)for(var n=1;n<=31;n+=1)t(n).replace(/\[|\]/g,"")===e&&(this.day=n)}],w:[iN,iT("week")],ww:[iI,iT("week")],M:[iN,iT("month")],MM:[iI,iT("month")],MMM:[iS,function(e){var t=iM("months"),r=(iM("monthsShort")||t.map(function(e){return e.slice(0,3)})).indexOf(e)+1;if(r<1)throw Error();this.month=r%12||r}],MMMM:[iS,function(e){var t=iM("months").indexOf(e)+1;if(t<1)throw Error();this.month=t%12||t}],Y:[/[+-]?\d+/,iT("year")],YY:[iI,function(e){this.year=iv(e)}],YYYY:[/\d{4}/,iT("year")],Z:iw,ZZ:iw},i_.exports=function(e,t,r){r.p.customParseFormat=!0,e&&e.parseTwoDigitYear&&(iv=e.parseTwoDigitYear);var n=t.prototype,i=n.parse;n.parse=function(e){var t=e.date,n=e.utc,s=e.args;this.$u=n;var a=s[1];if("string"==typeof a){var o=!0===s[2],l=!0===s[3],u=s[2];l&&(u=s[2]),iA=this.$locale(),!o&&u&&(iA=r.Ls[u]),this.$d=function(e,t,r,n){try{if(["x","X"].indexOf(t)>-1)return new Date(("X"===t?1e3:1)*e);var i=(function(e){var t,r;t=e,r=iA&&iA.formats;for(var n=(e=t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(e,t,n){var i=n&&n.toUpperCase();return t||r[n]||iE[n]||r[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})})).match(iR),i=n.length,s=0;s<i;s+=1){var a=n[s],o=ix[a],l=o&&o[0],u=o&&o[1];n[s]=u?{regex:l,parser:u}:a.replace(/^\[|\]$/g,"")}return function(e){for(var t={},r=0,s=0;r<i;r+=1){var a=n[r];if("string"==typeof a)s+=a.length;else{var o=a.regex,l=a.parser,u=e.slice(s),c=o.exec(u)[0];l.call(t,c),e=e.replace(c,"")}}return function(e){var t=e.afternoon;if(void 0!==t){var r=e.hours;t?r<12&&(e.hours+=12):12===r&&(e.hours=0),delete e.afternoon}}(t),t}})(t)(e),s=i.year,a=i.month,o=i.day,l=i.hours,u=i.minutes,c=i.seconds,h=i.milliseconds,d=i.zone,m=i.week,g=new Date,f=o||(s||a?1:g.getDate()),p=s||g.getFullYear(),C=0;s&&!a||(C=a>0?a-1:g.getMonth());var _,y=l||0,E=u||0,R=c||0,b=h||0;return d?new Date(Date.UTC(p,C,f,y,E,R,b+60*d.offset*1e3)):r?new Date(Date.UTC(p,C,f,y,E,R,b)):(_=new Date(p,C,f,y,E,R,b),m&&(_=n(_).week(m).toDate()),_)}catch{return new Date("")}}(t,a,n,r),this.init(),u&&!0!==u&&(this.$L=this.locale(u).$L),(o||l)&&t!=this.format(a)&&(this.$d=new Date("")),iA={}}else if(a instanceof Array)for(var c=a.length,h=1;h<=c;h+=1){s[1]=a[h-1];var d=r.apply(this,s);if(d.isValid()){this.$d=d.$d,this.$L=d.$L,this.init();break}h===c&&(this.$d=new Date(""))}else i.call(this,e)}}),i_.exports));var iE,iR,ib,iI,iN,iS,iA,iv,iT,iw,iM,iO,ix,iU,iD={exports:{}};iD.exports;let iV=nK((iU||(iU=1,iD.exports=function(e,t,r){var n=t.prototype,i=function(e){return e&&(e.indexOf?e:e.s)},s=function(e,t,r,n,s){var a=e.name?e:e.$locale(),o=i(a[t]),l=i(a[r]),u=o||l.map(function(e){return e.slice(0,n)});if(!s)return u;var c=a.weekStart;return u.map(function(e,t){return u[(t+(c||0))%7]})},a=function(){return r.Ls[r.locale()]},o=function(e,t){return e.formats[t]||e.formats[t.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})},l=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):s(e,"months")},monthsShort:function(t){return t?t.format("MMM"):s(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):s(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):s(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):s(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return o(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};n.localeData=function(){return l.bind(this)()},r.localeData=function(){var e=a();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return r.weekdays()},weekdaysShort:function(){return r.weekdaysShort()},weekdaysMin:function(){return r.weekdaysMin()},months:function(){return r.months()},monthsShort:function(){return r.monthsShort()},longDateFormat:function(t){return o(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},r.months=function(){return s(a(),"months")},r.monthsShort=function(){return s(a(),"monthsShort","months",3)},r.weekdays=function(e){return s(a(),"weekdays",null,null,e)},r.weekdaysShort=function(e){return s(a(),"weekdaysShort","weekdays",3,e)},r.weekdaysMin=function(e){return s(a(),"weekdaysMin","weekdays",2,e)}}),iD.exports));var iL,iP={exports:{}};iP.exports;let iF=nK((iL||(iL=1,ik={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},iP.exports=function(e,t,r){var n=t.prototype,i=n.format;r.en.formats=ik,n.format=function(e){void 0===e&&(e="YYYY-MM-DDTHH:mm:ssZ");var t,r,n=this.$locale().formats,s=(t=e,r=void 0===n?{}:n,t.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(e,t,n){var i=n&&n.toUpperCase();return t||r[n]||ik[n]||r[i].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(e,t,r){return t||r.slice(1)})}));return i.call(this,s)}}),iP.exports));var ik,ij,iB={exports:{}};iB.exports;let i$=nK((ij||(ij=1,iH="minute",iW=/[+-]\d\d(?::?\d\d)?/g,iG=/([+-]|\d\d)/g,iB.exports=function(e,t,r){var n=t.prototype;r.utc=function(e){var r={date:e,utc:!0,args:arguments};return new t(r)},n.utc=function(e){var t=r(this.toDate(),{locale:this.$L,utc:!0});return e?t.add(this.utcOffset(),iH):t},n.local=function(){return r(this.toDate(),{locale:this.$L,utc:!1})};var i=n.parse;n.parse=function(e){e.utc&&(this.$u=!0),this.$utils().u(e.$offset)||(this.$offset=e.$offset),i.call(this,e)};var s=n.init;n.init=function(){if(this.$u){var e=this.$d;this.$y=e.getUTCFullYear(),this.$M=e.getUTCMonth(),this.$D=e.getUTCDate(),this.$W=e.getUTCDay(),this.$H=e.getUTCHours(),this.$m=e.getUTCMinutes(),this.$s=e.getUTCSeconds(),this.$ms=e.getUTCMilliseconds()}else s.call(this)};var a=n.utcOffset;n.utcOffset=function(e,t){var r=this.$utils().u;if(r(e))return this.$u?0:r(this.$offset)?a.call(this):this.$offset;if("string"==typeof e&&null===(e=function(e){void 0===e&&(e="");var t=e.match(iW);if(!t)return null;var r=(""+t[0]).match(iG)||["-",0,0],n=r[0],i=60*r[1]+ +r[2];return 0===i?0:"+"===n?i:-i}(e)))return this;var n=16>=Math.abs(e)?60*e:e,i=this;if(t)return i.$offset=n,i.$u=0===e,i;if(0!==e){var s=this.$u?this.toDate().getTimezoneOffset():-1*this.utcOffset();(i=this.local().add(n+s,iH)).$offset=n,i.$x.$localOffset=s}else i=this.utc();return i};var o=n.format;n.format=function(e){var t=e||(this.$u?"YYYY-MM-DDTHH:mm:ss[Z]":"");return o.call(this,t)},n.valueOf=function(){var e=this.$utils().u(this.$offset)?0:this.$offset+(this.$x.$localOffset||this.$d.getTimezoneOffset());return this.$d.valueOf()-6e4*e},n.isUTC=function(){return!!this.$u},n.toISOString=function(){return this.toDate().toISOString()},n.toString=function(){return this.toDate().toUTCString()};var l=n.toDate;n.toDate=function(e){return"s"===e&&this.$offset?r(this.format("YYYY-MM-DD HH:mm:ss:SSS")).toDate():l.call(this)};var u=n.diff;n.diff=function(e,t,n){if(e&&this.$u===e.$u)return u.call(this,e,t,n);var i=this.local(),s=r(e).local();return u.call(i,s,t,n)}}),iB.exports));var iH,iW,iG,iY,iz={exports:{}};iz.exports;let iX=nK((iY||(iY=1,iz.exports=function(e,t){t.prototype.weekday=function(e){var t=this.$locale().weekStart||0,r=this.$W,n=(r<t?r+7:r)-t;return this.$utils().u(e)?n:this.subtract(n,"day").add(e,"day")}}),iz.exports));var iq,iK={exports:{}};iK.exports;let iQ=nK((iq||(iq=1,iZ="week",iJ="year",iK.exports=function(e,t,r){var n=t.prototype;n.week=function(e){if(void 0===e&&(e=null),null!==e)return this.add(7*(e-this.week()),"day");var t=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var n=r(this).startOf(iJ).add(1,iJ).date(t),i=r(this).endOf(iZ);if(n.isBefore(i))return 1}var s=r(this).startOf(iJ).date(t).startOf(iZ).subtract(1,"millisecond"),a=this.diff(s,iZ,!0);return a<0?r(this).startOf("week").week():Math.ceil(a)},n.weeks=function(e){return void 0===e&&(e=null),this.week(e)}}),iK.exports));var iZ,iJ,i0,i1={exports:{}};i1.exports;let i2=nK((i0||(i0=1,i1.exports=function(e,t){t.prototype.weekYear=function(){var e=this.month(),t=this.week(),r=this.year();return 1===t&&11===e?r+1:0===e&&t>=52?r-1:r}}),i1.exports));function i5(e,t,r,n){if(e>t)throw Error("a1 should be less than a2");if(r>n)throw Error("b1 should be less than b2");if(t<r||n<e)return[e,t];if(r<=e&&n>=t)return[];let i=n-r+1;return e<r&&t>n?[e,t-i]:r<=e&&n<t?[n+1-i,t-i]:r>e&&n>=t?[e,r-1]:[e,t]}function i3(e){if(null==e)return!1;let t=e.bullet;return(null==t?void 0:t.listId)!=null}function i4(e){return null!=e&&i6(e.paragraphStyle)}function i6(e){var t;return null!=e&&(null!=e.indentStart&&0!==e.indentStart.v||null!=e.hanging)&&(null==(t=e.hanging)?void 0:t.v)!==0}function i9(e,t,r){return e.slice(0,t)+r+e.slice(t)}function i8(e,t,r){return t>r?e:e.slice(0,t)+e.slice(r)}function i7(e){if(null==e||"boolean"==typeof e)return!1;if("number"==typeof e)return!isNaN(e);if("string"==typeof e){let t=e.trim();return""!==t&&!isNaN(Number(t))}return!1}function se(e){let t=0;for(let r=0;r<e.length;r++)t=e.charCodeAt(r)+(t<<6)+(t<<16)-t;return t>>>0}nJ.extend(iy),nJ.extend(ip),nJ.extend(iX),nJ.extend(iV),nJ.extend(iQ),nJ.extend(i2),nJ.extend(i$),nJ.extend(iF);let st=Symbol("newer"),sr=Symbol("older");class sn{constructor(e){tE(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[st],{done:!1,value:e.key}):{done:!0,value:void 0}}}class si{constructor(e){tE(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[st],{done:!1,value:e.value}):{done:!0,value:void 0}}}class ss{constructor(e){tE(this,"entry"),this.entry=e}[Symbol.iterator](){return this}next(){let e=this.entry;return e?(this.entry=e[st],{done:!1,value:[e.key,e.value]}):{done:!0,value:void 0}}}class sa{constructor(e,t){tE(this,"key"),tE(this,"value"),tE(this,st),tE(this,sr),this.key=e,this.value=t,this[st]=void 0,this[sr]=void 0}toJSON(){return{key:this.key,value:this.value}}}class so{constructor(...e){if(tE(this,"_keymap"),tE(this,"size",0),tE(this,"limit"),tE(this,"oldest"),tE(this,"newest"),tE(this,"_onShiftListeners",[]),sl.hasLength(e,1)){if(sl.isNumber(e[0])){let t=e[0];this._initialize(t,void 0);return}if(sl.isIterable(e[0])){let t=e[0];this._initialize(0,t)}return}if(sl.hasLength(e,2)){let t=e[0],r=e[1];this._initialize(t,r)}}onShift(e){if(-1===this._onShiftListeners.indexOf(e))return this._onShiftListeners.push(e),tD(()=>tb(this._onShiftListeners,e));throw Error("[LRUMap]: the listener has been registered!")}_initialize(e,t){this.oldest=void 0,this.newest=void 0,this.size=0,this.limit=e,this._keymap=new Map,t&&(this.assign(t),e<1&&(this.limit=this.size))}_markEntryAsUsed(e){e!==this.newest&&(e[st]&&(e===this.oldest&&(this.oldest=e[st]),e[st][sr]=e[sr]),e[sr]&&(e[sr][st]=e[st]),e[st]=void 0,e[sr]=this.newest,this.newest&&(this.newest[st]=e),this.newest=e)}assign(e){let t,r=this.limit||Number.MAX_VALUE;this._keymap.clear();let n=e[Symbol.iterator]();for(let e=n.next();!e.done;e=n.next()){let n=new sa(e.value[0],e.value[1]);if(this._keymap.set(n.key,n),t?(t[st]=n,n[sr]=t):this.oldest=n,t=n,0==r--)throw Error("overflow")}this.newest=t,this.size=this._keymap.size}set(e,t){let r=this._keymap.get(e);return r?(r.value=t,this._markEntryAsUsed(r)):(this._keymap.set(e,r=new sa(e,t)),this.newest?(this.newest[st]=r,r[sr]=this.newest):this.oldest=r,this.newest=r,++this.size,this.size>this.limit&&this.shift()),this}shift(){let e=this.oldest;if(e)return this.oldest&&this.oldest[st]?(this.oldest=this.oldest[st],this.oldest[sr]=void 0):(this.oldest=void 0,this.newest=void 0),e[st]=e[sr]=void 0,this._keymap.delete(e.key),--this.size,this._onShiftListeners.forEach(t=>t(e)),[e.key,e.value]}get(e){let t=this._keymap.get(e);if(t)return this._markEntryAsUsed(t),t.value}has(e){return this._keymap.has(e)}find(e){let t=this._keymap.get(e);return t?t.value:void 0}delete(e){let t=this._keymap.get(e);if(t)return this._keymap.delete(t.key),t[st]&&t[sr]?(t[sr][st]=t[st],t[st][sr]=t[sr]):t[st]?(t[st][sr]=void 0,this.oldest=t[st]):t[sr]?(t[sr][st]=void 0,this.newest=t[sr]):this.oldest=this.newest=void 0,this.size--,t.value}clear(){this.oldest=void 0,this.newest=void 0,this.size=0,this._keymap.clear()}keys(){return new sn(this.oldest)}values(){return new si(this.oldest)}entries(){return this[Symbol.iterator]()}[Symbol.iterator](){return new ss(this.oldest)}forEach(e,t){"object"!=typeof t&&(t=this);let r=this.oldest;for(;r;)e.call(t,r.value,r.key,this),r=r[st]}toJSON(){let e=Array(this.size),t=0,r=this.oldest;for(;r;)e[t++]={key:r.key,value:r.value},r=r[st];return e}toString(){let e="",t=this.oldest;for(;t;)e+=`${String(t.key)}:${t.value}`,(t=t[st])&&(e+=" < ");return e}}class sl{static hasLength(e,t){return e.length===t}static getValueType(e){return Object.prototype.toString.apply(e)}static isObject(e){return"[object Object]"===this.getValueType(e)}static isIterable(e){return null!=e[Symbol.iterator]}static isNumber(e){return"[object Number]"===this.getValueType(e)}}var su,sc={exports:{}};sc.exports;let sh=nK((l3||(l3=1,su||(su=1,"u">typeof self&&self,sc.exports=function(){var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return es}});var r={1078:"af",1052:"sq",1118:"am",5121:"ar_DZ",15361:"ar_BH",3073:"ar_EG",2049:"ar_IQ",11265:"ar_JO",13313:"ar_KW",12289:"ar_LB",4097:"ar_LY",6145:"ar_MA",8193:"ar_OM",16385:"ar_QA",1025:"ar_SA",10241:"ar_SY",7169:"ar_TN",14337:"ar_AE",9217:"ar_YE",1067:"hy",1101:"as",2092:"az_AZ",1068:"az_AZ",1069:"eu",1059:"be",2117:"bn",1093:"bn_IN",5146:"bs",1026:"bg",1109:"my",1027:"ca",2052:"zh_CN",3076:"zh_HK",5124:"zh_MO",4100:"zh_SG",1028:"zh_TW",1050:"hr",1029:"cs",1030:"da",1125:"dv",2067:"nl_BE",1043:"nl_NL",1126:"bin",3081:"en_AU",10249:"en_BZ",4105:"en_CA",9225:"en_CB",2057:"en_GB",16393:"en_IN",6153:"en_IE",8201:"en_JM",5129:"en_NZ",13321:"en_PH",7177:"en_ZA",11273:"en_TT",1033:"en_US",12297:"en_ZW",1061:"et",1071:"mk",1080:"fo",1065:"fa",1124:"fil",1035:"fi",2060:"fr_BE",11276:"fr_CM",3084:"fr_CA",9228:"fr_CG",12300:"fr_CI",1036:"fr_FR",5132:"fr_LU",13324:"fr_ML",6156:"fr_MC",14348:"fr_MA",10252:"fr_SN",4108:"fr_CH",7180:"fr",1122:"fy_NL",2108:"gd_IE",1084:"gd",1110:"gl",1079:"ka",3079:"de_AT",1031:"de_DE",5127:"de_LI",4103:"de_LU",2055:"de_CH",1032:"el",1140:"gn",1095:"gu",1279:"en",1037:"he",1081:"hi",1038:"hu",1039:"is",1136:"ig_NG",1057:"id",1040:"it_IT",2064:"it_CH",1041:"ja",1099:"kn",1120:"ks",1087:"kk",1107:"km",1111:"kok",1042:"ko",1088:"ky",1108:"lo",1142:"la",1062:"lv",1063:"lt",2110:"ms_BN",1086:"ms_MY",1100:"ml",1082:"mt",1112:"mni",1153:"mi",1102:"mr",1104:"mn",2128:"mn",1121:"ne",1044:"no_NO",2068:"no_NO",1096:"or",1045:"pl",1046:"pt_BR",2070:"pt_PT",1094:"pa",1047:"rm",2072:"ro_MO",1048:"ro_RO",1049:"ru",2073:"ru_MO",1083:"se",1103:"sa",3098:"sr_SP",2074:"sr_SP",1072:"st",1074:"tn",1113:"sd",1115:"si",1051:"sk",1060:"sl",1143:"so",1070:"sb",11274:"es_AR",16394:"es_BO",13322:"es_CL",9226:"es_CO",5130:"es_CR",7178:"es_DO",12298:"es_EC",17418:"es_SV",4106:"es_GT",18442:"es_HN",2058:"es_MX",19466:"es_NI",6154:"es_PA",15370:"es_PY",10250:"es_PE",20490:"es_PR",1034:"es_ES",14346:"es_UY",8202:"es_VE",1089:"sw",2077:"sv_FI",1053:"sv_SE",1114:"syc",1064:"tg",1097:"ta",1092:"tt",1098:"te",1054:"th",1105:"bo",1073:"ts",1055:"tr",1090:"tk",1058:"uk",1056:"ur",2115:"uz_UZ",1091:"uz_UZ",1075:"ve",1066:"vi",1106:"cy",1076:"xh",1085:"yi",1077:"zu"};let n=/^([a-z\d]+)(?:[_-]([a-z\d]+))?(?:\.([a-z\d]+))?(?:@([a-z\d]+))?$/i,i={},s={group:"",decimal:".",positive:"+",negative:"-",percent:"%",exponent:"E",nan:"NaN",infinity:"",ampm:["AM","PM"],mmmm6:["Muharram","Safar","Rabi I","Rabi II","Jumada I","Jumada II","Rajab","Shaban","Ramadan","Shawwal","Dhul-Qidah","Dhul-Hijjah"],mmm6:["Muh.","Saf.","Rab. I","Rab. II","Jum. I","Jum. II","Raj.","Sha.","Ram.","Shaw.","Dhul-Q.","Dhul-H."],mmmm:["January","February","March","April","May","June","July","August","September","October","November","December"],mmm:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dddd:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],ddd:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]};function a(e){let t=n.exec(e);if(!t)throw SyntaxError("Malformed locale: ".concat(e));return{lang:t[1]+(t[2]?"_"+t[2]:""),language:t[1],territory:t[2]||"",codeset:t[3]||"",modifier:t[4]||""}}function o(e){if("number"==typeof e)return r[65535&e]||null;let t=parseInt(e,16);return isFinite(t)&&r[65535&t]?r[65535&t]||null:n.test(e)?e:null}function l(e){let t=o(e),r=null;if(t){let e=a(t);r=i[e.lang]||i[e.language]||null}return r}function u(e){return Object.assign({},s,e)}function c(e,t){let r="object"==typeof t?t:a(t);return i[r.lang]=u(e),r.language===r.lang||i[r.language]||(i[r.language]=u(e)),i[r.lang]}let h=u({group:","});function d(e,t){if("number"!=typeof e)return e;if(e<0)return-d(-e,t);if(t){let r=10**(t||0)||1;return d(e*r,0)/r}return Math.round(e)}function m(e,t,r){let n=e<0?-1:1,i=10**(t||2),s=10**(r||2),a,o,l=Math.abs(e),u=0,c=0,h=0,d=1;if((e=l)%1==0)o=[e*n,1];else if(e<1e-19)o=[n,1e19];else if(e>1e19)o=[1e19*n,1];else{do if(l=1/(l-Math.floor(l)),a=d,d=d*Math.floor(l)+u,u=a,c=h,(h=Math.floor(e*d+.5))>=i||d>=s)return[n*c,u];while(Math.abs(e-h/d)>=1e-10&&l!==Math.floor(l))o=[n*h,d]}return o}h.isDefault=!0,c({group:",",ampm:["",""],mmmm:["","","","","","","","","","","",""],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"zh_CN"),c({group:",",nan:"",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"zh_TW"),c({group:",",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ja"),c({group:",",ampm:["",""],mmmm:["1","2","3","4","5","6","7","8","9","10","11","12"],mmm:["1","2","3","4","5","6","7","8","9","10","11","12"],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ko"),c({group:",",ampm:["",""],mmmm:["","","","","","","","","","","",""],mmm:["..","..","..","..","..","..","..","..","..","..","..",".."],dddd:["","","","","","",""],ddd:[".",".",".",".",".",".","."]},"th"),c({decimal:",",ampm:["dop.","odp."],mmmm:["ledna","nora","bezna","dubna","kvtna","ervna","ervence","srpna","z","jna","listopadu","prosince"],mmm:["led","no","be","dub","kv","vn","vc","srp","z","j","lis","pro"],dddd:["nedle","pondl","ter","steda","tvrtek","ptek","sobota"],ddd:["ne","po","t","st","t","p","so"]},"cs"),c({group:".",decimal:",",mmmm:["januar","februar","marts","april","maj","juni","juli","august","september","oktober","november","december"],mmm:["jan.","feb.","mar.","apr.","maj","jun.","jul.","aug.","sep.","okt.","nov.","dec."],dddd:["sndag","mandag","tirsdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn.","man.","tir.","ons.","tor.","fre.","lr."]},"da"),c({group:".",decimal:",",ampm:["a.m.","p.m."],mmmm:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],mmm:["jan.","feb.","mrt.","apr.","mei","jun.","jul.","aug.","sep.","okt.","nov.","dec."],dddd:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"],ddd:["zo","ma","di","wo","do","vr","za"]},"nl"),c({group:","},"en"),c({decimal:",",nan:"epluku",ampm:["ap.","ip."],mmmm:["tammikuuta","helmikuuta","maaliskuuta","huhtikuuta","toukokuuta","keskuuta","heinkuuta","elokuuta","syyskuuta","lokakuuta","marraskuuta","joulukuuta"],mmm:["tammik.","helmik.","maalisk.","huhtik.","toukok.","kesk.","heink.","elok.","syysk.","lokak.","marrask.","jouluk."],dddd:["sunnuntaina","maanantaina","tiistaina","keskiviikkona","torstaina","perjantaina","lauantaina"],ddd:["su","ma","ti","ke","to","pe","la"]},"fi"),c({group:"",decimal:",",mmmm:["janvier","fvrier","mars","avril","mai","juin","juillet","aot","septembre","octobre","novembre","dcembre"],mmm:["janv.","fvr.","mars","avr.","mai","juin","juil.","aot","sept.","oct.","nov.","dc."],dddd:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"],ddd:["dim.","lun.","mar.","mer.","jeu.","ven.","sam."]},"fr"),c({group:".",decimal:",",mmmm:["Januar","Februar","Mrz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],mmm:["Jan.","Feb.","Mrz","Apr.","Mai","Juni","Juli","Aug.","Sept.","Okt.","Nov.","Dez."],dddd:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"],ddd:["So.","Mo.","Di.","Mi.","Do.","Fr.","Sa."]},"de"),c({group:".",decimal:",",ampm:["..",".."],mmmm:["","","","","","","","","","","",""],mmm:["","","","","","","","","","","",""],dddd:["","","","","","",""],ddd:["","","","","","",""]},"el"),c({decimal:",",ampm:["de.","du."],mmmm:["janur","februr","mrcius","prilis","mjus","jnius","jlius","augusztus","szeptember","oktber","november","december"],mmm:["jan.","febr.","mrc.","pr.","mj.","jn.","jl.","aug.","szept.","okt.","nov.","dec."],dddd:["vasrnap","htf","kedd","szerda","cstrtk","pntek","szombat"],ddd:["V","H","K","Sze","Cs","P","Szo"]},"hu"),c({group:".",decimal:",",ampm:["f.h.","e.h."],mmmm:["janar","febrar","mars","aprl","ma","jn","jl","gst","september","oktber","nvember","desember"],mmm:["jan.","feb.","mar.","apr.","ma","jn.","jl.","g.","sep.","okt.","nv.","des."],dddd:["sunnudagur","mnudagur","rijudagur","mivikudagur","fimmtudagur","fstudagur","laugardagur"],ddd:["sun.","mn.","ri.","mi.","fim.","fs.","lau."]},"is"),c({group:".",decimal:",",mmmm:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],mmm:["Jan","Feb","Mar","Apr","Mei","Jun","Jul","Agu","Sep","Okt","Nov","Des"],dddd:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"],ddd:["Min","Sen","Sel","Rab","Kam","Jum","Sab"]},"id"),c({group:".",decimal:",",mmmm:["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"],mmm:["gen","feb","mar","apr","mag","giu","lug","ago","set","ott","nov","dic"],dddd:["domenica","luned","marted","mercoled","gioved","venerd","sabato"],ddd:["dom","lun","mar","mer","gio","ven","sab"]},"it"),c({decimal:",",ampm:["a.m.","p.m."],mmmm:["januar","februar","mars","april","mai","juni","juli","august","september","oktober","november","desember"],mmm:["jan.","feb.","mar.","apr.","mai","jun.","jul.","aug.","sep.","okt.","nov.","des."],dddd:["sndag","mandag","tirsdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn.","man.","tir.","ons.","tor.","fre.","lr."]},"nb"),c({decimal:",",mmmm:["stycznia","lutego","marca","kwietnia","maja","czerwca","lipca","sierpnia","wrzenia","padziernika","listopada","grudnia"],mmm:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","pa","lis","gru"],dddd:["niedziela","poniedziaek","wtorek","roda","czwartek","pitek","sobota"],ddd:["niedz.","pon.","wt.","r.","czw.","pt.","sob."]},"pl"),c({group:".",decimal:",",mmmm:["janeiro","fevereiro","maro","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],mmm:["jan.","fev.","mar.","abr.","mai.","jun.","jul.","ago.","set.","out.","nov.","dez."],dddd:["domingo","segunda-feira","tera-feira","quarta-feira","quinta-feira","sexta-feira","sbado"],ddd:["dom.","seg.","ter.","qua.","qui.","sex.","sb."]},"pt"),c({decimal:",",nan:"",mmmm:["","","","","","","","","","","",""],mmm:[".",".",".",".","",".",".",".",".",".",".","."],dddd:["","","","","","",""],ddd:["","","","","","",""]},"ru"),c({decimal:",",mmmm:["janura","februra","marca","aprla","mja","jna","jla","augusta","septembra","oktbra","novembra","decembra"],mmm:["jan","feb","mar","apr","mj","jn","jl","aug","sep","okt","nov","dec"],dddd:["nedea","pondelok","utorok","streda","tvrtok","piatok","sobota"],ddd:["ne","po","ut","st","t","pi","so"]},"sk"),c({group:".",decimal:",",ampm:["a.m.","p.m."],mmmm:["enero","febrero","marzo","abril","mayo","junio","julio","agosto","septiembre","octubre","noviembre","diciembre"],mmm:["ene.","feb.","mar.","abr.","may.","jun.","jul.","ago.","sept.","oct.","nov.","dic."],dddd:["domingo","lunes","martes","mircoles","jueves","viernes","sbado"],ddd:["dom.","lun.","mar.","mi.","jue.","vie.","sb."]},"es"),c({decimal:",",ampm:["fm","em"],mmmm:["januari","februari","mars","april","maj","juni","juli","augusti","september","oktober","november","december"],mmm:["jan.","feb.","mars","apr.","maj","juni","juli","aug.","sep.","okt.","nov.","dec."],dddd:["sndag","mndag","tisdag","onsdag","torsdag","fredag","lrdag"],ddd:["sn","mn","tis","ons","tors","fre","lr"]},"sv"),c({group:".",decimal:",",ampm:["","S"],mmmm:["Ocak","ubat","Mart","Nisan","Mays","Haziran","Temmuz","Austos","Eyll","Ekim","Kasm","Aralk"],mmm:["Oca","ub","Mar","Nis","May","Haz","Tem","Au","Eyl","Eki","Kas","Ara"],dddd:["Pazar","Pazartesi","Sal","aramba","Perembe","Cuma","Cumartesi"],ddd:["Paz","Pzt","Sal","ar","Per","Cum","Cmt"]},"tr");let g={overflow:"######",dateErrorThrows:!1,dateErrorNumber:!0,dateSpanLarge:!0,leap1900:!0,nbsp:!0,throws:!0,invalid:"######",locale:"",ignoreTimezone:!1},f=Object.assign({},g);function p(e){if(null===e&&(e=g),e){for(let t in e)if(t in g){let r=e[t];f[t]=null==r?g[t]:r}}return{...f}}let C={"#":"",0:"0","?":""},_={"@":"text","-":"minus","+":"plus"},y=["#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#000","#FFF","#F00","#0F0","#00F","#FF0","#F0F","#0FF","#800","#080","#008","#880","#808","#088","#CCC","#888","#99F","#936","#FFC","#CFF","#606","#F88","#06C","#CCF","#008","#F0F","#FF0","#0FF","#808","#800","#088","#00F","#0CF","#CFF","#CFC","#FF9","#9CF","#F9C","#C9F","#FC9","#36F","#3CC","#9C0","#FC0"],E=["","$","","","","","","","","","","","","","","","","","","","","","","","","",""],R=RegExp("["+E.join("")+"]");function b(e,t,r){return t[r+"_max"]=e.length,t[r+"_min"]=e.replace(/#/g,"").length,t}let I={};function N(e){if(!(e in I)){let t=[],r=e.replace(/^[#,]+/,"").replace(/[1-9]\d*/g,e=>"?".repeat(e.length));for(let e=0;e<r.length;e++){let n=r.charAt(e);t[e]=n in C?C[n]:n}I[e]=t.join("")}return I[e]}function S(e,t){"string"==typeof e&&(e={type:"string",value:e=e.replace(/ /g,C["?"])}),t.push(e)}function A(e){let t=[],r={scale:1,percent:!1,text:!1,date:0,date_eval:!1,date_system:1,sec_decimals:0,general:!1,clock:24,int_pattern:[],frac_pattern:[],man_pattern:[],den_pattern:[],num_pattern:[],tokens:t},n=e+"",i="int",s=!1,a=null,l=[],u,c,h=!1;for(;n&&!s;){if(u=/^General/i.exec(n))r.general=!0,S({type:"general"},t);else if("int"===i&&(u=/^[#?0]+(?:,[#?0]+)*/.exec(n))||"den"===i&&(u=/^[#?\d]+/.exec(n))||(u=/^[#?0]+/.exec(n)))r[i+"_pattern"].push(u[0]),S(a={type:i,num:u[0]},t);else if((u=/^\//.exec(n))&&r[i+"_pattern"].length){if(!a)throw SyntaxError("Missing a numerator in pattern ".concat(e));r.fractions=!0,r.num_pattern.push(r[i+"_pattern"].pop()),a.type="num",i="den",S({type:"div"},t)}else if(u=/^,+/.exec(n)){let e=n.charAt(1)in C;c.slice(-1)in C&&(u[0].length>1||!e)?r.scale=.001**u[0].length:r.dec_fractions||S(u[0],t)}else{if(u=/^;/.exec(n)){s=!0;break}if(u=/^[@+-]/.exec(n))"@"===u[0]&&(r.text=!0),S({type:_[u[0]]},t);else if(u=/^(?:\[(h+|m+|s+)\])/i.exec(n)){let e=u[1].toLowerCase(),n=e[0],i={type:"",size:0,date:1,raw:u[0],pad:e.length};"h"===n?(i.size=16,i.type="hour-elap"):"m"===n?(i.size=32,i.type="min-elap"):(i.size=64,i.type="sec-elap"),r.date=r.date|i.size,l.push(i),S(i,t)}else if(u=/^(?:B2)/i.exec(n))h||(r.date_system=6);else if(u=/^(?:B1)/i.exec(n))h||(r.date_system=1);else if(u=/^(?:([hHmMsSyYbBdDegG])\1*)/.exec(n)){let e={type:"",size:0,date:1,raw:u[0]},n=u[0].toLowerCase(),i=n[0];if("y"===n||"yy"===n)e.size=2,e.type="year-short";else if("y"===i||"e"===i)e.size=2,e.type="year";else if("b"===n||"bb"===n)e.size=2,e.type="b-year-short";else if("b"===i)e.size=2,e.type="b-year";else if("d"===n||"dd"===n)e.size=8,e.type="day",e.pad=/dd/.test(n);else if("ddd"===n)e.size=8,e.type="weekday-short";else if("d"===i)e.size=8,e.type="weekday";else if("h"===i)e.size=16,e.type="hour",e.pad=/hh/i.test(n);else if("m"===i){3===n.length?(e.size=4,e.type="monthname-short"):5===n.length?(e.size=4,e.type="monthname-single"):n.length>=4&&(e.size=4,e.type="monthname");let t=l[l.length-1];!e.type&&t&&!t.used&&80&t.size&&(t.used=!0,e.size=32,e.type="min",e.pad=/mm/.test(n)),e.type||(e.size=4,e.type="month",e.pad=/mm/.test(n),e.indeterminate=!0)}else if("s"===i){e.size=64,e.type="sec",e.pad=/ss/.test(n);let t=l[l.length-1];t&&32&t.size?e.used=!0:t&&t.indeterminate&&(delete t.indeterminate,t.size=32,t.type="min",e.used=!0)}r.date=r.date|e.size,r.date_eval=!0,l.push(e),S(e,t)}else if(u=/^(?:AM\/PM|am\/pm|A\/P)/.exec(n))r.clock=12,r.date=16|r.date,r.date_eval=!0,S({type:"am",short:"A/P"===u[0]},t);else if(r.date&&(u=/^\.0{1,3}/i.exec(n))){let e=u[0].length-1,n=[64,128,256,512][e];r.date=r.date|n,r.date_eval=!0,r.sec_decimals=Math.max(r.sec_decimals,e),S({type:"subsec",size:n,decimals:e,date:1,raw:u[0]},t)}else if((u=/^\\(.)/.exec(n))||(u=/^"([^"]*?)"/.exec(n)))S(u[1],t);else if(u=/^\[(<[=>]?|>=?|=)\s*(-?[.\d]+)\]/.exec(n))r.condition=[u[1],parseFloat(u[2],10)];else if(u=/^\[\$([^\]]+)\]/.exec(n)){let e=u[1].split("-"),n=e.length<2?"":e[e.length-1],i=e[0];i&&S(i,t);let s=o(n);s&&(r.locale=s);let a=parseInt(n,16);isFinite(a)&&0xff0000&a&&(a>>16&255)==6&&(r.date_system=6),h=!0}else if(u=/^\[(black|blue|cyan|green|magenta|red|white|yellow|color\s*(\d+))\]/i.exec(n))r.color=u[2]?y[parseInt(u[2],10)]||"#000":u[1].toLowerCase();else if(!(u=/^\[(DBNum1|ENG|HIJ|JPN|TWN)\]/i.exec(n))){if(u=/^%/.exec(n))r.scale=100,r.percent=!0,S("%",t);else if(u=/^_(\\.|.)/.exec(n))S(" ",t);else if(u=/^\./.exec(n))S({type:"point",value:u[0]},t),r.dec_fractions=!0,i="frac";else if(u=/^[Ee]([+-]?|(?=[0#?]))/.exec(n))r.exponential=!0,r.exp_plus="+"===u[1],i="man",S({type:"exp",plus:"+"===u[1]},t);else if(!(u=/^\*(\\.|.)/.exec(n))){if(u=/^[BENn[]/.exec(n))throw SyntaxError("Unexpected char ".concat(n.charAt(0)," in pattern ").concat(e));"("===n[0]&&(r.parens=!0),S((u=[n[0]])[0],t)}}}c=u[0],n=n.slice(u?u[0].length:1)}if(r.pattern=e.slice(0,e.length-n.length),/^((?:\[[^\]]+\])+)(;|$)/.test(r.pattern)&&!/^\[(?:h+|m+|s+)\]/.test(r.pattern)&&S({type:"text"},t),r.fractions&&r.dec_fractions||r.fractions&&r.exponential)throw SyntaxError("Invalid pattern: ".concat(r.pattern));let d=r.int_pattern.join("");if(r.grouping=d.indexOf(",")>=0,r.grouping){let e=d.split(","),t=e.length;2===t?(r.group_pri=e[1].length,r.group_sec=r.group_pri):t>2&&(r.group_pri=e[t-1].length,r.group_sec=e[t-2].length)}else r.group_pri=0,r.group_sec=0;b(d.replace(/[,]/g,""),r,"int"),b(r.frac_pattern.join(""),r,"frac"),b(r.man_pattern.join(""),r,"man");let m=r.num_pattern.join(""),g=r.den_pattern.join(""),f=/\?/.test(g)||/\?/.test(m);return g=g.replace(/\d/g,f?"?":"#"),f&&(g=g.replace(/#$/g,"?")),b(m,r,"num"),b(g,r,"den"),f&&(m=m.replace(/#$/g,"?")),r.int_padding=N(r.int_pattern.join("")),r.man_padding=N(r.man_pattern.join("")),r.num_padding=N(m),r.den_padding=N(g),r.den_pattern.length&&(r.denominator=parseInt(r.den_pattern.join("").replace(/\D/g,""),10)),r.integer=!!r.int_pattern.join("").length,r.fractions&&t.forEach((e,r)=>{let n=t[r+1];"string"===e.type&&n&&("num"===n.type?e.rule="num+int":"div"===n.type?e.rule="num":"den"===n.type&&(e.rule="den"))}),r}let v=e=>{let t=e.condition;t&&t[1]<0&&("<"===t[0]||"<="===t[0]||"="===t[0])||e.tokens.unshift({type:"minus",volatile:!0})};function T(e){let t=[],r,n=!1,i=null,s=e,a=0,l=!1,u=0,c=0;do{if(((l=A(s)).date||l.general)&&(l.int_pattern.length||l.frac_pattern.length||1!==l.scale||l.text))throw Error("Illegal format");if(l.condition&&(c++,n=!0),l.text){if(i)throw Error("Unexpected partition");i=l}l.locale&&(r=o(l.locale)),t.push(l),a=+(";"===s.charAt(l.pattern.length)),s=s.slice(l.pattern.length+a),u++}while(a&&u<4&&c<3)if(a)throw Error("Unexpected partition");if(c>2)throw Error("Unexpected condition");let h=t[3];if(h&&(h.int_pattern.length||h.frac_pattern.length||h.date))throw Error("Unexpected partition");if(n){let e=t.length;if(1===e&&(t[1]=A("General"),t[1].generated=!0),e<3){let e=t[0],r=t[1];if(v(e),r.condition)v(r);else{let t=e.condition;("="===t[0]||t[1]>=0&&(">"===t[0]||">="===t[0]))&&r.tokens.unshift({type:"minus",volatile:!0})}}else t.forEach(v)}else{if(t.length<4&&i)for(let e=0,r=t.length;e<r;e++)t[e]===i&&t.splice(e,1);if(t.length<1&&i&&(t[0]=A("General"),t[0].generated=!0),t.length<2){let e=A(t[0].pattern);e.tokens.unshift({type:"minus",volatile:!0}),e.generated=!0,t.push(e)}if(t.length<3){let e=A(t[0].pattern);e.generated=!0,t.push(e)}if(t.length<4)if(i)t.push(i);else{let e=A("@");e.generated=!0,t.push(e)}t[0].condition=[">",0],t[1].condition=["<",0],t[2].condition=null}return{pattern:e,partitions:t,locale:r}}let w=Math.floor;function M(e){if((!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&e>=0){if(0===e)return[1900,1,0];if(60===e)return[1900,2,29];if(e<60)return[1900,e<32?1:2,(e-1)%31+1]}let t=e+68569+2415019,r=w(4*t/146097);t-=w((146097*r+3)/4);let n=w(4e3*(t+1)/1461001);t=t-w(1461*n/4)+31;let i=w(80*t/2447),s=t-w(2447*i/80);t=w(i/11);let a=i+2-12*t;return[0|100*(r-49)+n+t,0|a,0|s]}function O(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=w(e);return 6===t?function(e){if(60===e)throw Error("#VALUE!");if(e<=1)return[1317,8,29];if(e<60)return[1317,e<32?9:10,1+(e-2)%30];let t=10631/30,r=e+466935,n=w(r/10631),i=w(((r-=10631*n)-.1335)/t);r-=w(i*t+.1335);let s=w((r+28.5001)/29.5);return 13===s?[30*n+i,12,30]:[30*n+i,s,r-w(29.5001*s-29)]}(n):-1===t?M(n+1462):M(n,r)}let x=Math.floor;function U(e,t){let r=null;if(Array.isArray(e)){let[t,n,i,s,a,o]=e;r=Date.UTC(t,null==n?0:n-1,null!=i?i:1,s||0,a||0,o||0)}else if(e instanceof Date&&(r=+e,!t||!t.ignoreTimezone)){let t=new Date;t.setUTCFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t.setUTCHours(e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()),r=+t}if(null!=r&&isFinite(r)){let e=r/864e5;return e-(e<=-25509?-25568:-25569)}return e}function D(e,t){let r=0|e,n=86400*(e-r),i=x(n);n-i>.9999&&86400===(i+=1)&&(i=0,r+=1);let s=i<0?86400+i:i,[a,o,l]=O(e,0,t&&t.leap1900),u=x(s/60/60)%60,c=x(s/60)%60,h=x(s)%60;if(t&&t.nativeDate){let e=new Date(0);return e.setUTCFullYear(a,o-1,l),e.setUTCHours(u,c,h),e}return[a,o,l,u,c,h]}let V={text:15,datetime:10.8,date:10.8,time:10.8,percent:10.6,currency:10.4,grouped:10.2,scientific:6,number:4,fraction:2,general:0,error:0},L=[["DMY",1],["DM",2],["MY",3],["MDY",4],["MD",5],["hmsa",6],["hma",7],["hms",8],["hm",9]],P={total:1,sign:0,period:0,int:1,frac:0},F=(e,t)=>e.replace(/\./,t.decimal);function k(e,t,r,n){let i=0|r;if("string"==typeof r)e.push(r);else if(r===i)e.push(Math.abs(i));else{let t=Math.abs(r),i=t?Math.floor(Math.log10(t)):0,s=i<0?t*10**-i:t/10**i;10===s&&(s=1,i++);let a=function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=Math.abs(e);if(!r)return P;let n=t&&e<0?1:0,i=Math.floor(r),s=Math.floor(Math.log10(r)+1),a=0,o=0;if(i!==r){a=1;let e=String(d(s<0?r*10**-s:r/10**s,15)),t=e.length,n=!0,i=0;for(;i<=e.length;){if("."===e[i]){t--;break}"0"===e[i]&&n?t--:n=!1,i++}(o=t-s)<0&&(o=0,a=0)}return{total:n+Math.max(s,1)+a+o,digits:Math.max(s,0)+o,sign:n,period:a,int:Math.max(s,1),frac:o}}(t),o=()=>{let t,r=Math.abs(i);t=1===s?s:d(s,5),e.push(F(t+"",n),n.exponent,i<0?n.negative:n.positive,r<10?"0":"",r)};if(i>=-4&&i<=-1){let r=t.toPrecision(10+i).replace(/\.?0+$/,"");e.push(F(r,n))}else if(10===i){let r=t.toFixed(10).slice(0,12).replace(/\.$/,"");e.push(F(r,n))}else if(9>=Math.abs(i))if(a.total<=11){let r=d(t,9).toFixed(a.frac);e.push(F(r,n))}else 9===i?e.push(Math.floor(t)):i>=0&&i<9?e.push(d(t,9-i)):o();else a.total>=12?o():Math.floor(t)===t?e.push(Math.floor(t)):e.push(F(d(t,9).toFixed(a.frac),n))}return e}let j={int:"integer",frac:"fraction",man:"mantissa",num:"numerator",den:"denominator"},B=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Math.floor(Math.log10(e));return t>1?Math.floor(r/t)*t:r};function $(e,t,r,n){var i,s;let a="",o="",l="",u="",c="",g=0,f=0|e,p=0,_=0,y=1,E=0,R=0,b=0,I=0,N=0,S=0,A=n||h;if(!t.text&&isFinite(t.scale)&&1!==t.scale&&(e=function(e){if(0===e)return e;let t=Math.ceil(Math.log10(e<0?-e:e)),r=10**(16-Math.floor(t));return Math.round(e*r)/r}(e*t.scale)),t.exponential){let r=Math.abs(e);if(r){let e=10**-B(r,t.int_max);g=B(d(r*e,t.frac_max)/e,t.int_max)}r/=10**g,e=e<0?-r:r,a+=Math.abs(g)}if(t.integer){let r=Math.abs(d(e,t.fractions?1:t.frac_max));c+=r<1?"":Math.floor(r)}if(t.grouping){let e="",r=c.length;for(r>t.group_pri&&(r-=t.group_pri,e=A.group+c.slice(r,r+t.group_pri)+e);r>t.group_sec;)r-=t.group_sec,e=A.group+c.slice(r,r+t.group_sec)+e;c=r?c.slice(0,r)+e:e}t.dec_fractions&&(u=String(d(e,t.frac_max)).split(".")[1]||"");let v=!1;if(t.fractions){let r=Math.abs(t.integer?e%1:e);if(r)if(v=!0,isFinite(t.denominator))l+=t.denominator,"0"===(o+=d(r*t.denominator))&&(o="",l="",v=!1,c||(c="0"));else{let e=m(r,t.integer?t.num_max:1/0,t.den_max);o+=e[0],l+=e[1],t.integer&&"0"===o&&(c||(c="0"),o="",l="",v=!1)}}if(t.date){f=Math.trunc(e);let n=86400*(e-f);if(p=Math.floor(n),1e-6>Math.abs(S=n-p)?S=0:S>.9999&&(S=0,86400===(p+=1)&&(p=0,f+=1)),S){let e=512&t.date||256&t.date||128&t.date;(512===e&&S>.9995||256===e&&S>.995||128===e&&S>.95||!e&&S>=.5)&&(p++,S=0)}if(f||t.date_system){let n=O(e,t.date_system,r.leap1900);_=n[0],y=n[1],E=n[2]}if(p){let e=p<0?86400+p:p;N=Math.floor(e)%60,I=Math.floor(e/60)%60,b=Math.floor(e/60/60)%60}if(R=(6+f)%7,t.date_eval&&(i=e,s=f+p/86400,r.dateSpanLarge?i<-694324||s>=0x222ba13:i<0||s>=2958466)){if(r.dateErrorThrows)throw Error("Date out of bounds");return r.dateErrorNumber?k(e<0?[A.negative]:[],0,e,A).join(""):r.overflow}}if(t.int_padding&&(c=1===t.int_padding.length?c||t.int_padding:t.int_padding.substring(0,t.int_padding.length-c.length)+c),t.num_padding&&(o=1===t.num_padding.length?o||t.num_padding:t.num_padding.substring(0,t.num_padding.length-o.length)+o),t.den_padding&&(l=1===t.den_padding.length?l||t.den_padding:l+t.den_padding.slice(l.length)),t.man_padding){let e=t.exp_plus?"+":"";a=1===t.man_padding.length?(g<0?"-":e)+(a||t.man_padding):(g<0?"-":e)+t.man_padding.slice(0,t.man_padding.length-a.length)+a}let T=[],w=0,M={int:0,frac:0,man:0,num:0,den:0};for(let i=0,s=t.tokens.length;i<s;i++){let s=t.tokens[i],h=s.num?s.num.length:0;if("string"===s.type)s.rule?"num"===s.rule?v?T.push(s.value):(t.num_min>0||t.den_min>0)&&T.push(s.value.replace(/./g,C["?"])):"num+int"===s.rule?v&&c?T.push(s.value):t.den_min>0&&(c||t.num_min)&&T.push(s.value.replace(/./g,C["?"])):"den"===s.rule&&(v?T.push(s.value):(t.den_min>0||t.den_min>0)&&T.push(s.value.replace(/./g,C["?"]))):T.push(s.value);else if("error"===s.type)T.push(r.invalid);else if("point"===s.type)T.push(t.date?s.value:A.decimal);else if("general"===s.type)k(T,0,e,A);else if("exp"===s.type)T.push(A.exponent);else if("minus"===s.type)s.volatile&&t.date||s.volatile&&(e>=0||"number"!=typeof e)||(s.volatile&&!t.fractions&&(t.integer||t.dec_fractions)?(e<0&&c&&"0"!==c||u)&&T.push(A.negative):T.push(A.negative));else if("plus"===s.type)T.push(A.positive);else if("text"===s.type)T.push(e);else if("div"===s.type)v?T.push("/"):t.num_min>0||t.den_min>0?T.push(C["?"]):T.push(C["#"]);else if("int"===s.type)if(1===t.int_pattern.length)T.push(c);else{let e=w?t.int_pattern.join("").length-M.int:1/0,r=w===t.int_pattern.length-1?0:t.int_pattern.join("").length-(M.int+s.num.length);T.push(c.substring(c.length-e,c.length-r)),w++,M.int+=s.num.length}else if("frac"===s.type){let e=M.frac;for(let t=0;t<h;t++)T.push(u[t+e]||C[s.num[t]]);M.frac+=h}else if(s.type in j)1===t[s.type+"_pattern"].length?("int"===s.type&&T.push(c),"frac"===s.type&&T.push(u),"man"===s.type&&T.push(a),"num"===s.type&&T.push(o),"den"===s.type&&T.push(l)):(T.push(j[s.type].slice(M[s.type],M[s.type]+h)),M[s.type]+=h);else if("year"===s.type)_<0&&T.push(A.negative),T.push(String(Math.abs(_)).padStart(4,"0"));else if("year-short"===s.type){let e=_%100;T.push(e<10?"0":"",e)}else if("month"===s.type)T.push(s.pad&&y<10?"0":"",y);else if("monthname-single"===s.type)6===t.date_system?T.push(A.mmmm6[y-1].charAt(0)):T.push(A.mmmm[y-1].charAt(0));else if("monthname-short"===s.type)6===t.date_system?T.push(A.mmm6[y-1]):T.push(A.mmm[y-1]);else if("monthname"===s.type)6===t.date_system?T.push(A.mmmm6[y-1]):T.push(A.mmmm[y-1]);else if("weekday-short"===s.type)T.push(A.ddd[R]);else if("weekday"===s.type)T.push(A.dddd[R]);else if("day"===s.type)T.push(s.pad&&E<10?"0":"",E);else if("hour"===s.type){let e=b%t.clock||(t.clock<24?t.clock:0);T.push(s.pad&&e<10?"0":"",e)}else if("min"===s.type)T.push(s.pad&&I<10?"0":"",I);else if("sec"===s.type)T.push(s.pad&&N<10?"0":"",N);else if("subsec"===s.type){T.push(A.decimal);let e=S.toFixed(t.sec_decimals);T.push(e.slice(2,2+s.decimals))}else if("am"===s.type){let e=b<12?0:1;s.short&&!n?T.push("AP"[e]):T.push(A.ampm[e])}else if("hour-elap"===s.type){e<0&&T.push(A.negative);let t=24*f+Math.floor(Math.abs(p)/3600);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("min-elap"===s.type){e<0&&T.push(A.negative);let t=1440*f+Math.floor(Math.abs(p)/60);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("sec-elap"===s.type){e<0&&T.push(A.negative);let t=86400*f+Math.abs(p);T.push(String(Math.abs(t)).padStart(s.pad,"0"))}else if("b-year"===s.type)T.push(_+543);else if("b-year-short"===s.type){let e=(_+543)%100;T.push(e<10?"0":"",e)}}return r.nbsp?T.join(""):T.join("").replace(/\u00a0/g," ")}function H(e,t){for(let r=0;r<3;r++){let n=t[r];if(n){let t;if(n.condition){let r=n.condition[0],i=n.condition[1];"="===r?t=e===i:">"===r?t=e>i:"<"===r?t=e<i:">="===r?t=e>=i:"<="===r?t=e<=i:"<>"===r&&(t=e!==i)}else t=!0;if(t)return n}}}let W=A("@"),G="black",Y={};function z(e,t){if(e){let r=e[0];t[r]=t[r]||{},z(e.slice(1),t[r])}else t.$=!0}["d-F-y","d-F-Y","d-M-y","d-M-Y","F-d-y","F-d-Y","F-j-y","F-j-Y","j-F-y","j-F-Y","j-M-y","j-M-Y","M-d-y","M-d-Y","M-j-y","M-j-Y","m-d-y","m-d-Y","m-j-y","m-j-Y","n-d-y","n-d-Y","n-j-y","n-j-Y","y-F-d","y-F-j","y-M-d","y-M-j","Y-F-d","Y-F-j","Y-M-d","Y-m-d","Y-M-j","Y-m-j","Y-n-d","Y-n-j","j-F","j-M","d-F","d-M","n-d","n-j","n-Y","m-d","m-j","m-Y","M-Y","M-y","F-y","F-Y","Y-M","Y-n","Y-m","Y-F","Y-M"].forEach(e=>{z(e,Y),z(e+" x",Y),z(e+" l",Y),z(e+" l x",Y),z("l "+e,Y),z("l "+e+" x",Y),z(e+" D",Y),z(e+" D x",Y),z("D "+e,Y),z("D "+e+" x",Y)});let X={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12},q={january:1,february:2,march:3,april:4,june:6,july:7,august:8,september:9,october:10,november:11,december:12},K={sunday:"l",monday:"l",tuesday:"l",wednesday:"l",thursday:"l",friday:"l",saturday:"l",sun:"D",mon:"D",tue:"D",wed:"D",thu:"D",fri:"D",sat:"D"},Q=new Date().getUTCFullYear();function Z(e){let t=RegExp("^([\\s+%"+E.join("")+"(-]*)(((?:(?:\\d[\\d,]*)(?:\\.\\d*)?|(?:\\.\\d+)))([eE][+-]?\\d+)?)([\\s%"+E.join("")+")]*)$").exec(e);if(t){let[,e,r,n,i,s]=t,a=1,o="",l=!1,u=!1,c=!1,h=!1,d=!1,m=null,g=!1,f=parseFloat(r.replace(/,/g,""));if(!isFinite(f))return null;for(let t=0;t<e.length;t++){let r=e[t];if("-"===r){if(l||u)return null;l=!0,a=-1}else if(R.test(r)){if(d)return null;d=!0,m=r}else if("("===r){if(u||l)return null;u=!0,a=-1}else if("%"===r){if(h)return null;h=!0}}for(let e=0;e<s.length;e++){let t=s[e];if(R.test(t)){if(d)return null;d=!0,m=t,g=!0}else if(")"===t){if(c||!u)return null;c=!0}else if("%"===t){if(h)return null;h=!0}}if(i){if(h||d)return null;o="0.00E+00"}else if(h){if(d)return null;o=n.includes(".")?"0.00%":"0%",f*=.01}else if(d){let e=n.includes(".")?"#,##0.00":"#,##0";o=g?e+m:m+e}else n.includes(",")&&(o=n.includes(".")?"#,##0.00":"#,##0");let p={v:f*a};return o&&(p.z=o),p}}let J=(e,t,r)=>{let n=r.path||"",i=Object.keys(t);for(let s=0;s<i.length;s++){let a,o=i[s];if(t[o]){if("$"===o||""===o)e||(a=r);else if("-"===o){let i=/^(\s*([./-]|,\s)\s*|\s+)/.exec(e);if(i){let s="-"===i[1]||"/"===i[1]||"."===i[1]?i[1]:" ";if(!r.sep||r.sep===s){let l=i[0].replace(/\s+/g," ");a=J(e.slice(i[0].length),t[o],{...r,sep:s,path:n+l})}}}else if(" "===o){let i=/^[,.]?\s+/.exec(e);if(i){let s=i[0].replace(/\s+/g," ");a=J(e.slice(i[0].length),t[o],{...r,path:n+s})}}else if("j"===o||"d"===o){let i=/^(0?[1-9]|1\d|2\d|3[01])\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,day:i[0],path:n+o}))}else if("n"===o||"m"===o){let i=/^(0?[1-9]|1[012])\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,month:+i[0],_mon:i[0],path:n+o}))}else if("F"===o||"M"===o){let i=/^([a-z]{3,9})\b/i.exec(e),s=i&&("F"===o?q:X)[i[0].toLowerCase()];s&&(a=J(e.slice(i[0].length),t[o],{...r,month:s,_mon:i[0],path:n+o}))}else if("l"===o||"D"===o){let i=/^([a-z]{3,9})\b/i.exec(e);(i&&K[i[0].toLowerCase()])===o&&(a=J(e.slice(i[0].length),t[o],{...r,path:n+o}))}else if("y"===o){let i=/^\d\d\b/.exec(e);if(i){let s=+i[0]>=30?+i[0]+1900:+i[0]+2e3;a=J(e.slice(i[0].length),t[o],{...r,year:s,path:n+o})}}else if("Y"===o){let i=/^\d\d\d\d\b/.exec(e);i&&(a=J(e.slice(i[0].length),t[o],{...r,year:+i[0],path:n+o}))}else{if("x"!==o)throw Error('Unknown date token "'.concat(o,'"'));{let i=et(e);i&&(a=J("",t[o],{...r,time:i.v,tf:i.z,path:n+o}))}}if(a)return a}}};function ee(e,t){let r=J(e.trim(),Y,{path:""});if(r){var n;if("."===r.sep&&3===r.path.length)return null;let e=+(null!=(n=r.year)?n:Q);if(r.day||(r.day=1),!function(e,t,r){if(r<1||t<1||t>12)return!1;if(2===t){if(r>(e%4==0&&e%100!=0||e%400==0||1900===e?29:28))return!1}else if((4===t||6===t||9===t||11===t)&&r>30||(1===t||3===t||5===t||7===t||8===t||10===t||12===t)&&r>31)return!1;return!0}(e,r.month,r.day))return null;let i=-1/0;if(e<1900)return null;e<=1900&&r.month<=2?i=25568:e<1e4&&(i=25569);let s=Date.UTC(e,r.month-1,r.day)/864e5+i+(r.time||0);if(s>=0&&s<=2958465){let e="0"===r._mon[0]||"0"===r.day[0]||2===r._mon.length&&2===r.day.length,n=r.path.replace(/[jdlDnmMFyYx-]/g,t=>"j"===t||"d"===t?e?"dd":"d":"D"===t?"ddd":"l"===t?"dddd":"n"===t||"m"===t?e?"mm":"m":"M"===t?"mmm":"F"===t?"mmmm":"y"===t?"yy":"x"===t?r.tf||"":"Y"===t?"yyyy":t);return t&&t.nativeDate?{v:D(s,t),z:n}:{v:s,z:n}}}return null}function et(e){let t=/^\s*([10]?\d|2[0-4])(?::([0-5]\d|\d))?(?::([0-5]\d|\d))?(\.\d{1,10})?(?:\s*([AP])M?)?\s*$/i.exec(e);if(t){let[,e,r,n,i,s]=t;if(i&&!n||!s&&!r&&!n)return null;let a=+(e||0);if(s){if(a>=13)return null;"p"!==s[0]&&"P"!==s[0]||(a+=12)}return{v:(60*a*60+60*(r||0)+ +(n||0)+ +(i||0))/86400,z:(2===e.length?"hh":"h")+":mm"+(n?":ss":"")+(s?" AM/PM":"")}}return null}function er(e){return/^\s*true\s*$/i.test(e)?{v:!0}:/^\s*false\s*$/i.test(e)?{v:!1}:null}let en={};function ei(e,t){e||(e="General");let r=null;return en[e]?r=en[e]:(r=Object.assign({},p(),t).throws?T(e):function(e){try{return T(e)}catch(r){let t={tokens:[{type:"error"}],error:r.message};return{pattern:e,partitions:[t,t,t,t],error:r.message,locale:null}}}(e)).error||(en[e]=r),function(e,t){let{pattern:r,partitions:n,locale:i}=e,s=e=>{let r=Object.assign({},p(),t,e);return i&&(r.locale=i),r},a=(e,t)=>{let r=s(t);return function(e,t,r){let n=l(r.locale),i=t[3]?t[3]:W;if("boolean"==typeof e&&(e=e?"TRUE":"FALSE"),null==e)return"";if("number"!=typeof e)return $(e,i,r,n);if(!isFinite(e)){let t=n||h;return isNaN(e)?t.nan:(e<0?t.negative:"")+t.infinity}let s=H(e,t);return s?$(e,s,r,n):r.overflow}(U(e,r),n,r)};a.color=(e,t)=>(function(e,t){if("number"!=typeof e||!isFinite(e))return(t[3]?t[3].color:W.color)||G;let r=H(e,t);return r&&r.color||G})(U(e,s(t)),n);let o=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,[n,i]=e,s=n.frac_max,a={type:"general",isDate:!!(e[0]&&e[0].date||e[1]&&e[1].date||e[2]&&e[2].date||e[3]&&e[3].date),isText:function(e){let[t,r,n,i]=e;return!(t&&!t.generated||r&&!r.generated||n&&!n.generated||!i||!i.text||i.generated)}(e),isPercent:!!(e[0]&&e[0].percent||e[1]&&e[1].percent||e[2]&&e[2].percent||e[3]&&e[3].percent),maxDecimals:n.general?9:s,scale:null!=(t=n.scale)?t:1,color:0,parentheses:0,grouped:+!!n.grouping,_partitions:e},o=!a.isDate&&!a.isText&&!n.error&&n.tokens.some(e=>"string"===e.type&&(r?e.value===r:R.test(e.value))),l="G",u=s>=0?Math.min(15,s):"",c="",h="";if(i&&i.color&&(h="-",a.color=1),n.parens&&(c="()",a.parentheses=1),o)l="C",a.type="currency";else if(n.error)a.type="error",a.maxDecimals=0;else if(a.isDate){let e=0,t=0,r="";n.tokens.forEach(n=>{let i=n.type;/^(b-)?year/.test(i)?(r+="Y",t++):i.startsWith("month")?(r+="M",t++):/^(week)?day/.test(i)?(r+="D",t++):"hour"!==i&&"min"!==i&&"sec"!==i&&"am"!==i||(r+=i[0],e++)}),a.type="date",t&&e?a.type="datetime":!t&&e&&(a.type="time");let i=L.find(e=>r.startsWith(e[0]));l=i?"D":"G",u=i?i[1]:""}else a.isText?(l="G",a.type="text",u="",a.maxDecimals=0):n.general?(l="G",a.type="general",u=""):n.fractions?(l="G",a.type="fraction",u=""):n.exponential?(l="S",a.type="scientific"):a.isPercent?(l="P",a.type="percent"):n.grouping?(l=",",a.type="grouped"):(n.int_max||s)&&(l="F",a.type="number");return a.code=l+u+h+c,a.level=V[a.type],Object.freeze(a)}(n,(t||{}).currency)||SyntaxError();return a.info=o,a.dateInfo=function(e){let[t]=e;return{year:!!(2&t.date),month:!!(4&t.date),day:!!(8&t.date),hours:!!(16&t.date),minutes:!!(32&t.date),seconds:!!(64&t.date),clockType:12===t.clock?12:24}}(n),a.isPercent=()=>!!o.isPercent,a.isDate=()=>!!o.isDate,a.isText=()=>!!o.isText,a.pattern=r,e.error&&(a.error=e.error),a.options=s,a.locale=i||t&&t.locale||"",Object.freeze(a)}(r,t)}ei.isDate=e=>ei(e,{throws:!1}).isDate(),ei.isPercent=e=>ei(e,{throws:!1}).isPercent(),ei.isText=e=>ei(e,{throws:!1}).isText(),ei.getInfo=(e,t)=>ei(e,{...t,throws:!1}).info,ei.getDateInfo=(e,t)=>ei(e,{...t,throws:!1}).dateInfo,ei.dateToSerial=U,ei.dateFromSerial=D,ei.options=p,ei.dec2frac=m,ei.round=d,ei.codeToLocale=r,ei.parseLocale=a,ei.getLocale=l,ei.addLocale=(e,t)=>{let r=a(t);return delete en[r.lang],delete en[r.language],c(e,r)},ei.format=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=r&&"object"==typeof r?r:{locale:r,throws:!n};return ei(e,i)(U(t,i),i)},ei.is_date=ei.isDate,ei.parseNumber=Z,ei.parseDate=ee,ei.parseTime=et,ei.parseBool=er,ei.parseValue=function(e,t){var r,n,i;return null!=(r=null!=(n=null!=(i=Z(e))?i:ee(e,t))?n:et(e))?r:er(e)};var es=ei;return t.default}()),l5=sc.exports),l5));function sd(e){let t=0;for(let r of Object.keys(e))t=Math.max(t,Number(r));return t+1}function sm(e,t,r){let n=sd(r);for(let t=n-1;t>=e;t--)r[t+1]=r[t];r[e]=t}function sg(e,t,r){let n=Object.keys(r).reduce((e,t)=>Math.max(e,Number.parseInt(t)),0)+1;for(let i=e;i<n;i++)i<e+t?delete r[i]:void 0!==r[i]&&(r[i-t]=r[i],delete r[i])}function sf(e,t){let r=Object.keys(e),n=r.length,i=Object.keys(t),s=i.length,a={},o=0;for(let t=0;t<n;t++,o++){let n=r[t];a[o]=e[n]}for(let e=0;e<s;e++,o++){let r=i[e];a[o]=t[r]}return a}function sp(e,t,r){if(sd(r)>0){let n={},i=0;for(let s=e;s<=t;s++)r[s]&&(n[i]=r[s],i++);return n}return{}}function sC(e,t,r,n){let i=e>r;if(!i&&e+t>r)throw Error("Invalid move operation");i?function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e-1;i>=r;i--){let e=n[i];n[i+t]=e,void 0===e&&delete n[i+t]}i.forEach((e,t)=>{n[r+t]=e,void 0===e&&delete n[r+t]})}(e,t,r,n):function(e,t,r,n){let i=[];for(let r=e;r<e+t;r++)i.push(n[r]);for(let i=e+t;i<r;i++){let e=n[i];n[i-t]=e,void 0===e&&delete n[i-t]}i.forEach((e,i)=>{n[r+i-t]=e,void 0===e&&delete n[r+i-t]})}(e,t,r,n)}class s_{constructor(e={}){tE(this,"_matrix"),this._setOriginValue(e)}static MakeObjectMatrixSize(e){return new s_({[e-1]:{}})}getMatrix(){return this._matrix}forEach(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,i))break}return this}forRow(e){let t=this._matrix;for(let r of Object.keys(t)){let n=Number(r),i=t[n];if(!1===e(n,Object.keys(i).map(e=>Number(e))))break}return this}forValue(e){let t=this._matrix;for(let r in t){let n=Number(r),i=t[n];if(i)for(let t in i){let r=Number(t),s=i[r];if(!1===e(n,r,s))return this}}return this}swapRow(e,t){let r=this._matrix[e],n=this._matrix[t];this._matrix[e]=n,this._matrix[t]=r}getRow(e){return this._matrix[e]}getRowOrCreate(e){let t=this.getRow(e);return null==t&&(t={},this._matrix[e]=t),t}reset(){this._setOriginValue({})}hasValue(){let e=this._matrix,t=Object.keys(e);if(0===t.length)return!1;for(let r of t)if(Object.keys(e[Number(r)]).length>0)return!0;return!1}getValue(e,t){var r,n;return null==(n=null==(r=this._matrix)?void 0:r[e])?void 0:n[t]}setValue(e,t,r){this.getRowOrCreate(e)[t]=r}deleteValue(e,t){var r,n;null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t]}realDeleteValue(e,t){var r,n,i;if(null==(n=null==(r=this._matrix)?void 0:r[e])||delete n[t],this.getRow(e)){let t=this.getRow(e);if(null==t)return;0===Object.keys(t).length&&(null==(i=this._matrix)||delete i[e])}}setRow(e,t){this._matrix[e]=t}moveRows(e,t,r){sC(e,t,r,this._matrix)}moveColumns(e,t,r){this.forEach((n,i)=>{sC(e,t,r,i)})}insertRows(e,t){for(let r=e;r<e+t;r++)sm(r,{},this._matrix)}insertColumns(e,t){for(let r=e;r<e+t;r++)this.forEach((e,t)=>{t&&sm(r,void 0,t)})}removeRows(e,t){sg(e,t,this._matrix)}removeColumns(e,t){this.forEach((r,n)=>{n&&sg(e,t,n)})}getFragment(e,t,r,n){let i=new s_,s=0;for(let a=e;a<=t;a++){let e={},t=0;for(let i=r;i<=n;i++){let r=this.getValue(a,i);e[t]=r,t++}i.setRow(s,e),s++}return i}getSlice(e,t,r,n){let i=new s_;for(let s=e;s<=t;s++)for(let e=r;e<=n;e++){let t=this.getValue(s,e);t&&i.setValue(s,e,rq.deepClone(t))}return i}getSizeOf(){return Object.keys(this._matrix).length}getLength(){return sd(this._matrix)}getRange(){let e=this.getLength()-1,t=0,r=this.getLength();for(let e=0;e<r;e++){let r=this.getRow(e);if(r){let e=sd(r)-1;t=e>t?e:t}}return{startRow:0,startColumn:0,endRow:e,endColumn:t}}toNativeArray(){let e=[];return this.forValue((t,r,n)=>{e.push(n)}),e}toArray(){let e=[];return this.forRow((t,r)=>{null==e[t]&&(e[t]=[]),r.forEach(r=>{e[t][r]=this.getValue(t,r)})}),e}toFullArray(){let{endColumn:e,endRow:t}=this.getRange(),r=[];for(let n=0;n<=t;n++){let t=Array(e+1).fill(void 0);r.push(t)}return this.forValue((e,t,n)=>{r[e][t]=n}),r}toJSON(){return this._matrix}clone(){return JSON.parse(JSON.stringify(this._matrix))}getData(){return JSON.parse(JSON.stringify(this._matrix))}getArrayData(){let e=0,t=0,r=!1,n=!1,i=new s_;return this.forEach((s,a)=>{r||(r=!0,e=s),Object.keys(a).forEach(r=>{let a=Number(r);n?a<t&&(t=a):(n=!0,t=a);let o=this.getValue(s,a);i.setValue(s-e,a-t,o)})}),i.getData()}getStartEndScope(){let e=1/0,t=-1/0,r=1/0,n=-1/0,i=Object.keys(this._matrix);for(let s of(i.length>0&&(e=+i[0],t=+i[i.length-1]),i)){let e=Object.keys(this._matrix[s]);e.length>0&&(r=Math.min(r,+e[0]),n=Math.max(n,+e[e.length-1]))}return{startRow:e,endRow:t,startColumn:r,endColumn:n}}getDataRange(){let e=0,t=0,r=0,n=-1,i=!1,s=!1;return this.forEach((a,o)=>{if(i||(i=!0,e=a),null==o)return;let l=sd(o)-1;l>r&&(r=l),Object.keys(o).forEach(e=>{let r=Number(e);s?r<t&&(t=r):(s=!0,t=r)}),a>n&&(n=a)}),{startRow:e,startColumn:t,endRow:n,endColumn:r}}getDiscreteRanges(){let e=[];return this.forEach((t,r)=>{Object.keys(r).forEach(r=>{let n=Number(r),i=!1;for(let r of e)if(t>=r.startRow&&t<=r.endRow+1&&n>=r.startColumn&&n<=r.endColumn+1){r.endRow=Math.max(t,r.endRow),r.endColumn=Math.max(n,r.endColumn),i=!0;break}i||e.push({startRow:t,endRow:t,startColumn:n,endColumn:n})})}),e}_setOriginValue(e={}){this._matrix=e}}let sy="__INTERNAL_EDITOR__",sE=`${sy}DOCS_NORMAL`,sR=`${sy}DOCS_FORMULA_BAR`,sb=`${sy}ZEN_EDITOR`,sI=`\r
`,sN="isRowStylePrecedeColumnStyle",sS=Symbol("AUTO_HEIGHT_FOR_MERGED_CELLS");function sA(e){return`${sy}${e}`}function sv(e){return e.startsWith(sy)}var sT=((G=sT||{})[G.character=0]="character",G[G.paragraph=1]="paragraph",G[G.table=2]="table",G[G.numbering=3]="numbering",G),sw=((Y=sw||{})[Y.TAB=0]="TAB",Y[Y.SPACE=1]="SPACE",Y[Y.NOTHING=2]="NOTHING",Y),sM=((z=sM||{})[z.BULLET=0]="BULLET",z[z.NONE=1]="NONE",z[z.DECIMAL=2]="DECIMAL",z[z.DECIMAL_ZERO=3]="DECIMAL_ZERO",z[z.UPPER_LETTER=4]="UPPER_LETTER",z[z.LOWER_LETTER=5]="LOWER_LETTER",z[z.UPPER_ROMAN=6]="UPPER_ROMAN",z[z.LOWER_ROMAN=7]="LOWER_ROMAN",z[z.ORDINAL=8]="ORDINAL",z[z.CARDINAL_TEXT=9]="CARDINAL_TEXT",z[z.ORDINAL_TEXT=10]="ORDINAL_TEXT",z[z.HEX=11]="HEX",z[z.CHICAGO=12]="CHICAGO",z[z.IDEOGRAPH_DIGITAL=13]="IDEOGRAPH_DIGITAL",z[z.JAPANESE_COUNTING=14]="JAPANESE_COUNTING",z[z.AIUEO=15]="AIUEO",z[z.IROHA=16]="IROHA",z[z.DECIMAL_FULL_WIDTH=17]="DECIMAL_FULL_WIDTH",z[z.DECIMAL_HALF_WIDTH=18]="DECIMAL_HALF_WIDTH",z[z.JAPANESE_LEGAL=19]="JAPANESE_LEGAL",z[z.JAPANESE_DIGITAL_TEN_THOUSAND=20]="JAPANESE_DIGITAL_TEN_THOUSAND",z[z.DECIMAL_ENCLOSED_CIRCLE=21]="DECIMAL_ENCLOSED_CIRCLE",z[z.DECIMAL_FULL_WIDTH2=22]="DECIMAL_FULL_WIDTH2",z[z.AIUEO_FULL_WIDTH=23]="AIUEO_FULL_WIDTH",z[z.IROHA_FULL_WIDTH=24]="IROHA_FULL_WIDTH",z[z.GANADA=25]="GANADA",z[z.CHOSUNG=26]="CHOSUNG",z[z.DECIMAL_ENCLOSED_FULLSTOP=27]="DECIMAL_ENCLOSED_FULLSTOP",z[z.DECIMAL_ENCLOSED_PAREN=28]="DECIMAL_ENCLOSED_PAREN",z[z.DECIMAL_ENCLOSED_CIRCLE_CHINESE=29]="DECIMAL_ENCLOSED_CIRCLE_CHINESE",z[z.IDEOGRAPH_ENCLOSED_CIRCLE=30]="IDEOGRAPH_ENCLOSED_CIRCLE",z[z.IDEOGRAPH_TRADITIONAL=31]="IDEOGRAPH_TRADITIONAL",z[z.IDEOGRAPH_ZODIAC=32]="IDEOGRAPH_ZODIAC",z[z.IDEOGRAPH_ZODIAC_TRADITIONAL=33]="IDEOGRAPH_ZODIAC_TRADITIONAL",z[z.TAIWANESE_COUNTING=34]="TAIWANESE_COUNTING",z[z.IDEOGRAPH_LEGAL_TRADITIONAL=35]="IDEOGRAPH_LEGAL_TRADITIONAL",z[z.TAIWANESE_COUNTING_THOUSAND=36]="TAIWANESE_COUNTING_THOUSAND",z[z.TAIWANESE_DIGITAL=37]="TAIWANESE_DIGITAL",z[z.CHINESE_COUNTING=38]="CHINESE_COUNTING",z[z.CHINESE_LEGAL_SIMPLIFIED=39]="CHINESE_LEGAL_SIMPLIFIED",z[z.CHINESE_COUNTING_THOUSAND=40]="CHINESE_COUNTING_THOUSAND",z[z.KOREAN_DIGITAL=41]="KOREAN_DIGITAL",z[z.KOREAN_COUNTING=42]="KOREAN_COUNTING",z[z.KOREAN_LEGAL=43]="KOREAN_LEGAL",z[z.KOREAN_DIGITAL2=44]="KOREAN_DIGITAL2",z[z.VIETNAMESE_COUNTING=45]="VIETNAMESE_COUNTING",z[z.RUSSIAN_LOWER=46]="RUSSIAN_LOWER",z[z.RUSSIAN_UPPER=47]="RUSSIAN_UPPER",z[z.NUMBER_IN_DASH=48]="NUMBER_IN_DASH",z[z.HEBREW1=49]="HEBREW1",z[z.HEBREW2=50]="HEBREW2",z[z.ARABIC_ALPHA=51]="ARABIC_ALPHA",z[z.ARABIC_ABJAD=52]="ARABIC_ABJAD",z[z.HINDI_VOWELS=53]="HINDI_VOWELS",z[z.HINDI_CONSONANTS=54]="HINDI_CONSONANTS",z[z.HINDI_NUMBERS=55]="HINDI_NUMBERS",z[z.HINDI_COUNTING=56]="HINDI_COUNTING",z[z.THAI_LETTERS=57]="THAI_LETTERS",z[z.THAI_NUMBERS=58]="THAI_NUMBERS",z[z.THAI_COUNTING=59]="THAI_COUNTING",z[z.CUSTOM=60]="CUSTOM",z),sO=((X=sO||{})[X.BULLET_ALIGNMENT_UNSPECIFIED=0]="BULLET_ALIGNMENT_UNSPECIFIED",X[X.START=1]="START",X[X.CENTER=2]="CENTER",X[X.END=3]="END",X[X.BOTH=4]="BOTH",X),sx=((q=sx||{})[q.HYPERLINK=0]="HYPERLINK",q[q.FIELD=1]="FIELD",q[q.SDT=2]="SDT",q[q.BOOKMARK=3]="BOOKMARK",q[q.COMMENT=4]="COMMENT",q[q.CUSTOM=5]="CUSTOM",q[q.MENTION=6]="MENTION",q[q.UNI_FORMULA=7]="UNI_FORMULA",q[q.DELTED=9999]="DELTED",q),sU=((K=sU||{})[K.COMMENT=0]="COMMENT",K[K.DELETED=9999]="DELETED",K),sD=((Q=sD||{})[Q.DRAWING=0]="DRAWING",Q[Q.CUSTOM=1]="CUSTOM",Q),sV=((Z=sV||{})[Z.UNSPECIFIED=0]="UNSPECIFIED",Z[Z.TRADITIONAL=1]="TRADITIONAL",Z[Z.MODERN=2]="MODERN",Z),sL=((J=sL||{})[J.DEFAULT=0]="DEFAULT",J[J.LINES=1]="LINES",J[J.LINES_AND_CHARS=2]="LINES_AND_CHARS",J[J.SNAP_TO_CHARS=3]="SNAP_TO_CHARS",J),sP=((ee=sP||{})[ee.SECTION_TYPE_UNSPECIFIED=0]="SECTION_TYPE_UNSPECIFIED",ee[ee.CONTINUOUS=1]="CONTINUOUS",ee[ee.NEXT_PAGE=2]="NEXT_PAGE",ee[ee.EVEN_PAGE=3]="EVEN_PAGE",ee[ee.ODD_PAGE=4]="ODD_PAGE",ee),sF=((et=sF||{})[et.COLUMN_SEPARATOR_STYLE_UNSPECIFIED=0]="COLUMN_SEPARATOR_STYLE_UNSPECIFIED",et[et.NONE=1]="NONE",et[et.BETWEEN_EACH_COLUMN=2]="BETWEEN_EACH_COLUMN",et),sk=((er=sk||{})[er.NORMAL=0]="NORMAL",er[er.TBRL=1]="TBRL",er[er.LRTBV=2]="LRTBV",er),sj=((en=sj||{})[en.TEXT_RUN=0]="TEXT_RUN",en[en.AUTO_TEXT=1]="AUTO_TEXT",en[en.PAGE_BREAK=2]="PAGE_BREAK",en[en.COLUMN_BREAK=3]="COLUMN_BREAK",en[en.FOOT_NOTE_REFERENCE=4]="FOOT_NOTE_REFERENCE",en[en.HORIZONTAL_RULE=5]="HORIZONTAL_RULE",en[en.EQUATION=6]="EQUATION",en[en.DRAWING=7]="DRAWING",en[en.PERSON=8]="PERSON",en[en.RICH_LINK=9]="RICH_LINK",en),sB=((ei=sB||{})[ei.BOTH_SIDES=0]="BOTH_SIDES",ei[ei.LEFT=1]="LEFT",ei[ei.RIGHT=2]="RIGHT",ei[ei.LARGEST=3]="LARGEST",ei),s$=((es=s$||{})[es.INLINE=0]="INLINE",es[es.WRAP_NONE=1]="WRAP_NONE",es[es.WRAP_POLYGON=2]="WRAP_POLYGON",es[es.WRAP_SQUARE=3]="WRAP_SQUARE",es[es.WRAP_THROUGH=4]="WRAP_THROUGH",es[es.WRAP_TIGHT=5]="WRAP_TIGHT",es[es.WRAP_TOP_AND_BOTTOM=6]="WRAP_TOP_AND_BOTTOM",es),sH=((ea=sH||{})[ea.NAMED_STYLE_TYPE_UNSPECIFIED=0]="NAMED_STYLE_TYPE_UNSPECIFIED",ea[ea.NORMAL_TEXT=1]="NORMAL_TEXT",ea[ea.TITLE=2]="TITLE",ea[ea.SUBTITLE=3]="SUBTITLE",ea[ea.HEADING_1=4]="HEADING_1",ea[ea.HEADING_2=5]="HEADING_2",ea[ea.HEADING_3=6]="HEADING_3",ea[ea.HEADING_4=7]="HEADING_4",ea[ea.HEADING_5=8]="HEADING_5",ea),sW=((eo=sW||{})[eo.AUTO=0]="AUTO",eo[eo.AT_LEAST=1]="AT_LEAST",eo[eo.EXACT=2]="EXACT",eo),sG=((el=sG||{})[el.DASH_STYLE_UNSPECIFIED=0]="DASH_STYLE_UNSPECIFIED",el[el.SOLID=1]="SOLID",el[el.DOT=2]="DOT",el[el.DASH=3]="DASH",el),sY=((eu=sY||{})[eu.TAB_STOP_ALIGNMENT_UNSPECIFIED=0]="TAB_STOP_ALIGNMENT_UNSPECIFIED",eu[eu.START=1]="START",eu[eu.CENTER=2]="CENTER",eu[eu.END=3]="END",eu),sz=((ec=sz||{})[ec.UNSPECIFIED=0]="UNSPECIFIED",ec[ec.SPECIFIED=1]="SPECIFIED",ec),sX=((eh=sX||{})[eh.START=0]="START",eh[eh.CENTER=1]="CENTER",eh[eh.END=2]="END",eh),sq=((ed=sq||{})[ed.AUTO_FIT=0]="AUTO_FIT",ed[ed.FIXED=1]="FIXED",ed),sK=((em=sK||{})[em.NONE=0]="NONE",em[em.WRAP=1]="WRAP",em),sQ=((eg=sQ||{})[eg.AUTO=0]="AUTO",eg[eg.AT_LEAST=1]="AT_LEAST",eg[eg.EXACT=2]="EXACT",eg),sZ=((ef=sZ||{})[ef.CONTENT_ALIGNMENT_UNSPECIFIED=0]="CONTENT_ALIGNMENT_UNSPECIFIED",ef[ef.BOTH=1]="BOTH",ef[ef.TOP=2]="TOP",ef[ef.CENTER=3]="CENTER",ef[ef.BOTTOM=4]="BOTTOM",ef),sJ=((ep=sJ||{}).NORMAL="normal",ep.BOLD="bold",ep.ITALIC="italic",ep),s0=((eC=s0||{})[eC.PAGE=0]="PAGE",eC[eC.COLUMN=1]="COLUMN",eC[eC.CHARACTER=2]="CHARACTER",eC[eC.MARGIN=3]="MARGIN",eC[eC.INSIDE_MARGIN=4]="INSIDE_MARGIN",eC[eC.OUTSIDE_MARGIN=5]="OUTSIDE_MARGIN",eC[eC.LEFT_MARGIN=6]="LEFT_MARGIN",eC[eC.RIGHT_MARGIN=7]="RIGHT_MARGIN",eC),s1=((e_=s1||{})[e_.PAGE=0]="PAGE",e_[e_.PARAGRAPH=1]="PARAGRAPH",e_[e_.LINE=2]="LINE",e_[e_.MARGIN=3]="MARGIN",e_[e_.TOP_MARGIN=4]="TOP_MARGIN",e_[e_.BOTTOM_MARGIN=5]="BOTTOM_MARGIN",e_[e_.INSIDE_MARGIN=6]="INSIDE_MARGIN",e_[e_.OUTSIDE_MARGIN=7]="OUTSIDE_MARGIN",e_),s2=((ey=s2||{})[ey.POINT=0]="POINT",ey[ey.LINE=1]="LINE",ey[ey.CHARACTER=2]="CHARACTER",ey[ey.PIXEL=3]="PIXEL",ey[ey.PERCENT=4]="PERCENT",ey),s5=((eE=s5||{})[eE.CENTER=0]="CENTER",eE[eE.INSIDE=1]="INSIDE",eE[eE.LEFT=2]="LEFT",eE[eE.OUTSIDE=3]="OUTSIDE",eE[eE.RIGHT=4]="RIGHT",eE[eE.BOTH=5]="BOTH",eE[eE.DISTRIBUTE=6]="DISTRIBUTE",eE),s3=((eR=s3||{})[eR.BOTTOM=0]="BOTTOM",eR[eR.CENTER=1]="CENTER",eR[eR.INSIDE=2]="INSIDE",eR[eR.OUTSIDE=3]="OUTSIDE",eR[eR.TOP=4]="TOP",eR),s4=((eb=s4||{})[eb.compressPunctuation=0]="compressPunctuation",eb[eb.compressPunctuationAndJapaneseKana=1]="compressPunctuationAndJapaneseKana",eb[eb.doNotCompress=2]="doNotCompress",eb),s6=((eI=s6||{})[eI.PORTRAIT=0]="PORTRAIT",eI[eI.LANDSCAPE=1]="LANDSCAPE",eI),s9=((eN=s9||{}).Letter="Letter",eN.Tabloid="Tabloid",eN.Legal="Legal",eN.Statement="Statement",eN.Executive="Executive",eN.Folio="Folio",eN.A3="A3",eN.A4="A4",eN.A5="A5",eN.B4="B4",eN.B5="B5",eN);let s8=["A3","A4","A5","B4","B5","Letter","Tabloid","Legal","Statement","Executive","Folio"];var s7=((eS=s7||{})[eS.forward=0]="forward",eS[eS.backward=1]="backward",eS[eS.front=2]="front",eS[eS.back=3]="back",eS),ae=((eA=ae||{})[eA.UNRECOGNIZED=-1]="UNRECOGNIZED",eA[eA.DRAWING_IMAGE=0]="DRAWING_IMAGE",eA[eA.DRAWING_SHAPE=1]="DRAWING_SHAPE",eA[eA.DRAWING_CHART=2]="DRAWING_CHART",eA[eA.DRAWING_TABLE=3]="DRAWING_TABLE",eA[eA.DRAWING_SMART_ART=4]="DRAWING_SMART_ART",eA[eA.DRAWING_VIDEO=5]="DRAWING_VIDEO",eA[eA.DRAWING_GROUP=6]="DRAWING_GROUP",eA[eA.DRAWING_UNIT=7]="DRAWING_UNIT",eA[eA.DRAWING_DOM=8]="DRAWING_DOM",eA),at=((ev=at||{})[ev.SLIDE=0]="SLIDE",ev[ev.MASTER=1]="MASTER",ev[ev.LAYOUT=2]="LAYOUT",ev[ev.HANDOUT_MASTER=3]="HANDOUT_MASTER",ev[ev.NOTES_MASTER=4]="NOTES_MASTER",ev),ar=((eT=ar||{})[eT.SHAPE=0]="SHAPE",eT[eT.IMAGE=1]="IMAGE",eT[eT.TEXT=2]="TEXT",eT[eT.SPREADSHEET=3]="SPREADSHEET",eT[eT.DOCUMENT=4]="DOCUMENT",eT[eT.SLIDE=5]="SLIDE",eT),an=((ew=an||{})[ew.RELATIVE_SLIDE_LINK_UNSPECIFIED=0]="RELATIVE_SLIDE_LINK_UNSPECIFIED",ew[ew.NEXT_SLIDE=1]="NEXT_SLIDE",ew[ew.PREVIOUS_SLIDE=2]="PREVIOUS_SLIDE",ew[ew.FIRST_SLIDE=3]="FIRST_SLIDE",ew[ew.LAST_SLIDE=4]="LAST_SLIDE",ew);let ai={sheetId:"",range:{startRow:-1,endRow:-1,startColumn:-1,endColumn:-1}},as={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1},aa={startRow:0,startColumn:0,endRow:0,endColumn:0},ao={row:0,column:0},al={ff:"Arial",fs:11,it:rD.FALSE,bl:rD.FALSE,ul:{s:rD.FALSE},st:{s:rD.FALSE},ol:{s:rD.FALSE},tr:{a:0,v:rD.FALSE},td:rA.UNSPECIFIED,cl:{rgb:"#000"},bg:{rgb:"#fff"},ht:rT.UNSPECIFIED,vt:rw.UNSPECIFIED,tb:rM.UNSPECIFIED,pd:{t:0,r:0,b:0,l:0},n:null,bd:{b:null,l:null,r:null,t:null}},au={id:"default_slide",title:"defaultSlide",pageSize:{width:300,height:300}},ac=[sE,sb,sR],ah={[sH.HEADING_1]:{fs:20,bl:1},[sH.HEADING_2]:{fs:18,bl:1},[sH.HEADING_3]:{fs:16,bl:1},[sH.HEADING_4]:{fs:14,bl:1},[sH.HEADING_5]:{fs:12,bl:1},[sH.NORMAL_TEXT]:null,[sH.TITLE]:{fs:26,bl:1},[sH.SUBTITLE]:{fs:15,cl:{rgb:"#999999"}},[sH.NAMED_STYLE_TYPE_UNSPECIFIED]:null},ad={[sH.HEADING_1]:{spaceAbove:{v:20},spaceBelow:{v:10}},[sH.HEADING_2]:{spaceAbove:{v:18},spaceBelow:{v:10}},[sH.HEADING_3]:{spaceAbove:{v:16},spaceBelow:{v:10}},[sH.HEADING_4]:{spaceAbove:{v:14},spaceBelow:{v:8}},[sH.HEADING_5]:{spaceAbove:{v:12},spaceBelow:{v:8}},[sH.NORMAL_TEXT]:{spaceAbove:{v:0},spaceBelow:{v:0}},[sH.TITLE]:{spaceAbove:{v:0},spaceBelow:{v:7}},[sH.SUBTITLE]:{spaceAbove:{v:0},spaceBelow:{v:16}},[sH.NAMED_STYLE_TYPE_UNSPECIFIED]:null},am="univer-sheets-chart-print-chart",ag="univer-docs-drawing-printing";var af=((eM=af||{}).ARRAY_CONVERTOR="ARRAY_CONVERTOR",eM.MATRIX_CONVERTOR="MATRIX_CONVERTOR",eM);let ap={[s9.A3]:{width:1123,height:1587},[s9.A4]:{width:794,height:1124},[s9.A5]:{width:559,height:794},[s9.B4]:{width:944,height:1344},[s9.B5]:{width:665,height:944},[s9.Executive]:{width:696,height:1008},[s9.Folio]:{width:816,height:1248},[s9.Legal]:{width:816,height:1344},[s9.Letter]:{width:816,height:1056},[s9.Statement]:{width:528,height:816},[s9.Tabloid]:{width:1056,height:1632}};function aC(e,t){let{textRuns:r=[]}=t,n=0;for(let t of r){let{ts:r={},st:i,ed:s}=t;if(null==r[e])return rD.FALSE;switch(e){case"bl":case"it":if(r[e]===rD.FALSE)return rD.FALSE;break;case"ul":case"st":if(r[e].s===rD.FALSE)return rD.FALSE;break;default:throw Error(`unknown style key: ${e} in IStyleBase`)}n+=s-i}return t.dataStream.indexOf(`\r
`)===n?rD.TRUE:rD.FALSE}let a_=class e{constructor(e,t,r){tE(this,"_range"),tE(this,"_worksheet"),this._deps=r,this._range=t,this._worksheet=e}static foreach(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}getRangeData(){return this._range}getValue(){return this.getValues()[0][0]}getValues(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=[];for(let s=e;s<=t;s++){let e=[];for(let t=r;t<=n;t++)e.push(this.getMatrix().getValue(s,t)||null);i.push(e)}return i}getMatrix(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new s_;for(let a=e;a<=t;a++)for(let e=r;e<=n;e++)s.setValue(a,e,i.getValue(a,e)||null);return s}getMatrixObject(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this._range,i=this._worksheet.getCellMatrix(),s=new s_;for(let a=e;a<=t;a++)for(let t=r;t<=n;t++)s.setValue(a-e,t-r,i.getValue(a,t)||{});return s}getA1Notation(){let e,t,{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range;return i<s?(e=rq.numToWord(i+1)+(r+1),t=rq.numToWord(s+1)+(n+1)):(e=rq.numToWord(s+1)+(n+1),t=rq.numToWord(i+1)+(r+1)),e===t?`${e}`:`${e}:${t}`}getBackground(){return this.getBackgrounds()[0][0]}getBackgrounds(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.bg)?void 0:r.rgb)||al.bg.rgb}))}getCell(t,r){let{startRow:n,startColumn:i}=this._range;return new e(this._worksheet,{startRow:n+t,endRow:n+t,startColumn:i+r,endColumn:i+r},this._deps)}getColumn(){return this._range.startColumn}getObjectValue(e={}){return this.getObjectValues(e)[0][0]}getObjectValues(e={}){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this._range,a=this._worksheet.getCellMatrix().getFragment(r,n,i,s).getData();if(e.isIncludeStyle){let e=this._deps.getStyles();for(let o=0;o<=n-r;o++)for(let r=0;r<=s-i;r++){if(null==a||(null==(t=null==a?void 0:a[o])?void 0:t[r])==null)continue;let n=a[o][r].s;n&&(a[o][r].s=e.get(n))}}return a}getFontColor(){return this.getFontColors()[0][0]}getFontColors(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>{var r;let n=e.getStyleByCell(t);return(null==(r=null==n?void 0:n.cl)?void 0:r.rgb)||al.cl.rgb}))}getFontFamilies(){return this._getStyles("ff")}getFontFamily(){return this.getFontFamilies()[0][0]}getUnderlines(){return this._getStyles("ul")}getUnderline(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?aC("ul",r.body)===rD.TRUE?{s:rD.TRUE}:{s:rD.FALSE}:this.getUnderlines()[0][0]}getOverlines(){return this._getStyles("ol")}getOverline(){return this.getOverlines()[0][0]}getStrikeThrough(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?aC("st",r.body)===rD.TRUE?{s:rD.TRUE}:{s:rD.FALSE}:this.getStrikeThroughs()[0][0]}getStrikeThroughs(){return this._getStyles("st")}getFontSize(){var e,t;let r=(null==(e=this.getValue())?void 0:e.p)||{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0&&r.body.textRuns.some(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)!=null})?Math.max(...r.body.textRuns.map(e=>{var t;return(null==(t=null==e?void 0:e.ts)?void 0:t.fs)||0})):this.getFontSizes()[0][0]}getFontSizes(){return this._getStyles("fs")}getBorder(){return this.getBorders()[0][0]}getBorders(){return this._getStyles("bd")}getFontStyle(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?aC("it",r.body)===rD.TRUE?rO.ITALIC:rO.NORMAL:this._getFontStyles()[0][0]}_getFontStyles(){return this._getStyles("it")}getFontWeight(){var e,t;let{p:r}=null!=(e=this.getValue())?e:{};return r&&Array.isArray(null==(t=r.body)?void 0:t.textRuns)&&r.body.textRuns.length>0?aC("bl",r.body)===rD.TRUE?rx.BOLD:rx.NORMAL:this._getFontWeights()[0][0]}_getFontWeights(){return this._getStyles("bl")}getGridId(){return this._worksheet.getSheetId()}getHeight(){let{_range:e,_worksheet:t}=this,{startRow:r,endRow:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getRowHeight(e);return i}getHorizontalAlignment(){return this.getHorizontalAlignments()[0][0]}getHorizontalAlignments(){return this._getStyles("ht")}getLastColumn(){return this._range.endColumn}getLastRow(){return this._range.endRow}getNumColumns(){let{startColumn:e,endColumn:t}=this._range;return t-e+1}getNumRows(){let{startRow:e,endRow:t}=this._range;return t-e+1}getRichTextValue(){return this.getRichTextValues()[0][0]}getRichTextValues(){return this.getValues().map(e=>e.map(e=>(null==e?void 0:e.p)||""))}getRowIndex(){return this._range.startRow}getSheet(){return this._worksheet}getTextDirection(){return this.getTextDirections()[0][0]}getTextDirections(){return this._getStyles("td")}getTextRotation(){return this.getTextRotations()[0][0]}getTextRotations(){return this._getStyles("tr")}getTextStyle(){return this.getTextStyles()[0][0]}getTextStyles(){let e=this._deps.getStyles();return this.getValues().map(t=>t.map(t=>e.getStyleByCell(t)))}getVerticalAlignment(){return this.getVerticalAlignments()[0][0]}getVerticalAlignments(){return this._getStyles("vt")}getWidth(){let{_range:e,_worksheet:t}=this,{startColumn:r,endColumn:n}=e,i=0;for(let e=0;e<=n-r;e++)i+=t.getColumnWidth(e);return i}getWrap(){return this.getWrapStrategy()===rM.WRAP?rD.TRUE:rD.FALSE}getWrapStrategies(){return this._getStyles("tb")}getWrapStrategy(){return this.getWrapStrategies()[0][0]}forEach(t){e.foreach(this._range,t)}_getStyles(e){let t=this._deps.getStyles();return this.getValues().map(r=>r.map(r=>{let n=t&&t.getStyleByCell(r);return n&&n[e]||al[e]}))}};tE(a_,"transformRange",(e,t)=>{let r=t.getMaxColumns()-1,n=t.getMaxRows()-1;return e.rangeType===nA.ALL?{startColumn:0,startRow:0,endColumn:r,endRow:n}:e.rangeType===nA.COLUMN?{startRow:0,endRow:n,startColumn:e.startColumn,endColumn:e.endColumn}:e.rangeType===nA.ROW?{startColumn:0,endColumn:r,startRow:e.startRow,endRow:e.endRow}:{startColumn:e.startColumn,endColumn:Math.min(e.endColumn,r),startRow:e.startRow,endRow:Math.min(e.endRow,n)}});let ay=a_;function aE(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}class aR{constructor(e=9){this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(e){let t=this.data,r=[];if(!aM(e,t))return r;let n=this.toBBox,i=[];for(;t;){for(let s=0;s<t.children.length;s++){let a=t.children[s],o=t.leaf?n(a):a;aM(e,o)&&(t.leaf?r.push(a):aw(e,o)?this._all(a,r):i.push(a))}t=i.pop()}return r}collides(e){let t=this.data;if(!aM(e,t))return!1;let r=[];for(;t;){for(let n=0;n<t.children.length;n++){let i=t.children[n],s=t.leaf?this.toBBox(i):i;if(aM(e,s)){if(t.leaf||aw(e,s))return!0;r.push(i)}}t=r.pop()}return!1}load(e){if(!(e&&e.length))return this;if(e.length<this._minEntries){for(let t=0;t<e.length;t++)this.insert(e[t]);return this}let t=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===t.height)this._splitRoot(this.data,t);else{if(this.data.height<t.height){let e=this.data;this.data=t,t=e}this._insert(t,this.data.height-t.height-1,!0)}else this.data=t;return this}insert(e){return e&&this._insert(e,this.data.height-1),this}clear(){return this.data=aO([]),this}remove(e,t){let r,n,i;if(!e)return this;let s=this.data,a=this.toBBox(e),o=[],l=[];for(;s||o.length;){if(s||(s=o.pop(),n=o[o.length-1],r=l.pop(),i=!0),s.leaf){let r=function(e,t,r){if(!r)return t.indexOf(e);for(let n=0;n<t.length;n++)if(r(e,t[n]))return n;return -1}(e,s.children,t);if(-1!==r)return s.children.splice(r,1),o.push(s),this._condense(o),this}!i&&!s.leaf&&aw(s,a)?(o.push(s),l.push(r),r=0,n=s,s=s.children[0]):n?(r++,s=n.children[r],i=!1):s=null}return this}toBBox(e){return e}compareMinX(e,t){return e.minX-t.minX}compareMinY(e,t){return e.minY-t.minY}toJSON(){return this.data}fromJSON(e){return this.data=e,this}_all(e,t){let r=[];for(;e;)e.leaf?t.push(...e.children):r.push(...e.children),e=r.pop();return t}_build(e,t,r,n){let i=r-t+1,s=this._maxEntries,a;if(i<=s)return ab(a=aO(e.slice(t,r+1)),this.toBBox),a;n||(n=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,n-1))),(a=aO([])).leaf=!1,a.height=n;let o=Math.ceil(i/s),l=o*Math.ceil(Math.sqrt(s));ax(e,t,r,l,this.compareMinX);for(let i=t;i<=r;i+=l){let t=Math.min(i+l-1,r);ax(e,i,t,o,this.compareMinY);for(let r=i;r<=t;r+=o){let i=Math.min(r+o-1,t);a.children.push(this._build(e,r,i,n-1))}}return ab(a,this.toBBox),a}_chooseSubtree(e,t,r,n){for(;n.push(t),!(t.leaf||n.length-1===r);){let r=1/0,n=1/0,a;for(let o=0;o<t.children.length;o++){var i,s;let l=t.children[o],u=av(l),c=(i=e,(Math.max((s=l).maxX,i.maxX)-Math.min(s.minX,i.minX))*(Math.max(s.maxY,i.maxY)-Math.min(s.minY,i.minY))-u);c<n?(n=c,r=u<r?u:r,a=l):c===n&&u<r&&(r=u,a=l)}t=a||t.children[0]}return t}_insert(e,t,r){let n=r?e:this.toBBox(e),i=[],s=this._chooseSubtree(n,this.data,t,i);for(s.children.push(e),aN(s,n);t>=0&&i[t].children.length>this._maxEntries;)this._split(i,t),t--;this._adjustParentBBoxes(n,i,t)}_split(e,t){let r=e[t],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);let s=this._chooseSplitIndex(r,i,n),a=aO(r.children.splice(s,r.children.length-s));a.height=r.height,a.leaf=r.leaf,ab(r,this.toBBox),ab(a,this.toBBox),t?e[t-1].children.push(a):this._splitRoot(r,a)}_splitRoot(e,t){this.data=aO([e,t]),this.data.height=e.height+1,this.data.leaf=!1,ab(this.data,this.toBBox)}_chooseSplitIndex(e,t,r){let n,i=1/0,s=1/0;for(let a=t;a<=r-t;a++){let t=aI(e,0,a,this.toBBox),o=aI(e,a,r,this.toBBox),l=function(e,t){let r=Math.max(e.minX,t.minX),n=Math.max(e.minY,t.minY);return Math.max(0,Math.min(e.maxX,t.maxX)-r)*Math.max(0,Math.min(e.maxY,t.maxY)-n)}(t,o),u=av(t)+av(o);l<i?(i=l,n=a,s=u<s?u:s):l===i&&u<s&&(s=u,n=a)}return n||r-t}_chooseSplitAxis(e,t,r){let n=e.leaf?this.compareMinX:aS,i=e.leaf?this.compareMinY:aA;this._allDistMargin(e,t,r,n)<this._allDistMargin(e,t,r,i)&&e.children.sort(n)}_allDistMargin(e,t,r,n){e.children.sort(n);let i=this.toBBox,s=aI(e,0,t,i),a=aI(e,r-t,r,i),o=aT(s)+aT(a);for(let n=t;n<r-t;n++){let t=e.children[n];aN(s,e.leaf?i(t):t),o+=aT(s)}for(let n=r-t-1;n>=t;n--){let t=e.children[n];aN(a,e.leaf?i(t):t),o+=aT(a)}return o}_adjustParentBBoxes(e,t,r){for(let n=r;n>=0;n--)aN(t[n],e)}_condense(e){for(let t=e.length-1,r;t>=0;t--)0===e[t].children.length?t>0?(r=e[t-1].children).splice(r.indexOf(e[t]),1):this.clear():ab(e[t],this.toBBox)}}function ab(e,t){aI(e,0,e.children.length,t,e)}function aI(e,t,r,n,i){i||(i=aO(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=t;s<r;s++){let t=e.children[s];aN(i,e.leaf?n(t):t)}return i}function aN(e,t){return e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),e}function aS(e,t){return e.minX-t.minX}function aA(e,t){return e.minY-t.minY}function av(e){return(e.maxX-e.minX)*(e.maxY-e.minY)}function aT(e){return e.maxX-e.minX+(e.maxY-e.minY)}function aw(e,t){return e.minX<=t.minX&&e.minY<=t.minY&&t.maxX<=e.maxX&&t.maxY<=e.maxY}function aM(e,t){return t.minX<=e.maxX&&t.minY<=e.maxY&&t.maxX>=e.minX&&t.maxY>=e.minY}function aO(e){return{children:e,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ax(e,t,r,n,i){let s=[t,r];for(;s.length;){if((r=s.pop())-(t=s.pop())<=n)continue;let a=t+Math.ceil((r-t)/n/2)*n;(function e(t,r,n=0,i=t.length-1,s=function(e,t){return e<t?-1:+(e>t)}){for(;i>n;){if(i-n>600){let a=i-n+1,o=r-n+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(o-a/2<0?-1:1),h=Math.max(n,Math.floor(r-o*u/a+c)),d=Math.min(i,Math.floor(r+(a-o)*u/a+c));e(t,r,h,d,s)}let a=t[r],o=n,l=i;for(aE(t,n,r),s(t[i],a)>0&&aE(t,n,i);o<l;){for(aE(t,o,l),o++,l--;0>s(t[o],a);)o++;for(;s(t[l],a)>0;)l--}0===s(t[n],a)?aE(t,n,l):aE(t,++l,i),l<=r&&(n=l+1),r<=l&&(i=l-1)}})(e,a,t,r,i),s.push(t,a,a,r)}}function aU(e,t,r,n=!1){if(0===t&&0===r)return e;let i={...e},s=i.startAbsoluteRefType||nv.NONE,a=i.endAbsoluteRefType||nv.NONE,o=i.rangeType||nA.NORMAL;if(!n&&s===nv.ALL&&a===nv.ALL)return i;let l=aD(i.startRow,r,i.startColumn,t,o),u=aD(i.endRow,r,i.endColumn,t,o);return n||s===nv.NONE&&a===nv.NONE?i={...i,startRow:l.row,startColumn:l.column,endRow:u.row,endColumn:u.column}:(s===nv.NONE?i={...i,startRow:l.row,startColumn:l.column}:s===nv.COLUMN?i={...i,startRow:l.row}:s===nv.ROW&&(i={...i,startColumn:l.column}),a===nv.NONE?i={...i,endRow:u.row,endColumn:u.column}:a===nv.COLUMN?i={...i,endRow:u.row}:a===nv.ROW&&(i={...i,endColumn:u.column}),i)}function aD(e,t,r,n,i){return i===nA.NORMAL?{row:e+t,column:r+n}:i===nA.ROW?{row:e+t,column:r}:i===nA.COLUMN?{row:e,column:r+n}:{row:e,column:r}}function aV(e){let t=new Set,r=new Set;for(let n of e)t.add(n.startColumn),t.add(n.endColumn+1),r.add(n.startRow),r.add(n.endRow+1);let n=Array.from(t).sort((e,t)=>e-t),i=Array.from(r).sort((e,t)=>e-t);e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let s=[];for(let t=0;t<i.length-1;t++)for(let r=0;r<n.length-1;r++){let a=n[r],o=n[r+1]-1,l=i[t],u=i[t+1]-1;for(let t of e){if(t.startRow>u)break;if(t.startRow<=l&&t.endRow>=u&&t.startColumn<=a&&t.endColumn>=o){s.push({startColumn:a,endColumn:o,startRow:l,endRow:u});break}}}return s}function aL(e,t){let r=aP(e.startRow,e.endRow,t.startRow,t.endRow),n=aP(e.startColumn,e.endColumn,t.startColumn,t.endColumn);if(!r||!n)return null;let[i,s]=r,[a,o]=n,l=function(e,t,r,n,i,s){let a=void 0!==e?e:aF(r,n,i,s),o=void 0!==t?t:aF(r,n,i,s);return a===nA.ALL||o===nA.ALL?a===o?a:a===nA.ALL?o:a:a===o?a:(a===nA.NORMAL||nA.NORMAL,nA.NORMAL)}(e.rangeType,t.rangeType,i,s,a,o);return{startRow:i,endRow:s,startColumn:a,endColumn:o,rangeType:l}}function aP(e,t,r,n){let i=isNaN(e)?-1/0:e,s=isNaN(t)?1/0:t,a=isNaN(r)?-1/0:r,o=isNaN(n)?1/0:n,l=Math.max(i,a),u=Math.min(s,o);return l<=u?[l===-1/0?Number.NaN:l,u===1/0?Number.NaN:u]:null}function aF(e,t,r,n){let i=!isNaN(e)&&!isNaN(t),s=!isNaN(r)&&!isNaN(n);return i&&s?nA.NORMAL:i?nA.ROW:s?nA.COLUMN:nA.ALL}let ak=class e{static clone(e){return void 0!==e.rangeType?{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn,rangeType:e.rangeType}:{startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn}}static equals(e,t){return null!=e&&null!=t&&e.endRow===t.endRow&&e.endColumn===t.endColumn&&e.startRow===t.startRow&&e.startColumn===t.startColumn&&(e.rangeType===t.rangeType||void 0===e.rangeType&&t.rangeType===nA.NORMAL||void 0===t.rangeType&&e.rangeType===nA.NORMAL)}static simpleRangesIntersect(e,t){let{startRow:r,endRow:n,startColumn:i,endColumn:s}=e,{startRow:a,endRow:o,startColumn:l,endColumn:u}=t;return r<=o&&n>=a&&i<=u&&s>=l}static intersects(e,t){if(e.rangeType===nA.ROW&&t.rangeType===nA.COLUMN||e.rangeType===nA.COLUMN&&t.rangeType===nA.ROW)return!0;if(e.rangeType===nA.ROW&&t.rangeType===nA.ROW)return e.startRow<=t.endRow&&e.endRow>=t.startRow;if(e.rangeType===nA.COLUMN&&t.rangeType===nA.COLUMN)return e.startColumn<=t.endColumn&&e.endColumn>=t.startColumn;let r=Math.floor(Number.MAX_SAFE_INTEGER/10),n=Number.isNaN(e.startRow)?0:e.startRow,i=Number.isNaN(e.endRow)?r:e.endRow,s=Number.isNaN(e.startColumn)?0:e.startColumn,a=Number.isNaN(e.endColumn)?r:e.endColumn,o=Number.isNaN(t.startRow)?0:t.startRow,l=Number.isNaN(t.endRow)?r:t.endRow,u=Number.isNaN(t.startColumn)?0:t.startColumn,c=Number.isNaN(t.endColumn)?r:t.endColumn,h=Math.abs(n+i-o-l),d=Math.abs(n-i)+Math.abs(o-l);return Math.abs(s+a-u-c)<=Math.abs(s-a)+Math.abs(u-c)&&h<=d}static doAnyRangesIntersect(e,t){let r=new aR;return r.load(e.map(e=>({minX:e.startColumn,minY:e.startRow,maxX:e.endColumn,maxY:e.endRow}))),t.some(e=>r.search({minX:e.startColumn,minY:e.startRow,maxX:e.endColumn,maxY:e.endRow}).length>0)}static getIntersects(e,t){let r,n,i,s=e.startRow,a=e.endRow,o=e.startColumn,l=e.endColumn,u=t.startRow,c=t.endRow,h=t.startColumn,d=t.endColumn;return u<=a&&(n=u>=s?u:s,c>=s&&(i=c>=a?a:c,h<=l&&(r=h>o?h:o,d>=o)))?{startRow:n,endRow:i,startColumn:r,endColumn:d>=l?l:d,rangeType:nA.NORMAL}:null}static contains(e,t){return e.startRow<=t.startRow&&e.endRow>=t.endRow&&e.startColumn<=t.startColumn&&e.endColumn>=t.endColumn}static realContain(t,r){return e.contains(t,r)&&(t.startRow<r.startRow||t.endRow>r.endRow||t.startColumn<r.startColumn||t.endColumn>r.endColumn)}static union(...e){return e.reduce((e,t)=>({startRow:Math.min(e.startRow,t.startRow),startColumn:Math.min(e.startColumn,t.startColumn),endRow:Math.max(e.endRow,t.endRow),endColumn:Math.max(e.endColumn,t.endColumn),rangeType:nA.NORMAL}),e[0])}static realUnion(...t){let r=t.some(e=>e.rangeType===nA.COLUMN),n=t.some(e=>e.rangeType===nA.ROW),i=e.union(...t);return{startColumn:n?Number.NaN:i.startColumn,endColumn:n?Number.NaN:i.endColumn,startRow:r?Number.NaN:i.startRow,endRow:r?Number.NaN:i.endRow,rangeType:n?nA.ROW:r?nA.COLUMN:nA.NORMAL}}static subtract(e,t){if(t.startRow>e.endRow||t.endRow<e.startRow||t.startColumn>e.endColumn||t.endColumn<e.startColumn)return[e];let r=[];t.startRow>=e.startRow&&r.push({startRow:e.startRow,startColumn:e.startColumn,endRow:t.startRow-1,endColumn:e.endColumn}),t.endRow<=e.endRow&&r.push({startRow:t.endRow+1,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn});let n=Math.max(e.startRow,t.startRow),i=Math.min(e.endRow,t.endRow);return t.startColumn>=e.startColumn&&r.push({startRow:n,startColumn:e.startColumn,endRow:i,endColumn:t.startColumn-1}),t.endColumn<=e.endColumn&&r.push({startRow:n,startColumn:t.endColumn+1,endRow:i,endColumn:e.endColumn}),r.filter(e=>e.startRow<=e.endRow&&e.startColumn<=e.endColumn)}static mergeRanges(e){return function(e){e.sort((e,t)=>e.startColumn-t.startColumn||e.startRow-t.startRow);let t={};for(let r of e)t[r.startColumn]||(t[r.startColumn]=[]),t[r.startColumn].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startRow-t.startRow);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startRow<=i.endRow+1&&t.startColumn===i.startColumn&&t.endColumn===i.endColumn?i.endRow=Math.max(i.endRow,t.endRow):(r.push(i),i=t)}r.push(i)}return r}(function(e){e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn);let t={};for(let r of e)t[r.startRow]||(t[r.startRow]=[]),t[r.startRow].push(r);let r=[];for(let e in t){let n=t[+e];n.sort((e,t)=>e.startColumn-t.startColumn);let i=n[0];for(let e=1;e<n.length;e++){let t=n[e];t.startColumn<=i.endColumn+1&&t.startRow===i.startRow&&t.endRow===i.endRow?i.endColumn=Math.max(i.endColumn,t.endColumn):(r.push(i),i=t)}r.push(i)}return r}(aV(e)))}static splitIntoGrid(e){return aV(e)}static subtractMulti(e,t){if(!t.length)return e;let r=e;return t.forEach(e=>{r=function(e,t){let r=[];return e.forEach(e=>{r.push(...aj.subtract(e,t))}),aj.mergeRanges(r)}(r,e)}),r}static hasIntersectionBetweenTwoRect(e,t){return!(e.left>t.right||e.right<t.left||e.top>t.bottom||e.bottom<t.top)}static getIntersectionBetweenTwoRect(e,t){let r=Math.max(e.left,t.left),n=Math.min(e.right,t.right),i=Math.max(e.top,t.top),s=Math.min(e.bottom,t.bottom);return n<=r||s<=i?null:{left:r,right:n,top:i,bottom:s,width:n-r,height:s-i}}static sort(e){return e.sort((e,t)=>e.startRow-t.startRow||e.startColumn-t.startColumn)}};tE(ak,"getRelativeRange",(e,t)=>({startRow:e.startRow-t.startRow,endRow:e.endRow-e.startRow,startColumn:e.startColumn-t.startColumn,endColumn:e.endColumn-e.startColumn})),tE(ak,"getPositionRange",(e,t,r)=>({...r||{},startRow:r&&[nv.ROW,nv.ALL].includes(r.startAbsoluteRefType||0)?r.startRow:e.startRow+t.startRow,endRow:r&&[nv.ROW,nv.ALL].includes(r.endAbsoluteRefType||0)?r.endRow:e.endRow+e.startRow+t.startRow,startColumn:r&&[nv.COLUMN,nv.ALL].includes(r.startAbsoluteRefType||0)?r.startColumn:e.startColumn+t.startColumn,endColumn:r&&[nv.COLUMN,nv.ALL].includes(r.endAbsoluteRefType||0)?r.endColumn:e.endColumn+e.startColumn+t.startColumn})),tE(ak,"moveHorizontal",(e,t=0,r=0)=>({...e,startColumn:e.startColumn+t,endColumn:e.endColumn+t+r})),tE(ak,"moveVertical",(e,t=0,r=0)=>({...e,startRow:e.startRow+t,endRow:e.endRow+t+r})),tE(ak,"moveOffset",(e,t,r)=>({...e,startRow:e.startRow+r,endRow:e.endRow+r,startColumn:e.startColumn+t,endColumn:e.endColumn+t}));let aj=ak;function aB(e,t){let r=e.toFullArray(),n=[];for(;;){let e=function(e,t){if(0===e.length||0===e[0].length)return null;let r=Array(e[0].length).fill(0),n=0,i=null;for(let s=0;s<e.length;s++){for(let n=0;n<e[0].length;n++)r[n]=t(e[s][n])?r[n]+1:0;let a=function(e){let t=[],r=0,n={area:0,height:0,start:0,end:0},i=0;for(;i<e.length;)if(0===t.length||e[i]>=e[t[t.length-1]])t.push(i++);else{let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}for(;t.length>0;){let s=e[t.pop()],a=0===t.length?i:i-t[t.length-1]-1;s*a>r&&(n={area:r=s*a,height:s,start:0===t.length?0:t[t.length-1]+1,end:i-1})}return n}(r);a.area>n&&(n=a.area,i={startColumn:a.start,startRow:s-a.height+1,endColumn:a.end,endRow:s})}return i}(r,t);if(!e)break;n.push(e),function(e,t){ay.foreach(t,(t,r)=>{e[t][r]=void 0})}(r,e)}return n}class a${constructor(e,t){tE(this,"_values",[]),tE(this,"_keys",[]),tE(this,"_keyMaps",new Map),this._values=e,this._keys=t,e.forEach(e=>{this._initKeyMap(e)})}_initKeyMap(e){this._keys.forEach(t=>{let r=e[t],n=this._keyMaps.get(t)||new Map;n.set(r,e),this._keyMaps.set(t,n)})}getValue(e,t){let r=t||this._keys;for(let t=0;t<r.length;t++){let n=this._keyMaps.get(r[t]);if(null!=n&&n.has(e))return n.get(e)}return null}hasValue(e){for(let t=0;t<this._keys.length;t++){let r=this._keyMaps.get(this._keys[t]);if(null!=r&&r.has(e))return!0}return!1}addValue(e){this._values.push(e),this._initKeyMap(e)}setValue(e,t,r){let n=this.getValue(e);n&&Object.keys(n).includes(t)&&(n[t]=r)}deleteValue(e,t){let r=this.getValue(e,t);if(r){this._keys.forEach(e=>{let t=this._keyMaps.get(e),n=r[e];null==t||t.delete(n)});let e=this._values.findIndex(e=>e===r);this._values.splice(e,1)}}getValues(){return this._values}getKeyMap(e){var t;return[...(null==(t=this._keyMaps.get(e))?void 0:t.keys())||[]]}clear(){this._values=[],this._keys=[],this._keyMaps.clear()}}function aH(e,t,r,n){return{forEach(i){for(let s=e;s<=t;s++)for(let e=r;e<=n;e++)i(s,e)}}}function aW(e){if(null==e||0===e.length)return Number.NaN;let t=e.toLowerCase().split(""),r=t.length,n=e=>e.charCodeAt(0)-96,i=0,s=0;for(let e=0;e<r;e++)i+=n(t[e])*26**(r-e-1);return 0===i?Number.NaN:i-1}function aG(e){let t="";for(;e>=0;)t=String.fromCharCode(e%26+65)+t,e=Math.floor(e/26)-1;return t}function aY(e,t){let r="";for(;t>0;)r+=e,t--;return r}function az(e,t=!1){let r=97;return t&&(r=65),aY(String.fromCharCode(e%26+r),Math.floor(e/26)+1)}function aX(e,t){return e.zIndex>t.zIndex?1:e.zIndex===t.zIndex?0:-1}function aq(e,t){return e.zIndex>t.zIndex?-1:+(e.zIndex!==t.zIndex)}function aK(e="index",t=1){return(r,n)=>r[e]>n[e]?t:r[e]===n[e]?0:-t}var aQ=((eO=aQ||{}).PARAGRAPH="PARAGRAPH",eO.SECTION_BREAK="SECTION_BREAK",eO.TABLE="TABLE",eO.TABLE_ROW="TABLE_ROW",eO.TABLE_CELL="TABLE_CELL",eO.CUSTOM_BLOCK="CUSTOM_BLOCK",eO),aZ=((ex=aZ||{}).PARAGRAPH="\r",ex.SECTION_BREAK=`
`,ex.TABLE_START="\x1a",ex.TABLE_ROW_START="\x1b",ex.TABLE_CELL_START="\x1c",ex.TABLE_CELL_END="\x1d",ex.TABLE_ROW_END="\x0e",ex.TABLE_END="\x0f",ex.CUSTOM_RANGE_START="\x1f",ex.CUSTOM_RANGE_END="\x1e",ex.COLUMN_BREAK="\v",ex.PAGE_BREAK="\f",ex.DOCS_END="\0",ex.TAB="	",ex.CUSTOM_BLOCK="\b",ex.LETTER="",ex.SPACE=" ",ex);function aJ(e){return`${e}`}let a0=[aZ.TABLE_START,aZ.TABLE_ROW_START,aZ.TABLE_CELL_START,aZ.TABLE_CELL_END,aZ.TABLE_ROW_END,aZ.TABLE_END],a1=e=>{let t=e.endsWith(`\r
`)?e.slice(0,-2):e;return a0.reduce((e,t)=>e.replaceAll(t,""),t)};var a2="object"==typeof n&&n&&n.Object===Object&&n,a5="object"==typeof self&&self&&self.Object===Object&&self,a3=a2||a5||Function("return this")(),a4=a3.Symbol,a6=Object.prototype,a9=a6.hasOwnProperty,a8=a6.toString,a7=a4?a4.toStringTag:void 0,oe=Object.prototype.toString,ot=a4?a4.toStringTag:void 0;function or(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":ot&&ot in Object(e)?function(e){var t=a9.call(e,a7),r=e[a7];try{e[a7]=void 0;var n=!0}catch{}var i=a8.call(e);return n&&(t?e[a7]=r:delete e[a7]),i}(e):oe.call(e)}function on(e){return null!=e&&"object"==typeof e}function oi(e){return"symbol"==typeof e||on(e)&&"[object Symbol]"==or(e)}var os=Array.isArray,oa=a4?a4.prototype:void 0,oo=oa?oa.toString:void 0,ol=/\s/,ou=/^\s+/;function oc(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var oh=NaN,od=/^[-+]0x[0-9a-f]+$/i,om=/^0b[01]+$/i,og=/^0o[0-7]+$/i,of=parseInt;function op(e){if("number"==typeof e)return e;if(oi(e))return oh;if(oc(e)){var t,r="function"==typeof e.valueOf?e.valueOf():e;e=oc(r)?r+"":r}if("string"!=typeof e)return 0===e?e:+e;e=(t=e)&&t.slice(0,function(e){for(var t=e.length;t--&&ol.test(e.charAt(t)););return t}(t)+1).replace(ou,"");var n=om.test(e);return n||og.test(e)?of(e.slice(2),n?2:8):od.test(e)?oh:+e}function oC(e){return e}function o_(e){if(!oc(e))return!1;var t=or(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}var oy=a3["__core-js_shared__"],oE=(lq=/[^.]+$/.exec(oy&&oy.keys&&oy.keys.IE_PROTO||""))?"Symbol(src)_1."+lq:"",oR=Function.prototype.toString,ob=/^\[object .+?Constructor\]$/,oI=Object.prototype,oN=Function.prototype.toString,oS=oI.hasOwnProperty,oA=RegExp("^"+oN.call(oS).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function ov(e,t){var r=null==e?void 0:e[t];return oc(r)&&(!oE||!(oE in r))&&(o_(r)?oA:ob).test(function(e){if(null!=e){try{return oR.call(e)}catch{}try{return e+""}catch{}}return""}(r))?r:void 0}var oT=Object.create,ow=function(){function e(){}return function(t){if(!oc(t))return{};if(oT)return oT(t);e.prototype=t;var r=new e;return e.prototype=void 0,r}}(),oM=Date.now,oO=function(){try{var e=ov(Object,"defineProperty");return e({},"",{}),e}catch{}}(),ox=(lK=oO?function(e,t){return oO(e,"toString",{configurable:!0,enumerable:!1,value:function(){return t},writable:!0})}:oC,lQ=0,lZ=0,function(){var e=oM(),t=16-(e-lZ);if(lZ=e,t>0){if(++lQ>=800)return arguments[0]}else lQ=0;return lK.apply(void 0,arguments)}),oU=/^(?:0|[1-9]\d*)$/;function oD(e,t){var r=typeof e;return!!(t=null==t?0x1fffffffffffff:t)&&("number"==r||"symbol"!=r&&oU.test(e))&&e>-1&&e%1==0&&e<t}function oV(e,t,r){"__proto__"==t&&oO?oO(e,t,{configurable:!0,enumerable:!0,value:r,writable:!0}):e[t]=r}function oL(e,t){return e===t||e!=e&&t!=t}var oP=Object.prototype.hasOwnProperty;function oF(e,t,r){var n=e[t];oP.call(e,t)&&oL(n,r)&&(void 0!==r||t in e)||oV(e,t,r)}var ok=Math.max;function oj(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=0x1fffffffffffff}function oB(e){return null!=e&&oj(e.length)&&!o_(e)}function o$(e){var t,r,n;return ox((r=t=function(t,r){var n=-1,i=r.length,s=i>1?r[i-1]:void 0,a=i>2?r[2]:void 0;for(s=e.length>3&&"function"==typeof s?(i--,s):void 0,a&&function(e,t,r){if(!oc(r))return!1;var n=typeof t;return("number"==n?!!(oB(r)&&oD(t,r.length)):"string"==n&&t in r)&&oL(r[t],e)}(r[0],r[1],a)&&(s=i<3?void 0:s,i=1),t=Object(t);++n<i;){var o=r[n];o&&e(t,o,n,s)}return t},n=ok((n=void 0,r.length-1),0),function(){for(var e=arguments,t=-1,i=ok(e.length-n,0),s=Array(i);++t<i;)s[t]=e[n+t];t=-1;for(var a=Array(n+1);++t<n;)a[t]=e[t];return a[n]=oC(s),function(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}(r,this,a)}),t+"")}var oH=Object.prototype;function oW(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||oH)}function oG(e){return on(e)&&"[object Arguments]"==or(e)}var oY=Object.prototype,oz=oY.hasOwnProperty,oX=oY.propertyIsEnumerable,oq=oG(function(){return arguments}())?oG:function(e){return on(e)&&oz.call(e,"callee")&&!oX.call(e,"callee")},oK=t&&!t.nodeType&&t,oQ=oK&&e&&!e.nodeType&&e,oZ=oQ&&oQ.exports===oK?a3.Buffer:void 0,oJ=(oZ?oZ.isBuffer:void 0)||function(){return!1},o0={};o0["[object Float32Array]"]=o0["[object Float64Array]"]=o0["[object Int8Array]"]=o0["[object Int16Array]"]=o0["[object Int32Array]"]=o0["[object Uint8Array]"]=o0["[object Uint8ClampedArray]"]=o0["[object Uint16Array]"]=o0["[object Uint32Array]"]=!0,o0["[object Arguments]"]=o0["[object Array]"]=o0["[object ArrayBuffer]"]=o0["[object Boolean]"]=o0["[object DataView]"]=o0["[object Date]"]=o0["[object Error]"]=o0["[object Function]"]=o0["[object Map]"]=o0["[object Number]"]=o0["[object Object]"]=o0["[object RegExp]"]=o0["[object Set]"]=o0["[object String]"]=o0["[object WeakMap]"]=!1;var o1=t&&!t.nodeType&&t,o2=o1&&e&&!e.nodeType&&e,o5=o2&&o2.exports===o1&&a2.process,o3=function(){try{return o2&&o2.require&&o2.require("util").types||o5&&o5.binding&&o5.binding("util")}catch{}}(),o4=o3&&o3.isTypedArray,o6=o4?function(e){return o4(e)}:function(e){return on(e)&&oj(e.length)&&!!o0[or(e)]},o9=Object.prototype.hasOwnProperty;function o8(e){return oB(e)?function(e,t){var r=os(e),n=!r&&oq(e),i=!r&&!n&&oJ(e),s=!r&&!n&&!i&&o6(e),a=r||n||i||s,o=a?function(e,t){for(var r=-1,n=Array(e);++r<e;)n[r]=t(r);return n}(e.length,String):[],l=o.length;for(var u in e)a&&("length"==u||i&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||oD(u,l))||o.push(u);return o}(e):function(e){if(!oc(e)){var t=[];if(null!=e)for(var r in Object(e))t.push(r);return t}var n=oW(e),i=[];for(var s in e)"constructor"==s&&(n||!o9.call(e,s))||i.push(s);return i}(e)}var o7=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,le=/^\w*$/,lt=ov(Object,"create"),lr=Object.prototype.hasOwnProperty,ln=Object.prototype.hasOwnProperty;function li(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function ls(e,t){for(var r=e.length;r--;)if(oL(e[r][0],t))return r;return -1}li.prototype.clear=function(){this.__data__=lt?lt(null):{},this.size=0},li.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t},li.prototype.get=function(e){var t=this.__data__;if(lt){var r=t[e];return"__lodash_hash_undefined__"===r?void 0:r}return lr.call(t,e)?t[e]:void 0},li.prototype.has=function(e){var t=this.__data__;return lt?void 0!==t[e]:ln.call(t,e)},li.prototype.set=function(e,t){var r=this.__data__;return this.size+=+!this.has(e),r[e]=lt&&void 0===t?"__lodash_hash_undefined__":t,this};var la=Array.prototype.splice;function lo(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}lo.prototype.clear=function(){this.__data__=[],this.size=0},lo.prototype.delete=function(e){var t=this.__data__,r=ls(t,e);return!(r<0)&&(r==t.length-1?t.pop():la.call(t,r,1),--this.size,!0)},lo.prototype.get=function(e){var t=this.__data__,r=ls(t,e);return r<0?void 0:t[r][1]},lo.prototype.has=function(e){return ls(this.__data__,e)>-1},lo.prototype.set=function(e,t){var r=this.__data__,n=ls(r,e);return n<0?(++this.size,r.push([e,t])):r[n][1]=t,this};var ll=ov(a3,"Map");function lu(e,t){var r,n=e.__data__;return("string"==(r=typeof t)||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==t:null===t)?n["string"==typeof t?"string":"hash"]:n.map}function lc(e){var t=-1,r=null==e?0:e.length;for(this.clear();++t<r;){var n=e[t];this.set(n[0],n[1])}}function lh(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw TypeError("Expected a function");var r=function(){var n=arguments,i=t?t.apply(this,n):n[0],s=r.cache;if(s.has(i))return s.get(i);var a=e.apply(this,n);return r.cache=s.set(i,a)||s,a};return r.cache=new(lh.Cache||lc),r}lc.prototype.clear=function(){this.size=0,this.__data__={hash:new li,map:new(ll||lo),string:new li}},lc.prototype.delete=function(e){var t=lu(this,e).delete(e);return this.size-=!!t,t},lc.prototype.get=function(e){return lu(this,e).get(e)},lc.prototype.has=function(e){return lu(this,e).has(e)},lc.prototype.set=function(e,t){var r=lu(this,e),n=r.size;return r.set(e,t),this.size+=+(r.size!=n),this},lh.Cache=lc;var ld=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lm=/\\(\\)?/g,lg=(l0=(lJ=lh(function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(ld,function(e,r,n,i){t.push(n?i.replace(lm,"$1"):r||e)}),t},function(e){return 500===l0.size&&l0.clear(),e})).cache,lJ);function lf(e,t){return os(e)?e:!function(e,t){if(os(e))return!1;var r=typeof e;return!!("number"==r||"symbol"==r||"boolean"==r||null==e||oi(e))||le.test(e)||!o7.test(e)||null!=t&&e in Object(t)}(e,t)?lg(null==e?"":function e(t){if("string"==typeof t)return t;if(os(t))return function(e,t){for(var r=-1,n=null==e?0:e.length,i=Array(n);++r<n;)i[r]=t(e[r],r,e);return i}(t,e)+"";if(oi(t))return oo?oo.call(t):"";var r=t+"";return"0"==r&&1/t==-1/0?"-0":r}(e)):[e]}function lp(e){if("string"==typeof e||oi(e))return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}function lC(e,t,r){var n=null==e?void 0:function(e,t){t=lf(t,e);for(var r=0,n=t.length;null!=e&&r<n;)e=e[lp(t[r++])];return r&&r==n?e:void 0}(e,t);return void 0===n?r:n}var l_=(l1=Object.getPrototypeOf,l2=Object,function(e){return l1(l2(e))}),ly=Object.prototype,lE=Function.prototype.toString,lR=ly.hasOwnProperty,lb=lE.call(Object);function lI(e){var t=this.__data__=new lo(e);this.size=t.size}lI.prototype.clear=function(){this.__data__=new lo,this.size=0},lI.prototype.delete=function(e){var t=this.__data__,r=t.delete(e);return this.size=t.size,r},lI.prototype.get=function(e){return this.__data__.get(e)},lI.prototype.has=function(e){return this.__data__.has(e)},lI.prototype.set=function(e,t){var r=this.__data__;if(r instanceof lo){var n=r.__data__;if(!ll||n.length<199)return n.push([e,t]),this.size=++r.size,this;r=this.__data__=new lc(n)}return r.set(e,t),this.size=r.size,this};var lN=t&&!t.nodeType&&t,lS=lN&&e&&!e.nodeType&&e,lA=lS&&lS.exports===lN?a3.Buffer:void 0;lA&&lA.allocUnsafe;var lv=a3.Uint8Array,lT=function(e,t,r){for(var n=-1,i=Object(e),s=r(e),a=s.length;a--;){var o=s[++n];if(!1===t(i[o],o,i))break}return e},lw=function(){return a3.Date.now()},lM=Math.max,lO=Math.min;function lx(e,t,r){var n,i,s,a,o,l,u=0,c=!1,h=!1,d=!0;if("function"!=typeof e)throw TypeError("Expected a function");function m(t){var r=n,s=i;return n=i=void 0,u=t,a=e.apply(s,r)}function g(e){var r=e-l,n=e-u;return void 0===l||r>=t||r<0||h&&n>=s}function f(){var e,r,n,i=lw();if(g(i))return p(i);o=setTimeout(f,(e=i-l,r=i-u,n=t-e,h?lO(n,s-r):n))}function p(e){return o=void 0,d&&n?m(e):(n=i=void 0,a)}function C(){var e,r=lw(),s=g(r);if(n=arguments,i=this,l=r,s){if(void 0===o)return u=e=l,o=setTimeout(f,t),c?m(e):a;if(h)return clearTimeout(o),o=setTimeout(f,t),m(l)}return void 0===o&&(o=setTimeout(f,t)),a}return t=op(t)||0,oc(r)&&(c=!!r.leading,s=(h="maxWait"in r)?lM(op(r.maxWait)||0,t):s,d="trailing"in r?!!r.trailing:d),C.cancel=function(){void 0!==o&&clearTimeout(o),u=0,n=l=i=o=void 0},C.flush=function(){return void 0===o?a:p(lw())},C}function lU(e,t,r){(void 0===r||oL(e[t],r))&&(void 0!==r||t in e)||oV(e,t,r)}function lD(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}function lV(e,t,r,n,i){e!==t&&lT(t,function(s,a){if(i||(i=new lI),oc(s))!function(e,t,r,n,i,s,a){var o=lD(e,r),l=lD(t,r),u=a.get(l);if(u)return lU(e,r,u);var c=s?s(o,l,r+"",e,t,a):void 0,h=void 0===c;if(h){var d,m,g=os(l),f=!g&&oJ(l),p=!g&&!f&&o6(l);c=l,g||f||p?os(o)?c=o:on(o)&&oB(o)?c=function(e,t){var r=-1,n=e.length;for(t||(t=Array(n));++r<n;)t[r]=e[r];return t}(o):f?(h=!1,c=l.slice()):p?(h=!1,new lv(m=new(d=l.buffer).constructor(d.byteLength)).set(new lv(d)),c=new l.constructor(m,l.byteOffset,l.length)):c=[]:function(e){if(!on(e)||"[object Object]"!=or(e))return!1;var t=l_(e);if(null===t)return!0;var r=lR.call(t,"constructor")&&t.constructor;return"function"==typeof r&&r instanceof r&&lE.call(r)==lb}(l)||oq(l)?(c=o,oq(o)?c=function(e,t,r,n){var i=!r;r||(r={});for(var s=-1,a=t.length;++s<a;){var o=t[s],l=void 0;void 0===l&&(l=e[o]),i?oV(r,o,l):oF(r,o,l)}return r}(o,o8(o)):(!oc(o)||o_(o))&&(c="function"!=typeof l.constructor||oW(l)?{}:ow(l_(l)))):h=!1}h&&(a.set(l,c),i(c,l,n,s,a),a.delete(l)),lU(e,r,c)}(e,t,a,r,lV,n,i);else{var o=n?n(lD(e,a),s,a+"",e,t,i):void 0;void 0===o&&(o=s),lU(e,a,o)}},o8)}var lL=o$(function(e,t,r,n){lV(e,t,r,n)}),lP=o$(function(e,t,r){lV(e,t,r)});function lF(e,t,r){return null==e?e:function(e,t,r,n){if(!oc(e))return e;t=lf(t,e);for(var i=-1,s=t.length,a=s-1,o=e;null!=o&&++i<s;){var l=lp(t[i]),u=r;if("__proto__"===l||"constructor"===l||"prototype"===l)break;if(i!=a){var c=o[l];u=void 0,u=oc(c)?c:oD(t[i+1])?[]:{}}oF(o,l,u),o=o[l]}return e}(e,t,r)}let lk=nK(function(){if(l6)return l4;function e(h,d,m,g,p){if(h===d)return h?[[0,h]]:[];if(null!=m){var C=function(e,t,r){var n="number"==typeof r?{index:r,length:0}:r.oldRange,i="number"==typeof r?null:r.newRange,s=e.length,a=t.length;if(0===n.length&&(null===i||0===i.length)){var o=n.index,l=e.slice(0,o),u=e.slice(o),c=i?i.index:null;e:{var h=o+a-s;if(null!==c&&c!==h||h<0||h>a)break e;var d=t.slice(0,h),m=t.slice(h);if(m!==u)break e;var g=Math.min(o,h),p=l.slice(0,g),C=d.slice(0,g);if(p!==C)break e;var _=l.slice(g),y=d.slice(g);return f(p,_,y,u)}e:if(null===c||c===o){var d=t.slice(0,o),m=t.slice(o);if(d!==l)break e;var E=Math.min(s-o,a-o),R=u.slice(u.length-E),b=m.slice(m.length-E);if(R!==b)break e;var _=u.slice(0,u.length-E),y=m.slice(0,m.length-E);return f(l,_,y,R)}}if(n.length>0&&i&&0===i.length)e:{var p=e.slice(0,n.index),R=e.slice(n.index+n.length),g=p.length,E=R.length;if(a<g+E)break e;var C=t.slice(0,g),b=t.slice(a-E);if(p!==C||R!==b)break e;var _=e.slice(g,s-E),y=t.slice(g,a-E);return f(p,_,y,R)}return null}(h,d,m);if(C)return C}var _=r(h,d),y=h.substring(0,_);_=i(h=h.substring(_),d=d.substring(_));var E=h.substring(h.length-_),R=function(n,s){if(!n)return[[1,s]];if(!s)return[[-1,n]];var a,o=n.length>s.length?n:s,l=n.length>s.length?s:n,u=o.indexOf(l);if(-1!==u)return a=[[1,o.substring(0,u)],[0,l],[1,o.substring(u+l.length)]],n.length>s.length&&(a[0][0]=a[2][0]=-1),a;if(1===l.length)return[[-1,n],[1,s]];var c=function(e,t){var n,s,a,o,l=e.length>t.length?e:t,u=e.length>t.length?t:e;if(l.length<4||2*u.length<l.length)return null;function c(e,t,n){for(var s,a,o,l,u=e.substring(n,n+Math.floor(e.length/4)),c=-1,h="";-1!==(c=t.indexOf(u,c+1));){var d=r(e.substring(n),t.substring(c)),m=i(e.substring(0,n),t.substring(0,c));h.length<m+d&&(h=t.substring(c-m,c)+t.substring(c,c+d),s=e.substring(0,n-m),a=e.substring(n+d),o=t.substring(0,c-m),l=t.substring(c+d))}return 2*h.length>=e.length?[s,a,o,l,h]:null}var h,d=c(l,u,Math.ceil(l.length/4)),m=c(l,u,Math.ceil(l.length/2));return d||m?(h=m?d&&d[4].length>m[4].length?d:m:d,e.length>t.length?(n=h[0],s=h[1],a=h[2],o=h[3]):(a=h[0],o=h[1],n=h[2],s=h[3]),[n,s,a,o,h[4]]):null}(n,s);if(c){var h=c[0],d=c[1],m=c[2],g=c[3],f=c[4],p=e(h,m),C=e(d,g);return p.concat([[0,f]],C)}return function(e,r){for(var n=e.length,i=r.length,s=Math.ceil((n+i)/2),a=2*s,o=Array(a),l=Array(a),u=0;u<a;u++)o[u]=-1,l[u]=-1;o[s+1]=0,l[s+1]=0;for(var c=n-i,h=c%2!=0,d=0,m=0,g=0,f=0,p=0;p<s;p++){for(var C=-p+d;C<=p-m;C+=2){var _,y=s+C;_=C===-p||C!==p&&o[y-1]<o[y+1]?o[y+1]:o[y-1]+1;for(var E=_-C;_<n&&E<i&&e.charAt(_)===r.charAt(E);)_++,E++;if(o[y]=_,_>n)m+=2;else if(E>i)d+=2;else if(h){var R=s+c-C;if(R>=0&&R<a&&-1!==l[R]){var b=n-l[R];if(_>=b)return t(e,r,_,E)}}}for(var I=-p+g;I<=p-f;I+=2){var b,R=s+I;b=I===-p||I!==p&&l[R-1]<l[R+1]?l[R+1]:l[R-1]+1;for(var N=b-I;b<n&&N<i&&e.charAt(n-b-1)===r.charAt(i-N-1);)b++,N++;if(l[R]=b,b>n)f+=2;else if(N>i)g+=2;else if(!h){var y=s+c-I;if(y>=0&&y<a&&-1!==o[y]){var _=o[y],E=s+_-y;if(_>=(b=n-b))return t(e,r,_,E)}}}}return[[-1,e],[1,r]]}(n,s)}(h=h.substring(0,h.length-_),d=d.substring(0,d.length-_));return y&&R.unshift([0,y]),E&&R.push([0,E]),c(R,p),g&&function(e){for(var t=!1,r=[],h=0,d=null,m=0,g=0,f=0,p=0,C=0;m<e.length;)0==e[m][0]?(r[h++]=m,g=p,f=C,p=0,C=0,d=e[m][1]):(1==e[m][0]?p+=e[m][1].length:C+=e[m][1].length,d&&d.length<=Math.max(g,f)&&d.length<=Math.max(p,C)&&(e.splice(r[h-1],0,[-1,d]),e[r[h-1]+1][0]=1,h--,m=--h>0?r[h-1]:-1,g=0,f=0,p=0,C=0,d=null,t=!0)),m++;for(t&&c(e),function(e){function t(e,t){if(!e||!t)return 6;var r=e.charAt(e.length-1),n=t.charAt(0),i=r.match(s),c=n.match(s),h=i&&r.match(a),d=c&&n.match(a),m=h&&r.match(o),g=d&&n.match(o),f=m&&e.match(l),p=g&&t.match(u);return f||p?5:m||g?4:i&&!h&&d?3:h||d?2:i||c?1:0}for(var r=1;r<e.length-1;){if(0==e[r-1][0]&&0==e[r+1][0]){var n=e[r-1][1],c=e[r][1],h=e[r+1][1],d=i(n,c);if(d){var m=c.substring(c.length-d);n=n.substring(0,n.length-d),c=m+c.substring(0,c.length-d),h=m+h}for(var g=n,f=c,p=h,C=t(n,c)+t(c,h);c.charAt(0)===h.charAt(0);){n+=c.charAt(0),c=c.substring(1)+h.charAt(0),h=h.substring(1);var _=t(n,c)+t(c,h);_>=C&&(C=_,g=n,f=c,p=h)}e[r-1][1]!=g&&(g?e[r-1][1]=g:(e.splice(r-1,1),r--),e[r][1]=f,p?e[r+1][1]=p:(e.splice(r+1,1),r--))}r++}}(e),m=1;m<e.length;){if(-1==e[m-1][0]&&1==e[m][0]){var _=e[m-1][1],y=e[m][1],E=n(_,y),R=n(y,_);E>=R?(E>=_.length/2||E>=y.length/2)&&(e.splice(m,0,[0,y.substring(0,E)]),e[m-1][1]=_.substring(0,_.length-E),e[m+1][1]=y.substring(E),m++):(R>=_.length/2||R>=y.length/2)&&(e.splice(m,0,[0,_.substring(0,R)]),e[m-1][0]=1,e[m-1][1]=y.substring(0,y.length-R),e[m+1][0]=-1,e[m+1][1]=_.substring(R),m++),m++}m++}}(R),R}function t(t,r,n,i){var s=t.substring(0,n),a=r.substring(0,i),o=t.substring(n),l=r.substring(i),u=e(s,a),c=e(o,l);return u.concat(c)}function r(e,t){if(!e||!t||e.charAt(0)!==t.charAt(0))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(s,i)==t.substring(s,i)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return h(e.charCodeAt(i-1))&&i--,i}function n(e,t){var r=e.length,n=t.length;if(0==r||0==n)return 0;r>n?e=e.substring(r-n):r<n&&(t=t.substring(0,r));var i=Math.min(r,n);if(e==t)return i;for(var s=0,a=1;;){var o=e.substring(i-a),l=t.indexOf(o);if(-1==l)return s;a+=l,(0==l||e.substring(i-a)==t.substring(0,a))&&(s=a,a++)}}function i(e,t){if(!e||!t||e.slice(-1)!==t.slice(-1))return 0;for(var r=0,n=Math.min(e.length,t.length),i=n,s=0;r<i;)e.substring(e.length-i,e.length-s)==t.substring(t.length-i,t.length-s)?s=r=i:n=i,i=Math.floor((n-r)/2+r);return d(e.charCodeAt(e.length-i))&&i--,i}l6=1;var s=/[^a-zA-Z0-9]/,a=/\s/,o=/[\r\n]/,l=/\n\r?\n$/,u=/^\r?\n\r?\n/;function c(e,t){e.push([0,""]);for(var n,s=0,a=0,o=0,l="",u="";s<e.length;){if(s<e.length-1&&!e[s][1]){e.splice(s,1);continue}switch(e[s][0]){case 1:o++,u+=e[s][1],s++;break;case -1:a++,l+=e[s][1],s++;break;case 0:var h=s-o-a-1;if(t){if(h>=0&&g(e[h][1])){var d=e[h][1].slice(-1);if(e[h][1]=e[h][1].slice(0,-1),l=d+l,u=d+u,!e[h][1]){e.splice(h,1),s--;var f=h-1;e[f]&&1===e[f][0]&&(o++,u=e[f][1]+u,f--),e[f]&&-1===e[f][0]&&(a++,l=e[f][1]+l,f--),h=f}}if(m(e[s][1])){var d=e[s][1].charAt(0);e[s][1]=e[s][1].slice(1),l+=d,u+=d}}if(s<e.length-1&&!e[s][1]){e.splice(s,1);break}if(l.length>0||u.length>0){l.length>0&&u.length>0&&(0!==(n=r(u,l))&&(h>=0?e[h][1]+=u.substring(0,n):(e.splice(0,0,[0,u.substring(0,n)]),s++),u=u.substring(n),l=l.substring(n)),0!==(n=i(u,l))&&(e[s][1]=u.substring(u.length-n)+e[s][1],u=u.substring(0,u.length-n),l=l.substring(0,l.length-n)));var p=o+a;0===l.length&&0===u.length?(e.splice(s-p,p),s-=p):0===l.length?(e.splice(s-p,p,[1,u]),s=s-p+1):0===u.length?(e.splice(s-p,p,[-1,l]),s=s-p+1):(e.splice(s-p,p,[-1,l],[1,u]),s=s-p+2)}0!==s&&0===e[s-1][0]?(e[s-1][1]+=e[s][1],e.splice(s,1)):s++,o=0,a=0,l="",u=""}}""===e[e.length-1][1]&&e.pop();var C=!1;for(s=1;s<e.length-1;)0===e[s-1][0]&&0===e[s+1][0]&&(e[s][1].substring(e[s][1].length-e[s-1][1].length)===e[s-1][1]?(e[s][1]=e[s-1][1]+e[s][1].substring(0,e[s][1].length-e[s-1][1].length),e[s+1][1]=e[s-1][1]+e[s+1][1],e.splice(s-1,1),C=!0):e[s][1].substring(0,e[s+1][1].length)==e[s+1][1]&&(e[s-1][1]+=e[s+1][1],e[s][1]=e[s][1].substring(e[s+1][1].length)+e[s+1][1],e.splice(s+1,1),C=!0)),s++;C&&c(e,t)}function h(e){return e>=55296&&e<=56319}function d(e){return e>=56320&&e<=57343}function m(e){return d(e.charCodeAt(0))}function g(e){return h(e.charCodeAt(e.length-1))}function f(e,t,r,n){return g(e)||m(n)?null:function(e){for(var t=[],r=0;r<e.length;r++)e[r][1].length>0&&t.push(e[r]);return t}([[0,e],[-1,t],[1,r],[0,n]])}function p(t,r,n,i){return e(t,r,n,i,!0)}return p.INSERT=1,p.DELETE=-1,p.EQUAL=0,l4=p}()),lj=new Set(["true","false"]);function lB(e){return lj.has(e.toLowerCase())}let l$=nK((ue||(ue=1,l7=function(){if(l8)return l9;l8=1;var e=function(t){if(t=t||{},this.Promise=t.Promise||Promise,this.queues=Object.create(null),this.domainReentrant=t.domainReentrant||!1,this.domainReentrant)throw Error("Domain-reentrant locks require `process.domain` to exist. Please flip `opts.domainReentrant = false`, use a NodeJS version that still implements Domain, or install a browser polyfill.");this.timeout=t.timeout||e.DEFAULT_TIMEOUT,this.maxOccupationTime=t.maxOccupationTime||e.DEFAULT_MAX_OCCUPATION_TIME,this.maxExecutionTime=t.maxExecutionTime||e.DEFAULT_MAX_EXECUTION_TIME,t.maxPending===1/0||Number.isInteger(t.maxPending)&&t.maxPending>=0?this.maxPending=t.maxPending:this.maxPending=e.DEFAULT_MAX_PENDING};return e.DEFAULT_TIMEOUT=0,e.DEFAULT_MAX_OCCUPATION_TIME=0,e.DEFAULT_MAX_EXECUTION_TIME=0,e.DEFAULT_MAX_PENDING=1e3,e.prototype.acquire=function(e,t,r,n){if(Array.isArray(e))return this._acquireBatch(e,t,r,n);if("function"!=typeof t)throw Error("You must pass a function to execute");var i=null,s=null,a=null;"function"!=typeof r&&(n=r,r=null,a=new this.Promise(function(e,t){i=e,s=t})),n=n||{};var o=!1,l=null,u=null,c=null,h=this,d=function(t,n,l){u&&(clearTimeout(u),u=null),c&&(clearTimeout(c),c=null),t&&(h.queues[e]&&0===h.queues[e].length&&delete h.queues[e],h.domainReentrant&&delete h.domains[e]),o||(a?n?s(n):i(l):"function"==typeof r&&r(n,l),o=!0),t&&h.queues[e]&&h.queues[e].length>0&&h.queues[e].shift()()},m=function(r){if(o)return d(r);l&&(clearTimeout(l),l=null),h.domainReentrant&&r&&(h.domains[e]=tC.domain);var i=n.maxExecutionTime||h.maxExecutionTime;if(i&&(c=setTimeout(function(){h.queues[e]&&d(r,Error("Maximum execution time is exceeded "+e))},i)),1===t.length){var s=!1;try{t(function(e,t){s||(s=!0,d(r,e,t))})}catch(e){s||(s=!0,d(r,e))}}else h._promiseTry(function(){return t()}).then(function(e){d(r,void 0,e)},function(e){d(r,e)})};h.domainReentrant&&tC.domain&&(m=tC.domain.bind(m));var g=n.maxPending||h.maxPending;if(h.queues[e])if(h.domainReentrant&&tC.domain&&tC.domain===h.domains[e])m(!1);else if(h.queues[e].length>=g)d(!1,Error("Too many pending tasks in queue "+e));else{var f=function(){m(!0)};n.skipQueue?h.queues[e].unshift(f):h.queues[e].push(f);var p=n.timeout||h.timeout;p&&(l=setTimeout(function(){l=null,d(!1,Error("async-lock timed out in queue "+e))},p))}else h.queues[e]=[],m(!0);var C=n.maxOccupationTime||h.maxOccupationTime;if(C&&(u=setTimeout(function(){h.queues[e]&&d(!1,Error("Maximum occupation time is exceeded in queue "+e))},C)),a)return a},e.prototype._acquireBatch=function(e,t,r,n){"function"!=typeof r&&(n=r,r=null);var i=this,s=e.reduceRight(function(e,t){return function(r){i.acquire(t,e,r,n)}},t);if("function"!=typeof r)return new this.Promise(function(e,t){1===s.length?s(function(r,n){r?t(r):e(n)}):e(s())});s(r)},e.prototype.isBusy=function(e){return e?!!this.queues[e]:Object.keys(this.queues).length>0},e.prototype._promiseTry=function(e){try{return this.Promise.resolve(e())}catch(e){return this.Promise.reject(e)}},l9=e}()),l7));function lH(e,t){if(Object.is(e,t))return!0;if("object"!=typeof e||!e||"object"!=typeof t||!t)return!1;let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;let i=Object.prototype.hasOwnProperty.bind(t);for(let n=0;n<r.length;n++){let s=r[n];if(!i(s)||e[s]!==t[s])return!1}return!0}var lW=((eU=lW||{})[eU.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",eU[eU.UNIVER_DOC=1]="UNIVER_DOC",eU[eU.UNIVER_SHEET=2]="UNIVER_SHEET",eU[eU.UNIVER_SLIDE=3]="UNIVER_SLIDE",eU[eU.UNIVER_PROJECT=4]="UNIVER_PROJECT",eU[eU.UNRECOGNIZED=-1]="UNRECOGNIZED",eU),lG=((eD=lG||{})[eD.Reader=0]="Reader",eD[eD.Editor=1]="Editor",eD[eD.Owner=2]="Owner",eD[eD.UNRECOGNIZED=-1]="UNRECOGNIZED",eD),lY=((eV=lY||{})[eV.SomeCollaborator=0]="SomeCollaborator",eV[eV.AllCollaborator=1]="AllCollaborator",eV[eV.OneSelf=2]="OneSelf",eV[eV.UNRECOGNIZED=-1]="UNRECOGNIZED",eV);class lz extends tP{}var lX,lq,lK,lQ,lZ,lJ,l0,l1,l2,l5,l3,l4,l6,l9,l8,l7,ue,ut,ur,un,ui={},us={},ua={},uo={},ul={};function uu(){return un||(un=1,function(e){function t(e,t){if(!e)throw Error(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.eachChildOf=e.advancer=e.readCursor=e.writeCursor=e.WriteCursor=e.ReadCursor=e.isValidPathItem=void 0;let r=e=>null!=e&&"object"==typeof e&&!Array.isArray(e),n=(e,t)=>typeof e==typeof t?e>t:"string"==typeof e&&"number"==typeof t;function i(e,t){for(let r in e)t.write(r,e[r])}e.isValidPathItem=e=>"number"==typeof e||"string"==typeof e&&"__proto__"!==e;class s{constructor(e=null){this.parents=[],this.indexes=[],this.lcIdx=-1,this.idx=-1,this.container=e}ascend(){t(this.parents.length===this.indexes.length/2),0===this.idx?this.parents.length?(this.lcIdx=this.indexes.pop(),this.container=this.parents.pop(),this.idx=this.indexes.pop()):(this.lcIdx=0,this.idx=-1):(t(this.idx>0),this.idx--,r(this.container[this.idx])&&this.idx--)}getPath(){let e=[],t=this.container,n=this.parents.length-1,i=this.idx;for(;i>=0;)e.unshift(t[i]),0===i?(i=this.indexes[2*n],t=this.parents[n--]):i-=r(t[i-1])?2:1;return e}}class a extends s{get(){return this.container?this.container.slice(this.idx+1):null}getKey(){return t(null!=this.container,"Invalid call to getKey before cursor descended"),this.container[this.idx]}getComponent(){let e;return this.container&&this.container.length>this.idx+1&&r(e=this.container[this.idx+1])?e:null}descendFirst(){let e=this.idx+1;if(!this.container||e>=this.container.length||r(this.container[e])&&e+1>=this.container.length)return!1;r(this.container[e])&&e++;let t=this.container[e];return Array.isArray(t)?(this.indexes.push(this.idx),this.parents.push(this.container),this.indexes.push(e),this.idx=0,this.container=t):this.idx=e,!0}nextSibling(){if(t(this.parents.length===this.indexes.length/2),this.idx>0||0===this.parents.length)return!1;let e=this.indexes[this.indexes.length-1]+1,r=this.parents[this.parents.length-1];return!(e>=r.length)&&(t(!isNaN(e)),this.indexes[this.indexes.length-1]=e,this.container=r[e],!0)}_init(e,t,r,n){this.container=e,this.idx=t,this.parents=r.slice(),this.indexes=n.slice()}clone(){let e=new a;return e._init(this.container,this.idx,this.parents,this.indexes),e}*[Symbol.iterator](){if(this.descendFirst()){do yield this.getKey();while(this.nextSibling())this.ascend()}}traverse(e,t){let r=this.getComponent();for(let n of(r&&t(r,e),this))e&&e.descend(n),this.traverse(e,t),e&&e.ascend()}eachPick(e,t){this.traverse(e,(e,r)=>{null!=e.p&&t(e.p,r)})}eachDrop(e,t){this.traverse(e,(e,r)=>{null!=e.d&&t(e.d,r)})}}e.ReadCursor=a;class o extends s{constructor(e=null){super(e),this.pendingDescent=[],this._op=e}flushDescent(){t(this.parents.length===this.indexes.length/2),null===this.container&&(this._op=this.container=[]);for(let e=0;e<this.pendingDescent.length;e++){let i=this.pendingDescent[e],s=this.idx+1;if(s<this.container.length&&r(this.container[s])&&s++,t(s===this.container.length||!r(this.container[s])),s===this.container.length)this.container.push(i),this.idx=s;else if(this.container[s]===i)this.idx=s;else{if(!Array.isArray(this.container[s])){let e=this.container.splice(s,this.container.length-s);this.container.push(e),this.lcIdx>-1&&(this.lcIdx=s)}for(this.indexes.push(this.idx),this.parents.push(this.container),-1!==this.lcIdx&&(t(n(i,this.container[this.lcIdx][0])),s=this.lcIdx+1,this.lcIdx=-1);s<this.container.length&&n(i,this.container[s][0]);)s++;if(this.indexes.push(s),this.idx=0,s<this.container.length&&this.container[s][0]===i)this.container=this.container[s];else{let e=[i];this.container.splice(s,0,e),this.container=e}}}this.pendingDescent.length=0}reset(){this.lcIdx=-1}getComponent(){this.flushDescent();let e=this.idx+1;if(e<this.container.length&&r(this.container[e]))return this.container[e];{let t={};return this.container.splice(e,0,t),t}}write(e,r){let n=this.getComponent();t(null==n[e]||n[e]===r,"Internal consistency error: Overwritten component. File a bug"),n[e]=r}get(){return this._op}descend(t){if(!e.isValidPathItem(t))throw Error("Invalid JSON key");this.pendingDescent.push(t)}descendPath(e){return this.pendingDescent.push(...e),this}ascend(){this.pendingDescent.length?this.pendingDescent.pop():super.ascend()}mergeTree(e,r=i){if(null===e)return;if(t(Array.isArray(e)),e===this._op)throw Error("Cannot merge into my own tree");let n=this.lcIdx,s=this.parents.length,a=0;for(let t=0;t<e.length;t++){let n=e[t];"string"==typeof n||"number"==typeof n?(a++,this.descend(n)):Array.isArray(n)?this.mergeTree(n,r):"object"==typeof n&&r(n,this)}for(;a--;)this.ascend();this.lcIdx=this.parents.length===s?n:-1}at(e,t){this.descendPath(e),t(this);for(let t=0;t<e.length;t++)this.ascend();return this}writeAtPath(e,t,r){return this.at(e,()=>this.write(t,r)),this.reset(),this}writeMove(e,t,r=0){return this.writeAtPath(e,"p",r).writeAtPath(t,"d",r)}getPath(){let e=super.getPath();return e.push(...this.pendingDescent),e}}e.WriteCursor=o,e.writeCursor=()=>new o,e.readCursor=e=>new a(e),e.advancer=function(e,t,r){let i,s;function a(i){let a;for(;s;){let o=a=e.getKey();if(null!=i){let r=!1;if(t&&"number"==typeof o&&(a=t(o,e.getComponent()))<0&&(a=~a,r=!0),n(a,i))return null;if(a===i&&!r)return e}r&&"number"==typeof a&&r(a,e.getComponent()),s=e.nextSibling()}return null}return s=i=!!e&&e.descendFirst(),a.end=()=>{i&&e.ascend()},a},e.eachChildOf=function(e,t,r){let i,s,a,o;for(i=s=e&&e.descendFirst(),a=o=t&&t.descendFirst();i||a;){let s=i?e.getKey():null,o=a?t.getKey():null;null!==s&&null!==o&&(n(o,s)?o=null:s!==o&&(s=null)),r(null==s?o:s,null!=s?e:null,null!=o?t:null),null!=s&&i&&(i=e.nextSibling()),null!=o&&a&&(a=t.nextSibling())}s&&e.ascend(),o&&t.ascend()}}(ul)),ul}var uc,uh={};function ud(){var e;return uc||(uc=1,Object.defineProperty(uh,"__esModule",{value:!0}),uh.ConflictType=void 0,(e=uh.ConflictType||(uh.ConflictType={}))[e.RM_UNEXPECTED_CONTENT=1]="RM_UNEXPECTED_CONTENT",e[e.DROP_COLLISION=2]="DROP_COLLISION",e[e.BLACKHOLE=3]="BLACKHOLE"),uh}var um,ug={},uf={};function up(){return um||(um=1,Object.defineProperty(uf,"__esModule",{value:!0}),uf.uniToStrPos=uf.strPosToUni=void 0,uf.strPosToUni=(e,t=e.length)=>{let r=0,n=0;for(;n<t;n++){let t=e.charCodeAt(n);t>=55296&&t<=57343&&(r++,n++)}if(n!==t)throw Error("Invalid offset - splits unicode bytes");return n-r},uf.uniToStrPos=(e,t)=>{let r=0;for(;t>0;t--){let t=e.charCodeAt(r);r+=t>=55296&&t<=57343?2:1}return r}),uf}var uC,u_={};function uy(){return uC||(uC=1,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.uniSlice=e.dlen=e.eachOp=void 0;let t=up(),r=t=>{if(!Array.isArray(t))throw Error("Op must be an array of components");let r=null;for(let n=0;n<t.length;n++){let i=t[n];switch(typeof i){case"object":if("number"!=typeof i.d&&"string"!=typeof i.d)throw Error("Delete must be number or string");if(0>=e.dlen(i.d))throw Error("Deletes must not be empty");break;case"string":if(!(i.length>0))throw Error("Inserts cannot be empty");break;case"number":if(!(i>0))throw Error("Skip components must be >0");if("number"==typeof r)throw Error("Adjacent skip components should be combined")}r=i}if("number"==typeof r)throw Error("Op has a trailing skip")};function n(r,n){let i=0,s=0;for(let a=0;a<r.length;a++){let o=r[a];switch(n(o,i,s),typeof o){case"object":i+=e.dlen(o.d);break;case"string":s+=t.strPosToUni(o);break;case"number":i+=o,s+=o}}}function i(e,t){let r=[],i=o(r);return n(e,(e,r,n)=>{i(t(e,r,n))}),h(r)}e.eachOp=n;let s=e=>e,a=e=>i(e,s);e.dlen=e=>"number"==typeof e?e:t.strPosToUni(e);let o=t=>r=>{if(!(!r||0===r.d||""===r.d))if(0===t.length)t.push(r);else if(typeof r==typeof t[t.length-1])if("object"==typeof r){let n=t[t.length-1];n.d="string"==typeof n.d&&"string"==typeof r.d?n.d+r.d:e.dlen(n.d)+e.dlen(r.d)}else t[t.length-1]+=r;else t.push(r)},l=e=>"number"==typeof e?e:"string"==typeof e?t.strPosToUni(e):"number"==typeof e.d?e.d:t.strPosToUni(e.d);e.uniSlice=(e,r,n)=>{let i=t.uniToStrPos(e,r),s=null==n?1/0:t.uniToStrPos(e,n);return e.slice(i,s)};let u=(t,r,n)=>"number"==typeof t?null==n?t-r:Math.min(t,n)-r:e.uniSlice(t,r,n),c=r=>{let n=0,i=0;return{take:(s,a)=>{let o;if(n===r.length)return -1===s?null:s;let l=r[n];if("number"==typeof l)return -1===s||l-i<=s?(o=l-i,++n,i=0,o):(i+=s,s);if("string"==typeof l){if(-1===s||"i"===a||t.strPosToUni(l.slice(i))<=s)return o=l.slice(i),++n,i=0,o;{let e=i+t.uniToStrPos(l.slice(i),s);return o=l.slice(i,e),i=e,o}}if(-1===s||"d"===a||e.dlen(l.d)-i<=s)return o={d:u(l.d,i)},++n,i=0,o;{let e=u(l.d,i,i+s);return i+=s,{d:e}}},peek:()=>r[n]}},h=e=>(e.length>0&&"number"==typeof e[e.length-1]&&e.pop(),e);function d(n,i,s){let a;if("left"!==s&&"right"!==s)throw Error("side ("+s+") must be 'left' or 'right'");r(n),r(i);let u=[],d=o(u),{take:m,peek:g}=c(n);for(let r=0;r<i.length;r++){let n,a,o=i[r];switch(typeof o){case"number":for(n=o;n>0;)d(a=m(n,"i")),"string"!=typeof a&&(n-=l(a));break;case"string":"left"===s&&"string"==typeof g()&&d(m(-1)),d(t.strPosToUni(o));break;case"object":for(n=e.dlen(o.d);n>0;)switch(typeof(a=m(n,"i"))){case"number":n-=a;break;case"string":d(a);break;case"object":n-=e.dlen(a.d)}}}for(;a=m(-1);)d(a);return h(u)}function m(n,i){let s;r(n),r(i);let a=[],d=o(a),{take:m}=c(n);for(let r=0;r<i.length;r++){let n,s,a=i[r];switch(typeof a){case"number":for(n=a;n>0;)d(s=m(n,"d")),"object"!=typeof s&&(n-=l(s));break;case"string":d(a);break;case"object":n=e.dlen(a.d);let o=0;for(;o<n;)switch(typeof(s=m(n-o,"d"))){case"number":d({d:u(a.d,o,o+s)}),o+=s;break;case"string":o+=t.strPosToUni(s);break;case"object":d(s)}}}for(;s=m(-1);)d(s);return h(a)}let g=(r,n)=>{let i=0;for(let s=0;s<n.length&&r>i;s++){let a=n[s];switch(typeof a){case"number":i+=a;break;case"string":let o=t.strPosToUni(a);i+=o,r+=o;break;case"object":r-=Math.min(e.dlen(a.d),r-i)}}return r},f=(e,t)=>"number"==typeof e?g(e,t):e.map(e=>g(e,t));function p(e,t,r){return i(e,(e,n)=>"object"==typeof e&&"number"==typeof e.d?{d:r.slice(t,n,n+e.d)}:e)}function C(e){return i(e,e=>{switch(typeof e){case"object":if("number"==typeof e.d)throw Error("Cannot invert text op: Deleted characters missing from operation. makeInvertible must be called first.");return e.d;case"string":return{d:e};case"number":return e}})}function _(e){return i(e,e=>"object"==typeof e&&"string"==typeof e.d?{d:t.strPosToUni(e.d)}:e)}function y(e){let t=!0;return n(e,e=>{"object"==typeof e&&"number"==typeof e.d&&(t=!1)}),t}e.default=function(t){return{name:"text-unicode",uri:"http://sharejs.org/types/text-unicode",trim:h,normalize:a,checkOp:r,create(e=""){if("string"!=typeof e)throw Error("Initial data must be a string");return t.create(e)},apply(n,i){r(i);let s=t.builder(n);for(let t=0;t<i.length;t++){let r=i[t];switch(typeof r){case"number":s.skip(r);break;case"string":s.append(r);break;case"object":s.del(e.dlen(r.d))}}return s.build()},transform:d,compose:m,transformPosition:g,transformSelection:f,isInvertible:y,makeInvertible:(e,r)=>p(e,r,t),stripInvertible:_,invert:C,invertWithDoc:(e,r)=>C(p(e,r,t)),isNoop:e=>0===e.length}}}(u_)),u_}var uE,uR={},ub=(e6||(e6=1,eJ=ui&&ui.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),e0=ui&&ui.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||eJ(t,e,r)},Object.defineProperty(ui,"__esModule",{value:!0}),e0((e4||(e4=1,function(e){var t=us&&us.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.editOp=e.replaceOp=e.insertOp=e.moveOp=e.removeOp=e.type=void 0;let r=t(ut?ua:(ut=1,Object.defineProperty(ua,"__esModule",{value:!0}),ua.default=function e(t,r){return t===r||null!==t&&null!==r&&"object"==typeof t&&"object"==typeof r&&(Array.isArray(t)?function(t,r){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],r[n]))return!1;return!0}(t,r):function(t,r){if(Array.isArray(r))return!1;for(let n in t)if(!e(t[n],r[n]))return!1;for(let e in r)if(void 0===t[e])return!1;return!0}(t,r))},ua)),n=t((ur||(ur=1,Object.defineProperty(uo,"__esModule",{value:!0}),uo.default=function e(t){if(null===t)return null;if(Array.isArray(t))return t.map(e);if("object"!=typeof t)return t;{let r={};for(let n in t)r[n]=e(t[n]);return r}}),uo)),i=uu(),s=ud();function a(e,t){if(!e)throw Error(t)}e.type={name:"json1",uri:"http://sharejs.org/types/JSONv1",readCursor:i.readCursor,writeCursor:i.writeCursor,create:e=>e,isNoop:e=>null==e,setDebug(e){},registerSubtype:C,checkValidOp:S,normalize:A,apply:function(e,t){if(S(t),null===t)return e;let r=[];return function e(t,n){let i=t,s=0,o={root:t},l=0,c=o,h="root";function d(){for(;l<s;l++){let e=n[l];"object"!=typeof e&&(a(g(c,h)),c=c[h]=u(c[h]),h=e)}}for(;s<n.length;s++){let t=n[s];if(Array.isArray(t)){let r=e(i,t);r!==i&&void 0!==r&&(d(),i=c[h]=r)}else if("object"==typeof t){null!=t.d?(d(),i=m(c,h,r[t.d])):void 0!==t.i&&(d(),i=m(c,h,t.i));let e=E(t);if(e)d(),i=c[h]=e.apply(i,R(t));else if(void 0!==t.e)throw Error("Subtype "+t.et+" undefined")}else i=f(i,t)}return o.root}(e=function e(t,n){var i,s;let o=[],l=0;for(;l<n.length;l++){let e=n[l];if(Array.isArray(e))break;"object"!=typeof e&&(o.push(t),t=f(t,e))}for(let r=n.length-1;r>=l;r--)t=e(t,n[r]);for(--l;l>=0;l--){let e=n[l];if("object"!=typeof e){let r=o.pop();t=t===f(r,e)?r:void 0===t?d(r,e):(s=t,(i=u(i=r))[e]=s,i)}else c(e)&&(a(void 0!==t,"Cannot pick up or remove undefined"),null!=e.p&&(r[e.p]=t),t=void 0)}return t}(e,t),t)},transformPosition:function(e,t){e=e.slice(),S(t);let r=i.readCursor(t),n,s,a=!1,l=[];for(let t=0;;t++){let o=e[t],u=r.getComponent();if(u&&(void 0!==u.r?a=!0:null!=u.p&&(a=!1,n=u.p,s=t)),t>=e.length)break;let h=0,d=i.advancer(r,void 0,(e,t)=>{c(t)&&h++});l.unshift(d);let m=d(o);if("number"==typeof o&&(e[t]-=h),!m)break}if(l.forEach(e=>e.end()),a)return null;let u=()=>{let t=0;if(null!=n){let n=r.getPath();t=n.length,e=n.concat(e.slice(s))}for(;t<e.length;t++){let n=e[t],s=o(r),a=E(s);if(a){let r=R(s);a.transformPosition&&(e[t]=a.transformPosition(e[t],r));break}let l=0,u=i.advancer(r,(e,t)=>h(t)?~(e-l):e-l,(e,t)=>{h(t)&&l++})(n);if("number"==typeof n&&(e[t]+=l),!u)break}};return null!=n?r.eachDrop(null,e=>{e===n&&u()}):u(),e},compose:v,tryTransform:x,transform:function(e,t,r){let n=x(e,t,r);if(n.ok)return n.result;U(n.conflict)},makeInvertible:M,invert:T,invertWithDoc:function(e,t){return T(M(e,t))},RM_UNEXPECTED_CONTENT:s.ConflictType.RM_UNEXPECTED_CONTENT,DROP_COLLISION:s.ConflictType.DROP_COLLISION,BLACKHOLE:s.ConflictType.BLACKHOLE,transformNoConflict:(e,t,r)=>L(()=>!0,e,t,r),typeAllowingConflictsPred:t=>Object.assign(Object.assign({},e.type),{transform:(e,r,n)=>L(t,e,r,n)})};let o=e=>e?e.getComponent():null;function l(e){return e&&"object"==typeof e&&!Array.isArray(e)}let u=e=>Array.isArray(e)?e.slice():null!==e&&"object"==typeof e?Object.assign({},e):e,c=e=>e&&(null!=e.p||void 0!==e.r),h=e=>e&&(null!=e.d||void 0!==e.i);function d(e,t){return a(null!=e),"number"==typeof t?(a(Array.isArray(e),"Invalid key - child is not an array"),(e=e.slice()).splice(t,1)):(a(l(e),"Invalid key - child is not an object"),delete(e=Object.assign({},e))[t]),e}function m(e,t,r){return"number"==typeof t?(a(null!=e,"Container is missing for key"),a(Array.isArray(e),"Cannot use numerical key for object container"),a(e.length>=t,"Cannot insert into out of bounds index"),e.splice(t,0,r)):(a(l(e),"Cannot insert into missing item"),a(void 0===e[t],"Trying to overwrite value at key. Your op needs to remove it first"),e[t]=r),r}e.removeOp=(e,t=!0)=>i.writeCursor().writeAtPath(e,"r",t).get(),e.moveOp=(e,t)=>i.writeCursor().writeMove(e,t).get(),e.insertOp=(e,t)=>i.writeCursor().writeAtPath(e,"i",t).get(),e.replaceOp=(e,t,r)=>i.writeCursor().at(e,e=>{e.write("r",t),e.write("i",r)}).get(),e.editOp=(e,t,r,n=!1)=>i.writeCursor().at(e,e=>b(e,t,r,n)).get();let g=(e,t)=>null!=e&&("number"==typeof t?Array.isArray(e):"object"==typeof e),f=(e,t)=>g(e,t)?e[t]:void 0,p={};function C(e){let t=e.type?e.type:e;t.name&&(p[t.name]=t),t.uri&&(p[t.uri]=t)}let _=e=>{let t=p[e];if(t)return t;throw Error("Missing type: "+e)};C((e3||(e3=1,function(e){var t=ug&&ug.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),r=ug&&ug.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),n=ug&&ug.__importStar||function(e){if(e&&e.__esModule)return e;var n={};if(null!=e)for(var i in e)Object.hasOwnProperty.call(e,i)&&t(n,e,i);return r(n,e),n},i=ug&&ug.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(e,"__esModule",{value:!0}),e.type=e.remove=e.insert=void 0;let s=up(),a=n(uy()),o=i(function(){if(uE)return uR;uE=1,Object.defineProperty(uR,"__esModule",{value:!0});let e=uy(),t=up();function r(r,n){return{get:r,getLength:()=>r().length,insert:(e,i,s)=>n([t.strPosToUni(r(),e),i],s),remove:(e,i,s)=>n([t.strPosToUni(r(),e),{d:i}],s),_onOp(t){e.eachOp(t,(t,r,n)=>{switch(typeof t){case"string":this.onInsert&&this.onInsert(n,t);break;case"object":let i=e.dlen(t.d);this.onRemove&&this.onRemove(n,i)}})},onInsert:null,onRemove:null}}return uR.default=r,r.provides={text:!0},uR}()),l={create:e=>e,toString:e=>e,builder(e){if("string"!=typeof e)throw Error("Invalid document snapshot: "+e);let t=[];return{skip(r){let n=s.uniToStrPos(e,r);if(n>e.length)throw Error("The op is too long for this document");t.push(e.slice(0,n)),e=e.slice(n)},append(e){t.push(e)},del(t){e=e.slice(s.uniToStrPos(e,t))},build:()=>t.join("")+e}},slice:a.uniSlice};e.type=Object.assign(Object.assign({},a.default(l)),{api:o.default}),e.insert=(e,t)=>0===t.length?[]:0===e?[t]:[e,t],e.remove=(e,t)=>0===a.dlen(t)?[]:0===e?[{d:t}]:[e,{d:t}];var u=uy();Object.defineProperty(e,"makeType",{enumerable:!0,get:function(){return u.default}})}(ug)),ug));let y=(e,t)=>e+t;C({name:"number",apply:y,compose:y,invert:e=>-e,transform:e=>e});let E=e=>null==e?null:e.et?_(e.et):e.es?p["text-unicode"]:null!=e.ena?p.number:null,R=e=>e.es?e.es:null!=e.ena?e.ena:e.e,b=(e,t,r,n=!1)=>{let[i,s]="string"==typeof t?[_(t),t]:[t,t.name];!n&&i.isNoop&&i.isNoop(r)||("number"===s?e.write("ena",r):"text-unicode"===s?e.write("es",r):(e.write("et",s),e.write("e",r)))};function I(e){a("number"==typeof e),a(e>=0),a(e===(0|e))}function N(e){"number"==typeof e?I(e):a("string"==typeof e)}function S(e){if(null===e)return;let t=new Set,r=new Set,n=e=>{let n=!0,i=!1;for(let s in e){let o=e[s];if(n=!1,a("p"===s||"r"===s||"d"===s||"i"===s||"e"===s||"es"===s||"ena"===s||"et"===s,"Invalid component item '"+s+"'"),"p"===s)I(o),a(!t.has(o)),t.add(o),a(void 0===e.r);else if("d"===s)I(o),a(!r.has(o)),r.add(o),a(void 0===e.i);else if("e"===s||"es"===s||"ena"===s){a(!i),i=!0;let t=E(e);a(t,"Missing type in edit"),t.checkValidOp&&t.checkValidOp(R(e))}}a(!n)},s=(e,t,r)=>{if(!Array.isArray(e))throw Error("Op must be null or a list");if(0===e.length)throw Error("Empty descent");t||N(e[0]);let o=1,l=0,u=0;for(let t=0;t<e.length;t++){let r=e[t];if(a(null!=r),Array.isArray(r)){let e=s(r,!1);if(l){let t=typeof u,r=typeof e;t===r?a(u<e,"descent keys are not in order"):a("number"===t&&"string"===r)}u=e,l++,o=3}else"object"==typeof r?(a(1===o,`Prev not scalar - instead ${o}`),n(r),o=2):(a(3!==o),N(r),a(i.isValidPathItem(r),"Invalid path key"),o=1)}return a(1!==l,"Operation makes multiple descents. Remove some []"),a(2===o||3===o),e[0]};s(e,!0),a(t.size===r.size,"Mismatched picks and drops in op");for(let e=0;e<t.size;e++)a(t.has(e)),a(r.has(e))}function A(e){let t=0,r=[],n=i.writeCursor();return n.mergeTree(e,(e,n)=>{var i;let s=E(e);if(s){let t=R(e);b(n,s,s.normalize?s.normalize(t):t)}for(let s of["r","p","i","d"])if(void 0!==e[s]){let a="p"===s||"d"===s?(null==r[i=e[s]]&&(r[i]=t++),r[i]):e[s];n.write(s,a)}}),n.get()}function v(e,t){if(S(e),S(t),null==e)return t;if(null==t)return e;let r=0,n=i.readCursor(e),s=i.readCursor(t),l=i.writeCursor(),u=[],d=[],m=[],g=[],f=[],p=[],C=new Set;n.traverse(null,e=>{null!=e.p&&(m[e.p]=n.clone())}),s.traverse(null,e=>{null!=e.d&&(g[e.d]=s.clone())});let _=i.writeCursor();return function e(t,n,s,l,_,y,I,N){let S;a(n||s);let A=o(n),v=o(s),T=!!v&&void 0!==v.r,w=!!A&&void 0!==A.i,M=A?A.d:null,O=v?v.p:null,x=(y||T)&&null==O;if(null!=O)l=g[O],I=d[O]=new i.WriteCursor;else if(v&&void 0!==v.r)l=null;else{let e=o(l);e&&null!=e.d&&(l=null)}let U=o(l);if(null!=M)if(t=m[M],N=u[M]=new i.WriteCursor,x)y&&!T&&N.write("r",!0);else{let e=f[M]=r++;I.write("d",e)}else if(A&&void 0!==A.i)t=null;else{let e=o(t);e&&null!=e.p&&(t=null)}w?(a(void 0===_),S=A.i):S=_;let D=(null==O?!w||y||T:void 0===S)?null:I.getComponent();if(null!=O){if(!(void 0!==_||w)){let e=null!=M?f[M]:r++;p[O]=e,N.write("p",e)}}else T&&(w||void 0!==_||(v.r,N.write("r",v.r)));let V=x?null:E(A),L=E(U);if((V||L)&&(V&&V.name,L&&L.name),V&&L){a(V===L);let e=R(A),t=R(U),r=V.compose(e,t);b(I,V,r),C.add(U)}else V?b(I,V,R(A)):L&&(b(I,L,R(U)),C.add(U));let P="object"==typeof S&&null!=S,F=!1,k=0,j=0,B=0,$=0,H=0,W=i.advancer(l,(e,t)=>h(t)?$-e-1:e-$,(e,t)=>{h(t)&&$++}),G=i.advancer(t,(e,t)=>c(t)?k-e-1:e-k,(e,t)=>{c(t)&&k++});if(i.eachChildOf(n,s,(t,r,n)=>{var i,s;let l,u,d=t,m=t,g=t;if("number"==typeof t){let e=t+B;u=W(e),m=e+$;let i=t+j;l=G(i),h(o(u))&&(l=null),d=i+k,g=t+H,a(d>=0,"p1PickKey is negative"),a(m>=0,"p2DropKey is negative");let s=h(o(r)),f=c(o(n));(s||f&&!x)&&H--,s&&j--,f&&B--}else l=G(t),u=W(t);N.descend(d),I.descend(m);let f=P&&!h(o(r))?S[g]:void 0,p=e(l,r,n,u,f,x,I,N);P&&!x?f!==p&&(F||(S=Array.isArray(S)?S.slice():Object.assign({},S),F=!0),i=S,"number"==typeof(s=g)?(a(Array.isArray(i)),a(s<i.length)):(a(!Array.isArray(i)),a(void 0!==i[s])),void 0===p?"number"==typeof s?i.splice(s,1):delete i[s]:i[s]=p):a(void 0===p),I.ascend(),N.ascend()}),G.end(),W.end(),null!=D)D.i=S;else if(!y&&!T&&null==O)return S}(n,n.clone(),s,s.clone(),void 0,!1,l,_),l.reset(),l.mergeTree(_.get()),l.reset(),l.get(),u.map(e=>e.get()),d.map(e=>e.get()),n.traverse(l,(e,t)=>{let r=e.p;if(null!=r){let e=f[r];null!=e&&t.write("p",e);let n=u[r];n&&n.get(),n&&t.mergeTree(n.get())}else void 0!==e.r&&t.write("r",e.r)}),l.reset(),l.get(),s.traverse(l,(e,t)=>{let r=e.d;if(null!=r){let e=p[r];null!=e&&t.write("d",e);let n=d[r];n&&t.mergeTree(n.get())}else void 0!==e.i&&t.write("i",e.i);let n=E(e);n&&!C.has(e)&&b(t,n,R(e))}),l.get()}function T(e){let t;if(null==e)return null;let r=new i.ReadCursor(e),n=new i.WriteCursor,s=[],a=[];return function e(r,n,i){let a=r.getComponent(),o,l=!1;if(a){null!=a.p&&(n.write("d",a.p),s[a.p]=r.clone()),void 0!==a.r&&n.write("i",a.r),null!=a.d&&(n.write("p",a.d),i=void 0),void 0!==a.i&&(i=o=a.i);let e=E(a);e&&(void 0===i?(t||(t=new Set),t.add(a)):(R(a),i=e.apply(i,R(a)),l=!0))}let c=0;for(let t of r){n.descend(t);let s="number"==typeof t?t-c:t,a=f(i,s);h(r.getComponent())&&c++;let o=e(r,n,a);if(void 0!==i&&void 0!==o){if(l||(l=!0,i=u(i)),!g(i,s))throw Error("Cannot modify child - invalid operation");i[s]=o}n.ascend()}if(void 0===o)return l?i:void 0;n.write("r",i)}(r,n,void 0),t&&(n.reset(),function e(r,n,o){let l=n.getComponent();if(l){let e=l.d;if(null!=e&&(r=s[e],o=a[e]=i.writeCursor()),t.has(l)){let e=E(l);if(!e.invert)throw Error(`Cannot invert subtype ${e.name}`);b(o,e,e.invert(R(l)))}}let u=0,d=0,m=i.advancer(r,(e,t)=>c(t)?u-e-1:e-u,(e,t)=>{c(t)&&u++});for(let t of n)if("number"==typeof t){let r=t-d,i=m(r),s=r+u;o.descend(s),e(i,n,o),h(n.getComponent())&&d++,o.ascend()}else o.descend(t),e(m(t),n,o),o.ascend();m.end()}(r.clone(),r,n),a.length&&(n.reset(),r.traverse(n,(e,t)=>{let r=e.p;if(null!=r){let e=a[r];e&&e.get(),e&&t.mergeTree(e.get())}}))),n.get()}let w=(e,t)=>e.some(e=>"object"==typeof e&&(Array.isArray(e)?w(e,t):t(e)));function M(e,t){if(null==e||!w(e,e=>{var t;return void 0!==e.r||(null==(t=E(e))?void 0:t.makeInvertible)!=null}))return e;let r=new i.ReadCursor(e),s=new i.WriteCursor,o=!1,l=[],m=[],g=(e,t,r)=>{let i=e.getComponent(),s=!1;if(i){null!=i.d&&t.write("d",i.d),void 0!==i.i&&t.write("i",i.i);let n=i.p;if(null!=n&&(l[n]=e.clone(),a(void 0!==r,"Operation picks up at an invalid key"),m[n]=r,t.write("p",i.p)),void 0!==i.r&&void 0===r)throw Error("Invalid doc / op in makeInvertible: removed item missing from doc");let s=E(i);s&&(s.makeInvertible?o=!0:b(t,s,R(i),!0))}let c=0;for(let n of e){t.descend(n);let i="number"==typeof n?n-c:n,a=f(r,i),o=g(e,t,a);a!==o&&(s||(s=!0,r=u(r)),void 0===o?(r=d(r,i),"number"==typeof n&&c++):r[i]=o),t.ascend()}return i&&(void 0!==i.r?(t.write("r",n.default(r)),r=void 0):null!=i.p&&(r=void 0)),r};return g(r,s,t),s.get(),o&&(s.reset(),function e(t,r,n,s,a){let o=r.getComponent();if(o){void 0!==o.i?(s=o.i,a=!0):null!=o.d&&(s=m[o.d],t=l[o.d],a=!1,o.d);let e=E(o);if(e&&e.makeInvertible){let t=R(o);b(n,e,e.makeInvertible(t,s),!0)}}let u=0,d=0,g=i.advancer(t,(e,t)=>c(t)?u-e-1:e-u,(e,t)=>{c(t)&&u++});for(let t of r)if("number"==typeof t){let i=t-d,o=g(i),l=i+u,c=f(s,a?i:l);n.descend(t),e(o,r,n,c,a),h(r.getComponent())&&d++,n.ascend()}else{let i=f(s,t);n.descend(t),e(g(t),r,n,i,a),n.ascend()}g.end()}(r.clone(),r,s,t,!1)),s.get()}let O=e=>{if(null==e)return null;let t=e.slice();for(let r=0;r<e.length;r++){let e=t[r];Array.isArray(e)&&(t[r]=O(e))}return t};function x(t,l,u){a("left"===u||"right"===u,"Direction must be left or right");let d=+("left"!==u);if(null==l)return{ok:!0,result:t};S(t),S(l);let m=null,g=[],f=[],p=[],C=[],_=[],y=[],I=[],N=[],A=[],v=[],T=[],w=[],M=[],x=[],U=[],D=0,V=i.readCursor(t),L=i.readCursor(l),P=i.writeCursor();if(function e(t,r=null,n){let s,a=o(r);a&&(void 0!==a.r?n=r.clone():null!=a.p&&(n=null,y[a.p]=t.clone()));let l=t.getComponent();l&&null!=(s=l.p)&&(_[s]=r?r.clone():null,p[s]=t.clone(),n&&(v[s]=!0,A[s]=n),a&&null!=a.p&&(x[s]=a.p));let u=i.advancer(r);for(let r of t)e(t,u(r),n);u.end()}(L,V,null),function t(r,n,a,l,u){let h=a.getComponent(),g,f=!1;h&&(null!=(g=h.d)?(C[g]=a.clone(),null!=l&&(null==U[l]&&(U[l]=[]),U[l].push(g)),v[g],r=_[g]||null,n=p[g]||null,v[g]?(u&&(T[g]=!0),u=A[g]||null):u&&(1===d||null==x[g])&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.moveOp(n.getPath(),a.getPath())}),f=!0):void 0!==h.i&&(r=n=null,f=!0,u&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.insertOp(a.getPath(),h.i)})));let y=o(r);y&&(void 0!==y.r?u=r.clone():null!=y.p&&(y.p,l=y.p,u=null));let b=E(h);b&&u&&null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.removeOp(u.getPath()),op2:e.editOp(a.getPath(),b,R(h),!0)});let I=0,N=0,S=i.advancer(n,(e,t)=>c(t)?I-e-1:e-I,(e,t)=>{c(t)&&I++}),w=i.advancer(r);for(let e of a)if("number"==typeof e){let r=e-N,n=S(r);N+=+t(w(r+I),n,a,l,u)}else{let r=S(e);t(w(e),r,a,l,u)}return S.end(),w.end(),f}(V,L,L.clone(),null,null),C.map(e=>e&&e.get()),m)return{ok:!1,conflict:m};T.map(e=>!!e);let F=[],k=null;(function e(t,r,n,s,l){let u=!1,m=o(r);if(c(m)){let e=m.p;null!=e?(n=C[e],s=w[e]=i.writeCursor(),u=!0,l=null):(n=null,l=r.clone())}else h(o(n))&&(n=null);let f=t.getComponent();if(f){let e=f.p;null!=e?(l&&(N[e]=l),F[e]=l||1===d&&u?null:s.getComponent(),g[e]=t.clone(),n&&(I[e]=n.clone())):void 0!==f.r&&(l||s.write("r",!0),(l||u)&&(null==k&&(k=new Set),k.add(f)))}let p=0,_=0,y=i.advancer(r,void 0,(e,t)=>{c(t)&&p++}),E=i.advancer(n,(e,t)=>h(t)?~(e-_):e-_,(e,t)=>{h(t)&&_++});if(t)for(let r of t)if("string"==typeof r){let n=y(r),i=E(r);s.descend(r),e(t,n,i,s,l),s.ascend()}else{let n=y(r),i=r-p,u=c(o(n))?null:E(i),h=i+_;a(h>=0),s.descend(h),e(t,n,u,s,l),s.ascend()}y.end(),E.end()})(V,L,L.clone(),P,null),P.reset();let j=[];if(function t(l,_,S,A,T,w){a(_);let O=_.getComponent(),U=o(A),V=!1,L=(t,r,n)=>t?e.moveOp(t.getPath(),r.getPath()):e.insertOp(r.getPath(),n.i);if(h(O)){let t=O.d;null!=t&&(f[t]=_.clone());let i=null!=t?F[t]:null,a=!1;if(void 0!==O.i||null!=t&&i){let o;U&&(void 0!==U.i||null!=(o=U.d)&&!v[o])&&((a=null!=o?null!=t&&t===x[o]:r.default(U.i,O.i))||null!=o&&1!==d&&null!=x[o]||null==m&&(m={type:s.ConflictType.DROP_COLLISION,op1:L(null!=t?g[t]:null,_,O),op2:L(null!=o?p[o]:null,A,U)})),a||(w?null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:L(null!=t?g[t]:null,_,O),op2:e.removeOp(w.getPath())}):(null!=t?(j[D]=t,T.write("d",i.p=D++)):T.write("i",n.default(O.i)),V=!0))}else if(null!=t&&!i){let e=N[t];e&&(w=e.clone())}null!=t?(l=g[t],S=y[t],A=I[t]):void 0!==O.i&&(l=S=null,a||(A=null))}else c(o(l))&&(l=S=A=null);let P=o(l),B=o(S);if(c(B)){let e=B.p;void 0!==B.r&&(!P||void 0===P.r)||v[e]?(A=null,w=S.clone()):null!=e&&(A=C[e],1!==d&&null!=x[e]||((T=M[e])||(T=M[e]=i.writeCursor()),T.reset(),w=null))}else!h(O)&&h(U)&&(A=null);U=null!=A?A.getComponent():null;let $=E(O);if($){let t=R(O);if(w)null==m&&(m={type:s.ConflictType.RM_UNEXPECTED_CONTENT,op1:e.editOp(_.getPath(),$,t,!0),op2:e.removeOp(w.getPath())});else{let e,r=E(U);if(r){if($!==r)throw Error("Transforming incompatible types");let n=R(U);e=$.transform(t,n,u)}else e=n.default(t);b(T,$,e)}}let H=0,W=0,G=0,Y=0,z=0,X=0,q=null!=l&&l.descendFirst(),K=q,Q=i.advancer(S,void 0,(e,t)=>{c(t)&&G++}),Z=null!=A&&A.descendFirst(),J=Z;for(let e of _)if("number"==typeof e){let r,n=h(_.getComponent()),i=e-W;{let e;for(;q&&"number"==typeof(e=l.getKey());){e+=H;let t=l.getComponent(),r=c(t);if(e>i||e===i&&(!r||0===d&&n))break;if(r){H--;let e=t.p;x.includes(e),t.d,o(M[t.d]),c(o(M[t.d])),(void 0===t.r||k&&k.has(t))&&(null==e||!F[e]||1!==d&&x.includes(e))||z--}q=l.nextSibling()}r=q&&e===i?l:null}let s=i-H,u=Q(s),m=s-G,g=null;{let e,t;for(;Z&&"number"==typeof(e=A.getKey());){t=e-Y;let r=A.getComponent(),i=h(r);if(t>m)break;if(t===m){if(!i){g=A;break}{if(0===d&&n){g=A;break}let e=u&&c(u.getComponent());if(0===d&&e)break}}if(i){let e=r.d;v[e],x[e],void 0===r.i&&(v[e]||null!=x[e]&&1!==d)?(v[e]||null!=x[e]&&0===d)&&(Y++,X--):Y++}Z=A.nextSibling()}}let f=m+Y+z+X;a(f>=0,"trying to descend to a negative index"),T.descend(f),n&&(r=u=g=null,W++),t(r,_,u,g,T,w)&&X++,T.ascend()}else{let r,n;for(;q&&("string"!=typeof(r=l.getKey())||!(r>e||r===e));)q=l.nextSibling();let i=q&&r===e?l:null,s=Q(e);for(;Z&&("string"!=typeof(n=A.getKey())||!(n>e||n===e));)Z=A.nextSibling();let a=Z&&n===e?A:null;T.descend(e),t(i,_,s,a,T,w),T.ascend()}return Q.end(),K&&l.ascend(),J&&A.ascend(),V}(V,V.clone(),L,L.clone(),P,null),m)return{ok:!1,conflict:m};P.reset();let B=(e,t,r)=>e.traverse(t,(t,n)=>{null!=t.d&&r(t.d,e,n)});(v.length||w.length)&&(B(L,P,(e,t,r)=>{v[e]&&!T[e]&&r.write("r",!0),w[e]&&r.mergeTree(w[e].get())}),P.reset());let $=[],H=[];if((M.length||v.length)&&!m){let e=i.readCursor(O(P.get()));if(B(e,null,(e,t)=>{$[e]=t.clone()}),M.forEach(e=>{e&&B(i.readCursor(e.get()),null,(e,t)=>{$[e]=t.clone()})}),function e(t,r,n,s,a,l){let u=o(r);if(u&&c(u))if(null!=u.p){let e=u.p;$[e].getPath(),n=$[e],s=H[e]=i.writeCursor()}else void 0!==u.r&&(n=null);else h(o(n))&&(n=null);let d=t.getComponent();if(d){let e;if(null!=(e=d.d)){let t=M[e];t&&(t.get(),s.mergeTree(t.get()),n=i.readCursor(t.get()))}}let m=0,g=0,f=i.advancer(r,void 0,(e,t)=>{c(t)&&m--}),p=i.advancer(n,(e,t)=>h(t)?-(e-g)-1:e-g,(e,t)=>{h(t)&&g++});for(let r of t)if("number"==typeof r){let n=f(r),i=r+m,a=p(i),o=i+g;s.descend(o),e(t,n,a,s),s.ascend()}else s.descend(r),e(t,f(r),p(r),s),s.ascend();f.end(),p.end()}(L,e,e.clone(),P),P.reset(),m)return{ok:!1,conflict:m};if(P.get(),H.length){let e=H.map(e=>e?e.get():null);if(B(i.readCursor(O(P.get())),P,(t,r,n)=>{let i=e[t];i&&(n.mergeTree(i),e[t]=null)}),e.find(e=>e)){let t=i.writeCursor(),r=i.writeCursor(),n=0,a=0;e.forEach(e=>{null!=e&&B(i.readCursor(e),null,e=>{let i=j[e];t.writeMove(g[i].getPath(),f[i].getPath(),n++);let s=U[i];s&&s.forEach(e=>{v[e]||1!==d&&null!=x[e]||r.writeMove(p[e].getPath(),C[e].getPath(),a++)})})}),m={type:s.ConflictType.BLACKHOLE,op1:t.get(),op2:r.get()}}}}return m?{ok:!1,conflict:m}:{ok:!0,result:P.get()}}let U=e=>{let t=Error("Transform detected write conflict");throw t.conflict=e,t.type=t.name="writeConflict",t},D=e=>{let t=i.writeCursor();return i.readCursor(e).traverse(t,(e,t)=>{(h(e)||E(e))&&t.write("r",!0)}),t.get()},V=(e,t)=>{let{type:r,op1:n,op2:a}=e;switch(r){case s.ConflictType.DROP_COLLISION:return"left"===t?[null,D(a)]:[D(n),null];case s.ConflictType.RM_UNEXPECTED_CONTENT:let o=!1;return i.readCursor(n).traverse(null,e=>{void 0!==e.r&&(o=!0)}),o?[null,D(a)]:[D(n),null];case s.ConflictType.BLACKHOLE:return[D(n),D(a)];default:throw Error("Unrecognised conflict: "+r)}};function L(e,t,r,n){let i=null;for(;;){let s=x(t,r,n);if(s.ok)return v(i,s.result);{let{conflict:a}=s;e(a)||U(a);let[o,l]=V(a,n);t=v(A(t),o),r=v(A(r),l),i=v(i,l)}}}}(us)),us),ui),e1=uu(),Object.defineProperty(ui,"ReadCursor",{enumerable:!0,get:function(){return e1.ReadCursor}}),Object.defineProperty(ui,"WriteCursor",{enumerable:!0,get:function(){return e1.WriteCursor}}),e2=ud(),Object.defineProperty(ui,"ConflictType",{enumerable:!0,get:function(){return e2.ConflictType}})),ui);let uI=function(e,t){for(var r=0;r<t.length;r++){let n=t[r];if("string"!=typeof n&&!Array.isArray(n)){for(let t in n)if("default"!==t&&!(t in e)){let r=Object.getOwnPropertyDescriptor(n,t);r&&Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:()=>n[t]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}({__proto__:null,default:nK(ub)},[ub]);var uN=((eL=uN||{}).RETAIN="r",eL.INSERT="i",eL.DELETE="d",eL);function uS(e,t=!1){let r=[];for(let n of e){let{st:e,ed:i,ts:s}=n;if(void 0===n.sId&&delete n.sId,e===i||!t&&rq.isEmptyObject(s)&&null==n.sId)continue;if(0===r.length){r.push(n);continue}let a=r.pop();nX(n,a)&&rq.hasIntersectionBetweenTwoRanges(a.st,a.ed,n.st,n.ed)?r.push({...n,st:a.st,ed:i}):r.push(a,n)}return r}function uA(e,t,r,n){var i;let{textRuns:s}=e;if(null==s)return;let a=[],o=s.length,l=!1,u=null!=(i=t.textRuns)?i:[];if(u.length)for(let e of u)e.st+=n,e.ed+=n;for(let e=0;e<o;e++){let t=s[e],{st:i,ed:o}=t;if(o<=n)a.push(t);else if(n>i&&n<o){l=!0;let e={...t,ed:n};a.push(e),u.length&&a.push(...u);let i={...t,st:n+r,ed:o+r};a.push(i)}else t.st+=r,t.ed+=r,l||(l=!0,a.push(...u)),a.push(t)}l||(l=!0,a.push(...u)),e.textRuns=uS(a)}function uv(e,t,r,n){let{paragraphs:i}=e;if(null==i)return;let{paragraphs:s}=t,a=[];for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r),a.push(t.startIndex)}let o=-1;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n;let r=t.startIndex;o=a.indexOf(r)}-1!==o&&i.splice(o,1),i.push(...s),i.sort(aK("startIndex"))}}function uT(e,t,r,n){let{sectionBreaks:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.sectionBreaks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(aK("startIndex"))}}function uw(e,t,r,n){let{customBlocks:i=[]}=e;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r)}let s=t.customBlocks;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n}i.push(...s),i.sort(aK("startIndex"))}i.length&&!e.customBlocks&&(e.customBlocks=i)}function uM(e,t,r,n){let{tables:i}=e;if(null==i)return;for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s,endIndex:a}=t;s>n?(t.startIndex+=r,t.endIndex+=r):a>n&&(t.endIndex+=r)}let s=t.tables;if(s){for(let e=0,t=s.length;e<t;e++){let t=s[e];t.startIndex+=n,t.endIndex+=n}i.push(...s),i.sort(aK("startIndex"))}}let uO=e=>e.split("$")[0];function ux(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};r.rangeId=uO(r.rangeId);for(let n=1;n<e.length;n++){let i=e[n];i.rangeId=uO(i.rangeId),i.rangeId===r.rangeId&&lH(r.properties,i.properties)&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}t.push(r);let n=Object.create(null);for(let e=0,r=t.length;e<r;e++){let r=t[e],i=r.rangeId;n[i]?(r.rangeId=`${i}$${n[i]}`,n[i]=n[i]+1):n[i]=1}return t}function uU(e,t){let r=e.findIndex(e=>e.startIndex<t&&e.endIndex>=t),n=e[r];n&&e.splice(r,1,{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:n.startIndex,endIndex:t-1,properties:{...n.properties}},{rangeId:n.rangeId,rangeType:n.rangeType,startIndex:t,endIndex:n.endIndex,properties:{...n.properties}})}function uD(e){if(e.length<=1)return e;e.sort((e,t)=>e.startIndex-t.startIndex);let t=[],r={...e[0]};for(let n=1;n<e.length;n++){let i=e[n];i.id===r.id&&r.endIndex+1>=i.startIndex?r.endIndex=i.endIndex:(t.push(r),r={...i})}return t.push(r),t}function uV(e,t){e.filter(e=>e.startIndex<t&&e.endIndex>=t).forEach(r=>{let n=e.indexOf(r);e.splice(n,1,{id:r.id,type:r.type,startIndex:r.startIndex,endIndex:t-1},{id:r.id,type:r.type,startIndex:t,endIndex:r.endIndex})})}function uL(e,t,r){let{textRuns:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{st:l,ed:u}=o;if(r<=l&&i>=u){s.push({...o,st:l-r,ed:u-r});continue}l<=r&&u>=i?(s.push({...o,st:r-r,ed:i-r}),o.ed-=t):r>=l&&r<u?(s.push({...o,st:r-r,ed:u-r}),o.ed=r):i>l&&i<=u?(s.push({...o,st:l-r,ed:i-r}),o.st=i-t,o.ed-=t):l>=i&&(o.st-=t,o.ed-=t),a.push(o)}e.textRuns=a}return 0===s.length&&s.push({st:0,ed:t,ts:{}}),s}function uP(e,t,r){let{paragraphs:n}=e,i=r+t,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<i){s.push({...o,startIndex:l-r});continue}l>=i&&(o.startIndex-=t),a.push(o)}e.paragraphs=a}return s}function uF(e,t,r){let{sectionBreaks:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.sectionBreaks=a}return s}function uk(e,t,r){let{customBlocks:n=[]}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l}=o;if(l>=r&&l<=i){s.push({...o,startIndex:l-r});continue}l>i&&(o.startIndex-=t),a.push(o)}e.customBlocks=a}return n.length&&!e.customBlocks&&(e.customBlocks=n),s}function uj(e,t,r){let{tables:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(r<=l&&i>=u){s.push({...o,startIndex:l-r,endIndex:u-r});continue}if(l<=r&&u>=i){let e=i5(l,u,r,i);if(0===e.length||(o.startIndex=e[0],o.endIndex=e[1],o.startIndex===o.endIndex))continue}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.tables=a}return s}var uB=((eP=uB||{}).ORDER_LIST_QUICK_1="1.",eP.ORDER_LIST_QUICK_2="a)",eP.ORDER_LIST_QUICK_3="a.",eP.ORDER_LIST_QUICK_4="i.",eP.ORDER_LIST_QUICK_5="A.",eP.ORDER_LIST_QUICK_6="I.",eP.ORDER_LIST_QUICK_7="01.",eP.BULLET_LIST="*",eP),u$=((eF=u$||{}).BULLET_LIST="BULLET_LIST",eF.BULLET_LIST_1="BULLET_LIST_1",eF.BULLET_LIST_2="BULLET_LIST_2",eF.BULLET_LIST_3="BULLET_LIST_3",eF.BULLET_LIST_4="BULLET_LIST_4",eF.BULLET_LIST_5="BULLET_LIST_5",eF.ORDER_LIST="ORDER_LIST",eF.ORDER_LIST_1="ORDER_LIST_1",eF.ORDER_LIST_2="ORDER_LIST_2",eF.ORDER_LIST_3="ORDER_LIST_3",eF.ORDER_LIST_4="ORDER_LIST_4",eF.ORDER_LIST_5="ORDER_LIST_5",eF.ORDER_LIST_QUICK_2="ORDER_LIST_QUICK_2",eF.ORDER_LIST_QUICK_3="ORDER_LIST_QUICK_3",eF.ORDER_LIST_QUICK_4="ORDER_LIST_QUICK_4",eF.ORDER_LIST_QUICK_5="ORDER_LIST_QUICK_5",eF.ORDER_LIST_QUICK_6="ORDER_LIST_QUICK_6",eF.CHECK_LIST="CHECK_LIST",eF.CHECK_LIST_CHECKED="CHECK_LIST_CHECKED",eF);let uH={"a)":{glyphFormat:"%1)",glyphType:sM.DECIMAL},"1.":{glyphType:sM.DECIMAL},"a.":{glyphFormat:"%1.",glyphType:sM.LOWER_LETTER},"A.":{glyphType:sM.UPPER_LETTER},"i.":{glyphFormat:"%1.",glyphType:sM.LOWER_ROMAN},"I.":{glyphFormat:"%1.",glyphType:sM.UPPER_LETTER}},uW=e=>[...e,...e,...e].map((e,t)=>({glyphFormat:` %${t+1}`,glyphSymbol:e,bulletAlignment:sO.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),uG=e=>e.map((e,t)=>({...e,bulletAlignment:sO.START,textStyle:{fs:12},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*t}}})),uY=(e,t)=>Array(9).fill(0).map((r,n)=>({glyphFormat:` %${n+1}`,glyphSymbol:e,bulletAlignment:sO.START,textStyle:{fs:16},startNumber:0,paragraphProperties:{hanging:{v:21},indentStart:{v:21*n},textStyle:t}})),uz={BULLET_LIST:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},BULLET_LIST_1:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},BULLET_LIST_2:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},BULLET_LIST_3:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},BULLET_LIST_4:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},BULLET_LIST_5:{listType:"BULLET_LIST",nestingLevel:uW(["","",""])},ORDER_LIST:{listType:"ORDER_LIST",nestingLevel:uG([{glyphFormat:"%1.",glyphType:sM.DECIMAL},{glyphFormat:"%2.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%3.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:sM.DECIMAL},{glyphFormat:"%5.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%6.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:sM.DECIMAL},{glyphFormat:"%8.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%9.",glyphType:sM.LOWER_ROMAN}])},ORDER_LIST_1:{listType:"ORDER_LIST",nestingLevel:uG([{glyphFormat:"%1)",glyphType:sM.DECIMAL},{glyphFormat:"%2)",glyphType:sM.LOWER_LETTER},{glyphFormat:"%3)",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%4)",glyphType:sM.DECIMAL},{glyphFormat:"%5)",glyphType:sM.LOWER_LETTER},{glyphFormat:"%6)",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%7)",glyphType:sM.DECIMAL},{glyphFormat:"%8)",glyphType:sM.LOWER_LETTER},{glyphFormat:"%9)",glyphType:sM.LOWER_ROMAN}])},ORDER_LIST_2:{listType:"ORDER_LIST",nestingLevel:uG(["%1.","%1.%2.","%1.%2.%3.","%1.%2.%3.%4.","%1.%2.%3.%4.%5.","%1.%2.%3.%4.%5.%6.","%1.%2.%3.%4.%5.%6.%7."].map(e=>({glyphFormat:e,glyphType:sM.DECIMAL})))},ORDER_LIST_3:{listType:"ORDER_LIST",nestingLevel:uG([{glyphFormat:"%1.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%2.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%3.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%5.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%6.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%8.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%9.",glyphType:sM.LOWER_ROMAN}])},ORDER_LIST_4:{listType:"ORDER_LIST",nestingLevel:uG([{glyphFormat:"%1.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%2.",glyphType:sM.DECIMAL},{glyphFormat:"%3.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%5.",glyphType:sM.DECIMAL},{glyphFormat:"%6.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:sM.UPPER_LETTER},{glyphFormat:"%8.",glyphType:sM.DECIMAL},{glyphFormat:"%9.",glyphType:sM.LOWER_ROMAN}])},ORDER_LIST_5:{listType:"ORDER_LIST",nestingLevel:uG([{glyphFormat:"%1.",glyphType:sM.DECIMAL_ZERO},{glyphFormat:"%2.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%3.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%4.",glyphType:sM.DECIMAL_ZERO},{glyphFormat:"%5.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%6.",glyphType:sM.LOWER_ROMAN},{glyphFormat:"%7.",glyphType:sM.DECIMAL_ZERO},{glyphFormat:"%8.",glyphType:sM.LOWER_LETTER},{glyphFormat:"%9.",glyphType:sM.LOWER_ROMAN}])},CHECK_LIST:{listType:"CHECK_LIST",nestingLevel:uY("")},CHECK_LIST_CHECKED:{listType:"CHECK_LIST_CHECKED",nestingLevel:uY("",{st:{s:rD.TRUE}})}},uX=e=>{let{glyphFormat:t,glyphType:r}=e,n=rq.deepClone(uz.ORDER_LIST);return n.nestingLevel[0].glyphFormat=t,n.nestingLevel[0].glyphType=r,n};Object.assign(uz,{ORDER_LIST_QUICK_2:uX(uH["a)"]),ORDER_LIST_QUICK_3:uX(uH["a."]),ORDER_LIST_QUICK_4:uX(uH["i."]),ORDER_LIST_QUICK_6:uX(uH["I."])});let uq={"1.":"ORDER_LIST","a)":"ORDER_LIST_QUICK_2","a.":"ORDER_LIST_QUICK_3","i.":"ORDER_LIST_QUICK_4","A.":"ORDER_LIST_3","I.":"ORDER_LIST_QUICK_6","01.":"ORDER_LIST_5","*":"BULLET_LIST"};function uK(e,t,r){if(0===t.length)return e;e=rq.deepClone(e),t=rq.deepClone(t);let n=[],i=e.length,s=t.length,a=0,o=0,l=null;function u(){return!!l&&(n.push(l),l=null,!0)}for(;a<i&&o<s;){let i,{st:s,ed:c,ts:h}=e[a],{st:d,ed:m,ts:g,sId:f}=t[o];if(i=r===nR.COVER?{...g,...h}:{...h},c<d)u()||n.push(e[a]),a++;else if(m<s)u()||n.push(t[o]),o++;else{let r={st:Math.min(s,d),ed:Math.max(s,d),ts:s<d?{...h}:{...g},sId:s<d?void 0:f};r.ed>r.st&&n.push(r),n.push({st:Math.max(s,d),ed:Math.min(c,m),ts:i,sId:f}),c<m?(a++,t[o].st=c,t[o].st===t[o].ed&&o++):(o++,e[a].st=m,e[a].st===e[a].ed&&a++);let u={st:Math.min(c,m),ed:Math.max(c,m),ts:c<m?{...g}:{...h},sId:c<m?f:void 0};l=u.ed>u.st?u:null}}u();let c=n[n.length-1],h=e[i-1],d=t[s-1];return c&&c.ed!==Math.max(h.ed,d.ed)&&(h.ed>d.ed?n.push(h):n.push(d)),uS(n)}var uQ=((ek=uQ||{})[ek.copy=0]="copy",ek[ek.cut=1]="cut",ek);function uZ(e,t,r,n=!0){let{textRuns:i}=e;if(i){let e=[];for(let n of i){let i=rq.deepClone(n),{st:s,ed:a}=i;rq.hasIntersectionBetweenTwoRanges(s,a,t,r)&&(t>=s&&t<=a?e.push({...i,st:t,ed:Math.min(r,a)}):r>=s&&r<=a?e.push({...i,st:Math.max(t,s),ed:r}):e.push(i))}return uS(e.map(e=>{let{st:r,ed:n}=e;return{...e,st:r-t,ed:n-t}}))}if(n)return[{st:0,ed:r-t,ts:{}}]}function uJ(e,t,r){let{tables:n=[]}=e,i=[];for(let e of n){let n=rq.deepClone(e),{startIndex:s,endIndex:a}=n;s>=t&&a<=r&&i.push({...n,startIndex:s-t,endIndex:a-t})}return i}function u0(e,t,r){let{paragraphs:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;if(n>=t&&n<r){let t=rq.deepClone(e);i.push(t)}}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function u1(e,t,r){let{sectionBreaks:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;n>=t&&n<=r&&i.push(rq.deepClone(e))}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function u2(e,t,r){let{customBlocks:n=[]}=e,i=[];for(let e of n){let{startIndex:n}=e;n>=t&&n<r&&i.push(rq.deepClone(e))}if(i.length)return i.map(e=>({...e,startIndex:e.startIndex-t}))}function u5(e,t,r,n=!0,i=1){let{dataStream:s}=e,a={dataStream:s.slice(t,r)};a.textRuns=uZ(e,t,r,n);let o=uJ(e,t,r);if(o.length&&(a.tables=o),a.paragraphs=u0(e,t,r),1===i){let i=u6(e,t,r);i?a.customDecorations=i:n&&(a.customDecorations=[])}let{customRanges:l}=u4(e,t,r);return l?a.customRanges=l:n&&(a.customRanges=[]),a.customBlocks=u2(e,t,r),a}function u3(e){let{dataStream:t,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}=e,o=0,l=0;null==i||i.forEach(e=>{e.startIndex<0&&(o=Math.max(o,-e.startIndex)),e.endIndex>t.length-1&&(l=Math.max(l,e.endIndex-t.length+1))});let u=`${t}`;return r&&(r[0]&&(r[0].st=r[0].st-o),r[r.length-1]&&(r[r.length-1].ed=r[r.length-1].ed+l)),null==r||r.forEach(e=>{e.st+=o,e.ed+=o}),null==n||n.forEach(e=>{e.startIndex+=o}),null==i||i.forEach(e=>{e.startIndex+=o,e.endIndex+=o}),null==s||s.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),null==a||a.forEach(e=>{e.startIndex+=o,e.endIndex+=l}),{...e,dataStream:u,textRuns:r,paragraphs:n,customRanges:i,customDecorations:s,tables:a}}function u4(e,t,r){if(null==e.customRanges)return{};let{customRanges:n}=e;return{customRanges:n.filter(e=>Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)).map(e=>({...e,startIndex:Math.max(e.startIndex,t),endIndex:Math.min(e.endIndex,r-1)})).map(e=>({...e,startIndex:e.startIndex-t,endIndex:e.endIndex-t})),leftOffset:0,rightOffset:0}}function u6(e,t,r){if(null==e.customDecorations)return;let{customDecorations:n=[]}=e,i=[];return n.forEach(e=>{if(Math.max(e.startIndex,t)<=Math.min(e.endIndex,r-1)){let n=rq.deepClone(e);i.push({...n,startIndex:Math.max(n.startIndex-t,0),endIndex:Math.min(n.endIndex,r-1)-t})}}),i}function u9(e,t,r=nR.COVER){if(""!==t.dataStream)throw Error("Cannot compose other body with non-empty dataStream");let n={dataStream:e.dataStream},{textRuns:i,paragraphs:s=[],customRanges:a,customDecorations:o=[]}=e,{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h=[]}=t;n.textRuns=null==l||null==i?null!=l?l:i:uK(l,i,r),n.customRanges=function(e,t,r){if(null==e||null==t)return null!=e?e:t;if(0===t.length||0===e.length)return e;if(t.length>1||e.length>1)throw Error("Cannot cover multiple customRanges");return r===nR.REPLACE?[{...e[0]}]:[{...t[0],...e[0]}]}(c,a,r);let d=0===o.length||0===h.length||r===nR.REPLACE?h:[...h,...o.filter(e=>!h.some(t=>e.id===t.id))];d.length&&(n.customDecorations=d);let m=[],g=0,f=0;for(;g<s.length&&f<u.length;){let e=s[g],t=u[f],{startIndex:r}=e,{startIndex:n}=t;r===n?(m.push(rq.deepMerge(e,t)),g++,f++):r<n?(m.push(rq.deepClone(e)),g++):(m.push(rq.deepClone(t)),f++)}return g<s.length&&m.push(...s.slice(g)),f<u.length&&m.push(...u.slice(f)),m.length&&(n.paragraphs=m),n}class u8{constructor(e){tE(this,"_index",0),tE(this,"_offset",0),this._actions=e}hasNext(){return this.peekLength()<Number.POSITIVE_INFINITY}next(e){e||(e=Number.POSITIVE_INFINITY);let t=this._actions[this._index];if(!t)return{t:uN.RETAIN,len:Number.POSITIVE_INFINITY};{let r=this._offset,n=t.len;return e>=n-r?(e=n-r,this._index+=1,this._offset=0):this._offset+=e,t.t===uN.DELETE||t.t===uN.RETAIN&&null==t.body?rq.deepClone({...t,len:e}):rq.deepClone({...t,len:e,body:u5(t.body,r,r+e,!1)})}}peek(){return this._actions[this._index]}peekLength(){return this._actions[this._index]?this._actions[this._index].len-this._offset:Number.POSITIVE_INFINITY}peekType(){let e=this._actions[this._index];return e?e.t:uN.RETAIN}rest(){if(!this.hasNext())return[];if(0===this._offset)return this._actions.slice(this._index);{let e=this._offset,t=this._index,r=this.next(),n=this._actions.slice(this._index);return this._offset=e,this._index=t,[r].concat(n)}}}class u7{constructor(){tE(this,"cursor",0)}reset(){return this.cursor=0,this}moveCursor(e){this.cursor+=e}moveCursorTo(e){this.cursor=e}}function ce(e,t,r){let{dataStream:n}=e,i=r+t,s=uL(e,t,r),a=uP(e,t,r),o=uF(e,t,r),l=uk(e,t,r),u=uj(e,t,r),c=function(e,t,r){let{customRanges:n}=e,i=r+t-1,s=[];if(n){let a=[];for(let e=0,o=n.length;e<o;e++){let o=n[e],{startIndex:l,endIndex:u}=o;if(l>=r&&u<=i){s.push(o);continue}if(Math.max(r,l)<=Math.min(i,u)){let e=i5(l,u,r,i);if(0===e.length)continue;o.startIndex=e[0],o.endIndex=e[1]}else i<l&&(o.startIndex-=t,o.endIndex-=t);a.push(o)}e.customRanges=ux(a)}return s}(e,t,r),h=function(e,t,r,n=!0){let{customDecorations:i}=e,s=r+t-1,a=[];if(i){let o=[];for(let e=0,l=i.length;e<l;e++){let l=i[e],{startIndex:u,endIndex:c}=l;if(u>=r&&c<=s){a.push(l);continue}if(Math.max(r,u)<=Math.min(s,c)){let e=i5(u,c,r,s);if(0===e.length)continue;l.startIndex=e[0],l.endIndex=e[1]}else s<u&&n&&(l.startIndex-=t,l.endIndex-=t);o.push(l)}e.customDecorations=o}return a}(e,t,r),d="";return n&&(e.dataStream=i8(n,r,i),d=n.slice(r,i)),{dataStream:d,textRuns:s,paragraphs:a,sectionBreaks:o,customBlocks:l,tables:u,customRanges:c,customDecorations:h}}function ct(e,t,r,n){e.dataStream=i9(e.dataStream,n,t.dataStream),uA(e,t,r,n),uv(e,t,r,n),uT(e,t,r,n),uw(e,t,r,n),uM(e,t,r,n),function(e,t,r,n){e.customRanges||(e.customRanges=[]);let{customRanges:i}=e;uU(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customRanges){for(let e=0,r=t.customRanges.length;e<r;e++){let r=t.customRanges[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customRanges=ux(i)}(e,t,r,n),function(e,t,r,n){e.customDecorations||(e.customDecorations=[]);let{customDecorations:i}=e;uV(i,n);for(let e=0,t=i.length;e<t;e++){let t=i[e],{startIndex:s}=t;s>=n&&(t.startIndex+=r,t.endIndex+=r)}let s=[];if(t.customDecorations){for(let e=0,r=t.customDecorations.length;e<r;e++){let r=t.customDecorations[e];r.startIndex+=n,r.endIndex+=n,s.push(r)}i.push(...s)}e.customDecorations=uD(i)}(e,t,r,n)}function cr(e,t,r,n,i){let s={startIndex:t.startIndex};if(t.paragraphStyle&&(s.paragraphStyle=rq.deepClone(t.paragraphStyle),e.paragraphStyle)){if(r===nR.REPLACE)if(n===nR.REPLACE)1===i&&(s.paragraphStyle={...e.paragraphStyle});else if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else if(n===nR.REPLACE)if(1===i)for(let t of Object.keys(e.paragraphStyle))void 0!==e.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else for(let t of Object.keys(e.paragraphStyle))void 0===s.paragraphStyle[t]&&(s.paragraphStyle[t]=e.paragraphStyle[t]);else if(1===i)for(let t of Object.keys(e.paragraphStyle))s.paragraphStyle[t]&&delete s.paragraphStyle[t]}return r===nR.REPLACE&&n===nR.REPLACE?s.bullet=1===i?rq.deepClone(e.bullet):rq.deepClone(t.bullet):void 0===e.bullet?s.bullet=rq.deepClone(t.bullet):r===nR.REPLACE||n===nR.REPLACE?s.bullet=0===i&&t.bullet?rq.deepClone(t.bullet):rq.deepClone(e.bullet):0===i&&void 0!==t.bullet&&(s.bullet=rq.deepClone(t.bullet)),s}function cn(e){return 1===Object.keys(e).length}let ci=class e{constructor(){tE(this,"_actions",[])}static apply(e,t){let r=new u7;return r.reset(),t.forEach(t=>{var n,i;let s=rq.deepClone(t);switch(s.t){case uN.RETAIN:{let{coverType:t,body:n,len:i}=s;null!=n&&function(e,t,r,n,i=nR.COVER){var s,a,o,l,u;(function(e,t,r,n,i){let{textRuns:s}=e,{textRuns:a}=t;if(null==s||null==a)return;let o=uL(e,r,n);i!==nR.REPLACE&&(t.textRuns=uK(a,o,i)),uA(e,t,r,n)})(s=e,a=t,o=r,l=n,u=i),function(e,t,r,n,i){let{paragraphs:s}=e,{paragraphs:a}=t;if(null==s||null==a)return;let o=uP(e,r,n);if(i!==nR.REPLACE){let e=[];for(let t of a){let{startIndex:r,paragraphStyle:n,bullet:s}=t,a=[];for(let e of o){let t,o,{startIndex:l,paragraphStyle:u,bullet:c}=e;if(i===nR.COVER?(t={...u,...n},o={listId:"",listType:u$.BULLET_LIST,nestingLevel:0,textStyle:{},...c,...s}):(t={...n,...u},o={listId:"",listType:u$.BULLET_LIST,nestingLevel:0,textStyle:{},...s,...c}),r===l){a.push({startIndex:r,paragraphStyle:t,bullet:o});break}}e.push(...a),a=[]}t.paragraphs=e}uv(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){let{sectionBreaks:s}=e,{sectionBreaks:a}=t;if(null==s||null==a)return;let o=uF(e,r,n);if(i!==nR.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===nR.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.sectionBreaks=e}uT(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){let{customBlocks:s=[]}=e,{customBlocks:a}=t;if(null==s||null==a)return;let o=uk(e,r,n);if(i!==nR.REPLACE){let e=[];for(let t of a){let{startIndex:r}=t,n=[];for(let e of o){let{startIndex:s}=e;if(r===s){i===nR.COVER?n.push({...e,...t}):n.push({...t,...e});break}}e.push(...n),n=[]}t.customBlocks=e}uw(e,t,r,n),s.length&&!e.customBlocks&&(e.customBlocks=s)}(s,a,o,l,u),function(e,t,r,n,i){let{tables:s}=e,{tables:a}=t;if(null==s||null==a)return;let o=uj(e,r,n);if(i!==nR.REPLACE){let e=[];for(let t of a){let{startIndex:r,endIndex:n}=t,s=[];for(let e of o){let{startIndex:a,endIndex:o}=e;if(a>=r&&o<=n){i===nR.COVER?s.push({...e,...t}):s.push({...t,...e});break}}e.push(...s),s=[]}t.tables=e}uM(e,t,r,n)}(s,a,o,l,u),function(e,t,r,n,i){e.customRanges||(e.customRanges=[]),uU(e.customRanges,n),uU(e.customRanges,n+r);let s=n+r-1,{customRanges:a}=t,o=[],l=new Map;e.customRanges.forEach(e=>{let{startIndex:t,endIndex:r}=e;t>=n&&r<=s?l.set(e.rangeId,e):o.push(e)}),a&&(a.forEach(e=>{let{startIndex:t,endIndex:r}=e;o.push({...e,startIndex:t+n,endIndex:r+n})}),e.customRanges=ux(o))}(s,a,o,l),function(e,t,r,n,i){e.customDecorations||(e.customDecorations=[]),uV(e.customDecorations,n),uV(e.customDecorations,n+r);let s=[],{customDecorations:a}=e,{customDecorations:o=[]}=t;if(i===nR.REPLACE){for(let e=0;e<a.length;e++){let t=a[e],{startIndex:i,endIndex:o}=t;i>=n&&o<=n+r-1&&s.push(t)}o.forEach(e=>{let{startIndex:t,endIndex:r}=e;a.push({...e,startIndex:t+n,endIndex:r+n})})}else for(let e of o){let{id:t}=e;if(e.type===sU.DELETED){let e=a.filter(e=>e.id===t);e.length&&s.push(...e)}else a.push({...e,startIndex:e.startIndex+n,endIndex:e.endIndex+n})}for(let e of s){let{id:t}=e,r=a.findIndex(e=>e.id===t);-1!==r&&a.splice(r,1)}e.customDecorations=uD(a)}(s,a,o,l,u)}(e,n,i,r.cursor,t),r.moveCursor(i);break}case uN.INSERT:{let{body:t,len:i}=s;n=r.cursor,0!==i&&ct(e,t,i,n),r.moveCursor(i);break}case uN.DELETE:{let{len:t}=s;i=r.cursor,t<=0||ce(e,t,i);break}default:throw Error(`Unknown action type for action: ${s}.`)}}),e}static compose(t,r){let n=new u8(t),i=new u8(r),s=new e;for(;n.hasNext()||i.hasNext();)if(i.peekType()===uN.INSERT)s.push(i.next());else if(n.peekType()===uN.DELETE)s.push(n.next());else{let e=Math.min(n.peekLength(),i.peekLength()),t=n.next(e),r=i.next(e);if(t.t===uN.INSERT&&r.t===uN.RETAIN)null==r.body?s.push(t):s.push({...t,body:u9(t.body,r.body,r.coverType)});else if(t.t===uN.RETAIN&&r.t===uN.RETAIN)if(null==t.body&&null==r.body)s.push(t.len!==Number.POSITIVE_INFINITY?t:r);else if(t.body&&r.body){let e=t.coverType===nR.REPLACE||r.coverType===nR.REPLACE?nR.REPLACE:nR.COVER;s.push({...t,t:uN.RETAIN,coverType:e,body:u9(t.body,r.body,r.coverType)})}else s.push(t.body?t:r);else t.t===uN.RETAIN&&r.t===uN.DELETE?s.push(r):t.t===uN.INSERT&&(r.t,uN.DELETE)}return s.trimEndUselessRetainAction(),s.serialize()}static transform(e,t,r="right"){return this._transform(t,e,"left"===r?"right":"left")}static _transform(t,r,n="right"){let i=new u8(t),s=new u8(r),a=new e;for(;i.hasNext()||s.hasNext();)if(i.peekType()===uN.INSERT&&("left"===n||s.peekType()!==uN.INSERT)){let e=i.next();a.retain(e.len)}else if(s.peekType()===uN.INSERT)a.push(s.next());else{let e=Math.min(i.peekLength(),s.peekLength()),t=i.next(e),r=s.next(e);if(t.t===uN.DELETE)continue;if(r.t===uN.DELETE){a.push(r);continue}if(null==t.body||null==r.body)a.push(r);else{let{coverType:e,body:i}=function(e,t,r=!1){let{body:n,coverType:i=nR.COVER}=e,{body:s,coverType:a=nR.COVER}=t;if(null==n||""!==n.dataStream||null==s||""!==s.dataStream)throw Error("Data stream is not supported in retain transform.");let o={dataStream:""},{textRuns:l,paragraphs:u=[],customRanges:c,customDecorations:h}=n,{textRuns:d,paragraphs:m=[],customRanges:g,customDecorations:f}=s,p=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];t=rq.deepClone(t),e=rq.deepClone(e);let s=[],a=t.length,o=e.length,l=0,u=0,c=null;function h(){return!!c&&(s.push(c),c=null,!0)}for(;l<a&&u<o;){let{st:a,ed:o,ts:d}=t[l],{st:m,ed:g,ts:f,sId:p}=e[u],C={};if(0===i)C={...d},r===nR.COVER&&n===nR.REPLACE&&f&&(C=Object.assign({},f,C));else if(C={...d},r===nR.REPLACE){if(n===nR.REPLACE)C={...f};else if(d&&f)for(let e of Object.keys(d))f[e]&&delete C[e]}else if(n===nR.REPLACE){if(f)for(let e of Object.keys(f))void 0!==f[e]&&(C[e]=f[e])}else if(f)for(let e of Object.keys(f))void 0!==C[e]&&delete C[e];if(o<m)h()||s.push(t[l]),l++;else if(g<a)h()||s.push(e[u]),u++;else{let r={st:Math.min(a,m),ed:Math.max(a,m),ts:a<m?{...d}:{...f}};r.ed>r.st&&s.push(),s.push({st:Math.max(a,m),ed:Math.min(o,g),ts:C,sId:p}),o<g?(l++,e[u].st=o,e[u].st===e[u].ed&&u++):(u++,t[l].st=g,t[l].st===t[l].ed&&l++);let n={st:Math.min(o,g),ed:Math.max(o,g),ts:o<g?{...f}:{...d},sId:o<g?p:void 0};c=n.ed>n.st?n:null}}h();let d=s[s.length-1],m=t[a-1],g=e[o-1];return d.ed!==Math.max(m.ed,g.ed)&&(m.ed>g.ed?s.push(m):s.push(g)),uS(s,!0)}(l,d,i,a,+!!r);p&&(o.textRuns=p);let C=function(e,t,r,n,i){if(null==e||null==t)return t;if(0===e.length||0===t.length)return[];if(e.length>1||t.length>1)throw Error("CustomRanges is only supported transform for length one now.");let s=e[0],a=t[0];if(r===nR.REPLACE)return 1===i?[rq.deepClone(s)]:[rq.deepClone(a)];if(n===nR.REPLACE){let e=rq.deepClone(a);return 1===i&&Object.assign(e,rq.deepClone(s)),[e]}{let e=rq.deepClone(a);return 1===i&&Object.assign(e,rq.deepClone(s)),[e]}}(c,g,i,a,+!!r);C&&(o.customRanges=C);let _=function(e,t){if(null==e||null==t)return t;if(0===e.length||0===t.length)return rq.deepClone(t);let r=[];for(let n of t){let{id:t,type:i}=n,s=!1;for(let a of e)if(a.id===t){(a.type===sU.DELETED||i===sU.DELETED)&&(s=!0,r.push({...n,type:sU.DELETED}));break}s||r.push(n)}return r}(h,f);_&&(o.customDecorations=_);let y=[],E=0,R=0;for(;E<u.length&&R<m.length;){let e=u[E],t=m[R],{startIndex:n}=e,{startIndex:s}=t;if(n===s){let s={startIndex:n};s=r?cr(e,t,i,a,1):cr(e,t,i,a,0),y.push(s),E++,R++}else n<s?E++:(y.push(rq.deepClone(t)),R++)}return R<m.length&&y.push(...m.slice(R)),y.length&&(o.paragraphs=y),{coverType:a,body:o}}(t,r,"left"===n);a.push({...r,t:uN.RETAIN,coverType:e,body:i})}}return a.trimEndUselessRetainAction(),a.serialize()}static transformPosition(e,t,r=!1){let n=new u8(e),i=0;for(;n.hasNext()&&i<=t;){let e=n.peekLength(),s=n.peekType();if(n.next(),s===uN.DELETE){t-=Math.min(e,t-i);continue}s===uN.INSERT&&(i<t||!r)&&(t+=e),i+=e}return t}static isNoop(e){return 0===e.length}static invert(e){let t=[];for(let r of e)if(r.t===uN.INSERT)t.push({t:uN.DELETE,len:r.len,body:r.body});else if(r.t===uN.DELETE){if(null==r.body)throw Error("Can not invert DELETE action without body property, makeInvertible must be called first.");t.push({t:uN.INSERT,body:r.body,len:r.len})}else if(null!=r.body){if(null==r.oldBody)throw Error("Can not invert RETAIN action without oldBody property, makeInvertible must be called first.");t.push({t:uN.RETAIN,body:r.oldBody,oldBody:r.body,len:r.len,coverType:nR.REPLACE})}else t.push(r);return t}static makeInvertible(e,t){let r=[],n=0;for(let i of e){if(i.t===uN.DELETE&&(null==i.body||i.body&&i.body.dataStream.length!==i.len)){let e=u5(t,n,n+i.len,!1);i.len=e.dataStream.length,i.body=e}if(i.t===uN.RETAIN&&null!=i.body){let e=u5(t,n,n+i.len,!0);i.oldBody={...e,dataStream:""},i.len=e.dataStream.length}r.push(i),i.t!==uN.INSERT&&(n+=i.len)}return r}insert(e,t){let r={t:uN.INSERT,body:t,len:e};return this.push(r),this}retain(e,t,r){let n={t:uN.RETAIN,len:e};return null!=t&&(n.body=t),null!=r&&(n.coverType=r),this.push(n),this}delete(e){let t={t:uN.DELETE,len:e};return this.push(t),this}empty(){return this._actions=[],this}serialize(){return this._actions}push(...e){if(e.length>1){for(let t of e)this.push(t);return this}let t=this._actions.length,r=this._actions[t-1],n=rq.deepClone(e[0]);if(n.t===uN.RETAIN&&0===n.len&&null==n.body)return this;if("object"==typeof r){if(r.t===uN.DELETE&&n.t===uN.DELETE)return r.len+=n.len,this;if(r.t===uN.DELETE&&n.t===uN.INSERT&&(t-=1,null==(r=this._actions[t-1])))return this._actions.unshift(n),this;if(r.t===uN.RETAIN&&n.t===uN.RETAIN&&null==r.body&&null==n.body)return r.len+=n.len,this;if(r.t===uN.INSERT&&cn(r.body)&&n.t===uN.INSERT&&cn(n.body))return r.len+=n.len,r.body.dataStream+=n.body.dataStream,this}return t===this._actions.length?this._actions.push(n):this._actions.splice(t,0,n),this}trimEndUselessRetainAction(){let e=this._actions[this._actions.length-1];for(;e&&e.t===uN.RETAIN&&function(e){let{body:t}=e;if(null==t)return!0;let{textRuns:r,paragraphs:n,customRanges:i,customBlocks:s,customDecorations:a,tables:o}=t;return null==r&&null==n&&null==i&&null==s&&null==a&&null==o}(e);)this._actions.pop(),e=this._actions[this._actions.length-1];return this}};tE(ci,"id","text-x"),tE(ci,"uri","https://github.com/dream-num/univer#text-x");let cs=ci;Object.defineProperty(cs,"name",{value:"text-x"});let ca=class e{static registerSubtype(e){var t;null==e||this._subTypes.has(e.name)&&(null==(t=this._subTypes.get(e.name))?void 0:t.id)!==cs.id||(this._subTypes.set(e.name,e),ub.type.registerSubtype(e))}static apply(e,t){if(!ub.type.isNoop(t))return ub.type.apply(e,t)}static compose(e,t){return ub.type.compose(e,t)}static transform(e,t,r){return ub.type.transform(e,t,r)}static transformPosition(e,t,r="right"){return e&&2===e.length&&"body"===e[0]&&e[1].et===cs.name?cs.transformPosition(e[1].e,t,"left"===r):t}static invertWithDoc(e,t){return ub.type.invertWithDoc(e,t)}static isNoop(e){return ub.type.isNoop(e)}static getInstance(){return null==this._instance&&(this._instance=new e),this._instance}removeOp(e,t){return ub.removeOp(e,t)}moveOp(e,t){return ub.moveOp(e,t)}insertOp(e,t){return ub.insertOp(e,t)}replaceOp(e,t,r){return ub.replaceOp(e,t,r)}editOp(e,t=["body"]){return ub.editOp(t,cs.name,e)}};tE(ca,"uri","https://github.com/dream-num/univer#json-x"),tE(ca,"_subTypes",new Map),tE(ca,"_instance",null);let co=ca;co.registerSubtype(cs);let cl={id:"default_doc",documentStyle:{}};class cu extends lz{constructor(e){var t;super(),tE(this,"type",lW.UNIVER_DOC),tE(this,"_name$",new(0,e9.BehaviorSubject)("")),tE(this,"name$",this._name$.asObservable()),tE(this,"snapshot"),this.snapshot={...cl,...e},this._name$.next(null!=(t=this.snapshot.title)?t:"No Title")}getUnitId(){throw Error("Method not implemented.")}getRev(){var e;return null!=(e=this.snapshot.rev)?e:1}incrementRev(){this.snapshot.rev=this.getRev()+1}setRev(e){this.snapshot.rev=e}setName(e){this.snapshot.title=e,this._name$.next(e)}get drawings(){return this.snapshot.drawings}get documentStyle(){return this.snapshot.documentStyle}get lists(){return this.snapshot.lists}get zoomRatio(){var e;return(null==(e=this.snapshot.settings)?void 0:e.zoomRatio)||1}resetDrawing(e,t){this.snapshot.drawings=e,this.snapshot.drawingsOrder=t}getBody(){return this.snapshot.body}getSnapshot(){return this.snapshot}getBulletPresetList(){var e;let t=null!=(e=this.snapshot.lists)?e:{};return{...uz,...t}}updateDocumentId(e){this.snapshot.id=e}updateDocumentRenderConfig(e){let{documentStyle:t}=this.snapshot;null==t.renderConfig?t.renderConfig=e:t.renderConfig={...t.renderConfig,...e}}getDocumentStyle(){return this.snapshot.documentStyle}updateDocumentStyle(e){null==this.snapshot.documentStyle?this.snapshot.documentStyle=e:this.snapshot.documentStyle={...this.snapshot.documentStyle,...e}}updateDocumentDataMargin(e){let{t:t,l:r,b:n,r:i}=e,{documentStyle:s}=this.snapshot;null!=t&&(s.marginTop=t),null!=r&&(s.marginLeft=r),null!=n&&(s.marginBottom=n),null!=i&&(s.marginRight=i)}updateDocumentDataPageSize(e,t){let{documentStyle:r}=this.snapshot;if(!r.pageSize){e=null!=e?e:Number.POSITIVE_INFINITY,t=null!=t?t:Number.POSITIVE_INFINITY,r.pageSize={width:e,height:t};return}void 0!==e&&(r.pageSize.width=e),void 0!==t&&(r.pageSize.height=t)}updateDrawing(e,t){let{drawings:r}=this,{width:n,height:i,left:s,top:a}=t,o=null==r?void 0:r[e];if(!o)return;let l=o.docTransform;l.size.width=n,l.size.height=i,l.positionH.posOffset=s,l.positionV.posOffset=a}setZoomRatio(e=1){null==this.snapshot.settings?this.snapshot.settings={zoomRatio:e}:this.snapshot.settings.zoomRatio=1}setDisabled(e){this.snapshot.disabled=e}getDisabled(){return this.snapshot.disabled}getTitle(){return this.snapshot.title}}class cc extends cu{constructor(e){var t,r;super(rq.isEmptyObject(e)?function(e=rq.generateRandomId(6),t=rC.EN_US,r=""){return{id:e,locale:t,title:r,tableSource:{},drawings:{},drawingsOrder:[],headers:{},footers:{},body:{dataStream:`\r
`,textRuns:[],customBlocks:[],tables:[],paragraphs:[{startIndex:0,paragraphStyle:{spaceAbove:{v:5},lineSpacing:1,spaceBelow:{v:0}}}],sectionBreaks:[{startIndex:1}]},documentStyle:{pageSize:{width:793.3333333333334,height:1122.6666666666667},documentFlavor:sV.TRADITIONAL,marginTop:50,marginBottom:50,marginRight:50,marginLeft:50,renderConfig:{zeroWidthParagraphBreak:rD.FALSE,vertexAngle:0,centerAngle:0,background:{rgb:"#ccc"}},autoHyphenation:rD.TRUE,doNotHyphenateCaps:rD.FALSE,consecutiveHyphenLimit:2,defaultHeaderId:"",defaultFooterId:"",evenPageHeaderId:"",evenPageFooterId:"",firstPageHeaderId:"",firstPageFooterId:"",evenAndOddHeaders:rD.FALSE,useFirstPageHeaderFooter:rD.FALSE,marginHeader:30,marginFooter:30},settings:{}}}():e),tE(this,"_unitId"),tE(this,"headerModelMap",new Map),tE(this,"footerModelMap",new Map),tE(this,"change$",new(0,e9.BehaviorSubject)(0)),this._unitId=null!=(t=this.snapshot.id)?t:rq.generateRandomId(6),this._initializeHeaderFooterModel(),this._name$.next(null!=(r=this.snapshot.title)?r:"")}dispose(){super.dispose(),this.headerModelMap.forEach(e=>{e.dispose()}),this.footerModelMap.forEach(e=>{e.dispose()}),this._name$.complete()}getDrawings(){return this.snapshot.drawings}getDrawingsOrder(){return this.snapshot.drawingsOrder}getCustomRanges(){var e;return null==(e=this.snapshot.body)?void 0:e.customRanges}getCustomDecorations(){var e;return null==(e=this.snapshot.body)?void 0:e.customDecorations}getSettings(){return this.snapshot.settings}reset(e){if(e.id&&e.id!==this._unitId)throw Error("Cannot reset a document model with a different unit id!");this.snapshot={...cl,...e},this._initializeHeaderFooterModel(),this.change$.next(this.change$.value+1)}getSelfOrHeaderFooterModel(e){if(null!=e){if(this.headerModelMap.has(e))return this.headerModelMap.get(e);if(this.footerModelMap.has(e))return this.footerModelMap.get(e)}return this}getUnitId(){return this._unitId}apply(e){if(!co.isNoop(e))return this.snapshot=co.apply(this.snapshot,e),null!=e&&e.some(e=>Array.isArray(e)&&((null==e?void 0:e[0])==="headers"||(null==e?void 0:e[0])==="footers"))&&(this.headerModelMap.clear(),this.footerModelMap.clear(),this._initializeHeaderFooterModel()),this.change$.next(this.change$.value+1),this.snapshot}sliceBody(e,t,r=uQ.copy){let n=this.getBody();if(null!=n)return u5(n,e,t,!1,r)}_initializeHeaderFooterModel(){let{headers:e,footers:t}=this.getSnapshot();if(e)for(let t in e){let r=e[t];this.headerModelMap.set(t,new cc(r)),this.headerModelMap.get(t).updateDocumentId(this.getUnitId())}if(t)for(let e in t){let r=t[e];this.footerModelMap.set(e,new cc(r)),this.footerModelMap.get(e).updateDocumentId(this.getUnitId())}}updateDocumentId(e){super.updateDocumentId(e),this._unitId=e}getPlainText(){var e,t;return a1(null!=(t=null==(e=this.getBody())?void 0:e.dataStream)?t:"")}}function ch(e,t,r,n){return e<=r&&t>=r||e>=r&&e<=n}function cd(e,t,r,n){let i=[];for(let s=0,a=r.length;s<a;s++){let a=r[s];if((void 0===n||a.rangeType===n)&&Math.max(a.startIndex,e)<=Math.min(a.endIndex,t)&&i.push({...a}),a.startIndex>t)break}return i}function cm(e,t,r=0,n=null,i=!0){e.sort((e,t)=>e.startOffset-t.startOffset);let s=[],{paragraphs:a=[]}=t,o=null==a?void 0:a.find(t=>t.startIndex>=e[0].startOffset&&t.startIndex<e[0].endOffset),l=r;if(e.forEach(e=>{let{startOffset:t,endOffset:r}=e;t>l&&(s.push({t:uN.RETAIN,len:t-l}),l=t),l<r&&(s.push({t:uN.DELETE,len:r-l}),l=r)}),n&&s.push({t:uN.INSERT,body:n,len:n.dataStream.length}),o&&i){let t=a.find(t=>t.startIndex-r>=e[e.length-1].endOffset-1);t&&(t.startIndex>l&&(s.push({t:uN.RETAIN,len:t.startIndex-l}),l=t.startIndex),s.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...t,startIndex:0,bullet:null==o?void 0:o.bullet}]},coverType:nR.REPLACE}))}return s}function cg(e,t,r,n){let{startOffset:i,endOffset:s}=e,a=null!=n?n:cC(t,r),o=[],l=-1;for(let e=0;e<a.length;e++){let t=a[e],{startIndex:r}=t;(i>l&&i<=r||s>l&&s<=r||r>=i&&r<=s)&&o.push(t),l=r}return o}function cf(e,t,r){let n=[],i=cC(t,r);for(let s of e){let e=cg(s,t,r,i);n.push(...e)}return n}let cp=[aZ.PARAGRAPH,aZ.TABLE_START,aZ.TABLE_END,aZ.TABLE_ROW_START,aZ.TABLE_CELL_START,aZ.TABLE_CELL_END];function cC(e,t){let r=[];for(let n=0;n<e.length;n++){let i=e[n],{startIndex:s}=i,a=s-1;for(;!cp.includes(t[a])&&a>=0;)a--;r.push({...i,paragraphStart:a+1,paragraphEnd:i.startIndex})}return r}class c_{}function cy(e){var t;return e.body=function(e){if(e.customRanges||(e.customRanges=[]),!e.paragraphs){e.paragraphs=[];for(let t=0;t<e.dataStream.length;t++)"\r"===e.dataStream[t]&&e.paragraphs.push({startIndex:t})}return e.customBlocks||(e.customBlocks=[]),e.textRuns||(e.textRuns=[]),e.customDecorations||(e.customDecorations=[]),e.sectionBreaks||(e.sectionBreaks=[]),e.tables||(e.tables=[]),e}(null!=(t=e.body)?t:{dataStream:""}),e.drawingsOrder||(e.drawingsOrder=[]),e.drawings||(e.drawings={}),e.documentStyle||(e.documentStyle={}),e}tE(c_,"customRange",{add:function(e){let{ranges:t,rangeId:r,rangeType:n,wholeEntity:i,properties:s,body:a}=e,o=0,l=new cs,u=!1;return t.forEach(e=>{var t,c,h;let d=function(e,t){var r,n,i,s,a;let o=cd(e.startOffset,e.collapsed?e.startOffset:e.endOffset-1,null!=(r=t.customRanges)?r:[]),l=Math.min(e.startOffset,null!=(i=null==(n=o[0])?void 0:n.startIndex)?i:1/0),u=Math.max(e.endOffset,(null!=(a=null==(s=o[o.length-1])?void 0:s.endIndex)?a:-1/0)+1);return{startOffset:l,endOffset:u,collapsed:l===u}}(e,a);if(!d||!a)return!1;let{startOffset:m,endOffset:g}=d,f=null!=(t=a.customRanges)?t:[],p=(e,t,a)=>{var u,c,h,d;let m=cd(e,t,f,n),g=Math.min(null!=(c=null==(u=m[0])?void 0:u.startIndex)?c:1/0,e),p=Math.max(null!=(d=null==(h=m[m.length-1])?void 0:h.endIndex)?d:-1/0,t),C={rangeId:a?`${r}$${a}`:r,rangeType:n,startIndex:0,endIndex:p-g,wholeEntity:i,properties:{...s}};l.push({t:uN.RETAIN,len:g-o}),l.push({t:uN.RETAIN,len:p-g+1,body:{dataStream:"",customRanges:[C]},coverType:nR.COVER}),o=p+1},C=(null!=(c=a.paragraphs)?c:[]).filter(e=>e.startIndex<g&&e.startIndex>m),_=(null!=(h=a.customBlocks)?h:[]).filter(e=>e.startIndex<g&&e.startIndex>m);(function(e,t){let r=[],n=e[0];for(let i of t)i<e[0]||i>e[1]||(n<i&&r.push([n,i-1]),n=i+1);return n<=e[1]&&r.push([n,e[1]]),r})([m,g-1],[...C.map(e=>e.startIndex),..._.map(e=>e.startIndex)]).forEach(([e,t],r)=>p(e,t,r)),u=!0,l.selections=[{startOffset:d.endOffset,endOffset:d.endOffset,collapsed:!0}]}),!!u&&l},delete:function(e){var t,r,n;let{rangeId:i,segmentId:s,documentDataModel:a,insert:o}=e,l=null==(r=null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.customRanges)?void 0:r.find(e=>e.rangeId===i);if(!l)return!1;let{startIndex:u,endIndex:c}=l,h=new cs;h.push({t:uN.RETAIN,len:u}),h.push({t:uN.RETAIN,len:c-u+1,body:{dataStream:"",customRanges:[]}}),o&&h.push({t:uN.INSERT,body:o,len:o.dataStream.length});let d=c+1+(null!=(n=null==o?void 0:o.dataStream.length)?n:0);return h.selections=[{startOffset:d,endOffset:d,collapsed:!0}],h},copyCustomRange:function(e){return{...rq.deepClone(e),rangeId:rK()}},getCustomRangesInterestsWithSelection:function(e,t){let r=[];for(let n=0,i=t.length;n<i;n++){let i=t[n];e.collapsed?i.startIndex<e.startOffset&&e.startOffset<=i.endIndex&&r.push(i):ch(e.startOffset,e.endOffset-1,i.startIndex,i.endIndex)&&r.push(i)}return r},isIntersecting:ch}),tE(c_,"customDecoration",{add:function(e){let{ranges:t,id:r,type:n}=e,i=new cs,s=0;for(let e=0;e<t.length;e++){let{startOffset:a,endOffset:o}=t[e];a>0&&i.push({t:uN.RETAIN,len:a-s}),i.push({t:uN.RETAIN,body:{dataStream:"",customDecorations:[{id:r,type:n,startIndex:0,endIndex:o-a-1}]},len:o-a}),s=o}return i},delete:function(e){var t,r,n;let{id:i,segmentId:s,documentDataModel:a}=e,o=null==a?void 0:a.getBody();if(!a||!o)return!1;let l=null==(n=null==(r=null==(t=a.getSelfOrHeaderFooterModel(s))?void 0:t.getBody())?void 0:r.customDecorations)?void 0:n.find(e=>e.id===i);if(!l)return!1;let u=new cs,{startIndex:c,endIndex:h}=l,d=h-c+1;return u.push({t:uN.RETAIN,len:c}),u.push({t:uN.RETAIN,len:d,body:{dataStream:"",customDecorations:[{startIndex:0,endIndex:d-1,id:i,type:sU.DELETED}]}}),u}}),tE(c_,"selection",{replace:e=>{var t;let{selection:r,body:n,doc:i}=e,s=r.segmentId,a=null==(t=i.getSelfOrHeaderFooterModel(s))?void 0:t.getBody();if(!a)return!1;let o=r.collapsed?null:u5(a,r.startOffset,r.endOffset),l=lk(o?o.dataStream:"",n.dataStream),u=0,c=l.map(([e,t])=>{switch(e){case 0:{let e={t:uN.RETAIN,body:{...u5(n,u,u+t.length,!1),dataStream:""},len:t.length};return u+=t.length,e}case 1:{let e={t:uN.INSERT,body:u5(n,u,u+t.length),len:t.length};return u+=t.length,e}default:return{t:uN.DELETE,len:t.length}}}),h=new cs;return h.push({t:uN.RETAIN,len:r.startOffset}),h.push(...c),h},makeSelection:function(e,t){if(typeof t>"u")return{startOffset:e,endOffset:e,collapsed:!0};if(t<e)throw Error(`Cannot make a doc selection when endOffset ${t} is less than startOffset ${e}.`);return{startOffset:e,endOffset:t,collapsed:e===t}},normalizeSelection:function(e){let{startOffset:t,endOffset:r,collapsed:n}=e;return{startOffset:Math.min(t,r),endOffset:Math.max(t,r),collapsed:n}},delete:cm,replaceTextRuns:e=>{var t;let{selection:r,body:n,doc:i}=e,s=r.segmentId,a=null==(t=i.getSelfOrHeaderFooterModel(s))?void 0:t.getBody();if(!a)return!1;let o=r.collapsed?null:u5(a,r.startOffset,r.endOffset),l=lk(o?o.dataStream:"",n.dataStream),u=0,c=l.map(([e,t])=>{switch(e){case 0:{let e=uZ(n,u,u+t.length,!1),r=uZ(o,u,u+t.length,!1),i={t:uN.RETAIN,body:(null==e?void 0:e.length)===(null==r?void 0:r.length)&&null!=e&&e.every((e,t)=>JSON.stringify(e)===JSON.stringify(null==r?void 0:r[t]))?void 0:{textRuns:e,dataStream:""},len:t.length};return u+=t.length,i}case 1:{let e={t:uN.INSERT,body:u5(n,u,u+t.length),len:t.length};return u+=t.length,e}default:return{t:uN.DELETE,len:t.length}}});if(c.every(e=>e.t===uN.RETAIN&&!e.body))return!1;let h=new cs;return h.push({t:uN.RETAIN,len:r.startOffset}),h.push(...c),h},retain:function(e,t,r=0){let n=[],i=r;return e.forEach(e=>{let{startOffset:r,endOffset:s}=e;r>i&&(n.push({t:uN.RETAIN,len:r-i}),i=r),s>i&&(n.push({t:uN.RETAIN,len:s-i,body:{...rq.deepClone(t),dataStream:""}}),i=s)}),n}}),tE(c_,"range",{isIntersects:function(e,t,r,n){return Math.max(e,r)<=Math.min(t,n)},getParagraphsInRange:cg,getParagraphsInRanges:cf}),tE(c_,"transform",{getPlainText:a1,fromPlainText:e=>{let t=e.replace(/\n/g,"\r"),r=[],n=[],i=0,s="",a=(a,o=!0)=>{let l=t.slice(i,a);if(rq.isLegalUrl(l)){let t=rK(),u=`${l}`,c={startIndex:i,endIndex:i+u.length-1,rangeId:t,rangeType:sx.HYPERLINK,properties:{url:e}};n.push(c),s+=u,i=a+1,o&&(s+="\r",r.push({startIndex:a}))}else s+=t.slice(i,a+1),i=a+1,o&&r.push({startIndex:a})},o=0;for(let e=0;e<t.length;e++)"\r"===t[e]&&(a(e),o=e);return(o!==t.length-1||1===t.length)&&a(t.length,!1),{dataStream:s,paragraphs:r,customRanges:n}},isEmptyDocument:e=>!e||""===a1(e).replaceAll("\r","")}),tE(c_,"paragraph",{bullet:{set:e=>{var t,r;let{paragraphs:n,listType:i,segmentId:s,document:a}=e;if((null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)==null)return!1;let o=rq.generateRandomId(6),l=new u7;l.reset();let u=new cs;for(let e of n){let{startIndex:t,paragraphStyle:n={},bullet:s}=e;u.push({t:uN.RETAIN,len:t-l.cursor}),u.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:n,bullet:{nestingLevel:null!=(r=null==s?void 0:s.nestingLevel)?r:0,textStyle:(null==s?void 0:s.listType)===i?s.textStyle:{fs:20},listType:i,listId:o}}]},coverType:nR.REPLACE}),l.moveCursorTo(t+1)}return u},switch:e=>{var t,r,n;let{paragraphs:i,segmentId:s,document:a}=e,o=e.listType,l=null!=(r=null==(t=a.getSelfOrHeaderFooterModel(s).getBody())?void 0:t.paragraphs)?r:[],u=i.every(e=>{var t;return(null==(t=e.bullet)?void 0:t.listType.indexOf(o))===0}),c=rq.generateRandomId(6);if(1===i.length){let e=l.indexOf(i[0]),t=l[e-1],r=l[e+1];t&&t.bullet&&0===t.bullet.listType.indexOf(o)?(c=t.bullet.listId,o!==u$.CHECK_LIST&&(o=t.bullet.listType)):r&&r.bullet&&0===r.bullet.listType.indexOf(o)&&(c=r.bullet.listId,o!==u$.CHECK_LIST&&(o=r.bullet.listType))}let h=new u7;h.reset();let d=new cs;for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:i}=e;d.push({t:uN.RETAIN,len:t-h.cursor}),d.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[u?{paragraphStyle:r,startIndex:0}:{startIndex:0,paragraphStyle:{...r},bullet:{nestingLevel:null!=(n=null==i?void 0:i.nestingLevel)?n:0,textStyle:{fs:20},listType:o,listId:c}}]},coverType:nR.REPLACE}),h.moveCursorTo(t+1)}return d},toggleChecklist:e=>{var t;let{paragraphIndex:r,segmentId:n,document:i}=e,s=null==(t=i.getSelfOrHeaderFooterModel(n).getBody())?void 0:t.paragraphs;if(null==s)return!1;let a=s.find(e=>e.startIndex===r);if(!(null!=a&&a.bullet)||-1===a.bullet.listType.indexOf(u$.CHECK_LIST))return!1;let o=new u7;o.reset();let l=new cs,{startIndex:u,paragraphStyle:c={}}=a,h=a.bullet.listType===u$.CHECK_LIST?u$.CHECK_LIST_CHECKED:u$.CHECK_LIST;return l.push({t:uN.RETAIN,len:u-o.cursor}),l.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[{...a,paragraphStyle:c,startIndex:0,bullet:{...a.bullet,listType:h}}]},coverType:nR.REPLACE}),o.moveCursorTo(u+1),l},changeNestLevel:e=>{var t,r,n;let{paragraphs:i,document:s,type:a}=e,o=new u7;o.reset();let l=new cs,u=null!=(t=s.getSnapshot().lists)?t:{},c=null!=(n=null==(r=s.getBody())?void 0:r.tables)?n:[],h={...uz,...u};for(let e of i){let{startIndex:t,paragraphStyle:r={},bullet:n}=e,i=function(e,t){return t.some(t=>e.startIndex>t.startIndex&&e.startIndex<t.endIndex)}(e,c);if(l.push({t:uN.RETAIN,len:t-o.cursor}),n){let e=h[n.listType].nestingLevel.length-1;i&&(e=Math.min(e,2)),l.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:{...r},bullet:{...n,nestingLevel:Math.max(Math.min(n.nestingLevel+a,e),0)}}]},coverType:nR.REPLACE})}else l.push({t:uN.RETAIN,len:1});o.moveCursorTo(t+1)}return l}},style:{set:e=>{var t,r,n,i;let{textRanges:s,segmentId:a,document:o,style:l,paragraphTextRun:u,cursor:c,deleteLen:h,textX:d}=e,m=o.getSelfOrHeaderFooterModel(a),g=cf(s,null!=(r=null==(t=m.getBody())?void 0:t.paragraphs)?r:[],null!=(i=null==(n=m.getBody())?void 0:n.dataStream)?i:""),f=new u7;c&&f.moveCursorTo(c);let p=null!=d?d:new cs;g.sort((e,t)=>e.startIndex-t.startIndex);let C=Math.max(0,g[0].paragraphStart-1);for(let e of(C>f.cursor&&(p.push({t:uN.RETAIN,len:C-f.cursor}),f.moveCursorTo(C)),h&&p.push({t:uN.DELETE,len:h}),g)){let{startIndex:t,paragraphStyle:r={}}=e,n=t-f.cursor;p.push({t:uN.RETAIN,len:n,...u?{body:{dataStream:"",textRuns:[{ts:u,st:0,ed:n}]},coverType:nR.REPLACE}:null}),p.push({t:uN.RETAIN,len:1,body:{dataStream:"",paragraphs:[{startIndex:0,paragraphStyle:{...r,...l}}]},coverType:nR.REPLACE}),f.moveCursorTo(t+1)}return p}},util:{transform:cC,getParagraphsInRange:cg,getParagraphsInRanges:cf}}),tE(c_,"drawing",{add:e=>{var t,r,n,i;let{selection:s,documentDataModel:a,drawings:o}=e,{collapsed:l,startOffset:u,segmentId:c}=s,h=new cs,d=co.getInstance(),m=[],g=a.getSelfOrHeaderFooterModel(c).getBody();if(!g)return!1;let f=null!=(r=null==(t=a.getSnapshot().drawingsOrder)?void 0:t.length)?r:0,p=0;if(l)u>0&&h.push({t:uN.RETAIN,len:u});else{let e=cm([s],g,0,null,!1);h.push(...e);let t=function(e,t){let r=[],{customBlocks:n=[]}=e;for(let e of t){let{startOffset:t,endOffset:i}=e;if(null!=t&&null!=i)for(let e of n){let{startIndex:n}=e;n>=t&&n<i&&r.push(e.blockId)}}return r}(g,[s]),r=null!=(n=a.getDrawings())?n:{},o=null!=(i=a.getDrawingsOrder())?i:[],l=t.sort((e,t)=>o.indexOf(e)>o.indexOf(t)?-1:+(o.indexOf(e)<o.indexOf(t)));if(l.length>0)for(let e of l){let t=r[e],n=o.indexOf(e);if(null==t||n<0)continue;let i=d.removeOp(["drawings",e],t),s=d.removeOp(["drawingsOrder",n],e);m.push(i),m.push(s),p++}}h.push({t:uN.INSERT,body:{dataStream:"\b".repeat(o.length),customBlocks:o.map((e,t)=>({startIndex:t,blockId:e.drawingId}))},len:o.length});let C=function(e,t=""){if(!t)return["body"];let{headers:r,footers:n}=e.getSnapshot();if(null==r&&null==n)throw Error("Document data model must have headers or footers when update by segment id");if((null==r?void 0:r[t])!=null)return["headers",t,"body"];if((null==n?void 0:n[t])!=null)return["footers",t,"body"];throw Error("Segment id not found in headers or footers")}(a,c),_=d.editOp(h.serialize(),C);for(let e of(m.push(_),o)){let{drawingId:t}=e,r=d.insertOp(["drawings",t],e),n=d.insertOp(["drawingsOrder",f-p],t);m.push(r),m.push(n)}return m.reduce((e,t)=>co.compose(e,t),null)}});class cE{constructor(e={}){tE(this,"_style"),this._style=e}static create(e={}){return new cE(e)}get fontFamily(){return this._style.ff}get fontSize(){return this._style.fs}get italic(){return this._style.it===rD.TRUE}get bold(){return this._style.bl===rD.TRUE}get underline(){return this._style.ul&&cb.create(this._style.ul)}get bottomBorderLine(){return this._style.bbl&&cb.create(this._style.bbl)}get strikethrough(){return this._style.st&&cb.create(this._style.st)}get overline(){return this._style.ol&&cb.create(this._style.ol)}get background(){return this._style.bg}get border(){return this._style.bd}get color(){return this._style.cl}get verticalAlign(){return this._style.va}get numberFormat(){return this._style.n}copy(){return cR.create(rq.deepClone(this._style))}getValue(){return{...this._style}}}class cR extends cE{static create(e={}){return new cR(e)}constructor(e={}){super(e)}setFontFamily(e){return this._style.ff=e,this}setFontSize(e){return this._style.fs=e,this}setItalic(e){return this._style.it=+!!e,this}setBold(e){return this._style.bl=+!!e,this}setUnderline(e){return this._style.ul=e.build(),this}setBottomBorderLine(e){return this._style.bbl=e.build(),this}setStrikethrough(e){return this._style.st=e.build(),this}setOverline(e){return this._style.ol=e.build(),this}setBackground(e){return this._style.bg=e,this}setBorder(e){return this._style.bd=e,this}setColor(e){return this._style.cl=e,this}setVerticalAlign(e){return this._style.va=e,this}copy(){return cR.create(rq.deepClone(this._style))}build(){return this.getValue()}}class cb{constructor(e={s:1}){tE(this,"_decoration"),this._decoration=e}static create(e={s:1}){return new cb(e)}get show(){return this._decoration.s===rD.TRUE}get followFontColor(){return this._decoration.c===rD.TRUE}get color(){return this._decoration.cl}get type(){return this._decoration.t}setShow(e){return this._decoration.s=+!!e,this}setFollowFontColor(e){return this._decoration.c=+!!e,this}setColor(e){return this._decoration.cl=e,this}setLineType(e){return this._decoration.t=e,this}copy(){return cb.create(rq.deepClone(this._decoration))}build(){return{...this._decoration}}}class cI{constructor(e={}){tE(this,"_style"),this._style=e}static create(e={}){return new cI(e)}get indentFirstLine(){return this._style.indentFirstLine}get hanging(){return this._style.hanging}get indentStart(){return this._style.indentStart}get tabStops(){return this._style.tabStops}get indentEnd(){return this._style.indentEnd}get textStyle(){return this._style.textStyle}get headingId(){return this._style.headingId}get namedStyleType(){return this._style.namedStyleType}get horizontalAlign(){return this._style.horizontalAlign}get lineSpacing(){return this._style.lineSpacing}get direction(){return this._style.direction}get spacingRule(){return this._style.spacingRule}get snapToGrid(){return this._style.snapToGrid}get spaceAbove(){return this._style.spaceAbove}get spaceBelow(){return this._style.spaceBelow}get borderBetween(){return this._style.borderBetween}get borderTop(){return this._style.borderTop}get borderBottom(){return this._style.borderBottom}get borderLeft(){return this._style.borderLeft}get borderRight(){return this._style.borderRight}get keepLines(){return this._style.keepLines===rD.TRUE}get keepNext(){return this._style.keepNext===rD.TRUE}get wordWrap(){return this._style.wordWrap===rD.TRUE}get widowControl(){return this._style.widowControl===rD.TRUE}get shading(){return this._style.shading}get suppressHyphenation(){return this._style.suppressHyphenation===rD.TRUE}copy(){return cN.create(rq.deepClone(this._style))}getValue(){return this._style}}class cN extends cI{static create(e={}){return new cN(e)}constructor(e={}){super(e)}setIndentFirstLine(e){return this._style.indentFirstLine=e,this}setHanging(e){return this._style.hanging=e,this}setIndentStart(e){return this._style.indentStart=e,this}setTabStops(e){return this._style.tabStops=e,this}setIndentEnd(e){return this._style.indentEnd=e,this}setTextStyle(e){return this._style.textStyle=e,this}setHeadingId(e){return this._style.headingId=e,this}setNamedStyleType(e){return this._style.namedStyleType=e,this}setHorizontalAlign(e){return this._style.horizontalAlign=e,this}setLineSpacing(e){return this._style.lineSpacing=e,this}setDirection(e){return this._style.direction=e,this}setSpacingRule(e){return this._style.spacingRule=e,this}setSnapToGrid(e){return this._style.snapToGrid=+!!e,this}setSpaceAbove(e){return this._style.spaceAbove=e,this}setSpaceBelow(e){return this._style.spaceBelow=e,this}setBorderBetween(e){return this._style.borderBetween=e,this}setBorderTop(e){return this._style.borderTop=e,this}setBorderBottom(e){return this._style.borderBottom=e,this}setBorderLeft(e){return this._style.borderLeft=e,this}setBorderRight(e){return this._style.borderRight=e,this}setKeepLines(e){return this._style.keepLines=+!!e,this}setKeepNext(e){return this._style.keepNext=+!!e,this}setWordWrap(e){return this._style.wordWrap=+!!e,this}setWidowControl(e){return this._style.widowControl=+!!e,this}setShading(e){return this._style.shading=e,this}setSuppressHyphenation(e){return this._style.suppressHyphenation=+!!e,this}copy(){return cN.create(rq.deepClone(this._style))}build(){return this.getValue()}}class cS{constructor(e){if(tE(this,"_data"),!e.body)throw Error("Invalid document data, body is required");this._data=cy(e)}static create(e){return new cS(e)}static createByBody(e){return new cS({body:e,id:"d",documentStyle:{}})}copy(){return cA.create(rq.deepClone(this._data))}slice(e,t){let{body:r,...n}=this._data;return cA.create({...rq.deepClone(n),body:u5(r,e,t)})}toPlainText(){var e,t;return c_.transform.getPlainText(null!=(t=null==(e=this._data.body)?void 0:e.dataStream)?t:"").replaceAll("\r",`
`)}getParagraphStyle(){var e,t;return cI.create(null==(t=null==(e=this._data.body)?void 0:e.paragraphs)?void 0:t[0].paragraphStyle)}getParagraphBullet(){var e,t;return null==(t=null==(e=this._data.body)?void 0:e.paragraphs)?void 0:t[0].bullet}getParagraphs(){var e,t;let r=null!=(t=null==(e=this._data.body)?void 0:e.paragraphs)?t:[],n=0;return r.map(e=>{let t=this.slice(n,e.startIndex);return n=e.startIndex,t})}getTextRuns(){var e,t;return(null!=(t=null==(e=this._data.body)?void 0:e.textRuns)?t:[]).map(e=>({...e,ts:e.ts?cE.create(e.ts):null}))}getLinks(){var e,t,r;return null!=(r=null==(t=null==(e=this._data.body)?void 0:e.customRanges)?void 0:t.filter(e=>e.rangeType===sx.HYPERLINK))?r:[]}getData(){return this._data}}class cA extends cS{constructor(e){super(e),tE(this,"_doc"),this._doc=new cc(e)}static newEmptyData(){return cy({id:"d",documentStyle:{},drawings:{},drawingsOrder:[],body:{dataStream:`\r
`,customBlocks:[],customRanges:[],paragraphs:[{startIndex:0}],textRuns:[],tables:[],sectionBreaks:[]}})}static create(e){return new cA(null!=e?e:cA.newEmptyData())}insertText(e,t,r){var n,i;let s=(null!=(i=null==(n=this._data.body)?void 0:n.dataStream.length)?i:2)-2,a,o;if("string"==typeof e?a=e:(s=Math.min(e,s),a=t),o="object"==typeof t?t instanceof cR?t.build():t:r instanceof cR?r.build():r,!a)return this;let l={dataStream:a,textRuns:o?[{ts:o,st:s,ed:s+a.length}]:[]},u=c_.selection.replace({doc:this._doc,selection:{startOffset:s,endOffset:s,collapsed:!0},body:l});if(!u)throw Error("Insert text failed, please check.");return cs.apply(this._doc.getBody(),u.serialize()),this}insertRichText(e,t){var r,n;let i=(null!=(n=null==(r=this._data.body)?void 0:r.dataStream.length)?n:2)-2,s;"object"==typeof e?s=e instanceof cS?e.getData():e:(i=Math.min(e,i),s=t instanceof cS?t.getData():t);let a=c_.selection.replace({doc:this._doc,selection:{startOffset:i,endOffset:i,collapsed:!0},body:s.body});if(!a)throw Error("Insert text failed, please check.");return cs.apply(this._doc.getBody(),a.serialize()),this}delete(e,t){if(void 0!==t){if(!t)return this;let r=c_.selection.delete([{startOffset:e,endOffset:e+t,collapsed:!0}],this._data.body);cs.apply(this._doc.getBody(),r)}return this}setStyle(e,t,r){let n={dataStream:"",textRuns:[{ts:r instanceof cR?r.build():r,st:0,ed:t-e}]},i=c_.selection.retain([{startOffset:e,endOffset:t,collapsed:!0}],n);return cs.apply(this._doc.getBody(),i),this}setLink(e,t,r){let n=c_.customRange.add({rangeType:sx.HYPERLINK,rangeId:rK(),properties:{url:r},ranges:[{startOffset:e,endOffset:t,collapsed:!1}],body:this._data.body});if(!n)throw Error("Insert text failed, please check.");return cs.apply(this._doc.getBody(),n.serialize()),this}cancelLink(e,t){if("string"==typeof e){let t=c_.customRange.delete({rangeId:e,documentDataModel:this._doc});if(!t)throw Error("Insert text failed, please check.");cs.apply(this._doc.getBody(),t.serialize())}else this.slice(e,t).getLinks().forEach(e=>{let t=c_.customRange.delete({rangeId:e.rangeId,documentDataModel:this._doc});if(!t)throw Error("Insert text failed, please check.");cs.apply(this._doc.getBody(),t.serialize())});return this}updateLink(e,t){var r,n;let i=null==(n=null==(r=this._data.body)?void 0:r.customRanges)?void 0:n.find(t=>t.rangeId===e);if(!i)throw Error("Link not found");return i.properties.url=t,this}insertParagraph(e,t){var r,n;let i,s;return"object"==typeof e?(i={dataStream:"\r",paragraphs:[{startIndex:0,paragraphStyle:e.build()}]},s=(null!=(n=null==(r=this._data.body)?void 0:r.dataStream.length)?n:2)-2):(s=e,i={dataStream:"\r",paragraphs:[{startIndex:0,paragraphStyle:null==t?void 0:t.build()}]}),this.insertRichText(s,cS.create({body:i,id:"d",documentStyle:{}})),this}insertLink(e,t,r){let n="",i="";"string"==typeof e?(n=e,i=t):(n=t,i=r);let s=cA.createByBody({dataStream:n,customRanges:[{rangeType:sx.HYPERLINK,rangeId:rK(),properties:{url:i},startIndex:0,endIndex:n.length-1}]});return"number"==typeof e?this.insertRichText(e,s):this.insertRichText(s)}}function cv(e,t=16){let r=0,n=null;return function(...i){let s=Date.now();s-r<t?(n&&clearTimeout(n),n=setTimeout(()=>{r=s,e.apply(this,i)},t)):(r=s,e.apply(this,i))}}var cT=((ej=cT||{})[ej.Style=1]="Style",ej[ej.Value=2]="Value",ej);function cw(e){return`sheet_interceptor_${e}`}let cM=e=>function(t,r){let n=-1,i=t;for(let t=0;t<=e.length;t++){if(t<=n)throw Error("[SheetInterceptorService]: next() called multiple times!");if(n=t,t===e.length)break;let s=e[t],a=!1;if(i=s.handler(i,r,e=>(a=!0,e)),!a)break}return i};class cO{constructor(e){tE(this,"_interceptorsByName",new Map),tE(this,"_interceptorPoints"),this._interceptorPoints=e}fetchThroughInterceptors(e,t){let r=this._interceptorsByName.get(e);return t&&(r=r.filter(t)),cM(r||[])}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);return r.push(t),this._interceptorsByName.set(e,r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)})),()=>tb(this._interceptorsByName.get(e),t)}getInterceptPoints(){return this._interceptorPoints}dispose(){this._interceptorsByName.clear()}}function cx(e){return`sheet_async_interceptor_${e}`}let cU=e=>async function(t,r){let n=-1,i=t;for(let t=0;t<=e.length;t++){if(t<=n)throw Error("[SheetInterceptorService]: next() called multiple times!");if(n=t,t===e.length)break;let s=e[t],a=!1;if(i=await s.handler(i,r,async e=>(a=!0,e)),!a)break}return i};class cD{constructor(e){tE(this,"_asyncInterceptorsByName",new Map),tE(this,"_asyncInterceptorPoints"),this._asyncInterceptorPoints=e}fetchThroughAsyncInterceptors(e,t){let r=this._asyncInterceptorsByName.get(e);return t&&(r=r.filter(t)),cU(r||[])}async interceptAsync(e,t){this._asyncInterceptorsByName.has(e)||this._asyncInterceptorsByName.set(e,[]);let r=this._asyncInterceptorsByName.get(e);return r.push(t),this._asyncInterceptorsByName.set(e,r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)})),()=>tb(this._asyncInterceptorsByName.get(e),t)}getInterceptPoints(){return this._asyncInterceptorPoints}dispose(){this._asyncInterceptorsByName.clear()}}function cV(e,t){for(let r in t)t.hasOwnProperty(r)&&(e[r]=t[r])}function cL(e){return/^-?\d+(\.\d+)?$/.test(e)}function cP(e){return!!cL(e)&&Number(e)<=Number.MAX_SAFE_INTEGER}class cF{constructor(){tE(this,"_data",[])}static create(){return new cF}add(e){this._data.indexOf(e)>-1||this._data.push(e)}delete(e){let t=this._data.indexOf(e);this._data.splice(t,1)}getData(){return this._data}}class ck{constructor(){tE(this,"_data",new Map)}static create(){return new ck}add(e,t){this._data.has(e)||this._data.set(e,t)}delete(e){this._data.delete(e)}getData(){return this._data}}function cj(e){let t=new MessageChannel,r=!1;return t.port1.onmessage=()=>{r||e()},t.port2.postMessage(null),()=>{r=!0,t.port1.onmessage=null,t.port1.close(),t.port2.close()}}function cB(e,t){return t.forEach(t=>e.add(t)),e}function c$(e,t,r,n){var i;let s;if(""===t)return e;let a=new cc({id:"mock-id",body:e,documentStyle:{}}),o=t.length;for(;(s=(n?a.getBody().dataStream:a.getBody().dataStream.toLowerCase()).indexOf(t))>=0;){let e=new cs,t=co.getInstance();if(s>0&&e.retain(s),r.length>0){let t=a.sliceBody(s,s+o),n={dataStream:r};Array.isArray(null==t?void 0:t.textRuns)&&t.textRuns.length&&(n.textRuns=[{...t.textRuns[0],st:0,ed:r.length}]),null!=(i=null==t?void 0:t.customRanges)&&i.length&&(n.customRanges=[{...t.customRanges[0],startIndex:0,endIndex:r.length-1}]),e.insert(r.length,n)}e.delete(o),a.apply(t.editOp(e.serialize()))}let l=a.getBody();return a.dispose(),l}let cH="__default_document_sub_component_id20231101__";class cW{constructor(){tE(this,"skipNextObservers",!1),tE(this,"lastReturnValue"),tE(this,"isStopPropagation",!1)}stopPropagation(){this.isStopPropagation=!0}}class cG extends tu.Subject{constructor(){super(...arguments),tE(this,"_sortedObservers",[])}subscribe(){throw Error("[EventSubject]: please use `subscribeEvent` instead of `subscribe` method for `EventSubject`.")}next(){throw Error("[EventSubject]: please use `emitEvent` instead of `next` method for `EventSubject`.")}unsubscribe(){super.unsubscribe(),this._sortedObservers.length=0}complete(){super.complete(),this._sortedObservers.length=0}subscribeEvent(e){let t;t="function"==typeof e?{next:([t,r])=>e(t,r)}:e;let r=super.subscribe(t);return this._sortedObservers.push(t),this._sortedObservers.sort((e,t)=>{var r,n;return(null!=(r=e.priority)?r:0)-(null!=(n=t.priority)?n:0)}),r.add(()=>this._sortedObservers=this._sortedObservers.filter(e=>e!==t)),r}clearObservers(){this._sortedObservers.forEach(e=>{var t;return null==(t=e.complete)?void 0:t.call(e)}),this._sortedObservers.length=0}emitEvent(e){var t;if(!this.closed){let r=new cW;for(let n of(r.lastReturnValue=e,this._sortedObservers)){let i=null==(t=n.next)?void 0:t.call(n,[e,r]);if(r.lastReturnValue=i,r.skipNextObservers)return{handled:!0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}return{handled:this._sortedObservers.length>0,lastReturnValue:r.lastReturnValue,stopPropagation:r.isStopPropagation}}throw Error("[EventSubject]: cannot emit event on a closed subject.")}}function cY(e){return new(0,ts.Observable)(t=>{let r=e.subscribeEvent(e=>{t.next(e)});return()=>r.unsubscribe()})}let cz=(0,tf.createIdentifier)("core.resource-manager.service"),cX={[lG.Editor]:"Editor",[lG.Owner]:"Owner",[lG.Reader]:"Reader",[lG.UNRECOGNIZED]:"UNRECOGNIZED"},cq=e=>e?{userID:`${cX[e]}_${rq.generateRandomId(8)}`,name:cX[e],avatar:""}:{userID:"",name:"",avatar:"",anonymous:!0,canBindAnonymous:!1},cK=(e,t)=>e.startsWith(cX[t]);class cQ{constructor(){tE(this,"_model",new Map),tE(this,"_userChange$",new(0,tu.Subject)),tE(this,"userChange$",this._userChange$.asObservable()),tE(this,"_currentUser$",new(0,e9.BehaviorSubject)(cq())),tE(this,"currentUser$",this._currentUser$.asObservable())}getCurrentUser(){return this._currentUser$.getValue()}setCurrentUser(e){this.addUser(e),this._currentUser$.next(e)}addUser(e){this._model.set(e.userID,e),this._userChange$.next({type:"add",user:e})}getUser(e,t){let r=this._model.get(e);if(r)return r;t&&t()}delete(e){let t=this.getUser(e);this._model.delete(e),t&&this._userChange$.next({type:"delete",user:t})}clear(){this._model.clear(),this._userChange$.next({type:"clear"})}list(){return Array.from(this._model.values())}}var cZ=Object.getOwnPropertyDescriptor,cJ=(e,t)=>(r,n)=>t(r,n,e);let c0=class{constructor(e,t){tE(this,"_permissionMap",new Map([])),this._resourceManagerService=e,this._userManagerService=t,this._initSnapshot(),this._initDefaultUser()}_initDefaultUser(){let e=this._userManagerService.getCurrentUser();e&&e.userID||this._userManagerService.setCurrentUser(cq(lG.Owner))}_getRole(e){let t=this._userManagerService.getCurrentUser();return!!t&&cK(t.userID,e)}_initSnapshot(){this._resourceManagerService.registerPluginResource({toJson:e=>JSON.stringify([...this._permissionMap.keys()].reduce((e,t)=>{let r=this._permissionMap.get(t);return e[t]=r,e},{})),parseJson:e=>JSON.parse(e),pluginName:"SHEET_AuthzIoMockService_PLUGIN",businesses:[lW.UNIVER_SHEET,lW.UNIVER_DOC,lW.UNIVER_SLIDE],onLoad:(e,t)=>{for(let e in t)this._permissionMap.set(e,t[e])},onUnLoad:()=>{this._permissionMap.clear()}})}async create(e){return rK(8)}async allowed(e){return Promise.resolve([])}async batchAllowed(e){return Promise.resolve([])}async list(e){let t=[];return e.objectIDs.forEach(r=>{let n=this._permissionMap.get(r);if(n){let i={objectID:r,unitID:e.unitID,objectType:n.objectType,name:n.name,shareOn:!1,shareRole:lG.Owner,shareScope:-1,scope:{read:lY.AllCollaborator,edit:lY.AllCollaborator},creator:cq(lG.Owner),strategies:[{action:6,role:1},{action:16,role:1},{action:17,role:1},{action:18,role:1},{action:19,role:1},{action:33,role:1},{action:34,role:1},{action:35,role:1},{action:36,role:1},{action:37,role:1},{action:38,role:1},{action:39,role:1},{action:40,role:1}],actions:e.actions.map(e=>({action:e,allowed:this._getRole(lG.Owner)||this._getRole(lG.Editor)}))};t.push(i)}}),t}async listCollaborators(){return[]}async listRoles(){return{roles:[],actions:[]}}async deleteCollaborator(){}async update(e){}async updateCollaborator(){}async createCollaborator(){}async putCollaborators(e){}};c0=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?cZ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([cJ(0,cz),cJ(1,(0,tf.Inject)(cQ))],c0);let c1=(0,tf.createIdentifier)("IAuthzIoIoService");var c2=Object.getOwnPropertyDescriptor;let c5=class{constructor(e){this._userManagerService=e}async list(e){return{list:[{type:r_.PERSON,mentions:[{objectType:r_.PERSON,objectId:this._userManagerService.getCurrentUser().userID,label:this._userManagerService.getCurrentUser().name,metadata:{icon:this._userManagerService.getCurrentUser().avatar}}],metadata:{},title:"PEOPLE"}],page:e.page,size:e.size,total:1}}};c5=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?c2(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(eB=(0,tf.Inject)(cQ),(e,t)=>eB(e,t,0))],c5);let c3=(0,tf.createIdentifier)("univer.service.mention-io"),c4=(0,tf.createIdentifier)("univer.config-service");class c6{constructor(){tE(this,"_configChanged$",new(0,tu.Subject)),tE(this,"configChanged$",this._configChanged$.asObservable()),tE(this,"_config",new Map)}dispose(){this._configChanged$.complete()}getConfig(e){return this._config.get(e)}setConfig(e,t,r){var n;let{merge:i=!1}=r||{},s=null!=(n=this._config.get(e))?n:{};s=i?lP(s,t):t,this._config.set(e,s),this._configChanged$.next({[e]:s})}deleteConfig(e){return this._config.delete(e)}subscribeConfigValue$(e){return new(0,ts.Observable)(t=>{Object.prototype.hasOwnProperty.call(this._config,e)&&t.next(this._config.get(e));let r=this.configChanged$.pipe((0,tt.filter)(t=>Object.prototype.hasOwnProperty.call(t,e))).subscribe(r=>t.next(r[e]));return()=>r.unsubscribe()})}}let c9="FOCUSING_UNIT",c8="FOCUSING_SHEET",c7="FOCUSING_DOC",he="FOCUSING_SLIDE",ht="FOCUSING_EDITOR_BUT_HIDDEN",hr="EDITOR_ACTIVATED",hn="FOCUSING_EDITOR_INPUT_FORMULA",hi="FOCUSING_FX_BAR_EDITOR",hs="FOCUSING_UNIVER_EDITOR",ha="FOCUSING_EDITOR_INPUT_FORMULA",ho="FOCUSING_PANEL_EDITOR",hl="FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE",hu="FOCUSING_COMMON_DRAWINGS",hc="FORMULA_EDITOR_ACTIVATED";class hh extends tP{constructor(){super(...arguments),tE(this,"_error$",new(0,tu.Subject)),tE(this,"error$",this._error$.asObservable())}dispose(){this._error$.complete()}emit(e){this._error$.next({errorKey:e})}}class hd{constructor(e={}){tE(this,"_styles"),tE(this,"_cacheMap",new so(1e5)),this._styles=e,this._generateCacheMap()}each(e){return Object.entries(this._styles).forEach(e),this}search(e,t){return this._cacheMap.has(t)?this._cacheMap.get(t):this._getExistingStyleId(e)||"-1"}get(e){return"string"!=typeof e?e:(e=String(e),this._styles[e])}add(e,t){let r=rq.generateRandomId(6);return this._styles[r]=e,this._cacheMap.set(t,r),r}setValue(e){if(null==e)return;let t=JSON.stringify(e),r=this.search(e,t);return"-1"!==r?r:this.add(e,t)}toJSON(){return this._styles}getStyleByCell(e){let t;t=e&&rq.isObject(e.s)?e.s:(null==e?void 0:e.s)&&this.get(e.s);let r=null==e?void 0:e.interceptorStyle;return r?{...t,...r}:t}_generateCacheMap(){let{_styles:e,_cacheMap:t}=this;for(let r in e){let n=JSON.stringify(e[r]);t.set(n,r)}}_getExistingStyleId(e){let{_styles:t}=this;for(let r in t)if(rq.diffValue(t[r],e))return r;return null}}let hm=(e,t)=>t.length===e.length&&!e.some(e=>t.some(t=>!aj.equals(t,e))),hg=(e,t)=>t.length===e.length&&e.every((e,r)=>{let n=t[r];return n.unitId===e.unitId&&n.sheetId===e.sheetId&&aj.equals(e.range,n.range)}),hf={t:0,b:2,l:2,r:2},hp=e=>({sbr:.6,sbo:e,spr:.6,spo:e});function hC(e,t,r={}){let n=e.length,{textRotation:i,paddingData:s,horizontalAlign:a=rT.UNSPECIFIED,verticalAlign:o=rw.UNSPECIFIED,wrapStrategy:l=rM.UNSPECIFIED,cellValueType:u}=r,{t:c,r:h,b:d,l:m}=s||hf,{vertexAngle:g,centerAngle:f}=hb(i);return new cc({id:"d",body:{dataStream:`${e}${sI}`,textRuns:[{ts:t,st:0,ed:n}],paragraphs:[{startIndex:n,paragraphStyle:{horizontalAlign:a}}],sectionBreaks:[{startIndex:n+1}]},documentStyle:{pageSize:{width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},marginTop:c,marginBottom:d,marginRight:h,marginLeft:m,renderConfig:{horizontalAlign:a,verticalAlign:o,centerAngle:f,vertexAngle:g,wrapStrategy:l,cellValueType:u,zeroWidthParagraphBreak:1}},drawings:{},drawingsOrder:[]})}function h_(e){if(!e)return{};let{ff:t,fs:r,it:n,bl:i,ul:s,st:a,ol:o,cl:l}=e,u={};return t&&(u.ff=t),r&&(u.fs=r),n&&(u.it=n),i&&(u.bl=i),s&&(u.ul=s),a&&(u.st=a),o&&(u.ol=o),l&&(u.cl=l),u}function hy(e,t,r){var n;let i=e.getBody();if(null!=(n=i.customRanges)&&n.some(e=>e.rangeType===sx.HYPERLINK))return;let s=c_.customRange.add({ranges:[{startOffset:0,endOffset:i.dataStream.length-1,collapsed:!1}],rangeId:r,rangeType:sx.HYPERLINK,body:i,properties:{url:t,refId:r}});s&&cs.apply(i,s.serialize())}function hE(e){return null!=e}function hR(e){let t=al.ff,r=al.fs;if(!e){let e=`${r}pt  ${t}`;return{fontCache:e,fontString:e,fontSize:r,originFontSize:r,fontFamily:t}}let n=sJ.ITALIC;(0===e.it||void 0===e.it)&&(n=sJ.NORMAL);let i=sJ.BOLD;(0===e.bl||void 0===e.bl)&&(i=sJ.NORMAL);let s=r;e.fs&&(s=Math.ceil(e.fs));let a=t;if(e.ff){let r=e.ff;(r=r.replace(/"/g,"").replace(/'/g,"")).indexOf(" ")>-1&&(r=`"${r}"`),null==r&&(r=t),a=r}let{va:o}=e,l=s;if(o===rU.SUBSCRIPT||o===rU.SUPERSCRIPT){var u;let{sbr:e,spr:t}=(u=0,hp(l));l*=o===rU.SUBSCRIPT?e:t}let c=`${n} ${i} ${l}pt ${a}`,h=`${c}, "Helvetica Neue", Helvetica, Arial, "PingFang SC", "Hiragino Sans GB", "Heiti SC", "Microsoft YaHei", "WenQuanYi Micro Hei", sans-serif `;return{fontCache:c,fontString:h,fontSize:l,originFontSize:s,fontFamily:a}}function hb(e){let{a:t=0,v:r=rD.FALSE}=e||{a:0,v:rD.FALSE},n=0,i=t;return r===rD.TRUE&&(n=90,i=90),{centerAngle:n,vertexAngle:i}}class hI{constructor(e,t){tE(this,"_columnData",{}),this._config=e,this._columnData=t}getColumnData(){return this._columnData}getColVisible(e){let{_columnData:t}=this,r=t[e];return!r||r.hd!==rD.TRUE}getColumnStyle(e){var t;return null==(t=this._columnData[e])?void 0:t.s}setColumnStyle(e,t){this.getColumnOrCreate(e).s=t}getHiddenCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&e?(n=!1,r.push({rangeType:nA.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):n||e||(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:nA.COLUMN}),r}getVisibleCols(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getColVisible(s);n&&!e?(n=!1,r.push({rangeType:nA.COLUMN,startColumn:i,endColumn:s-1,startRow:0,endRow:0})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:0,endRow:0,startColumn:i,endColumn:t,rangeType:nA.COLUMN}),r}getColumnDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getColumnOrCreate(i);r[n]=e,n++}return r}getSize(){return sd(this._columnData)}getColumnWidth(e){let{_columnData:t}=this,r=this._config;return(t[e]||{hd:rD.FALSE,w:r.defaultColumnWidth}).w||r.defaultColumnWidth}getColumn(e){let t=this._columnData[e];if(t)return t}removeColumn(e){delete this._columnData[e]}getColumnOrCreate(e){let{_columnData:t}=this,r=t[e];if(r)return r;let n={};return this._columnData[e]=n,n}setCustomMetadata(e,t){let r=this.getColumn(e);r&&(r.custom=t)}getCustomMetadata(e){var t;return null==(t=this.getColumn(e))?void 0:t.custom}}class hN{constructor(e,t,r){tE(this,"_rowData"),this._config=e,this._viewModel=t,this._rowData=r}getRowData(){return this._rowData}getRowStyle(e){var t;return null==(t=this._rowData[e])?void 0:t.s}setRowStyle(e,t){this.getRowOrCreate(e).s=t}getRowDatas(e,t){let r={},n=0;for(let i=e;i<e+t;i++){let e=this.getRowOrCreate(i);r[n]=e,n++}return r}getRowHeight(e,t=1){let{_rowData:r}=this,n=this._config,i=0;for(let s=0;s<t;s++){let{ia:t,ah:a,h:o=n.defaultRowHeight}=r[s+e]||{hd:rD.FALSE,h:n.defaultRowHeight};i+=(null==t||t===rD.TRUE)&&"number"==typeof a?a:o}return i}getRow(e){return this._rowData[e]}removeRow(e){delete this._rowData[e]}getRowOrCreate(e){let{_rowData:t}=this,r=t[e];if(r)return r;let n={};return t[e]=n,n}getHiddenRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:nA.ROW})):n||e||(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:nA.ROW}),r}getVisibleRows(e=0,t=this.getSize()-1){let r=[],n=!1,i=-1;for(let s=e;s<=t;s++){let e=this.getRowRawVisible(s);n&&!e?(n=!1,r.push({startRow:i,endRow:s-1,startColumn:0,endColumn:0,rangeType:nA.ROW})):!n&&e&&(n=!0,i=s)}return n&&r.push({startRow:i,endRow:t,startColumn:0,endColumn:0,rangeType:nA.ROW}),r}getRowRawVisible(e){let t=this.getRow(e);return!t||t.hd!==rD.TRUE}getSize(){return sd(this._rowData)}setCustomMetadata(e,t){let r=this.getRow(e);r&&(r.custom=t)}getCustomMetadata(e){var t;return null==(t=this.getRow(e))?void 0:t.custom}}let hS="DEFAULT_WORKSHEET_ROW_COUNT",hA=1e3,hv="DEFAULT_WORKSHEET_COLUMN_COUNT",hT=20,hw="DEFAULT_WORKSHEET_ROW_HEIGHT",hM=24,hO="DEFAULT_WORKSHEET_COLUMN_WIDTH",hx=88,hU="DEFAULT_WORKSHEET_ROW_TITLE_WIDTH",hD=46,hV="DEFAULT_WORKSHEET_COLUMN_TITLE_HEIGHT",hL=20;function hP(e){let t={name:"Sheet1",id:"sheet-01",tabColor:"",hidden:rD.FALSE,rowCount:hA,columnCount:hT,zoomRatio:1,freeze:{xSplit:0,ySplit:0,startRow:-1,startColumn:-1},scrollTop:0,scrollLeft:0,defaultColumnWidth:hx,defaultRowHeight:hM,mergeData:[],cellData:{},rowData:{},columnData:{},showGridlines:rD.TRUE,rowHeader:{width:hD,hidden:rD.FALSE},columnHeader:{height:hL,hidden:rD.FALSE},rightToLeft:rD.FALSE};return Object.keys(t).forEach(r=>{typeof e[r]>"u"&&(e[r]=t[r])}),e}class hF extends tP{constructor(e){super(),tE(this,"_cellCache",new Map),tE(this,"_rowCache",new Map),tE(this,"_columnCache",new Map),tE(this,"_hasRow",!1),tE(this,"_hasColumn",!1),tE(this,"_hasAll",!1),tE(this,"_allIndex",-1),tE(this,"_mergeData"),tE(this,"_rangeMap",new so(5e4)),tE(this,"_skeletonCache",new so(5e4)),this._init(e.concat())}_init(e){this._mergeData=e,this._createCache(e)}_clearCache(){this._cellCache.clear(),this._rowCache.clear(),this._columnCache.clear(),this._hasAll=!1,this._allIndex=-1,this._rangeMap.clear(),this._skeletonCache.clear(),this._hasColumn=!1,this._hasRow=!1}_createCache(e){let t=0;for(let r of e){let{rangeType:e}=r;e===nA.ROW?this._createRowCache(r,t):e===nA.COLUMN?this._createColumnCache(r,t):e===nA.ALL?this._createCellAllCache(t):this._createCellCache(r,t),t++}}rebuild(e){this._clearCache(),this._init(e.concat())}_createRowCache(e,t){let{startRow:r,endRow:n}=e;for(let e=r;e<=n;e++)this._rowCache.set(e,t),this._hasRow=!0}_createColumnCache(e,t){let{startColumn:r,endColumn:n}=e;for(let e=r;e<=n;e++)this._columnCache.set(e,t),this._hasColumn=!0}_createCellAllCache(e){this._hasAll=!0,this._allIndex=e}_createCellCache(e,t){for(let r=e.startRow;r<=e.endRow;r++){let n=this._cellCache.get(r);null==n&&(n=new Map,this._cellCache.set(r,n));for(let r=e.startColumn;r<=e.endColumn;r++)n.set(r,t)}}add(e){this._mergeData.push(e),this._clearCache(),this._createCache(this._mergeData)}remove(e,t){let r=this._getMergeDataIndex(e,t);-1!==r&&(this._mergeData.splice(r,1),this._clearCache(),this._createCache(this._mergeData))}getMergedCell(e,t){let r=this._getMergeDataIndex(e,t);return -1!==r?this._mergeData[r]:null}getMergeDataIndex(e,t){return this._getMergeDataIndex(e,t)}isRowContainsMergedCell(e){return!(!this._hasAll&&rq.isEmptyObject(this._columnCache))||this._mergeData.some(t=>t.startRow<=e&&e<=t.endRow)}isColumnContainsMergedCell(e){return!(!this._hasAll&&rq.isEmptyObject(this._rowCache))||this._mergeData.some(t=>t.startColumn<=e&&e<=t.endColumn)}getMergedCellRange(e,t,r,n){let i=[],s=`${e}-${t}-${r}-${n}`;if(this._rangeMap.has(s))return this._getRangeFromCache(s);let a=0,o=[];for(let s of this._mergeData||[])aj.intersects(s,{startRow:e,endRow:r,startColumn:t,endColumn:n})&&(i.push({...s}),o.push(a)),a++;return this._rangeMap.set(s,o),i}getMergedCellRangeForSkeleton(e,t,r,n){let i=[],s=this._mergeData,a=`${e}-${t}-${r}-${n}`;if(this._skeletonCache.has(a))return this._getSkeletonRangeFromCache(a);let o=[];for(let a=0;a<s.length;a++){let{startRow:l,endRow:u,startColumn:c,endColumn:h}=s[a];for(let s=e;s<=r;s++){let e=!1;for(let r=t;r<=n;r++)if(s>=l&&s<=u&&r>=c&&r<=h){i.push({startRow:l,endRow:u,startColumn:c,endColumn:h}),o.push(a),e=!0;break}if(e)break}}return this._skeletonCache.set(a,o),i}_getRangeFromCache(e){let t=this._rangeMap.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getSkeletonRangeFromCache(e){let t=this._skeletonCache.get(e)||[],r=[];for(let e of t)r.push({...this._mergeData[e]});return r}_getMergeDataIndex(e,t){var r;if(this._hasAll)return this._allIndex;if(this._hasRow){let t=this._rowCache.get(e);if(void 0!==t)return t}if(this._hasColumn){let e=this._columnCache.get(t);if(void 0!==e)return e}let n=null==(r=this._cellCache.get(e))?void 0:r.get(t);return void 0!==n?n:-1}getMergeDataSnapshot(){return this._mergeData}dispose(){this._clearCache(),this._mergeData=[]}}class hk extends tP{constructor(e){super(),tE(this,"_cellContentInterceptor",null),tE(this,"_rowFilteredInterceptor",null),this.getRawCell=e}dispose(){super.dispose(),this._cellContentInterceptor=null,this._rowFilteredInterceptor=null}getCell(e,t,r,n){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,cT.Value|cT.Style,r,n):this.getRawCell(e,t)}getCellValueOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,cT.Value):this.getRawCell(e,t)}getCellStyleOnly(e,t){return this._cellContentInterceptor?this._cellContentInterceptor.getCell(e,t,cT.Style):this.getRawCell(e,t)}getRowFiltered(e){var t,r;return null!=(r=null==(t=this._rowFilteredInterceptor)?void 0:t.getRowFiltered(e))&&r}registerCellContentInterceptor(e){if(this._cellContentInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._cellContentInterceptor=e,tD(()=>this._cellContentInterceptor=null)}registerRowFilteredInterceptor(e){if(this._rowFilteredInterceptor)throw Error("[SheetViewModel]: Interceptor already registered.");return this._rowFilteredInterceptor=e,tD(()=>this._rowFilteredInterceptor=null)}}let hj={isDeepClone:!1,displayRawFormula:!1,ignoreTextRotation:!1};class hB{constructor(e,t,r){var n;tE(this,"_sheetId"),tE(this,"_snapshot"),tE(this,"_cellData"),tE(this,"_rowManager"),tE(this,"_columnManager"),tE(this,"_viewModel"),tE(this,"_spanModel"),this.unitId=e,this._styles=r,this._snapshot=hP(t);let{columnData:i,rowData:s,cellData:a}=this._snapshot;this._sheetId=null!=(n=this._snapshot.id)?n:rq.generateRandomId(6),this._cellData=new s_(a),this._viewModel=new hk((e,t)=>this.getCellRaw(e,t)),this._rowManager=new hN(this._snapshot,this._viewModel,s),this._columnManager=new hI(this._snapshot,i),this._spanModel=new hF(this._snapshot.mergeData)}__interceptViewModel(e){e(this._viewModel)}getSnapshot(){return this._snapshot}setMergeData(e){this._snapshot.mergeData=e,this.getSpanModel().rebuild(e)}getSpanModel(){return this._spanModel}getStyleDataByHash(e){return{...this._styles.get(e)}}setStyleData(e){return this._styles.setValue(e)}getColumnStyle(e,t=!1){return t?this._columnManager.getColumnStyle(e):this._styles.get(this._columnManager.getColumnStyle(e))}setColumnStyle(e,t){this._columnManager.setColumnStyle(e,t)}getRowStyle(e,t=!1){return t?this._rowManager.getRowStyle(e):this._styles.get(this._rowManager.getRowStyle(e))}setRowStyle(e,t){this._rowManager.setRowStyle(e,t)}getDefaultCellStyle(){return this._snapshot.defaultStyle}getDefaultCellStyleInternal(){let e=this._snapshot.defaultStyle;return this._styles.get(e)}setDefaultCellStyle(e){this._snapshot.defaultStyle=e}getCellStyle(e,t){let r=this.getCell(e,t);if(r){let e=r.s;return"string"==typeof e?this._styles.get(e):e}return null}getComposedCellStyle(e,t,r=!0){let n=this.getCellStyle(e,t),i=this.getDefaultCellStyleInternal(),s=this.getRowStyle(e),a=this.getColumnStyle(t);return r?rQ(i,s,a,n):rQ(i,a,s,n)}getCellMatrix(){return this._cellData}getCellMatrixPrintRange(){let e=this.getCellMatrix(),t=this.getMergeData(),r=-1,n=-1,i=-1,s=-1,a=!1,o=!1;return e.forEach((t,l)=>{Object.keys(l).forEach(l=>{let u=+l,c=e.getValue(t,u),h=null!=c&&c.s?this._styles.get(c.s):null,d=(null==h?void 0:h.bd)&&(h.bd.b||h.bd.l||h.bd.r||h.bd.t||h.bd.bc_tr||h.bd.bl_tr||h.bd.ml_tr||h.bd.tl_bc||h.bd.tl_br||h.bd.tl_mr);(c&&(c.v||c.p)||null!=h&&h.bg||d)&&(a?r=Math.min(r,t):(r=t,a=!0),n=Math.max(n,t),o?i=Math.min(i,u):(o=!0,i=u),s=Math.max(s,u))})}),t.forEach(e=>{a?r=Math.min(r,e.startRow):(r=e.startRow,a=!0),n=Math.max(n,e.endRow),o?i=Math.min(i,e.startColumn):(i=e.startColumn,a=!0),s=Math.max(s,e.endColumn)}),a&&o?{startColumn:i,startRow:r,endColumn:s,endRow:n}:null}getRowManager(){return this._rowManager}getUnitId(){return this.unitId}getSheetId(){return this._sheetId}getColumnManager(){return this._columnManager}getName(){return this._snapshot.name}clone(){let{_snapshot:e}=this,t=rq.deepClone(e);return new hB(this.unitId,t,this._styles)}getMergeData(){return this._spanModel.getMergeDataSnapshot()}getMergedCell(e,t){return this._spanModel.getMergedCell(e,t)}getMergedCellRange(e,t,r,n){return this._spanModel.getMergedCellRange(e,t,r,n)}isRowContainsMergedCell(e){return this._spanModel.isRowContainsMergedCell(e)}isColumnContainsMergedCell(e){return this._spanModel.isColumnContainsMergedCell(e)}getCellInfoInMergeData(e,t){let r=this.getMergedCell(e,t),n=!1,i=!1,s=e,a=t,o=e,l=t;if(r){let{startRow:u,endRow:c,startColumn:h,endColumn:d}=r;e===u&&t===h?(s=c,a=d,o=u,l=h,i=!0):e>=u&&e<=c&&t>=h&&t<=d&&(s=c,a=d,o=u,l=h,n=!0)}return{actualRow:e,actualColumn:t,isMergedMainCell:i,isMerged:n,endRow:s,endColumn:a,startRow:o,startColumn:l}}getCell(e,t){return e<0||t<0?null:this._viewModel.getCell(e,t)}getCellValueOnly(e,t){return e<0||t<0?null:this._viewModel.getCellValueOnly(e,t)}getCellStyleOnly(e,t){return e<0||t<0?null:this._viewModel.getCellStyleOnly(e,t)}getCellRaw(e,t){return this.getCellMatrix().getValue(e,t)}getCellWithFilteredInterceptors(e,t,r,n){return this._viewModel.getCell(e,t,r,n)}getRowFiltered(e){return this._viewModel.getRowFiltered(e)}getMatrixWithMergedCells(e,t,r,n,i=nx.Raw){let s=this.getCellMatrix(),a=this._spanModel.getMergedCellRange(e,t,r,n),o=new s_;return aH(e,r,t,n).forEach((e,t)=>{var r;let n;if(i===nx.Raw)n=this.getCellRaw(e,t);else if(i===nx.Intercepted)n=this.getCell(e,t);else if(i===nx.Both){let i=this.getCellRaw(e,t);if(i){n={...i};let s=null==(r=this.getCell(e,t))?void 0:r.v;hE(s)&&n&&(n.displayV=String(s))}}n&&o.setValue(e,t,n)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;aH(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),rowSpan:i-r+1,colSpan:n-t+1}),(e!==r||a!==t)&&o.realDeleteValue(e,a)})}),o}getRange(e,t,r,n){return"object"==typeof e?new ay(this,e,{getStyles:()=>this._styles}):new ay(this,{startRow:e,startColumn:t,endColumn:n||t,endRow:r||e},{getStyles:()=>this._styles})}getScrollLeftTopFromSnapshot(){return{scrollLeft:this._snapshot.scrollLeft,scrollTop:this._snapshot.scrollTop}}getZoomRatio(){return this._snapshot.zoomRatio||1}getConfig(){return this._snapshot}getFreeze(){return this._snapshot.freeze}getMaxColumns(){let{_snapshot:e}=this,{columnCount:t}=e;return t}getMaxRows(){let{_snapshot:e}=this,{rowCount:t}=e;return t}getRowCount(){return this._snapshot.rowCount}setRowCount(e){this._snapshot.rowCount=e}getColumnCount(){return this._snapshot.columnCount}setColumnCount(e){this._snapshot.columnCount=e}isSheetHidden(){return this._snapshot.hidden}hasHiddenGridlines(){let{_snapshot:e}=this,{showGridlines:t}=e;return 0===t}getGridlinesColor(){return this.getConfig().gridlinesColor}getTabColor(){let{_snapshot:e}=this,{tabColor:t}=e;return t}getColumnWidth(e){return this.getColumnManager().getColumnWidth(e)}getRowHeight(e){return this._viewModel.getRowFiltered(e)?0:this.getRowManager().getRowHeight(e)}isRowFiltered(e){return this._viewModel.getRowFiltered(e)}getRowVisible(e){return!this.isRowFiltered(e)&&this.getRowRawVisible(e)}getRowRawVisible(e){return this.getRowManager().getRowRawVisible(e)}getHiddenRows(e,t){let r=this.getMaxColumns()-1,n=this._rowManager.getHiddenRows(e,t);return n.forEach(e=>e.endColumn=r),n}getColVisible(e){return this._columnManager.getColVisible(e)}getHiddenCols(e,t){let r=this.getMaxRows()-1,n=this._columnManager.getHiddenCols(e,t);return n.forEach(e=>e.endRow=r),n}getVisibleRows(){let e=this.getRowCount();return this._rowManager.getVisibleRows(0,e-1)}getVisibleCols(){let e=this.getColumnCount();return this._columnManager.getVisibleCols(0,e-1)}isRightToLeft(){let{_snapshot:e}=this,{rightToLeft:t}=e;return t}getLastRowWithContent(){return this._cellData.getLength()-1}getLastColumnWithContent(){return this._cellData.getRange().endColumn}getDataRangeScope(){return this._cellData.getStartEndScope()}cellHasValue(e){return e&&(void 0!==e.v||void 0!==e.f||void 0!==e.p)}iterateByRow(e,t=!0){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e,a=this;return{[Symbol.iterator]:()=>{let e=r,o=n;return{next(){for(;;){if(o>s&&(e+=1,o=n),e>i)return{done:!0,value:void 0};let r=a.getCell(e,o),l=!r,u=a.getMergedCell(e,o);if(u){if(e!==u.startRow||o!==u.startColumn||l&&t){o=u.endColumn+1;continue}let n={row:e,col:o,value:r};return n.colSpan=u.endColumn-u.startColumn+1,n.rowSpan=u.endRow-u.startRow+1,o=u.endColumn+1,{done:!1,value:n}}if(l&&t)o+=1;else{let t={row:e,col:o,value:r};return o+=1,{done:!1,value:t}}}}}}}}iterateByColumn(e,t=!0,r=!0){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e,o=this;return{[Symbol.iterator]:()=>{let e=n,l=i;return{next(){for(;;){if(e>s&&(l+=1,e=n),l>a)return{done:!0,value:void 0};let i=o.getMergedCell(e,l);if(i){let n=e!==i.startRow,s=n||l!==i.startColumn;if(r&&s||!r&&n){e=i.endRow+1;continue}let a=o.getCell(i.startRow,i.startColumn);if(!a&&t){e=i.endRow+1;continue}let u={row:e,col:i.startColumn,value:a};return u.colSpan=i.endColumn-i.startColumn+1,u.rowSpan=i.endRow-i.startRow+1,e=i.endRow+1,{done:!1,value:u}}let u=o.getCell(e,l);if(!u&&t)e+=1;else{let t={row:e,col:l,value:u};return e+=1,{done:!1,value:t}}}}}}}}_getCellDocumentModel(e,t=hj){var r;let{isDeepClone:n,displayRawFormula:i,ignoreTextRotation:s}={...hj,...t},a=this._styles.getStyleByCell(e);if(!e)return;let o,l="document",u=function(e){if(!e)return{};let{tr:t,td:r,ht:n,vt:i,tb:s,pd:a}=e;return{textRotation:t,textDirection:r,horizontalAlign:n,verticalAlign:i,wrapStrategy:s,paddingData:a}}(a),c=s?al.tr:u.textRotation||al.tr,h=u.horizontalAlign||al.ht,d=u.verticalAlign||al.vt,m=u.wrapStrategy||al.tb,g=u.paddingData||hf;if(e.f&&i)o=hC(e.f.toString(),{},{verticalAlign:d}),h=al.ht;else if(e.p){let{centerAngle:t,vertexAngle:r}=hb(c);o=this._updateConfigAndGetDocumentModel(n?rq.deepClone(e.p):e.p,h,g,{horizontalAlign:h,verticalAlign:d,centerAngle:t,vertexAngle:r,wrapStrategy:m,zeroWidthParagraphBreak:1})}else if(null!=e.v){let t=h_(a);l=hR(t).fontCache;let r=h$(e);e.t===rV.FORCE_STRING&&i&&(r=`'${r}`),o=hC(r,t,{...u,textRotation:c,cellValueType:e.t})}return o&&e.linkUrl&&e.linkId&&hy(o,e.linkUrl,e.linkId),{documentModel:o,fontString:l,textRotation:c,wrapStrategy:m,verticalAlign:d,horizontalAlign:h,paddingData:g,fill:null==(r=null==a?void 0:a.bg)?void 0:r.rgb}}_updateConfigAndGetDocumentModel(e,t,r,n){var i,s,a,o,l;if(n&&null!=(i=e.body)&&i.dataStream){for(let i of(e.documentStyle||(e.documentStyle={}),e.documentStyle.marginTop=null!=(s=r.t)?s:0,e.documentStyle.marginBottom=null!=(a=r.b)?a:2,e.documentStyle.marginLeft=null!=(o=r.l)?o:2,e.documentStyle.marginRight=null!=(l=r.r)?l:2,e.documentStyle.pageSize={width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},e.documentStyle.renderConfig={...e.documentStyle.renderConfig,...n},e.body.paragraphs||[]))i.paragraphStyle||(i.paragraphStyle={}),i.paragraphStyle.horizontalAlign=t;return new cc(e)}}getBlankCellDocumentModel(e){let t=this._getCellDocumentModel(e,{ignoreTextRotation:!0}),r=h_(this._styles.getStyleByCell(e));if(null!=t)return null==t.documentModel&&(t.documentModel=hC("",r)),t;let n="document",i=al.tr,s=al.ht,a=al.vt,o=al.tb;return n=hR({}).fontCache,{documentModel:hC("",r),fontString:n,textRotation:i,wrapStrategy:o,verticalAlign:a,horizontalAlign:s,paddingData:hf}}getCellDocumentModelWithFormula(e){return this._getCellDocumentModel(e,{isDeepClone:!0,displayRawFormula:!0,ignoreTextRotation:!0})}getCustomMetadata(){return this._snapshot.custom}setCustomMetadata(e){this._snapshot.custom=e}}function h$(e){var t,r;if(!e)return"";let n=null==(r=null==(t=e.p)?void 0:t.body)?void 0:r.dataStream;if(n)return c_.transform.getPlainText(n);let i=e.v;return"string"==typeof i?e.t===rV.BOOLEAN?i.toUpperCase():i.replace(/[\r\n]/g,""):"number"==typeof i?e.t===rV.BOOLEAN?i?"TRUE":"FALSE":i.toString():"boolean"==typeof i?i?"TRUE":"FALSE":""}function hH(e){if(null===e)return"";if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return"";let r=t.dataStream;return c_.transform.getPlainText(r)}return null==e?void 0:e.v}var hW=Object.getOwnPropertyDescriptor;function hG(e,t){return`${e.getUnitId()}|${t.getSheetId()}`}let hY=class extends lz{constructor(e={},t){super(),tE(this,"type",lW.UNIVER_SHEET),tE(this,"_sheetCreated$",new(0,tu.Subject)),tE(this,"sheetCreated$",this._sheetCreated$.asObservable()),tE(this,"_sheetDisposed$",new(0,tu.Subject)),tE(this,"sheetDisposed$",this._sheetDisposed$.asObservable()),tE(this,"_activeSheet$",new(0,e9.BehaviorSubject)(null)),tE(this,"activeSheet$",this._activeSheet$.asObservable()),tE(this,"_worksheets"),tE(this,"_styles"),tE(this,"_snapshot"),tE(this,"_unitId"),tE(this,"_count"),tE(this,"_name$"),tE(this,"name$"),this._logService=t;let r=function(e="",t=rC.ZH_CN,r=""){return{id:e,sheetOrder:[],name:r,appVersion:"0.7.0",locale:t,styles:{},sheets:{},resources:[]}}();rq.isEmptyObject(e)?this._snapshot=r:this._snapshot=rq.commonExtend(r,e);let{styles:n}=this._snapshot;(null==this._snapshot.id||0===this._snapshot.id.length)&&(this._snapshot.id=rq.generateRandomId(6)),this._unitId=this._snapshot.id,this._styles=new hd(n),this._count=1,this._worksheets=new Map,this._name$=new(0,e9.BehaviorSubject)(e.name||""),this.name$=this._name$.asObservable(),this._parseWorksheetSnapshots()}get _activeSheet(){return this._activeSheet$.getValue()}get name(){return this._name$.getValue()}static isIRangeType(e){return"string"==typeof e||"startRow"in e||"row"in e}dispose(){super.dispose(),this._sheetCreated$.complete(),this._sheetDisposed$.complete(),this._activeSheet$.complete(),this._name$.complete()}save(){return rq.deepClone(this._snapshot)}getSnapshot(){return this._snapshot}getName(){return this._snapshot.name}setName(e){this._name$.next(e),this._snapshot.name=e}getUnitId(){return this._unitId}getRev(){var e;return null!=(e=this._snapshot.rev)?e:1}incrementRev(){this._snapshot.rev=this.getRev()+1}setRev(e){this._snapshot.rev=e}addWorksheet(e,t,r){let{sheets:n,sheetOrder:i}=this._snapshot;if(n[e])return!1;n[e]=r,i.splice(t,0,e);let s=new hB(this._unitId,r,this._styles);return this._worksheets.set(e,s),this._sheetCreated$.next(s),!0}getSheetOrders(){return this._snapshot.sheetOrder}getWorksheets(){return this._worksheets}getActiveSpreadsheet(){return this}getStyles(){return this._styles}getConfig(){return this._snapshot}getIndexBySheetId(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>t===e)}getActiveSheet(e){if(!this._activeSheet&&typeof e>"u")throw Error(`[Workbook]: no active Worksheet on Workbook ${this._unitId}!`);return this._activeSheet}ensureActiveSheet(){let e=this._activeSheet;if(e)return e;let t=this._snapshot.sheetOrder;for(let e=0,r=t.length;e<r;e++){let r=this._worksheets.get(t[e]);if(r&&r.isSheetHidden()!==rD.TRUE)return this.setActiveSheet(r),r}let r=this._worksheets.get(t[0]);return this.setActiveSheet(r),r}setActiveSheet(e){this._activeSheet$.next(e)}removeSheet(e){let t=this._worksheets.get(e);return!!t&&(this._worksheets.delete(e),this._snapshot.sheetOrder.splice(this._snapshot.sheetOrder.indexOf(e),1),delete this._snapshot.sheets[e],this._sheetDisposed$.next(t),!0)}getActiveSheetIndex(){let{sheetOrder:e}=this._snapshot;return e.findIndex(e=>this._worksheets.get(e)===this._activeSheet)}getSheetSize(){return this._snapshot.sheetOrder.length}getSheets(){let{sheetOrder:e}=this._snapshot;return e.map(e=>this._worksheets.get(e))}getSheetsName(){let{sheetOrder:e}=this._snapshot,t=[];return e.forEach(e=>{let r=this._worksheets.get(e);r&&t.push(r.getName())}),t}getSheetIndex(e){let{sheetOrder:t}=this._snapshot;return t.findIndex(t=>e.getSheetId()===t)}getSheetBySheetName(e){let{sheetOrder:t}=this._snapshot,r=t.find(t=>this._worksheets.get(t).getName()===e);return this._worksheets.get(r)}getSheetBySheetId(e){return this._worksheets.get(e)}getSheetByIndex(e){let{sheetOrder:t}=this._snapshot;return this._worksheets.get(t[e])}getHiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden===rD.TRUE).map(e=>e.getConfig().id)}getUnhiddenWorksheets(){return this.getSheets().filter(e=>e.getConfig().hidden!==rD.TRUE).map(e=>e.getConfig().id)}load(e){this._snapshot=e}checkSheetName(e){return this.getSheetsName().includes(e)}uniqueSheetName(e="Sheet1"){let t=e;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}generateNewSheetName(e){let t=e+this._count;for(;this.checkSheetName(t);)t=e+this._count,this._count++;return t}_parseWorksheetSnapshots(){let{_snapshot:e,_worksheets:t}=this,{sheets:r,sheetOrder:n}=e;if(rq.isEmptyObject(r)){let e=rq.generateRandomId();r[e]={id:e}}for(let e in r){let i=r[e],{name:s}=i;i.name=this.uniqueSheetName(s),i.name!==s&&this._logService.debug("[Workbook]",`The worksheet name ${s} is duplicated, we changed it to ${i.name}. Please fix the problem in your snapshot.`);let a=new hB(this._unitId,i,this._styles);t.set(e,a),n.includes(e)||n.push(e)}this.ensureActiveSheet()}getCustomMetadata(){return this._snapshot.custom}setCustomMetadata(e){this._snapshot.custom=e}};hY=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?hW(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>tH(e,t,1)],hY);class hz extends lz{constructor(e){var t;super(),tE(this,"type",lW.UNIVER_SLIDE),tE(this,"_activePage$",new(0,e9.BehaviorSubject)(null)),tE(this,"activePage$",this._activePage$.asObservable()),tE(this,"_name$"),tE(this,"name$"),tE(this,"_snapshot"),tE(this,"_unitId"),this._snapshot={...au,...e},this._unitId=null!=(t=this._snapshot.id)?t:rq.generateRandomId(6),this._name$=new(0,e9.BehaviorSubject)(this._snapshot.title),this.name$=this._name$.asObservable()}get _activePage(){var e,t;let r=this._activePage$.getValue();if(!r){let r=null==(e=this.getPageOrder())?void 0:e[0];return r?null==(t=this.getPages())?void 0:t[r]:null}return r}setName(e){var t;this._snapshot.title=e,this._name$.next(e),this._unitId=null!=(t=this._snapshot.id)?t:rK(6)}getRev(){return 0}incrementRev(){}setRev(e){}getSnapshot(){return this._snapshot}getUnitId(){return this._unitId}getPages(){var e;return null==(e=this._snapshot.body)?void 0:e.pages}getPageOrder(){var e;return null==(e=this._snapshot.body)?void 0:e.pageOrder}getPage(e){let t=this.getPages();return null==t?void 0:t[e]}getElementsByPage(e){var t;return null==(t=this.getPage(e))?void 0:t.pageElements}getElement(e,t){var r;return null==(r=this.getElementsByPage(e))?void 0:r[t]}getPageSize(){return this._snapshot.pageSize}getBlankPage(){let e=rK(6);return{id:e,pageType:at.SLIDE,zIndex:10,title:e,description:"",pageBackgroundFill:{rgb:"rgb(255,255,255)"},pageElements:{}}}setActivePage(e){this._activePage$.next(e)}getActivePage(){return this._activePage}updatePage(e,t){this._snapshot.body&&(this._snapshot.body.pages[e]=t)}appendPage(e){var t;if(!this._snapshot.body)return;this._snapshot.body.pages[e.id]=e;let r=this._activePage,n=this._snapshot.body.pageOrder.indexOf(null!=(t=null==r?void 0:r.id)?t:"");this._snapshot.body.pageOrder.splice(n+1,0,e.id)}}var hX=Object.getOwnPropertyDescriptor,hq=(e,t)=>(r,n)=>t(r,n,e);let hK=(0,tf.createIdentifier)("univer.current"),hQ=class extends tP{constructor(e,t){super(),tE(this,"_unitsByType",new Map),tE(this,"_createHandler"),tE(this,"_ctorByType",new Map),tE(this,"_currentUnits",new Map),tE(this,"_currentUnits$",new(0,e9.BehaviorSubject)(this._currentUnits)),tE(this,"currentUnits$",this._currentUnits$.asObservable()),tE(this,"_unitAdded$",new(0,tu.Subject)),tE(this,"unitAdded$",this._unitAdded$.asObservable()),tE(this,"_unitDisposed$",new(0,tu.Subject)),tE(this,"unitDisposed$",this._unitDisposed$.asObservable()),tE(this,"_focused$",new(0,e9.BehaviorSubject)(null)),tE(this,"focused$",this._focused$.asObservable()),this._injector=e,this._contextService=t}dispose(){super.dispose(),this._focused$.complete()}__setCreateHandler(e){this._createHandler=e}createUnit(e,t,r){return this._createHandler(e,t,this._ctorByType.get(e),r)}registerCtorForType(e,t){return this._ctorByType.set(e,t),{dispose:()=>{this._ctorByType.delete(e)}}}getCurrentTypeOfUnit$(e){return this.currentUnits$.pipe((0,tn.map)(t=>{var r;return null!=(r=t.get(e))?r:null}),(0,te.distinctUntilChanged)())}getCurrentUnitForType(e){return this._currentUnits.get(e)}getCurrentUnitOfType(e){return this.getCurrentUnitForType(e)}setCurrentUnitForType(e){let t=this._getUnitById(e);if(!t)throw Error(`[UniverInstanceService]: no document with unitId ${e}!`);this._currentUnits.set(t[1],t[0]),this._currentUnits$.next(this._currentUnits)}getTypeOfUnitAdded$(e){return this._unitAdded$.pipe((0,tt.filter)(t=>t.type===e))}__addUnit(e,t){var r;let n=e.type;this._unitsByType.has(n)||this._unitsByType.set(n,[]);let i=this._unitsByType.get(n),s=e.getUnitId();if(-1!==i.findIndex(e=>e.getUnitId()===s))throw Error(`[UniverInstanceService]: cannot create a unit with the same unit id: ${s}.`);i.push(e),this._unitAdded$.next(e),(null==(r=null==t?void 0:t.makeCurrent)||r)&&this.setCurrentUnitForType(e.getUnitId())}getTypeOfUnitDisposed$(e){return this.unitDisposed$.pipe((0,tt.filter)(t=>t.type===e))}getUnit(e,t){var r;let n=null==(r=this._getUnitById(e))?void 0:r[0];return t&&(null==n?void 0:n.type)!==t?null:n}getCurrentUniverDocInstance(){return this.getCurrentUnitForType(lW.UNIVER_DOC)}getUniverDocInstance(e){return this.getUnit(e,lW.UNIVER_DOC)}getUniverSheetInstance(e){return this.getUnit(e,lW.UNIVER_SHEET)}getAllUnitsForType(e){var t;return null!=(t=this._unitsByType.get(e))?t:[]}changeDoc(e,t){let r=this.getAllUnitsForType(lW.UNIVER_DOC),n=r.find(t=>t.getUnitId()===e);if(null!=n){let e=r.indexOf(n);r.splice(e,1)}this.__addUnit(t)}get focused(){var e;let t=this._focused$.getValue();return t?null==(e=this._getUnitById(t))?void 0:e[0]:null}focusUnit(e){this._focused$.next(e),this.focused instanceof hY?(this._contextService.setContextValue(c9,!0),this._contextService.setContextValue(c7,!1),this._contextService.setContextValue(c8,!0),this._contextService.setContextValue(he,!1),this.setCurrentUnitForType(e)):this.focused instanceof cc?(this._contextService.setContextValue(c9,!0),this._contextService.setContextValue(c7,!0),this._contextService.setContextValue(c8,!1),this._contextService.setContextValue(he,!1),this.setCurrentUnitForType(e)):this.focused instanceof hz?(this._contextService.setContextValue(c9,!0),this._contextService.setContextValue(c7,!1),this._contextService.setContextValue(c8,!1),this._contextService.setContextValue(he,!0),this.setCurrentUnitForType(e)):(this._contextService.setContextValue(c9,!1),this._contextService.setContextValue(c7,!1),this._contextService.setContextValue(c8,!1),this._contextService.setContextValue(he,!1))}getFocusedUnit(){return this.focused}getUnitType(e){let t=this._getUnitById(e);return t?t[1]:lW.UNRECOGNIZED}disposeUnit(e){let t=this._getUnitById(e);if(!t)return!1;let[r,n]=t,i=this._unitsByType.get(n),s=i.indexOf(r);return i.splice(s,1),this._tryResetCurrentOnRemoval(e,n),this._tryResetFocusOnRemoval(e),this._unitDisposed$.next(r),!0}_tryResetCurrentOnRemoval(e,t){let r=this.getCurrentUnitForType(t);(null==r?void 0:r.getUnitId())===e&&(this._currentUnits.set(t,null),this._currentUnits$.next(this._currentUnits))}_tryResetFocusOnRemoval(e){var t;(null==(t=this.focused)?void 0:t.getUnitId())===e&&this._focused$.next(null)}_getUnitById(e){for(let[t,r]of this._unitsByType){let n=r.find(t=>t.getUnitId()===e);if(n)return[n,t]}}};hQ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?hX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([hq(0,(0,tf.Inject)(tf.Injector)),hq(1,tj)],hQ);var hZ=((e$=hZ||{})[e$.Starting=0]="Starting",e$[e$.Ready=1]="Ready",e$[e$.Rendered=2]="Rendered",e$[e$.Steady=3]="Steady",e$);let hJ={0:"Starting",1:"Ready",2:"Rendered",3:"Steady"};var h0=Object.getOwnPropertyDescriptor;let h1=class extends tP{constructor(e){super(),tE(this,"_lifecycle$",new(0,e9.BehaviorSubject)(hZ.Starting)),tE(this,"lifecycle$",this._lifecycle$.asObservable()),tE(this,"_lock",!1),this._logService=e,this._reportProgress(hZ.Starting)}get stage(){return this._lifecycle$.getValue()}set stage(e){if(this._lock)throw Error("[LifecycleService]: cannot set new stage when related logic is all handled!");if(e<this.stage)throw Error("[LifecycleService]: lifecycle stage cannot go backward!");e!==this.stage&&(this._lock=!0,this._reportProgress(e),this._lifecycle$.next(e),this._lock=!1)}dispose(){this._lifecycle$.complete(),super.dispose()}onStage(e){return(0,tr.firstValueFrom)(this.lifecycle$.pipe((0,tt.filter)(t=>t>=e),t2(t=>t===e),(0,tn.map)(()=>{})))}subscribeWithPrevious(){return(0,ti.merge)(h2(this.stage),this._lifecycle$.pipe((0,tl.skip)(1))).pipe(t2(e=>e===hZ.Steady))}_reportProgress(e){this._logService.debug("[LifecycleService]",`lifecycle progressed to "${hJ[e]}".`)}};function h2(e){switch(e){case hZ.Starting:return(0,ta.of)(hZ.Starting);case hZ.Ready:return(0,ta.of)(hZ.Starting,hZ.Ready);case hZ.Rendered:return(0,ta.of)(hZ.Starting,hZ.Ready,hZ.Rendered);default:return(0,ta.of)(hZ.Starting,hZ.Ready,hZ.Rendered,hZ.Steady)}}h1=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?h0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>tH(e,t,0)],h1);let h5=(0,tf.createIdentifier)("ILocalStorageService");class h3 extends tP{constructor(){super(),tE(this,"_currentLocale$",new(0,e9.BehaviorSubject)(rC.ZH_CN)),tE(this,"currentLocale$",this._currentLocale$.asObservable()),tE(this,"_locales",null),tE(this,"localeChanged$",new(0,tu.Subject)),tE(this,"t",(e,...t)=>{if(!this._locales)throw Error("[LocaleService]: Locale not initialized");let r=e.split("."),n=this.resolveKeyPath(this._locales[this._currentLocale],r);if("string"!=typeof n)return e;{let e=n;return t.forEach((t,r)=>{e=e.replace(`{${r}}`,t)}),e}}),this.disposeWithMe(tD(()=>this.localeChanged$.complete()))}get _currentLocale(){return this._currentLocale$.value}load(e){var t;this._locales=lP(null!=(t=this._locales)?t:{},e)}setLocale(e){this._currentLocale$.next(e),this.localeChanged$.next()}getLocales(){var e;return null==(e=this._locales)?void 0:e[this._currentLocale]}getCurrentLocale(){return this._currentLocale}resolveKeyPath(e,t){let r=t.shift();if(r&&e&&r in e){let n=e[r];return t.length>0&&("object"==typeof n||Array.isArray(n))?this.resolveKeyPath(n,t):n}return null}}var h4=((eH=h4||{}).INIT="init",eH.FETCHING="fetching",eH.DONE="done",eH);let h6=(0,tf.createIdentifier)("univer.permission-service");class h9 extends tP{constructor(){super(...arguments),tE(this,"_permissionPointMap",new Map),tE(this,"_permissionPointUpdate$",new(0,tu.Subject)),tE(this,"permissionPointUpdate$",this._permissionPointUpdate$.asObservable()),tE(this,"_showComponents",!0)}setShowComponents(e){this._showComponents=e}getShowComponents(){return this._showComponents}deletePermissionPoint(e){let t=this._permissionPointMap.get(e);t&&(t.complete(),this._permissionPointMap.delete(e))}addPermissionPoint(e){let t=e instanceof e9.BehaviorSubject,r=t?e.getValue():e;if(!r.id)return!1;if(this._permissionPointMap.get(r.id))throw Error(`${r.id} PermissionPoint already exists`);return this._permissionPointMap.set(r.id,t?e:new(0,e9.BehaviorSubject)(r)),this._permissionPointUpdate$.next(r),!0}updatePermissionPoint(e,t){let r=this._permissionPointMap.get(e);if(!r)return;let n=r.getValue();n.value=t,n.status=h4.DONE,r.next(n),this._permissionPointUpdate$.next(n)}clearPermissionMap(){this._permissionPointMap.clear()}getPermissionPoint(e){let t=this._permissionPointMap.get(e);if(t)return t.getValue()}getPermissionPoint$(e){let t=this._permissionPointMap.get(e);if(t)return t}composePermission$(e){let t=e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.asObservable()});return(0,e8.combineLatest)(t).pipe((0,tn.map)(e=>e))}composePermission(e){return e.map(e=>{var t;let r=null==(t=this._permissionPointMap)?void 0:t.get(e);if(!r)throw Error(`[PermissionService]: ${e} permissionPoint does not exist!`);return r.getValue()})}getAllPermissionPoint(){let e=new Map;return this._permissionPointMap.forEach((t,r)=>{e.set(r,t)}),e}}var h8=Object.getOwnPropertyDescriptor,h7=(e,t)=>(r,n)=>t(r,n,e);let de=Symbol("DependentOn");class dt extends tP{onStarting(){}onReady(){}onRendered(){}onSteady(){}getUnitType(){return this.constructor.type}getPluginName(){return this.constructor.pluginName}}tE(dt,"pluginName"),tE(dt,"type",lW.UNIVER_UNKNOWN);class dr{constructor(){tE(this,"_plugins",[])}addPlugin(e){this._plugins.push(e)}removePlugins(){let e=this._plugins.slice();return this._plugins.length=0,e}forEachPlugin(e){this._plugins.forEach(e)}}function dn(...e){return function(t){t[de]=e}}let di=class{constructor(e,t,r){tE(this,"_pluginRegistry",new Map),tE(this,"_pluginStore",new dr),tE(this,"_seenPlugins",new Set),tE(this,"_loadedPlugins",new Set),tE(this,"_loadedPluginTypes",new Set([lW.UNIVER_UNKNOWN])),tE(this,"_flushTimerByType",new Map),this._injector=e,this._lifecycleService=t,this._logService=r}dispose(){this._pluginStore.removePlugins().forEach(e=>e.dispose()),this._flushTimerByType.forEach(e=>clearTimeout(e))}registerPlugin(e,t){this._assertPluginValid(e);let r={plugin:e,options:t};this._pluginRegistry.set(e.pluginName,r),this._logService.debug("[PluginService]",`Plugin "${e.pluginName}" registered.`);let{type:n}=e;this._loadedPluginTypes.has(n)&&(n===lW.UNIVER_UNKNOWN?this._loadFromPlugins([r]):this._flushType(n))}startPluginsForType(e){this._loadedPluginTypes.has(e)||this._loadPluginsForType(e)}_loadPluginsForType(e){let t=Array.from(this._pluginRegistry.keys()),r=[];t.forEach(t=>{let n=this._pluginRegistry.get(t);n.plugin.type===e&&r.push(n)}),this._loadFromPlugins(r),this._loadedPluginTypes.add(e)}_assertPluginValid(e){let{type:t,pluginName:r}=e;if(t===lW.UNRECOGNIZED)throw Error(`[PluginService]: invalid plugin type for ${e.name}. Please assign a "type" to your plugin.`);if(!r)throw Error(`[PluginService]: no plugin name for ${e.name}. Please assign a "pluginName" to your plugin.`);if(this._seenPlugins.has(r))throw Error(`[PluginService]: duplicated plugin name for "${r}". Maybe a plugin that dependents on "${r} has already registered it. In that case please register "${r}" before the that plugin.`);this._seenPlugins.add(e.pluginName)}_flushType(e){void 0===this._flushTimerByType.get(e)&&this._flushTimerByType.set(e,setTimeout(()=>{this._loadPluginsForType(e),this._flushTimerByType.delete(e)},4))}_loadFromPlugins(e){let t=[],r=new Set,n=e=>{let{plugin:i}=e,{pluginName:s}=i;if(this._loadedPlugins.has(s)||r.has(s))return;r.add(s),this._pluginRegistry.delete(s);let a=i[de];a&&a.forEach(e=>{let t=this._pluginRegistry.get(e.pluginName);if(t)n(t);else if(!this._seenPlugins.has(e.pluginName)&&!r.has(e.pluginName)){if(i.type===lW.UNIVER_UNKNOWN&&e.type!==lW.UNIVER_UNKNOWN)throw Error(`[PluginService]: cannot register a plugin with Univer type that depends on a plugin with other type. The dependent is ${i.pluginName} and the dependency is ${e.pluginName}.`);i.type!==e.type&&e.type!==lW.UNIVER_UNKNOWN&&this._logService.debug("[PluginService]",`Plugin "${s}" depends on "${e.pluginName}" which has different type.`),this._logService.debug("[PluginService]",`Plugin "${s}" depends on "${e.pluginName}" which is not registered. Univer will automatically register it with default configuration.`),this._assertPluginValid(e),n({plugin:e,options:void 0})}}),t.push(e)};e.forEach(e=>n(e));let i=t.map(e=>this._initPlugin(e.plugin,e.options));this._pluginsRunLifecycle(i)}_pluginsRunLifecycle(e){let t=this._lifecycleService.stage;if(h2(t).subscribe(t=>this._runStage(e,t)),t!==hZ.Steady){let t=this._lifecycleService.lifecycle$.pipe((0,tl.skip)(1)).subscribe(r=>{this._runStage(e,r),r===hZ.Steady&&t.unsubscribe()})}}_runStage(e,t){e.forEach(e=>{switch(t){case hZ.Starting:e.onStarting();break;case hZ.Ready:e.onReady();break;case hZ.Rendered:e.onRendered();break;case hZ.Steady:e.onSteady()}})}_initPlugin(e,t){let r=this._injector.createInstance(e,t);return this._pluginStore.addPlugin(r),this._loadedPlugins.add(e.pluginName),this._logService.debug("[PluginService]",`Plugin "${r.getPluginName()}" loaded.`),r}};function ds(e,t){if(!t)return e;let r=[];for(let n of e){let e=t.find(([e])=>e===n[0]);if(e){if(null===e[1])continue;r.push([n[0],e[1]])}else r.push(n)}return r}di=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?h8(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([h7(0,(0,tf.Inject)(tf.Injector)),h7(1,(0,tf.Inject)(h1)),h7(2,tH)],di);let da=(0,tf.createIdentifier)("resource-loader-service");class dl extends tP{constructor(){super(...arguments),tE(this,"_resourceMap",new Map),tE(this,"_register$",new(0,tu.Subject)),tE(this,"register$",this._register$.asObservable())}getAllResourceHooks(){return[...this._resourceMap.values()]}getResources(e,t){return t?this.getResourcesByType(e,t):this.getAllResourceHooks().map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}getResourcesByType(e,t){return this.getAllResourceHooks().filter(e=>e.businesses.includes(t)).map(t=>{let r=t.toJson(e);return{name:t.pluginName,data:r}})}registerPluginResource(e){let t=e.pluginName;if(this._resourceMap.has(t))throw Error(`the pluginName is registered {${t}}`);return this._resourceMap.set(t,e),this._register$.next(e),tD(()=>this._resourceMap.delete(t))}disposePluginResource(e){this._resourceMap.delete(e)}loadResources(e,t){this.getAllResourceHooks().forEach(r=>{var n;let i=null==(n=null==t?void 0:t.find(e=>e.name===r.pluginName))?void 0:n.data;if(i)try{let t=r.parseJson(i);r.onLoad(e,t)}catch{console.error("LoadResources Error!")}})}unloadResources(e){this.getAllResourceHooks().forEach(t=>{t.onUnLoad(e)})}dispose(){this._register$.complete(),this._resourceMap.clear()}}class du extends tP{constructor(){super(),tE(this,"_darkMode$",new(0,e9.BehaviorSubject)(!1)),tE(this,"darkMode$",this._darkMode$.asObservable()),tE(this,"_currentTheme",tp.defaultTheme),tE(this,"_currentTheme$",new(0,e9.BehaviorSubject)(this._currentTheme)),tE(this,"currentTheme$",this._currentTheme$.asObservable()),this.disposeWithMe(tD(()=>{this._currentTheme$.complete(),this._darkMode$.complete()}))}get darkMode(){return this._darkMode$.getValue()}getCurrentTheme(){return this._currentTheme}setTheme(e){this._currentTheme=e,this._currentTheme$.next(e)}setDarkMode(e){this._darkMode$.next(e)}getColorFromTheme(e){return lC(this._currentTheme,e)}}var dc=Object.getOwnPropertyDescriptor,dh=(e,t)=>(r,n)=>t(r,n,e);let dd=(0,tf.createIdentifier)("univer.undo-redo.service");class dm{dispose(){}async dispatchToHandlers(){return!1}}let dg="univer.command.redo",df="univer.command.undo",dp=new class extends dm{constructor(){super(...arguments),tE(this,"type",tz.COMMAND),tE(this,"id",df)}handler(e){let t=e.get(dd),r=t.pitchTopUndoElement();if(!r)return!1;let n=e.get(tX);return!!tJ(r.undoMutations,n)&&(t.popUndoToRedo(),!0)}},dC=new class extends dm{constructor(){super(...arguments),tE(this,"type",tz.COMMAND),tE(this,"id",dg)}handler(e){let t=e.get(dd),r=t.pitchTopRedoElement();if(!r)return!1;let n=e.get(tX);return!!tJ(r.redoMutations,n)&&(t.popRedoToUndo(),!0)}},d_=class extends tP{constructor(e,t,r){super(),tE(this,"undoRedoStatus$"),tE(this,"_undoRedoStatus$",new(0,e9.BehaviorSubject)({undos:0,redos:0})),tE(this,"_undoStacks",new Map),tE(this,"_redoStacks",new Map),tE(this,"_batchingStatus",new Map),this._univerInstanceService=e,this._commandService=t,this._contextService=r,this.undoRedoStatus$=this._undoRedoStatus$.asObservable(),this.disposeWithMe(this._commandService.registerCommand(dp)),this.disposeWithMe(this._commandService.registerCommand(dC)),this.disposeWithMe(tD(()=>this._undoRedoStatus$.complete())),this.disposeWithMe(tD(this._univerInstanceService.focused$.subscribe(()=>this._updateStatus())))}pushUndoRedo(e){let{unitID:t}=e,r=this._getRedoStack(t,!0),n=this._getUndoStack(t,!0);if(r.length=0,this._batchingStatus.has(e.unitID)){let t=this._batchingStatus.get(e.unitID),r=this._pitchUndoElement(e.unitID);0!==t&&r?this._tryBatchingElements(r,e):(i(e),this._batchingStatus.set(e.unitID,1))}else i(e);function i(e){n.push(e),n.length>20&&n.splice(0,1)}this._updateStatus()}clearUndoRedo(e){let t=this._getRedoStack(e);t&&(t.length=0);let r=this._getUndoStack(e);r&&(r.length=0),this._updateStatus()}pitchTopUndoElement(){let e=this._getFocusedUnitId();return this._pitchUndoElement(e)}pitchTopRedoElement(){let e=this._getFocusedUnitId();return this._pitchRedoElement(e)}_pitchUndoElement(e){let t=this._getUndoStack(e);return null!=t&&t.length?t[t.length-1]:null}_pitchRedoElement(e){let t=this._getRedoStack(e);return null!=t&&t.length?t[t.length-1]:null}popUndoToRedo(){let e=this._getUndoStackForFocused().pop();e&&(this._getRedoStackForFocused().push(e),this._updateStatus())}popRedoToUndo(){let e=this._getRedoStackForFocused().pop();e&&(this._getUndoStackForFocused().push(e),this._updateStatus())}rollback(e,t){let r=t||this._getFocusedUnitId(),n=this._getUndoStack(r),i=null==n?void 0:n[(null==n?void 0:n.length)-1];i&&i.id===e&&(n.pop(),tJ(i.undoMutations,this._commandService))}__tempBatchingUndoRedo(e){if(this._batchingStatus.has(e))throw Error("[LocalUndoRedoService]: cannot batching undo redo twice at the same time!");return this._batchingStatus.set(e,0),tD(()=>this._batchingStatus.delete(e))}_updateStatus(){var e,t;let r=this._getFocusedUnitId(),n=r&&(null==(e=this._undoStacks.get(r))?void 0:e.length)||0,i=r&&(null==(t=this._redoStacks.get(r))?void 0:t.length)||0;this._undoRedoStatus$.next({undos:n,redos:i})}_getUndoStack(e,t=!1){let r=this._undoStacks.get(e);return!r&&t&&(r=[],this._undoStacks.set(e,r)),r||null}_getRedoStack(e,t=!1){let r=this._redoStacks.get(e);return!r&&t&&(r=[],this._redoStacks.set(e,r)),r||null}_getUndoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getUndoStack(e,!0)}_getRedoStackForFocused(){let e=this._getFocusedUnitId();if(!e)throw Error("No focused univer instance!");return this._getRedoStack(e,!0)}_tryBatchingElements(e,t){e.redoMutations.push(...t.redoMutations),e.undoMutations.push(...t.undoMutations)}_getFocusedUnitId(){var e,t,r,n;let i=this._contextService.getContextValue(c8),s=this._contextService.getContextValue(hi),a=this._contextService.getContextValue(hr);return i?s?sR:a?sE:null!=(t=null==(e=this._univerInstanceService.getFocusedUnit())?void 0:e.getUnitId())?t:"":null!=(n=null==(r=this._univerInstanceService.getFocusedUnit())?void 0:r.getUnitId())?n:""}};function dy(e){return!(0===e.length||e.length>31||e.startsWith("'")||e.endsWith("'")||/[:\\\/\?\*\[\]]/.test(e))}function dE(e){return new Promise(t=>setTimeout(t,e))}function dR(e=1){return new Promise(t=>{let r=0,n=()=>{++r>=e?t():requestAnimationFrame(n)};requestAnimationFrame(n)})}d_=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?dc(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([dh(0,hK),dh(1,tX),dh(2,tj)],d_);var db=((eW=db||{}).URL="URL",eW.UUID="UUID",eW.BASE64="BASE64",eW),dI=((eG=dI||{}).SUCCUSS="0",eG.ERROR_EXCEED_SIZE="1",eG.ERROR_IMAGE_TYPE="2",eG.ERROR_UPLOAD_COUNT_LIMIT="3",eG.ERROR_IMAGE="4",eG);let dN=(0,tf.createIdentifier)("core.image-io.service");class dS{constructor(e,t=100){tE(this,"_imageCacheMap"),this._injector=e,this._imageCacheMap=new so(t)}_getImageCacheKey(e,t){return`${e}-${t}`}getImage(e,t,r,n){let i=this._getImageCacheKey(e,t),s=this._imageCacheMap.get(i);return s||((async()=>{s=new Image;let a=this._injector.has(dN)?this._injector.get(dN):null;if(e===db.UUID)try{s.src=await (null==a?void 0:a.getImage(t))||""}catch(e){console.error(e)}else s.src=t;s.onload=()=>{null==r||r()},s.onerror=()=>{null==n||n()},this._imageCacheMap.set(i,s)})(),null)}}let dA=["script","style","meta","comment","link"];var dv=((eY=dv||{})[eY.INFO=0]="INFO",eY[eY.STOP=1]="STOP",eY[eY.WARNING=2]="WARNING",eY),dT=((ez=dT||{})[ez.DISABLED=0]="DISABLED",ez[ez.FULL_ALPHA=1]="FULL_ALPHA",ez[ez.FULL_HANGUL=2]="FULL_HANGUL",ez[ez.FULL_KATAKANA=3]="FULL_KATAKANA",ez[ez.HALF_ALPHA=4]="HALF_ALPHA",ez[ez.HALF_HANGUL=5]="HALF_HANGUL",ez[ez.HALF_KATAKANA=6]="HALF_KATAKANA",ez[ez.HIRAGANA=7]="HIRAGANA",ez[ez.NO_CONTROL=8]="NO_CONTROL",ez[ez.OFF=9]="OFF",ez[ez.ON=10]="ON",ez),dw=((eX=dw||{}).BETWEEN="between",eX.EQUAL="equal",eX.GREATER_THAN="greaterThan",eX.GREATER_THAN_OR_EQUAL="greaterThanOrEqual",eX.LESS_THAN="lessThan",eX.LESS_THAN_OR_EQUAL="lessThanOrEqual",eX.NOT_BETWEEN="notBetween",eX.NOT_EQUAL="notEqual",eX),dM=((eq=dM||{})[eq.TEXT=0]="TEXT",eq[eq.ARROW=1]="ARROW",eq[eq.CUSTOM=2]="CUSTOM",eq),dO=((eK=dO||{}).VALID="valid",eK.INVALID="invalid",eK.VALIDATING="validating",eK),dx=((eQ=dx||{}).CUSTOM="custom",eQ.LIST="list",eQ.LIST_MULTIPLE="listMultiple",eQ.NONE="none",eQ.TEXT_LENGTH="textLength",eQ.DATE="date",eQ.TIME="time",eQ.WHOLE="whole",eQ.DECIMAL="decimal",eQ.CHECKBOX="checkbox",eQ.ANY="any",eQ),dU=Object.getOwnPropertyDescriptor;let dD=class extends tP{constructor(e){super(),tE(this,"_fontLocale"),tE(this,"_dirty",!0),this._localeService=e,this._localeInitial()}get dirty(){return this._dirty}getFontLocale(){return this._fontLocale}makeDirty(e){this._dirty=e}dispose(){super.dispose(),this._fontLocale=null}_localeInitial(){}};dD=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?dU(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(eZ=(0,tf.Inject)(h3),(e,t)=>eZ(e,t,0))],dD);var dV=Object.getOwnPropertyDescriptor,dL=(e,t)=>(r,n)=>t(r,n,e);let dP=class extends dD{constructor(e,t,r,n,i,s){super(r),tE(this,"_worksheetData"),tE(this,"_renderRawFormula",!1),tE(this,"_cellData"),tE(this,"_imageCacheMap"),tE(this,"_isRowStylePrecedeColumnStyle",!1),tE(this,"_skipAutoHeightForMergedCells",!0),tE(this,"_rowTotalHeight",0),tE(this,"_columnTotalWidth",0),tE(this,"_rowHeaderWidth",0),tE(this,"_columnHeaderHeight",0),tE(this,"_rowHeightAccumulation",[]),tE(this,"_columnWidthAccumulation",[]),tE(this,"_marginTop",0),tE(this,"_marginLeft",0),tE(this,"_scaleX"),tE(this,"_scaleY"),tE(this,"_scrollX"),tE(this,"_scrollY"),this.worksheet=e,this._styles=t,this._contextService=n,this._configService=i,this._injector=s,this._worksheetData=this.worksheet.getConfig(),this._cellData=this.worksheet.getCellMatrix(),this._imageCacheMap=new dS(this._injector),this.initConfig()}initConfig(){var e,t;this._skipAutoHeightForMergedCells=!(null!=(e=this._configService.getConfig(sS))&&e),this._isRowStylePrecedeColumnStyle=null!=(t=this._configService.getConfig(sN))&&t}resetCache(){}getWorksheetConfig(){return this._worksheetData}getLocation(){return[this.worksheet.getUnitId(),this.worksheet.getSheetId()]}set columnHeaderHeight(e){this._columnHeaderHeight=e,this._worksheetData.columnHeader.height=e}set rowHeaderWidth(e){this._rowHeaderWidth=e,this._worksheetData.rowHeader.width=e}get rowHeightAccumulation(){return this._rowHeightAccumulation}get rowTotalHeight(){return this._rowTotalHeight}get columnWidthAccumulation(){return this._columnWidthAccumulation}get columnTotalWidth(){return this._columnTotalWidth}get rowHeaderWidth(){return this._rowHeaderWidth}get columnHeaderHeight(){return this._columnHeaderHeight}setMarginLeft(e){this._marginLeft=e}setMarginTop(e){this._marginTop=e}setScale(e,t){this._updateLayout(),this._scaleX=e,this._scaleY=t||e,this._updateLayout()}setScroll(e,t){rq.isDefine(e)&&(this._scrollX=e),rq.isDefine(t)&&(this._scrollY=t)}get scrollX(){return this._scrollX}get scrollY(){return this._scrollY}get scaleX(){return this._scaleX}get scaleY(){return this._scaleY}get rowHeaderWidthAndMarginLeft(){return this.rowHeaderWidth+this._marginLeft}get columnHeaderHeightAndMarginTop(){return this.columnHeaderHeight+this._marginTop}get imageCacheMap(){return this._imageCacheMap}_generateRowMatrixCache(e,t,r){let n=0,i=[];for(let s=0;s<e;s++){let e=r;if(this.worksheet.getRowFiltered(s))e=0;else if(null!=t[s]){let n=t[s];if(!n)continue;let{h:i=r,ah:a,ia:o}=n;e=(null==o||o===rD.TRUE)&&"number"==typeof a?a:i,n.hd===rD.TRUE&&(e=0)}n+=e,i.push(n)}return{rowTotalHeight:n,rowHeightAccumulation:i}}_generateColumnMatrixCache(e,t,r){let n=0,i=[];for(let s=0;s<e;s++){let e=r;if(null!=t[s]){let r=t[s];if(!r)continue;null!=r.w&&(e=r.w),r.hd===rD.TRUE&&(e=0)}n+=e,i.push(n)}return{columnTotalWidth:n,columnWidthAccumulation:i}}intersectMergeRange(e,t){return!!this.worksheet.getMergedCell(e,t)}_getOverflowBound(e,t,r,n,i=rT.LEFT){let s=0;if(t>r){let a=this._columnWidthAccumulation.length-1;for(let o=t;o>=r;o--){let r=o;if(!nP(this.worksheet.getCell(e,r))&&r!==t||this.intersectMergeRange(e,r))return r===t?r:r+1>a?a:r+1;let{startX:l,endX:u}=dj(e,r,this.rowHeightAccumulation,this.columnWidthAccumulation);if(i===rT.CENTER&&r===t?s+=(u-l)/2:s+=u-l,n<s)return r}return t}for(let a=t;a<=r;a++){let r=a;if(!nP(this.worksheet.getCell(e,r))&&r!==t||this.intersectMergeRange(e,r))return r===t?r:r-1<0?0:r-1;let{startX:o,endX:l}=dj(e,r,this.rowHeightAccumulation,this.columnWidthAccumulation);if(i===rT.CENTER&&r===t?s+=(l-o)/2:s+=l-o,n<s)return r}return r}_updateLayout(){if(!this.dirty)return;let{rowData:e,columnData:t,defaultRowHeight:r,defaultColumnWidth:n,rowCount:i,columnCount:s,rowHeader:a,columnHeader:o}=this._worksheetData,{rowTotalHeight:l,rowHeightAccumulation:u}=this._generateRowMatrixCache(i,e,r),{columnTotalWidth:c,columnWidthAccumulation:h}=this._generateColumnMatrixCache(s,t,n);this._rowHeaderWidth=a.hidden!==rD.TRUE?this._dynamicallyUpdateRowHeaderWidth(a):0,this._columnHeaderHeight=o.hidden!==rD.TRUE?o.height:0,this._rowTotalHeight=l,this._rowHeightAccumulation=u,this._columnTotalWidth=c,this._columnWidthAccumulation=h,this.makeDirty(!1)}calculate(){return this.resetCache(),this._updateLayout(),this}resetRangeCache(e){}_dynamicallyUpdateRowHeaderWidth(e){let t=8*`${this.worksheet.getRowCount()}`.length;return Math.max(e.width,t)}_hasUnMergedCellInRow(e,t,r){if(!this.worksheet.getMergeData())return!1;for(let n=t;n<=r;n++){let{isMerged:t,isMergedMainCell:r}=this.worksheet.getCellInfoInMergeData(e,n);if(!t&&!r)return!0}return!1}expandRangeByMerge(e){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=e,s=this._worksheetData.mergeData;if(!s)return{startRow:t,startColumn:r,endRow:n,endColumn:i};let a=!0,o=new s_;for(;a;){a=!1;for(let e=0;e<s.length;e++){let{startRow:l,startColumn:u,endRow:c,endColumn:h}=s[e];!o.getValue(l,u)&&aL({startColumn:r,startRow:t,endColumn:i,endRow:n},{startColumn:u,startRow:l,endColumn:h,endRow:c})&&(t=Math.min(t,l),r=Math.min(r,u),n=Math.max(n,c),i=Math.max(i,h),o.setValue(l,u,!0),a=!0)}}return{startRow:t,startColumn:r,endRow:n,endColumn:i}}getColumnCount(){return this._columnWidthAccumulation.length}getRowCount(){return this._rowHeightAccumulation.length}_getCellMergeInfo(e,t){return this.worksheet.getCellInfoInMergeData(e,t)}getNoMergeCellPositionByIndex(e,t,r=!0){return this.getNoMergeCellWithCoordByIndex(e,t,r)}getNoMergeCellWithCoordByIndex(e,t,r=!0){let{rowHeightAccumulation:n,columnWidthAccumulation:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:a}=this,{startY:o,endY:l,startX:u,endX:c}=dj(e,t,n,i);return r&&(o+=a,l+=a,u+=s,c+=s),{startY:o,endY:l,startX:u,endX:c}}getNoMergeCellPositionByIndexWithNoHeader(e,t){let{rowHeightAccumulation:r,columnWidthAccumulation:n}=this,{startY:i,endY:s,startX:a,endX:o}=dj(e,t,r,n);return{startY:i,endY:s,startX:a,endX:o}}getRowIndexByOffsetY(e,t,r,n){var i;let{rowHeightAccumulation:s}=this,a=re(s,e=d$(e,t,r,this.columnHeaderHeightAndMarginTop),null==n?void 0:n.firstMatch);return null!=n&&n.closeFirst&&Math.abs(s[a]-e)<Math.abs(e-(null!=(i=s[a-1])?i:0))&&(a+=1),a}getColumnIndexByOffsetX(e,t,r,n){var i;let s=dB(e,t,r,this.rowHeaderWidthAndMarginLeft),{columnWidthAccumulation:a}=this,o=re(a,s,null==n?void 0:n.firstMatch);return null!=n&&n.closeFirst&&Math.abs(a[o]-s)<Math.abs(s-(null!=(i=a[o-1])?i:0))&&(o+=1),o}getCellIndexByOffset(e,t,r,n,i,s){return{row:this.getRowIndexByOffsetY(t,n,i,s),column:this.getColumnIndexByOffsetX(e,r,i,s)}}getCellByOffset(e,t,r,n,i){let s=this==null?void 0:this.getCellIndexByOffset(e,t,r,n,i,{firstMatch:!0});return s?this.worksheet.getCellInfoInMergeData(s.row,s.column):null}getCellWithCoordByIndex(e,t,r=!0){let{rowHeightAccumulation:n,columnWidthAccumulation:i,rowHeaderWidthAndMarginLeft:s,columnHeaderHeightAndMarginTop:a}=this,o=dj(e,t,n,i,this.worksheet.getCellInfoInMergeData(e,t)),{isMerged:l,isMergedMainCell:u}=o,{startY:c,endY:h,startX:d,endX:m,mergeInfo:g}=o,f=s,p=a;return!1===r&&(f=0,p=0),c+=p,h+=p,d+=f,m+=f,g.startY+=p,g.endY+=p,g.startX+=f,g.endX+=f,{actualRow:e,actualColumn:t,startX:d,startY:c,endX:m,endY:h,isMerged:l,isMergedMainCell:u,mergeInfo:g}}getCellWithCoordByOffset(e,t,r,n,i,s){let{row:a,column:o}=this.getCellIndexByOffset(e,t,r,n,i,s);return this.getCellWithCoordByIndex(a,o)}getOffsetByColumn(e){let{columnWidthAccumulation:t,rowHeaderWidthAndMarginLeft:r}=this,n=t.length-1,i=t[e];return null!=i?i+r:e<0?r:t[n]+r}getOffsetByRow(e){let{rowHeightAccumulation:t,columnHeaderHeightAndMarginTop:r}=this,n=t.length-1,i=t[e];return null!=i?i+r:e<0?r:t[n]+r}getOffsetRelativeToRowCol(e,t){let r=re(this.columnWidthAccumulation,e),n=0;n=0===r?e:e-this._columnWidthAccumulation[r-1];let i=re(this.rowHeightAccumulation,t),s=0;return s=0===i?t:t-this._rowHeightAccumulation[i-1],{row:i,column:r,columnOffset:n,rowOffset:s}}_updateConfigAndGetDocumentModel(e,t,r,n){var i,s,a,o,l;if(n&&null!=(i=e.body)&&i.dataStream){for(let i of(e.documentStyle||(e.documentStyle={}),e.documentStyle.marginTop=null!=(s=r.t)?s:0,e.documentStyle.marginBottom=null!=(a=r.b)?a:2,e.documentStyle.marginLeft=null!=(o=r.l)?o:2,e.documentStyle.marginRight=null!=(l=r.r)?l:2,e.documentStyle.pageSize={width:Number.POSITIVE_INFINITY,height:Number.POSITIVE_INFINITY},e.documentStyle.renderConfig={...e.documentStyle.renderConfig,...n},e.body.paragraphs||[]))i.paragraphStyle||(i.paragraphStyle={}),i.paragraphStyle.horizontalAlign=t;return new cc(e)}}dispose(){super.dispose(),this._rowHeightAccumulation=[],this._columnWidthAccumulation=[],this._rowTotalHeight=0,this._columnTotalWidth=0,this._rowHeaderWidth=0,this._columnHeaderHeight=0,this._worksheetData=null,this._cellData=null,this._styles=null}};function dF(e,t,r,n){let i=r[e-1]||0,s=r[e];null==s&&(s=r[r.length-1]);let a=n[t-1]||0,o=n[t];return null==o&&(o=n[n.length-1]),{startY:i,endY:s,startX:a,endX:o}}function dk(e,t,r,n){return dF(e,t,r,n)}function dj(e,t,r,n,i){let{startY:s,endY:a,startX:o,endX:l}=dF(e=rq.clamp(e,0,r.length-1),t=rq.clamp(t,0,n.length-1),r,n);if(!i)return{startY:s,endY:a,startX:o,endX:l,isMerged:!1,isMergedMainCell:!1,actualRow:e,actualColumn:t,mergeInfo:{startY:s,endY:a,startX:o,endX:l,startRow:e,startColumn:t,endRow:e,endColumn:t}};let{isMerged:u,isMergedMainCell:c,startRow:h,startColumn:d,endRow:m,endColumn:g}=i,f={startRow:h,startColumn:d,endRow:m,endColumn:g,startY:s,endY:a,startX:o,endX:l},p=r.length-1,C=n.length-1;if(u&&-1!==h&&-1!==d){let e=r[h-1]||0,t=r[m]||r[p],i=n[d-1]||0,s=n[g]||n[C];f={...f,startY:e,endY:t,startX:i,endX:s}}else if(!u&&-1!==m&&-1!==g){let e=r[m]||r[p],t=n[g]||n[C];f={...f,startY:s,endY:e,startX:o,endX:t}}return{isMerged:u,isMergedMainCell:c,actualRow:e,actualColumn:t,startY:s,endY:a,startX:o,endX:l,mergeInfo:f}}function dB(e,t,r,n){let{x:i}=r;return e/t+i-n}function d$(e,t,r,n){let{y:i}=r;return e=e/t+i-n}dP=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?dV(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([dL(2,(0,tf.Inject)(h3)),dL(3,tj),dL(4,c4),dL(5,(0,tf.Inject)(tf.Injector))],dP);let dH=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class dW{static from(e){if(!(e instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[t,r]=new Uint8Array(e,0,2);if(219!==t)throw Error("Data does not appear to be in a KDBush format.");let n=r>>4;if(1!==n)throw Error(`Got v${n} data when expected v1.`);let i=dH[15&r];if(!i)throw Error("Unrecognized array type.");let[s]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new dW(a,s,i,e)}constructor(e,t=64,r=Float64Array,n){if(isNaN(e)||e<0)throw Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let i=dH.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,o=(8-a%8)%8;if(i<0)throw Error(`Unexpected typed array class: ${r}.`);n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+a+o),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+o,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){let r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){let e=this._pos>>1;if(e!==this.numItems)throw Error(`Added ${e} items when expected ${this.numItems}.`);return function e(t,r,n,i,s,a){if(s-i<=n)return;let o=i+s>>1;(function e(t,r,n,i,s,a){for(;s>i;){if(s-i>600){let o=s-i+1,l=n-i+1,u=Math.log(o),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(o-c)/o)*(l-o/2<0?-1:1),d=Math.max(i,Math.floor(n-l*c/o+h)),m=Math.min(s,Math.floor(n+(o-l)*c/o+h));e(t,r,n,d,m,a)}let o=r[2*n+a],l=i,u=s;for(dG(t,r,i,n),r[2*s+a]>o&&dG(t,r,i,s);l<u;){for(dG(t,r,l,u),l++,u--;r[2*l+a]<o;)l++;for(;r[2*u+a]>o;)u--}r[2*i+a]===o?dG(t,r,i,u):dG(t,r,++u,s),u<=n&&(i=u+1),n<=u&&(s=u-1)}})(t,r,o,i,s,a),e(t,r,n,i,o-1,1-a),e(t,r,n,o+1,s,1-a)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:i,coords:s,nodeSize:a}=this,o=[0,i.length-1,0],l=[];for(;o.length;){let u=o.pop()||0,c=o.pop()||0,h=o.pop()||0;if(c-h<=a){for(let a=h;a<=c;a++){let o=s[2*a],u=s[2*a+1];o>=e&&o<=r&&u>=t&&u<=n&&l.push(i[a])}continue}let d=h+c>>1,m=s[2*d],g=s[2*d+1];m>=e&&m<=r&&g>=t&&g<=n&&l.push(i[d]),(0===u?e<=m:t<=g)&&(o.push(h),o.push(d-1),o.push(1-u)),(0===u?r>=m:n>=g)&&(o.push(d+1),o.push(c),o.push(1-u))}return l}within(e,t,r){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:n,coords:i,nodeSize:s}=this,a=[0,n.length-1,0],o=[],l=r*r;for(;a.length;){let u=a.pop()||0,c=a.pop()||0,h=a.pop()||0;if(c-h<=s){for(let r=h;r<=c;r++)dz(i[2*r],i[2*r+1],e,t)<=l&&o.push(n[r]);continue}let d=h+c>>1,m=i[2*d],g=i[2*d+1];dz(m,g,e,t)<=l&&o.push(n[d]),(0===u?e-r<=m:t-r<=g)&&(a.push(h),a.push(d-1),a.push(1-u)),(0===u?e+r>=m:t+r>=g)&&(a.push(d+1),a.push(c),a.push(1-u))}return o}}function dG(e,t,r,n){dY(e,r,n),dY(t,2*r,2*n),dY(t,2*r+1,2*n+1)}function dY(e,t,r){let n=e[t];e[t]=e[r],e[r]=n}function dz(e,t,r,n){let i=e-r,s=t-n;return i*i+s*s}class dX{constructor(e=!1){tE(this,"_tree",new Map),tE(this,"_oneCellCache",new Map),tE(this,"_kdTree",new Map),this._enableOneCellCache=e}dispose(){this.clear()}getTree(e,t){return this._tree.has(e)||this._tree.set(e,new Map),this._tree.get(e).has(t)||this._tree.get(e).set(t,new aR),this._tree.get(e).get(t)}_getOneCellCache(e,t,r,n){return this._oneCellCache.has(e)||this._oneCellCache.set(e,new Map),this._oneCellCache.get(e).has(t)||this._oneCellCache.get(e).set(t,new Map),this._oneCellCache.get(e).get(t).has(r)||this._oneCellCache.get(e).get(t).set(r,new Map),this._oneCellCache.get(e).get(t).get(r).has(n)||this._oneCellCache.get(e).get(t).get(r).set(n,new Set),this._oneCellCache.get(e).get(t).get(r).get(n)}_removeOneCellCache(e,t,r,n,i){let s=this._oneCellCache.get(e);if(!s)return;let a=s.get(t);if(!a)return;let o=a.get(r);if(!o)return;let l=o.get(n);l&&l.delete(i)}_removeCellCacheByRange(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this._oneCellCache.get(t);if(!s)return;let a=s.get(r);if(!a)return;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=n;for(let e=o;e<=u;e++){let t=a.get(e);if(t)for(let e=l;e<=c;e++){let r=t.get(e);r&&r.delete(i)}}}_insertOneCellCache(e,t,r,n,i){this._getOneCellCache(e,t,r,n).add(i)}_getRdTreeItems(e){let t=[];for(let[r,n]of e)for(let[e,i]of n)t.push({x:e,y:r,ids:i});return t}_searchByOneCellCache(e){var t;let{unitId:r,sheetId:n,range:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=i,u=null==(t=this._kdTree.get(r))?void 0:t.get(n);if(!u)return[];let{tree:c,items:h}=u,d=c.range(a,s,l,o),m=[];for(let e of d){let t=h[e];m.push(...Array.from(t.ids))}return m}openKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of(this._kdTree.has(t)||this._kdTree.set(t,new Map),r)){let r=this._getRdTreeItems(i),s=new dW(r.length);for(let i of(null==(e=this._kdTree.get(t))||e.set(n,{tree:s,items:r}),r))s.add(i.x,i.y);s.finish()}}closeKdTree(){var e;for(let[t,r]of this._oneCellCache)for(let[n,i]of r)null==(e=this._kdTree.get(t))||e.set(n,void 0)}insert(e){let{unitId:t,sheetId:r,range:n,id:i}=e;if(!t||0===t.length)return;let{startRow:s,endRow:a,startColumn:o,endColumn:l}=n;if(this._enableOneCellCache&&s===a&&o===l)return void this._insertOneCellCache(t,r,s,o,i);let u=this.getTree(t,r);Number.isNaN(s)&&(s=0),Number.isNaN(o)&&(o=0),Number.isNaN(a)&&(a=Number.POSITIVE_INFINITY),Number.isNaN(l)&&(l=Number.POSITIVE_INFINITY),u.insert({minX:o,minY:s,maxX:l,maxY:a,id:i})}bulkInsert(e){for(let t of e)this.insert(t)}*searchGenerator(e){var t;let{unitId:r,sheetId:n,range:i}=e;if(this._enableOneCellCache)for(let t of this._searchByOneCellCache(e))yield t;let s=null==(t=this._tree.get(r))?void 0:t.get(n);if(s)for(let e of s.search({minX:i.startColumn,minY:i.startRow,maxX:i.endColumn,maxY:i.endRow}))yield e.id}bulkSearch(e,t){let r=new Set;for(let n of e)for(let e of this.searchGenerator(n))(null==t?void 0:t.has(e))!==!0&&r.add(e);return r}removeById(e,t){var r,n;t?(null==(r=this._tree.get(e))||r.delete(t),null==(n=this._oneCellCache.get(e))||n.delete(t)):(this._tree.delete(e),this._oneCellCache.delete(e))}_removeRTreeItem(e){let{unitId:t,sheetId:r,range:n,id:i}=e,s=this.getTree(t,r),a=s.search({minX:n.startColumn,minY:n.startRow,maxX:n.endColumn,maxY:n.endRow});for(let e=0;e<a.length;e++)a[e].id===i&&s.remove(a[e])}remove(e){let{unitId:t,sheetId:r,range:n,id:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=n;this._enableOneCellCache?s===o&&a===l?this._removeOneCellCache(t,r,n.startRow,n.startColumn,i):(this._removeCellCacheByRange(e),this._removeRTreeItem(e)):this._removeRTreeItem(e)}bulkRemove(e){for(let t of e)this.remove(t)}clear(){this._tree.clear(),this._oneCellCache.clear()}toJSON(){let e={};return this._tree.forEach((t,r)=>{e[r]={},t.forEach((t,n)=>{e[r][n]=t.toJSON()})}),e}fromJSON(e){for(let t in this._tree.clear(),e)for(let r in this._tree.set(t,new Map),e[t]){let n=new aR;n.fromJSON(e[t][r]),this._tree.get(t).set(r,n)}}}var dq=Object.getOwnPropertyDescriptor,dK=(e,t)=>(r,n)=>t(r,n,e);let dQ=class extends tP{constructor(e,t){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._init()}_init(){let e=e=>{e.businesses.forEach(t=>{switch(t){case lW.UNRECOGNIZED:case lW.UNIVER_UNKNOWN:case lW.UNIVER_SLIDE:case lW.UNIVER_DOC:this._univerInstanceService.getAllUnitsForType(lW.UNIVER_DOC).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Document{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}});break;case lW.UNIVER_SHEET:this._univerInstanceService.getAllUnitsForType(lW.UNIVER_SHEET).forEach(t=>{let r=(t.getSnapshot().resources||[]).find(t=>t.name===e.pluginName);if(r)try{let n=e.parseJson(r.data);e.onLoad(t.getUnitId(),n)}catch{console.error(`Load Workbook{${t.getUnitId()}} Resources{${e.pluginName}} Data Error.`)}})}})};this._resourceManagerService.getAllResourceHooks().forEach(t=>e(t)),this.disposeWithMe(this._resourceManagerService.register$.subscribe(t=>e(t))),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(lW.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(lW.UNIVER_DOC).subscribe(e=>{sv(e.getUnitId())||this._resourceManagerService.loadResources(e.getUnitId(),e.getSnapshot().resources)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(lW.UNIVER_SHEET).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(lW.UNIVER_DOC).subscribe(e=>{this._resourceManagerService.unloadResources(e.getUnitId())}))}saveUnit(e){let t=this._univerInstanceService.getUnit(e);if(!t)return null;let r=this._resourceManagerService.getResources(e,t.type),n=rq.deepClone(t.getSnapshot());return n.resources=r,n}};dQ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?dq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([dK(0,(0,tf.Inject)(cz)),dK(1,(0,tf.Inject)(hK))],dQ);class dZ{constructor(e={},t){tE(this,"_startedTypes",new Set),tE(this,"_injector"),tE(this,"_disposingCallbacks",new tL);let r=this._injector=function(e,t){let r=ds([[hh],[h3],[du],[h1],[di],[cQ],[hK,{useClass:hQ}],[h6,{useClass:h9}],[tH,{useClass:tW,lazy:!0}],[tX,{useClass:tQ}],[dd,{useClass:d_,lazy:!0}],[c4,{useClass:c6}],[tj,{useClass:tB}],[cz,{useClass:dl,lazy:!0}],[da,{useClass:dQ,lazy:!0}],[c1,{useClass:c0}],[c3,{useClass:c5,lazy:!0}]],t),n=e?e.createChild(r):new(0,tf.Injector)(r);return tw(n,[[cQ],[da]]),n}(t,null==e?void 0:e.override),{theme:n,darkMode:i,locale:s,locales:a,logLevel:o}=e;n&&this._injector.get(du).setTheme(n),i&&this._injector.get(du).setDarkMode(i),a&&this._injector.get(h3).load(a),s&&this._injector.get(h3).setLocale(s),o&&this._injector.get(tH).setLogLevel(o),this._init(r)}get _univerInstanceService(){return this._injector.get(hK)}get _pluginService(){return this._injector.get(di)}__getInjector(){return this._injector}onDispose(e){let t=this._disposingCallbacks.add(tD(e));return tD(()=>t.dispose(!0))}dispose(){this._disposingCallbacks.dispose(),this._injector.dispose()}setLocale(e){this._injector.get(h3).setLocale(e)}createUnit(e,t){return this._univerInstanceService.createUnit(e,t)}createUniverSheet(e){return this._injector.get(tH).warn("[Univer]","Univer.createUniverSheet is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(lW.UNIVER_SHEET,e)}createUniverDoc(e){return this._injector.get(tH).warn("[Univer]","Univer.createUniverDoc is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(lW.UNIVER_DOC,e)}createUniverSlide(e){return this._injector.get(tH).warn("[Univer]","Univer.createUniverSlide is deprecated, use createUnit instead"),this._univerInstanceService.createUnit(lW.UNIVER_SLIDE,e)}_init(e){this._univerInstanceService.registerCtorForType(lW.UNIVER_SHEET,hY),this._univerInstanceService.registerCtorForType(lW.UNIVER_DOC,cc),this._univerInstanceService.registerCtorForType(lW.UNIVER_SLIDE,hz);let t=e.get(hK);t.__setCreateHandler((r,n,i,s)=>{if(!this._startedTypes.has(r)){this._pluginService.startPluginsForType(r),this._startedTypes.add(r);let a=e.createInstance(i,n);return t.__addUnit(a,s),this._tryProgressToReady(),a}let a=e.createInstance(i,n);return t.__addUnit(a,s),a})}_tryProgressToReady(){this._injector.get(h1).stage<hZ.Ready&&(this._injector.get(h1).stage=hZ.Ready)}registerPlugin(e,t){this._pluginService.registerPlugin(e,t)}}function dJ(e){return e.map(e=>e/255)}function d0(e){return e.map(e=>Math.round(255*e))}let d1=[[.333,-.667,-.667,0,1],[-.667,.333,-.667,0,1],[-.667,-.667,.333,0,1],[0,0,0,1,0]];function d2(e){return d0(function(e){let t=e[0],r=e[1],n=e[2];return[d1[0][0]*t+d1[0][1]*r+d1[0][2]*n+d1[0][4],d1[1][0]*t+d1[1][1]*r+d1[1][2]*n+d1[1][4],d1[2][0]*t+d1[2][1]*r+d1[2][2]*n+d1[2][4]].map(e=>e>1?1:e<0?0:e)}(dJ(e)))}function d5(e,t,r){let n=[e,t,r].map(e=>e<=.03928?e/12.92:((e+.055)/1.055)**2.4);return .2126*n[0]+.7152*n[1]+.0722*n[2]}function d3(e,t){return(Math.max(e,t)+.05)/(Math.min(e,t)+.05)}let d4=d5(1,1,1),d6=d5(0,0,0);function d9(e){return d0(function(e){let t=d3(d4,d5(e[0],e[1],e[2])),r=function([e,t,r]){let n=Math.max(e,t,r),i=Math.min(e,t,r),s=(n+i)/2,a=0,o=0;if(n!==i){let l=n-i;switch(o=s>.5?l/(2-n-i):l/(n+i),n){case e:a=(t-r)/l+6*(t<r);break;case t:a=(r-e)/l+2;break;case r:a=(e-t)/l+4}a/=6}return[a,o,s]}(e),n=1-r[2],i,s;do s=d3(d5((i=function(e,t,r){let n,i,s;if(0===t)n=i=s=r;else{let a=(e,t,r)=>{let n=r;return n<0&&(n+=1),n>1&&(n-=1),n<.16666666666666666?e+(t-e)*6*n:n<.5?t:n<.6666666666666666?e+(t-e)*(.6666666666666666-n)*6:e},o=r<.5?r*(1+t):r+t-r*t,l=2*r-o;n=a(l,o,e+1/3),i=a(l,o,e),s=a(l,o,e-1/3)}return[n,i,s]}(r[0],r[1],n))[0],i[1],i[2]),d6),n+=.01;while(n<=1&&n>=0&&.01>Math.abs(s-t))return i}(dJ(e)))}let d8=new Map,d7=0;"function"!=typeof tR.requestIdleCallback&&(tR.requestIdleCallback=function(e){let t=Date.now(),r=++d7,n=setTimeout(function(){d8.delete(r);let n=Math.max(0,50-(Date.now()-t));e({didTimeout:0===n,timeRemaining:()=>n})},1);return d8.set(r,n),r}),"function"!=typeof tR.cancelIdleCallback&&(tR.cancelIdleCallback=function(e){let t=d8.get(e);void 0!==t&&(clearTimeout(t),d8.delete(e))}),e5=e.exports,Object.keys(tf).forEach(function(e){"default"===e||"__esModule"===e||Object.prototype.hasOwnProperty.call(e5,e)||Object.defineProperty(e5,e,{enumerable:!0,get:function(){return tf[e]}})})}),c("5LPkb",function(e,t){i(e.exports,"BehaviorSubject",function(){return n});var r=u("14wAQ"),n=function(e){function t(t){var r=e.call(this)||this;return r._value=t,r}return(0,r.__extends)(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),t.prototype._subscribe=function(t){var r=e.prototype._subscribe.call(this,t);return r.closed||t.next(this._value),r},t.prototype.getValue=function(){var e=this.hasError,t=this.thrownError,r=this._value;if(e)throw t;return this._throwIfClosed(),r},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(u("1mjSk").Subject)}),c("14wAQ",function(e,t){i(e.exports,"__extends",function(){return n}),i(e.exports,"__awaiter",function(){return s}),i(e.exports,"__generator",function(){return a}),i(e.exports,"__values",function(){return o}),i(e.exports,"__read",function(){return l}),i(e.exports,"__spreadArray",function(){return u}),i(e.exports,"__await",function(){return c}),i(e.exports,"__asyncGenerator",function(){return h}),i(e.exports,"__asyncValues",function(){return d});var r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function n(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}function s(e,t,r,n){return new(r||(r=Promise))(function(i,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function o(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(a,o)}l((n=n.apply(e,t||[])).next())})}function a(e,t){var r,n,i,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=o(0),a.throw=o(1),a.return=o(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function o(o){return function(l){var u=[o,l];if(r)throw TypeError("Generator is already executing.");for(;a&&(a=0,u[0]&&(s=0)),s;)try{if(r=1,n&&(i=2&u[0]?n.return:u[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,u[1])).done)return i;switch(n=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,n=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===u[0]||2===u[0])){s=0;continue}if(3===u[0]&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(6===u[0]&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=t.call(e,s)}catch(e){u=[6,e],n=0}finally{r=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}}function o(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,i,s=r.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(n=s.next()).done;)a.push(n.value)}catch(e){i={error:e}}finally{try{n&&!n.done&&(r=s.return)&&r.call(s)}finally{if(i)throw i.error}}return a}function u(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))}function c(e){return this instanceof c?(this.v=e,this):new c(e)}function h(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(e,t||[]),s=[];return n=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),a("next"),a("throw"),a("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),n[Symbol.asyncIterator]=function(){return this},n;function a(e,t){i[e]&&(n[e]=function(t){return new Promise(function(r,n){s.push([e,t,r,n])>1||o(e,t)})},t&&(n[e]=t(n[e])))}function o(e,t){try{var r;(r=i[e](t)).value instanceof c?Promise.resolve(r.value.v).then(l,u):h(s[0][2],r)}catch(e){h(s[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function h(e,t){e(t),s.shift(),s.length&&o(s[0][0],s[0][1])}}function d(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=o(e),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(r){t[r]=e[r]&&function(t){return new Promise(function(n,i){var s,a,o;s=n,a=i,o=(t=e[r](t)).done,Promise.resolve(t.value).then(function(e){s({value:e,done:o})},a)})}}}"function"==typeof SuppressedError&&SuppressedError}),c("1mjSk",function(e,t){i(e.exports,"Subject",function(){return c});var r=u("14wAQ"),n=u("1O3Nt"),s=u("e1VZ5"),a=u("c6P6i"),o=u("hFN8R"),l=u("dIjnd"),c=function(e){function t(){var t=e.call(this)||this;return t.closed=!1,t.currentObservers=null,t.observers=[],t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return(0,r.__extends)(t,e),t.prototype.lift=function(e){var t=new h(this,this);return t.operator=e,t},t.prototype._throwIfClosed=function(){if(this.closed)throw new(0,a.ObjectUnsubscribedError)},t.prototype.next=function(e){var t=this;(0,l.errorContext)(function(){var n,i;if(t._throwIfClosed(),!t.isStopped){t.currentObservers||(t.currentObservers=Array.from(t.observers));try{for(var s=(0,r.__values)(t.currentObservers),a=s.next();!a.done;a=s.next())a.value.next(e)}catch(e){n={error:e}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}}})},t.prototype.error=function(e){var t=this;(0,l.errorContext)(function(){if(t._throwIfClosed(),!t.isStopped){t.hasError=t.isStopped=!0,t.thrownError=e;for(var r=t.observers;r.length;)r.shift().error(e)}})},t.prototype.complete=function(){var e=this;(0,l.errorContext)(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var t=e.observers;t.length;)t.shift().complete()}})},t.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(t.prototype,"observed",{get:function(){var e;return(null==(e=this.observers)?void 0:e.length)>0},enumerable:!1,configurable:!0}),t.prototype._trySubscribe=function(t){return this._throwIfClosed(),e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},t.prototype._innerSubscribe=function(e){var t=this,r=this.hasError,n=this.isStopped,i=this.observers;return r||n?s.EMPTY_SUBSCRIPTION:(this.currentObservers=null,i.push(e),new(0,s.Subscription)(function(){t.currentObservers=null,(0,o.arrRemove)(i,e)}))},t.prototype._checkFinalizedStatuses=function(e){var t=this.hasError,r=this.thrownError,n=this.isStopped;t?e.error(r):n&&e.complete()},t.prototype.asObservable=function(){var e=new(0,n.Observable);return e.source=this,e},t.create=function(e,t){return new h(e,t)},t}(n.Observable),h=function(e){function t(t,r){var n=e.call(this)||this;return n.destination=t,n.source=r,n}return(0,r.__extends)(t,e),t.prototype.next=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.next)||r.call(t,e)},t.prototype.error=function(e){var t,r;null==(r=null==(t=this.destination)?void 0:t.error)||r.call(t,e)},t.prototype.complete=function(){var e,t;null==(t=null==(e=this.destination)?void 0:e.complete)||t.call(e)},t.prototype._subscribe=function(e){var t,r;return null!=(r=null==(t=this.source)?void 0:t.subscribe(e))?r:s.EMPTY_SUBSCRIPTION},t}(c)}),c("1O3Nt",function(e,t){i(e.exports,"Observable",function(){return h});var r=u("lftZl"),n=u("e1VZ5"),s=u("eDMxo"),a=u("1hKfX"),o=u("laEi0"),l=u("3IQI0"),c=u("dIjnd"),h=function(){function e(e){e&&(this._subscribe=e)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(e,t,i){var s=this,a=!function(e){return e&&e instanceof r.Subscriber||e&&(0,l.isFunction)(e.next)&&(0,l.isFunction)(e.error)&&(0,l.isFunction)(e.complete)&&(0,n.isSubscription)(e)}(e)?new(0,r.SafeSubscriber)(e,t,i):e;return(0,c.errorContext)(function(){var e=s.operator,t=s.source;a.add(e?e.call(a,t):t?s._subscribe(a):s._trySubscribe(a))}),a},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=d(t))(function(t,i){var s=new(0,r.SafeSubscriber)({next:function(t){try{e(t)}catch(e){i(e),s.unsubscribe()}},error:i,complete:t});n.subscribe(s)})},e.prototype._subscribe=function(e){var t;return null==(t=this.source)?void 0:t.subscribe(e)},e.prototype[s.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return(0,a.pipeFromArray)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=d(e))(function(e,r){var n;t.subscribe(function(e){return n=e},function(e){return r(e)},function(){return e(n)})})},e.create=function(t){return new e(t)},e}();function d(e){var t;return null!=(t=null!=e?e:o.config.Promise)?t:Promise}}),c("lftZl",function(e,t){i(e.exports,"Subscriber",function(){return m}),i(e.exports,"SafeSubscriber",function(){return C});var r=u("14wAQ"),n=u("3IQI0"),s=u("e1VZ5"),a=u("laEi0"),o=u("ghA1h"),l=u("f1euv"),c=u("6x7Ga"),h=u("caYEJ"),d=u("dIjnd"),m=function(e){function t(t){var r=e.call(this)||this;return r.isStopped=!1,t?(r.destination=t,(0,s.isSubscription)(t)&&t.add(r)):r.destination=E,r}return(0,r.__extends)(t,e),t.create=function(e,t,r){return new C(e,t,r)},t.prototype.next=function(e){this.isStopped?y((0,c.nextNotification)(e),this):this._next(e)},t.prototype.error=function(e){this.isStopped?y((0,c.errorNotification)(e),this):(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped?y(c.COMPLETE_NOTIFICATION,this):(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this),this.destination=null)},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},t.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},t}(s.Subscription),g=Function.prototype.bind;function f(e,t){return g.call(e,t)}var p=function(){function e(e){this.partialObserver=e}return e.prototype.next=function(e){var t=this.partialObserver;if(t.next)try{t.next(e)}catch(e){_(e)}},e.prototype.error=function(e){var t=this.partialObserver;if(t.error)try{t.error(e)}catch(e){_(e)}else _(e)},e.prototype.complete=function(){var e=this.partialObserver;if(e.complete)try{e.complete()}catch(e){_(e)}},e}(),C=function(e){function t(t,r,i){var s,o,l=e.call(this)||this;return(0,n.isFunction)(t)||!t?s={next:null!=t?t:void 0,error:null!=r?r:void 0,complete:null!=i?i:void 0}:l&&a.config.useDeprecatedNextContext?((o=Object.create(t)).unsubscribe=function(){return l.unsubscribe()},s={next:t.next&&f(t.next,o),error:t.error&&f(t.error,o),complete:t.complete&&f(t.complete,o)}):s=t,l.destination=new p(s),l}return(0,r.__extends)(t,e),t}(m);function _(e){a.config.useDeprecatedSynchronousErrorHandling?(0,d.captureError)(e):(0,o.reportUnhandledError)(e)}function y(e,t){var r=a.config.onStoppedNotification;r&&h.timeoutProvider.setTimeout(function(){return r(e,t)})}var E={closed:!0,next:l.noop,error:function(e){throw e},complete:l.noop}}),c("3IQI0",function(e,t){i(e.exports,"isFunction",function(){return r});function r(e){return"function"==typeof e}}),c("e1VZ5",function(e,t){i(e.exports,"Subscription",function(){return o}),i(e.exports,"EMPTY_SUBSCRIPTION",function(){return l}),i(e.exports,"isSubscription",function(){return c});var r=u("14wAQ"),n=u("3IQI0"),s=u("iftTV"),a=u("hFN8R"),o=function(){var e;function t(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e,t,i,a,o,l=this._parentage;if(l)if(this._parentage=null,Array.isArray(l))try{for(var u=(0,r.__values)(l),c=u.next();!c.done;c=u.next())c.value.remove(this)}catch(t){e={error:t}}finally{try{c&&!c.done&&(t=u.return)&&t.call(u)}finally{if(e)throw e.error}}else l.remove(this);var d=this.initialTeardown;if((0,n.isFunction)(d))try{d()}catch(e){o=e instanceof s.UnsubscriptionError?e.errors:[e]}var m=this._finalizers;if(m){this._finalizers=null;try{for(var g=(0,r.__values)(m),f=g.next();!f.done;f=g.next()){var p=f.value;try{h(p)}catch(e){o=null!=o?o:[],e instanceof s.UnsubscriptionError?o=(0,r.__spreadArray)((0,r.__spreadArray)([],(0,r.__read)(o)),(0,r.__read)(e.errors)):o.push(e)}}}catch(e){i={error:e}}finally{try{f&&!f.done&&(a=g.return)&&a.call(g)}finally{if(i)throw i.error}}}if(o)throw new(0,s.UnsubscriptionError)(o)}},t.prototype.add=function(e){var r;if(e&&e!==this)if(this.closed)h(e);else{if(e instanceof t){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!=(r=this._finalizers)?r:[]).push(e)}},t.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},t.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},t.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&(0,a.arrRemove)(t,e)},t.prototype.remove=function(e){var r=this._finalizers;r&&(0,a.arrRemove)(r,e),e instanceof t&&e._removeParent(this)},(e=new t).closed=!0,t.EMPTY=e,t}(),l=o.EMPTY;function c(e){return e instanceof o||e&&"closed"in e&&(0,n.isFunction)(e.remove)&&(0,n.isFunction)(e.add)&&(0,n.isFunction)(e.unsubscribe)}function h(e){(0,n.isFunction)(e)?e():e.unsubscribe()}}),c("iftTV",function(e,t){i(e.exports,"UnsubscriptionError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(t){e(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t}})}),c("bfFMS",function(e,t){i(e.exports,"createErrorClass",function(){return r});function r(e){var t=e(function(e){Error.call(e),e.stack=Error().stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}}),c("hFN8R",function(e,t){i(e.exports,"arrRemove",function(){return r});function r(e,t){if(e){var r=e.indexOf(t);0<=r&&e.splice(r,1)}}}),c("laEi0",function(e,t){i(e.exports,"config",function(){return r});var r={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}}),c("ghA1h",function(e,t){i(e.exports,"reportUnhandledError",function(){return s});var r=u("laEi0"),n=u("caYEJ");function s(e){n.timeoutProvider.setTimeout(function(){var t=r.config.onUnhandledError;if(t)t(e);else throw e})}}),c("caYEJ",function(e,t){i(e.exports,"timeoutProvider",function(){return n});var r=u("14wAQ"),n={setTimeout:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=n.delegate;return(null==a?void 0:a.setTimeout)?a.setTimeout.apply(a,(0,r.__spreadArray)([e,t],(0,r.__read)(i))):setTimeout.apply(void 0,(0,r.__spreadArray)([e,t],(0,r.__read)(i)))},clearTimeout:function(e){var t=n.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},delegate:void 0}}),c("f1euv",function(e,t){i(e.exports,"noop",function(){return r});function r(){}}),c("6x7Ga",function(e,t){i(e.exports,"COMPLETE_NOTIFICATION",function(){return r}),i(e.exports,"errorNotification",function(){return n}),i(e.exports,"nextNotification",function(){return s});var r=a("C",void 0,void 0);function n(e){return a("E",void 0,e)}function s(e){return a("N",e,void 0)}function a(e,t,r){return{kind:e,value:t,error:r}}}),c("dIjnd",function(e,t){i(e.exports,"errorContext",function(){return s}),i(e.exports,"captureError",function(){return a});var r=u("laEi0"),n=null;function s(e){if(r.config.useDeprecatedSynchronousErrorHandling){var t=!n;if(t&&(n={errorThrown:!1,error:null}),e(),t){var i=n,s=i.errorThrown,a=i.error;if(n=null,s)throw a}}else e()}function a(e){r.config.useDeprecatedSynchronousErrorHandling&&n&&(n.errorThrown=!0,n.error=e)}}),c("eDMxo",function(e,t){i(e.exports,"observable",function(){return r});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"}),c("1hKfX",function(e,t){i(e.exports,"pipe",function(){return n}),i(e.exports,"pipeFromArray",function(){return s});var r=u("2N6l4");function n(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return s(e)}function s(e){return 0===e.length?r.identity:1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}}}),c("2N6l4",function(e,t){i(e.exports,"identity",function(){return r});function r(e){return e}}),c("c6P6i",function(e,t){i(e.exports,"ObjectUnsubscribedError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}})}),c("5K4WI",function(e,t){i(e.exports,"combineLatest",function(){return m}),i(e.exports,"combineLatestInit",function(){return g});var r=u("1O3Nt"),n=u("6obID"),s=u("fz1T5"),a=u("2N6l4"),o=u("h319C"),l=u("4xvfD"),c=u("TccoZ"),h=u("iNetn"),d=u("99A8K");function m(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,l.popScheduler)(e),u=(0,l.popResultSelector)(e),h=(0,n.argsArgArrayOrObject)(e),d=h.args,m=h.keys;if(0===d.length)return(0,s.from)([],i);var f=new(0,r.Observable)(g(d,i,m?function(e){return(0,c.createObject)(m,e)}:a.identity));return u?f.pipe((0,o.mapOneOrManyArgs)(u)):f}function g(e,t,r){return void 0===r&&(r=a.identity),function(n){f(t,function(){for(var i=e.length,a=Array(i),o=i,l=i,u=function(i){f(t,function(){var u=(0,s.from)(e[i],t),c=!1;u.subscribe((0,h.createOperatorSubscriber)(n,function(e){a[i]=e,!c&&(c=!0,l--),l||n.next(r(a.slice()))},function(){--o||n.complete()}))},n)},c=0;c<i;c++)u(c)},n)}}function f(e,t,r){e?(0,d.executeSchedule)(r,e,t):t()}}),c("6obID",function(e,t){i(e.exports,"argsArgArrayOrObject",function(){return o});var r=Array.isArray,n=Object.getPrototypeOf,s=Object.prototype,a=Object.keys;function o(e){if(1===e.length){var t,i=e[0];if(r(i))return{args:i,keys:null};if((t=i)&&"object"==typeof t&&n(t)===s){var o=a(i);return{args:o.map(function(e){return i[e]}),keys:o}}}return{args:e,keys:null}}}),c("fz1T5",function(e,t){i(e.exports,"from",function(){return s});var r=u("3ESKv"),n=u("b7gpN");function s(e,t){return t?(0,r.scheduled)(e,t):(0,n.innerFrom)(e)}}),c("3ESKv",function(e,t){i(e.exports,"scheduled",function(){return C});var r=u("HWDtl"),n=u("kx7NJ"),s=u("61w6q"),a=u("3kNl0"),o=u("1jutQ"),l=u("5BIEa"),c=u("jWdZ8"),h=u("bLVFn"),d=u("6woc9"),m=u("aewtS"),g=u("729in"),f=u("fdiCB"),p=u("dvjJq");function C(e,t){if(null!=e){if((0,l.isInteropObservable)(e))return(0,r.scheduleObservable)(e,t);if((0,h.isArrayLike)(e))return(0,s.scheduleArray)(e,t);if((0,c.isPromise)(e))return(0,n.schedulePromise)(e,t);if((0,m.isAsyncIterable)(e))return(0,o.scheduleAsyncIterable)(e,t);if((0,d.isIterable)(e))return(0,a.scheduleIterable)(e,t);if((0,f.isReadableStreamLike)(e))return(0,p.scheduleReadableStreamLike)(e,t)}throw(0,g.createInvalidObservableTypeError)(e)}}),c("HWDtl",function(e,t){i(e.exports,"scheduleObservable",function(){return a});var r=u("b7gpN"),n=u("jHEit"),s=u("bQ23s");function a(e,t){return(0,r.innerFrom)(e).pipe((0,s.subscribeOn)(t),(0,n.observeOn)(t))}}),c("b7gpN",function(e,t){i(e.exports,"innerFrom",function(){return p});var r=u("14wAQ"),n=u("bLVFn"),s=u("jWdZ8"),a=u("1O3Nt"),o=u("5BIEa"),l=u("aewtS"),c=u("729in"),h=u("6woc9"),d=u("fdiCB"),m=u("3IQI0"),g=u("ghA1h"),f=u("eDMxo");function p(e){if(e instanceof a.Observable)return e;if(null!=e){var t,i,u,p,_;if((0,o.isInteropObservable)(e)){return t=e,new(0,a.Observable)(function(e){var r=t[f.observable]();if((0,m.isFunction)(r.subscribe))return r.subscribe(e);throw TypeError("Provided object does not correctly implement Symbol.observable")})}if((0,n.isArrayLike)(e)){return i=e,new(0,a.Observable)(function(e){for(var t=0;t<i.length&&!e.closed;t++)e.next(i[t]);e.complete()})}if((0,s.isPromise)(e)){return u=e,new(0,a.Observable)(function(e){u.then(function(t){e.closed||(e.next(t),e.complete())},function(t){return e.error(t)}).then(null,g.reportUnhandledError)})}if((0,l.isAsyncIterable)(e))return C(e);if((0,h.isIterable)(e)){return p=e,new(0,a.Observable)(function(e){var t,n;try{for(var i=(0,r.__values)(p),s=i.next();!s.done;s=i.next()){var a=s.value;if(e.next(a),e.closed)return}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}e.complete()})}if((0,d.isReadableStreamLike)(e)){return _=e,C((0,d.readableStreamLikeToAsyncGenerator)(_))}}throw(0,c.createInvalidObservableTypeError)(e)}function C(e){return new(0,a.Observable)(function(t){(function(e,t){var n,i,s,a;return(0,r.__awaiter)(this,void 0,void 0,function(){var o;return(0,r.__generator)(this,function(l){switch(l.label){case 0:l.trys.push([0,5,6,11]),n=(0,r.__asyncValues)(e),l.label=1;case 1:return[4,n.next()];case 2:if((i=l.sent()).done)return[3,4];if(o=i.value,t.next(o),t.closed)return[2];l.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return s={error:l.sent()},[3,11];case 6:if(l.trys.push([6,,9,10]),!(i&&!i.done&&(a=n.return)))return[3,8];return[4,a.call(n)];case 7:l.sent(),l.label=8;case 8:return[3,10];case 9:if(s)throw s.error;return[7];case 10:return[7];case 11:return t.complete(),[2]}})})})(e,t).catch(function(e){return t.error(e)})})}}),c("bLVFn",function(e,t){i(e.exports,"isArrayLike",function(){return r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}}),c("jWdZ8",function(e,t){i(e.exports,"isPromise",function(){return n});var r=u("3IQI0");function n(e){return(0,r.isFunction)(null==e?void 0:e.then)}}),c("5BIEa",function(e,t){i(e.exports,"isInteropObservable",function(){return s});var r=u("eDMxo"),n=u("3IQI0");function s(e){return(0,n.isFunction)(e[r.observable])}}),c("aewtS",function(e,t){i(e.exports,"isAsyncIterable",function(){return n});var r=u("3IQI0");function n(e){return Symbol.asyncIterator&&(0,r.isFunction)(null==e?void 0:e[Symbol.asyncIterator])}}),c("729in",function(e,t){i(e.exports,"createInvalidObservableTypeError",function(){return r});function r(e){return TypeError("You provided "+(null!==e&&"object"==typeof e?"an invalid object":"'"+e+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}}),c("6woc9",function(e,t){i(e.exports,"isIterable",function(){return s});var r=u("kZq5V"),n=u("3IQI0");function s(e){return(0,n.isFunction)(null==e?void 0:e[r.iterator])}}),c("kZq5V",function(e,t){i(e.exports,"iterator",function(){return r});var r="function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}),c("fdiCB",function(e,t){i(e.exports,"readableStreamLikeToAsyncGenerator",function(){return s}),i(e.exports,"isReadableStreamLike",function(){return a});var r=u("14wAQ"),n=u("3IQI0");function s(e){return(0,r.__asyncGenerator)(this,arguments,function(){var t,n,i;return(0,r.__generator)(this,function(s){switch(s.label){case 0:t=e.getReader(),s.label=1;case 1:s.trys.push([1,,9,10]),s.label=2;case 2:return[4,(0,r.__await)(t.read())];case 3:if(i=(n=s.sent()).value,!n.done)return[3,5];return[4,(0,r.__await)(void 0)];case 4:return[2,s.sent()];case 5:return[4,(0,r.__await)(i)];case 6:return[4,s.sent()];case 7:return s.sent(),[3,2];case 8:return[3,10];case 9:return t.releaseLock(),[7];case 10:return[2]}})})}function a(e){return(0,n.isFunction)(null==e?void 0:e.getReader)}}),c("jHEit",function(e,t){i(e.exports,"observeOn",function(){return a});var r=u("99A8K"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=0),(0,n.operate)(function(n,i){n.subscribe((0,s.createOperatorSubscriber)(i,function(n){return(0,r.executeSchedule)(i,e,function(){return i.next(n)},t)},function(){return(0,r.executeSchedule)(i,e,function(){return i.complete()},t)},function(n){return(0,r.executeSchedule)(i,e,function(){return i.error(n)},t)}))})}}),c("99A8K",function(e,t){i(e.exports,"executeSchedule",function(){return r});function r(e,t,r,n,i){void 0===n&&(n=0),void 0===i&&(i=!1);var s=t.schedule(function(){r(),i?e.add(this.schedule(null,n)):this.unsubscribe()},n);if(e.add(s),!i)return s}}),c("jSzwf",function(e,t){i(e.exports,"operate",function(){return n});var r=u("3IQI0");function n(e){return function(t){if((0,r.isFunction)(null==t?void 0:t.lift))return t.lift(function(t){try{return e(t,this)}catch(e){this.error(e)}});throw TypeError("Unable to lift unknown Observable type")}}}),c("iNetn",function(e,t){i(e.exports,"createOperatorSubscriber",function(){return n});var r=u("14wAQ");function n(e,t,r,n,i){return new s(e,t,r,n,i)}var s=function(e){function t(t,r,n,i,s,a){var o=e.call(this,t)||this;return o.onFinalize=s,o.shouldUnsubscribe=a,o._next=r?function(e){try{r(e)}catch(e){t.error(e)}}:e.prototype._next,o._error=i?function(e){try{i(e)}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._error,o._complete=n?function(){try{n()}catch(e){t.error(e)}finally{this.unsubscribe()}}:e.prototype._complete,o}return(0,r.__extends)(t,e),t.prototype.unsubscribe=function(){var t;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var r=this.closed;e.prototype.unsubscribe.call(this),r||null==(t=this.onFinalize)||t.call(this)}},t}(u("lftZl").Subscriber)}),c("bQ23s",function(e,t){i(e.exports,"subscribeOn",function(){return n});var r=u("jSzwf");function n(e,t){return void 0===t&&(t=0),(0,r.operate)(function(r,n){n.add(e.schedule(function(){return r.subscribe(n)},t))})}}),c("kx7NJ",function(e,t){i(e.exports,"schedulePromise",function(){return a});var r=u("b7gpN"),n=u("jHEit"),s=u("bQ23s");function a(e,t){return(0,r.innerFrom)(e).pipe((0,s.subscribeOn)(t),(0,n.observeOn)(t))}}),c("61w6q",function(e,t){i(e.exports,"scheduleArray",function(){return n});var r=u("1O3Nt");function n(e,t){return new(0,r.Observable)(function(r){var n=0;return t.schedule(function(){n===e.length?r.complete():(r.next(e[n++]),r.closed||this.schedule())})})}}),c("3kNl0",function(e,t){i(e.exports,"scheduleIterable",function(){return o});var r=u("1O3Nt"),n=u("kZq5V"),s=u("3IQI0"),a=u("99A8K");function o(e,t){return new(0,r.Observable)(function(r){var i;return(0,a.executeSchedule)(r,t,function(){i=e[n.iterator](),(0,a.executeSchedule)(r,t,function(){var e,t,n;try{t=(e=i.next()).value,n=e.done}catch(e){r.error(e);return}n?r.complete():r.next(t)},0,!0)}),function(){return(0,s.isFunction)(null==i?void 0:i.return)&&i.return()}})}}),c("1jutQ",function(e,t){i(e.exports,"scheduleAsyncIterable",function(){return s});var r=u("1O3Nt"),n=u("99A8K");function s(e,t){if(!e)throw Error("Iterable cannot be null");return new(0,r.Observable)(function(r){(0,n.executeSchedule)(r,t,function(){var i=e[Symbol.asyncIterator]();(0,n.executeSchedule)(r,t,function(){i.next().then(function(e){e.done?r.complete():r.next(e.value)})},0,!0)})})}}),c("dvjJq",function(e,t){i(e.exports,"scheduleReadableStreamLike",function(){return s});var r=u("1jutQ"),n=u("fdiCB");function s(e,t){return(0,r.scheduleAsyncIterable)((0,n.readableStreamLikeToAsyncGenerator)(e),t)}}),c("h319C",function(e,t){i(e.exports,"mapOneOrManyArgs",function(){return a});var r=u("14wAQ"),n=u("hciHF"),s=Array.isArray;function a(e){return(0,n.map)(function(t){return s(t)?e.apply(void 0,(0,r.__spreadArray)([],(0,r.__read)(t))):e(t)})}}),c("hciHF",function(e,t){i(e.exports,"map",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e,t){return(0,r.operate)(function(r,i){var s=0;r.subscribe((0,n.createOperatorSubscriber)(i,function(r){i.next(e.call(t,r,s++))}))})}}),c("4xvfD",function(e,t){i(e.exports,"popResultSelector",function(){return a}),i(e.exports,"popScheduler",function(){return o}),i(e.exports,"popNumber",function(){return l});var r=u("3IQI0"),n=u("4tjBj");function s(e){return e[e.length-1]}function a(e){return(0,r.isFunction)(s(e))?e.pop():void 0}function o(e){return(0,n.isScheduler)(s(e))?e.pop():void 0}function l(e,t){return"number"==typeof s(e)?e.pop():t}}),c("4tjBj",function(e,t){i(e.exports,"isScheduler",function(){return n});var r=u("3IQI0");function n(e){return e&&(0,r.isFunction)(e.schedule)}}),c("TccoZ",function(e,t){i(e.exports,"createObject",function(){return r});function r(e,t){return e.reduce(function(e,r,n){return e[r]=t[n],e},{})}}),c("bXJOC",function(e,t){i(e.exports,"debounceTime",function(){return a});var r=u("jaZjQ"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=r.asyncScheduler),(0,n.operate)(function(r,n){var i=null,a=null,o=null,l=function(){if(i){i.unsubscribe(),i=null;var e=a;a=null,n.next(e)}};function u(){var r=o+e,s=t.now();if(s<r){i=this.schedule(void 0,r-s),n.add(i);return}l()}r.subscribe((0,s.createOperatorSubscriber)(n,function(r){a=r,o=t.now(),i||(i=t.schedule(u,e),n.add(i))},function(){l(),n.complete()},void 0,function(){a=i=null}))})}}),c("jaZjQ",function(e,t){i(e.exports,"asyncScheduler",function(){return n}),i(e.exports,"async",function(){return s});var r=u("aTfYm"),n=new(0,u("7GTYN").AsyncScheduler)(r.AsyncAction),s=n}),c("aTfYm",function(e,t){i(e.exports,"AsyncAction",function(){return o});var r=u("14wAQ"),n=u("iSRzt"),s=u("ic7D4"),a=u("hFN8R"),o=function(e){function t(t,r){var n=e.call(this,t,r)||this;return n.scheduler=t,n.work=r,n.pending=!1,n}return(0,r.__extends)(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var r,n=this.id,i=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(i,n,t)),this.pending=!0,this.delay=t,this.id=null!=(r=this.id)?r:this.requestAsyncId(i,this.id,t),this},t.prototype.requestAsyncId=function(e,t,r){return void 0===r&&(r=0),s.intervalProvider.setInterval(e.flush.bind(e,this),r)},t.prototype.recycleAsyncId=function(e,t,r){if(void 0===r&&(r=0),null!=r&&this.delay===r&&!1===this.pending)return t;null!=t&&s.intervalProvider.clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return Error("executing a cancelled action");this.pending=!1;var r=this._execute(e,t);if(r)return r;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var r,n=!1;try{this.work(e)}catch(e){n=!0,r=e||Error("Scheduled action threw falsy error")}if(n)return this.unsubscribe(),r},t.prototype.unsubscribe=function(){if(!this.closed){var t=this.id,r=this.scheduler,n=r.actions;this.work=this.state=this.scheduler=null,this.pending=!1,(0,a.arrRemove)(n,this),null!=t&&(this.id=this.recycleAsyncId(r,t,null)),this.delay=null,e.prototype.unsubscribe.call(this)}},t}(n.Action)}),c("iSRzt",function(e,t){i(e.exports,"Action",function(){return n});var r=u("14wAQ"),n=function(e){function t(t,r){return e.call(this)||this}return(0,r.__extends)(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(u("e1VZ5").Subscription)}),c("ic7D4",function(e,t){i(e.exports,"intervalProvider",function(){return n});var r=u("14wAQ"),n={setInterval:function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var a=n.delegate;return(null==a?void 0:a.setInterval)?a.setInterval.apply(a,(0,r.__spreadArray)([e,t],(0,r.__read)(i))):setInterval.apply(void 0,(0,r.__spreadArray)([e,t],(0,r.__read)(i)))},clearInterval:function(e){var t=n.delegate;return((null==t?void 0:t.clearInterval)||clearInterval)(e)},delegate:void 0}}),c("7GTYN",function(e,t){i(e.exports,"AsyncScheduler",function(){return s});var r=u("14wAQ"),n=u("gDW7u"),s=function(e){function t(t,r){void 0===r&&(r=n.Scheduler.now);var i=e.call(this,t,r)||this;return i.actions=[],i._active=!1,i}return(0,r.__extends)(t,e),t.prototype.flush=function(e){var t,r=this.actions;if(this._active)return void r.push(e);this._active=!0;do if(t=e.execute(e.state,e.delay))break;while(e=r.shift())if(this._active=!1,t){for(;e=r.shift();)e.unsubscribe();throw t}},t}(n.Scheduler)}),c("gDW7u",function(e,t){i(e.exports,"Scheduler",function(){return n});var r=u("O2Flc"),n=function(){function e(t,r){void 0===r&&(r=e.now),this.schedulerActionCtor=t,this.now=r}return e.prototype.schedule=function(e,t,r){return void 0===t&&(t=0),new this.schedulerActionCtor(this,e).schedule(r,t)},e.now=r.dateTimestampProvider.now,e}()}),c("O2Flc",function(e,t){i(e.exports,"dateTimestampProvider",function(){return r});var r={now:function(){return(r.delegate||Date).now()},delegate:void 0}}),c("arCqp",function(e,t){i(e.exports,"distinctUntilChanged",function(){return a});var r=u("2N6l4"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return void 0===t&&(t=r.identity),e=null!=e?e:o,(0,n.operate)(function(r,n){var i,a=!0;r.subscribe((0,s.createOperatorSubscriber)(n,function(r){var s=t(r);(a||!e(i,s))&&(a=!1,i=s,n.next(r))}))})}function o(e,t){return e===t}}),c("lMvMU",function(e,t){i(e.exports,"filter",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e,t){return(0,r.operate)(function(r,i){var s=0;r.subscribe((0,n.createOperatorSubscriber)(i,function(r){return e.call(t,r,s++)&&i.next(r)}))})}}),c("dBx9C",function(e,t){i(e.exports,"firstValueFrom",function(){return s});var r=u("aXqMV"),n=u("lftZl");function s(e,t){var i="object"==typeof t;return new Promise(function(s,a){var o=new(0,n.SafeSubscriber)({next:function(e){s(e),o.unsubscribe()},error:a,complete:function(){i?s(t.defaultValue):a(new(0,r.EmptyError))}});e.subscribe(o)})}}),c("aXqMV",function(e,t){i(e.exports,"EmptyError",function(){return r});var r=(0,u("bfFMS").createErrorClass)(function(e){return function(){e(this),this.name="EmptyError",this.message="no elements in sequence"}})}),c("i54iF",function(e,t){i(e.exports,"merge",function(){return l});var r=u("gpa4f"),n=u("b7gpN"),s=u("gL4uk"),a=u("4xvfD"),o=u("fz1T5");function l(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,a.popScheduler)(e),l=(0,a.popNumber)(e,1/0);return e.length?1===e.length?(0,n.innerFrom)(e[0]):(0,r.mergeAll)(l)((0,o.from)(e,i)):s.EMPTY}}),c("gpa4f",function(e,t){i(e.exports,"mergeAll",function(){return s});var r=u("97m73"),n=u("2N6l4");function s(e){return void 0===e&&(e=1/0),(0,r.mergeMap)(n.identity,e)}}),c("97m73",function(e,t){i(e.exports,"mergeMap",function(){return function e(t,i,l){return(void 0===l&&(l=1/0),(0,o.isFunction)(i))?e(function(e,s){return(0,r.map)(function(t,r){return i(e,t,s,r)})((0,n.innerFrom)(t(e,s)))},l):("number"==typeof i&&(l=i),(0,s.operate)(function(e,r){return(0,a.mergeInternals)(e,r,t,l)}))}});var r=u("hciHF"),n=u("b7gpN"),s=u("jSzwf"),a=u("c8eGQ"),o=u("3IQI0")}),c("c8eGQ",function(e,t){i(e.exports,"mergeInternals",function(){return a});var r=u("b7gpN"),n=u("99A8K"),s=u("iNetn");function a(e,t,i,a,o,l,u,c){var h=[],d=0,m=0,g=!1,f=function(){!g||h.length||d||t.complete()},p=function(e){return d<a?C(e):h.push(e)},C=function(e){l&&t.next(e),d++;var c=!1;(0,r.innerFrom)(i(e,m++)).subscribe((0,s.createOperatorSubscriber)(t,function(e){null==o||o(e),l?p(e):t.next(e)},function(){c=!0},void 0,function(){if(c)try{for(d--;h.length&&d<a;)!function(){var e=h.shift();u?(0,n.executeSchedule)(t,u,function(){return C(e)}):C(e)}();f()}catch(e){t.error(e)}}))};return e.subscribe((0,s.createOperatorSubscriber)(t,p,function(){g=!0,f()})),function(){null==c||c()}}}),c("gL4uk",function(e,t){i(e.exports,"EMPTY",function(){return r});var r=new(0,u("1O3Nt").Observable)(function(e){return e.complete()})}),c("3yupB",function(e,t){i(e.exports,"of",function(){return s});var r=u("4xvfD"),n=u("fz1T5");function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=(0,r.popScheduler)(e);return(0,n.from)(e,i)}}),c("3rvNF",function(e,t){i(e.exports,"ReplaySubject",function(){return a});var r=u("14wAQ"),n=u("1mjSk"),s=u("O2Flc"),a=function(e){function t(t,r,n){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===n&&(n=s.dateTimestampProvider);var i=e.call(this)||this;return i._bufferSize=t,i._windowTime=r,i._timestampProvider=n,i._buffer=[],i._infiniteTimeWindow=!0,i._infiniteTimeWindow=r===1/0,i._bufferSize=Math.max(1,t),i._windowTime=Math.max(1,r),i}return(0,r.__extends)(t,e),t.prototype.next=function(t){var r=this.isStopped,n=this._buffer,i=this._infiniteTimeWindow,s=this._timestampProvider,a=this._windowTime;!r&&(n.push(t),i||n.push(s.now()+a)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,n=this._buffer.slice(),i=0;i<n.length&&!e.closed;i+=r?1:2)e.next(n[i]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,n=this._infiniteTimeWindow,i=(n?1:2)*e;if(e<1/0&&i<r.length&&r.splice(0,r.length-i),!n){for(var s=t.now(),a=0,o=1;o<r.length&&r[o]<=s;o+=2)a=o;a&&r.splice(0,a+1)}},t}(n.Subject)}),c("9GqS8",function(e,t){i(e.exports,"skip",function(){return n});var r=u("lMvMU");function n(e){return(0,r.filter)(function(t,r){return e<=r})}}),c("9z4na",function(e,t){i(e.exports,"take",function(){return a});var r=u("gL4uk"),n=u("jSzwf"),s=u("iNetn");function a(e){return e<=0?function(){return r.EMPTY}:(0,n.operate)(function(t,r){var n=0;t.subscribe((0,s.createOperatorSubscriber)(r,function(t){++n<=e&&(r.next(t),e<=n&&r.complete())}))})}}),c("b7wVW",function(e,t){i(e.exports,"tap",function(){return o});var r=u("3IQI0"),n=u("jSzwf"),s=u("iNetn"),a=u("2N6l4");function o(e,t,i){var o=(0,r.isFunction)(e)||t||i?{next:e,error:t,complete:i}:e;return o?(0,n.operate)(function(e,t){null==(r=o.subscribe)||r.call(o);var r,n=!0;e.subscribe((0,s.createOperatorSubscriber)(t,function(e){var r;null==(r=o.next)||r.call(o,e),t.next(e)},function(){var e;n=!1,null==(e=o.complete)||e.call(o),t.complete()},function(e){var r;n=!1,null==(r=o.error)||r.call(o,e),t.error(e)},function(){var e,t;n&&(null==(e=o.unsubscribe)||e.call(o)),null==(t=o.finalize)||t.call(o)}))}):a.identity}}),c("aMpZj",function(e,t){i(e.exports,"timer",function(){return o});var r=u("1O3Nt"),n=u("jaZjQ"),s=u("4tjBj"),a=u("hdn9Z");function o(e,t,i){void 0===e&&(e=0),void 0===i&&(i=n.async);var o=-1;return null!=t&&((0,s.isScheduler)(t)?i=t:o=t),new(0,r.Observable)(function(t){var r=(0,a.isValidDate)(e)?e-i.now():e;r<0&&(r=0);var n=0;return i.schedule(function(){t.closed||(t.next(n++),0<=o?this.schedule(void 0,o):t.complete())},r)})}}),c("hdn9Z",function(e,t){i(e.exports,"isValidDate",function(){return r});function r(e){return e instanceof Date&&!isNaN(e)}}),c("bDEN0",function(e,t){i(e.exports,"first",function(){return c});var r=u("aXqMV"),n=u("lMvMU"),s=u("9z4na"),a=u("gSl4p"),o=u("aRjCl"),l=u("2N6l4");function c(e,t){var i=arguments.length>=2;return function(u){return u.pipe(e?(0,n.filter)(function(t,r){return e(t,r,u)}):l.identity,(0,s.take)(1),i?(0,a.defaultIfEmpty)(t):(0,o.throwIfEmpty)(function(){return new(0,r.EmptyError)}))}}}),c("gSl4p",function(e,t){i(e.exports,"defaultIfEmpty",function(){return s});var r=u("jSzwf"),n=u("iNetn");function s(e){return(0,r.operate)(function(t,r){var i=!1;t.subscribe((0,n.createOperatorSubscriber)(r,function(e){i=!0,r.next(e)},function(){i||r.next(e),r.complete()}))})}}),c("aRjCl",function(e,t){i(e.exports,"throwIfEmpty",function(){return a});var r=u("aXqMV"),n=u("jSzwf"),s=u("iNetn");function a(e){return void 0===e&&(e=o),(0,n.operate)(function(t,r){var n=!1;t.subscribe((0,s.createOperatorSubscriber)(r,function(e){n=!0,r.next(e)},function(){return n?r.complete():r.error(e())}))})}function o(){return new(0,r.EmptyError)}}),c("1ZKGP",function(e,t){i(e.exports,"isCtor",function(){return f}),i(e.exports,"isClassDependencyItem",function(){return p}),i(e.exports,"isFactoryDependencyItem",function(){return C}),i(e.exports,"isValueDependencyItem",function(){return _}),i(e.exports,"isAsyncDependencyItem",function(){return y}),i(e.exports,"isAsyncHook",function(){return R}),i(e.exports,"RediError",function(){return N}),i(e.exports,"Quantity",function(){return h}),i(e.exports,"LookUp",function(){return d}),i(e.exports,"createIdentifier",function(){return D}),i(e.exports,"SkipSelf",function(){return L}),i(e.exports,"Self",function(){return P}),i(e.exports,"Many",function(){return $}),i(e.exports,"Optional",function(){return H}),i(e.exports,"Inject",function(){return W}),i(e.exports,"WithNew",function(){return G}),i(e.exports,"setDependencies",function(){return z}),i(e.exports,"forwardRef",function(){return X}),i(e.exports,"isDisposable",function(){return q}),i(e.exports,"Injector",function(){return eg});var r,s,a,o,l,u,c,h,d,m,g=Symbol("$$IDENTIFIER_DECORATOR");function f(e){return"function"==typeof e}function p(e){return!!e&&void 0!==e.useClass}function C(e){return!!e&&void 0!==e.useFactory}function _(e){return!!e&&void 0!==e.useValue}function y(e){return!!e&&void 0!==e.useAsync}var E=Symbol("AsyncHook");function R(e){return!!e&&e.__symbol===E}function b(e){return void 0===e?"undefined":f(e)&&!e[g]?e.name:e.toString()}var I=(r=function(e,t){return(r=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),N=function(e){function t(t){return e.call(this,"[redi]: ".concat(t))||this}return I(t,e),t}(Error);(s=h||(h={})).MANY="many",s.OPTIONAL="optional",s.REQUIRED="required",(a=d||(d={})).SELF="self",a.SKIP_SELF="skipSelf";var S=(o=function(e,t){return(o=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),A=Symbol("$$TARGET"),v=Symbol("$$DEPENDENCIES"),T=function(e){function t(t,r){var n="Could not find dependency registered on the ".concat(t,' (indexed) parameter of the constructor of "').concat(b(r),'".');return e.call(this,n)||this}return S(t,e),t}(N),w=function(e){function t(t,r){var n='It seems that you register "undefined" as dependency on the '.concat(r+1,' parameter of "').concat(b(t),'". Please make sure that there is not cyclic dependency among your TypeScript files, or consider using "forwardRef". For more info please visit our website https://redi.wendell.fun/docs/debug#could-not-find-dependency-registered-on');return e.call(this,n)||this}return S(t,e),t}(N);function M(e,t){var r=(e[v]||[]).find(function(e){return e.paramIndex===t});if(!r)throw new T(t,e);return r}function O(e,t,r,n,i){void 0===n&&(n=h.REQUIRED);var s={paramIndex:r,identifier:t,quantity:n,lookUp:i,withNew:!1};if(void 0===t)throw new w(e,r);e[A]===e?e[v].push(s):(e[v]=[s],e[A]=e)}var x=new Set,U=new Map;function D(e){if(x.has(e))return console.error('Identifier "'.concat(e,'" already exists. Returning the cached identifier decorator.')),U.get(e);var t=function(e,r,n){O(e,t,n)};return t.decoratorName=e,t.toString=function(){return t.decoratorName},t[g]=!0,x.add(e),U.set(e,t),t}function V(e){return function t(){return this instanceof t?this:function(t,r,n){M(t,n).lookUp=e}}}var L=V(d.SKIP_SELF),P=V(d.SELF),F=(l=function(e,t){return(l=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}l(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),k=function(e){function t(t,r,n){var i=this,s="Expect ".concat(function(e){switch(e){case h.OPTIONAL:return"0 or 1";case h.REQUIRED:return"1";case h.MANY:return"0 or more"}}(r),' dependency item(s) for id "').concat(b(t),'" but get ').concat(n,".");return 0===n&&(s+=" Did you forget to register it?"),n>1&&(s+=" You register it more than once."),(i=e.call(this,s)||this).quantity=r,i.actual=n,i}return F(t,e),t}(N);function j(e,t,r){if(t===h.OPTIONAL&&r>1||t===h.REQUIRED&&1!==r)throw new k(e,t,r)}function B(e){return function t(r){return this instanceof t?this:function(t,n,i){if(r)O(t,r,i,e);else{if(e===h.REQUIRED)throw new w(t,i);M(t,i).quantity=e}}}}var $=B(h.MANY),H=B(h.OPTIONAL),W=B(h.REQUIRED),G=function e(){return this instanceof e?this:function(e,t,r){M(e,r).withNew=!0}};function Y(e,t){return(void 0===t&&(t=0),e)?e.map(function(e,r){if(r+=t,!Array.isArray(e))return{paramIndex:r,identifier:e,quantity:h.REQUIRED,withNew:!1};var n,i=e.slice(0,e.length-1),s=e[e.length-1],a=h.REQUIRED,o=!1;return i.forEach(function(e){if(e instanceof P)n=d.SELF;else if(e instanceof L)n=d.SKIP_SELF;else if(e instanceof H)a=h.OPTIONAL;else if(e instanceof $)a=h.MANY;else if(e instanceof G)o=!0;else throw new N("unknown dep modifier ".concat(e,"."))}),{paramIndex:r,identifier:s,quantity:a,lookUp:n,withNew:o}}):[]}function z(e,t,r){void 0===r&&(r=0),Y(t,r).forEach(function(t){O(e,t.identifier,t.paramIndex,t.quantity,t.lookUp)})}function X(e){return{unwrap:e}}function q(e){return!!e&&"function"==typeof e.dispose}var K=(u=function(e,t){return(u=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}u(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),Q=[],Z=function(e){function t(t,r,n){var i='Cannot find "'.concat(b(r),'" registered by any injector. It is the ').concat(n,'th param of "').concat(t&&!0===t[g]?b(t):t.name,'".');return e.call(this,i)||this}return K(t,e),t}(N),J=function(e){function t(t){var r=this,n='Cannot find "'.concat(b(t),'" registered by any injector. The stack of dependencies is: "').concat(Q.map(function(e){return b(e)}).join(" -> "),'".');return r=e.call(this,n)||this,Q.length=0,r}return K(t,e),t}(N),ee=function(){function e(e){var t=this;this.dependencyMap=new Map,this.normalizeDependencies(e).map(function(e){return t.add(e[0],e[1])})}return e.prototype.add=function(e,t){void 0===t&&(t={useClass:e,lazy:!1});var r=this.dependencyMap.get(e);void 0===r&&(r=[],this.dependencyMap.set(e,r)),r.push(t)},e.prototype.delete=function(e){this.dependencyMap.delete(e)},e.prototype.get=function(e,t){void 0===t&&(t=h.REQUIRED);var r=this.dependencyMap.get(e);return j(e,t,r.length),t===h.MANY?r:r[0]},e.prototype.has=function(e){return this.dependencyMap.has(e)},e.prototype.append=function(e){var t=this;this.normalizeDependencies(e).forEach(function(e){return t.add(e[0],e[1])})},e.prototype.dispose=function(){this.dependencyMap.clear()},e.prototype.normalizeDependencies=function(e){return e.map(function(e){var t,r=e[0];return[r,t=1===e.length?{useClass:e[0],lazy:!1}:e[1]]})},e}(),et=function(){function e(){this.resolvedDependencies=new Map}return e.prototype.add=function(e,t){var r=this.resolvedDependencies.get(e);void 0===r&&(r=[],this.resolvedDependencies.set(e,r)),r.push(t)},e.prototype.has=function(e){return this.resolvedDependencies.has(e)},e.prototype.delete=function(e){this.resolvedDependencies.has(e)&&(this.resolvedDependencies.get(e).forEach(function(e){return q(e)?e.dispose():void 0}),this.resolvedDependencies.delete(e))},e.prototype.get=function(e,t){void 0===t&&(t=h.REQUIRED);var r=this.resolvedDependencies.get(e);if(!r)throw new J(e);return(j(e,t,r.length),t===h.MANY)?r:r[0]},e.prototype.dispose=function(){Array.from(this.resolvedDependencies.values()).forEach(function(e){e.forEach(function(e){return q(e)?e.dispose():void 0})}),this.resolvedDependencies.clear()},e}();if("undefined"!=typeof requestIdleCallback&&"undefined"!=typeof cancelIdleCallback)m=function(e,t){var r=requestIdleCallback(e,"number"==typeof t?{timeout:t}:void 0),n=!1;return function(){n||(n=!0,cancelIdleCallback(r))}};else{var er=Object.freeze({didTimeout:!0,timeRemaining:function(){return 15}});m=function(e){var t=setTimeout(function(){return e(er)}),r=!1;return function(){r||(r=!0,clearTimeout(t))}}}var en=function(){function e(e){var t=this;this.didRun=!1,this.selfExecutor=function(){try{t.value=e()}catch(e){t.error=e}finally{t.didRun=!0}},this.disposeCallback=m(function(){return t.selfExecutor()})}return e.prototype.hasRun=function(){return this.didRun},e.prototype.dispose=function(){this.disposeCallback()},e.prototype.getValue=function(){if(this.didRun||(this.dispose(),this.selfExecutor()),this.error)throw this.error;return this.value},e}(),ei=(c=function(e,t){return(c=Object.setPrototypeOf||({__proto__:[]})instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}c(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),es=function(){return(es=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},ea=function(e,t,r){if(r||2==arguments.length)for(var n,i=0,s=t.length;i<s;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||Array.prototype.slice.call(t))},eo=Symbol("$$NOT_INSTANTIATED_SYMBOL"),el=function(e){function t(t){return e.call(this,'Detecting cyclic dependency. The last identifier is "'.concat(b(t),'".'))||this}return ei(t,e),t}(N),eu=function(e){function t(){return e.call(this,"Injector cannot be accessed after it was disposed.")||this}return ei(t,e),t}(N),ec=function(e){function t(t){return e.call(this,'Async item "'.concat(b(t),'" returns another async item.'))||this}return ei(t,e),t}(N),eh=function(e){function t(t){return e.call(this,'Cannot get async item "'.concat(b(t),'" from sync api.'))||this}return ei(t,e),t}(N),ed=function(e){function t(t){return e.call(this,'Cannot add dependency "'.concat(b(t),'" after it is already resolved.'))||this}return ei(t,e),t}(N),em=function(e){function t(t){return e.call(this,'Cannot dependency dependency "'.concat(b(t),'" after it is already resolved.'))||this}return ei(t,e),t}(N),eg=function(){function e(e,t){void 0===t&&(t=null),this.parent=t,this.children=[],this.resolutionOngoing=0,this.disposingCallbacks=new Set,this.disposed=!1,this.dependencyCollection=new ee(e||[]),this.resolvedDependencyCollection=new et,t&&t.children.push(this)}return e.prototype.onDispose=function(e){var t=this;return this.disposingCallbacks.add(e),{dispose:function(){return t.disposingCallbacks.delete(e)}}},e.prototype.createChild=function(t){return this._ensureInjectorNotDisposed(),new e(t,this)},e.prototype.dispose=function(){this.children.forEach(function(e){return e.dispose()}),this.children.length=0,this.dependencyCollection.dispose(),this.resolvedDependencyCollection.dispose(),this.deleteSelfFromParent(),this.disposed=!0,this.disposingCallbacks.forEach(function(e){return e()}),this.disposingCallbacks.clear()},e.prototype.deleteSelfFromParent=function(){if(this.parent){var e=this.parent.children.indexOf(this);e>-1&&this.parent.children.splice(e,1)}},e.prototype.add=function(e){this._ensureInjectorNotDisposed();var t=e[0],r=e[1];if(this.resolvedDependencyCollection.has(t))throw new ed(t);void 0===r?this.dependencyCollection.add(t):y(r)||p(r)||_(r)||C(r)?this.dependencyCollection.add(t,r):this.resolvedDependencyCollection.add(t,r)},e.prototype.replace=function(e){this._ensureInjectorNotDisposed();var t=e[0];if(this.resolvedDependencyCollection.has(t))throw new ed(t);this.dependencyCollection.delete(t),1===e.length?this.dependencyCollection.add(t):this.dependencyCollection.add(t,e[1])},e.prototype.delete=function(e){if(this._ensureInjectorNotDisposed(),this.resolvedDependencyCollection.has(e))throw new em(e);this.dependencyCollection.delete(e)},e.prototype.invoke=function(e){for(var t=this,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return this._ensureInjectorNotDisposed(),e.apply(void 0,ea([{get:function(e,r,n){return t._get(e,r,n)},has:function(e){return t.has(e)}}],r,!1))},e.prototype.has=function(e){var t;return this.dependencyCollection.has(e)||(null==(t=this.parent)?void 0:t.has(e))||!1},e.prototype.get=function(e,t,r){this._ensureInjectorNotDisposed();var n=this._get(e,t,r);if(Array.isArray(n)&&n.some(function(e){return R(e)})||R(n))throw new eh(e);return n},e.prototype._get=function(e,t,r,n){var i=h.REQUIRED;if(t===h.REQUIRED||t===h.OPTIONAL||t===h.MANY?i=t:r=t,!n){var s=this.getValue(e,i,r);if(s!==eo)return s}return this.createDependency(e,i,r,!n)},e.prototype.getAsync=function(e){this._ensureInjectorNotDisposed();var t=this.getValue(e,h.REQUIRED);if(t!==eo)return Promise.resolve(t);var r=this.createDependency(e,h.REQUIRED);return R(r)?r.whenReady():Promise.resolve(r)},e.prototype.createInstance=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this._ensureInjectorNotDisposed(),this._resolveClassImpl.apply(this,ea([{useClass:e}],t,!1))},e.prototype._resolveDependency=function(e,t,r){var n;void 0===r&&(r=!0),Q.push(e);try{n=_(t)?this._resolveValueDependency(e,t):C(t)?this._resolveFactory(e,t,r):p(t)?this._resolveClass(e,t,r):(t&&void 0!==t.useExisting?0:1)?this._resolveAsync(e,t):this._resolveExisting(e,t),Q.pop()}catch(e){throw Q.pop(),e}return n},e.prototype._resolveExisting=function(e,t){var r=this.get(t.useExisting);return this.resolvedDependencyCollection.add(e,r),r},e.prototype._resolveValueDependency=function(e,t){var r=t.useValue;return this.resolvedDependencyCollection.add(e,r),r},e.prototype._resolveClass=function(e,t,r){var n,i=this;if(void 0===r&&(r=!0),t.lazy){var s=new en(function(){return i._ensureInjectorNotDisposed(),i._resolveClassImpl(t)});n=new Proxy(Object.create(null),{get:function(e,t){if(t in e)return e[t];if("whenReady"!==t){var r=s.getValue(),n=r[t];return"function"!=typeof n||(n=n.bind(r),e[t]=n),n}},set:function(e,t,r){return s.getValue()[t]=r,!0}})}else n=this._resolveClassImpl(t);return e&&r&&this.resolvedDependencyCollection.add(e,n),n},e.prototype._resolveClassImpl=function(e){for(var t,r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];var i=e.useClass;this.markNewResolution(i);for(var s=(i[v]||[]).sort(function(e,t){return e.paramIndex-t.paramIndex}).map(function(e){var t,r;return es(es({},e),{identifier:(r=t=e.identifier)&&"function"==typeof r.unwrap?t.unwrap():t})}),a=[],o=0;o<s.length;o++){var l=s[o];try{var u=this._get(l.identifier,l.quantity,l.lookUp,l.withNew);a.push(u)}catch(e){if(e instanceof J||e instanceof k&&0===e.actual)throw new Z(i,l.identifier,l.paramIndex);throw e}}var c=ea([],r,!0),h=s.length>0?s[0].paramIndex:c.length;if(c.length!==h){console.warn("[redi]: Expect ".concat(h," custom parameter(s) of ").concat(b(i)," but get ").concat(c.length,"."));var d=h-c.length;c=d>0?ea(ea([],c,!0),Array.from({length:d}).fill(void 0),!0):c.slice(0,h)}var m=new(i.bind.apply(i,ea(ea([void 0],c,!1),a,!1)));return null==(t=null==e?void 0:e.onInstantiation)||t.call(e,m),this.markResolutionCompleted(),m},e.prototype._resolveFactory=function(e,t,r){this.markNewResolution(e);for(var n,i=Y(t.deps),s=[],a=0;a<i.length;a++){var o=i[a];try{var l=this._get(o.identifier,o.quantity,o.lookUp,o.withNew);s.push(l)}catch(t){if(t instanceof J||t instanceof k&&0===t.actual)throw new Z(e,o.identifier,o.paramIndex);throw t}}var u=t.useFactory.apply(null,s);return r&&this.resolvedDependencyCollection.add(e,u),this.markResolutionCompleted(),null==(n=null==t?void 0:t.onInstantiation)||n.call(t,u),u},e.prototype._resolveAsync=function(e,t){var r=this;return{__symbol:E,whenReady:function(){return r._resolveAsyncImpl(e,t)}}},e.prototype._resolveAsyncImpl=function(e,t){var r=this;return t.useAsync().then(function(n){var i,s=r.getValue(e);if(s!==eo)return s;if(Array.isArray(n)){var a=n[1];if(y(a))throw new ec(e);i=r._resolveDependency(e,a)}else i=f(n)?r._resolveClassImpl({useClass:n,onInstantiation:t.onInstantiation}):n;return r.resolvedDependencyCollection.add(e,i),i})},e.prototype.getValue=function(t,r,n){var i=this;void 0===r&&(r=h.REQUIRED);var s=function(){return i.parent?i.parent.getValue(t,r):(j(t,r,0),r===h.MANY)?[]:null};return n===d.SKIP_SELF?s():t===e?this:n===d.SELF||this.resolvedDependencyCollection.has(t)||this.dependencyCollection.has(t)?i.dependencyCollection.has(t)&&!i.resolvedDependencyCollection.has(t)?eo:i.resolvedDependencyCollection.get(t,r):s()},e.prototype.createDependency=function(e,t,r,n){var i,s,a=this;void 0===t&&(t=h.REQUIRED),void 0===n&&(n=!0);var o=function(){if(a.parent)return a.parent.createDependency(e,t,void 0,n);if(t===h.OPTIONAL)return null;throw Q.push(e),new J(e)};return r===d.SKIP_SELF?o():this.dependencyCollection.has(e)?(i=a.dependencyCollection.get(e,t),s=null,Array.isArray(i)?s=i.map(function(t){return a._resolveDependency(e,t,n)}):i&&(s=a._resolveDependency(e,i,n)),s):o()},e.prototype.markNewResolution=function(e){if(this.resolutionOngoing+=1,this.resolutionOngoing>=300)throw new el(e)},e.prototype.markResolutionCompleted=function(){this.resolutionOngoing-=1},e.prototype._ensureInjectorNotDisposed=function(){if(this.disposed)throw new eu},e}(),ef="undefined"!=typeof globalThis&&globalThis||"undefined"!=typeof window&&window||void 0!==n&&n,ep="REDI_GLOBAL_LOCK";ef[ep]?console.error("[redi]: You are loading scripts of redi more than once! This may cause undesired behavior in your application.\nMaybe your dependencies added redi as its dependency and bundled redi to its dist files. Or you import different versions of redi.\nFor more info please visit our website: https://redi.wendell.fun/en-US/docs/debug#import-scripts-of-redi-more-than-once"):ef[ep]=!0}),c("hBGpS",function(e,t){i(e.exports,"defaultTheme",function(){return r}),i(e.exports,"greenTheme",function(){return n});let r={white:"#FFFFFF",black:"#000000",primary:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},gray:{50:"#F9FAFB",100:"#EEEFF1",200:"#E3E5EA",300:"#A8B0BD",400:"#7D8698",500:"#4E5565",600:"#31363F",700:"#272A2F",800:"#1F2124",900:"#1B1C1F"},blue:{50:"#EBF5FF",100:"#E1EFFE",200:"#C3DDFD",300:"#A4CAFE",400:"#76A9FA",500:"#3F83F8",600:"#1C64F2",700:"#1A56DB",800:"#1E429F",900:"#233876"},red:{50:"#FDF2F2",100:"#FDE8E8",200:"#FBD5D5",300:"#F8B4B4",400:"#F98080",500:"#F05252",600:"#E02424",700:"#C81E1E",800:"#9B1C1C",900:"#771D1D"},orange:{50:"#FFF8F1",100:"#FEECDC",200:"#FCD9BD",300:"#FDBA8C",400:"#FF8A4C",500:"#FF5A1F",600:"#D03801",700:"#B43403",800:"#8A2C0D",900:"#771D1D"},yellow:{50:"#FDFCEA",100:"#FFF4B9",200:"#FCDC6A",300:"#FAC815",400:"#F1B312",500:"#D49D0F",600:"#AB7F0E",700:"#9A6D15",800:"#725213",900:"#634312"},green:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},jiqing:{50:"#EDFAFA",100:"#D5F5F6",200:"#AFECEF",300:"#7EDCE2",400:"#16BDCA",500:"#0694A2",600:"#047481",700:"#036672",800:"#05505C",900:"#014451"},indigo:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},purple:{50:"#F6F5FF",100:"#EDEBFE",200:"#DCD7FE",300:"#CABFFD",400:"#AC94FA",500:"#9061F9",600:"#7E3AF2",700:"#6C2BD9",800:"#5521B5",900:"#4A1D96"},pink:{50:"#FDF2F8",100:"#FCE8F3",200:"#FAD1E8",300:"#F8B4D9",400:"#F17EB8",500:"#E74694",600:"#D61F69",700:"#BF125D",800:"#99154B",900:"#751A3D"},"loop-color":{1:"purple.400",2:"green.500",3:"blue.500",4:"yellow.400",5:"pink.300",6:"jiqing.600",7:"orange.400",8:"gray.800",9:"indigo.500",10:"red.300",11:"green.600",12:"yellow.700"}},n={white:"#FFFFFF",black:"#000000",primary:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},gray:{50:"#F9FAFB",100:"#EEEFF1",200:"#E3E5EA",300:"#A8B0BD",400:"#7D8698",500:"#4E5565",600:"#31363F",700:"#272A2F",800:"#1F2124",900:"#1B1C1F"},blue:{50:"#EBF5FF",100:"#E1EFFE",200:"#C3DDFD",300:"#A4CAFE",400:"#76A9FA",500:"#3F83F8",600:"#1C64F2",700:"#1A56DB",800:"#1E429F",900:"#233876"},red:{50:"#FDF2F2",100:"#FDE8E8",200:"#FBD5D5",300:"#F8B4B4",400:"#F98080",500:"#F05252",600:"#E02424",700:"#C81E1E",800:"#9B1C1C",900:"#771D1D"},orange:{50:"#FFF8F1",100:"#FEECDC",200:"#FCD9BD",300:"#FDBA8C",400:"#FF8A4C",500:"#FF5A1F",600:"#D03801",700:"#B43403",800:"#8A2C0D",900:"#771D1D"},yellow:{50:"#FDFCEA",100:"#FFF4B9",200:"#FCDC6A",300:"#FAC815",400:"#F1B312",500:"#D49D0F",600:"#AB7F0E",700:"#9A6D15",800:"#725213",900:"#634312"},green:{50:"#F3FAF7",100:"#DEF7EC",200:"#BCF0DA",300:"#84E1BC",400:"#31C48D",500:"#0DA471",600:"#057A55",700:"#046C4E",800:"#03543F",900:"#014737"},jiqing:{50:"#EDFAFA",100:"#D5F5F6",200:"#AFECEF",300:"#7EDCE2",400:"#16BDCA",500:"#0694A2",600:"#047481",700:"#036672",800:"#05505C",900:"#014451"},indigo:{50:"#F3F5FF",100:"#E9EDFF",200:"#D2DAFA",300:"#BAC6F8",400:"#6280F9",500:"#466AF7",600:"#2C53F1",700:"#143EE3",800:"#083AD1",900:"#1033BF"},purple:{50:"#F6F5FF",100:"#EDEBFE",200:"#DCD7FE",300:"#CABFFD",400:"#AC94FA",500:"#9061F9",600:"#7E3AF2",700:"#6C2BD9",800:"#5521B5",900:"#4A1D96"},pink:{50:"#FDF2F8",100:"#FCE8F3",200:"#FAD1E8",300:"#F8B4D9",400:"#F17EB8",500:"#E74694",600:"#D61F69",700:"#BF125D",800:"#99154B",900:"#751A3D"},"loop-color":{1:"purple.400",2:"green.500",3:"blue.500",4:"yellow.400",5:"pink.300",6:"jiqing.600",7:"orange.400",8:"gray.800",9:"indigo.500",10:"red.300",11:"green.600",12:"yellow.700"}}}),c("8L69c",function(e,t){var r,n,i,s=e.exports={};function a(){throw Error("setTimeout has not been defined")}function o(){throw Error("clearTimeout has not been defined")}try{r="function"==typeof setTimeout?setTimeout:a}catch(e){r=a}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}function l(e){if(r===setTimeout)return setTimeout(e,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}var u=[],c=!1,h=-1;function d(){c&&i&&(c=!1,i.length?u=i.concat(u):h=-1,u.length&&m())}function m(){if(!c){var e=l(d);c=!0;for(var t=u.length;t;){for(i=u,u=[];++h<t;)i&&i[h].run();h=-1,t=u.length}i=null,c=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}s.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];u.push(new g(e,t)),1!==u.length||c||l(m)},g.prototype.run=function(){this.fun.apply(null,this.array)},s.title="browser",s.browser=!0,s.env={},s.argv=[],s.version="",s.versions={},s.on=f,s.addListener=f,s.once=f,s.off=f,s.removeListener=f,s.removeAllListeners=f,s.emit=f,s.prependListener=f,s.prependOnceListener=f,s.listeners=function(e){return[]},s.binding=function(e){throw Error("process.binding is not supported")},s.cwd=function(){return"/"},s.chdir=function(e){throw Error("process.chdir is not supported")},s.umask=function(){return 0}}),c("ejawP",function(e,t){let r,n,s,a,o,l,c,h,d,m,g,f,p,C,_,y,E;i(e.exports,"ViewStateEnum",function(){return B}),i(e.exports,"EditStateEnum",function(){return $}),i(e.exports,"RangeProtectionRuleModel",function(){return H}),i(e.exports,"FactoryDeleteRangeProtectionMutation",function(){return W}),i(e.exports,"AddRangeProtectionMutation",function(){return z}),i(e.exports,"DeleteRangeProtectionMutation",function(){return G}),i(e.exports,"FactoryAddRangeProtectionMutation",function(){return Y}),i(e.exports,"AddRangeProtectionCommand",function(){return X}),i(e.exports,"WorksheetProtectionRuleModel",function(){return q}),i(e.exports,"AddWorksheetProtectionMutation",function(){return K}),i(e.exports,"DeleteWorksheetProtectionMutation",function(){return Q}),i(e.exports,"AddWorksheetProtectionCommand",function(){return Z}),i(e.exports,"INTERCEPTOR_POINT",function(){return J}),i(e.exports,"InterceptCellContentPriority",function(){return ee}),i(e.exports,"BEFORE_CELL_EDIT",function(){return ei}),i(e.exports,"AFTER_CELL_EDIT",function(){return es}),i(e.exports,"VALIDATE_CELL",function(){return ea}),i(e.exports,"SheetInterceptorService",function(){return eo}),i(e.exports,"RangeThemeStyle",function(){return eh}),i(e.exports,"SheetRangeThemeModel",function(){return eb}),i(e.exports,"getSheetCommandTargetWorkbook",function(){return eI}),i(e.exports,"getSheetCommandTarget",function(){return eN}),i(e.exports,"getSheetMutationTarget",function(){return eS}),i(e.exports,"SetWorksheetRangeThemeStyleMutation",function(){return eA}),i(e.exports,"SetWorksheetRangeThemeStyleMutationFactory",function(){return ev}),i(e.exports,"DeleteWorksheetRangeThemeStyleMutation",function(){return eT}),i(e.exports,"DeleteWorksheetRangeThemeStyleMutationFactory",function(){return ew}),i(e.exports,"SetWorksheetRangeThemeStyleCommand",function(){return eM}),i(e.exports,"InsertRowMutationUndoFactory",function(){return eO}),i(e.exports,"InsertRowMutation",function(){return ex}),i(e.exports,"InsertColMutationUndoFactory",function(){return eU}),i(e.exports,"InsertColMutation",function(){return eD}),i(e.exports,"RemoveRowMutation",function(){return eL}),i(e.exports,"RemoveColMutation",function(){return eF}),i(e.exports,"checkCellValueType",function(){return eB}),i(e.exports,"SetRangeValuesUndoMutationFactory",function(){return eH}),i(e.exports,"SetRangeValuesMutation",function(){return eW}),i(e.exports,"AppendRowCommand",function(){return eG}),i(e.exports,"generateNullCell",function(){return eX}),i(e.exports,"generateNullCellValue",function(){return eq}),i(e.exports,"rangeToDiscreteRange",function(){return eK}),i(e.exports,"getVisibleRanges",function(){return eQ}),i(e.exports,"SelectionMoveType",function(){return eZ}),i(e.exports,"WorkbookSelectionModel",function(){return eJ}),i(e.exports,"SheetsSelectionsService",function(){return e1}),i(e.exports,"DISABLE_NORMAL_SELECTIONS",function(){return e2}),i(e.exports,"SELECTIONS_ENABLED",function(){return e5}),i(e.exports,"REF_SELECTIONS_ENABLED",function(){return e3}),i(e.exports,"ClearSelectionAllCommand",function(){return e4}),i(e.exports,"ClearSelectionContentCommand",function(){return e6}),i(e.exports,"ClearSelectionFormatCommand",function(){return e9}),i(e.exports,"InsertSheetUndoMutationFactory",function(){return e8}),i(e.exports,"InsertSheetMutation",function(){return e7}),i(e.exports,"RemoveSheetUndoMutationFactory",function(){return te}),i(e.exports,"RemoveSheetMutation",function(){return tt}),i(e.exports,"CopySheetCommand",function(){return tr}),i(e.exports,"MoveRangeMutation",function(){return tn}),i(e.exports,"alignToMergedCellsBorders",function(){return ti}),i(e.exports,"getCellAtRowCol",function(){return ts}),i(e.exports,"setEndForRange",function(){return ta}),i(e.exports,"getPrimaryForRange",function(){return to}),i(e.exports,"followSelectionOperation",function(){return tl}),i(e.exports,"SetSelectionsOperation",function(){return tp}),i(e.exports,"isSingleCellSelection",function(){return tu}),i(e.exports,"copyRangeStyles",function(){return th}),i(e.exports,"IRefSelectionsService",function(){return tm}),i(e.exports,"RefSelectionsService",function(){return tg}),i(e.exports,"getSelectionsService",function(){return tf}),i(e.exports,"SelectRangeCommand",function(){return tC}),i(e.exports,"MoveRangeCommand",function(){return ty}),i(e.exports,"getMoveRangeUndoRedoMutations",function(){return tE}),i(e.exports,"UnitAction",function(){return tb}),i(e.exports,"UnitObject",function(){return tI}),i(e.exports,"RangeProtectionPermissionEditPoint",function(){return tN}),i(e.exports,"RangeProtectionPermissionViewPoint",function(){return tS}),i(e.exports,"WorkbookCommentPermission",function(){return tA}),i(e.exports,"WorkbookCopyPermission",function(){return tv}),i(e.exports,"WorkbookCopySheetPermission",function(){return tT}),i(e.exports,"WorkbookCreateProtectPermission",function(){return tw}),i(e.exports,"WorkbookCreateSheetPermission",function(){return tM}),i(e.exports,"WorkbookDeleteSheetPermission",function(){return tO}),i(e.exports,"WorkbookDuplicatePermission",function(){return tx}),i(e.exports,"WorkbookEditablePermission",function(){return tU}),i(e.exports,"WorkbookExportPermission",function(){return tD}),i(e.exports,"WorkbookHideSheetPermission",function(){return tV}),i(e.exports,"WorkbookHistoryPermission",function(){return tL}),i(e.exports,"WorkbookManageCollaboratorPermission",function(){return tP}),i(e.exports,"WorkbookMoveSheetPermission",function(){return tF}),i(e.exports,"WorkbookPrintPermission",function(){return tk}),i(e.exports,"WorkbookRecoverHistoryPermission",function(){return tj}),i(e.exports,"WorkbookRenameSheetPermission",function(){return tB}),i(e.exports,"WorkbookSharePermission",function(){return t$}),i(e.exports,"WorkbookViewPermission",function(){return tH}),i(e.exports,"WorkbookViewHistoryPermission",function(){return tW}),i(e.exports,"WorksheetCopyPermission",function(){return tG}),i(e.exports,"WorksheetDeleteColumnPermission",function(){return tY}),i(e.exports,"WorksheetDeleteProtectionPermission",function(){return tz}),i(e.exports,"WorksheetDeleteRowPermission",function(){return tX}),i(e.exports,"WorksheetEditPermission",function(){return tq}),i(e.exports,"WorksheetEditExtraObjectPermission",function(){return tK}),i(e.exports,"WorksheetFilterPermission",function(){return tQ}),i(e.exports,"WorksheetInsertColumnPermission",function(){return tZ}),i(e.exports,"WorksheetInsertHyperlinkPermission",function(){return tJ}),i(e.exports,"WorksheetInsertRowPermission",function(){return t0}),i(e.exports,"WorksheetManageCollaboratorPermission",function(){return t1}),i(e.exports,"WorksheetPivotTablePermission",function(){return t2}),i(e.exports,"WorksheetSelectProtectedCellsPermission",function(){return t5}),i(e.exports,"WorksheetSelectUnProtectedCellsPermission",function(){return t3}),i(e.exports,"WorksheetSetCellStylePermission",function(){return t4}),i(e.exports,"WorksheetSetCellValuePermission",function(){return t6}),i(e.exports,"WorksheetSetColumnStylePermission",function(){return t9}),i(e.exports,"WorksheetSetRowStylePermission",function(){return t8}),i(e.exports,"WorksheetSortPermission",function(){return t7}),i(e.exports,"WorksheetViewPermission",function(){return re}),i(e.exports,"SetRangeValuesCommand",function(){return rt}),i(e.exports,"getInsertRangeMutations",function(){return rr}),i(e.exports,"getRemoveRangeMutations",function(){return rn}),i(e.exports,"handleInsertRangeMutation",function(){return ri}),i(e.exports,"handleDeleteRangeMutation",function(){return rs}),i(e.exports,"DeleteRangeMoveLeftCommand",function(){return ro}),i(e.exports,"DeleteRangeMoveUpCommand",function(){return ru}),i(e.exports,"DeleteRangeProtectionCommand",function(){return rc}),i(e.exports,"DeleteWorksheetProtectionCommand",function(){return rh}),i(e.exports,"DeleteWorksheetRangeThemeStyleCommand",function(){return rd}),i(e.exports,"InsertDefinedNameCommand",function(){return rm}),i(e.exports,"InsertRangeMoveDownCommand",function(){return rg}),i(e.exports,"InsertRangeMoveRightCommand",function(){return rp}),i(e.exports,"InsertRowCommand",function(){return r_}),i(e.exports,"InsertRowByRangeCommand",function(){return ry}),i(e.exports,"InsertRowBeforeCommand",function(){return rE}),i(e.exports,"InsertRowAfterCommand",function(){return rR}),i(e.exports,"InsertMultiRowsAboveCommand",function(){return rb}),i(e.exports,"InsertMultiRowsAfterCommand",function(){return rI}),i(e.exports,"InsertColCommand",function(){return rS}),i(e.exports,"InsertColByRangeCommand",function(){return rA}),i(e.exports,"InsertColBeforeCommand",function(){return rv}),i(e.exports,"InsertColAfterCommand",function(){return rT}),i(e.exports,"InsertMultiColsLeftCommand",function(){return rw}),i(e.exports,"InsertMultiColsRightCommand",function(){return rM}),i(e.exports,"InsertSheetCommand",function(){return rO}),i(e.exports,"MoveRowsMutationUndoFactory",function(){return rx}),i(e.exports,"MoveRowsMutation",function(){return rU}),i(e.exports,"MoveColsMutationUndoFactory",function(){return rD}),i(e.exports,"MoveColsMutation",function(){return rV}),i(e.exports,"MoveRowsCommand",function(){return rP}),i(e.exports,"MoveColsCommand",function(){return rk}),i(e.exports,"RegisterWorksheetRangeThemeStyleMutation",function(){return rB}),i(e.exports,"UnregisterWorksheetRangeThemeStyleMutation",function(){return r$}),i(e.exports,"RegisterWorksheetRangeThemeStyleCommand",function(){return rH}),i(e.exports,"RemoveDefinedNameCommand",function(){return rW}),i(e.exports,"RemoveRowByRangeCommand",function(){return rY}),i(e.exports,"RemoveRowCommand",function(){return rz}),i(e.exports,"RemoveColByRangeCommand",function(){return rq}),i(e.exports,"RemoveColCommand",function(){return rK}),i(e.exports,"RemoveSheetCommand",function(){return rQ}),i(e.exports,"AddMergeUndoMutationFactory",function(){return rZ}),i(e.exports,"AddWorksheetMergeMutation",function(){return rJ}),i(e.exports,"RemoveMergeUndoMutationFactory",function(){return r0}),i(e.exports,"RemoveWorksheetMergeMutation",function(){return r1}),i(e.exports,"RemoveWorksheetMergeCommand",function(){return r2}),i(e.exports,"ReorderRangeUndoMutationFactory",function(){return r5}),i(e.exports,"ReorderRangeMutation",function(){return r3}),i(e.exports,"ReorderRangeCommand",function(){return r6}),i(e.exports,"BorderStyleManagerService",function(){return r9}),i(e.exports,"SetBorderCommand",function(){return ni}),i(e.exports,"SetBorderPositionCommand",function(){return ns}),i(e.exports,"SetBorderStyleCommand",function(){return na}),i(e.exports,"SetBorderColorCommand",function(){return no}),i(e.exports,"SetBorderBasicCommand",function(){return nl}),i(e.exports,"SetColDataMutationFactory",function(){return nu}),i(e.exports,"SetColDataMutation",function(){return nc}),i(e.exports,"SetColDataCommand",function(){return nh}),i(e.exports,"SetColHiddenMutation",function(){return nm}),i(e.exports,"SetColVisibleMutation",function(){return nf}),i(e.exports,"SetSpecificColsVisibleCommand",function(){return np}),i(e.exports,"SetSelectedColsVisibleCommand",function(){return nC}),i(e.exports,"SetColHiddenCommand",function(){return n_}),i(e.exports,"SetDefinedNameCommand",function(){return nE}),i(e.exports,"SetFrozenMutationFactory",function(){return nR}),i(e.exports,"SetFrozenMutation",function(){return nb}),i(e.exports,"SetFrozenCommand",function(){return nI}),i(e.exports,"CancelFrozenCommand",function(){return nN}),i(e.exports,"SetGridlinesColorMutation",function(){return nS}),i(e.exports,"SetGridlinesColorCommand",function(){return nA}),i(e.exports,"SetRangeProtectionMutation",function(){return nv}),i(e.exports,"FactorySetRangeProtectionMutation",function(){return nT}),i(e.exports,"SetWorksheetProtectionMutation",function(){return nw}),i(e.exports,"SetProtectionCommand",function(){return nM}),i(e.exports,"SetRowDataMutationFactory",function(){return nO}),i(e.exports,"SetRowDataMutation",function(){return nx}),i(e.exports,"SetRowDataCommand",function(){return nU}),i(e.exports,"SetRowVisibleMutation",function(){return nV}),i(e.exports,"SetRowHiddenMutation",function(){return nP}),i(e.exports,"SetSpecificRowsVisibleCommand",function(){return nF}),i(e.exports,"SetSelectedRowsVisibleCommand",function(){return nk}),i(e.exports,"SetRowHiddenCommand",function(){return nj}),i(e.exports,"SetStyleCommand",function(){return n$}),i(e.exports,"SetBoldCommand",function(){return nH}),i(e.exports,"SetItalicCommand",function(){return nW}),i(e.exports,"SetUnderlineCommand",function(){return nG}),i(e.exports,"SetStrikeThroughCommand",function(){return nY}),i(e.exports,"SetOverlineCommand",function(){return nz}),i(e.exports,"SetFontFamilyCommand",function(){return nX}),i(e.exports,"SetFontSizeCommand",function(){return nq}),i(e.exports,"SetTextColorCommand",function(){return nK}),i(e.exports,"ResetTextColorCommand",function(){return nQ}),i(e.exports,"SetBackgroundColorCommand",function(){return nZ}),i(e.exports,"ResetBackgroundColorCommand",function(){return nJ}),i(e.exports,"SetVerticalTextAlignCommand",function(){return n0}),i(e.exports,"SetHorizontalTextAlignCommand",function(){return n1}),i(e.exports,"SetTextWrapCommand",function(){return n2}),i(e.exports,"SetTextRotationCommand",function(){return n5}),i(e.exports,"SetTabColorMutation",function(){return n4}),i(e.exports,"SetTabColorCommand",function(){return n6}),i(e.exports,"SetWorkbookNameMutation",function(){return n9}),i(e.exports,"SetWorkbookNameCommand",function(){return n8}),i(e.exports,"SetWorksheetActiveOperation",function(){return n7}),i(e.exports,"SetWorksheetActivateCommand",function(){return ie}),i(e.exports,"SetWorksheetColWidthMutationFactory",function(){return it}),i(e.exports,"SetWorksheetColWidthMutation",function(){return ir}),i(e.exports,"DeltaColumnWidthCommand",function(){return ii}),i(e.exports,"SetColWidthCommand",function(){return is}),i(e.exports,"SetWorksheetColumnCountUndoMutationFactory",function(){return ia}),i(e.exports,"SetWorksheetColumnCountMutation",function(){return io}),i(e.exports,"SetWorksheetColumnCountCommand",function(){return il}),i(e.exports,"SetWorksheetDefaultStyleMutation",function(){return iu}),i(e.exports,"SetWorksheetDefaultStyleMutationFactory",function(){return ic}),i(e.exports,"SetWorksheetDefaultStyleCommand",function(){return ih}),i(e.exports,"SetWorksheetHideMutation",function(){return im}),i(e.exports,"SetWorksheetHideCommand",function(){return ig}),i(e.exports,"SetWorksheetNameMutation",function(){return iC}),i(e.exports,"SetWorksheetNameCommand",function(){return i_}),i(e.exports,"SetWorksheetOrderMutation",function(){return iE}),i(e.exports,"SetWorksheetOrderCommand",function(){return iR}),i(e.exports,"WorksheetProtectionPointModel",function(){return ib}),i(e.exports,"RangeProtectionPermissionDeleteProtectionPoint",function(){return iI}),i(e.exports,"RangeProtectionPermissionManageCollaPoint",function(){return iN}),i(e.exports,"getAllRangePermissionPoint",function(){return iS}),i(e.exports,"baseProtectionActions",function(){return iA}),i(e.exports,"getDefaultRangePermission",function(){return iv}),i(e.exports,"getAllWorkbookPermissionPoint",function(){return iT}),i(e.exports,"defaultWorkbookPermissionPoints",function(){return iw}),i(e.exports,"getAllWorksheetPermissionPoint",function(){return iM}),i(e.exports,"getAllWorksheetPermissionPointByPointPanel",function(){return iO}),i(e.exports,"defaultWorksheetPermissionPoint",function(){return ix}),i(e.exports,"WorksheetPermissionService",function(){return iV}),i(e.exports,"SetWorksheetPermissionPointsMutation",function(){return iL}),i(e.exports,"SetWorksheetPermissionPointsCommand",function(){return iP}),i(e.exports,"SetWorksheetProtectionCommand",function(){return iF}),i(e.exports,"SetWorksheetRowCountUndoMutationFactory",function(){return ik}),i(e.exports,"SetWorksheetRowCountMutation",function(){return ij}),i(e.exports,"SetWorksheetRowCountCommand",function(){return iB}),i(e.exports,"SetWorksheetRowAutoHeightMutationFactory",function(){return iW}),i(e.exports,"SetWorksheetRowHeightMutation",function(){return iG}),i(e.exports,"SetWorksheetRowIsAutoHeightMutation",function(){return iY}),i(e.exports,"SetWorksheetRowAutoHeightMutation",function(){return iz}),i(e.exports,"DeltaRowHeightCommand",function(){return iX}),i(e.exports,"SetRowHeightCommand",function(){return iq}),i(e.exports,"SetWorksheetRowIsAutoHeightCommand",function(){return iK}),i(e.exports,"SetWorksheetShowCommand",function(){return iQ}),i(e.exports,"SplitDelimiterEnum",function(){return iZ}),i(e.exports,"splitRangeText",function(){return i1}),i(e.exports,"SplitTextToColumnsCommand",function(){return i2}),i(e.exports,"ToggleCellCheckboxCommand",function(){return i5}),i(e.exports,"ToggleGridlinesMutation",function(){return i3}),i(e.exports,"ToggleGridlinesCommand",function(){return i4}),i(e.exports,"UnregisterWorksheetRangeThemeStyleCommand",function(){return i6}),i(e.exports,"EmptyMutation",function(){return i9}),i(e.exports,"createTopMatrixFromRanges",function(){return i8}),i(e.exports,"createTopMatrixFromMatrix",function(){return i7}),i(e.exports,"findAllRectangle",function(){return sr}),i(e.exports,"rangeMerge",function(){return sn}),i(e.exports,"RangeMergeUtil",function(){return si}),i(e.exports,"INumfmtService",function(){return ss}),i(e.exports,"factorySetNumfmtUndoMutation",function(){return sa}),i(e.exports,"transformCellsToRange",function(){return sc}),i(e.exports,"SetNumfmtMutation",function(){return so}),i(e.exports,"RemoveNumfmtMutation",function(){return sl}),i(e.exports,"factoryRemoveNumfmtUndoMutation",function(){return su}),i(e.exports,"ScrollToCellOperation",function(){return sh}),i(e.exports,"MAX_CELL_PER_SHEET_KEY",function(){return sm}),i(e.exports,"SetRangeThemeMutation",function(){return sg}),i(e.exports,"RemoveRangeThemeMutation",function(){return sf}),i(e.exports,"AddRangeThemeMutation",function(){return sp}),i(e.exports,"SCOPE_WORKBOOK_VALUE_DEFINED_NAME",function(){return sA}),i(e.exports,"DefinedNameDataController",function(){return sv}),i(e.exports,"EffectRefRangId",function(){return sT}),i(e.exports,"OperatorType",function(){return sw}),i(e.exports,"rotateRange",function(){return sx}),i(e.exports,"handleBaseMoveRowsCols",function(){return sU}),i(e.exports,"handleMoveRows",function(){return sD}),i(e.exports,"handleMoveCols",function(){return sP}),i(e.exports,"handleMoveRange",function(){return sk}),i(e.exports,"handleBaseRemoveRange",function(){return sB}),i(e.exports,"handleIRemoveCol",function(){return s$}),i(e.exports,"handleIRemoveRow",function(){return sH}),i(e.exports,"handleBaseInsertRange",function(){return sG}),i(e.exports,"handleInsertRow",function(){return sY}),i(e.exports,"handleInsertCol",function(){return sz}),i(e.exports,"handleInsertRangeMoveDown",function(){return sX}),i(e.exports,"handleInsertRangeMoveRight",function(){return sK}),i(e.exports,"handleDeleteRangeMoveLeft",function(){return sZ}),i(e.exports,"handleDeleteRangeMoveUp",function(){return s0}),i(e.exports,"runRefRangeMutations",function(){return s4}),i(e.exports,"handleDefaultRangeChangeWithEffectRefCommands",function(){return s6}),i(e.exports,"handleDefaultRangeChangeWithEffectRefCommandsSkipNoInterests",function(){return s9}),i(e.exports,"handleCommonDefaultRangeChangeWithEffectRefCommands",function(){return s8}),i(e.exports,"handleCommonRangeChangeWithEffectRefCommandsSkipNoInterests",function(){return s7}),i(e.exports,"adjustRangeOnMutation",function(){return ae}),i(e.exports,"getSeparateEffectedRangesOnCommand",function(){return ar}),i(e.exports,"RefRangeService",function(){return au}),i(e.exports,"getAddMergeMutationRangeByType",function(){return aC}),i(e.exports,"MERGE_CELL_INTERCEPTOR_CHECK",function(){return a_}),i(e.exports,"MergeCellController",function(){return ay}),i(e.exports,"SheetPermissionCheckController",function(){return aA}),i(e.exports,"WorkbookPermissionService",function(){return aw}),i(e.exports,"SheetPermissionInitController",function(){return ax}),i(e.exports,"RangeProtectionCache",function(){return aV}),i(e.exports,"RangeProtectionRenderModel",function(){return aB}),i(e.exports,"IExclusiveRangeService",function(){return a$}),i(e.exports,"ExclusiveRangeService",function(){return aH}),i(e.exports,"NumfmtService",function(){return aY}),i(e.exports,"RangeProtectionRefRangeService",function(){return aQ}),i(e.exports,"RangeProtectionService",function(){return a0}),i(e.exports,"SheetRangeThemeService",function(){return a2}),i(e.exports,"SheetSkeletonService",function(){return a3}),i(e.exports,"UniverSheetsPlugin",function(){return oe}),i(e.exports,"SheetSkeletonChangeType",function(){return ot}),i(e.exports,"SheetValueChangeType",function(){return or}),i(e.exports,"COMMAND_LISTENER_SKELETON_CHANGE",function(){return on}),i(e.exports,"COMMAND_LISTENER_VALUE_CHANGE",function(){return oi}),i(e.exports,"getValueChangedEffectedRange",function(){return os}),i(e.exports,"getSkeletonChangedEffectedRange",function(){return oa}),i(e.exports,"SELECTION_CONTROL_BORDER_BUFFER_WIDTH",function(){return oo}),i(e.exports,"SELECTION_CONTROL_BORDER_BUFFER_COLOR",function(){return ol}),i(e.exports,"convertSelectionDataToRange",function(){return ou}),i(e.exports,"convertPrimaryWithCoordToPrimary",function(){return oc}),i(e.exports,"AddMergeRedoSelectionsOperationFactory",function(){return oh}),i(e.exports,"AddMergeUndoSelectionsOperationFactory",function(){return od}),i(e.exports,"expandToContinuousRange",function(){return of}),i(e.exports,"getNextPrimaryCell",function(){return ob}),i(e.exports,"PermissionPointsDefinitions",function(){return oI}),i(e.exports,"checkRangesEditablePermission",function(){return oN}),i(e.exports,"AddWorksheetMergeCommand",function(){return oS}),i(e.exports,"AddWorksheetMergeAllCommand",function(){return oA}),i(e.exports,"AddWorksheetMergeVerticalCommand",function(){return ov}),i(e.exports,"AddWorksheetMergeHorizontalCommand",function(){return oT}),i(e.exports,"addMergeCellsUtil",function(){return ow}),i(e.exports,"SetWorksheetRightToLeftMutation",function(){return oO}),i(e.exports,"SetWorksheetRightToLeftCommand",function(){return ox});var R=u("7yNYd"),b=u("1ZKGP"),I=u("86b1c"),N=u("k2g5B"),S=u("5LPkb"),A=u("arCqp"),v=u("lMvMU"),T=u("bDEN0"),w=u("hciHF"),M=u("i54iF"),O=u("3yupB"),x=u("c3hg1"),U=u("9GqS8"),D=u("1mjSk"),V=u("23cfA"),L=u("2jrJe"),P=u("2BOVU"),v=u("lMvMU"),w=u("hciHF"),L=u("2jrJe"),F=Object.defineProperty,k=(e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,j=(e,t,r)=>k(e,"symbol"!=typeof t?t+"":t,r),B=((r=B||{}).OthersCanView="othersCanView",r.NoOneElseCanView="noOneElseCanView",r),$=((n=$||{}).DesignedUserCanEdit="designedUserCanEdit",n.OnlyMe="onlyMe",n);class H{constructor(){j(this,"_model",new Map),j(this,"_ruleChange$",new(0,D.Subject)),j(this,"ruleChange$",this._ruleChange$.asObservable()),j(this,"_ruleRefresh$",new(0,D.Subject)),j(this,"ruleRefresh$",this._ruleRefresh$.asObservable()),j(this,"_rangeRuleInitStateChange",new(0,S.BehaviorSubject)(!1)),j(this,"rangeRuleInitStateChange$",this._rangeRuleInitStateChange.asObservable())}dispose(){this._ruleChange$.complete(),this._ruleRefresh$.complete()}ruleRefresh(e){this._ruleRefresh$.next(e)}getRangeRuleInitState(){return this._rangeRuleInitStateChange.value}changeRuleInitState(e){this._rangeRuleInitStateChange.next(e)}addRule(e,t,r){this._ensureRuleMap(e,t).set(r.id,r),this._ruleChange$.next({unitId:e,subUnitId:t,rule:r,type:"add"})}deleteRule(e,t,r){var n,i,s,a;let o=null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r);o&&(null==(a=null==(s=this._model.get(e))?void 0:s.get(t))||a.delete(r),this._ruleChange$.next({unitId:e,subUnitId:t,rule:o,type:"delete"}))}setRule(e,t,r,n){var i,s;let a=this.getRule(e,t,r);a&&(null==(s=null==(i=this._model.get(e))?void 0:i.get(t))||s.set(r,n),this._ruleChange$.next({unitId:e,subUnitId:t,oldRule:a,rule:n,type:"set"}))}getRule(e,t,r){var n,i;return null==(i=null==(n=this._model.get(e))?void 0:n.get(t))?void 0:i.get(r)}getSubunitRuleList(e,t){var r;return[...((null==(r=this._model.get(e))?void 0:r.get(t))||new Map).values()]}getSubunitRuleListLength(e,t){var r;let n=null==(r=this._model.get(e))?void 0:r.get(t);return n?n.size:0}_ensureRuleMap(e,t){let r=this._model.get(e);r||(r=new Map,this._model.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t),n=[...r.keys()];e[t]={},n.forEach(n=>{let i=r.get(n);e[t][n]=[...i.values()]})}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r],i=new Map;Object.keys(n).forEach(e=>{let t=n[e].reduce((e,t)=>(e.set(t.id,t),e),new Map);i.set(e,t)}),t.set(r,i)}),this._model=t}deleteUnitModel(e){this._model.delete(e)}createRuleId(e,t){let r=R.Tools.generateRandomId(4),n=this._ensureRuleMap(e,t);for(;n.has(r);)r=R.Tools.generateRandomId(4);return r}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)for(let r of i.values())if(r.permissionId===t)return[e,n];return null}}let W=(e,t)=>{let r=e.get(H),n=t.ruleIds.map(e=>r.getRule(t.unitId,t.subUnitId,e)).filter(e=>!!e);return{id:z.id,params:{subUnitId:t.subUnitId,unitId:t.unitId,rules:n}}},G={id:"sheet.mutation.delete-range-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,ruleIds:i}=t,s=e.get(H);return i.forEach(e=>{s.deleteRule(r,n,e)}),!0}},Y=e=>{let t={...e,ruleIds:e.rules.map(e=>e.id)};return{id:G.id,params:t}},z={id:"sheet.mutation.add-range-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rules:i}=t,s=e.get(H);return i.forEach(e=>{s.addRule(r,n,e)}),!0}},X={type:R.CommandType.COMMAND,id:"sheet.command.add-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=e.get(H),{rule:s,permissionId:a}=t,{unitId:o,subUnitId:l,ranges:u,description:c,viewState:h,editState:d}=s,m=[{ranges:u,permissionId:a,id:i.createRuleId(o,l),description:c,unitType:s.unitType,unitId:o,subUnitId:l,viewState:h,editState:d}];if(await r.executeCommand(z.id,{unitId:o,subUnitId:l,rules:m})){let e=[{id:z.id,params:{unitId:o,subUnitId:l,rules:m}}],t=[{id:G.id,params:{unitId:o,subUnitId:l,ruleIds:m.map(e=>e.id)}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}};class q{constructor(){j(this,"_model",new Map),j(this,"_ruleChange",new(0,D.Subject)),j(this,"_ruleRefresh",new(0,D.Subject)),j(this,"_resetOrder",new(0,D.Subject)),j(this,"ruleChange$",this._ruleChange.asObservable()),j(this,"ruleRefresh$",this._ruleRefresh.asObservable()),j(this,"resetOrder$",this._resetOrder.asObservable()),j(this,"_worksheetRuleInitStateChange",new(0,S.BehaviorSubject)(!1)),j(this,"worksheetRuleInitStateChange$",this._worksheetRuleInitStateChange.asObservable())}changeRuleInitState(e){this._worksheetRuleInitStateChange.next(e)}getSheetRuleInitState(){return this._worksheetRuleInitStateChange.value}addRule(e,t){this._ensureSubUnitMap(e).set(t.subUnitId,t),this._ruleChange.next({unitId:e,rule:t,type:"add",subUnitId:t.subUnitId})}deleteRule(e,t){var r,n,i;let s=null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t);s&&(null==(i=this._model.get(e))||i.delete(t),this._ruleChange.next({unitId:e,rule:s,type:"delete",subUnitId:t}))}setRule(e,t,r){var n,i;let s=this.getRule(e,t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.set(t,r),this._ruleChange.next({unitId:e,oldRule:s,rule:r,type:"set",subUnitId:t}))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=new Map,this._model.set(e,t)),t}ruleRefresh(e){this._ruleRefresh.next(e)}resetOrder(){this._resetOrder.next(Math.random())}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}let K={id:"sheet.mutation.add-worksheet-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,rule:n}=t;return e.get(q).addRule(r,n),!0}},Q={id:"sheet.mutation.delete-worksheet-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n}=t;return e.get(q).deleteRule(r,n),!0}},Z={type:R.CommandType.COMMAND,id:"sheet.command.add-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{rule:i,unitId:s}=t,a=i.subUnitId;if(await r.executeCommand(K.id,{unitId:s,rule:i,subUnitId:i.subUnitId})){let e=[{id:K.id,params:{unitId:s,rule:i,subUnitId:i.subUnitId}}],t=[{id:Q.id,params:{unitId:s,subUnitId:a}}];n.pushUndoRedo({unitID:s,redoMutations:e,undoMutations:t})}return!0}},J={CELL_CONTENT:(0,R.createInterceptorKey)("CELL_CONTENT"),ROW_FILTERED:(0,R.createInterceptorKey)("ROW_FILTERED")};var ee=((s=ee||{})[s.DATA_VALIDATION=9]="DATA_VALIDATION",s[s.NUMFMT=10]="NUMFMT",s[s.CELL_IMAGE=11]="CELL_IMAGE",s);let et="sheet.interceptor.range-theme-id",er="sheet.interceptor.ignore-range-theme";var en=Object.getOwnPropertyDescriptor;let ei=(0,R.createInterceptorKey)("BEFORE_CELL_EDIT"),es=(0,R.createInterceptorKey)("AFTER_CELL_EDIT"),ea=(0,R.createInterceptorKey)("VALIDATE_CELL"),eo=class extends R.Disposable{constructor(e){super(),j(this,"_interceptorsByName",new Map),j(this,"_commandInterceptors",[]),j(this,"_rangeInterceptors",[]),j(this,"_beforeCommandInterceptor",[]),j(this,"_afterCommandInterceptors",[]),j(this,"_workbookDisposables",new Map),j(this,"_worksheetDisposables",new Map),j(this,"_interceptorsDirty",!1),j(this,"_composedInterceptorByKey",new Map),j(this,"writeCellInterceptor",new(0,R.InterceptorManager)({BEFORE_CELL_EDIT:ei,AFTER_CELL_EDIT:es,VALIDATE_CELL:ea})),this._univerInstanceService=e,this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(R.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._interceptWorkbook(e)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(R.UniverInstanceType.UNIVER_SHEET).subscribe(e=>this._disposeWorkbookInterceptor(e))),this.intercept(J.CELL_CONTENT,{priority:-1,effect:R.InterceptorEffectEnum.Style|R.InterceptorEffectEnum.Value,handler(e,t){let r=t.worksheet.getCellRaw(t.row,t.col);return e?{...r,...e}:r}}),this.disposeWithMe(this.writeCellInterceptor.intercept(es,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(ei,{priority:-1,handler:e=>e})),this.disposeWithMe(this.writeCellInterceptor.intercept(ea,{priority:-1,handler:e=>e}))}dispose(){super.dispose(),this._workbookDisposables.forEach(e=>e.dispose()),this._workbookDisposables.clear(),this._worksheetDisposables.clear(),this._interceptorsByName.clear()}interceptCommand(e){if(this._commandInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._commandInterceptors.push(e),this._commandInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,R.toDisposable)(()=>(0,R.remove)(this._commandInterceptors,e)))}onCommandExecute(e){let t=this._commandInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}interceptAfterCommand(e){if(this._afterCommandInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._afterCommandInterceptors.push(e),this._afterCommandInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,R.toDisposable)(()=>(0,R.remove)(this._afterCommandInterceptors,e)))}afterCommandExecute(e){let t=this._afterCommandInterceptors.map(t=>t.getMutations(e));return{undos:t.map(e=>e.undos).flat(),redos:t.map(e=>e.redos).flat()}}interceptBeforeCommand(e){if(this._beforeCommandInterceptor.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._beforeCommandInterceptor.push(e),this._beforeCommandInterceptor.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,R.toDisposable)(()=>(0,R.remove)(this._beforeCommandInterceptor,e)))}async beforeCommandExecute(e){return(await Promise.all(this._beforeCommandInterceptor.map(t=>t.performCheck(e)))).every(e=>e)}interceptRanges(e){if(this._rangeInterceptors.includes(e))throw Error("[SheetInterceptorService]: Interceptor already exists!");return this._rangeInterceptors.push(e),this._rangeInterceptors.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)}),this.disposeWithMe((0,R.toDisposable)(()=>(0,R.remove)(this._rangeInterceptors,e)))}generateMutationsByRanges(e){let t=this._rangeInterceptors.map(t=>t.getMutations(e));return{preUndos:t.map(e=>{var t;return null!=(t=e.preUndos)?t:[]}).flat(),undos:t.map(e=>e.undos).flat(),preRedos:t.map(e=>{var t;return null!=(t=e.preRedos)?t:[]}).flat(),redos:t.map(e=>e.redos).flat()}}onWriteCell(e,t,r,n,i){let s={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:r,col:n,origin:R.Tools.deepClone(i)};return this.writeCellInterceptor.fetchThroughInterceptors(es)(i,s)}onValidateCell(e,t,r,n){let i={subUnitId:t.getSheetId(),unitId:e.getUnitId(),workbook:e,worksheet:t,row:r,col:n};return this.writeCellInterceptor.fetchThroughInterceptors(ea)(Promise.resolve(!0),i)}intercept(e,t){this._interceptorsByName.has(e)||this._interceptorsByName.set(e,[]);let r=this._interceptorsByName.get(e);r.push(t);let n=r.sort((e,t)=>{var r,n;return(null!=(r=t.priority)?r:0)-(null!=(n=e.priority)?n:0)});if(this._interceptorsDirty=!0,e!==J.CELL_CONTENT)return this._interceptorsByName.set(e,n),this.disposeWithMe((0,R.toDisposable)(()=>(0,R.remove)(this._interceptorsByName.get(e),t)));{let r=R.InterceptorEffectEnum.Style|R.InterceptorEffectEnum.Value;this._interceptorsByName.set(`${e}-${r}`,n);let i=R.InterceptorEffectEnum.Style|R.InterceptorEffectEnum.Value;return this._interceptorsByName.set(`${e}-${R.InterceptorEffectEnum.Style}`,n.filter(e=>((e.effect||i)&R.InterceptorEffectEnum.Style)>0)),this._interceptorsByName.set(`${e}-${R.InterceptorEffectEnum.Value}`,n.filter(e=>((e.effect||i)&R.InterceptorEffectEnum.Value)>0)),this.disposeWithMe((0,R.toDisposable)(()=>{(0,R.remove)(this._interceptorsByName.get(e),t),(0,R.remove)(this._interceptorsByName.get(`${e}-${r}`),t),(0,R.remove)(this._interceptorsByName.get(`${e}-${R.InterceptorEffectEnum.Style}`),t),(0,R.remove)(this._interceptorsByName.get(`${e}-${R.InterceptorEffectEnum.Value}`),t)}))}}fetchThroughInterceptors(e,t,r,n){let i=void 0===t?e:`${e}-${t}`,s=null!=r?r:i,a=this._composedInterceptorByKey.get(s);if(!a||this._interceptorsDirty){let e=this._interceptorsByName.get(i);e&&n&&(e=e.filter(n)),a=(0,R.composeInterceptors)(e||[]),this._composedInterceptorByKey.set(s,a)}return a}_interceptWorkbook(e){let t=new(0,R.DisposableCollection),r=e.getUnitId(),n=this,i=t=>{let i=t.getSheetId();t.__interceptViewModel(s=>{let a=new(0,R.DisposableCollection);n._worksheetDisposables.set(el(r,t),a),a.add(s.registerCellContentInterceptor({getCell(s,a,o,l,u){let c=t.getCellRaw(s,a);return n.fetchThroughInterceptors(J.CELL_CONTENT,o,l,u)(c,{unitId:r,subUnitId:i,row:s,col:a,worksheet:t,workbook:e,rawData:c})}})),a.add(s.registerRowFilteredInterceptor({getRowFiltered:s=>!!n.fetchThroughInterceptors(J.ROW_FILTERED)(!1,{unitId:r,subUnitId:i,row:s,workbook:e,worksheet:t})}))})};e.getSheets().forEach(e=>i(e)),t.add(e.sheetCreated$.subscribe(e=>i(e))),t.add((0,R.toDisposable)(()=>e.getSheets().forEach(e=>this._disposeSheetInterceptor(r,e)))),t.add(e.sheetDisposed$.subscribe(e=>this._disposeSheetInterceptor(r,e))),this._workbookDisposables.set(r,t)}_disposeWorkbookInterceptor(e){let t=e.getUnitId(),r=this._workbookDisposables.get(t);r&&(r.dispose(),this._workbookDisposables.delete(t))}_disposeSheetInterceptor(e,t){let r=el(e,t),n=this._worksheetDisposables.get(r);n&&(n.dispose(),this._worksheetDisposables.delete(r))}};function el(e,t){return`${e}|${t.getSheetId()}`}eo=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?en(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(a=R.IUniverInstanceService,(e,t)=>a(e,t,0))],eo);let eu=e=>{let t={};return e.bg&&(t.bg={...e.bg}),e.ol&&(t.ol={...e.ol}),e.bd&&(t.bd={...e.bd}),e.cl&&(t.cl={...e.cl}),e.ht&&(t.ht=e.ht),e.vt&&(t.vt=e.vt),void 0!==e.bl&&(t.bl=e.bl),t},ec={wholeStyle:1,headerRowStyle:2,headerColumnStyle:4,firstRowStyle:8,secondRowStyle:16,lastRowStyle:32,firstColumnStyle:128,secondColumnStyle:256,lastColumnStyle:512};class eh{constructor(e,t){j(this,"_name"),j(this,"wholeStyle",null),j(this,"headerRowStyle",null),j(this,"headerColumnStyle",null),j(this,"firstRowStyle",null),j(this,"secondRowStyle",null),j(this,"lastRowStyle",null),j(this,"firstColumnStyle",null),j(this,"secondColumnStyle",null),j(this,"lastColumnStyle",null),j(this,"_mergeCacheMap",new Map),t&&this.fromJson({...t,name:e}),this._name=e}getName(){return this._name}getWholeStyle(){return this.wholeStyle}setWholeStyle(e){this.wholeStyle=e,this._resetStyleCache()}getFirstRowStyle(){return this.firstRowStyle}setFirstRowStyle(e){this.firstRowStyle=e,this._resetStyleCache()}getSecondRowStyle(){return this.secondRowStyle}setSecondRowStyle(e){this.secondRowStyle=e,this._resetStyleCache()}getLastRowStyle(){return this.lastRowStyle}setLastRowStyle(e){this.lastRowStyle=e,this._resetStyleCache()}getFirstColumnStyle(){return this.firstColumnStyle}setFirstColumnStyle(e){this.firstColumnStyle=e,this._resetStyleCache()}getSecondColumnStyle(){return this.secondColumnStyle}setSecondColumnStyle(e){this.secondColumnStyle=e,this._resetStyleCache()}getLastColumnStyle(){return this.lastColumnStyle}setLastColumnStyle(e){this.lastColumnStyle=e,this._resetStyleCache()}getHeaderRowStyle(){return this.headerRowStyle}setHeaderRowStyle(e){this.headerRowStyle=e,this._resetStyleCache()}getHeaderColumnStyle(){return this.headerColumnStyle}setHeaderColumnStyle(e){this.headerColumnStyle=e,this._resetStyleCache()}getStyle(e,t,r,n){let i=0;return r&&(i|=ec.lastRowStyle),n&&(i|=ec.lastColumnStyle),e>=0&&t>=0&&(i|=ec.wholeStyle),e%2==1&&(i|=ec.firstRowStyle),e%2==0&&(i|=ec.secondRowStyle),0===e&&(i|=ec.headerRowStyle),0===t&&(i|=ec.headerColumnStyle),t%2==1&&(i|=ec.firstColumnStyle),t%2==0&&(i|=ec.secondColumnStyle),0===i?null:this._getMergeStyle(i)}_getMergeStyle(e){let t=this._mergeCacheMap.get(e);return t||(t=this._mergeStyle(e),this._mergeCacheMap.set(e,t)),t}_mergeStyle(e){let t=[];return this.wholeStyle&&e&ec.wholeStyle&&t.push(this.wholeStyle),this.firstColumnStyle&&e&ec.firstColumnStyle&&t.push(this.firstColumnStyle),this.secondColumnStyle&&e&ec.secondColumnStyle&&t.push(this.secondColumnStyle),this.firstRowStyle&&e&ec.firstRowStyle&&t.push(this.firstRowStyle),this.secondRowStyle&&e&ec.secondRowStyle&&t.push(this.secondRowStyle),this.headerColumnStyle&&e&ec.headerColumnStyle&&t.push(this.headerColumnStyle),this.lastColumnStyle&&e&ec.lastColumnStyle&&t.push(this.lastColumnStyle),this.headerRowStyle&&e&ec.headerRowStyle&&t.push(this.headerRowStyle),this.lastRowStyle&&e&ec.lastRowStyle&&t.push(this.lastRowStyle),function(e){let t={};if(1===e.length)return e[0];for(let r of e)r.bg&&(t.bg=r.bg),r.ol&&(t.ol=r.ol),r.bd&&(t.bd={...t.bd,...r.bd}),r.cl&&(t.cl=r.cl),r.ht&&(t.ht=r.ht),r.vt&&(t.vt=r.vt),void 0!==r.bl&&(t.bl=r.bl);return t}(t)}_resetStyleCache(){this._mergeCacheMap.clear()}toJson(){let e={name:this._name};return this.wholeStyle&&(e.wholeStyle=eu(this.wholeStyle)),this.headerRowStyle&&(e.headerRowStyle=eu(this.headerRowStyle)),this.headerColumnStyle&&(e.headerColumnStyle=eu(this.headerColumnStyle)),this.firstRowStyle&&(e.firstRowStyle=eu(this.firstRowStyle)),this.secondRowStyle&&(e.secondRowStyle=eu(this.secondRowStyle)),this.lastRowStyle&&(e.lastRowStyle=eu(this.lastRowStyle)),this.firstColumnStyle&&(e.firstColumnStyle=eu(this.firstColumnStyle)),this.secondColumnStyle&&(e.secondColumnStyle=eu(this.secondColumnStyle)),this.lastColumnStyle&&(e.lastColumnStyle=eu(this.lastColumnStyle)),e}fromJson(e){this._name=e.name,e.wholeStyle&&(this.wholeStyle=eu(e.wholeStyle)),e.headerRowStyle&&(this.headerRowStyle=eu(e.headerRowStyle)),e.headerColumnStyle&&(this.headerColumnStyle=eu(e.headerColumnStyle)),e.firstRowStyle&&(this.firstRowStyle=eu(e.firstRowStyle)),e.secondRowStyle&&(this.secondRowStyle=eu(e.secondRowStyle)),e.lastRowStyle&&(this.lastRowStyle=eu(e.lastRowStyle)),e.firstColumnStyle&&(this.firstColumnStyle=eu(e.firstColumnStyle)),e.secondColumnStyle&&(this.secondColumnStyle=eu(e.secondColumnStyle)),e.lastColumnStyle&&(this.lastColumnStyle=eu(e.lastColumnStyle))}dispose(){this._mergeCacheMap.clear()}}let ed=(e,t,r)=>new eh(`light-${e}`,{headerRowStyle:{bg:{rgb:t}},firstColumnStyle:{bg:{rgb:"rgb(255, 255, 255)"}},secondColumnStyle:{bg:{rgb:r}},lastRowStyle:{bg:{rgb:t}}}),em=(e,t,r)=>new eh(`middle-${e}`,{headerRowStyle:{bg:{rgb:t}},headerColumnStyle:{bg:{rgb:r}},secondRowStyle:{bg:{rgb:r}},lastRowStyle:{bg:{rgb:t}},lastColumnStyle:{bg:{rgb:r}}}),eg=(e,t,r,n)=>new eh(`dark-${e}`,{headerRowStyle:{bg:{rgb:t},cl:{rgb:"rgb(255, 255, 255)"},ht:R.HorizontalAlign.CENTER,bl:R.BooleanNumber.TRUE},firstRowStyle:{bg:{rgb:r}},secondRowStyle:{bg:{rgb:n}},lastRowStyle:{bg:{rgb:t}}}),ef=[{baseName:"blue",header:"rgb(164, 202, 254)",color:"rgb(225, 239, 254)"},{baseName:"grey",header:"rgb(205, 208, 216)",color:"rgb(238, 239, 241)"},{baseName:"red",header:"rgb(248, 180, 180)",color:"rgb(253, 232, 232)"},{baseName:"orange",header:"rgb(253, 186, 140)",color:"rgb(254, 236, 220)"},{baseName:"yellow",header:"rgb(250, 200, 21)",color:"rgb(255, 244, 185)"},{baseName:"green",header:"rgb(132, 225, 188)",color:"rgb(222, 247, 236)"},{baseName:"azure",header:"rgb(126, 220, 226)",color:"rgb(213, 245, 246)"},{baseName:"indigo",header:"rgb(186, 198, 248)",color:"rgb(233, 237, 255)"},{baseName:"purple",header:"rgb(202, 191, 253)",color:"rgb(237, 235, 254)"},{baseName:"magenta",header:"rgb(248, 180, 217)",color:"rgb(252, 232, 243)"}].map(({baseName:e,header:t,color:r})=>ed(e,t,r)),ep=[...ef,...[{baseName:"blue",rowHeader:"rgb(63, 131, 248)",colHeader:"rgb(195, 221, 253)"},{baseName:"grey",rowHeader:"rgb(95, 101, 116)",colHeader:"rgb(227, 229, 234)"},{baseName:"red",rowHeader:"rgb(240, 82, 82)",colHeader:"rgb(251, 213, 213)"},{baseName:"orange",rowHeader:"rgb(255, 90, 31)",colHeader:"rgb(252, 217, 189)"},{baseName:"yellow",rowHeader:"rgb(212, 157, 15)",colHeader:"rgb(252, 220, 106)"},{baseName:"green",rowHeader:"rgb(13, 164, 113)",colHeader:"rgb(188, 240, 218)"},{baseName:"azure",rowHeader:"rgb(6, 148, 162)",colHeader:"rgb(175, 236, 239)"},{baseName:"indigo",rowHeader:"rgb(70, 106, 247)",colHeader:"rgb(210, 218, 250)"},{baseName:"purple",rowHeader:"rgb(144, 97, 249)",colHeader:"rgb(220, 215, 254)"},{baseName:"magenta",rowHeader:"rgb(231, 70, 148)",colHeader:"rgb(250, 209, 232)"}].map(({baseName:e,rowHeader:t,colHeader:r})=>em(e,t,r)),...[{baseName:"blue",rowHeader:"rgb(30, 66, 159)",firstRow:"rgb(195, 221, 253)",secondRow:"rgb(118, 169, 250)"},{baseName:"grey",rowHeader:"rgb(44, 48, 64)",firstRow:"rgb(227, 229, 234)",secondRow:"rgb(151, 157, 172)"},{baseName:"red",rowHeader:"rgb(155, 28, 28)",firstRow:"rgb(251, 213, 213)",secondRow:"rgb(249, 128, 128)"},{baseName:"orange",rowHeader:"rgb(180, 52, 3)",firstRow:"rgb(252, 217, 189)",secondRow:"rgb(255, 138, 76)"},{baseName:"yellow",rowHeader:"rgb(154, 109, 21)",firstRow:"rgb(252, 220, 106)",secondRow:"rgb(212, 157, 15)"},{baseName:"green",rowHeader:"rgb(4, 108, 78)",firstRow:"rgb(188, 240, 218)",secondRow:"rgb(49, 196, 141)"},{baseName:"azure",rowHeader:"rgb(3, 102, 114)",firstRow:"rgb(175, 236, 239)",secondRow:"rgb(22, 189, 202)"},{baseName:"indigo",rowHeader:"rgb(16, 51, 191)",firstRow:"rgb(210, 218, 250)",secondRow:"rgb(98, 128, 249)"},{baseName:"purple",rowHeader:"rgb(74, 29, 150)",firstRow:"rgb(220, 215, 254)",secondRow:"rgb(172, 148, 250)"},{baseName:"magenta",rowHeader:"rgb(153, 21, 75)",firstRow:"rgb(250, 209, 232)",secondRow:"rgb(241, 126, 184)"}].map(({baseName:e,rowHeader:t,firstRow:r,secondRow:n})=>eg(e,t,r,n))],eC={headerRowStyle:{bg:{rgb:"rgb(68,114,196)"},cl:{rgb:"rgb(255,255,255)"},ht:R.HorizontalAlign.CENTER,bl:R.BooleanNumber.TRUE},firstRowStyle:{bg:{rgb:"rgb(217,225,242)"}}},e_=new eh("default",eC),ey=new eh("default-last-row",{...eC,lastRowStyle:{bd:{t:{s:R.BorderStyleTypes.THIN,cl:{rgb:"rgb(68,114,196)"}}},ht:R.HorizontalAlign.CENTER,bl:R.BooleanNumber.TRUE}});var eE=Object.getOwnPropertyDescriptor,eR=(e,t)=>(r,n)=>t(r,n,e);let eb=class extends R.Disposable{constructor(e,t){super(),j(this,"_rangeThemeStyleMap",new Map),j(this,"_rangeThemeStyleRuleMap",new Map),j(this,"_rTreeCollection",new Map),j(this,"_defaultRangeThemeMap",new Map),j(this,"_rangeThemeMapChanged$",new(0,D.Subject)),j(this,"rangeThemeMapChange$",this._rangeThemeMapChanged$.asObservable()),this._sheetInterceptorService=e,this._resourceManagerService=t,this._registerIntercept(),this._initSnapshot(),this._initDefaultTheme()}_initDefaultTheme(){for(let e of(this.registerDefaultRangeTheme(e_),this.registerDefaultRangeTheme(ey),ep))this.registerDefaultRangeTheme(e)}_ensureRangeThemeStyleMap(e){return this._rangeThemeStyleMap.has(e)||this._rangeThemeStyleMap.set(e,new Map),this._rangeThemeStyleMap.get(e)}_ensureRangeThemeStyleRuleMap(e){return this._rangeThemeStyleRuleMap.has(e)||this._rangeThemeStyleRuleMap.set(e,new Map),this._rangeThemeStyleRuleMap.get(e)}_ensureRTreeCollection(e){return this._rTreeCollection.has(e)||this._rTreeCollection.set(e,new(0,R.RTree)),this._rTreeCollection.get(e)}getDefaultRangeThemeStyle(e){return this._defaultRangeThemeMap.get(e)}getCustomRangeThemeStyle(e,t){return this._ensureRangeThemeStyleMap(e).get(t)}registerRangeThemeRule(e,t){let{unitId:r,subUnitId:n,range:i}=t,s=(0,R.generateRandomId)(),a=this._ensureRangeThemeStyleRuleMap(r),o=this._ensureRTreeCollection(r);a.set(s,{rangeInfo:t,themeName:e}),o.insert({unitId:r,sheetId:n,range:i,id:s})}getRegisteredRangeThemeStyle(e){let{unitId:t,subUnitId:r,range:n}=e,i=Array.from(this._ensureRTreeCollection(t).bulkSearch([{unitId:t,sheetId:r,range:n}]));if(i[0]){let e=this._ensureRangeThemeStyleRuleMap(t).get(i[0]);if(e)return e.themeName}}removeRangeThemeRule(e,t){let{unitId:r,subUnitId:n,range:i}=t,s=this._ensureRTreeCollection(r),a=Array.from(s.bulkSearch([{unitId:r,sheetId:n,range:i}])),o=this._ensureRangeThemeStyleRuleMap(r);for(let t=0;t<a.length;t++){let l=o.get(a[t]);if(l&&l.themeName===e){o.delete(a[t]),s.remove({unitId:r,sheetId:n,range:i,id:a[t]});break}}}registerDefaultRangeTheme(e){this._defaultRangeThemeMap.set(e.getName(),e),this._rangeThemeMapChanged$.next({type:"add",styleName:e.getName()})}unRegisterDefaultRangeTheme(e){this._defaultRangeThemeMap.delete(e),this._rangeThemeMapChanged$.next({type:"remove",styleName:e})}getRegisteredRangeThemes(){return Array.from(this._defaultRangeThemeMap.keys())}registerRangeThemeStyle(e,t){this._ensureRangeThemeStyleMap(e).set(t.getName(),t),this._rangeThemeMapChanged$.next({type:"add",styleName:t.getName()})}unregisterRangeThemeStyle(e,t){this._ensureRangeThemeStyleMap(e).delete(t),this._rangeThemeMapChanged$.next({type:"remove",styleName:t})}getALLRegisteredTheme(e){return Array.from(this._ensureRangeThemeStyleMap(e).keys())}getRangeThemeStyle(e,t){return this._defaultRangeThemeMap.has(t)?this._defaultRangeThemeMap.get(t):this._ensureRangeThemeStyleMap(e).get(t)}getCellStyle(e,t,r,n){let i=Array.from(this._ensureRTreeCollection(e).bulkSearch([{unitId:e,sheetId:t,range:{startRow:r,startColumn:n,endRow:r,endColumn:n}}]));if(i[0]){let t=this._ensureRangeThemeStyleRuleMap(e).get(i[0]);if(t){let{rangeInfo:i,themeName:s}=t,a=r-i.range.startRow,o=n-i.range.startColumn,l=this.getRangeThemeStyle(e,s);if(l)return l.getStyle(a,o,r===i.range.endRow,n===i.range.endColumn)}}}_registerIntercept(){this.disposeWithMe(this._sheetInterceptorService.intercept(J.CELL_CONTENT,{id:et,effect:R.InterceptorEffectEnum.Style,handler:(e,t,r)=>{let{row:n,col:i,unitId:s,subUnitId:a}=t,o=this.getCellStyle(s,a,n,i);if(o){let t={...e};return t.themeStyle=o,r(t)}return r(e)}}))}toJson(e){let t=this._ensureRangeThemeStyleRuleMap(e),r=this._ensureRangeThemeStyleMap(e);if(0===r.size&&0===t.size)return"{}";let n={};t.forEach((e,t)=>{n[t]=e});let i={};return r.forEach((e,t)=>{i[t]=e.toJson()}),JSON.stringify({rangeThemeStyleRuleMap:n,rangeThemeStyleMapJson:i})}fromJSON(e,t){let{rangeThemeStyleRuleMap:r,rangeThemeStyleMapJson:n}=t;Object.keys(r).forEach(e=>{let{themeName:t,rangeInfo:n}=r[e];t.startsWith("table")||(this.registerRangeThemeRule(t,n),this._ensureRTreeCollection(n.unitId).insert({unitId:e,sheetId:n.subUnitId,range:n.range,id:e}))}),n&&Object.keys(n).forEach(t=>{let r=n[t],i=new eh(r.name);i.fromJson(r),this._ensureRangeThemeStyleMap(e).set(i.getName(),i)})}deleteUnitId(e){this._rangeThemeStyleMap.delete(e),this._rangeThemeStyleRuleMap.delete(e),this._rTreeCollection.delete(e)}_initSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e=>this.toJson(e),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},businesses:[R.UniverInstanceType.UNIVER_SHEET],pluginName:"SHEET_RANGE_THEME_MODEL_PLUGIN",onLoad:(e,t)=>{this.fromJSON(e,t)},onUnLoad:e=>{this.deleteUnitId(e)}}))}dispose(){super.dispose(),this._rangeThemeStyleMap.clear(),this._rangeThemeStyleRuleMap.clear(),this._defaultRangeThemeMap.clear(),this._rTreeCollection.clear()}};function eI(e,t){let{unitId:r}=t,n=r?e.getUnit(r,R.UniverInstanceType.UNIVER_SHEET):e.getCurrentUnitOfType(R.UniverInstanceType.UNIVER_SHEET);return n?{workbook:n,unitId:n.getUnitId()}:null}function eN(e,t={}){let{unitId:r,subUnitId:n}=t,i=r?e.getUnit(r,R.UniverInstanceType.UNIVER_SHEET):e.getCurrentUnitOfType(R.UniverInstanceType.UNIVER_SHEET);if(!i)return null;let s=n?i.getSheetBySheetId(n):i.getActiveSheet(!0);return s?{worksheet:s,workbook:i,unitId:i.getUnitId(),subUnitId:s.getSheetId()}:null}function eS(e,t){let{unitId:r,subUnitId:n}=t,i=e.getUnit(r,R.UniverInstanceType.UNIVER_SHEET);if(!i)return null;let s=i.getSheetBySheetId(n);return s?{worksheet:s,workbook:i}:null}eb=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?eE(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([eR(0,(0,b.Inject)(eo)),eR(1,(0,b.Inject)(R.IResourceManagerService))],eb);let eA={id:"sheet.mutation.set-worksheet-range-theme-style",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,themeName:s}=t,a=eN(e.get(R.IUniverInstanceService)),o=e.get(eb);return!!a&&(o.registerRangeThemeRule(s,{range:i,unitId:r,subUnitId:n}),!0)}},ev=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetRangeThemeStyleMutation]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),range:t.range,themeName:t.themeName}},eT={id:"sheet.mutation.remove-worksheet-range-theme-style",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,themeName:s}=t,a=eN(e.get(R.IUniverInstanceService)),o=e.get(eb);return!!a&&(o.removeRangeThemeRule(s,{range:i,unitId:r,subUnitId:n}),!0)}},ew=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[DeleteWorksheetRangeThemeStyleMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),range:t.range,themeName:t.themeName}},eM={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-range-theme-style",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{unitId:i}=t,s=ev(e,t);return!!r.syncExecuteCommand(eA.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:eT.id,params:s}],redoMutations:[{id:eA.id,params:t}]}),!0)}},eO=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},ex={id:"sheet.mutation.insert-row",type:R.CommandType.MUTATION,handler:(e,t)=>{var r;let{unitId:n,subUnitId:i,range:s,rowInfo:a}=t,o=e.get(R.IUniverInstanceService).getUniverSheetInstance(n);if(null==o)throw Error("universheet is null error!");let l=o.getSheetBySheetId(i);if(null==l)throw Error("worksheet is null error!");let u=l.getRowManager().getRowData(),c={h:l.getConfig().defaultRowHeight,hd:0},h=s.startRow,d=s.endRow-s.startRow+1;for(let e=h;e<h+d;e++)a?(0,R.insertMatrixArray)(e,null!=(r=a[e-s.startRow])?r:c,u):(0,R.insertMatrixArray)(e,c,u);return l.setRowCount(l.getRowCount()+s.endRow-s.startRow+1),l.getCellMatrix().insertRows(s.startRow,d),!0}},eU=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}},eD={id:"sheet.mutation.insert-col",type:R.CommandType.MUTATION,handler:(e,t)=>{var r;let n=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==n)throw Error("universheet is null error!");let i=n.getSheetBySheetId(t.subUnitId);if(!i)return!1;let s=i.getColumnManager(),{range:a,colInfo:o}=t,l=s.getColumnData(),u=a.startColumn,c=a.endColumn-a.startColumn+1,h=i.getConfig().defaultColumnWidth;for(let e=u;e<u+c;e++){let t={w:h,hd:0};o?(0,R.insertMatrixArray)(e,null!=(r=o[e-a.startColumn])?r:t,l):(0,R.insertMatrixArray)(e,t,l)}return i.setColumnCount(i.getColumnCount()+a.endColumn-a.startColumn+1),i.getCellMatrix().insertColumns(a.startColumn,c),!0}},eV=(e,t)=>{let r=t.getRowManager().getRowData(),n=e.range,i=(0,R.sliceMatrixArray)(n.startRow,n.endRow,r),s=(0,R.concatMatrixArray)({},i);return{unitId:e.unitId,subUnitId:e.subUnitId,range:e.range,rowInfo:s}},eL={id:"sheet.mutation.remove-rows",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getRowManager().getRowData();for(let e=i.startRow;e<=i.endRow;e++)n.getRowFiltered(e);let a=i.endRow-i.startRow+1;return(0,R.spliceArray)(i.startRow,a,s),n.getCellMatrix().removeRows(i.startRow,a),n.setRowCount(n.getRowCount()-a),!0}},eP=(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getColumnManager().getColumnData(),s=t.range,a=(0,R.sliceMatrixArray)(s.startColumn,s.endColumn,i),o=(0,R.concatMatrixArray)({},a);return{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,colInfo:o}},eF={id:"sheet.mutation.remove-col",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=t.range,s=n.getColumnManager().getColumnData(),a=i.endColumn-i.startColumn+1;return(0,R.spliceArray)(i.startColumn,a,s),n.setColumnCount(n.getColumnCount()-a),n.getCellMatrix().removeColumns(i.startColumn,a),!0}};function ek(e,t,r=!1){if(null===t)return t;if(void 0===t)return e;let n=R.Tools.deepClone(e)||{};for(let e in t)r&&["bd","tr","td","ht","vt","tb","pd","bg"].includes(e)||(e in n&&"bd"===e?n[e]=Object.assign(n[e],t[e]):n[e]=t[e]);return"cl"in n&&("ul"in n&&n.ul&&(n.ul.cl=n.cl),"ol"in n&&n.ol&&(n.ol.cl=n.cl),"st"in n&&n.st&&(n.st.cl=n.cl)),n}function ej(e,t){return void 0!==e.v?eB(e.v,e.t):eB(t.v,t.t)}function eB(e,t){return null===e?null:"string"==typeof e?(0,R.isRealNum)(e)?(0==+e||1==+e)&&t===R.CellValueType.BOOLEAN?R.CellValueType.BOOLEAN:R.CellValueType.NUMBER:(0,R.isBooleanString)(e)?R.CellValueType.BOOLEAN:R.CellValueType.STRING:"number"==typeof e?(0===e||1===e)&&t===R.CellValueType.BOOLEAN?R.CellValueType.BOOLEAN:R.CellValueType.NUMBER:"boolean"==typeof e?R.CellValueType.BOOLEAN:R.CellValueType.FORCE_STRING}function e$(e,t){return e===R.CellValueType.NUMBER?Number(t.v):e===R.CellValueType.BOOLEAN?+!!function(e){if("string"==typeof e){if("TRUE"===e.toUpperCase())return!0;if("FALSE"===e.toUpperCase())return!1;if((0,R.isSafeNumeric)(e)){if(0===Number(e))return!1;if(1===Number(e))return!0}}if("number"==typeof e){if(0===e)return!1;if(1===e)return!0}return"boolean"==typeof e?e:null}(t.v):e===R.CellValueType.STRING||e===R.CellValueType.FORCE_STRING?`${t.v}`:t.v}let eH=(e,t)=>{let{unitId:r,subUnitId:n,cellValue:i}=t,s=e.get(R.IUniverInstanceService).getUniverSheetInstance(r);if(null==s)throw Error("workbook is null error!");let a=s.getSheetBySheetId(n);if(null==a)throw Error("worksheet is null error!");let o=a.getCellMatrix(),l=s.getStyles(),u=new(0,R.ObjectMatrix);return new(0,R.ObjectMatrix)(i).forValue((e,t,r)=>{let n=R.Tools.deepClone(null==o?void 0:o.getValue(e,t))||{},i=l.getStyleByCell(n);n.s=function(e,t){if(!t||!Object.keys(t).length)return e;let r=R.Tools.deepClone(null!=e?e:{});for(let e in t)"bd"===e?r[e]=function(e,t){if(!t||!Object.keys(t).length)return e;for(let r in t)r in e||(e[r]=null);return e}(r[e]||{},t[e]):e in r||(r[e]=null);return r}(i,l.getStyleByCell(r)),u.setValue(e,t,null==n?null:(void 0===n.f&&(n.f=null),void 0===n.si&&(n.si=null),void 0===n.p&&(n.p=null),void 0===n.v&&(n.v=null),void 0===n.t&&(n.t=null),void 0===n.s&&(n.s=null),void 0===n.custom&&(n.custom=null),n))}),{...t,options:{},cellValue:u.getMatrix()}},eW={id:"sheet.mutation.set-range-values",type:R.CommandType.MUTATION,handler:(e,t)=>{let{cellValue:r,subUnitId:n,unitId:i}=t,s=e.get(R.IUniverInstanceService).getUnit(i);if(!s)return!1;let a=s.getSheetBySheetId(n);if(!a)return!1;let o=a.getCellMatrix(),l=s.getStyles();return new(0,R.ObjectMatrix)(r).forValue((e,t,r)=>{if(r){let n=o.getValue(e,t)||{};n=function(e,t,r){let n=new Set(["f","p","si","custom"]),i=function(e,t,r){var n,i,s,a,o;if(t.t)return t.t;if(null===t.v)return null;let l=e.getStyleByCell(t),u=e.getStyleByCell(r);if(r.t===R.CellValueType.FORCE_STRING){if(!(0,P.isTextFormat)(null==(n=null==u?void 0:u.n)?void 0:n.pattern)&&void 0!==t.v){if((0,R.isRealNum)(t.v))return R.CellValueType.NUMBER;if((0,R.isBooleanString)(`${t.v}`))return R.CellValueType.BOOLEAN}return R.CellValueType.FORCE_STRING}return null!=(o=null==(a=l)?void 0:a.n)&&o.pattern?(0,P.isTextFormat)(null==(i=null==l?void 0:l.n)?void 0:i.pattern)?R.CellValueType.STRING:ej(t,r):(0,P.isTextFormat)(null==(s=null==u?void 0:u.n)?void 0:s.pattern)?R.CellValueType.STRING:ej(t,r)}(r,e,t);return Object.keys(e).forEach(s=>{if(n.has(s)){var a,o,l;let r=e[s];a=t,o=s,void 0===(l=r)||(null===l?delete a[o]:a[o]=l)}else"v"===s?void 0!==e.v&&(t.v=e$(i,e)):"s"===s&&function(e,t,r){var n;let i=e.getStyleByCell(t);null==i&&delete t.s,"string"==typeof r.s&&(r.s=e.get(r.s));let s=ek(i,r.s?r.s:null);s&&(R.Tools.removeNull(s),Object.entries(s).forEach(([e,t])=>{"object"==typeof t&&null!==t&&0===Object.keys(t).length&&delete s[e]})),R.Tools.isEmptyObject(s)?delete t.s:t.s=e.setValue(s);let a=r.v?`${r.v}\r
`:"";!r.p&&t.p&&(a&&a!==(null==(n=t.p.body)?void 0:n.dataStream)?delete t.p:function(e,t){var r;if(null==e.body)return;Array.isArray(e.body.textRuns)||(e.body.textRuns=[]);let n=0,i=[],s=(null==(r=e.body)?void 0:r.paragraphs)||[];for(let r of e.body.textRuns){let{st:e,ed:a,ts:o={}}=r;if(n<e){let r={st:n,ed:e},s=ek({},t,!0);s&&R.Tools.removeNull(s),R.Tools.isEmptyObject(s)||(r.ts=s),i.push(r)}let l=ek(o,t,!0);l&&R.Tools.removeNull(l),R.Tools.isEmptyObject(l)?delete r.ts:r.ts=l,i.push(r),n=function e(t,r){return t.some(e=>e.startIndex===r)?e(t,r+1):r}(s,a)}let a=e.body.dataStream.endsWith(`\r
`)?e.body.dataStream.length-2:e.body.dataStream.length;if(n<a){let e={st:n,ed:a},r=ek({},t,!0);r&&R.Tools.removeNull(r),R.Tools.isEmptyObject(r)||(e.ts=r),i.push(e)}e.body.textRuns=(0,R.normalizeTextRuns)(i)}(t.p,r.s?r.s:null))}(r,t,e)}),void 0!==t.v&&(t.t=i,t.v=e$(i,t)),null===t.v&&(delete t.t,delete t.v),t}(r,n,l),R.Tools.isEmptyObject(n)?o.realDeleteValue(e,t):o.setValue(e,t,n)}else o.realDeleteValue(e,t)}),!0}},eG={type:R.CommandType.COMMAND,id:"sheet.command.append-row",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{unitId:i,subUnitId:s,cellValue:a,insertRowNums:o,insertColumnNums:l,maxRows:u,maxColumns:c}=t,h={unitId:i,subUnitId:s,cellValue:a},d=eH(e,h),m=[{id:eW.id,params:h}],g=[{id:eW.id,params:d}];if(o){let t={unitId:i,subUnitId:s,range:{startRow:u,endRow:u,startColumn:0,endColumn:c-1}},r=eO(e,t);m.unshift({id:ex.id,params:t}),g.push({id:eL.id,params:r})}if(l){let t={unitId:i,subUnitId:s,range:{startRow:0,endRow:u-1,startColumn:c,endColumn:c-1+l}},r=eU(e,t);m.unshift({id:eD.id,params:t}),g.push({id:eF.id,params:r})}return!!(0,R.sequenceExecute)(m,r).result&&(n.pushUndoRedo({unitID:i,undoMutations:g,redoMutations:m}),!0)}},eY=(e,t,r="")=>e.reduce((e,n)=>{let i=n&&n[t];return"string"!=typeof i?console.warn(n,`${t} is not string`):i?(e[i]||(e[i]=[]),e[i].push(n)):e[r].push(n),e},{}),ez=(e=0)=>{let t=e;return function(){return t++}};function eX(e){let t=new(0,R.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,null)}),t.clone()}function eq(e){let t=new(0,R.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{v:null,p:null,f:null,si:null,custom:null})}),t.clone()}function eK(e,t,r,n,i){let s=t.get(R.IUniverInstanceService),a=r?s.getUnit(r,R.UniverInstanceType.UNIVER_SHEET):s.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET),o=n?null==a?void 0:a.getSheetBySheetId(n):null==a?void 0:a.getActiveSheet();if(!o)return null;let{startRow:l,endRow:u,startColumn:c,endColumn:h}=e,d=[],m=[];for(let e=l;e<=u;e++)o.getRowFiltered(e)||(i?o.getRowRawVisible(e)&&d.push(e):d.push(e));for(let e=c;e<=h;e++)i?o.getColVisible(e)&&m.push(e):m.push(e);return{rows:d,cols:m}}function eQ(e,t,r,n){let i=[],s=[];for(let a of e){let e=eK(a,t,r,n,!0);e&&(i.push(...e.rows),s.push(...e.cols))}let a=Array.from(new Set(i)).sort((e,t)=>e-t),o=Array.from(new Set(s)).sort((e,t)=>e-t),l=[];function u(e){let t=[],r=e[0];for(let n=1;n<e.length;n++)e[n]!==e[n-1]+1&&(t.push([r,e[n-1]]),r=e[n]);return t.push([r,e[e.length-1]]),t}let c=u(a),h=u(o);for(let[e,t]of c)for(let[r,n]of h)l.push({startRow:e,endRow:t,startColumn:r,endColumn:n});return l}var eZ=((o=eZ||{})[o.MOVE_START=0]="MOVE_START",o[o.MOVING=1]="MOVING",o[o.MOVE_END=2]="MOVE_END",o[o.ONLY_SET=3]="ONLY_SET",o);class eJ extends R.Disposable{constructor(e){super(),j(this,"_worksheetSelections",new Map),j(this,"_selectionMoveStart$",new(0,D.Subject)),j(this,"selectionMoveStart$",this._selectionMoveStart$.asObservable()),j(this,"_selectionMoving$",new(0,D.Subject)),j(this,"selectionMoving$",this._selectionMoving$.asObservable()),j(this,"_selectionMoveEnd$",new(0,S.BehaviorSubject)([])),j(this,"selectionMoveEnd$",this._selectionMoveEnd$.asObservable()),j(this,"_selectionSet$",new(0,S.BehaviorSubject)([])),j(this,"selectionSet$",this._selectionSet$.asObservable()),j(this,"selectionChanged$"),j(this,"_beforeSelectionMoveEnd$",new(0,S.BehaviorSubject)([])),j(this,"beforeSelectionMoveEnd$",this._beforeSelectionMoveEnd$.asObservable()),this._workbook=e,this.selectionChanged$=(0,M.merge)(this._selectionMoveEnd$,this._selectionSet$)}dispose(){super.dispose(),this._beforeSelectionMoveEnd$.complete(),this._selectionMoveEnd$.complete(),this._selectionMoving$.complete(),this._selectionMoveStart$.complete(),this._selectionSet$.complete()}addSelections(e,t){let r=this.getSelectionsOfWorksheet(e);r.push(...t),this._selectionSet$.next(r)}setSelections(e,t=[],r){switch(this.setSelectionsOfWorksheet(e,t),r){case eZ.MOVE_START:this._selectionMoveStart$.next(t);break;case eZ.MOVING:this._selectionMoving$.next(t);break;case eZ.MOVE_END:this._beforeSelectionMoveEnd$.next(t),this._selectionMoveEnd$.next(t);break;case eZ.ONLY_SET:default:this._selectionSet$.next(t)}}getCurrentSelections(){return this._getCurrentSelections()}getSelectionOfWorksheet(e){return this.getSelectionsOfWorksheet(e)}getSelectionsOfWorksheet(e){return this._worksheetSelections.has(e)||this._worksheetSelections.set(e,[]),this._worksheetSelections.get(e)}setSelectionsOfWorksheet(e,t){this._worksheetSelections.set(e,[...t])}deleteSheetSelection(e){this._worksheetSelections.set(e,[])}clear(){this._worksheetSelections.clear(),this._selectionSet$.next([])}_getCurrentSelections(){return this.getSelectionsOfWorksheet(this._workbook.getActiveSheet().getSheetId())}getCurrentLastSelection(){let e=this._getCurrentSelections();return e[e.length-1]}}var e0=Object.getOwnPropertyDescriptor;let e1=class extends R.RxDisposable{constructor(e){super(),j(this,"selectionMoveStart$"),j(this,"selectionMoving$"),j(this,"selectionMoveEnd$"),j(this,"selectionSet$"),j(this,"selectionChanged$"),j(this,"_workbookSelections",new Map),this._instanceSrv=e,this._init()}get _currentSelectionPos(){let e=this._instanceSrv.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!e)return null;let t=e.getActiveSheet();return{unitId:e.getUnitId(),sheetId:t.getSheetId()}}get currentSelectionParam(){return this._currentSelectionPos}_init(){let e=this._instanceSrv.getCurrentTypeOfUnit$(R.UniverInstanceType.UNIVER_SHEET).pipe((0,x.shareReplay)(1),(0,L.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,V.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveStart$:(0,O.of)())),this.selectionMoving$=e.pipe((0,V.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoving$:(0,O.of)())),this.selectionMoveEnd$=e.pipe((0,V.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionMoveEnd$:(0,O.of)([]))),this.selectionSet$=e.pipe((0,V.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionSet$:(0,O.of)([]))),this.selectionChanged$=e.pipe((0,V.switchMap)(e=>e?this._ensureWorkbookSelection(e.getUnitId()).selectionChanged$:(0,O.of)([]))).pipe((0,A.distinctUntilChanged)((e,t)=>e.length===t.length&&(0===e.length&&0===t.length||e.every((e,r)=>JSON.stringify(e)===JSON.stringify(t[r])))),(0,U.skip)(1)),this._instanceSrv.getTypeOfUnitDisposed$(R.UniverInstanceType.UNIVER_SHEET).pipe((0,L.takeUntil)(this.dispose$)).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId())})}clear(){this._workbookSelections.forEach(e=>e.clear())}getCurrentSelections(){return this._getCurrentSelections()}getCurrentLastSelection(){let e=this._getCurrentSelections();return null==e?void 0:e[e.length-1]}addSelections(e,t,r){if("string"==typeof e)return void this._ensureWorkbookSelection(e).addSelections(t,r);let n=this._currentSelectionPos;if(!n)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:i,sheetId:s}=n;this._ensureWorkbookSelection(i).addSelections(s,e)}setSelections(e,t,r,n){if("string"==typeof e&&"string"==typeof t)return void this._ensureWorkbookSelection(e).setSelections(t,r||[],null!=n?n:eZ.ONLY_SET);let i=this._currentSelectionPos;if(!i)throw Error("[SheetsSelectionsService]: cannot find current selection position!");let{unitId:s,sheetId:a}=i;if("object"==typeof e){let n=null!=t?t:eZ.ONLY_SET;this._ensureWorkbookSelection(s).setSelections(a,null!=e?e:r,n)}}clearCurrentSelections(){this._getCurrentSelections().splice(0)}isOverlapping(){let e=this.getCurrentSelections();return null!=e&&e.some(({range:t},r)=>e.some(({range:e},n)=>r!==n&&t.startRow<=e.endRow&&t.endRow>=e.startRow&&t.startColumn<=e.endColumn&&t.endColumn>=e.startColumn))}_getCurrentSelections(){let e=this._currentSelectionPos;if(!e)return[];let{unitId:t,sheetId:r}=e;return this._ensureWorkbookSelection(t).getSelectionsOfWorksheet(r)}getWorkbookSelections(e){return this._ensureWorkbookSelection(e)}_ensureWorkbookSelection(e){let t=this._workbookSelections.get(e);if(!t){let r=this._instanceSrv.getUnit(e);if(!r)throw Error(`[SheetsSelectionsService]: cannot resolve unit with id "${e}"!`);t=new eJ(r),this._workbookSelections.set(e,t)}return t}_removeWorkbookSelection(e){this._workbookSelections.delete(e)}};e1=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?e0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(l=R.IUniverInstanceService,(e,t)=>l(e,t,0))],e1);let e2="DISABLE_NORMAL_SELECTIONS",e5="SELECTIONS_ENABLED",e3="REF_SELECTIONS_ENABLED",e4={id:"sheet.command.clear-selection-all",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(R.IUniverInstanceService),i=e.get(R.ICommandService),s=e.get(e1),a=e.get(R.IUndoRedoService),o=e.get(eo),l=n.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=eQ(d,e,u,h),g=[],f=[],p={subUnitId:h,unitId:u,cellValue:eX(m)},C=eH(e,p);g.push({id:eW.id,params:p}),f.push({id:eW.id,params:C});let _=o.onCommandExecute({id:e4.id});return g.push(..._.redos),f.unshift(..._.undos),!!(0,R.sequenceExecute)(g,i)&&(a.pushUndoRedo({unitID:u,undoMutations:f,redoMutations:g}),!0)}},e6={id:"sheet.command.clear-selection-content",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(R.IUniverInstanceService),i=e.get(R.ICommandService),s=e.get(e1),a=e.get(R.IUndoRedoService),o=e.get(eo),l=n.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=eQ(d,e,u,h),g={subUnitId:h,unitId:u,cellValue:eq(m)},f=eH(e,g),p=o.onCommandExecute({id:e6.id}),C=[{id:eW.id,params:g},...p.redos],_=[...p.undos,{id:eW.id,params:f}];return!!(0,R.sequenceExecute)(C,i).result&&(a.pushUndoRedo({unitID:u,undoMutations:_,redoMutations:C}),!0)}},e9={id:"sheet.command.clear-selection-format",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(R.IUniverInstanceService),i=e.get(R.ICommandService),s=e.get(e1),a=e.get(R.IUndoRedoService),o=e.get(eo),l=n.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!l)return!1;let u=(null==t?void 0:t.unitId)||l.getUnitId(),c=l.getActiveSheet();if(!c)return!1;let h=(null==t?void 0:t.subUnitId)||c.getSheetId(),d=(null==t?void 0:t.ranges)||(null==(r=s.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=d&&d.length))return!1;let m=eQ(d,e,u,h),g=[],f=[],p={subUnitId:h,unitId:u,cellValue:function(e){let t=new(0,R.ObjectMatrix);return e.forEach(e=>{let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t.setValue(e,r,{s:null})}),t.clone()}(m)},C=eH(e,p);g.push({id:eW.id,params:p}),f.push({id:eW.id,params:C});let _=o.onCommandExecute({id:e9.id});return g.push(..._.redos),f.unshift(..._.undos),!!(0,R.sequenceExecute)(g,i)&&(a.pushUndoRedo({unitID:u,undoMutations:f,redoMutations:g}),!0)}},e8=(e,t)=>({subUnitId:t.sheet.id,unitId:t.unitId,subUnitName:t.sheet.name}),e7={id:"sheet.mutation.insert-sheet",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService),{sheet:n,index:i,unitId:s}=t,a=r.getUniverSheetInstance(s);return!!a&&a.addWorksheet(n.id,i,n)}},te=(e,t)=>{let r=e.get(R.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=eS(r,t);if(!s)throw Error("[RemoveSheetUndoMutationFactory]: Worksheet is null error!");let{workbook:a,worksheet:o}=s,l=o.getConfig();return{index:a.getConfig().sheetOrder.findIndex(e=>e===n),sheet:l,unitId:i}},tt={id:"sheet.mutation.remove-sheet",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService),{subUnitId:n,unitId:i}=t,s=r.getUniverSheetInstance(i);return!!s&&s.removeSheet(n)}},tr={type:R.CommandType.COMMAND,id:"sheet.command.copy-sheet",handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService),o=e.get(eo),l=e.get(R.LocaleService),u=eN(a,t);if(!u)return!1;let{workbook:c,worksheet:h,unitId:d,subUnitId:m}=u,g=R.Tools.deepClone(h.getConfig());g.name=function(e,t,r){let n=r+t.t("sheets.tabs.sheetCopy",""),i=2;for(;e.checkSheetName(n);)n=r+t.t("sheets.tabs.sheetCopy",`${i}`),i++;return n}(c,l,g.name),g.id=R.Tools.generateRandomId();let f={index:c.getSheetIndex(h)+1,sheet:g,unitId:d},p=e8(e,f),C=o.onCommandExecute({id:tr.id,params:{unitId:d,subUnitId:m,targetSubUnitId:g.id}}),_=[...null!=(r=C.preRedos)?r:[],{id:e7.id,params:f},...C.redos],y=[...null!=(n=C.preUndos)?n:[],{id:tt.id,params:p},...C.undos];return!!(0,R.sequenceExecute)(_,i).result&&(s.pushUndoRedo({unitID:d,undoMutations:y,redoMutations:_}),!0)}},tn={id:"sheet.mutation.move-range",type:R.CommandType.MUTATION,handler:(e,t)=>{let{from:r,to:n}=t;if(!r||!n)return!1;let i=e.get(R.IUniverInstanceService).getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getSheetBySheetId(t.from.subUnitId),a=i.getSheetBySheetId(t.to.subUnitId);if(!s||!a)return!1;let o=s.getCellMatrix(),l=a.getCellMatrix();return new(0,R.ObjectMatrix)(r.value).forValue((e,t,r)=>{o.setValue(e,t,r)}),new(0,R.ObjectMatrix)(n.value).forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}};function ti(e,t,r=!0){let n=t.getMatrixWithMergedCells(...(0,R.selectionToArray)(e)),i=[];if(n.forValue((t,r,n)=>{if(void 0!==n.colSpan&&void 0!==n.rowSpan){let s={startRow:t,startColumn:r,endRow:t+n.rowSpan-1,endColumn:r+n.colSpan-1};R.Rectangle.contains(e,s)||i.push(s)}}),0===i.length)return e;let s=R.Rectangle.union(e,...i);return r?ti(s,t,r):s}function ts(e,t,r){let n=null;return r.getMatrixWithMergedCells(e,t,e,t).forValue((e,t,r)=>(n={actualRow:e,actualColumn:t,startRow:e,startColumn:t,isMerged:void 0!==r.rowSpan||void 0!==r.colSpan,isMergedMainCell:void 0!==r.rowSpan&&void 0!==r.colSpan,endRow:e+(void 0!==r.rowSpan?r.rowSpan-1:0),endColumn:t+(void 0!==r.colSpan?r.colSpan-1:0),rangeType:R.RANGE_TYPE.NORMAL},!1)),n||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:R.RANGE_TYPE.NORMAL}}function ta(e,t,r){let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return Number.isNaN(n)&&(e.startRow=0),Number.isNaN(s)&&(e.endRow=t-1),Number.isNaN(i)&&(e.startColumn=0),Number.isNaN(a)&&(e.endColumn=r-1),e}function to(e,t){let r=Number.isNaN(e.startRow)?0:e.startRow,n=Number.isNaN(e.startColumn)?0:e.startColumn,i=t.getMergedCell(r,n);return i?{...i,actualRow:r,actualColumn:n,rangeType:R.RANGE_TYPE.NORMAL,isMerged:!0,isMergedMainCell:!0}:{startRow:r,startColumn:n,endRow:e.startRow,endColumn:e.startColumn,actualRow:r,actualColumn:n,rangeType:R.RANGE_TYPE.NORMAL,isMerged:!1,isMergedMainCell:!1}}let tl=(e,t,r)=>({id:tp.id,params:{unitId:t.getUnitId(),subUnitId:r.getSheetId(),reveal:!0,selections:[{range:e,primary:to(e,r)}]}});function tu(e){if(!e)return!1;let{range:t,primary:r}=e;return R.Rectangle.equals(t,r)}let tc=e=>e.id!==et;function th(e,t,r,n,i,s,a){let o={};for(let l=t;l<=r;l++)for(let t=n;t<=i;t++){let r=s?e.getCellWithFilteredInterceptors(a,t,er,tc):e.getCellWithFilteredInterceptors(l,a,er,tc);r&&r.s&&(o[l]||(o[l]={}),o[l][t]={s:r.s})}return o}var td=Object.getOwnPropertyDescriptor;let tm=(0,b.createIdentifier)("sheets-formula.ref-selections.service"),tg=class extends e1{constructor(e){super(e)}_init(){let e=this._getAliveWorkbooks$().pipe((0,L.takeUntil)(this.dispose$));this.selectionMoveStart$=e.pipe((0,V.switchMap)(e=>(0,M.merge)(...e.map(e=>e.selectionMoveStart$)))),this.selectionMoving$=e.pipe((0,V.switchMap)(e=>(0,M.merge)(...e.map(e=>e.selectionMoving$)))),this.selectionMoveEnd$=e.pipe((0,V.switchMap)(e=>(0,M.merge)(...e.map(e=>e.selectionMoveEnd$)))),this.selectionSet$=e.pipe((0,V.switchMap)(e=>(0,M.merge)(...e.map(e=>e.selectionSet$))))}_getAliveWorkbooks$(){let e=this._instanceSrv.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET);e.forEach(e=>this._ensureWorkbookSelection(e.getUnitId()));let t=new(0,S.BehaviorSubject)(e);return this.disposeWithMe(this._instanceSrv.getTypeOfUnitAdded$(R.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._ensureWorkbookSelection(e.getUnitId()),t.next([...t.getValue(),e])})),this.disposeWithMe(this._instanceSrv.getTypeOfUnitDisposed$(R.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{this._removeWorkbookSelection(e.getUnitId()),t.next(t.getValue().filter(t=>t!==e))})),t.pipe((0,w.map)(e=>e.map(e=>this._ensureWorkbookSelection(e.getUnitId()))))}};function tf(e,t){let r=e.get(R.IContextService).getContextValue(e3);return e.get(r&&!t?tm:e1)}tg=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?td(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(c=R.IUniverInstanceService,(e,t)=>c(e,t,0))],tg);let tp={id:"sheet.operation.set-selections",type:R.CommandType.OPERATION,handler:(e,t)=>{if(!t)return!1;let{selections:r,type:n,unitId:i,subUnitId:s}=t;return tf(e).setSelections(i,s,[...r],n),!0}},tC={id:"sheet.command.select-range",type:R.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnit:n,range:i}=t,s=e.get(R.ICommandService),a=eN(e.get(R.IUniverInstanceService),t);if(!a)return!1;let o=[{range:i,primary:to(i,a.worksheet),style:null}];return s.syncExecuteCommand(tp.id,{unitId:r,subUnitId:n,selections:o})}},t_="sheet.command.move-range",ty={type:R.CommandType.COMMAND,id:t_,handler:async(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService),o=e.get(R.ErrorService),l=e.get(R.LocaleService),u=e.get(eo),c=eN(a);if(!c||!await u.beforeCommandExecute({id:ty.id,params:t}))return!1;let{worksheet:h,subUnitId:d,unitId:m}=c,g=tE(e,{unitId:m,subUnitId:d,range:t.fromRange},{subUnitId:d,range:t.toRange});if(null===g)return o.emit(l.t("sheets.info.acrossMergedCell")),!1;let f=u.onCommandExecute({id:ty.id,params:{...t}}),p=[...null!=(r=f.preRedos)?r:[],...g.redos,...f.redos,{id:tp.id,params:{unitId:m,subUnitId:d,selections:[{range:t.toRange,primary:function(e,t,r){let n=e.startRow,i=e.startColumn,s=r.getMergedCell(n,i),a=to(t,r);if(s){let e=s.endRow-s.startRow+1,t=s.endColumn-s.startColumn+1;a.endRow=a.startRow+e-1,a.endColumn=a.startColumn+t-1,a.actualRow=a.startRow,a.actualColumn=a.startColumn,a.isMerged=!1,a.isMergedMainCell=!0}return a}(t.fromRange,t.toRange,h)}],type:eZ.MOVE_END}}],C=[...null!=(n=f.preUndos)?n:[],...g.undos,...f.undos,{id:tp.id,params:{unitId:m,subUnitId:d,selections:[{range:t.fromRange,primary:to(t.fromRange,h)}],type:eZ.MOVE_END}}],_=(0,R.sequenceExecute)(p,i).result,y=u.afterCommandExecute({id:ty.id,params:{...t}});return!!_&&((0,R.sequenceExecute)(y.redos,i),s.pushUndoRedo({unitID:m,undoMutations:[...C,...y.undos],redoMutations:[...p,...y.redos]}),!0)}};function tE(e,t,r,n=!1){let i=[],s=[],{range:a,subUnitId:o,unitId:l}=t,{range:u,subUnitId:c}=r,h=e.get(R.IUniverInstanceService).getUniverSheetInstance(l),d=null==h?void 0:h.getSheetBySheetId(c),m=null==h?void 0:h.getSheetBySheetId(o),g=null==d?void 0:d.getCellMatrix(),f=null==m?void 0:m.getCellMatrix();if(d&&m&&g&&f){let e=ti(u,d,!1);if(!R.Rectangle.equals(u,e)&&!n)return null;let m=new(0,R.ObjectMatrix),p=new(0,R.ObjectMatrix),C=new(0,R.ObjectMatrix);R.Range.foreach(a,(e,t)=>{let r=f.getValue(e,t);if(m.setValue(e,t,R.Tools.deepClone(r)),r){let n=null==h?void 0:h.getStyles().get(r.s);C.setValue(e,t,R.Tools.deepClone(n))}p.setValue(e,t,null)});let _=new(0,R.ObjectMatrix),y=new(0,R.ObjectMatrix);R.Range.foreach(u,(e,t)=>{_.setValue(e,t,R.Tools.deepClone(g.getValue(e,t)))}),R.Range.foreach(a,(e,t)=>{let r=(0,R.cellToRange)(e,t),n=R.Rectangle.getRelativeRange(r,a),i=R.Rectangle.getPositionRange(n,u),s=R.Tools.deepClone(C.getValue(e,t)),o=R.Tools.deepClone(m.getValue(e,t));o&&s&&(o.s=s),y.setValue(i.startRow,i.startColumn,o)});let E={fromRange:t.range,toRange:r.range,from:{value:p.getMatrix(),subUnitId:o},to:{value:y.getMatrix(),subUnitId:c},unitId:l},b={fromRange:r.range,toRange:t.range,from:{value:m.getMatrix(),subUnitId:o},to:{value:_.getMatrix(),subUnitId:c},unitId:l};i.push({id:tn.id,params:E}),s.push({id:tn.id,params:b})}return{redos:i,undos:s}}var tR=((h=tR||{})[h.UNIVER_UNKNOWN=0]="UNIVER_UNKNOWN",h[h.UNIVER_DOC=1]="UNIVER_DOC",h[h.UNIVER_SHEET=2]="UNIVER_SHEET",h[h.UNIVER_SLIDE=3]="UNIVER_SLIDE",h[h.UNIVER_PROJECT=4]="UNIVER_PROJECT",h[h.UNRECOGNIZED=-1]="UNRECOGNIZED",h),tb=((d=tb||{})[d.View=0]="View",d[d.Edit=1]="Edit",d[d.ManageCollaborator=2]="ManageCollaborator",d[d.Print=3]="Print",d[d.Duplicate=4]="Duplicate",d[d.Comment=5]="Comment",d[d.Copy=6]="Copy",d[d.Share=7]="Share",d[d.Export=8]="Export",d[d.MoveWorksheet=9]="MoveWorksheet",d[d.DeleteWorksheet=10]="DeleteWorksheet",d[d.HideWorksheet=11]="HideWorksheet",d[d.RenameWorksheet=12]="RenameWorksheet",d[d.CreateWorksheet=13]="CreateWorksheet",d[d.SetWorksheetStyle=14]="SetWorksheetStyle",d[d.EditWorksheetCell=15]="EditWorksheetCell",d[d.InsertHyperlink=16]="InsertHyperlink",d[d.Sort=17]="Sort",d[d.Filter=18]="Filter",d[d.PivotTable=19]="PivotTable",d[d.FloatImg=20]="FloatImg",d[d.History=21]="History",d[d.RwHgtClWdt=22]="RwHgtClWdt",d[d.ViemRwHgtClWdt=23]="ViemRwHgtClWdt",d[d.ViewFilter=24]="ViewFilter",d[d.MoveSheet=25]="MoveSheet",d[d.DeleteSheet=26]="DeleteSheet",d[d.HideSheet=27]="HideSheet",d[d.CopySheet=28]="CopySheet",d[d.RenameSheet=29]="RenameSheet",d[d.CreateSheet=30]="CreateSheet",d[d.SelectProtectedCells=31]="SelectProtectedCells",d[d.SelectUnProtectedCells=32]="SelectUnProtectedCells",d[d.SetCellStyle=33]="SetCellStyle",d[d.SetCellValue=34]="SetCellValue",d[d.SetRowStyle=35]="SetRowStyle",d[d.SetColumnStyle=36]="SetColumnStyle",d[d.InsertRow=37]="InsertRow",d[d.InsertColumn=38]="InsertColumn",d[d.DeleteRow=39]="DeleteRow",d[d.DeleteColumn=40]="DeleteColumn",d[d.EditExtraObject=41]="EditExtraObject",d[d.Delete=42]="Delete",d[d.RecoverHistory=43]="RecoverHistory",d[d.ViewHistory=44]="ViewHistory",d[d.CreatePermissionObject=45]="CreatePermissionObject",d[d.UNRECOGNIZED=-1]="UNRECOGNIZED",d),tI=((m=tI||{})[m.Unkonwn=0]="Unkonwn",m[m.Workbook=1]="Workbook",m[m.Worksheet=2]="Worksheet",m[m.SelectRange=3]="SelectRange",m[m.Document=4]="Document",m[m.Slide=5]="Slide",m[m.UNRECOGNIZED=-1]="UNRECOGNIZED",m);class tN{constructor(e,t,r){j(this,"type",tI.SelectRange),j(this,"subType",tb.Edit),j(this,"status",R.PermissionStatus.INIT),j(this,"value",!0),j(this,"id"),j(this,"unitId"),j(this,"subUnitId"),j(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${tI.SelectRange}.${tb.Edit}.${r}`}}class tS{constructor(e,t,r){j(this,"type",tI.SelectRange),j(this,"subType",tb.View),j(this,"status",R.PermissionStatus.INIT),j(this,"value",!0),j(this,"id"),j(this,"unitId"),j(this,"subUnitId"),j(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${tI.SelectRange}.${tb.View}.${r}`}}class tA{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Comment),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Comment}_${e}`}}class tv{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Copy),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Copy}_${e}`}}class tT{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"subType",tb.CopySheet),j(this,"status",R.PermissionStatus.INIT),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.CopySheet}_${e}`}}class tw{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.CreatePermissionObject),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.CreatePermissionObject}_${e}`}}class tM{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.CreateSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.CreateSheet}_${e}`}}class tO{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.DeleteSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.DeleteSheet}_${e}`}}class tx{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Duplicate),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Duplicate}_${e}`}}class tU{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Edit),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Edit}_${e}`}}class tD{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Export),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Export}_${e}`}}class tV{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.HideSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.HideSheet}_${e}`}}class tL{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.History),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.History}_${e}`}}class tP{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.ManageCollaborator),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.ManageCollaborator}_${e}`}}class tF{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.MoveSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.MoveSheet}_${e}`}}class tk{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Print),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Print}_${e}`}}class tj{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.RecoverHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.RecoverHistory}_${e}`}}class tB{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.RenameSheet),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.RenameSheet}_${e}`}}class t${constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.Share),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.Share}_${e}`}}class tH{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.View),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.View}_${e}`}}class tW{constructor(e){j(this,"id"),j(this,"value",!0),j(this,"type",tI.Workbook),j(this,"status",R.PermissionStatus.INIT),j(this,"subType",tb.ViewHistory),this.unitId=e,this.unitId=e,this.id=`${this.type}.${tb.ViewHistory}_${e}`}}class tG{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.Copy),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.Copy}_${e}_${t}`}}class tY{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.DeleteColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.DeleteColumn}_${e}_${t}`}}class tz{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.Delete),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.Delete}_${e}_${t}`}}class tX{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.DeleteRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.DeleteRow}_${e}_${t}`}}class tq{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.Edit),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.Edit}_${e}_${t}`}}class tK{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.EditExtraObject),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.EditExtraObject}_${e}_${t}`}}class tQ{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.Filter),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.Filter}_${e}_${t}`}}class tZ{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.InsertColumn),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.InsertColumn}_${e}_${t}`}}class tJ{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.InsertHyperlink),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.InsertHyperlink}_${e}_${t}`}}class t0{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.InsertRow),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.InsertRow}_${e}_${t}`}}class t1{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.ManageCollaborator),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.ManageCollaborator}_${e}_${t}`}}class t2{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.PivotTable),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.PivotTable}_${e}_${t}`}}class t5{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SelectProtectedCells),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SelectProtectedCells}_${e}_${t}`}}class t3{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SelectUnProtectedCells),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SelectUnProtectedCells}_${e}_${t}`}}class t4{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SetCellStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SetCellStyle}_${e}_${t}`}}class t6{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SetCellValue),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SetCellValue}_${e}_${t}`}}class t9{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SetColumnStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SetColumnStyle}_${e}_${t}`}}class t8{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.SetRowStyle),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.SetRowStyle}_${e}_${t}`}}class t7{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.Sort),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.Sort}_${e}_${t}`}}class re{constructor(e,t){j(this,"value",!0),j(this,"type",tI.Worksheet),j(this,"status",R.PermissionStatus.INIT),j(this,"id"),j(this,"subType",tb.View),this.unitId=e,this.subUnitId=t,this.id=`${this.type}.${tb.View}_${e}_${t}`}}let rt={id:"sheet.command.set-range-values",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n,i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService),o=e.get(e1),l=e.get(eo),u=e.get(R.IPermissionService),c=eN(a,t);if(!c)return!1;let{subUnitId:h,unitId:d,workbook:m,worksheet:g}=c,{value:f,range:p,redoUndoId:C}=t,_=p?[p]:null==(r=o.getCurrentSelections())?void 0:r.map(e=>e.range);if(!_||!_.length||!u.getPermissionPoint(new tq(d,h).id))return!1;let y=new(0,R.ObjectMatrix);if(R.Tools.isArray(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=0;e<=n-t;e++)for(let n=0;n<=i-r;n++)y.setValue(e+t,n+r,f[e][n])}else if((0,R.isICellData)(f))for(let e=0;e<_.length;e++){let{startRow:t,startColumn:r,endRow:n,endColumn:i}=_[e];for(let e=t;e<=n;e++)for(let t=r;t<=i;t++)y.setValue(e,t,f)}else n=f;let E={subUnitId:h,unitId:d,cellValue:null!=n?n:y.getMatrix()},b=eH(e,E);if(!i.syncExecuteCommand(eW.id,E))return!1;let{undos:I,redos:N}=l.onCommandExecute({id:rt.id,params:{...E,range:_}});if((0,R.sequenceExecute)([...N],i).result){let e=tl(null!=p?p:y.getRange(),m,g);return s.pushUndoRedo({unitID:d,undoMutations:[{id:eW.id,params:b},...I,e],redoMutations:[{id:eW.id,params:E},...N,R.Tools.deepClone(e)],id:C}),!0}return!1}};function rr(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o,cellValue:l={}}=t,u=e.get(R.IUniverInstanceService),c=e.get(eo),h=u.getUniverSheetInstance(i),d=null==h?void 0:h.getSheetBySheetId(s);if(d){let t=d.getCellMatrix(),u=t.getDataRange();if(a.startColumn<=u.endColumn||a.startRow<=u.endRow){let l,c;if(o===R.Dimension.COLUMNS){let e=Math.min(a.endRow,u.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,R.getArrayLength)(e)-1:0)}l={startRow:a.startRow,startColumn:a.startColumn,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:l.startColumn+n,endRow:e,endColumn:l.endColumn+n}}else{let e=Math.min(a.endColumn,u.endColumn),t=u.endRow;l={startRow:a.startRow,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:l.startRow+r,startColumn:a.startColumn,endRow:l.endRow+r,endColumn:e}}let h=tE(e,{unitId:i,subUnitId:s,range:l},{subUnitId:s,range:c},!0);h&&(r.push(...h.redos),n.push(...h.undos))}if(0===Object.entries(l).length)for(let e=a.startRow;e<=a.endRow;e++){l[e]||(l[e]={});for(let t=a.startColumn;t<=a.endColumn;t++)l[e][t]=null}let h={subUnitId:s,unitId:i,cellValue:l},m=eH(e,h),{undos:g,redos:f}=c.onCommandExecute({id:rt.id,params:{...h,range:a}});r.push({id:eW.id,params:h},...f),n.push({id:eW.id,params:m},...g)}return{redo:r,undo:n}}function rn(e,t){let r=[],n=[],{unitId:i,subUnitId:s,range:a,shiftDimension:o}=t,l=e.get(R.IUniverInstanceService),u=e.get(eo),c=l.getUniverSheetInstance(i),h=null==c?void 0:c.getSheetBySheetId(s);if(h){let t=h.getCellMatrix(),l=t.getDataRange(),c={subUnitId:s,unitId:i,cellValue:eX([a])},d=eH(e,c),m=u.onCommandExecute({id:rt.id,params:c});if(r.push({id:eW.id,params:c},...m.redos),n.push(...m.undos,{id:eW.id,params:d}),a.startColumn<=l.endColumn||a.startRow<=l.endRow){let u=null,c=null;if(o===R.Dimension.COLUMNS&&a.endColumn<l.endColumn){let e=Math.min(a.endRow,l.endRow),r=0;for(let n=a.startRow;n<=e;n++){let e=t.getRow(n);r=Math.max(r,e?(0,R.getArrayLength)(e)-1:0)}u={startRow:a.startRow,startColumn:a.endColumn+1,endRow:e,endColumn:r};let n=a.endColumn-a.startColumn+1;c={startRow:a.startRow,startColumn:u.startColumn-n,endRow:e,endColumn:u.endColumn-n}}if(o===R.Dimension.ROWS&&a.endRow<l.endRow){let e=Math.min(a.endColumn,l.endColumn),t=l.endRow;u={startRow:a.endRow+1,startColumn:a.startColumn,endRow:t,endColumn:e};let r=a.endRow-a.startRow+1;c={startRow:u.startRow-r,startColumn:a.startColumn,endRow:u.endRow-r,endColumn:e}}if(u&&c){let t=tE(e,{unitId:i,subUnitId:s,range:u},{subUnitId:s,range:c},!0);t&&(r.push(...t.redos),n.push(...t.undos))}}}return{redo:r,undo:n}}function ri(e,t,r,n,i,s){let{startRow:a,endRow:o,startColumn:l,endColumn:u}=t;if(i===R.Dimension.ROWS){let t=o-a+1;for(let n=r;n>=a;n--)for(let r=l;r<=u;r++){let i=e.getValue(n,r);null==i?e.realDeleteValue(n+t,r):e.setValue(n+t,r,i)}for(let t=o;t>=a;t--)for(let r=l;r<=u;r++)s&&s[t]&&s[t][r]?e.setValue(t,r,s[t][r]):e.realDeleteValue(t,r)}else if(i===R.Dimension.COLUMNS){let t=u-l+1;for(let r=a;r<=o;r++)for(let i=n;i>=l;i--){let n=e.getValue(r,i);null==n?e.realDeleteValue(r,i+t):e.setValue(r,i+t,n)}for(let t=a;t<=o;t++)for(let r=u;r>=l;r--)s&&s[t]&&s[t][r]?e.setValue(t,r,s[t][r]):e.realDeleteValue(t,r)}}function rs(e,t,r,n,i){let{startRow:s,endRow:a,startColumn:o,endColumn:l}=t,u=a-s+1,c=l-o+1;if(i===R.Dimension.ROWS)for(let t=s;t<=r;t++)for(let r=o;r<=l;r++){let n=e.getValue(t+u,r);null==n?e.realDeleteValue(t,r):e.setValue(t,r,n)}else if(i===R.Dimension.COLUMNS)for(let t=s;t<=a;t++)for(let r=o;r<=n;r++){let n=e.getValue(t,r+c);null==n?e.realDeleteValue(t,r):e.setValue(t,r,n)}}let ra="sheet.command.delete-range-move-left",ro={type:R.CommandType.COMMAND,id:ra,handler:async(e,t)=>{var r,n,i;let s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService),o=e.get(R.IUniverInstanceService),l=e.get(e1),u=e.get(eo),c=eN(o);if(!c)return!1;let{worksheet:h,workbook:d,subUnitId:m,unitId:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let p={range:f,subUnitId:m,unitId:g,shiftDimension:R.Dimension.COLUMNS},C=u.onCommandExecute({id:ro.id,params:{range:f}}),{redo:_,undo:y}=rn(e,p),E=[...null!=(n=C.preRedos)?n:[],..._],b=[...C.undos,...y];return E.push(...C.redos),E.push(tl(f,d,h)),b.push(...null!=(i=C.preUndos)?i:[]),!!(0,R.sequenceExecute)(E,s).result&&(a.pushUndoRedo({unitID:g,undoMutations:b.reverse(),redoMutations:E}),!0)}},rl="sheet.command.delete-range-move-up",ru={type:R.CommandType.COMMAND,id:rl,handler:async(e,t)=>{var r,n,i;let s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService),o=e.get(R.IUniverInstanceService),l=e.get(e1),u=e.get(eo),c=eN(o);if(!c)return!1;let{unitId:h,subUnitId:d,workbook:m,worksheet:g}=c,f=null==t?void 0:t.range;if(f||(f=null==(r=l.getCurrentLastSelection())?void 0:r.range),!f)return!1;let p={range:f,subUnitId:d,unitId:h,shiftDimension:R.Dimension.ROWS},C=u.onCommandExecute({id:ru.id,params:{range:f}}),{redo:_,undo:y}=rn(e,p),E=[...null!=(n=C.preRedos)?n:[],..._],b=[...C.undos,...y];return E.push(...C.redos),E.push(tl(f,m,g)),b.push(...null!=(i=C.preUndos)?i:[]),!!(0,R.sequenceExecute)(E,s).result&&(a.pushUndoRedo({unitID:h,undoMutations:b.reverse(),redoMutations:E}),!0)}},rc={type:R.CommandType.COMMAND,id:"sheet.command.delete-range-protection",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{unitId:i,subUnitId:s,rule:a}=t,o={unitId:i,subUnitId:s,ruleIds:[a.id]};return await r.executeCommand(G.id,o)&&n.pushUndoRedo({unitID:i,redoMutations:[{id:G.id,params:o}],undoMutations:[{id:z.id,params:{unitId:i,subUnitId:s,rules:[a]}}]}),!0}},rh={type:R.CommandType.COMMAND,id:"sheet.command.delete-worksheet-protection",handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{rule:i,unitId:s,subUnitId:a}=t;r.executeCommand(Q.id,{unitId:s,subUnitId:a});let o=[{id:Q.id,params:{unitId:s,subUnitId:a}}],l=[{id:K.id,params:{unitId:s,rule:i,subUnitId:a}}];return n.pushUndoRedo({unitID:s,redoMutations:o,undoMutations:l}),!0}},rd={type:R.CommandType.COMMAND,id:"sheet.command.remove-worksheet-range-theme-style",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{unitId:i}=t,s=ew(e,t);return!!r.syncExecuteCommand(eT.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:eA.id,params:s}],redoMutations:[{id:eT.id,params:t}]}),!0)}},rm={id:"sheet.command.insert-defined-name",type:R.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService);if(!t)return!1;let i={...t};return!!r.syncExecuteCommand(I.SetDefinedNameMutation.id,i)&&(n.pushUndoRedo({unitID:t.unitId,undoMutations:[{id:I.RemoveDefinedNameMutation.id,params:i}],redoMutations:[{id:I.SetDefinedNameMutation.id,params:i}]}),!0)}},rg={type:R.CommandType.COMMAND,id:"sheet.command.insert-range-move-down",handler:async(e,t)=>{var r,n,i;let s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService),o=e.get(R.IUniverInstanceService),l=e.get(e1),u=e.get(eo),c=e.get(R.ErrorService),h=e.get(R.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=eN(o);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f,workbook:p}=d,C=null==t?void 0:t.range;if(C||(C=null==(r=l.getCurrentLastSelection())?void 0:r.range),!C)return!1;let _=[],y=[],E=f.getCellMatrix(),b=E.getDataRange(),I=Math.max(E.getSlice(b.startRow,b.endRow,C.startColumn,C.endColumn).getDataRange().endRow+(C.endRow-C.startRow+1)-b.endRow,0);if(I>0){let t=C.startRow-1,r=f.getRowHeight(t),n={unitId:m,subUnitId:g,range:{startRow:b.endRow+1,endRow:b.endRow+I,startColumn:b.startColumn,endColumn:b.endColumn},rowInfo:Array(I).fill(void 0).map(()=>({h:r,hd:R.BooleanNumber.FALSE}))};_.push({id:ex.id,params:n});let i=eO(e,n);y.push({id:eL.id,params:i})}let N={};R.Range.foreach(C,(e,t)=>{let r=f.getCell(e,t);r&&(N[e]||(N[e]={}),N[e][t]={s:r.s})});let{redo:S,undo:A}=rr(e,{range:C,subUnitId:g,unitId:m,shiftDimension:R.Dimension.ROWS,cellValue:N});_.push(...S),y.push(...A);let v=u.onCommandExecute({id:rg.id,params:{range:C}});return _.push(...v.redos),_.push(tl(C,p,f)),y.push(...null!=(n=v.preUndos)?n:[]),_.unshift(...null!=(i=v.preRedos)?i:[]),y.unshift(...v.undos),!!(0,R.sequenceExecute)(_,s)&&(a.pushUndoRedo({unitID:m,undoMutations:y.reverse(),redoMutations:_}),!0)}},rf="sheet.command.insert-range-move-right",rp={type:R.CommandType.COMMAND,id:rf,handler:async(e,t)=>{var r,n,i;let s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService),o=e.get(R.IUniverInstanceService),l=e.get(e1),u=e.get(eo),c=e.get(R.ErrorService),h=e.get(R.LocaleService);if(l.isOverlapping())return c.emit(h.t("sheets.info.overlappingSelections")),!1;let d=eN(o);if(!d)return!1;let{workbook:m,worksheet:g,unitId:f,subUnitId:p}=d,C=null==t?void 0:t.range;if(C||(C=null==(r=l.getCurrentLastSelection())?void 0:r.range),!C)return!1;let _=[],y=[],E=g.getCellMatrix(),b=E.getDataRange(),I=Math.max(E.getSlice(C.startRow,C.endRow,b.startColumn,b.endColumn).getDataRange().endColumn+(C.endColumn-C.startColumn+1)-b.endColumn,0);if(I>0){let t=C.startColumn-1,r=g.getColumnWidth(t),n={unitId:f,subUnitId:p,range:{startRow:b.startRow+1,endRow:b.endRow,startColumn:b.endColumn+1,endColumn:b.endColumn+I},colInfo:Array(I).fill(void 0).map(()=>({w:r,hd:R.BooleanNumber.FALSE}))};_.push({id:eD.id,params:n});let i=eU(e,n);y.push({id:eF.id,params:i})}let N={};R.Range.foreach(C,(e,t)=>{let r=g.getCell(e,t);r&&r.s&&(N[e]||(N[e]={}),N[e][t]={s:r.s})});let{redo:S,undo:A}=rr(e,{range:C,subUnitId:p,unitId:f,shiftDimension:R.Dimension.COLUMNS,cellValue:N});_.push(...S),y.push(...A);let v=u.onCommandExecute({id:rp.id,params:{range:C}});return _.push(...v.redos),_.push(tl(C,m,g)),y.push(...null!=(n=v.preUndos)?n:[]),_.unshift(...null!=(i=v.preRedos)?i:[]),y.unshift(...v.undos),!!(0,R.sequenceExecute)(_,s).result&&(a.pushUndoRedo({unitID:f,undoMutations:y.reverse(),redoMutations:_}),!0)}},rC="sheet.command.insert-row",r_={type:R.CommandType.COMMAND,id:rC,handler:async(e,t)=>{let r=e.get(R.ICommandService),n=e.get(eo),{range:i,direction:s,unitId:a,subUnitId:o,cellValue:l}=t;return!!await n.beforeCommandExecute({id:r_.id,params:t})&&r.syncExecuteCommand(ry.id,{range:i,direction:s,unitId:a,subUnitId:o,cellValue:l})}},ry={type:R.CommandType.COMMAND,id:"sheet.command.insert-row-by-range",handler:(e,t)=>{var r,n,i,s;let a=e.get(R.ICommandService),o=e.get(R.IUndoRedoService),l=e.get(R.IUniverInstanceService),u=e.get(eo),c=eN(l,t);if(!c)return!1;let{workbook:h,worksheet:d}=c,{range:m,direction:g,unitId:f,subUnitId:p,cellValue:C}=t,{startRow:_,endRow:y}=m;m.rangeType=R.RANGE_TYPE.ROW;let E=g===R.Direction.UP?_:_-1,b=d.getRowHeight(E),I={unitId:f,subUnitId:p,range:m,rowInfo:Array(y-_+1).fill(void 0).map(()=>({h:b,hd:R.BooleanNumber.FALSE}))},N=eO(e,I),S=[{id:ex.id,params:I}],A=[{id:eL.id,params:N}];C&&S.push({id:eW.id,params:{unitId:f,subUnitId:p,cellValue:C}});let v=u.onCommandExecute({id:r_.id,params:t});return S.unshift(...null!=(r=v.preRedos)?r:[]),S.push(...null!=(n=v.redos)?n:[]),S.push(tl(m,h,d)),A.unshift(...null!=(i=v.preUndos)?i:[]),A.push(...null!=(s=v.undos)?s:[]),!!(0,R.sequenceExecute)(S,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:A,redoMutations:S}),!0)}},rE={type:R.CommandType.COMMAND,id:"sheet.command.insert-row-before",handler:async e=>{var t;let r,n=null==(t=e.get(e1).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s,subUnitId:a,unitId:o}=i,{startRow:l,endRow:u}=r,c=s.getColumnCount()-1,h={unitId:o,subUnitId:a,direction:R.Direction.UP,range:{startRow:l,endRow:u,startColumn:0,endColumn:c},cellValue:th(s,l,u,0,c,!0,l-1)};return e.get(R.ICommandService).executeCommand(r_.id,h)}},rR={type:R.CommandType.COMMAND,id:"sheet.command.insert-row-after",handler:async e=>{var t;let r,n=null==(t=e.get(e1).getCurrentSelections())?void 0:t.map(e=>e.range);if((null==n?void 0:n.length)!==1)return!1;r=n[0];let i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=r.endRow-r.startRow+1,u=r.endRow+1,c=r.endRow+l,h=s.getColumnCount()-1,d={unitId:a,subUnitId:o,direction:R.Direction.DOWN,range:{startRow:u,endRow:c,startColumn:0,endColumn:h,rangeType:R.RANGE_TYPE.ROW},cellValue:th(s,u,c,0,h,!0,r.endRow)};return e.get(R.ICommandService).executeCommand(r_.id,d)}},rb={type:R.CommandType.COMMAND,id:"sheet.command.insert-multi-rows-above",handler:async(e,t)=>{var r;let n,i=null==(r=e.get(e1).getCurrentSelections())?void 0:r.map(e=>e.range);if((null==i?void 0:i.length)!==1)return!1;n=i[0];let s=eN(e.get(R.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=t.value||0,c=n.startRow,h=n.startRow+u-1,d=a.getColumnCount()-1,m=th(a,c,h,0,d,!0,c-1),g={unitId:o,subUnitId:l,direction:R.Direction.UP,range:{startRow:c,endRow:h,startColumn:0,endColumn:d,rangeType:R.RANGE_TYPE.ROW},cellValue:m};return e.get(R.ICommandService).executeCommand(r_.id,g)}},rI={type:R.CommandType.COMMAND,id:"sheet.command.insert-multi-rows-after",handler:async(e,t)=>{var r;let n,i=null==(r=e.get(e1).getCurrentSelections())?void 0:r.map(e=>e.range);if((null==i?void 0:i.length)!==1)return!1;n=i[0];let s=eN(e.get(R.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=t.value||0,c=n.endRow+1,h=n.endRow+u,d=a.getColumnCount()-1,m={unitId:o,subUnitId:l,direction:R.Direction.DOWN,range:{startRow:c,endRow:h,startColumn:0,endColumn:d,rangeType:R.RANGE_TYPE.ROW},cellValue:th(a,c,h,0,d,!0,n.endRow)};return e.get(R.ICommandService).executeCommand(r_.id,m)}},rN="sheet.command.insert-col",rS={type:R.CommandType.COMMAND,id:rN,handler:async(e,t)=>{let r=e.get(R.ICommandService),n=e.get(eo),{range:i,direction:s,subUnitId:a,unitId:o,cellValue:l}=t;return!!await n.beforeCommandExecute({id:rS.id,params:t})&&r.syncExecuteCommand(rA.id,{range:i,direction:s,unitId:o,subUnitId:a,cellValue:l})}},rA={type:R.CommandType.COMMAND,id:"sheet.command.insert-col-by-range",handler:(e,t)=>{var r,n,i,s;let a=e.get(R.ICommandService),o=e.get(R.IUndoRedoService),l=e.get(R.IUniverInstanceService),u=e.get(eo),{range:c,direction:h,subUnitId:d,unitId:m,cellValue:g}=t,{startColumn:f,endColumn:p}=t.range;c.rangeType=R.RANGE_TYPE.COLUMN;let C=l.getUniverSheetInstance(t.unitId),_=C.getSheetBySheetId(t.subUnitId),y=h===R.Direction.LEFT?f:f-1,E=_.getColumnWidth(y),b={unitId:m,subUnitId:d,range:c,colInfo:Array(p-f+1).fill(void 0).map(()=>({w:E,hd:R.BooleanNumber.FALSE}))},I=eU(e,b),N=[{id:eD.id,params:b}],S=[{id:eF.id,params:I}];g&&N.push({id:eW.id,params:{unitId:m,subUnitId:d,cellValue:g}});let A=u.onCommandExecute({id:rS.id,params:t});return N.unshift(...null!=(r=A.preRedos)?r:[]),N.push(...null!=(n=A.redos)?n:[]),N.push(tl(c,C,_)),S.unshift(...null!=(i=A.preUndos)?i:[]),S.push(...null!=(s=A.undos)?s:[]),!!(0,R.sequenceExecute)(N,a).result&&(o.pushUndoRedo({unitID:t.unitId,undoMutations:S.filter(Boolean),redoMutations:N.filter(Boolean)}),!0)}},rv={type:R.CommandType.COMMAND,id:"sheet.command.insert-col-before",handler:async e=>{let t,r=e.get(e1).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=eN(e.get(R.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,{startColumn:o,endColumn:l}=t,u=i.getRowCount()-1,c={unitId:s,subUnitId:a,direction:R.Direction.LEFT,range:{startColumn:o,endColumn:l,startRow:0,endRow:u,rangeType:R.RANGE_TYPE.COLUMN},cellValue:th(i,0,u,o,l,!1,o-1)};return e.get(R.ICommandService).executeCommand(rS.id,c)}},rT={type:R.CommandType.COMMAND,id:"sheet.command.insert-col-after",handler:async e=>{let t,r=e.get(e1).getCurrentSelections();if((null==r?void 0:r.length)!==1)return!1;t=r[0].range;let n=eN(e.get(R.IUniverInstanceService));if(!n)return!1;let{worksheet:i,unitId:s,subUnitId:a}=n,o=t.endColumn-t.startColumn+1,l=t.endColumn+1,u=t.endColumn+o,c=i.getRowCount()-1,h={unitId:s,subUnitId:a,direction:R.Direction.RIGHT,range:{startColumn:l,endColumn:u,startRow:0,endRow:c},cellValue:th(i,0,c,l,u,!1,t.endColumn)};return e.get(R.ICommandService).executeCommand(rS.id,h)}},rw={type:R.CommandType.COMMAND,id:"sheet.command.insert-multi-cols-before",handler:async(e,t)=>{let r,n=e.get(e1).getCurrentSelections();if((null==n?void 0:n.length)!==1)return!1;r=n[0].range;let i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=t.value||0,u=r.startColumn,c=r.startColumn+l-1,h=s.getRowCount()-1,d={unitId:a,subUnitId:o,direction:R.Direction.LEFT,range:{startColumn:u,endColumn:c,startRow:0,endRow:h,rangeType:R.RANGE_TYPE.COLUMN},cellValue:th(s,0,h,u,c,!1,u-1)};return e.get(R.ICommandService).executeCommand(rS.id,d)}},rM={type:R.CommandType.COMMAND,id:"sheet.command.insert-multi-cols-right",handler:async(e,t)=>{let r,n=e.get(e1).getCurrentSelections();if((null==n?void 0:n.length)!==1)return!1;r=n[0].range;let i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s,unitId:a,subUnitId:o}=i,l=t.value||0,u=r.endColumn+1,c=r.endColumn+l,h=s.getRowCount()-1,d={unitId:a,subUnitId:o,direction:R.Direction.RIGHT,range:{startColumn:u,endColumn:c,startRow:0,endRow:h},cellValue:th(s,0,h,u,c,!1,r.endColumn)};return e.get(R.ICommandService).executeCommand(rS.id,d)}},rO={id:"sheet.command.insert-sheet",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(R.ICommandService),i=e.get(R.IUndoRedoService),s=e.get(R.IUniverInstanceService),a=e.get(R.LocaleService),o=eI(s,{unitId:null==t?void 0:t.unitId});if(!o)return!1;let{unitId:l,workbook:u}=o,c=u.getSheets().length,h=null==t?void 0:t.sheet,d=null==h?void 0:h.id,m=(0,R.mergeWorksheetSnapshotWithDefault)(h||{});t?(c=null!=(r=t.index)?r:c,m.id=d||R.Tools.generateRandomId(),m.name=(null==h?void 0:h.name)||u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`)):(m.id=R.Tools.generateRandomId(),m.name=u.generateNewSheetName(`${a.t("sheets.tabs.sheet")}`));let g={index:c,sheet:m,unitId:l},f=e8(e,g);return!!n.syncExecuteCommand(e7.id,g)&&(i.pushUndoRedo({unitID:l,undoMutations:[{id:tt.id,params:f}],redoMutations:[{id:e7.id,params:g}]}),!0)}};function rx(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startRow>s.startRow,o=i.endRow-i.startRow+1;return a?{unitId:r,subUnitId:n,sourceRange:R.Rectangle.clone(s),targetRange:{...i,endRow:i.endRow+o,startRow:i.startRow+o}}:{unitId:r,subUnitId:n,targetRange:R.Rectangle.clone(i),sourceRange:{...s,endRow:s.endRow-o,startRow:s.startRow-o}}}let rU={id:"sheet.mutation.move-rows",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(R.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveRowMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveRowMutation] worksheet is null!");let l=i.startRow,u=i.endRow-i.startRow+1,c=s.startRow,h=o.getRowManager().getRowData();return(0,R.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveRows(l,u,c),!0}};function rD(e,t){let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=i.startColumn>s.startColumn,o=i.endColumn-i.startColumn+1;return a?{unitId:r,subUnitId:n,sourceRange:R.Rectangle.clone(s),targetRange:{...i,endColumn:i.endColumn+o,startColumn:i.startColumn+o}}:{unitId:r,subUnitId:n,targetRange:R.Rectangle.clone(i),sourceRange:{...s,startColumn:s.startColumn-o,endColumn:s.endColumn-o}}}let rV={id:"sheet.mutation.move-columns",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,sourceRange:i,targetRange:s}=t,a=e.get(R.IUniverInstanceService).getUniverSheetInstance(r);if(!a)throw Error("[MoveColumnMutation] univerSheet is null!");let o=a.getSheetBySheetId(n);if(!o)throw Error("[MoveColumnMutation] worksheet is null!");let l=i.startColumn,u=i.endColumn-i.startColumn+1,c=s.startColumn,h=o.getColumnManager().getColumnData();return(0,R.moveMatrixArray)(l,u,c,h),o.getCellMatrix().moveColumns(l,u,c),!0}},rL="sheet.command.move-rows",rP={id:rL,type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(e1),{fromRange:{startRow:s},toRange:{startRow:a},range:o}=t,l=o?[rj(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===R.RANGE_TYPE.ROW&&e.range.startRow<=s&&s<=e.range.endRow);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(eo),h=eN(e.get(R.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),p=e.get(R.ErrorService),C=e.get(R.LocaleService),_=u[0].range,y=u[0].primary,E=ti(_,m,!1);if(!R.Rectangle.equals(_,E))return p.emit(C.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startRow<a&&a<=e.endRow))return p.emit(C.t("sheets.info.acrossMergedCell")),!1;let b={..._,startRow:a,endRow:a+_.endRow-_.startRow},I={unitId:g,subUnitId:f,sourceRange:_,targetRange:b},N=rx(e,I),S=e.get(R.ICommandService),A=c.onCommandExecute({id:rP.id,params:t}),v=[...null!=(r=A.preRedos)?r:[],{id:rU.id,params:I}],T=[...null!=(n=A.preUndos)?n:[],{id:rU.id,params:N}];if(y){let e=_.endRow-_.startRow+1,t=a-s<0?b:{...b,startRow:b.startRow-e,endRow:b.endRow-e},r={unitId:g,subUnitId:f,type:eZ.MOVE_END,selections:[{range:t,primary:to(t,m),style:null}]},n={unitId:g,subUnitId:f,type:eZ.MOVE_END,selections:[{range:_,primary:y,style:null}]};v.push({id:tp.id,params:r}),T.push({id:tp.id,params:n})}return v.push(...A.redos),T.push(...A.undos),!!(0,R.sequenceExecute)(v,S).result&&(e.get(R.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:v}),!0)}},rF="sheet.command.move-cols",rk={id:rF,type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(e1),{fromRange:{startColumn:s},toRange:{startColumn:a},range:o}=t,l=o?[rj(o)]:i.getCurrentSelections(),u=null==l?void 0:l.filter(e=>e.range.rangeType===R.RANGE_TYPE.COLUMN&&e.range.startColumn<=s&&s<=e.range.endColumn);if((null==u?void 0:u.length)!==1)return!1;let c=e.get(eo),h=eN(e.get(R.IUniverInstanceService),t);if(!h)return!1;let{workbook:d,worksheet:m}=h,g=d.getUnitId(),f=m.getSheetId(),p=e.get(R.ErrorService),C=e.get(R.LocaleService),_=u[0].range,y=u[0].primary,E=ti(_,m,!1);if(!R.Rectangle.equals(_,E))return p.emit(C.t("sheets.info.partOfCell")),!1;if(m.getMergeData().some(e=>e.startColumn<a&&a<=e.endColumn))return p.emit(C.t("sheets.info.acrossMergedCell")),!1;let b={..._,startColumn:a,endColumn:a+_.endColumn-_.startColumn},I={unitId:g,subUnitId:f,sourceRange:_,targetRange:b},N=rD(e,I),S=e.get(R.ICommandService),A=c.onCommandExecute({id:rk.id,params:t}),v=[...null!=(r=A.preRedos)?r:[],{id:rV.id,params:I}],T=[...null!=(n=A.preUndos)?n:[],{id:rV.id,params:N}];if(y){let e=_.endColumn-_.startColumn+1,t=a-s<0?b:{...b,startColumn:b.startColumn-e,endColumn:b.endColumn-e},r={unitId:g,subUnitId:f,type:eZ.MOVE_END,selections:[{range:t,primary:to(t,m),style:null}]},n={unitId:g,subUnitId:f,type:eZ.MOVE_END,selections:[{range:_,primary:y,style:null}]};v.push({id:tp.id,params:r}),T.push({id:tp.id,params:n})}return v.push(...A.redos),T.push(...A.undos),(0,R.sequenceExecute)(v,S).result&&e.get(R.IUndoRedoService).pushUndoRedo({unitID:g,undoMutations:T,redoMutations:v}),!0}};function rj(e){return{range:e,primary:null,style:null}}let rB={id:"sheet.mutation.register-worksheet-range-theme-style",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,rangeThemeStyleJson:n,themeName:i}=t,s=eN(e.get(R.IUniverInstanceService)),a=e.get(eb);if(!s)return!1;let o=new eh(i,n);return a.registerRangeThemeStyle(r,o),!0}},r$={id:"sheet.mutation.unregister-worksheet-range-theme-style",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,themeName:n}=t,i=eN(e.get(R.IUniverInstanceService)),s=e.get(eb);return!!i&&(s.unregisterRangeThemeStyle(r,n),!0)}},rH={id:"sheet.command.register-worksheet-range-theme-style",type:R.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,rangeThemeStyle:n}=t,i=e.get(R.IUniverInstanceService),s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService);if(!eN(i))return!1;let o={unitId:r,themeName:n.getName(),rangeThemeStyleJson:n.toJson()},l={unitId:r,themeName:n.getName()};return s.syncExecuteCommand(rB.id,o)&&a.pushUndoRedo({unitID:r,undoMutations:[{id:r$.id,params:l}],redoMutations:[{id:rB.id,params:o}]}),!0}},rW={id:"sheet.command.remove-defined-name",type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(eo);if(!t)return!1;let o={...t},l=a.onCommandExecute({id:rW.id,params:t}),u=[...null!=(r=l.preRedos)?r:[],{id:I.RemoveDefinedNameMutation.id,params:o},...l.redos],c=[...null!=(n=l.preUndos)?n:[],{id:I.SetDefinedNameMutation.id,params:o},...l.undos];return!!(0,R.sequenceExecute)(u,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:c.filter(Boolean),redoMutations:u.filter(Boolean)}),!0)}},rG="sheet.command.remove-row",rY={type:R.CommandType.COMMAND,id:"sheet.command.remove-row-by-range",handler:(e,t)=>{if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService),t);if(!r)return!1;let{workbook:n,worksheet:i}=r,s=e.get(eo),{range:a,unitId:o,subUnitId:l}=t,u=eQ([a],e,o,l).reverse(),c=[],h=[];u.forEach(e=>{var t,r,n,a;let u=[],d=[],m={unitId:o,subUnitId:l,range:e},g=eV(m,i),f={unitId:o,subUnitId:l,cellValue:i.getCellMatrix().getSlice(e.startRow,e.endRow,0,i.getColumnCount()-1).getMatrix()},p=s.onCommandExecute({id:rG,params:{range:e}});d.push(...null!=(t=p.preRedos)?t:[]),d.push({id:eL.id,params:m}),d.push(...null!=(r=p.redos)?r:[]),u.push(...null!=(n=p.preUndos)?n:[]),u.push({id:ex.id,params:g}),u.push({id:eW.id,params:f}),u.push(...null!=(a=p.undos)?a:[]),h.push(...d),c.unshift(...u)}),h.push(tl(a,n,i));let d=e.get(R.ICommandService);return!!(0,R.sequenceExecute)(h,d).result&&(e.get(R.IUndoRedoService).pushUndoRedo({unitID:o,undoMutations:c,redoMutations:h}),!0)}},rz={type:R.CommandType.COMMAND,id:rG,handler:async(e,t)=>{var r;let n=e.get(e1),i=e.get(eo),s=e.get(R.ICommandService),a=null==t?void 0:t.range;if(a||(a=null==(r=n.getCurrentLastSelection())?void 0:r.range),!a)return!1;let o=eN(e.get(R.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o;return a={...a,startColumn:0,endColumn:Math.max(l.getMaxColumns()-1,0)},!!await i.beforeCommandExecute({id:rz.id,params:{range:a}})&&s.syncExecuteCommand(rY.id,{range:a,unitId:c,subUnitId:u})}},rX="sheet.command.remove-col",rq={type:R.CommandType.COMMAND,id:"sheet.command.remove-col-by-range",handler:(e,t)=>{var r,n,i;if(!t)return!1;let s=eN(e.get(R.IUniverInstanceService),t);if(!s)return!1;let{workbook:a,worksheet:o}=s,l=e.get(eo),{range:u,unitId:c,subUnitId:h}=t,d={unitId:c,subUnitId:h,range:u},m=eP(e,d),g={unitId:c,subUnitId:h,cellValue:o.getCellMatrix().getSlice(0,o.getRowCount()-1,u.startColumn,u.endColumn).getMatrix()},f=l.onCommandExecute({id:rX,params:{range:u}}),p=e.get(R.ICommandService);return!!(0,R.sequenceExecute)([...null!=(r=f.preRedos)?r:[],{id:eF.id,params:d},...f.redos,tl(u,a,o)],p).result&&(e.get(R.IUndoRedoService).pushUndoRedo({unitID:c,undoMutations:[...null!=(n=f.preUndos)?n:[],{id:eD.id,params:m},{id:eW.id,params:g},...f.undos],redoMutations:[...null!=(i=f.preRedos)?i:[],{id:eF.id,params:d},...f.redos]}),!0)}},rK={type:R.CommandType.COMMAND,id:rX,handler:async(e,t)=>{var r;let n=e.get(e1),i=e.get(eo),s=e.get(R.ICommandService),a=null==t?void 0:t.range;if(a||(a=null==(r=n.getCurrentLastSelection())?void 0:r.range),!a)return!1;let o=eN(e.get(R.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o;return a={...a,startRow:0,endRow:Math.max(l.getMaxRows()-1,0)},!!await i.beforeCommandExecute({id:rK.id,params:{range:a}})&&s.syncExecuteCommand(rq.id,{range:a,unitId:c,subUnitId:u})}},rQ={id:"sheet.command.remove-sheet",type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService),o=e.get(eo),l=eN(a,t);if(!l)return!1;let{unitId:u,subUnitId:c,workbook:h,worksheet:d}=l;if(h.getSheets().length<=1)return!1;let m={subUnitId:c,unitId:u,subUnitName:d.getName()},g=te(e,m),f=o.onCommandExecute({id:rQ.id,params:{unitId:u,subUnitId:c}}),p=[...null!=(r=f.preRedos)?r:[],{id:tt.id,params:m},...f.redos],C=[...null!=(n=f.preUndos)?n:[],{id:e7.id,params:g},...f.undos];return!!(0,R.sequenceExecute)(p,i).result&&(s.pushUndoRedo({unitID:u,undoMutations:C,redoMutations:p}),!0)}},rZ=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:R.Tools.deepClone(t.ranges)}},rJ={id:"sheet.mutation.add-worksheet-merge",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)i.push(s[e]);return n.getSpanModel().rebuild(i),!0}},r0=(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().mergeData,s=t.ranges,a=[];for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];R.Rectangle.intersects(r,n)&&a.push(i[t])}return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:a}},r1={id:"sheet.mutation.remove-worksheet-merge",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig().mergeData,s=t.ranges;for(let e=0;e<s.length;e++)for(let t=i.length-1;t>=0;t--){let r=i[t],n=s[e];R.Rectangle.intersects(r,n)&&i.splice(t,1)}return n.getSpanModel().rebuild(i),!0}},r2={type:R.CommandType.COMMAND,id:"sheet.command.remove-worksheet-merge",handler:(e,t)=>{var r;let n=e.get(e1),i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService),o=(null==t?void 0:t.ranges)||(null==(r=n.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=o&&o.length))return!1;let l=eN(a);if(!l)return!1;let{subUnitId:u,unitId:c,worksheet:h}=l,d=h.getConfig().mergeData.filter(e=>o.some(t=>R.Rectangle.intersects(t,e)));if(!d.length)return!1;let m=r0(e,{unitId:c,subUnitId:u,ranges:o}),g=n.getCurrentSelections();if(!(null!=g&&g.length))return!1;let f=R.Tools.deepClone(g),p=R.Tools.deepClone(g),C=p[p.length-1],{startRow:_,startColumn:y}=C.range;C.primary={startRow:_,startColumn:y,endRow:_,endColumn:y,actualRow:_,actualColumn:y,isMerged:!1,isMergedMainCell:!1};let E=function(e,t){let r=new(0,R.ObjectMatrix),n=new(0,R.ObjectMatrix);return t.forEach(t=>{let{startRow:i,startColumn:s,endColumn:a,endRow:o}=t,l=e.getCellMatrix().getValue(i,s);if(null!=l&&l.s)for(let e=i;e<=o;e++)for(let t=s;t<=a;t++)(e!==i||t!==s)&&(r.setValue(e,t,{s:l.s}),n.setValue(e,t,null))}),{redoParams:r,undoParams:n}}(h,d),b={unitId:c,subUnitId:u,cellValue:E.redoParams.getMatrix()},I={unitId:c,subUnitId:u,cellValue:E.undoParams.getMatrix()},N=[{id:r1.id,params:m},{id:eW.id,params:b},{id:tp.id,params:{selections:p}}],S=[{id:rJ.id,params:m},{id:eW.id,params:I},{id:tp.id,params:{selections:f}}];return!!(0,R.sequenceExecute)(N,i)&&(s.pushUndoRedo({unitID:c,undoMutations:S,redoMutations:N}),!0)}},r5=e=>{let{order:t}=e,r={};return Object.keys(t).forEach(e=>{r[t[Number(e)]]=Number(e)}),{...e,order:r}},r3={id:"sheet.mutation.reorder-range",type:R.CommandType.MUTATION,handler:(e,t)=>{let{subUnitId:r,unitId:n,range:i,order:s}=t,a=e.get(R.IUniverInstanceService).getUnit(n).getSheetBySheetId(r);if(!a)return!1;let o=new(0,R.ObjectMatrix);R.Range.foreach(i,(e,t)=>{if(s.hasOwnProperty(e)){let r=s[e],n=R.Tools.deepClone(a.getCellRaw(r,t));o.setValue(e,t,n)}});let l=a.getCellMatrix();return o.forValue((e,t,r)=>{l.setValue(e,t,r)}),!0}},r4="sheet.command.reorder-range",r6={id:r4,type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let{subUnitId:i,unitId:s,range:a,order:o}=t,l=e.get(R.ICommandService),u={id:r3.id,params:{unitId:s,subUnitId:i,order:o,range:a}},c={id:r3.id,params:r5(u.params)},h=e.get(eo),d=h.onCommandExecute({id:r6.id,params:t}),m=[...null!=(r=d.preRedos)?r:[],u,...d.redos],g=[...null!=(n=d.preUndos)?n:[],c,...d.undos],f=(0,R.sequenceExecute)(m,l),p=h.afterCommandExecute({id:r6.id,params:t});return!!f.result&&((0,R.sequenceExecute)(p.redos,l),e.get(R.IUndoRedoService).pushUndoRedo({unitID:s,undoMutations:[...g,...p.undos],redoMutations:[...m,...p.redos]}),!0)}};class r9{constructor(){j(this,"_borderInfo",{type:R.BorderType.ALL,color:"#000000",style:R.BorderStyleTypes.THIN,activeBorderType:!1}),j(this,"_borderInfo$",new(0,S.BehaviorSubject)(this._borderInfo)),j(this,"borderInfo$",this._borderInfo$.asObservable())}dispose(){this._borderInfo$.complete()}setType(e){this._borderInfo.type=e,this.setActiveBorderType(!0),this._refresh()}setColor(e){this._borderInfo.color=e,this._refresh()}setStyle(e){this._borderInfo.style=e,this._refresh()}setActiveBorderType(e){this._borderInfo.activeBorderType=e}getBorderInfo(){return this._borderInfo}_refresh(){this._borderInfo$.next(this._borderInfo)}}function r8(e,t){let{startRow:r,startColumn:n,endRow:i,endColumn:s}=e;for(let e=r;e<=i;e++)for(let r=n;r<=s;r++)t(e,r)}let r7=(e,t,r,n)=>{let{mr:i,worksheet:s}=e;t.startRow<0||t.startColumn<0||r8(t,(e,t)=>{var a,o;let l=s.getMergedCell(e,t),u=r;if(l&&(r.bc_tr||r.ml_tr||r.bl_tr||r.tl_mr||r.tl_bc||r.tl_br)){if(n){let e=R.Tools.deepClone(null==(a=i.getValue(l.startRow,l.startColumn))?void 0:a.s);u=null!=e&&e.bd?Object.assign(e.bd,r):r}i.setValue(l.startRow,l.startColumn,{s:{bd:u}})}else{if(n){let n=R.Tools.deepClone(null==(o=i.getValue(e,t))?void 0:o.s);u=null!=n&&n.bd?Object.assign(n.bd,r):r}i.setValue(e,t,{s:{bd:u}})}})},ne=e=>{let t={startRow:e.startRow-1,startColumn:e.startColumn,endRow:e.startRow-1,endColumn:e.endColumn},r={startRow:e.startRow,startColumn:e.startColumn-1,endRow:e.endRow,endColumn:e.startColumn-1},n={startRow:e.endRow+1,startColumn:e.startColumn,endRow:e.endRow+1,endColumn:e.endColumn},i={startRow:e.startRow,startColumn:e.endColumn+1,endRow:e.endRow,endColumn:e.endColumn+1},s={startRow:e.startRow,startColumn:e.startColumn,endRow:e.startRow,endColumn:e.endColumn},a={startRow:e.startRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.startColumn};return{topRangeOut:t,leftRangeOut:r,bottomRangeOut:n,rightRangeOut:i,topRange:s,leftRange:a,bottomRange:{startRow:e.endRow,startColumn:e.startColumn,endRow:e.endRow,endColumn:e.endColumn},rightRange:{startRow:e.startRow,startColumn:e.endColumn,endRow:e.endRow,endColumn:e.endColumn}}},nt=e=>{let{range:t,mr:r,borderStyle:n,vertical:i,horizontal:s,worksheet:a}=e;i&&r8(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startColumn!==t.startColumn&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{l:R.Tools.deepClone(n)}):{l:R.Tools.deepClone(n)}}})}else{if(i!==t.endColumn){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:R.Tools.deepClone(n)}):{r:R.Tools.deepClone(n)}}})}if(i!==t.startColumn){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:R.Tools.deepClone(n)}):{l:R.Tools.deepClone(n)}}})}}}),s&&r8(t,(e,i)=>{var s,o,l;let u=a.getMergedCell(e,i);if(u){let a=null==(s=r.getValue(u.startRow,u.startColumn))?void 0:s.s;u.startRow!==t.startRow&&r.setValue(e,i,{s:{bd:null!=a&&a.bd?Object.assign(a.bd,{t:R.Tools.deepClone(n)}):{t:R.Tools.deepClone(n)}}})}else{if(e!==t.endRow){let t=null==(o=r.getValue(e,i))?void 0:o.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:R.Tools.deepClone(n)}):{b:R.Tools.deepClone(n)}}})}if(e!==t.startRow){let t=null==(l=r.getValue(e,i))?void 0:l.s;r.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:R.Tools.deepClone(n)}):{t:R.Tools.deepClone(n)}}})}}})},nr=e=>{let{top:t,left:r,right:n,bottom:i,borderStyle:s,bottomRange:a,topRange:o,leftRange:l,rightRange:u,bottomRangeOut:c,topRangeOut:h,leftRangeOut:d,rightRangeOut:m}=e,g=(t,r,n)=>{r7(e,t,r,n)};t&&(g(h,{b:null}),g(o,{t:R.Tools.deepClone(s)},!0)),i&&(g(c,{t:null}),g(a,{b:R.Tools.deepClone(s)},!0)),r&&(g(d,{r:null}),g(l,{l:R.Tools.deepClone(s)},!0)),n&&(g(m,{l:null}),g(u,{r:R.Tools.deepClone(s)},!0))},nn=e=>{let{range:t,worksheet:r,mr:n,top:i,bottom:s,left:a,right:o,vertical:l,horizontal:u,tl_br:c,tl_bc:h,tl_mr:d,bl_tr:m,ml_tr:g,bc_tr:f,topRange:p,bottomRange:C,leftRange:_,rightRange:y,topRangeOut:E,bottomRangeOut:R,leftRangeOut:b,rightRangeOut:I}=e,N=(t,r,n)=>{r7(e,t,r,n)};i||s||a||o||l||u||c||h||d||m||g||f||(r8(t,(e,i)=>{var s,a,o,l,u,c,h,d;let m=r.getMergedCell(e,i);if(m){if(m.endColumn!==t.endColumn){let t=null==(s=n.getValue(m.startRow,m.startColumn))?void 0:s.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(m.startColumn!==t.startColumn){let t=null==(a=n.getValue(m.startRow,m.startColumn))?void 0:a.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(m.endRow!==t.endRow){let t=null==(o=n.getValue(m.startRow,m.startColumn))?void 0:o.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(m.startRow!==t.startRow){let t=null==(l=n.getValue(m.startRow,m.startColumn))?void 0:l.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}else{if(i!==t.endColumn){let t=null==(u=n.getValue(e,i))?void 0:u.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{r:null}):{r:null}}})}if(i!==t.startColumn){let t=null==(c=n.getValue(e,i))?void 0:c.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{l:null}):{l:null}}})}if(e!==t.endRow){let t=null==(h=n.getValue(e,i))?void 0:h.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{b:null}):{b:null}}})}if(e!==t.startRow){let t=null==(d=n.getValue(e,i))?void 0:d.s;n.setValue(e,i,{s:{bd:null!=t&&t.bd?Object.assign(t.bd,{t:null}):{t:null}}})}}}),N(E,{b:null}),N(p,{t:null},!0),N(R,{t:null}),N(C,{b:null},!0),N(b,{r:null}),N(_,{l:null},!0),N(I,{l:null}),N(y,{r:null},!0),N(t,{tl_br:null},!0),N(t,{tl_bc:null},!0),N(t,{tl_mr:null},!0),N(t,{bl_tr:null},!0),N(t,{ml_tr:null},!0),N(t,{bc_tr:null},!0))},ni={id:"sheet.command.set-border",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;let n=e.get(R.ICommandService),i=e.get(R.IUndoRedoService),s=e.get(R.IUniverInstanceService),a=e.get(e1),o=e.get(r9),l=eN(s,t);if(!l)return!1;let u=(null==t?void 0:t.ranges)||(null==(r=a.getCurrentSelections())?void 0:r.map(e=>e.range));if(!(null!=u&&u.length))return!1;let{activeBorderType:c}=o.getBorderInfo();if(!c)return!1;let h=function(e,t,r){let{style:n,color:i,type:s}=e.getBorderInfo(),a=s===R.BorderType.TOP||s===R.BorderType.ALL||s===R.BorderType.OUTSIDE,o=s===R.BorderType.LEFT||s===R.BorderType.ALL||s===R.BorderType.OUTSIDE,l=s===R.BorderType.BOTTOM||s===R.BorderType.ALL||s===R.BorderType.OUTSIDE,u=s===R.BorderType.RIGHT||s===R.BorderType.ALL||s===R.BorderType.OUTSIDE,c=s===R.BorderType.VERTICAL||s===R.BorderType.ALL||s===R.BorderType.INSIDE,h=s===R.BorderType.HORIZONTAL||s===R.BorderType.ALL||s===R.BorderType.INSIDE,d=s.indexOf("tlbr")>-1,m=s.indexOf("tlbc")>-1,g=s.indexOf("tlmr")>-1,f=s.indexOf("bltr")>-1,p=s.indexOf("mltr")>-1,C=s.indexOf("bctr")>-1,_=r[0],{topRangeOut:y,leftRangeOut:E,bottomRangeOut:b,rightRangeOut:I,topRange:N,leftRange:S,bottomRange:A,rightRange:v}=ne(_),T=new(0,R.ObjectMatrix),{worksheet:w,unitId:M,subUnitId:O}=t;return{worksheet:w,unitId:M,subUnitId:O,style:n,color:i,type:s,top:a,left:o,right:u,bottom:l,vertical:c,horizontal:h,tl_br:d,tl_bc:m,tl_mr:g,bl_tr:f,ml_tr:p,bc_tr:C,topRangeOut:y,leftRangeOut:E,bottomRangeOut:b,rightRangeOut:I,topRange:N,leftRange:S,bottomRange:A,rightRange:v,range:_,mr:T,borderStyle:{s:n,cl:{rgb:i}}}}(o,l,u);nt(h),nr(h),function(e){let{borderStyle:t,tl_br:r,tl_bc:n,tl_mr:i,bl_tr:s,ml_tr:a,bc_tr:o}=e,l=(t,r,n)=>{r7(e,t,r,n)};r&&l(e.range,{tl_br:R.Tools.deepClone(t)},!0),n&&l(e.range,{tl_bc:R.Tools.deepClone(t)},!0),i&&l(e.range,{tl_mr:R.Tools.deepClone(t)},!0),s&&l(e.range,{bl_tr:R.Tools.deepClone(t)},!0),a&&l(e.range,{ml_tr:R.Tools.deepClone(t)},!0),o&&l(e.range,{bc_tr:R.Tools.deepClone(t)},!0)}(h),nn(h);let{unitId:d,subUnitId:m,mr:g}=h,f={unitId:d,subUnitId:m,cellValue:g.getData()},p=eH(e,f);return!!n.syncExecuteCommand(eW.id,f)&&(i.pushUndoRedo({unitID:d,undoMutations:[{id:eW.id,params:p}],redoMutations:[{id:eW.id,params:f}]}),!0)}},ns={id:"sheet.command.set-border-position",type:R.CommandType.COMMAND,handler:(e,t)=>{if(!t.value)return!1;let r=e.get(R.ICommandService);return e.get(r9).setType(t.value),r.syncExecuteCommand(ni.id)}},na={id:"sheet.command.set-border-style",type:R.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(R.ICommandService);return e.get(r9).setStyle(t.value),r.syncExecuteCommand(ni.id)}},no={id:"sheet.command.set-border-color",type:R.CommandType.COMMAND,handler:(e,t)=>{let r=e.get(R.ICommandService);return e.get(r9).setColor(t.value),r.syncExecuteCommand(ni.id)}},nl={id:"sheet.command.set-border-basic",type:R.CommandType.COMMAND,handler:(e,t)=>{let{unitId:r,subUnitId:n,value:i,ranges:s}=t,{type:a,color:o,style:l}=i,u=e.get(R.ICommandService),c=e.get(r9);return c.setType(a),o&&c.setColor(o),c.setStyle(l),u.syncExecuteCommand(ni.id,{unitId:r,subUnitId:n,ranges:s})}},nu=(e,t)=>{let{unitId:r,subUnitId:n,columnData:i}=e,s={},a=t.getColumnManager();for(let e in i){let t=i[e],r=a.getColumn(Number(e));s[e]=function(e,t){if(null==e)return e;let r=R.Tools.deepClone(e);if(null==t)return r;let n={};return"w"in t&&(n.w=r.w),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,columnData:s}},nc={id:"sheet.mutation.set-col-data",type:R.CommandType.MUTATION,handler:(e,t)=>{let{columnData:r}=t,n=eN(e.get(R.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getColumnManager();for(let e in r){let t=r[e];if(null==t){s.removeColumn(Number(e));continue}Object.assign(s.getColumnOrCreate(Number(e)),t)}return!0}},nh={type:R.CommandType.COMMAND,id:"sheet.command.set-col-data",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService),t);if(!i)return!1;let{columnData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,columnData:s},c=nu(u,l);return!!r.syncExecuteCommand(nc.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:nc.id,params:c}],redoMutations:[{id:nc.id,params:u}]}),!0)}},nd=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},nm={id:"sheet.mutation.set-col-hidden",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=R.BooleanNumber.TRUE)}}return!0}},ng=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},nf={id:"sheet.mutation.set-col-visible",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId).getColumnManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startColumn;e<r.endColumn+1;e++){let t=n.getColumnOrCreate(e);null!=t&&(t.hd=R.BooleanNumber.FALSE)}}return!0}},np={type:R.CommandType.COMMAND,id:"sheet.command.set-col-visible-on-cols",handler:(e,t)=>{var r,n;let{unitId:i,subUnitId:s,ranges:a}=t,o=e.get(eo),l=e.get(R.ICommandService),u=eN(e.get(R.IUniverInstanceService),{unitId:i,subUnitId:s});if(!u)return!1;let{worksheet:c}=u,h={unitId:i,subUnitId:s,ranges:a},d={unitId:i,subUnitId:s,reveal:!0,selections:a.map(e=>({range:e,primary:to(e,c),style:null}))},m=ng(e,h),g={unitId:i,subUnitId:s,selections:ny(a).map(e=>({range:e,primary:to(e,c),style:null}))},f=(0,R.sequenceExecute)([{id:nf.id,params:h},{id:tp.id,params:d}],l),p=o.onCommandExecute({id:np.id,params:t}),C=(0,R.sequenceExecute)([...p.redos],l);return f.result&&C.result&&e.get(R.IUndoRedoService).pushUndoRedo({unitID:i,undoMutations:[{id:nm.id,params:m},{id:tp.id,params:g},...null!=(r=p.undos)?r:[]],redoMutations:[...null!=(n=p.preRedos)?n:[],{id:nf.id,params:h},{id:tp.id,params:d},...p.redos]}),!0}},nC={type:R.CommandType.COMMAND,id:"sheet.command.set-selected-cols-visible",handler:e=>{var t;let r=e.get(e1),n=e.get(R.ICommandService),i=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===R.RANGE_TYPE.COLUMN);if(!(null!=i&&i.length))return!1;let s=eN(e.get(R.IUniverInstanceService));if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=i.map(e=>a.getHiddenCols(e.startColumn,e.endColumn)).flat();return n.executeCommand(np.id,{unitId:o,subUnitId:l,ranges:u})}},n_={type:R.CommandType.COMMAND,id:"sheet.command.set-col-hidden",handler:(e,t)=>{var r,n,i,s;let a=e.get(e1),o=e.get(eo),l=e.get(R.IUniverInstanceService),u=e.get(R.ICommandService),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===R.RANGE_TYPE.COLUMN);if(!(null!=c&&c.length))return!1;let h=eN(l,t);if(!h)return!1;let{worksheet:d,unitId:m,subUnitId:g}=h,f={unitId:m,subUnitId:g,ranges:c=function(e,t){let r=e.getRowCount()-1,n=e.getHiddenCols(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startColumn>=e.startColumn&&t.endColumn<=e.endColumn);if(t.length){let n=e.startColumn;t.forEach(e=>{e.startColumn>n&&(i.push({startColumn:n,endColumn:e.startColumn-1,startRow:0,endRow:r}),n=e.endColumn+1)}),n<=e.endColumn&&i.push({startColumn:n,endColumn:e.endColumn,startRow:0,endRow:r})}else i.push(e)}),i}(h.worksheet,c)},p={unitId:m,subUnitId:g,selections:ny(c).map(e=>({range:e,primary:to(e,d),style:null}))},C=nd(e,f),_={unitId:m,subUnitId:g,reveal:!0,selections:c.map(e=>({range:e,primary:to(e,d),style:null}))},y=(0,R.sequenceExecute)([{id:nm.id,params:f},{id:tp.id,params:p}],u),E=o.onCommandExecute({id:n_.id,params:f}),b=(0,R.sequenceExecute)([...E.redos],u);return!!y.result&&!!b.result&&(e.get(R.IUndoRedoService).pushUndoRedo({unitID:m,undoMutations:[{id:nf.id,params:C},{id:tp.id,params:_},...null!=(i=E.undos)?i:[]],redoMutations:[...null!=(s=E.preRedos)?s:[],{id:nm.id,params:f},{id:tp.id,params:p},...E.redos]}),!0)}};function ny(e){return(function(e){let t,r=[];return e.sort((e,t)=>e.startColumn-t.startColumn).forEach(e=>{if(!t){t=e;return}t.endColumn===e.startColumn-1?t.endColumn=e.endColumn:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startColumn?e.endColumn+1:e.startColumn-1;return{...e,startColumn:t,endColumn:t}})}let nE={id:"sheet.command.set-defined-name",type:R.CommandType.COMMAND,handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(eo);if(!t)return!1;let o={...t},l=(0,I.SetDefinedNameMutationFactory)(e,t),u=a.onCommandExecute({id:nE.id,params:t}),c=[...null!=(r=u.preRedos)?r:[],{id:I.RemoveDefinedNameMutation.id,params:l},{id:I.SetDefinedNameMutation.id,params:o},...u.redos],h=[...null!=(n=u.preUndos)?n:[],{id:I.RemoveDefinedNameMutation.id,params:o},{id:I.SetDefinedNameMutation.id,params:l},...u.undos];return!!(0,R.sequenceExecute)(c,i)&&(s.pushUndoRedo({unitID:t.unitId,undoMutations:h.filter(Boolean),redoMutations:c.filter(Boolean)}),!0)}},nR=(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(null==n)throw Error("worksheet is null error!");let i=n.getConfig().freeze;return{unitId:t.unitId,subUnitId:t.subUnitId,...i}},nb={id:"sheet.mutation.set-frozen",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId);if(!n)return!1;let i=n.getConfig(),{startRow:s,startColumn:a,ySplit:o,xSplit:l}=t;return i.freeze={startRow:s,startColumn:a,ySplit:o,xSplit:l},!0}},nI={type:R.CommandType.COMMAND,id:"sheet.command.set-frozen",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService),{unitId:t.unitId,subUnitId:t.subUnitId});if(!i)return!1;let{unitId:s,subUnitId:a,worksheet:o}=i,{startColumn:l,startRow:u,xSplit:c,ySplit:h}=t;if(u>=o.getRowCount()||l>=o.getColumnCount()||c>=o.getColumnCount()||h>=o.getRowCount())return!1;let d={unitId:s,subUnitId:a,...t},m=nR(e,d);return!!r.syncExecuteCommand(nb.id,d)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:nb.id,params:m}],redoMutations:[{id:nb.id,params:d}]}),!0)}},nN={type:R.CommandType.COMMAND,id:"sheet.command.cancel-frozen",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUniverInstanceService),i=e.get(R.IUndoRedoService),s=eN(n,{unitId:null==t?void 0:t.unitId,subUnitId:null==t?void 0:t.subUnitId});if(!s)return!1;let{unitId:a,subUnitId:o}=s,l={unitId:a,subUnitId:o,startRow:-1,startColumn:-1,xSplit:0,ySplit:0},u=nR(e,l);return r.syncExecuteCommand(nb.id,l)&&i.pushUndoRedo({unitID:a,undoMutations:[{id:nb.id,params:u}],redoMutations:[{id:nb.id,params:l}]}),!0}},nS={id:"sheet.mutation.set-gridlines-color",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=eN(e.get(R.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r;return n.getConfig().gridlinesColor=t.color,!0}},nA={type:R.CommandType.COMMAND,id:"sheet.command.set-gridlines-color",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s}=i,a=s.getConfig().gridlinesColor;if(a===(null==t?void 0:t.color))return!1;let{unitId:o,subUnitId:l}=i,u={color:null==t?void 0:t.color,unitId:o,subUnitId:l};return!!r.syncExecuteCommand(nS.id,u)&&(n.pushUndoRedo({unitID:o,undoMutations:[{id:nS.id,params:{color:a,unitId:o,subUnitId:l}}],redoMutations:[{id:nS.id,params:u}]}),!0)}},nv={id:"sheet.mutation.set-range-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i,ruleId:s}=t;return e.get(H).setRule(r,n,s,i),!0}},nT=(e,t)=>{let{unitId:r,subUnitId:n,ruleId:i}=t,s=e.get(H).getRule(r,n,i);return s?{id:nv.id,params:{...t,rule:s}}:null},nw={id:"sheet.mutation.set-worksheet-protection",type:R.CommandType.MUTATION,handler:(e,t)=>{let{unitId:r,subUnitId:n,rule:i}=t;return e.get(q).setRule(r,n,i),!0}},nM={type:R.CommandType.COMMAND,id:"sheet.command.set-protection",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=e.get(H),{rule:s,oldRule:a}=t,{unitId:o,subUnitId:l}=s,u=[],c=[];return(null==a?void 0:a.unitType)===s.unitType?s.unitType===tI.Worksheet?(u.push({id:nw.id,params:{unitId:o,subUnitId:l,rule:s}}),c.push({id:nw.id,params:{unitId:o,subUnitId:l,rule:a}})):(u.push({id:nv.id,params:{unitId:o,subUnitId:l,rule:s,ruleId:s.id}}),c.push({id:nv.id,params:{unitId:o,subUnitId:l,ruleId:a.id,rule:a}})):(a&&(a.unitType===tI.Worksheet?(u.push({id:Q.id,params:{unitId:o,subUnitId:l}}),c.push({id:K.id,params:{unitId:o,rule:a,subUnitId:a.subUnitId}})):a.unitType===tI.SelectRange&&(u.push({id:G.id,params:{unitId:o,subUnitId:l,ruleIds:[a.id]}}),c.push({id:z.id,params:{unitId:o,subUnitId:l,rules:[a]}}))),s.unitType===tI.Worksheet?(u.push({id:K.id,params:{unitId:o,rule:s,subUnitId:s.subUnitId}}),c.unshift({id:Q.id,params:{unitId:o,subUnitId:l}})):s.unitType===tI.SelectRange&&(s.id=i.createRuleId(o,l),u.push({id:z.id,params:{unitId:o,subUnitId:l,rules:[s]}}),c.unshift({id:G.id,params:{unitId:o,subUnitId:l,ruleIds:[s.id]}}))),(0,R.sequenceExecute)(u,r)&&n.pushUndoRedo({unitID:o,undoMutations:c,redoMutations:u}),!0}},nO=(e,t)=>{let{unitId:r,subUnitId:n,rowData:i}=e,s={},a=t.getRowManager();for(let e in i){let t=i[e],r=a.getRow(Number(e));s[e]=function(e,t){if(null==e)return e;let r=R.Tools.deepClone(e);if(null==t)return r;let n={};return"h"in t&&(n.h=r.h),"ia"in t&&(n.ia=r.ia),"ah"in t&&(n.ah=r.ah),"hd"in t&&(n.hd=r.hd),"s"in t&&(n.s=r.s),"custom"in t&&(n.custom=r.custom),n}(r,t)}return{unitId:r,subUnitId:n,rowData:s}},nx={id:"sheet.mutation.set-row-data",type:R.CommandType.MUTATION,handler:(e,t)=>{let{rowData:r}=t,n=eN(e.get(R.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getRowManager();for(let e in r){let t=r[e];if(null==t){s.removeRow(Number(e));continue}Object.assign(s.getRowOrCreate(Number(e)),t)}return!0}},nU={type:R.CommandType.COMMAND,id:"sheet.command.set-row-data",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService),t);if(!i)return!1;let{rowData:s}=t,{unitId:a,subUnitId:o,worksheet:l}=i,u={subUnitId:o,unitId:a,rowData:s},c=nO(u,l);return!!r.syncExecuteCommand(nx.id,u)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:nx.id,params:c}],redoMutations:[{id:nx.id,params:u}]}),!0)}},nD=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},nV={id:"sheet.mutation.set-row-visible",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=0)}}return!0}},nL=(e,t)=>{if(null==e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId))throw Error("universheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,ranges:t.ranges}},nP={id:"sheet.mutation.set-row-hidden",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)throw Error("universheet is null error!");let n=r.getSheetBySheetId(t.subUnitId).getRowManager();for(let e=0;e<t.ranges.length;e++){let r=t.ranges[e];for(let e=r.startRow;e<r.endRow+1;e++){let t=n.getRowOrCreate(e);null!=t&&(t.hd=1)}}return!0}},nF={type:R.CommandType.COMMAND,id:"sheet.command.set-specific-rows-visible",handler:(e,t)=>{var r,n,i;let{unitId:s,subUnitId:a,ranges:o}=t,l=e.get(R.ICommandService),u=e.get(R.IUndoRedoService),c=e.get(eo),h=eN(e.get(R.IUniverInstanceService),{unitId:s,subUnitId:a});if(!h)return!1;let{worksheet:d}=h,m={unitId:s,subUnitId:a,ranges:o},g={unitId:s,subUnitId:a,reveal:!0,selections:o.map(e=>({range:e,primary:to(e,d),style:null}))},f=nD(e,m),p={unitId:s,subUnitId:a,selections:nB(o).map(e=>({range:e,primary:to(e,d),style:null}))},C=(0,R.sequenceExecute)([{id:nV.id,params:m},{id:tp.id,params:g}],l),_=c.onCommandExecute({id:nF.id,params:t}),y=(0,R.sequenceExecute)([..._.redos],l);return C.result&&y.result&&u.pushUndoRedo({unitID:s,undoMutations:[...null!=(r=_.preUndos)?r:[],{id:nP.id,params:f},{id:tp.id,params:p},...null!=(n=_.undos)?n:[]],redoMutations:[...null!=(i=_.preRedos)?i:[],{id:nV.id,params:m},{id:tp.id,params:g},..._.redos]}),!0}},nk={type:R.CommandType.COMMAND,id:"sheet.command.set-selected-rows-visible",handler:async e=>{var t;let r=e.get(e1),n=e.get(R.IUniverInstanceService),i=e.get(R.ICommandService),s=null==(t=r.getCurrentSelections())?void 0:t.map(e=>e.range).filter(e=>e.rangeType===R.RANGE_TYPE.ROW);if(!(null!=s&&s.length))return!1;let a=eN(n);if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,c=s.map(e=>o.getHiddenRows(e.startRow,e.endRow)).flat();return i.executeCommand(nF.id,{unitId:l,subUnitId:u,ranges:c})}},nj={type:R.CommandType.COMMAND,id:"sheet.command.set-rows-hidden",handler:(e,t)=>{var r,n,i,s,a,o;let l=e.get(e1),u=e.get(R.ICommandService),c=e.get(R.IUndoRedoService),h=e.get(R.IUniverInstanceService),d=e.get(eo),m=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=l.getCurrentSelections())?void 0:n.map(e=>e.range).filter(e=>e.rangeType===R.RANGE_TYPE.ROW);if(!(null!=m&&m.length))return!1;let g=eN(h,t);if(!g)return!1;m=function(e,t){let r=e.getMaxColumns()-1,n=e.getHiddenRows(),i=[];return t.forEach(e=>{let t=n.filter(t=>t.startRow>=e.startRow&&t.endRow<=e.endRow);if(t.length){let n=e.startRow;t.forEach(e=>{e.startRow>n&&(i.push({startRow:n,endRow:e.startRow-1,startColumn:0,endColumn:r}),n=e.endRow+1)}),n<=e.endRow&&i.push({startRow:n,endRow:e.endRow,startColumn:0,endColumn:r})}else i.push(e)}),i}(g.worksheet,m);let{unitId:f,subUnitId:p,worksheet:C}=g,_={unitId:f,subUnitId:p,ranges:m},y={unitId:f,subUnitId:p,selections:nB(m).map(e=>({range:e,primary:to(e,C),style:null}))},E=nL(e,_),b={unitId:f,subUnitId:p,reveal:!0,selections:m.map(e=>({range:e,primary:to(e,C),style:null}))},I=d.onCommandExecute({id:nj.id,params:_});return(0,R.sequenceExecute)([...null!=(i=I.preRedos)?i:[],{id:nP.id,params:_},{id:tp.id,params:y},...I.redos],u).result&&c.pushUndoRedo({unitID:f,undoMutations:[...null!=(s=I.preUndos)?s:[],{id:nV.id,params:E},{id:tp.id,params:b},...null!=(a=I.undos)?a:[]],redoMutations:[...null!=(o=I.preRedos)?o:[],{id:nP.id,params:_},{id:tp.id,params:y},...I.redos]}),!0}};function nB(e){return(function(e){let t,r=[];return e.sort((e,t)=>e.startRow-t.startRow).forEach(e=>{if(!t){t=e;return}e.startRow===t.endRow+1?t.endRow=e.endRow:(r.push(t),t=e)}),r.push(t),r})(e).map(e=>{let t=0===e.startRow?e.endRow+1:e.startRow-1;return{...e,startRow:t,endRow:t}})}let n$={type:R.CommandType.COMMAND,id:"sheet.command.set-style",handler:(e,t)=>{var r;let n=eN(e.get(R.IUniverInstanceService),t);if(!n)return!1;let{unitId:i,subUnitId:s,worksheet:a}=n,{range:o,style:l}=t,u=e.get(R.ICommandService),c=e.get(R.IUndoRedoService),h=e.get(e1),d=o?[o]:null==(r=h.getCurrentSelections())?void 0:r.map(e=>e.range);if(!(null!=d&&d.length))return!1;let m=new(0,R.ObjectMatrix),g={forOperableEach:function(e,t){for(let r=e.startRow;r<=e.endRow;r++)if(!a.getRowFiltered(r))for(let n=e.startColumn;n<=e.endColumn;n++)t(r,n,e)}};if(R.Tools.isArray(l.value))for(let e=0;e<d.length;e++)g.forOperableEach(d[e],(e,t,r)=>{m.setValue(e,t,{s:{[l.type]:l.value[e-r.startRow][t-r.startColumn]}})});else for(let e=0;e<d.length;e++){let t={s:{[l.type]:l.value}};g.forOperableEach(d[e],(e,r)=>m.setValue(e,r,t))}let f={subUnitId:s,unitId:i,cellValue:m.getMatrix()},p=eH(e,f),C=u.syncExecuteCommand(eW.id,f),{undos:_,redos:y}=e.get(eo).onCommandExecute({id:n$.id,params:t}),E=(0,R.sequenceExecute)([...y],u);return!!C&&!!E.result&&(c.pushUndoRedo({unitID:f.unitId,undoMutations:[{id:eW.id,params:p},..._],redoMutations:[{id:eW.id,params:f},...y]}),!0)}},nH={type:R.CommandType.COMMAND,id:"sheet.command.set-bold",handler:e=>{let t=e.get(e1).getCurrentLastSelection();if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,{actualRow:i,actualColumn:s}=t.primary,a={style:{type:"bl",value:n.getRange(i,s).getFontWeight()===R.FontWeight.BOLD?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE}};return e.get(R.ICommandService).syncExecuteCommand(n$.id,a)}},nW={type:R.CommandType.COMMAND,id:"sheet.command.set-italic",handler:e=>{let t=e.get(e1).getCurrentLastSelection();if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;if(t.primary){let{startRow:e,startColumn:r}=t.primary;i=n.getRange(e,r).getFontStyle()===R.FontItalic.ITALIC}let s={style:{type:"it",value:i?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE}};return e.get(R.ICommandService).syncExecuteCommand(n$.id,s)}},nG={type:R.CommandType.COMMAND,id:"sheet.command.set-underline",handler:e=>{let t=e.get(e1).getCurrentLastSelection();if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.startRow,t.primary.startColumn).getUnderline().s);let s={style:{type:"ul",value:{s:i?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE}}};return e.get(R.ICommandService).syncExecuteCommand(n$.id,s)}},nY={type:R.CommandType.COMMAND,id:"sheet.command.set-stroke",handler:e=>{let t=e.get(e1).getCurrentLastSelection();if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.actualRow,t.primary.actualColumn).getStrikeThrough().s);let s={style:{type:"st",value:{s:i?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE}}};return e.get(R.ICommandService).syncExecuteCommand(n$.id,s)}},nz={type:R.CommandType.COMMAND,id:"sheet.command.set-overline",handler:e=>{let t=e.get(e1).getCurrentLastSelection();if(!t)return!1;let r=eN(e.get(R.IUniverInstanceService));if(!r)return!1;let{worksheet:n}=r,i=!0;t.primary&&(i=!!n.getRange(t.primary.startRow,t.primary.startColumn).getOverline().s);let s={style:{type:"ol",value:{s:i?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE}}};return e.get(R.ICommandService).syncExecuteCommand(n$.id,s)}},nX={type:R.CommandType.COMMAND,id:"sheet.command.set-font-family",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={style:{type:"ff",value:t.value}};return r.syncExecuteCommand(n$.id,n)}},nq={type:R.CommandType.COMMAND,id:"sheet.command.set-font-size",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={style:{type:"fs",value:t.value}};return r.syncExecuteCommand(n$.id,n)}},nK={type:R.CommandType.COMMAND,id:"sheet.command.set-text-color",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={style:{type:"cl",value:{rgb:t.value}}};return r.syncExecuteCommand(n$.id,n)}},nQ={type:R.CommandType.COMMAND,id:"sheet.command.reset-text-color",handler:e=>e.get(R.ICommandService).syncExecuteCommand(n$.id,{style:{type:"cl",value:{rgb:null}}})},nZ={type:R.CommandType.COMMAND,id:"sheet.command.set-background-color",handler:(e,t)=>{if(!t||!t.value)return!1;let r=e.get(R.ICommandService),n={style:{type:"bg",value:{rgb:t.value}}};return r.syncExecuteCommand(n$.id,n)}},nJ={type:R.CommandType.COMMAND,id:"sheet.command.reset-background-color",handler:e=>e.get(R.ICommandService).syncExecuteCommand(n$.id,{style:{type:"bg",value:{rgb:null}}})},n0={type:R.CommandType.COMMAND,id:"sheet.command.set-vertical-text-align",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"vt",value:t.value}};return r.syncExecuteCommand(n$.id,n)}},n1={type:R.CommandType.COMMAND,id:"sheet.command.set-horizontal-text-align",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"ht",value:t.value}};return r.syncExecuteCommand(n$.id,n)}},n2={type:R.CommandType.COMMAND,id:"sheet.command.set-text-wrap",handler:(e,t)=>{if(!t)return!1;let r=e.get(R.ICommandService),n={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tb",value:t.value}};return r.syncExecuteCommand(n$.id,n)}},n5={type:R.CommandType.COMMAND,id:"sheet.command.set-text-rotation",handler:(e,t)=>{if(!t)return!1;let r="number"==typeof t.value?{a:t.value}:{a:0,v:R.BooleanNumber.TRUE},n=e.get(R.ICommandService),i={unitId:t.unitId,subUnitId:t.subUnitId,range:t.range,style:{type:"tr",value:r}};return n.syncExecuteCommand(n$.id,i)}},n3=(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().tabColor;return{...R.Tools.deepClone(t),color:r}},n4={id:"sheet.mutation.set-tab-color",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().tabColor=t.color,!0)}},n6={type:R.CommandType.COMMAND,id:"sheet.command.set-tab-color",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{unitId:s,subUnitId:a}=i,o={color:t.value,unitId:s,subUnitId:a},l=n3(e,o);return!!r.syncExecuteCommand(n4.id,o)&&(n.pushUndoRedo({unitID:s,undoMutations:[{id:n4.id,params:l}],redoMutations:[{id:n4.id,params:o}]}),!0)}},n9={id:"sheet.mutation.set-workbook-name",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUnit(t.unitId,R.UniverInstanceType.UNIVER_SHEET);return!!r&&(r.setName(t.name),!0)}},n8={type:R.CommandType.COMMAND,id:"sheet.command.set-workbook-name",handler:async(e,t)=>{var r;if(!e.get(R.IUniverInstanceService).getUnit(t.unitId,R.UniverInstanceType.UNIVER_SHEET))return!1;let n=e.get(eo).onCommandExecute({id:n8.id,params:t}),i={name:t.name,unitId:t.unitId},s=[...null!=(r=n.preRedos)?r:[],{id:n9.id,params:i},...n.redos],a=e.get(R.ICommandService);return(0,R.sequenceExecute)(s,a).result}},n7={id:"sheet.operation.set-worksheet-active",type:R.CommandType.OPERATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;for(let[,e]of r.getWorksheets())if(e.getSheetId()===t.subUnitId)return r.setActiveSheet(e),!0;return!1}},ie={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-activate",handler:(e,t,r)=>{let n=e.get(R.ICommandService),i=eN(e.get(R.IUniverInstanceService),t);if(!i)return!1;let{unitId:s,subUnitId:a}=i;return new Promise(e=>{setTimeout(()=>{e(n.syncExecuteCommand(n7.id,{unitId:s,subUnitId:a},r))},4)})}},it=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getColumnManager();for(let e=0;e<i.length;e++){let t=i[e];for(let e=t.startColumn;e<t.endColumn+1;e++){let t=a.getColumnOrCreate(e);s[e]=t.w}}return{unitId:r,subUnitId:n,ranges:i,colWidth:s}},ir={id:"sheet.mutation.set-worksheet-col-width",type:R.CommandType.MUTATION,handler:(e,t)=>{var r;let n=eN(e.get(R.IUniverInstanceService),t);if(!n)return!1;let{worksheet:i}=n,s=i.getConfig().defaultColumnWidth,a=i.getColumnManager(),o=t.ranges;for(let e=0;e<o.length;e++){let n=o[e];for(let e=n.startColumn;e<n.endColumn+1;e++){if(!i.getColVisible(e))continue;let n=a.getColumnOrCreate(e);"number"==typeof t.colWidth?n.w=t.colWidth:n.w=null!=(r=t.colWidth[e])?r:s}}return!0}},ii={type:R.CommandType.COMMAND,id:"sheet.command.delta-column-width",handler:async(e,t)=>{let r,n=e.get(e1).getCurrentSelections();if(!(null!=n&&n.length))return!1;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=eN(e.get(R.IUniverInstanceService));if(!a)return!1;let{worksheet:o,unitId:l,subUnitId:u}=a,{anchorCol:c,deltaX:h}=t,d=o.getColumnWidth(c)+h,m=1===n.length&&n[0].range.rangeType===R.RANGE_TYPE.ALL,g=n.filter(e=>e.range.rangeType===R.RANGE_TYPE.COLUMN),f=m?R.RANGE_TYPE.ALL:g.some(({range:e})=>{let{startColumn:t,endColumn:r}=e;return t<=c&&c<=r})?R.RANGE_TYPE.COLUMN:R.RANGE_TYPE.NORMAL;if(f===R.RANGE_TYPE.ALL){let e=o.getRowCount();r={subUnitId:u,unitId:l,colWidth:d,ranges:Array(o.getColumnCount()).fill(void 0).map((t,r)=>({startRow:0,endRow:e-1,startColumn:r,endColumn:r}))}}else r=f===R.RANGE_TYPE.COLUMN?{subUnitId:u,unitId:l,ranges:g.map(e=>R.Rectangle.clone(e.range)),colWidth:d}:{subUnitId:u,unitId:l,colWidth:d,ranges:[{startRow:0,endRow:o.getMaxRows()-1,startColumn:c,endColumn:c}]};let{undos:p,redos:C}=e.get(eo).onCommandExecute({id:ii.id,params:r}),_=it(r,o),y=i.syncExecuteCommand(ir.id,r),E=(0,R.sequenceExecute)([...C],i);return y&&E.result&&s.pushUndoRedo({unitID:l,undoMutations:[{id:ir.id,params:_},...p],redoMutations:[{id:ir.id,params:r},...C]}),!0}},is={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-col-width",handler:(e,t)=>{var r,n,i,s;let a=e.get(e1),o=e.get(R.ICommandService),l=e.get(R.IUndoRedoService),u=e.get(eo),c=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=c&&c.length))return!1;let h=eN(e.get(R.IUniverInstanceService),t);if(!h)return!1;let{subUnitId:d,unitId:m,worksheet:g}=h,f={subUnitId:d,unitId:m,ranges:c,colWidth:t.value},p=it(f,g),C=o.syncExecuteCommand(ir.id,f),{undos:_,redos:y}=e.get(eo).onCommandExecute({id:is.id,params:f}),E=u.onCommandExecute({id:is.id,params:f}),b=(0,R.sequenceExecute)([...y,...E.redos],o);return!!C&&!!b.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=E.preUndos)?i:[],{id:ir.id,params:p},..._],redoMutations:[...null!=(s=E.preRedos)?s:[],{id:ir.id,params:f},...y]}),!0)}};R.CommandType.COMMAND;let ia=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetColumnCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,columnCount:r.worksheet.getColumnCount()}},io={id:"sheet.mutation.set-worksheet-column-count",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);return!!r&&(r.worksheet.setColumnCount(t.columnCount),!0)}},il={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-column-count",handler:(e,t)=>{let{unitId:r,subUnitId:n,columnCount:i}=t,s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService);if(!eN(e.get(R.IUniverInstanceService),t))return!1;let o={unitId:r,subUnitId:n,columnCount:i},l=ia(e,o);return!!s.syncExecuteCommand(io.id,o)&&(a.pushUndoRedo({unitID:r,undoMutations:[{id:io.id,params:l}],redoMutations:[{id:io.id,params:o}]}),!0)}},iu={id:"sheet.mutation.set-worksheet-default-style",type:R.CommandType.MUTATION,handler:(e,t)=>{let{defaultStyle:r}=t,n=eN(e.get(R.IUniverInstanceService));if(!n)return!1;let{worksheet:i}=n;return!!i&&(i.setDefaultCellStyle(r),!0)}},ic=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetDefaultStyleMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,subUnitId:n.getSheetId(),defaultStyle:n.getDefaultCellStyle()}},ih={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-default-style",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{unitId:i}=t,s=ic(e,t);return!!r.syncExecuteCommand(iu.id,t)&&(n.pushUndoRedo({unitID:i,undoMutations:[{id:iu.id,params:s}],redoMutations:[{id:iu.id,params:t}]}),!0)}},id=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetHideMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{hidden:n.isSheetHidden(),unitId:t.unitId,subUnitId:n.getSheetId()}},im={id:"sheet.mutation.set-worksheet-hidden",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().hidden=t.hidden,!0)}},ig={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-hidden",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=e.get(R.ErrorService),s=e.get(R.LocaleService),a=eN(e.get(R.IUniverInstanceService),t);if(!a)return!1;let{workbook:o,worksheet:l,unitId:u,subUnitId:c}=a;if(l.getConfig().hidden===R.BooleanNumber.TRUE)return!1;let h={unitId:u,subUnitId:c,hidden:R.BooleanNumber.TRUE},d=id(e,h);return 1===o.getSheets().filter(e=>e.getConfig().hidden===R.BooleanNumber.FALSE).length?(i.emit(s.t("sheets.info.hideSheet")),!1):!!r.syncExecuteCommand(im.id,h)&&(n.pushUndoRedo({unitID:u,undoMutations:[{id:im.id,params:d}],redoMutations:[{id:im.id,params:h}]}),!0)}},ip=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetNameMutationFactory]: worksheet is null error!");let{worksheet:n}=r;return{unitId:t.unitId,name:n.getName(),subUnitId:n.getSheetId()}},iC={id:"sheet.mutation.set-worksheet-name",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(null==r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().name=t.name,!0)}},i_={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-name",handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(eo),o=eN(e.get(R.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u}=o,c={subUnitId:u,name:t.name,unitId:l},h=ip(e,c),d=a.onCommandExecute({id:i_.id,params:t}),m=[...null!=(r=d.preRedos)?r:[],{id:iC.id,params:c},...d.redos],g=[...null!=(n=d.preUndos)?n:[],{id:iC.id,params:h},...d.undos];return!!(0,R.sequenceExecute)(m,i).result&&(s.pushUndoRedo({unitID:l,undoMutations:g,redoMutations:m}),!0)}},iy=(e,t)=>({...R.Tools.deepClone(t),toOrder:t.fromOrder,fromOrder:t.toOrder}),iE={id:"sheet.mutation.set-worksheet-order",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getConfig();return n.sheetOrder.splice(t.fromOrder,1),n.sheetOrder.splice(t.toOrder,0,t.subUnitId),!0}},iR={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-order",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService),t);if(!i)return!1;let{workbook:s,unitId:a,subUnitId:o}=i,l={fromOrder:s.getConfig().sheetOrder.indexOf(o),toOrder:t.order,unitId:a,subUnitId:o},u=iy(e,l);return!!r.syncExecuteCommand(iE.id,l)&&(n.pushUndoRedo({unitID:a,undoMutations:[{id:iE.id,params:u}],redoMutations:[{id:iE.id,params:l}]}),!0)}};class ib{constructor(){j(this,"_model",new Map),j(this,"_pointChange",new(0,D.Subject)),j(this,"pointChange$",this._pointChange.asObservable())}addRule(e){this._ensureSubUnitMap(e.unitId).set(e.subUnitId,e),this._pointChange.next(e)}deleteRule(e,t){var r,n,i;let s=null==(r=this._model.get(e))?void 0:r.get(t);s&&(null==(i=null==(n=this._model)?void 0:n.get(e))||i.delete(t),this._pointChange.next(s))}getRule(e,t){var r,n;return null==(n=null==(r=this._model)?void 0:r.get(e))?void 0:n.get(t)}toObject(){let e={};return[...this._model.keys()].forEach(t=>{let r=this._model.get(t);null!=r&&r.size&&(e[t]=[],[...r.keys()].forEach(n=>{let i=r.get(n);i&&e[t].push(i)}))}),e}fromObject(e){let t=new Map;Object.keys(e).forEach(r=>{let n=e[r];if(null!=n&&n.length){let e=new Map;n.forEach(t=>{e.set(t.subUnitId,t)}),t.set(r,e)}}),this._model=t}deleteUnitModel(e){this._model.delete(e)}_ensureSubUnitMap(e){let t=this._model.get(e);return t||(t=new Map,this._model.set(e,t)),t}getTargetByPermissionId(e,t){let r=this._model.get(e);if(!r)return null;for(let[n,i]of r)if(i.permissionId===t)return[e,n]}}class iI{constructor(e,t,r){j(this,"type",tI.SelectRange),j(this,"subType",tb.Delete),j(this,"status",R.PermissionStatus.INIT),j(this,"value",!0),j(this,"id"),j(this,"unitId"),j(this,"subUnitId"),j(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${tI.SelectRange}.${tb.Delete}.${r}`}}class iN{constructor(e,t,r){j(this,"type",tI.SelectRange),j(this,"subType",tb.ManageCollaborator),j(this,"status",R.PermissionStatus.INIT),j(this,"value",!0),j(this,"id"),j(this,"unitId"),j(this,"subUnitId"),j(this,"permissionId"),this.unitId=e,this.subUnitId=t,this.permissionId=r,this.id=`${tI.SelectRange}.${tb.ManageCollaborator}.${r}`}}let iS=()=>[tS,tN,iN,iI],iA=[tb.Edit,tb.View,tb.ManageCollaborator,tb.Delete],iv=(e="unitId",t="subUnitId",r="permissionId")=>iS().reduce((n,i)=>{let s=new i(e,t,r);return n[s.subType]=s.value,n},{}),iT=()=>[tU,tk,tA,tH,tv,tD,tP,tM,tO,tB,tV,tx,t$,tF,tT,tW,tj,tw],iw=[tb.Edit,tb.Print,tb.Comment,tb.View,tb.Copy,tb.Export,tb.ManageCollaborator,tb.CreateSheet,tb.DeleteSheet,tb.RenameSheet,tb.HideSheet,tb.Duplicate,tb.Share,tb.MoveSheet,tb.CopySheet,tb.RecoverHistory,tb.ViewHistory,tb.CreatePermissionObject],iM=()=>[tq,re,t1,tz],iO=()=>[tG,tY,tX,tK,tQ,tZ,t0,tJ,t2,t4,t6,t9,t8,t7],ix=[tb.Copy,tb.DeleteColumn,tb.DeleteRow,tb.EditExtraObject,tb.Filter,tb.InsertColumn,tb.InsertRow,tb.InsertHyperlink,tb.PivotTable,tb.SetCellStyle,tb.SetCellValue,tb.SetColumnStyle,tb.SetRowStyle,tb.Sort];var iU=Object.getOwnPropertyDescriptor,iD=(e,t)=>(r,n)=>t(r,n,e);let iV=class extends R.RxDisposable{constructor(e,t,r,n,i,s,a,o){super(),this._permissionService=e,this._univerInstanceService=t,this._injector=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointRuleModel=i,this._resourceManagerService=s,this._rangeProtectionRuleModel=a,this._logService=o,this._init(),this._initRuleChange(),this._initRuleSnapshot(),this._initPointSnapshot()}_init(){let e=e=>{let t=e.getUnitId(),r=e=>{let r=e.getSheetId();[...iM(),...iO()].forEach(e=>{let n=new e(t,r);this._permissionService.addPermissionPoint(n)}),this._logService.debug("[WorksheetPermissionService]","Initialization completed",t,r)};e.getSheets().forEach(e=>{r(e)}),e.sheetCreated$.subscribe(e=>{r(e)}),e.sheetDisposed$.subscribe(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...iS()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...iM(),...iO()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})})};this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this._univerInstanceService.getTypeOfUnitAdded$(R.UniverInstanceType.UNIVER_SHEET).pipe((0,L.takeUntil)(this.dispose$)).subscribe(e),this._univerInstanceService.getTypeOfUnitDisposed$(R.UniverInstanceType.UNIVER_SHEET).pipe((0,L.takeUntil)(this.dispose$)).subscribe(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();iM().forEach(e=>{let t=new e(r,n);this._permissionService.deletePermissionPoint(t.id)})})})}_initRuleChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":break;case"delete":iM().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,!0)});break;case"set":iM().forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,e.rule)})}}))}_initRuleSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:()=>JSON.stringify(this._worksheetProtectionRuleModel.toObject()),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_PLUGIN",businesses:[tR.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionRuleModel.fromObject(t),Object.keys(t).forEach(t=>{iM().forEach(r=>{let n=new r(e,t);n.value=!1,this._permissionService.addPermissionPoint(n)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)},onUnLoad:e=>{let t=this._univerInstanceService.getUnit(e);t&&(t.getSheets().forEach(t=>{let r=t.getSheetId();[...iM(),...iO()].forEach(t=>{let n=new t(e,r);this._permissionService.deletePermissionPoint(n.id)})}),iT().forEach(t=>{let r=new t(e);this._permissionService.deletePermissionPoint(r.id)})),this._worksheetProtectionRuleModel.deleteUnitModel(e)}}))}_initPointSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:()=>JSON.stringify(this._worksheetProtectionPointRuleModel.toObject()),parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_WORKSHEET_PROTECTION_POINT_PLUGIN",businesses:[tR.UNIVER_SHEET],onLoad:(e,t)=>{this._worksheetProtectionPointRuleModel.fromObject(t),Object.keys(t).forEach(t=>{iO().forEach(r=>{let n=new r(e,t);this._permissionService.addPermissionPoint(n)})})},onUnLoad:e=>{this._worksheetProtectionPointRuleModel.deleteUnitModel(e)}}))}};iV=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iU(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([iD(0,(0,b.Inject)(R.IPermissionService)),iD(1,(0,b.Inject)(R.IUniverInstanceService)),iD(2,(0,b.Inject)(b.Injector)),iD(3,(0,b.Inject)(q)),iD(4,(0,b.Inject)(ib)),iD(5,(0,b.Inject)(R.IResourceManagerService)),iD(6,(0,b.Inject)(H)),iD(7,(0,b.Inject)(R.ILogService))],iV);let iL={id:"sheet.mutation.set-worksheet-permission-points",type:R.CommandType.MUTATION,handler:(e,t)=>{let{rule:r}=t;return e.get(ib).addRule(r),!0}},iP={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-permission-points",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),{rule:n}=t;return r.executeCommand(iL.id,{rule:n,unitId:n.unitId,subUnitId:n.subUnitId}),!0}},iF={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-protection",async handler(e,t){if(!t)return!1;let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),{rule:i,permissionId:s,oldRule:a}=t,{unitId:o,subUnitId:l}=i,u={...i,permissionId:s};if(await r.executeCommand(nw.id,{unitId:o,subUnitId:l,newRule:u})){let e=[{id:nw.id,params:{unitId:o,subUnitId:l,newRule:u}}],t=[{id:nw.id,params:{unitId:o,subUnitId:l,rule:a}}];n.pushUndoRedo({unitID:o,redoMutations:e,undoMutations:t})}return!0}},ik=(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);if(!r)throw Error("[SetWorksheetRowCountUndoMutationFactory]: worksheet is null error!");return{unitId:t.unitId,subUnitId:t.subUnitId,rowCount:r.worksheet.getRowCount()}},ij={id:"sheet.mutation.set-worksheet-row-count",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=eS(e.get(R.IUniverInstanceService),t);return!!r&&(r.worksheet.setRowCount(t.rowCount),!0)}},iB={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-row-count",handler:(e,t)=>{let{unitId:r,subUnitId:n,rowCount:i}=t,s=e.get(R.ICommandService),a=e.get(R.IUndoRedoService);if(!eN(e.get(R.IUniverInstanceService),t))return!1;let o={unitId:r,subUnitId:n,rowCount:i},l=ik(e,o);return!!s.syncExecuteCommand(ij.id,o)&&(a.pushUndoRedo({unitID:r,undoMutations:[{id:ij.id,params:l}],redoMutations:[{id:ij.id,params:o}]}),!0)}},i$=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getRowManager();for(let{startRow:e,endRow:t}of i)for(let r=e;r<t+1;r++){let e=a.getRowOrCreate(r);s[r]=e.h}return{unitId:r,subUnitId:n,ranges:i,rowHeight:s}},iH=(e,t)=>{let{unitId:r,subUnitId:n,ranges:i}=e,s={},a=t.getRowManager();for(let{startRow:e,endRow:t}of i)for(let r=e;r<=t;r++){let e=a.getRowOrCreate(r);s[r]=e.ia}return{unitId:r,subUnitId:n,ranges:i,autoHeightInfo:s}},iW=(e,t)=>{let{unitId:r,subUnitId:n,rowsAutoHeightInfo:i}=e,s=[],a=t.getRowManager();for(let e of i){let{row:t}=e,{ah:r}=a.getRowOrCreate(t);s.push({row:t,autoHeight:r})}return{unitId:r,subUnitId:n,rowsAutoHeightInfo:s}},iG={id:"sheet.mutation.set-worksheet-row-height",type:R.CommandType.MUTATION,handler:(e,t)=>{var r;let{ranges:n,rowHeight:i}=t,s=eN(e.get(R.IUniverInstanceService),t);if(!s)return!1;let{worksheet:a}=s,o=a.getRowManager(),l=a.getConfig().defaultRowHeight;for(let{startRow:e,endRow:t}of n)for(let n=e;n<=t;n++){let e=o.getRowOrCreate(n);"number"==typeof i?e.h=i:e.h=null!=(r=i[n])?r:l,e.h=Math.min(2e3,e.h)}return!0}},iY={id:"sheet.mutation.set-worksheet-row-is-auto-height",type:R.CommandType.MUTATION,handler:(e,t)=>{var r;let{ranges:n,autoHeightInfo:i}=t,s=eN(e.get(R.IUniverInstanceService),t);if(!s)return!1;let a=s.worksheet.getRowManager();for(let{startRow:e,endRow:t}of n)for(let n=e;n<=t;n++){let e=a.getRowOrCreate(n);"number"==typeof i?e.ia=i:e.ia=null!=(r=i[n])?r:void 0}return!0}},iz={id:"sheet.mutation.set-worksheet-row-auto-height",type:R.CommandType.MUTATION,handler:(e,t)=>{let{rowsAutoHeightInfo:r}=t,n=eN(e.get(R.IUniverInstanceService),t);if(!n)return!1;let i=n.worksheet.getRowManager();for(let{row:e,autoHeight:t}of r)i.getRowOrCreate(e).ah=t;return!0}},iX={type:R.CommandType.COMMAND,id:"sheet.command.delta-row-height",handler:async(e,t)=>{var r,n;let i,s=e.get(e1).getCurrentSelections(),a=e.get(eo);if(!(null!=s&&s.length))return!1;let o=eN(e.get(R.IUniverInstanceService));if(!o)return!1;let{worksheet:l,subUnitId:u,unitId:c}=o,{anchorRow:h,deltaY:d}=t,m=l.getRowHeight(h)+d,g=1===s.length&&s[0].range.rangeType===R.RANGE_TYPE.ALL,f=s.filter(e=>e.range.rangeType===R.RANGE_TYPE.ROW),p=g?R.RANGE_TYPE.ALL:f.some(({range:e})=>{let{startRow:t,endRow:r}=e;return t<=h&&h<=r})?R.RANGE_TYPE.ROW:R.RANGE_TYPE.NORMAL;if(p===R.RANGE_TYPE.ALL){let e=l.getColumnCount();i={subUnitId:u,unitId:c,rowHeight:m,ranges:Array(l.getRowCount()).fill(void 0).map((t,r)=>({startRow:r,endRow:r,startColumn:0,endColumn:e-1}))}}else i=p===R.RANGE_TYPE.ROW?{subUnitId:u,unitId:c,ranges:f.map(e=>R.Rectangle.clone(e.range)),rowHeight:m}:{subUnitId:u,unitId:c,rowHeight:m,ranges:[{startRow:h,endRow:h,startColumn:0,endColumn:l.getMaxColumns()-1}]};let C=i$(i,l),_={unitId:c,subUnitId:u,ranges:i.ranges,autoHeightInfo:R.BooleanNumber.FALSE},y=iH(_,l),E=e.get(R.ICommandService),b=e.get(R.IUndoRedoService),I=a.onCommandExecute({id:iX.id,params:i}),N=(0,R.sequenceExecute)([{id:iG.id,params:i},{id:iY.id,params:_}],E),S=(0,R.sequenceExecute)([...I.redos],E);return!!N.result&&!!S.result&&(b.pushUndoRedo({unitID:c,undoMutations:[...null!=(r=I.preUndos)?r:[],{id:iG.id,params:C},{id:iY.id,params:y},...I.undos],redoMutations:[...null!=(n=I.preRedos)?n:[],{id:iG.id,params:i},{id:iY.id,params:_},...I.redos]}),!0)}},iq={type:R.CommandType.COMMAND,id:"sheet.command.set-row-height",handler:(e,t)=>{var r,n,i,s;let a=e.get(e1),o=e.get(R.ICommandService),l=e.get(R.IUndoRedoService),u=e.get(R.IUniverInstanceService),c=e.get(eo),h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d=eN(u,t);if(!d)return!1;let{unitId:m,subUnitId:g,worksheet:f}=d,p={subUnitId:g,unitId:m,ranges:h,rowHeight:t.value},C=i$(p,f),_={unitId:m,subUnitId:g,ranges:p.ranges,autoHeightInfo:R.BooleanNumber.FALSE},y=iH(_,f),E=(0,R.sequenceExecute)([{id:iG.id,params:p},{id:iY.id,params:_}],o),b=c.onCommandExecute({id:iq.id,params:p}),I=(0,R.sequenceExecute)([...b.redos],o);return!!E.result&&!!I.result&&(l.pushUndoRedo({unitID:m,undoMutations:[...null!=(i=b.preRedos)?i:[],{id:iG.id,params:C},{id:iY.id,params:y},...b.undos],redoMutations:[...null!=(s=b.preRedos)?s:[],{id:iG.id,params:p},{id:iY.id,params:_},...b.redos]}),!0)}},iK={type:R.CommandType.COMMAND,id:"sheet.command.set-row-is-auto-height",handler:(e,t)=>{var r,n;let i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(e1),o=eN(e.get(R.IUniverInstanceService),t);if(!o)return!1;let{unitId:l,subUnitId:u,worksheet:c}=o,h=null!=(r=null==t?void 0:t.ranges)&&r.length?t.ranges:null==(n=a.getCurrentSelections())?void 0:n.map(e=>e.range);if(!(null!=h&&h.length))return!1;let d={unitId:l,subUnitId:u,ranges:h,autoHeightInfo:R.BooleanNumber.TRUE},m=iH(d,c),g=i.syncExecuteCommand(iY.id,d),{undos:f,redos:p}=e.get(eo).onCommandExecute({id:iK.id,params:d}),C=(0,R.sequenceExecute)([...p],i);return!!g&&!!C.result&&(s.pushUndoRedo({unitID:l,undoMutations:[{id:iY.id,params:m},...f],redoMutations:[{id:iY.id,params:d},...p]}),!0)}},iQ={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-show",handler:(e,t)=>{let{unitId:r,subUnitId:n}=t,i=e.get(R.ICommandService),s=e.get(R.IUndoRedoService),a=e.get(R.IUniverInstanceService);if(!eN(e.get(R.IUniverInstanceService)))return!1;let o=a.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!o)return!1;let l=o.getSheetBySheetId(n);if(!l||l.getConfig().hidden===R.BooleanNumber.FALSE)return!1;let u={unitId:r,subUnitId:n,hidden:R.BooleanNumber.FALSE},c=id(e,u),h=i.syncExecuteCommand(im.id,u),d=i.syncExecuteCommand(n7.id,{unitId:r,subUnitId:n});return!!h&&!!d&&(s.pushUndoRedo({unitID:r,undoMutations:[{id:im.id,params:c}],redoMutations:[{id:im.id,params:u}]}),!0)}};var iZ=((g=iZ||{})[g.Tab=1]="Tab",g[g.Comma=2]="Comma",g[g.Semicolon=4]="Semicolon",g[g.Space=8]="Space",g[g.Custom=16]="Custom",g);class iJ{constructor(){j(this,"_tabCount",0),j(this,"_commaCount",0),j(this,"_semicolonCount",0),j(this,"_spaceCount",0)}add(e){switch(e){case"	":this._tabCount++;break;case",":this._commaCount++;break;case";":this._semicolonCount++;break;case" ":this._spaceCount++}}update(e){e&&"string"==typeof e&&(e.includes("	")&&this._tabCount++,e.includes(",")&&this._commaCount++,e.includes(";")&&this._semicolonCount++,e.trim().includes(" ")&&this._spaceCount++)}getDelimiter(){let e=Math.max(this._tabCount,this._commaCount,this._semicolonCount,this._spaceCount);return 0===e||e===this._tabCount?1:e===this._commaCount?2:e===this._semicolonCount?4:e===this._spaceCount?8:1}}let i0=e=>{var t;return(null==(t=e.body)?void 0:t.dataStream.replace(/\r\n$/,""))||""};function i1(e,t,r,n,i=!1){let{startColumn:s,startRow:a,endColumn:o,endRow:l}=R.Range.transformRange(t,e);if(s!==o)throw Error("The range must be in the same column.");if(r&&(16&r)>0&&(void 0===n||1!==n.length))throw Error("The custom delimiter must a character.");let u=void 0===r,c=u?new iJ:null,h=[];for(let t=a;t<=l;t++){let r=function(e){if(null!=e){if(e.p)return i0(e.p);if(e.v&&"string"==typeof e.v)return e.v;if(e.t&&(e.t===R.CellValueType.FORCE_STRING||e.t===R.CellValueType.STRING))return String(e.v)}}(e.getCell(t,s));h.push(r),c&&c.update(r)}let d=function(e,t,r){let n=[];void 0!==r&&(16&e)>0&&n.push(r),(1&e)>0&&n.push("	"),(2&e)>0&&n.push(","),(4&e)>0&&n.push(";"),(8&e)>0&&n.push(" ");let i="";for(let e of n)i+=e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");let s="[".concat(i,"]");return t&&(s+="+"),new RegExp(s)}(u?c.getDelimiter():r,i,n),m=-1,g=0,f=0,p=[];for(let e of h){if(void 0!==e){let t=String(e).split(d);m=m<0?t.length:Math.max(m,t.length),p.push(t),g=f}else p.push(void 0);f++}return{rs:p,maxLength:-1===m?0:m,lastRow:g}}let i2={type:R.CommandType.COMMAND,id:"sheet.command.split-text-to-columns",handler:(e,t)=>{let{unitId:r,subUnitId:n,range:i,delimiter:s,customDelimiter:a,treatMultipleDelimitersAsOne:o}=t,l=e.get(R.ICommandService),u=e.get(R.IUniverInstanceService),c=e.get(R.IUndoRedoService);if(!eN(e.get(R.IUniverInstanceService)))return!1;let h=u.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!h)return!1;let d=h.getSheetBySheetId(n);if(!d)return!1;let{lastRow:m,rs:g,maxLength:f}=i1(d,i,s,a,o),p=d.getColumnCount(),{startColumn:C}=R.Range.transformRange(i,d);if(i.startColumn!==i.endColumn)return!1;let _=[],y=[],E=C+f+1-p;if(E>0){let t={unitId:r,subUnitId:n,range:{startRow:0,endRow:d.getRowCount()-1,startColumn:p-1,endColumn:p-1+E}};_.push({id:eD.id,params:t});let i=eU(e,t);y.push({id:eF.id,params:i})}let b={startRow:i.startRow,endRow:m,startColumn:C,endColumn:C+f},I=new(0,R.ObjectMatrix);for(let e=b.startRow;e<=b.endRow;e++)for(let t=b.startColumn;t<=b.endColumn;t++){let r=g[e-b.startRow];0===t&&(null==r?void 0:r.length)===1?I.setValue(e,t,d.getCell(e,t)):I.setValue(e,t,{v:(null==r?void 0:r[t-b.startColumn])||null,p:null,f:null,si:null,custom:null})}let N={unitId:r,subUnitId:n,cellValue:I.clone()},S=eH(e,N);return _.push({id:eW.id,params:N}),y.unshift({id:eW.id,params:S}),!!(0,R.sequenceExecute)(_,l).result&&(c.pushUndoRedo({unitID:r,undoMutations:y,redoMutations:_}),!0)}},i5={id:"sheet.command.toggle-cell-checkbox",type:R.CommandType.COMMAND,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,row:i,col:s,paragraphIndex:a}=t,o=e.get(R.IUniverInstanceService).getUnit(r,R.UniverInstanceType.UNIVER_SHEET),l=null==o?void 0:o.getSheetBySheetId(n),u=e.get(R.IUndoRedoService),c=e.get(R.ICommandService);if(!l)return!1;let h=l.getCell(i,s);if(!(null!=h&&h.p))return!1;let d=R.Tools.deepClone(h.p),m=new(0,R.DocumentDataModel)(d),g=R.BuildTextUtils.paragraph.bullet.toggleChecklist({document:m,paragraphIndex:a});if(!g)return!1;R.TextX.apply(m.getBody(),g.serialize());let f={unitId:r,subUnitId:n,cellValue:{[i]:{[s]:{p:d,t:R.CellValueType.STRING}}}},p={id:eW.id,params:f},C=eH(e,f),_={id:eW.id,params:C},y=[p];return u.pushUndoRedo({redoMutations:y,undoMutations:[_],unitID:r}),c.syncExecuteCommand(p.id,p.params)}},i3={id:"sheet.mutation.toggle-gridlines",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=eN(e.get(R.IUniverInstanceService),t);if(!r)return!1;let{worksheet:n}=r;return n.getConfig().showGridlines=t.showGridlines,!0}},i4={type:R.CommandType.COMMAND,id:"sheet.command.toggle-gridlines",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=eN(e.get(R.IUniverInstanceService));if(!i)return!1;let{worksheet:s}=i,a=s.getConfig().showGridlines;if(a===(null==t?void 0:t.showGridlines))return!1;let{unitId:o,subUnitId:l}=i,u={showGridlines:a===R.BooleanNumber.TRUE?R.BooleanNumber.FALSE:R.BooleanNumber.TRUE,unitId:o,subUnitId:l};return!!r.syncExecuteCommand(i3.id,u)&&(n.pushUndoRedo({unitID:o,undoMutations:[{id:i3.id,params:{showGridlines:a,unitId:o,subUnitId:l}}],redoMutations:[{id:i3.id,params:u}]}),!0)}},i6={id:"sheet.command.unregister-worksheet-range-theme-style",type:R.CommandType.COMMAND,handler:(e,t)=>{var r;if(!t)return!1;let{unitId:n,themeName:i}=t,s=e.get(R.IUniverInstanceService),a=e.get(R.ICommandService),o=e.get(R.IUndoRedoService),l=e.get(eb);if(!eN(s))return!1;let u={unitId:n,themeName:i,rangeThemeStyleJson:null==(r=l.getRangeThemeStyle(n,i))?void 0:r.toJson()};return a.syncExecuteCommand(rB.id,t)&&o.pushUndoRedo({unitID:n,undoMutations:[{id:rB.id,params:u}],redoMutations:[{id:r$.id,params:{unitId:n,themeName:i}}]}),!0}},i9={id:"sheet.mutation.empty",type:R.CommandType.MUTATION,handler:()=>!0},i8=e=>{let t=new(0,R.ObjectMatrix);return e.forEach(e=>{R.Range.foreach(e,(e,r)=>{t.setValue(e,r,1)})}),t.forValue((e,r)=>{let n=t.getValue(e-1,r);n&&t.setValue(e,r,n+1)}),t},i7=e=>(e.forValue((t,r)=>{let n=e.getValue(t-1,r);n&&e.setValue(t,r,n+1)}),e),se=e=>{let t={area:0},r=(e,r)=>t.area<e&&(t.area=e,t.range=r,!0);return e.forValue((t,n,i)=>{let s=1,a=i;r(+a,{startRow:t-a+1,endRow:t,startColumn:n,endColumn:n});let o={startRow:t-a+1,endRow:t,startColumn:0,endColumn:n};for(let i=n-1;i>=0&&e.getValue(t,i);i--){let n=(a=Math.min(e.getValue(t,i)||0,a))*++s;o.startColumn=i,o.startRow=t-a+1,r(n,o)}}),t},st=(e,t)=>{R.Range.foreach(t,(t,r)=>{e.realDeleteValue(t,r)});for(let r=t.startColumn;r<=t.endColumn;r++){let n=t.endRow+1;if(e.getValue(n,r)>0){e.setValue(n,r,1);let t=n+1;for(;e.getValue(t,r)>0;)e.setValue(t,r,e.getValue(t-1,r)+1),t++}}return e},sr=e=>{let t=[],r=se(e);for(;r.area>0;)r.range&&(t.push(r.range),st(e,r.range)),r=se(e);return t},sn=e=>sr(i8(e));class si{constructor(){j(this,"_matrix",new(0,R.ObjectMatrix))}add(...e){return e.forEach(e=>{R.Range.foreach(e,(e,t)=>{this._matrix.setValue(e,t,1)})}),this}subtract(...e){return e.forEach(e=>{R.Range.foreach(e,(e,t)=>{this._matrix.realDeleteValue(e,t)})}),this}merge(){return sr(i7(this._matrix))}}let ss=(0,b.createIdentifier)("INumfmtService"),sa=(e,t)=>{let r=e.get(ss),{values:n,unitId:i,subUnitId:s}=t,a=[],o=[];Object.keys(n).forEach(e=>{n[e].ranges.forEach(e=>{R.Range.foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n?a.push({pattern:n.pattern,row:e,col:t}):o.push({startColumn:t,endColumn:t,startRow:e,endRow:e})})})});let l=[];if(a.length){let e=sc(i,s,a);Object.keys(e.values).forEach(t=>{let r=e.values[t];r.ranges=sn(r.ranges)}),l.push({id:so.id,params:sc(i,s,a)})}return o.length&&l.push({id:sl.id,params:{unitId:i,subUnitId:s,ranges:o}}),l},so={id:"sheet.mutation.set.numfmt",type:R.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{values:r,refMap:n}=t,i=e.get(ss),s=t.unitId,a=t.subUnitId,o=Object.keys(r).reduce((e,t)=>{let i=n[t],s=r[t].ranges;return i&&e.push({...i,ranges:s}),e},[]);return i.setValues(s,a,o),!0}},sl={id:"sheet.mutation.remove.numfmt",type:R.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{unitId:r,subUnitId:n,ranges:i}=t;return e.get(ss).deleteValues(r,n,i),!0}},su=(e,t)=>{let r=e.get(ss),{ranges:n,unitId:i,subUnitId:s}=t,a=[];if(n.forEach(e=>{R.Range.foreach(e,(e,t)=>{let n=r.getValue(i,s,e,t);n&&a.push({pattern:n.pattern,row:e,col:t})})}),!a.length)return[];let o=sc(i,s,a);return Object.keys(o.values).forEach(e=>{let t=o.values[e];t.ranges=sn(t.ranges)}),[{id:so.id,params:o}]},sc=(e,t,r)=>{let n=eY(r,"pattern"),i={},s={},a=ez();return Object.keys(n).forEach(e=>{let t=n[e],r=a();i[r]={pattern:e},t.forEach(e=>{s[r]||(s[r]={ranges:[]}),s[r].ranges.push((0,R.cellToRange)(e.row,e.col))})}),{unitId:e,subUnitId:t,refMap:i,values:s}},sh={id:"sheet.operation.scroll-to-cell",type:R.CommandType.OPERATION,handler:()=>!0},sd="ONLY_REGISTER_FORMULA_RELATED_MUTATIONS_KEY",sm="maxCellsPerSheet",sg={id:"sheet.mutation.set-range-theme",type:R.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{unitId:r,styleName:n,style:i}=t,s=e.get(eb).getRangeThemeStyle(r,n);return s&&(i.headerRowStyle&&s.setHeaderRowStyle(i.headerRowStyle),i.firstRowStyle&&s.setFirstRowStyle(i.firstRowStyle),i.secondRowStyle&&s.setSecondRowStyle(i.secondRowStyle),i.lastRowStyle&&s.setLastRowStyle(i.lastRowStyle)),!0}},sf={id:"sheet.mutation.remove-range-theme",type:R.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{styleName:r,unitId:n}=t;return e.get(eb).unregisterRangeThemeStyle(n,r),!0}},sp={id:"sheet.mutation.add-range-theme",type:R.CommandType.MUTATION,handler:(e,t)=>{if(!t)return!1;let{styleJSON:r,unitId:n}=t,i=e.get(eb),s=new eh(r.name);return s.fromJson(r),i.registerRangeThemeStyle(n,s),!0}};var sC=Object.getOwnPropertyDescriptor,s_=(e,t)=>(r,n)=>t(r,n,e);let sy=class extends R.Disposable{constructor(e,t,r){var n;super(),this._commandService=e,this._configService=t,this._dataSyncPrimaryController=r,[eW,eD,ex,e7,tn,rU,rV,eF,eL,tt,r1,sl,rJ,n9,iC,so,r3,i9,nP,nV].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)}),null!=(n=this._configService.getConfig(sd))&&n||[eG,e4,e6,e9,tr,ro,ru,ii,iX,rT,rv,rw,rM,rA,rS,rg,rp,rR,rE,rI,rb,ry,r_,rO,rk,ty,rP,rY,rK,rq,rz,rQ,r6,r2,nJ,nQ,nZ,nl,no,ni,ns,na,n_,nm,nf,is,nh,nc,nI,nb,nN,n1,rt,iq,nj,nU,nx,nC,nk,np,nF,n$,n6,n4,nK,n5,n2,n0,n8,ie,n7,ig,im,i_,iR,iE,iz,iG,iK,iY,ir,iB,ij,il,io,tC,tp,sh,rm,rW,nE,iQ,i4,i3,nA,nS,iP,K,nw,Q,iL,X,nM,rc,Z,rh,iF,z,G,nv,i5,iu,ih,i2,eT,eA,r$,rB,i6,rH,eM,rd,sp,sg,sf].forEach(e=>this.disposeWithMe(this._commandService.registerCommand(e))),this._configService.setConfig(sm,3e6)}};sy=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sC(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([s_(0,R.ICommandService),s_(1,R.IConfigService),s_(2,(0,b.Optional)(N.DataSyncPrimaryController))],sy);var sE=Object.getOwnPropertyDescriptor,sR=(e,t)=>(r,n)=>t(r,n,e);let sb=class extends R.Disposable{constructor(e,t){super(),this._univerInstanceService=e,this._commandService=t,this._initialize()}_initialize(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id!==I.SetFormulaCalculationResultMutation.id)return;let{unitData:t}=e.params,r=Object.keys(t),n=[];for(let e=0;e<r.length;e++){let i=r[e],s=t[i];if(null==s)continue;let a=Object.keys(s);for(let e=0;e<a.length;e++){let t=a[e],r=s[t];if(null==r)continue;let o=this._getMergedCellData(i,t,r),l={subUnitId:t,unitId:i,cellValue:o};n.push({id:eW.id,params:l})}}return n.every(e=>this._commandService.executeCommand(e.id,e.params,{onlyLocal:!0}))}))}_getMergedCellData(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e),i=null==n?void 0:n.getStyles(),s=null==n?void 0:n.getSheetBySheetId(t),a=null==s?void 0:s.getCellMatrix(),o=new(0,R.ObjectMatrix)(r);return o.forValue((e,t,r)=>{let n=null==a?void 0:a.getValue(e,t),s=(0,I.handleNumfmtInCell)(n,r,i);o.setValue(e,t,s)}),o.getMatrix()}};sb=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sE(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sR(0,(0,b.Inject)(R.IUniverInstanceService)),sR(1,R.ICommandService)],sb);let sI={};var sN=Object.getOwnPropertyDescriptor,sS=(e,t)=>(r,n)=>t(r,n,e);let sA="AllDefaultWorkbook",sv=class extends R.Disposable{constructor(e,t){super(),this._definedNamesService=e,this._resourceManagerService=t,this._initialize()}_initialize(){this._initSnapshot()}_initSnapshot(){let e=e=>{let t=this._definedNamesService.getDefinedNameMap(e);return t?JSON.stringify(t):""},t=e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}};this.disposeWithMe(this._resourceManagerService.registerPluginResource({pluginName:"SHEET_DEFINED_NAME_PLUGIN",businesses:[R.UniverInstanceType.UNIVER_SHEET],toJson:t=>e(t),parseJson:e=>t(e),onUnLoad:e=>{this._definedNamesService.removeUnitDefinedName(e)},onLoad:(e,t)=>{this._definedNamesService.registerDefinedNames(e,t)}}))}};sv=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sN(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sS(0,I.IDefinedNamesService),sS(1,R.IResourceManagerService)],sv);let sT={MoveRangeCommandId:t_,InsertRowCommandId:rC,InsertColCommandId:rN,RemoveColCommandId:rX,RemoveRowCommandId:rG,DeleteRangeMoveLeftCommandId:ra,DeleteRangeMoveUpCommandId:rl,InsertRangeMoveDownCommandId:"sheet.command.insert-range-move-down",InsertRangeMoveRightCommandId:rf,MoveColsCommandId:rF,MoveRowsCommandId:rL,ReorderRangeCommandId:r4};var sw=((f=sw||{})[f.Set=0]="Set",f[f.Delete=1]="Delete",f[f.HorizontalMove=2]="HorizontalMove",f[f.VerticalMove=3]="VerticalMove",f[f.Unknown=4]="Unknown",f);let sM=Number.MAX_SAFE_INTEGER,sO=e=>{let t={...e},r=Number.isNaN(t.startRow)&&Number.isNaN(t.endRow)&&!Number.isNaN(t.startColumn)&&!Number.isNaN(t.endColumn),n=Number.isNaN(t.startColumn)&&Number.isNaN(t.endColumn)&&!Number.isNaN(t.startRow)&&!Number.isNaN(t.endRow);return(t.rangeType===R.RANGE_TYPE.COLUMN||r)&&(t.startRow=0,t.endRow=sM),(t.rangeType===R.RANGE_TYPE.ROW||n)&&(t.startColumn=0,t.endColumn=sM),t.rangeType===R.RANGE_TYPE.ALL&&(t.startColumn=0,t.endColumn=sM,t.startRow=0,t.endRow=sM),t},sx=e=>{let t=e.rangeType;return e.rangeType===R.RANGE_TYPE.COLUMN?t=R.RANGE_TYPE.ROW:e.rangeType===R.RANGE_TYPE.ROW&&(t=R.RANGE_TYPE.COLUMN),{startRow:e.startColumn,endRow:e.endColumn,startColumn:e.startRow,endColumn:e.endRow,rangeType:t}},sU=(e,t,r)=>{let n={...r},i={...t},s=(e,t)=>{let r=Math.max(e.start,t.start),n=Math.min(e.end,t.end);return n<r?null:{start:r,end:n}},a=e=>e.end-e.start+1,o=t.start>e.start;if(o){let r=Math.min(e.end,t.start)-e.start+1;i.start-=r,i.end-=r}let l=a(e),u=s(e,n),c=u&&a(u)>=a(n);if(e.end<n.start)n.start-=l,n.end-=l;else if(u){let t=a(u);if(c){let t,r=(t={start:n.start-e.start,end:n.start-e.start+n.end-n.start},{start:i.start+t.start,end:i.start+t.start+t.end-t.start});n.start=r.start,n.end=r.end}else u.start>e.start?o?(n.end-=t+l,n.start-=l):n.end-=t:o?n.end-=t:n.start>e.start&&n.end>e.end?(n.start-=l,n.end-=l+t):n.end-=t}let h=s(i,n);return c||(i.start<=n.start?(n.start+=l,n.end+=l):h&&(o?i.end<=n.start||i.start<=n.start&&i.end>=n.start?(n.start+=l,n.end+=l):i.start>=n.start&&i.start<=n.end&&(n.end+=l):n.start<i.start&&n.end>i.start?n.end+=l:(n.start>=i.end||n.start>=i.start&&n.start<=i.end)&&(n.end+=l,n.start+=l))),{step:n.start-r.start,length:a(n)-a(r)}},sD=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=sO(r),s=sO(n),a=sO(t),o=sU({start:i.startRow,end:i.endRow},{start:s.startRow,end:s.endRow},{start:a.startRow,end:a.endRow});return null===o?[{type:sw.Delete}]:[{type:sw.VerticalMove,step:o.step||0,length:o.length||0}]},sV=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startRow,s=r.endRow-r.startRow+1,a=n.startRow,o=new(0,R.ObjectMatrix);return R.Range.foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveRows(i,s,a),(0,R.queryObjectMatrix)(o,e=>1===e)},sL=(e,t)=>{let{range:r,order:n}=e.params||{};if(!r||!n)return[t];let i=new(0,R.ObjectMatrix);R.Range.foreach(t,(e,t)=>{i.setValue(e,t,1)});let s=new(0,R.ObjectMatrix);return R.Range.foreach(r,(e,t)=>{var r;if(Object.prototype.hasOwnProperty.call(n,e)){let a=n[e],o=null!=(r=i.getValue(a,t))?r:0;s.setValue(e,t,o)}}),s.forValue((e,t,r)=>{i.setValue(e,t,r)}),(0,R.queryObjectMatrix)(i,e=>1===e)},sP=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!n||!r)return[];let i=sO(r),s=sO(n),a=sO(t),o=sU({start:i.startColumn,end:i.endColumn},{start:s.startColumn,end:s.endColumn},{start:a.startColumn,end:a.endColumn});return null===o?[{type:sw.Delete}]:[{type:sw.HorizontalMove,step:o.step||0,length:o.length||0}]},sF=(e,t)=>{let{fromRange:r,toRange:n}=e.params||{};if(!r||!n)return[t];let i=r.startColumn,s=r.endColumn-r.startColumn+1,a=n.startColumn,o=new(0,R.ObjectMatrix);return R.Range.foreach(t,(e,t)=>{o.setValue(e,t,1)}),o.moveColumns(i,s,a),(0,R.queryObjectMatrix)(o,e=>1===e)},sk=(e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s)return[];let a=[];if(R.Rectangle.contains(i,t)&&a.push({type:sw.Delete}),R.Rectangle.contains(s,t)){a.push({type:sw.Delete});let e=R.Rectangle.getRelativeRange(t,s),r=R.Rectangle.getPositionRange(e,i);return[{type:sw.Set,range:r}]}return a},sj=(e,t)=>{var r,n;let i=null==(r=e.params)?void 0:r.toRange,s=null==(n=e.params)?void 0:n.fromRange;if(!i||!s||!R.Rectangle.intersects(s,t)&&!R.Rectangle.intersects(i,t))return[t];if(R.Rectangle.contains(s,t)){let e=R.Rectangle.getRelativeRange(t,s);return[R.Rectangle.getPositionRange(e,i)]}let a=new(0,R.ObjectMatrix);R.Range.foreach(t,(e,t)=>{a.setValue(e,t,1)});let o=new(0,R.ObjectMatrix),l=R.Rectangle.getIntersects(s,t);l&&R.Range.foreach(l,(e,t)=>{a.getValue(e,t)&&(a.setValue(e,t,void 0),o.setValue(e,t,1))});let u=i.startColumn-s.startColumn,c=i.startRow-s.startRow,h={startColumn:i.startColumn-u,endColumn:i.endColumn-u,startRow:i.startRow-c,endRow:i.endRow-c};return h&&R.Range.foreach(h,(e,t)=>{var r;let n=e+c,i=t+u;a.setValue(n,i,null!=(r=o.getValue(e,t))?r:0)}),(0,R.queryObjectMatrix)(a,e=>1===e)},sB=(e,t)=>{let r=sO(e),n=sO(t),i=e=>e.endColumn-e.startColumn+1,s=e=>e.endRow-e.startRow+1;if(r.startRow<=n.startRow&&r.endRow>=n.endRow){if(n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn){let e=R.Rectangle.getIntersects(n,r);if(e)return{step:0,length:-i(e)}}if(n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn&&s(r)>=s(n))return null;if(n.startColumn>=r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn){let e=R.Rectangle.getIntersects(n,r);if(e){let t=-i(e);return{step:-(i(r)-i(e)),length:t}}}if(n.startColumn>r.endColumn)return{step:-i(r),length:0}}return{step:0,length:0}},s$=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=sB(n,t);if(s){let{step:e,length:t}=s;i.push({type:sw.HorizontalMove,step:e,length:t})}else i.push({type:sw.Delete});return i},sH=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=sB(sx(n),sx(t));if(s){let{step:e,length:t}=s;i.push({type:sw.VerticalMove,step:e,length:t})}else i.push({type:sw.Delete});return i},sW=(e,t)=>{let{range:r,order:n}=e.params||{};if(!r||!n)return[];if(R.Rectangle.contains(r,t)&&t.endRow===t.startRow){let e=[],r=t.startRow;for(let t in n)if(n[t]===r){let n=Number(t);return e.push({type:sw.VerticalMove,step:n-r,length:0}),e}}return[]},sG=(e,t)=>{let r=sO(e),n=sO(t),i=e=>e.endColumn-e.startColumn+1;return r.startRow<=n.startRow&&r.endRow>=n.endRow?n.startColumn<r.startColumn&&n.endColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn<r.startColumn&&n.endColumn>=r.endColumn?{step:0,length:i(r)}:n.startColumn>=r.startColumn&&n.endColumn<=r.endColumn||n.startColumn>=r.startColumn&&n.startColumn<=r.endColumn&&n.endColumn>r.endColumn||n.startColumn>=r.endColumn?{step:i(r),length:0}:{step:0,length:0}:{step:0,length:0}},sY=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=sG(sx(n),sx(t));return i.push({type:sw.VerticalMove,step:s,length:a}),i},sz=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=sG(n,t);return i.push({type:sw.HorizontalMove,step:s,length:a}),i},sX=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=sG(sx(n),sx(t));return i.push({type:sw.VerticalMove,step:s,length:a}),i},sq=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endRow-n.startRow+1,s={...n,startRow:n.startRow,endRow:Number.POSITIVE_INFINITY},a=R.Rectangle.subtract(t,s),o=R.Rectangle.getIntersects(s,t);if(!o)return[t];let l=new(0,R.ObjectMatrix);return a.forEach(e=>{R.Range.foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&R.Range.foreach(o,(e,t)=>{l.setValue(e+i,t,1)}),(0,R.queryObjectMatrix)(l,e=>1===e)},sK=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],{step:s,length:a}=sG(n,t);return i.push({type:sw.HorizontalMove,step:s,length:a}),i},sQ=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i=n.endColumn-n.startColumn+1,s={...n,startColumn:n.startColumn,endColumn:Number.POSITIVE_INFINITY},a=R.Rectangle.subtract(t,s),o=R.Rectangle.getIntersects(s,t);if(!o)return[t];let l=new(0,R.ObjectMatrix);return a.forEach(e=>{R.Range.foreach(e,(e,t)=>{l.setValue(e,t,1)})}),o&&R.Range.foreach(o,(e,t)=>{l.setValue(e,t+i,1)}),(0,R.queryObjectMatrix)(l,e=>1===e)},sZ=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=sB(n,t);if(s){let{step:e,length:t}=s;i.push({type:sw.HorizontalMove,step:e,length:t})}else i.push({type:sw.Delete});return i},sJ=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={startRow:n.startRow,endRow:n.endRow,startColumn:n.startColumn,endColumn:Number.POSITIVE_INFINITY},s=n.endColumn-n.startColumn+1,a=R.Rectangle.getIntersects(n,t),o=R.Rectangle.subtract(t,i),l=R.Rectangle.getIntersects(i,t);if(!a&&!l)return[t];let u=new(0,R.ObjectMatrix);return l&&R.Range.foreach(l,(e,t)=>{u.setValue(e,t-s,1)}),a&&R.Range.foreach(a,(e,t)=>{u.setValue(e,t-s,0)}),o.forEach(e=>{R.Range.foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,R.queryObjectMatrix)(u,e=>1===e)},s0=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[];let i=[],s=sB(sx(n),sx(t));if(s){let{step:e,length:t}=s;i.push({type:sw.VerticalMove,step:e,length:t})}else i.push({type:sw.Delete});return i},s1=(e,t)=>{var r;let n=null==(r=e.params)?void 0:r.range;if(!n)return[t];let i={...n,startRow:n.startRow,endRow:Number.POSITIVE_INFINITY},s=n.endRow-n.startRow+1,a=R.Rectangle.getIntersects(n,t),o=R.Rectangle.subtract(t,i),l=R.Rectangle.getIntersects(i,t);if(!a&&!l)return[t];let u=new(0,R.ObjectMatrix);return l&&R.Range.foreach(l,(e,t)=>{u.setValue(e-s,t,1)}),a&&R.Range.foreach(a,(e,t)=>{u.setValue(e-s,t,0)}),o.forEach(e=>{R.Range.foreach(e,(e,t)=>{u.setValue(e,t,1)})}),(0,R.queryObjectMatrix)(u,e=>1===e)},s2=(e,t)=>{var r;let n=null!=(r=e.ranges)?r:[e.range],i=new(0,R.ObjectMatrix);return R.Range.foreach(t,(e,t)=>{i.setValue(e,t,1)}),n.forEach(e=>{let t=e.startRow,r=e.endRow-t+1;i.removeRows(t,r)}),(0,R.queryObjectMatrix)(i,e=>1===e)},s5=(e,t)=>{let r=e.params,n=r.range.startRow,i=r.range.endRow-r.range.startRow+1;return t.startRow>=n?[{startRow:t.startRow+i,endRow:t.endRow+i,startColumn:t.startColumn,endColumn:t.endColumn}]:t.endRow<n?[t]:[{startRow:t.startRow,endRow:t.endRow+i,startColumn:t.startColumn,endColumn:t.endColumn}]},s3=(e,t)=>{let r=e.params,n=r.range.startColumn,i=r.range.endColumn-r.range.startColumn+1;return t.startColumn>=n?[{startRow:t.startRow,endRow:t.endRow,startColumn:t.startColumn+i,endColumn:t.endColumn+i}]:t.endColumn<n?[t]:[{startRow:t.startRow,endRow:t.endRow,startColumn:t.startColumn,endColumn:t.endColumn+i}]},s4=(e,t)=>{let r={...t};return e.forEach(e=>{switch(e.type){case sw.Delete:r=null;break;case sw.HorizontalMove:if(!r)return;r.startColumn+=e.step,r.endColumn+=e.step+(e.length||0);break;case sw.VerticalMove:if(!r)return;r.startRow+=e.step,r.endRow+=e.step+(e.length||0);break;case sw.Set:r=e.range}}),r&&(r.endColumn<r.startColumn||r.endRow<r.startRow)?null:r},s6=(e,t)=>{let r=[];switch(t.id){case sT.DeleteRangeMoveLeftCommandId:r=sZ(t,e);break;case sT.DeleteRangeMoveUpCommandId:r=s0(t,e);break;case sT.InsertColCommandId:r=sz(t,e);break;case sT.InsertRangeMoveDownCommandId:r=sX(t,e);break;case sT.InsertRangeMoveRightCommandId:r=sK(t,e);break;case sT.InsertRowCommandId:r=sY(t,e);break;case sT.MoveColsCommandId:r=sP(t,e);break;case sT.MoveRangeCommandId:r=sk(t,e);break;case sT.MoveRowsCommandId:r=sD(t,e);break;case sT.RemoveColCommandId:r=s$(t,e);break;case sT.RemoveRowCommandId:r=sH(t,e);break;case sT.ReorderRangeCommandId:r=sW(t,e)}return s4(r,e)},s9=(e,t,r)=>[ro.id,ru.id].includes(t.id)||at(t,r).some(t=>R.Rectangle.intersects(t,e))?s6(e,t):e,s8=(e,t)=>{let r=[];switch(t.id){case sT.DeleteRangeMoveLeftCommandId:return sJ(t,e);case sT.DeleteRangeMoveUpCommandId:return s1(t,e);case sT.InsertRangeMoveDownCommandId:return sq(t,e);case sT.InsertRangeMoveRightCommandId:return sQ(t,e);case sT.InsertColCommandId:return s3(t,e);case sT.InsertRowCommandId:return s5(t,e);case sT.MoveColsCommandId:return sF(t,e);case sT.MoveRangeCommandId:return sj(t,e);case sT.MoveRowsCommandId:return sV(t,e);case sT.ReorderRangeCommandId:return sL(t,e);case sT.RemoveColCommandId:r=s$(t,e);break;case sT.RemoveRowCommandId:return s2(t.params,e)}let n=s4(r,e);return n?[n]:[]},s7=(e,t,r)=>[ro.id,ru.id,rg.id,rf].includes(t.id)||at(t,r).some(t=>R.Rectangle.intersects(t,e))?s8(e,t):e;function ae(e,t){let{id:r,params:n}=t,i={length:0,step:0,type:sw.Unknown};switch(r){case tt.id:i.type=sw.Delete;break;case rU.id:(i=sU({start:n.sourceRange.startRow,end:n.sourceRange.endRow},{start:n.targetRange.startRow,end:n.targetRange.endRow},{start:e.startRow,end:e.endRow})).type=sw.VerticalMove;break;case rV.id:(i=sU({start:n.sourceRange.startColumn,end:n.sourceRange.endColumn},{start:n.targetRange.startColumn,end:n.targetRange.endColumn},{start:e.startColumn,end:e.endColumn})).type=sw.HorizontalMove;break;case eF.id:(i=sB(n.range,e))?i.type=sw.HorizontalMove:i={step:0,length:0,type:sw.Delete};break;case eL.id:(i=sB(sx(n.range),sx(e)))?i.type=sw.VerticalMove:i={step:0,length:0,type:sw.Delete};break;case ex.id:(i=sG(sx(n.range),sx(e))).type=sw.VerticalMove;break;case eD.id:(i=sG(n.range,e)).type=sw.HorizontalMove;break;case tn.id:i=function(e,t,r){let n=[];if(R.Rectangle.contains(t,r)&&n.push({type:sw.Delete}),R.Rectangle.contains(e,r)){n.push({type:sw.Delete});let i=R.Rectangle.getRelativeRange(r,e),s=R.Rectangle.getPositionRange(i,t);return[{type:sw.Set,range:s}]}return n}(n.fromRange||new(0,R.ObjectMatrix)(n.from).getRange(),n.toRange||new(0,R.ObjectMatrix)(n.to).getRange(),e)}return i?Array.isArray(i)?s4(i,e):s4([i],e):e}function at(e,t){var r,n,i,s,a,o;let{selectionManagerService:l}=t;switch(e.id){case sT.MoveColsCommandId:{let t=e.params;return[t.fromRange,{...t.toRange,startColumn:t.toRange.startColumn-.5,endColumn:t.toRange.endColumn-.5}]}case sT.MoveRowsCommandId:{let t=e.params;return[t.fromRange,{...t.toRange,startRow:t.toRange.startRow-.5,endRow:t.toRange.startRow-.5}]}case sT.MoveRangeCommandId:return[e.params.fromRange,e.params.toRange];case sT.InsertRowCommandId:{let t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.endRow-.5}]}case sT.InsertColCommandId:{let t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.endColumn-.5}]}case sT.RemoveRowCommandId:case sT.RemoveColCommandId:return[e.params.range];case sT.DeleteRangeMoveUpCommandId:case sT.InsertRangeMoveDownCommandId:{let t=(null==(r=e.params)?void 0:r.range)||(null==(i=null==(n=l.getCurrentSelections())?void 0:n.map(e=>e.range))?void 0:i[0]);return t?[t]:[]}case sT.DeleteRangeMoveLeftCommandId:case sT.InsertRangeMoveRightCommandId:{let t=(null==(s=e.params)?void 0:s.range)||(null==(o=null==(a=l.getCurrentSelections())?void 0:a.map(e=>e.range))?void 0:o[0]);return t?[t]:[]}case sT.ReorderRangeCommandId:{let{range:t,order:r}=e.params,n=[];for(let e=t.startRow;e<=t.endRow;e++)e in r&&n.push({startRow:e,endRow:e,startColumn:t.startColumn,endColumn:t.endColumn});return n}}}function ar(e,t){var r,n,i,s,a,o;let l=e.get(R.IUniverInstanceService),u=e.get(e1);switch(t.id){case sT.MoveColsCommandId:{let e=t.params,r=eN(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startColumn:e.fromRange.startColumn<e.toRange.startColumn?e.fromRange.endColumn+1:e.toRange.startColumn,endColumn:e.fromRange.startColumn<e.toRange.startColumn?e.toRange.endColumn-1:e.fromRange.startColumn-1}]}}case sT.MoveRowsCommandId:{let e=t.params,r=eN(l,{unitId:e.unitId,subUnitId:e.subUnitId});return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,{...e.toRange,startRow:e.fromRange.startRow<e.toRange.startRow?e.fromRange.endRow+1:e.toRange.startRow,endRow:e.fromRange.startRow<e.toRange.startRow?e.toRange.endRow-1:e.fromRange.startRow-1}]}}case sT.MoveRangeCommandId:{let e=t.params,r=eN(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e.fromRange,e.toRange]}}case sT.InsertRowCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startRow>0?[{...r,startRow:r.startRow-1,endRow:r.endRow-1}]:[],{...r,startRow:r.startRow,endRow:Number.MAX_SAFE_INTEGER}]}}case sT.InsertColCommandId:{let e=t.params,r=e.range;return{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[...r.startColumn>0?[{...r,startColumn:r.startColumn-1,endColumn:r.endColumn-1}]:[],{...r,startColumn:r.startColumn,endColumn:Number.MAX_SAFE_INTEGER}]}}case sT.RemoveRowCommandId:{let e=t.params.range,r=eN(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startRow:e.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}}case sT.RemoveColCommandId:{let e=t.params.range,r=eN(l);return{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}}case sT.DeleteRangeMoveUpCommandId:case sT.InsertRangeMoveDownCommandId:{let e=eN(l),s=(null==(r=t.params)?void 0:r.range)||(null==(i=null==(n=u.getCurrentSelections())?void 0:n.map(e=>e.range))?void 0:i[0]);return s?{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[s,{...s,startRow:s.endRow+1,endRow:Number.MAX_SAFE_INTEGER}]}:{unitId:e.unitId,subUnitId:e.subUnitId,ranges:[]}}case sT.DeleteRangeMoveLeftCommandId:case sT.InsertRangeMoveRightCommandId:{let e=(null==(s=t.params)?void 0:s.range)||(null==(o=null==(a=u.getCurrentSelections())?void 0:a.map(e=>e.range))?void 0:o[0]),r=eN(l);return e?{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[e,{...e,startColumn:e.endColumn+1,endColumn:Number.MAX_SAFE_INTEGER}]}:{unitId:r.unitId,subUnitId:r.subUnitId,ranges:[]}}case sT.ReorderRangeCommandId:{let{range:e,order:r}=t.params,n=[];for(let t=e.startRow;t<=e.endRow;t++)t in r&&n.push({startRow:t,endRow:t,startColumn:e.startColumn,endColumn:e.endColumn});let i=eN(l);return{unitId:i.unitId,subUnitId:i.subUnitId,ranges:n}}}}var an=Object.getOwnPropertyDescriptor,ai=(e,t)=>(r,n)=>t(r,n,e);let as=(0,R.createInterceptorKey)("MERGE_REDO"),aa=(0,R.createInterceptorKey)("MERGE_UNDO"),ao=Math.floor(Number.MAX_SAFE_INTEGER/10);class al extends R.Disposable{constructor(e,t,r,n,i=!1){super(),this._unitId=e,this._subUnitId=t,this._range=r,this._callback=n,this._skipIntersects=i}onMutation(e){var t,r;if((null==(t=e.params)?void 0:t.unitId)!==this._unitId)return;if(e.id===tn.id){let t=e.params;if(t.from.subUnitId!==this._subUnitId||t.to.subUnitId!==this._subUnitId)return}else if((null==(r=e.params)?void 0:r.subUnitId)!==this._subUnitId)return;if(!this._range)return;if(this._skipIntersects){if(e.id===tt.id)return;let t=function(e){switch(e.id){case rV.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startColumn:t.targetRange.startColumn-.5,endColumn:t.targetRange.startColumn-.5}]}case rU.id:{let t=e.params;return[t.sourceRange,{...t.targetRange,startRow:t.targetRange.startRow-.5,endRow:t.targetRange.startRow-.5}]}case tn.id:{let t=e.params;return[new(0,R.ObjectMatrix)(t.from.value).getRange(),new(0,R.ObjectMatrix)(t.to.value).getRange()]}case eD.id:{let t=e.params.range;return[{...t,startColumn:t.startColumn-.5,endColumn:t.startColumn-.5}]}case ex.id:{let t=e.params.range;return[{...t,startRow:t.startRow-.5,endRow:t.startRow-.5}]}case eF.id:case eL.id:return[e.params.range]}}(e);if(null!=t&&t.some(e=>R.Rectangle.intersects(e,this._range)))return}let n=ae(this._range,e);if(n&&R.Rectangle.equals(n,this._range))return!1;let i=this._range;this._range=n,this._callback(i,n)}}let au=class extends R.Disposable{constructor(e,t,r,n){super(),j(this,"interceptor",new(0,R.InterceptorManager)({MERGE_REDO:as,MERGE_UNDO:aa})),j(this,"_watchRanges",new Set),j(this,"_refRangeManagerMap",new Map),j(this,"_serializer",function(){let e=["startRow","startColumn","endRow","endColumn","rangeType"];return{deserialize:t=>{let r=e.reduce((e,t,r)=>(e[String(r)]=t,e),{});return t.split("_").reduce((e,t,n)=>{let i=String(n);return t&&r[i]&&(e[r[i]]=t),e},{})},serialize:t=>e.reduce((e,r,n)=>{let i=t[r];return void 0!==i?`${e}${n>0?"_":""}${i}`:`${e}`},"")}}()),j(this,"_onRefRangeChange",()=>{this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET).getActiveSheet(),r=ac(this._univerInstanceService),n=ah(this._univerInstanceService);if(!t||!r||!n)return{redos:[],undos:[],preRedos:[],preUndos:[]};let i=((()=>{switch(e.id){case sT.MoveColsCommandId:{let i=e.params,s=Math.min(i.fromRange.startColumn,i.toRange.startColumn);return this._checkRange([{...i.fromRange,startColumn:s,endColumn:t.getColumnCount()-1}],r,n)}case sT.MoveRowsCommandId:{let i=e.params,s=Math.min(i.fromRange.startRow,i.toRange.startRow);return this._checkRange([{...i.fromRange,startRow:s,endRow:t.getRowCount()-1}],r,n)}case sT.MoveRangeCommandId:return this._checkRange([e.params.fromRange,e.params.toRange],r,n);case sT.InsertRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:R.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case sT.InsertColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:R.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case sT.RemoveRowCommandId:{let i={startRow:e.params.range.startRow,endRow:t.getRowCount()-1,startColumn:0,endColumn:t.getColumnCount()-1,rangeType:R.RANGE_TYPE.ROW};return this._checkRange([i],r,n)}case sT.RemoveColCommandId:{let i=e.params.range.startColumn,s={startRow:0,endRow:t.getRowCount()-1,startColumn:i,endColumn:t.getColumnCount()-1,rangeType:R.RANGE_TYPE.COLUMN};return this._checkRange([s],r,n)}case sT.DeleteRangeMoveUpCommandId:case sT.InsertRangeMoveDownCommandId:{let t=e.params.range||ad(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:t.endColumn,endRow:ao};return this._checkRange([i],r,n)}case sT.DeleteRangeMoveLeftCommandId:case sT.InsertRangeMoveRightCommandId:{let t=e.params.range||ad(this._selectionManagerService)[0],i={startRow:t.startRow,startColumn:t.startColumn,endColumn:ao,endRow:t.endRow};return this._checkRange([i],r,n)}case sT.ReorderRangeCommandId:{let{range:t,order:i}=e.params,s=[];for(let e=t.startRow;e<=t.endRow;e++)e in i&&s.push({startRow:e,endRow:e,startColumn:t.startColumn,endColumn:t.endColumn});return this._checkRange(s,r,n)}}})()||[]).reduce((t,r)=>{let n=r(e);return t.push(n),t},[]).reduce((e,t)=>{var r,n;return e.redos.push(...t.redos),e.undos.push(...t.undos),e.preRedos.push(...null!=(r=t.preRedos)?r:[]),e.preUndos.push(...null!=(n=t.preUndos)?n:[]),e},{redos:[],undos:[],preUndos:[],preRedos:[]}),s=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.preRedos,null)||[],a=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_REDO)(i.redos,null)||[],o=this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.preUndos,null)||[];return{redos:a,undos:this.interceptor.fetchThroughInterceptors(this.interceptor.getInterceptPoints().MERGE_UNDO)(i.undos,null)||[],preRedos:s,preUndos:o}}})}),j(this,"_checkRange",(e,t,r)=>{var n,i;let s=(n=t,i=r,`${n}_${i}`),a=this._refRangeManagerMap.get(s);if(a){let t=new Set;return[...a.keys()].forEach(r=>{let n=a.get(r),i=this._serializer.deserialize(r),s={...i,startRow:+i.startRow,endRow:+i.endRow,startColumn:+i.startColumn,endColumn:+i.endColumn,rangeType:i.rangeType&&+i.rangeType};e.some(e=>R.Rectangle.intersects(e,s))&&n&&n.forEach(e=>{t.add(e)})}),[...t]}return[]}),j(this,"registerRefRange",(e,t,r,n)=>{var i,s;let a=r||ac(this._univerInstanceService),o=n||ah(this._univerInstanceService);if(!a||!o)return(0,R.toDisposable)(()=>{});let l=(i=a,s=o,`${i}_${s}`),u=this._serializer.serialize(e),c=this._refRangeManagerMap.get(l);c||(c=new Map,this._refRangeManagerMap.set(l,c));let h=c.get(u);return h?h.add(t):c.set(u,new Set([t])),(0,R.toDisposable)(()=>{let e=c.get(u);e&&(e.delete(t),e.size||(c.delete(u),c.size||this._refRangeManagerMap.delete(l)))})}),this._commandService=e,this._sheetInterceptorService=t,this._univerInstanceService=r,this._selectionManagerService=n,this._onRefRangeChange(),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_REDO,{priority:-1,handler:e=>e}),this.interceptor.intercept(this.interceptor.getInterceptPoints().MERGE_UNDO,{priority:-1,handler:e=>e})}watchRange(e,t,r,n,i){let s;0===this._watchRanges.size&&(s=this._commandService.onCommandExecuted(e=>{if(e.type!==R.CommandType.MUTATION)return!1;for(let t of this._watchRanges)t.onMutation(e)}));let a=new al(e,t,r,n,i);this._watchRanges.add(a);let o=(0,R.toDisposable)(()=>{this._watchRanges.delete(a),0===this._watchRanges.size&&(null==s||s.dispose(),s=null)}),l=this.disposeWithMe(o);return(0,R.toDisposable)(()=>{l.dispose(),o.dispose()})}};function ac(e){return e.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET).getUnitId()}function ah(e){var t;return null==(t=e.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET).getActiveSheet())?void 0:t.getSheetId()}function ad(e){var t;return(null==(t=e.getCurrentSelections())?void 0:t.map(e=>e.range))||[]}au=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?an(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ai(0,R.ICommandService),ai(1,(0,b.Inject)(eo)),ai(2,(0,b.Inject)(R.IUniverInstanceService)),ai(3,(0,b.Inject)(e1))],au);var am=Object.getOwnPropertyDescriptor,ag=(e,t)=>(r,n)=>t(r,n,e);let af=[eD.id,ex.id,eF.id,eL.id],ap=[rU.id,rV.id];function aC(e,t){let r=e;if(void 0!==t){let e=[];for(let n=0;n<r.length;n++){let{startRow:i,endRow:s,startColumn:a,endColumn:o}=r[n];if(t===R.Dimension.ROWS)for(let t=i;t<=s;t++){let r={startRow:t,endRow:t,startColumn:a,endColumn:o};e.push(r)}else if(t===R.Dimension.COLUMNS)for(let t=a;t<=o;t++){let r={startRow:i,endRow:s,startColumn:t,endColumn:t};e.push(r)}}r=e}return r}let a_=(0,R.createInterceptorKey)("mergeCellPermissionCheck"),ay=class extends R.Disposable{constructor(e,t,r,n,i,s){super(),j(this,"disposableCollection",new(0,R.DisposableCollection)),j(this,"interceptor",new(0,R.InterceptorManager)({MERGE_CELL_INTERCEPTOR_CHECK:a_})),this._commandService=e,this._refRangeService=t,this._univerInstanceService=r,this._injector=n,this._sheetInterceptorService=i,this._selectionManagerService=s,this._onRefRangeChange(),this._initCommandInterceptor(),this._commandExecutedListener()}_initCommandInterceptor(){let e=this;this._sheetInterceptorService.interceptCommand({getMutations(t){var r;switch(t.id){case e4.id:case e9.id:{let t=e._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET),n=t.getUnitId(),i=null==t?void 0:t.getActiveSheet();if(!i)return{redos:[],undos:[]};let s=i.getSheetId(),a=i.getConfig().mergeData,o=null==(r=e._selectionManagerService.getCurrentSelections())?void 0:r.map(e=>e.range);if(o&&o.length>0&&o.some(e=>a.some(t=>R.Rectangle.intersects(t,e)))){let t={unitId:n,subUnitId:s,ranges:o},r=r0(e._injector,t);return{redos:[{id:r1.id,params:t}],undos:[{id:rJ.id,params:r}]}}}}return{redos:[],undos:[]}}}),this._sheetInterceptorService.interceptRanges({getMutations:({unitId:e,subUnitId:t,ranges:r})=>{let n=[],i=[],s={redos:n,undos:i};if(!r||!r.length)return s;let a=eN(this._univerInstanceService,{unitId:e,subUnitId:t});if(!a)return s;let{worksheet:o}=a,l=o.getMergeData().filter(e=>r.some(t=>R.Rectangle.intersects(e,t)));return l.length?(n.push({id:r1.id,params:{unitId:e,subUnitId:t,ranges:l}}),i.push({id:rJ.id,params:{unitId:e,subUnitId:t,ranges:l}}),{undos:i,redos:n}):s}})}refRangeHandle(e,t,r){switch(e.id){case sT.MoveColsCommandId:{let n=e.params;return this._handleMoveColsCommand(n,t,r)}case sT.MoveRowsCommandId:{let n=e.params;return this._handleMoveRowsCommand(n,t,r)}case r_.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertRowCommand(n,i,s)}case rS.id:{let n=e.params,i=n.unitId||t,s=n.subUnitId||r;return this._handleInsertColCommand(n,i,s)}case rK.id:{let n=e.params;return this._handleRemoveColCommand(n,t,r)}case rz.id:{let n=e.params;return this._handleRemoveRowCommand(n,t,r)}case ty.id:{let n=e.params;return this._handleMoveRangeCommand(n,t,r)}case rp.id:{let n=e.params;return this._handleInsertRangeMoveRightCommand(n,t,r)}case rg.id:{let n=e.params;return this._handleInsertRangeMoveDownCommand(n,t,r)}case ru.id:{let n=e.params;return this._handleDeleteRangeMoveUpCommand(n,t,r)}case ro.id:{let n=e.params;return this._handleDeleteRangeMoveLeftCommand(n,t,r)}}return{redos:[],undos:[]}}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getUniverSheetInstance(e);if(!r)return;let n=null==r?void 0:r.getSheetBySheetId(t);if(!n)return;this.disposableCollection.dispose();let i=n.getMergeData(),s=r=>this.refRangeHandle(r,e,t);i.forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,s,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===n7.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}if(t.id===rJ.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(r.unitId,r.subUnitId)}})),this._univerInstanceService.getCurrentTypeOfUnit$(R.UniverInstanceType.UNIVER_SHEET).pipe((0,T.first)(e=>!!e)).subscribe(t=>{let r=t.getActiveSheet();r&&e(t.getUnitId(),r.getSheetId())})}_handleMoveRowsCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startRow:u,endRow:c}=l;if(s.forEach(t=>{if(u<=t.startRow&&c>=t.endRow){a.ranges.push(t);let r=s4(sD({id:sT.MoveRowsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=r0(this._injector,a),d=rZ(this._injector,o);return{preRedos:[{id:r1.id,params:a}],redos:[{id:rJ.id,params:o}],preUndos:[{id:r1.id,params:d}],undos:[{id:rJ.id,params:h}]}}_handleMoveColsCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=[...i.getMergeData()],a={unitId:t,subUnitId:r,ranges:[]},o={unitId:t,subUnitId:r,ranges:[]},{fromRange:l}=e,{startColumn:u,endColumn:c}=l;if(s.forEach(t=>{if(u<=t.startColumn&&c>=t.endColumn){a.ranges.push(t);let r=s4(sP({id:sT.MoveColsCommandId,params:e},t),t);r&&o.ranges.push(r)}}),0===a.ranges.length)return this._handleNull();let h=r0(this._injector,a),d=rZ(this._injector,o);return{preRedos:[{id:r1.id,params:a}],redos:[{id:rJ.id,params:o}],preUndos:[{id:r1.id,params:d}],undos:[{id:rJ.id,params:h}]}}_handleMoveRangeCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=i.getMergeData(),a=s.filter(t=>R.Rectangle.intersects(t,e.fromRange)),o=s.filter(t=>R.Rectangle.intersects(t,e.toRange)),l=aC(a.map(t=>R.Rectangle.getRelativeRange(t,e.fromRange)).map(t=>R.Rectangle.getPositionRange(t,e.toRange))).filter(e=>!s.some(t=>R.Rectangle.equals(e,t)));return{redos:[{id:r1.id,params:{unitId:t,subUnitId:r,ranges:a}},{id:r1.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:rJ.id,params:{unitId:t,subUnitId:r,ranges:l}}],undos:[{id:r1.id,params:{unitId:t,subUnitId:r,ranges:l}},{id:rJ.id,params:{unitId:t,subUnitId:r,ranges:o}},{id:rJ.id,params:{unitId:t,subUnitId:r,ranges:a}}]}}_handleInsertRowCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let{range:s}=e,{startRow:a,endRow:o}=s,l=R.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=R.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(a>t.startRow&&a<=t.endRow&&(t.endRow+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d);return{redos:[{id:r1.id,params:c},{id:rJ.id,params:d}],undos:[{id:r1.id,params:m},{id:rJ.id,params:h}]}}_handleInsertColCommand(e,t,r){let{range:n}=e,i=aE(this._univerInstanceService,t);if(!i)return this._handleNull();let s=aR(i,r);if(!s)return this._handleNull();let{startColumn:a,endColumn:o}=n,l=R.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=R.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(a>t.startColumn&&a<=t.endColumn&&(t.endColumn+=o-a+1,this._checkIsMergeCell(t)&&e.push(t)),e),[]),c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d);return{redos:[{id:r1.id,params:c},{id:rJ.id,params:d}],undos:[{id:r1.id,params:m},{id:rJ.id,params:h}]}}_handleRemoveColCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let{range:s}=e,{startColumn:a,endColumn:o}=s,l=R.Tools.deepClone(i.getMergeData()).reduce((e,t)=>(R.Rectangle.intersects(s,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=R.Tools.deepClone(i.getMergeData()).reduce((e,t)=>{if(R.Rectangle.intersects(s,t)){if(a<=t.startColumn&&o>=t.endColumn)return e;a>=t.startColumn&&o<=t.endColumn?t.endColumn-=o-a+1:a<t.startColumn?(t.startColumn=a,t.endColumn-=o-a+1):o>t.endColumn&&(t.endColumn=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d),g=[{id:r1.id,params:c}],f=[{id:rJ.id,params:d}];return{preUndos:[{id:r1.id,params:m}],undos:[{id:rJ.id,params:h}],preRedos:g,redos:f}}_handleRemoveRowCommand(e,t,r){let{range:n}=e,i=aE(this._univerInstanceService,t);if(!i)return this._handleNull();let s=aR(i,r);if(!s)return this._handleNull();let{startRow:a,endRow:o}=n,l=R.Tools.deepClone(s.getMergeData()).reduce((e,t)=>(R.Rectangle.intersects(n,t)&&e.push(t),e),[]);if(0===l.length)return this._handleNull();let u=R.Tools.deepClone(s.getMergeData()).reduce((e,t)=>{if(R.Rectangle.intersects(n,t)){if(a<=t.startRow&&o>=t.endRow)return e;a>=t.startRow&&o<=t.endRow?t.endRow-=o-a+1:a<t.startRow?(t.startRow=a,t.endRow-=o-a+1):o>t.endRow&&(t.endRow=a-1),this._checkIsMergeCell(t)&&e.push(t)}return e},[]),c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d),g=[{id:r1.id,params:c}],f=[{id:rJ.id,params:d}];return{preUndos:[{id:r1.id,params:m}],undos:[{id:rJ.id,params:h}],preRedos:g,redos:f}}_handleInsertRangeMoveRightCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if(R.Rectangle.intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),R.Rectangle.contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn+t,endRow:e.endRow,endColumn:e.endColumn+t})}});let c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d);return{preRedos:[{id:r1.id,params:c}],redos:[{id:rJ.id,params:d}],preUndos:[{id:r1.id,params:m}],undos:[{id:rJ.id,params:h}]}}_handleInsertRangeMoveDownCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if(R.Rectangle.intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),R.Rectangle.contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1;u.push({startRow:e.startRow+r,startColumn:e.startColumn,endRow:e.endRow+r,endColumn:e.endColumn})}});let c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d),g=[{id:r1.id,params:c}],f=[{id:rJ.id,params:d}],p=[{id:r1.id,params:m}];return{redos:f,undos:[{id:rJ.id,params:h}],preRedos:g,preUndos:p}}_handleDeleteRangeMoveUpCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxRows()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,startColumn:r,endColumn:n,endRow:i}=s;if(R.Rectangle.intersects({startRow:t,startColumn:r,endRow:a,endColumn:n},e)&&(l.push(e),R.Rectangle.contains({startRow:t,startColumn:r,endRow:a,endColumn:n},e))){let r=i-t+1,n=R.Rectangle.moveVertical(e,-r);u.push(n)}});let c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d),g=[{id:r1.id,params:c}],f=[{id:rJ.id,params:d}],p=[{id:r1.id,params:m}];return{redos:f,undos:[{id:rJ.id,params:h}],preRedos:g,preUndos:p}}_handleDeleteRangeMoveLeftCommand(e,t,r){let n=aE(this._univerInstanceService,t);if(!n)return this._handleNull();let i=aR(n,r);if(!i)return this._handleNull();let s=e.range,a=i.getMaxColumns()-1,o=i.getMergeData(),l=[],u=[];o.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=s;if(R.Rectangle.intersects({startRow:t,startColumn:n,endRow:r,endColumn:a},e)&&(l.push(e),R.Rectangle.contains({startRow:t,startColumn:n,endRow:r,endColumn:a},e))){let t=i-n+1;u.push({startRow:e.startRow,startColumn:e.startColumn-t,endRow:e.endRow,endColumn:e.endColumn-t})}});let c={unitId:t,subUnitId:r,ranges:l},h=r0(this._injector,c),d={unitId:t,subUnitId:r,ranges:u},m=rZ(this._injector,d);return{preRedos:[{id:r1.id,params:c}],redos:[{id:rJ.id,params:d}],undos:[{id:rJ.id,params:h}],preUndos:[{id:r1.id,params:m}]}}_checkIsMergeCell(e){return e.startRow!==e.endRow||e.startColumn!==e.endColumn}_handleNull(){return{redos:[],undos:[]}}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(ap.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn,u=r.getConfig().mergeData,c=[];u.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h}=e;R.Rectangle.intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),e.startRow===e.endRow&&e.startColumn===e.endColumn||c.push({startRow:t,endRow:r,startColumn:i,endColumn:u,rangeType:h})}),r.setMergeData(c),this.disposableCollection.dispose();let{unitId:h,subUnitId:d}=e.params,m=e=>this.refRangeHandle(e,h,d);c.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,m,h,d))})}if(af.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=r.getConfig().mergeData,i=e.params;if(!i)return;let{range:s}=i,a=e.id.includes("row"),o=e.id.includes("insert"),l=a?s.startRow:s.startColumn,u=a?s.endRow:s.endColumn,c=u-l+1,h=[];n.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s}=e;o?a?l<=t&&(t+=c,r+=c):l<=n&&(n+=c,i+=c):a?u<t&&(t-=c,r-=c):u<n&&(n-=c,i-=c),e.startRow===e.endRow&&e.startColumn===e.endColumn||h.push({startRow:t,endRow:r,startColumn:n,endColumn:i,rangeType:s})}),r.setMergeData(h),this.disposableCollection.dispose();let{unitId:d,subUnitId:m}=e.params,g=e=>this.refRangeHandle(e,d,m);h.forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,g,d,m))})}}))}};function aE(e,t){return t?e.getUniverSheetInstance(t):e.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET)}function aR(e,t){return t?e.getSheetBySheetId(t):e.getActiveSheet()}ay=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?am(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ag(0,(0,b.Inject)(R.ICommandService)),ag(1,(0,b.Inject)(au)),ag(2,(0,b.Inject)(R.IUniverInstanceService)),ag(3,(0,b.Inject)(b.Injector)),ag(4,(0,b.Inject)(eo)),ag(5,(0,b.Inject)(e1))],ay);var ab=Object.getOwnPropertyDescriptor;let aI=class extends R.Disposable{constructor(e){super(),this._sheetInterceptorService=e,this._initialize()}_initialize(){this._initInterceptorCellContent()}_initInterceptorCellContent(){this.disposeWithMe(this._sheetInterceptorService.intercept(J.CELL_CONTENT,{priority:11,effect:R.InterceptorEffectEnum.Value|R.InterceptorEffectEnum.Style,handler:(e,t,r)=>{var n;let i=t.workbook.getStyles().getStyleByCell(e);return r(null!=(n=null==i?void 0:i.n)&&n.pattern?{...e}:(null==e?void 0:e.t)===R.CellValueType.NUMBER&&void 0!==e.v&&null!==e.v&&(0,R.isRealNum)(e.v)?{...e,v:(0,I.stripErrorMargin)(Number(e.v))}:{...e})}}))}};aI=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ab(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(p=(0,b.Inject)(eo),(e,t)=>p(e,t,0))],aI);var aN=Object.getOwnPropertyDescriptor,aS=(e,t)=>(r,n)=>t(r,n,e);let aA=class extends R.Disposable{constructor(e,t,r,n,i,s,a,o,l,u){super(),j(this,"disposableCollection",new(0,R.DisposableCollection)),j(this,"_triggerPermissionUIEvent$",new(0,D.Subject)),j(this,"triggerPermissionUIEvent$",this._triggerPermissionUIEvent$.asObservable()),this._commandService=e,this._univerInstanceService=t,this._permissionService=r,this._selectionManagerService=n,this._rangeProtectionRuleModel=i,this._worksheetProtectionRuleModel=s,this._localeService=a,this._lexerTreeBuilder=o,this._contextService=l,this._definedNamesService=u,this._initialize()}blockExecuteWithoutPermission(e){throw this._triggerPermissionUIEvent$.next(e),new(0,R.CustomCommandExecutionError)("have no permission")}_getPermissionCheck(e,t){let r=!0,n="";switch(e){case rt.id:(0,R.isICellData)(t.value)&&t.value.f?(r=this._permissionCheckWithFormula(t),n=this._localeService.t("permission.dialog.formulaErr")):r=this._permissionCheckBySetRangeValue({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[t6,tq]},t);break;case e6.id:r=this.permissionCheckWithRanges({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[t6,tq]}),n=this._localeService.t("permission.dialog.editErr");break;case ii.id:case is.id:r=this.permissionCheckWithoutRange({worksheetTypes:[t9]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case iX.id:case iq.id:case iK.id:r=this.permissionCheckWithoutRange({worksheetTypes:[t8]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case rk.id:case rP.id:r=this._permissionCheckByMoveCommand(t),n=this._localeService.t("permission.dialog.moveRowColErr");break;case ty.id:r=this._permissionCheckByMoveRangeCommand(t),n=this._localeService.t("permission.dialog.moveRangeErr");break;case iR.id:r=this._permissionCheckByWorksheetCommand([tU,tF]),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder();break;case i_.id:r=this._permissionCheckByWorksheetCommand([tU,tB]),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder();break;case iQ.id:{let{unitId:e,subUnitId:i}=t;r=this._permissionCheckByWorksheetCommand([tU,tV],e,i),n=this._localeService.t("permission.dialog.operatorSheetErr"),!1===r&&this._worksheetProtectionRuleModel.resetOrder()}break;case np.id:r=this.permissionCheckWithRanges({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[tq,t9]},t.ranges),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case nF.id:r=this.permissionCheckWithRanges({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[tq,t8]},t.ranges),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case nC.id:r=this.permissionCheckWithRanges({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[tq,t9]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case nk.id:r=this.permissionCheckWithRanges({workbookTypes:[tU],rangeTypes:[tN],worksheetTypes:[tq,t8]}),n=this._localeService.t("permission.dialog.setRowColStyleErr");break;case rp.id:r=this._permissionCheckWithInsertRangeMove("right"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case rg.id:r=this._permissionCheckWithInsertRangeMove("bottom"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case ro.id:r=this._permissionCheckWithInsertRangeMove("left"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr");break;case ru.id:r=this._permissionCheckWithInsertRangeMove("top"),n=this._localeService.t("permission.dialog.insertOrDeleteMoveRangeErr")}r||this.blockExecuteWithoutPermission(n)}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.beforeCommandExecuted(e=>{this._getPermissionCheck(e.id,null==e?void 0:e.params)})),this.disposeWithMe(this._commandService.onCommandExecuted(e=>{var t;if(e.id===iC.id){let{unitId:r=null==(t=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET))?void 0:t.getUnitId(),subUnitId:n}=e.params;if(!r||!n)return;let i=this._worksheetProtectionRuleModel.getRule(r,n),s=this._rangeProtectionRuleModel.getSubunitRuleList(r,n);i&&this._worksheetProtectionRuleModel.ruleRefresh(i.permissionId),s.length&&this._rangeProtectionRuleModel.ruleRefresh(n)}}))}_permissionCheckWithInsertRangeMove(e){var t;let r=eN(this._univerInstanceService);if(!r)return!1;let{worksheet:n,unitId:i,subUnitId:s}=r,a=R.Tools.deepClone(null==(t=this._selectionManagerService.getCurrentLastSelection())?void 0:t.range);return!(!a||("top"===e||"bottom"===e?a.endRow=n.getRowCount()-1:("left"===e||"right"===e)&&(a.endColumn=n.getColumnCount()-1),this._rangeProtectionRuleModel.getSubunitRuleList(i,s).map(e=>e.ranges).flat().some(e=>R.Rectangle.getIntersects(a,e))))}_permissionCheckByWorksheetCommand(e,t,r){var n,i;let s=eN(this._univerInstanceService,{unitId:t,subUnitId:r});if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=this._worksheetProtectionRuleModel.getRule(a,o),u=this._rangeProtectionRuleModel.getSubunitRuleList(a,o).length>0;return l||u?null!=(i=null==(n=this._permissionService.getPermissionPoint(new tP(a).id))?void 0:n.value)&&i:this._permissionService.composePermission(e.map(e=>new e(a).id)).every(e=>e.value)}permissionCheckWithoutRange(e){var t,r,n,i;let s=eN(this._univerInstanceService);if(!s)return!1;let{worksheet:a,unitId:o,subUnitId:l}=s,u=this._selectionManagerService.getCurrentLastSelection();if(!u)return!0;let c=null!=(r=null==(t=null==u?void 0:u.primary)?void 0:t.actualRow)?r:0,h=null!=(i=null==(n=null==u?void 0:u.primary)?void 0:n.actualColumn)?i:0,{workbookTypes:d,worksheetTypes:m,rangeTypes:g}=e;return!(d&&!0===d.some(e=>{var t,r;let n=new e(o);return(null!=(r=null==(t=this._permissionService.getPermissionPoint(n.id))?void 0:t.value)&&r)===!1})||m&&!0===m.some(e=>{var t,r;let n=new e(o,l);return(null!=(r=null==(t=this._permissionService.getPermissionPoint(n.id))?void 0:t.value)&&r)===!1})||g&&!0===g.some(e=>{var t,r,n,i,s;let u=null==(r=null==(t=a.getCell(c,h))?void 0:t.selectionProtection)?void 0:r[0];if(!(null!=u&&u.ruleId))return!1;let d=null==(n=this._rangeProtectionRuleModel.getRule(o,l,u.ruleId))?void 0:n.permissionId;if(!d)return!1;let m=new e(o,l,d);return(null!=(s=null==(i=this._permissionService.getPermissionPoint(m.id))?void 0:i.value)&&s)===!1}))}permissionCheckWithRanges(e,t,r,n){var i;let s=eN(this._univerInstanceService);if(!s)return!1;let{workbook:a,worksheet:o}=s;r||(r=a.getUnitId()),n||(n=o.getSheetId());let l=null!=t?t:null==(i=this._selectionManagerService.getCurrentSelections())?void 0:i.map(e=>e.range);if(!l)return!1;let{workbookTypes:u,worksheetTypes:c,rangeTypes:h}=e,d=[];return u&&d.push(...u.map(e=>new e(r).id)),c&&d.push(...c.map(e=>new e(r,n).id)),h&&this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(e=>{l.some(t=>e.ranges.some(e=>R.Rectangle.intersects(e,t)))&&d.push(...h.map(t=>new t(r,n,e.permissionId).id))}),!d.length||this._permissionService.composePermission(d).every(e=>e.value)}_permissionCheckByMoveCommand(e){let t=eN(this._univerInstanceService);if(!t)return!1;let{worksheet:r,unitId:n,subUnitId:i}=t,s=e.toRange;s.endRow===r.getRowCount()-1?s.endColumn=s.startColumn:s.endRow=s.startRow;let a=this._rangeProtectionRuleModel.getSubunitRuleList(n,i).reduce((e,t)=>[...e,...t.ranges],[]).filter(e=>R.Rectangle.intersects(e,s));return!(a.length>0)&&(a.forEach(e=>{var t,n;for(let i=e.startRow;i<=e.endRow;i++)for(let s=e.startColumn;s<=e.endColumn;s++){let e=null==(n=null==(t=r.getCell(i,s))?void 0:t.selectionProtection)?void 0:n[0];if((null==e?void 0:e[tb.Edit])===!1)return!1}}),!0)}_permissionCheckByMoveRangeCommand(e){let t=eN(this._univerInstanceService);if(!t)return!1;let{worksheet:r,unitId:n,subUnitId:i}=t,s=e.toRange,a=this._rangeProtectionRuleModel.getSubunitRuleList(n,i).reduce((e,t)=>[...e,...t.ranges],[]).filter(e=>R.Rectangle.intersects(e,s));return!(a.length>0)&&(a.forEach(e=>{var t,n;for(let i=e.startRow;i<=e.endRow;i++)for(let s=e.startColumn;s<=e.endColumn;s++){let e=null==(n=null==(t=r.getCell(i,s))?void 0:t.selectionProtection)?void 0:n[0];if((null==e?void 0:e[tb.Edit])===!1)return!1}}),!0)}_permissionCheckBySetRangeValue(e,t){let r=[];r=t.range?[t.range]:[new(0,R.ObjectMatrix)(t.value).getDataRange()];let{unitId:n,subUnitId:i}=t;return this.permissionCheckWithRanges(e,r,n,i)}_permissionCheckWithFormula(e){var t,r,n,i,s;let a=e.value,o=e.range,l=a.f;if(l){let a=l.substring(1),o=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET),u=null!=(t=e.unitId)?t:o.getUnitId(),c=this._definedNamesService.getValueByName(u,a);if(c){let e=c.formulaOrRefString;e.startsWith(I.operatorToken.EQUALS)&&(e=e.slice(1));let t=e.split(",");for(let e=0;e<t.length;e++){let i=t[e],s=(0,I.deserializeRangeWithSheet)(i);if(s.sheetName){let e=o.getSheetBySheetName(s.sheetName);if(!e)return!0;let{startRow:t,endRow:i,startColumn:a,endColumn:l}=s.range;for(let s=t;s<=i;s++)for(let t=a;t<=l;t++){let i=null==(n=null==(r=e.getCell(s,t))?void 0:r.selectionProtection)?void 0:n[0];if((null==i?void 0:i[tb.View])===!1)return!1}}}return!0}{let e=this._lexerTreeBuilder.sequenceNodesBuilder(l);if(!e)return!0;for(let t=0;t<e.length;t++){let r=e[t];if("string"==typeof r||r.nodeType!==I.sequenceNodeType.REFERENCE)continue;let{token:n}=r,a=(0,I.deserializeRangeWithSheetWithCache)(n),o=a.unitId?this._univerInstanceService.getUnit(a.unitId):this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!o)break;let l=a.sheetName?o.getSheetBySheetName(a.sheetName):o.getActiveSheet(),u=o.getUnitId();if(a.sheetName){if(!(l=o.getSheetBySheetName(a.sheetName)))return!0;let e=null==l?void 0:l.getSheetId();if(!this._permissionService.getPermissionPoint(new re(u,e).id))return!1}if(!l)break;let{startRow:c,endRow:h,startColumn:d,endColumn:m}=a.range;for(let e=c;e<=h;e++)for(let t=d;t<=m;t++){let r=null==(s=null==(i=l.getCell(e,t))?void 0:i.selectionProtection)?void 0:s[0];if((null==r?void 0:r[tb.View])===!1)return!1}}return!0}}if(o){let t=eN(this._univerInstanceService);if(!t)return!1;let r=e.unitId||t.unitId,n=e.subUnitId||t.subUnitId,i=this._rangeProtectionRuleModel.getSubunitRuleList(r,n).filter(e=>e.ranges.some(e=>R.Rectangle.intersects(e,o))).map(e=>new tN(r,n,e.permissionId).id);if(!this._permissionService.composePermission(i).every(e=>e.value))return!1}return!0}};aA=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aN(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aS(0,R.ICommandService),aS(1,R.IUniverInstanceService),aS(2,R.IPermissionService),aS(3,(0,b.Inject)(e1)),aS(4,(0,b.Inject)(H)),aS(5,(0,b.Inject)(q)),aS(6,(0,b.Inject)(R.LocaleService)),aS(7,(0,b.Inject)(I.LexerTreeBuilder)),aS(8,R.IContextService),aS(9,I.IDefinedNamesService)],aA);var av=Object.getOwnPropertyDescriptor,aT=(e,t)=>(r,n)=>t(r,n,e);let aw=class extends R.Disposable{constructor(e,t,r,n,i){super(),j(this,"_unitPermissionInitStateChange",new(0,S.BehaviorSubject)(!1)),j(this,"unitPermissionInitStateChange$",this._unitPermissionInitStateChange.asObservable()),this._permissionService=e,this._univerInstanceService=t,this._rangeProtectionRuleModel=r,this._worksheetProtectionRuleModel=n,this._worksheetProtectionPointModel=i,this._init()}_init(){let e=e=>{let t=e.getUnitId();iT().forEach(e=>{let r=new e(t);this._permissionService.addPermissionPoint(r)})};this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).forEach(t=>{e(t)}),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitAdded$(R.UniverInstanceType.UNIVER_SHEET).subscribe(t=>{e(t)})),this.disposeWithMe(this._univerInstanceService.getTypeOfUnitDisposed$(R.UniverInstanceType.UNIVER_SHEET).subscribe(e=>{let t=e.getUnitId();e.getSheets().forEach(e=>{let r=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(t,r).forEach(e=>{[...iS()].forEach(n=>{let i=new n(t,r,e.permissionId);this._permissionService.deletePermissionPoint(i.id)})}),[...iM(),...iO()].forEach(e=>{let n=new e(t,r);this._permissionService.deletePermissionPoint(n.id)})}),iT().forEach(e=>{let r=new e(t);this._permissionService.deletePermissionPoint(r.id)}),this._rangeProtectionRuleModel.deleteUnitModel(t),this._worksheetProtectionPointModel.deleteUnitModel(t),this._worksheetProtectionRuleModel.deleteUnitModel(t)}))}changeUnitInitState(e){this._unitPermissionInitStateChange.next(e)}};aw=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?av(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aT(0,(0,b.Inject)(R.IPermissionService)),aT(1,(0,b.Inject)(R.IUniverInstanceService)),aT(2,(0,b.Inject)(H)),aT(3,(0,b.Inject)(q)),aT(4,(0,b.Inject)(ib))],aw);var aM=Object.getOwnPropertyDescriptor,aO=(e,t)=>(r,n)=>t(r,n,e);let ax=class extends R.Disposable{constructor(e,t,r,n,i,s,a,o,l,u){super(),this._univerInstanceService=e,this._permissionService=t,this._authzIoService=r,this._rangeProtectionRuleModel=n,this._worksheetProtectionRuleModel=i,this._userManagerService=s,this._worksheetProtectionPointRuleModel=a,this._workbookPermissionService=o,this._undoRedoService=l,this._commandService=u}initPermission(){this._initRangePermissionFromSnapshot(),this._initRangePermissionChange(),this._initWorksheetPermissionFromSnapshot(),this._initWorksheetPermissionChange(),this._initWorksheetPermissionPointsChange(),this._initWorkbookPermissionFromSnapshot(),this._initUserChange(),this._refreshPermissionByCollaCreate()}async _initRangePermissionFromSnapshot(){let e=async e=>{let t=[],r=e.getUnitId(),n=e.getSheets(),i=new Map;if(n.forEach(e=>{let n=e.getSheetId();this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(e=>{i.set(e.permissionId,e),t.push({objectID:e.permissionId,unitID:r,objectType:tI.SelectRange,actions:iA})})}),!t.length)return void this._rangeProtectionRuleModel.changeRuleInitState(!0);this._authzIoService.batchAllowed(t).then(e=>{e.forEach(e=>{let t=i.get(e.objectID);t&&iS().forEach(n=>{let i=new n(r,t.subUnitId,e.objectID),s=i.subType,a=e.actions.find(e=>e.action===s);(null==a?void 0:a.allowed)!==void 0&&this._permissionService.updatePermissionPoint(i.id,a.allowed)})}),this._rangeProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).map(t=>e(t))),this._rangeProtectionRuleModel.changeRuleInitState(!0)}_initRangePermissionChange(){this.disposeWithMe(this._rangeProtectionRuleModel.ruleChange$.subscribe(e=>{"delete"!==e.type?this._authzIoService.allowed({objectID:e.rule.permissionId,unitID:e.unitId,objectType:tI.SelectRange,actions:iA}).then(t=>{iS().forEach(r=>{if("set"===e.type){let{rule:t,oldRule:r}=e;if(t.permissionId===(null==r?void 0:r.permissionId))return}let n=e.rule,i=new r(n.unitId,n.subUnitId,n.permissionId),s=i.subType,a=t.find(e=>e.action===s);a&&this._permissionService.updatePermissionPoint(i.id,a.allowed)}),this._rangeProtectionRuleModel.ruleRefresh(e.rule.permissionId)}):0===this._rangeProtectionRuleModel.getSubunitRuleList(e.unitId,e.subUnitId).length&&(this._worksheetProtectionPointRuleModel.deleteRule(e.unitId,e.subUnitId),[...iO()].forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,r.value)}))}))}async initWorkbookPermissionChange(e){var t;let r=e||(null==(t=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET))?void 0:t.getUnitId());if(r)return this._authzIoService.allowed({objectID:r,objectType:tI.Workbook,unitID:r,actions:iw}).then(e=>{iT().forEach(t=>{let n=new t(r),i=n.subType,s=e.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)})})}async _initWorkbookPermissionFromSnapshot(){await Promise.all(this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).map(e=>this.initWorkbookPermissionChange(e.getUnitId()))),this._workbookPermissionService.changeUnitInitState(!0)}_initWorksheetPermissionChange(){this.disposeWithMe(this._worksheetProtectionRuleModel.ruleChange$.subscribe(e=>{"delete"!==e.type?this._authzIoService.allowed({objectID:e.rule.permissionId,unitID:e.unitId,objectType:tI.Worksheet,actions:iA}).then(t=>{iM().forEach(r=>{let n=new r(e.unitId,e.subUnitId),i=n.subType,s=t.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)}),this._worksheetProtectionRuleModel.ruleRefresh(e.rule.permissionId)}):([...iM(),...iO()].forEach(t=>{let r=new t(e.unitId,e.subUnitId);this._permissionService.updatePermissionPoint(r.id,!0)}),this._worksheetProtectionPointRuleModel.deleteRule(e.unitId,e.subUnitId))}))}_initWorksheetPermissionPointsChange(){this.disposeWithMe(this._worksheetProtectionPointRuleModel.pointChange$.subscribe(e=>{this._authzIoService.allowed({objectID:e.permissionId,unitID:e.unitId,objectType:tI.Worksheet,actions:ix}).then(t=>{iO().forEach(r=>{let n=new r(e.unitId,e.subUnitId),i=n.subType,s=t.find(e=>e.action===i);s&&this._permissionService.updatePermissionPoint(n.id,s.allowed)})})}))}async _initWorksheetPermissionFromSnapshot(){let e=async e=>{let t=[],r=e.getUnitId(),n=e.getSheets(),i=new Map;if(n.forEach(e=>{let n=e.getSheetId(),s=this._worksheetProtectionRuleModel.getRule(r,n);s&&(i.set(s.permissionId,s),t.push({objectID:s.permissionId,unitID:r,objectType:tI.Worksheet,actions:iA}));let a=this._worksheetProtectionPointRuleModel.getRule(r,n);a&&(i.set(a.permissionId,a),t.push({objectID:a.permissionId,unitID:r,objectType:tI.Worksheet,actions:ix}))}),!t.length)return void this._worksheetProtectionRuleModel.changeRuleInitState(!0);this._authzIoService.batchAllowed(t).then(e=>{e.forEach(e=>{let t=i.get(e.objectID);t&&[...iM(),...iO()].forEach(n=>{let i=new n(r,t.subUnitId),s=i.subType,a=e.actions.find(e=>e.action===s);(null==a?void 0:a.allowed)!==void 0&&this._permissionService.updatePermissionPoint(i.id,a.allowed)})}),this._worksheetProtectionRuleModel.changeRuleInitState(!0)})};await Promise.all(this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).map(t=>e(t))),this._worksheetProtectionRuleModel.changeRuleInitState(!0)}_initUserChange(){this.disposeWithMe(this._userManagerService.currentUser$.pipe((0,U.skip)(1)).subscribe(()=>{let e=this._permissionService.getAllPermissionPoint();this._permissionService.clearPermissionMap(),this._worksheetProtectionRuleModel.changeRuleInitState(!1),this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).forEach(t=>{let r=t.getUnitId();iT().forEach(t=>{let n=new t(r);e.has(n.id)&&(n=e.get(n.id)),this._permissionService.addPermissionPoint(n)}),t.getSheets().forEach(t=>{let n=t.getSheetId();[...iM(),...iO()].forEach(t=>{let i=new t(r,n);e.has(i.id)&&(i=e.get(i.id)),this._permissionService.addPermissionPoint(i)}),this._rangeProtectionRuleModel.getSubunitRuleList(r,n).forEach(t=>{iS().forEach(i=>{let s=new i(r,n,t.permissionId);e.has(s.id)&&(s=e.get(s.id)),this._permissionService.addPermissionPoint(s)})})}),this._initWorkbookPermissionFromSnapshot(),this._initWorksheetPermissionFromSnapshot(),this._initRangePermissionFromSnapshot()})}))}refreshPermission(e,t){let r=this._worksheetProtectionRuleModel.getTargetByPermissionId(e,t),n=!1;if(r){let[i,s]=r;this._authzIoService.allowed({objectID:t,unitID:e,objectType:tI.Worksheet,actions:iA}).then(r=>{let i="";iM().forEach(t=>{var a;let o=new t(e,s),l=o.subType,u=r.find(e=>e.action===l);u&&((null==(a=this._permissionService.getPermissionPoint(o.id))?void 0:a.value)!==u.allowed&&(n=!0),this._permissionService.updatePermissionPoint(o.id,u.allowed),i+=`${u.action}_${u.allowed}`)}),this._worksheetProtectionRuleModel.ruleRefresh(`${t}_${i}`),n&&this._undoRedoService.clearUndoRedo(e)})}let i=this._worksheetProtectionPointRuleModel.getTargetByPermissionId(e,t);if(i){let[r,s]=i;this._authzIoService.allowed({objectID:t,unitID:e,objectType:tI.Worksheet,actions:ix}).then(t=>{iO().forEach(r=>{var i;let a=new r(e,s),o=a.subType,l=t.find(e=>e.action===o);l&&((null==(i=this._permissionService.getPermissionPoint(a.id))?void 0:i.value)!==l.allowed&&(n=!0),this._permissionService.updatePermissionPoint(a.id,l.allowed))}),n&&this._undoRedoService.clearUndoRedo(e)})}let s=this._rangeProtectionRuleModel.getTargetByPermissionId(e,t);if(s){let[r,i]=s;this._authzIoService.allowed({objectID:t,unitID:e,objectType:tI.SelectRange,actions:iA}).then(r=>{let s="";iS().forEach(a=>{var o;let l=new a(e,i,t),u=l.subType,c=r.find(e=>e.action===u);c&&((null==(o=this._permissionService.getPermissionPoint(l.id))?void 0:o.value)!==c.allowed&&(n=!0),this._permissionService.updatePermissionPoint(l.id,c.allowed),s+=`${c.action}_${c.allowed}`)}),this._rangeProtectionRuleModel.ruleRefresh(`${t}_${s}`),n&&this._undoRedoService.clearUndoRedo(e)})}}_refreshPermissionByCollaCreate(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{if(null!=t&&t.fromCollab&&(e.id===z.id||e.id===K.id||e.id===iL.id)){let t=e.params;this._undoRedoService.clearUndoRedo(t.unitId)}}))}};ax=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aM(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aO(0,R.IUniverInstanceService),aO(1,R.IPermissionService),aO(2,R.IAuthzIoService),aO(3,(0,b.Inject)(H)),aO(4,(0,b.Inject)(q)),aO(5,(0,b.Inject)(R.UserManagerService)),aO(6,(0,b.Inject)(ib)),aO(7,(0,b.Inject)(aw)),aO(8,(0,b.Inject)(R.IUndoRedoService)),aO(9,(0,b.Inject)(R.ICommandService))],ax);var aU=Object.getOwnPropertyDescriptor,aD=(e,t)=>(r,n)=>t(r,n,e);let aV=class extends R.Disposable{constructor(e,t,r){super(),j(this,"_cellRuleCache",new Map),j(this,"_permissionIdCache",new Map),j(this,"_cellInfoCache",new Map),j(this,"_rowInfoCache",new Map),j(this,"_colInfoCache",new Map),this._ruleModel=e,this._permissionService=t,this._univerInstanceService=r,this._initUpdateCellRuleCache(),this._initUpdateCellInfoCache(),this._initUpdateRowColInfoCache(),this._initCache()}_initCache(){this._univerInstanceService.getAllUnitsForType(R.UniverInstanceType.UNIVER_SHEET).forEach(e=>{e.getSheets().forEach(t=>{let r=e.getUnitId(),n=t.getSheetId();this.reBuildCache(r,n)})})}_initUpdateCellInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,v.filter)(e=>e.type===tI.SelectRange),(0,w.map)(e=>e)).subscribe(e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureCellInfoMap(r,t);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;for(let e=t;e<=r;e++)for(let t=n;t<=i;t++)a.delete(`${e}-${t}`)})}),this._ruleModel.ruleChange$.subscribe(e=>{var t;let{unitId:r,subUnitId:n}=e,i=this._ensureCellInfoMap(r,n);e.rule.ranges.forEach(e=>{R.Range.foreach(e,(e,t)=>{i.delete(`${e}-${t}`)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(e=>{R.Range.foreach(e,(e,t)=>{this._cellInfoCache.delete(`${e}-${t}`)})}))})}_initUpdateCellRuleCache(){this._ruleModel.ruleChange$.subscribe(e=>{let{type:t}=e;"add"===t?this._addCellRuleCache(e):"delete"===t?this._deleteCellRuleCache(e):(this._deleteCellRuleCache({...e,rule:e.oldRule}),this._addCellRuleCache(e))})}_ensureRuleMap(e,t){let r=this._cellRuleCache.get(e);r||(r=new Map,this._cellRuleCache.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}_ensureCellInfoMap(e,t){let r=this._cellInfoCache.get(e);r||(r=new Map,this._cellInfoCache.set(e,r));let n=r.get(t);return n||(n=new Map,r.set(t,n)),n}_ensureRowColInfoMap(e,t,r){let n="row"===r?this._rowInfoCache.get(e):this._colInfoCache.get(e);n||(n=new Map,"row"===r?this._rowInfoCache.set(e,n):this._colInfoCache.set(e,n));let i=n.get(t);return i||(i=new Map,n.set(t,i)),i}_addCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:s,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=s;t<=a;t++)i.set(`${e}-${t}`,n.id)}),this._permissionIdCache.set(n.permissionId,n.id)}_deleteCellRuleCache(e){let{subUnitId:t,unitId:r,rule:n}=e,i=this._ensureRuleMap(r,t),s=this._ensureCellInfoMap(r,t);n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:a}=e;for(let e=t;e<=r;e++)for(let t=n;t<=a;t++)i.delete(`${e}-${t}`),s.delete(`${e}-${t}`)}),this._permissionIdCache.delete(n.permissionId)}_getSelectionActions(e,t,r){var n,i,s,a,o,l,u,c;let h=null==(i=null==(n=this._permissionService.getPermissionPoint(new tN(e,t,r.permissionId).id))?void 0:n.value)||i,d=null==(a=null==(s=this._permissionService.getPermissionPoint(new tS(e,t,r.permissionId).id))?void 0:s.value)||a,m=null!=(l=null==(o=this._permissionService.getPermissionPoint(new iN(e,t,r.permissionId).id))?void 0:o.value)&&l,g=null!=(c=null==(u=this._permissionService.getPermissionPoint(new iI(e,t,r.permissionId).id))?void 0:u.value)&&c;return{[tb.Edit]:h,[tb.View]:d,[tb.ManageCollaborator]:m,[tb.Delete]:g}}reBuildCache(e,t){let r=this._ensureRuleMap(e,t),n=this._ensureCellInfoMap(e,t);r.clear(),n.clear();let i=this._ensureRowColInfoMap(e,t,"row"),s=this._ensureRowColInfoMap(e,t,"col");i.clear(),s.clear(),this._ruleModel.getSubunitRuleList(e,t).forEach(a=>{let o=this._getSelectionActions(e,t,a),l={...o,ruleId:a.id,ranges:a.ranges};a.ranges.forEach(e=>{let{startRow:t,endRow:u,startColumn:c,endColumn:h}=e;for(let e=t;e<=u;e++){let t=i.get(`${e}`);t?t.set(a.id,o):i.set(`${e}`,new Map([[a.id,o]]));for(let t=c;t<=h;t++){r.set(`${e}-${t}`,a.id),n.set(`${e}-${t}`,l);let i=s.get(`${t}`);i?i.set(a.id,o):s.set(`${t}`,new Map([[a.id,o]]))}}}),this._permissionIdCache.set(a.permissionId,a.id)})}getRowPermissionInfo(e,t,r,n){var i;let s=null==(i=this._rowInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}getColPermissionInfo(e,t,r,n){var i;let s=null==(i=this._colInfoCache.get(e))?void 0:i.get(t);if(!s)return!0;let a=s.get(`${r}`);return!a||n.every(e=>{for(let t of a.values())if(!1===t[e])return!1;return!0})}_initUpdateRowColInfoCache(){this._permissionService.permissionPointUpdate$.pipe((0,v.filter)(e=>e.type===tI.SelectRange),(0,w.map)(e=>e)).subscribe({next:e=>{let{subUnitId:t,unitId:r,permissionId:n}=e,i=this._permissionIdCache.get(n);if(!i)return;let s=this._ruleModel.getRule(r,t,i);if(!s)return;let a=this._ensureRowColInfoMap(r,t,"row"),o=this._ensureRowColInfoMap(r,t,"col"),l=this._getSelectionActions(r,t,s);s.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:s}=e;for(let e=t;e<=r;e++){let t=a.get(`${e}`);t?t.set(i,l):a.set(`${e}`,new Map([[i,l]]));for(let e=n;e<=s;e++){let t=o.get(`${e}`);t?t.set(i,l):o.set(`${e}`,new Map([[i,l]]))}}})}}),this._ruleModel.ruleChange$.subscribe(e=>{if("delete"===e.type){let{unitId:t,subUnitId:r,rule:n}=e,i=this._ensureRowColInfoMap(t,r,"row"),s=this._ensureRowColInfoMap(t,r,"col");n.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:a,endColumn:o}=e;for(let e=t;e<=r;e++){let t=i.get(`${e}`);null==t||t.delete(n.id);for(let e=a;e<=o;e++){let t=s.get(`${e}`);null==t||t.delete(n.id)}}})}})}getCellInfo(e,t,r,n){var i,s;let a=this._ensureCellInfoMap(e,t),o=a.get(`${r}-${n}`);if(o)return o;let l=null==(s=null==(i=this._cellRuleCache.get(e))?void 0:i.get(t))?void 0:s.get(`${r}-${n}`);if(!l)return;let u=this._ruleModel.getRule(e,t,l);if(u){let i={...this._getSelectionActions(e,t,u),ruleId:l,ranges:u.ranges};return a.set(`${r}-${n}`,i),i}}deleteUnit(e){this._cellRuleCache.delete(e),this._cellInfoCache.delete(e),this._rowInfoCache.delete(e),this._colInfoCache.delete(e);let t=this._univerInstanceService.getUnit(e);null==t||t.getSheets().forEach(t=>{let r=t.getSheetId();this._ruleModel.getSubunitRuleList(e,r).forEach(e=>{this._permissionIdCache.delete(e.permissionId)})})}};aV=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aU(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aD(0,(0,b.Inject)(H)),aD(1,(0,b.Inject)(R.IPermissionService)),aD(2,(0,b.Inject)(R.IUniverInstanceService))],aV);var aL=Object.getOwnPropertyDescriptor,aP=(e,t)=>(r,n)=>t(r,n,e);let aF=class extends R.Disposable{constructor(e,t,r,n){super(),this._permissionService=e,this._worksheetProtectionRuleModel=t,this._sheetInterceptorService=r,this._rangeProtectionCache=n,this._initViewModelByRangeInterceptor(),this._initViewModelBySheetInterceptor()}_initViewModelByRangeInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(J.CELL_CONTENT,{priority:999,effect:R.InterceptorEffectEnum.Value|R.InterceptorEffectEnum.Style,handler:(e={},t,r)=>{let{unitId:n,subUnitId:i,row:s,col:a}=t,o=this._rangeProtectionCache.getCellInfo(n,i,s,a);if(o){let t=!1===o[tb.View],n={...e,selectionProtection:[o]};return t?(delete n.s,delete n.v,delete n.p,n):r(n)}return r(e)}}))}_initViewModelBySheetInterceptor(){this.disposeWithMe(this._sheetInterceptorService.intercept(J.CELL_CONTENT,{priority:999,effect:R.InterceptorEffectEnum.Value|R.InterceptorEffectEnum.Style,handler:(e={},t,r)=>{var n,i,s,a,o;let{unitId:l,subUnitId:u}=t,c=this._worksheetProtectionRuleModel.getRule(l,u);if(null!=c&&c.permissionId){let t=[{[tb.View]:null!=(i=null==(n=this._permissionService.getPermissionPoint(new re(l,u).id))?void 0:n.value)&&i,[tb.Edit]:null!=(a=null==(s=this._permissionService.getPermissionPoint(new tq(l,u).id))?void 0:s.value)&&a}],c=!(null!=(o=t[0])&&o[tb.View]),h={...e,hasWorksheetRule:!0,selectionProtection:t};return c?(delete h.s,delete h.v,delete h.p,h):r(h)}return r(e)}}))}};aF=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aL(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aP(0,R.IPermissionService),aP(1,(0,b.Inject)(q)),aP(2,(0,b.Inject)(eo)),aP(3,(0,b.Inject)(aV))],aF);var ak=Object.getOwnPropertyDescriptor,aj=(e,t)=>(r,n)=>t(r,n,e);let aB=class{constructor(e,t){j(this,"_cache",new(0,R.LRUMap)(1e4)),this._selectionProtectionRuleModel=e,this._permissionService=t,this._init()}_init(){this._permissionService.permissionPointUpdate$.pipe((0,v.filter)(e=>e.type===tI.SelectRange),(0,v.filter)(e=>iS().some(t=>e instanceof t)),(0,w.map)(e=>e)).subscribe(e=>{for(let t of this._selectionProtectionRuleModel.getSubunitRuleList(e.unitId,e.subUnitId))t.permissionId===e.permissionId&&t.ranges.forEach(t=>{R.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})})}),this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{var t;e.rule.ranges.forEach(t=>{R.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}),"set"===e.type&&(null==(t=e.oldRule)||t.ranges.forEach(t=>{R.Range.foreach(t,(t,r)=>{let n=this._createKey(e.unitId,e.subUnitId,t,r);this._cache.delete(n)})}))})}_createKey(e,t,r,n){return`${e}_${t}_${r}_${n}`}getCellInfo(e,t,r,n){let i=this._selectionProtectionRuleModel.getSubunitRuleList(e,t);if(!i||!i.length)return[];let s=this._createKey(e,t,r,n),a=this._cache.get(s);if(a)return a;let o=[];for(let s of i)if(s.ranges.some(e=>e.startRow<=r&&e.endRow>=r&&e.startColumn<=n&&e.endColumn>=n)){let r=iS().reduce((r,n)=>{var i;let a=new n(e,t,s.permissionId),o=this._permissionService.getPermissionPoint(a.id);return r[a.subType]=null!=(i=null==o?void 0:o.value)?i:a.value,r},{});o.push({...r,ruleId:s.id,ranges:s.ranges})}return this._cache.set(s,o),o}clear(){this._cache.clear()}};aB=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ak(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aj(0,(0,b.Inject)(H)),aj(1,(0,b.Inject)(R.IPermissionService))],aB);let a$=(0,b.createIdentifier)("univer.exclusive-range-service");class aH extends R.Disposable{constructor(){super(...arguments),j(this,"_exclusiveRanges",new Map),j(this,"_exclusiveRangesChange$",new(0,D.Subject)),j(this,"exclusiveRangesChange$",this._exclusiveRangesChange$.asObservable())}_ensureUnitMap(e){return this._exclusiveRanges.has(e)||this._exclusiveRanges.set(e,new Map),this._exclusiveRanges.get(e)}_ensureSubunitMap(e,t){let r=this._ensureUnitMap(e);return r.has(t)||r.set(t,new Map),r.get(t)}_ensureFeature(e,t,r){let n=this._ensureSubunitMap(e,t);return n.has(r)||n.set(r,[]),n.get(r)}addExclusiveRange(e,t,r,n){let i=this._ensureFeature(e,t,r);i.push(...n),this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:i.map(e=>e.range)})}getExclusiveRanges(e,t,r){var n,i;return null==(i=null==(n=this._exclusiveRanges.get(e))?void 0:n.get(t))?void 0:i.get(r)}clearExclusiveRanges(e,t,r){let n=this.getExclusiveRanges(e,t,r);this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:(null==n?void 0:n.map(e=>e.range))||[]}),this._ensureFeature(e,t,r),this._exclusiveRanges.get(e).get(t).set(r,[])}clearExclusiveRangesByGroupId(e,t,r,n){let i=this.getExclusiveRanges(e,t,r);this._exclusiveRangesChange$.next({unitId:e,subUnitId:t,ranges:(null==i?void 0:i.map(e=>e.range))||[]});let s=this.getExclusiveRanges(e,t,r);if(s){let i=s.filter(e=>e.groupId!==n);this._exclusiveRanges.get(e).get(t).set(r,i)}}getInterestGroupId(e){let t=[];return e.forEach(e=>{var r;let n=e.range,{unitId:i,sheetId:s}=n;if(!i||!s)return;let a=null==(r=this._exclusiveRanges.get(i))?void 0:r.get(s);if(a)for(let e of a.keys()){let r=a.get(e);if(r){for(let i of r)if(R.Rectangle.intersects(n,i.range)){t.push(e);break}}}}),t}}var aW=Object.getOwnPropertyDescriptor,aG=(e,t)=>(r,n)=>t(r,n,e);let aY=class extends R.Disposable{constructor(e,t,r){super(),this._resourceManagerService=e,this._univerInstanceService=t,this._logService=r}getValue(e,t,r,n){let i=this._univerInstanceService.getUniverSheetInstance(e);if(!i)return;let s=null==i?void 0:i.getSheetBySheetId(t);if(!s)return;let a=i.getStyles(),o=s.getCellRaw(r,n);if(null!=o&&o.s){let e=a.get(o.s);if(null!=e&&e.n)return e.n}return null}deleteValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles();r.forEach(e=>{R.Range.foreach(e,(e,t)=>{let r=i.getCellRaw(e,t);if(!r)return;let n=null==r?void 0:r.s,a={...n&&s.get(n)||{}};delete a.n,r.s=s.setValue(a)})})}setValues(e,t,r){let n=this._univerInstanceService.getUniverSheetInstance(e);if(!n)return;let i=null==n?void 0:n.getSheetBySheetId(t);if(!i)return;let s=n.getStyles(),a=i.getCellMatrix();r.forEach(e=>{e.ranges.forEach(t=>{R.Range.foreach(t,(t,r)=>{let n=i.getCellRaw(t,r);if(n){let t={...s.getStyleByCell(n)||{},n:{pattern:e.pattern}};n.s=s.setValue(t)}else{let n={n:{pattern:e.pattern}},i=s.setValue(n);i&&a.setValue(t,r,{s:i})}})})})}};aY=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aW(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aG(0,R.IResourceManagerService),aG(1,R.IUniverInstanceService),aG(2,R.ILogService)],aY);var az=Object.getOwnPropertyDescriptor,aX=(e,t)=>(r,n)=>t(r,n,e);let aq=[eD.id,ex.id,eF.id,eL.id],aK=[rU.id,rV.id],aQ=class extends R.Disposable{constructor(e,t,r,n,i,s,a,o){super(),j(this,"disposableCollection",new(0,R.DisposableCollection)),this._selectionProtectionRuleModel=e,this._univerInstanceService=t,this._commandService=r,this._refRangeService=n,this._selectionProtectionRenderModel=i,this._rangeProtectionCache=s,this._sheetInterceptorService=a,this._rangeProtectionRuleModel=o,this._onRefRangeChange(),this._correctPermissionRange(),this._initReBuildCache(),this._initRemoveSheet()}_onRefRangeChange(){let e=(e,t)=>{let r=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!r||!(null==r?void 0:r.getSheetBySheetId(t)))return;this.disposableCollection.dispose();let n=r=>this.refRangeHandle(r,e,t);this._selectionProtectionRuleModel.getSubunitRuleList(e,t).reduce((e,t)=>[...e,...t.ranges],[]).forEach(r=>{this.disposableCollection.add(this._refRangeService.registerRefRange(r,n,e,t))})};this.disposeWithMe(this._commandService.onCommandExecuted(t=>{if(t.id===ie.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}if(t.id===nv.id||t.id===z.id){let r=t.params,n=r.subUnitId,i=r.unitId;if(!n||!i)return;e(i,n)}}));let t=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(t){let r=t.getActiveSheet();if(!r)return;e(t.getUnitId(),r.getSheetId())}}refRangeHandle(e,t,r){switch(e.id){case rP.id:return this._getRefRangeMutationsByMoveRows(e.params,t,r);case rk.id:return this._getRefRangeMutationsByMoveCols(e.params,t,r);case r_.id:return this._getRefRangeMutationsByInsertRows(e.params,t,r);case rS.id:return this._getRefRangeMutationsByInsertCols(e.params,t,r);case rK.id:return this._getRefRangeMutationsByDeleteCols(e.params,t,r);case rz.id:return this._getRefRangeMutationsByDeleteRows(e.params,t,r)}return{redos:[],undos:[]}}_getRefRangeMutationsByDeleteCols(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>R.Rectangle.intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=R.Tools.deepClone(n),o=a.ranges.reduce((e,t)=>{if(R.Rectangle.intersects(t,i)){let r=R.Tools.deepClone(t),{startColumn:n,endColumn:s}=i;if(n<=r.startColumn&&s>=r.endColumn)return e;n>=r.startColumn&&s<=r.endColumn?r.endColumn-=s-n+1:n<r.startColumn?(r.startColumn=n,r.endColumn-=s-n+1):s>r.endColumn&&(r.endColumn=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,a.ranges.length?(e.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})):(e.push({id:G.id,params:{unitId:t,subUnitId:r,ruleIds:[n.id]}}),s.push({id:z.id,params:{unitId:t,subUnitId:r,name:"",rules:[n]}}))}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByDeleteRows(e,t,r){let n=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(t=>t.ranges.some(t=>R.Rectangle.intersects(t,e.range))),i=e.range;if(n.length){let e=[],s=[];return n.forEach(n=>{let a=R.Tools.deepClone(n),o=a.ranges.reduce((e,t)=>{if(R.Rectangle.intersects(t,i)){let r=R.Tools.deepClone(t),{startRow:n,endRow:s}=i;if(n<=r.startRow&&s>=r.endRow)return e;n>=r.startRow&&s<=r.endRow?r.endRow-=s-n+1:n<r.startRow?(r.startRow=n,r.endRow-=s-n+1):s>r.endRow&&(r.endRow=n-1),this._checkIsRightRange(r)&&e.push(r)}return e},[]);a.ranges=o,e.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:n.id}}),s.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:n,ruleId:n.id}})}),{redos:e,undos:s}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertCols(e,t,r){let n=e.range.startColumn,i=e.range.endColumn-e.range.startColumn+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startColumn&&n<=e.endColumn));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=R.Tools.deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startColumn&&n<=e.endColumn&&(e.endColumn+=i,l=!0)}),l&&(e.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByInsertRows(e,t,r){let n=e.range.startRow,i=e.range.endRow-e.range.startRow+1,s=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n>e.startRow&&n<=e.endRow));if(s.length){let e=[],a=[];return s.forEach(s=>{let o=R.Tools.deepClone(s),l=!1;o.ranges.forEach(e=>{n>e.startRow&&n<=e.endRow&&(e.endRow+=i,l=!0)}),l&&(e.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:o,ruleId:s.id}}),a.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:s,ruleId:s.id}}))}),{redos:e,undos:a}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveRows(e,t,r){let n=e.toRange,i=n.startRow,s=n.endRow-n.startRow+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startRow&&i<=e.endRow));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=R.Tools.deepClone(a),u=e.fromRange.startRow,c=!1;l.ranges.forEach(e=>{i>e.startRow&&i<=e.endRow&&(u<e.startRow&&(e.startRow=e.startRow-s,e.endRow=e.endRow-s),e.endRow+=s,c=!0)}),c&&(n.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_getRefRangeMutationsByMoveCols(e,t,r){let n=e.toRange,i=n.startColumn,s=n.endColumn-n.startColumn+1,a=this._selectionProtectionRuleModel.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>i>e.startColumn&&i<=e.endColumn));if(a.length){let n=[],o=[];return a.forEach(a=>{let l=R.Tools.deepClone(a),u=e.fromRange.startColumn,c=!1;l.ranges.forEach(e=>{i>e.startColumn&&i<=e.endColumn&&(u<e.startColumn&&(e.startColumn=e.startColumn-s,e.endColumn=e.endColumn-s),e.endColumn+=s,c=!0)}),c&&(n.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:l,ruleId:a.id}}),o.push({id:nv.id,params:{unitId:t,subUnitId:r,rule:a,ruleId:a.id}}))}),{redos:n,undos:o}}return{undos:[],redos:[]}}_correctPermissionRange(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(aK.includes(e.id)){if(!e.params)return;let t=this._univerInstanceService.getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let{sourceRange:n,targetRange:i}=e.params,s=n.startColumn===i.startColumn&&n.endColumn===i.endColumn,a=s?n.endRow-n.startRow+1:n.endColumn-n.startColumn+1,o=s?n.startRow:n.startColumn,l=s?i.startRow:i.startColumn;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:i,endColumn:u}=e;R.Rectangle.intersects(e,n)||(s?o<t&&l>r?(t-=a,r-=a):o>r&&l<=t&&(t+=a,r+=a):o<i&&l>u?(i-=a,u-=a):o>u&&l<=i&&(i+=a,u+=a)),this._checkIsRightRange({startRow:t,endRow:r,startColumn:i,endColumn:u})&&(e.startColumn=i,e.endColumn=u,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:u,subUnitId:c}=e.params,h=e=>this.refRangeHandle(e,u,c);this._selectionProtectionRuleModel.getSubunitRuleList(u,c).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,h,u,c))}),this._selectionProtectionRenderModel.clear()}if(aq.includes(e.id)){let t=this._univerInstanceService.getUniverSheetInstance(e.params.unitId);if(!t)return;let r=t.getSheetBySheetId(e.params.subUnitId);if(!r)return;let n=e.params;if(!n)return;let{range:i}=n,s=e.id.includes("row"),a=e.id.includes("insert"),o=s?i.startRow:i.startColumn,l=s?i.endRow:i.endColumn,u=l-o+1;this._selectionProtectionRuleModel.getSubunitRuleList(t.getUnitId(),r.getSheetId()).forEach(e=>{e.ranges.forEach(e=>{let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e;a?s?o<=t&&(t+=u,r+=u):o<=n&&(n+=u,i+=u):s?l<t&&(t-=u,r-=u):l<n&&(n-=u,i-=u),this._checkIsRightRange({startRow:t,endRow:r,startColumn:n,endColumn:i})&&(e.startColumn=n,e.endColumn=i,e.startRow=t,e.endRow=r)})}),this.disposableCollection.dispose();let{unitId:c,subUnitId:h}=e.params,d=e=>this.refRangeHandle(e,c,h);this._selectionProtectionRuleModel.getSubunitRuleList(c,h).reduce((e,t)=>[...e,...t.ranges],[]).forEach(e=>{this.disposableCollection.add(this._refRangeService.registerRefRange(e,d,c,h))}),this._selectionProtectionRenderModel.clear()}}))}_checkIsRightRange(e){return e.startRow<=e.endRow&&e.startColumn<=e.endColumn}_initReBuildCache(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(aq.includes(e.id)||aK.includes(e.id)){let{unitId:t,subUnitId:r}=e.params;this._rangeProtectionCache.reBuildCache(t,r)}}))}_initRemoveSheet(){this._sheetInterceptorService.interceptCommand({getMutations:e=>{let t=[],r=[];if(e.id===rQ.id){let n=e.params,i=[],s=[];this._rangeProtectionRuleModel.getSubunitRuleList(n.unitId,n.subUnitId).forEach(e=>{i.push(e.id),s.push(e)}),i.length&&s.length&&(r.push({id:G.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,ruleIds:i}}),t.push({id:z.id,params:{unitId:n.unitId,subUnitId:n.subUnitId,name:"",rules:s}}))}return{redos:[],undos:t,preRedos:r,preUndos:[]}}})}};aQ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?az(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aX(0,(0,b.Inject)(H)),aX(1,(0,b.Inject)(R.IUniverInstanceService)),aX(2,R.ICommandService),aX(3,(0,b.Inject)(au)),aX(4,(0,b.Inject)(aB)),aX(5,(0,b.Inject)(aV)),aX(6,(0,b.Inject)(eo)),aX(7,(0,b.Inject)(H))],aQ);var aZ=Object.getOwnPropertyDescriptor,aJ=(e,t)=>(r,n)=>t(r,n,e);let a0=class extends R.Disposable{constructor(e,t,r,n,i){super(),this._selectionProtectionRuleModel=e,this._permissionService=t,this._resourceManagerService=r,this._selectionProtectionCache=n,this._univerInstanceService=i,this._initSnapshot(),this._initRuleChange()}_initRuleChange(){this.disposeWithMe(this._selectionProtectionRuleModel.ruleChange$.subscribe(e=>{switch(e.type){case"add":iS().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(r)});break;case"delete":iS().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.deletePermissionPoint(r.id)});break;case"set":e.oldRule.permissionId!==e.rule.permissionId&&iS().forEach(t=>{let r=new t(e.unitId,e.subUnitId,e.oldRule.permissionId);this._permissionService.deletePermissionPoint(r.id);let n=new t(e.unitId,e.subUnitId,e.rule.permissionId);this._permissionService.addPermissionPoint(n)})}}))}_initSnapshot(){this.disposeWithMe(this._resourceManagerService.registerPluginResource({toJson:e=>{let t=this._selectionProtectionRuleModel.toObject()[e];return t?JSON.stringify(t):""},parseJson:e=>{if(!e)return{};try{return JSON.parse(e)}catch{return{}}},pluginName:"SHEET_RANGE_PROTECTION_PLUGIN",businesses:[tR.UNIVER_SHEET],onLoad:(e,t)=>{let r=this._selectionProtectionRuleModel.toObject();r[e]=t,this._selectionProtectionRuleModel.fromObject(r);let n=[];Object.keys(t).forEach(r=>{let i=t[r];this._selectionProtectionRuleModel.getSubunitRuleList(e,r).forEach(t=>{n.push({objectID:t.permissionId,unitID:e,objectType:tI.SelectRange,actions:iA})}),i.forEach(t=>{iS().forEach(n=>{let i=new n(e,r,t.permissionId);i.value=!1,this._permissionService.addPermissionPoint(i)})}),this._selectionProtectionCache.reBuildCache(e,r)})},onUnLoad:e=>{this._selectionProtectionCache.deleteUnit(e)}}))}};a0=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?aZ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([aJ(0,(0,b.Inject)(H)),aJ(1,(0,b.Inject)(R.IPermissionService)),aJ(2,(0,b.Inject)(R.IResourceManagerService)),aJ(3,(0,b.Inject)(aV)),aJ(4,(0,b.Inject)(R.IUniverInstanceService))],a0);var a1=Object.getOwnPropertyDescriptor;let a2=class extends R.Disposable{constructor(e){super(),this._sheetRangeThemeModel=e}registerRangeTheme(e,t){this._sheetRangeThemeModel.registerRangeThemeStyle(e,t)}removeRangeThemeRule(e,t){this._sheetRangeThemeModel.removeRangeThemeRule(e,t)}getALLRegisterThemes(e){return this._sheetRangeThemeModel.getALLRegisteredTheme(e)}registerRangeThemeStyle(e,t){this._sheetRangeThemeModel.registerRangeThemeRule(e,t)}getAppliedRangeThemeStyle(e){return this._sheetRangeThemeModel.getRegisteredRangeThemeStyle(e)}getRegisteredRangeThemes(){return this._sheetRangeThemeModel.getRegisteredRangeThemes()}};a2=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a1(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(C=(0,b.Inject)(eb),(e,t)=>C(e,t,0))],a2);var a5=Object.getOwnPropertyDescriptor;let a3=class extends R.Disposable{constructor(e){super(),j(this,"_sheetSkeletonStore",new Map),this._injector=e,this.disposeWithMe(()=>{this._sheetSkeletonStore=new Map})}getSkeleton(e,t){if(this._sheetSkeletonStore.has(e))return this._sheetSkeletonStore.get(e).get(t)}setSkeleton(e,t,r){this._sheetSkeletonStore.has(e)||this._sheetSkeletonStore.set(e,new Map),this._sheetSkeletonStore.get(e).set(t,r)}deleteSkeleton(e,t){this._sheetSkeletonStore.has(e)&&this._sheetSkeletonStore.get(e).delete(t)}};a3=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a5(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(_=(0,b.Inject)(b.Injector),(e,t)=>_(e,t,0))],a3);var a4=Object.defineProperty,a6=Object.getOwnPropertyDescriptor,a9=(e,t,r)=>t in e?a4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a8=(e,t)=>(r,n)=>t(r,n,e),a7=(e,t,r)=>a9(e,"symbol"!=typeof t?t+"":t,r);let oe=class extends R.Plugin{constructor(e=sI,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=(0,R.merge)({},sI,this._config);this._configService.setConfig("sheets.config",n),this._initConfig(),this._initDependencies()}_initConfig(){var e,t,r;null!=(e=this._config)&&e.onlyRegisterFormulaRelatedMutations&&this._configService.setConfig(sd,!0),null!=(t=this._config)&&t.isRowStylePrecedeColumnStyle&&this._configService.setConfig(R.IS_ROW_STYLE_PRECEDE_COLUMN_STYLE,!0),null!=(r=this._config)&&r.autoHeightForMergedCells&&this._configService.setConfig(R.AUTO_HEIGHT_FOR_MERGED_CELLS,!0)}_initDependencies(){var e;let t=[[r9],[e1],[au],[aw],[ss,{useClass:aY}],[eo],[a2],[a3],[sy],[ay],[aI],[sv],[iV],[q],[ib],[aF],[ax],[aA],[eb],[aB],[H],[aV],[aQ],[a0],[a$,{useClass:aH,deps:[e1]}]];null!=(e=this._config)&&e.notExecuteFormula||t.push([sb]),(0,R.registerDependencies)(this._injector,(0,R.mergeOverrideWithDependencies)(t,this._config.override)),(0,R.touchDependencies)(this._injector,[[eo],[a0],[a$],[ax]])}onStarting(){(0,R.touchDependencies)(this._injector,[[sy],[ay],[aw],[iV],[aF],[a3]])}onRendered(){(0,R.touchDependencies)(this._injector,[[ss]])}onReady(){(0,R.touchDependencies)(this._injector,[[sb],[sv],[eb],[aI],[aB],[aQ],[au],[aA]])}};a7(oe,"pluginName","SHEET_PLUGIN"),a7(oe,"type",R.UniverInstanceType.UNIVER_SHEET),oe=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?a6(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(0,R.DependentOn)(I.UniverFormulaEnginePlugin),a8(1,(0,b.Inject)(b.Injector)),a8(2,R.IConfigService)],oe);var ot=((y=ot||{}).SET_WORKSHEET_ROW_HEIGHT="sheet.mutation.set-worksheet-row-height",y.SET_WORKSHEET_ROW_IS_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-is-auto-height",y.SET_WORKSHEET_ROW_AUTO_HEIGHT="sheet.mutation.set-worksheet-row-auto-height",y.SET_WORKSHEET_COL_WIDTH="sheet.mutation.set-worksheet-col-width",y.SET_WORKSHEET_ACTIVE="sheet.operation.set-worksheet-active",y.MOVE_ROWS="sheet.mutation.move-rows",y.MOVE_COLUMNS="sheet.mutation.move-columns",y.SET_COL_HIDDEN="sheet.mutation.set-col-hidden",y.SET_COL_VISIBLE="sheet.mutation.set-col-visible",y.SET_ROW_HIDDEN="sheet.mutation.set-row-hidden",y.SET_ROW_VISIBLE="sheet.mutation.set-row-visible",y.INSERT_COL="sheet.mutation.insert-col",y.INSERT_ROW="sheet.mutation.insert-row",y.REMOVE_COL="sheet.mutation.remove-col",y.REMOVE_ROW="sheet.mutation.remove-rows",y.TOGGLE_GRIDLINES="sheet.mutation.toggle-gridlines",y.SET_GRIDLINES_COLOR="sheet.mutation.set-gridlines-color",y),or=((E=or||{}).SET_RANGE_VALUES="sheet.mutation.set-range-values",E.MOVE_RANGE="sheet.mutation.move-range",E.REMOVE_WORKSHEET_MERGE="sheet.mutation.remove-worksheet-merge",E.ADD_WORKSHEET_MERGE="sheet.mutation.add-worksheet-merge",E.REORDER_RANGE="sheet.mutation.reorder-range",E.SET_WORKSHEET_DEFAULT_STYLE="sheet.mutation.set-worksheet-default-style",E.SET_ROW_DATA="sheet.mutation.set-row-data",E.SET_COL_DATA="sheet.mutation.set-col-data",E.SET_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.set-worksheet-range-theme-style",E.DELETE_WORKSHEET_RANGE_THEME_STYLE="sheet.mutation.delete-worksheet-range-theme-style",E);let on=[iG.id,iY.id,iz.id,ir.id,n7.id,rU.id,rV.id,nm.id,nf.id,nP.id,nV.id,eD.id,ex.id,eF.id,eL.id,i3.id,nS.id,ij.id,io.id],oi=[eW.id,tn.id,r1.id,rJ.id,r3.id,iu.id,nx.id,nc.id,eA.id,eT.id];function os(e){switch(e.id){case"sheet.mutation.set-range-values":{let t=e.params,r=new(0,R.ObjectMatrix)(t.cellValue).getDataRange();return -1===r.endRow?[]:t.cellValue?[{unitId:t.unitId,subUnitId:t.subUnitId,range:r}]:[]}case"sheet.mutation.move-range":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.from.subUnitId,range:new(0,R.ObjectMatrix)(t.from.value).getRange()},{unitId:t.unitId,subUnitId:t.to.subUnitId,range:new(0,R.ObjectMatrix)(t.to.value).getRange()}]}case"sheet.mutation.remove-worksheet-merge":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:e}))}case"sheet.mutation.add-worksheet-merge":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:e}))}case"sheet.mutation.reorder-range":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}]}case"sheet.mutation.set-worksheet-default-style":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:0,endRow:Number.MAX_SAFE_INTEGER,startColumn:0,endColumn:Number.MAX_SAFE_INTEGER}}]}case"sheet.mutation.set-row-data":{let t=e.params,r=Object.keys(t.rowData).map(Number);return 0===r.length?[]:[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:Math.min(...r),endRow:Math.max(...r),startColumn:0,endColumn:Number.MAX_SAFE_INTEGER}}]}case"sheet.mutation.set-col-data":{let t=e.params,r=Object.keys(t.columnData).map(Number);return 0===r.length?[]:[{unitId:t.unitId,subUnitId:t.subUnitId,range:{startRow:0,endRow:Number.MAX_SAFE_INTEGER,startColumn:Math.min(...r),endColumn:Math.max(...r)}}]}case"sheet.mutation.set-worksheet-range-theme-style":case"sheet.mutation.delete-worksheet-range-theme-style":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.range}]}default:return[]}}function oa(e,t){switch(e.id){case"sheet.mutation.set-worksheet-row-height":case"sheet.mutation.set-worksheet-row-is-auto-height":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:R.RANGE_TYPE.ROW}}))}case"sheet.mutation.set-worksheet-row-auto-height":{let r=e.params;return r.rowsAutoHeightInfo.map(e=>({unitId:r.unitId,subUnitId:r.subUnitId,range:{startRow:e.row,endRow:e.row,startColumn:0,endColumn:t-1,rangeType:R.RANGE_TYPE.ROW}}))}case"sheet.mutation.set-worksheet-col-width":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:R.RANGE_TYPE.COLUMN}}))}case"sheet.mutation.move-rows":case"sheet.mutation.move-columns":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:t.targetRange},{unitId:t.unitId,subUnitId:t.subUnitId,range:t.sourceRange}]}case"sheet.mutation.set-col-hidden":case"sheet.mutation.set-col-visible":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:R.RANGE_TYPE.COLUMN}}))}case"sheet.mutation.set-row-hidden":case"sheet.mutation.set-row-visible":{let t=e.params;return t.ranges.map(e=>({unitId:t.unitId,subUnitId:t.subUnitId,range:{...e,rangeType:R.RANGE_TYPE.ROW}}))}case"sheet.mutation.insert-col":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:R.RANGE_TYPE.COLUMN}}]}case"sheet.mutation.insert-row":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:R.RANGE_TYPE.ROW}}]}case"sheet.mutation.remove-col":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:R.RANGE_TYPE.COLUMN}}]}case"sheet.mutation.remove-rows":{let t=e.params;return[{unitId:t.unitId,subUnitId:t.subUnitId,range:{...t.range,rangeType:R.RANGE_TYPE.ROW}}]}default:return[]}}let oo=1.5,ol="rgba(255, 255, 255, 0.01)";function ou(e){let{rangeWithCoord:t,primaryWithCoord:r,style:n}=e,i={range:{startRow:t.startRow,startColumn:t.startColumn,endRow:t.endRow,endColumn:t.endColumn,rangeType:t.rangeType,unitId:t.unitId,sheetId:t.sheetId},primary:null,style:n};return null!=r&&(i.primary=oc(r)),i}function oc(e){let{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i}=e,{startRow:s,startColumn:a,endRow:o,endColumn:l}=e.mergeInfo;return{actualRow:t,actualColumn:r,isMerged:n,isMergedMainCell:i,startRow:s,startColumn:a,endRow:o,endColumn:l}}let oh=(e,t,r)=>{let n=e.get(e1).getCurrentSelections(),{value:i,selections:s,unitId:a,subUnitId:o}=t;if(n){let e=n[(null==n?void 0:n.length)-1].primary;if(e){let{actualColumn:t,actualRow:l}=e,{startRow:u,startColumn:c,endRow:h,endColumn:d}=s[s.length-1];if(i===R.Dimension.COLUMNS){let e=r.find(e=>e.startColumn===t&&e.endColumn===t&&l===e.startRow);e&&(d=e.endColumn,u=e.startRow,h=e.endRow)}else if(i===R.Dimension.ROWS){let e=r.find(e=>e.startRow===l&&e.endRow===l&&t===e.startColumn);e&&(h=e.endRow,c=e.startColumn,d=e.endColumn)}let m={startRow:u,startColumn:c,endRow:h,endColumn:d,actualRow:l,actualColumn:t,isMerged:!0,isMergedMainCell:u===l&&c===t},g=n.map((e,t,r)=>({range:e.range,style:null,primary:t===r.length-1?m:null})),f={unitId:a,subUnitId:o,type:eZ.ONLY_SET,selections:g};return{id:tp.id,params:f}}}return null},od=(e,t)=>{let r=e.get(e1).getCurrentSelections(),{unitId:n,subUnitId:i}=t;if(r&&r[(null==r?void 0:r.length)-1].primary){let e={unitId:n,subUnitId:i,type:eZ.ONLY_SET,selections:[...r]};return{id:tp.id,params:e}}return null};function om(e){return null!=e&&(void 0!==e.v&&null!==e.v&&""!==e.v||void 0!==e.p)}function og(e,t){return e&&e.spanAnchor?om(t.getValue(e.spanAnchor.startRow,e.spanAnchor.startColumn)):om(e)}function of(e,t,r){let n=r.getMaxRows(),i=r.getMaxColumns(),s=function(e,t,r,n,i){let s=e.getCellMatrix(),a=e.getSpanModel().getMergedCellRange(0,0,n,i),o=new(0,R.ObjectMatrix);return s.forValue((e,t)=>{let r=s.getValue(e,t);r&&o.setValue(e,t,r)}),a.forEach(e=>{let{startColumn:t,startRow:r,endColumn:n,endRow:i}=e;(0,R.createRowColIter)(r,i,t,n).forEach((e,a)=>{e===r&&a===t&&o.setValue(e,a,{...s.getValue(e,a),spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}),(e!==r||a!==t)&&(o.realDeleteValue(e,a),o.setValue(e,a,{spanAnchor:{startRow:r,endRow:i,startColumn:t,endColumn:n}}))})}),o}(r,0,0,n-1,i-1),a=r.getSnapshot().mergeData.length>0,{left:o,right:l,up:u,down:c}=t,h=!0,d={...e},m=[];for(;h;){if(h=!1,u&&0!==d.startRow){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endColumn:a}=e,o=null,l=!1;for(let e=s;e<=a;e++){let r=t.getValue(i-1,e);if(l=l||og(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startRow=e.startRow-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(c&&d.endRow!==n-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startColumn:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=s;e++){let r=t.getValue(a+1,e);if(l=l||og(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endRow=e.endRow+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(o&&0!==d.startColumn){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,startColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s-1);if(l=l||og(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.startColumn=e.startColumn-1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}if(l&&d.endColumn!==i-1){let{hasValue:e,range:t,spanAnchor:r}=function(e,t,r,n){let{startRow:i,endColumn:s,endRow:a}=e,o=null,l=!1;for(let e=i;e<=a;e++){let r=t.getValue(e,s+1);if(l=l||og(r,t),!n&&l)break;r&&r.spanAnchor&&(o=o?{startRow:Math.min(r.spanAnchor.startRow,o.startRow),startColumn:Math.min(r.spanAnchor.startColumn,o.startColumn),endRow:Math.max(r.spanAnchor.endRow,o.endRow),endColumn:Math.max(r.spanAnchor.endColumn,o.endColumn)}:{startRow:r.spanAnchor.startRow,startColumn:r.spanAnchor.startColumn,endRow:r.spanAnchor.endRow,endColumn:r.spanAnchor.endColumn})}return l?(e.endColumn=e.endColumn+1,{spanAnchor:o,hasValue:!0,range:e}):{spanAnchor:null,hasValue:!1,range:e}}(d,s,1,a);if(r&&m.push(r),e){d=t,h=!0;continue}}}return m.length>0&&(d=R.Rectangle.union(d,...m)),d}let op=(e,t,r,n=1,i=!0,s=!0)=>{let{startRow:a,endRow:o}=R.Range.transformRange(e,t),l=r.startRow-n,u=t.getMergedCell(l,r.startColumn),c=!u||u.startRow===l&&u.startColumn===r.startColumn;for(;!t.getRowVisible(l)||!c;)l--,c=!(u=t.getMergedCell(l,r.startColumn))||u.startRow===l&&u.startColumn===r.startColumn;return l>=a?{...r,startRow:l,endRow:l}:s?o_(e,t,{...r,startRow:o,endRow:o},n,i,!1):void 0},oC=(e,t,r,n=1,i=!0,s=!0)=>{let{startRow:a,endRow:o}=R.Range.transformRange(e,t),l=r.endRow+n,u=t.getMergedCell(l,r.startColumn),c=!u||u.startRow===l&&u.startColumn===r.startColumn;for(;!t.getRowVisible(l)||!c;)l++,c=!(u=t.getMergedCell(l,r.startColumn))||u.startRow===l&&u.startColumn===r.startColumn;return l<=o?{...r,startRow:l,endRow:l}:s?oy(e,t,{...r,startRow:a,endRow:a},n,i,!1):void 0},o_=(e,t,r,n=1,i=!0,s=!0)=>{let{startColumn:a,endColumn:o}=R.Range.transformRange(e,t),l=r.startColumn-n,u=t.getMergedCell(r.startRow,l),c=!u||u.startRow===r.startRow&&u.startColumn===l;for(;!t.getColVisible(l)||!c;)l--,c=!(u=t.getMergedCell(r.startRow,l))||u.startRow===r.startRow&&u.startColumn===l;return l>=a?{...r,startColumn:l,endColumn:l}:s?op(e,t,{...r,startColumn:o,endColumn:o},n,i,!1):void 0},oy=(e,t,r,n=1,i=!0,s=!0)=>{let{startColumn:a,endColumn:o}=R.Range.transformRange(e,t),l=r.endColumn+n,u=t.getMergedCell(r.startRow,l),c=!u||u.startRow===r.startRow&&u.startColumn===l;for(;!t.getColVisible(l)||!c;)l++,c=!(u=t.getMergedCell(r.startRow,l))||u.startRow===r.startRow&&u.startColumn===l;return l<=o?{...r,endColumn:l,startColumn:l}:s?oC(e,t,{...r,startColumn:a,endColumn:a},n,i,!1):void 0};function oE(e,t,r){let n=null;return r.getMatrixWithMergedCells(e,t,e,t).forValue((e,t,r)=>(n={actualRow:e,actualColumn:t,startRow:e,startColumn:t,isMerged:void 0!==r.rowSpan||void 0!==r.colSpan,isMergedMainCell:void 0!==r.rowSpan&&void 0!==r.colSpan,endRow:e+(void 0!==r.rowSpan?r.rowSpan-1:0),endColumn:t+(void 0!==r.colSpan?r.colSpan-1:0),rangeType:R.RANGE_TYPE.NORMAL},!1)),n||{actualColumn:t,actualRow:e,startRow:e,startColumn:t,endRow:e,endColumn:t,isMerged:!1,isMergedMainCell:!1,rangeType:R.RANGE_TYPE.NORMAL}}let oR=(e,t,r,n,i=1)=>{switch(n){case R.Direction.UP:return op(e,t,r,i);case R.Direction.DOWN:return oC(e,t,r,i);case R.Direction.LEFT:return o_(e,t,r,i);case R.Direction.RIGHT:return oy(e,t,r,i)}},ob=(e,t,r)=>{let n,i=-1,s;for(let t=0;t<e.length;t++)if(e[t].primary){n=e[t],i=t,s=n.primary;break}if(-1===i)return null;let a=t===R.Direction.LEFT||t===R.Direction.UP,o=a?i-1>=0?i-1:e.length-1:i+1<e.length?i+1:0,l=e[o];if(!n||!s)return null;let u={...s},{startRow:c,startColumn:h,endRow:d,endColumn:m}=n.range,g=a?u.startRow===c&&u.startColumn===h:u.endRow===d&&u.endColumn===m,f=g&&a;if(!R.Rectangle.equals(n.range,u)){let e=g?l.range:oR(n.range,r,u,t);if(!e)return null;let i=f?oE(e.endRow,e.endColumn,r):oE(e.startRow,e.startColumn,r);return{startRow:i.startRow,startColumn:i.startColumn,endRow:i.endRow,endColumn:i.endColumn}}let p=f?oE(l.range.endRow,l.range.endColumn,r):oE(l.range.startRow,l.range.startColumn,r);return{startRow:p.startRow,startColumn:p.startColumn,endRow:p.endRow,endColumn:p.endColumn}},oI={WorkbookCommentPermission:tA,WorkbookCopyPermission:tv,WorkbookCreateProtectPermission:tw,WorkbookCreateSheetPermission:tM,WorkbookDeleteSheetPermission:tO,WorkbookDuplicatePermission:tx,WorkbookEditablePermission:tU,WorkbookExportPermission:tD,WorkbookHideSheetPermission:tV,WorkbookHistoryPermission:tL,WorkbookManageCollaboratorPermission:tP,WorkbookMoveSheetPermission:tF,WorkbookPrintPermission:tk,WorkbookRecoverHistoryPermission:tj,WorkbookRenameSheetPermission:tB,WorkbookSharePermission:t$,WorkbookViewHistoryPermission:tW,WorkbookViewPermission:tH,WorksheetCopyPermission:tG,WorksheetDeleteColumnPermission:tY,WorksheetDeleteProtectionPermission:tz,WorksheetDeleteRowPermission:tX,WorksheetEditExtraObjectPermission:tK,WorksheetEditPermission:tq,WorksheetFilterPermission:tQ,WorksheetInsertColumnPermission:tZ,WorksheetInsertHyperlinkPermission:tJ,WorksheetInsertRowPermission:t0,WorksheetManageCollaboratorPermission:t1,WorksheetPivotTablePermission:t2,WorksheetSetCellStylePermission:t4,WorksheetSetCellValuePermission:t6,WorksheetSetColumnStylePermission:t9,WorksheetSetRowStylePermission:t8,WorksheetSortPermission:t7,WorksheetViewPermission:re,RangeProtectionPermissionEditPoint:tN,RangeProtectionPermissionViewPoint:tS},oN=(e,t,r,n)=>{let i=e.get(R.IPermissionService),s=e.get(H),a=i.getPermissionPoint(new tU(t).id);if(!(null!=a&&a.value))return!1;let o=i.getPermissionPoint(new tq(t,r).id);if(!(null!=o&&o.value))return!1;let l=s.getSubunitRuleList(t,r).filter(e=>e.ranges.some(e=>n.some(t=>R.Rectangle.intersects(e,t))));return!l.length||l.every(e=>{let n=e.permissionId,s=i.getPermissionPoint(new tN(t,r,n).id);return!!(null!=s&&s.value)})},oS={type:R.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge",handler:(e,t)=>{let r=e.get(R.ICommandService),n=e.get(R.IUndoRedoService),i=e.get(R.IUniverInstanceService),s=t.unitId,a=t.subUnitId,o=aC(t.selections,t.value),l=i.getUniverSheetInstance(s).getSheetBySheetId(a),u=[],c=[],h=o.some(e=>(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i),o=!1;return a.forValue((t,i,s)=>{if(s&&(t!==r||i!==n)&&e.cellHasValue(s))return o=!0,!1}),o})(l,e)),d={unitId:s,subUnitId:a,ranges:o},m={unitId:s,subUnitId:a,ranges:o};u.push({id:r1.id,params:d}),u.push({id:rJ.id,params:m});let g=r0(e,d),f=rZ(e,m);if(c.push({id:r1.id,params:f}),c.push({id:rJ.id,params:g}),h){let t=function(e,t,r,n){let i=[],s=[],a=r.getSheetId();return n.forEach(n=>{let o={unitId:t,subUnitId:a,cellValue:(function(e,t){let{startRow:r,startColumn:n,endColumn:i,endRow:s}=t,a=e.getMatrixWithMergedCells(r,n,s,i,R.CellModeEnum.Raw),o=new(0,R.ObjectMatrix);return a.forValue((e,t,i)=>{i&&(e!==r||t!==n)&&o.setValue(e,t,null)}),o})(r,n).getData()},l=eH(e,o);i.push({id:eW.id,params:l}),s.push({id:eW.id,params:o})}),{undos:i,redos:s}}(e,s,l,o);u.unshift(...t.redos),c.push(...t.undos)}return!!(0,R.sequenceExecute)(u,r).result&&(n.pushUndoRedo({unitID:s,undoMutations:c,redoMutations:u}),!0)}},oA={type:R.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-all",handler:async e=>{var t;let r=e.get(R.ICommandService),n=null==(t=e.get(e1).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(R.IUniverInstanceService).getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(oS.id,{selections:n,unitId:a,subUnitId:o})}},ov={type:R.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-vertical",handler:async e=>{var t;let r=e.get(R.ICommandService),n=null==(t=e.get(e1).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(R.IUniverInstanceService).getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(oS.id,{value:R.Dimension.COLUMNS,selections:n,unitId:a,subUnitId:o})}},oT={type:R.CommandType.COMMAND,id:"sheet.command.add-worksheet-merge-horizontal",handler:async e=>{var t;let r=e.get(R.ICommandService),n=null==(t=e.get(e1).getCurrentSelections())?void 0:t.map(e=>e.range);if(!(null!=n&&n.length))return!1;let i=e.get(R.IUniverInstanceService).getCurrentUnitForType(R.UniverInstanceType.UNIVER_SHEET);if(!i)return!1;let s=i.getActiveSheet();if(!s)return!1;let a=i.getUnitId(),o=s.getSheetId();return r.executeCommand(oS.id,{value:R.Dimension.ROWS,selections:n,unitId:a,subUnitId:o})}};function ow(e,t,r,n,i){let s=eN(e.get(R.IUniverInstanceService),{unitId:t,subUnitId:r});if(!s)return;let{worksheet:a}=s;if(a.getMergeData().some(e=>n.some(t=>R.Rectangle.intersects(t,e))))throw Error("The ranges to be merged overlap with the existing merged cells");e.get(R.ICommandService).executeCommand(oS.id,{unitId:t,subUnitId:r,selections:n,defaultMerge:i})}let oM=(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId).getSheetBySheetId(t.subUnitId).getConfig().rightToLeft;return{...R.Tools.deepClone(t),rightToLeft:r}},oO={id:"sheet.mutation.set-worksheet-right-to-left",type:R.CommandType.MUTATION,handler:(e,t)=>{let r=e.get(R.IUniverInstanceService).getUniverSheetInstance(t.unitId);if(!r)return!1;let n=r.getSheetBySheetId(t.subUnitId);return!!n&&(n.getConfig().rightToLeft=t.rightToLeft,!0)}},ox={type:R.CommandType.COMMAND,id:"sheet.command.set-worksheet-right-to-left",handler:async(e,t)=>{var r;let n=e.get(R.ICommandService),i=e.get(R.IUndoRedoService),s=eN(e.get(R.IUniverInstanceService),t);if(!s)return!1;let{unitId:a,subUnitId:o}=s,l=R.BooleanNumber.FALSE;t&&(l=null!=(r=t.rightToLeft)?r:R.BooleanNumber.FALSE);let u={rightToLeft:l,unitId:a,subUnitId:o},c=oM(e,u);return!!n.syncExecuteCommand(oO.id,u)&&(i.pushUndoRedo({unitID:a,undoMutations:[{id:oO.id,params:c}],redoMutations:[{id:oO.id,params:u}]}),!0)}}}),c("86b1c",function(e,t){let r,n,s,a,o,l,c,h,d,m,g,f,p,C,_,y,E,R,b,I,N,S,A,v,T,w,M,O,x,U,D,V,L,P;i(e.exports,"generateExecuteAstNodeData",function(){return ee}),i(e.exports,"getObjectValue",function(){return et}),i(e.exports,"BooleanValue",function(){return er}),i(e.exports,"isInDirtyRange",function(){return es}),i(e.exports,"ErrorType",function(){return ea}),i(e.exports,"ERROR_TYPE_SET",function(){return eo}),i(e.exports,"FunctionType",function(){return eu}),i(e.exports,"operatorToken",function(){return ec}),i(e.exports,"compareToken",function(){return eh}),i(e.exports,"matchToken",function(){return ef}),i(e.exports,"isFormulaLexerToken",function(){return eE}),i(e.exports,"includeFormulaLexerToken",function(){return eR}),i(e.exports,"normalizeSheetName",function(){return eb}),i(e.exports,"matchRefDrawToken",function(){return eI}),i(e.exports,"convertUnitDataToRuntime",function(){return eA}),i(e.exports,"isReferenceString",function(){return eY}),i(e.exports,"RegisterFunctionMutation",function(){return ez}),i(e.exports,"SetArrayFormulaDataMutation",function(){return eX}),i(e.exports,"getAbsoluteRefTypeWithSingleString",function(){return eQ}),i(e.exports,"getAbsoluteRefTypeWitString",function(){return eZ}),i(e.exports,"serializeRange",function(){return e0}),i(e.exports,"serializeRangeWithSheet",function(){return e1}),i(e.exports,"serializeRangeWithSpreadsheet",function(){return e2}),i(e.exports,"serializeRangeToRefString",function(){return e5}),i(e.exports,"singleReferenceToGrid",function(){return e3}),i(e.exports,"handleRefStringInfo",function(){return e4}),i(e.exports,"deserializeRangeWithSheet",function(){return e6}),i(e.exports,"isReferenceStringWithEffectiveColumn",function(){return e8}),i(e.exports,"getRangeWithRefsString",function(){return te}),i(e.exports,"isReferenceStrings",function(){return tt}),i(e.exports,"DefinedNamesService",function(){return to}),i(e.exports,"IDefinedNamesService",function(){return tl}),i(e.exports,"SetDefinedNameMutationFactory",function(){return tu}),i(e.exports,"SetDefinedNameMutation",function(){return tc}),i(e.exports,"RemoveDefinedNameMutation",function(){return th}),i(e.exports,"SetFeatureCalculationMutation",function(){return td}),i(e.exports,"RemoveFeatureCalculationMutation",function(){return tm}),i(e.exports,"SetFormulaCalculationStartMutation",function(){return tg}),i(e.exports,"SetFormulaCalculationStopMutation",function(){return tf}),i(e.exports,"SetFormulaCalculationNotificationMutation",function(){return tp}),i(e.exports,"SetFormulaCalculationResultMutation",function(){return tC}),i(e.exports,"SetFormulaDataMutation",function(){return t_}),i(e.exports,"SetOtherFormulaMutation",function(){return ty}),i(e.exports,"RemoveOtherFormulaMutation",function(){return tE}),i(e.exports,"SetSuperTableMutation",function(){return tR}),i(e.exports,"RemoveSuperTableMutation",function(){return tb}),i(e.exports,"SetSuperTableOptionMutation",function(){return tI}),i(e.exports,"deserializeRangeWithSheetWithCache",function(){return tM}),i(e.exports,"sequenceNodeType",function(){return tO}),i(e.exports,"generateStringWithSequence",function(){return tx}),i(e.exports,"LexerNode",function(){return tU}),i(e.exports,"LexerTreeBuilder",function(){return tL}),i(e.exports,"FormulaDataModel",function(){return tk}),i(e.exports,"initSheetFormulaData",function(){return tj}),i(e.exports,"ENGINE_FORMULA_PLUGIN_CONFIG_KEY",function(){return tG}),i(e.exports,"ENGINE_FORMULA_CYCLE_REFERENCE_COUNT",function(){return tY}),i(e.exports,"SheetRowFilteredService",function(){return tX}),i(e.exports,"ISheetRowFilteredService",function(){return tq}),i(e.exports,"FormulaCurrentConfigService",function(){return tZ}),i(e.exports,"IFormulaCurrentConfigService",function(){return tJ}),i(e.exports,"Lexer",function(){return t2}),i(e.exports,"handleNumfmtInCell",function(){return t9}),i(e.exports,"BaseValueObject",function(){return ro}),i(e.exports,"ErrorValueObject",function(){return ru}),i(e.exports,"strip",function(){return nG}),i(e.exports,"stripErrorMargin",function(){return nY}),i(e.exports,"NumberValueObject",function(){return nQ}),i(e.exports,"StringValueObject",function(){return nJ}),i(e.exports,"BooleanValueObject",function(){return nK}),i(e.exports,"NullValueObject",function(){return nX}),i(e.exports,"ValueObjectFactory",function(){return n3}),i(e.exports,"ArrayValueObject",function(){return n5}),i(e.exports,"BaseReferenceObject",function(){return n6}),i(e.exports,"AsyncObject",function(){return n9}),i(e.exports,"AsyncArrayObject",function(){return n8}),i(e.exports,"RangeReferenceObject",function(){return n7}),i(e.exports,"FormulaExecuteStageType",function(){return iC}),i(e.exports,"FormulaExecutedStateType",function(){return i_}),i(e.exports,"FormulaRuntimeService",function(){return iy}),i(e.exports,"IFormulaRuntimeService",function(){return iE}),i(e.exports,"AstRootNodeFactory",function(){return iv}),i(e.exports,"generateAstNode",function(){return iw}),i(e.exports,"IFunctionService",function(){return iO}),i(e.exports,"FunctionService",function(){return ix}),i(e.exports,"PrefixNodeFactory",function(){return iP}),i(e.exports,"FunctionNodeFactory",function(){return iH}),i(e.exports,"Interpreter",function(){return iG}),i(e.exports,"LambdaValueObjectObject",function(){return iX}),i(e.exports,"LambdaNodeFactory",function(){return iZ}),i(e.exports,"LambdaParameterNodeFactory",function(){return i0}),i(e.exports,"FUNCTION_NAMES_MATH",function(){return i2}),i(e.exports,"FUNCTION_NAMES_TEXT",function(){return i5}),i(e.exports,"OperatorNodeFactory",function(){return i6}),i(e.exports,"ReferenceNodeFactory",function(){return se}),i(e.exports,"SuffixNodeFactory",function(){return si}),i(e.exports,"UnionNodeFactory",function(){return so}),i(e.exports,"ValueNodeFactory",function(){return su}),i(e.exports,"AstTreeBuilder",function(){return sd}),i(e.exports,"DependencyManagerBaseService",function(){return sm}),i(e.exports,"DependencyManagerService",function(){return sg}),i(e.exports,"IDependencyManagerService",function(){return sf}),i(e.exports,"FeatureCalculationManagerService",function(){return sp}),i(e.exports,"IFeatureCalculationManagerService",function(){return sC}),i(e.exports,"OtherFormulaManagerService",function(){return s_}),i(e.exports,"IOtherFormulaManagerService",function(){return sy}),i(e.exports,"FormulaDependencyTreeType",function(){return sE}),i(e.exports,"FormulaDependencyTreeVirtual",function(){return sb}),i(e.exports,"FormulaDependencyTree",function(){return sI}),i(e.exports,"generateRandomDependencyTreeId",function(){return sA}),i(e.exports,"IFormulaDependencyGenerator",function(){return sv}),i(e.exports,"FormulaDependencyGenerator",function(){return sT}),i(e.exports,"DEFAULT_INTERVAL_COUNT",function(){return sO}),i(e.exports,"ICalculateFormulaService",function(){return sx}),i(e.exports,"CalculateFormulaService",function(){return sU}),i(e.exports,"CalculateController",function(){return sL}),i(e.exports,"deserializeRangeForR1C1",function(){return sj}),i(e.exports,"BaseFunction",function(){return sz}),i(e.exports,"FUNCTION_NAMES_ARRAY",function(){return sX}),i(e.exports,"functionArray",function(){return sq}),i(e.exports,"FUNCTION_NAMES_COMPATIBILITY",function(){return oi}),i(e.exports,"functionCompatibility",function(){return os}),i(e.exports,"functionCube",function(){return oa}),i(e.exports,"FUNCTION_NAMES_CUBE",function(){return oo}),i(e.exports,"CustomFunction",function(){return ol}),i(e.exports,"AsyncCustomFunction",function(){return ou}),i(e.exports,"FUNCTION_NAMES_DATABASE",function(){return og}),i(e.exports,"functionDatabase",function(){return of}),i(e.exports,"FUNCTION_NAMES_DATE",function(){return oj}),i(e.exports,"functionDate",function(){return oB}),i(e.exports,"FUNCTION_NAMES_ENGINEERING",function(){return oH}),i(e.exports,"functionEngineering",function(){return oW}),i(e.exports,"FUNCTION_NAMES_FINANCIAL",function(){return oG}),i(e.exports,"functionFinancial",function(){return le}),i(e.exports,"FUNCTION_NAMES_INFORMATION",function(){return lt}),i(e.exports,"functionInformation",function(){return lr}),i(e.exports,"FUNCTION_NAMES_LOGICAL",function(){return ln}),i(e.exports,"functionLogical",function(){return ls}),i(e.exports,"FUNCTION_NAMES_LOOKUP",function(){return la}),i(e.exports,"functionLookup",function(){return lo}),i(e.exports,"functionMath",function(){return lc}),i(e.exports,"functionMeta",function(){return ld}),i(e.exports,"FUNCTION_NAMES_STATISTICAL",function(){return lg}),i(e.exports,"functionStatistical",function(){return lp}),i(e.exports,"functionText",function(){return l$}),i(e.exports,"functionUniver",function(){return lH}),i(e.exports,"FUNCTION_NAMES_UNIVER",function(){return lW}),i(e.exports,"FUNCTION_NAMES_WEB",function(){return lG}),i(e.exports,"functionWeb",function(){return lY}),i(e.exports,"GlobalComputingStatusService",function(){return lz}),i(e.exports,"SuperTableService",function(){return l7}),i(e.exports,"ISuperTableService",function(){return ue}),i(e.exports,"ActiveDirtyManagerService",function(){return ui}),i(e.exports,"IActiveDirtyManagerService",function(){return us}),i(e.exports,"UniverFormulaEnginePlugin",function(){return ul});var F,k,j=u("7yNYd"),B=u("1ZKGP"),$=u("5LPkb"),H=u("5K4WI"),W=u("arCqp"),G=u("hciHF"),Y=u("1O3Nt"),z=u("c3hg1"),X=u("1mjSk"),q=u("2BOVU"),K=u("k2g5B"),Q=Object.defineProperty,Z=(e,t,r)=>t in e?Q(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,J=(e,t,r)=>Z(e,"symbol"!=typeof t?t+"":t,r);function ee(e,t=0,r=0){return{node:e,refOffsetX:t,refOffsetY:r}}function et(e){return e.isError()?e.getValue():e.isReferenceObject()?e.toArrayValueObject().toValue():e.isArray()?e.toValue():e.getValue()}var er=((r=er||{}).FALSE="FALSE",r.TRUE="TRUE",r),en=((n=en||{})[n.SUCCESS=0]="SUCCESS",n[n.ERROR=1]="ERROR",n),ei=((s=ei||{})[s.FRONT=0]="FRONT",s[s.BACK=1]="BACK",s);function es(e,t,r,n,i){for(let s=0,a=e.length;s<a;s++){let a=e[s];if(t!==a.unitId||r!==a.sheetId)continue;let{startRow:o,startColumn:l,endRow:u,endColumn:c}=a.range;if(n>=o&&n<=u&&i>=l&&i<=c)return!0}return!1}var ea=((a=ea||{}).DIV_BY_ZERO="#DIV/0!",a.NAME="#NAME?",a.VALUE="#VALUE!",a.NUM="#NUM!",a.NA="#N/A",a.CYCLE="#CYCLE!",a.REF="#REF!",a.SPILL="#SPILL!",a.CALC="#CALC!",a.ERROR="#ERROR!",a.CONNECT="#GETTING_DATA",a.NULL="#NULL!",a);let eo=new Set(Object.values(ea)),el=[...new Set(Object.values(ea).map(e=>e.length))];var eu=((o=eu||{})[o.Financial=0]="Financial",o[o.Date=1]="Date",o[o.Math=2]="Math",o[o.Statistical=3]="Statistical",o[o.Lookup=4]="Lookup",o[o.Database=5]="Database",o[o.Text=6]="Text",o[o.Logical=7]="Logical",o[o.Information=8]="Information",o[o.Engineering=9]="Engineering",o[o.Cube=10]="Cube",o[o.Compatibility=11]="Compatibility",o[o.Web=12]="Web",o[o.Array=13]="Array",o[o.Univer=14]="Univer",o[o.User=15]="User",o[o.DefinedName=16]="DefinedName",o),ec=((l=ec||{}).PLUS="+",l.MINUS="-",l.MULTIPLY="*",l.DIVIDED="/",l.CONCATENATE="&",l.POWER="^",l.EQUALS="=",l.NOT_EQUAL="<>",l.GREATER_THAN=">",l.GREATER_THAN_OR_EQUAL=">=",l.LESS_THAN="<",l.LESS_THAN_OR_EQUAL="<=",l),eh=((c=eh||{}).EQUALS="=",c.NOT_EQUAL="<>",c.GREATER_THAN=">",c.GREATER_THAN_OR_EQUAL=">=",c.LESS_THAN="<",c.LESS_THAN_OR_EQUAL="<=",c);let ed=new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),em=new Set(ed.keys()),eg=new Set(["=","<>",">",">=","<","<="]);var ef=((h=ef||{}).OPEN_BRACKET="(",h.CLOSE_BRACKET=")",h.COMMA=",",h.SINGLE_QUOTATION="'",h.DOUBLE_QUOTATION='"',h.OPEN_BRACES="{",h.CLOSE_BRACES="}",h.COLON=":",h.OPEN_SQUARE_BRACKET="[",h.CLOSE_SQUARE_BRACKET="]",h),ep=((d=ep||{}).PERCENTAGE="%",d.POUND="#",d);let eC=new Set(["%","#"]);var e_=((m=e_||{}).AT="@",m.MINUS="-",m.PLUS="+",m);let ey=[...Object.values(eh),...Object.values(ec),...Object.values(ef),...Object.values(ep),...Object.values(e_)];function eE(e){return ey.includes(e)}function eR(e){for(let t of ey)if(e.indexOf(t)>-1)return!0;return!1}function eb(e){return"'"===e[0]&&"'"===e[e.length-1]?e.substring(1,e.length-1):e}function eI(e){return eE(e)&&e!==ef.CLOSE_BRACES&&e!==ef.CLOSE_BRACKET&&e!==ef.SINGLE_QUOTATION&&e!==ef.DOUBLE_QUOTATION||" "===e}let eN=new Set([ec.PLUS,ec.MINUS,ec.MULTIPLY,ec.DIVIDED,ec.CONCATENATE,ec.POWER,ec.EQUALS,ec.NOT_EQUAL,ec.GREATER_THAN,ec.GREATER_THAN_OR_EQUAL,ec.LESS_THAN,ec.LESS_THAN_OR_EQUAL,ef.OPEN_BRACKET,ef.COMMA,ef.COLON,ef.OPEN_BRACES,ef.OPEN_SQUARE_BRACKET]),eS=new Set([ec.PLUS,ec.MINUS,ec.MULTIPLY,ec.DIVIDED,ec.CONCATENATE,ec.POWER,ec.EQUALS,ec.NOT_EQUAL,ec.GREATER_THAN,ec.GREATER_THAN_OR_EQUAL,ec.LESS_THAN,ec.LESS_THAN_OR_EQUAL,ef.OPEN_BRACKET,ef.COMMA,ef.COLON,ef.OPEN_BRACES,ef.OPEN_SQUARE_BRACKET,ep.PERCENTAGE,ep.POUND]);function eA(e){let t={};return Object.keys(e).forEach(r=>{let n=e[r];if(null==n)return!0;null==t[r]&&(t[r]={}),Object.keys(n).forEach(e=>{let i=n[e];t[r][e]=new(0,j.ObjectMatrix)(i)})}),t}let ev='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',eT=new RegExp(ev),ew="\\s*?:\\s*?",eM="[A-Za-z]+",eO="[1-9][0-9]*",ex=`'?(${ev})?(((?![\\[\\]\\/?*\\\\]).)*!)?'?`,eU=`\\$?${eM}\\$?${eO}`,eD=RegExp(`^(${e_.AT})?${ex}${eU}${ew}${eU}$`),eV=RegExp(`^${ex}\\s*?${eU}(${ep.POUND})?$`),eL=RegExp(`^${ex}\\$?${eO}${ew}\\$?${eO}$`),eP=RegExp(`^${ex}\\$?${eM}${ew}\\$?${eM}$`),eF=RegExp(`^${ex}\\s*?\\$?${eO}$`),ek=RegExp(`^${ex}\\s*?\\$?${eM}$`),ej=RegExp("{.*?}","g");function eB(e){return eV.lastIndex=0,eV.test(e)}function e$(e){return eL.lastIndex=0,eL.test(e)}function eH(e){return eP.lastIndex=0,eP.test(e)}function eW(e){return eF.lastIndex=0,eF.test(e)}function eG(e){return ek.lastIndex=0,ek.test(e)}function eY(e){return eB(e)||(eD.lastIndex=0,eD.test(e))||e$(e)||eH(e)}let ez={id:"formula.mutation.register-function",type:j.CommandType.MUTATION,handler:()=>!0},eX={id:"formula.mutation.set-array-formula-data",type:j.CommandType.MUTATION,handler:(e,t)=>!0},eq=/[^0-9]/g,eK=/[^A-Za-z]/g;function eQ(e){let t="$"===e[0],r=e.substring(1),n=r.indexOf("$")>-1;return j.Tools.isStringNumber(r)&&t&&!n&&(t=!1,n=!0),t&&n?j.AbsoluteRefType.ALL:t?j.AbsoluteRefType.COLUMN:n?j.AbsoluteRefType.ROW:j.AbsoluteRefType.NONE}function eZ(e){let t=e.split("!");t.length>1&&(e=t[t.length-1]);let r=e.split(":");return r.length>1?{startAbsoluteRefType:eQ(r[0]),endAbsoluteRefType:eQ(r[1])}:{startAbsoluteRefType:eQ(r[0])}}function eJ(e=j.AbsoluteRefType.NONE){let t="",r="";return e===j.AbsoluteRefType.ROW?t="$":e===j.AbsoluteRefType.COLUMN?r="$":e===j.AbsoluteRefType.ALL&&(t="$",r="$"),{rowAbsoluteString:t,columnAbsoluteString:r}}function e0(e){let{startColumn:t,startRow:r,endColumn:n,endRow:i,startAbsoluteRefType:s,endAbsoluteRefType:a,rangeType:o=j.RANGE_TYPE.NORMAL}=e,l=eJ(s),u=eJ(a);if(o===j.RANGE_TYPE.ROW||o===j.RANGE_TYPE.ALL){let e=`${l.rowAbsoluteString}${r+1}`,t=`${u.rowAbsoluteString}${i+1}`;return`${e}:${t}`}if(o===j.RANGE_TYPE.COLUMN){let e=`${l.columnAbsoluteString}${j.Tools.chatAtABC(t)}`,r=`${u.columnAbsoluteString}${j.Tools.chatAtABC(n)}`;return`${e}:${r}`}let c=`${l.columnAbsoluteString}${j.Tools.chatAtABC(t)}${l.rowAbsoluteString}${r+1}`,h=`${u.columnAbsoluteString}${j.Tools.chatAtABC(n)}${u.rowAbsoluteString}${i+1}`;return c===h?c:`${c}:${h}`}function e1(e,t){return`${tn(e)}!${e0(t)}`}function e2(e,t,r){return tr(e)||tr(t)?`'[${ti(e)}]${ti(t)}'!${e0(r)}`:`[${e}]${t}!${e0(r)}`}function e5(e){let{unitId:t,sheetName:r,range:n}=e;return null!=t&&t.length>0&&null!=r&&r.length>0?e2(t,r,n):null!=r&&r.length>0?e1(r,n):e0(n)}function e3(e){let t=Number.parseInt(e.replace(eq,""))-1;return{row:t,column:j.Tools.ABCatNum(e.replace(eK,"")),absoluteRefType:eQ(e)}}function e4(e){let t=eT.exec(e),r="";null!=t&&(r=ts((r=t[0].trim()).slice(1,r.length-1)),e=e.replace(eT,""));let n=e.indexOf("!"),i="",s="";return n>-1?("'"===(i=e.substring(0,n))[0]&&"'"===i[i.length-1]&&(i=i.substring(1,i.length-1)),i=ts(i),s=e.substring(n+1)):s=e,{refBody:s,sheetName:i,unitId:r}}function e6(e){let{refBody:t,sheetName:r,unitId:n}=e4(e),i=t.indexOf(":");if(-1===i){let e=e3(t),i=e.row,s=e.column,a=e.absoluteRefType;return{unitId:n,sheetName:r,range:{startRow:i,startColumn:s,endRow:i,endColumn:s,startAbsoluteRefType:a,endAbsoluteRefType:a}}}let s=t.substring(0,i),a=t.substring(i+1),o=e3(s),l=e3(a),u=o.row>l.row?l.row:o.row,c=o.column>l.column?l.column:o.column,h=o.row>l.row?o.row:l.row,d=o.column>l.column?o.column:l.column,m=j.RANGE_TYPE.NORMAL;return Number.isNaN(u)&&Number.isNaN(h)?m=j.RANGE_TYPE.COLUMN:Number.isNaN(c)&&Number.isNaN(d)&&(m=j.RANGE_TYPE.ROW),{unitId:n,sheetName:r,range:{startRow:u,startColumn:c,endRow:h,endColumn:d,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:l.absoluteRefType,rangeType:m}}}let e9=["LOG10"];function e8(e){let t=e7(e);if(!eY(t)||e9.includes(t.toUpperCase().trim()))return!1;let{range:r}=e6(t);return!(r.endColumn>=16384)}function e7(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(" "!==i||r){if(!r&&(i===e_.AT||i===e_.MINUS||i===e_.PLUS))continue;t.push(i),r=!0}else t.push(i)}return t.join("")}function te(e,t){let r=(null==e?void 0:e.split(","))||[];return""===e||0===r.length?[]:tt(e)?r.map(e=>{let r=e6(e);return{unitId:r.unitId,sheetId:t(r.sheetName),range:r.range,sheetName:r.sheetName}}):[]}function tt(e){return((null==e?void 0:e.split(","))||[]).every(e=>e8(e.trim()))}function tr(e){var t,r;return 0!==e.length&&!!(eR(e)||function(e){let t=e.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(e)&&null!==t}(e)||(t=e,/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(t))||(r=e,!RegExp("^\\p{Letter}","u").test(r.charAt(0)))||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?]/.test(e))}function tn(e){return tr(e)?`'${ti(e)}'`:e}function ti(e){return e.replace(/'/g,"''")}function ts(e){return e.replace(/''/g,"'")}var ta=Object.getOwnPropertyDescriptor;let to=class extends j.Disposable{constructor(e){super(),J(this,"_definedNameMap",{}),J(this,"_nameCacheMap",{}),J(this,"_update$",new(0,X.Subject)),J(this,"update$",this._update$.asObservable()),J(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),J(this,"_currentRange$",new(0,X.Subject)),J(this,"currentRange$",this._currentRange$.asObservable()),J(this,"_focusRange$",new(0,X.Subject)),J(this,"focusRange$",this._focusRange$.asObservable()),this._univerInstanceService=e}dispose(){super.dispose(),this._definedNameMap={},this._nameCacheMap={},this._update$.complete(),this._currentRange$.complete(),this._focusRange$.complete()}getWorksheetByRef(e,t){var r;let{sheetName:n}=e4(t);return null==(r=this._univerInstanceService.getUnit(e))?void 0:r.getSheetBySheetName(n)}focusRange(e,t){let r=this.getValueById(e,t);void 0!==r&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return e0(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._updateCache(e),this._update()}registerDefinedName(e,t){void 0===this._definedNameMap[e]&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._updateCache(e),this._update()}removeDefinedName(e,t){var r;null==(r=this._definedNameMap[e])||delete r[t],this._updateCache(e),this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._updateCache(e),this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){let r=this._nameCacheMap[e];if(r)return r[t]||null;let n=this._definedNameMap[e];if(void 0===n)return null;let i=null;for(let e of Object.values(n))if(e.name===t){i=e;break}return i&&(this._nameCacheMap[e]=this._nameCacheMap[e]||{},this._nameCacheMap[e][t]=i),i}getValueById(e,t){var r;return null==(r=this._definedNameMap[e])?void 0:r[t]}hasDefinedName(e){return void 0!==this._definedNameMap[e]&&0!==(Array.from(Object.values(this._definedNameMap[e])).length||0)}_update(){this._update$.next(null)}_updateCache(e){let t=this._definedNameMap[e];if(void 0===t)return void delete this._nameCacheMap[e];for(let r of(this._nameCacheMap[e]={},Object.values(t)))this._nameCacheMap[e][r.name]=r}};to=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ta(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(g=j.IUniverInstanceService,(e,t)=>g(e,t,0))],to);let tl=(0,B.createIdentifier)("univer.formula.defined-names.service"),tu=(e,t)=>{let{unitId:r,id:n}=t;return{...e.get(tl).getValueById(r,n),unitId:r}},tc={id:"formula.mutation.set-defined-name",type:j.CommandType.MUTATION,handler:(e,t)=>{if(null==t)return!1;let r=e.get(tl),{id:n,unitId:i,name:s,formulaOrRefString:a,comment:o,hidden:l,localSheetId:u}=t;return r.registerDefinedName(i,{id:n,name:s.trim(),formulaOrRefString:a.trim(),comment:null==o?void 0:o.trim(),hidden:l,localSheetId:u}),!0}},th={id:"formula.mutation.remove-defined-name",type:j.CommandType.MUTATION,handler:(e,t)=>{if(null==t)return!1;let r=e.get(tl),{unitId:n,id:i}=t;return r.removeDefinedName(n,i),!0}},td={id:"formula.mutation.set-feature-calculation",type:j.CommandType.MUTATION,handler:()=>!0},tm={id:"formula.mutation.remove-feature-calculation",type:j.CommandType.MUTATION,handler:()=>!0},tg={id:"formula.mutation.set-formula-calculation-start",type:j.CommandType.MUTATION,handler:()=>!0},tf={id:"formula.mutation.set-formula-calculation-stop",type:j.CommandType.MUTATION,handler:()=>!0},tp={id:"formula.mutation.set-formula-calculation-notification",type:j.CommandType.MUTATION,handler:()=>!0},tC={id:"formula.mutation.set-formula-calculation-result",type:j.CommandType.MUTATION,handler:()=>!0},t_={id:"formula.mutation.set-formula-data",type:j.CommandType.MUTATION,handler:(e,t)=>!0},ty={id:"formula.mutation.set-other-formula",type:j.CommandType.MUTATION,handler:()=>!0},tE={id:"formula.mutation.remove-other-formula",type:j.CommandType.MUTATION,handler:()=>!0},tR={id:"formula.mutation.set-super-table",type:j.CommandType.MUTATION,handler:()=>!0},tb={id:"formula.mutation.remove-super-table",type:j.CommandType.MUTATION,handler:()=>!0},tI={id:"formula.mutation.set-super-table-option",type:j.CommandType.MUTATION,handler:()=>!0};class tN{constructor(e){J(this,"_cache"),this._cache=new(0,j.LRUMap)(e)}set(e,t){let r=this._hash(e);this._cache.set(r,t)}get(e){let t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}delete(e){this._cache.delete(this._hash(e))}forEach(e,t){this._cache.forEach(e,t)}_hash(e){return e.length<=64?e:(0,j.hashAlgorithm)(e).toString()}}let tS="LR_1",tA="LO_1",tv="LAMBDA",tT=new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),tw=new tN(1e5);function tM(e){let t=tw.get(e);if(t)return t;let r=e6(e);return tw.set(e,r),e6(e)}var tO=((f=tO||{})[f.NORMAL=0]="NORMAL",f[f.NUMBER=1]="NUMBER",f[f.STRING=2]="STRING",f[f.FUNCTION=3]="FUNCTION",f[f.REFERENCE=4]="REFERENCE",f[f.ARRAY=5]="ARRAY",f[f.DEFINED_NAME=6]="DEFINED_NAME",f);function tx(e){let t="";for(let r of e)"string"==typeof r?t+=r:t+=r.token;return t}class tU{constructor(){J(this,"_parent"),J(this,"_token","R_1"),J(this,"_children",[]),J(this,"_lambdaId"),J(this,"_functionDefinitionPrivacyVar"),J(this,"_lambdaParameter",""),J(this,"_startIndex",-1),J(this,"_endIndex",-1),J(this,"_definedNames",[])}dispose(){var e;this._children.forEach(e=>{"string"!=typeof e&&e.dispose()}),null==(e=this._functionDefinitionPrivacyVar)||e.clear(),this._functionDefinitionPrivacyVar=null,this._children=[],this._parent=null,this._definedNames=[]}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){let r=this._getIndexInParent(e);null!=r&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){let t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){let t=this._getIndexInParent(e);null!=t&&this.getChildren().splice(t,1)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];n instanceof tU?r.push(n.serialize()):r.push(n)}return{token:e,st:this._startIndex,ed:this._endIndex,children:r}}_getIndexInParent(e){let t=this.getChildren(),r=t.length;for(let n=0;n<r;n++)if(t[n]===e)return n}}let tD=new tN(2e3),tV=new tN(2e3);class tL extends j.Disposable{constructor(){super(...arguments),J(this,"_currentLexerNode",new tU),J(this,"_upLevel",0),J(this,"_segment",""),J(this,"_bracketState",[]),J(this,"_squareBracketState",0),J(this,"_bracesState",0),J(this,"_singleQuotationState",0),J(this,"_doubleQuotationState",0),J(this,"_lambdaState",!1),J(this,"_colonState",!1),J(this,"_formulaErrorCount",0),J(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),tD.clear(),tV.clear()}getUpLevel(){return this._upLevel}isColonClose(){return!1===this._colonState}isColonOpen(){return!0===this._colonState}isDoubleQuotationClose(){return 0===this._doubleQuotationState}isLambdaOpen(){return!0===this._lambdaState}isLambdaClose(){return!1===this._lambdaState}isSingleQuotationClose(){return 0===this._singleQuotationState}isBracesClose(){return 0===this._bracesState}isBracketClose(){return 0===this._bracketState.length}isSquareBracketClose(){return 0===this._squareBracketState}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){let r=this._getCurrentParamIndex(e,t);if(null==r||r===ea.VALUE)return;let n=r[0];if("string"==typeof n)return;let i=n.getParent(),s=n;for(;i;){let e=i.getToken();if("P_1"!==e&&!eE(e)&&-1!==i.getStartIndex())return{functionName:e,paramIndex:i.getChildren().indexOf(s)};s=i,i=i.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,n=e[r];for(;(n===ef.CLOSE_BRACKET||" "===n)&&r>=0;)n===ef.CLOSE_BRACKET&&t++,n=e[--r];let i=this._getCurrentParamIndex(e,e.length-2);if(null==i||i===ea.VALUE)return 0;let s=i[0];if("string"==typeof s)return 0;let a=s.getParent(),o=0;for(i[1]===ef.OPEN_BRACKET&&o++;a;){let e=a.getToken();"P_1"!==e&&e!==ef.COLON&&-1!==a.getStartIndex()&&e.toUpperCase()!==tv&&(0===t?o+=1:t--),a=a.getParent()}return o}sequenceNodesBuilder(e){let t=tV.get(e);if(t)return[...t];let r=this._getSequenceArray(e);if(0===r.length)return;let n=this.getSequenceNode(r);return tV.set(e,[...n]),n}convertRefersToAbsolute(e,t,r,n=""){let i=this.sequenceNodesBuilder(e);if(null==i)return e;let s="";e.substring(0,1)===ec.EQUALS&&(s=ec.EQUALS);for(let e=0,s=i.length;e<s;e++){let a=i[e];if("string"!=typeof a&&a.nodeType===tO.REFERENCE){let{token:o,endIndex:l}=a,u=tM(o);if(null==u)continue;let{range:c,sheetName:h,unitId:d}=u,m=e5({range:{...c,startAbsoluteRefType:t,endAbsoluteRefType:r},unitId:d,sheetName:h||n}),g=m.length-o.length;i[e]={...a,token:m,endIndex:l+g};for(let t=e+1;t<s;t++){let e=i[t];"string"!=typeof e&&(e.startIndex+=g,e.endIndex+=g)}}}return`${s}${tx(i)}`}moveFormulaRefOffset(e,t,r,n=!1){let i=this.sequenceNodesBuilder(e);if(null==i)return e;let s=[];for(let e=0,a=i.length;e<a;e++){let a=i[e];if("string"==typeof a||a.nodeType!==tO.REFERENCE){s.push(a);continue}let{token:o}=a,l=tM(o),{sheetName:u,unitId:c}=l,h=l.range;if(n||h.startAbsoluteRefType!==j.AbsoluteRefType.ALL||h.endAbsoluteRefType!==j.AbsoluteRefType.ALL)h=(0,j.moveRangeByOffset)(h,t,r,n);else{s.push(a);continue}let d="";d=(0,j.isValidRange)(h)?e5({range:h,unitId:c,sheetName:u}):ea.REF,s.push({...a,token:d})}return`=${tx(s)}`}_formulaSpellCheck(){if(0===this._currentLexerNode.getChildren().length)return!0;let e=this._currentLexerNode.getChildren()[0];return!!(e instanceof tU||em.has(e)||eC.has(e)||e===e_.AT||e===ef.COMMA||e===ef.COLON||e===ef.OPEN_BRACKET)}getSequenceNode(e){let t=[],r=!1;for(let n=0,i=e.length;n<i;n++){let s=e[n],a=e[n-1],{segment:o,currentString:l}=s;if(l===ef.DOUBLE_QUOTATION&&(r=!0),(""!==o||0===n)&&n!==i-1){t.push(l);continue}let u=(null==a?void 0:a.segment)||"",c=n-u.length,h=n-1,d=n-1;if(n===i-1&&this._isLastMergeString(l)&&(u+=l,h+=1),""===u||ed.has(u)){t.push(l);continue}let m=u.trim(),g=e7(m);!0===r&&m[m.length-1]===ef.DOUBLE_QUOTATION&&m[0]!==ef.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,tO.STRING,u,c,h,d)):eB(g)&&e8(g)?this._processPushSequenceNode(t,tO.REFERENCE,u,c,h,d):j.Tools.isStringNumber(m)?this._processPushSequenceNode(t,tO.NUMBER,u,c,h,d):m.length>0&&this._processPushSequenceNode(t,tO.FUNCTION,u,c,h,d),n===i-1&&this._isLastMergeString(l)||t.push(l)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,n,i,s){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:n,endIndex:i},s)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===ef.DOUBLE_QUOTATION||j.Tools.isStringNumber(e)||!eE(e)}_mergeSequenceNodeReference(e){let t=[],r=e.length,n=0;for(;n<r;){let r=e[n];if("string"==typeof r){let i=e[n-1];if(r.trim()===ef.CLOSE_BRACES&&null!=i&&"string"!=typeof i&&i.nodeType===tO.FUNCTION&&i.token.trim().substring(0,1)===ef.OPEN_BRACES){i.nodeType=tO.ARRAY,i.token+=r,i.endIndex+=r.length,n++;continue}t.push(r)}else{let i=e[n+1],s=e[n+2];i===ef.COLON&&"string"!=typeof r&&null!=s&&"string"!=typeof s&&e8((r.token+i+s.token).trim())&&(r.nodeType=tO.REFERENCE,r.token+=i+s.token,r.endIndex=s.endIndex,n+=2),t.push(r)}n++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){let t=[];for(let r of e){if("string"!=typeof r){let e=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(e){let n=e[1],i=e[3];if(e8(i.trim())){let e=n.length,s=r.startIndex,a=r.startIndex+e-1,o={nodeType:tO.NORMAL,token:n,startIndex:s,endIndex:a},l={nodeType:tO.REFERENCE,token:i,startIndex:a+1,endIndex:r.endIndex};t.push(o),t.push(l);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){let n=r-t.startIndex+1;e.splice(e.length-n,n,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,n){if(!0===t){let t=tD.get(e),r=null==n?void 0:n(e);if(t&&!r)return t}this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1");let i=[],s=this._nodeMaker(e,i);if(s===ea.VALUE||0===i.length)return s;let a=!1,o="",l=[];if(r){let{hasDefinedName:e,sequenceString:t,definedNames:n}=r(i);a=e,o=t,l=n}if(a&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1"),(s=this._nodeMaker(`=${o}`))===ea.VALUE))return s;let u=this._getTopNode(this._currentLexerNode);if(u&&(this._currentLexerNode=u),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return ea.VALUE;tD.set(e,this._currentLexerNode)}return a&&this._currentLexerNode.setDefinedNames(l),this._currentLexerNode}_suffixExpressionHandler(e){var t;let r=e.getChildren();if(!r)return!1;let n=r.length,i=[],s=[],a=!0;for(let e=0;e<n;e++){let n=r[e];if(n instanceof tU)a=this._suffixExpressionHandler(n),i.push(n);else{let a=n.trim();if(""===a)continue;if(em.has(a)){if(a===ec.PLUS&&this._deletePlusForPreNode(r[e-1]))continue;if(a!==ec.PLUS&&a!==ec.MINUS&&this._deletePlusForPreNode(r[e-1]))return!1;for(;s.length>0;){let e=null==(t=s[s.length-1])?void 0:t.trim();if(!e||e===ef.OPEN_BRACKET)break;let r=ed.get(e),n=ed.get(a);if(!r||!n)break;if(n>=r)i.push(s.pop());else break}s.push(n)}else if(a===ef.OPEN_BRACKET)s.push(n);else if(a===ef.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(i,s,r,e);else{if(this._checkCloseBracket(r[e-1]))return!1;i.push(n)}}}return!!a&&this._processSuffixExpressionRemain(i,s,e)}_processSuffixExpressionRemain(e,t,r){let n=e.length,i=e[n-1];for(;t.length>0;){let r=t.pop();if(!(i instanceof tU)&&(r===ef.OPEN_BRACKET||r===ef.CLOSE_BRACKET))return!1;e.push(r)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,n){var i;if(this._checkOpenBracket(r[n-1])||this._checkOperator(r[n-1]))return!1;for(;t.length>0;){let r=null==(i=t[t.length-1])?void 0:i.trim();if(!r)break;if(r===ef.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===ef.CLOSE_BRACKET||e instanceof tU}_checkOpenBracket(e){return e===ef.OPEN_BRACKET}_checkOperator(e){return null!=e&&!(e instanceof tU)&&em.has(e)}_deletePlusForPreNode(e){if(null==e)return!0;if(!(e instanceof tU)){let t=e.trim();if(em.has(t)||t===ef.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new tU}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){let e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){let t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){let e=this._currentLexerNode.getChildren();if(e&&e.length>0){let t=e[e.length-1];if(t instanceof tU)return t}return!1}_getLastChildCurrent(){let e=this._currentLexerNode.getChildren();return!!e&&e.length>0&&e[e.length-1]}_setParentCurrentLexerNode(){let e=this._currentLexerNode.getParent();return!!e&&(this._currentLexerNode=e,!0)}_setAncestorCurrentLexerNode(){var e,t,r,n,i,s;let a=null==(e=this._currentLexerNode)?void 0:e.getParent(),o=!1;if(a&&"L_1"===a.getToken()){if(null!=(t=null==a?void 0:a.getParent())&&t.getParent()){let e=null==(n=null==(r=this._currentLexerNode.getParent())?void 0:r.getParent())?void 0:n.getParent();e&&(this._currentLexerNode=e),o=!0}}else if(null!=a&&a.getParent()){let e=null==(i=this._currentLexerNode.getParent())?void 0:i.getParent();e&&(this._currentLexerNode=e),o=!0}for(let e=0;e<this._upLevel;e++){let e=null==(s=this._currentLexerNode)?void 0:s.getParent();e&&(this._currentLexerNode=e),o=!!this._currentLexerNode}return o}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(""!==r){let e=this._currentLexerNode.getChildren();if(!(r instanceof tU)&&this.isColonOpen()){let e=new tU;e.setToken(r),e.setParent(this._currentLexerNode),r=e}t?e.unshift(r):e.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){let n=new tU;n.setToken(e),n.setIndex(t-e.length,t-1),this._setCurrentLexerNode(n,r)}_getTopNode(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){let r=this._findPreviousToken(e,t)||"",n=e.length-1===t;if(!n&&this._isOperatorToken(r)||n&&eN.has(r))return!0;if(eC.has(r)){let r=this._findSecondLastNonSpaceToken(e,t);if(null==r||eS.has(r))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,n=0;for(;r>=0;){let t=e[r];if(" "!==t&&2==++n)return t;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===ef.OPEN_BRACKET||e===ef.COMMA||e===ec.EQUALS||""===e}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!em.has(e)}_getSequenceArray(e){let t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new tU,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let n=t;if(e!==ep.POUND)return!0;let i=r[++n];for(;" "===i;)i=r[++n];return!!eE(i)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<el.length;r++){let n=el[r],i=t.slice(e,e+n).join("").toUpperCase();if(eo.has(i))return i}}_nodeMaker(e,t,r){let n=e.replace(/\r\n$|\r|\n/g," ");n.substring(0,1)===ec.EQUALS&&(n=n.substring(1));let i=n.split(""),s=i.length;this._resetTemp(),this._formulaErrorLastTokenCheck(i,s-1)&&this._formalErrorOccurred();let a=0;for(;a<s;){let e=i[a];if(r===a)return[this._currentLexerNode,e];if(e===ep.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(a,i)){let e=this._findErrorObject(a,i);if(null==e)return ea.VALUE;this._pushNodeToChildren(e);for(let r=0;r<e.length;r++){let e=i[a];this._pushSegment(e),this._addSequenceArray(t,e,a),a++}this._resetSegment();continue}if(e===ef.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,a),this._resetSegment()),this._openBracket(1),this._closeLambda();let r=i[a+1];if(r&&r===ef.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return ea.VALUE;this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,r,a),a++,this._closeBracket();continue}r&&this._newAndPushCurrentLexerNode("P_1",a)}else this._pushNodeToChildren(e),this._openBracket(0),this._resetSegment();else if(e===ef.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();let t=this._getCurrentBracket();if(0===t)this._pushNodeToChildren(e);else{if(1!==t)return ea.VALUE;let e=i[a+1];if(e&&e===ef.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&a!==s-1)return ea.VALUE;this._newAndPushCurrentLexerNode("L_1",a,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&a!==s-1)return ea.VALUE}this._closeBracket()}else if(e===ef.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(e),this._openBraces(),!this._formulaSpellCheck())return ea.VALUE}else if(e===ef.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(e),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(e===ef.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(e),this._openSquareBracket();else if(e===ef.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(e),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(e);else if(e===ef.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{let e=i[a+1];e&&e===ef.DOUBLE_QUOTATION?a++:this._closeDoubleQuotation()}this._pushSegment(e)}else if(e===ef.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation(),0===this._segmentCount()&&this._resetSegment();else{let r=i[a+1];if(r&&r===ef.SINGLE_QUOTATION){this._pushSegment(e),this._addSequenceArray(t,e,a),a++,this._pushSegment(r),this._addSequenceArray(t,r,a),a++;continue}this._closeSingleQuotation()}this._pushSegment(e)}else if(e===ef.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(i,a-1)&&this._formalErrorOccurred();let e=this._getCurrentBracket();if(1===e||null==e){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&a!==s-1&&null!=e)return ea.VALUE;this._newAndPushCurrentLexerNode("P_1",a)}else{let e=new tU;e.setToken("CUBE");let t=new tU;t.setToken("P_1"),t.changeToParent(e);let r=this._currentLexerNode.getParent();if(!r||r.getToken()!==ef.COLON)return ea.VALUE;{let n=r.getParent();if(!n)return ea.VALUE;r.changeToParent(t),n.setChildren([]),e.changeToParent(n)}this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=e,this._newAndPushCurrentLexerNode("P_1",a)}}else if(e===ef.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let t=new tU;t.setToken(e);let r=new tU;r.setToken("P_1"),r.setParent(t);let n=new tU;n.setToken("P_1"),n.setParent(t),t.getChildren().push(r,n);let i=t,s=0;if(this._segmentCount()>0){let e,n,a=0,o=this._segment.trim(),l=o[0],u=o[1];if(l===e_.MINUS&&((e=new tU).setToken(e_.MINUS),a++),(l===e_.AT||u===e_.AT)&&((n=new tU).setToken(e_.AT),e&&(e.addChildren(n),n.setParent(e)),a++),a>0&&(this._segment=o.slice(a)),s=a,n)if(n.addChildren(t),t.setParent(n),n.getParent()){let e=n.getParent();e&&(i=e)}else i=n;else e&&(i=e,e.addChildren(t),t.setParent(e));let c=new tU;c.setToken(this._segment),c.setParent(r),r.getChildren().push(c),this._resetSegment()}else{let e=this._getLastChildCurrentLexerNode();e&&e.changeToParent(r)}this._setCurrentLexerNode(i),this._currentLexerNode=n,this._openColon(s)}else if(eC.has(e)&&this._checkSimilarErrorToken(e,a,i)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);let t=new tU;t.setToken(e);let r=this._getLastChildCurrent();r instanceof tU?r.changeToParent(t):!1!==r&&(t.getChildren().push(r),this._removeLastChild()),this._pushNodeToChildren(t),t.setParent(this._currentLexerNode),this._resetSegment()}else if(em.has(e)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let r=this._segment.trim();if(e===ec.MINUS&&""===r){let r=this._findPreviousToken(i,a-1)||"",n=this._findNextToken(i,a+1)||"";if(this._unexpectedEndingTokenExcludeOperator(r)&&this._isOperatorToken(n)){this._pushNodeToChildren("0"),this._pushNodeToChildren(ec.MINUS),this._addSequenceArray(t,e,a),this._resetSegment(),a++;continue}if(this._unexpectedEndingToken(r))if(n===ec.PLUS){this._pushSegment(ec.MINUS),this._addSequenceArray(t,e,a),this._addSequenceArray(t,ec.PLUS,a+1),a+=2;continue}else{this._pushSegment(ec.MINUS),this._addSequenceArray(t,e,a),a++;continue}}else if(this._segment.length>0&&this._isScientificNotation(i,a,e)){this._pushSegment(e),this._addSequenceArray(t,e,a),a++;continue}else this._segment.length>0&&""===r?r=this._segment:(this._pushNodeToChildren(this._segment),r="");if(e===ec.LESS_THAN||e===ec.GREATER_THAN){let n=i[a+1];if(n&&em.has(e+n)){this._pushNodeToChildren(r+e+n),this._resetSegment(),this._addSequenceArray(t,e,a),a++,this._addSequenceArray(t,n,a),a++;continue}this._pushNodeToChildren(r+e)}else this._pushNodeToChildren(r+e);this._resetSegment()}else(""!==this._segment||" "!==e)&&this._pushSegment(e);this._addSequenceArray(t,e,a),a++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return ea.VALUE}_isScientificNotation(e,t,r){let n=e[t-2];if(n&&Number.isNaN(Number(n))||r!==ec.MINUS&&r!==ec.PLUS)return!1;let i=e[t+1];if(i&&Number.isNaN(Number(i)))return!1;let s=e[t-1];return s&&"E"===s.toUpperCase()}_addSequenceArray(e,t,r){null==e||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}}var tP=Object.getOwnPropertyDescriptor,tF=(e,t)=>(r,n)=>t(r,n,e);let tk=class extends j.Disposable{constructor(e,t){super(),J(this,"_arrayFormulaRange",{}),J(this,"_arrayFormulaCellData",{}),this._univerInstanceService=e,this._lexerTreeBuilder=t}dispose(){super.dispose(),this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{var n,i,s,a;let o=r[e],l=null==(i=null==(n=this._arrayFormulaRange)?void 0:n[t])?void 0:i[e];if(null==l)return!0;let u=new(0,j.ObjectMatrix)(l),c=new(0,j.ObjectMatrix);(null==(s=this._arrayFormulaCellData[t])?void 0:s[e])!=null&&(c=new(0,j.ObjectMatrix)(null==(a=this._arrayFormulaCellData[t])?void 0:a[e])),o.forValue((e,t)=>{let r=u.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=r;for(let e=n;e<=s;e++)for(let t=i;t<=a;t++)c.setValue(e,t,null);u.realDeleteValue(e,t)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;null==this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t]={}),null==this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(e=>{var n,i;let s=r[e],a=new(0,j.ObjectMatrix)(null==(n=this._arrayFormulaRange[t])?void 0:n[e]),o=new(0,j.ObjectMatrix)(null==(i=this._arrayFormulaCellData[t])?void 0:i[e]);s.forValue((e,t)=>{let r=null==a?void 0:a.getValue(e,t);if(null==r)return!0;let{startRow:n,startColumn:i,endRow:s,endColumn:l}=r;for(let e=n;e<=s;e++)for(let t=i;t<=l;t++)o.setValue(e,t,null)}),s.forValue((e,t,r)=>{o.setValue(e,t,r)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=o.getData())})})}getFormulaData(){let e={},t=this._univerInstanceService.getAllUnitsForType(j.UniverInstanceType.UNIVER_SHEET);return 0===t.length||t.forEach(t=>{let r=t.getUnitId();e[r]={},t.getSheets().forEach(t=>{let n=t.getCellMatrix();tj(e,r,t.getSheetId(),n)})}),e}getSheetFormulaData(e,t){let r={},n=this._univerInstanceService.getUnit(e);if(null==n)return{};r[e]={};let i=n.getSheetBySheetId(t);return null==i?{}:(tj(r,e,t,i.getCellMatrix()),r[e][t])}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(e=>{var n;let i=new(0,j.ObjectMatrix)(r[e]),s=new(0,j.ObjectMatrix)(null==(n=this._arrayFormulaRange[t])?void 0:n[e]);i.forValue((e,t,r)=>{s.setValue(e,t,r)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][e]=s.getData())})})}deleteArrayFormulaRange(e,t,r,n){var i;let s=null==(i=this._arrayFormulaRange[e])?void 0:i[t];if(null==s)return;let a=new(0,j.ObjectMatrix)(s);a.getValue(r,n)&&(a.realDeleteValue(r,n),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=a.getData()))}getCalculateData(){let e=this._univerInstanceService.getAllUnitsForType(j.UniverInstanceType.UNIVER_SHEET),t={},r={},n={};for(let i of e){let e=i.getUnitId(),s=i.getSheets(),a={},o={};for(let e of s){let t=e.getSheetId(),r=e.getConfig();a[t]={cellData:new(0,j.ObjectMatrix)(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},o[e.getName()]=e.getSheetId()}t[e]=a,r[e]=i.getStyles(),n[e]=o}return{allUnitData:t,unitStylesData:r,unitSheetNameMap:n}}getHiddenRowsFiltered(){let e=this._univerInstanceService.getAllUnitsForType(j.UniverInstanceType.UNIVER_SHEET),t={};for(let r of e){let e=r.getUnitId(),n=r.getSheets();for(let r of(t[e]={},n)){let n=r.getSheetId();t[e][n]={};let i=r.getRowCount()-1,s={};for(let e=0;e<=i;e++)r.getRowVisible(e)||(s[e]={hd:j.BooleanNumber.TRUE});t[e][n]=s}}return t}updateFormulaData(e,t,r){let n=new(0,j.ObjectMatrix)(r),i=this._getSheetFormulaIdMap(e,t),s=new Map,a=this.getFormulaData();null==a[e]&&(a[e]={});let o=a[e];null==o[t]&&(o[t]={});let l=new(0,j.ObjectMatrix)(o[t]||{}),u=new(0,j.ObjectMatrix);return n.forValue((e,t,r)=>{!function(e,t,r,n,i,s,a){let o=(null==a?void 0:a.f)||"",l=(null==a?void 0:a.si)||"",u=(0,j.isFormulaString)(o),c=(0,j.isFormulaId)(l),h=e.getValue(i,s),d=(null==h?void 0:h.f)||"",m=(null==h?void 0:h.si)||"";function g(){var e;if((0,j.isFormulaString)(d)&&(0,j.isFormulaId)(m)){let t=null==(e=null==r?void 0:r[m])?void 0:e.f;t?n.set(m,t):n.set(m,d)}}u&&c?(m!==l&&g(),e.setValue(i,s,{f:o,si:l}),r[l]={f:o,r:i,c:s},t.setValue(i,s,{f:o,si:l})):u&&!c?(d!==o&&g(),e.setValue(i,s,{f:o}),t.setValue(i,s,{f:o})):!u&&c?(m!==l&&g(),e.setValue(i,s,{f:"",si:l})):!u&&!c&&e.getValue(i,s)&&(g(),e.realDeleteValue(i,s),t.setValue(i,s,null))}(l,u,i,s,e,t,r)}),l.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,j.isFormulaId)(a)){let o=null==i?void 0:i[a],c=s.get(a);if(o&&!(0,j.isFormulaString)(n)){let r=o.f,n=t-o.c,i=e-o.r;l.setValue(e,t,{f:r,si:a,x:n,y:i}),u.setValue(e,t,{f:r,si:a,x:n,y:i})}else if("string"==typeof c){let n=(null==r?void 0:r.x)||0,i=(null==r?void 0:r.y)||0,o=this._lexerTreeBuilder.moveFormulaRefOffset(c,n,i);s.set(a,{r:e,c:t,f:o}),l.setValue(e,t,{f:o,si:a}),u.setValue(e,t,{f:o,si:a})}else if("object"==typeof c){let r=t-c.c,n=e-c.r;l.setValue(e,t,{f:c.f,si:a,x:r,y:n}),u.setValue(e,t,{f:c.f,si:a,x:r,y:n})}}}),u.getMatrix()}updateArrayFormulaRange(e,t,r){var n;let i=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!i)return;let s=new(0,j.ObjectMatrix)(i);new(0,j.ObjectMatrix)(r).forValue((e,t,r)=>{s.realDeleteValue(e,t)})}updateArrayFormulaCellData(e,t,r){var n,i;let s=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(!s)return;let a=new(0,j.ObjectMatrix)(s),o=null==(i=this._arrayFormulaCellData[e])?void 0:i[t];if(!o)return;let l=new(0,j.ObjectMatrix)(o);new(0,j.ObjectMatrix)(r).forValue((e,t,r)=>{!function(e,t,r,n){let i=null==e?void 0:e.getValue(r,n);if(null==i)return;let s=[];e.forValue((e,t,a)=>{e===r&&t===n||j.Rectangle.intersects(a,i)&&s.push(a)});let{startRow:a,startColumn:o,endRow:l,endColumn:u}=i;for(let e=a;e<=l;e++)for(let r=o;r<=u;r++){let n=!1,i=(0,j.cellToRange)(e,r);s.some(e=>!!j.Rectangle.contains(e,i)&&(n=!0,!0)),n||t.realDeleteValue(e,r)}}(a,l,e,t)})}getFormulaStringByCell(e,t,r,n){let i=this._univerInstanceService.getUnit(n);if(null==i)return null;let s=i.getSheetBySheetId(r);if(null==s)return null;let a=s.getCellMatrix(),o=a.getValue(e,t);if(null==o)return null;let{f:l,si:u}=o;if((0,j.isFormulaString)(l))return l;if((0,j.isFormulaId)(u)){let r=null;return a.forValue((n,i,s)=>{if(null==s)return!0;let{f:a,si:o}=s;if((0,j.isFormulaString)(a)&&u===o)return r=this._lexerTreeBuilder.moveFormulaRefOffset(a,t-i,e-n),!1}),r}return null}getFormulaDirtyRanges(){let e=this.getFormulaData(),t=[];for(let r in e){let n=e[r];if(!n)continue;let i=this._univerInstanceService.getUnit(r);if(i)for(let e in n){let s=n[e];if(!s)continue;let a=i.getSheetBySheetId(e);if(!a)continue;let o={};for(let e of Object.keys(s)){let t=Number(e);for(let e in s[t]){let r=Number(e),n=a.getCellRaw(t,r),i=(0,j.isFormulaString)(null==n?void 0:n.f)||(0,j.isFormulaId)(null==n?void 0:n.si),s=(null==n?void 0:n.v)===void 0;if(!(i&&s))continue;o[r]||(o[r]=[]);let l=o[r].slice(-1)[0];l&&l.endRow===t-1?l.endRow=t:o[r].push({startRow:t,endRow:t})}}for(let n in o){let i=o[n];for(let s=0;s<i.length;s++){let a=i[s];t.push({unitId:r,sheetId:e,range:{rangeType:j.RANGE_TYPE.NORMAL,startRow:a.startRow,endRow:a.endRow,startColumn:Number(n),endColumn:Number(n)}})}}}}return t}_getSheetFormulaIdMap(e,t){let r={},n=this._univerInstanceService.getUnit(e);if(null==n)return r;let i=n.getSheetBySheetId(t);return null==i||i.getCellMatrix().forValue((e,t,n)=>{if(null==n)return!0;let{f:i,si:s}=n;(0,j.isFormulaString)(i)&&(0,j.isFormulaId)(s)&&(r[s]={f:i,r:e,c:t})}),r}};function tj(e,t,r,n){e[t]||(e[t]={}),e[t][r]||(e[t][r]={});let i=new Map,s=new(0,j.ObjectMatrix)(e[t][r]);return n.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"",o=(0,j.isFormulaString)(n),l=(0,j.isFormulaId)(a);o&&l?(s.setValue(e,t,{f:n,si:a}),i.set(a,{f:n,r:e,c:t})):o&&!l?s.setValue(e,t,{f:n}):!o&&l&&s.setValue(e,t,{f:"",si:a})}),s.forValue((e,t,r)=>{let n=(null==r?void 0:r.f)||"",a=(null==r?void 0:r.si)||"";if((0,j.isFormulaId)(a)&&!(0,j.isFormulaString)(n)){let r=i.get(a);if(r){let n=r.f,i=t-r.c,o=e-r.r;s.setValue(e,t,{f:n,si:a,x:i,y:o})}else s.realDeleteValue(e,t)}}),{[t]:{[r]:s.getMatrix()}}}tk=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tP(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tF(0,j.IUniverInstanceService),tF(1,(0,B.Inject)(tL))],tk);let tB=class e{constructor(e,t){this.low=e,this.high=t}clone(){return new e(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equal_to(e){return this.low===e.low&&this.high===e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(t){return new e(void 0===this.low?t.low:this.low<t.low?this.low:t.low,void 0===this.high?t.high:this.high>t.high?this.high:t.high)}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}};class t${constructor(e,t,r=null,n=null,i=null,s=1){if(this.left=r,this.right=n,this.parent=i,this.color=s,this.item={key:e,value:t},e&&e instanceof Array&&2===e.length&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])){let[t,r]=e;t>r&&([t,r]=[r,t]),this.item.key=new tB(t,r)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&1===this.color}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value===e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){return(0,this.item.key.constructor.comparable_less_than)(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,r=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}}class tH{constructor(){this.root=null,this.nil_node=new t$}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return null==this.root||this.root===this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let r=new t$(e,t,this.nil_node,this.nil_node,null,0);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new t$(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new t$(e,t),n=this.tree_search(this.root,r);return n&&this.tree_delete(n),n}search(e,t=(e,t)=>e===t?t.output():e){let r=new t$(e),n=[];return this.tree_search_interval(this.root,r,n),n.map(e=>t(e.item.value,e.item.key))}intersect_any(e){let t=new t$(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(e){let t=new tH;return this.tree_walk(this.root,r=>t.insert(r.item.key,e(r.item.value,r.item.key))),t}*iterate(e,t=(e,t)=>e===t?t.output():e){let r;for(e?r=this.tree_search_nearest_forward(this.root,new t$(e)):this.root&&(r=this.local_minimum(this.root));r;)yield t(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(null==this.root||this.root===this.nil_node)this.root=e;else{for(;t!==this.nil_node;)r=t,t=e.less_than(t)?t.left:t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!==this.root&&0===t.parent.color;)t.parent===t.parent.parent.left?0===(r=t.parent.parent.right).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_right(t.parent.parent)):0===(r=t.parent.parent.left).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_left(t.parent.parent));this.root.color=1}tree_delete(e){let t,r;(r=(t=e.left===this.nil_node||e.right===this.nil_node?e:this.tree_successor(e)).left!==this.nil_node?t.left:t.right).parent=t.parent,t===this.root?this.root=r:(t===t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!==e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),1===t.color&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!==this.root&&null!=t.parent&&1===t.color;)t===t.parent.left?(0===(r=t.parent.right).color&&(r.color=1,t.parent.color=0,this.rotate_left(t.parent),r=t.parent.right),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.right.color&&(r.color=0,r.left.color=1,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=1,r.right.color=1,this.rotate_left(t.parent),t=this.root)):(0===(r=t.parent.left).color&&(r.color=1,t.parent.color=0,this.rotate_right(t.parent),r=t.parent.left),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.left.color&&(r.color=0,r.right.color=1,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=1,r.left.color=1,this.rotate_right(t.parent),t=this.root));t.color=1}tree_search(e,t){if(null!=e&&e!==this.nil_node)return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_nearest_forward(e,t){let r,n=e;for(;n&&n!==this.nil_node;)n.less_than(t)?n.intersect(t)?(r=n,n=n.left):n=n.right:((!r||n.less_than(r))&&(r=n),n=n.left);return r||null}tree_search_interval(e,t,r){null!=e&&e!==this.nil_node&&(e.left===this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right===this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return null!=e&&e!==this.nil_node&&(e.left===this.nil_node||e.not_intersect_left_subtree(t)||(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),r||e.right===this.nil_node||e.not_intersect_right_subtree(t)||(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;null!=t.left&&t.left!==this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!==this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,n;if(e.right!==this.nil_node)t=this.local_minimum(e.right);else{for(r=e,n=e.parent;null!=n&&n.right===r;)r=n,n=n.parent;t=n}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!==this.nil_node&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!==this.nil_node&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!==e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!==this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){0===t.color&&(1===t.left.color&&1===t.right.color||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0,n=0;if(1===e.color&&t++,(r=e.left!==this.nil_node?this.testBlackHeightProperty(e.left):1)!==(e.right!==this.nil_node?this.testBlackHeightProperty(e.right):1))throw Error("Red-black height property violated");return t+r}}let tW=new class{constructor(){J(this,"_cache",new Map),J(this,"_continueBuildingCache",new Map)}set(e,t,r,n,i,s=!1){if(!this.shouldContinueBuildingCache(e,t,r,i)&&!s)return;let a=this._cache.get(e);null==a&&(a=new Map,this._cache.set(e,a));let o=a.get(t);null==o&&(o=new Map,a.set(t,o));let l=o.get(r);if(null==l&&(l=new Map,o.set(r,l)),s){for(let[e,t]of l)if(t.has(i)){t.delete(i);break}}let u=l.get(n);null==u&&(u=new Set,l.set(n,u)),u.add(i)}getCellValuePositions(e,t,r){var n,i;return null==(i=null==(n=this._cache.get(e))?void 0:n.get(t))?void 0:i.get(r)}getCellPositions(e,t,r,n,i){var s,a,o;let l=null==(o=null==(a=null==(s=this._cache.get(e))?void 0:s.get(t))?void 0:a.get(r))?void 0:o.get(n);return l&&[...l].filter(e=>i.some(([t,r])=>e>=t&&e<=r))}setContinueBuildingCache(e,t,r,n,i){if(-1===r||-1===n||-1===i)return;let s=this._continueBuildingCache.get(e);null==s&&(s=new Map,this._continueBuildingCache.set(e,s));let a=s.get(t);null==a&&(a=new Map,s.set(t,a));let o=a.get(r);if(null==o){(o=new tH).insert([n,i]),a.set(r,o);return}this._handleNewInterval(o,n,i)}shouldContinueBuildingCache(e,t,r,n){var i,s;if(-1===r||-1===n)return!1;let a=null==(s=null==(i=this._continueBuildingCache.get(e))?void 0:i.get(t))?void 0:s.get(r);return!a||0===a.search([n,n]).length}canUseCache(e,t,r,n,i){var s,a;let o=null==(a=null==(s=this._continueBuildingCache.get(e))?void 0:s.get(t))?void 0:a.get(r);if(-1===r||-1===n||-1===i||!o)return{rowsInCache:[],rowsNotInCache:[]};let l=o.search([n,i]);if(0===l.length)return{rowsInCache:[],rowsNotInCache:[]};l.sort((e,t)=>e[0]-t[0]);let u=[],c=[],h=n;for(let e=0;e<l.length;e++){let[t,r]=l[e];if(h>=t){if(i<=r){u.push([h,i]);break}u.push([h,r]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i])}else{if(i>r){u.push([t,r]),c.push([h,t-1]),h=r+1,e===l.length-1&&h<=i&&c.push([h,i]);continue}u.push([t,i]),c.push([h,t-1])}}return{rowsInCache:u,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(e,t,r){let n=e.search([t,r]);if(0===n.length){let i=[t-1<0?0:t-1,r+1];if(0===(n=e.search(i)).length)return void e.insert([t,r])}let i=t,s=r;for(let t of n)i=Math.min(i,t[0]),s=Math.max(s,t[1]),e.remove(t);e.insert([i,s])}},tG="engine-formula.config",tY="CYCLE_REFERENCE_COUNT",tz={};class tX extends j.Disposable{constructor(){super(...arguments),J(this,"_getRowFilteredCallback")}register(e){this._getRowFilteredCallback=e}getRowFiltered(e,t,r){var n;return!!this._getRowFilteredCallback&&null!=(n=this._getRowFilteredCallback(e,t,r))&&n}}let tq=(0,B.createIdentifier)("univer.formula.sheet-row-filtered.service");var tK=Object.getOwnPropertyDescriptor,tQ=(e,t)=>(r,n)=>t(r,n,e);let tZ=class extends j.Disposable{constructor(e,t,r,n){super(),J(this,"_unitData",{}),J(this,"_unitStylesData",{}),J(this,"_arrayFormulaCellData",{}),J(this,"_arrayFormulaRange",{}),J(this,"_formulaData",{}),J(this,"_sheetNameMap",{}),J(this,"_forceCalculate",!1),J(this,"_clearDependencyTreeCache",{}),J(this,"_dirtyRanges",[]),J(this,"_dirtyNameMap",{}),J(this,"_dirtyDefinedNameMap",{}),J(this,"_dirtyUnitFeatureMap",{}),J(this,"_dirtyUnitOtherFormulaMap",{}),J(this,"_excludedCell"),J(this,"_sheetIdToNameMap",{}),J(this,"_executeUnitId",""),J(this,"_executeSubUnitId",""),this._univerInstanceService=e,this._localeService=t,this._formulaDataModel=r,this._sheetRowFilteredService=n}dispose(){super.dispose(),this._unitData={},this._unitStylesData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._formulaData={},this._sheetNameMap={},this._clearDependencyTreeCache={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._dirtyUnitOtherFormulaMap={},this._excludedCell={},this._sheetIdToNameMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return null==this._sheetIdToNameMap[e]?"":this._sheetIdToNameMap[e][t]||""}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){let{id:e,sheetOrder:t}=this._univerInstanceService.getCurrentUnitForType(j.UniverInstanceType.UNIVER_SHEET).getSnapshot();return{sheetOrder:t,sheetNameMap:this._sheetIdToNameMap[e]}}getSheetRowColumnCount(e,t){let r=this._univerInstanceService.getUnit(e),n=null==r?void 0:r.getSheetBySheetId(t),i=null==n?void 0:n.getSnapshot();if(!i)return{rowCount:0,columnCount:0};let{rowCount:s,columnCount:a}=i;return{rowCount:s,columnCount:a}}getFilteredOutRows(e,t,r,n){let i=[];for(let s=r;s<=n;s++)this._sheetRowFilteredService.getRowFiltered(e,t,s)&&i.push(s);return i}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{let{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}e.rowData&&this._applyUnitRowData(e.rowData),this._formulaData=e.formulaData,this._arrayFormulaCellData=eA(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(n=>{null==e[r]&&(e[r]={}),e[r][t[r][n]]=n})}),this._sheetIdToNameMap={},Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(r=>{null==this._sheetIdToNameMap[t]&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][e[t][r]]=r})})}_loadSheetData(){let e=this._univerInstanceService.getCurrentUnitForType(j.UniverInstanceType.UNIVER_SHEET),t=null==e?void 0:e.getActiveSheet();return this._executeUnitId=null==e?void 0:e.getUnitId(),this._executeSubUnitId=null==t?void 0:t.getSheetId(),this._formulaDataModel.getCalculateData()}_applyUnitRowData(e){for(let t in e)if(null!=e[t])for(let r in e[t])null!=e[t][r]&&(null==this._unitData[t]&&(this._unitData[t]={}),null==this._unitData[t][r]&&(this._unitData[t][r]={cellData:new(0,j.ObjectMatrix)({}),rowCount:0,columnCount:0,rowData:{},columnData:{}}),this._unitData[t][r].rowData=e[t][r])}};tZ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?tK(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([tQ(0,j.IUniverInstanceService),tQ(1,(0,B.Inject)(j.LocaleService)),tQ(2,(0,B.Inject)(tk)),tQ(3,(0,B.Inject)(tq))],tZ);let tJ=(0,B.createIdentifier)("univer.formula.current-data.service");var t0=Object.getOwnPropertyDescriptor,t1=(e,t)=>(r,n)=>t(r,n,e);let t2=class extends j.Disposable{constructor(e,t,r){super(),this._definedNamesService=e,this._lexerTreeBuilder=t,this._formulaCurrentConfigService=r}treeBuilder(e,t=!0){return this._lexerTreeBuilder.treeBuilder(e,t,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++){let r=n[t];if(e.indexOf(r)>-1)return!0}}return!1}_checkDefinedNameDirty(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let n=Object.keys(t[r]);for(let t=0,r=n.length;t<r;t++)if(n[t]===e)return!0}return!1}_injectDefinedName(e){let t=this._formulaCurrentConfigService.getExecuteUnitId();if(null==t)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};let r=this._lexerTreeBuilder.getSequenceNode(e),n="",i=!1,s=[];for(let e=0,a=r.length;e<a;e++){let a=r[e];if("string"==typeof a){n+=a;continue}let{nodeType:o,token:l}=a;if(o===tO.REFERENCE||o===tO.FUNCTION){let e=this._definedNamesService.getValueByName(t,l);if(e){let t=e.formulaOrRefString;t.substring(0,1)===ec.EQUALS&&(t=t.substring(1)),n+=t,s.push(e.name),i=!0}else this._checkDefinedNameDirty(l)?(n+=ea.NAME,i=!0,s.push(l)):n+=l}else n+=l}return{sequenceString:n,hasDefinedName:i,definedNames:s}}};function t5(e){if(null==e)return!0;let{v:t,f:r,si:n,p:i}=e;return!(null!=t&&("string"!=typeof t||0!==t.length)||null!=r&&r.length>0||null!=n&&n.length>0||null!=i)}function t3(e,t,r,n,i){var s;for(let a of Object.keys(i)){let o=i[a],l=null==(s=null==o?void 0:o[n])?void 0:s[r];if(null==l)continue;let u=l.getValue(e,t);if(null!=u)return u}}t2=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?t0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([t1(0,tl),t1(1,(0,B.Inject)(tL)),t1(2,tJ)],t2);let t4=["$","","","","","","","","","","","","","","","","","","","","","","","","","",""],t6={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function t9(e,t,r){var n,i;if(null==e||null==t)return t;let s=(null==r?void 0:r.getStyleByCell(e))||e.s,a=(null==r?void 0:r.getStyleByCell(t))||t.s;if(null==s||null==a||"object"!=typeof s||"object"!=typeof a)return t;let o=null==(n=null==s?void 0:s.n)?void 0:n.pattern,l=null==(i=null==a?void 0:a.n)?void 0:i.pattern;return null==o||null==l||(a.n.pattern=o||l),t}let t8=new tN(1e5);function t7(e){var t,r;let n=t8.get(e);if(void 0!==n)return n;let i=(r=t=e,t4.find(e=>r.includes(e))&&r.startsWith("_("))?3:t6[j.numfmt.getInfo(t).type||"unknown"];return t8.set(e,i),i}function re(e,t,r){if(""===e)return t;if(""===t)return e;let n=t7(e),i=t7(t);return r===ec.PLUS||r===ec.MINUS?4===n&&4===i||11===n&&11===i?"":t:r===ec.MULTIPLY||r===ec.DIVIDED?6===n&&6===i||7===n&&7===i||8===n&&8===i||9===n&&9===i?t:"":e||t}let rt=new Map([[j.LocaleType.EN_US,"$"],[j.LocaleType.RU_RU,""],[j.LocaleType.VI_VN,""],[j.LocaleType.ZH_CN,""],[j.LocaleType.ZH_TW,"NT$"]]);function rr(e){return rt.get(e)||"$"}function rn(e,t=2){let r=t;t>127&&(r=127);let n="";return r>0&&(n=`.${"0".repeat(r)}`),`"${rr(e)}"#,##0${n}_);[Red]("${rr(e)}"#,##0${n})`}let ri=new tN(1e5);function rs(e,t,r){return ri.set(e,{value:t,pattern:r}),{isNumberPattern:!0,value:t,pattern:r}}class ra{constructor(){J(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}}class ro extends ra{constructor(e){super(),J(this,"_customData"),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}withCustomData(e){return this._customData=e,this}getCustomData(){return this._customData}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}sum(){return ru.create(ea.VALUE)}max(){return ru.create(ea.VALUE)}min(){return ru.create(ea.VALUE)}count(){return ru.create(ea.VALUE)}countA(){return ru.create(ea.VALUE)}countBlank(){return ru.create(ea.VALUE)}getNegative(){return ru.create(ea.VALUE)}getReciprocal(){return ru.create(ea.VALUE)}plus(e){return ru.create(ea.VALUE)}minus(e){return ru.create(ea.VALUE)}multiply(e){return ru.create(ea.VALUE)}divided(e){return ru.create(ea.VALUE)}mod(e){return ru.create(ea.VALUE)}map(e){return ru.create(ea.NAME)}mapValue(e){return ru.create(ea.NAME)}compare(e,t,r=!1){return ru.create(ea.NAME)}isEqual(e){return this.compare(e,eh.EQUALS)}isNotEqual(e){return this.compare(e,eh.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,eh.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,eh.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,eh.LESS_THAN)}isGreaterThan(e){return this.compare(e,eh.GREATER_THAN)}concatenateFront(e){return ru.create(ea.NAME)}concatenateBack(e){return ru.create(ea.NAME)}plusBy(e){return ru.create(ea.VALUE)}minusBy(e){return ru.create(ea.VALUE)}multiplyBy(e){return ru.create(ea.VALUE)}dividedBy(e){return ru.create(ea.VALUE)}modInverse(e){return ru.create(ea.VALUE)}compareBy(e,t){return ru.create(ea.NAME)}concatenate(e,t=ei.FRONT){let r=this.getValue().toString();if("string"==typeof e)t===ei.FRONT?r=e+r:r+=e;else if("number"==typeof e)t===ei.FRONT?r=e.toString()+r:r+=e.toString();else if("boolean"==typeof e){let n=e?"TRUE":"FALSE";t===ei.FRONT?r=n+r:r+=n}return r}pow(e){return ru.create(ea.VALUE)}powInverse(e){return ru.create(ea.VALUE)}sqrt(){return ru.create(ea.VALUE)}cbrt(){return ru.create(ea.VALUE)}cos(){return ru.create(ea.VALUE)}cosh(){return ru.create(ea.VALUE)}acos(){return ru.create(ea.VALUE)}acosh(){return ru.create(ea.VALUE)}sin(){return ru.create(ea.VALUE)}sinh(){return ru.create(ea.VALUE)}asin(){return ru.create(ea.VALUE)}asinh(){return ru.create(ea.VALUE)}tan(){return ru.create(ea.VALUE)}tanh(){return ru.create(ea.VALUE)}atan(){return ru.create(ea.VALUE)}atan2(e){return ru.create(ea.VALUE)}atan2Inverse(e){return ru.create(ea.VALUE)}atanh(){return ru.create(ea.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return ru.create(ea.VALUE)}log10(){return ru.create(ea.VALUE)}exp(){return ru.create(ea.VALUE)}abs(){return ru.create(ea.VALUE)}round(e){return ru.create(ea.VALUE)}roundInverse(e){return ru.create(ea.VALUE)}floor(e){return ru.create(ea.VALUE)}floorInverse(e){return ru.create(ea.VALUE)}ceil(e){return ru.create(ea.VALUE)}ceilInverse(e){return ru.create(ea.VALUE)}convertToNumberObjectValue(){return ru.create(ea.VALUE)}convertToBooleanObjectValue(){return ru.create(ea.VALUE)}}let rl=new tN(1e3);class ru extends ro{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(e,t=""){let r=`${e}-${t}`,n=rl.get(r);if(n)return n;let i=new ru(e,t);return rl.set(r,i),i}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}}var rc=((p=rc||{})[p.MIN=0]="MIN",p[p.MAX=1]="MAX",p),rh=((C=rh||{})[C.NORMAL=0]="NORMAL",C[C.MIN=1]="MIN",C[C.MAX=2]="MAX",C);function rd(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(e,t)=>e.localeCompare(t)}function rm(e,t){let r=t.replace(/[.+^${}()|[\]\\]/g,"\\$&").replace(/~?[*?]/g,e=>e.startsWith("~")?`\\${e.substring(1)}`:"*"===e?".*":"?"===e?".":e);return RegExp(`^${r}$`).test(e)}function rg(e){return e.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function rf(e){switch(e){case 1:return 2;case 0:default:return 0;case -1:return 1}}function rp(e){let t;switch(e){case eh.EQUALS:t=eh.EQUALS;break;case eh.GREATER_THAN:t=eh.LESS_THAN;break;case eh.GREATER_THAN_OR_EQUAL:t=eh.LESS_THAN_OR_EQUAL;break;case eh.LESS_THAN:t=eh.GREATER_THAN;break;case eh.LESS_THAN_OR_EQUAL:t=eh.GREATER_THAN_OR_EQUAL;break;case eh.NOT_EQUAL:t=eh.NOT_EQUAL}return t}var rC,r_,ry="0123456789abcdef",rE="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rR="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rb={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},rI=!0,rN="[DecimalError] ",rS=rN+"Invalid argument: ",rA=rN+"Precision limit exceeded",rv=rN+"crypto unavailable",rT="[object Decimal]",rw=Math.floor,rM=Math.pow,rO=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,rx=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rU=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,rD=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,rV=rE.length-1,rL=rR.length-1,rP={toStringTag:rT};function rF(e){var t,r,n,i=e.length-1,s="",a=e[0];if(i>0){for(s+=a,t=1;t<i;t++)(r=7-(n=e[t]+"").length)&&(s+=rq(r)),s+=n;(r=7-(n=(a=e[t])+"").length)&&(s+=rq(r))}else if(0===a)return"0";for(;a%10==0;)a/=10;return s+a}function rk(e,t,r){if(e!==~~e||e<t||e>r)throw Error(rS+e)}function rj(e,t,r,n){var i,s,a,o;for(s=e[0];s>=10;s/=10)--t;return--t<0?(t+=7,i=0):(i=Math.ceil((t+1)/7),t%=7),s=rM(10,7-t),o=e[i]%s|0,null==n?t<3?(0==t?o=o/100|0:1==t&&(o=o/10|0),a=r<4&&99999==o||r>3&&49999==o||5e4==o||0==o):a=(r<4&&o+1==s||r>3&&o+1==s/2)&&(e[i+1]/s/100|0)==rM(10,t-2)-1||(o==s/2||0==o)&&(e[i+1]/s/100|0)==0:t<4?(0==t?o=o/1e3|0:1==t?o=o/100|0:2==t&&(o=o/10|0),a=(n||r<4)&&9999==o||!n&&r>3&&4999==o):a=((n||r<4)&&o+1==s||!n&&r>3&&o+1==s/2)&&(e[i+1]/s/1e3|0)==rM(10,t-3)-1,a}function rB(e,t,r){for(var n,i,s=[0],a=0,o=e.length;a<o;){for(i=s.length;i--;)s[i]*=t;for(s[0]+=ry.indexOf(e.charAt(a++)),n=0;n<s.length;n++)s[n]>r-1&&(void 0===s[n+1]&&(s[n+1]=0),s[n+1]+=s[n]/r|0,s[n]%=r)}return s.reverse()}rP.absoluteValue=rP.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),rH(e)},rP.ceil=function(){return rH(new this.constructor(this),this.e+1,2)},rP.clampedTo=rP.clamp=function(e,t){var r=this.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(rS+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new r(this)},rP.comparedTo=rP.cmp=function(e){var t,r,n,i,s=this.d,a=(e=new this.constructor(e)).d,o=this.s,l=e.s;if(!s||!a)return o&&l?o!==l?o:s===a?0:!s^o<0?1:-1:NaN;if(!s[0]||!a[0])return s[0]?o:a[0]?-l:0;if(o!==l)return o;if(this.e!==e.e)return this.e>e.e^o<0?1:-1;for(n=s.length,i=a.length,t=0,r=n<i?n:i;t<r;++t)if(s[t]!==a[t])return s[t]>a[t]^o<0?1:-1;return n===i?0:n>i^o<0?1:-1},rP.cosine=rP.cos=function(){var e,t,r=this,n=r.constructor;return r.d?r.d[0]?(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n,i;if(t.isZero())return t;(n=t.d.length)<32?i=(1/r3(4,r=Math.ceil(n/3))).toString():(r=16,i="2.3283064365386962890625e-10"),e.precision+=r,t=r5(e,1,t.times(i),new e(1));for(var s=r;s--;){var a=t.times(t);t=a.times(a).minus(a).times(8).plus(1)}return e.precision-=r,t}(n,r4(n,r)),n.precision=e,n.rounding=t,rH(2==r_||3==r_?r.neg():r,e,t,!0)):new n(1):new n(NaN)},rP.cubeRoot=rP.cbrt=function(){var e,t,r,n,i,s,a,o,l,u,c=this.constructor;if(!this.isFinite()||this.isZero())return new c(this);for(rI=!1,(s=this.s*rM(this.s*this,1/3))&&Math.abs(s)!=1/0?n=new c(s.toString()):(r=rF(this.d),(s=((e=this.e)-r.length+1)%3)&&(r+=1==s||-2==s?"0":"00"),s=rM(r,1/3),e=rw((e+1)/3)-(e%3==(e<0?-1:2)),(n=new c(r=s==1/0?"5e"+e:(r=s.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=this.s),a=(e=c.precision)+3;;)if(n=r$((u=(l=(o=n).times(o).times(o)).plus(this)).plus(this).times(o),u.plus(l),a+2,1),rF(o.d).slice(0,a)===(r=rF(n.d)).slice(0,a))if("9999"!=(r=r.slice(a-3,a+1))&&(i||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(rH(n,e+1,1),t=!n.times(n).times(n).eq(this));break}else{if(!i&&(rH(o,e+1,0),o.times(o).times(o).eq(this))){n=o;break}a+=4,i=1}return rI=!0,rH(n,e,c.rounding,t)},rP.decimalPlaces=rP.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-rw(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},rP.dividedBy=rP.div=function(e){return r$(this,new this.constructor(e))},rP.dividedToIntegerBy=rP.divToInt=function(e){var t=this.constructor;return rH(r$(this,new t(e),0,1,1),t.precision,t.rounding)},rP.equals=rP.eq=function(e){return 0===this.cmp(e)},rP.floor=function(){return rH(new this.constructor(this),this.e+1,3)},rP.greaterThan=rP.gt=function(e){return this.cmp(e)>0},rP.greaterThanOrEqualTo=rP.gte=function(e){var t=this.cmp(e);return 1==t||0===t},rP.hyperbolicCosine=rP.cosh=function(){var e,t,r,n,i,s=this,a=s.constructor,o=new a(1);if(!s.isFinite())return new a(s.s?1/0:NaN);if(s.isZero())return o;r=a.precision,n=a.rounding,a.precision=r+Math.max(s.e,s.sd())+4,a.rounding=1,(i=s.d.length)<32?t=(1/r3(4,e=Math.ceil(i/3))).toString():(e=16,t="2.3283064365386962890625e-10"),s=r5(a,1,s.times(t),new a(1),!0);for(var l,u=e,c=new a(8);u--;)l=s.times(s),s=o.minus(l.times(c.minus(l.times(c))));return rH(s,a.precision=r,a.rounding=n,!0)},rP.hyperbolicSine=rP.sinh=function(){var e,t,r,n,i=this,s=i.constructor;if(!i.isFinite()||i.isZero())return new s(i);if(t=s.precision,r=s.rounding,s.precision=t+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<3)i=r5(s,2,i,i,!0);else{e=(e=1.4*Math.sqrt(n))>16?16:0|e,i=r5(s,2,i=i.times(1/r3(5,e)),i,!0);for(var a,o=new s(5),l=new s(16),u=new s(20);e--;)a=i.times(i),i=i.times(o.plus(a.times(l.times(a).plus(u))))}return s.precision=t,s.rounding=r,rH(i,t,r,!0)},rP.hyperbolicTangent=rP.tanh=function(){var e,t,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,r$(this.sinh(),this.cosh(),r.precision=e,r.rounding=t)):new r(this.s)},rP.inverseCosine=rP.acos=function(){var e=this,t=e.constructor,r=e.abs().cmp(1),n=t.precision,i=t.rounding;return -1!==r?0===r?e.isNeg()?rz(t,n,i):new t(0):new t(NaN):e.isZero()?rz(t,n+4,i).times(.5):(t.precision=n+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=n,t.rounding=i,e.times(2))},rP.inverseHyperbolicCosine=rP.acosh=function(){var e,t,r=this,n=r.constructor;return r.lte(1)?new n(r.eq(1)?0:NaN):r.isFinite()?(e=n.precision,t=n.rounding,n.precision=e+Math.max(Math.abs(r.e),r.sd())+4,n.rounding=1,rI=!1,r=r.times(r).minus(1).sqrt().plus(r),rI=!0,n.precision=e,n.rounding=t,r.ln()):new n(r)},rP.inverseHyperbolicSine=rP.asinh=function(){var e,t,r=this,n=r.constructor;return!r.isFinite()||r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,n.rounding=1,rI=!1,r=r.times(r).plus(1).sqrt().plus(r),rI=!0,n.precision=e,n.rounding=t,r.ln())},rP.inverseHyperbolicTangent=rP.atanh=function(){var e,t,r,n,i=this,s=i.constructor;return i.isFinite()?i.e>=0?new s(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=s.precision,t=s.rounding,Math.max(n=i.sd(),e)<-(2*i.e)-1?rH(new s(i),e,t,!0):(s.precision=r=n-i.e,i=r$(i.plus(1),new s(1).minus(i),r+e,1),s.precision=e+4,s.rounding=1,i=i.ln(),s.precision=e,s.rounding=t,i.times(.5))):new s(NaN)},rP.inverseSine=rP.asin=function(){var e,t,r,n,i=this,s=i.constructor;return i.isZero()?new s(i):(t=i.abs().cmp(1),r=s.precision,n=s.rounding,-1!==t?0===t?((e=rz(s,r+4,n).times(.5)).s=i.s,e):new s(NaN):(s.precision=r+6,s.rounding=1,i=i.div(new s(1).minus(i.times(i)).sqrt().plus(1)).atan(),s.precision=r,s.rounding=n,i.times(2)))},rP.inverseTangent=rP.atan=function(){var e,t,r,n,i,s,a,o,l,u=this,c=u.constructor,h=c.precision,d=c.rounding;if(u.isFinite()){if(u.isZero())return new c(u);if(u.abs().eq(1)&&h+4<=rL)return(a=rz(c,h+4,d).times(.25)).s=u.s,a}else{if(!u.s)return new c(NaN);if(h+4<=rL)return(a=rz(c,h+4,d).times(.5)).s=u.s,a}for(c.precision=o=h+10,c.rounding=1,e=r=Math.min(28,o/7+2|0);e;--e)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(rI=!1,t=Math.ceil(o/7),n=1,l=u.times(u),a=new c(u),i=u;-1!==e;)if(i=i.times(l),s=a.minus(i.div(n+=2)),i=i.times(l),void 0!==(a=s.plus(i.div(n+=2))).d[t])for(e=t;a.d[e]===s.d[e]&&e--;);return r&&(a=a.times(2<<r-1)),rI=!0,rH(a,c.precision=h,c.rounding=d,!0)},rP.isFinite=function(){return!!this.d},rP.isInteger=rP.isInt=function(){return!!this.d&&rw(this.e/7)>this.d.length-2},rP.isNaN=function(){return!this.s},rP.isNegative=rP.isNeg=function(){return this.s<0},rP.isPositive=rP.isPos=function(){return this.s>0},rP.isZero=function(){return!!this.d&&0===this.d[0]},rP.lessThan=rP.lt=function(e){return 0>this.cmp(e)},rP.lessThanOrEqualTo=rP.lte=function(e){return 1>this.cmp(e)},rP.logarithm=rP.log=function(e){var t,r,n,i,s,a,o,l,u=this.constructor,c=u.precision,h=u.rounding;if(null==e)e=new u(10),t=!0;else{if(r=(e=new u(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new u(NaN);t=e.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new u(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(t)if(r.length>1)s=!0;else{for(i=r[0];i%10==0;)i/=10;s=1!==i}if(rI=!1,rj((l=r$(a=r0(this,o=c+5),t?rY(u,o+10):r0(e,o),o,1)).d,i=c,h))do if(o+=10,l=r$(a=r0(this,o),t?rY(u,o+10):r0(e,o),o,1),!s){+rF(l.d).slice(i+1,i+15)+1==1e14&&(l=rH(l,c+1,0));break}while(rj(l.d,i+=10,h))return rI=!0,rH(l,c,h)},rP.minus=rP.sub=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.constructor;if(e=new m(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new m(e.d||this.s!==e.s?this:NaN):e=new m(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(u=this.d,d=e.d,o=m.precision,l=m.rounding,!u[0]||!d[0]){if(d[0])e.s=-e.s;else{if(!u[0])return new m(3===l?-0:0);e=new m(this)}return rI?rH(e,o,l):e}if(r=rw(e.e/7),c=rw(this.e/7),u=u.slice(),s=c-r){for((h=s<0)?(t=u,s=-s,a=d.length):(t=d,r=c,a=u.length),s>(n=Math.max(Math.ceil(o/7),a)+2)&&(s=n,t.length=1),t.reverse(),n=s;n--;)t.push(0);t.reverse()}else{for((h=(n=u.length)<(a=d.length))&&(a=n),n=0;n<a;n++)if(u[n]!=d[n]){h=u[n]<d[n];break}s=0}for(h&&(t=u,u=d,d=t,e.s=-e.s),a=u.length,n=d.length-a;n>0;--n)u[a++]=0;for(n=d.length;n>s;){if(u[--n]<d[n]){for(i=n;i&&0===u[--i];)u[i]=1e7-1;--u[i],u[n]+=1e7}u[n]-=d[n]}for(;0===u[--a];)u.pop();for(;0===u[0];u.shift())--r;return u[0]?(e.d=u,e.e=rG(u,r),rI?rH(e,o,l):e):new m(3===l?-0:0)},rP.modulo=rP.mod=function(e){var t,r=this.constructor;return e=new r(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(rI=!1,9==r.modulo?(t=r$(this,e.abs(),0,3,1),t.s*=e.s):t=r$(this,e,0,r.modulo,1),t=t.times(e),rI=!0,this.minus(t)):rH(new r(this),r.precision,r.rounding):new r(NaN)},rP.naturalExponential=rP.exp=function(){return rJ(this)},rP.naturalLogarithm=rP.ln=function(){return r0(this)},rP.negated=rP.neg=function(){var e=new this.constructor(this);return e.s=-e.s,rH(e)},rP.plus=rP.add=function(e){var t,r,n,i,s,a,o,l,u,c,h=this.constructor;if(e=new h(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new h(e.d||this.s===e.s?this:NaN)):e=new h(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(u=this.d,c=e.d,o=h.precision,l=h.rounding,!u[0]||!c[0])return c[0]||(e=new h(this)),rI?rH(e,o,l):e;if(s=rw(this.e/7),n=rw(e.e/7),u=u.slice(),i=s-n){for(i<0?(r=u,i=-i,a=c.length):(r=c,n=s,a=u.length),i>(a=(s=Math.ceil(o/7))>a?s+1:a+1)&&(i=a,r.length=1),r.reverse();i--;)r.push(0);r.reverse()}for((a=u.length)-(i=c.length)<0&&(i=a,r=c,c=u,u=r),t=0;i;)t=(u[--i]=u[i]+c[i]+t)/1e7|0,u[i]%=1e7;for(t&&(u.unshift(t),++n),a=u.length;0==u[--a];)u.pop();return e.d=u,e.e=rG(u,n),rI?rH(e,o,l):e},rP.precision=rP.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(rS+e);return this.d?(t=rX(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},rP.round=function(){var e=this.constructor;return rH(new e(this),this.e+1,e.rounding)},rP.sine=rP.sin=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+Math.max(r.e,r.sd())+7,n.rounding=1,r=function(e,t){var r,n=t.d.length;if(n<3)return t.isZero()?t:r5(e,2,t,t);r=(r=1.4*Math.sqrt(n))>16?16:0|r,t=r5(e,2,t=t.times(1/r3(5,r)),t);for(var i,s=new e(5),a=new e(16),o=new e(20);r--;)i=t.times(t),t=t.times(s.plus(i.times(a.times(i).minus(o))));return t}(n,r4(n,r)),n.precision=e,n.rounding=t,rH(r_>2?r.neg():r,e,t,!0)):new n(NaN)},rP.squareRoot=rP.sqrt=function(){var e,t,r,n,i,s,a=this.d,o=this.e,l=this.s,u=this.constructor;if(1!==l||!a||!a[0])return new u(!l||l<0&&(!a||a[0])?NaN:a?this:1/0);for(rI=!1,0==(l=Math.sqrt(+this))||l==1/0?(((t=rF(a)).length+o)%2==0&&(t+="0"),l=Math.sqrt(t),o=rw((o+1)/2)-(o<0||o%2),n=new u(t=l==1/0?"5e"+o:(t=l.toExponential()).slice(0,t.indexOf("e")+1)+o)):n=new u(l.toString()),r=(o=u.precision)+3;;)if(n=(s=n).plus(r$(this,s,r+2,1)).times(.5),rF(s.d).slice(0,r)===(t=rF(n.d)).slice(0,r))if("9999"!=(t=t.slice(r-3,r+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(rH(n,o+1,1),e=!n.times(n).eq(this));break}else{if(!i&&(rH(s,o+1,0),s.times(s).eq(this))){n=s;break}r+=4,i=1}return rI=!0,rH(n,o,u.rounding,e)},rP.tangent=rP.tan=function(){var e,t,r=this,n=r.constructor;return r.isFinite()?r.isZero()?new n(r):(e=n.precision,t=n.rounding,n.precision=e+10,n.rounding=1,(r=r.sin()).s=1,r=r$(r,new n(1).minus(r.times(r)).sqrt(),e+10,0),n.precision=e,n.rounding=t,rH(2==r_||4==r_?r.neg():r,e,t,!0)):new n(NaN)},rP.times=rP.mul=function(e){var t,r,n,i,s,a,o,l,u,c=this.constructor,h=this.d,d=(e=new c(e)).d;if(e.s*=this.s,!h||!h[0]||!d||!d[0])return new c(!e.s||h&&!h[0]&&!d||d&&!d[0]&&!h?NaN:!h||!d?e.s/0:0*e.s);for(r=rw(this.e/7)+rw(e.e/7),(l=h.length)<(u=d.length)&&(s=h,h=d,d=s,a=l,l=u,u=a),s=[],n=a=l+u;n--;)s.push(0);for(n=u;--n>=0;){for(t=0,i=l+n;i>n;)o=s[i]+d[n]*h[i-n-1]+t,s[i--]=o%1e7|0,t=o/1e7|0;s[i]=(s[i]+t)%1e7|0}for(;!s[--a];)s.pop();return t?++r:s.shift(),e.d=s,e.e=rG(s,r),rI?rH(e,c.precision,c.rounding):e},rP.toBinary=function(e,t){return r6(this,2,e,t)},rP.toDecimalPlaces=rP.toDP=function(e,t){var r=this,n=r.constructor;return r=new n(r),void 0===e?r:(rk(e,0,1e9),void 0===t?t=n.rounding:rk(t,0,8),rH(r,e+r.e+1,t))},rP.toExponential=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rW(n,!0):(rk(e,0,1e9),void 0===t?t=i.rounding:rk(t,0,8),r=rW(n=rH(new i(n),e+1,t),!0,e+1)),n.isNeg()&&!n.isZero()?"-"+r:r},rP.toFixed=function(e,t){var r,n,i=this.constructor;return void 0===e?r=rW(this):(rk(e,0,1e9),void 0===t?t=i.rounding:rk(t,0,8),r=rW(n=rH(new i(this),e+this.e+1,t),!1,e+n.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},rP.toFraction=function(e){var t,r,n,i,s,a,o,l,u,c,h,d,m=this.d,g=this.constructor;if(!m)return new g(this);if(u=r=new g(1),n=l=new g(0),a=(s=(t=new g(n)).e=rX(m)-this.e-1)%7,t.d[0]=rM(10,a<0?7+a:a),null==e)e=s>0?t:u;else{if(!(o=new g(e)).isInt()||o.lt(u))throw Error(rS+o);e=o.gt(t)?s>0?t:u:o}for(rI=!1,o=new g(rF(m)),c=g.precision,g.precision=s=7*m.length*2;h=r$(o,t,0,1,1),1!=(i=r.plus(h.times(n))).cmp(e);)r=n,n=i,i=u,u=l.plus(h.times(i)),l=i,i=t,t=o.minus(h.times(i)),o=i;return i=r$(e.minus(r),n,0,1,1),l=l.plus(i.times(u)),r=r.plus(i.times(n)),l.s=u.s=this.s,d=1>r$(u,n,s,1).minus(this).abs().cmp(r$(l,r,s,1).minus(this).abs())?[u,n]:[l,r],g.precision=c,rI=!0,d},rP.toHexadecimal=rP.toHex=function(e,t){return r6(this,16,e,t)},rP.toNearest=function(e,t){var r=this,n=r.constructor;if(r=new n(r),null==e){if(!r.d)return r;e=new n(1),t=n.rounding}else{if(e=new n(e),void 0===t?t=n.rounding:rk(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(rI=!1,r=r$(r,e,0,t,1).times(e),rI=!0,rH(r)):(e.s=r.s,r=e),r},rP.toNumber=function(){return+this},rP.toOctal=function(e,t){return r6(this,8,e,t)},rP.toPower=rP.pow=function(e){var t,r,n,i,s,a,o=this,l=o.constructor,u=+(e=new l(e));if(!o.d||!e.d||!o.d[0]||!e.d[0])return new l(rM(+o,u));if((o=new l(o)).eq(1))return o;if(n=l.precision,s=l.rounding,e.eq(1))return rH(o,n,s);if((t=rw(e.e/7))>=e.d.length-1&&(r=u<0?-u:u)<=0x1fffffffffffff)return i=rK(l,o,r,n),e.s<0?new l(1).div(i):rH(i,n,s);if((a=o.s)<0){if(t<e.d.length-1)return new l(NaN);if((1&e.d[t])==0&&(a=1),0==o.e&&1==o.d[0]&&1==o.d.length)return o.s=a,o}return(t=0!=(r=rM(+o,u))&&isFinite(r)?new l(r+"").e:rw(u*(Math.log("0."+rF(o.d))/Math.LN10+o.e+1)))>l.maxE+1||t<l.minE-1?new l(t>0?a/0:0):(rI=!1,l.rounding=o.s=1,r=Math.min(12,(t+"").length),(i=rJ(e.times(r0(o,n+r)),n)).d&&rj((i=rH(i,n+5,1)).d,n,s)&&(t=n+10,+rF((i=rH(rJ(e.times(r0(o,t+r)),t),t+5,1)).d).slice(n+1,n+15)+1==1e14&&(i=rH(i,n+1,0))),i.s=a,rI=!0,l.rounding=s,rH(i,n,s))},rP.toPrecision=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=rW(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(rk(e,1,1e9),void 0===t?t=i.rounding:rk(t,0,8),r=rW(n=rH(new i(n),e,t),e<=n.e||n.e<=i.toExpNeg,e)),n.isNeg()&&!n.isZero()?"-"+r:r},rP.toSignificantDigits=rP.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(rk(e,1,1e9),void 0===t?t=r.rounding:rk(t,0,8)),rH(new r(this),e,t)},rP.toString=function(){var e=this.constructor,t=rW(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},rP.truncated=rP.trunc=function(){return rH(new this.constructor(this),this.e+1,1)},rP.valueOf=rP.toJSON=function(){var e=this.constructor,t=rW(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t};var r$=function(){function e(e,t,r){var n,i=0,s=e.length;for(e=e.slice();s--;)n=e[s]*t+i,e[s]=n%r|0,i=n/r|0;return i&&e.unshift(i),e}function t(e,t,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(e[i]!=t[i]){s=e[i]>t[i]?1:-1;break}return s}function r(e,t,r,n){for(var i=0;r--;)e[r]-=i,i=+(e[r]<t[r]),e[r]=i*n+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(n,i,s,a,o,l){var u,c,h,d,m,g,f,p,C,_,y,E,R,b,I,N,S,A,v,T,w=n.constructor,M=n.s==i.s?1:-1,O=n.d,x=i.d;if(!O||!O[0]||!x||!x[0])return new w(!n.s||!i.s||(O?x&&O[0]==x[0]:!x)?NaN:O&&0==O[0]||!x?0*M:M/0);for(l?(m=1,c=n.e-i.e):(l=1e7,m=7,c=rw(n.e/m)-rw(i.e/m)),v=x.length,S=O.length,_=(C=new w(M)).d=[],h=0;x[h]==(O[h]||0);h++);if(x[h]>(O[h]||0)&&c--,null==s?(b=s=w.precision,a=w.rounding):b=o?s+(n.e-i.e)+1:s,b<0)_.push(1),g=!0;else{if(b=b/m+2|0,h=0,1==v){for(d=0,x=x[0],b++;(h<S||d)&&b--;h++)I=d*l+(O[h]||0),_[h]=I/x|0,d=I%x|0;g=d||h<S}else{for((d=l/(x[0]+1)|0)>1&&(x=e(x,d,l),O=e(O,d,l),v=x.length,S=O.length),N=v,E=(y=O.slice(0,v)).length;E<v;)y[E++]=0;(T=x.slice()).unshift(0),A=x[0],x[1]>=l/2&&++A;do d=0,(u=t(x,y,v,E))<0?(R=y[0],v!=E&&(R=R*l+(y[1]||0)),(d=R/A|0)>1?(d>=l&&(d=l-1),p=(f=e(x,d,l)).length,E=y.length,1==(u=t(f,y,p,E))&&(d--,r(f,v<p?T:x,p,l))):(0==d&&(u=d=1),f=x.slice()),(p=f.length)<E&&f.unshift(0),r(y,f,E,l),-1==u&&(E=y.length,(u=t(x,y,v,E))<1&&(d++,r(y,v<E?T:x,E,l))),E=y.length):0===u&&(d++,y=[0]),_[h++]=d,u&&y[0]?y[E++]=O[N]||0:(y=[O[N]],E=1);while((N++<S||void 0!==y[0])&&b--)g=void 0!==y[0]}_[0]||_.shift()}if(1==m)C.e=c,rC=g;else{for(h=1,d=_[0];d>=10;d/=10)h++;C.e=h+c*m-1,rH(C,o?s+C.e+1:s,a,g)}return C}}();function rH(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor;t:if(null!=t){if(!(h=e.d))return e;for(i=1,o=h[0];o>=10;o/=10)i++;if((s=t-i)<0)s+=7,a=t,l=(c=h[d=0])/rM(10,i-a-1)%10|0;else if((d=Math.ceil((s+1)/7))>=(o=h.length))if(n){for(;o++<=d;)h.push(0);c=l=0,i=1,s%=7,a=s-7+1}else break t;else{for(c=o=h[d],i=1;o>=10;o/=10)i++;s%=7,l=(a=s-7+i)<0?0:c/rM(10,i-a-1)%10|0}if(n=n||t<0||void 0!==h[d+1]||(a<0?c:c%rM(10,i-a-1)),u=r<4?(l||n)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||n||6==r&&(s>0?a>0?c/rM(10,i-a):0:h[d-1])%10&1||r==(e.s<0?8:7)),t<1||!h[0])return h.length=0,u?(t-=e.e+1,h[0]=rM(10,(7-t%7)%7),e.e=-t||0):h[0]=e.e=0,e;if(0==s?(h.length=d,o=1,d--):(h.length=d+1,o=rM(10,7-s),h[d]=a>0?(c/rM(10,i-a)%rM(10,a)|0)*o:0),u)for(;;)if(0==d){for(s=1,a=h[0];a>=10;a/=10)s++;for(a=h[0]+=o,o=1;a>=10;a/=10)o++;s!=o&&(e.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[d]+=o,1e7!=h[d])break;h[d--]=0,o=1}for(s=h.length;0===h[--s];)h.pop()}return rI&&(e.e>m.maxE?(e.d=null,e.e=NaN):e.e<m.minE&&(e.e=0,e.d=[0])),e}function rW(e,t,r){if(!e.isFinite())return r1(e);var n,i=e.e,s=rF(e.d),a=s.length;return t?(r&&(n=r-a)>0?s=s.charAt(0)+"."+s.slice(1)+rq(n):a>1&&(s=s.charAt(0)+"."+s.slice(1)),s=s+(e.e<0?"e":"e+")+e.e):i<0?(s="0."+rq(-i-1)+s,r&&(n=r-a)>0&&(s+=rq(n))):i>=a?(s+=rq(i+1-a),r&&(n=r-i-1)>0&&(s=s+"."+rq(n))):((n=i+1)<a&&(s=s.slice(0,n)+"."+s.slice(n)),r&&(n=r-a)>0&&(i+1===a&&(s+="."),s+=rq(n))),s}function rG(e,t){var r=e[0];for(t*=7;r>=10;r/=10)t++;return t}function rY(e,t,r){if(t>rV)throw rI=!0,r&&(e.precision=r),Error(rA);return rH(new e(rE),t,1,!0)}function rz(e,t,r){if(t>rL)throw Error(rA);return rH(new e(rR),t,r,!0)}function rX(e){var t=e.length-1,r=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function rq(e){for(var t="";e--;)t+="0";return t}function rK(e,t,r,n){var i,s=new e(1),a=Math.ceil(n/7+4);for(rI=!1;;){if(r%2&&r9((s=s.times(t)).d,a)&&(i=!0),0===(r=rw(r/2))){r=s.d.length-1,i&&0===s.d[r]&&++s.d[r];break}r9((t=t.times(t)).d,a)}return rI=!0,s}function rQ(e){return 1&e.d[e.d.length-1]}function rZ(e,t,r){for(var n,i,s=new e(t[0]),a=0;++a<t.length;){if(!(i=new e(t[a])).s){s=i;break}((n=s.cmp(i))===r||0===n&&s.s===r)&&(s=i)}return s}function rJ(e,t){var r,n,i,s,a,o,l,u=0,c=0,h=0,d=e.constructor,m=d.rounding,g=d.precision;if(!e.d||!e.d[0]||e.e>17)return new d(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(rI=!1,l=g):l=t,o=new d(.03125);e.e>-2;)e=e.times(o),h+=5;for(l+=n=Math.log(rM(2,h))/Math.LN10*2+5|0,r=s=a=new d(1),d.precision=l;;){if(s=rH(s.times(e),l,1),r=r.times(++c),rF((o=a.plus(r$(s,r,l,1))).d).slice(0,l)===rF(a.d).slice(0,l)){for(i=h;i--;)a=rH(a.times(a),l,1);if(null!=t)return d.precision=g,a;if(!(u<3&&rj(a.d,l-n,m,u)))return rH(a,d.precision=g,m,rI=!0);d.precision=l+=10,r=s=o=new d(1),c=0,u++}a=o}}function r0(e,t){var r,n,i,s,a,o,l,u,c,h,d,m=1,g=e,f=g.d,p=g.constructor,C=p.rounding,_=p.precision;if(g.s<0||!f||!f[0]||!g.e&&1==f[0]&&1==f.length)return new p(f&&!f[0]?-1/0:1!=g.s?NaN:f?0:g);if(null==t?(rI=!1,c=_):c=t,p.precision=c+=10,n=(r=rF(f)).charAt(0),!(15e14>Math.abs(s=g.e)))return u=rY(p,c+2,_).times(s+""),g=r0(new p(n+"."+r.slice(1)),c-10).plus(u),p.precision=_,null==t?rH(g,_,C,rI=!0):g;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=rF((g=g.times(e)).d)).charAt(0),m++;for(s=g.e,n>1?(g=new p("0."+r),s++):g=new p(n+"."+r.slice(1)),h=g,l=a=g=r$(g.minus(1),g.plus(1),c,1),d=rH(g.times(g),c,1),i=3;;){if(a=rH(a.times(d),c,1),rF((u=l.plus(r$(a,new p(i),c,1))).d).slice(0,c)===rF(l.d).slice(0,c))if(l=l.times(2),0!==s&&(l=l.plus(rY(p,c+2,_).times(s+""))),l=r$(l,new p(m),c,1),null!=t)return p.precision=_,l;else{if(!rj(l.d,c-10,C,o))return rH(l,p.precision=_,C,rI=!0);p.precision=c+=10,u=a=g=r$(h.minus(1),h.plus(1),c,1),d=rH(g.times(g),c,1),i=o=1}l=u,i+=2}}function r1(e){return String(e.s*e.s/0)}function r2(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;48===t.charCodeAt(n);n++);for(i=t.length;48===t.charCodeAt(i-1);--i);if(t=t.slice(n,i)){if(i-=n,e.e=r=r-n-1,e.d=[],n=(r+1)%7,r<0&&(n+=7),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=7;n<i;)e.d.push(+t.slice(n,n+=7));n=7-(t=t.slice(n)).length}else n-=i;for(;n--;)t+="0";e.d.push(+t),rI&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function r5(e,t,r,n,i){var s,a,o,l,u=e.precision,c=Math.ceil(u/7);for(rI=!1,l=r.times(r),o=new e(n);;){if(a=r$(o.times(l),new e(t++*t++),u,1),o=i?n.plus(a):n.minus(a),n=r$(a.times(l),new e(t++*t++),u,1),void 0!==(a=o.plus(n)).d[c]){for(s=c;a.d[s]===o.d[s]&&s--;);if(-1==s)break}s=o,o=n,n=a,a=s}return rI=!0,a.d.length=c+1,a}function r3(e,t){for(var r=e;--t;)r*=e;return r}function r4(e,t){var r,n=t.s<0,i=rz(e,e.precision,1),s=i.times(.5);if((t=t.abs()).lte(s))return r_=n?4:1,t;if((r=t.divToInt(i)).isZero())r_=n?3:2;else{if((t=t.minus(r.times(i))).lte(s))return r_=rQ(r)?n?2:3:n?4:1,t;r_=rQ(r)?n?1:4:n?3:2}return t.minus(i).abs()}function r6(e,t,r,n){var i,s,a,o,l,u,c,h,d,m=e.constructor,g=void 0!==r;if(g?(rk(r,1,1e9),void 0===n?n=m.rounding:rk(n,0,8)):(r=m.precision,n=m.rounding),e.isFinite()){for(a=(c=rW(e)).indexOf("."),g?(i=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):i=t,a>=0&&(c=c.replace(".",""),(d=new m(1)).e=c.length-a,d.d=rB(rW(d),10,i),d.e=d.d.length),s=l=(h=rB(c,10,i)).length;0==h[--l];)h.pop();if(h[0]){if(a<0?s--:((e=new m(e)).d=h,e.e=s,h=(e=r$(e,d,r,n,0,i)).d,s=e.e,u=rC),a=h[r],o=i/2,u=u||void 0!==h[r+1],u=n<4?(void 0!==a||u)&&(0===n||n===(e.s<0?3:2)):a>o||a===o&&(4===n||u||6===n&&1&h[r-1]||n===(e.s<0?8:7)),h.length=r,u)for(;++h[--r]>i-1;)h[r]=0,r||(++s,h.unshift(1));for(l=h.length;!h[l-1];--l);for(a=0,c="";a<l;a++)c+=ry.charAt(h[a]);if(g){if(l>1)if(16==t||8==t){for(a=16==t?4:3,--l;l%a;l++)c+="0";for(l=(h=rB(c,i,t)).length;!h[l-1];--l);for(a=1,c="1.";a<l;a++)c+=ry.charAt(h[a])}else c=c.charAt(0)+"."+c.slice(1);c=c+(s<0?"p":"p+")+s}else if(s<0){for(;++s;)c="0"+c;c="0."+c}else if(++s>l)for(s-=l;s--;)c+="0";else s<l&&(c=c.slice(0,s)+"."+c.slice(s))}else c=g?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=r1(e);return e.s<0?"-"+c:c}function r9(e,t){if(e.length>t)return e.length=t,!0}function r8(e){return new this(e).abs()}function r7(e){return new this(e).acos()}function ne(e){return new this(e).acosh()}function nt(e,t){return new this(e).plus(t)}function nr(e){return new this(e).asin()}function nn(e){return new this(e).asinh()}function ni(e){return new this(e).atan()}function ns(e){return new this(e).atanh()}function na(e,t){e=new this(e),t=new this(t);var r,n=this.precision,i=this.rounding,s=n+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?rz(this,n,i):new this(0)).s=e.s:!e.d||t.isZero()?(r=rz(this,s,1).times(.5)).s=e.s:t.s<0?(this.precision=s,this.rounding=1,r=this.atan(r$(e,t,s,1)),t=rz(this,s,1),this.precision=n,this.rounding=i,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(r$(e,t,s,1)):(r=rz(this,s,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function no(e){return new this(e).cbrt()}function nl(e){return rH(e=new this(e),e.e+1,2)}function nu(e,t,r){return new this(e).clamp(t,r)}function nc(e){if(!e||"object"!=typeof e)throw Error(rN+"Object expected");var t,r,n,i=!0===e.defaults,s=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<s.length;t+=3)if(r=s[t],i&&(this[r]=rb[r]),void 0!==(n=e[r]))if(rw(n)===n&&n>=s[t+1]&&n<=s[t+2])this[r]=n;else throw Error(rS+r+": "+n);if(r="crypto",i&&(this[r]=rb[r]),void 0!==(n=e[r]))if(!0===n||!1===n||0===n||1===n)if(n)if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(rv);else this[r]=!1;else throw Error(rS+r+": "+n);return this}function nh(e){return new this(e).cos()}function nd(e){return new this(e).cosh()}function nm(e,t){return new this(e).div(t)}function ng(e){return new this(e).exp()}function nf(e){return rH(e=new this(e),e.e+1,3)}function np(){var e,t,r=new this(0);for(rI=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return rI=!0,new this(1/0);r=t}return rI=!0,r.sqrt()}function nC(e){return e instanceof nF||e&&e.toStringTag===rT||!1}function n_(e){return new this(e).ln()}function ny(e,t){return new this(e).log(t)}function nE(e){return new this(e).log(2)}function nR(e){return new this(e).log(10)}function nb(){return rZ(this,arguments,-1)}function nI(){return rZ(this,arguments,1)}function nN(e,t){return new this(e).mod(t)}function nS(e,t){return new this(e).mul(t)}function nA(e,t){return new this(e).pow(t)}function nv(e){var t,r,n,i,s=0,a=new this(1),o=[];if(void 0===e?e=this.precision:rk(e,1,1e9),n=Math.ceil(e/7),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(n));s<n;)(i=t[s])>=429e7?t[s]=crypto.getRandomValues(new Uint32Array(1))[0]:o[s++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(n*=4);s<n;)(i=t[s]+(t[s+1]<<8)+(t[s+2]<<16)+((127&t[s+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,s):(o.push(i%1e7),s+=4);s=n/4}else throw Error(rv);else for(;s<n;)o[s++]=1e7*Math.random()|0;for(n=o[--s],e%=7,n&&e&&(i=rM(10,7-e),o[s]=(n/i|0)*i);0===o[s];s--)o.pop();if(s<0)r=0,o=[0];else{for(r=-1;0===o[0];r-=7)o.shift();for(n=1,i=o[0];i>=10;i/=10)n++;n<7&&(r-=7-n)}return a.e=r,a.d=o,a}function nT(e){return rH(e=new this(e),e.e+1,this.rounding)}function nw(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function nM(e){return new this(e).sin()}function nO(e){return new this(e).sinh()}function nx(e){return new this(e).sqrt()}function nU(e,t){return new this(e).sub(t)}function nD(){var e=0,t=arguments,r=new this(t[0]);for(rI=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return rI=!0,rH(r,this.precision,this.rounding)}function nV(e){return new this(e).tan()}function nL(e){return new this(e).tanh()}function nP(e){return rH(e=new this(e),e.e+1,1)}rP[Symbol.for("nodejs.util.inspect.custom")]=rP.toString,rP[Symbol.toStringTag]="Decimal";var nF=rP.constructor=function e(t){var r,n,i;function s(e){var t,r,n;if(!(this instanceof s))return new s(e);if(this.constructor=s,nC(e)){this.s=e.s,rI?!e.d||e.e>s.maxE?(this.e=NaN,this.d=null):e.e<s.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(n=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;rI?t>s.maxE?(this.e=NaN,this.d=null):t<s.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return r2(this,e.toString())}if("string"===n)return 45===(r=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===r&&(e=e.slice(1)),this.s=1),rD.test(e)?r2(this,e):function(e,t){var r,n,i,s,a,o,l,u,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),rD.test(t))return r2(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(rx.test(t))r=16,t=t.toLowerCase();else if(rO.test(t))r=2;else if(rU.test(t))r=8;else throw Error(rS+t);for((s=t.search(/p/i))>0?(l=+t.slice(s+1),t=t.substring(2,s)):t=t.slice(2),a=(s=t.indexOf("."))>=0,n=e.constructor,a&&(s=(o=(t=t.replace(".","")).length)-s,i=rK(n,new n(r),s,2*s)),s=c=(u=rB(t,r,1e7)).length-1;0===u[s];--s)u.pop();return s<0?new n(0*e.s):(e.e=rG(u,c),e.d=u,rI=!1,a&&(e=r$(e,i,4*o)),l&&(e=e.times(54>Math.abs(l)?rM(2,l):nF.pow(2,l))),rI=!0,e)}(this,e);if("bigint"===n)return e<0?(e=-e,this.s=-1):this.s=1,r2(this,e.toString());throw Error(rS+e)}if(s.prototype=rP,s.ROUND_UP=0,s.ROUND_DOWN=1,s.ROUND_CEIL=2,s.ROUND_FLOOR=3,s.ROUND_HALF_UP=4,s.ROUND_HALF_DOWN=5,s.ROUND_HALF_EVEN=6,s.ROUND_HALF_CEIL=7,s.ROUND_HALF_FLOOR=8,s.EUCLID=9,s.config=s.set=nc,s.clone=e,s.isDecimal=nC,s.abs=r8,s.acos=r7,s.acosh=ne,s.add=nt,s.asin=nr,s.asinh=nn,s.atan=ni,s.atanh=ns,s.atan2=na,s.cbrt=no,s.ceil=nl,s.clamp=nu,s.cos=nh,s.cosh=nd,s.div=nm,s.exp=ng,s.floor=nf,s.hypot=np,s.ln=n_,s.log=ny,s.log10=nR,s.log2=nE,s.max=nb,s.min=nI,s.mod=nN,s.mul=nS,s.pow=nA,s.random=nv,s.round=nT,s.sign=nw,s.sin=nM,s.sinh=nO,s.sqrt=nx,s.sub=nU,s.sum=nD,s.tan=nV,s.tanh=nL,s.trunc=nP,void 0===t&&(t={}),t&&!0!==t.defaults)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],r=0;r<i.length;)t.hasOwnProperty(n=i[r++])||(t[n]=this[n]);return s.config(t),s}(rb);function nk(e,t){let r=e*t;return Number.isSafeInteger(r)?r:new nF(e).mul(t).toNumber()}function nj(e,t){let r=10**Math.trunc(t),n=nH(e,r);return Math.round(nk(e,r)+n)/r}function nB(e,t){let r=10**Math.trunc(t),n=nH(e,r);return Math.floor(nk(e,r)+n)/r}function n$(e,t){let r=10**Math.trunc(t),n=nH(e,r);return Math.ceil(nk(e,r)-n)/r}function nH(e,t){return Number.EPSILON*Math.max(1,Math.abs(nk(e,t)))}function nW(e,t){return e-t*Math.floor(e/t)}rE=new nF(rE),rR=new nF(rR);function nG(e,t=15){return Number.parseFloat(e.toPrecision(t))}function nY(e,t=12,r=1e-10){let n=nG(e,t);return!function(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}(e,n,r)?nG(e):n}let nz=class e extends ro{static create(){return this._instance=this._instance||new e(0),this._instance}isNull(){return!0}plus(e){return nQ.create(0).plus(e)}minus(e){return nQ.create(0).minus(e)}multiply(e){return nQ.create(0).multiply(e)}divided(e){return nQ.create(0).divided(e)}mod(e){return nQ.create(0).mod(e)}compare(e,t){return e.isString()?nJ.create("").compare(e,t):e.isBoolean()?nK.create(!1).compare(e,t):nQ.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(nJ.create("")):nJ.create(this.concatenate(e.getValue(),ei.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(nJ.create("")):nJ.create(this.concatenate(e.getValue(),ei.BACK))}plusBy(e){return nQ.create(0).plusBy(e)}minusBy(e){return nQ.create(0).minusBy(e)}multiplyBy(e){return nQ.create(0).multiplyBy(e)}dividedBy(e){return nQ.create(0).dividedBy(e)}compareBy(e,t){return"string"==typeof e?nJ.create("").compareBy(e,t):"boolean"==typeof e?nK.create(!1).compareBy(e,t):nQ.create(0).compareBy(e,t)}pow(e){return nQ.create(0).pow(e)}sqrt(){return nQ.create(0).sqrt()}cbrt(){return nQ.create(0).cbrt()}cos(){return nQ.create(0).cos()}cosh(){return nQ.create(0).cosh()}acos(){return nQ.create(0).acos()}acosh(){return nQ.create(0).acosh()}sin(){return nQ.create(0).sin()}sinh(){return nQ.create(0).sinh()}asin(){return nQ.create(0).asin()}asinh(){return nQ.create(0).asinh()}tan(){return nQ.create(0).tan()}tanh(){return nQ.create(0).tanh()}atan(){return nQ.create(0).atan()}atan2(e){return nQ.create(0).atan2(e)}atanh(){return nQ.create(0).atanh()}log(){return ru.create(ea.NUM)}log10(){return ru.create(ea.NUM)}exp(){return nQ.create(0).exp()}abs(){return nQ.create(0).abs()}round(e){return nQ.create(0).round(e)}floor(e){return nQ.create(0).floor(e)}ceil(e){return nQ.create(0).ceil(e)}convertToNumberObjectValue(){return nQ.create(0)}convertToBooleanObjectValue(){return nK.create(!1)}};J(nz,"_instance");let nX=nz,nq=class e extends ro{constructor(e){super(e),J(this,"_value",!1),this._value=e}static create(t){return t?(this._instanceTrue=this._instanceTrue||new e(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new e(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){let e=this.getValue(),t=0;return e&&(t=1),nQ.create(-t)}getReciprocal(){return this.getValue()?nQ.create(1):ru.create(ea.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,rp(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(t,r){let n=!1;if("string"==typeof t||"number"==typeof t)n=this._compareString(r);else if("boolean"==typeof t){let e=nQ.create(+!!t);return this._convertToNumber().compare(e,r)}return e.create(n)}_compareString(e){switch(e){case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:return!0;case eh.EQUALS:case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:case eh.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){let e=this.getValue(),t=0;return e&&(t=1),nQ.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return n1(this.getValue())}convertToBooleanObjectValue(){return this}};J(nq,"_instanceTrue"),J(nq,"_instanceFalse");let nK=nq;class nQ extends ro{constructor(e){super(e),J(this,"_value",0),this._value=Number(e)}static create(e,t=""){let r=new nQ(e);return t&&r.setPattern(t),r}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return nQ.create(0).minus(this)}getReciprocal(){return nQ.create(1).divided(this)}plus(e){if(e.isArray())return e.plus(this);let t=this.plusBy(e.getValue());if(t.isError())return t;let r=re(this.getPattern(),e.getPattern(),ec.PLUS);return nQ.create(Number(t.getValue()),r)}equalZero(){return 0===this._value}minus(e){if(e.isArray()){let t=e.getNegative();return t.isError()?t:t.plus(this)}let t=this.minusBy(e.getValue());if(t.isError())return t;let r=re(this.getPattern(),e.getPattern(),ec.MINUS);return nQ.create(Number(t.getValue()),r)}multiply(e){if(e.isArray())return e.multiply(this);let t=this.multiplyBy(e.getValue());if(t.isError())return t;let r=re(this.getPattern(),e.getPattern(),ec.MULTIPLY);return nQ.create(Number(t.getValue()),r)}divided(e){if(e.isArray()){let t=e.getReciprocal();return t.isError()?t:t.multiply(this)}let t=this.dividedBy(e.getValue());if(t.isError())return t;let r=re(this.getPattern(),e.getPattern(),ec.DIVIDED);return nQ.create(Number(t.getValue()),r)}mod(e){if(e.isArray())return e.modInverse(this);let t=this.getValue(),r=e.getValue();if(e.isNull())return ru.create(ea.DIV_BY_ZERO);if("string"==typeof r)return ru.create(ea.VALUE);if("number"==typeof r){if(0===r)return ru.create(ea.DIV_BY_ZERO);if(!Number.isFinite(t)||!Number.isFinite(r)||11259e8*Math.abs(r)<=Math.abs(t))return ru.create(ea.NUM);let e=nW(t,r);return Number.isFinite(e)?nQ.create(e):ru.create(ea.NUM)}if("boolean"==typeof r){let e=+!!r;return 0===e?ru.create(ea.DIV_BY_ZERO):nQ.create(nW(t,e))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nJ.create(this.concatenate(e.getValue(),ei.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nJ.create(this.concatenate(e.getValue(),ei.BACK))}compare(e,t){return e.isArray()?e.compare(this,rp(t)):this.compareBy(e.getValue(),t)}plusBy(e){if("string"==typeof e&&""===e.trim())return ru.create(ea.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ru.create(ea.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let n=function(e,t){let r=e+t;return Number.isSafeInteger(r)?r:new nF(e).add(t).toNumber()}(t,r);return Number.isFinite(n)?nQ.create(n):ru.create(ea.NUM)}minusBy(e){if("string"==typeof e&&""===e.trim())return ru.create(ea.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ru.create(ea.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let n=function(e,t){let r=e-t;return Number.isSafeInteger(r)?r:new nF(e).sub(t).toNumber()}(t,r);return Number.isFinite(n)?nQ.create(n):ru.create(ea.NUM)}multiplyBy(e){if("string"==typeof e&&""===e.trim())return ru.create(ea.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ru.create(ea.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let n=nk(t,r);return Number.isFinite(n)?nQ.create(n):ru.create(ea.NUM)}dividedBy(e){if("string"==typeof e&&""===e.trim())return ru.create(ea.VALUE);let t=+this.getValue(),r=+e;if(Number.isNaN(t)||Number.isNaN(r))return ru.create(ea.VALUE);if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);if(0===r)return ru.create(ea.DIV_BY_ZERO);let n=function(e,t){let r=e/t;return Number.isSafeInteger(r)?r:new nF(e).div(t).toNumber()}(t,r);return Number.isFinite(n)?nQ.create(n):ru.create(ea.NUM)}compareBy(e,t){let r=this.getValue(),n=!1;return"string"==typeof e?n=this._compareString(t):"number"==typeof e?n=this._compareNumber(r,e,t):"boolean"==typeof e&&(n=this._compareBoolean(t)),nK.create(n)}_compareString(e){switch(e){case eh.EQUALS:case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:return!1;case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:case eh.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return Number.isFinite(e)&&Number.isFinite(t)?this._compareFiniteNumber(e,t,r):this._compareInfinity(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case eh.EQUALS:return e===t;case eh.GREATER_THAN:return e>t;case eh.GREATER_THAN_OR_EQUAL:return e>=t;case eh.LESS_THAN:return e<t;case eh.LESS_THAN_OR_EQUAL:return e<=t;case eh.NOT_EQUAL:return e!==t}}_compareBoolean(e){switch(e){case eh.EQUALS:case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:return!1;case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:case eh.NOT_EQUAL:return!0}}pow(e){if(e.isArray())return e.powInverse(this);if(this.isError())return this;let t=this.getValue(),r=e;if(e.isString()&&(r=e.convertToNumberObjectValue()),r.isError())return r;let n=+r.getValue();if(Number.isNaN(n))return ru.create(ea.VALUE);if(!Number.isFinite(t)||!Number.isFinite(n))return ru.create(ea.NUM);if(0===t)return n<0?ru.create(ea.DIV_BY_ZERO):0===n?ru.create(ea.NUM):nQ.create(0);let i=t**n;return Number.isFinite(i)?nQ.create(i):ru.create(ea.NUM)}sqrt(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.sqrt(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}cbrt(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.cbrt(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}cos(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.cos(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}cosh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.cosh(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}acos(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.acos(e);return Number.isNaN(t)?ru.create(ea.NUM):nQ.create(t)}acosh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.acosh(e);return Number.isNaN(t)?ru.create(ea.NUM):nQ.create(t)}sin(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.sin(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}sinh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.sinh(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}asin(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.asin(e);return Number.isNaN(t)?ru.create(ea.NUM):nQ.create(t)}asinh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.asinh(e);return Number.isNaN(t)?ru.create(ea.NUM):nQ.create(t)}tan(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.tan(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}tanh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.tanh(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}atan(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.atan(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}atan2(e){if(e.isArray())return e.atan2Inverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ru.create(ea.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);if(0===t&&0===r)return ru.create(ea.DIV_BY_ZERO);let e=Math.atan2(t,r);return Number.isFinite(e)?nQ.create(e):ru.create(ea.NUM)}return"boolean"==typeof r?nQ.create(Math.atan2(t,+!!r)):this}atanh(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.atanh(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}log(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.log(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}log10(){let e=this.getValue();if("number"==typeof e&&e<=0||!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.log10(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}exp(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.exp(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}abs(){let e=this.getValue();if(!Number.isFinite(e))return ru.create(ea.NUM);let t=Math.abs(e);return Number.isFinite(t)?nQ.create(t):ru.create(ea.NUM)}round(e){if(e.isArray())return e.roundInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ru.create(ea.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let e=t<0?-nj(Math.abs(t),r):nj(t,r);return Number.isFinite(e)?nQ.create(e):ru.create(ea.NUM)}return"boolean"==typeof r?nQ.create(nj(t,+!!r)):this}floor(e){if(e.isArray())return e.floorInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ru.create(ea.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let e=t<0?-nB(Math.abs(t),r):nB(t,r);return Number.isFinite(e)?nQ.create(e):ru.create(ea.NUM)}return"boolean"==typeof r?nQ.create(nB(t,+!!r)):this}ceil(e){if(e.isArray())return e.ceilInverse(this);let t=this.getValue(),r=e.getValue();if("string"==typeof r)return ru.create(ea.VALUE);if("number"==typeof r){if(!Number.isFinite(t)||!Number.isFinite(r))return ru.create(ea.NUM);let e=t<0?-n$(Math.abs(t),r):n$(t,r);return Number.isFinite(e)?nQ.create(e):ru.create(ea.NUM)}return"boolean"==typeof r?nQ.create(n$(t,+!!r)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return n0(!0)}_compareInfinity(e,t,r){let n=!1;switch(r){case eh.EQUALS:n=e===t;break;case eh.GREATER_THAN:n=e>t;break;case eh.GREATER_THAN_OR_EQUAL:n=e>=t;break;case eh.LESS_THAN:n=e<t;break;case eh.LESS_THAN_OR_EQUAL:n=e<=t;break;case eh.NOT_EQUAL:n=e!==t}return n}}let nZ=new tN(1e5);class nJ extends ro{constructor(e){super(e),J(this,"_value"),this._value=e}static create(e){let t=nZ.get(e);if(t)return t;let r=new nJ(e);return nZ.set(e,r),r}getValue(){return this._value}isString(){return!0}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nJ.create(this.concatenate(e.getValue(),ei.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nJ.create(this.concatenate(e.getValue(),ei.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,rp(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let n=this.getValue(),i=!1;if("string"==typeof e){var s;let a=e;if(r||(n=n.toLocaleLowerCase(),a=a.toLocaleLowerCase()),(s=a).indexOf("*")>-1||s.indexOf("?")>-1)return this._checkWildcard(a,t);i=this._compareString(n,a,t)}else"number"==typeof e?i=this._compareNumber(t):"boolean"==typeof e&&(i=this._compareBoolean(t));return nK.create(i)}_compareString(e,t,r){switch(r){case eh.EQUALS:return e===t;case eh.GREATER_THAN:return e>t;case eh.GREATER_THAN_OR_EQUAL:return e>=t;case eh.LESS_THAN:return e<t;case eh.LESS_THAN_OR_EQUAL:return e<=t;case eh.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case eh.NOT_EQUAL:case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:return!0;case eh.EQUALS:case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case eh.EQUALS:case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:return!1;case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:case eh.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return n1(this.getValue())}convertToBooleanObjectValue(){return nK.create(!0)}_checkWildcard(e,t){let r=function(e,t,r){let n=!1;switch(r){case eh.EQUALS:n=rm(e,t);break;case eh.NOT_EQUAL:n=!rm(e,t);break;case eh.GREATER_THAN:case eh.GREATER_THAN_OR_EQUAL:n=rm(e,t)||e>rg(t);break;case eh.LESS_THAN:case eh.LESS_THAN_OR_EQUAL:n=e<rg(t)}return n}(this.getValue().toLocaleLowerCase(),e,t);return nK.create(r)}}function n0(e){if("boolean"==typeof e)return nK.create(e);let t=!1;if("string"==typeof e){let r=e.toLocaleUpperCase();r===er.TRUE?t=!0:r===er.FALSE&&(t=!1)}else t=1===e;return nK.create(t)}function n1(e,t=""){if("boolean"==typeof e){let r=0;return e&&(r=1),nQ.create(r,t)}return"number"==typeof e?Number.isFinite(e)?nQ.create(e,t):ru.create(ea.NUM):(0,j.isRealNum)(e)?nQ.create(Number(e),t):ru.create(ea.VALUE)}function n2(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];t[r][e]=n3.create(i)}}return t}class n5 extends ro{constructor(e){super("string"==typeof e?e:""),J(this,"_values",[]),J(this,"_rowCount",-1),J(this,"_columnCount",-1),J(this,"_unitId",""),J(this,"_sheetId",""),J(this,"_currentRow",-1),J(this,"_currentColumn",-1),J(this,"_sliceCache",new Map),J(this,"_flattenCache"),J(this,"_defaultValue",null),J(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(e){return new n5(e)}static createByArray(e){return new n5({calculateValueList:n2(e),rowCount:e.length,columnCount:e[0].length||0,unitId:"",sheetId:"",row:-1,column:-1})}dispose(){this._values=[],this._defaultValue=null,this._flattenPosition=null,this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return(null==(r=this._values[e])?void 0:r[t])||this._defaultValue}getRealValue(e,t){let r=this._values[e];if(null==r)return null;let n=r[t];return null==n?null:n}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){return{startRow:0,endRow:this.getRowCount()-1,startColumn:0,endColumn:this.getColumnCount()-1}}iterator(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=r;o<=n;o++)for(let r=i;r<=s;r++)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}iteratorReverse(e){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=this.getArrayValue();for(let o=n;o>=r;o--)for(let r=s;r>=i;r--)if(!1===e((null==(t=a[o])?void 0:t[r])||this._defaultValue,o,r))return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,n)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:n},!1}),e}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nX.create()}getLastCell(){let{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nX.create()}pick(e){let t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){let t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[nX.create()]];let n=[];n[0]=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.get(i,t);if(!(null==r||r.isError())&&!0===r.getValue()){let e=this.get(i,t);n[0].push(e)}}return n}flatten(){if(null!=this._flattenCache)return this._flattenCache;let e=[];e[0]=[];for(let t=0;t<this._rowCount;t++)for(let r=0;r<this._columnCount;r++){let n=this.get(t,r);e[0].push(n)}let t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(null!=this._flattenPosition)return this._flattenPosition;let e=[],t=[],r=[],n=[],i=0;for(let s=0;s<this._rowCount;s++)for(let a=0;a<this._columnCount;a++){let o=this.get(s,a);if(null==o||o.isError()||o.isNull()){i++;continue}o.isString()?(e.push(o),r.push(i++)):(t.push(o),n.push(i++))}let s={stringArray:e,numberArray:t,stringPosition:r,numberPosition:n};return this._flattenPosition=s,s}slice(e,t){let r=0,n=this._rowCount,i=1,s=0,a=this._columnCount,o=1;if(null!=e&&(r=e[0]||0,n=e[1]||this._rowCount,i=e[2]||1),null!=t&&(s=t[0]||0,a=t[1]||this._columnCount,o=t[2]||1),r>=this._rowCount||s>=this._columnCount)return;let l=`${r}_${n}_${i}_${s}_${a}_${o}`,u=this._sliceCache.get(l);if(null!=u)return u;let c=[],h=this._values,d=0,m=0;for(let e=r;e<n;e+=i){m=0,null==c[d]&&(c[d]=[]);for(let t=s;t<a;t+=o){if(!h[e])return;let r=h[e][t]||this._defaultValue;null==r&&(r=nX.create()),c[d][m]=r,m++}d++}if(0===c.length||0===c[0].length)return;let g=i>1?-1:r+this._currentRow,f=o>1?-1:s+this._currentColumn,p=this._createNewArray(c,c.length,c[0].length,g,f);return p.setDefaultValue(this._defaultValue),this._sliceCache.set(l,p),p}sortByRow(e){let t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){let e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,n=this._createNewArray(e,r,t);return n.setDefaultValue(this._defaultValue),n}orderSearch(e,t=rh.MIN,r=!1,n=!1){let i,s,a,o,l=(r,l,u)=>{let c;return null==r||((null==(c=!0===n?r.compare(e,eh.EQUALS):r.isEqual(e))?void 0:c.getValue())===!0?(i=r,a={row:l,column:u},!1):void(t===rh.MAX?!0===r.isGreaterThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u}):t===rh.MIN&&!0===r.isLessThan(e).getValue()&&(null==s||!0===r.minus(e).abs().isLessThanOrEqual(s.minus(e).abs()).getValue())&&(s=r,o={row:l,column:u})))};return(r?this.iteratorReverse((e,t,r)=>l(e,t,r)):this.iterator((e,t,r)=>l(e,t,r)),null!=i)?a:null!=s?o:void 0}binarySearch(e,t=rc.MIN,r=rh.MIN){if(e.isError())return;let{stringArray:n,stringPosition:i,numberArray:s,numberPosition:a}=this.flattenPosition();return e.isString()?this._binarySearch(e,n,i,t,r):this._binarySearch(e,s,a,t,r)}_binarySearch(e,t,r,n=rc.MIN,i=rh.MIN){let s=rd(),a=Number(e.getValue()),o=!Number.isNaN(a),l=0,u=t.length-1,c=-1,h=-1,d=-1;for(;l<=u;){let r,i=Math.floor((l+u)/2),m=t[i];if(m.isNull())r=n===rc.MIN?1:-1;else{let t=m.getValue();if(o){let e=Number(t);r=Number.isNaN(e)?1:Math.sign(e-a)}else r=s(t.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(n===rc.MAX&&(r=-r),0===r){c=i;break}r<0?(h=i,l=i+1):(d=i,u=i-1)}return i===rh.NORMAL?-1!==c?r[c]:void 0:i===rh.MIN?-1!==c?r[c]:n===rc.MIN?r[h]:r[d]:i===rh.MAX?-1!==c?r[c]:n===rc.MIN?r[d]:r[h]:void 0}sum(){let e=nQ.create(0);return this.iterator(t=>!!(null==t||t.isString()||t.isBoolean()||t.isNull())||(t.isError()?(e=t,!1):void(e=e.plus(t)))),e}max(){let e=nQ.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isLessThan(t).getValue()&&(e=t)))),e}min(){let e=nQ.create(Number.POSITIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isGreaterThan(t).getValue()&&(e=t)))),e}count(){let e=nQ.create(0);return this.iterator(t=>{if(null==t||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=nQ.create(0);return this.iterator(t=>{if(null==t||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=nQ.create(0);return this.iterator(t=>{(null==t||t.isNull()||""===t.getValue())&&(e=e.plusBy(1))}),e}getNegative(){return n5.create("{0}").minus(this)}getReciprocal(){return n5.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){return this.mapValue((t,r,n)=>null==t?nX.create():t.isError()?t:e(t,r,n))}mapValue(e){var t;let r=this._rowCount,n=this._columnCount,i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=null==(t=this._values)?void 0:t[s];if(null==n)r[i]=ru.create(ea.VALUE);else{let t=n[i]||this._defaultValue;t?r[i]=e(t,s,i):r[i]=nX.create()}}i.push(r)}return this._createNewArray(i,r,n)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){let t=this.sum(),r=this.count();return t.divided(0===e?r:r.minusBy(1))}median(){let e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||nX.create();if(t.sortByRow(0),r%2==0){let e=t.get(0,r/2)||nX.create(),n=t.get(0,r/2-1)||nX.create();return e.plus(n).divided(nQ.create(2))}return t.get(0,(r-1)/2)||nX.create()}var(e=0){let t=this.mean(),r=[[]];this.iterator(e=>{if(null==e||e.isError()||e.isString()||e.isBoolean()||e.isNull())return;let n=e.minus(t).pow(nQ.create(2));n.isError()||r[0].push(n)});let{_unitId:n,_sheetId:i,_currentRow:s,_currentColumn:a}=this;return n5.create({calculateValueList:r,rowCount:1,columnCount:r[0].length,unitId:n,sheetId:i,row:s,column:a}).mean(e)}std(e=0){let t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return function(e=[]){let t=[];for(let r=0;r<e.length;r++){let n=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<n.length;e++){let i=n[e];null==i?t[r][e]=null:i.isError()?t[r][e]=i.getErrorType():t[r][e]=i.getValue()}}return t}(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){let t=rd();return(r,n)=>{let i=r[e],s=n[e];return null==i?1:null==s?-1:i.isError()&&i.isError()?0:i.isError()?1:s.isError()?-1:t(i.getValue(),s.getValue())}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_batchOperator(e,t,r,n){let i=[],s=this._rowCount,a=this._columnCount;if(e.isArray()){let o=e.getRowCount(),l=e.getColumnCount();if(s=Math.max(o,s),a=Math.max(l,a),1===o&&1===l){let t=e.getFirstCell();for(let e=0;e<a;e++)i.push(t)}else{if(1!==o||!(this._columnCount>1))return this._batchOperatorArray(e,t,r,n);let s=e.getArrayValue();for(let e=0;e<a;e++)i.push(s[0][e])}}else for(let t=0;t<a;t++)i.push(e);let o=[];for(let e=0;e<a;e++){let s=i[e];this._batchOperatorValue(s,e,o,t,r,n)}let l=this._createNewArray(o,s,a);return l.setDefaultValue(nK.create(!1)),l}_batchOperatorValue(e,t,r,n,i,s){let a=this._rowCount,o=this.getUnitId(),l=this.getSheetId(),u=this.getCurrentRow(),c=this.getCurrentColumn();if(5===n){let{rowsInCache:h,rowsNotInCache:d}=tW.canUseCache(o,l,t+c,u,u+a-1);if(h.length>0){if(i===eh.EQUALS){let n=tW.getCellPositions(o,l,t+c,e.getValue(),h);null!=n&&n.forEach(e=>{if(e<u||e>u+a-1)return;let n=e-u;null==r[n]&&(r[n]=[]),r[n][t]=nK.create(!0)})}else{let n=tW.getCellValuePositions(o,l,t+c);null!=n&&n.forEach((n,o)=>{let l,c=nX.create();eo.has(o)?c=ru.create(o):"string"==typeof o?c=nJ.create(o):"number"==typeof o?c=nQ.create(o):"boolean"==typeof o&&(c=nK.create(o)),((l=c.isError()?c:e.isError()?e:c.compare(e,i,s)).isError()||!0===l.getValue())&&n.forEach(e=>{e>=u&&e<=u+a-1&&(null==r[e-u]&&(r[e-u]=[]),r[e-u][t]=l)})})}if(d.length>0)for(let a of d){let[h,d]=a;for(let a=h;a<=d;a++)this.__batchOperatorRowValue(e,t,r,n,a-u,o,l,u,c,i,s);tW.setContinueBuildingCache(o,l,t+c,h,d)}return}}for(let h=0;h<a;h++)this.__batchOperatorRowValue(e,t,r,n,h,o,l,u,c,i,s);tW.setContinueBuildingCache(o,l,t+c,u,u+a-1)}__batchOperatorRowValue(e,t,r,n,i,s,a,o,l,u,c){let h=this.getValueOrDefault(i,t);if(null==r[i]&&(r[i]=[]),h&&e)if(h.isError())r[i][t]=h;else if(e.isError())r[i][t]=e;else switch(n){case 1:r[i][t]=h.plus(e);break;case 0:r[i][t]=h.minus(e);break;case 2:r[i][t]=h.multiply(e);break;case 3:r[i][t]=h.divided(e);break;case 4:r[i][t]=h.mod(e);break;case 5:u?r[i][t]=h.compare(e,u,c):r[i][t]=ru.create(ea.VALUE);break;case 6:r[i][t]=h.concatenateFront(e);break;case 7:r[i][t]=h.concatenateBack(e);break;case 8:r[i][t]=h.pow(e);break;case 9:r[i][t]=h.round(e);break;case 10:r[i][t]=h.floor(e);break;case 12:r[i][t]=h.atan2(e);break;case 11:r[i][t]=h.ceil(e)}else r[i][t]=ru.create(ea.NA);null!=h&&(h.isError()?tW.set(s,a,t+l,h.getErrorType(),i+o):tW.set(s,a,t+l,h.getValue(),i+o))}_batchOperatorArray(e,t,r,n){let i=e.getRowCount(),s=e.getColumnCount();i<this._rowCount&&(i=this._rowCount),s<this._columnCount&&(s=this._columnCount);let a=[],o=this._checkArrayCalculateType(this),l=this._checkArrayCalculateType(e);for(let u=0;u<i;u++){let i=[];for(let a=0;a<s;a++){let s,c;if(s=3===o?this.getValueOrDefault(0,0):1===o?this.getValueOrDefault(0,a):2===o?this.getValueOrDefault(u,0):this.getValueOrDefault(u,a),c=3===l?e.getValueOrDefault(0,0):1===l?e.getValueOrDefault(0,a):2===l?e.getValueOrDefault(u,0):e.getValueOrDefault(u,a),s&&c)if(s.isError())i[a]=s;else if(c.isError())i[a]=c;else switch(t){case 1:i[a]=s.plus(c);break;case 0:i[a]=s.minus(c);break;case 2:i[a]=s.multiply(c);break;case 3:i[a]=s.divided(c);break;case 4:i[a]=s.mod(c);break;case 5:r?i[a]=s.compare(c,r,n):i[a]=ru.create(ea.VALUE);break;case 6:i[a]=s.concatenateFront(c);break;case 7:i[a]=s.concatenateBack(c);break;case 8:i[a]=s.pow(c);break;case 9:i[a]=s.round(c);break;case 12:i[a]=s.atan2(c);break;case 10:i[a]=s.floor(c);break;case 11:i[a]=s.ceil(c)}else i[a]=ru.create(ea.NA)}a.push(i)}return this._createNewArray(a,i,s)}_checkArrayCalculateType(e){return 1===e.getRowCount()&&1===e.getColumnCount()?3:1===e.getRowCount()?1:2*(1===e.getColumnCount())}_formatValue(e){if("string"!=typeof e)return this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;let t=(e=e.slice(1,-1)).split(";"),r=t.length,n=[],i=0;for(let e=0;e<r;e++){let r=t[e].split(","),s=r.length;i<s&&(i=s);let a=[];for(let e=0;e<s;e++){let t=r[e].trim();a.push(n3.create(t))}n.push(a)}return this._rowCount=r,this._columnCount=i,n}_createNewArray(e,t,r,n=-1,i=-1){(-1===this._currentColumn||-1===this._currentRow)&&(n=-1,i=-1);let s={calculateValueList:e,rowCount:t,columnCount:r,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:i};return n5.create(s)}}class n3{static create(e){if(null==e)return nX.create();if("boolean"==typeof e)return nK.create(e);if("string"==typeof e){let t,r=e.toLocaleUpperCase().trim();if(eo.has(r))return ru.create(r);if(r===er.TRUE||r===er.FALSE)return n0(e);if((0,j.isRealNum)(e))return nQ.create(Number(e));let{isNumberPattern:n,value:i,pattern:s}=function(e){let t=e;t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let r=ri.get(t);if(r)return{isNumberPattern:!0,value:r.value,pattern:r.pattern};let n=j.numfmt.parseNumber(t);if(n&&n.z)return rs(t,n.v,n.z);let i=j.numfmt.parseDate(t);if(i&&i.z)return rs(t,i.v,i.z);let s=j.numfmt.parseTime(t);return s&&s.z?rs(t,s.v,s.z):{isNumberPattern:!1}}(e);if(n)return nQ.create(i,s);let a=e.replace(/\n/g,"").replace(/\r/g,"");return!function(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')}(a)&&(ej.lastIndex=0,ej.test(a))?n5.create(a):('"'===(t=e.toString()).charAt(0)&&'"'===t.charAt(t.length-1)&&(t=(t=t.slice(1,-1)).replace(/""/g,'"')),nJ.create(t))}return"number"==typeof e?n1(e):ru.create(ea.VALUE)}}let n4=new tN(1e4);class n6 extends ra{constructor(e){super(),J(this,"_forcedSheetId",""),J(this,"_forcedSheetName",""),J(this,"_defaultSheetId",""),J(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),J(this,"_unitData",{}),J(this,"_unitStylesData",{}),J(this,"_filteredOutRows",[]),J(this,"_defaultUnitId",""),J(this,"_forcedUnitId",""),J(this,"_runtimeData",{}),J(this,"_arrayFormulaCellData",{}),J(this,"_runtimeArrayFormulaCellData",{}),J(this,"_runtimeFeatureCellData",{}),J(this,"_refOffsetX",0),J(this,"_refOffsetY",0),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){let{startRow:e,endRow:t,startColumn:r,endColumn:n}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||n>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:n}=(0,j.moveRangeByOffset)(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(n)&&(n=this.getActiveSheetColumnCount()-1),{...this._rangeData,startRow:e,endRow:r,startColumn:t,endColumn:n}}isReferenceObject(){return!0}iterator(e){let{startRow:t,endRow:r,startColumn:n,endColumn:i}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(ru.create(ea.VALUE),t,n);let s=this._forcedUnitId||this._defaultUnitId,a=this._forcedSheetId||this._defaultSheetId;for(let o=t;o<=r;o++)for(let r=n;r<=i;r++){if(o<0||r<0)return e(ru.create(ea.REF),o,r);let i=this.getCellData(o,r),l=!1;if(t5(i)){e(null,o,r);continue}let u=this.getCellValueObject(i);if(o===t&&r===n){let e=this.getCellPattern(s,a,o,r);if(e&&u.isNumber()){let t=Number(u.getValue());u=nQ.create(t,e)}}if(!1===e(u,o,r))return}}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return nQ.create(0);let n=this.getCellValueObject(r),i=this._forcedUnitId||this._defaultUnitId,s=this._forcedSheetId||this._defaultSheetId,a=this.getCellPattern(i,s,e,t);if(a&&n.isNumber()){let e=Number(n.getValue());n=nQ.create(e,a)}return n}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=null==(t=e[this.getUnitId()])?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getFilteredOutRows(){return this._filteredOutRows}setFilteredOutRows(e){this._filteredOutRows=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowData)||{}}getColumnData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return ru.create(ea.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){let t=function(e){var t;if(null===e)return 0;if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return 0;let r=t.dataStream;return j.BuildTextUtils.transform.getPlainText(r)}return null!=(t=null==e?void 0:e.v)?t:0}(e);if(eo.has(t))return ru.create(t);if(e.t===j.CellValueType.NUMBER){let r=this._getPatternByCell(e);return(0,q.isTextFormat)(r)?nJ.create(t.toString()):n1(t,r)}return e.t===j.CellValueType.STRING||e.t===j.CellValueType.FORCE_STRING?nJ.create(t.toString()):e.t===j.CellValueType.BOOLEAN?n0(t):n3.create(t)}_getPatternByCell(e){var t;let r=this._unitStylesData[this.getUnitId()];if(!r)return"";let n=r.getStyleByCell(e);return(null==(t=null==n?void 0:n.n)?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return null==(e=this._unitData[this.getUnitId()])?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return null==(t=null==(e=this._runtimeData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._arrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._runtimeArrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCellData(e,t){let r=this.getCurrentActiveSheetData(),n=this.getCurrentRuntimeSheetData(),i=this.getCurrentActiveArrayFormulaCellData(),s=this.getCurrentRuntimeActiveArrayFormulaCellData();return(null==n?void 0:n.getValue(e,t))||(null==s?void 0:s.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(null==i?void 0:i.getValue(e,t))||(null==r?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return t3(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,n=t;r||(r=this._rangeData.startRow),n||(n=this._rangeData.startColumn);let i=this.getCellData(r,n);return i?this.getCellValueObject(i):ru.create(ea.VALUE)}getCellPattern(e,t,r,n){var i,s,a,o;let l=this._unitStylesData[e];if(!l)return"";let u=null==(a=null==(s=null==(i=this._unitData[e])?void 0:i[t])?void 0:s.cellData)?void 0:a.getValue(r,n);if(!u)return"";let c=l.getStyleByCell(u);return(null==(o=null==c?void 0:c.n)?void 0:o.pattern)||""}toArrayValueObject(e=!0){var t;let{startRow:r,endRow:n,startColumn:i,endColumn:s}=this.getRangePosition(),a=`${this.getUnitId()}_${this.getSheetId()}_${r}_${n}_${i}_${s}`,o=n4.get(a);if(o&&e)return o;let l=n-r+1,u=s-i+1;if(l<0||u<0)return this._getBlankArrayValueObject();let c=Array(l);this.iterator((e,t,n)=>{let s=t-r,a=n-i;c[s]||(c[s]=Array(u)),null==e&&(e=nX.create()),c[s][a]=e});let h={calculateValueList:c,rowCount:c.length,columnCount:(null==(t=c[0])?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:i},d=n5.create(h);return e&&n4.set(a,d),d}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(null==this._forcedSheetId||0===this._forcedSheetId.length)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){let e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return n5.create(e)}}class n9 extends ra{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}}class n8 extends ra{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;let t=[];for(let e=0;e<this._promiseList.length;e++){let r=this._promiseList[e];null==t[e]&&(t[e]=[]);for(let n=0;n<r.length;n++){let i=r[n];i.isAsyncObject()?t[e][n]=await i.getValue():t[e][n]=i}}let r={calculateValueList:t,rowCount:t.length,columnCount:(null==(e=t[0])?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return n5.create(r)}}class n7 extends n6{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}}class ie extends n6{constructor(e){super(e);let t=tM(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return ru.create(ea.REF);let t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(e,t){let r=e.startRow,n=e.startColumn,i=t.startRow,s=t.startColumn,a={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>i?(a.startRow=i,a.endRow=r):(a.startRow=r,a.endRow=i),n>s?(a.startColumn=s,a.endColumn=n):(a.startColumn=n,a.endColumn=s),e.startAbsoluteRefType&&(a.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(a.endAbsoluteRefType=t.startAbsoluteRefType),a}_createRange(e){let t=new n7(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());let{x:r,y:n}=this.getRefOffset();t.setRefOffset(r,n);let i=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),null!=i&&t.setForcedSheetIdDirect(i);let s=this.getForcedUnitId();return s&&t.setForcedUnitIdDirect(s),t}}class it extends n6{constructor(e){super(e);let t=tM(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:t.range.startColumn,startRow:Number.NaN,endColumn:t.range.endColumn,endRow:Number.NaN,rangeType:j.RANGE_TYPE.COLUMN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return ru.create(ea.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startColumn;if(n>=t.startColumn&&n<=t.endColumn)return this;let i=t.startColumn;return n>i?t.endColumn=n:(t.startColumn=n,t.endColumn=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=j.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${ef.COLON}${e.getToken()}`),this}}class ir extends n6{constructor(e){super(e);let t=tM(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:Number.NaN,startRow:t.range.startRow,endColumn:Number.NaN,endRow:t.range.endRow,rangeType:j.RANGE_TYPE.ROW};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return ru.create(ea.REF);let t=this.getRangeData(),r=e.getRangeData(),n=r.startRow;if(n>=t.startRow&&n<=t.endRow)return this;let i=t.startRow;return n>i?t.endRow=n:(t.startRow=n,t.endRow=i),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=j.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${ef.COLON}${e.getToken()}`),this}}function ii(e,t,r,n){let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1,a=[];for(let o=0;o<e;o++){let e=[];for(let a=0;a<t;a++){if(1===i&&1===s){let t=r.isArray()?r.get(0,0):r;e.push(t);continue}if(1===i&&a<s){let t=r.get(0,a);e.push(t);continue}if(1===s&&o<i){let t=r.get(o,0);e.push(t);continue}if(o>=i||a>=s){e.push(null!=n?n:nX.create());continue}let t=r.get(o,a);e.push(t)}a.push(e)}return is(a,e,t)}function is(e,t,r,n="",i=""){return n5.create({calculateValueList:e,rowCount:t,columnCount:r,unitId:n,sheetId:i,row:-1,column:-1})}function ia(e){for(let t of[eh.EQUALS,eh.NOT_EQUAL,eh.GREATER_THAN_OR_EQUAL,eh.GREATER_THAN,eh.LESS_THAN_OR_EQUAL,eh.LESS_THAN])if(e.startsWith(t)){let r=e.substring(t.length);return[t,n3.create(r)]}return[eh.EQUALS,n3.create(e)]}function io(e,t,r,n){if(!r)if(t.isString()){let[e,n]=ia(`${t.getValue()}`);r=e,t=n}else r=eh.EQUALS;return e.compare(t,r,n)}function il(e){return!!e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()||(e.isReferenceObject()?!!(e.isCell()||1===e.getRowCount()&&1===e.getColumnCount()):!!(e.isString()||e.isNumber()||e.isBoolean()||e.isError()||e.isNull()))}function iu(e){let t=null==e?void 0:e.getPattern(),r={},n={};if(t&&(r={s:{n:{pattern:t}}}),null!=e&&e.getCustomData()&&(n={custom:e.getCustomData()}),null==e)return{v:null,...r};if(e.isError())return{v:e.getErrorType(),t:j.CellValueType.STRING,...r,...n};if(e.isValueObject()){let t=e.getValue();return e.isNumber()?{v:t,t:j.CellValueType.NUMBER,...r,...n}:e.isBoolean()?{v:+!!t,t:j.CellValueType.BOOLEAN,...r,...n}:e.isString()?{v:t,t:j.CellValueType.STRING,...r,...n}:e.isNull()?{v:null,...r,...n}:{v:t,t:j.CellValueType.STRING,...r,...n}}}function ic(e){let t=0,r=0;return e.forEach((e,n)=>{n%2==1&&(e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1)))}),{maxRowLength:t,maxColumnLength:r}}function ih(e,t,r,n){let i=t.getRowCount(),s=t.getColumnCount();for(let t=0;t<e.length;t++){if(t%2==1)continue;let a=e[t],o=a.getRowCount(),l=a.getColumnCount();if(o!==i||l!==s)return ii(r,n,ru.create(ea.VALUE))}return null}function id(e,t,r,n=!1){let i=[];for(let s=0;s<e.length;s++){if(s%2==1)continue;let a=e[s];ii(t,r,e[s+1],ru.create(ea.NA)).iterator((e,t,r)=>{if(!e)return;let s=io(a,e);if(n&&(s=im(s,a,e)),void 0===i[t]&&(i[t]=[]),void 0===i[t][r]){i[t][r]=s;return}i[t][r]=function(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t);return i.mapValue((e,t,r)=>{let n=s.get(t,r);return null!=e&&e.isError()?e:null!=n&&n.isError()?n:null!=e&&e.isBoolean()&&null!=n&&n.isBoolean()?n0(e.getValue()&&n.getValue()):nK.create(!1)})}(i[t][r],s)})}return i}function im(e,t,r){let[n,i]=ia(`${r.getValue()}`);return e.mapValue((e,r,s)=>{let a=t.get(r,s);if(a&&function(e,t){if(e.isNumber()&&t.isNumber()||e.isBoolean()&&t.isBoolean())return!0;let r=e.isString()&&""===e.getValue(),n=t.isString()&&""===t.getValue();return!!((r||e.isNull())&&(n||t.isNull())||e.isString()&&!r&&t.isString()&&!n)}(a,i))return e;if(null!=a&&a.isNumber()){if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isNumber())return a.compare(e,n)}return nK.create(!1)}if(!i.isNumber())return null!=a&&a.isError()&&i.isError()&&a.getValue()===i.getValue()?nK.create(!0):nK.create(!1);if(null!=a&&a.isString()){let e=a.convertToNumberObjectValue();if(e.isNumber())return e.compare(i,n)}return nK.create(!1)})}var ig=((_=ig||{})[_.CELL=0]="CELL",_[_.COLUMN=1]="COLUMN",_[_.ROW=2]="ROW",_),ip=Object.getOwnPropertyDescriptor,iC=((y=iC||{})[y.IDLE=0]="IDLE",y[y.START=1]="START",y[y.START_DEPENDENCY=2]="START_DEPENDENCY",y[y.START_CALCULATION=3]="START_CALCULATION",y[y.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",y[y.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",y[y.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",y[y.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",y[y.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",y),i_=((E=i_||{})[E.INITIAL=0]="INITIAL",E[E.STOP_EXECUTION=1]="STOP_EXECUTION",E[E.NOT_EXECUTED=2]="NOT_EXECUTED",E[E.SUCCESS=3]="SUCCESS",E);let iy=class extends j.Disposable{constructor(e){super(),J(this,"_formulaExecuteStage",0),J(this,"_stopState",!1),J(this,"_currentRow",-1),J(this,"_currentColumn",-1),J(this,"_currentRowCount",Number.NEGATIVE_INFINITY),J(this,"_currentColumnCount",Number.NEGATIVE_INFINITY),J(this,"_currentSubUnitId",""),J(this,"_currentUnitId",""),J(this,"_runtimeData",{}),J(this,"_runtimeOtherData",{}),J(this,"_unitArrayFormulaRange",{}),J(this,"_runtimeArrayFormulaCellData",{}),J(this,"_runtimeClearArrayFormulaCellData",{}),J(this,"_runtimeFeatureRange",{}),J(this,"_runtimeFeatureCellData",{}),J(this,"_functionsExecutedState",0),J(this,"_functionDefinitionPrivacyVar",new Map),J(this,"_totalFormulasToCalculate",0),J(this,"_completedFormulasCount",0),J(this,"_totalArrayFormulasToCalculate",0),J(this,"_completedArrayFormulasCount",0),J(this,"_formulaCycleIndex",0),J(this,"_isCycleDependency",!1),this._currentConfigService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){super.dispose(),this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0,this.clearReferenceAndNumberformatCache()}clearReferenceAndNumberformatCache(){t8.clear(),ri.clear(),tw.clear()}setCurrent(e,t,r,n,i,s){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=n,this._currentSubUnitId=i,this._currentUnitId=s}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t,r,n){let i=this._currentSubUnitId,s=this._currentUnitId;void 0===this._runtimeOtherData[s]&&(this._runtimeOtherData[s]={});let a=this._runtimeOtherData[s];(void 0===a[i]||null===a[i])&&(a[i]={});let o=a[i],l=[];if(n.isReferenceObject()||n.isValueObject()&&n.isArray()){let{startRow:e,startColumn:t}=n.getRangePosition();n.iterator((r,n,i)=>{let s=iu(r),a=n-e;null==l[a]&&(l[a]=[]),l[a][i-t]=s})}else l=[[iu(n)]];(void 0===o[e]||null===o[e])&&(o[e]={}),(void 0===o[e][r]||null===o[e][r])&&(o[e][r]={}),o[e][r][t]=l}setRuntimeData(e){let t=this._currentRow,r=this._currentColumn,n=this._currentRowCount,i=this.currentColumnCount,s=this._currentSubUnitId,a=this._currentUnitId;null==this._runtimeData[a]&&(this._runtimeData[a]={});let o=this._runtimeData[a];null==o[s]&&(o[s]=new(0,j.ObjectMatrix)),null==this._unitArrayFormulaRange[a]&&(this._unitArrayFormulaRange[a]={});let l=this._unitArrayFormulaRange[a];(null===l[s]||void 0===l[s])&&(l[s]={});let u=new(0,j.ObjectMatrix)(l[s]);void 0===this._runtimeArrayFormulaCellData[a]&&(this._runtimeArrayFormulaCellData[a]={});let c=this._runtimeArrayFormulaCellData[a];null==c[s]&&(c[s]=new(0,j.ObjectMatrix)),void 0===this._runtimeClearArrayFormulaCellData[a]&&(this._runtimeClearArrayFormulaCellData[a]={});let h=this._runtimeClearArrayFormulaCellData[a];null==h[s]&&(h[s]=new(0,j.ObjectMatrix));let d=o[s],m=c[s],g=h[s];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){let{startRow:o,startColumn:l,endRow:c,endColumn:h}=e.getRangePosition();if(o===c&&l===h){let n=e.getFirstCell(),i=iu(n);d.setValue(t,r,i),g.setValue(t,r,i),tW.set(a,s,r,n.getValue(),t,!0);return}let f={startRow:t,startColumn:r,endRow:c-o+t,endColumn:h-l+r};if(u.setValue(t,r,f),this._checkIfArrayFormulaRangeHasData(a,s,t,r,f)||this._checkIfArrayFormulaExceeded(n,i,f)){let n=iu(ru.create(ea.SPILL));d.setValue(t,r,n),g.setValue(t,r,n),tW.set(a,s,r,ea.SPILL,t,!0);let i=this._currentConfigService.getUnitData();e.iterator((e,u,c)=>{var h,d;let g=u-o+t,f=c-l+r,p=null==(d=null==(h=i[a])?void 0:h[s])?void 0:d.cellData.getValue(g,f);if(u===o&&c===l)m.setValue(t,r,n);else if(null!=p)null==p.v&&(p.v=""),m.setValue(g,f,p);else{if(this._isInOtherArrayFormulaRange(a,s,t,r,g,f))return!0;m.setValue(g,f,{v:""})}})}else{let n=ru.create(ea.SPILL);e.iterator((e,i,u)=>{tW.set(a,s,r-l+u,e?e.getValue():0,t-o+i,!0);let c=iu(e);if(i===o&&u===l){if(null!=e&&e.isError()&&e.isEqualType(n))return g.setValue(t,r,{}),d.setValue(t,r,{...iu(n)}),!1;d.setValue(t,r,{...c})}let h=i-o+t,f=u-l+r;m.setValue(h,f,c)})}}else{let n=iu(e);d.setValue(t,r,n),tW.set(a,s,r,e.getValue(),t,!0),g.setValue(t,r,n)}}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,n,i){var s,a,o,l,u,c,h,d,m,g,f;let{startRow:p,startColumn:C,endRow:_,endColumn:y}=i,E=this._currentConfigService.getUnitData(),R=this._currentConfigService.getArrayFormulaCellData();null==(o=null==(a=null==(s=this._unitArrayFormulaRange[e])?void 0:s[t])?void 0:a[r])||o[n];for(let i=p;i<=_;i++)for(let s=C;s<=y;s++){if(i===r&&n===s)continue;let a=null==(c=null==(u=null==(l=this._runtimeData)?void 0:l[e])?void 0:u[t])?void 0:c.getValue(i,s);null==(d=null==(h=null==R?void 0:R[e])?void 0:h[t])||d.getValue(i,s);let o=null==(f=null==(g=null==(m=null==E?void 0:E[e])?void 0:m[t])?void 0:g.cellData)?void 0:f.getValue(i,s),p=this._getRuntimeFeatureCellValue(i,s,t,e);if(!t5(a)||this._isInOtherArrayFormulaRange(e,t,r,n,i,s)||!t5(o)||!t5(p))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,n){return t3(e,t,r,n,this._runtimeFeatureCellData)}_arrayCellHasData(e){return null!=e&&void 0!==e.v}_isInOtherArrayFormulaRange(e,t,r,n,i,s){var a;let o=null==(a=this._currentConfigService.getArrayFormulaRange()[e])?void 0:a[t];if(null==o)return!1;let l=!1;return new(0,j.ObjectMatrix)(o).forValue((a,o,u)=>{var c,h;if(a===r&&o===n)return;let d=this._isInArrayFormulaRange(u,i,s),m=null==(h=null==(c=this._runtimeData[e])?void 0:c[t])?void 0:h.getValue(a,o);d&&(null==m?void 0:m.v)!==ea.SPILL&&(l=!0)}),l}_isInArrayFormulaRange(e,t,r){if(null==e)return!1;let{startRow:n,startColumn:i,endRow:s,endColumn:a}=e;return t>=n&&t<=s&&r>=i&&r<=a}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,n){let i=this._currentConfigService.getDirtyRanges();return 0===i.length||es(i,e,t,r,n)}};iy=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ip(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>tJ(e,t,0)],iy);let iE=(0,B.createIdentifier)("univer.formula.runtime.service");var iR=((R=iR||{})[R.REFERENCE=1]="REFERENCE",R[R.VALUE=2]="VALUE",R[R.OPERATOR=3]="OPERATOR",R[R.FUNCTION=4]="FUNCTION",R[R.LAMBDA=5]="LAMBDA",R[R.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",R[R.ERROR=7]="ERROR",R[R.BASE=8]="BASE",R[R.ROOT=9]="ROOT",R[R.UNION=10]="UNION",R[R.PREFIX=11]="PREFIX",R[R.SUFFIX=12]="SUFFIX",R[R.NULL=13]="NULL",R);let ib=new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]);class iI{constructor(e){J(this,"_children",[]),J(this,"_definedNames"),J(this,"_parent"),J(this,"_valueObject"),J(this,"_calculateState",!1),J(this,"_async",!1),J(this,"_address",!1),J(this,"_isForcedCalculateFunction",!1),this._token=e}dispose(){var e;this._children.forEach(e=>{e.dispose()}),null==(e=this._valueObject)||e.dispose(),this._valueObject=null,this._children=[],this._definedNames=null,this._parent=null}get nodeType(){return iR.BASE}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}async executeAsync(){return Promise.resolve(en.SUCCESS)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],n=t.length;for(let e=0;e<n;e++){let n=t[e];r.push(n.serialize())}let i={token:e,nodeType:this.nodeType};return n>0&&(i.children=r),i}hasDefinedName(e){var t;return(null==(t=this._definedNames)?void 0:t.includes(e))||!1}setDefinedNames(e){this._definedNames=e}getDefinedNames(){return this._definedNames}}class iN extends iI{constructor(e){super(e),J(this,"_errorValueObject"),this._errorValueObject=ru.create(e)}get nodeType(){return iR.ERROR}static create(e){return new iN(e)}getValue(){return this._errorValueObject}}class iS{get zIndex(){return 0}dispose(){}create(e,t,r){let n;return new iI(e instanceof tU?e.getToken():e)}}class iA extends iI{get nodeType(){return iR.ROOT}execute(){let e=this.getChildren();if(e.length>1)return void this.setValue(ru.create(ea.VALUE));let t=e[0];null==t?this.setValue(ru.create(ea.VALUE)):this.setValue(t.getValue())}}class iv extends iS{get zIndex(){return ib.get(iR.ROOT)||100}checkAndCreateNodeType(e){if(e instanceof tU&&"R_1"===e.getToken())return new iA("R_1")}}let iT=new tN(5e3);function iw(e,t,r,n,i){let s=iT.get(`${e}${t}`);if(s&&!iM(s,i))return s;let a=r.treeBuilder(t);if(eo.has(a))return iN.create(a);if(null==(s=n.parse(a)))throw Error("astNode is null");return iT.set(`${e}${t}`,s),s}function iM(e,t){let r=t.getDirtyDefinedNameMap(),n=t.getExecuteUnitId();if(null!=n&&null!=r[n]){let t=Object.keys(r[n]);for(let r=0,n=t.length;r<n;r++){let n=t[r];if(e.hasDefinedName(n))return!0}}return!1}let iO=(0,B.createIdentifier)("univer.formula-function.service");class ix extends j.Disposable{constructor(){super(...arguments),J(this,"_functionExecutors",new Map),J(this,"_functionDescriptions",new Map)}dispose(){super.dispose(),this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.set(r.functionName,r)}return(0,j.toDisposable)(()=>{for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r)}}deleteFormulaAstCacheKey(...e){iT.forEach((t,r)=>{e.forEach(e=>{r.includes(e)&&iT.delete(r)})})}}var iU=((b=iU||{}).COMPARE="COMPARE",b.DIVIDED="DIVIDED",b.MINUS="MINUS",b.MULTIPLY="MULTIPLY",b.PLUS="PLUS",b.UNION="UNION",b.CUBE="CUBE",b),iD=Object.getOwnPropertyDescriptor,iV=(e,t)=>(r,n)=>t(r,n,e);class iL extends iI{constructor(e,t,r){super(t),this._runtimeService=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return iR.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");this._operatorString===e_.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(nQ.create(0),e)):t=this._operatorString===e_.AT?this._handlerAT(e):ru.create(ea.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject()||e.isCell())return ru.create(ea.VALUE);let t=this._runtimeService,r=t.currentRow||0,n=t.currentColumn||0,{startRow:i,startColumn:s,endRow:a,endColumn:o}=e.getRangePosition();return o!==s&&a!==i||i===a&&s===o?ru.create(ea.VALUE):a===i&&n>=s&&n<=o?e.getCellByColumn(n):s===o&&r>=i&&r<=a?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):ru.create(ea.VALUE)}}let iP=class extends iS{constructor(e,t){super(),this._functionService=e,this._runtimeService=t}get zIndex(){return ib.get(iR.PREFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tU))return;let t=e.getToken(),r=t.trim();if('"'===r.charAt(0)&&'"'===r.charAt(r.length-1))return;let n="";if(r!==e_.MINUS)return r===e_.AT?new iL(this._runtimeService,r):void 0;n=iU.MINUS;let i=this._functionService.getExecutor(n);return i?new iL(this._runtimeService,r,i):(console.error(`No function ${t}`),iN.create(ea.NAME))}};function iF(e,t,r){let n,i,s=e,a=s.slice(0,2),o=0;if(a[0]===e_.MINUS){let e=t.getExecutor(iU.MINUS);n=new iL(r,e_.MINUS,e),o++}return a[0]===e_.AT&&(i=new iL(r,e_.AT),n&&i.setParent(n),o++),o>0&&(s=s.slice(o)),{tokenTrim:s,minusPrefixNode:n,atPrefixNode:i}}iP=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([iV(0,iO),iV(1,iE)],iP),RegExp(e_.MINUS,"g"),RegExp(e_.AT,"g");var ik=Object.getOwnPropertyDescriptor,ij=(e,t)=>(r,n)=>t(r,n,e);class iB extends iI{constructor(e,t,r,n,i,s){super(e),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=n,this._definedNamesService=i,this._formulaDataModel=s,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo(),this._functionExecutor.needsFormulaDataModel&&this._functionExecutor.setFormulaDataModel(this._formulaDataModel)}get nodeType(){return iR.FUNCTION}async executeAsync(){let e,t=[],r=this.getChildren(),n=r.length;this._compatibility();for(let e=0;e<n;e++){let n=r[e].getValue();null!=n&&(n.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?t.push(n.toArrayValueObject()):t.push(n))}let i=await this._calculateAsync(t);return e=i.isAsyncObject()||i.isAsyncArrayObject()?await i.getValue():i,this._setRefData(e),this.setValue(e),Promise.resolve(en.SUCCESS)}execute(){let e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let n=0;n<r;n++){let r=t[n].getValue();null!=r&&(r.isReferenceObject()&&this._functionExecutor.needsFilteredOutRows&&this._setFilteredOutRows(r),r.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(r.toArrayValueObject()):e.push(r))}let n=this._calculate(e);this._setRefData(n),this.setValue(n)}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){let e,t,r=this.getChildren(),n=r.length;if(!this._functionExecutor.needsExpandParams||3!==n)return;let i=r[1].getValue(),s=r[2].getValue();if(!(null!=i&&i.isReferenceObject())&&!(null!=s&&s.isReferenceObject()))return;if(null!=i&&i.isReferenceObject()){let{startRow:r,startColumn:n,endRow:s,endColumn:a}=i.getRangeData();e=s-r+1,t=a-n+1}else e=null!=i&&i.isArray()?i.getRowCount():1,t=null!=i&&i.isArray()?i.getColumnCount():1;let a=s.getRangeData(),{startRow:o,startColumn:l,endRow:u,endColumn:c}=a,h=u-o+1,d=c-l+1;e!==h&&(a.endRow+=e-h),t!==d&&(a.endColumn+=t-d)}_handleCustomResult(e){var t;if("object"!=typeof e||null==e)return n3.create(e);let r=n2(e);return n5.create({calculateValueList:r,rowCount:r.length,columnCount:(null==(t=r[0])?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}_handleAddressFunction(){this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction()}_mapVariantsToValues(e){return e.map(e=>e.isArray()?e.toValue():e.isLambda()?e:e.getValue())}_calculate(e){let t,{minParams:r,maxParams:n}=this._functionExecutor;if(-1!==r&&-1!==n&&(e.length<r||e.length>n))return ru.create(ea.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let r=this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));t=this._handleCustomResult(r)}else this._handleAddressFunction(),t=this._functionExecutor.calculate(...e);return t}async _calculateAsync(e){let t,{minParams:r,maxParams:n}=this._functionExecutor;if(-1!==r&&-1!==n&&(e.length<r||e.length>n))return ru.create(ea.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let r=await this._functionExecutor.calculateCustom(...this._mapVariantsToValues(e));t=this._handleCustomResult(r)}else this._handleAddressFunction(),t=this._functionExecutor.calculate(...e);return t}_setDefinedNamesForFunction(){let e=this._currentConfigService.getExecuteUnitId();if(null==e)return;let t=this._definedNamesService.getDefinedNameMap(e);null!=t&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){let{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:n}=this._runtimeService;if(this._functionExecutor.setRefInfo(e,t,r,n),this._functionExecutor.needsSheetRowColumnCount){let{rowCount:r,columnCount:n}=this._currentConfigService.getSheetRowColumnCount(e,t);this._functionExecutor.setSheetRowColumnCount(r,n)}}_setRefData(e){e.isReferenceObject()&&(e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData()))}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}_setFilteredOutRows(e){let{startRow:t,endRow:r}=e.getRangePosition(),n=this._currentConfigService.getFilteredOutRows(e.getUnitId(),e.getSheetId(),t,r);e.setFilteredOutRows(n)}}class i$ extends iI{constructor(e="Error"){super(e)}get nodeType(){return iR.FUNCTION}async executeAsync(){return this.setValue(ru.create(ea.NAME)),Promise.resolve(en.SUCCESS)}execute(){this.setValue(ru.create(ea.NAME))}}let iH=class extends iS{constructor(e,t,r,n,i,s){super(),this._functionService=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=n,this._injector=i,this._formulaDataModel=s}get zIndex(){return ib.get(iR.FUNCTION)||100}create(e){let t=this._functionService.getExecutor(e);return t?new iB(e,t,this._currentConfigService,this._runtimeService,this._definedNamesService,this._formulaDataModel):(console.error(`No function ${e}`),iN.create(ea.NAME))}checkAndCreateNodeType(e){if("string"==typeof e)return;let{tokenTrim:t,minusPrefixNode:r,atPrefixNode:n}=iF(e.getToken().trim(),this._functionService,this._runtimeService);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(e))return iN.create(ea.VALUE);let i=t.toUpperCase();if(this._functionService.hasExecutor(i)){let e=this.create(i);return n?e.setParent(n):r&&e.setParent(r),e}}_isParentUnionNode(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken())===ef.COLON}};iH=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ik(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ij(0,iO),ij(1,tJ),ij(2,iE),ij(3,tl),ij(4,(0,B.Inject)(B.Injector)),ij(5,(0,B.Inject)(tk))],iH);var iW=Object.getOwnPropertyDescriptor;let iG=class extends j.Disposable{constructor(e){super(),this._runtimeService=e}async executeAsync(e){if(!e||!e.node)return Promise.resolve(ru.create(ea.VALUE));let t=e.node,r=e.refOffsetX,n=e.refOffsetY;await this._executeAsync(t,r,n);let i=t.getValue();return null==i?Promise.resolve(ru.create(ea.VALUE)):Promise.resolve(i)}execute(e){if(!e||!e.node)return ru.create(ea.VALUE);let t=e.node,r=e.refOffsetX,n=e.refOffsetY;this._execute(t,r,n);let i=t.getValue();return null==i?ru.create(ea.VALUE):i}executePreCalculateNode(e){return e.execute(),e.getValue()}checkAsyncNode(e){if(null==e)return!1;let t=[];this._checkAsyncNode(e,t);for(let e=0,r=t.length;e<r;e++)if(!0===t[e])return!0;return!1}_checkAsyncNode(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];t.push(n.isAsync()),this._checkAsyncNode(n,t)}}async _executeAsync(e,t=0,r=0){if(this._runtimeService.isStopExecution())return Promise.resolve(en.ERROR);let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===tv&&i.isEmptyParamFunction()){i.execute();continue}await this._executeAsync(i,t,r)}return e.nodeType===iR.REFERENCE&&e.setRefOffset(t,r),e.nodeType===iR.FUNCTION&&e.isAsync()?await e.executeAsync():e.execute(),Promise.resolve(en.SUCCESS)}_execute(e,t=0,r=0){if(this._runtimeService.isStopExecution())return en.ERROR;let n=e.getChildren(),i=n.length;for(let e=0;e<i;e++){let i=n[e];if(i.getToken().toUpperCase()===tv&&i.isEmptyParamFunction()){i.execute();continue}this._execute(i,t,r)}return e.nodeType===iR.REFERENCE&&e.setRefOffset(t,r),e.execute(),en.SUCCESS}};function iY(e){return e instanceof tU&&"L_1"===e.getToken()}function iz(e,t,r){let n=e.getChildren(),i=n.length,s=n[0];for(let e=0;e<i;e++){let i=n[e];if(!(iY(s)&&0!==e))if(i instanceof tU)iz(i,t,r);else{let s=i.trim();if(r.has(s)){let i=new tU;i.setToken(tS),i.setLambdaId(t),i.setLambdaPrivacyVar(r),i.setLambdaParameter(s),n[e]=i}}}}iG=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iW(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iE(e,t,0)],iG);class iX extends ro{constructor(e,t,r){super(0),J(this,"_lambdaPrivacyValueMap",new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(e,t,r){return new iX(e,t,r)}dispose(){this._lambdaPrivacyValueMap.clear(),this._lambdaPrivacyValueMap=new Map,this._lambdaNode=null,this._interpreter=null,this._lambdaPrivacyVarKeys=[]}isLambda(){return!0}execute(...e){let t,r=this._lambdaPrivacyVarKeys.length;if(e.length!==r||!this._interpreter||!this._lambdaNode)return ru.create(ea.VALUE);if(this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1),this._interpreter.checkAsyncNode(this._lambdaNode))t=new n9(this._interpreter.executeAsync(ee(this._lambdaNode)));else{let e=this._interpreter.execute(ee(this._lambdaNode));t=e.isReferenceObject()?e.toArrayValueObject():e}return this._lambdaNode.setNotEmpty(!0),t}executeCustom(...e){let t=e.map(e=>n3.create(e));return this.execute(...t)}_setLambdaNodeValue(e){if(!e)return;let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken()===tS){let e=r.getLambdaParameter(),t=this._lambdaPrivacyValueMap.get(e);if(t)r.setValue(t);else{let t=function e(t){if(!t)return;if(t.getToken()!==tS)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(!r)return;let i=r.get(n);return null==i&&t.getValue()?t:e(i)}(r.getCurrentLambdaPrivacyVar().get(e));null!=t&&r.setValue(t.getValue())}continue}this._setLambdaNodeValue(r)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){let r=e[t],n=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(n,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}}var iq=Object.getOwnPropertyDescriptor,iK=(e,t)=>(r,n)=>t(r,n,e);class iQ extends iI{constructor(e,t,r,n){super(e),J(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=n}get nodeType(){return iR.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return null===this._lambdaId}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(iX.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{let e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}}let iZ=class extends iS{constructor(e,t){super(),this._runtimeService=e,this._interpreter=t}get zIndex(){return ib.get(iR.LAMBDA)||100}create(e){let t=e.getChildren(),r=t[0],n=t.slice(1,-1),i=t[t.length-1];if(!(r instanceof tU&&i instanceof tU))return iN.create(ea.NAME);if("L_1"===r.getToken()){let e=r.getChildren();if(n.length!==e.length)return iN.create(ea.VALUE)}else n=t.slice(0,-1);let s=j.Tools.generateRandomId(8),a=new Map;for(let e=0;e<n.length;e++){let t=n[e];if(!(t instanceof tU))return iN.create(ea.VALUE);{let e=t.getChildren()[0];t.setToken(tA),a.set(e.trim(),void 0)}}return this._runtimeService.registerFunctionDefinitionPrivacyVar(s,a),this._updateLambdaStatement(i,s,a),new iQ(e.getToken(),s,this._interpreter,[...a.keys()])}checkAndCreateNodeType(e){if(e instanceof tU&&e.getToken().trim().toUpperCase()===tv)return this.create(e)}_updateLambdaStatement(e,t,r){iz(e,t,r)}};iZ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?iq(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([iK(0,iE),iK(1,(0,B.Inject)(iG))],iZ);class iJ extends iI{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return iR.LAMBDA_PARAMETER}execute(){let e=function e(t){if(!t)return;if(t.getToken()!==tS)return t;let r=t.getCurrentLambdaPrivacyVar(),n=t.getLambdaParameter();if(r)return e(r.get(n))}(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{let e=this.getValue();(null==e||e.isError())&&this.setValue(ru.create(ea.NAME))}}}class i0 extends iS{get zIndex(){return ib.get(iR.LAMBDA_PARAMETER)||100}create(e){let t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new iJ(e.getToken(),r,t):new iN(ea.NAME)}checkAndCreateNodeType(e){if(e instanceof tU&&e.getToken().trim()===tS)return this.create(e)}}class i1 extends iI{constructor(e){super(e),this._operatorString=e}get nodeType(){return iR.NULL}execute(){this.setValue(nX.create())}}var i2=((I=i2||{}).ABS="ABS",I.ACOS="ACOS",I.ACOSH="ACOSH",I.ACOT="ACOT",I.ACOTH="ACOTH",I.AGGREGATE="AGGREGATE",I.ARABIC="ARABIC",I.ASIN="ASIN",I.ASINH="ASINH",I.ATAN="ATAN",I.ATAN2="ATAN2",I.ATANH="ATANH",I.BASE="BASE",I.CEILING="CEILING",I.CEILING_MATH="CEILING.MATH",I.CEILING_PRECISE="CEILING.PRECISE",I.COMBIN="COMBIN",I.COMBINA="COMBINA",I.COS="COS",I.COSH="COSH",I.COT="COT",I.COTH="COTH",I.CSC="CSC",I.CSCH="CSCH",I.DECIMAL="DECIMAL",I.DEGREES="DEGREES",I.EVEN="EVEN",I.EXP="EXP",I.FACT="FACT",I.FACTDOUBLE="FACTDOUBLE",I.FLOOR="FLOOR",I.FLOOR_MATH="FLOOR.MATH",I.FLOOR_PRECISE="FLOOR.PRECISE",I.GCD="GCD",I.INT="INT",I.ISO_CEILING="ISO.CEILING",I.LCM="LCM",I.LET="LET",I.LN="LN",I.LOG="LOG",I.LOG10="LOG10",I.MDETERM="MDETERM",I.MINVERSE="MINVERSE",I.MMULT="MMULT",I.MOD="MOD",I.MROUND="MROUND",I.MULTINOMIAL="MULTINOMIAL",I.MUNIT="MUNIT",I.ODD="ODD",I.PI="PI",I.POWER="POWER",I.PRODUCT="PRODUCT",I.QUOTIENT="QUOTIENT",I.RADIANS="RADIANS",I.RAND="RAND",I.RANDARRAY="RANDARRAY",I.RANDBETWEEN="RANDBETWEEN",I.ROMAN="ROMAN",I.ROUND="ROUND",I.ROUNDBANK="ROUNDBANK",I.ROUNDDOWN="ROUNDDOWN",I.ROUNDUP="ROUNDUP",I.SEC="SEC",I.SECH="SECH",I.SERIESSUM="SERIESSUM",I.SEQUENCE="SEQUENCE",I.SIGN="SIGN",I.SIN="SIN",I.SINH="SINH",I.SQRT="SQRT",I.SQRTPI="SQRTPI",I.SUBTOTAL="SUBTOTAL",I.SUM="SUM",I.SUMIF="SUMIF",I.SUMIFS="SUMIFS",I.SUMPRODUCT="SUMPRODUCT",I.SUMSQ="SUMSQ",I.SUMX2MY2="SUMX2MY2",I.SUMX2PY2="SUMX2PY2",I.SUMXMY2="SUMXMY2",I.TAN="TAN",I.TANH="TANH",I.TRUNC="TRUNC",I),i5=((N=i5||{}).ASC="ASC",N.ARRAYTOTEXT="ARRAYTOTEXT",N.BAHTTEXT="BAHTTEXT",N.CHAR="CHAR",N.CLEAN="CLEAN",N.CODE="CODE",N.CONCAT="CONCAT",N.CONCATENATE="CONCATENATE",N.DBCS="DBCS",N.DOLLAR="DOLLAR",N.EXACT="EXACT",N.FIND="FIND",N.FINDB="FINDB",N.FIXED="FIXED",N.LEFT="LEFT",N.LEFTB="LEFTB",N.LEN="LEN",N.LENB="LENB",N.LOWER="LOWER",N.MID="MID",N.MIDB="MIDB",N.NUMBERSTRING="NUMBERSTRING",N.NUMBERVALUE="NUMBERVALUE",N.PHONETIC="PHONETIC",N.PROPER="PROPER",N.REGEXEXTRACT="REGEXEXTRACT",N.REGEXMATCH="REGEXMATCH",N.REGEXREPLACE="REGEXREPLACE",N.REPLACE="REPLACE",N.REPLACEB="REPLACEB",N.REPT="REPT",N.RIGHT="RIGHT",N.RIGHTB="RIGHTB",N.SEARCH="SEARCH",N.SEARCHB="SEARCHB",N.SUBSTITUTE="SUBSTITUTE",N.T="T",N.TEXT="TEXT",N.TEXTAFTER="TEXTAFTER",N.TEXTBEFORE="TEXTBEFORE",N.TEXTJOIN="TEXTJOIN",N.TEXTSPLIT="TEXTSPLIT",N.TRIM="TRIM",N.UNICHAR="UNICHAR",N.UNICODE="UNICODE",N.UPPER="UPPER",N.VALUE="VALUE",N.VALUETOTEXT="VALUETOTEXT",N.CALL="CALL",N.EUROCONVERT="EUROCONVERT",N.REGISTER_ID="REGISTER.ID",N),i3=Object.getOwnPropertyDescriptor;class i4 extends iI{constructor(e,t){super(e),this._functionExecutor=t}get nodeType(){return iR.OPERATOR}execute(){let e=this.getChildren();this._functionExecutor.name===iU.COMPARE&&this._functionExecutor.setCompareType(this.getToken());let t=e[0],r=e[1],n=null==t?void 0:t.getValue(),i=null==r?void 0:r.getValue(),s=this.getToken();if((null==n||null==i)&&s!==ec.MINUS&&s!==ec.PLUS)return void this.setValue(ru.create(ea.VALUE));null==n&&(n=nX.create()),null==i&&(i=nX.create()),n.isReferenceObject()&&(n=n.toArrayValueObject()),i.isReferenceObject()&&(i=i.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(n,i))}}let i6=class extends iS{constructor(e){super(),this._functionService=e}get zIndex(){return ib.get(iR.OPERATOR)||100}create(e){let t="";e===ec.PLUS?t=iU.PLUS:e===ec.MINUS?t=iU.MINUS:e===ec.MULTIPLY?t=iU.MULTIPLY:e===ec.DIVIDED?t=iU.DIVIDED:e===ec.CONCATENATE?t=i5.CONCATENATE:e===ec.POWER?t=i2.POWER:eg.has(e)&&(t=iU.COMPARE);let r=this._functionService.getExecutor(t);return r?new i4(e,r):(console.error(`No function ${e}`),iN.create(ea.NAME))}checkAndCreateNodeType(e){if(e instanceof tU)return;let t=e.trim();if(('"'!==t.charAt(0)||'"'!==t.charAt(t.length-1))&&em.has(t))return this.create(t)}};i6=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i3(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iO(e,t,0)],i6);var i9=Object.getOwnPropertyDescriptor,i8=(e,t)=>(r,n)=>t(r,n,e);class i7 extends iI{constructor(e,t,r,n,i=!1){super(r),J(this,"_refOffsetX",0),J(this,"_refOffsetY",0),this._currentConfigService=e,this._runtimeService=t,this._referenceObjectType=n,this._isPrepareMerge=i}get nodeType(){return iR.REFERENCE}execute(){let e=this._currentConfigService,t=this._runtimeService,r=function(e,t){let r;switch(t){case 0:r=new ie(e);break;case 1:r=new it(e);break;case 2:r=new ir(e);break;default:throw Error("Unknown reference object type")}return r}(this.getToken(),this._referenceObjectType);r.setDefaultUnitId(t.currentUnitId),r.setDefaultSheetId(t.currentSubUnitId),r.setForcedSheetId(e.getSheetNameMap()),r.setUnitData(e.getUnitData()),r.setArrayFormulaCellData(e.getArrayFormulaCellData()),r.setRuntimeData(t.getUnitData()),r.setUnitStylesData(e.getUnitStylesData()),r.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),r.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());let{x:n,y:i}=this.getRefOffset();r.setRefOffset(n,i),!this._isPrepareMerge&&r.isExceedRange()?this.setValue(ru.create(ea.NAME)):this.setValue(r)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}}let se=class extends iS{constructor(e,t,r){super(),this._currentConfigService=e,this._formulaRuntimeService=t,this._functionService=r}get zIndex(){return ib.get(iR.REFERENCE)||100}checkAndCreateNodeType(e){var t,r;let n,i=!1,s,a=!1;e instanceof tU?(i=!0,s=e.getToken().trim(),(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ef.COLON&&(a=!0)):s=e.trim();let o=this._currentConfigService,l=this._formulaRuntimeService,{tokenTrim:u,minusPrefixNode:c,atPrefixNode:h}=iF(s,this._functionService,l);if((i||'"'!==u.charAt(0)||'"'!==u.charAt(u.length-1))&&(eB(u)?n=new i7(o,l,u,ig.CELL,a):i&&this._checkParentIsUnionOperator(e)&&(eW(u)?n=new i7(o,l,u,ig.ROW,a):eG(u)&&(n=new i7(o,l,u,ig.COLUMN,a))),n))return h?n.setParent(h):c&&n.setParent(c),n}_checkParentIsUnionOperator(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===ef.COLON}};se=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?i9(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([i8(0,tJ),i8(1,iE),i8(2,iO)],se);var st=Object.getOwnPropertyDescriptor,sr=(e,t)=>(r,n)=>t(r,n,e);class sn extends iI{constructor(e,t,r,n){super(r),this._currentConfigService=e,this._lexer=t,this._operatorString=r,this._functionExecutor=n}get nodeType(){return iR.SUFFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");if(this._operatorString===ep.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),(t=this._functionExecutor.calculate(e,nQ.create(100))).isNumber()){let e=Number(t.getValue());t=nQ.create(e,"0.00%")}}else t=this._operatorString===ep.POUND?this._handlerPound(e):ru.create(ea.VALUE);this.setValue(t)}_handlerPound(e){var t,r,n,i;if(!e.isReferenceObject()||!e.isCell())return ru.create(ea.VALUE);let s=e.getRangePosition(),a=e.getUnitId(),o=e.getSheetId(),l=this._currentConfigService.getFormulaData(),u=null==(i=null==(n=null==(r=null==(t=null==l?void 0:l[a])?void 0:t[o])?void 0:r[s.startRow])?void 0:n[s.startColumn])?void 0:i.f;return u&&this._lexer.treeBuilder(u),ru.create(ea.VALUE)}}let si=class extends iS{constructor(e,t,r){super(),this._functionService=e,this._lexer=t,this._currentConfigService=r}get zIndex(){return ib.get(iR.SUFFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tU))return;let t=e.getToken().trim();if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return;let r="";if(t!==ep.PERCENTAGE)return t===ep.POUND?new sn(this._currentConfigService,this._lexer,t):void 0;r=iU.DIVIDED;let n=this._functionService.getExecutor(r);return n?new sn(this._currentConfigService,this._lexer,t,n):(console.error(`No function ${e}`),iN.create(ea.NAME))}};si=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?st(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sr(0,iO),sr(1,(0,B.Inject)(t2)),sr(2,tJ)],si);var ss=Object.getOwnPropertyDescriptor;class sa extends iI{constructor(e){super(e)}get nodeType(){return iR.UNION}execute(){let e,t=this.getChildren(),r=t[0],n=t[1],i=r.getValue(),s=n.getValue();if(null==i||null==s)throw Error("leftNode and rightNode");e=this.getToken()===ef.COLON?this._unionFunction(i,s):ru.create(ea.NAME),this.setValue(e)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?ru.create(ea.REF):e.isCell()&&t.isCell()||e.isRow()&&t.isRow()||e.isColumn()&&t.isColumn()?e.unionBy(t):ru.create(ea.NAME)}}let so=class extends iS{constructor(e){super(),this._functionService=e}get zIndex(){return ib.get(iR.UNION)||100}create(e){return new sa(e)}checkAndCreateNodeType(e){if(!(e instanceof tU))return;let t=e.getToken().trim();if(('"'!==t.charAt(0)||'"'!==t.charAt(t.length-1))&&t===ef.COLON)return this.create(t)}};so=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ss(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([(e,t)=>iO(e,t,0)],so);class sl extends iI{constructor(e){super(e)}get nodeType(){return iR.VALUE}execute(){this.setValue(n3.create(this.getToken()))}}class su extends iS{get zIndex(){return ib.get(iR.VALUE)||100}_checkValueNode(e){if(!Number.isNaN(Number(e)))return this.create(e);{let t=e.trim(),r=t.charAt(0),n=t.charAt(t.length-1);if(eo.has(t)||'"'===r&&'"'===n||"{"===r&&"}"===n)return this.create(t);let i=t.toUpperCase();if(i===er.TRUE||i===er.FALSE)return this.create(i)}}create(e){return new sl(e)}checkAndCreateNodeType(e){if(!(e instanceof tU))return this._checkValueNode(e)}}var sc=Object.getOwnPropertyDescriptor,sh=(e,t)=>(r,n)=>t(r,n,e);let sd=class extends j.Disposable{constructor(e,t,r,n,i,s,a,o,l,u,c){super(),J(this,"_astNodeFactoryList",[]),this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=n,this._lambdaParameterNodeFactory=i,this._operatorNodeFactory=s,this._prefixNodeFactory=a,this._referenceNodeFactory=o,this._suffixNodeFactory=l,this._unionNodeFactory=u,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){let t=new iA("R_1"),r=this._parse(e,t);return e.hasDefinedNames()&&(null==r||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(null==t.getLambdaId)return iN.create(ea.VALUE);let r=t.getLambdaId(),n=new iA("R_1"),i=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!i)return!1;let s=[...i.keys()],a=e.getChildren(),o=a.length;for(let e=0;e<o;e++){let t=a[e];if(!(t instanceof tU))return!1;{iz(t,r,i),this._parse(t,n);let a=n.getChildren()[e];null!=a&&i.set(s[e],a)}}return n.setParent(t),t}_changeLetToLambda(e){let t=e.getChildren(),r=t.length;if(r%2!=1||0===r)return;let n=new tU;n.setToken(tv);let i=new tU;i.setToken("L_1");let s=[...t];for(let e=0;e<r;e++){let t=s[e];if(!(t instanceof tU))return;e%2==0?t.changeToParent(n):t.changeToParent(i)}n.addChildrenFirst(i),i.setParent(n);let a=e.getParent();return null==a||a.replaceChild(e,n),n}_parse(e,t){var r;let n=e.getChildren(),i=n.length,s=[],a=null,o=e.getToken().trim().toUpperCase();if("LET"===o){let r=this._changeLetToLambda(e);return null!=r?this._parse(r,t):iN.create(ea.ERROR)}if("P_1"===o){if(a=t,0===i)return new i1("R_1").setParent(t),a}else{if("L_1"===o){let r=this._lambdaParameterHandler(e,t);return!1===r&&(r=iN.create(ea.ERROR)),r}if(null==(a=this._checkAstNode(e)))return iN.create(ea.NAME)}let l=n[0];for(let e=0;e<i;e++){let t=n[e];if(iY(l)){if(0!==e&&e!==i-1)continue}else if(t instanceof tU&&t.getToken()===tA&&e!==i-1)continue;let o=null;if(t instanceof tU){if("P_1"===t.getToken()&&0===t.getChildren().length){let e=null==(r=t.getParent())?void 0:r.getChildren();if(e&&1===e.length)return iN.create(ea.NAME)}if((o=this._parse(t,a))===a)continue}else o=this._checkAstNode(t);if(null==o)return iN.create(ea.NAME);if(null==(o=function(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}(o))||(null==o?void 0:o.nodeType)===iR.ERROR)return o;switch(o.nodeType){case iR.FUNCTION:{let e=o.getToken().trim().toUpperCase();tT.has(e)&&o.setForcedCalculateFunction(),s.push(o);break}case iR.LAMBDA:case iR.LAMBDA_PARAMETER:s.push(o);break;case iR.OPERATOR:{let e=s.pop(),t=s.pop();t&&t.setParent(o),e&&e.setParent(o),s.push(o);break}case iR.REFERENCE:case iR.ROOT:case iR.UNION:case iR.VALUE:case iR.PREFIX:case iR.SUFFIX:s.push(o)}}let u=s.length;for(let e=0;e<u;e++)s[e].setParent(a);return a}_checkAstNode(e){let t=null,r=this._astNodeFactoryList.length;for(let n=0;n<r&&null==(t=this._astNodeFactoryList[n].checkAndCreateNodeType(e));n++);return null==t?new i$:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(j.sortRules)}};sd=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sc(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sh(0,iE),sh(1,(0,B.Inject)(iv)),sh(2,(0,B.Inject)(iH)),sh(3,(0,B.Inject)(iZ)),sh(4,(0,B.Inject)(i0)),sh(5,(0,B.Inject)(i6)),sh(6,(0,B.Inject)(iP)),sh(7,(0,B.Inject)(se)),sh(8,(0,B.Inject)(si)),sh(9,(0,B.Inject)(so)),sh(10,(0,B.Inject)(su))],sd);class sm extends j.Disposable{constructor(){super(...arguments),J(this,"_otherFormulaData",new Map),J(this,"_featureFormulaData",new Map),J(this,"_formulaData",new Map),J(this,"_definedNameMap",new Map),J(this,"_otherFormulaDataMainData",new Set),J(this,"_dependencyRTreeCache",new(0,j.RTree)),J(this,"_dependencyTreeIdLast",0)}buildDependencyTree(e,t){throw Error("Method not implemented.")}getTreeById(e){throw Error("Method not implemented.")}getAllTree(){throw Error("Method not implemented.")}reset(){throw Error("Method not implemented.")}addOtherFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeOtherFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearOtherFormulaDependency(e,t){throw Error("Method not implemented.")}addFeatureFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}removeFeatureFormulaDependency(e,t,r){throw Error("Method not implemented.")}clearFeatureFormulaDependency(e,t){throw Error("Method not implemented.")}addFormulaDependency(e,t,r,n,i){throw Error("Method not implemented.")}removeFormulaDependency(e,t,r,n){throw Error("Method not implemented.")}clearFormulaDependency(e,t){throw Error("Method not implemented.")}removeFormulaDependencyByDefinedName(e,t){throw Error("Method not implemented.")}searchDependency(e,t){return this._dependencyRTreeCache.bulkSearch(e,t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getOtherFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._otherFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}addOtherFormulaDependencyMainData(e){this._otherFormulaDataMainData.add(e)}hasOtherFormulaDataMainData(e){return this._otherFormulaDataMainData.has(e)}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}getFeatureFormulaDependency(e,t,r){var n,i;return null==(i=null==(n=this._featureFormulaData.get(e))?void 0:n.get(t))?void 0:i.get(r)}getFormulaDependency(e,t,r,n){var i,s;return null==(s=null==(i=this._formulaData.get(e))?void 0:i.get(t))?void 0:s.getValue(r,n)}addDependencyRTreeCache(e){let t=[];for(let r=0;r<e.rangeList.length;r++){let{unitId:n,sheetId:i,range:s}=e.rangeList[r];t.push({unitId:n,sheetId:i,range:s,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t),this._addAllTreeMap(e)}getLastTreeId(){let e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_addAllTreeMap(e){throw Error("Method not implemented.")}_addDefinedName(e,t,r){this._definedNameMap.has(e)||this._definedNameMap.set(e,new Map);let n=this._definedNameMap.get(e);n.has(t)||n.set(t,new Set),n.get(t).add(r)}addFormulaDependencyByDefinedName(e,t){let r=e.treeId;for(let n of(null==t?void 0:t.getDefinedNames())||[])this._addDefinedName(e.unitId,n,r)}}class sg extends sm{constructor(){super(...arguments),J(this,"_allTreeMap",new Map)}dispose(){super.dispose(),this.reset()}buildDependencyTree(e,t=[]){let r=this.getAllTree();return 0===e.length?this._buildReverseDependency(r,t):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e)),r}_buildDependencyTree(e,t){let r=new Map;for(let e=0;e<t.length;e++){let n=t[e];r.set(n.treeId,n)}for(let t=0;t<e.length;t++){let n=e[t],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}_buildReverseDependency(e,t){let r=new Map;for(let t=0;t<e.length;t++){let n=e[t];r.set(n.treeId,n)}for(let e=0;e<t.length;e++){let n=t[e],i=n.toRTreeItem();for(let e of this._dependencyRTreeCache.bulkSearch(i)){let t=r.get(e);t&&n!==t&&!t.hasChildren(n.treeId)&&t.pushChildren(n)}}r.clear()}getAllTree(){let e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}reset(){this._otherFormulaData.clear(),this._featureFormulaData.clear(),this._formulaData.clear(),this._definedNameMap.clear(),this._otherFormulaDataMainData.clear(),this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,n){this._otherFormulaData.has(e)||this._otherFormulaData.set(e,new Map);let i=this._otherFormulaData.get(e);i.has(t)||i.set(t,new Map);let s=i.get(t);s.has(r)||s.set(r,new(0,j.ObjectMatrix)),s.get(r).setValue(n.refOffsetX,n.refOffsetY,n.treeId),this._addAllTreeMap(n)}removeOtherFormulaDependency(e,t,r){let n=this._otherFormulaData.get(e);if(n&&n.has(t)){let i=n.get(t);r.forEach(e=>{let t=i.get(e);null!=t&&(t.forValue((e,t,r)=>{this._removeDependencyRTreeCache(r),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),i.delete(e),this._otherFormulaDataMainData.delete(e))}),0===i.size&&n.delete(t),0===n.size&&this._otherFormulaData.delete(e)}}clearOtherFormulaDependency(e,t){let r=this._otherFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}n.clear()}else if(r){for(let t of r.keys()){let n=r.get(t);for(let r of(this._removeDependencyRTreeCacheById(e,t),n.keys())){let e=n.get(r);null!=e&&(e.forValue((e,t,r)=>{let n=this._allTreeMap.get(r);n&&(this.clearDependencyForTree(n),this._removeAllTreeMap(r))}),this._otherFormulaDataMainData.delete(r))}}this._otherFormulaData.delete(e)}}addFeatureFormulaDependency(e,t,r,n){this._featureFormulaData.has(e)||this._featureFormulaData.set(e,new Map);let i=this._featureFormulaData.get(e);i.has(t)||i.set(t,new Map),i.get(t).set(r,n.treeId),this._addAllTreeMap(n)}removeFeatureFormulaDependency(e,t,r){let n=this._featureFormulaData.get(e);if(n&&n.has(t)){let e=n.get(t);r.forEach(t=>{let r=e.get(t);null!=r&&(this._removeDependencyRTreeCache(r),e.delete(t),this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r))})}}clearFeatureFormulaDependency(e,t){let r=this._featureFormulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))}),n.clear()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forEach(e=>{null!=e&&(this.clearDependencyForTree(this._allTreeMap.get(e)),this._removeAllTreeMap(e))})}),this._featureFormulaData.delete(e))}addFormulaDependency(e,t,r,n,i){this._formulaData.has(e)||this._formulaData.set(e,new Map);let s=this._formulaData.get(e);s.has(t)||s.set(t,new(0,j.ObjectMatrix)),s.get(t).setValue(r,n,i.treeId),this._addAllTreeMap(i)}removeFormulaDependency(e,t,r,n){let i=this._formulaData.get(e);if(i&&i.has(t)){let e=i.get(t),s=e.getValue(r,n);if(null==s)return;this._removeDependencyRTreeCache(s),e.realDeleteValue(r,n),this.clearDependencyForTree(this._allTreeMap.get(s)),this._removeAllTreeMap(s)}}clearFormulaDependency(e,t){let r=this._formulaData.get(e);if(t&&r&&r.has(t)){let n=r.get(t);this._removeDependencyRTreeCacheById(e,t),n.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)}),n.reset()}else r&&(r.forEach((t,r)=>{this._removeDependencyRTreeCacheById(e,r),t.forValue((e,t,r)=>{if(null==r)return!0;this.clearDependencyForTree(this._allTreeMap.get(r)),this._removeAllTreeMap(r)})}),this._formulaData.delete(e))}clearDependencyForTree(e){if(null==e)return;let t=e.parents,r=e.children,n=this._allTreeMap;for(let r of t){let t=n.get(r);null==t||t.children.delete(e.treeId)}for(let t of r){let r=n.get(t);null==r||r.parents.delete(e.treeId)}e.dispose()}_removeDependencyRTreeCache(e){if(null==e)return;let t=this._allTreeMap.get(e);if(t){let r=[];for(let n=0;n<t.rangeList.length;n++){let{unitId:i,sheetId:s,range:a}=t.rangeList[n];r.push({unitId:i,sheetId:s,range:a,id:e})}this._dependencyRTreeCache.bulkRemove(r)}}removeFormulaDependencyByDefinedName(e,t){let r=this._definedNameMap.get(e);if(r){let e=r.get(t);if(e){for(let t of e)this._removeDependencyRTreeCache(t),this.clearDependencyForTree(this._allTreeMap.get(t)),this._removeAllTreeMap(t);e.clear()}}}_removeAllTreeMap(e){null!=e&&this._allTreeMap.delete(e)}_addAllTreeMap(e){this._allTreeMap.set(e.treeId,e)}}let sf=(0,B.createIdentifier)("univer.formula.dependency-manager.service");class sp extends j.Disposable{constructor(){super(...arguments),J(this,"_referenceExecutorMap",new Map),J(this,"_onChanged$",new(0,X.Subject)),J(this,"onChanged$",this._onChanged$.asObservable())}dispose(){super.dispose(),this._referenceExecutorMap.clear(),this._onChanged$.complete()}remove(e,t,r){r.forEach(r=>{var n,i;null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))||i.delete(r)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var n,i;return null==(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))?void 0:i.get(r)}has(e,t,r){var n,i;return!!(null!=(i=null==(n=this._referenceExecutorMap.get(e))?void 0:n.get(t))&&i.has(r))}register(e,t,r,n){let i=this._referenceExecutorMap.get(e);i||(i=new Map,this._referenceExecutorMap.set(e,i));let s=i.get(t);s||(s=new Map,i.set(t,s)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),s.set(r,n)}getReferenceExecutorMap(){return this._referenceExecutorMap}}let sC=(0,B.createIdentifier)("univer.formula.feature-calculation-manager.service");class s_ extends j.Disposable{constructor(){super(...arguments),J(this,"_otherFormulaData",{})}dispose(){super.dispose(),this._otherFormulaData={}}remove(e){var t,r,n;let{unitId:i,subUnitId:s,formulaId:a}=e;null==(n=null==(r=null==(t=this._otherFormulaData)?void 0:t[i])?void 0:r[s])||delete n[a]}get(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s]}has(e){var t,r;let{unitId:n,subUnitId:i,formulaId:s}=e;return(null==(r=null==(t=this._otherFormulaData[n])?void 0:t[i])?void 0:r[s])!=null}register(e){let{unitId:t,subUnitId:r,formulaId:n,item:i}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][n]=i}batchRegister(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{let i=n[r];if(null==i)return!0;this.register({unitId:t,subUnitId:e,formulaId:r,item:i})})})})}batchRemove(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let n=r[e];if(null==n)return!0;Object.keys(n).forEach(r=>{this.remove({unitId:t,subUnitId:e,formulaId:r})})})})}getOtherFormulaData(){return this._otherFormulaData}}let sy=(0,B.createIdentifier)("univer.formula.other-formula-manager.service");var sE=((S=sE||{})[S.NORMAL_FORMULA=0]="NORMAL_FORMULA",S[S.OTHER_FORMULA=1]="OTHER_FORMULA",S[S.FEATURE_FORMULA=2]="FEATURE_FORMULA",S);class sR{constructor(){J(this,"_state",0),J(this,"treeId"),J(this,"children",new Set),J(this,"parents",new Set)}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return 1===this._state}setSkip(){this._state=2}isSkip(){return 2===this._state}pushChildren(e){this.children.add(e.treeId),e._pushParent(this)}hasChildren(e){return this.children.has(e)}_pushParent(e){this.parents.add(e.treeId)}}class sb extends sR{constructor(){super(...arguments),J(this,"refTree"),J(this,"refOffsetX",-1),J(this,"refOffsetY",-1),J(this,"isCache",!1),J(this,"isDirty",!1),J(this,"addressFunctionNodes",[]),J(this,"getDirtyData"),J(this,"featureId")}get isVirtual(){return!0}get row(){return null==this.refTree?-1:this.refTree.row+this.refOffsetY}get column(){return null==this.refTree?-1:this.refTree.column+this.refOffsetX}get rowCount(){return null==this.refTree?0:this.refTree.rowCount}get columnCount(){return null==this.refTree?0:this.refTree.columnCount}get unitId(){return null==this.refTree?"":this.refTree.unitId}get subUnitId(){return null==this.refTree?"":this.refTree.subUnitId}get formula(){var e,t;return null!=(t=null==(e=this.refTree)?void 0:e.formula)?t:""}get nodeData(){return{node:this.node,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}get node(){var e;return null==(e=this.refTree)?void 0:e.node}dispose(){this.refTree=null}get rangeList(){let e=[];if(null==this.refTree)return[];for(let t=0;t<this.refTree.rangeList.length;t++){let r=this.refTree.rangeList[t];e.push({unitId:r.unitId,sheetId:r.sheetId,range:(0,j.moveRangeByOffset)(r.range,this.refOffsetX,this.refOffsetY)})}return e}toRTreeItem(){let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){return null!=this.refTree&&this.refTree.dependencySheetName(e)}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=Number.POSITIVE_INFINITY),Number.isNaN(h)&&(h=Number.POSITIVE_INFINITY);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}get formulaId(){return null==this.refTree?"":this.refTree.formulaId}}class sI extends sR{constructor(e){super(),J(this,"isCache",!1),J(this,"featureId"),J(this,"featureDirtyRanges",[]),J(this,"refOffsetX",0),J(this,"refOffsetY",0),J(this,"type",0),J(this,"formulaId"),J(this,"subUnitId",""),J(this,"unitId",""),J(this,"rangeList",[]),J(this,"formula",""),J(this,"row",-1),J(this,"column",-1),J(this,"rowCount",Number.NEGATIVE_INFINITY),J(this,"columnCount",Number.NEGATIVE_INFINITY),J(this,"isDirty",!1),J(this,"node"),J(this,"addressFunctionNodes",[]),J(this,"getDirtyData"),this.treeId=e}get isVirtual(){return!1}get nodeData(){return{node:this.node,refOffsetX:0,refOffsetY:0}}toJson(){return{formula:this.formula,refOffsetX:this.refOffsetX,refOffsetY:this.refOffsetY}}dispose(){this.featureDirtyRanges=[],this.rangeList=[],this.addressFunctionNodes=[],this.getDirtyData=null}inRangeData(e){let t=e.startRow,r=e.startColumn,n=e.endRow,i=e.endColumn,s=this.row,a=this.column;return!(s<t||s>n||a<r||a>i)}dependencySheetName(e){var t;let r=this.rangeList;if(0===r.length||null==e)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s}=r[n];if((null==(t=e[i])?void 0:t[s])!=null)return!0}return!1}isExcludeRange(e){var t;let r=this.rangeList;if(0===r.length)return!1;for(let n=0,i=r.length;n<i;n++){let{unitId:i,sheetId:s,range:a}=r[n],o=null==(t=null==e?void 0:e[i])?void 0:t[s],{startRow:l,endRow:u,startColumn:c,endColumn:h}=a;Number.isNaN(l)&&(l=0),Number.isNaN(c)&&(c=0),Number.isNaN(u)&&(u=Number.POSITIVE_INFINITY),Number.isNaN(h)&&(h=Number.POSITIVE_INFINITY);let d=!1;if(null==o||o.forValue((e,t)=>{if(e>=l&&e<=u&&t>=c&&t<=h)return d=!0,!1}),d)return!0}return!1}pushRangeList(e){this.rangeList.push(...e)}shouldBePushRangeList(){return 0===this.rangeList.length&&2!==this.type}toRTreeItem(){if(null!=this.featureId)return this.featureDirtyRanges;let e=this.row,t=this.column;return[{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:e,startColumn:t,endRow:e,endColumn:t}}]}}var sN=Object.getOwnPropertyDescriptor,sS=(e,t)=>(r,n)=>t(r,n,e);function sA(e){return e.getLastTreeId()||0}let sv=(0,B.createIdentifier)("engine-formula.dependency-generator"),sT=class extends j.Disposable{constructor(e,t,r,n,i,s,a,o){super(),J(this,"_updateRangeFlattenCache",new Map),J(this,"_dependencyRTreeCacheForAddressFunction",new(0,j.RTree)),J(this,"_executedAddressFunctionNodeIds",new Set),this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=n,this._interpreter=i,this._astTreeBuilder=s,this._lexer=a,this._dependencyManagerService=o}dispose(){this._updateRangeFlattenCache.clear(),this._dependencyRTreeCacheForAddressFunction.clear(),iT.clear()}async generate(){this._updateRangeFlatten();let e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();null!=r&&Object.keys(r).forEach(e=>{null!=e&&Object.keys(r[e]).forEach(t=>{null!=t&&(this._dependencyManagerService.clearOtherFormulaDependency(e,t),this._dependencyManagerService.clearFeatureFormulaDependency(e,t),this._dependencyManagerService.clearFormulaDependency(e,t))})});let n=this._currentConfigService.getUnitData(),i=await this._generateTreeList(e,t,n),s=this._getUpdateTreeListAndMakeDependency(i),a=this._calculateRunList(s);return this._dependencyFeatureCalculation(a)&&(a.forEach(e=>{e.resetState()}),a=this._calculateRunList(a)),this._checkIsCycleDependency(a)&&this._runtimeService.enableCycleDependency(),this._dependencyRTreeCacheForAddressFunction.clear(),Promise.resolve(a)}_dependencyFeatureCalculation(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();if(0===t.size)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((t,n)=>{t.forEach((t,n)=>{t.forEach((t,n)=>{let{unitId:i,subUnitId:s,getDirtyData:a}=t,o=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),l=this._convertDirtyRangesToUnitRange(o.dirtyRanges),u=this._intersectFeatureCalculation(l,e,{unitId:i,subUnitId:s,featureId:n});if(u.length>0){let a=this._getExistTreeList({unitId:i,subUnitId:s,featureId:n},e);null==a&&(a=this._getFeatureFormulaTree(n,sA(this._dependencyManagerService),t),e.push(a)),a.parents=new Set,u.forEach(e=>{e.hasChildren(a.treeId)||e.pushChildren(a)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(e=>{var r,n,i,s;let a=new Set;for(let i of e.children){let s=this._dependencyManagerService.getTreeById(i);s&&(s.featureId&&null!=(n=null==(r=t.get(e.unitId))?void 0:r.get(e.subUnitId))&&n.has(s.featureId)||a.add(i))}e.children=a;let o=new Set;for(let r of e.parents){let n=this._dependencyManagerService.getTreeById(r);n&&(n.featureId&&null!=(s=null==(i=t.get(e.unitId))?void 0:i.get(e.subUnitId))&&s.has(n.featureId)||o.add(r))}e.parents=o})}_convertDirtyRangesToUnitRange(e){let t=[];for(let r in e){let n=e[r];for(let e in n)for(let i of n[e])t.push({unitId:r,sheetId:e,range:i})}return t}_intersectFeatureCalculation(e,t,r){let n=[],i=this._dependencyManagerService.searchDependency(e);for(let e=0,s=t.length;e<s;e++){let s=t[e];(s.unitId!==r.unitId||s.subUnitId!==r.subUnitId||s.featureId!==r.featureId)&&i.has(s.treeId)&&n.push(s)}return n}_getExistTreeList(e,t){let{unitId:r,subUnitId:n,featureId:i}=e;for(let e=0,s=t.length;e<s;e++){let s=t[e];if(s.unitId===r&&s.subUnitId===n&&s.featureId===i)return s}}_isCyclicUtil(e,t,r){let n=this._dependencyManagerService.getTreeById(e);if(null==n)return!1;if(!t.has(n.treeId)){for(let e of(t.add(n.treeId),r.add(n.treeId),n.children))if(!t.has(e)&&this._isCyclicUtil(e,t,r)||r.has(e))return!0}return r.delete(n.treeId),!1}_checkIsCycleDependency(e){let t=new Set,r=new Set;for(let n=0,i=e.length;n<i;n++){let i=e[n];if(!0===this._isCyclicUtil(i.treeId,t,r))return!0}return!1}async _generateTreeList(e,t,r){let n=Object.keys(e),i=Object.keys(t),s=[];this._currentConfigService.isForceCalculate()&&this._dependencyManagerService.reset(),this._registerFormulas(n,e,r,s),this._registerOtherFormulas(t,i,s),this._registerFeatureFormulas(s);for(let e=0,t=s.length;e<t;e++){let t=s[e];if(!t.formula)continue;let r=this._getTreeNode(t);t.isDirty=this._includeTree(t,r);let n=this._getAddressFunctionNodeList(r);if(n.length>0&&(t.addressFunctionNodes=n),t.isVirtual)continue;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let i=await this._getRangeListByNode({node:r,refOffsetX:t.refOffsetX,refOffsetY:t.refOffsetY});t.pushRangeList(i)}for(let e=0,t=s.length;e<t;e++){let t=s[e];t.isCache||this._dependencyManagerService.addDependencyRTreeCache(t)}return await this._calculateListByFunctionRefNode(s),s}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((t,r)=>{t.forEach((t,r)=>{t.forEach((t,r)=>{let n=this._dependencyManagerService.getFeatureFormulaDependency(t.unitId,t.subUnitId,r);e.push(this._getFeatureFormulaTree(r,n,t))})})})}_getFeatureFormulaTree(e,t,r){let{unitId:n,subUnitId:i,dependencyRanges:s,getDirtyData:a}=r,o=new sI(t||sA(this._dependencyManagerService));o.unitId=n,o.subUnitId=i,o.rangeList=s,o.getDirtyData=a;let l=a(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());return o.featureDirtyRanges=this._convertDirtyRangesToUnitRange(l.dirtyRanges),o.featureId=e,o.type=sE.FEATURE_FORMULA,this._dependencyManagerService.addFeatureFormulaDependency(n,i,e,o),this._dependencyManagerService.getFeatureFormulaDependency(r.unitId,r.subUnitId,e)&&(o.isCache=!0),o}_registerOtherFormulas(e,t,r){for(let n of t){let t=e[n];if(null!=t)for(let e of Object.keys(t)){let i=t[e];if(null!=i)for(let t of Object.keys(i)){let s=this._dependencyManagerService.hasOtherFormulaDataMainData(t),{f:a,ranges:o}=i[t],l=!1;s&&(l=!0);let u=iw(n,a,this._lexer,this._astTreeBuilder,this._currentConfigService),{firstRow:c,firstColumn:h}=this._getFirstCellOfRange(o),d=this._dependencyManagerService.getOtherFormulaDependency(n,e,t),m=new sI((null==d?void 0:d.getValue(0,0))||sA(this._dependencyManagerService));for(let i=0;i<o.length;i++){let{startRow:s,startColumn:g,endRow:f,endColumn:p}=o[i];for(let i=s;i<=f;i++)for(let s=g;s<=p;s++){let o=s-h,g=i-c;if(0===o&&0===g){m.node=u,m.formula=a,m.unitId=n,m.subUnitId=e,m.formulaId=t,m.type=sE.OTHER_FORMULA,m.isCache=l,r.push(m),this._dependencyManagerService.addOtherFormulaDependency(n,e,t,m),this._dependencyManagerService.addFormulaDependencyByDefinedName(m);continue}let f=new sb;f.treeId=(null==d?void 0:d.getValue(o,g))||sA(this._dependencyManagerService),f.refTree=m,f.refOffsetX=o,f.refOffsetY=g,f.isCache=l,this._dependencyManagerService.addOtherFormulaDependency(n,e,t,f),this._dependencyManagerService.addFormulaDependencyByDefinedName(f),r.push(f)}}this._dependencyManagerService.addOtherFormulaDependencyMainData(t)}}}}_getFirstCellOfRange(e){let t=e[0];return{firstRow:t.startRow,firstColumn:t.startColumn}}_registerFormulas(e,t,r,n){for(let i of e){let e=t[i];if(null!=e)for(let t of Object.keys(e)){let s=new(0,j.ObjectMatrix)(e[t]||{}),a=new Map;s.forValue((e,s,o)=>{if(null==o)return!0;let{x:l=0,y:u=0,si:c}=o;if(0!==l||0!==u||null==c)return!0;let h=this._createFDtree(i,t,e,s,r,o),d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?h.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,h),this._dependencyManagerService.addFormulaDependencyByDefinedName(h)),a.set(c,h),n.push(h)}),s.forValue((e,s,o)=>{let l;if(null==o)return!0;let{x:u=0,y:c=0,si:h}=o;if(0===u&&0===c&&null!=h)return!0;if(h&&a.has(h)){let e=a.get(h);l=this._createVirtualFDtree(e,o)}else l=this._createFDtree(i,t,e,s,r,o);let d=this._dependencyManagerService.getFormulaDependency(i,t,e,s);null!=d?l.treeId=d:(this._dependencyManagerService.addFormulaDependency(i,t,e,s,l),this._dependencyManagerService.addFormulaDependencyByDefinedName(l)),n.push(l)}),a.clear()}}}_createFDtree(e,t,r,n,i,s){let{f:a,x:o=0,y:l=0}=s,u=new sI(sA(this._dependencyManagerService)),c=i[e][t];return u.node=iw(e,a,this._lexer,this._astTreeBuilder,this._currentConfigService),u.formula=a,u.unitId=e,u.subUnitId=t,u.row=r,u.column=n,u.rowCount=c.rowCount,u.columnCount=c.columnCount,u}_createVirtualFDtree(e,t){let{x:r=0,y:n=0}=t,i=new sb;return i.treeId=sA(this._dependencyManagerService),i.refTree=e,i.refOffsetX=r,i.refOffsetY=n,i}_updateRangeFlatten(){let e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let e=0;e<t.length;e++){let r=t[e],n=r.range,i=r.sheetId,s=r.unitId;this._addFlattenCache(s,i,n)}}}_addFlattenCache(e,t,r){let n=this._updateRangeFlattenCache.get(e);null==n&&(n=new Map,this._updateRangeFlattenCache.set(e,n));let i=n.get(t);null==i&&(i=[],n.set(t,i)),i.push(r)}_isPreCalculateNode(e){return e.nodeType===iR.UNION||e.nodeType===iR.PREFIX&&e.getToken()===e_.AT||e.nodeType===iR.SUFFIX&&e.getToken()===ep.POUND}_nodeTraversalRef(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(this._isPreCalculateNode(n)){if(t.push(n),n.nodeType===iR.UNION)for(let e of n.getChildren())e.nodeType===iR.FUNCTION&&e.isAddress()&&this._nodeTraversalRef(e,t);continue}n.nodeType===iR.REFERENCE&&t.push(n),this._nodeTraversalRef(n,t)}}_nodeTraversalReferenceFunction(e,t){let r=e.getChildren(),n=r.length;for(let e=0;e<n;e++){let n=r[e];if(n.nodeType===iR.FUNCTION&&n.isAddress()){t.push(n);continue}this._nodeTraversalReferenceFunction(n,t)}}async _executeNode(e,t=0,r=0){let n={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?await this._interpreter.executeAsync(n):this._interpreter.execute(n)}async _getRangeListByNode(e){let t=[],r=e.refOffsetX,n=e.refOffsetY,i=e.node;if(null==i)return[];this._nodeTraversalRef(i,t);let s=[];for(let e=0,i=t.length;e<i;e++){let i=t[e],a=(await this._executeNode(i,r,n)).toUnitRange();s.push(a),i.setValue(null)}return s}_getAddressFunctionNodeList(e){let t=[];return null==e?[]:(this._nodeTraversalReferenceFunction(e,t),t)}_getTreeNode(e){return e.node}async _buildDirtyRangesByAddressFunction(e,t){let r=t.addressFunctionNodes;if(0===r.length)return;let n=t.refOffsetX,i=t.refOffsetY,s=await this._getRangeListByFunctionRefNode(r,n,i);t.addressFunctionNodes=[],this._addDependencyTreeByAddressFunction(t,s);let a=e.bulkSearch(s),o=this._buildTreeNodeById(a);0!==o.length&&await this._calculateAddressFunctionRuntimeData(e,o)}async _calculateListByFunctionRefNode(e){let t=new(0,j.RTree);for(let r=0,n=e.length;r<n;r++){let n=e[r];t.insert({unitId:n.unitId,sheetId:n.subUnitId,range:{startRow:n.row,startColumn:n.column,endRow:n.row,endColumn:n.column},id:n.treeId})}this._executedAddressFunctionNodeIds.clear();for(let r=0,n=e.length;r<n;r++){let n=e[r];await this._calculateAddressFunction(t,n)}}async _calculateAddressFunction(e,t){let r=t.addressFunctionNodes;if(0===r.length)return;let n=t.refOffsetX,i=t.refOffsetY;this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let s=[];for(let e=0,t=r.length;e<t;e++){let t=await this._getRangeListByNode({node:r[e],refOffsetX:n,refOffsetY:i});s.push(...t)}let a=new Set;this._searchDependencyByAddressFunction(e,s,a);let o=this._buildTreeNodeById(a);if(0===o.length)return void await this._buildDirtyRangesByAddressFunction(e,t);await this._calculateAddressFunctionRuntimeData(e,o),await this._buildDirtyRangesByAddressFunction(e,t)}async _calculateAddressFunctionRuntimeData(e,t){for(;t.length>0;){let r,n=t.pop(),i={node:this._getTreeNode(n),refOffsetX:n.refOffsetX,refOffsetY:n.refOffsetY};await this._calculateAddressFunction(e,n),this._runtimeService.setCurrent(n.row,n.column,n.rowCount,n.columnCount,n.subUnitId,n.unitId),r=this._interpreter.checkAsyncNode(i.node)?await this._interpreter.executeAsync(i):this._interpreter.execute(i),null!=n.formulaId?this._runtimeService.setRuntimeOtherData(n.formulaId,n.refOffsetX,n.refOffsetY,r):this._runtimeService.setRuntimeData(r)}}_buildTreeNodeById(e){let t=[];for(let r of e){let e=this._getTreeById(r);!e||this._executedAddressFunctionNodeIds.has(r)||(this._executedAddressFunctionNodeIds.add(r),t.push(e))}return t}_searchDependencyByAddressFunction(e,t,r){let n=e.bulkSearch(t);for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(t))r.has(e)||r.add(e);let i=[];for(let e of n){let t=this._getTreeById(e);t&&!r.has(e)&&(i.push(...t.rangeList),r.add(e))}return i.length>0&&this._searchDependencyByAddressFunction(e,i,r),r}_getTreeById(e){return this._dependencyManagerService.getTreeById(e)}_addDependencyTreeByAddressFunction(e,t){let r=[];for(let n=0;n<t.length;n++){let{unitId:i,sheetId:s,range:a}=t[n];r.push({unitId:i,sheetId:s,range:a,id:e.treeId})}this._dependencyRTreeCacheForAddressFunction.bulkInsert(r)}async _getRangeListByFunctionRefNode(e,t,r){let n=[];for(let i=0,s=e.length;i<s;i++){let s=e[i],a=(await this._executeNode(s,t,r)).toUnitRange();n.push(a),s.setValue(null)}return n}_getUpdateTreeListAndMakeDependency(e){let t=[],r=new Set,n=this._currentConfigService.isForceCalculate(),i=this._currentConfigService.getDirtyRanges(),s=this._dependencyManagerService.searchDependency(i);for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(i))s.add(e);for(let i of this._dependencyManagerService.buildDependencyTree(e)){let e=i.treeId;(n||i.isDirty||i.dependencySheetName(this._currentConfigService.getDirtyNameMap())||s.has(e)&&!i.isExcludeRange(this._currentConfigService.getExcludedRange()))&&!r.has(e)&&(t.push(i),r.add(e))}return t}_includeTreeFeature(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.featureId;if(null!=s){let e=this._currentConfigService.getDirtyUnitFeatureMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_includeOtherFormula(e){var t,r;let n=e.unitId,i=e.subUnitId,s=e.formulaId;if(null!=s){let e=this._currentConfigService.getDirtyUnitOtherFormulaMap();if((null==(r=null==(t=null==e?void 0:e[n])?void 0:t[i])?void 0:r[s])!=null)return!0}return!1}_detectForcedRecalculationNode(e,t){return null!=t&&this._detectForcedRecalculationNodeRecursion(t)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;let t=e.getChildren();for(let e=0,r=t.length;e<r;e++){let r=t[e];if(this._detectForcedRecalculationNodeRecursion(r))return!0}return!1}_includeTree(e,t){var r,n,i,s;let a=e.unitId,o=e.subUnitId;if(!0===this._detectForcedRecalculationNode(e,t)||!0===this._includeTreeFeature(e)||!0===this._includeOtherFormula(e)||!0==(s=this._currentConfigService,!!(null!=t&&iM(t,s))))return!0;let l=null==(n=null==(r=this._currentConfigService.getExcludedRange())?void 0:r[a])?void 0:n[o];if((null==l?void 0:l.getValue(e.row,e.column))!=null)return!1;if((null==(i=this._currentConfigService.getDirtyNameMap()[a])?void 0:i[o])!=null)return!0;if(!this._updateRangeFlattenCache.has(a))return!1;let u=this._updateRangeFlattenCache.get(a);if(!u.has(o))return!1;for(let t of u.get(o))if(e.inRangeData(t))return!0;return!1}_calculateRunList(e){e.length;let t=[],r=[];for(;e.length>0;){let n=e.pop();if(!(void 0===n||n.isSkip())){if(n.isAdded()){t.push(n),n.setSkip();continue}for(let e of(r.length=0,n.parents)){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||n.isSkip()||r.push(t)}for(let e of this._dependencyRTreeCacheForAddressFunction.bulkSearch(n.toRTreeItem())){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||n.isSkip()||r.push(t)}0===r.length?(t.push(n),n.setSkip()):(n.setAdded(),e.push(n,...r))}}return t}};sT=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sN(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sS(0,tJ),sS(1,iE),sS(2,sy),sS(3,sC),sS(4,(0,B.Inject)(iG)),sS(5,(0,B.Inject)(sd)),sS(6,(0,B.Inject)(t2)),sS(7,sf)],sT);var sw=Object.getOwnPropertyDescriptor,sM=(e,t)=>(r,n)=>t(r,n,e);let sO=500,sx=(0,B.createIdentifier)("engine-formula.calculate-formula.service"),sU=class extends j.Disposable{constructor(e,t,r,n,i,s,a){super(),J(this,"_executionInProgressListener$",new(0,X.Subject)),J(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),J(this,"_executionCompleteListener$",new(0,X.Subject)),J(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),J(this,"_executeLock",new(0,j.AsyncLock)),this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=n,this._formulaDependencyGenerator=i,this._interpreter=s,this._astTreeBuilder=a}dispose(){super.dispose(),this._executionInProgressListener$.complete(),this._executionCompleteListener$.complete(),n4.clear(),tW.clear(),rl.clear(),nZ.clear()}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(iC.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();let t=e.maxIteration||1;this._executeLock.acquire("FORMULA_EXECUTION_LOCK",async()=>{for(let e=0;e<t&&(this._runtimeService.setFormulaCycleIndex(e),await this._executeStep(),n4.clear(),this._runtimeService.isCycleDependency());e++);this._runtimeService.setFormulaExecuteStage(iC.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),tW.clear(),this._runtimeService.reset()})}async _executeStep(){let e=await this._apply();if(null==e)return;let{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:n,excludedCell:i}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return null==n||0===n.length||(this._currentConfigService.loadDirtyRangesAndExcludedCell(n,i),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){let r=[],n={};return Object.keys(e).forEach(t=>{let i=e[t];if(null==i)return!0;Object.keys(i).forEach(e=>{let s=new(0,j.ObjectMatrix)(i[e]);if(null==s)return!0;let a=new(0,j.ObjectMatrix);s.forValue((n,i,s)=>{a.setValue(n,i,!0),r.push({unitId:t,sheetId:e,range:s})}),null==n[t]&&(n[t]={}),n[t][e]=a})}),Object.keys(t).forEach(e=>{let n=t[e];Object.keys(n).forEach(e=>{let t=n[e];if(null==t)return!0;Object.keys(t).forEach(n=>{let i=t[n];if(null==i)return!0;for(let t of i)r.push({unitId:e,sheetId:n,range:t})})})}),{dirtyRanges:r,excludedCell:n}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(iC.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(iC.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let t=(await this._formulaDependencyGenerator.generate()).reverse(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(iC.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(iC.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let n=[],i=this._configService.getConfig(tG),s=(null==i?void 0:i.intervalCount)||sO,a=t.length;for(let i=0;i<a;i++){let a,o=t[i],l=o.nodeData,u=o.getDirtyData;if(i%s==0&&(await new Promise(e=>{let t=(0,j.requestImmediateMacroTask)(e);n.push(t)}),e?(this._runtimeService.setFormulaExecuteStage(iC.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(i+1)):(this._runtimeService.setFormulaExecuteStage(iC.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(i+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||null==l&&null==u)){this._runtimeService.setFormulaExecuteStage(iC.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}if(this._runtimeService.setCurrent(o.row,o.column,o.rowCount,o.columnCount,o.subUnitId,o.unitId),null!=u&&null!=o.featureId){let{runtimeCellData:e,dirtyRanges:t}=u(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(o.featureId,e),this._runtimeService.setRuntimeFeatureRange(o.featureId,t)}else null!=l&&(a=r.checkAsyncNode(l.node)?await r.executeAsync(l):r.execute(l),null!=o.formulaId?this._runtimeService.setRuntimeOtherData(o.formulaId,o.refOffsetX,o.refOffsetY,a):this._runtimeService.setRuntimeData(a))}return n.forEach(e=>e()),n=[],a>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){let r=this._lexer.treeBuilder(e,t);if(Object.values(ea).includes(r))return iN.create(r);let n=this._astTreeBuilder.parse(r);null==n||n.serialize()}};sU=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sw(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sM(0,j.IConfigService),sM(1,(0,B.Inject)(t2)),sM(2,tJ),sM(3,iE),sM(4,sv),sM(5,(0,B.Inject)(iG)),sM(6,(0,B.Inject)(sd))],sU);var sD=Object.getOwnPropertyDescriptor,sV=(e,t)=>(r,n)=>t(r,n,e);let sL=class extends j.Disposable{constructor(e,t,r){super(),this._commandService=e,this._calculateFormulaService=t,this._formulaDataModel=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tf.id)this._calculateFormulaService.stopFormulaExecution();else if(e.id===tg.id)this._calculate(e.params);else if(e.id===eX.id){let t=e.params;if(null==t)return;let{arrayFormulaRange:r,arrayFormulaCellData:n}=t;this._formulaDataModel.setArrayFormulaRange(r),this._formulaDataModel.setArrayFormulaCellData(n)}}))}async _calculate(e){let{forceCalculation:t=!1,dirtyRanges:r=[],dirtyNameMap:n={},dirtyDefinedNameMap:i={},dirtyUnitFeatureMap:s={},dirtyUnitOtherFormulaMap:a={},clearDependencyTreeCache:o={},maxIteration:l=1,rowData:u}=e,c=this._formulaDataModel.getFormulaData(),h=this._formulaDataModel.getArrayFormulaCellData(),d=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:c,arrayFormulaCellData:h,arrayFormulaRange:d,forceCalculate:t,dirtyRanges:r,dirtyNameMap:n,dirtyDefinedNameMap:i,dirtyUnitFeatureMap:s,dirtyUnitOtherFormulaMap:a,clearDependencyTreeCache:o,maxIteration:l,rowData:u})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(e=>{let t=e.functionsExecutedState;switch(t){case i_.NOT_EXECUTED:case i_.STOP_EXECUTION:break;case i_.SUCCESS:this._applyResult(e);case i_.INITIAL:}this._commandService.executeCommand(tp.id,{functionsExecutedState:t},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(e=>{this._commandService.executeCommand(tp.id,{stageInfo:e},{onlyLocal:!0})})}async _applyResult(e){let{unitData:t,unitOtherData:r,arrayFormulaRange:n,arrayFormulaCellData:i,clearArrayFormulaCellData:s}=e;if(!t)return void console.error("No sheetData from Formula Engine!");n&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(s),this._formulaDataModel.mergeArrayFormulaCellData(i),this._formulaDataModel.mergeArrayFormulaRange(n),this._commandService.executeCommand(eX.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(tC.id,{unitData:function(e){let t={};for(let r in e){let n=e[r];if(null!=n)for(let e in null==t[r]&&(t[r]={}),n){let i=n[e],s={};i.forValue((e,t,r)=>{void 0===s[e]&&(s[e]={}),s[e][t]=r}),t[r][e]=s}}return t}(t),unitOtherData:r},{onlyLocal:!0})}};sL=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?sD(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([sV(0,j.ICommandService),sV(1,sx),sV(2,(0,B.Inject)(tk))],sL);let sP=/[\[\]]/g;function sF(e,t){return sP.test(e)?t+Number(e.replace(sP,"")):Number(e)-1}function sk(e,t=0,r=0){let n=(e=e.toLocaleUpperCase()).split(/[RC]/),i=n[1],s=n[2];return{row:sF(i,t),column:sF(s,r),absoluteRefType:j.AbsoluteRefType.NONE}}function sj(e,t=0,r=0){let{refBody:n,sheetName:i,unitId:s}=e4(e),a=n.indexOf(":");if(-1===a){let e=sk(n,t,r),a=e.row,o=e.column,l=e.absoluteRefType;return{unitId:s,sheetName:i,range:{startRow:a,startColumn:o,endRow:a,endColumn:o,startAbsoluteRefType:l,endAbsoluteRefType:l}}}let o=n.substring(0,a),l=n.substring(a+1),u=sk(o,t,r),c=sk(l,t,r),h=u.row,d=u.column;return{unitId:s,sheetName:i,range:{startRow:h,startColumn:d,endRow:c.row,endColumn:c.column,startAbsoluteRefType:u.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}function sB(e,t=j.AbsoluteRefType.ALL,r){switch(e+=1,t){case j.AbsoluteRefType.ALL:return`${e}`;case j.AbsoluteRefType.ROW:return r?`${e}`:`[${e}]`;case j.AbsoluteRefType.COLUMN:return r?`[${e}]`:`${e}`;case j.AbsoluteRefType.NONE:return`[${e}]`}}function s$(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return ru.create(ea.VALUE);t=e.get(0,0)}return t.isError(),t}function sH(...e){for(let t=0;t<e.length;t++){let r=s$(e[t]);if(r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}function sW(...e){for(let t=0;t<e.length;t++){let r=s$(e[t]);if(r.isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sG(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return{isError:!0,errorObject:r};if(r.isNull())return{isError:!0,errorObject:ru.create(ea.NA)};if((r=s$(e[t])).isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE)};e[t]=r}return{isError:!1,variants:e}}function sY(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}class sz{constructor(e){J(this,"_unitId"),J(this,"_subUnitId"),J(this,"_row",-1),J(this,"_column",-1),J(this,"_definedNames"),J(this,"_locale"),J(this,"_sheetOrder"),J(this,"_sheetNameMap"),J(this,"_formulaDataModel"),J(this,"_rowCount",-1),J(this,"_columnCount",-1),J(this,"needsExpandParams",!1),J(this,"needsReferenceObject",!1),J(this,"needsLocale",!1),J(this,"needsSheetsInfo",!1),J(this,"needsFormulaDataModel",!1),J(this,"needsSheetRowColumnCount",!1),J(this,"needsFilteredOutRows",!1),J(this,"minParams",-1),J(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(e){var t;let r=this._definedNames;return null==r?null:null==(t=Array.from(Object.values(r)).filter(t=>t.name===e))?void 0:t[0]}setDefinedNames(e){this._definedNames=e}getLocale(){return this._locale}setLocale(e){this._locale=e}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:e,sheetNameMap:t}){this._sheetOrder=e,this._sheetNameMap=t}setFormulaDataModel(e){this._formulaDataModel=e}setSheetRowColumnCount(e,t){this._rowCount=e,this._columnCount=t}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}setRefInfo(e,t,r,n){this._unitId=e,this._subUnitId=t,this._row=r,this._column=n}calculateCustom(...e){return null}calculate(...e){return ru.create(ea.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return!1===r.getValue()?ru.create(ea.VALUE):t;if(r.isString()){let e=Number(r.getValue());return Number.isNaN(e)?ru.create(ea.REF):e}return r.isNumber()?r.getValue():ru.create(ea.VALUE)}getZeroOrOneByOneDefault(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;e.isNumber()&&0===e.getValue()&&(t=0)}return t}getMatchTypeValue(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;if(e.isNumber()){let r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,n,i){let s,a=t.binarySearch(e,n,i);return null==a?ru.create(ea.NA):(s=1===r.getRowCount()?r.get(0,a)||nX.create():r.get(a,0)||nX.create()).isNull()?nQ.create(0):s}_getOneFirstByRaw(e){return 0===e.length?ru.create(ea.NA):e[0][0]||ru.create(ea.NA)}_getOneLastByRaw(e){return 0===e.length?ru.create(ea.NA):e[e.length-1][e[0].length-1]||ru.create(ea.NA)}equalSearch(e,t,r,n=!0){let i=r.pickRaw(t.isEqual(e));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}fuzzySearch(e,t,r,n=!0){let i=r.pickRaw(t.compare(e,eh.EQUALS));return n?this._getOneFirstByRaw(i):this._getOneLastByRaw(i)}orderSearch(e,t,r,n=rh.MIN,i=!1){let s=t.orderSearch(e,n,i);if(null==s)return ru.create(ea.NA);let a=r.get(s.row,s.column)||nX.create();return a.isNull()?ru.create(ea.NA):a}binarySearchExpand(e,t,r,n=0,i,s){let a=t.binarySearch(e,i,s);return null==a?ru.create(ea.NA):0===n?r.slice([a,a+1]):r.slice(void 0,[a,a+1])}equalSearchExpand(e,t,r,n=!0,i=0){let s,a=t.isEqual(e);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?ru.create(ea.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}fuzzySearchExpand(e,t,r,n=!0,i=0){let s,a=t.compare(e,eh.EQUALS);return null==(s=n?a.getFirstTruePosition():a.getLastTruePosition())?ru.create(ea.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}orderSearchExpand(e,t,r,n=rh.MIN,i=!1,s=0){let a=t.orderSearch(e,n,i);return null==a?ru.create(ea.NA):0===s?r.slice([a.row,a.row+1]):r.slice(void 0,[a.column,a.column+1])}flattenArray(e,t=!0){let r=[];r[0]=[];for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean()||i.isNull())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){let e;if(i.iterator(n=>!!(null==n||n.isNull()||t&&(n.isString()||n.isBoolean()))||((n=this._includingLogicalValuesAndText(n)).isError()?(e=n,!1):void r[0].push(n))),null!=e&&e.isError())return e}else r[0].push(i)}return is(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=function(e){let t=e.getValue(),r=0;return t&&(r=1),nQ.create(r)}(e)),e.isString()){let t=Number(e.getValue());e=nQ.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){let r,n=e.getForcedUnitId(),i=e.getForcedSheetId()||"",s=e5({unitId:n,sheetName:e.getForcedSheetName(),range:t});return r=eB(s)?new ie(s):eW(s)?new ir(s):eG(s)?new it(s):new n7(t,i,n),this._setReferenceDefault(e,r)}_setReferenceDefault(e,t){return null==this.unitId||null==this.subUnitId?ru.create(ea.REF):(t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(e.getRuntimeArrayFormulaCellData()),t)}}var sX=((A=sX||{}).ARRAY_CONSTRAIN="ARRAY_CONSTRAIN",A.FLATTEN="FLATTEN",A);let sq=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;let{isError:n,errorObject:i,variants:s}=sH(t,r);if(n)return i;let{isError:a,errorObject:o,variants:l}=sY(...s);if(a)return o;let[u,c]=l,h=Math.floor(+u.getValue()),d=Math.floor(+c.getValue());if(h<0||d<0)return ru.create(ea.NUM);if(0===h||0===d)return ru.create(ea.REF);let m=e.isArray()?e.getRowCount():1,g=e.isArray()?e.getColumnCount():1;return 1===m&&1===g?e.isArray()?e.get(0,0):e:e.slice([0,h>m?m:h],[0,d>g?g:d])}},sX.ARRAY_CONSTRAIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r],i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<i;e++)for(let r=0;r<s;r++){let i=n.isArray()?n.get(e,r):n;t.push([i])}}return n5.create({calculateValueList:t,rowCount:t.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},sX.FLATTEN]];function sK(e){return/^[01]{1,10}$/.test(e)}function sQ(e){return/^[0-7]{1,10}$/.test(e)}function sZ(e){return/^[0-9A-Fa-f]{1,10}$/.test(e)}function sJ(e){if(0===e)return 0;let t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-946595344482036e-18,366839497852761e-18,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],r=e,n=!1;r<0&&(r=-r,n=!0);let i=2/(2+r),s=4*i-2,a=0,o=0,l;for(let e=t.length-1;e>0;e--)l=a,a=s*a-o+t[e],o=l;let u=i*Math.exp(-r*r+.5*(t[0]+s*a)-o);return n?u-1:1-u}function s0(e,t=1){let r=Math.floor(e);if(e<0)return Number.NaN;let n=1;for(;r>1&&Number.isFinite(n);)n*=r,r-=t;return n}function s1(e,t){let r=Math.min(e-t,t),n=1;for(let t=1;t<=r&&Number.isFinite(n);t++)n*=e-t+1,n/=t;return n}function s2(e,t){let r=Math.floor(e),n=Math.floor(t);for(;0!==n;){let e=n;n=r%n,r=e}return r}function s5(e,t){let r=s2(e,t);return 0===r?0:Math.abs(e*t)/r}function s3(e){let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let{rowSwap:r,smallPivotDetected:n,luMatrix:i,permutation:s}=s9(e);if(n)return 0;let a=r?1:-1;for(let e=0;e<s.length;e++)a*=i[e][e];return 0===a?0:a}function s4(e,t){return e.map(e=>t[0].map((r,n)=>e.reduce((e,r,i)=>e+r*t[i][n],0)))}function s6(e){return e[0].map((t,r)=>e.map(e=>e[r]))}function s9(e){let t=s6(e),r=t.length,n=t[0].length,i=!0,s=!1,a=s8(r,n,0),o=Array(n).fill(0).map((e,t)=>t);for(let e=0;e<n;e++){for(let r=0;r<e;r++){let n=t[r][e];for(let t=0;t<r;t++)n-=a[r][t]*a[t][e];a[r][e]=n}let n=-1/0,l=e;for(let i=e;i<r;i++){let r=t[i][e];for(let t=0;t<e;t++)r-=a[i][t]*a[t][e];a[i][e]=r;let s=Math.abs(r);s>n&&(n=s,l=i)}if(1e-11>Math.abs(a[l][e])){s=!0;break}l!==e&&([a[e],a[l]]=[a[l],a[e]],[t[e],t[l]]=[t[l],t[e]],[o[e],o[l]]=[o[l],o[e]],i=!i);let u=a[e][e];for(let t=e+1;t<r;t++)a[t][e]/=u}return{rowSwap:i,smallPivotDetected:s,luMatrix:a,permutation:o}}function s8(e,t,r){let n=[];for(let i=0;i<e;i++){n[i]=[];for(let e=0;e<t;e++)n[i].push(r)}return n}function s7(e,t){let r=0;return Math.abs(e)>Math.abs(t)?(r=t/e,Math.abs(e)*Math.sqrt(1+r*r)):0!==t?(r=e/t,Math.abs(t)*Math.sqrt(1+r*r)):0}function ae(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[a][n]*e[a][i];return s}function at(e,t,r,n,i){let s=0;for(let a=t;a<r;a++)s+=e[n][a]*e[i][a];return s}(e=>{function t(e,t){let r=0;for(let n=0;n<e.length;++n)r=t*r+e[n];return r}function r(e,t,r,n,i){if(0===t)return r;if(1===t)return n;let s=2/e,a=r,o=n,l=n;for(let e=1;e<t;++e)l=o*e*s+i*a,a=o,o=l;return l}function n(e,t,n,i){return function(s,a){if(n){if(0===s)return 1===n?-1/0:1/0;if(s<0)return Number.NaN}if(0===a)return e(s);if(1===a)return t(s);if(a<0)return Number.NaN;let o=e(s),l=t(s);return r(s,0|a,o,l,i)}}e.besselj=(()=>{let e=[-184.9052456,77392.33017,-11214424.18,651619640.7,-0x31c78f292,0xd6759744e],n=[1,267.8532712,59272.64853,9494680.718,0x3d5d6d39,0xd675973ab],i=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],s=[-934935152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function a(r){let a=0,o=0,l=0,u=r*r;if(r<8)a=(o=t(e,u))/t(n,u);else{let e=r-.785398164;a=Math.sqrt(.636619772/r)*(Math.cos(e)*(o=t(i,u=64/u))-Math.sin(e)*t(s,u)*8/r)}return a}let o=[-30.16036606,15704.4826,-2972611.439,242396853.1,-0x1d6950b23,0x10d925ddd8],l=[1,376.9991397,99447.43394,18583304.74,0x891f618a,0x21b24bbb9a],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function h(e){let r=0,n=0,i=0,s=e*e,a=Math.abs(e)-2.356194491;return 8>Math.abs(e)?r=(n=e*t(o,s))/t(l,s):(r=Math.sqrt(.636619772/Math.abs(e))*(Math.cos(a)*(n=t(u,s=64/s))-Math.sin(a)*t(c,s)*8/Math.abs(e)),e<0&&(r=-r)),r}return function e(t,n){let i=Math.round(n);if(!Number.isFinite(t))return Number.isNaN(t)?t:0;if(i<0)return(i%2?-1:1)*e(t,-i);if(t<0)return(i%2?-1:1)*e(-t,i);if(0===i)return a(t);if(1===i)return h(t);if(0===t)return 0;let s=0;if(t>i)s=r(t,i,a(t),h(t),-1);else{let e=2*Math.floor((i+Math.floor(Math.sqrt(40*i)))/2),r=!1,n=0,a=0,o=1,l=0,u=2/t;for(let t=e;t>0;t--)if(l=t*u*o-n,n=o,Math.abs(o=l)>1e10&&(o*=1e-10,n*=1e-10,s*=1e-10,a*=1e-10),r&&(a+=o),r=!r,t===i&&(s=n),e-t>100&&0===s)return Number.NaN;s/=a=2*a-o}return s}})(),e.bessely=(()=>{let r=[228.4622733,-86327.92757,10879881.29,-512359803.6,0x1a4fa4b91,-0xb04cc5cd],i=[1,226.1030244,47447.2647,7189466.438,745249964.8,0x954bf890d],s=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],a=[-934945152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995],o=[8511.937935,-4237922.726,734926455.1,-0xbffb0414e,127527439e4,-4900604943e3],l=[1,354.9632885,102042.605,22459040.02,0xde8afbbf,0x62d2b66f40,249958057e5],u=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];return n(function(n){let o=0,l=0,u=0,c=n*n,h=n-.785398164;return n<8?(l=t(r,c))/t(i,c)+.636619772*(0,e.besselj)(n,0)*Math.log(n):Math.sqrt(.636619772/n)*(Math.sin(h)*(l=t(s,c=64/c))+Math.cos(h)*t(a,c)*8/n)},function(r){let n=0,i=0,s=0,a=r*r,h=r-2.356194491;return r<8?(i=r*t(o,a))/t(l,a)+.636619772*((0,e.besselj)(r,1)*Math.log(r)-1/r):Math.sqrt(.636619772/r)*(Math.sin(h)*(i=t(u,a=64/a))+Math.cos(h)*t(c,a)*8/r)},1,-1)})(),e.besseli=(()=>{let e=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],r=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228],n=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],i=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];return function s(a,o){let l=Math.round(o);if(0===l)return a<=3.75?t(e,a*a/14.0625):Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(r,3.75/Math.abs(a));if(1===l)return a<3.75?a*t(n,a*a/14.0625):(a<0?-1:1)*Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(i,3.75/Math.abs(a));if(l<0)return Number.NaN;if(0===Math.abs(a))return 0;if(a===1/0)return 1/0;let u=0,c,h=2/Math.abs(a),d=0,m=1,g=0,f=2*Math.round((l+Math.round(Math.sqrt(40*l)))/2);for(c=f;c>0;c--)if(g=c*h*m+d,d=m,Math.abs(m=g)>1e10&&(m*=1e-10,d*=1e-10,u*=1e-10),c===l&&(u=d),f-c>100&&0===u)return Number.NaN;return u*=s(a,0)/m,a<0&&l%2?-u:u}})(),e.besselk=(()=>{let r=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],i=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414],s=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],a=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];return n(function(n){return n<=2?-Math.log(n/2)*(0,e.besseli)(n,0)+t(r,n*n/4):Math.exp(-n)/Math.sqrt(n)*t(i,2/n)},function(r){return r<=2?Math.log(r/2)*(0,e.besseli)(r,1)+1/r*t(s,r*r/4):Math.exp(-r)/Math.sqrt(r)*t(a,2/r)},2,1)})()})(F||(F={}));let ar=new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),an=new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),ai=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function as(e,t,r){return e<=0?0:e>=1?1:ao(e,t,r)}function aa(e,t,r){let n,i,s;if(e<=0)return 0;if(e>=1)return 1;if(t>=1&&r>=1){let i=Math.sqrt(-2*Math.log(e<.5?e:1-e));n=(2.30753+.27061*i)/(1+i*(.99229+.04481*i))-i,e<.5&&(n=-n);let s=(n*n-3)/6,a=2/(1/(2*t-1)+1/(2*r-1)),o=n*Math.sqrt(s+a)/a-(1/(2*r-1)-1/(2*t-1))*(s+5/6-2/(3*a));n=t/(t+r*Math.exp(2*o))}else{let i=Math.exp(t*Math.log(t/(t+r)))/t,s=i+Math.exp(r*Math.log(r/(t+r)))/r;n=e<i/s?(t*s*e)**(1/t):1-(r*s*(1-e))**(1/r)}let a=-ac(t,r);for(let o=0;o<10&&!(0===n||1===n||(s=(ao(n,t,r)-e)/(i=Math.exp((t-1)*Math.log(n)+(r-1)*Math.log(1-n)+a)),(n-=i=s/(1-.5*Math.min(1,s*((t-1)/n-(r-1)/(1-n)))))<=0&&(n=.5*(n+i)),n>=1&&(n=.5*(n+i+1)),Math.abs(i)<1e-8*n&&o>0));o++);return n}function ao(e,t,r){let n=0===e||1===e?0:Math.exp(ay(t+r)-ay(t)-ay(r)+t*Math.log(e)+r*Math.log(1-e));return e<(t+1)/(t+r+2)?n*al(e,t,r)/t:1-n*al(1-e,r,t)/r}function al(e,t,r){let n=1-(t+r)*e/(t+1);1e-8>Math.abs(n)&&(n=1e-8);let i=1,s=n=1/n;for(let a=1;a<=100;a++){let o=a*(r-a)*e/((t-1+2*a)*(t+2*a));if(1e-8>Math.abs(n=1+o*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n=1+(o=-(t+a)*(t+r+a)*e/((t+2*a)*(t+1+2*a)))*n)&&(n=1e-8),1e-8>Math.abs(i=1+o/i)&&(i=1e-8),s*=(n=1/n)*i,1e-8>Math.abs(n*i-1))break}return s}function au(e,t){return e+t>170?Math.exp(ac(e,t)):a_(e)*a_(t)/a_(e+t)}function ac(e,t){return ay(e)+ay(t)-ay(e+t)}function ah(e,t,r){if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return Number.NaN;let n=0;for(let i=0;i<=e;i++)n+=ad(i,t,r);return n}function ad(e,t,r){return 0===r||1===r?+(t*r===e):s1(t,e)*r**e*(1-r)**(t-e)}function am(e,t){return e<=0?0:aE(t/2,e/2)}function ag(e,t){return e<=0?0:e>=1?1/0:2*aR(e,t/2)}function af(e,t,r){return e<0?0:ao(t*e/(t*e+r),t/2,r/2)}function ap(e,t,r){return e<=0?0:e>=1?1/0:r/(t*(1/aa(e,t/2,r/2)-1))}function aC(e,t,r){let n=t.length,i=0,s=0;for(let e=0;e<n;e++)i+=t[e],s+=r[e];let a=i/n,o=s/n,l=0,u=0;for(let e=0;e<n;e++)l+=(t[e]-a)*(r[e]-o),u+=(r[e]-o)**2;if(0===u)return 1/0;let c=l/u;return a-c*o+c*e}function a_(e){let t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],n=0,i=e;if(e>171.6243769536076)return 1/0;if(i<=0){let e=i%1+36e-17;if(!e)return 1/0;n=(1&i?-1:1)*Math.PI/Math.sin(Math.PI*e),i=1-i}let s=i,a=0,o;o=i<1?i++:(i-=a=(0|i)-1)-1;let l=0,u=0;for(let e=0;e<8;++e)l=(l+t[e])*o,u=u*o+r[e];let c=l/u+1;if(s<i)c/=s;else if(s>i)for(let e=0;e<a;++e)c*=i,i++;return n&&(c=n/c),c}function ay(e){let t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=e,n=e+5.5;n-=(e+.5)*Math.log(n);let i=1.000000000190015;for(let e=0;e<6;e++)i+=t[e]/++r;return-n+Math.log(2.5066282746310007*i/e)}function aE(e,t){if(t<0||e<=0)return Number.NaN;let r=-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17),n=ay(e),i=Math.exp(-t+e*Math.log(t)-n),s=e,a=1/e,o=a;if(t<e+1){if(0===i)return 0;for(let e=1;e<=r&&(a+=o*=t/++s,!(Math.abs(o)<1e-30*Math.abs(a)));e++);return a*i}if(0===i)return 1;let l=t+1-e,u=9999999999999999e14,c=1/l,h=c;for(let t=1;t<=r;t++){let r=-t*(t-e);if(l+=2,1e-30>Math.abs(c=r*c+l)&&(c=1e-30),1e-30>Math.abs(u=l+r/u)&&(u=1e-30),h*=(c=1/c)*u,1e-30>Math.abs(c*u-1))break}return 1-h*i}function aR(e,t){let r,n,i;if(e<=0)return 0;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(t>1){let n=Math.sqrt(-2*Math.log(e<.5?e:1-e));r=(2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n,e<.5&&(r=-r),r=Math.max(.001,t*(1-1/(9*t)-r/(3*Math.sqrt(t)))**3)}else{let n=1-t*(.253+.12*t);r=e<n?(e/n)**(1/t):1-Math.log(1-(e-n)/(1-n))}let s=ay(t);for(let a=0;a<12;a++){if(r<=0)return 0;if(n=aE(t,r)-e,0!==(i=t>1?Math.exp((t-1)*(Math.log(t-1)-1)-s)*Math.exp(-(r-(t-1))+(t-1)*(Math.log(r)-Math.log(t-1))):Math.exp(-r+(t-1)*Math.log(r)-s))&&(i=n/i/(1-.5*Math.min(1,n/i*((t-1)/r-1)))),(r-=i)<=0&&(r=.5*(r+i)),Math.abs(i)<1e-8*r)break}return r}function ab(e,t,r,n){return t-e>n-r?0:s1(r,e)*s1(n-r,t-e)/s1(n,t)}function aI(e,t,r){return e<0?0:.5+.5*sJ((Math.log(e)-t)/Math.sqrt(2*r*r))}function aN(e,t,r){return e<0?0:s1(e+t-1,t-1)*r**t*(1-r)**e}function aS(e,t,r){return .5*(1+sJ((e-t)/Math.sqrt(2*r*r)))}function aA(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-(e-t)**2/(2*r*r))}function av(e,t,r){return -1.4142135623730951*r*function(e){if(e>=2)return -100;if(e<=0)return 100;let t=e<1?e:2-e,r=Math.sqrt(-2*Math.log(t/2)),n=-.70711*((2.30753+.27061*r)/(1+r*(.99229+.04481*r))-r);for(let e=0;e<2;e++){let e=1-sJ(n)-t;n+=e/(1.1283791670955126*Math.exp(-n*n)-n*e)}return e<1?n:-n}(2*e)+t}function aT(e,t){return Math.exp(-t)*t**e/s0(e)}function aw(e,t){let r=.5*ao(t/(e**2+t),t/2,.5);return e<0?r:1-r}function aM(e,t){let r=aa(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}function aO(e,t,r,n,i){let s=[],a=[],o=!0;for(let l=0;l<r;l++){let r=Math.floor(l/n),u=l%n,c=Math.floor(l/i),h=l%i,d=e.isArray()?e.get(r,u):e,m=t.isArray()?t.get(c,h):t;if(d.isError())return{isError:!0,errorObject:d,array1Values:s,array2Values:a,noCalculate:o};if(m.isError())return{isError:!0,errorObject:m,array1Values:s,array2Values:a,noCalculate:o};if(d.isNull()||m.isNull()||d.isBoolean()||m.isBoolean())continue;let g=d.getValue(),f=m.getValue();(0,j.isRealNum)(g)&&(0,j.isRealNum)(f)&&(s.push(+g),a.push(+f),o=!1)}return{isError:!1,errorObject:null,array1Values:s,array2Values:a,noCalculate:o}}function ax(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=n,a=i;if(t&&!t.isNull()&&(s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,1===n&&a!==i||1===i&&s!==n||1!==n&&1!==i&&(s!==n||a!==i)))return{isError:!0,errorObject:ru.create(ea.REF)};if(r&&!r.isNull()){let e=r.isArray()?r.getRowCount():1,t=r.isArray()?r.getColumnCount():1;if(1===n&&s>1&&e!==s||1===i&&a>1&&t!==a)return{isError:!0,errorObject:ru.create(ea.REF)}}return{isError:!1,errorObject:null}}function aU(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){n[i]=[];for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError()||r.isNull()||r.isBoolean()||r.isString())return ru.create(ea.VALUE);n[i].push(+r.getValue())}}return n}function aD(e,t){let r=[],n=1;for(let i=0;i<e;i++){r[i]=[];for(let e=0;e<t;e++)r[i].push(n++)}return r}function aV(e,t,r,n){let i,s,a=t;return n&&(a=t.map(e=>Math.log(e))),r?{slope:i,intercept:s}=function(e,t){let r=t.length,n=0,i=0,s=0,a=0;for(let o=0;o<r;o++)n+=e[o],i+=t[o],s+=e[o]*e[o],a+=e[o]*t[o];let o=(r*a-n*i)/(r*s-n*n),l=1/r*i-1/r*o*n;return{slope:o,intercept:l}}(e,a):{slope:i,intercept:s}=function(e,t){let r=[[...e]],n=[...t],i=r.length,s=r[0].length,a=Math.min(i,s),o=Array(a).fill(0);for(let e=0;e<a;e++){let t=r[e],n=0;for(let e=0;e<s;e++)n+=t[e]**2;let a=t[e]<0?Math.sqrt(n):-Math.sqrt(n);if(o[e]=a,0!==a){t[e]-=a;for(let n=e+1;n<i;n++){let i=0;for(let a=e;a<s;a++)i-=r[n][a]*t[a];i/=a*t[e];for(let a=e;a<s;a++)r[n][a]-=i*t[a]}}}a=Math.min(i=r.length,s=r[0].length);let l=Array(i).fill(0);for(let e=0;e<a;e++){let t=r[e],i=0;for(let e=0;e<s;e++)i+=n[e]*t[e];i/=o[e]*t[e];for(let e=0;e<s;e++)n[e]+=i*t[e]}for(let e=o.length-1;e>=0;e--){n[e]/=o[e];let t=n[e],i=r[e];l[e]=t;for(let r=0;r<e;r++)n[r]-=t*i[r]}return{slope:l[0],intercept:0}}(e,a),n&&(i=Math.exp(i),s=Math.exp(s)),Number.isNaN(i)&&!r&&(i=0),{slope:i,intercept:s,Y:a}}function aL(e,t,r,n,i){let s=1===e.length&&e[0].length>1,a=e;i&&(a=e.map(e=>e.map(e=>Math.log(e))));let o=t,l=r;s&&(a=s6(a),o=s6(o),l=s6(l)),n&&(o=o.map(e=>[...e,1]));let u=s6(o),c=s4(u,o),h=s4(u,a),d=function(e){let{smallPivotDetected:t,luMatrix:r,permutation:n}=s9(e);return t?null:function(e,t){let r=t.length,n=s8(r,r,0);for(let e=0;e<r;e++)n[e][e]=1;let i=s8(r,r,0);for(let e=0;e<r;e++){let s=t[e];for(let t=0;t<r;t++)i[e][t]=n[s][t]}for(let t=0;t<r;t++){let n=i[t];for(let s=t+1;s<r;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}for(let t=r-1;t>=0;t--){let n=i[t],s=e[t][t];for(let e=0;e<r;e++)n[e]/=s;for(let s=0;s<t;s++){let a=e[s][t];for(let e=0;e<r;e++)i[s][e]-=n[e]*a}}return i}(r,n)}(c);if(!d&&!(d=function(e){let t=function(e){let t=s6(e),r=t.length,n=t[0].length;if(r<n)return null;let i=Array(n).fill(0),s=Array(n).fill(0),a=Array.from({length:n},()=>Array(n).fill(0)),o=Number.EPSILON,l=0,u=0,c=0;for(let e=0;e<n;e++){if(i[e]=l,(u=ae(t,e,r,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e]>=0&&(l=-l);let i=t[e][e]*l-u;t[e][e]-=l;for(let s=e+1;s<n;s++){u=ae(t,e,r,e,s);for(let n=e;n<r;n++)t[n][s]+=u/i*t[n][e]}}if(s[e]=l,(u=at(t,e+1,n,e,e))<=1e-64/o)l=0;else{l=Math.sqrt(u),t[e][e+1]>=0&&(l=-l);let s=t[e][e+1]*l-u;t[e][e+1]-=l;for(let r=e+1;r<n;r++)i[r]=t[e][r]/s;for(let s=e+1;s<r;s++){u=at(t,e+1,n,s,e);for(let r=e+1;r<n;r++)t[s][r]+=u*i[r]}}let a=Math.abs(s[e])+Math.abs(i[e]);a>c&&(c=a)}let h=0;for(let e=n-1;e>=0;e--){if(0!==l){for(let r=h;r<n;r++)a[r][e]=t[e][r]/(l*t[e][e+1]);for(let r=h;r<n;r++){u=0;for(let i=h;i<n;i++)u+=t[e][i]*a[i][r];for(let t=h;t<n;t++)a[t][r]+=u*a[t][e]}}for(let t=h;t<n;t++)a[e][t]=0,a[t][e]=0;a[e][e]=1,l=i[e],h=e}for(let e=n-1;e>=0;e--){l=s[e];for(let r=e+1;r<n;r++)t[e][r]=0;if(0!==l){for(let i=e+1;i<n;i++){u=ae(t,e+1,r,e,i);for(let n=e;n<r;n++)t[n][i]+=u/(t[e][e]*l)*t[n][e]}for(let n=e;n<r;n++)t[n][e]/=l}else for(let n=e;n<r;n++)t[n][e]=0;t[e][e]+=1}o*=c;let d=0,m=0,g=0;for(let e=n-1;e>=0;e--)for(let l=0;l<50;l++){let u=!1,c=e;for(;c>=0;c--){if(Math.abs(i[c])<=o){u=!0;break}if(Math.abs(s[c-1])<=o)break}if(!u){let n=0,a=1;for(let l=c;l<e+1&&(d=a*i[l],m=s[l],i[l]*=n,!(Math.abs(d)<=o));l++){g=s7(d,m),s[l]=g,n=m/g,a=-d/g;for(let e=0;e<r;e++){let r=t[e][c-1],i=t[e][l];t[e][c-1]=r*n+i*a,t[e][l]=-r*a+i*n}}}if(c===e){if(s[e]<0){s[e]=-s[e];for(let t=0;t<n;t++)a[t][e]=-a[t][e]}break}if(l>=49)return null;let h=s[c];g=s7(d=((s[e-1]-s[e])*(s[e-1]+s[e])+(i[e-1]-i[e])*(i[e-1]+i[e]))/(2*i[e]*s[e-1]),1),d=d<0?((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d-g)-i[e]))/h:((h-s[e])*(h+s[e])+i[e]*(s[e-1]/(d+g)-i[e]))/h;let f=1,p=1;for(let o=c+1;o<e+1;o++){let e=i[o],l=s[o];m=p*e,e*=f,g=s7(d,m),i[o-1]=g,d=h*(f=d/g)+e*(p=m/g),m=l*p,e=-h*p+e*f,l*=f;for(let e=0;e<n;e++){let t=a[e][o-1],r=a[e][o];a[e][o-1]=t*f+r*p,a[e][o]=-t*p+r*f}g=s7(d,m),s[o-1]=g,d=(f=d/g)*e+(p=m/g)*l,h=-p*e+f*l;for(let e=0;e<r;e++){let r=t[e][o-1],n=t[e][o];t[e][o-1]=r*f+n*p,t[e][o]=-r*p+n*f}}i[c]=0,i[e]=d,s[e]=h}for(let e=0;e<s.length;e++)s[e]<o&&(s[e]=0);for(let e=0;e<n;e++)for(let r=e-1;r>=0;r--)if(s[r]<s[e]){let n=s[r];s[r]=s[e],s[e]=n;for(let n=0;n<t.length;n++){let i=t[n][e];t[n][e]=t[n][r],t[n][r]=i}for(let t=0;t<a.length;t++){let n=a[t][e];a[t][e]=a[t][r],a[t][r]=n}e=r}return{matrixU:t,matrixS:s,matrixV:a}}(e);if(!t)return null;let{matrixU:r,matrixS:n,matrixV:i}=t,s=s6(r),a=Array.from({length:n.length},()=>Array(e[0].length).fill(0)),o=Math.max(e.length,e[0].length)*Number.EPSILON*n[0];for(let e=0;e<n.length;e++)Math.abs(n[e])>o&&(a[e][e]=1/n[e]);return s4(i,s4(a,s))}(c)))return ru.create(ea.NA);let m=s4(d,h);n||m.push([0]);let g=(m=s6(m))[0].pop();if(m[0].reverse(),m[0].push(g),i)for(let e=0;e<m[0].length;e++)m[0][e]=Math.exp(m[0][e]);return{coefficients:m,Y:a,X:o,newX:l,XTXInverse:d}}class aP extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(1);s.isNull()&&(s=nQ.create(0)),a.isNull()&&(a=nQ.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sY(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<=0||m>=1||p>=C)return ru.create(ea.NUM);let _=aa(m,g,f)*(C-p)+p;return nQ.create(_)}}class aF extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||d>m||g<0||g>1?ru.create(ea.NUM):(i=f?ah(d,m,g):ad(d,m,g),nQ.create(i))}}class ak extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=+o.getValue(),h=+l.getValue();if(u<0||c<=0||c>=1||h<=0||h>=1)return ru.create(ea.NUM);let d=0;for(;d<=u&&!(ah(d,u,c)>=h);)d++;return nQ.create(d)}}class aj extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return ru.create(ea.NUM);let u=1-am(o,l);return nQ.create(u)}}class aB extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return ru.create(ea.NUM);let u=ag(1-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}}class a$ extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ru.create(ea.VALUE):ru.create(ea.NA);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h,r,n)}_getResult(e,t,r,n){let i=0;for(let r=0;r<e.length;r++){if(0===t[r])return ru.create(ea.DIV_BY_ZERO);i+=(e[r]-t[r])**2/t[r]}let s=(r-1)*(n-1);1===r?s=n-1:1===n&&(s=r-1);let a=1-am(i,s);return nQ.create(a)}}class aH extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sY(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return ru.create(ea.NUM);let p=Math.abs(av(m/2,0,1)*g/Math.sqrt(f));return nQ.create(p)});return 1===n&&1===i?l.get(0,0):l}}class aW extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ru.create(ea.VALUE);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return ru.create(ea.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nQ.create(o/r)}}class aG extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sY(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=+l.getValue(),d=+u.getValue();return c<0||h<=0?ru.create(ea.NUM):(d?n=c<0?0:1-Math.exp(-h*c):n=c<0?0:h*Math.exp(-h*c),nQ.create(n))}}class aY extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>1e10)return ru.create(ea.NUM);let d=1-af(u,c,h);return nQ.create(d)}}class az extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return ru.create(ea.NUM);let d=ap(1-u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}}class aX extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variance:i,ns1:s}=this._getValues(e);if(r)return n;let{isError:a,errorObject:o,variance:l,ns1:u}=this._getValues(t);if(a)return o;let c=2*(1-af(i/l,s,u));return c>1&&(c=2-c),nQ.create(c)}_getValues(e){let t=0,r=0,n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(1===n&&1===i){let n=e.isArray()?e.get(0,0):e;return n.isError()?{isError:!0,errorObject:n,variance:t,ns1:r}:n.isNull()?{isError:!0,errorObject:ru.create(ea.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),variance:t,ns1:r}}let s=[],a=0;for(let o=0;o<n;o++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(o,n):e;if(i.isError())return{isError:!0,errorObject:i,variance:t,ns1:r};if(i.isNull()||i.isBoolean())continue;let l=i.getValue();(0,j.isRealNum)(l)&&(s.push(+l),a+=+l)}if(s.length<=1)return{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),variance:t,ns1:r};let o=a/s.length,l=0;for(let e=0;e<s.length;e++)l+=(s[e]-o)**2;return 0==(t=l/(r=s.length-1))?{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}}class aq extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<0||m<=0||g<=0?ru.create(ea.NUM):(f?i=d<=0?0:aE(m,d/g):i=d<0?0:0===d&&1===m?1/g:Math.exp((m-1)*Math.log(d)-d/g-ay(m)-m*Math.log(g)),nQ.create(i))}}class aK extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<0||u>1||c<=0||h<=0)return ru.create(ea.NUM);let d=u<=0?0:u>=1?1/0:h*aR(u,c);return Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}}class aQ extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return ru.create(ea.NUM);let d=Math.exp(av(u,c,h));return Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}}class aZ extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,j.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new ru(ea.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return nQ.create(r[0])}}class aJ extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return g<=0?ru.create(ea.NUM):(i=f?aS(d,m,g):aA(d,m,g),nQ.create(i))}}class a0 extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||u>=1||h<=0)return ru.create(ea.NUM);let d=av(u,c,h);return nQ.create(d)}}class a1 extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0||s>=1)return ru.create(ea.NUM);let a=av(s,0,1);return nQ.create(a)}}class a2 extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<0||a>1)return ru.create(ea.NUM);let l=a*(o-1),u=Math.floor(l),c=l-u;if(0===c)return nQ.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nQ.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}}class a5 extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nQ.create(3);i.isNull()&&(i=nQ.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,t,ru.create(ea.NA)),l=ii(s,a,i,ru.create(ea.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof ru)return e;let{isError:n,errorObject:i,variants:s}=sY(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return ru.create(ea.NA);if(1===c)return l===e[0]?nQ.create(1):ru.create(ea.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=m/(c-1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+(l-e[m])/(e[m+1]-e[m]))/(c-1),d=!0),m++;return d?u<1?ru.create(ea.NUM):(h=nB(h,u),nQ.create(h)):ru.create(ea.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}}class a3 extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sY(e,t,r);if(i)return s;let[o,l,u]=a,c=Math.floor(+o.getValue()),h=+l.getValue(),d=+u.getValue();return c<0||h<0?ru.create(ea.NUM):(n=d?function(e,t){let r=0;for(let n=0;n<=e;n++)r+=aT(n,t);return r}(c,h):aT(c,h),nQ.create(n))}}class a4 extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>4)return ru.create(ea.NUM);let o=a/4*(e.length-1),l=Math.floor(o),u=o-l;if(0===u)return nQ.create(e[l]);let c=e[l]+u*(e[l+1]-e[l]);return nQ.create(c)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}}class a6 extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std()}}class a9 extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std(1)}}class a8 extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return ru.create(ea.NUM);let u=Math.abs(aM(o/2,l));return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}}class a7 extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,array1Values:a,array2Values:o}=this._handleArray1AndArray2(e,t),l=this._getArrayValues(e),u=this._getArrayValues(t),c=Math.max(r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),h=Math.max(r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),d=ii(c,h,r,ru.create(ea.NA)),m=ii(c,h,n,ru.create(ea.NA)),g=d.mapValue((r,n,c)=>{let h=m.get(n,c);if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(h.isError())return h;let{isError:d,errorObject:g,variants:f}=sY(r,h);if(d)return g;let[p,C]=f,_=Math.floor(+p.getValue()),y=Math.floor(+C.getValue());return[1,2].includes(_)&&[1,2,3].includes(y)?1===y&&i?s:1!==y&&l instanceof ru?l:1!==y&&u instanceof ru?u:this._handleSignleObject(1===y?a:l,1===y?o:u,_,y):ru.create(ea.NUM)});return 1===c&&1===h?g.get(0,0):g}_handleSignleObject(e,t,r,n){if(e.length<2||t.length<2)return ru.create(ea.DIV_BY_ZERO);let{isError:i,errorObject:s,x:a,degFreedom:o}=this._getTDistParamByArrayValues(e,t,n);if(i)return s;let l=aw(-a,o);return 2===r&&(l*=2),Number.isNaN(l)||!Number.isFinite(l)?ru.create(ea.NUM):nQ.create(l)}_getArrayValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let s=0;s<r;s++){let a=e.isArray()?e.get(i,s):e;if(a.isError())return a;if(a.isNull()){if(t*r==1)return ru.create(ea.VALUE);continue}a.isBoolean()||a.isString()||n.push(+a.getValue())}return n}_handleArray1AndArray2(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,array1Values:[],array2Values:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,array1Values:[],array2Values:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:ru.create(ea.VALUE),array1Values:[],array2Values:[]};if(r*n!=i*s)return{isError:!0,errorObject:ru.create(ea.NA),array1Values:[],array2Values:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,array1Values:[],array2Values:[]}:d||c.length<2?{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),array1Values:[],array2Values:[]}:{isError:!1,errorObject:null,array1Values:c,array2Values:h}}_getTDistParamByArrayValues(e,t,r){return 1===r?this._getTDistParamByType1(e,t):2===r?this._getTDistParamByType2(e,t):this._getTDistParamByType3(e,t)}_getTDistParamByType1(e,t){let r=e.length,n=0,i=0,s=0;for(let a=0;a<r;a++)n+=e[a],i+=t[a],s+=(e[a]-t[a])**2;let a=n-i,o=r*s-a**2,l=r-1;return 0===o?{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),x:0,degFreedom:l}:{isError:!1,errorObject:null,x:Math.abs(a)*Math.sqrt(l/o),degFreedom:l}}_getTDistParamByType2(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=Math.sqrt(s-i**2/r+(o-a**2/n));if(0===l)return{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),x:0,degFreedom:0};let u=r-1+n-1,c=Math.sqrt(r*n*u/(r+n));return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/l*c,degFreedom:u}}_getTDistParamByType3(e,t){let r=e.length,n=t.length,i=0,s=0;for(let t=0;t<r;t++)i+=e[t],s+=e[t]**2;let a=0,o=0;for(let e=0;e<n;e++)a+=t[e],o+=t[e]**2;let l=(s-i**2/r)/(r*(r-1)),u=(o-a**2/n)/(n*(n-1));if(l+u===0)return{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),x:0,degFreedom:0};let c=l/(l+u);return{isError:!1,errorObject:null,x:Math.abs(i/r-a/n)/Math.sqrt(l+u),degFreedom:1/(c**2/(r-1)+(1-c)**2/(n-1))}}}class oe extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var()}}class ot extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var(1)}}class or extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();if(d<0||m<=0||g<=0)return ru.create(ea.NUM);let p=Math.exp(-((d/g)**m));return Number.isNaN(i=f?1-p:m/g**m*d**(m-1)*p)||!Number.isFinite(i)?ru.create(ea.NUM):nQ.create(i)}}class on extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=this._getArrayValues(e),i=Math.max(t.isArray()?t.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(t.isArray()?t.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=ii(i,s,t,ru.create(ea.NA)),o=r?ii(i,s,r,ru.create(ea.NA)):void 0,l=a.mapValue((e,t,i)=>{if(n instanceof ru)return n;if(e.isError())return e;let s=r?o.get(t,i):void 0;return null!=s&&s.isError()?s:0===n.length?ru.create(ea.NA):1===n.length?ru.create(ea.DIV_BY_ZERO):this._handleSignleObject(n,e,s)});return 1===i&&1===s?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.length,u=0,c=0;for(let t=0;t<l;t++)u+=e[t],c+=e[t]**2;let h=0;if(void 0!==r){let{isError:e,errorObject:t,variants:n}=sY(r);if(e)return t;let[i]=n;h=+i.getValue()}else{let e=u/l;h=Math.sqrt((c-2*e*u+l*e**2)/(l-1))}if(h<=0)return ru.create(ea.NUM);let d=1-aS((u/l-o)/(h/Math.sqrt(l)),0,1);return Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}_getArrayValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;if(n.isNull()||n.isBoolean()||n.isString())continue;let s=n.getValue();(0,j.isRealNum)(s)&&t.push(+s)}return t}}var oi=((v=oi||{}).BETADIST="BETADIST",v.BETAINV="BETAINV",v.BINOMDIST="BINOMDIST",v.CHIDIST="CHIDIST",v.CHIINV="CHIINV",v.CHITEST="CHITEST",v.CONFIDENCE="CONFIDENCE",v.COVAR="COVAR",v.CRITBINOM="CRITBINOM",v.EXPONDIST="EXPONDIST",v.FDIST="FDIST",v.FINV="FINV",v.FTEST="FTEST",v.GAMMADIST="GAMMADIST",v.GAMMAINV="GAMMAINV",v.HYPGEOMDIST="HYPGEOMDIST",v.LOGINV="LOGINV",v.LOGNORMDIST="LOGNORMDIST",v.MODE="MODE",v.NEGBINOMDIST="NEGBINOMDIST",v.NORMDIST="NORMDIST",v.NORMINV="NORMINV",v.NORMSDIST="NORMSDIST",v.NORMSINV="NORMSINV",v.PERCENTILE="PERCENTILE",v.PERCENTRANK="PERCENTRANK",v.POISSON="POISSON",v.QUARTILE="QUARTILE",v.RANK="RANK",v.STDEV="STDEV",v.STDEVP="STDEVP",v.TDIST="TDIST",v.TINV="TINV",v.TTEST="TTEST",v.VAR="VAR",v.VARP="VARP",v.WEIBULL="WEIBULL",v.ZTEST="ZTEST",v);let os=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(1);s.isNull()&&(s=nQ.create(0)),a.isNull()&&(a=nQ.create(1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.mapValue((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),s=d.get(t,r),a=m.get(t,r);return this._handleSignleObject(e,n,i,s,a)});return 1===o&&1===l?g.get(0,0):g}_handleSignleObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:a,variants:o}=sY(e,t,r,n,i);if(s)return a;let[l,u,c,h,d]=o,m=+l.getValue(),g=+u.getValue(),f=+c.getValue(),p=+h.getValue(),C=+d.getValue();if(g<=0||f<=0||m<p||m>C||p===C)return ru.create(ea.NUM);let _=as((m-p)/(C-p),g,f);return nQ.create(_)}},oi.BETADIST],[aP,oi.BETAINV],[aF,oi.BINOMDIST],[aj,oi.CHIDIST],[aB,oi.CHIINV],[a$,oi.CHITEST],[aH,oi.CONFIDENCE],[aW,oi.COVAR],[ak,oi.CRITBINOM],[aG,oi.EXPONDIST],[aY,oi.FDIST],[az,oi.FINV],[aX,oi.FTEST],[aq,oi.GAMMADIST],[aK,oi.GAMMAINV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sY(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||h>d||h>m||h<d-g+m||d<=0||d>g||m<=0||m>g||g<=0)return ru.create(ea.NUM);let f=ab(h,d,m,g);return Number.isNaN(f)&&(f=0),nQ.create(f)}},oi.HYPGEOMDIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();if(u<=0||h<=0)return ru.create(ea.NUM);let d=aI(u,c,h);return nQ.create(d)}},oi.LOGNORMDIST],[aQ,oi.LOGINV],[aZ,oi.MODE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue()),h=+l.getValue();if(u<0||c<1||h<=0||h>=1)return ru.create(ea.NUM);let d=aN(u,c,h);return nQ.create(d)}},oi.NEGBINOMDIST],[aJ,oi.NORMDIST],[a0,oi.NORMINV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=aS(+i.getValue(),0,1);return nQ.create(s)}},oi.NORMSDIST],[a1,oi.NORMSINV],[a2,oi.PERCENTILE],[a5,oi.PERCENTRANK],[a3,oi.POISSON],[a4,oi.QUARTILE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nQ.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,n,ru.create(ea.NA)),h=ii(l,u,o,ru.create(ea.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ru.create(ea.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ru.create(ea.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?ru.create(ea.NA):nQ.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=ru.create(ea.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},oi.RANK],[a9,oi.STDEV],[a6,oi.STDEVP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||c<1||c>1e10||h<1||h>2)return ru.create(ea.NUM);let d=aw(-u,c);return 2===h&&(d*=2),Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}},oi.TDIST],[a8,oi.TINV],[a7,oi.TTEST],[ot,oi.VAR],[oe,oi.VARP],[or,oi.WEIBULL],[on,oi.ZTEST]],oa=[];var oo=((T=oo||{}).CUBEKPIMEMBER="CUBEKPIMEMBER",T.CUBEMEMBER="CUBEMEMBER",T.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",T.CUBERANKEDMEMBER="CUBERANKEDMEMBER",T.CUBESET="CUBESET",T.CUBESETCOUNT="CUBESETCOUNT",T.CUBEVALUE="CUBEVALUE",T);class ol extends sz{isCustom(){return!0}}class ou extends ol{isAsync(){return!0}}function oc(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,databaseValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:ru.create(ea.VALUE),databaseValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()&&(s=s.toLocaleUpperCase()),n.isNumber()||(0,j.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,databaseValues:t}}function oh(e,t){let r=-1;if(e.isError())return{isError:!0,errorObject:e,fieldIndex:r};let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;if(n>1||i>1)return{isError:!0,errorObject:ru.create(ea.VALUE),fieldIndex:r};let s=e.isArray()?e.get(0,0):e,a=`${s.getValue()}`;if(s.isNull()?a=0:s.isBoolean()?a=+!!s.getValue():(s.isNumber()||(0,j.isRealNum)(a))&&(a=Math.floor(+a)),"number"==typeof a){if(a<1||a>t[0].length)return{isError:!0,errorObject:ru.create(ea.VALUE),fieldIndex:r};r=a-1}else if(-1===(r=t[0].findIndex(e=>null!==e&&`${e}`.toLocaleLowerCase()===a.toLocaleLowerCase())))return{isError:!0,errorObject:ru.create(ea.VALUE),fieldIndex:r};return{isError:!1,errorObject:null,fieldIndex:r}}function od(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,criteriaValues:t};let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:ru.create(ea.VALUE),criteriaValues:t};for(let i=0;i<r;i++){let r=[];for(let t=0;t<n;t++){let n=e.get(i,t);if(n.isNull()){r.push(null);continue}let s=`${n.getValue()}`;if(n.isBoolean()){r.push(+!!n.getValue());continue}if(n.isNumber()||(0,j.isRealNum)(s)){r.push(+s);continue}r.push(s)}t.push(r)}return{isError:!1,errorObject:null,criteriaValues:t}}function om(e,t,r){let n=e.length,i=e[0].length,s={},a=!1;for(let o=1;o<n;o++){let n=!0;for(let a=0;a<i;a++){let i=e[o][a];if(null===i)continue;let l=s[a];if(void 0===l){let r=e[0][a];l=t[0].findIndex(e=>null!==e&&null!==r&&`${e}`.toLocaleLowerCase()===`${r}`.toLocaleLowerCase()),s[a]=l}if(-1===l&&("string"==typeof i||0===i)){n=!1;break}if(l>-1){let e=t[r][l];if(null===e){n=!1;break}let[s,a]=ia(`${i}`);if(!n3.create(`${e}`).compare(a,s).getValue()){n=!1;break}}}if(n){a=!0;break}}return a}var og=((w=og||{}).DAVERAGE="DAVERAGE",w.DCOUNT="DCOUNT",w.DCOUNTA="DCOUNTA",w.DGET="DGET",w.DMAX="DMAX",w.DMIN="DMIN",w.DPRODUCT="DPRODUCT",w.DSTDEV="DSTDEV",w.DSTDEVP="DSTDEVP",w.DSUM="DSUM",w.DVAR="DVAR",w.DVARP="DVARP",w);let of=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d+=t,m++)}return 0===m?ru.create(ea.DIV_BY_ZERO):nQ.create(d/m)}},og.DAVERAGE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)"number"==typeof s[e][l]&&om(h,s,e)&&d++;return nQ.create(d)}},og.DCOUNT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&om(h,s,e)&&d++;return nQ.create(d)}},og.DCOUNTA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0,m=0;for(let e=1;e<s.length;e++)null!=s[e][l]&&om(h,s,e)&&(d++,m=e);return 0===d?ru.create(ea.VALUE):d>1?ru.create(ea.NUM):e.get(m,l)}},og.DGET],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=-1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d=Math.max(d,t),m++)}return 0===m?nQ.create(0):nQ.create(d)}},og.DMAX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=1/0,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d=Math.min(d,t),m++)}return 0===m?nQ.create(0):nQ.create(d)}},og.DMIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=1,m=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d*=t,m++)}return 0===m?nQ.create(0):nQ.create(d)}},og.DPRODUCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return ru.create(ea.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/(g-1));return nQ.create(C)}},og.DSTDEV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return ru.create(ea.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=Math.sqrt(p/g);return nQ.create(C)}},og.DSTDEVP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d+=t)}return nQ.create(d)}},og.DSUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(g<=1)return ru.create(ea.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/(g-1);return nQ.create(C)}},og.DVAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,databaseValues:s}=oc(e);if(n)return i;let{isError:a,errorObject:o,fieldIndex:l}=oh(t,s);if(a)return o;let{isError:u,errorObject:c,criteriaValues:h}=od(r);if(u)return c;let d=[],m=0,g=0;for(let e=1;e<s.length;e++){let t=s[e][l];"number"==typeof t&&om(h,s,e)&&(d.push(t),m+=t,g++)}if(0===g)return ru.create(ea.DIV_BY_ZERO);let f=m/g,p=0;for(let e=0;e<g;e++)p+=(d[e]-f)**2;let C=p/g;return nQ.create(C)}},og.DVARP]],op="yyyy/mm/dd;@";function oC(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),i=(n-t.getTime())/864e5;return n>r.getTime()&&(i+=1),Math.floor(i)+1}function o_(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=(e.getTime()-t.getTime())/864e5;return e>r&&(n+=1),n+1}function oy(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),n=Math.floor(e)-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),new Date(t.getTime()+864e5*n)}function oE(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),n=e-1;return n>(r.getTime()-t.getTime())/864e5&&(n-=1),n<0&&(n=e),new Date(t.getTime()+864e5*n)}function oR(e){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let t=e.replace(/-/g,"/").replace(/T.+/,""),r=new Date(`${t}`);if(Number.isNaN(r.getTime()))return!1;let n=r.getFullYear(),i=(r.getMonth()+1).toString().padStart(2,"0"),s=r.getDate().toString().padStart(2,"0"),a=`${n}-${i}-${s}`;return e.replace(/\//g,"-").split("-").map(e=>e.padStart(2,"0")).join("-")===a}function ob(e){return j.numfmt.parseDate(e)}function oI(e){return j.numfmt.parseValue(e)}function oN(e){return j.numfmt.parseTime(e)}function oS(e){return j.numfmt.isDate(e)}let oA={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function ov(e){return!!("string"==typeof e&&/^[0|1]{7}/.test(e)||oA[Number(e)])}function oT(e){if(!ov(e))return[];if("string"==typeof e&&/^[0|1]{7}/.test(e)){let t=[];for(let r=1;r<=e.length;r++)"1"==`${e[r-1]}`&&(r===e.length?t.push(0):t.push(r));return t}return oA[Number(e)]||[]}function ow(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=Math.floor(t),o=a>s?s:a,l=0,u=Math.abs(Math.floor(t)-Math.floor(e))+1;for(let e=0;e<u;e++){let t=o+e;if(n&&n.length>0&&n.some(e=>Math.floor(e)===t))continue;let r=ox(t);i.includes(r)||l++}return a>=s?l:-l}function oM(e,t,r=1,n){let i=oT(r),s=Math.floor(e),a=s,o=Math.abs(t);for(let e=1;e<=o;e++){let r=t<0?s-e:s+e;if(r<0)return ru.create(ea.NUM);if(n&&n.length>0&&n.some(e=>Math.floor(e)===r)){o++;continue}let l=ox(r);if(i.includes(l)){o++;continue}a=r}return a}function oO(e){if(e.isError())return e;let t=e.getValue();if(e.isString()){let e;if(ob(`${t}`))e=ob(`${t}`).v;else if(oN(`${t}`))e=oN(`${t}`).v;else{if(!(0,j.isRealNum)(t))return ru.create(ea.VALUE);e=+t}return e instanceof Date&&(e=o_(e)),0>+e||+e>2958465?ru.create(ea.NUM):+e}{let t=+e.getValue();return t<0||t>2958465?ru.create(ea.NUM):t}}function ox(e){let t=60===Math.floor(e),r=oy(e),n=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getTime(),i=new Date(Date.UTC(1900,1,28)).getTime();return!t&&n<=i&&(r=new Date(n-864e5)),new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getUTCDay()}function oU(e,t,r){switch(r){case 0:return function(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 2===i?oy(e+1).getUTCMonth()+1===3&&(s=30):31===s&&(s=30),31===u&&(s<30?(o=(a=oy(t+1)).getUTCFullYear(),l=a.getUTCMonth()+1,u=a.getUTCDate()):u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t);case 1:return function(e,t){let r,n,i=oy(e),s=e>0?i.getUTCFullYear():1900,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=Math.abs(t-e),u=Math.abs(o-s)+1;if(o<s){let e=new Date(Date.UTC(o,0,1)),t=new Date(Date.UTC(s,11,31));r=oC(e),n=oC(t),1900===o&&(r+=1)}else{let e=new Date(Date.UTC(s,0,1)),t=new Date(Date.UTC(o,11,31));r=oC(e),n=oC(t),1900===s&&(r+=1)}return{days:l,yearDays:(n-r+1)/u}}(e,t);case 2:return{days:Math.abs(t-e),yearDays:360};case 3:default:return{days:Math.abs(t-e),yearDays:365};case 4:return function(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=e>0?r.getUTCMonth()+1:1,s=e>0?r.getUTCDate():0,a=oy(t),o=t>0?a.getUTCFullYear():1900,l=t>0?a.getUTCMonth()+1:1,u=t>0?a.getUTCDate():0;return 31===s&&(s=30),31===u&&(u=30),{days:Math.abs((o-n)*360+(t>=e?30-s:-s)+(t>=e?u:u-30)+(t>=e?l-i-1:l-i+1)*30),yearDays:360}}(e,t)}}let oD=[31,29,31,30,31,30,31,31,30,31,30,31],oV=[31,28,31,30,31,30,31,31,30,31,30,31];function oL(e,t){return e%4==0&&e%100!=0||e%400==0?oD[t]:oV[t]}function oP(e){return e%4==0&&e%100!=0||e%400==0||1900===e?366:365}function oF(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return oP(oy(e).getUTCFullYear());case 3:return 365;default:return -1}}function ok(e,t){let r=e.getUTCFullYear(),n=e.getUTCMonth(),i=e.getUTCDate();return oL(r,n)===i?(e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),r=e.getUTCFullYear(),n=e.getUTCMonth(),e.setUTCDate(oL(r,n))):e.setUTCMonth(e.getUTCMonth()+t),e}var oj=((M=oj||{}).DATE="DATE",M.DATEDIF="DATEDIF",M.DATEVALUE="DATEVALUE",M.DAY="DAY",M.DAYS="DAYS",M.DAYS360="DAYS360",M.EDATE="EDATE",M.EOMONTH="EOMONTH",M.EPOCHTODATE="EPOCHTODATE",M.HOUR="HOUR",M.ISOWEEKNUM="ISOWEEKNUM",M.MINUTE="MINUTE",M.MONTH="MONTH",M.NETWORKDAYS="NETWORKDAYS",M.NETWORKDAYS_INTL="NETWORKDAYS.INTL",M.NOW="NOW",M.SECOND="SECOND",M.TIME="TIME",M.TIMEVALUE="TIMEVALUE",M.TO_DATE="TO_DATE",M.TODAY="TODAY",M.WEEKDAY="WEEKDAY",M.WEEKNUM="WEEKNUM",M.WORKDAY="WORKDAY",M.WORKDAY_INTL="WORKDAY.INTL",M.YEAR="YEAR",M.YEARFRAC="YEARFRAC",M);let oB=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e),a=ii(n,i,t),o=ii(n,i,r);return s.map((e,t,r)=>{let n=a.get(t,r)||nX.create(),i=o.get(t,r)||nX.create();if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;if(e.isString()||n.isString()||i.isString())return ru.create(ea.VALUE);let s=+e.getValue(),l=Math.floor(+n.getValue()),u=+i.getValue();if(s<0||s>9999)return ru.create(ea.NUM);s>=0&&s<1899&&(s+=1900);let c=oC(new Date(s,l-1,u));return c<0?ru.create(ea.NUM):nQ.create(c,op)})}},oj.DATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t,s=r;if(n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),s.isArray()&&(s=s.get(0,0)),n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=oO(n);if("number"!=typeof a)return a;let o=oO(i);return"number"!=typeof o?o:o<a||!s.isString()?ru.create(ea.NUM):this._getResultByUnit(a,o,s)}_getResultByUnit(e,t,r){let n=oy(e),i=n.getUTCFullYear(),s=n.getUTCMonth()+1,a=n.getUTCDate(),o=oy(t),l=o.getUTCFullYear(),u=o.getUTCMonth()+1,c=o.getUTCDate(),h=`${r.getValue()}`.toLocaleUpperCase(),d=0,m;switch(h){case"Y":d=l-i,(u<s||u===s&&c<a)&&(d-=1);break;case"M":d=(l-i)*12+u-s,c<a&&(d-=1);break;case"D":d=Math.floor(t)-Math.floor(e);break;case"MD":d=c-a,c<a&&(d+=oL((m=new Date(Date.UTC(l,u-1,0))).getUTCFullYear(),m.getUTCMonth()));break;case"YM":d=u-s,(u<s||u===s&&c<a)&&(d+=12),c<a&&(d-=1);break;case"YD":m=new Date(Date.UTC(i,u-1,c)),(u<s||u===s&&c<a)&&(m=new Date(Date.UTC(i+1,u-1,c))),d=Math.floor(oC(m))-Math.floor(e);break;default:return ru.create(ea.NUM)}return nQ.create(d)}},oj.DATEDIF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=oI(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&oS(r))return e instanceof Date&&(e=o_(e)),nQ.create(Math.trunc(+e))}}return ru.create(ea.VALUE)}},oj.DATEVALUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t,r=e.getValue();if(e.isString()){if(!oR(`${r}`))return ru.create(ea.VALUE);t=new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return ru.create(ea.NUM);if(0===r)return nQ.create(0);t=oy(r)}let n=t.getDate();return nQ.create(n)}},oj.DAY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let i=oO(e);if("number"!=typeof i)return i;let a=oO(n);if("number"!=typeof a)return a;let o=Math.floor(i)-Math.floor(a);return nQ.create(o)});return 1===r&&1===n?a.get(0,0):a}},oj.DAYS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nK.create(!1);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);if(e.isError())return e;let s=oO(e);if("number"!=typeof s)return s;if(n.isError())return n;let a=oO(n);if("number"!=typeof a)return a;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let{days:u}=oU(s,a,4*!!+i.getValue());return nQ.create(a>=s?u:-u)});return 1===i&&1===s?u.get(0,0):u}},oj.DAYS360],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t);return i.map((e,t,r)=>{let n=s.get(t,r)||nX.create();if(e.isError())return e;if(n.isError())return n;if(e.isString()||e.isBoolean()||n.isString()||n.isBoolean())return ru.create(ea.VALUE);let i=+e.getValue();if(i<0)return ru.create(ea.NUM);let a=Math.floor(+n.getValue()),o=oy(i),l=o.getUTCFullYear(),u=oC(new Date(Date.UTC(l,o.getUTCMonth()+a,o.getUTCDate())));return nQ.create(u,op)})}},oj.EDATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e,n=t;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);r=r.get(0,0)}if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(r.isError())return r;if(n.isError())return n;let i=oO(r);if("number"!=typeof i)return i;if(n.isBoolean())return ru.create(ea.VALUE);let s=oy(i),a=i>0?s.getUTCFullYear():1900,o=i>0?s.getUTCMonth():0,l=Math.floor(+n.getValue());if(Number.isNaN(l))return ru.create(ea.VALUE);let u=oC(new Date(Date.UTC(a,o+l+1,0)));return nQ.create(u)}},oj.EOMONTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2),J(this,"needsReferenceObject",!0)}calculate(e,t){let r=null!=t?t:nQ.create(1),{isError:n,errorObject:i,timestampIsReferenceObject:s,timestampObject:a,unitObject:o}=this._checkVariants(e,r);if(n)return i;if(a.isNull()||a.isBoolean()||a.isString()||!s&&a.isNumber()&&""!==a.getPattern())return ru.create(ea.VALUE);let l=+a.getValue(),{isError:u,errorObject:c,variants:h}=sY(o);if(u)return c;let[d]=h,m=Math.floor(+d.getValue());if(l<0||m<1||m>3)return ru.create(ea.NUM);1===m&&(l*=1e3),3===m&&(l/=1e3);let g=new Date(Date.UTC(1970,0,1,0,0,0,0)+l);if(Number.isNaN(g.getTime())){let e=25569+l/864e5;return nQ.create(e)}{let e=o_(g);return nQ.create(e,"yyyy-MM-dd AM/PM hh:mm:ss")}}_checkVariants(e,t){let r=e.isReferenceObject(),n=t.isReferenceObject(),i=e;if(r&&(i=e.toArrayValueObject()),i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ru.create(ea.VALUE)};i=i.get(0,0)}if(i.isError())return{isError:!0,errorObject:i};let s=t;if(n&&(s=t.toArrayValueObject()),s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ru.create(ea.VALUE)};s=s.get(0,0)}return s.isError()?{isError:!0,errorObject:s}:{isError:!1,errorObject:null,timestampIsReferenceObject:r,timestampObject:i,unitIsReferenceObject:n,unitObject:s}}},oj.EPOCHTODATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nQ.create(0);let r=oE(t).getUTCHours();return nQ.create(r)}},oj.HOUR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;let r=oy(t),n=t>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=oC(i),a=ox(s),o;t<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=oC(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));let l=Math.ceil((t-o+1)/7);return nQ.create(l)}},oj.ISOWEEKNUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nQ.create(0);let r=oE(t).getUTCMinutes();return nQ.create(r)}},oj.MINUTE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!oR(`${r}`))return ru.create(ea.VALUE);t=new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return ru.create(ea.NUM);if(0===r)return nQ.create(1);t=oy(r)}let n=t.getUTCMonth()+1;return nQ.create(n)}},oj.MONTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return ru.create(ea.VALUE);let s=oO(n);if("number"!=typeof s)return s;let a=oO(i);if("number"!=typeof a)return a;if(r)return this._getResultByHolidays(s,a,r);let o=ow(s,a);return nQ.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return ru.create(ea.VALUE);let s=oO(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return ru.create(ea.VALUE);let e=oO(r);if("number"!=typeof e)return e;n.push(e)}let i=ow(e,t,1,n);return nQ.create(i)}},oj.NETWORKDAYS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=e,s=t;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);i=i.get(0,0)}if(i.isError())return i;if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);s=s.get(0,0)}if(s.isError())return s;let a=1;if(r){if(a=r.getValue(),r.isBoolean()&&(a*=1),r.isString()&&!ov(a))return ru.create(ea.VALUE);if(!ov(a))return ru.create(ea.NUM)}if(i.isBoolean()||s.isBoolean())return ru.create(ea.VALUE);let o=oO(i);if("number"!=typeof o)return o;let l=oO(s);if("number"!=typeof l)return l;if(n)return this._getResultByHolidays(o,l,a,n);let u=ow(o,l,a);return nQ.create(u)}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return ru.create(ea.VALUE);let s=oO(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return ru.create(ea.VALUE);let e=oO(n);if("number"!=typeof e)return e;i.push(e)}let s=ow(e,t,r,i);return nQ.create(s)}},oj.NETWORKDAYS_INTL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){let e=new Date,t=o_(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())));return nQ.create(t,"yyyy/mm/dd hh:mm")}},oj.NOW],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=oO(e);if("number"!=typeof t)return t;if(0===t)return nQ.create(0);let r=oE(t).getUTCSeconds();return nQ.create(r)}},oj.SECOND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e),a=ii(n,i,t),o=ii(n,i,r);return s.map((e,t,r)=>this._calculateTime(e,a,o,t,r))}_calculateTime(e,t,r,n,i){let s=e,a=t.get(n,i)||nX.create(),o=r.get(n,i)||nX.create();if((s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),(a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),(o.isString()||o.isBoolean())&&(o=o.convertToNumberObjectValue()),s.isError())return s;if(a.isError())return a;if(o.isError())return o;let l=Math.floor(+s.getValue()),u=Math.floor(+a.getValue()),c=Math.floor(+o.getValue());if(l<0||u<0||c<0||l>32767||u>32767||c>32767)return ru.create(ea.NUM);u+=Math.floor(c/60),c%=60,l+=Math.floor(u/60);let h=(3600*(l%=24)+60*(u%=60)+c)/86400;return nQ.create(h,"h:mm A/P")}},oj.TIME],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let r=oI(`${e.getValue()}`);if(r){let{v:e,z:n}=r;if(n&&oS(n)){var t;return e instanceof Date&&(e=o_(e)),nQ.create((t=+e)-Math.trunc(t))}}}return ru.create(ea.VALUE)}},oj.TIMEVALUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0)}calculate(e){let t=e.isReferenceObject(),r=e;if(t&&(r=e.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);r=r.get(0,0)}if(r.isError()||r.isNull()||r.isBoolean()||r.isString()||!t&&r.isNumber()&&""!==r.getPattern())return r;let n=+r.getValue();return nQ.create(n,"yyyy-MM-dd hh:mm:ss AM/PM")}},oj.TO_DATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){let e=oC(new Date);return nQ.create(e,op)}},oj.TODAY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2),J(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){let r=null!=t?t:nQ.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r);return this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;let n=oO(e);if("number"!=typeof n)return n;if(r.isString()&&(r=r.convertToNumberObjectValue()).isError())return r;let i=Math.floor(+r.getValue());if(!this._returnTypeMap[i])return ru.create(ea.NUM);let s=ox(n),a=this._returnTypeMap[i][s];return nQ.create(a)}},oj.WEEKDAY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2),J(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,n=null!=t?t:nQ.create(1);if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);r=r.get(0,0)}if(r.isError())return r;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean())return ru.create(ea.VALUE);let i=oO(r);if("number"!=typeof i)return i;if(n.isBoolean())return ru.create(ea.VALUE);let s=Math.floor(+n.getValue());return Number.isNaN(s)?ru.create(ea.VALUE):s in this._returnTypeMap?this._getResult(i,s):ru.create(ea.NUM)}_getResult(e,t){let r=oy(e),n=e>0?r.getUTCFullYear():1900,i=new Date(Date.UTC(n,0,1)),s=oC(i),a=ox(s),o;if(21===t)e<(o=a<1?s+1:a<=4?s-(a-1):s+(11-a))&&(o=(a=ox(s=oC(i=new Date(Date.UTC(n-1,0,1)))))<1?s+1:a<=4?s-(a-1):s+(11-a));else{let e=this._returnTypeMap[t];o=a<e?s-(a+7-e):s-(a-e)}let l=Math.ceil((e-o+1)/7);return nQ.create(l)}},oj.WEEKNUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);i=i.get(0,0)}if(i.isError())return i;if(null!=r&&r.isError())return r;if(n.isBoolean()||i.isBoolean())return ru.create(ea.VALUE);let s=oO(n);if("number"!=typeof s)return s;let a=+i.getValue();if(Number.isNaN(a))return ru.create(ea.VALUE);if(r)return this._getResultByHolidays(s,a,r);let o=oM(s,a);return"number"!=typeof o?o:nQ.create(o)}_getResultByHolidays(e,t,r){let n=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let i=0;i<e;i++)for(let e=0;e<t;e++){let t=r.get(i,e);if(t.isBoolean())return ru.create(ea.VALUE);let s=oO(t);if("number"!=typeof s)return s;n.push(s)}}else{if(r.isBoolean())return ru.create(ea.VALUE);let e=oO(r);if("number"!=typeof e)return e;n.push(e)}let i=oM(e,t,1,n);return"number"!=typeof i?i:nQ.create(i)}},oj.WORKDAY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",4)}calculate(e,t,r,n){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=n&&n.isError()?n:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,t,r,n)}_handleSingleObject(e,t,r,n){let i=null!=r?r:nQ.create(1),s=this._checkArrayError(e);if(s.isError())return s;let a=this._checkArrayError(t);if(a.isError())return a;if(s.isBoolean()||a.isBoolean())return ru.create(ea.VALUE);let o=oO(e);if("number"!=typeof o)return o;let l=+t.getValue();if(Number.isNaN(l))return ru.create(ea.VALUE);let u=i.getValue();if(i.isBoolean()&&(u*=1),i.isString()&&(!ov(u)||"1111111"===u))return ru.create(ea.VALUE);if(!ov(u))return ru.create(ea.NUM);if(n)return this._getResultByHolidays(o,l,u,n);let c=oM(o,l,u);return"number"!=typeof c?c:nQ.create(c)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,n){let i=[];if(null!=n&&n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=n.get(r,e);if(t.isBoolean())return ru.create(ea.VALUE);let s=oO(t);if("number"!=typeof s)return s;i.push(s)}}else{if(n.isBoolean())return ru.create(ea.VALUE);let e=oO(n);if("number"!=typeof e)return e;i.push(e)}let s=oM(e,t,r,i);return"number"!=typeof s?s:nQ.create(s)}},oj.WORKDAY_INTL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!oR(`${r}`))return ru.create(ea.VALUE);t=new Date(`${r}`)}else{let e=+r;if(e<0)return ru.create(ea.NUM);if(0===e)return nQ.create(1900);t=oy(e)}let n=t.getUTCFullYear();return nQ.create(n)}},oj.YEAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(0),i=s$(e);if(i.isError())return i;let s=s$(t);if(s.isError())return s;if((n=s$(n)).isError())return n;if(i.isBoolean()||s.isBoolean()||n.isBoolean())return ru.create(ea.VALUE);let a=oO(i);if("number"!=typeof a)return a;let o=oO(s);if("number"!=typeof o)return o;let l=Math.floor(+n.getValue());if(Number.isNaN(l))return ru.create(ea.VALUE);if(l<0||l>4)return ru.create(ea.NUM);let{days:u,yearDays:c}=oU(a,o,l);return nQ.create(u/c)}},oj.YEARFRAC]];nF.prototype.cos=function(){return new nF(Math.cos(this.toNumber()))};let o$=class e{constructor(e){if(J(this,"_inumber",""),J(this,"_realNum",0),J(this,"_iNum",0),J(this,"_suffix",""),J(this,"_isError",!1),""===`${e}`.trim()){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){let n,i=new nF(e).toSignificantDigits(15).toNumber(),s=new nF(t).toSignificantDigits(15).toNumber(),a=""===r?"i":r;if(0===i&&0===s)n=0;else if(0===i)n=1===s?a:`${s}${a}`;else if(0===s)n=i;else{let e=1===s?a:`${s}${a}`;n=`${i}${s>0?"+":""}${e}`}return n}static createByComplexStr(t,r,n){let i=e.getComplex(t,r,n);return new e(i)}_getImReal(){if(0===this._inumber||"0"===this._inumber){this._realNum=0;return}let e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(0===this._inumber||"0"===this._inumber){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let n=e.substring(e.length-1,e.length),i="i"===n||"j"===n;if(t>=0||r>=0){if(!i){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-e.substring(r+1,e.length-1)}else i?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){let e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix="i"===t||"j"===t?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return e.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){let t=e.getSuffix();return""!==this._suffix&&""!==t&&this._suffix!==t}Abs(){return nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){let e=nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))),t=nF.acos(new nF(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return e.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){let t=nF.cos(this._realNum).mul(nF.cosh(this._iNum)).toNumber(),r=nF.sin(this._realNum).mul(nF.sinh(this._iNum)).negated().toNumber();return e.getComplex(t,r,this._suffix)}{let t=nF.cos(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nF.cosh(this._realNum).mul(nF.cos(this._iNum)).toNumber(),r=nF.sinh(this._realNum).mul(nF.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nF.cosh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Cot(){if(this._iNum){let t=nF.cosh(2*this._iNum).sub(nF.cos(2*this._realNum)),r=nF.sin(2*this._realNum).div(t).toNumber(),n=nF.sinh(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.tan(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Coth(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nF.cosh(2*this._realNum).sub(nF.cos(2*this._iNum)),r=nF.sinh(2*this._realNum).div(t).toNumber(),n=nF.sin(2*this._iNum).div(t).negated().toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.tanh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csc(){if(this._iNum){let t=nF.cosh(2*this._iNum).sub(nF.cos(2*this._realNum)),r=nF.sin(this._realNum).mul(nF.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nF.cos(this._realNum).mul(nF.sinh(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.sin(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nF.cosh(2*this._realNum).sub(nF.cos(2*this._iNum)),r=nF.sinh(this._realNum).mul(nF.cos(this._iNum)).mul(2).div(t).toNumber(),n=nF.cosh(this._realNum).mul(nF.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.sinh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Div(t){let r=new nF(this._realNum),n=new nF(this._iNum),i=new nF(t.getRealNum()),s=new nF(t.getINum()),a=i.mul(i).add(s.mul(s)),o=r.mul(i).add(n.mul(s)).div(a).toNumber(),l=n.mul(i).sub(r.mul(s)).div(a).toNumber(),u=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(o,l,u)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";let t=nF.exp(this._realNum).mul(nF.cos(this._iNum)).toNumber(),r=nF.exp(this._realNum).mul(nF.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}Ln(){let t=nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))),r=nF.ln(t).toNumber(),n=nF.acos(new nF(this._realNum).div(t)).toNumber();return e.getComplex(r,n,this._suffix)}Log(t){let r=nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))),n=nF.ln(r),i=nF.acos(new nF(this._realNum).div(r));this._iNum<0&&(i=i.negated());let s=nF.ln(t),a=new nF(0),o=s.mul(s).add(a.mul(a));if(o.eq(0))return this._isError=!0,"";let l=n.mul(s).add(i.mul(a)).div(o).toNumber(),u=i.mul(s).sub(n.mul(a)).div(o).toNumber();return e.getComplex(l,u,this._suffix)}Power(t){if(0===this._realNum&&0===this._iNum)return t>0?e.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let r=nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))),n=nF.acos(new nF(this._realNum).div(r));this._iNum<0&&(n=n.negated()),r=nF.pow(r,t),n=n.mul(t);let i=nF.cos(n).mul(r).toNumber(),s=nF.sin(n).mul(r).toNumber();return Number.isFinite(i)&&Number.isFinite(s)?e.getComplex(i,s,this._suffix):(this._isError=!0,"")}Product(t){let r=new nF(this._realNum),n=new nF(this._iNum),i=new nF(t.getRealNum()),s=new nF(t.getINum()),a=r.mul(i).sub(n.mul(s)).toNumber(),o=r.mul(s).add(n.mul(i)).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sec(){if(this._iNum){let t=nF.cosh(2*this._iNum).add(nF.cos(2*this._realNum)),r=nF.cos(this._realNum).mul(nF.cosh(this._iNum)).mul(2).div(t).toNumber(),n=nF.sin(this._realNum).mul(nF.sinh(this._iNum)).mul(2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.cos(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(2*this._realNum))||!Number.isFinite(Math.cosh(2*this._realNum)))return e.getComplex(0,0,this._suffix);if(this._iNum){let t=nF.cosh(2*this._realNum).add(nF.cos(2*this._iNum)),r=nF.cosh(this._realNum).mul(nF.cos(this._iNum)).mul(2).div(t).toNumber(),n=nF.sinh(this._realNum).mul(nF.sin(this._iNum)).mul(-2).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=new nF(1).div(nF.cosh(this._realNum)).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sin(){if(this._iNum){let t=nF.sin(this._realNum).mul(nF.cosh(this._iNum)).toNumber(),r=nF.cos(this._realNum).mul(nF.sinh(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nF.sin(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nF.sinh(this._realNum).mul(nF.cos(this._iNum)).toNumber(),r=nF.cosh(this._realNum).mul(nF.sin(this._iNum)).toNumber();return e.getComplex(t,r,this._suffix)}{let t=nF.sinh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Sqrt(){let t=nF.sqrt(nF.pow(this._realNum,2).add(nF.pow(this._iNum,2))),r=nF.sqrt(t),n=nF.acos(new nF(this._realNum).div(t));this._iNum<0&&(n=n.negated());let i=r.mul(nF.cos(n.div(2).toNumber())).toNumber(),s=r.mul(nF.sin(n.div(2))).toNumber();return e.getComplex(i,s,this._suffix)}Sub(t){let r=new nF(this._realNum),n=new nF(this._iNum),i=new nF(t.getRealNum()),s=new nF(t.getINum()),a=r.sub(i).toNumber(),o=n.sub(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Sum(t){let r=new nF(this._realNum),n=new nF(this._iNum),i=new nF(t.getRealNum()),s=new nF(t.getINum()),a=r.add(i).toNumber(),o=n.add(s).toNumber(),l=""===this._suffix?t.getSuffix():this._suffix;return e.getComplex(a,o,l)}Tan(){if(this._iNum){let t=nF.cos(2*this._realNum).add(nF.cosh(2*this._iNum)),r=nF.sin(2*this._realNum).div(t).toNumber(),n=nF.sinh(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nF.tan(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}Tanh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let t=nF.cosh(2*this._realNum).add(nF.cos(2*this._iNum)),r=nF.sinh(2*this._realNum).div(t).toNumber(),n=nF.sin(2*this._iNum).div(t).toNumber();return e.getComplex(r,n,this._suffix)}{let t=nF.tanh(this._realNum).toNumber();return e.getComplex(t,this._iNum,this._suffix)}}};var oH=((O=oH||{}).BESSELI="BESSELI",O.BESSELJ="BESSELJ",O.BESSELK="BESSELK",O.BESSELY="BESSELY",O.BIN2DEC="BIN2DEC",O.BIN2HEX="BIN2HEX",O.BIN2OCT="BIN2OCT",O.BITAND="BITAND",O.BITLSHIFT="BITLSHIFT",O.BITOR="BITOR",O.BITRSHIFT="BITRSHIFT",O.BITXOR="BITXOR",O.COMPLEX="COMPLEX",O.CONVERT="CONVERT",O.DEC2BIN="DEC2BIN",O.DEC2HEX="DEC2HEX",O.DEC2OCT="DEC2OCT",O.DELTA="DELTA",O.ERF="ERF",O.ERF_PRECISE="ERF.PRECISE",O.ERFC="ERFC",O.ERFC_PRECISE="ERFC.PRECISE",O.GESTEP="GESTEP",O.HEX2BIN="HEX2BIN",O.HEX2DEC="HEX2DEC",O.HEX2OCT="HEX2OCT",O.IMABS="IMABS",O.IMAGINARY="IMAGINARY",O.IMARGUMENT="IMARGUMENT",O.IMCONJUGATE="IMCONJUGATE",O.IMCOS="IMCOS",O.IMCOSH="IMCOSH",O.IMCOT="IMCOT",O.IMCOTH="IMCOTH",O.IMCSC="IMCSC",O.IMCSCH="IMCSCH",O.IMDIV="IMDIV",O.IMEXP="IMEXP",O.IMLN="IMLN",O.IMLOG="IMLOG",O.IMLOG10="IMLOG10",O.IMLOG2="IMLOG2",O.IMPOWER="IMPOWER",O.IMPRODUCT="IMPRODUCT",O.IMREAL="IMREAL",O.IMSEC="IMSEC",O.IMSECH="IMSECH",O.IMSIN="IMSIN",O.IMSINH="IMSINH",O.IMSQRT="IMSQRT",O.IMSUB="IMSUB",O.IMSUM="IMSUM",O.IMTAN="IMTAN",O.IMTANH="IMTANH",O.OCT2BIN="OCT2BIN",O.OCT2DEC="OCT2DEC",O.OCT2HEX="OCT2HEX",O);let oW=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);let u=F.besseli(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},oH.BESSELI],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);let u=F.besselj(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},oH.BESSELJ],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);let u=F.besselk(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},oH.BESSELK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);let u=F.bessely(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},oH.BESSELY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t,{isError:r,errorObject:n,variants:i}=sW(e);if(r)return n;let[s]=i,a=`${s.getValue()}`;return sK(a)?(t=10===a.length&&"1"===a.substring(0,1)?Number.parseInt(a.substring(1),2)-512:Number.parseInt(a,2),nQ.create(t)):ru.create(ea.NUM)}},oH.BIN2DEC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sK(l))return ru.create(ea.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0xfffffffe00+Number.parseInt(l.substring(1),2)).toString(16);else if(r=Number.parseInt(l,2).toString(16),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r.toLocaleUpperCase())}},oH.BIN2HEX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sK(l))return ru.create(ea.NUM);if(10===l.length&&"1"===l.substring(0,1))r=(0x3ffffe00+Number.parseInt(l.substring(1),2)).toString(8);else if(r=Number.parseInt(l,2).toString(8),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.BIN2OCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?ru.create(ea.NUM):nQ.create(a&o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITAND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return ru.create(ea.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)<<BigInt(o):BigInt(a)>>BigInt(-o));return l>0xffffffffffff?ru.create(ea.NUM):nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITLSHIFT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff)return ru.create(ea.NUM);let l=Number(BigInt(a)|BigInt(o));return nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITOR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a<0||Math.floor(a)!==a||a>0xffffffffffff||Math.abs(o)>53)return ru.create(ea.NUM);let l=Number((o=Math.trunc(o))>=0?BigInt(a)>>BigInt(o):BigInt(a)<<BigInt(-o));return l>0xffffffffffff?ru.create(ea.NUM):nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},oH.BITRSHIFT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=s.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();return a<0||o<0||Math.floor(a)!==a||Math.floor(o)!==o||a>0xffffffffffff||o>0xffffffffffff?ru.create(ea.NUM):nQ.create(a^o)});return 1===r&&1===n?a.get(0,0):a}},oH.BITXOR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sW(e,t,null!=r?r:nJ.create("i"));if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=`${l.getValue()}`;if(Number.isNaN(u)||Number.isNaN(c)||"i"!==h&&"j"!==h)return ru.create(ea.VALUE);let d=o$.getComplex(u,c,h);return"number"==typeof d?nQ.create(d):nJ.create(d)}},oH.COMPLEX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3),J(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ngstrm","",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ngstrm","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,0x17a9e9bc0],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,0x219c7bf72246c0],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,0x11de784a],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestrke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ngstrm","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,0x1e187e0]]),J(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,0x10000000000,"Ti","tera"],Gi:["gibi",30,0x40000000,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),J(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sW(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=`${l.getValue()}`,d=`${u.getValue()}`;if(Number.isNaN(c))return ru.create(ea.VALUE);let m,g=1,f,p=1,{_from:C,_to:_}=this._lookupFromAndToUnits(h,d);if(m=C,f=_,null===m){let{_from:e,_fromMultiplier:t}=this._lookupFromPrefix(h);m=e,g=t}if(null===f){let{_to:e,_toMultiplier:t}=this._lookupToPrefix(d);f=e,p=t}return null===m||null===f||m[3]!==f[3]?ru.create(ea.NA):(n="temperature"===m[3]?+(n=this._getTemperatureConversion(c,m[1],f[1])).toFixed(2):c*m[6]*g/(f[6]*p),nQ.create(n))}_lookupFromAndToUnits(e,t){let r=null,n=null,i;for(let s=0;s<this._units.length;s++)i=null===this._units[s][2]?[]:this._units[s][2],(this._units[s][1]===e||i.indexOf(e)>=0)&&(r=this._units[s]),(this._units[s][1]===t||i.indexOf(t)>=0)&&(n=this._units[s]);return{_from:r,_to:n}}_lookupFromPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,n=e,i,s=this._binaryPrefixes[e.substring(0,2)],a=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(a=["dekao",10,"da"]),s?(r=s[2],n=e.substring(2)):a&&(r=a[1],n=e.substring(a[2].length));for(let e=0;e<this._units.length;e++)i=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===n||i.indexOf(n)>=0)&&(t=this._units[e]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return 9*e/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return 4*e/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return 9*e/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return 5*e/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return 5*e/4;case"F":return 9*e/4+32;case"K":return 5*e/4+273.15;case"Rank":return 9*e/4+491.67;default:return e}}},oH.CONVERT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ru.create(ea.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${l}`)||l<-512||l>511)return ru.create(ea.NUM);if(l<0){let e=(512+l).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=Number.parseInt(`${l}`,10).toString(2),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.DEC2BIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ru.create(ea.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${l}`)||l<-0x8000000000||l>0x7fffffffff)return ru.create(ea.NUM);if(l<0)r=(0x10000000000+l).toString(16);else if(r=Number.parseInt(`${l}`,10).toString(16),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r.toLocaleUpperCase())}},oH.DEC2HEX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=Math.trunc(+o.getValue());if(Number.isNaN(l))return ru.create(ea.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${l}`)||l<-0x20000000||l>0x1fffffff)return ru.create(ea.NUM);if(l<0)r=(0x40000000+l).toString(8);else if(r=Number.parseInt(`${l}`,10).toString(8),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.DEC2OCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,null!=t?t:nQ.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?ru.create(ea.VALUE):nQ.create(+(o===l))}},oH.DELTA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(t){let{isError:n,errorObject:i,variants:s}=sW(e,t);if(n)return i;let[a,o]=s,l=+a.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ru.create(ea.VALUE);r=sJ(u)-sJ(l)}else{let{isError:t,errorObject:n,variants:i}=sW(e);if(t)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return ru.create(ea.VALUE);r=sJ(a)}return nQ.create(r)}},oH.ERF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ru.create(ea.VALUE);let a=sJ(s);return nQ.create(a)}},oH.ERF_PRECISE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ru.create(ea.VALUE);let a=1-sJ(s);return nQ.create(a)}},oH.ERFC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return ru.create(ea.VALUE);let a=1-sJ(s);return nQ.create(a)}},oH.ERFC_PRECISE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){if(e.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,null!=t?t:nQ.create(0));if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();return Number.isNaN(o)||Number.isNaN(l)?ru.create(ea.VALUE):nQ.create(+(o>=l))}},oH.GESTEP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return ru.create(ea.NUM);let u=10===l.length&&"F"===l.substring(0,1).toLocaleUpperCase(),c=u?Number.parseInt(l,16)-0x10000000000:Number.parseInt(l,16);if(c<-512||c>511)return ru.create(ea.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.HEX2BIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sZ(s))return ru.create(ea.NUM);let a=Number.parseInt(s,16);return a>=0x8000000000&&(a-=0x10000000000),nQ.create(a)}},oH.HEX2DEC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sZ(l))return ru.create(ea.NUM);let u=Number.parseInt(l,16);if(u>0x1fffffff&&u<0xffe0000000)return ru.create(ea.NUM);if(u>=0xffe0000000)r=(u-0xffc0000000).toString(8);else if(r=u.toString(8),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.HEX2OCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Abs();return nQ.create(a)}},oH.IMABS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.getINum();return nQ.create(a)}},oH.IMAGINARY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);if(0===s.getRealNum()&&0===s.getINum())return ru.create(ea.DIV_BY_ZERO);let a=s.Argument();return nQ.create(a)}},oH.IMARGUMENT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Conjugate();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCONJUGATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Cos();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCOS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Cosh();return s.isError()?ru.create(ea.NUM):"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCOSH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Cot();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCOT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Coth();return s.isError()?ru.create(ea.NUM):"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCOTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Csc();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCSC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Csch();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMCSCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c)||0===c.getRealNum()&&0===c.getINum())return ru.create(ea.NUM);let h=u.Div(c);return"number"==typeof h||(0,j.isRealNum)(h)?nQ.create(+h):nJ.create(h)}},oH.IMDIV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Exp();return s.isError()?ru.create(ea.NUM):"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMEXP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Ln();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMLN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e);if(r)return n;let[s]=i,a=null!=t?t:nQ.create(10);if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);a=a.get(0,0)}let{isError:o,errorObject:l,variants:u}=sY(a);if(o)return l;let[c]=u,h=`${s.getValue()}`,d=+c.getValue(),m=new o$(h);if(m.isError()||0===m.getRealNum()&&0===m.getINum()||d<=0)return ru.create(ea.NUM);let g=m.Log(d);return m.isError()?ru.create(ea.NUM):"number"==typeof g||(0,j.isRealNum)(g)?nQ.create(+g):nJ.create(g)}},oH.IMLOG],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Log(10);return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMLOG10],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError()||0===s.getRealNum()&&0===s.getINum())return ru.create(ea.NUM);let a=s.Log(2);return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMLOG2],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=new o$(`${s.getValue()}`);if(o.isError())return ru.create(ea.NUM);let l=+a.getValue();if(Number.isNaN(l))return ru.create(ea.VALUE);let u=o.Power(l);return o.isError()?ru.create(ea.NUM):"number"==typeof u||(0,j.isRealNum)(u)?nQ.create(+u):nJ.create(u)}},oH.IMPOWER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof ru)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof ru)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof ru?t:"number"==typeof t||(0,j.isRealNum)(t)?nQ.create(+t):nJ.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return ru.create(ea.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return ru.create(ea.NUM);if(e.isDifferentSuffixes(i))return ru.create(ea.VALUE);r=e.Product(i)}else{let e=new o$(n);if(e.isError())return ru.create(ea.NUM);r=e.toString()}return r}},oH.IMPRODUCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.getRealNum();return nQ.create(a)}},oH.IMREAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Sec();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMSEC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Sech();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMSECH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Sin();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMSIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Sinh();return s.isError()?ru.create(ea.NUM):"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMSINH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);if(0===s.getRealNum()&&0===s.getINum())return nQ.create(0);let a=s.Sqrt();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMSQRT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=`${s.getValue()}`,l=`${a.getValue()}`,u=new o$(o),c=new o$(l);if(u.isError()||c.isError()||u.isDifferentSuffixes(c))return ru.create(ea.NUM);let h=u.Sub(c);return"number"==typeof h||(0,j.isRealNum)(h)?nQ.create(+h):nJ.create(h)}},oH.IMSUB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof ru)return t;let n=e[r];if(n.isArray()){let e=!1,r;if(n.iterator(n=>{if((t=this._handleSingleObject(n,t))instanceof ru)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(n,t)}return t instanceof ru?t:"number"==typeof t||(0,j.isRealNum)(t)?nQ.create(+t):nJ.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return ru.create(ea.VALUE);let n=`${e.getValue()}`;if("number"==typeof t||t){let e=new o$(t),i=new o$(n);if(e.isError()||i.isError())return ru.create(ea.NUM);if(e.isDifferentSuffixes(i))return ru.create(ea.VALUE);r=e.Sum(i)}else{let e=new o$(n);if(e.isError())return ru.create(ea.NUM);r=e.toString()}return r}},oH.IMSUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Tan();return"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMTAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=new o$(`${i.getValue()}`);if(s.isError())return ru.create(ea.NUM);let a=s.Tanh();return s.isError()?ru.create(ea.NUM):"number"==typeof a||(0,j.isRealNum)(a)?nQ.create(+a):nJ.create(a)}},oH.IMTANH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return ru.create(ea.NUM);let u=10===l.length&&"7"===l.substring(0,1),c=u?Number.parseInt(l,8)-0x40000000:Number.parseInt(l,8);if(c<-512||c>511)return ru.create(ea.NUM);if(u){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r)}},oH.OCT2BIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:n}=sW(e);if(t)return r;let[i]=n,s=`${i.getValue()}`;if(!sQ(s))return ru.create(ea.NUM);let a=Number.parseInt(s,8);return a>=0x20000000&&(a-=0x40000000),nQ.create(a)}},oH.OCT2DEC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return ru.create(ea.NA);let n=0;if(t){let{isError:e,errorObject:r,variants:i}=sW(t);if(e)return r;let[s]=i;if(Number.isNaN(n=Math.floor(+s.getValue())))return ru.create(ea.VALUE);if(n<0||n>10)return ru.create(ea.NUM)}let{isError:i,errorObject:s,variants:a}=sW(e);if(i)return s;let[o]=a,l=`${o.getValue()}`;if(!sQ(l))return ru.create(ea.NUM);let u=Number.parseInt(l,8);if(u>=0x20000000)r=`ff${(u+0xc0000000).toString(16)}`;else if(r=u.toString(16),t){if(n<r.length)return ru.create(ea.NUM);r="0".repeat(n-r.length)+r}return nJ.create(r.toLocaleUpperCase())}},oH.OCT2HEX]];var oG=((x=oG||{}).ACCRINT="ACCRINT",x.ACCRINTM="ACCRINTM",x.AMORDEGRC="AMORDEGRC",x.AMORLINC="AMORLINC",x.COUPDAYBS="COUPDAYBS",x.COUPDAYS="COUPDAYS",x.COUPDAYSNC="COUPDAYSNC",x.COUPNCD="COUPNCD",x.COUPNUM="COUPNUM",x.COUPPCD="COUPPCD",x.CUMIPMT="CUMIPMT",x.CUMPRINC="CUMPRINC",x.DB="DB",x.DDB="DDB",x.DISC="DISC",x.DOLLARDE="DOLLARDE",x.DOLLARFR="DOLLARFR",x.DURATION="DURATION",x.EFFECT="EFFECT",x.FV="FV",x.FVSCHEDULE="FVSCHEDULE",x.INTRATE="INTRATE",x.IPMT="IPMT",x.IRR="IRR",x.ISPMT="ISPMT",x.MDURATION="MDURATION",x.MIRR="MIRR",x.NOMINAL="NOMINAL",x.NPER="NPER",x.NPV="NPV",x.ODDFPRICE="ODDFPRICE",x.ODDFYIELD="ODDFYIELD",x.ODDLPRICE="ODDLPRICE",x.ODDLYIELD="ODDLYIELD",x.PDURATION="PDURATION",x.PMT="PMT",x.PPMT="PPMT",x.PRICE="PRICE",x.PRICEDISC="PRICEDISC",x.PRICEMAT="PRICEMAT",x.PV="PV",x.RATE="RATE",x.RECEIVED="RECEIVED",x.RRI="RRI",x.SLN="SLN",x.SYD="SYD",x.TBILLEQ="TBILLEQ",x.TBILLPRICE="TBILLPRICE",x.TBILLYIELD="TBILLYIELD",x.VDB="VDB",x.XIRR="XIRR",x.XNPV="XNPV",x.YIELD="YIELD",x.YIELDDISC="YIELDDISC",x.YIELDMAT="YIELDMAT",x);function oY(e,t,r,n){let{days:i}=oU(oK(e,t,r),e,n);return i}function oz(e,t,r,n){let i;if(1===n){let n=oK(e,t,r),s=oy(n),a=oC(s=ok(s,12/r));i=n<0&&1===r?365:a-n}else i=3===n?365/r:360/r;return i}function oX(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=ok(i,-12/r);return oC(i=ok(i,12/r))}function oq(e,t,r){let n=0,i=oy(e),s=oy(t);for(;s>i;)s=ok(s,-12/r),n++;return n}function oK(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i<n&&i.setUTCFullYear(i.getUTCFullYear()+1);i>n;)i=ok(i,-12/r);return oC(i)}function oQ(e,t,r,n,i,s){let a=oY(e,t,i,s),o=oz(e,t,i,s),l=oq(e,t,i),u=(o-a)/o-1,c=n/i+1,h=100*r/i,d=0,m=0;for(let e=1;e<=l;e++){let t=e+u,r=h/c**t;d+=t*r,m+=r}let g=l+u,f=100/c**g;return(d+=g*f)/(m+=f)/i}function oZ(e,t,r,n,i){let s;if(0===e)s=(r+n)/t;else{let a=(1+e)**t;s=1===i?(n*e/(a-1)+r*e/(1-1/a))/(1+e):n*e/(a-1)+r*e/(1-1/a)}return-s}function oJ(e,t,r,n,i){let s;if(0===e)s=n+r*t;else{if(-1===e&&0===t)return Number.NaN;let a=(1+e)**t;s=1===i?n*a+r*(1+e)*(a-1)/e:n*a+r*(a-1)/e}return-s}function o0(e,t,r,n,i,s){let a=oZ(e,r,n,i,s);return(1===t?1===s?0:-n:1===s?oJ(e,t-2,a,n,1)-a:oJ(e,t-1,a,n,0))*e}function o1(e,t){let r=0;for(let n=1;n<=t.length;n++)r+=t[n-1]/(1+e)**n;return r}function o2(e,t,r,n,i,s,a,o,l){let u=o5(r,n,l),c=oz(e,n,o,l);return u<c?function(e,t,r,n,i,s,a,o,l,u,c){let h=0,d=oq(e,t,o),m=o5(e,n,l);h+=a/(1+s/o)**(d-1+m/c)+100*i/o*u/c/(1+s/o)**(m/c);for(let e=2;e<=d;e++)h+=100*i/o/(1+s/o)**(e-1+m/c);return h-100*i/o*o5(r,e,l)/c}(e,t,r,n,i,s,a,o,l,u,c):function(e,t,r,n,i,s,a,o,l,u){let c,h=0,d=oq(n,t,o),m=function(e,t,r,n){let i=oy(e),s=oy(t),a=i.getUTCFullYear(),o=i.getUTCMonth(),l=i.getUTCDate(),u=s.getUTCFullYear(),c=s.getUTCMonth(),h=s.getUTCDate(),d=oL(a,o)===l,m=!d&&1!==o&&l>28&&l<oL(a,o)?oL(u,c)===h:d,g=o6(t,0,m),f=1+ +(t<g),p=o6(g,r,m);for(;!(r>0?p>=t:p<=t);)p=o6(p,r,m),f++;return f}(n,e,12/o);if(2===l||3===l){let t=oX(e,n,o);c=o5(e,t,l)}else{let{days:t}=oU(oK(e,n,o),e,l);c=u-t}h+=a/(1+s/o)**(d+m+c/u);let g=oq(r,n,o),f=n,p=0,C=0;for(let t=g;t>=1;t--){let n=o6(f,-12/o,!1),i=1===l?o5(n,f,l):u;p+=(t>1?i:o5(r,f,l))/i,C+=o5(r>n?r:n,e<f?e:f,l)/i,f=n}h+=100*i/o*p/(1+s/o)**(m+c/u);for(let e=1;e<=d;e++)h+=100*i/o/(1+s/o)**(e+m+c/u);return h-100*i/o*C}(e,t,r,n,i,s,a,o,l,c)}function o5(e,t,r){let{days:n}=oU(e,t,r);return e<t?n:0}function o3(e,t,r){let n=oy(e),i=n.getUTCFullYear(),s=n.getUTCMonth(),a=n.getUTCDate(),o=oL(i,s)===a,l=oy(t),u=l.getUTCFullYear(),c=l.getUTCMonth(),h=l.getUTCDate(),d=oL(u,c)===h;return!(a!==h&&!(o&&d)||Math.abs((u-i)*12+(c-s))%(12/r)!=0)}function o4(e,t,r){return oK(e,t,r)>=0}function o6(e,t,r){let n=oy(e);if(n=ok(n,t),r){let e=oL(n.getUTCFullYear(),n.getUTCMonth());n.setUTCDate(e)}return oC(n)}function o9(e,t){let r=1,n=0,i=e,s;for(;r>1e-7&&n<500;){let e=(t(i+1e-7)-t(i-1e-7))/2e-7;s=i-t(i)/e,n++,r=Math.abs(s-i),i=s}return Number.isNaN(i)||Math.abs(i)===1/0||500===n?function(e,t){let r,n,i=Number.MAX_VALUE,s=e-.01<=-1?-1+1e-7:e-.01,a=e+.01>=i?i-1e-7:e+.01,o,l,u=0;if(e<=-1||e>=i)return ru.create(ea.NUM);for(let e=0;e<60;e++){o=s<=-1?-1+1e-7:s,l=a>=i?i-1e-7:a;let r=t(o),n=t(l);if(r*n<=0)break;if(!(r*n>0))return ru.create(ea.NUM);if(s=o+1.6*(o-l),a=l+1.6*(l-o),59===e)return ru.create(ea.NUM)}let c=t(o),h=t(l);if(1e-7>Math.abs(c)||1e-7>Math.abs(h))return ru.create(ea.NUM);do c*(r=t(n=o+(l-o)/2))<0?l=n:o=n,c=t(o),u++;while(Math.abs(r)>1e-7&&u<60)return n}(e,t):i}function o8(e,t,r,n,i,s,a){let o=oq(e,t,s),l=oz(e,t,s,a),u=oY(e,t,s,a);if(1===o)return(100*r/s+i)/(n/s*(l-u)/l+1)-100*r/s*u/l;let c=l-u,h=i/(1+n/s)**(o-1+c/l);for(let e=1;e<=o;e++)h+=100*r/s/(1+n/s)**(e-1+c/l);return h-100*r/s*u/l}function o7(e,t,r,n,i){let s=0,a=i/r;a>=1?(a=1,s=1===n?e:0):s=e*(1-a)**(n-1);let o=e*(1-a)**n,l=0;return(l=o<t?s-t:s-o)<0&&(l=0),l}let le=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=a?a:nQ.create(0),u=null!=o?o:nK.create(!0),{isError:c,errorObject:h,variants:d}=sW(e,t,r,n,i,s,l);if(c)return h;let[m,g,f,p,C,_,y]=d,E=oO(m);if("number"!=typeof E)return E;let R=oO(g);if("number"!=typeof R)return R;let b=oO(f);if("number"!=typeof b)return b;let I=+p.getValue(),N=+C.getValue(),S=Math.floor(+_.getValue()),A=Math.floor(+y.getValue()),v=+u.getValue();return Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v)?ru.create(ea.VALUE):I<=0||N<=0||![1,2,4].includes(S)||A<0||A>4||Math.floor(E)>=Math.floor(b)?ru.create(ea.NUM):this._getResult(E,R,b,I,N,S,A,v)}_getResult(e,t,r,n,i,s,a,o){let l=oK(e,t,s);if(l<=0)return nQ.create(0);l=oK(r,t,s);let u=12/s,c=oy(t),h=c.getUTCFullYear(),d=c.getUTCMonth(),m=c.getUTCDate(),g=oL(h,d)===m,f=o6(t,-u,g);if(r>t&&o)for(f=t;f<r;)f=o6(f,u,g);let p=e>f?e:f,{days:C}=oU(p,r,a);if(l>=e){let{days:e}=oU(p,r,4*!!a);C=e}r<p&&(C=-C);let _=oz(f,t,s,a),y=C/_,E=f,R=e;for(;E>e;){R=E;let{days:t}=oU(p=e>(E=o6(E,-u,g))?e:E,R,a);if(0===a)C=R>=p||e<=E?t:-t,_=oz(E,R,s,a);else if(C=R<p?-t:t,3===a)_=365/s;else{let{days:e}=oU(E,R,a);_=R<E?-e:e}y+=e<=E?+!!o:C/_}let b=i*n/s*y;return nQ.create(b)}},oG.ACCRINT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sW(e,t,r,n,null!=i?i:nQ.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ru.create(ea.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>Math.floor(g))return ru.create(ea.NUM);if(Math.floor(m)===Math.floor(g))return nQ.create(0);let{days:_,yearDays:y}=oU(m,g,C);return nQ.create(p*f*_/y)}},oG.ACCRINTM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let{isError:o,errorObject:l,variants:u}=sW(e,t,r,n,i,s,null!=a?a:nQ.create(0));if(o)return l;let[c,h,d,m,g,f,p]=u,C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+c.getValue(),E=+m.getValue(),R=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue());return Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(I)?ru.create(ea.VALUE):y<=0||E<0||y<E||Math.floor(C)>Math.floor(_)||R<0||b<=0||![0,1,3,4].includes(I)?ru.create(ea.NUM):(R=R>1?Math.floor(R):Math.ceil(R),this._getResult(y,C,_,E,R,b,I))}_getResult(e,t,r,n,i,s,a){let o=e-n,l=e*s,{days:u,yearDays:c}=oU(t,r,a),h=u/c,d=Math.ceil(o/l-h);if(d<0)return nQ.create(0);let m=l;return 0===i?m=l*h:i===d?m=o-l*(h+i-1):i>d&&(m=0),nQ.create(m)}},oG.AMORLINC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ru.create(ea.NUM);let f=oY(h,d,m,g);return nQ.create(f)}},oG.COUPDAYBS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ru.create(ea.NUM);let f=oz(h,d,m,g);return nQ.create(f)}},oG.COUPDAYS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ru.create(ea.NUM);let f=oy(h),p=oy(d);for(p.setUTCFullYear(f.getUTCFullYear()),p<f&&p.setUTCFullYear(p.getUTCFullYear()+1);p>f;)p.setUTCMonth(p.getUTCMonth()-12/m);p.setUTCMonth(p.getUTCMonth()+12/m);let{days:C}=oU(h,oC(p),g);return nQ.create(C)}},oG.COUPDAYSNC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ru.create(ea.NUM);let f=oX(h,d,m);return nQ.create(f)}},oG.COUPNCD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d)||0>oK(h,d,m))return ru.create(ea.NUM);let f=oq(h,d,m);return nQ.create(f)}},oG.COUPNUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sW(e,t,r,null!=n?n:nQ.create(0));if(i)return s;let[o,l,u,c]=a,h=oO(o);if("number"!=typeof h)return h;let d=oO(l);if("number"!=typeof d)return d;let m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(m)||Number.isNaN(g))return ru.create(ea.VALUE);if(![1,2,4].includes(m)||g<0||g>4||Math.floor(h)>=Math.floor(d))return ru.create(ea.NUM);let f=oK(h,d,m);return f<0&&(f=0),nQ.create(f)}},oG.COUPPCD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sW(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)?ru.create(ea.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||_>p||y>p||![0,1].includes(E)?ru.create(ea.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nQ.create(0):this._getResult(f,p,C,_,y,E)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(0===s&&(o=-r),l++);let u=!1;for(let t=l;t<=i;t++){let n=1===s?oJ(e,t-2,a,r,1):oJ(e,t-1,a,r,0);if(0===n){u=!0;break}o+=1===s?n-a:n}return((o*=e)<a*(i-n+1)||u)&&(o=a*(i-n+1)),nQ.create(o)}},oG.CUMIPMT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sW(e,t,r,n,i,s);if(a)return o;let[u,c,h,d,m,g]=l,f=+u.getValue(),p=+c.getValue(),C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue();return Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)?ru.create(ea.VALUE):f<=0||p<=0||C<=0||_<1||y<1||_>y||![0,1].includes(E)?ru.create(ea.NUM):Math.trunc(_)!==_&&Math.trunc(y)!==y&&Math.trunc(_)===Math.trunc(y)?nQ.create(0):this._getResult(f,p,C,_,y,E)}_getResult(e,t,r,n,i,s){let a=oZ(e,t,r,0,s),o=0,l=Math.ceil(n);1===l&&(o=0===s?a+r*e:a,l++);for(let t=l;t<=i;t++)o+=1===s?a-(oJ(e,t-2,a,r,1)-a)*e:a-oJ(e,t-1,a,r,0)*e;return nQ.create(o)}},oG.CUMPRINC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5),J(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nQ.create(12);s.isNull()&&(s=nQ.create(12));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=ii(a,o,e,ru.create(ea.NA)),u=ii(a,o,t,ru.create(ea.NA)),c=ii(a,o,r,ru.create(ea.NA)),h=ii(a,o,n,ru.create(ea.NA)),d=ii(a,o,s,ru.create(ea.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),i=c.get(t,r),{isError:s,errorObject:a,variants:o}=sY(e,n,i,h.get(t,r),d.get(t,r));if(s)return a;let[l,m,g,f,p]=o,C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),E=+f.getValue(),R=Math.floor(+p.getValue());return C<0||_<0||y<=0||E<=0||Math.floor(E)>Math.floor(y)||R<1||R>12?ru.create(ea.NUM):(E<1&&(E=1),E=Math.floor(E),this._getResult(C,_,y,E,R,t,r))});return 1===a&&1===o?m.get(0,0):m}_getResult(e,t,r,n,i,s,a){let o,l=+(1-(t/e)**(1/r)).toFixed(3),u=e*l*i/12,c=u,h=0,d=n===r?r-1:n;for(let t=2;t<=d;t++)h=(e-c)*l,c+=h;return Number.isNaN(o=1===n?u:n===r?(e-c)*l:h)||!Number.isFinite(o)?ru.create(ea.NUM):0===s&&0===a?nQ.create(o,rn(this.getLocale())):nQ.create(o)}},oG.DB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5),J(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=i?i:nQ.create(2);s.isNull()&&(s=nQ.create(2));let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,s.isArray()?s.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,s.isArray()?s.getColumnCount():1),l=ii(a,o,e,ru.create(ea.NA)),u=ii(a,o,t,ru.create(ea.NA)),c=ii(a,o,r,ru.create(ea.NA)),h=ii(a,o,n,ru.create(ea.NA)),d=ii(a,o,s,ru.create(ea.NA)),m=l.map((e,t,r)=>{let n=u.get(t,r),i=c.get(t,r),{isError:s,errorObject:a,variants:o}=sY(e,n,i,h.get(t,r),d.get(t,r));if(s)return a;let[l,m,g,f,p]=o,C=+l.getValue(),_=+m.getValue(),y=+g.getValue(),E=+f.getValue(),R=+p.getValue();if(C<0||_<0||y<=0||E<=0||E>y||R<=0)return ru.create(ea.NUM);let b=o7(C,_,y,E,R);return Number.isNaN(b)||!Number.isFinite(b)?ru.create(ea.NUM):0===t&&0===r?nQ.create(b,rn(this.getLocale())):nQ.create(b)});return 1===a&&1===o?m.get(0,0):m}},oG.DDB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sW(e,t,r,n,null!=i?i:nQ.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ru.create(ea.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return ru.create(ea.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nQ.create((p-f)/p*(y/_))}},oG.DISC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);if(l>=0&&l<1)return ru.create(ea.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);u+=o%1*10**Math.ceil(Math.log(l)/Math.LN10)/l;let c=10**(Math.ceil(Math.log(l)/Math.LN2)+1);return u=Math.round(u*c)/c,nQ.create(u)}},oG.DOLLARDE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(l<0)return ru.create(ea.NUM);if(l>=0&&l<1)return ru.create(ea.DIV_BY_ZERO);l=Number.parseInt(`${l}`,10);let u=Number.parseInt(`${o}`,10);return u+=o%1*10**-Math.ceil(Math.log(l)/Math.LN10)*l,nQ.create(u)}},oG.DOLLARFR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nQ.create(0);a.isNull()&&(a=nQ.create(0));let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),E=Math.floor(+g.getValue()),R=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(R))return ru.create(ea.VALUE);if(_<0||y<0||![1,2,4].includes(E)||R<0||R>4||Math.floor(p)>=Math.floor(C)||p<=0||C<=366)return ru.create(ea.NUM);let b=oQ(p,C,_,y,E,R);return nQ.create(b)}},oG.DURATION],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(o<=0||l<1)return ru.create(ea.NUM);l=Number.parseInt(`${l}`,10);let u=(1+o/l)**l-1;return nQ.create(u)}},oG.EFFECT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5),J(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sY(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=oJ(C,_,y,+f.getValue(),+!!+p.getValue());return Number.isNaN(E)||!Number.isFinite(E)?ru.create(ea.NUM):0===t&&0===r?nQ.create(E,rn(this.getLocale())):nQ.create(E)});return 1===o&&1===l?g.get(0,0):g}},oG.FV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e);if(r)return n;let[s]=i,a=+s.getValue();if(Number.isNaN(a))return ru.create(ea.VALUE);let o=a;if(t.isArray()){let e=t.getArrayValue().flat();for(let t=0;t<e.length;t++){let r=e[t];if(r.isBoolean())return ru.create(ea.VALUE);let n=+r.getValue();if(Number.isNaN(n))return ru.create(ea.VALUE);o*=1+n}}else{if(t.isBoolean())return ru.create(ea.VALUE);let e=+t.getValue();if(Number.isNaN(e))return ru.create(ea.VALUE);o*=1+e}return nQ.create(o)}},oG.FVSCHEDULE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sW(e,t,r,n,null!=i?i:nQ.create(0));if(s)return a;let[l,u,c,h,d]=o,m=oO(l);if("number"!=typeof m)return m;let g=oO(u);if("number"!=typeof g)return g;let f=+c.getValue(),p=+h.getValue(),C=Math.floor(+d.getValue());if(Number.isNaN(f)||Number.isNaN(p)||Number.isNaN(C))return ru.create(ea.VALUE);if(f<=0||p<=0||C<0||C>4||Math.floor(m)>=Math.floor(g))return ru.create(ea.NUM);let{days:_,yearDays:y}=oU(m,g,C);return nQ.create((p-f)/f*(y/_))}},oG.INTRATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",6),J(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nQ.create(0),o=null!=s?s:nQ.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,e,ru.create(ea.NA)),h=ii(l,u,t,ru.create(ea.NA)),d=ii(l,u,r,ru.create(ea.NA)),m=ii(l,u,n,ru.create(ea.NA)),g=ii(l,u,a,ru.create(ea.NA)),f=ii(l,u,o,ru.create(ea.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),{isError:a,errorObject:o,variants:l}=sY(e,n,i,s,g.get(t,r),f.get(t,r));if(a)return o;let[u,c,p,C,_,y]=l,E=+u.getValue(),R=+c.getValue(),b=+p.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();if(R<1||Math.floor(R)>Math.ceil(b))return ru.create(ea.NUM);let A=o0(E,R,b,I,N,+!!S);return Number.isNaN(A)||!Number.isFinite(A)?ru.create(ea.NUM):0===t&&0===r?nQ.create(A,rn(this.getLocale())):nQ.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.IPMT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(.1);return r.isNull()&&(r=nQ.create(.1)),r.isArray()?r.map((t,r,n)=>this._handleSingleObject(e,t,r,n)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,n=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return ru.create(ea.VALUE);if(!e.isArray())return ru.create(ea.NUM);let{_values:i,valuesHasError:s}=this._getValues(e);if(s)return ru.create(ea.VALUE);let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()).isError())return a;let o=+a.getValue(),{positive:l,negative:u}=this._checkValues(i);if(!l||!u)return ru.create(ea.NUM);let c=o9(o,e=>o1(e,i));return"number"!=typeof c?c:0===r&&0===n?nQ.create(c,"0%"):nQ.create(c)}_getValues(e){let t=[],r=!1;return e.iterator(e=>{if(e.isError())return r=!0,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;t.push(n)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}},oG.IRR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.map((e,t,r)=>{let n=o.get(t,r),{isError:i,errorObject:s,variants:a}=sY(e,n,l.get(t,r),u.get(t,r));if(i)return s;let[c,h,d,m]=a,g=+c.getValue(),f=+h.getValue(),p=+d.getValue(),C=+m.getValue();return 0===p?ru.create(ea.DIV_BY_ZERO):nQ.create(C*g*(f/p-1))});return 1===i&&1===s?c.get(0,0):c}},oG.ISPMT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nQ.create(0);a.isNull()&&(a=nQ.create(0));let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=+d.getValue(),y=+m.getValue(),E=Math.floor(+g.getValue()),R=Math.floor(+f.getValue());if(Number.isNaN(_)||Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(R))return ru.create(ea.VALUE);if(_<0||y<0||![1,2,4].includes(E)||R<0||R>4||Math.floor(p)>=Math.floor(C))return ru.create(ea.NUM);let b=oQ(p,C,_,y,E,R);return b/=1+y/E,nQ.create(b)}},oG.MDURATION],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{_values:n,numberValues:i,positive:s,negative:a}=this._getValues(e),o=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),u=ii(o,l,t,ru.create(ea.NA)),c=ii(o,l,r,ru.create(ea.NA)),h=u.map((t,r,o)=>{let l=c.get(r,o);if(e.isError())return e;if(l.isError())return l;if(n.isError())return n;if(!s||!a)return ru.create(ea.DIV_BY_ZERO);let u=+t.getValue(),h=+l.getValue();if(Number.isNaN(u)||Number.isNaN(h))return ru.create(ea.VALUE);if(-1===h)return ru.create(ea.DIV_BY_ZERO);let d=this._getResult(i,u,h);return 0===r&&0===o?nQ.create(d,"0%"):nQ.create(d)});return 1===o&&1===l?h.get(0,0):h}_getValues(e){let t=e,r=[],n=!1,i=!1;if(!e.isError())if(e.isNull())t=ru.create(ea.VALUE);else if(e.isArray()){let{numberValues:s,valuesHasError:a,errorObject:o,positive:l,negative:u}=this._checkValues(e);a&&(t=o),r=s,n=l,i=u}else t=ru.create(ea.DIV_BY_ZERO);return{_values:t,numberValues:r,positive:n,negative:i}}_checkValues(e){let t=[],r=!1,n=ru.create(ea.VALUE),i=!1,s=!1;return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return!0;let a=+e.getValue();if(Number.isNaN(a))return!0;a>0&&(i=!0),a<0&&(s=!0),t.push(a)}),{numberValues:t,valuesHasError:r,errorObject:n,positive:i,negative:s}}_getResult(e,t,r){let n=e.length,i=[],s=[];for(let t=0;t<n;t++)e[t]>0?s.push(e[t]):e[t]<0&&i.push(e[t]);let a=this._npv(r,e,"positive"),o=this._npv(t,e,"negative"),l=-a*(1+r)**n,u=o*(1+t);return(l/u)**(1/(n-1))-1}_npv(e,t,r){let n=0;for(let i=1;i<=t.length;i++){let s=t[i-1];("positive"===r&&s>0||"negative"===r&&s<0)&&(n+=s/(1+e)**i)}return n}},oG.MIRR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(o<=0||l<1)return ru.create(ea.NUM);l=Number.parseInt(`${l}`,10);let u=((o+1)**(1/l)-1)*l;return nQ.create(u)}},oG.NOMINAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.map((e,t,r)=>{let n,i=c.get(t,r),s=h.get(t,r),{isError:a,errorObject:o,variants:l}=sY(e,i,s,d.get(t,r),m.get(t,r));if(a)return o;let[u,g,f,p,C]=l,_=+u.getValue(),y=+g.getValue(),E=+f.getValue(),R=+p.getValue(),b=+C.getValue();return(b=+!!b,0===_&&0===y)?ru.create(ea.DIV_BY_ZERO):Number.isNaN(n=0===_?-(E+R)/y:Math.log((y*(1+_*b)-R*_)/(E*_+y*(1+_*b)))/Math.log(1+_))||!Number.isFinite(n)?ru.create(ea.NUM):nQ.create(n)});return 1===o&&1===l?g.get(0,0):g}},oG.NPER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255),J(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;let{isError:r,errorObject:n,values:i}=this._getValues(t);return e.isArray()?e.map((e,t,s)=>this._handleSingleObject(e,r,n,i,t,s)):this._handleSingleObject(e,r,n,i)}_handleSingleObject(e,t,r,n,i=0,s=0){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(t)return r;let o=o1(+e.getValue(),n);return Number.isNaN(o)||Math.abs(o)===1/0?ru.create(ea.DIV_BY_ZERO):0===i&&0===s?nQ.create(o,rn(this.getLocale())):nQ.create(o)}_getValues(e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return{isError:!0,errorObject:n};if(n.isArray()){let e=!1,r=ru.create(ea.VALUE);if(n.iterator(n=>{if(n.isError())return e=!0,r=n,!1;if(n.isNull()||n.isBoolean())return!0;let i=+n.getValue();if(Number.isNaN(i))return!0;t.push(i)}),e)return{isError:e,errorObject:r}}else{let e=+n.getValue();if(Number.isNaN(e))return{isError:!0,errorObject:ru.create(ea.VALUE)};t.push(e)}}return{isError:!1,values:t}}},oG.NPV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",8),J(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nQ.create(0);u.isNull()&&(u=nQ.create(0));let{isError:c,errorObject:h,variants:d}=sG(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,E,R]=d,b=oO(m);if("number"!=typeof b)return b;let I=oO(g);if("number"!=typeof I)return I;let N=oO(f);if("number"!=typeof N)return N;let S=oO(p);if("number"!=typeof S)return S;let A=+C.getValue(),v=+_.getValue(),T=+y.getValue(),w=Math.floor(+E.getValue()),M=Math.floor(+R.getValue());if(Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(T)||Number.isNaN(w)||Number.isNaN(M))return ru.create(ea.VALUE);if(A<0||v<0||T<=0||![1,2,4].includes(w)||M<0||M>4||!this._validDate(I,S,b,N,w))return ru.create(ea.NUM);let O=o2(b,I,N,S,A,v,T,w,M);return nQ.create(O)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}},oG.ODDFPRICE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",8),J(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o,l){let u=null!=l?l:nQ.create(0);u.isNull()&&(u=nQ.create(0));let{isError:c,errorObject:h,variants:d}=sG(e,t,r,n,i,s,a,o,u);if(c)return h;let[m,g,f,p,C,_,y,E,R]=d,b=oO(m);if("number"!=typeof b)return b;let I=oO(g);if("number"!=typeof I)return I;let N=oO(f);if("number"!=typeof N)return N;let S=oO(p);if("number"!=typeof S)return S;let A=+C.getValue(),v=+_.getValue(),T=+y.getValue(),w=Math.floor(+E.getValue()),M=Math.floor(+R.getValue());return Number.isNaN(A)||Number.isNaN(v)||Number.isNaN(T)||Number.isNaN(w)||Number.isNaN(M)?ru.create(ea.VALUE):A<0||v<=0||T<=0||![1,2,4].includes(w)||M<0||M>4||!this._validDate(I,S,b,N,w)?ru.create(ea.NUM):this._getResult(b,I,N,S,A,v,T,w,M)}_validDate(e,t,r,n,i){return this._getDateCorrectOrder(e,t,r,n)&&o3(e,t,i)&&o4(n,e,i)}_getDateCorrectOrder(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(n)}_getResult(e,t,r,n,i,s,a,o,l){let{days:u}=oU(e,t,l),c=o9((i*u*100-(s-100))/((s-100)*.25*(1+2*u)+100*u),u=>s-o2(e,t,r,n,i,u,a,o,l));return"number"!=typeof c?c:nQ.create(c)}},oG.ODDFYIELD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",7),J(this,"maxParams",8)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nQ.create(0);l.isNull()&&(l=nQ.create(0));let{isError:u,errorObject:c,variants:h}=sG(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,E=oO(d);if("number"!=typeof E)return E;let R=oO(m);if("number"!=typeof R)return R;let b=oO(g);if("number"!=typeof b)return b;let I=+f.getValue(),N=+p.getValue(),S=+C.getValue(),A=Math.floor(+_.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v))return ru.create(ea.VALUE);if(I<0||N<0||S<=0||![1,2,4].includes(A)||v<0||v>4||!this._validDate(R,E,b,A))return ru.create(ea.NUM);let T=this._getResult(E,R,b,I,N,S,A,v);return nQ.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(s*a+100*n*(c-u*(1+i*h/a)))/(i*h+a)}_getCoupDate(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return oC(i)}_getFrac(e,t,r,n,i){let s=oy(e),a=oy(t),o=oy(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=oC(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=oC(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oy(u),m=oy(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=oC(d),u=oC(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLPRICE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",8),J(this,"maxParams",9)}calculate(e,t,r,n,i,s,a,o){let l=null!=o?o:nQ.create(0);l.isNull()&&(l=nQ.create(0));let{isError:u,errorObject:c,variants:h}=sG(e,t,r,n,i,s,a,l);if(u)return c;let[d,m,g,f,p,C,_,y]=h,E=oO(d);if("number"!=typeof E)return E;let R=oO(m);if("number"!=typeof R)return R;let b=oO(g);if("number"!=typeof b)return b;let I=+f.getValue(),N=+p.getValue(),S=+C.getValue(),A=Math.floor(+_.getValue()),v=Math.floor(+y.getValue());if(Number.isNaN(I)||Number.isNaN(N)||Number.isNaN(S)||Number.isNaN(A)||Number.isNaN(v))return ru.create(ea.VALUE);if(I<0||N<=0||S<=0||![1,2,4].includes(A)||v<0||v>4||!this._validDate(R,E,b,A))return ru.create(ea.NUM);let T=this._getResult(E,R,b,I,N,S,A,v);return nQ.create(T)}_validDate(e,t,r,n){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&o4(r,e,n)}_getResult(e,t,r,n,i,s,a,o){let l=this._getCoupDate(t,r,a),u=this._getFrac(r,e,l,a,o),c=this._getFrac(r,t,l,a,o),h=this._getFrac(e,t,l,a,o);return(a*(s-i)+100*n*(c-u))/(h*i+100*n*u*h/a)}_getCoupDate(e,t,r){let n=oy(e),i=oy(t);for(i.setUTCFullYear(n.getUTCFullYear()),i>n&&i.setUTCFullYear(i.getUTCFullYear()-1);i<n;)i.setUTCMonth(i.getUTCMonth()+12/r);return oC(i)}_getFrac(e,t,r,n,i){let s=oy(e),a=oy(t),o=oy(r);for(o.setUTCFullYear(s.getUTCFullYear()),o<s&&o.setUTCFullYear(o.getUTCFullYear()+1);o>s;)o.setUTCMonth(o.getUTCMonth()-12/n);let l=oC(o);o.setUTCMonth(o.getUTCMonth()+12/n);let u=oC(o);if(u>=t){let{days:r}=oU(e,t,i);return r/oz(l,u,n,i)}let{days:c}=oU(e,u,i),h=c/oz(l,u,n,i),d=oy(u),m=oy(u);for(m.setUTCMonth(m.getUTCMonth()+12/n);m<a;)d.setUTCMonth(d.getUTCMonth()+12/n),m.setUTCMonth(m.getUTCMonth()+12/n),h+=1;l=oC(d),u=oC(m);let{days:g}=oU(l,t,i);return h+g/oz(l,u,n,i)}},oG.ODDLYIELD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sY(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=-1)return ru.create(ea.NUM);let g=(Math.log(m)-Math.log(d))/Math.log(1+h);return Number.isNaN(g)||!Number.isFinite(g)?ru.create(ea.NUM):nQ.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.PDURATION],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5),J(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sY(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=+f.getValue(),R=+p.getValue();if(C<=-1)return ru.create(ea.NUM);let b=oZ(C,_,y,E,+!!R);return Number.isNaN(b)||!Number.isFinite(b)?ru.create(ea.NUM):0===t&&0===r?nQ.create(b,rn(this.getLocale())):nQ.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PMT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",6),J(this,"needsLocale",!0)}calculate(e,t,r,n,i,s){let a=null!=i?i:nQ.create(0),o=null!=s?s:nQ.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,e,ru.create(ea.NA)),h=ii(l,u,t,ru.create(ea.NA)),d=ii(l,u,r,ru.create(ea.NA)),m=ii(l,u,n,ru.create(ea.NA)),g=ii(l,u,a,ru.create(ea.NA)),f=ii(l,u,o,ru.create(ea.NA)),p=c.map((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),{isError:a,errorObject:o,variants:l}=sY(e,n,i,s,g.get(t,r),f.get(t,r));if(a)return o;let[u,c,p,C,_,y]=l,E=+u.getValue(),R=+c.getValue(),b=+p.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();if(R<1||Math.floor(R)>Math.ceil(b)||R-b>=1)return ru.create(ea.NUM);let A=oZ(E,b,I,N,+!!S)-o0(E,R,b,I,N,+!!S);return Number.isNaN(A)||!Number.isFinite(A)?ru.create(ea.NUM):0===t&&0===r?nQ.create(A,rn(this.getLocale())):nQ.create(A)});return 1===l&&1===u?p.get(0,0):p}},oG.PPMT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nQ.create(0);o.isNull()&&(o=nQ.create(0));let{isError:l,errorObject:u,variants:c}=sG(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=oO(h);if("number"!=typeof _)return _;let y=oO(d);if("number"!=typeof y)return y;let E=+m.getValue(),R=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue()),N=Math.floor(+C.getValue());if(Number.isNaN(E)||Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(I)||Number.isNaN(N))return ru.create(ea.VALUE);if(E<0||R<0||b<=0||![1,2,4].includes(I)||N<0||N>4||_>=y||!o4(_,y,I))return ru.create(ea.NUM);let S=o8(_,y,E,R,b,I,N);return nQ.create(S)}},oG.PRICE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nQ.create(0);s.isNull()&&(s=nQ.create(0));let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ru.create(ea.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ru.create(ea.NUM);let{days:y,yearDays:E}=oU(g,f,_);return nQ.create(C-p*C*y/E)}},oG.PRICEDISC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nQ.create(0);a.isNull()&&(a=nQ.create(0));let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+m.getValue(),E=+g.getValue(),R=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(R))return ru.create(ea.VALUE);let b=this._getDateCorrectOrder(C,p,_);if(y<0||E<0||R<0||R>4||!b)return ru.create(ea.NUM);let I=oF(p,R),{days:N}=oU(p,C,R),{days:S}=oU(_,C,R),{days:A}=oU(_,p,R),v=(100+S/I*y*100)/(1+N/I*E)-A/I*y*100;return nQ.create(v)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.PRICEMAT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5),J(this,"needsLocale",!0)}calculate(e,t,r,n,i){let s=null!=n?n:nQ.create(0),a=null!=i?i:nQ.create(0),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,e,ru.create(ea.NA)),c=ii(o,l,t,ru.create(ea.NA)),h=ii(o,l,r,ru.create(ea.NA)),d=ii(o,l,s,ru.create(ea.NA)),m=ii(o,l,a,ru.create(ea.NA)),g=u.map((e,t,r)=>{let n=c.get(t,r),i=h.get(t,r),{isError:s,errorObject:a,variants:o}=sY(e,n,i,d.get(t,r),m.get(t,r));if(s)return a;let[l,u,g,f,p]=o,C=+l.getValue(),_=+u.getValue(),y=+g.getValue(),E=+f.getValue(),R=+p.getValue();R=+!!R;let b=0===C?-y*_-E:((1-(1+C)**_)/C*y*(1+C*R)-E)/(1+C)**_;return Number.isNaN(b)||!Number.isFinite(b)?ru.create(ea.NUM):0===t&&0===r?nQ.create(b,rn(this.getLocale())):nQ.create(b)});return 1===o&&1===l?g.get(0,0):g}},oG.PV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=n?n:nQ.create(0),o=null!=i?i:nQ.create(0),l=null!=s?s:nQ.create(.1),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ii(u,c,e,ru.create(ea.NA)),d=ii(u,c,t,ru.create(ea.NA)),m=ii(u,c,r,ru.create(ea.NA)),g=ii(u,c,a,ru.create(ea.NA)),f=ii(u,c,o,ru.create(ea.NA)),p=ii(u,c,l,ru.create(ea.NA)),C=h.map((e,t,r)=>{let n=d.get(t,r),i=m.get(t,r),s=g.get(t,r),{isError:a,errorObject:o,variants:l}=sY(e,n,i,s,f.get(t,r),p.get(t,r));if(a)return o;let[u,c,h,C,_,y]=l,E=+u.getValue(),R=+c.getValue(),b=+h.getValue(),I=+C.getValue(),N=+_.getValue(),S=+y.getValue();return N=+!!N,E<=0||R>=0?ru.create(ea.NUM):this._getResult(E,R,b,I,N,S,t,r)});return 1===u&&1===c?C.get(0,0):C}_getResult(e,t,r,n,i,s,a,o){let l=s;for(let s=0;s<20;s++){let s,a,o;if(l<=-1)return ru.create(ea.NUM);if(1e-10>Math.abs(s=1e-10>Math.abs(l)?r*(1+e*l)+t*(1+l*i)*e+n:r*(a=(1+l)**e)+t*(1/l+i)*(a-1)+n))break;if(1e-10>Math.abs(l))o=r*e+t*i*e;else{a=(1+l)**e;let n=e*(1+l)**(e-1);o=r*n+t*(1/l+i)*n+-1/(l*l)*t*(a-1)}l-=s/o}return 0===a&&0===o?nQ.create(l,"0%"):nQ.create(l)}},oG.RATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nQ.create(0);s.isNull()&&(s=nQ.create(0));let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ru.create(ea.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ru.create(ea.NUM);let{days:y,yearDays:E}=oU(g,f,_),R=p/(1-C*y/E);return R<0?ru.create(ea.NUM):nQ.create(R)}},oG.RECEIVED],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",6)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.map((e,t,r)=>{let{isError:n,errorObject:i,variants:s}=sY(e,a.get(t,r),o.get(t,r));if(n)return i;let[l,u,c]=s,h=+l.getValue(),d=+u.getValue(),m=+c.getValue();if(h<=0)return ru.create(ea.NUM);if(0===d&&0===m)return nQ.create(0);let g=(m/d)**(1/h)-1;return Number.isNaN(g)||!Number.isFinite(g)||m/d<0?ru.create(ea.NUM):nQ.create(g)});return 1===n&&1===i?l.get(0,0):l}},oG.RRI],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3),J(this,"needsLocale",!0)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.map((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(n.isError())return n;if(i.isError())return i;let s=+e.getValue(),l=+n.getValue(),u=+i.getValue();if(Number.isNaN(s)||Number.isNaN(l)||Number.isNaN(u))return ru.create(ea.VALUE);if(0===u)return ru.create(ea.DIV_BY_ZERO);let c=(s-l)/u;return 0===t&&0===r?nQ.create(c,rn(this.getLocale())):nQ.create(c)});return 1===n&&1===i?l.get(0,0):l}},oG.SLN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4),J(this,"needsLocale",!0)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let a=+e.getValue(),c=+n.getValue(),h=+i.getValue(),d=+s.getValue();if(Number.isNaN(a)||Number.isNaN(c)||Number.isNaN(h)||Number.isNaN(d))return ru.create(ea.VALUE);if(c<0||h<=0||d>h)return ru.create(ea.NUM);let m=(a-c)*(h-d+1)*2/(h*(h+1));return 0===t&&0===r?nQ.create(m,rn(this.getLocale())):nQ.create(m)});return 1===i&&1===s?c.get(0,0):c}},oG.SYD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sG(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ru.create(ea.VALUE);if(h<=0||u>=c)return ru.create(ea.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oy(u).getUTCFullYear()))return ru.create(ea.NUM);let m=365*h/(360-h*d);if(d>182){let e=d/365;if(Number.isNaN(m=(-e+Math.sqrt(e*e-(2*e-1)*(1-100/(100*(1-h*d/360)))))/(e-.5)))return ru.create(ea.NUM)}return m<0?ru.create(ea.NUM):nQ.create(m)}},oG.TBILLEQ],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3),J(this,"needsLocale",!0)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sG(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ru.create(ea.VALUE);if(h<=0||u>=c)return ru.create(ea.NUM);let d=Math.floor(c)-Math.floor(u);if(d>oP(oy(u).getUTCFullYear()))return ru.create(ea.NUM);let m=100*(1-h*d/360);return m<0?ru.create(ea.NUM):nQ.create(m,rn(this.getLocale()))}},oG.TBILLPRICE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sG(e,t,r);if(n)return i;let[a,o,l]=s,u=oO(a);if("number"!=typeof u)return u;let c=oO(o);if("number"!=typeof c)return c;let h=+l.getValue();if(Number.isNaN(h))return ru.create(ea.VALUE);if(h<=0||u>=c)return ru.create(ea.NUM);let d=Math.floor(c)-Math.floor(u);return d>oP(oy(u).getUTCFullYear())?ru.create(ea.NUM):nQ.create((100-h)/h*360/d)}},oG.TBILLYIELD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",7),J(this,"needsLocale",!0)}calculate(e,t,r,n,i,s,a){let o=null!=s?s:nQ.create(2);o.isNull()&&(o=nQ.create(2));let l=null!=a?a:nK.create(!1);l.isNull()&&(l=nK.create(!1));let u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ii(u,c,e,ru.create(ea.NA)),d=ii(u,c,t,ru.create(ea.NA)),m=ii(u,c,r,ru.create(ea.NA)),g=ii(u,c,n,ru.create(ea.NA)),f=ii(u,c,i,ru.create(ea.NA)),p=ii(u,c,o,ru.create(ea.NA)),C=ii(u,c,l,ru.create(ea.NA));return this._getResultArray(h,d,m,g,f,p,C,u,c)}_getResultArray(e,t,r,n,i,s,a,o,l){let u=e.map((e,o,l)=>{let u=t.get(o,l),c=r.get(o,l),h=n.get(o,l),d=i.get(o,l),{isError:m,errorObject:g,variants:f}=sY(e,u,c,h,d,s.get(o,l),a.get(o,l));if(m)return g;let[p,C,_,y,E,R,b]=f,I=+p.getValue(),N=+C.getValue(),S=+_.getValue(),A=+y.getValue(),v=+E.getValue(),T=+R.getValue(),w=+b.getValue();if(I<0||N<0||S<0||A<0||v<0||v>S||A>v||T<0)return ru.create(ea.NUM);if(0===S&&0===A&&0===v)return ru.create(ea.DIV_BY_ZERO);let M=this._getResult(I,N,S,A,v,T,w);return 0===o&&0===l?nQ.create(M,rn(this.getLocale())):nQ.create(M)});return 1===o&&1===l?u.get(0,0):u}_getResult(e,t,r,n,i,s,a){let o=Math.floor(n),l=Math.ceil(i),u=0;if(e<t){if(n>=1||a)return u;let r=Math.abs(e-t);return-(u=r*(i-n)>r?r:r*(i-n))}if(a)for(let a=o+1;a<=l;a++){let c=o7(e,t,r,a,s);a===o+1?c*=Math.min(i,o+1)-n:a===l&&(c*=i+1-l),u+=c}else{let a=e-this._getVdb(e,t,r,r,n,s);u=this._getVdb(a,t,r,r-n,i-n,s)}return u}_getVdb(e,t,r,n,i,s){let a=Math.ceil(i),o=0,l=e-t,u=0,c=0,h=!1;for(let d=1;d<=a;d++){if(h)c=u;else{let i=o7(e,t,r,d,s);(u=l/(n-(d-1)))>i?(c=u,h=!0):(c=i,l-=i)}d===a&&(c*=i+1-a),o+=c}return o}},oG.VDB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return ru.create(ea.NA);let{isError:n,errorObejct:i,_values:s,_dates:a}=this._checkErrors(e,t);if(n)return i;let o=null!=r?r:nQ.create(.1);o.isNull()&&(o=nQ.create(.1));let{isError:l,errorObject:u,variants:c}=sW(o);if(l)return u;let[h]=c,d=+h.getValue();if(Number.isNaN(d))return ru.create(ea.VALUE);let{positive:m,negative:g}=this._checkValues(s);if(!m||!g||(null==s?void 0:s.length)!==(null==a?void 0:a.length)||d<0)return ru.create(ea.NUM);let f=o9(d,e=>this._iterF(s,a,e));return"number"!=typeof f?f:nQ.create(f)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isBoolean())return r=!0,n=ru.create(ea.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=ru.create(ea.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ru.create(ea.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,j.isRealNum)(t)?{isError:!0,errorObejct:ru.create(ea.VALUE)}:{isError:!0,errorObejct:ru.create(ea.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);return e.iterator(e=>{if(null!=e&&e.isError())return r=!0,n=e,!1;if(null!=e&&e.isBoolean())return r=!0,n=ru.create(ea.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=ru.create(ea.VALUE),!1):i<0?(r=!0,n=ru.create(ea.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ru.create(ea.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,j.isRealNum)(t)?{isError:!0,errorObejct:ru.create(ea.VALUE)}:0>+t?{isError:!0,errorObejct:ru.create(ea.NUM)}:{isError:!0,errorObejct:ru.create(ea.NA)}}}_checkValues(e){let t=!1,r=!1;for(let n=0;n<e.length;n++)e[n]>0&&(t=!0),e[n]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((e,n,i)=>e+n/(1+r)**((t[i]-t[0])/365),0)}},oG.XIRR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return ru.create(ea.NA);let{isError:n,errorObject:i,variants:s}=sW(e);if(n)return i;let[a]=s,o=+a.getValue();if(Number.isNaN(o))return ru.create(ea.VALUE);let{isError:l,errorObejct:u,_values:c,_dates:h}=this._checkErrors(t,r);if(l)return u;if(o<0||c.length!==h.length)return ru.create(ea.NUM);let d=0,m=h[0];for(let e=0;e<h.length;e++){let t=h[e];d+=c[e]/(1+o)**((t-m)/365)}return nQ.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:n,_values:i}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:n};let{isError:s,errorObejct:a,_dates:o}=this._checkErrorDates(t);return s?{isError:s,errorObejct:a}:{isError:!1,_values:i,_dates:o}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=ru.create(ea.VALUE),!1;let i=+e.getValue();if(Number.isNaN(i))return r=!0,n=ru.create(ea.VALUE),!1;t.push(i)}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ru.create(ea.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,j.isRealNum)(t)?{isError:!0,errorObejct:ru.create(ea.VALUE)}:{isError:!0,errorObejct:ru.create(ea.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;if(e.isNull()||e.isBoolean())return r=!0,n=ru.create(ea.VALUE),!1;let i=+e.getValue();return Number.isNaN(i)?(r=!0,n=ru.create(ea.VALUE),!1):i<0?(r=!0,n=ru.create(ea.NUM),!1):void t.push(Math.floor(i))}),r?{isError:r,errorObejct:n}:t.length<=1?{isError:!0,errorObejct:ru.create(ea.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,j.isRealNum)(t)?{isError:!0,errorObejct:ru.create(ea.VALUE)}:0>+t?{isError:!0,errorObejct:ru.create(ea.NUM)}:{isError:!0,errorObejct:ru.create(ea.NA)}}}},oG.XNPV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",6),J(this,"maxParams",7)}calculate(e,t,r,n,i,s,a){let o=null!=a?a:nQ.create(0);o.isNull()&&(o=nQ.create(0));let{isError:l,errorObject:u,variants:c}=sG(e,t,r,n,i,s,o);if(l)return u;let[h,d,m,g,f,p,C]=c,_=oO(h);if("number"!=typeof _)return _;let y=oO(d);if("number"!=typeof y)return y;let E=+m.getValue(),R=+g.getValue(),b=+f.getValue(),I=Math.floor(+p.getValue()),N=Math.floor(+C.getValue());if(Number.isNaN(E)||Number.isNaN(R)||Number.isNaN(b)||Number.isNaN(I)||Number.isNaN(N))return ru.create(ea.VALUE);if(E<0||R<=0||b<=0||![1,2,4].includes(I)||N<0||N>4||_>=y||!o4(_,y,I))return ru.create(ea.NUM);let S=this._getResult(_,y,E,R,b,I,N);return nQ.create(S)}_getResult(e,t,r,n,i,s,a){if(oq(e,t,s)>1){let o=r||.01,l=o8(e,t,r,o,i,s,a),u=l-n;for(let c=0;c<100&&Math.abs(u)>1e-7;c++)l=o8(e,t,r,1.01*o,i,s,a),o+=-u/(l-n-u)*o*.01,u=o8(e,t,r,o,i,s,a)-n;return o}let o=oY(e,t,s,a),l=oz(e,t,s,a),{days:u}=oU(e,t,a),c=n/100+o/l*r/s;return(i/100+r/s-c)/c*s*l/u}},oG.YIELD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=null!=i?i:nQ.create(0);s.isNull()&&(s=nQ.create(0));let{isError:a,errorObject:o,variants:l}=sG(e,t,r,n,s);if(a)return o;let[u,c,h,d,m]=l,g=oO(u);if("number"!=typeof g)return g;let f=oO(c);if("number"!=typeof f)return f;let p=+h.getValue(),C=+d.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(p)||Number.isNaN(C)||Number.isNaN(_))return ru.create(ea.VALUE);if(p<=0||C<=0||_<0||_>4||g>=f)return ru.create(ea.NUM);let{days:y,yearDays:E}=oU(g,f,_);return nQ.create((C/p-1)/(y/E))}},oG.YIELDDISC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=s?s:nQ.create(0);a.isNull()&&(a=nQ.create(0));let{isError:o,errorObject:l,variants:u}=sG(e,t,r,n,i,a);if(o)return l;let[c,h,d,m,g,f]=u,p=oO(c);if("number"!=typeof p)return p;let C=oO(h);if("number"!=typeof C)return C;let _=oO(d);if("number"!=typeof _)return _;let y=+m.getValue(),E=+g.getValue(),R=Math.floor(+f.getValue());if(Number.isNaN(y)||Number.isNaN(E)||Number.isNaN(R))return ru.create(ea.VALUE);let b=this._getDateCorrectOrder(C,p,_);if(y<0||E<=0||R<0||R>4||!b)return ru.create(ea.NUM);let I=oF(p,R),{days:N}=oU(p,C,R),{days:S}=oU(_,C,R),{days:A}=oU(_,p,R),v=((1+S/I*y)/(E/100+A/I*y)-1)/(N/I);return nQ.create(v)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}},oG.YIELDMAT]];var lt=((U=lt||{}).CELL="CELL",U.ERROR_TYPE="ERROR.TYPE",U.INFO="INFO",U.ISBETWEEN="ISBETWEEN",U.ISBLANK="ISBLANK",U.ISDATE="ISDATE",U.ISEMAIL="ISEMAIL",U.ISERR="ISERR",U.ISERROR="ISERROR",U.ISEVEN="ISEVEN",U.ISFORMULA="ISFORMULA",U.ISLOGICAL="ISLOGICAL",U.ISNA="ISNA",U.ISNONTEXT="ISNONTEXT",U.ISNUMBER="ISNUMBER",U.ISODD="ISODD",U.ISOMITTED="ISOMITTED",U.ISREF="ISREF",U.ISTEXT="ISTEXT",U.ISURL="ISURL",U.N="N",U.NA="NA",U.SHEET="SHEET",U.SHEETS="SHEETS",U.TYPE="TYPE",U);let lr=[[class extends sz{constructor(){super(...arguments),J(this,"needsReferenceObject",!0),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),n=r.getColumnCount();if(1===e&&1===n){let e=r.get(0,0);return this._handleSingleObject(e,t)}return r.map(e=>e.isError()?e:this._handleSingleObject(e,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let n,i=t;if(i.isError())return i;if(!i.isReferenceObject())return ru.create(ea.NA);let{columnData:s,defaultColumnWidth:a}=i.getCurrentActiveSheetData(),o=(i=i.toArrayValueObject()).getCurrentRow(),l=i.getCurrentColumn();switch(i=i.getFirstCell(),`${e.getValue()}`.toLocaleLowerCase()){case"address":return nJ.create(`$${j.Tools.chatAtABC(l)}$${o+1}`);case"col":return nQ.create(l+1);case"color":case"parentheses":return nQ.create(0);case"contents":return i;case"filename":default:return ru.create(ea.VALUE);case"format":return nJ.create("G");case"prefix":return nJ.create("");case"protect":return nQ.create(1);case"row":return nQ.create(o+1);case"type":return n="v",i.isNull()&&(n="b"),i.isString()&&(n="l"),nJ.create(n);case"width":return this._getWidthResult(s,a,l,r)}}_getWidthResult(e,t,r,n){var i;let s=null==(i=e[r])?void 0:i.w;if(s||0===s||(s=t),n)return nQ.create(s);let a=[[s,s===t]];return n5.createByArray(a)}},lt.CELL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"_errorTypeValueMap",new Map([[ea.NULL,1],[ea.DIV_BY_ZERO,2],[ea.VALUE,3],[ea.REF,4],[ea.NAME,5],[ea.NUM,6],[ea.NA,7],[ea.CONNECT,8],[ea.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?nQ.create(r):ru.create(ea.NA)}},lt.ERROR_TYPE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5)}calculate(e,t,r,n,i){let{isError:s,errorObject:a,variants:o}=sH(e,t,r,null!=n?n:nK.create(!0),null!=i?i:nK.create(!0));if(s)return a;let[l,u,c,h,d]=o;if(h.isString()||d.isString())return ru.create(ea.VALUE);if(!0===u.compare(c,">").getValue())return ru.create(ea.NUM);let m=+h.getValue(),g=+d.getValue();return!1===l.compare(u,m?">=":">").getValue()||!1===l.compare(c,g?"<=":"<").getValue()?nK.create(!1):nK.create(!0)}},lt.ISBETWEEN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isNull()?nK.create(!0):e.isArray()?e.mapValue(e=>e.isNull()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISBLANK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}return t.isError()?t:t.isNumber()&&""!==t.getPattern()?nK.create(oS(t.getPattern())):t.isString()&&(ob(`${t.getValue()}`)||oN(`${t.getValue()}`))?nK.create(!0):nK.create(!1)}},lt.ISDATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nK.create(!1);let r=`${t.getValue()}`;if(r.length>254)return nK.create(!1);let n=j.Tools.topLevelDomainCombiningString(),i=RegExp(`^(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})$`,"i");return nK.create(i.test(r))}},lt.ISEMAIL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.getValue()===ea.NA?nK.create(!1):e.isError()?nK.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===ea.NA?nK.create(!1):e.isError()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISERR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?nK.create(!0):e.isArray()?e.mapValue(e=>e.isError()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISERROR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return ru.create(ea.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?ru.create(ea.VALUE):nK.create(r%2==0)}},lt.ISEVEN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return ru.create(ea.NA);let r=null==(t=e.getCurrentActiveSheetData())?void 0:t.cellData.getMatrix(),{startRow:n,startColumn:i}=e.getRangePosition(),s=e.toArrayValueObject(),a=s.mapValue((e,t,s)=>{var a;let o=null==(a=null==r?void 0:r[n+t])?void 0:a[i+s];return null!=o&&o.f||null!=o&&o.si?nK.create(!0):nK.create(!1)});return 1===s.getRowCount()&&1===s.getColumnCount()?a.get(0,0):a}},lt.ISFORMULA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isBoolean()?nK.create(!0):e.isArray()?e.mapValue(e=>e.isBoolean()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISLOGICAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.getValue()===ea.NA?nK.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===ea.NA?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISNA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()||e.isString()?e.isArray()?e.mapValue(e=>e.isString()?nK.create(!1):nK.create(!0)):nK.create(!1):nK.create(!0)}},lt.ISNONTEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isNumber()?nK.create(!0):e.isArray()?e.mapValue(e=>e.isNumber()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISNUMBER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return ru.create(ea.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?ru.create(ea.VALUE):nK.create(r%2!=0)}},lt.ISODD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nK.create(!0):nK.create(!1)}},lt.ISREF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isString()?nK.create(!0):e.isArray()?e.mapValue(e=>e.isString()?nK.create(!0):nK.create(!1)):nK.create(!1)}},lt.ISTEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isNull()||t.isBoolean()||t.isNumber())return nK.create(!1);let r=`${t.getValue()}`.replace(/^\s+|\s+$/g,"");if(r.length>1e3)return nK.create(!1);let n=j.Tools.topLevelDomainCombiningString(),i=RegExp(`^(?:(?:https?|s?ftp|ftps|nfs|ssh)://+[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})(?::[0-9]+)?(?:/(?:[A-Za-z0-9\\-._~!$&'()*+,;=:@]|%[A-Fa-f0-9]{2})*)*/?(?:[?#]\\S*)?|mailto:(?:[\\w+-]+\\.)*[\\w+-]+@[a-z0-9_-]+(?:\\.[a-z0-9_-]+)*\\.(?:${n})|(?:news|aim):[%a-z0-9$_\\.+!*(),;/?#:@&~=-]+)$`,"i");return nK.create(i.test(r))}},lt.ISURL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return nQ.create(0);let r=+t.getValue();return nQ.create(r)}},lt.N],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){return ru.create(ea.NA)}},lt.NA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",1),J(this,"needsReferenceObject",!0),J(this,"needsSheetsInfo",!0)}calculate(e){var t;if(null!=e&&e.isError())return e;let{sheetOrder:r,sheetNameMap:n}=this.getSheetsInfo();if(!e){let e=r.findIndex(e=>e===this.subUnitId);return nQ.create(e+1)}if(e.isReferenceObject()){let t=e.getForcedSheetId(),n=e.getDefaultSheetId(),i=r.findIndex(e=>t?e===t:e===n);return nQ.create(i+1)}if(e.isArray())return ru.create(ea.NA);let i=`${e.getValue()}`.toLocaleLowerCase(),s=null==(t=Object.entries(n).find(([e,t])=>t.toLocaleLowerCase()===i))?void 0:t[0];if(!s)return ru.create(ea.NA);let a=r.findIndex(e=>e===s);return nQ.create(a+1)}},lt.SHEET],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0),J(this,"needsSheetsInfo",!0)}calculate(){let{sheetOrder:e}=this.getSheetsInfo();return nQ.create(e.length)}},lt.SHEETS],[class extends sz{constructor(){super(...arguments),J(this,"needsReferenceObject",!0),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){let t=e.getRowCount(),r=e.getColumnCount();if(1!==t||1!==r)return nQ.create(64);{let t=e.getFirstCell();if(t.isError())return nQ.create(16);if(t.isBoolean())return nQ.create(4);if(t.isString())return nQ.create(2);if(t.isNumber()||t.isNull())return nQ.create(1)}}else{if(e.isArray())return nQ.create(64);if(e.isError())return nQ.create(16);if(e.isBoolean())return nQ.create(4);if(e.isString())return nQ.create(2);if(e.isNumber()||e.isNull())return nQ.create(1)}return nQ.create(128)}},lt.TYPE]];var ln=((D=ln||{}).AND="AND",D.BYCOL="BYCOL",D.BYROW="BYROW",D.FALSE="FALSE",D.IF="IF",D.IFERROR="IFERROR",D.IFNA="IFNA",D.IFS="IFS",D.LAMBDA="LAMBDA",D.LET="LET",D.MAKEARRAY="MAKEARRAY",D.MAP="MAP",D.NOT="NOT",D.OR="OR",D.REDUCE="REDUCE",D.SCAN="SCAN",D.SWITCH="SWITCH",D.TRUE="TRUE",D.XOR="XOR",D);let li=class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255),J(this,"needsReferenceObject",!0)}calculate(...e){let t=[],r=null,n=0,i=0;for(let s=0;s<e.length;s++){let a=e[s],o=a;if(o.isReferenceObject()&&(o=a.toArrayValueObject()),o.isError())return o;if(s===e.length-1){if(!(a.isValueObject()&&a.isLambda()))return ru.create(ea.VALUE);r=a}else t.push(a),n=Math.max(n,o.isArray()?o.getRowCount():1),i=Math.max(i,o.isArray()?o.getColumnCount():1)}let s=this._getResultArray(t,r,n,i);return s instanceof ru?s:1===n&&1===i?s[0][0]:n5.create({calculateValueList:s,rowCount:n,columnCount:i,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,n){let i=[];for(let s=0;s<r;s++){let r=[];for(let i=0;i<n;i++){let n=[],a=!1;for(let t=0;t<e.length;t++){let o=e[t],l=null;if(o.isReferenceObject()&&(l=o,o=o.toArrayValueObject()),!o.isArray())if(0===s&&0===i){n.push(l||o);continue}else{r.push(ru.create(ea.NA)),a=!0;break}let u=o.get(s,i);if(!u){r.push(ru.create(ea.NA)),a=!0;break}if(l){let{startRow:e,startColumn:t}=l.getRangePosition(),r={startRow:e+s,startColumn:t+i,endRow:e+s,endColumn:t+i};u=this.createReferenceObject(l,r)}n.push(u)}if(a||0===n.length)continue;let o=t.execute(...n);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return ru.create(ea.CALC);o=o.get(0,0)}o.isNull()&&(o=nQ.create(0)),r.push(o)}i.push(r)}return i}},ls=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t&&!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t&&!!i.getValue(),r=!1)}return r?ru.create(ea.VALUE):nK.create(t)}},ln.AND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2),J(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return ru.create(ea.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=ii(i,s,r);let a=[[]];for(let e=0;e<s;e++){let s=[];for(let t=0;t<i;t++){let n=r.get(t,e);s.push([n])}let o=n5.create({calculateValueList:s,rowCount:i,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),s={startRow:t,startColumn:r+e,endRow:t+i-1,endColumn:r+e};o=this.createReferenceObject(n,s)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return ru.create(ea.CALC);l=l.get(0,0)}l.isNull()&&(l=nQ.create(0)),a[0].push(l)}return 1===s?a[0][0]:n5.create({calculateValueList:a,rowCount:1,columnCount:s,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYCOL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2),J(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,n=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),n=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return ru.create(ea.VALUE);let i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1;r=ii(i,s,r);let a=[];for(let e=0;e<i;e++){let i=[[]];for(let t=0;t<s;t++){let n=r.get(e,t);i[0].push(n)}let o=n5.create({calculateValueList:i,rowCount:1,columnCount:s,unitId:"",sheetId:"",row:0,column:0});if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),i={startRow:t+e,startColumn:r,endRow:t+e,endColumn:r+s-1};o=this.createReferenceObject(n,i)}let l=t.execute(o);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return ru.create(ea.CALC);l=l.get(0,0)}l.isNull()&&(l=nQ.create(0)),a.push([l])}return 1===i?a[0][0]:n5.create({calculateValueList:a,rowCount:i,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.BYROW],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){return nK.create(!1)}},ln.FALSE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r=nK.create(!1)){let n=this._getSingleValueObject(e);if(n.isError())return n;if(!n.isArray())return n.getValue()?t:r;let i=Math.max(n.isArray()?n.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),s=Math.max(n.isArray()?n.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),a=ii(i,s,n),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA));return a.map((e,t,r)=>{if(e.isNull())return ru.create(ea.NA);{let n=o.get(t,r)||nX.create(),i=l.get(t,r)||nX.create();return this._calculateSingleCell(e,n,i)}})}_getSingleValueObject(e){return e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?ru.create(ea.NA):e.getValue()?t.isNull()?ru.create(ea.NA):t:r.isNull()?ru.create(ea.NA):r}},ln.IF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(!e.isArray())return e.isError()?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&i.set(t,r,s.get(t,r))}),i}},ln.IFERROR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==ea.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===ea.NA?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t);return i.iterator((e,t,r)=>{null!=e&&e.isError()&&e.getErrorType()===ea.NA&&i.set(t,r,s.get(t,r))}),i}},ln.IFNA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255)}calculate(...e){if(e.length%2!=0)return ru.create(ea.NA);for(let t=0;t<e.length;t++)if(e[t].isError())return e[t];let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),n=e.map(e=>ii(t,r,e,ru.create(ea.NA))),i=n[0].map((e,t,r)=>{for(let e=0;e<n.length;e+=2){let i=n[e].get(t,r)||nX.create(),s=n[e+1].get(t,r)||nX.create();if(i.isNull())continue;if(i.isError())return i;let a=i.getValue();if(i.isString()){if("TRUE"===`${a}`.toLocaleUpperCase())return s;if("FALSE"===`${a}`.toLocaleUpperCase())continue;return ru.create(ea.VALUE)}if(+a)return s.isNull()?ru.create(ea.NA):s}return ru.create(ea.NA)});return 1===t&&1===r?i.get(0,0):i}},ln.IFS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){return ru.create(ea.VALUE)}},ln.LAMBDA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(...e){return ru.create(ea.VALUE)}},ln.LET],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(...e){let t=this.getIndexNumValue(e[0]);if("number"!=typeof t)return t;let r=this.getIndexNumValue(e[1]);if("number"!=typeof r)return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return ru.create(ea.VALUE);let n=e[2],i=[];for(let e=0;e<t;e++){null==i[e]&&(i[e]=[]);for(let t=0;t<r;t++){let r=n.execute(nQ.create(e+1),nQ.create(t+1));r.isArray()&&(r=r.get(0,0)),i[e][t]=r}}return new n8(i)}isAsync(){return!0}},ln.MAKEARRAY],[li,ln.MAP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=+e.getValue();return Number.isNaN(t)?ru.create(ea.VALUE):nK.create(!t)}},ln.NOT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t||!!e.getValue(),r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(t=t||!!i.getValue(),r=!1)}return r?new ru(ea.VALUE):new nK(t)}},ln.OR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n,i,s,a;return e.isReferenceObject()?(n=e.toArrayValueObject(),i=e):(n=e,i=null),t.isReferenceObject()?(s=t.toArrayValueObject(),a=t):(s=t,a=null),n.isArray()?n.mapValue(e=>this._handleSingleValueObject(e,s,r,i,a)):this._handleSingleValueObject(n,s,r,i,a)}_handleSingleValueObject(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return ru.create(ea.VALUE);let s=t.isArray()?t.getRowCount():1,a=t.isArray()?t.getColumnCount():1,o=e;n&&(o=n);for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=t.isArray()?t.get(e,n):t;if(s.isError())return s;if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),a={startRow:t+e,startColumn:r+n,endRow:t+e,endColumn:r+n};s=this.createReferenceObject(i,a)}let a=r.execute(o,s);if(a.isError())return a;a.isNull()&&(a=nQ.create(0)),o=a}return o.isReferenceObject()?o.toArrayValueObject():o}},ln.REDUCE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e,i=null;e.isReferenceObject()&&(n=e.toArrayValueObject(),i=e);let s=t,a=null;if(t.isReferenceObject()&&(s=t.toArrayValueObject(),a=t),n.isError())return n;if(s.isError())return s;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return ru.create(ea.VALUE);if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.CALC);n=n.get(0,0)}return this._getResult(n,s,r,i,a)}_getResult(e,t,r,n,i){let s=[],a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1,l=e;n&&(l=n);for(let e=0;e<a;e++){let n=[];for(let s=0;s<o;s++){if(l.isError()){n.push(l);continue}let a=t.isArray()?t.get(e,s):t;if(a.isError()){l=a,n.push(a);continue}if(i){let{startRow:t,startColumn:r}=i.getRangePosition(),n={startRow:t+e,startColumn:r+s,endRow:t+e,endColumn:r+s};a=this.createReferenceObject(i,n)}let o=r.execute(l,a);if(o.isArray()){let e=o.getRowCount(),t=o.getColumnCount();if(e>1||t>1)return ru.create(ea.CALC);o=o.get(0,0)}o.isNull()&&(o=nQ.create(0)),l=o,n.push(o)}s.push(n)}return 1===a&&1===o?s[0][0]:n5.create({calculateValueList:s,rowCount:a,columnCount:o,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},ln.SCAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;let r=t.length%2!=0,n=r?t[t.length-1]:nX.create();return e.isArray()||t.some(e=>e.isArray())?this._handleArrayInputs(e,t,n,r):this._handleNonArrayInputs(e,t,n,r)}_handleNonArrayInputs(e,t,r,n){for(let r=0;r<t.length-!!n;r+=2){let n=t[r],i=t[r+1];if(!n.isNull()){if(n.isError())return n;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return i.isNull()?ru.create(ea.NA):i}}return r.isNull()?ru.create(ea.NA):r}_handleArrayInputs(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,...t.map(e=>e.isArray()?e.getRowCount():1),r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,...t.map(e=>e.isArray()?e.getColumnCount():1),r.isArray()?r.getColumnCount():1),a=ii(i,s,e),o=t.map(e=>ii(i,s,e,ru.create(ea.NA))),l=ii(i,s,r,ru.create(ea.NA));return a.map((e,t,r)=>{for(let i=0;i<o.length-!!n;i+=2){let n=o[i].get(t,r)||nX.create(),s=o[i+1].get(t,r)||nX.create();if(!n.isNull()){if(n.isError()||e.isError())return n.isError()?n:e;if(`${e.getValue()}`.toLocaleLowerCase()===`${n.getValue()}`.toLocaleLowerCase())return s.isNull()?ru.create(ea.NA):s}}let i=l.get(t,r)||nX.create();return i.isNull()?ru.create(ea.NA):i})}},ln.SWITCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){return nK.create(!0)}},ln.TRUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=0,r=!0,n=null;for(let i of e){if(i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null!=e&&e.isError())return n=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(e.getValue()&&t++,r=!1)}),n)return n}else(i.isBoolean()||i.isNumber())&&(i.getValue()&&t++,r=!1)}return r?ru.create(ea.VALUE):nK.create(t%2==1)}},ln.XOR]];var la=((V=la||{}).ADDRESS="ADDRESS",V.AREAS="AREAS",V.CHOOSE="CHOOSE",V.CHOOSECOLS="CHOOSECOLS",V.CHOOSEROWS="CHOOSEROWS",V.COLUMN="COLUMN",V.COLUMNS="COLUMNS",V.DROP="DROP",V.EXPAND="EXPAND",V.FILTER="FILTER",V.FORMULATEXT="FORMULATEXT",V.GETPIVOTDATA="GETPIVOTDATA",V.HLOOKUP="HLOOKUP",V.HSTACK="HSTACK",V.HYPERLINK="HYPERLINK",V.IMAGE="IMAGE",V.INDEX="INDEX",V.INDIRECT="INDIRECT",V.LOOKUP="LOOKUP",V.MATCH="MATCH",V.OFFSET="OFFSET",V.ROW="ROW",V.ROWS="ROWS",V.RTD="RTD",V.SORT="SORT",V.SORTBY="SORTBY",V.TAKE="TAKE",V.TOCOL="TOCOL",V.TOROW="TOROW",V.TRANSPOSE="TRANSPOSE",V.UNIQUE="UNIQUE",V.VLOOKUP="VLOOKUP",V.VSTACK="VSTACK",V.WRAPCOLS="WRAPCOLS",V.WRAPROWS="WRAPROWS",V.XLOOKUP="XLOOKUP",V.XMATCH="XMATCH",V);let lo=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",5)}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=r?r:nQ.create(1),a=null!=n?n:nK.create(!0),o=null!=i?i:nJ.create(""),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,e,ru.create(ea.NA)),h=ii(l,u,t,ru.create(ea.NA)),d=ii(l,u,s,ru.create(ea.NA)),m=ii(l,u,a,ru.create(ea.NA)),g=ii(l,u,o,ru.create(ea.NA));return c.map((e,t,r)=>{let n=h.get(t,r)||ru.create(ea.NA),i=d.get(t,r)||ru.create(ea.NA),s=m.get(t,r)||ru.create(ea.NA),a=g.get(t,r)||ru.create(ea.NA);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._calculateSingleCell(e,n,i,s,a)})}_calculateSingleCell(e,t,r,n,i){let s=Number.parseInt(`${Number(e.getValue())-1}`),a=Number.parseInt(`${Number(t.getValue())-1}`),o=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(s)||Number.isNaN(a)||Number.isNaN(o)||o<1||o>4)return ru.create(ea.VALUE);let l=function(e){switch(e){case 1:default:return j.AbsoluteRefType.ALL;case 2:return j.AbsoluteRefType.ROW;case 3:return j.AbsoluteRefType.COLUMN;case 4:return j.AbsoluteRefType.NONE}}(o),u=this.getZeroOrOneByOneDefault(n),c=tn(`${i.getValue()}`),h={startRow:s,startColumn:a,endRow:s,endColumn:a,startAbsoluteRefType:l,endAbsoluteRefType:l},d=n&&!u?function(e){let t=sB(e.startRow,e.startAbsoluteRefType,!0),r=sB(e.startColumn,e.startAbsoluteRefType,!1),n=sB(e.endRow,e.endAbsoluteRefType,!0),i=sB(e.endColumn,e.endAbsoluteRefType,!1);return t===n&&r===i?`R${t}C${r}`:`R${t}C${r}:R${n}C${i}`}(h):e0(h);return nJ.create(""!==c?`${c}!${d}`:d)}},la.ADDRESS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nQ.create(1):ru.create(ea.VALUE)}},la.AREAS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255),J(this,"needsReferenceObject",!0)}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){let e=r.convertToNumberObjectValue();return e.isError()?e:t[Math.trunc(+e.getValue())-1]||ru.create(ea.VALUE)}let n=r.isArray()?r.getRowCount():1,i=r.isArray()?r.getColumnCount():1;t.forEach((e,t)=>{e.isArray()?(n=Math.max(n,e.getRowCount()),i=Math.max(i,e.getColumnCount())):(n=Math.max(n,1),i=Math.max(i,1))});let s=ii(n,i,r,ru.create(ea.NA)),a=t.map(e=>{let t=e;return t.isReferenceObject()&&(t=t.toArrayValueObject()),ii(n,i,t,ru.create(ea.NA))});return s.map((e,t,r)=>{if(e.isError())return e;let n=e.convertToNumberObjectValue();if(n.isError())return n;let i=a[Math.trunc(+n.getValue())-1],s=(null==i?void 0:i.get(t,r))||ru.create(ea.VALUE);return null!=s&&s.isNull()&&(s=nQ.create(0)),s})}},la.CHOOSE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=[];for(let s=0;s<t.length;s++){let a=t[s];if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);a=a.get(0,0)}if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=Math.trunc(+a.getValue());if(0===o||Math.abs(o)>n)return ru.create(ea.VALUE);let l=e;n>1&&(l=o<0?e.slice(void 0,[o+n,o+1+n]):e.slice(void 0,[o-1,o]));for(let t=0;t<r;t++)i[t]||(i[t]=[]),e.isArray()?i[t].push(l.get(t,0)):i[t].push(e)}return n5.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSECOLS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,n=[];for(let i=0;i<t.length;i++){let s=t[i];if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);s=s.get(0,0)}if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.trunc(+s.getValue());if(0===a||Math.abs(a)>r)return ru.create(ea.VALUE);let o=e;r>1&&(o=a<0?e.slice([a+r,a+1+r]):e.slice([a-1,a])),e.isArray()?n.push(o.getArrayValue()[0]):n.push([e])}return n5.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.CHOOSEROWS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",1)}calculate(e){if(null==e)return nQ.create(this.column+1);if(e.isError())return e;if(!e.isArray())return ru.create(ea.NA);let t=e.getCurrentColumn(),r=e.getColumnCount(),n=[];for(let e=0;e<r;e++)n.push(nQ.create(t+e+1));let i={calculateValueList:[n],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(i)}},la.COLUMN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nQ.create(1);if(!e.isArray())return ru.create(ea.NA);let t=e.getColumnCount();return nQ.create(t)}},la.COLUMNS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(0),i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ii(a,o,t,ru.create(ea.NA)),u=ii(a,o,n,ru.create(ea.NA));if(a>1||o>1)return l.mapValue((t,r,n)=>{let a=u.get(r,n);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,i,s);return o?l:e.isArray()?ru.create(ea.VALUE):e});if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let c=t.isArray()?t.get(0,0):t,h=n.isArray()?n.get(0,0):n,{isError:d,errorObject:m,rowsValue:g,columnsValue:f}=this._checkRowsColumns(c,h,i,s);return d?m:this._getResultArray(e,g,f,i,s)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:ru.create(ea.VALUE)}:Math.abs(i)>=r||Math.abs(s)>=n?{isError:!0,errorObject:ru.create(ea.CALC)}:{isError:!1,rowsValue:i,columnsValue:s}}_getResultArray(e,t,r,n,i){let s,a=t>=0?[t,n]:[0,n+t],o=r>=0?[r,i]:[0,i+r];return s=(s=0===t&&0===r?e:0===t?e.slice(void 0,o):0===r?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nQ.create(0):e),n-t==1&&i-r==1?s.get(0,0):s}},la.DROP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",4)}calculate(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t,o=null!=r?r:nQ.create(s),l=null!=n?n:ru.create(ea.NA);t.isNull()&&(a=nQ.create(i)),o.isNull()&&(o=nQ.create(s));let u=Math.max(a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),c=Math.max(a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),h=ii(u,c,a,ru.create(ea.NA)),d=ii(u,c,o,ru.create(ea.NA));if(u>1||c>1)return h.mapValue((t,r,n)=>{let a=d.get(r,n);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let{isError:o,errorObject:u}=this._checkRowsColumnsPadWith(t,a,l,i,s);return o?u:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let m=a.isArray()?a.get(0,0):a,g=o.isArray()?o.get(0,0):o,{isError:f,errorObject:p,rowsValue:C,columnsValue:_,padWithObject:y}=this._checkRowsColumnsPadWith(m,g,l,i,s);return f?p:this._getResultArray(e,C,_,y,i,s)}_checkRowsColumnsPadWith(e,t,r,n,i){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let s=Math.trunc(+e.getValue()),a=Math.trunc(+t.getValue());if(Number.isNaN(s)||Number.isNaN(a)||Math.abs(s)<n||Math.abs(a)<i)return{isError:!0,errorObject:ru.create(ea.VALUE)};let o=r;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:ru.create(ea.VALUE)};o=r.get(0,0)}return{isError:!1,rowsValue:s,columnsValue:a,padWithObject:o}}_getResultArray(e,t,r,n,i,s){let a=[];a=e.isArray()?e.map(e=>e.isNull()?nQ.create(0):e).getArrayValue():[[e]];let o=Math.max(0,t-i),l=Math.max(0,r-s);for(let e=0;e<o;e++)a.push(Array(s).fill(n));for(let e=0;e<l;e++)a.forEach(e=>{e.push(n)});return 1===t&&1===r?a[0][0]:n5.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.EXPAND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ru.create(ea.CALC);if(e.isError())return e;if(t.isError())return t;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t.isArray()?t.getRowCount():1,o=t.isArray()?t.getColumnCount():1;return a>1&&o>1||1===a&&o!==s||1===o&&a!==i?ru.create(ea.VALUE):1===i&&1===s?this._getResultArrayByR1C1(e,t,n):1===a?o!==s?ru.create(ea.VALUE):this._getResultArrayByR1(i,s,e,t,n):1===o?a!==i?ru.create(ea.VALUE):this._getResultArrayByC1(i,s,e,t,n):n}_getResultArrayByR1C1(e,t,r){let n=e,i=t;return n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),i.isString()&&(i=i.convertToNumberObjectValue()),i.isError()?i:+i.getValue()?n:r}_getResultArrayByR1(e,t,r,n,i){let s=[];for(let i=0;i<t;i++){let t=n.get(0,i);if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;if(+t.getValue())for(let t=0;t<e;t++){s[t]||(s[t]=[]);let e=r.get(t,i);s[t].push(e)}}return 0===s.length?i:n5.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,n,i){let s=[];for(let i=0;i<e;i++){let e=n.get(i,0);if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return e;if(!+e.getValue())continue;let a=[];for(let e=0;e<t;e++){let t=r.get(i,e);a.push(t)}s.push(a)}return 0===s.length?i:n5.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.FILTER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0),J(this,"needsFormulaDataModel",!0)}calculate(e){var t,r;if(!e.isReferenceObject())return ru.create(ea.NA);let n=e.getUnitId(),i=e.getSheetId(),s=null==(r=null==(t=e.getUnitData()[n])?void 0:t[i])?void 0:r.cellData,{startRow:a,startColumn:o}=e.getRangePosition(),l=e.toArrayValueObject().mapValue((e,t,r)=>{let l=s.getValue(a+t,o+r);if(null!=l&&l.f||null!=l&&l.si){let e=this._formulaDataModel.getFormulaStringByCell(a+t,o+r,i,n);return nJ.create(e)}return ru.create(ea.NA)});return 1===l.getRowCount()&&1===l.getColumnCount()?l.get(0,0):l}},la.FORMULATEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return ru.create(ea.REF);if(!t.isArray()||r.isError()||null!=n&&n.isError())return ru.create(ea.NA);let i=this.getZeroOrOneByOneDefault(n);if(null==i)return ru.create(ea.VALUE);let s=this.getIndexNumValue(r);if(s instanceof ru)return s;let a=t.slice([0,1]),o=t.slice([s-1,s]);return null==a||null==o?ru.create(ea.REF):e.isArray()?e.map(e=>this._handleSingleObject(e,a,o,i)):this._handleSingleObject(e,a,o,i)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.HLOOKUP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<t;e++){r[e]||(r[e]=[]);for(let t=0;t<a;t++){let n=i;i.isArray()&&(n=i.get(e,t)),e>s-1||!n?r[e].push(ru.create(ea.NA)):r[e].push(n)}}}return n5.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.HSTACK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4),J(this,"needsReferenceObject",!0)}calculate(e,t,r,n){let i,s;if(e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;let a=0,o=0;if(e.isValueObject())a=1,o=1;else{if(!e.isReferenceObject())return ru.create(ea.VALUE);let{startRow:t,endRow:r,startColumn:n,endColumn:i}=e.getRangePosition();a=r-t+1,o=i-n+1}1===a&&o>1&&null==r?(s=null!=t?t:nQ.create(0),i=nQ.create(0)):(i=null!=t?t:nQ.create(0),s=null!=r?r:nQ.create(0));let l=null!=n?n:nQ.create(1);i.isReferenceObject()&&(i=i.toArrayValueObject()),s.isReferenceObject()&&(s=s.toArrayValueObject()),l.isReferenceObject()&&(l=l.toArrayValueObject());let u=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1);if(1===u&&1===c)return this._calculateSingleCell(e,i,s,l);{let t=ii(u,c,i,ru.create(ea.NA)),r=ii(u,c,s,ru.create(ea.NA)),n=ii(u,c,l,ru.create(ea.NA));return t.map((t,i,s)=>{let a=r.get(i,s)||nX.create(),o=n.get(i,s)||nX.create(),l=this._calculateSingleCell(e,t,a,o);return l.isReferenceObject()?l.toArrayValueObject().getFirstCell():l})}}_calculateSingleCell(e,t,r,n){if(t.isError())return t;let i=this._getNumberValue(t);if(void 0===i||i<0)return ru.create(ea.VALUE);if(r.isError())return r;let s=this._getNumberValue(r);if(void 0===s||s<0)return ru.create(ea.VALUE);if(n.isError())return n;let a=this._getAreaNumberValue(n);return void 0===a||a<1?ru.create(ea.VALUE):e.isReferenceObject()?this._getReferenceObject(e,i,s,a):e.isValueObject()&&1===i&&1===s?e:ru.create(ea.REF)}_getNumberValue(e){if(null==e)return 0;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getAreaNumberValue(e){if(null==e)return 1;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getReferenceObject(e,t,r,n){let{startRow:i,endRow:s,startColumn:a,endColumn:o}=e.getRangePosition(),l=0,u=0,c=0,h=0;if(0===t?(l=i,u=s):l=u=i+t-1,0===r?(c=a,h=o):c=h=a+r-1,l>s||c>o)return ru.create(ea.REF);let d={startRow:l,startColumn:c,endRow:u,endColumn:h};return this.createReferenceObject(e,d)}},la.INDEX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);null==r&&(r=1);let n=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return e.map(()=>ru.create(ea.VALUE));n=e.getFirstCell()}return this._handleSingleObject(n,r)}_handleSingleObject(e,t){let r=`${e.getValue()}`;if(""===r.trim())return ru.create(ea.REF);let n=this._convertToDefinedName(r);if(0===t){let{range:e,sheetName:t,unitId:r}=sj(n),i=new n7(e);return i.setForcedUnitIdDirect(r),i.setForcedSheetName(t),this._setDefault(i)}if(eB(n))return this._setDefault(new ie(n));if(e$(n))return this._setDefault(new ir(n));if(eH(n))return this._setDefault(new it(n));let{range:i,sheetName:s,unitId:a}=tM(n);if(Number.isNaN(i.startRow)||i.endRow+1>1048576||Number.isNaN(i.startColumn)||i.endColumn+1>16384)return ru.create(ea.REF);let o=new n7(i);return o.setForcedUnitIdDirect(a),o.setForcedSheetName(s),this._setDefault(o)}_setDefault(e){return null==this.unitId||null==this.subUnitId?ru.create(ea.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){let t=this.getDefinedName(e);if(null==t)return e;let r=t.formulaOrRefString;return null==r?e:r.startsWith(ec.EQUALS)?r.slice(1):r}},la.INDIRECT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?ru.create(ea.REF):t.isArray()?null!=r&&r.isError()?r:1===t.getColumnCount()||1===t.getRowCount()?null==r||r.isArray()?this._handleVector(e,t,r):ru.create(ea.REF):this._handleArray(e,t):ru.create(ea.VALUE)}_handleVector(e,t,r){let n=r;if(null==n)n=t;else if(n.getRowCount()!==t.getRowCount()||n.getColumnCount()!==t.getColumnCount())return ru.create(ea.REF);return e.isArray()?e.map(e=>this.binarySearch(e,t,n)):this.binarySearch(e,t,n)}_handleArray(e,t){let r,n,i=t.getRowCount(),s=t.getColumnCount();return s>i?(r=t.slice([0,1]),n=t.slice([i-1,i])):(r=t.slice(void 0,[0,1]),n=t.slice(void 0,[s-1,s])),null==r||null==n?ru.create(ea.VALUE):e.isArray()?e.map(e=>this.binarySearch(e,r,n)):this.binarySearch(e,r,n)}},la.LOOKUP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return ru.create(ea.REF);if(!t.isArray())return ru.create(ea.VALUE);let n=t.getRowCount(),i=t.getColumnCount();if(1!==n&&1!==i||null!=r&&r.isError())return ru.create(ea.NA);let s=this.getMatchTypeValue(r);return null==s?ru.create(ea.VALUE):e.isArray()?e.map(e=>this._handleSingleObject(e,t,s)):this._handleSingleObject(e,t,s)}_handleSingleObject(e,t,r){let n=this._getSearchModeValue(r),i=t.orderSearch(e,n);if(null==i)return ru.create(ea.NA);if(i instanceof ru)return i;let s=1===t.getRowCount()?i.column+1:i.row+1;return nQ.create(s)}_getSearchModeValue(e){switch(e){case 1:return rh.MIN;case 0:return rh.NORMAL;case -1:return rh.MAX}}},la.MATCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",5),J(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,n,i){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;if(!e.isReferenceObject())return ru.create(ea.VALUE);let s=e.getRowCount(),a=e.getColumnCount(),o=t;o.isReferenceObject()&&(o=o.toArrayValueObject());let l=r;l.isReferenceObject()&&(l=l.toArrayValueObject());let u=null!=n?n:nQ.create(s);u.isReferenceObject()&&(u=u.toArrayValueObject()),u.isNull()&&(u=nQ.create(s));let c=null!=i?i:nQ.create(a);c.isReferenceObject()&&(c=c.toArrayValueObject()),c.isNull()&&(c=nQ.create(a));let h=Math.max(o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(1===h&&1===d)return o=o.isArray()?o.get(0,0):o,l=l.isArray()?l.get(0,0):l,u=u.isArray()?u.get(0,0):u,c=c.isArray()?c.get(0,0):c,this._handleSingleObject(e,o,l,u,c);let m=ii(h,d,o,ru.create(ea.NA)),g=ii(h,d,l,ru.create(ea.NA)),f=ii(h,d,u,ru.create(ea.NA)),p=ii(h,d,c,ru.create(ea.NA));return m.mapValue((t,r,n)=>{let i=g.get(r,n),s=f.get(r,n),a=p.get(r,n);return t.isError()?t:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSingleObject(e,t,i,s,a,!0)})}_handleSingleObject(e,t,r,n,i,s=!1){let{startRow:a,startColumn:o}=e.getRangePosition(),l=t;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return l;let u=r;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+l.getValue(),h=+u.getValue();if("number"!=typeof c||"number"!=typeof h)return ru.create(ea.VALUE);let d=a+c,m=o+h;if(d<0||m<0)return ru.create(ea.REF);let g=this.getIndexNumValue(n),f=this.getIndexNumValue(i);if("number"!=typeof g||"number"!=typeof f)return ru.create(ea.VALUE);if(0===g||0===f)return ru.create(ea.REF);let p=g>0?d+g-1:d+g+1,C=f>0?m+f-1:m+f+1;return p<0||C<0?ru.create(ea.REF):s?ru.create(ea.VALUE):this.createReferenceObject(e,{startRow:d<p?d:p,startColumn:m<C?m:C,endRow:d>p?d:p,endColumn:m>C?m:C})}},la.OFFSET],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",1)}calculate(e){if(null==e)return nQ.create(this.row+1);if(e.isError())return e;if(!e.isArray())return ru.create(ea.NA);let t=e.getCurrentRow(),r=e.getRowCount(),n=[];for(let e=0;e<r;e++)n.push([nQ.create(t+e+1)]);let i={calculateValueList:n,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(i)}},la.ROW],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nQ.create(1);if(!e.isArray())return ru.create(ea.NA);let t=e.getRowCount();return nQ.create(t)}},la.ROWS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=t?t:nQ.create(1),s=null!=r?r:nQ.create(1),a=null!=n?n:nK.create(!1);if(a.isArray()){let t=a.getRowCount(),r=a.getColumnCount();if(1===t&&1===r){let t=a.get(0,0);return this._handleSingleObject(e,i,s,t)}return a.map(t=>{let r=this._handleSingleObject(e,i,s,t);return r.isArray()?r.get(0,0):r})}return this._handleSingleObject(e,i,s,a)}_handleSingleObject(e,t,r,n){if(e.isError())return e;let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=this._checkArrayError(t);if(a.isError())return a;let o=Math.floor(+a.getValue());if(o<1)return ru.create(ea.VALUE);let l=this._checkArrayError(r);if(l.isError())return l;let u=Math.floor(+l.getValue());if(-1!==u&&1!==u)return ru.create(ea.VALUE);let c=n;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!e.isArray()||1===i&&1===s)return e;let h=+c.getValue();return this._getResult(e,o,u,h,i,s)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,n,i,s){if(n){if(t>i)return ru.create(ea.VALUE);let n=e.transpose().getArrayValue();return n.sort(this._sort(t-1,r)),n5.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}{if(t>s)return ru.create(ea.VALUE);let n=e.getArrayValue();return n.sort(this._sort(t-1,r)),n5.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){let r=rd();return 1===t?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return 1;if(s.isError())return -1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?1:s.isBoolean()&&!0===o?-1:i.isBoolean()&&!1===a?1:s.isBoolean()&&!1===o?-1:i.isNumber()&&s.isNumber()?a-o:t(a,o)}}_sortDesc(e,t){return(r,n)=>{let i=r[e],s=n[e];if(null==i||i.isNull())return 1;if(null==s||s.isNull())return -1;if(i.isError()&&s.isError())return 0;if(i.isError())return -1;if(s.isError())return 1;let a=i.getValue(),o=s.getValue();return i.isBoolean()&&!0===a?-1:s.isBoolean()&&!0===o?1:i.isBoolean()&&!1===a?-1:s.isBoolean()&&!1===o?1:i.isNumber()&&s.isNumber()?o-a:t(o,a)}}},la.SORT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255)}calculate(e,...t){1===t.length&&t.push(nQ.create(1));let r=this._getVariantsError(e,...t),{maxRowLength:n,maxColumnLength:i}=ic(t);if(r.isError()){let e=ii(n,i,r);return 1===n&&1===i?e.get(0,0):e}let s=t.map((e,t)=>t%2==0?e:ii(n,i,e,ru.create(ea.NA))),a=this._getResultArray(e,s,n,i);return 1===n&&1===i?a[0][0]:n5.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let e=0;e<t.length;e++){let r=t[e];if(r.isError())return r}if(t.length<2||t.length%2!=0)return ru.create(ea.VALUE);let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t[0].isArray()?t[0].getRowCount():1,s=t[0].isArray()?t[0].getColumnCount():1;if((i>1||s>1)&&(i>1&&s>1||1===i&&s!==n||1===s&&i!==r))return ru.create(ea.VALUE);for(let e=2;e<t.length;e++){if(e%2==1)continue;let r=t[e].isArray()?t[e].getRowCount():1,n=t[e].isArray()?t[e].getColumnCount():1;if(r!==i||n!==s)return ru.create(ea.VALUE)}return nK.create(!0)}_getResultArray(e,t,r,n){let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=t[0].isArray()?t[0].getRowCount():1,o=t[0].isArray()?t[0].getColumnCount():1,l=[];for(let u=0;u<r;u++){l[u]=[];for(let c=0;c<n;c++){let{isError:h,errorObject:d,byArrays:m,sortOrders:g}=this._getByArraysAndSortOrders(t,u,c,o);if(h){l[u].push(d);continue}if(!e.isArray()||1===i&&1===s){l[u].push(e);continue}let f=e.getArrayValue();1===a&&1===o||(1===a?(f=f.concat(m),(f=this._transposeArray(f)).sort(this._sort(i,g)),f=this._transposeArray(f).slice(0,i)):1===o&&(f=(f=this._transposeArray(f)).concat(m),(f=this._transposeArray(f)).sort(this._sort(s,g)),f=f.map(e=>e.slice(0,s))));let p=n5.create({calculateValueList:f,rowCount:f.length,columnCount:f[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||n>1){l[u].push(p.get(0,0));continue}l[u].push(p)}}return l}_getByArraysAndSortOrders(e,t,r,n){let i=[],s=[],a=!1,o=null;for(let l=0;l<e.length;l++){if(l%2==1)continue;let u=e[l],c=e[l+1].get(t,r);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()){a=!0,o=c;break}let h=Math.floor(+c.getValue());if(-1!==h&&1!==h){a=!0,o=ru.create(ea.VALUE);break}if(s.push(h),u.isArray()){let e=u.getArrayValue();1===n&&(e=this._transposeArray(e)),i.push(e[0])}else i.push([u])}return{isError:a,errorObject:o,byArrays:i,sortOrders:s}}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}_sort(e,t){let r=rd();return(n,i)=>{let s=n[e],a=i[e],o=this._compare(s,a,t[0],r);if(0===o&&t.length>1)for(let l=1;l<t.length&&(s=n[e+l],a=i[e+l],0===(o=this._compare(s,a,t[l],r)));l++);return o}}_compare(e,t,r,n){return 1===r?this._asc(e,t,n):this._desc(e,t,n)}_asc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return -1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?1:t.isBoolean()&&!0===i?-1:e.isBoolean()&&!1===n?1:t.isBoolean()&&!1===i?-1:e.isNumber()&&t.isNumber()?n-i:r(n,i)}_desc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return -1;if(t.isError())return 1;let n=e.getValue(),i=t.getValue();return e.isBoolean()&&!0===n?-1:t.isBoolean()&&!0===i?1:e.isBoolean()&&!1===n?-1:t.isBoolean()&&!1===i?1:e.isNumber()&&t.isNumber()?i-n:r(i,n)}},la.SORTBY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t,a=null!=r?r:nQ.create(i);t.isNull()&&(s=nQ.create(n)),a.isNull()&&(a=nQ.create(i));let o=Math.max(s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=ii(o,l,s,ru.create(ea.NA)),c=ii(o,l,a,ru.create(ea.NA));if(o>1||l>1)return u.mapValue((t,r,s)=>{let a=c.get(r,s);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let{isError:o,errorObject:l}=this._checkRowsColumns(t,a,n,i);return o?l:e.isArray()?ru.create(ea.VALUE):e});if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let h=s.isArray()?s.get(0,0):s,d=a.isArray()?a.get(0,0):a,{isError:m,errorObject:g,rowsValue:f,columnsValue:p}=this._checkRowsColumns(h,d,n,i);return m?g:this._getResultArray(e,f,p,n,i)}_checkRowsColumns(e,t,r,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());return Number.isNaN(i)||Number.isNaN(s)?{isError:!0,errorObject:ru.create(ea.VALUE)}:0===Math.abs(i)||0===Math.abs(s)?{isError:!0,errorObject:ru.create(ea.CALC)}:(i>r&&(i=r),s>n&&(s=n),{isError:!1,rowsValue:i,columnsValue:s})}_getResultArray(e,t,r,n,i){let s;if(!e.isArray())return e;let a=t>=0?[0,t]:[n+t,n],o=r>=0?[0,r]:[i+r,i];return s=(s=t===n&&r===i?e:t===n?e.slice(void 0,o):r===i?e.slice(a,void 0):e.slice(a,o)).map(e=>e.isNull()?nQ.create(0):e),1===t&&1===r?s.get(0,0):s}},la.TAKE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nQ.create(0),i=null!=r?r:nK.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,n,ru.create(ea.NA)),l=ii(s,a,i,ru.create(ea.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u))return ru.create(ea.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?ru.create(ea.CALC):s>1||a>1||1===c.length?c[0]:n5.create({calculateValueList:c.map(e=>[e]),rowCount:c.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nQ.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nQ.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOCOL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nQ.create(0),i=null!=r?r:nK.create(!1),s=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,n,ru.create(ea.NA)),l=ii(s,a,i,ru.create(ea.NA)),u=o.mapValue((t,r,n)=>{let i=l.get(r,n);if(e.isError())return e;if(t.isError())return t;if(i.isError())return i;let o=Math.trunc(+t.getValue()),u=+i.getValue();if(Number.isNaN(o)||o<0||o>3||Number.isNaN(u)||e.isNull())return ru.create(ea.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=u?this._getArrayValueByColumn(e,o):this._getArrayValueByRow(e,o)).length?ru.create(ea.CALC):s>1||a>1||1===c.length?c[0]:n5.create({calculateValueList:[c],rowCount:1,columnCount:c.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===a?u.get(0,0):u}_getArrayValueByColumn(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<n;s++)for(let n=0;n<r;n++){let r=e.get(n,s);this._isIgnore(r,t)||i.push(r.isNull()?nQ.create(0):r)}return i}_getArrayValueByRow(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=[];for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=e.get(s,r);this._isIgnore(n,t)||i.push(n.isNull()?nQ.create(0):n)}return i}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}},la.TOROW],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return 1===t&&1===r?e.get(0,0):e.transpose()}return e}},la.TRANSPOSE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nK.create(!1),i=null!=r?r:nK.create(!1),s=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,o=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),l=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),u=ii(o,l,n,ru.create(ea.NA)),c=ii(o,l,i,ru.create(ea.NA)),h=u.map((t,r,n)=>{let i,u=t,h=c.get(r,n);if(e.isError())return e;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let d=+u.getValue(),m=+h.getValue();return i=!d&&1===s||d&&1===a?e:this._getResult(e,d,m),(o>1||l>1)&&null!=i&&i.isArray()?i.get(0,0):i});return 1===o&&1===l?h.get(0,0):h}_getResult(e,t,r){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=e.getArrayValue(),a=n,o=i;t&&(s=this._transposeArray(s),a=i,o=n);let l=this._getRepeatRows(s,a,o);if(l.length>0){let e=[];l.forEach(t=>{t.forEach((t,n)=>{(0!==n||r)&&e.push(t)})}),s=s.filter((t,r)=>!e.includes(r))}return 0===s.length?ru.create(ea.CALC):(t&&(s=this._transposeArray(s)),n5.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let n=[];for(let i=0;i<r;i++)if(0===i){let r=Array(t).fill(null).map((t,r)=>({r:r,valueObject:e[r][i]}));n=this._getRepeatRowsByObjects(r)}else{if(0===n.length)break;let t=[];n.forEach(r=>{let n=r.map(t=>({r:t,valueObject:e[t][i]})),s=this._getRepeatRowsByObjects(n);t=t.concat(s)}),n=t}return n}_getRepeatRowsByObjects(e){let t=new Map;return e.forEach(e=>{let r=e.r,n=e.valueObject,i=n.getValue();if(n.isNull()?i=null:n.isString()&&(0,j.isRealNum)(i)&&(i*=1),t.has(i)){let e=t.get(i);e.push(r),t.set(i,e)}else t.set(i,[r])}),Array.from(t.values()).filter(e=>e.length>1)}_transposeArray(e){let t=e.length,r=e[0].length,n=[];for(let i=0;i<r;i++){n[i]=[];for(let r=0;r<t;r++)n[i][r]=e[r][i]}return n}},la.UNIQUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return ru.create(ea.VALUE);if(r.isError())return r;if(null!=n&&n.isError())return n;let i=null!=n?n:nK.create(!0);return il(e)&&il(i)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,i):this._handleNonArrayColIndexNum(e,t,r,i)}_handleArrayColIndexNum(e,t,r,n){let i,s=e.isArray()?e.getFirstCell():e,a=this.getZeroOrOneByOneDefault(n);if(null==a)return ru.create(ea.VALUE);let o=[];return r.iterator((e,r,n)=>{if(null==e)return i=ru.create(ea.VALUE),!1;let l=this._handleTableArray(s,t,e,a);if(l.isError())return i=l,!1;void 0===o[r]&&(o[r]=[]),o[r][n]=l}),i||is(o,o.length,o[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e),o=ii(i,s,n);return a.map((e,n,i)=>{if(e.isError())return e;let s=o.get(n,i);if(null==s)return ru.create(ea.VALUE);if(s.isError())return s;let a=this.getZeroOrOneByOneDefault(s);return null==a?ru.create(ea.VALUE):this._handleTableArray(e,t,r,a)})}_handleTableArray(e,t,r,n){let i=this.getIndexNumValue(r);if(i instanceof ru)return i;if((i=Math.floor(i))<1)return ru.create(ea.VALUE);let s=t.slice(void 0,[0,1]);if(null==s)return ru.create(ea.VALUE);let a=t.slice(void 0,[i-1,i]);return null==a?ru.create(ea.REF):this._handleSingleObject(e,s,a,n)}_handleSingleObject(e,t,r,n){return 0===n?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}},la.VLOOKUP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),r=[];for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++){let n=[];for(let r=0;r<t;r++){let t=i;i.isArray()&&(t=i.get(e,r)),r>a-1||!t?n.push(ru.create(ea.NA)):n.push(t)}r.push(n)}}return n5.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}},la.VSTACK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ru.create(ea.NA);n.isNull()&&(n=ru.create(ea.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ii(a,o,t,ru.create(ea.NA)),u=ii(a,o,n,ru.create(ea.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return ru.create(ea.VALUE);if(c<1)return ru.create(ea.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:n5.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++)for(let n=0;n<i;n++){s[n]||(s[n]=[]);let a=t*i+n;a<e.length?s[n].push(e[a].isNull()?nQ.create(0):e[a]):s[n].push(r)}return s}},la.WRAPCOLS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:ru.create(ea.NA);n.isNull()&&(n=ru.create(ea.NA));let i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,a=Math.max(t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),o=Math.max(t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=ii(a,o,t,ru.create(ea.NA)),u=ii(a,o,n,ru.create(ea.NA)),c=l.mapValue((t,r,n)=>{let l=u.get(r,n);if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(i>1&&s>1||Number.isNaN(c))return ru.create(ea.VALUE);if(c<1)return ru.create(ea.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],d=this._getWrapArray(h,c,l);return a>1||o>1||1===d.length&&1===d[0].length?d[0][0]:n5.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===a&&1===o?c.get(0,0):c}_getWrapArray(e,t,r){let n=Math.ceil(e.length/t),i=n>1?t:e.length,s=[];for(let t=0;t<n;t++){let n=[];for(let s=0;s<i;s++){let a=t*i+s;a<e.length?n.push(e[a].isNull()?nQ.create(0):e[a]):n.push(r)}s.push(n)}return s}},la.WRAPROWS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=n?n:ru.create(ea.NA);null!=n&&n.isNull()&&(a=ru.create(ea.NA));let o=null!=i?i:nQ.create(0);null!=i&&i.isNull()&&(o=nQ.create(0));let l=null!=s?s:nQ.create(1);if(null!=s&&s.isNull()&&(l=nQ.create(1)),e.isError())return e;if(t.isError()||r.isError())return ru.create(ea.REF);if(!t.isArray()||!r.isArray())return ru.create(ea.VALUE);let u=t.getRowCount(),c=t.getColumnCount(),h=r.getRowCount(),d=r.getColumnCount();if(1!==u&&1!==c||1===u&&c>1&&c!==d||1===c&&u>1&&u!==h)return ru.create(ea.VALUE);if(o.isError())return o;if(l.isError())return l;let m=this.getIndexNumValue(o);if(m instanceof ru)return m;let g=this.getIndexNumValue(l);return g instanceof ru?g:this._getResult(e,t,r,a,m,g,u,c,h,d)}_getResult(e,t,r,n,i,s,a,o,l,u){let c=e.isArray()?e.getRowCount():1,h=e.isArray()?e.getColumnCount():1;if(c>1||h>1){let o;return null==(o=1===a?r.slice([0,1]):r.slice(void 0,[0,1]))?ru.create(ea.NA):e.map(e=>{let r=this._checkErrorCombination(i,s);if(r)return r;let a=this._handleSingleObject(e,t,o,i,s);return a.isError()?n:a})}let d=e.isArray()?e.get(0,0):e;if(o===u&&a===l){let e=this._checkErrorCombination(i,s);if(e)return e;let a=this._handleSingleObject(d,t,r,i,s);return a.isError()?n:a}let m=0;o===u&&(m=1);let g=this._handleExpandObject(d,t,r,i,s,m);return null==g?ru.create(ea.NA):g}_handleExpandObject(e,t,r,n,i,s=0){if((2===i||-2===i)&&2!==n){let a=rf(n);return this.binarySearchExpand(e,t,r,s,+(-2===i),a)}return 2===n?this.fuzzySearchExpand(e,t,r,-1!==i,s):-1===n||1===n?this.orderSearchExpand(e,t,r,1===n?rh.MAX:rh.MIN,-1===i,s):this.equalSearchExpand(e,t,r,-1!==i,s)}_handleSingleObject(e,t,r,n,i){if((2===i||-2===i)&&2!==n){let s=rf(n);return this.binarySearch(e,t,r,+(-2===i),s)}return 2===n?this.fuzzySearch(e,t,r,-1!==i):-1===n||1===n?this.orderSearch(e,t,r,1===n?rh.MAX:rh.MIN,-1===i):this.equalSearch(e,t,r,-1!==i)}_checkErrorCombination(e,t){return 2===e&&(-2===t||2===t)?ru.create(ea.VALUE):null}},la.XLOOKUP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",4)}calculate(e,t,r,n){if(e.isError())return e;if(t.isError())return ru.create(ea.REF);if(!t.isArray())return ru.create(ea.VALUE);let i=t.getRowCount(),s=t.getColumnCount();if(1!==i&&1!==s)return ru.create(ea.VALUE);if(null!=r&&r.isError()||null!=n&&n.isError())return ru.create(ea.NA);let a=this.getIndexNumValue(r||nQ.create(0));if(a instanceof ru)return a;let o=this.getIndexNumValue(n||nQ.create(1));return o instanceof ru?o:e.isArray()?e.map(e=>this._handleSingleObject(e,t,a,o)):this._handleSingleObject(e,t,a,o)}_handleSingleObject(e,t,r,n){let i;if((2===n||-2===n)&&2!==r){let s=rf(r);i=t.binarySearch(e,+(-2===n),s)}else if(2===r){let r,s=t.compare(e,eh.EQUALS);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return ru.create(ea.NA);i=1===t.getRowCount()?r.column:r.row}else if(-1===r||1===r){let s=t.orderSearch(e,1===r?rh.MAX:rh.MIN,-1===n);if(null==s)return ru.create(ea.NA);if(s instanceof ru)return s;i=1===t.getRowCount()?s.column:s.row}else{let r,s=t.isEqual(e);if(null==(r=-1!==n?s.getFirstTruePosition():s.getLastTruePosition()))return ru.create(ea.NA);i=1===t.getRowCount()?r.column:r.row}return null==i?ru.create(ea.NA):nQ.create(i+1)}},la.XMATCH]];function ll(e){let t=e.getValue();if(e.isBoolean()&&(t=+!!t),!Number.isFinite(t))return ru.create(ea.VALUE);let r=Math.atan(1/(t=Number(t)));return t<0&&(r+=Math.PI),Number.isNaN(r)?ru.create(ea.VALUE):nQ.create(r)}function lu(e){let t=e.getValue();if(e.isBoolean()&&(t=+!!t),!Number.isFinite(t))return ru.create(ea.VALUE);if(1>=Math.abs(t=Number(t)))return ru.create(ea.NUM);let r=.5*Math.log((t+1)/(t-1));return Number.isNaN(r)?ru.create(ea.VALUE):nQ.create(r)}let lc=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}},i2.ABS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}},i2.ACOS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}},i2.ACOSH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:ll(e)):ll(t)}},i2.ACOT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:lu(e)):lu(t)}},i2.ACOTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nQ.create(0);if(e.isBoolean()||e.isNumber())return ru.create(ea.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return ru.create(ea.VALUE);let r=t.startsWith("-");r&&(t=t.slice(1));let n=0;for(let e=0;e<t.length;e++){let r=ar.get(t[e])||0,i=ar.get(t[e+1])||0,s=ar.get(t[e+2])||0,a=ar.get(t[e+3])||0;if(!r||s>=i&&s>r||r===i&&r===s&&r===a||r===i/2)return ru.create(ea.VALUE);r<i?n-=r:n+=r}return nQ.create(r?-n:n)}},i2.ARABIC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}},i2.ASIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}},i2.ASINH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}},i2.ATAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e,n=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:n.atan2(r))}},i2.ATAN2],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}},i2.ATANH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(0);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.map((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return this._handleSingleObject(e,n,i)});return 1===u.getRowCount()&&1===u.getColumnCount()?u.getArrayValue()[0][0]:u}_handleSingleObject(e,t,r){let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=t;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=r;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue()),l=Math.floor(+s.getValue());if(a<0||a>=0x20000000000000||o<2||o>36||l<0)return ru.create(ea.NUM);let u=a.toString(o);return u.length<l&&(u=Array(l-u.length+1).join("0")+u),nJ.create(u.toLocaleUpperCase())}},i2.BASE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let a=+n.getValue(),o=+i.getValue();if(a>0&&o<0)return ru.create(ea.NUM);if(0===a||0===o)return nQ.create(0);let l=n$(a/o,0)*o;return nQ.create(l)});return 1===a.getRowCount()&&1===a.getColumnCount()?a.getArrayValue()[0][0]:a}},i2.CEILING],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nQ.create(1),i=null!=r?r:nQ.create(0);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,n,ru.create(ea.NA)),u=ii(s,a,i,ru.create(ea.NA)),c=o.map((e,t,r)=>{let n=e,i=l.get(t,r),s=u.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let a=+n.getValue(),o=+i.getValue(),c=+s.getValue();return 0===a||0===o?nQ.create(0):this._getResult(a,o,c)});return 1===s&&1===a?c.get(0,0):c}_getResult(e,t,r){let n;return n=e<0&&0!==r?(t<0?n$(Math.abs(e)/Math.abs(t),0):-n$(Math.abs(e)/t,0))*t:(t<0?-n$(e/Math.abs(t),0):n$(e/t,0))*t,nQ.create(n)}},i2.CEILING_MATH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nQ.create(0);let l=(o<0?-n$(s/Math.abs(o),0):n$(s/o,0))*o;return nQ.create(l)});return 1===n&&1===i?o.get(0,0):o}},i2.CEILING_PRECISE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||a<o)return ru.create(ea.NUM);let l=s1(a,o);return Number.isNaN(l)||!Number.isFinite(l)?ru.create(ea.NUM):nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},i2.COMBIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=e,i=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),i.isString()&&(i=i.convertToNumberObjectValue()),n.isError())return n;if(i.isError())return i;let a=Math.floor(+n.getValue()),o=Math.floor(+i.getValue());if(a<0||o<0||0===a&&a<o)return ru.create(ea.NUM);let l=s1(a+o-1,a-1);return Number.isNaN(l)||!Number.isFinite(l)?ru.create(ea.NUM):nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},i2.COMBINA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}},i2.COS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}},i2.COSH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?ru.create(ea.NUM):0===r?ru.create(ea.DIV_BY_ZERO):t.tan().getReciprocal()}},i2.COT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:0==+t.getValue()?ru.create(ea.DIV_BY_ZERO):t.tanh().getReciprocal()}},i2.COTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?ru.create(ea.NUM):0===r?ru.create(ea.DIV_BY_ZERO):t.sin().getReciprocal()}},i2.CSC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return 0===r?ru.create(ea.DIV_BY_ZERO):Number.isNaN(r)||Number.isFinite(Math.sinh(r))?t.sinh().getReciprocal():nQ.create(0)}},i2.CSCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=`${e.getValue()}`,a=Math.floor(+n.getValue());if((0,j.isRealNum)(i)&&(0>+i||+i>=0x20000000000000||!Number.isInteger(+i))||"true"===i.toLocaleLowerCase()||"false"===i.toLocaleLowerCase()||a<2||a>36)return ru.create(ea.NUM);if(""===i.replace(/\s/g,""))return nQ.create(0);if(!this._isValidCharForRadix(i,a))return ru.create(ea.NUM);let o=Number.parseInt(i,a);return Number.isNaN(o)?ru.create(ea.NUM):nQ.create(o)});return 1===r&&1===n?a.get(0,0):a}_isValidCharForRadix(e,t){for(let r of e){let e=r.toUpperCase().charCodeAt(0);if(t<=10&&!(e>=48&&e<48+t)||t>10&&!(e>=48&&e<58||e>=65&&e<65+t-10))return!1}return!0}},i2.DECIMAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ru.create(ea.VALUE);let n=180/Math.PI*r;return Number.isNaN(n)?ru.create(ea.VALUE):nQ.create(n)}},i2.DEGREES],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ru.create(ea.VALUE);let n=(r<0?-n$(Math.abs(r)/2,0):n$(r/2,0))*2;return Number.isNaN(n)?ru.create(ea.VALUE):0===n?nQ.create(0):nQ.create(n)}},i2.EVEN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}},i2.EXP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s0(Math.floor(+t.getValue()));return Number.isNaN(r)||!Number.isFinite(r)?ru.create(ea.NUM):nQ.create(r)}},i2.FACT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){let r=e.getRowCount(),n=e.getColumnCount();if(r>1||n>1)return ru.create(ea.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=s0(Math.floor(+t.getValue()),2);return Number.isNaN(r)||!Number.isFinite(r)?ru.create(ea.NUM):nQ.create(r)}},i2.FACTDOUBLE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=+i.getValue(),o=+n.getValue();if(a>0&&o<0)return ru.create(ea.NUM);if(0===a)return nQ.create(0);if(0===o)return ru.create(ea.DIV_BY_ZERO);let l=nB(a/o,0)*o;return nQ.create(l)});return 1===r&&1===n?a.get(0,0):a}},i2.FLOOR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nQ.create(1),i=null!=r?r:nQ.create(0),s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,n,ru.create(ea.NA)),u=ii(s,a,i,ru.create(ea.NA)),c=o.map((e,t,r)=>{let n,i=e,s=l.get(t,r),a=u.get(t,r);if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let o=+i.getValue(),c=+s.getValue(),h=+a.getValue();return 0===o||0===c?nQ.create(0):(n=o<0&&0!==h?(c<0?nB(Math.abs(o)/Math.abs(c),0):-nB(Math.abs(o)/c,0))*c:(c<0?-nB(o/Math.abs(c),0):nB(o/c,0))*c,nQ.create(n))});return 1===s&&1===a?c.get(0,0):c}},i2.FLOOR_MATH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(0===s||0===o)return nQ.create(0);let l=(o<0?-nB(s/Math.abs(o),0):nB(s/o,0))*o;return nQ.create(l)});return 1===n&&1===i?o.get(0,0):o}},i2.FLOOR_PRECISE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull())if(n.isArray()){let e=!1,r=ru.create(ea.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:a}=this._handleSingleObject(n);if(i)return e=!0,r=s,!1;t=s2(t,a)}),e)return r}else{let{isError:e,errorObject:r,number:i}=this._handleSingleObject(n);if(e)return r;t=s2(t,i)}}return nQ.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0||r>=0x20000000000000?{isError:!0,errorObject:ru.create(ea.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i2.GCD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());return nQ.create(r)}},i2.INT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull())if(i.isArray()){let e=!1,n=ru.create(ea.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);if(s)return e=!0,n=a,!1;t=s5(t,o),r=!1}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;t=s5(t,s),r=!1}}return r?nQ.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=0x20000000000000?ru.create(ea.VALUE):nQ.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:ru.create(ea.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i2.LCM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}},i2.LN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(10);if(e.isError())return e;if(r.isError())return r;let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue();if(s<=0||o<=0)return ru.create(ea.NUM);let l=Math.log(o);if(0===l)return ru.create(ea.DIV_BY_ZERO);let u=Math.log(s)/l;return nQ.create(u)});return 1===n&&1===i?o.get(0,0):o}},i2.LOG],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}},i2.LOG10],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ru.create(ea.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return ru.create(ea.VALUE);let i=s3(n);return nQ.create(i)}},i2.MDETERM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ru.create(ea.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}if(t!==r)return ru.create(ea.VALUE);let i=function(e){let t=s3(e);return 0===t?null:1===e.length?[[1/t]]:(function(e){let t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let n=0;n<t;n++)for(let i=0;i<t;i++){let t=((n+i)%2==0?1:-1)*s3(function(e,t,r){return e.filter((e,r)=>r!==t).map(e=>e.filter((e,t)=>t!==r))}(e,n,i));r[i][n]=0===t?0:t}return r})(e).map(e=>e.map(e=>e/t))}(n);return null===i?ru.create(ea.NUM):n5.createByArray(i)}},i2.MINVERSE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(n!==i)return ru.create(ea.VALUE);let a=this._getMatrix(e,r,n),o=this._getMatrix(t,i,s);if(a instanceof ru)return a;if(o instanceof ru)return o;let l=s4(a,o);return n5.createByArray(l)}_getMatrix(e,t,r){let n=[];for(let i=0;i<t;i++){let t=[];for(let n=0;n<r;n++){let r=e.isArray()?e.get(i,n):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return ru.create(ea.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let s=+r.getValue();t.push(s)}n.push(t)}return n}},i2.MMULT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.mod(n)}},i2.MOD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return ru.create(ea.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return ru.create(ea.VALUE);if(0===s)return nQ.create(0);if(i>0&&s<0||i<0&&s>0)return ru.create(ea.NUM);let a=nj(i/s,0)*s;return nQ.create(a)}},i2.MROUND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let n=0;n<e.length;n++){let i=e[n];if(!i.isNull())if(i.isArray()){let e=!1,n=ru.create(ea.VALUE);if(i.iterator(i=>{if(null!=i&&i.isNull())return!0;let{isError:s,errorObject:a,number:o}=this._handleSingleObject(i);return s?(e=!0,n=a,!1):(t+=o)>170?(e=!0,n=ru.create(ea.NUM),!1):void(r*=s0(o))}),e)return n}else{let{isError:e,errorObject:n,number:s}=this._handleSingleObject(i);if(e)return n;if((t+=s)>170)return ru.create(ea.NUM);r*=s0(s)}}let n=s0(t)/r;return nQ.create(n)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:ru.create(ea.NUM),number:null}:{isError:!1,errorObject:null,number:r}}},i2.MULTINOMIAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount(),n=e.mapValue(e=>{let n=this._handleSingleObject(e);return n.isError()?n:t>1||r>1?n.get(0,0):n});return 1===t&&1===r?n.get(0,0):n}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());if(r<=0)return ru.create(ea.VALUE);let n=[];for(let e=0;e<r;e++){n[e]=[];for(let t=0;t<r;t++)n[e][t]=+(e===t)}return n5.createByArray(n)}},i2.MUNIT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ru.create(ea.VALUE);let n=r<0?-n$(Math.abs(r),0):n$(r,0);return Number.isNaN(n)?ru.create(ea.VALUE):(Math.abs(n)%2==0&&(r<0?n--:n++),nQ.create(n))}},i2.ODD],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){return nQ.create(Math.PI)}},i2.PI],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.pow(n)}},i2.POWER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(1),r=!0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isArray()){let e=!1,n=null;if(i.iterator(i=>null!=i&&i.isError()?(e=!0,n=i,!1):!!(!i||i.isNull()||i.isString()||i.isBoolean())||void(t=t.multiply(i),r=!1)),e)return n}else{if(i.isNull())continue;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;t=t.multiply(i),r=!1}if(t.isError())return t}return r?nQ.create(0):t}},i2.PRODUCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sW(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=+a.getValue();if(Number.isNaN(o)||Number.isNaN(l))return ru.create(ea.VALUE);if(0===l)return ru.create(ea.DIV_BY_ZERO);let u=Math.trunc(o/l);return nQ.create(u)}},i2.QUOTIENT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return ru.create(ea.VALUE);let n=Math.PI/180*r;return Number.isNaN(n)?ru.create(ea.VALUE):nQ.create(n)}},i2.RADIANS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",0)}calculate(){return nQ.create(Math.random())}},i2.RAND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",0),J(this,"maxParams",5),J(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n,i){if(null!=e&&e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=n&&n.isError())return n;if(null!=i&&i.isError())return i;let s=null!=e?e:nQ.create(1),a=null!=t?t:nQ.create(1),o=null!=r?r:nQ.create(0),l=null!=n?n:nQ.create(1),u=null!=i?i:nQ.create(0);return this._calculateResult(s,a,o,l,u)}_calculateResult(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1);if(1===s&&1===a)return this._calculateSingleCell(e,t,r,n,i);let o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,t,ru.create(ea.NA)),u=ii(s,a,r,ru.create(ea.NA)),c=ii(s,a,n,ru.create(ea.NA)),h=ii(s,a,i,ru.create(ea.NA));return o.map((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r),o=this._handleError(e,n,i,s,a);if(o.errorObject)return o.errorObject;let{minValue:d,maxValue:m,wholeNumberValue:g}=o,f;return g?(d=Math.ceil(d),f=Math.floor(Math.random()*((m=Math.floor(m))-d+1))+d):f=Math.random()*(m-d)+d,f<d||f>m?ru.create(ea.VALUE):nQ.create(f)})}_calculateSingleCell(e,t,r,n,i){let s=e;s.isArray()&&(s=s.get(0,0));let a=t;a.isArray()&&(a=a.get(0,0));let o=r;o.isArray()&&(o=o.get(0,0));let l=n;l.isArray()&&(l=l.get(0,0));let u=i;u.isArray()&&(u=u.get(0,0));let c=this._handleError(s,a,o,l,u);if(c.errorObject)return c.errorObject;let{rowsValue:h,columnsValue:d,minValue:m,maxValue:g,wholeNumberValue:f}=c;if(f&&(m=Math.ceil(m))>(g=Math.floor(g)))return ru.create(ea.VALUE);let p=[];for(let e=0;e<h;e++){let e=[];for(let t=0;t<d;t++)f?e.push(Math.floor(Math.random()*(g-m+1))+m):e.push(Math.random()*(g-m)+m);p.push(e)}return 1===h&&1===d?nQ.create(p[0][0]):n5.createByArray(p)}_handleError(e,t,r,n,i){let s=e;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return{errorObject:s};let a=t;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return{errorObject:a};let o=r;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return{errorObject:o};let l=n;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let u=i;return u.isString()&&(u=u.convertToNumberObjectValue()),u.isError()?{errorObject:u}:this._getValue(s,a,o,l,u)}_getValue(e,t,r,n,i){let s=Math.floor(+e.getValue()),a=Math.floor(+t.getValue());if(0===s||0===a)return{errorObject:ru.create(ea.CALC)};let o=this._rowCount-this.row,l=this._columnCount-this.column;if(s<0||a<0||s*a>1e7)return{errorObject:ru.create(ea.VALUE)};if(s>o||a>l)return{errorObject:ru.create(ea.REF)};let u=+r.getValue(),c=+n.getValue(),h=+i.getValue();return u>c?{errorObject:ru.create(ea.VALUE)}:!h||Number.isInteger(u)&&Number.isInteger(c)?{rowsValue:s,columnsValue:a,minValue:u,maxValue:c,wholeNumberValue:h}:{errorObject:ru.create(ea.VALUE)}}},i2.RANDARRAY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);r=r.get(0,0)}if(r.isError())return r;let n=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);n=n.get(0,0)}if(n.isError())return n;if(r.isBoolean()||n.isBoolean())return ru.create(ea.VALUE);let i=+r.getValue(),s=+n.getValue();if(Number.isNaN(i)||Number.isNaN(s))return ru.create(ea.VALUE);if(i>s)return ru.create(ea.NUM);i=Math.ceil(i);let a=Math.floor(Math.random()*((s=Math.floor(s))-i+1))+i;return nQ.create(a)}},i2.RANDBETWEEN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e);if(r)return n;let[s]=i,a=Math.floor(+s.getValue()),o=t;if(o.isString()&&(o=o.convertToNumberObjectValue()).isError())return o;let l=Math.floor(+o.getValue());if(o.isBoolean()&&(l=4*!o.getValue()),a<0||a>3999||l<0||l>4)return ru.create(ea.VALUE);let u=ai[l],c=u.length-1,h="";for(;a>0;){c=this._binarySearch(a,0,c,u);let e=u[c];a-=e,h+=an.get(e)}return nJ.create(h)}_binarySearch(e,t,r,n){let i=t,s=r;for(;s-i>1;){let t=Math.floor((i+s)/2),r=n[t];if(r===e)return t;r>e?s=t:i=t}return i!==s&&n[s]<=e?s:i}},i2.ROMAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.round(n)}},i2.ROUND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sY(e,n);if(i)return a;let[l,u]=o,c=+l.getValue(),h=Math.trunc(+u.getValue()),d=this._roundBank(c,h);return nQ.create(d)});return 1===r&&1===n?a.get(0,0):a}_roundBank(e,t){if(t>16)return e;if(t<-16)return 0;let r=10**t,n=+(e*r).toFixed(8),i=Math.floor(n),s=n-i,a=Math.round(n);return s>.49999999&&s<.50000001&&(a=i%2==0?i:i+1),t?a/r:a}},i2.ROUNDBANK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.floor(n)}},i2.ROUNDDOWN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let n=t;return n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:r.ceil(n)}},i2.ROUNDUP],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())?t:Math.abs(+t.getValue())>=0x8000000?ru.create(ea.NUM):t.cos().getReciprocal()}},i2.SEC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=0x8000000?ru.create(ea.NUM):t.cosh().getReciprocal():nQ.create(0)}},i2.SECH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){if(e.isNull()||t.isNull()||r.isNull()||n.isNull())return ru.create(ea.NA);let{isError:i,errorObject:s,variants:a}=sW(e,t,r);if(i)return s;let{isError:o,errorObject:l,variants:u}=sY(...a);if(o)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=+d.getValue(),p=[];if(n.isArray()){let e=!1,t=ru.create(ea.VALUE);if(n.iterator(r=>{let{isError:n,errorObject:i,coefficientsObject:s}=this._handleSingleObject(r);if(n)return e=!0,t=i,!1;let a=+s.getValue();p.push(a)}),e)return t}else{let{isError:e,errorObject:t,coefficientsObject:r}=this._handleSingleObject(n);if(e)return t;let i=+r.getValue();p.push(i)}let C=0;for(let e=0;e<p.length;e++)C+=p[e]*m**(g+e*f);return Number.isNaN(C)||!Number.isFinite(C)?ru.create(ea.NUM):nQ.create(C)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(null!=e&&e.isBoolean())return{isError:!0,errorObject:ru.create(ea.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}},i2.SERIESSUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4),J(this,"needsSheetRowColumnCount",!0)}calculate(e,t,r,n){let i=e,s=null!=t?t:nQ.create(1),a=null!=r?r:nQ.create(1),o=null!=n?n:nQ.create(1);i.isNull()&&(i=nQ.create(1)),s.isNull()&&(s=nQ.create(1)),a.isNull()&&(a=nQ.create(1)),o.isNull()&&(o=nQ.create(1));let l=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,i,ru.create(ea.NA)),h=ii(l,u,s,ru.create(ea.NA)),d=ii(l,u,a,ru.create(ea.NA)),m=ii(l,u,o,ru.create(ea.NA)),g=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._getResult(e,n,i,s,l,u)});return 1===l&&1===u?g.get(0,0):g}_getResult(e,t,r,n,i,s){let{isError:a,errorObject:o,variants:l}=sY(e,t,r,n);if(a)return o;let[u,c,h,d]=l,m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue(),p=+d.getValue();if(m<0||g<0||m*g>1e7)return ru.create(ea.VALUE);if(0===m||0===g)return ru.create(ea.CALC);let C=this._rowCount-this.row,_=this._columnCount-this.column;if(m>C||g>_)return ru.create(ea.REF);let y=[];for(let e=0;e<m;e++){y[e]=[];for(let t=0;t<g;t++)y[e][t]=f+(e*g+t)*p}return i>1||s>1?nQ.create(y[0][0]):n5.createByArray(y)}},i2.SEQUENCE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue();return s>0?nQ.create(1):s<0?nQ.create(-1):nQ.create(0)}},i2.SIGN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}},i2.SIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}},i2.SINH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}},i2.SQRT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return ru.create(ea.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(r<0)return ru.create(ea.NUM);let n=Math.sqrt(r*Math.PI);return nQ.create(n)}},i2.SQRTPI],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255),J(this,"needsReferenceObject",!0),J(this,"needsFilteredOutRows",!0)}calculate(e,...t){return e.isError()?e:e.isReferenceObject()?e.toArrayValueObject().mapValue(e=>this._handleSingleObject(e,...t)):this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){let r,n=this._getIndexNumValue(e);if(n instanceof ru)return n;switch(n){case 1:r=this._average(!1,...t);break;case 2:r=this._count(!1,...t);break;case 3:r=this._counta(!1,...t);break;case 4:r=this._max(!1,...t);break;case 5:r=this._min(!1,...t);break;case 6:r=this._product(!1,...t);break;case 7:r=this._stdev(!1,...t);break;case 8:r=this._stdevp(!1,...t);break;case 9:r=this._sum(!1,...t);break;case 10:r=this._var(!1,...t);break;case 11:r=this._varp(!1,...t);break;case 101:r=this._average(!0,...t);break;case 102:r=this._count(!0,...t);break;case 103:r=this._counta(!0,...t);break;case 104:r=this._max(!0,...t);break;case 105:r=this._min(!0,...t);break;case 106:r=this._product(!0,...t);break;case 107:r=this._stdev(!0,...t);break;case 108:r=this._stdevp(!0,...t);break;case 109:r=this._sum(!0,...t);break;case 110:r=this._var(!0,...t);break;case 111:r=this._varp(!0,...t);break;default:r=ru.create(ea.VALUE)}return r}_getIndexNumValue(e){let t=e?Number(e.getValue()):0;if(Number.isNaN(t))return ru.create(ea.VALUE);let r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:ru.create(ea.VALUE)}_average(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=nQ.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return ru.create(ea.VALUE);let s=i.getFilteredOutRows(),a=i.getRowData();i.iterator((t,n)=>{if(s.includes(n)||e&&this._isRowHidden(a,n))return!0;null!=t&&t.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=nQ.create(0);for(let n=0;n<t.length;n++){let i=t[n];if(!i.isReferenceObject())return ru.create(ea.VALUE);let s=i.getFilteredOutRows(),a=i.getRowData();i.iterator((t,n)=>{if(s.includes(n)||e&&this._isRowHidden(a,n)||null==t||t.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nQ.create(0):r.max()}_min(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nQ.create(0):r.min()}_product(e,...t){let r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return nQ.create(0);let n=nQ.create(1);return r.iterator(e=>{n=n.multiply(e)}),n}_stdev(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ru.create(ea.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ru.create(ea.DIV_BY_ZERO):r.std()}_sum(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ru.create(ea.DIV_BY_ZERO):r.var(1)}_varp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?ru.create(ea.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){let r=[];r[0]=[];for(let n=0;n<t.length;n++){let i,s=t[n];if(s.isError())return s;if(!s.isReferenceObject())return ru.create(ea.VALUE);let a=s.getFilteredOutRows(),o=s.getRowData();if(s.iterator((t,n)=>!!(a.includes(n)||e&&this._isRowHidden(o,n)||null==t||t.isNull()||t.isString()||t.isBoolean())||(t.isError()?(i=t,!1):void r[0].push(t))),null!=i&&i.isError())return i}return is(r,1,r[0].length)}_isRowHidden(e,t){let r=e[t];return!!r&&r.hd===j.BooleanNumber.TRUE}_isBlankArrayObject(e){return 0===e.getArrayValue()[0].length}},i2.SUBTOTAL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()||(n.isArray()&&(n=n.sum()),n.isError()))return n;if((t=t.plus(n)).isError())break}return t}},i2.SUM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=t;if(t.isReferenceObject()&&(n=t.toArrayValueObject()),n.isArray()){let t=n.mapValue(t=>this._handleSingleObject(e,t,r));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,n,r)}_handleSingleObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(!e.isReferenceObject()||r&&!r.isReferenceObject())return ru.create(ea.VALUE);let n=e.toArrayValueObject(),i=io(n,t);i=im(i,n,t);let s=n.getRowCount(),a=n.getColumnCount(),o=n;if(r){let e=(o=r.toArrayValueObject()).getRowCount(),t=o.getColumnCount();if(s!==e||a!==t){let e=r.getRangeData();e.endRow=e.startRow+s-1,e.endColumn=e.startColumn+a-1,r.setRangeData(e),o=r.toArrayValueObject()}}return o.pick(i).sum()}},i2.SUMIF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ru.create(ea.VALUE);let{maxRowLength:r,maxColumnLength:n}=ic(t),i=ih(t,e,r,n);if(i)return i;let s=id(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>e.pick(t).sum())),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(n)}},i2.SUMIFS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=this._initArray1(e);if(!(t.length>0))return r.sum();{let e=r.getRowCount(),n=r.getColumnCount(),i=this._getResultArrayByArray1(e,n,r);if(i instanceof ru)return i;for(let r=0;r<t.length;r++){if(t[r].isError())return t[r];let s=1,a=1;if(t[r].isArray()&&(s=t[r].getRowCount(),a=t[r].getColumnCount()),s!==e||a!==n)return ru.create(ea.VALUE);for(let s=0;s<e;s++){let e=[];for(let a=0;a<n;a++){let n=t[r];if(t[r].isArray()&&(n=t[r].get(s,a)),n.isError())return n;let o=n.getValue();o&&(0,j.isRealNum)(o)?e.push(o*i[s][a]):e.push(0)}i[s]=e}}let s=i.reduce((e,t)=>e.concat(t)).reduce((e,t)=>e+t,0);return nQ.create(s)}}_initArray1(e){let t=e;return t.isArray()||(t=n5.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){let n=[];for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.get(i,n);if(t.isError())return t;let s=t.getValue();s&&(0,j.isRealNum)(s)?e.push(+s):e.push(0)}n.push(e)}return n}},i2.SUMPRODUCT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0),r=nQ.create(2);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()?i.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.plus(e.pow(r))))):t=t.plus(i.pow(r)),t.isError())break}return t}},i2.SUMSQ],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ru.create(ea.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nX.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2-c**2}),i.isError()?i:0===s.length||0===a.length?ru.create(ea.DIV_BY_ZERO):nQ.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ru.create(ea.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,j.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,j.isRealNum)(s)||n.isBoolean())return ru.create(ea.DIV_BY_ZERO);let a=i**2-s**2;return nQ.create(a)}},i2.SUMX2MY2],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ru.create(ea.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nX.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=u**2+c**2}),i.isError()?i:0===s.length||0===a.length?ru.create(ea.DIV_BY_ZERO):nQ.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ru.create(ea.VALUE);let i=+r.getValue(),s=+n.getValue();if(r.isString()&&!(0,j.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,j.isRealNum)(s)||n.isBoolean())return ru.create(ea.DIV_BY_ZERO);let a=i**2+s**2;return nQ.create(a)}},i2.SUMX2PY2],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return ru.create(ea.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),n=t.flatten(),i=nX.create(),s=[],a=[],o=0;return r.iterator((e,t,r)=>{let l=n.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return i=e,!1;if(null==l||l.isString()||l.isBoolean()||l.isNull())return!0;if(null!=l&&l.isError())return i=l,!1;let u=+e.getValue(),c=+l.getValue();s.push(u),a.push(c),o+=(u-c)**2}),i.isError()?i:0===s.length||0===a.length?ru.create(ea.DIV_BY_ZERO):nQ.create(o)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let n=t;if(n.isArray()&&(n=n.get(0,0)),n.isError())return n;if(r.isNull()||n.isNull())return ru.create(ea.VALUE);let i=+r.getValue(),s=+n.getValue();return r.isString()&&!(0,j.isRealNum)(i)||r.isBoolean()||n.isString()&&!(0,j.isRealNum)(s)||n.isBoolean()?ru.create(ea.DIV_BY_ZERO):nQ.create((i-s)**2)}},i2.SUMXMY2],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}},i2.TAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}},i2.TANH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.map((e,t,r)=>{let n=a.get(t,r),i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+i.getValue(),o=+n.getValue(),l=10**Math.trunc(o),u=nH(s,l),c=Math.trunc(nk(s,l)+u)/l;return nQ.create(c)});return 1===n&&1===i?o.get(0,0):o}},i2.TRUNC]];class lh extends ro{constructor(e){super(""),J(this,"_values",[]),this._values=e}static create(e){return new lh(e)}isCube(){return!0}dispose(){this._values.forEach(e=>{e.dispose()}),this._values=[]}sum(){let e=nQ.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=nQ.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=nQ.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){let e=nQ.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){let e=nQ.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){let e=nQ.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}}let ld=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2),J(this,"_compareType",eh.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}},iU.COMPARE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:t.isArray()||0!==t.getValue()?e.divided(t):ru.create(ea.DIV_BY_ZERO)}},iU.DIVIDED],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}},iU.MINUS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}},iU.MULTIPLY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}},iU.PLUS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isError())return n;if(!n.isArray())return ru.create(ea.VALUE);t.push(n)}return lh.create(t)}},iU.CUBE]];class lm extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=r.isArray()?r.getRowCount():1,a=r.isArray()?r.getColumnCount():1,o=t;t.isArray()&&1===n&&1===i&&(o=t.get(0,0));let l=r;return r.isArray()&&1===s&&1===a&&(l=r.get(0,0)),e.isArray()?e.mapValue(e=>this._handleSignleObject(e,o,l,n,i,s,a)):this._handleSignleObject(e,o,l,n,i,s,a)}_handleSignleObject(e,t,r,n,i,s,a){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let o=e;if(e.isString()&&(o=e.convertToNumberObjectValue()),o.isError())return o;let l=+o.getValue();if((n*i==1||s*a==1)&&(t.isNull()||r.isNull()))return ru.create(ea.VALUE);if(n*i!=s*a)return ru.create(ea.NA);let{isError:u,errorObject:c,array1Values:h,array2Values:d,noCalculate:m}=aO(t,r,n*i,i,a);if(u)return c;if(m)return ru.create(ea.DIV_BY_ZERO);let g=aC(l,h,d);return Number.isFinite(g)?nQ.create(g):ru.create(ea.DIV_BY_ZERO)}}var lg=((L=lg||{}).AVEDEV="AVEDEV",L.AVERAGE="AVERAGE",L.AVERAGE_WEIGHTED="AVERAGE.WEIGHTED",L.AVERAGEA="AVERAGEA",L.AVERAGEIF="AVERAGEIF",L.AVERAGEIFS="AVERAGEIFS",L.BETA_DIST="BETA.DIST",L.BETA_INV="BETA.INV",L.BINOM_DIST="BINOM.DIST",L.BINOM_DIST_RANGE="BINOM.DIST.RANGE",L.BINOM_INV="BINOM.INV",L.CHISQ_DIST="CHISQ.DIST",L.CHISQ_DIST_RT="CHISQ.DIST.RT",L.CHISQ_INV="CHISQ.INV",L.CHISQ_INV_RT="CHISQ.INV.RT",L.CHISQ_TEST="CHISQ.TEST",L.CONFIDENCE_NORM="CONFIDENCE.NORM",L.CONFIDENCE_T="CONFIDENCE.T",L.CORREL="CORREL",L.COUNT="COUNT",L.COUNTA="COUNTA",L.COUNTBLANK="COUNTBLANK",L.COUNTIF="COUNTIF",L.COUNTIFS="COUNTIFS",L.COVARIANCE_P="COVARIANCE.P",L.COVARIANCE_S="COVARIANCE.S",L.DEVSQ="DEVSQ",L.EXPON_DIST="EXPON.DIST",L.F_DIST="F.DIST",L.F_DIST_RT="F.DIST.RT",L.F_INV="F.INV",L.F_INV_RT="F.INV.RT",L.F_TEST="F.TEST",L.FISHER="FISHER",L.FISHERINV="FISHERINV",L.FORECAST="FORECAST",L.FORECAST_ETS="FORECAST.ETS",L.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",L.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",L.FORECAST_ETS_STAT="FORECAST.ETS.STAT",L.FORECAST_LINEAR="FORECAST.LINEAR",L.FREQUENCY="FREQUENCY",L.GAMMA="GAMMA",L.GAMMA_DIST="GAMMA.DIST",L.GAMMA_INV="GAMMA.INV",L.GAMMALN="GAMMALN",L.GAMMALN_PRECISE="GAMMALN.PRECISE",L.GAUSS="GAUSS",L.GEOMEAN="GEOMEAN",L.GROWTH="GROWTH",L.HARMEAN="HARMEAN",L.HYPGEOM_DIST="HYPGEOM.DIST",L.INTERCEPT="INTERCEPT",L.KURT="KURT",L.LARGE="LARGE",L.LINEST="LINEST",L.LOGEST="LOGEST",L.LOGNORM_DIST="LOGNORM.DIST",L.LOGNORM_INV="LOGNORM.INV",L.MARGINOFERROR="MARGINOFERROR",L.MAX="MAX",L.MAXA="MAXA",L.MAXIFS="MAXIFS",L.MEDIAN="MEDIAN",L.MIN="MIN",L.MINA="MINA",L.MINIFS="MINIFS",L.MODE_MULT="MODE.MULT",L.MODE_SNGL="MODE.SNGL",L.NEGBINOM_DIST="NEGBINOM.DIST",L.NORM_DIST="NORM.DIST",L.NORM_INV="NORM.INV",L.NORM_S_DIST="NORM.S.DIST",L.NORM_S_INV="NORM.S.INV",L.PEARSON="PEARSON",L.PERCENTILE_EXC="PERCENTILE.EXC",L.PERCENTILE_INC="PERCENTILE.INC",L.PERCENTRANK_EXC="PERCENTRANK.EXC",L.PERCENTRANK_INC="PERCENTRANK.INC",L.PERMUT="PERMUT",L.PERMUTATIONA="PERMUTATIONA",L.PHI="PHI",L.POISSON_DIST="POISSON.DIST",L.PROB="PROB",L.QUARTILE_EXC="QUARTILE.EXC",L.QUARTILE_INC="QUARTILE.INC",L.RANK_AVG="RANK.AVG",L.RANK_EQ="RANK.EQ",L.RSQ="RSQ",L.SKEW="SKEW",L.SKEW_P="SKEW.P",L.SLOPE="SLOPE",L.SMALL="SMALL",L.STANDARDIZE="STANDARDIZE",L.STDEV_P="STDEV.P",L.STDEV_S="STDEV.S",L.STDEVA="STDEVA",L.STDEVPA="STDEVPA",L.STEYX="STEYX",L.T_DIST="T.DIST",L.T_DIST_2T="T.DIST.2T",L.T_DIST_RT="T.DIST.RT",L.T_INV="T.INV",L.T_INV_2T="T.INV.2T",L.T_TEST="T.TEST",L.TREND="TREND",L.TRIMMEAN="TRIMMEAN",L.VAR_P="VAR.P",L.VAR_S="VAR.S",L.VARA="VARA",L.VARPA="VARPA",L.WEIBULL_DIST="WEIBULL.DIST",L.Z_TEST="Z.TEST",L);class lf extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue();if(s<=0)return ru.create(ea.NUM);let a=ay(s);return 1e-15>Math.abs(a)?nQ.create(0):nQ.create(a)}}let lp=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0),r=nQ.create(0);for(let n=0;n<e.length;n++){let i=e[n];if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((i=function(e){let t=[];t[0]=[];let r=null;return e.iterator((e,n,i)=>{if(null!=e&&e.isError())return r=e,!1;null!=e&&e.isNumber()&&t[0].push(e)}),r||is(t,1,t[0].length)}(i)).isError())return i;if(e[n]=i,(t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nQ.create(1)))}if(0===r.getValue())return ru.create(ea.NUM);let n=t.divided(r);if(n.isError())return n;let i=nQ.create(0);for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;if(r.isArray()){if((i=i.plus(r.minus(n).abs().sum())).isError())return i}else r.isNull()||(i=i.plus(r.minus(n).abs()))}return i.divided(r)}},lg.AVEDEV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0),r=nQ.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if((t=t.plus(i.sum())).isError())return t;r=r.plus(i.count())}else i.isNull()||(t=t.plus(i),r=r.plus(nQ.create(1)))}return t.divided(r)}},lg.AVERAGE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",254)}calculate(...e){let t=!1,r;e.length%2!=0&&(t=!0,r=ru.create(ea.NA));let n=[],i=[];for(let s=0;s<e.length;s+=2){let a=e[s],o=a.isArray()?a.getRowCount():1,l=a.isArray()?a.getColumnCount():1;for(let e=0;e<o;e++)for(let r=0;r<l;r++){let i=a.isArray()?a.get(e,r):a;if(i.isError())return i;if(t)continue;let s=i.isNull()?"":i.getValue();n.push(s)}if(s+1>=e.length)continue;let u=e[s+1],c=u.isArray()?u.getRowCount():1,h=u.isArray()?u.getColumnCount():1;(c!==o||h!==l)&&(t=!0,r=ru.create(ea.VALUE));for(let e=0;e<c;e++)for(let r=0;r<h;r++){let n=u.isArray()?u.get(e,r):u;if(n.isError())return n;if(t)continue;let s=n.isNull()?"":n.getValue();i.push(s)}}return t?r:this._getResult(n,i)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++){let r=e[s],a=t[s];if("number"==typeof r||"number"==typeof a){if("number"!=typeof r||"number"!=typeof a||a<0)return ru.create(ea.VALUE);n+=r*a,i+=a}}if(0===i)return ru.create(ea.DIV_BY_ZERO);let s=n/i;return nQ.create(s)}},lg.AVERAGE_WEIGHTED],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0),r=nQ.create(0);for(let n=0;n<e.length;n++){let i=e[n];if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(i.isArray()){if(i.iterator(e=>{if(null==e||e.isNull())return!0;let n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()).isError()&&(n=nQ.create(0)),n.isBoolean()&&(n=n.convertToNumberObjectValue()),n.isError())return t=n,!1;t=t.plus(n),r=r.plus(nQ.create(1))}),t.isError())return t}else i.isNull()||(t=t.plus(i),r=r.plus(nQ.create(1)))}return t.divided(r)}},lg.AVERAGEA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject()),n.isArray()||(n=is([[n]],1,1));let i=t;return i.isReferenceObject()&&(i=i.toArrayValueObject()),r&&!(null!=r&&r.isReferenceObject())?ru.create(ea.NA):i.isArray()?i.map(e=>this._handleSingleObject(n,e,r)):this._handleSingleObject(n,i,r)}_handleSingleObject(e,t,r){let n=io(e,t);n=im(n,e,t);let i=r?this._createRangeReferenceObject(r,e):e;if(!i)return ru.create(ea.VALUE);if(i.isError())return i;i.isReferenceObject()&&(i=i.toArrayValueObject());let s=i.pick(n),a=s.sum(),o=s.count();return a.divided(o)}_createRangeReferenceObject(e,t){let r=e.getRowCount(),n=e.getColumnCount(),i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1;if(r===i&&n===s)return e;let{startRow:a,startColumn:o}=e.getRangePosition();return this.createReferenceObject(e,{startRow:a,startColumn:o,endRow:a+i-1,endColumn:o+s-1})}},lg.AVERAGEIF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ru.create(ea.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ru.create(ea.VALUE);let{maxRowLength:r,maxColumnLength:n}=ic(t),i=ih(t,e,r,n);if(i)return i;let s=id(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t),n=r.sum(),i=r.count();return n.divided(i)})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(n)}},lg.AVERAGEIFS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=i?i:nQ.create(0),o=null!=s?s:nQ.create(1);a.isNull()&&(a=nQ.create(0)),o.isNull()&&(o=nQ.create(1));let l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,a.isArray()?a.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,a.isArray()?a.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,e,ru.create(ea.NA)),h=ii(l,u,t,ru.create(ea.NA)),d=ii(l,u,r,ru.create(ea.NA)),m=ii(l,u,n,ru.create(ea.NA)),g=ii(l,u,a,ru.create(ea.NA)),f=ii(l,u,o,ru.create(ea.NA)),p=c.mapValue((e,t,r)=>{let n=h.get(t,r),i=d.get(t,r),s=m.get(t,r),a=g.get(t,r),o=f.get(t,r);return this._handleSignleObject(e,n,i,s,a,o)});return 1===l&&1===u?p.get(0,0):p}_handleSignleObject(e,t,r,n,i,s){var a;let o;if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(n.isError())return n;if(i.isError())return i;if(s.isError())return s;let{isError:l,errorObject:u,variants:c}=sY(e,t,r,n,i,s);if(l)return u;let[h,d,m,g,f,p]=c,C=+h.getValue(),_=+d.getValue(),y=+m.getValue(),E=+g.getValue(),R=+f.getValue(),b=+p.getValue();return _<=0||y<=0||C<R||C>b||R===b?ru.create(ea.NUM):(o=E?as((C-R)/(b-R),_,y):((a=(C-R)/(b-R))<=0||a>=1?0:1===_&&1===y?1:_<512&&y<512?a**(_-1)*(1-a)**(y-1)/au(_,y):Math.exp((_-1)*Math.log(a)+(y-1)*Math.log(1-a)-ac(_,y)))/(b-R),nQ.create(o))}},lg.BETA_DIST],[aP,lg.BETA_INV],[aF,lg.BINOM_DIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let i=null!=n?n:r;i.isNull()&&(i=r);let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,t,ru.create(ea.NA)),u=ii(s,a,r,ru.create(ea.NA)),c=ii(s,a,i,ru.create(ea.NA)),h=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===s&&1===a?h.get(0,0):h}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sY(e,t,r,n);if(i)return s;let[o,l,u,c]=a,h=Math.floor(+o.getValue()),d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue());if(h<0||d<0||d>1||m<0||m>h||g<0||g<m||g>h)return ru.create(ea.NUM);let f=0;for(let e=m;e<=g;e++)f+=ad(e,h,d);return nQ.create(f)}},lg.BINOM_DIST_RANGE],[ak,lg.BINOM_INV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sY(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return c<0||h<1||h>1e10?ru.create(ea.NUM):(d?n=am(c,h):n=c<0?0:0===c&&2===h?.5:Math.exp((h/2-1)*Math.log(c)-c/2-h/2*Math.log(2)-ay(h/2)),nQ.create(n))}},lg.CHISQ_DIST],[aj,lg.CHISQ_DIST_RT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||o>1||l<1||l>1e10)return ru.create(ea.NUM);let u=ag(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},lg.CHISQ_INV],[aB,lg.CHISQ_INV_RT],[a$,lg.CHISQ_TEST],[aH,lg.CONFIDENCE_NORM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);if(e.isError())return e;if(n.isError())return n;if(i.isError())return i;let{isError:s,errorObject:l,variants:u}=sY(e,n,i);if(s)return l;let[c,h,d]=u,m=+c.getValue(),g=+h.getValue(),f=Math.floor(+d.getValue());if(m<=0||m>=1||g<=0||f<1)return ru.create(ea.NUM);if(1===f)return ru.create(ea.DIV_BY_ZERO);let p=Math.abs(aM(m/2,f-1)*g/Math.sqrt(f));return nQ.create(p)});return 1===n&&1===i?l.get(0,0):l}},lg.CONFIDENCE_T],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ru.create(ea.VALUE):ru.create(ea.DIV_BY_ZERO);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++){let r=e[n]-s,i=t[n]-a;o+=r*i,l+=r**2,u+=i**2}let c=Math.sqrt(l*u);return 0===c?ru.create(ea.DIV_BY_ZERO):nQ.create(o/c)}},lg.CORREL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0);for(let r=0;r<e.length;r++){let n=e[r];n.isError()||(n.isArray()?t=t.plus(n.count()):n.isString()?n.convertToNumberObjectValue().isError()||(t=t.plus(nQ.create(1))):n.isNull()||(t=t.plus(nQ.create(1))))}return t}},lg.COUNT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(0);for(let r=0;r<e.length;r++){let n=e[r];if(n.isError()){t=t.plus(nQ.create(1));continue}n.isArray()?(n=n.countA(),t=t.plus(n)):n.isNull()||(t=t.plus(nQ.create(1)))}return t}},lg.COUNTA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isError()?e:""===e.getValue()||e.isNull()?nQ.create(1):e.isArray()?e.countBlank():nQ.create(0)}},lg.COUNTBLANK],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?ru.create(ea.NA):e.isArray()?t.isArray()?t.mapValue(t=>this._handleSingleObject(e,t)):this._handleSingleObject(e,t):ru.create(ea.VALUE)}_handleSingleObject(e,t){let r=io(e,t);r=im(r,e,t);let n=e.pick(r);return this._countA(n)}_countA(e){let t=nQ.create(0);return e.iterator(e=>{if(null==e)return!0;t=t.plusBy(1)}),t}},lg.COUNTIF],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",255)}calculate(...e){if(e.length%2!=0||e.some((e,t)=>t%2==0&&!e.isArray()))return ru.create(ea.VALUE);let{maxRowLength:t,maxColumnLength:r}=ic(e),n=ih(e,e[0],t,r);if(n)return n;let i=id(e,t,r,!0);return this._aggregateResults(i)}_aggregateResults(e){let t=e.map(e=>e.map(e=>{let t;return t=0,e.iterator(e=>{null!=e&&e.isBoolean()&&!0===e.getValue()&&t++}),nQ.create(t)})),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(r)}},lg.COUNTIFS],[aW,lg.COVARIANCE_P],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ru.create(ea.VALUE);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(e.length<=1)return ru.create(ea.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a);return nQ.create(o/(r-1))}},lg.COVARIANCE_S],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[],r=0,n=!0;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ru.create(ea.VALUE);if(s.iterator(s=>{let a=this._handleSingleObject(s);if(a.isError())return e=!0,i=a,!1;if(a.isNull())return!0;let o=a.getValue();t.push(o),r+=o,n=!1}),e)return i}else{let e=this._handleSingleObject(s);if(e.isError())return e;if(e.isNull())continue;let i=e.getValue();t.push(i),r+=i,n=!1}}if(n)return ru.create(ea.NUM);let i=r/t.length,s=0;for(let e=0;e<t.length;e++)s+=(t[e]-i)**2;return nQ.create(s)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return nX.create();let t=e.getValue();return(0,j.isRealNum)(t)?nQ.create(+t):nX.create()}},lg.DEVSQ],[aG,lg.EXPON_DIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=Math.floor(+u.getValue()),g=Math.floor(+c.getValue()),f=+h.getValue();return d<0||m<1||m>1e10||g<1||g>1e10||Number.isNaN(i=f?af(d,m,g):function(e,t,r){if(e<0)return 0;if(0===e&&t<2)return 1/0;if(0===e&&2===t)return 1;let n=1/au(t/2,r/2);return(t/r)**(t/2)*e**(t/2-1)*(1+t/r*e)**(-(t+r)/2)*n}(d,m,g))||!Number.isFinite(i)?ru.create(ea.NUM):nQ.create(i)}},lg.F_DIST],[aY,lg.F_DIST_RT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.floor(+o.getValue()),h=Math.floor(+l.getValue());if(u<0||u>1||c<1||c>1e10||h<1||h>1e10)return ru.create(ea.NUM);let d=ap(u,c,h);return Number.isNaN(d)||!Number.isFinite(d)?ru.create(ea.NUM):nQ.create(d)}},lg.F_INV],[az,lg.F_INV_RT],[aX,lg.F_TEST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=i.getValue();if(s<=-1||s>=1)return ru.create(ea.NUM);let a=Math.log((1+s)/(1-s))/2;return nQ.create(a)}},lg.FISHER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(2*s)-1,o=Math.exp(2*s)+1;return!Number.isFinite(a)&&a>0&&!Number.isFinite(o)&&o>0?nQ.create(1):nQ.create(a/o)}},lg.FISHERINV],[lm,lg.FORECAST],[lm,lg.FORECAST_LINEAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,values:i}=this._getValues(e);if(r)return n;if(e.isNull()||t.isNull())return ru.create(ea.VALUE);let{values:s}=this._getValues(t,!0);0===s.length&&(s=[0]);let a=this._getNewBinsArrayValues(s),o=Array(a.length).fill(0);for(let e=0;e<i.length;e++){let t=i[e],r=a.findIndex(e=>t>e.start&&t<=e.end);o[r]++}return n5.createByArray(o.map(e=>[e]))}_getValues(e,t=!1){let r=[],n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1;for(let s=0;s<n;s++)for(let n=0;n<i;n++){let i=e.isArray()?e.get(s,n):e;if(i.isError()){if(!t)return{isError:!0,errorObject:i,values:r};continue}if(i.isNull()||i.isBoolean())continue;let a=i.getValue();(0,j.isRealNum)(a)&&r.push(+a)}return{isError:!1,errorObject:null,values:r}}_getNewBinsArrayValues(e){let t=e.map((e,t)=>({value:e,index:t})).sort((e,t)=>e.value-t.value),r=[];for(let e=0;e<t.length;e++){let n=t[e].index;if(0===e){r[n]={start:-1/0,end:t[e].value};continue}r[n]={start:t[e-1].value,end:t[e].value}}return r.push({start:t[t.length-1].value,end:1/0}),r}},lg.FREQUENCY],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue();if(0===s||s<0&&s%1==0)return ru.create(ea.NUM);let a=a_(s);return Number.isNaN(a)||!Number.isFinite(a)?ru.create(ea.NUM):nQ.create(a)}},lg.GAMMA],[aq,lg.GAMMA_DIST],[aK,lg.GAMMA_INV],[lf,lg.GAMMALN],[lf,lg.GAMMALN_PRECISE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=aS(+i.getValue(),0,1)-.5;return nQ.create(s)}},lg.GAUSS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=1,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ru.create(ea.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,j.isRealNum)(a))return!0;0>=+a&&(n=!0),t*=a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,j.isRealNum)(e))continue;0>=+e&&(n=!0),t*=e,r++}}if(0===r||n)return ru.create(ea.NUM);let i=t**(1/r);return nQ.create(i)}},lg.GEOMEAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=ax(e,t,r);if(i)return s;let a=aU(e);if(a instanceof ru)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ru)return o;let l=this._getNewXsValues(o,r);if(l instanceof ru)return l;let u=null!=n?n:nK.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?ru.create(ea.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aL(e,t,r,n,!0);if(s instanceof ru)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t*=a[0][l-2-r]**o[e][r];c[e].push(t)}return i&&(c=s6(c)),n5.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aV(t.flat(),i,n,!0),o=r.map(e=>e.map(e=>a*s**e));return n5.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aD(e.length,e[0].length):aU(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aU(t)}},lg.GROWTH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=0,r=0,n=!1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isArray()){let e=!1,i=ru.create(ea.VALUE);if(s.iterator(s=>{if(null!=s&&s.isError())return e=!0,i=s,!1;if(null!=s&&s.isNull()||null!=s&&s.isBoolean())return!0;let a=s.getValue();if(!(0,j.isRealNum)(a))return!0;0>=+a&&(n=!0),t+=1/a,r++}),e)return i}else{if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}if(s.isNull()||s.isBoolean())continue;let e=s.getValue();if(!(0,j.isRealNum)(e))continue;0>=+e&&(n=!0),t+=1/e,r++}}if(0===r)return ru.create(ea.NA);if(n)return ru.create(ea.NUM);let i=r/t;return nQ.create(i)}},lg.HARMEAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",5),J(this,"maxParams",5)}calculate(e,t,r,n,i){let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,t,ru.create(ea.NA)),u=ii(s,a,r,ru.create(ea.NA)),c=ii(s,a,n,ru.create(ea.NA)),h=ii(s,a,i,ru.create(ea.NA)),d=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=c.get(t,r),a=h.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:a.isError()?a:this._handleSignleObject(e,n,i,s,a)});return 1===s&&1===a?d.get(0,0):d}_handleSignleObject(e,t,r,n,i){let s,{isError:a,errorObject:o,variants:l}=sY(e,t,r,n,i);if(a)return o;let[u,c,h,d,m]=l,g=Math.floor(+u.getValue()),f=Math.floor(+c.getValue()),p=Math.floor(+h.getValue()),C=Math.floor(+d.getValue()),_=+m.getValue();return g<0||g>f||g>p||g<f-C+p||f<=0||f>C||p<=0||p>C||C<=0?ru.create(ea.NUM):(Number.isNaN(s=_?function(e,t,r,n){let i=0;for(let s=0;s<=e;s++)i+=ab(s,t,r,n);return i}(g,f,p,C):ab(g,f,p,C))&&(s=0),nQ.create(s))}},lg.HYPGEOM_DIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ru.create(ea.VALUE):ru.create(ea.DIV_BY_ZERO);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=aC(0,e,t);return Number.isFinite(r)?nQ.create(r):ru.create(ea.DIV_BY_ZERO)}},lg.INTERCEPT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,j.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=3?ru.create(ea.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return ru.create(ea.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**4;let o=r*(r+1)/((r-1)*(r-2)*(r-3))*a-3*(r-1)**2/((r-2)*(r-3));return nQ.create(o)}},lg.KURT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?ru.create(ea.NUM):(a=Math.ceil(a),nQ.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>t-e)}},lg.LARGE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=ax(e,t);if(i)return s;let a=aU(e);if(a instanceof ru)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ru)return o;let l=null!=r?r:nK.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nK.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sY(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?ru.create(ea.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aL(e,t,t,r,!1);if(i instanceof ru)return i;let{coefficients:s,X:a,XTXInverse:o}=i,l=[];if(n){let t=e.flat(),n=t.length,i=r?t.reduce((e,t)=>e+t,0)/n:0,u=o.length,c=n-u,h=s[0].length,d=Array(h-2).fill(ea.NA),m=s[0][h-1],g=[];for(let e=0;e<a.length;e++){let t=m;for(let r=h-2;r>=0;r--)t+=s[0][h-2-r]*a[e][r];g.push(t)}let f=0,p=0;for(let e=0;e<n;e++)f+=(t[e]-i)**2,p+=(t[e]-g[e])**2;let C=f-p,_=0===f?0:C/f,y=[];for(let e=u-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*o[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(ea.NA);let E=c>0?Math.sqrt(p/c):0,R=c>0?C/(h-1)/(p/c):ea.NUM;l=[s[0],[...y],[_,E,...d],[R,c,...d],[C,p,...d]]}else l=[s[0]];return n5.createByArray(l)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o}=aV(s,i,r,!1);if(Number.isNaN(a))return ru.create(ea.NA);let l=[];if(n){let e=i.length,t=0,n=0,u=e-1;if(r){let r=0,a=0;for(let t=0;t<e;t++)r+=i[t],a+=s[t];t=r/e,n=a/e,u=e-2}let c=0,h=0,d=0;for(let r=0;r<e;r++)c+=(i[r]-t)**2,h+=(i[r]-(a*s[r]+o))**2,d+=(s[r]-n)**2;let m=c-h,g=m===c?1:m/c,f=0,p=0,C=0;u>0&&(d>0&&(f=Math.sqrt(h/u/d),p=Math.sqrt(h/u*(1/e+n**2/d))),C=Math.sqrt(h/u));let _=u>0?m/1/(h/u):ea.NUM;r||(p=ea.NA),l=[[a,o],[f,p],[g,C],[_,u],[m,h]]}else l=[[a,o]];return n5.createByArray(l)}_getKnownXsValues(e,t){return!t||t.isNull()?aD(e.length,e[0].length):aU(t)}},lg.LINEST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=ax(e,t);if(i)return s;let a=aU(e);if(a instanceof ru)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ru)return o;let l=null!=r?r:nK.create(!0);l.isArray()&&(l=l.get(0,0));let u=null!=n?n:nK.create(!1);u.isArray()&&(u=u.get(0,0));let{isError:c,errorObject:h,variants:d}=sY(l,u);if(c)return h;let[m,g]=d;return this._getResult(a,o,+m.getValue(),+g.getValue())}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(r?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(r?t[0].length+1:t[0].length)>e.length?ru.create(ea.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=aL(e,t,t,r,!0);if(i instanceof ru)return i;let{coefficients:s,Y:a,X:o,XTXInverse:l}=i,u=[];if(n){let e=a.flat(),t=e.length,n=r?e.reduce((e,t)=>e+t,0)/t:0,i=l.length,c=t-i,h=s[0].length,d=Array(h-2).fill(ea.NA),m=s[0][h-1],g=[];for(let e=0;e<o.length;e++){let t=m;for(let r=h-2;r>=0;r--)t*=s[0][h-2-r]**o[e][r];g.push(Math.log(t))}let f=0,p=0;for(let i=0;i<t;i++)f+=(e[i]-n)**2,(r||Number.isFinite(g[i]))&&(p+=(e[i]-g[i])**2);Number.isFinite(p)||(p=0);let C=f-p,_=0===f?0:C/f,y=[];for(let e=i-1;e>=0;e--){let t=c>0?Math.sqrt(p/c*l[e][e]):0;y.push(t)}if(r){let e=y.shift();y.push(e)}else y.push(ea.NA);let E=c>0?Math.sqrt(p/c):0,R=c>0?C/(h-1)/(p/c):ea.NUM;u=[s[0],[...y],[_,E,...d],[R,c,...d],[C,p,...d]]}else u=[s[0]];return n5.createByArray(u)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),s=t.flat(),{slope:a,intercept:o,Y:l}=aV(s,i,r,!0);if(Number.isNaN(a))return ru.create(ea.NA);let u=[];if(n){let e=l.length,t=0,n=0,i=e-1;if(r){let r=0,a=0;for(let t=0;t<e;t++)r+=l[t],a+=s[t];t=r/e,n=a/e,i=e-2}let c=0,h=0,d=0;for(let r=0;r<e;r++)c+=(l[r]-t)**2,h+=(l[r]-Math.log(o*a**s[r]))**2,d+=(s[r]-n)**2;let m=c-h,g=0===c?0:m/c,f=0,p=0,C=0,_=0;i>0&&(d>0&&(f=Math.sqrt(h/i/d),p=Math.sqrt(h/i*(1/e+n**2/d))),C=Math.sqrt(h/i),_=m/1/(h/i)),r||(p=ea.NA),u=[[a,o],[f,p],[g,C],[_,i],[m,h]]}else u=[[a,o]];return n5.createByArray(u)}_getKnownXsValues(e,t){return!t||t.isNull()?aD(e.length,e[0].length):aU(t)}},lg.LOGEST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=+l.getValue(),m=+u.getValue(),g=+c.getValue(),f=+h.getValue();return d<=0||g<=0?ru.create(ea.NUM):(f?i=aI(d,m,g):i=d<=0?0:Math.exp(-Math.log(d)-.5*Math.log(2*Math.PI)-Math.log(g)-(Math.log(d)-m)**2/(2*g*g)),nQ.create(i))}},lg.LOGNORM_DIST],[aQ,lg.LOGNORM_INV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getRangeValues(e);if(r instanceof ru)return r;let n=s$(t);if(n.isError())return n;let{isError:i,errorObject:s,variants:a}=sY(n);if(i)return s;let[o]=a,l=+o.getValue();if(l<=0||l>=1)return ru.create(ea.NUM);if(r.length<2)return ru.create(ea.DIV_BY_ZERO);let u=r.length,c=r.reduce((e,t)=>e+t,0)/u,h=Math.sqrt(r.reduce((e,t)=>e+(t-c)**2,0)/(u-1));if(h<=0)return ru.create(ea.NUM);let d=Math.abs(aM((1-l)/2,u-1)*h/Math.sqrt(u));return nQ.create(d)}_getRangeValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;n.isNull()||n.isBoolean()||n.isString()||t.push(+n.getValue())}return t}},lg.MARGINOFERROR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.max()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?nQ.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nQ.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.NEGATIVE_INFINITY?nQ.create(0):t}_validator(e,t){let r=e.isLessThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MAXA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ru.create(ea.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ru.create(ea.VALUE);let{maxRowLength:r,maxColumnLength:n}=ic(t),i=ih(t,e,r,n);if(i)return i;let s=id(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?n5.create("0"):r.max()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(n)}},lg.MAXIFS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isArray()){let e=!1,r=ru.create(ea.VALUE);if(n.iterator(n=>{if(null!=n&&n.isError())return e=!0,r=n,!1;if(null!=n&&n.isNull()||null!=n&&n.isBoolean())return!0;let i=n.getValue();if(!(0,j.isRealNum)(i))return!0;t.push(+i)}),e)return r}else{if(n.isError())return n;if(n.isNull()||n.isBoolean())continue;if(n.isString()){let e=n.convertToNumberObjectValue();if(e.isError())return e}let e=n.getValue();if(!(0,j.isRealNum)(e))continue;t.push(+e)}}return 0===t.length?ru.create(ea.NUM):this._getResult(t.sort((e,t)=>e-t))}_getResult(e){let t,r=e.length;if(r%2==0){let n=r/2;t=(e[n-1]+e[n])/2}else t=e[Math.floor(r/2)];return nQ.create(t)}},lg.MEDIAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isArray()&&(n=n.min()),n.isError())return n;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?nQ.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=nQ.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let n=e[r];if(!n.isNull()){if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()&&n.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nQ.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,n)}}return t.getValue()===Number.POSITIVE_INFINITY?nQ.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),n=e;return r.getValue()&&(n=t),n}},lg.MINA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(e,...t){if(e.isError())return ru.create(ea.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return ru.create(ea.VALUE);let{maxRowLength:r,maxColumnLength:n}=ic(t),i=ih(t,e,r,n);if(i)return i;let s=id(t,r,n,!0);return this._aggregateResults(e,s)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?n5.create("0"):r.min()})),n={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return n5.create(n)}},lg.MINIFS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t={},r=0,n=1;for(let i=0;i<e.length;i++){let s=e[i];if(s.isError())return s;if(s.isString()){let e=s.convertToNumberObjectValue();if(e.isError())return e}let a=s.isArray()?s.getRowCount():1,o=s.isArray()?s.getColumnCount():1;for(let e=0;e<a;e++)for(let i=0;i<o;i++){let a=s.isArray()?s.get(e,i):s;if(a.isError())return a;if(a.isNull()||a.isBoolean()||a.isString())continue;let o=a.getValue();(0,j.isRealNum)(o)&&(t[+o]?(t[+o].count++,t[+o].count>n&&(n=t[+o].count)):t[+o]={count:1,order:r++})}}return 0===r||1===n?new ru(ea.NA):this._getResult(t,n)}_getResult(e,t){let r=Object.entries(e).filter(([e,{count:r}])=>r===t).sort((e,t)=>e[1].order-t[1].order).map(([e])=>+e);return 1===r.length?nQ.create(r[0]):n5.createByArray(r.map(e=>[e]))}},lg.MODE_MULT],[aZ,lg.MODE_SNGL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSignleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSignleObject(e,t,r,n){let i,{isError:s,errorObject:a,variants:o}=sY(e,t,r,n);if(s)return a;let[l,u,c,h]=o,d=Math.floor(+l.getValue()),m=Math.floor(+u.getValue()),g=+c.getValue(),f=+h.getValue();return d<0||m<1||g<=0||g>=1?ru.create(ea.NUM):(i=f?function(e,t,r){if(e<0)return 0;let n=0;for(let i=0;i<=e;i++)n+=aN(i,t,r);return n}(d,m,g):aN(d,m,g),nQ.create(i))}},lg.NEGBINOM_DIST],[aJ,lg.NORM_DIST],[a0,lg.NORM_INV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let r,{isError:n,errorObject:i,variants:s}=sY(e,t);if(n)return i;let[a,o]=s,l=+a.getValue();return r=+o.getValue()?aS(l,0,1):aA(l,0,1),nQ.create(r)}},lg.NORM_S_DIST],[a1,lg.NORM_S_INV],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ru.create(ea.VALUE):ru.create(ea.DIV_BY_ZERO);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return ru.create(ea.DIV_BY_ZERO);let c=o/Math.sqrt(l*u);return nQ.create(c)}},lg.PEARSON],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=+s.getValue(),o=e.length;if(a<1/(o+1)||a>1-1/(o+1))return ru.create(ea.NUM);let l=a*(o+1)-1,u=Math.floor(l),c=l-u;if(0===c)return nQ.create(e[u]);let h=e[u]+c*(e[u+1]-e[u]);return nQ.create(h)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}},lg.PERCENTILE_EXC],[a2,lg.PERCENTILE_INC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=this._getValues(e),i=null!=r?r:nQ.create(3);i.isNull()&&(i=nQ.create(3));let s=Math.max(t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,t,ru.create(ea.NA)),l=ii(s,a,i,ru.create(ea.NA)),u=o.mapValue((e,t,r)=>{let i=l.get(t,r);return e.isError()?e:i.isError()?i:this._handleSingleObject(n,e,i)});return 1===s&&1===a?u.get(0,0):u}_handleSingleObject(e,t,r){if(e instanceof ru)return e;let{isError:n,errorObject:i,variants:s}=sY(t,r);if(n)return i;let[a,o]=s,l=+a.getValue(),u=Math.floor(+o.getValue()),c=e.length;if(0===c||l<e[0]||l>e[c-1])return ru.create(ea.NA);if(1===c)return l===e[0]?nQ.create(1):ru.create(ea.NA);let h=0,d=!1,m=0;for(;!d&&m<c;)l===e[m]?(h=(m+1)/(c+1),d=!0):l>e[m]&&m+1<c&&l<e[m+1]&&(h=(m+1+(l-e[m])/(e[m+1]-e[m]))/(c+1),d=!0),m++;return d?u<1?ru.create(ea.NUM):(h=nB(h,u),nQ.create(h)):ru.create(ea.NA)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return n.sort((e,t)=>e-t)}},lg.PERCENTRANK_EXC],[a5,lg.PERCENTRANK_INC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sY(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0||c<h)return ru.create(ea.NUM);let d=1;for(let e=c-h+1;e<=c;e++)d*=e;return Number.isFinite(d)?nQ.create(d):ru.create(ea.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;if(n.isError())return n;let{isError:i,errorObject:a,variants:o}=sY(e,n);if(i)return a;let[l,u]=o,c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(c<0||c>=0x7fffffff||h<0)return ru.create(ea.NUM);if(0===c)return 0===h?nQ.create(1):nQ.create(0);let d=c**h;return Number.isFinite(d)?nQ.create(d):ru.create(ea.NUM)});return 1===r&&1===n?a.get(0,0):a}},lg.PERMUTATIONA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.exp(-.5*s*s)/Math.sqrt(2*Math.PI);return nQ.create(a)}},lg.PHI],[a3,lg.POISSON_DIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s,xRangeValues:a,probRangeValues:o}=this._handleXRangeAndProbRange(e,t),l=null!=n?n:r;null!=n&&n.isNull()&&(l=r);let u=Math.max(r.isArray()?r.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(r.isArray()?r.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=ii(u,c,r,ru.create(ea.NA)),d=ii(u,c,l,ru.create(ea.NA)),m=h.mapValue((r,n,l)=>{let u=d.get(n,l);return e.isError()?e:t.isError()?t:r.isError()?r:u.isError()?u:i?s:this._handleSignleObject(a,o,r,u)});return 1===u&&1===c?m.get(0,0):m}_handleSignleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sY(r,n);if(i)return s;let[o,l]=a,u=+o.getValue(),c=+l.getValue();if(1!==t.reduce((e,t)=>e+t,0))return ru.create(ea.NUM);let h=0;for(let r=0;r<e.length;r++)e[r]>=u&&e[r]<=c&&(h+=t[r]);return nQ.create(h)}_handleXRangeAndProbRange(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return{isError:!0,errorObject:a,xRangeValues:[],probRangeValues:[]};let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return{isError:!0,errorObject:o,xRangeValues:[],probRangeValues:[]};if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return{isError:!0,errorObject:ru.create(ea.VALUE),xRangeValues:[],probRangeValues:[]};if(r*n!=i*s)return{isError:!0,errorObject:ru.create(ea.NA),xRangeValues:[],probRangeValues:[]};let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?{isError:!0,errorObject:u,xRangeValues:[],probRangeValues:[]}:d?{isError:!0,errorObject:ru.create(ea.DIV_BY_ZERO),xRangeValues:[],probRangeValues:[]}:{isError:!1,errorObject:null,xRangeValues:c,probRangeValues:h}}},lg.PROB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<=0||a>=4)return ru.create(ea.NUM);let o=a/4,l=e.length;if(o<1/(l+1)||o>1-1/(l+1))return ru.create(ea.NUM);let u=o*(l+1)-1,c=Math.floor(u),h=u-c;if(0===h)return nQ.create(e[c]);let d=e[c]+h*(e[c+1]-e[c]);return nQ.create(d)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}},lg.QUARTILE_EXC],[a4,lg.QUARTILE_INC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nQ.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,n,ru.create(ea.NA)),h=ii(l,u,o,ru.create(ea.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ru.create(ea.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();return Number.isNaN(l)||Number.isNaN(u)?ru.create(ea.VALUE):this._getResult(l,u,a)});return 1===l&&1===u?d.get(0,0):d}_getResult(e,t,r){let n=r.sort((e,r)=>t?e-r:r-e),i=n.indexOf(e),s=[];for(;i>=0;){let t=i+1;s.push(t),i=n.indexOf(e,t)}if(0===s.length)return ru.create(ea.NA);let a=s.reduce((e,t)=>e+t,0)/s.length;return nQ.create(a)}_checkRefReferenceObject(e){let t=!1,r=ru.create(ea.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_AVG],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3),J(this,"needsReferenceObject",!0)}calculate(e,t,r){let n=e;n.isReferenceObject()&&(n=n.toArrayValueObject());let{refHasError:i,refErrorObject:s,refNumbers:a}=this._checkRefReferenceObject(t),o=null!=r?r:nQ.create(0);o.isReferenceObject()&&(o=o.toArrayValueObject());let l=Math.max(n.isArray()?n.getRowCount():1,o.isArray()?o.getRowCount():1),u=Math.max(n.isArray()?n.getColumnCount():1,o.isArray()?o.getColumnCount():1),c=ii(l,u,n,ru.create(ea.NA)),h=ii(l,u,o,ru.create(ea.NA)),d=c.map((t,r,n)=>{let o=h.get(r,n);if(!e.isReferenceObject()&&e.isNull())return ru.create(ea.NA);if(i)return s;if(o.isError())return o;let l=+t.getValue(),u=+o.getValue();if(Number.isNaN(l)||Number.isNaN(u))return ru.create(ea.VALUE);let c=a.sort((e,t)=>u?e-t:t-e).indexOf(l);return -1===c?ru.create(ea.NA):nQ.create(c+1)});return 1===l&&1===u?d.get(0,0):d}_checkRefReferenceObject(e){let t=!1,r=ru.create(ea.NA),n=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let i=+e.getValue();if(Number.isNaN(i))return!0;n.push(i)}),{refHasError:t,refErrorObject:r,refNumbers:n}):{refHasError:!0,refErrorObject:r,refNumbers:n}}},lg.RANK_EQ],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ru.create(ea.VALUE);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return ru.create(ea.DIV_BY_ZERO);let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===l||0===u)return ru.create(ea.DIV_BY_ZERO);let c=(o/Math.sqrt(l*u))**2;return nQ.create(c)}},lg.RSQ],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,j.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?ru.create(ea.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/(r-1));if(0===s)return ru.create(ea.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=r/((r-1)*(r-2))*a;return nQ.create(o)}},lg.SKEW],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=[],r=0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isError())return i;if(i.isString()){let e=i.convertToNumberObjectValue();if(e.isError())return e}let s=i.isArray()?i.getRowCount():1,a=i.isArray()?i.getColumnCount():1;for(let e=0;e<s;e++)for(let n=0;n<a;n++){let s=i.isArray()?i.get(e,n):i;if(s.isError())return s;if(s.isNull()||s.isBoolean())continue;let a=s.getValue();(0,j.isRealNum)(a)&&(t.push(+a),r+=+a)}}return t.length<=2?ru.create(ea.DIV_BY_ZERO):this._getResult(t,r)}_getResult(e,t){let r=e.length,n=t/r,i=0;for(let t=0;t<r;t++)i+=(e[t]-n)**2;let s=Math.sqrt(i/r);if(0===s)return ru.create(ea.DIV_BY_ZERO);let a=0;for(let t=0;t<r;t++)a+=((e[t]-n)/s)**3;let o=a/r;return nQ.create(o)}},lg.SKEW_P],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if(r*n==1||i*s==1)return a.isNull()||o.isNull()?ru.create(ea.VALUE):ru.create(ea.DIV_BY_ZERO);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(t[n]-a)**2;if(0===l)return ru.create(ea.DIV_BY_ZERO);let u=o/l;return nQ.create(u)}},lg.SLOPE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=+s.getValue();return a<1||a>e.length?ru.create(ea.NUM):(a=Math.floor(a),nQ.create(e[a-1]))}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean()||r.isString())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}},lg.SMALL],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=+o.getValue(),h=+l.getValue();return h<=0?ru.create(ea.NUM):nQ.create((u-c)/h)}},lg.STANDARDIZE],[a6,lg.STDEV_P],[a9,lg.STDEV_S],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}},lg.STDEVA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std()}},lg.STDEVPA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,a=e;if(e.isArray()&&1===r&&1===n&&(a=e.get(0,0)),a.isError())return a;let o=t;if(t.isArray()&&1===i&&1===s&&(o=t.get(0,0)),o.isError())return o;if((r*n==1||i*s==1)&&(a.isNull()||o.isNull()))return ru.create(ea.VALUE);if(r*n!=i*s)return ru.create(ea.NA);let{isError:l,errorObject:u,array1Values:c,array2Values:h,noCalculate:d}=aO(e,t,r*n,n,s);return l?u:d?ru.create(ea.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length;if(r<=2)return ru.create(ea.DIV_BY_ZERO);let n=0,i=0;for(let s=0;s<r;s++)n+=e[s],i+=t[s];let s=n/r,a=i/r,o=0,l=0,u=0;for(let n=0;n<r;n++)o+=(e[n]-s)*(t[n]-a),l+=(e[n]-s)**2,u+=(t[n]-a)**2;if(0===u)return ru.create(ea.DIV_BY_ZERO);let c=Math.sqrt((l-o**2/u)/(r-2));return Number.isNaN(c)||!Number.isFinite(c)?ru.create(ea.NUM):nQ.create(c)}},lg.STEYX],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSignleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSignleObject(e,t,r){let n,{isError:i,errorObject:s,variants:a}=sY(e,t,r);if(i)return s;let[o,l,u]=a,c=+o.getValue(),h=Math.floor(+l.getValue()),d=+u.getValue();return h<1?ru.create(ea.NUM):(d?n=aw(c,h):n=1/(Math.sqrt(h)*au(.5,h/2))*(1+c**2/h)**(-(h+1)/2),Number.isNaN(n)||!Number.isFinite(n)?ru.create(ea.NUM):nQ.create(n))}},lg.T_DIST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<0||l<1||l>1e10)return ru.create(ea.NUM);let u=2*aw(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},lg.T_DIST_2T],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(l<1||l>1e10)return ru.create(ea.NUM);let u=aw(-o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},lg.T_DIST_RT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSignleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSignleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.floor(+a.getValue());if(o<=0||o>1||l<1||l>1e10)return ru.create(ea.NUM);let u=aM(o,l);return Number.isNaN(u)||!Number.isFinite(u)?ru.create(ea.NUM):nQ.create(u)}},lg.T_INV],[a8,lg.T_INV_2T],[a7,lg.T_TEST],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",4)}calculate(e,t,r,n){let{isError:i,errorObject:s}=ax(e,t,r);if(i)return s;let a=aU(e);if(a instanceof ru)return a;let o=this._getKnownXsValues(a,t);if(o instanceof ru)return o;let l=this._getNewXsValues(o,r);if(l instanceof ru)return l;let u=null!=n?n:nK.create(!0);if(u.isArray()&&(u=u.get(0,0)),u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let c=+u.getValue();return this._getResult(a,o,l,c)}_getResult(e,t,r,n){return 1===e.length&&t.length>1||1===e[0].length&&t[0].length>1?1===e.length&&t.length>1&&(n?t.length+1:t.length)>e[0].length||1===e[0].length&&t[0].length>1&&(n?t[0].length+1:t[0].length)>e.length?ru.create(ea.NA):this._getResultByMultipleVariables(e,t,r,n):this._getResultBySimpleVariables(e,t,r,n)}_getResultByMultipleVariables(e,t,r,n){let i=1===e.length&&e[0].length>1,s=aL(e,t,r,n,!1);if(s instanceof ru)return s;let{coefficients:a,newX:o}=s,l=a[0].length,u=a[0][l-1],c=[];for(let e=0;e<o.length;e++){c[e]=[];let t=u;for(let r=l-2;r>=0;r--)t+=a[0][l-2-r]*o[e][r];c[e].push(t)}return i&&(c=s6(c)),n5.createByArray(c)}_getResultBySimpleVariables(e,t,r,n){let i=e.flat(),{slope:s,intercept:a}=aV(t.flat(),i,n,!1);if(Number.isNaN(s))return ru.create(ea.NA);let o=r.map(e=>e.map(e=>s*e+a));return n5.createByArray(o)}_getKnownXsValues(e,t){return!t||t.isNull()?aD(e.length,e[0].length):aU(t)}_getNewXsValues(e,t){return!t||t.isNull()?e:aU(t)}},lg.TREND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=this._getValues(e);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(r,e));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}return this._handleSingleObject(r,t)}_handleSingleObject(e,t){if(e instanceof ru)return e;let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=+s.getValue();if(a<0||a>=1)return ru.create(ea.NUM);let o=2*nB(e.length*a/2,0),l=e.slice(o/2,e.length-o/2),u=l.reduce((e,t)=>e+t,0)/l.length;return nQ.create(u)}_getValues(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t;i++)for(let t=0;t<r;t++){let r=e.isArray()?e.get(i,t):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())continue;let s=r.getValue();(0,j.isRealNum)(s)&&n.push(+s)}return 0===n.length?ru.create(ea.NUM):n.sort((e,t)=>e-t)}},lg.TRIMMEAN],[oe,lg.VAR_P],[ot,lg.VAR_S],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}},lg.VARA],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var()}},lg.VARPA],[or,lg.WEIBULL_DIST],[on,lg.Z_TEST]],lC=Object.values(j.DataStreamTreeTokenType).filter(e=>[j.DataStreamTreeTokenType.TABLE_START,j.DataStreamTreeTokenType.TABLE_ROW_START,j.DataStreamTreeTokenType.TABLE_CELL_START,j.DataStreamTreeTokenType.TABLE_CELL_END,j.DataStreamTreeTokenType.TABLE_ROW_END,j.DataStreamTreeTokenType.TABLE_END,j.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(e)),l_=(e,t)=>j.numfmt.format(e,t,{throws:!1}),ly=e=>{let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),e.isNumber()&&(t=""!==e.getPattern()?l_(e.getPattern(),+e.getValue()):`${nY(+e.getValue())}`),t};function lE(e){let t=0;for(let r=0;r<e.length;r++)t+=lR(e,r);return t}function lR(e,t,r="ltr"){return function(e,t,r="ltr"){let n=e.charCodeAt(t);if("ltr"===r&&lb(n)&&t+1<e.length){let r=e.charCodeAt(t+1);if(lI(r))return lN(n,r)}if("rtl"===r&&lI(n)&&t-1>=0){let r=e.charCodeAt(t-1);if(lb(r))return lN(r,n)}return n}(e,t,r)>255?2:1}function lb(e){return e>=55296&&e<=56319}function lI(e){return e>=56320&&e<=57343}function lN(e,t){return((1023&e)<<10)+(1023&t)+65536}let lS=["","","","","","","","","",""],lA=["","","","","","","","","",""],lv=["","","",""],lT=["","","",""],lw=["","","",""],lM=()=>[{type:4,from:48,to:57}],lO=()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],lx=()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],lU=()=>({type:3,set:lO(),not:!1}),lD=()=>({type:3,set:lO(),not:!0}),lV=()=>({type:3,set:lM(),not:!1}),lL=()=>({type:3,set:lM(),not:!0}),lP=()=>({type:3,set:lx(),not:!1}),lF=()=>({type:3,set:lx(),not:!0}),lk=()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0});function lj(e,t){var r;if(r=e,/\(\?<=.*?\)/g.test(r)&&!/\[.*?(\?<=.*?)\]/g.test(r)||/\(\?<!.*?\)/g.test(r)&&!/\[.*?(\?<!.*?)\]/g.test(r))return{isError:!0,regExp:null};try{let r=new RegExp(e,t?"ug":"u");return!function(e,t){let r,n;"[object RegExp]"===Object.prototype.toString.call(e)?r=e.source:e&&"string"!=typeof e&&(r=`${e}`);try{n=function(e){let t={type:0,stack:[]},r=t,n=t.stack,i=[],s=[],a=0;let o=t=>{throw SyntaxError(`Invalid regular expression: /${e}/: Nothing to repeat at column ${t-1}`)},l=e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(e,t,r,n,i,s,a)=>{let o;if(r)return e;let l=String.fromCharCode(t?8:n?Number.parseInt(n,16):i?Number.parseInt(i,16):s?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(s):({0:0,t:9,n:10,v:11,f:12,r:13})[a]);return/[[\]{}^$.|?*+()]/.test(l)?`\\${l}`:l}),u=0,c;for(;u<l.length;)switch(c=l[u++]){case"\\":if(u===l.length)throw SyntaxError(`Invalid regular expression: /${e}/: \\ at end of pattern`);switch(c=l[u++]){case"b":n.push({type:2,value:"b"});break;case"B":n.push({type:2,value:"B"});break;case"w":n.push(lU());break;case"W":n.push(lD());break;case"d":n.push(lV());break;case"D":n.push(lL());break;case"s":n.push(lP());break;case"S":n.push(lF());break;default:if(/\d/.test(c)){for(;/\d/.test(l[u])&&u<l.length;)c+=l[u++];let e=Number.parseInt(c,10);n.push({type:6,value:e}),s.push({reference:{type:6,value:e},stack:n,index:n.length-1})}else n.push({type:7,value:c.charCodeAt(0)})}break;case"^":n.push({type:2,value:"^"});break;case"$":n.push({type:2,value:"$"});break;case"[":{let t="^"===l[u];t&&u++;let r=function(e,t){let r,n=[],i=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;null!==(r=i.exec(e));){let e=null,[,t,s,a,o,l,u,c,h,d,m]=r;if(t||s||a||o||l||u?e=(()=>{let e={type:3,set:[],not:!1};return t?e=lU():s?e=lV():a?e=lP():o?e=lD():l?e=lL():u&&(e=lF()),e})():c&&m?e={type:4,from:(h||d).charCodeAt(0),to:m.charCodeAt(m.length-1)}:r[16]&&(e={type:7,value:r[16].charCodeAt(0)}),!e)return[n,i.lastIndex];n.push(e)}throw SyntaxError(`Invalid regular expression: /${t}/: Unterminated character class`)}(l.slice(u),e);u+=r[1],n.push({type:3,set:r[0],not:t});break}case".":n.push(lk());break;case"(":{let t={type:1,stack:[],remember:!0};if("?"===l[u]){let r=l[u+1];if(u+=2,"="===r)t.followedBy=!0;else if("!"===r)t.notFollowedBy=!0;else if(":"!==r)throw SyntaxError(`Invalid regular expression: /${e}/: Invalid group, character '${r}' after '?' at column ${u-1}`);t.remember=!1}else a+=1;n.push(t),i.push(r),r=t,n=t.stack;break}case")":if(0===i.length)throw SyntaxError(`Invalid regular expression: /${e}/: Unmatched ) at column ${u-1}`);n=(r=i.pop()).options?r.options[r.options.length-1]:r.stack;break;case"|":{r.options||(r.options=[r.stack],delete r.stack);let e=[];r.options.push(e),n=e;break}case"{":{let e=/^(\d+)(,(\d+)?)?\}/.exec(l.slice(u));if(e){0===n.length&&o(u);let t=Number.parseInt(e[1],10),r=e[2]?e[3]?Number.parseInt(e[3],10):1/0:t;u+=e[0].length,n.push({type:5,min:t,max:r,value:n.pop()})}else n.push({type:7,value:123});break}case"?":0===n.length&&o(u),n.push({type:5,min:0,max:1,value:n.pop()});break;case"+":0===n.length&&o(u),n.push({type:5,min:1,max:1/0,value:n.pop()});break;case"*":0===n.length&&o(u),n.push({type:5,min:0,max:1/0,value:n.pop()});break;default:n.push({type:7,value:c.charCodeAt(0)})}if(i.length>0)throw SyntaxError(`Invalid regular expression: /${e}/: Unterminated group`);return function(e,t){for(let r of e.reverse()){let e=r.reference.value;if(t<e){r.reference.type=7;let t=e.toString();if(r.reference.value=Number.parseInt(t,8),!/^[0-7]+$/.test(t)){let e=0;for(;"8"!==t[e]&&"9"!==t[e]&&e<t.length;)e+=1;if(0===e?(r.reference.value=t.charCodeAt(0),e+=1):r.reference.value=Number.parseInt(t.slice(0,e),8),t.length>e){let n=r.stack.splice(r.index+1);for(let n of t.slice(e))r.stack.push({type:7,value:n.charCodeAt(0)});r.stack.push(...n)}}}}}(s,a),t}(r)}catch{return!1}let i=0,s=(e,t)=>{let r=t;if(5===e.type&&(r++,i++,r>1||i>25))return!1;if(e.options){for(let t of e.options)if(!s({stack:t},r))return!1}let n=e.stack||e.value&&e.value.stack;if(!n)return!0;for(let e of n)if(!s(e,r))return!1;return!0};return s(n,0)}(r)?{isError:!0,regExp:null}:{isError:!1,regExp:r}}catch{return{isError:!0,regExp:null}}}let lB=Object.values(j.DataStreamTreeTokenType).filter(e=>[j.DataStreamTreeTokenType.TABLE_START,j.DataStreamTreeTokenType.TABLE_ROW_START,j.DataStreamTreeTokenType.TABLE_CELL_START,j.DataStreamTreeTokenType.TABLE_CELL_END,j.DataStreamTreeTokenType.TABLE_ROW_END,j.DataStreamTreeTokenType.TABLE_END,j.DataStreamTreeTokenType.CUSTOM_BLOCK].includes(e)),l$=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString(),r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);12288===n?n=32:n>=65281&&n<=65374&&(n-=65248),r+=String.fromCharCode(n)}return nJ.create(r)}},i5.ASC],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(0);if(null!=t&&t.isNull()&&(r=nQ.create(0)),r.isArray()){let t=r.mapValue(t=>this._handleSingleObject(e,t));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){let r=this._checkArray(e);if(r.isError())return r;let{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=+a.getValue(),l=e.isArray()?e.getRowCount():1,u=e.isArray()?e.getColumnCount():1,c="";for(let t=0;t<l;t++)for(let r=0;r<u;r++){let n=e.isArray()?e.get(t,r):e,i=`${n.getValue()}`;n.isNull()&&(i=""),n.isBoolean()&&(i=i.toLocaleUpperCase()),n.isString()&&o?c+=`"${i}"`:c+=i,t===l-1&&r===u-1||(o?r===u-1?c+=";":c+=",":c+=", ")}return o&&(c=`{${c}}`),c.length>32767?ru.create(ea.CALC):nJ.create(c)}_checkArray(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}},i5.ARRAYTOTEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=+i.getValue(),a=Math.abs(Number.parseInt(s.toString(),10)),o=Number.parseFloat((Math.abs(s)-a).toFixed(2)),l="";return l=0===a?0!==o?`${s<0?"":""}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`:"":0===o?`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}\u{E16}\u{E49}\u{E27}\u{E19}`:`${s<0?"":""}${this._convertNumberToThaiText(a)}\u{E1A}\u{E32}\u{E17}${this._convertNumberToThaiText(100*o)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`,nJ.create(l)}_convertNumberToThaiText(e){let t=["","","","","","",""],r=["","","","","","","","","",""],n=e.toString(),i=n.length,s="";for(let e=i;e>0;e--){let a=Number.parseInt(n.charAt(i-e),10),o=r[a],l=e>1?(e-1)%6:6;if(1===l&&2===a&&(o=""),1===a)switch(l){case 0:case 6:s+=e<i?"":o;break;case 1:break;default:s+=o}else if(0===a){0===l&&(s+=t[l]);continue}else s+=o;s+=t[l]}return s}},i5.BAHTTEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<=0)return ru.create(ea.VALUE);let a=String.fromCharCode(s);return lC.some(e=>e===a)&&(a="\x01"),nJ.create(a)}},i5.CHAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return nJ.create("");let t=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return nJ.create(t)}},i5.CLEAN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),""===t)return ru.create(ea.VALUE);let r=t.charCodeAt(0);return nQ.create(r)}},i5.CODE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t="",r=null;for(let n of e)if(n.isArray()){if(n.iterator(e=>!!(null==e||e.isNull())||(e.isError()?(r=e,!1):void(e.isBoolean()?t+=`${e.getValue()}`.toLocaleUpperCase():(e.isString()||e.isNumber())&&(t+=e.getValue())))),r)return r}else n.isError()||n.isNull()||(t+=n.getValue());return nJ.create(t)}},i5.CONCAT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(e=>{e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1))});let n=null;for(let i of e)n=ii(t,r,i,ru.create(ea.NA)).mapValue((e,t,r)=>{let i=n&&n.get(t,r);if(null!=i&&i.isError())return i;if(e.isError())return e;let s=null==i?void 0:i.getValue(),a=null==e?void 0:e.getValue();null!=i&&i.isBoolean()&&(s=`${s}`.toLocaleUpperCase()),null!=e&&e.isBoolean()&&(a=`${a}`.toLocaleUpperCase());let o=null!=i&&i.isNull()?"":null!=s?s:"",l=null!=e&&e.isNull()?"":null!=a?a:"";return nJ.create(`${o}${l}`)});return n||ru.create(ea.VALUE)}},i5.CONCATENATE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nJ.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let e=0;e<t.length;e++){let n=t.charCodeAt(e);n>=33&&n<=126?r+=String.fromCharCode(n+65248):32===n?r+="":r+=t.charAt(e)}return nJ.create(r)}},i5.DBCS],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2),J(this,"needsLocale",!0)}calculate(e,t){let r=null!=t?t:nQ.create(2);r.isNull()&&(r=nQ.create(2));let n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(e,t);if(r)return n;let[s,a]=i,o=+s.getValue(),l=Math.trunc(+a.getValue());if(l>127)return ru.create(ea.VALUE);l<0&&(o=`${o}`.length<Math.abs(l)?0:o<0?-nj(Math.abs(o),l):nj(o,l),l=0);let u=function(e,t,r=2){return j.numfmt.format(rn(e,r),t)}(this.getLocale(),o,l);return nJ.create(u)}},i5.DOLLAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,nX.create()),s=ii(r,n,t,nX.create()),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){let r=e.isNull()&&t.isNull();return nK.create(r)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let n=`${t.getValue()}`;t.isBoolean()&&(n=n.toLocaleUpperCase());let i=r===n;return nK.create(i)}},i5.EXACT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sY(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ru.create(ea.VALUE);if(e.isNull()||0===n.length)return nQ.create(u);let c=i.indexOf(n,u-1);return -1===c?ru.create(ea.VALUE):nQ.create(c+1)}},i5.FIND],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e),i=ly(t),{isError:s,errorObject:a,variants:o}=sY(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ru.create(ea.VALUE);if(e.isNull()||0===n.length)return nQ.create(u);let c=i.indexOf(n,u-1);if(-1===c)return ru.create(ea.VALUE);let h=lE(i.substring(0,c))+1;return nQ.create(h)}},i5.FINDB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nQ.create(2);n.isNull()&&(n=nQ.create(2));let i=null!=r?r:nK.create(!1);i.isNull()&&(i=nK.create(!1));let s=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1),o=ii(s,a,e,ru.create(ea.NA)),l=ii(s,a,n,ru.create(ea.NA)),u=ii(s,a,i,ru.create(ea.NA)),c=o.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===s&&1===a?c.get(0,0):c}_handleSingleObject(e,t,r){let{isError:n,errorObject:i,variants:s}=sY(e,t,r);if(n)return i;let[a,o,l]=s,u=+a.getValue(),c=Math.trunc(+o.getValue()),h=+l.getValue();if(c>127)return ru.create(ea.VALUE);c<0&&(u=`${u}`.length<Math.abs(c)?0:u<0?-nj(Math.abs(u),c):nj(u,c),c=0);let d=h?"###0":"#,##0";c>0&&(d+=`.${"0".repeat(c)}`);let m=l_(d,u);return nJ.create(m)}},i5.FIXED],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ru.create(ea.VALUE);if(e.isNull()||0===o)return nJ.create("");if(o>=r.length)return nJ.create(r);let l=r.substring(0,o);return nJ.create(l)}},i5.LEFT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,nX.create()),a=ii(n,i,r,nX.create()),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ru.create(ea.VALUE);if(e.isNull()||0===o)return nJ.create("");let l=0,u=0,c="";for(;u<o&&l<r.length;)u+=lR(r,l),c+=r.charAt(l),l++;return nJ.create(c)}},i5.LEFTB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=ly(e);return nQ.create(t.length)}},i5.LEN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleText(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;let t=lE(ly(e));return nQ.create(t)}},i5.LENB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nJ.create("");let t=`${e.getValue()}`.toLocaleLowerCase();return nJ.create(t)}},i5.LOWER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sY(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ru.create(ea.VALUE);if(e.isNull()||u>n.length||0===c)return nJ.create("");let h=n.substring(u-1,u-1+c);return nJ.create(h)}},i5.MID],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,t,ru.create(ea.NA)),o=ii(n,i,r,ru.create(ea.NA)),l=s.mapValue((e,t,r)=>{let n=a.get(t,r),i=o.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===n&&1===i?l.get(0,0):l}_handleSingleObject(e,t,r){let n=ly(e),{isError:i,errorObject:s,variants:a}=sY(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ru.create(ea.VALUE);if(e.isNull()||u>n.length||0===c)return nJ.create("");n=n.substring(u-1);let h=0,d=0,m="";for(;d<c&&h<n.length;)d+=lR(n,h),m+=n.charAt(h),h++;return nJ.create(m)}},i5.MIDB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.mapValue((e,t,r)=>{let n=s.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===r&&1===n?a.get(0,0):a}_handleSingleObject(e,t){let r=e.convertToNumberObjectValue();if(r.isError())return r;let n=t.convertToNumberObjectValue();if(n.isError())return n;let i=r.getValue(),s=Math.trunc(n.getValue());if(i<0||![1,2,3].includes(s))return ru.create(ea.NUM);let a=(i=Math.round(i)).toString(),o=a.length,l="",u=!1;for(let e=0;e<o;e++){let t=Number(a[e]);if(1===o&&0===t){l+=2===s?lA[0]:lS[0];break}if(3===s){l+=lS[t];continue}let r=o-e-1,n=r%4,i=Math.trunc(r/4);if(o>=17&&i>2){if(l+=1===s?lS[t]:lA[t],i>3)continue}else 0===t?u=0!==n:(u&&(l+=1===s?lS[0]:lA[0],u=!1),l+=1===s?lS[t]+lv[n]:lA[t]+lT[n]);0===n&&i>0&&"0000"!==a.slice(Math.max(0,e-3),e+1)&&(l+=lw[i])}return nJ.create(l)}},i5.NUMBERSTRING],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=t?t:nJ.create("."),i=Math.max(e.isArray()?e.getRowCount():1,n.isArray()?n.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,n.isArray()?n.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,n,ru.create(ea.NA)),l=r?ii(i,s,r,ru.create(ea.NA)):void 0,u=a.mapValue((e,t,n)=>{let i=o.get(t,n),s=r?l.get(t,n):void 0;return e.isError()?e:i.isError()?i:null!=s&&s.isError()?s:i.isNull()||null!=s&&s.isNull()?ru.create(ea.VALUE):e.isNull()?nQ.create(0):this._handleSingleObject(e,i,s)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n,i=`${e.getValue()}`;i=i.replace(/\s+/g,"");let s=`${t.getValue()}`;if(t.isBoolean()&&(s=s.toLocaleUpperCase()),s=s.charAt(0),r&&(n=`${r.getValue()}`,r.isBoolean()&&(n=n.toLocaleUpperCase()),s===(n=n.charAt(0))))return ru.create(ea.VALUE);if(""===i.trim())return nQ.create(0);if(!i.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return ru.create(ea.VALUE);let a=i.split(s);if(a.length>2)return ru.create(ea.VALUE);let o=a[0].replace(/,/g,"");r&&(o=o.split(n).join(""));let l=0;if(1===a.length){","===s&&(o=o.replace(/\./g,""));let e=0;for(;o.endsWith("%");)o=o.slice(0,-1),e++;l=e>0?o/100**e:+o}else{if(!(0,j.isRealNum)(o))return ru.create(ea.VALUE);let e=a[1],t=0;for(;e.endsWith("%");)e=e.slice(0,-1),t++;let r=`${o}.${e}`;if(!(0,j.isRealNum)(r))return ru.create(ea.VALUE);l=t>0?r/100**t:+r}return Number.isNaN(l)?ru.create(ea.VALUE):nQ.create(l)}},i5.NUMBERVALUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sH(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lj(l=`${l}`,!1);if(u)return ru.create(ea.REF);let h=o.match(c);if(null===h)return ru.create(ea.NA);if(h.length>1){let e=h.slice(1).map(e=>nJ.create(e));return e.length>1?n5.create({calculateValueList:[e],rowCount:1,columnCount:e.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):e[0]}return nJ.create(h[0])}},i5.REGEXEXTRACT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:n,variants:i}=sH(e,t);if(r)return n;let[s,a]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let l=a.getValue();a.isNull()&&(l=""),a.isBoolean()&&(l=l?"TRUE":"FALSE");let{isError:u,regExp:c}=lj(l=`${l}`,!1);return u?ru.create(ea.REF):null===o.match(c)?nK.create(!1):nK.create(!0)}},i5.REGEXMATCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",3)}calculate(e,t,r){let{isError:n,errorObject:i,variants:s}=sH(e,t,r);if(n)return i;let[a,o,l]=s,u=a.getValue();a.isNull()&&(u=""),a.isBoolean()&&(u=u?"TRUE":"FALSE"),u=`${u}`;let c=o.getValue();o.isNull()&&(c=""),o.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let h=l.getValue();l.isNull()&&(h=""),l.isBoolean()&&(h=h?"TRUE":"FALSE"),h=`${h}`;let{isError:d,regExp:m}=lj(c,!0);if(d)return ru.create(ea.REF);let g=u.replace(m,h);return nJ.create(g)}},i5.REGEXREPLACE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,e=>e.toLocaleUpperCase());return nJ.create(t)}},i5.PROPER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sY(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ru.create(ea.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1)+d+h.substring(u-1+c);return nJ.create(m)}},i5.REPLACE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",4),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=ii(i,s,n,ru.create(ea.NA)),c=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r),s=u.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,n,i,s)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let{isError:i,errorObject:s,variants:a}=sY(t,r);if(i)return s;let[o,l]=a,u=Math.floor(+o.getValue()),c=Math.floor(+l.getValue());if(u<=0||c<0)return ru.create(ea.VALUE);let h=ly(e),d=ly(n),m=h.substring(0,u-1);h=h.substring(u-1);let g=0,f=0;for(;f<c&&g<h.length;)f+=lR(h,g),g++;return m+=d+h.substring(g),nJ.create(m)}},i5.REPLACEB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e,ru.create(ea.NA)),s=ii(r,n,t,ru.create(ea.NA)),a=i.map((e,t,r)=>{let n=s.get(t,r);if(e.isError())return e;let i=e.getValue();if(e.isNull()&&(i=""),e.isBoolean()&&(i=i?"TRUE":"FALSE"),i+="",n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let a=Math.floor(+n.getValue());if(a<0||a>32767/i.length)return ru.create(ea.VALUE);let o=i.repeat(a);return nJ.create(o)});return 1===r&&1===n?a.get(0,0):a}},i5.REPT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ru.create(ea.VALUE);if(e.isNull()||0===o)return nJ.create("");if(o>=r.length)return nJ.create(r);let l=r.substring(r.length-o);return nJ.create(l)}},i5.RIGHT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(1),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let r=ly(e),{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;let[a]=s,o=Math.floor(+a.getValue());if(o<0)return ru.create(ea.VALUE);if(e.isNull()||0===o)return nJ.create("");let l=r.length-1,u=0,c="";for(;u<o&&l>=0;)u+=lR(r,l,"rtl"),c=r.charAt(l)+c,l--;return nJ.create(c)}},i5.RIGHTB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sY(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ru.create(ea.VALUE);if(e.isNull()||0===n.length)return nQ.create(u);let c=i.indexOf(n,u-1);return -1===c?ru.create(ea.VALUE):nQ.create(c+1)}},i5.SEARCH],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",3)}calculate(e,t,r){let n=null!=r?r:nQ.create(1),i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,n,ru.create(ea.NA)),u=a.mapValue((e,t,r)=>{let n=o.get(t,r),i=l.get(t,r);return e.isError()?e:n.isError()?n:i.isError()?i:this._handleSingleObject(e,n,i)});return 1===i&&1===s?u.get(0,0):u}_handleSingleObject(e,t,r){let n=ly(e).toLocaleUpperCase(),i=ly(t).toLocaleUpperCase(),{isError:s,errorObject:a,variants:o}=sY(r);if(s)return a;let[l]=o,u=Math.floor(+l.getValue());if(t.isNull()||u<=0||u>i.length)return ru.create(ea.VALUE);if(e.isNull()||0===n.length)return nQ.create(u);let c=i.indexOf(n,u-1);if(-1===c)return ru.create(ea.VALUE);let h=lE(i.substring(0,c))+1;return nQ.create(h)}},i5.SEARCHB],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",4)}calculate(e,t,r,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,null!=n&&n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,null!=n&&n.isArray()?n.getColumnCount():1),a=ii(i,s,e,ru.create(ea.NA)),o=ii(i,s,t,ru.create(ea.NA)),l=ii(i,s,r,ru.create(ea.NA)),u=n?ii(i,s,n,ru.create(ea.NA)):void 0,c=a.mapValue((e,t,r)=>{let i=o.get(t,r),s=l.get(t,r),a=n?u.get(t,r):void 0;return e.isError()?e:i.isError()?i:s.isError()?s:null!=a&&a.isError()?a:null!=a&&a.isNull()||null!=a&&a.isBoolean()?ru.create(ea.VALUE):(null!=a&&a.isString()&&(a=a.convertToNumberObjectValue()),null!=a&&a.isError()?a:this._handleSingleObject(e,i,s,a))});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r,n){let i=this._getObjectString(e),s=this._getObjectString(t),a=this._getObjectString(r),o=n?Math.floor(+n.getValue()):void 0;if(n&&o<=0)return ru.create(ea.VALUE);if(""===s)return nJ.create(i);let l="",u=0;for(let e=0;e<i.length;e++){let t=i.substr(e,s.length);if(t===s||t.length===s.length&&t.trim()===s.trim()){if(++u===o){l=i.substr(0,e)+a+i.substr(e+s.length);break}void 0===o&&(l+=a),e+=s.length-1}else void 0===o&&(l+=i[e])}return o&&u<o&&(l=i),nJ.create(l)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}},i5.SUBSTITUTE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1),J(this,"needsReferenceObject",!0)}calculate(e){let t=e;return e.isReferenceObject()&&(t=e.toArrayValueObject().get(0,0)),t.isArray()?t.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(t)}_handleSingleObject(e){return e.isError()?e:e.isNull()||e.isBoolean()||e.isNumber()?nJ.create(""):e}},i5.T],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),i=ii(r,n,e),s=ii(r,n,t);return i.map((e,t,r)=>{if(e.isError())return e;let n=s.get(t,r)||nJ.create(" ");if(n.isError())return n;if(n.isBoolean())return ru.create(ea.VALUE);if(e.isBoolean())return e;let i=e.getValue();if(e.isNull()&&(i=0),e.isString()){if(!(0,j.isRealNum)(i))return e;i=Number(i)}n.isNull()&&(n=nJ.create(" "));let a=`${n.getValue()}`,o=l_(a,i);return nJ.create(" "===a?o.trimEnd():o)})}},i5.TEXT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nQ.create(1);o.isNull()&&(a=!0,o=nQ.create(1));let l=null!=n?n:nQ.create(0),u=null!=i?i:nQ.create(0),c=null!=s?s:ru.create(ea.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=ii(h,d,e,ru.create(ea.NA)),g=ii(h,d,o,ru.create(ea.NA)),f=ii(h,d,l,ru.create(ea.NA)),p=ii(h,d,u,ru.create(ea.NA)),C=ii(h,d,c,ru.create(ea.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof ru)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof ru)return C;let[_,y,E]=C;return 0===_||y<0||y>1||E<0||E>1?ru.create(ea.VALUE):p.includes("")?_>0?nJ.create(f):nJ.create(""):!a&&Math.abs(_)>f.length?ru.create(ea.VALUE):p.every(e=>e.length>f.length)?ru.create(ea.NA):this._getResult(f,p,_,y,E,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nK.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),h=e.length,c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return ru.create(ea.NA);if(!c||c<Math.abs(r))return i?r>0?nJ.create(""):nJ.create(e):s;let d=e.substr(u+h);return nJ.create(d)}},i5.TEXTAFTER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=!1,o=null!=r?r:nQ.create(1);o.isNull()&&(a=!0,o=nQ.create(1));let l=null!=n?n:nQ.create(0),u=null!=i?i:nQ.create(0),c=null!=s?s:ru.create(ea.NA),h=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,c.isArray()?c.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,c.isArray()?c.getColumnCount():1),m=ii(h,d,e,ru.create(ea.NA)),g=ii(h,d,o,ru.create(ea.NA)),f=ii(h,d,l,ru.create(ea.NA)),p=ii(h,d,u,ru.create(ea.NA)),C=ii(h,d,c,ru.create(ea.NA)),_=this._getResultArray(m,t,g,f,p,C,a,!n);return 1===h&&1===d?_.get(0,0):_}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=r.get(l,u),h=n.get(l,u),d=i.get(l,u),m=s.get(l,u),g=this._checkVariantsError(e,c,h,d);if(g.isError())return g;let f=this._getStringValue(e),p=this._getDelimiterValue(t);if(p instanceof ru)return p;let C=this._getVariantsNumberFloorValue(c,h,d);if(C instanceof ru)return C;let[_,y,E]=C;return 0===_||y<0||y>1||E<0||E>1?ru.create(ea.VALUE):p.includes("")?_>0?nJ.create(""):nJ.create(f):!a&&Math.abs(_)>f.length?ru.create(ea.VALUE):p.every(e=>e.length>f.length)?ru.create(ea.NA):this._getResult(f,p,_,y,E,m,o)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nK.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,n=ru.create(ea.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,n=e,!1;t.push(this._getStringValue(e))}),r)return n}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let n=e[r];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=Math.floor(+n.getValue());t.push(i)}return t}_getResult(e,t,r,n,i,s,a){let o=n?e.toLocaleLowerCase():e,l=n?t.map(e=>e.toLocaleLowerCase()):t,u=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=l.map(e=>({index:o.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;u=e.index,o=o.substr(0,e.index),c++}else{let e=l.map(e=>({index:o.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;u+=e.index+h,o=o.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&a)return ru.create(ea.NA);if(!c||c<Math.abs(r))return i?r>0?nJ.create(e):nJ.create(""):s;let d=e.substr(0,u);return nJ.create(d)}},i5.TEXTBEFORE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",3),J(this,"maxParams",255)}calculate(e,t,...r){let n=this._getDelimiterValues(e),i=this._getTextValues(r);if(t.isArray()){let e=t.mapValue(e=>this._handleSingleObject(n,e,i));return 1===e.getRowCount()&&1===e.getColumnCount()?e.get(0,0):e}if(t.isString()){let e=`${t.getValue()}`.toLocaleUpperCase();if("TRUE"===e)return this._handleSingleObject(n,nK.create(!0),i);if("FALSE"===e)return this._handleSingleObject(n,nK.create(!1),i)}return this._handleSingleObject(n,t,i)}_handleSingleObject(e,t,r){if(e instanceof ru)return e;let{isError:n,errorObject:i,variants:s}=sY(t);if(n)return i;if(r instanceof ru)return r;let[a]=s,o=+a.getValue(),l=r;o&&(l=r.filter(e=>null!==e));let u="";for(let t=0;t<l.length;t++)null!==l[t]&&(u+=l[t]),t<l.length-1&&(u+=e[t%e.length]);return nJ.create(u)}_getDelimiterValues(e){let t=[],r=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;for(let i=0;i<r;i++)for(let r=0;r<n;r++){let n=e.isArray()?e.get(i,r):e;if(n.isError())return n;let s=`${n.getValue()}`;n.isNull()&&(s=""),n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}return t}_getTextValues(e){let t=[];for(let r of e){let e=r.isArray()?r.getRowCount():1,n=r.isArray()?r.getColumnCount():1;for(let i=0;i<e;i++)for(let e=0;e<n;e++){let n=r.isArray()?r.get(i,e):r;if(n.isError())return n;if(n.isNull()){t.push(null);continue}let s=`${n.getValue()}`;n.isBoolean()&&(s=s.toLocaleUpperCase()),t.push(s)}}return t}},i5.TEXTJOIN],[class extends sz{constructor(){super(...arguments),J(this,"minParams",2),J(this,"maxParams",6)}calculate(e,t,r,n,i,s){let a=null!=r?r:nJ.create("\\s"),o=null!=n?n:nQ.create(0),l=null!=i?i:nQ.create(0),u=null!=s?s:nJ.create(ea.NA),{_variant:c,values:h}=this._getStringValues(t),{_variant:d,values:m}=this._getStringValues(a,!1);a=d;let g=Math.max(e.isArray()?e.getRowCount():1,o.isArray()?o.getRowCount():1,l.isArray()?l.getRowCount():1),f=Math.max(e.isArray()?e.getColumnCount():1,o.isArray()?o.getColumnCount():1,l.isArray()?l.getColumnCount():1),p=ii(g,f,e,ru.create(ea.NA)),C=ii(g,f,o,ru.create(ea.NA)),_=ii(g,f,l,ru.create(ea.NA)),y=this._getResultArray(p,c,a,C,_,u,h,m);return 1===g&&1===f?y.get(0,0):y.map(e=>e.get(0,0))}_getStringValues(e,t=!0){let r=e,n=[];if(r.isArray())r.iterator(e=>{if(null!=e&&e.isError())return r=e,!1;if(null!=e&&e.isNull()&&t)return r=ru.create(ea.VALUE),!1;let i=this._getRegExpStringValue(e);if(""===i)return r=ru.create(ea.VALUE),!1;n.push(i)});else{r.isNull()&&t&&(r=ru.create(ea.VALUE));let e=this._getRegExpStringValue(r);""===e&&(r=ru.create(ea.VALUE)),n.push(e)}return{_variant:r,values:n}}_getResultArray(e,t,r,n,i,s,a,o){return e.map((e,l,u)=>{let c=n.get(l,u),h=i.get(l,u),d=this._checkVariantsError(e,t,r,c,h);if(d.isError())return d;if(e.isNull())return ru.create(ea.VALUE);let m=s;if(m.isArray()){let e=m.getRowCount(),t=m.getColumnCount();if(e>1||t>1)return ru.create(ea.VALUE);m=m.get(0,0)}let g=`${e.getValue()}`;if(e.isBoolean()&&(g=g.toLocaleUpperCase()),c.isString()&&(c=c.convertToNumberObjectValue()).isError())return c;let f=Math.floor(+c.getValue());if(h.isString()&&(h=h.convertToNumberObjectValue()).isError())return h;let p=Math.floor(+h.getValue());if(p<0||p>1)return ru.create(ea.VALUE);let C=`${m.getValue()}`;return m.isBoolean()&&(C=C.toLocaleUpperCase()),this._getResult(g,a,o,f,p,C)})}_getResult(e,t,r,n,i,s){let a=RegExp(r.join("|"),`g${i?"i":""}`),o=RegExp(t.join("|"),`g${i?"i":""}`),l=e.split(a),u=1,c=l.map(e=>{let t=e.split(o);return n&&(t=t.filter(e=>""!==e)),u=Math.max(u,t.length),t});return c=c.map(e=>{let t=e;return t.length<u&&(t=t.concat(Array(u-t.length).fill(s))),t}),n5.createByArray(c)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nK.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},i5.TEXTSPLIT],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nJ.create("");let t=`${e.getValue()}`;return e.isBoolean()&&(t=t.toLocaleUpperCase()),t=t.trim().replace(/\s+/g," "),nJ.create(t)}},i5.TRIM],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:n}=sY(e);if(t)return r;let[i]=n,s=Math.floor(+i.getValue());if(s<1||s>1114111)return ru.create(ea.VALUE);if(1114111===s||1114110===s)return ru.create(ea.NA);let a=String.fromCharCode(s);return lB.some(e=>e===a)&&(a="\x01"),nJ.create(a)}},i5.UNICHAR],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return ru.create(ea.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());let r=t.charCodeAt(0);return nQ.create(r)}},i5.UNICODE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nJ.create("");let t=`${e.getValue()}`.toLocaleUpperCase();return nJ.create(t)}},i5.UPPER],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return ru.create(ea.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()).isError())return t;let r=+t.getValue();return nQ.create(r)}},i5.VALUE],[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nQ.create(0),n=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=ii(n,i,e,ru.create(ea.NA)),a=ii(n,i,r,ru.create(ea.NA)),o=s.mapValue((e,t,r)=>{let n=a.get(t,r);return e.isError()?e:n.isError()?n:this._handleSingleObject(e,n)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t){let{isError:r,errorObject:n,variants:i}=sY(t);if(r)return n;let[s]=i,a=Math.floor(+s.getValue());if(a<0||a>1)return ru.create(ea.VALUE);if(e.isNull())return nJ.create("");if(e.isBoolean())return e;if(e.isNumber())return nQ.create(e.getValue());let o=a?`"${e.getValue()}"`:`${e.getValue()}`;return nJ.create(o)}},i5.VALUETOTEXT]],lH=[];var lW=lW||{},lG=((P=lG||{}).ENCODEURL="ENCODEURL",P.FILTERXML="FILTERXML",P.WEBSERVICE="WEBSERVICE",P);let lY=[[class extends sz{constructor(){super(...arguments),J(this,"minParams",1),J(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=encodeURIComponent(ly(e)).replace(/[!~'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toLocaleUpperCase()}`);return nJ.create(t)}},lG.ENCODEURL]];class lz extends j.Disposable{constructor(){super(...arguments),J(this,"_allSubjects",[]),J(this,"_computingStatus$",new(0,$.BehaviorSubject)(!0)),J(this,"computingStatus$",this._computingStatus$.pipe((0,W.distinctUntilChanged)())),J(this,"_computingSubscription")}get computingStatus(){return this._computingStatus$.getValue()}dispose(){var e;super.dispose(),null==(e=this._computingSubscription)||e.unsubscribe(),this._computingStatus$.next(!0),this._computingStatus$.complete(),this._allSubjects.forEach(e=>{e.complete()})}pushComputingStatusSubject(e){return this._allSubjects.push(e),this._updateComputingObservable(),{dispose:()=>{let t=this._allSubjects.indexOf(e);-1!==t&&this._allSubjects.splice(t,1),this._updateComputingObservable()}}}_updateComputingObservable(){var e;if(null==(e=this._computingSubscription)||e.unsubscribe(),0===this._allSubjects.length)return void this._computingStatus$.next(!0);this._computingSubscription=(0,H.combineLatest)(this._allSubjects).pipe((0,G.map)(e=>e.every(e=>e))).subscribe(e=>this._computingStatus$.next(e))}}var lX=Object.getOwnPropertyDescriptor,lq=(e,t)=>(r,n)=>t(r,n,e);let lK=class extends j.Disposable{constructor(e,t){super(),J(this,"_computingCompleted$",new(0,Y.Observable)(e=>{this._commandService.onCommandExecuted(t=>{if(t.id!==tp.id)return;let r=t.params;if(r.stageInfo)return e.next(r.stageInfo.stage===iC.IDLE||r.stageInfo.stage===iC.CALCULATION_COMPLETED)})}).pipe((0,W.distinctUntilChanged)(),(0,z.shareReplay)())),this._commandService=e,this._globalComputingSrv=t;let r=new(0,j.DisposableCollection),n=new(0,$.BehaviorSubject)(!0);r.add(this._globalComputingSrv.pushComputingStatusSubject(n)),r.add(this._computingCompleted$.subscribe(e=>n.next(e))),r.add(()=>n.complete()),this.disposeWithMe(r)}};lK=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?lX(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([lq(0,j.ICommandService),lq(1,(0,B.Inject)(lz))],lK);var lQ=Object.getOwnPropertyDescriptor,lZ=(e,t)=>(r,n)=>t(r,n,e);let lJ=class extends j.Disposable{constructor(e,t,r,n){super(),this._commandService=e,this._functionService=t,this._configService=r,this._dataSyncPrimaryController=n,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[t_,eX,tg,tf,tp,tC,tc,th,td,tm,ty,tE,tR,tb,tI,ez].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)})}_registerFunctions(){var e;let t=this._configService.getConfig(tG),r=[...sq,...os,...oa,...of,...oB,...oW,...le,...lr,...ls,...lo,...lc,...ld,...lp,...l$,...lH,...lY].concat(null!=(e=null==t?void 0:t.function)?e:[]).map(e=>new e[0](e[1]));this._functionService.registerExecutors(...r)}};lJ=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?lQ(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([lZ(0,j.ICommandService),lZ(1,iO),lZ(2,j.IConfigService),lZ(3,(0,B.Optional)(K.DataSyncPrimaryController))],lJ);var l0=Object.getOwnPropertyDescriptor,l1=(e,t)=>(r,n)=>t(r,n,e);let l2=class extends j.Disposable{constructor(e,t,r){super(),this._commandService=e,this._dependencyManagerService=t,this._featureCalculationManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(e=>{let{unitId:t,subUnitId:r,featureIds:n}=e;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,n)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tm.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._dependencyManagerService.removeFeatureFormulaDependency(n,i,r)}else if(e.id===td.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._dependencyManagerService.removeFeatureFormulaDependency(i,s,[r])}else if(e.id===tE.id){let t=e.params;if(null==t)return;this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,t.formulaIdList)}else if(e.id===ty.id){let t=e.params;if(null==t)return;let r=t.formulaMap,n=[];Object.keys(r).forEach(e=>{n.push(e)}),this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,n)}else if(e.id===t_.id){let t=e.params.formulaData;Object.keys(t).forEach(e=>{let r=t[e];if(void 0!==r){if(null===r)return void this._dependencyManagerService.clearFormulaDependency(e);Object.keys(r).forEach(t=>{let n=r[t];if(void 0!==n){if(null===n)return this._dependencyManagerService.clearFormulaDependency(e,t),!0;new(0,j.ObjectMatrix)(n).forValue((r,n)=>{this._dependencyManagerService.removeFormulaDependency(e,t,r,n)})}})}})}else e.id===tc.id&&this._handleSetDefinedName(e)}))}_handleSetDefinedName(e){let t=e.params;if(null==t)return;let{unitId:r,name:n}=t;this._dependencyManagerService.removeFormulaDependencyByDefinedName(r,n)}};l2=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l0(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l1(0,j.ICommandService),l1(1,sC),l1(1,sf),l1(2,sC)],l2);var l5=Object.getOwnPropertyDescriptor,l3=(e,t)=>(r,n)=>t(r,n,e);let l4=class extends j.Disposable{constructor(e,t){super(),this._commandService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===td.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:n}=t,{unitId:i,subUnitId:s}=n;this._featureCalculationManagerService.register(i,s,r,n)}else if(e.id===tm.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:n,subUnitId:i}=t;this._featureCalculationManagerService.remove(n,i,r)}}))}};l4=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l5(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l3(0,j.ICommandService),l3(1,sC)],l4);var l6=Object.getOwnPropertyDescriptor,l9=(e,t)=>(r,n)=>t(r,n,e);let l8=class extends j.Disposable{constructor(e,t,r){super(),this._commandService=e,this._otherFormulaManagerService=t,this._dependencyManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===ty.id){let t=e.params;if(null==t)return;let r={[t.unitId]:{[t.subUnitId]:t.formulaMap}};this._otherFormulaManagerService.batchRegister(r)}else if(e.id===tE.id){let t=e.params;if(null==t)return;let r={};t.formulaIdList.forEach(e=>r[e]=!0);let n={[t.unitId]:{[t.subUnitId]:r}};this._otherFormulaManagerService.batchRemove(n)}}))}};l8=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?l6(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([l9(0,j.ICommandService),l9(1,sy),l9(2,sf)],l8);class l7 extends j.Disposable{constructor(){super(...arguments),J(this,"_tableMap",new Map),J(this,"_tableOptionMap",new Map)}dispose(){super.dispose(),this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;null==(r=this._tableMap.get(e))||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var n;null==this._tableMap.get(e)&&this._tableMap.set(e,new Map),null==(n=this._tableMap.get(e))||n.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}}let ue=(0,B.createIdentifier)("univer.formula.super-table.service");var ut=Object.getOwnPropertyDescriptor,ur=(e,t)=>(r,n)=>t(r,n,e);let un=class extends j.Disposable{constructor(e,t){super(),this._commandService=e,this._superTableService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tc.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n,reference:i}=t;this._superTableService.registerTable(r,n,i)}else if(e.id===th.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:n}=t;this._superTableService.remove(r,n)}else if(e.id===tI.id){let t=e.params;if(null==t)return;let{tableOption:r,tableOptionType:n}=t;this._superTableService.registerTableOptionMap(r,n)}}))}};un=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ut(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([ur(0,j.ICommandService),ur(1,ue)],un);class ui extends j.Disposable{constructor(){super(...arguments),J(this,"_dirtyConversionMap",new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}}let us=(0,B.createIdentifier)("univer.formula.active-dirty-manager.service");var ua=Object.getOwnPropertyDescriptor,uo=(e,t)=>(r,n)=>t(r,n,e);let ul=(J(k=class extends j.Plugin{constructor(e=tz,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...n}=(0,j.merge)({},tz,this._config);this._configService.setConfig(tG,n)}onStarting(){this._initialize(),this._initializeWithOverride()}onReady(){var e;(0,j.touchDependencies)(this._injector,[[lJ],[un]]),null!=(e=this._config)&&e.notExecuteFormula||(0,j.touchDependencies)(this._injector,[[l8],[l4],[l2],[sL]])}onRendered(){var e;null!=(e=this._config)&&e.notExecuteFormula||(0,j.touchDependencies)(this._injector,[[sx],[sv]])}_initialize(){let e=!this._config.notExecuteFormula,t=[[iO,{useClass:ix}],[tl,{useClass:to}],[us,{useClass:ui}],[tq,{useClass:tX}],[ue,{useClass:l7}],[lz],[tk],[tL],[lJ],[un],[lK]];e&&t.push([sy,{useClass:s_}],[iE,{useClass:iy}],[tJ,{useClass:tZ}],[sC,{useClass:sp}],[sL],[l8],[l2],[l4],[iG],[sd],[t2],[iv],[iH],[iZ],[i0],[i6],[iP],[se],[si],[so],[su]),t.forEach(e=>this._injector.add(e))}_initializeWithOverride(){var e;null!=(e=this._config)&&e.notExecuteFormula||[[sx,{useClass:sU}],[sf,{useClass:sg}],[sv,{useClass:sT}]].forEach(e=>this._injector.add(e))}},"pluginName","UNIVER_ENGINE_FORMULA_PLUGIN"),k);ul=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?ua(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([uo(1,(0,B.Inject)(B.Injector)),uo(2,j.IConfigService)],ul)}),c("c3hg1",function(e,t){i(e.exports,"shareReplay",function(){return s});var r=u("3rvNF"),n=u("8LCGH");function s(e,t,i){var s,a,o,l,u=!1;return e&&"object"==typeof e?(l=void 0===(s=e.bufferSize)?1/0:s,t=void 0===(a=e.windowTime)?1/0:a,u=void 0!==(o=e.refCount)&&o,i=e.scheduler):l=null!=e?e:1/0,(0,n.share)({connector:function(){return new(0,r.ReplaySubject)(l,t,i)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:u})}}),c("8LCGH",function(e,t){i(e.exports,"share",function(){return l});var r=u("14wAQ"),n=u("b7gpN"),s=u("1mjSk"),a=u("lftZl"),o=u("jSzwf");function l(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new(0,s.Subject)}:t,i=e.resetOnError,l=void 0===i||i,u=e.resetOnComplete,h=void 0===u||u,d=e.resetOnRefCountZero,m=void 0===d||d;return function(e){var t,i,s,u=0,d=!1,g=!1,f=function(){null==i||i.unsubscribe(),i=void 0},p=function(){f(),t=s=void 0,d=g=!1},C=function(){var e=t;p(),null==e||e.unsubscribe()};return(0,o.operate)(function(e,o){u++,g||d||f();var _=s=null!=s?s:r();o.add(function(){0!=--u||g||d||(i=c(C,m))}),_.subscribe(o),!t&&u>0&&(t=new(0,a.SafeSubscriber)({next:function(e){return _.next(e)},error:function(e){g=!0,f(),i=c(p,l,e),_.error(e)},complete:function(){d=!0,f(),i=c(p,h),_.complete()}}),(0,n.innerFrom)(e).subscribe(t))})(e)}}function c(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];if(!0===t)return void e();if(!1!==t){var o=new(0,a.SafeSubscriber)({next:function(){o.unsubscribe(),e()}});return(0,n.innerFrom)(t.apply(void 0,(0,r.__spreadArray)([],(0,r.__read)(i)))).subscribe(o)}}}),c("2BOVU",function(e,t){i(e.exports,"DEFAULT_TEXT_FORMAT",function(){return r}),i(e.exports,"DEFAULT_TEXT_FORMAT_EXCEL",function(){return n}),i(e.exports,"DEFAULT_NUMBER_FORMAT",function(){return s}),i(e.exports,"isTextFormat",function(){return a}),i(e.exports,"isDefaultFormat",function(){return o});let r="@@@",n="@",s="General";function a(e){return e===r||e===n}function o(e){return null==e||e===s}}),c("k2g5B",function(e,t){i(e.exports,"RemoteSyncServiceName",function(){return N}),i(e.exports,"IRemoteSyncService",function(){return S}),i(e.exports,"RemoteSyncPrimaryService",function(){return A}),i(e.exports,"RemoteInstanceServiceName",function(){return v}),i(e.exports,"IRemoteInstanceService",function(){return T}),i(e.exports,"WebWorkerRemoteInstanceService",function(){return w}),i(e.exports,"fromModule",function(){return M}),i(e.exports,"toModule",function(){return O}),i(e.exports,"ChannelClient",function(){return x}),i(e.exports,"ChannelServer",function(){return U}),i(e.exports,"IRPCChannelService",function(){return D}),i(e.exports,"ChannelService",function(){return V}),i(e.exports,"DataSyncPrimaryController",function(){return F}),i(e.exports,"DataSyncReplicaController",function(){return B}),i(e.exports,"UniverRPCMainThreadPlugin",function(){return Y}),i(e.exports,"UniverRPCWorkerThreadPlugin",function(){return z});var r,n=u("7yNYd"),s=u("1ZKGP"),a=u("lMvMU"),o=u("9z4na"),l=u("2jrJe"),c=u("5LPkb"),h=u("dBx9C"),d=u("hRiv7"),m=u("1O3Nt"),g=u("3yupB"),f=u("c3hg1"),p=Object.defineProperty,C=(e,t,r)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t,r)=>C(e,"symbol"!=typeof t?t+"":t,r);let y={},E={};var R=Object.getOwnPropertyDescriptor,b=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?R(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s},I=(e,t)=>(r,n)=>t(r,n,e);let N="rpc.remote-sync.service",S=(0,s.createIdentifier)(N),A=class{constructor(e){this._commandService=e}async syncMutation(e){return this._commandService.syncExecuteCommand(e.mutationInfo.id,e.mutationInfo.params,{onlyLocal:!0,fromSync:!0})}};A=b([I(0,n.ICommandService)],A);let v="univer.remote-instance-service",T=(0,s.createIdentifier)(v),w=class{constructor(e,t,r){this._univerInstanceService=e,this._commandService=t,this._logService=r}whenReady(){return Promise.resolve(!0)}async syncMutation(e){return this._applyMutation(e.mutationInfo)}async createInstance(e){let{type:t,snapshot:r}=e;try{if(t===n.UniverInstanceType.UNIVER_SHEET)return this._univerInstanceService.createUnit(n.UniverInstanceType.UNIVER_SHEET,r),!0;throw Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${t}.`)}catch(e){throw e instanceof Error?e:TypeError(`${e}`)}}async disposeInstance(e){return this._univerInstanceService.disposeUnit(e.unitID)}_applyMutation(e){let{id:t,params:r}=e;return this._commandService.syncExecuteCommand(t,r,{onlyLocal:!0,fromSync:!0})}};function M(e){return new class{call(t,r){let n=e[t];if("function"==typeof n){let t=r?n.apply(e,r):n.call(e);return t instanceof Promise||(t=Promise.resolve(t)),t}throw Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){let n=e[t];if("function"==typeof n){let t=r?n.apply(e,r):n.call(e);return(0,d.isObservable)(t)?t:(0,g.of)(t)}throw Error(`[RPC]: observable method not found for ${t}!`)}}}function O(e){return new Proxy({},{get(t,r){if("dispose"!==r)return function(...t){return r.endsWith("$")?e.subscribe(r,t):e.call(r,t)}}})}w=b([I(0,n.IUniverInstanceService),I(1,n.ICommandService),I(2,n.ILogService)],w);class x extends n.RxDisposable{constructor(e){super(),_(this,"_initialized",new(0,c.BehaviorSubject)(!1)),_(this,"_lastRequestCounter",0),_(this,"_pendingRequests",new Map),this._protocol=e,this._protocol.send({type:50}),this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onMessage(e))}dispose(){this._pendingRequests.clear()}getChannel(e){let t=this;return{call:(r,n)=>t._disposed?Promise.reject():t._remoteCall(e,r,n),subscribe(r,n){if(t._disposed)throw Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,n)}}}_whenReady(){return(0,h.firstValueFrom)(this._initialized.pipe((0,a.filter)(e=>e),(0,o.take)(1)))}async _remoteCall(e,t,r){await this._whenReady();let n=++this._lastRequestCounter,i={seq:n,type:100,channelName:e,method:t,args:r},s=this;return new Promise((e,t)=>{this._pendingRequests.set(n,{handle(r){switch(r.type){case 201:s._pendingRequests.delete(n),e(r.data);break;case 202:s._pendingRequests.delete(n),t(r.data);break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(i)})}_remoteSubscribe(e,t,r){return new(0,m.Observable)(n=>{let i=-1;return this._whenReady().then(()=>{let s={seq:i=++this._lastRequestCounter,type:101,channelName:e,method:t,args:r};this._pendingRequests.set(i,{handle(e){switch(e.type){case 300:n.next(e.data);break;case 301:n.error(e.data);break;case 302:n.complete();break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(s)}),()=>{if(-1===i)return;let r={type:102,seq:i,channelName:e,method:t};this._sendRequest(r)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;switch(e.type){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:null==(t=this._pendingRequests.get(e.seq))||t.handle(e)}}}class U extends n.RxDisposable{constructor(e){super(),_(this,"_channels",new Map),_(this,"_subscriptions",new Map),this._protocol=e,this._protocol.onMessage.pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>this._onRequest(e)),this._sendInitialize()}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 50:this._sendInitialize();break;case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e)}}_sendInitialize(){this._sendResponse({seq:-1,type:0})}_onMethodCall(e){let t,{channelName:r,method:n,args:i}=e,s=this._channels.get(r);try{if(!s)throw Error(`[ChannelServer]: Channel ${r} not found!`);t=i?s.call(n,i):s.call(n)}catch(e){t=Promise.reject(e)}t.then(t=>{this._sendResponse({seq:e.seq,type:201,data:t})}).catch(t=>{t instanceof Error?this._sendResponse({seq:e.seq,type:202,data:t.message}):this._sendResponse({seq:e.seq,type:202,data:String(t)})})}_onSubscribe(e){let{channelName:t,seq:r}=e,n=this._channels.get(t);try{if(!n)throw Error(`[ChannelServer]: Channel ${t} not found!`);let i=n.subscribe(e.method,e.args).subscribe({next:e=>{this._sendResponse({seq:r,type:300,data:e})},error:e=>{this._sendResponse({seq:r,type:301,data:e.message}),this._sendResponse({seq:r,type:302})},complete:()=>{this._sendResponse({seq:r,type:302})}});this._subscriptions.set(e.seq,i)}catch(t){t instanceof Error?this._sendResponse({seq:e.seq,type:301,data:t.message}):this._sendResponse({seq:e.seq,type:301,data:String(t)})}}_onUnsubscribe(e){let t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}}let D=(0,s.createIdentifier)("IRPCChannelService");class V{constructor(e){_(this,"_client"),_(this,"_server"),this._client=new x(e),this._server=new U(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}}var L=Object.getOwnPropertyDescriptor,P=(e,t)=>(r,n)=>t(r,n,e);let F=class extends n.RxDisposable{constructor(e,t,r,n,i){super(),_(this,"_remoteInstanceService"),_(this,"_syncingUnits",new Set),_(this,"_syncingMutations",new Set),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._rpcChannelService=n,this._remoteSyncService=i,this._initRPCChannels(),this._init()}registerSyncingMutations(e){this._syncingMutations.add(e.id)}syncUnit(e){return this._syncingUnits.add(e),(0,n.toDisposable)(()=>this._syncingUnits.delete(e))}_initRPCChannels(){this._rpcChannelService.registerChannel(N,M(this._remoteSyncService)),this._injector.add([T,{useFactory:()=>O(this._rpcChannelService.requestChannel(v))}]),this._remoteInstanceService=this._injector.get(T)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(n.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.add(e.getUnitId()),this._remoteInstanceService.createInstance({unitID:e.getUnitId(),type:n.UniverInstanceType.UNIVER_SHEET,snapshot:e.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(n.UniverInstanceType.UNIVER_SHEET).pipe((0,l.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.delete(e.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:e.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{let{type:r,params:i,id:s}=e,a=(null==i?void 0:i.unitId)||"";r===n.CommandType.MUTATION&&(!a||this._syncingUnits.has(a))&&!(null!=t&&t.fromSync)&&this._syncingMutations.has(s)&&this._remoteInstanceService.syncMutation({mutationInfo:e})}))}};F=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?L(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([P(0,(0,s.Inject)(s.Injector)),P(1,n.ICommandService),P(2,n.IUniverInstanceService),P(3,D),P(4,S)],F);var k=Object.getOwnPropertyDescriptor,j=(e,t)=>(r,n)=>t(r,n,e);let B=class extends n.Disposable{constructor(e,t,r,n){super(),_(this,"_remoteSyncService"),this._injector=e,this._remoteInstanceService=t,this._commandService=r,this._rpcChannelService=n,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(v,M(this._remoteInstanceService)),this._injector.add([S,{useFactory:()=>O(this._rpcChannelService.requestChannel(N))}]),this._remoteSyncService=this._injector.get(S)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{e.type!==n.CommandType.MUTATION||null!=t&&t.fromSync||this._remoteSyncService.syncMutation({mutationInfo:e})}))}};B=((e,t,r,n)=>{for(var i,s=n>1?void 0:n?k(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s})([j(0,(0,s.Inject)(s.Injector)),j(1,T),j(2,n.ICommandService),j(3,D)],B);var $,H=Object.getOwnPropertyDescriptor,W=(e,t,r,n)=>{for(var i,s=n>1?void 0:n?H(t,r):t,a=e.length-1;a>=0;a--)(i=e[a])&&(s=i(s)||s);return s},G=(e,t)=>(r,n)=>t(r,n,e);let Y=($=class extends n.Plugin{constructor(e=y,t,r){super(),_(this,"_internalWorker",null),this._config=e,this._injector=t,this._configService=r;let{...i}=(0,n.merge)({},y,this._config);this._configService.setConfig("rpc.main-thread.config",i)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){let{workerURL:e}=this._config;if(!e)throw Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");let t=e instanceof Worker?e:new Worker(e);this._internalWorker=e instanceof Worker?null:t;let r={send(e){t.postMessage(e)},onMessage:new(0,m.Observable)(e=>{let r=t=>{e.next(t.data)};return t.addEventListener("message",r),()=>t.removeEventListener("message",r)}).pipe((0,f.shareReplay)(1))};[[D,{useFactory:()=>new V(r)}],[F],[S,{useClass:A}]].forEach(e=>this._injector.add(e)),this._injector.get(F)}},_($,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),$);Y=W([G(1,(0,s.Inject)(s.Injector)),G(2,n.IConfigService)],Y);let z=(_(r=class extends n.Plugin{constructor(e=E,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...i}=(0,n.merge)({},E,this._config);this._configService.setConfig("rpc.worker-thread.config",i)}onStarting(){[[B],[D,{useFactory:()=>new V({send(e){postMessage(e)},onMessage:new(0,m.Observable)(e=>{let t=t=>{e.next(t.data)};return addEventListener("message",t),()=>removeEventListener("message",t)}).pipe((0,f.shareReplay)(1))})}],[T,{useClass:w}]].forEach(e=>this._injector.add(e)),this._injector.get(B)}},"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),r);z=W([G(1,(0,s.Inject)(s.Injector)),G(2,n.IConfigService)],z)}),c("2jrJe",function(e,t){i(e.exports,"takeUntil",function(){return o});var r=u("jSzwf"),n=u("iNetn"),s=u("b7gpN"),a=u("f1euv");function o(e){return(0,r.operate)(function(t,r){(0,s.innerFrom)(e).subscribe((0,n.createOperatorSubscriber)(r,function(){return r.complete()},a.noop)),r.closed||t.subscribe(r)})}}),c("hRiv7",function(e,t){i(e.exports,"isObservable",function(){return s});var r=u("1O3Nt"),n=u("3IQI0");function s(e){return!!e&&(e instanceof r.Observable||(0,n.isFunction)(e.lift)&&(0,n.isFunction)(e.subscribe))}}),c("23cfA",function(e,t){i(e.exports,"switchMap",function(){return a});var r=u("b7gpN"),n=u("jSzwf"),s=u("iNetn");function a(e,t){return(0,n.operate)(function(n,i){var a=null,o=0,l=!1,u=function(){return l&&!a&&i.complete()};n.subscribe((0,s.createOperatorSubscriber)(i,function(n){null==a||a.unsubscribe();var l=0,c=o++;(0,r.innerFrom)(e(n,c)).subscribe(a=(0,s.createOperatorSubscriber)(i,function(e){return i.next(t?t(n,e,c,l++):e)},function(){a=null,u()}))},function(){l=!0,u()}))})}}),c("3SlRu",function(e,t){e.exports=Promise.all([s("dDin5"),s("fd2QQ")]).then(()=>u("61myN"))}),c("keteL",function(e,t){e.exports=Promise.all([s("dDin5"),s("1BRsM")]).then(()=>u("bzE9m"))}),c("4w8lL",function(e,t){e.exports=s("1LVG9").then(()=>u("jF4AZ"))}),c("gX45t",function(e,t){e.exports=s("jaeyi").then(()=>u("27FrX"))}),Object.assign(u.i??={},{fd2QQ:"es.e150e181.js",dDin5:"es.9ef2b9a3.js","1BRsM":"preset-sheets-core.c417e23e.js",fBi3N:"vue.runtime.esm-bundler.52ca4d42.js","1LVG9":"en-US.2b91a5bf.js",jaeyi:"mini.3273b840.js"});var h=u("7yNYd"),d=u("ejawP");const m=u("3SlRu"),g=u("keteL"),f=u("4w8lL"),p=u("gX45t"),C=window?.location?.search?.includes("_debug_spreadsheet");class _{static{this.MAX_COLS=1e9}static getCellIndex(e,t){return e*_.MAX_COLS+t}insert(e,t,r){let n=_.getCellIndex(e,t);this.ids[n]=r}get(e,t){let r=_.getCellIndex(e,t);return this.ids[r]}constructor(){this.ids=[]}}async function y(e,t){let{cellData:r,rowCount:n,columnCount:i,cellIdMap:s}=await E(e);return{worksheet:{id:"sqlpage",name:t.sheet_name,defaultColumnWidth:t.column_width,defaultRowHeight:t.row_height,showGridlines:+t.show_grid,freeze:{startRow:t.freeze_y,startColumn:t.freeze_x,xSplit:t.freeze_x,ySplit:t.freeze_y},rowCount:n,columnCount:i,cellData:r},cellIdMap:s}}async function E(e){let t={},r=new _,n=1e3,i=26,s=T(await p);for(let a of e){let[e,o,l,...u]=s.parse(a),c={v:l};if(u.length){let{s:t,customId:n}=function(e){let t,r={};for(let n=0;n<e.length;n++){let i=e[n];if(1===i)r.bl=1;else if(2===i)r.it=1;else if(3===i){let t=e[++n].toString();r.bg={rgb:N.getPropertyValue(`--tblr-${t}`)||t}}else if(4===i)r.ht=h.HorizontalAlign.CENTER;else if(5===i)r.ht=h.HorizontalAlign.RIGHT;else if(6===i)r.ht=h.HorizontalAlign.JUSTIFIED;else if(7===i)r.ht=h.HorizontalAlign.DISTRIBUTED;else if(8===i)r.n={pattern:e[++n].toString()};else if(9===i)t=e[++n].toString();else if(10===i)r.ff=e[++n].toString();else if(11===i)r.fs=Number(e[++n]);else if(12===i)r.ul={s:1};else if(13===i)r.st={s:1};else if(14===i){let t=e[++n].toString();r.cl={rgb:N.getPropertyValue(`--tblr-${t}`)||t}}else 15===i?r.vt=h.VerticalAlign.TOP:16===i?r.vt=h.VerticalAlign.MIDDLE:17===i?r.vt=h.VerticalAlign.BOTTOM:18===i?r.tb=h.WrapStrategy.OVERFLOW:19===i?r.tb=h.WrapStrategy.CLIP:20===i?r.tb=h.WrapStrategy.WRAP:21===i&&(r.td=h.TextDirection.RIGHT_TO_LEFT)}return{s:r,customId:t}}(u);c.s=t,n&&r.insert(o,e,n)}"number"==typeof l&&(c.t=2);let d=t[o];d?d[e]=c:t[o]={[e]:c},n=Math.max(n,o),i=Math.max(i,e)}return{cellData:t,rowCount:n,columnCount:i,cellIdMap:r}}async function R(e){let{LocaleType:t,createUniver:r,defaultTheme:n}=await m,{UniverSheetsCorePreset:i}=await g,{default:s}=await f,{univerAPI:a}=r({locale:t.EN_US,locales:{[t.EN_US]:s},logLevel:3*!!C,theme:n,presets:[i({container:e})]});return e.className="sqlpage_spreadsheet",a}const b=async e=>{let{update_link:t,x:r,y:n,value:i,customId:s,errorModal:a}=e;if(!t)return;let o=new URL(t,window.location.href);o.searchParams.append("_sqlpage_embed","");let l=new URLSearchParams;l.append("x",r.toString()),l.append("y",n.toString()),null!=i&&l.append("value",i.toString()),null!=s&&l.append("id",s);let u=await fetch(o,{method:"POST",body:l}),c=await u.text();200===u.status||c||(c=u.statusText),c&&a(c)},I=(r=async function(e){!function(e,t){let r=new Map,n=0;for(let i=0;i<e.length;i++){let s=e[i],a=t(s),o=r.get(a)??n++;r.set(a,o),e[o]=s}e.length=n}(e,({x:e,y:t})=>_.getCellIndex(t,e)),await Promise.all(e.map(b))},e=null,t=[],n=>{t.push(n),null===e&&(e=setTimeout(()=>{r(t),t=[],e=null},50))}),N=getComputedStyle(document.documentElement);async function S(e,t,r){let n=e.querySelector(".modal");if(!(n instanceof HTMLElement))throw Error("modal not found");let i=function(e){let t=window.alert;try{if(!e)throw Error("resp_modal not found");let t=e.querySelector(".modal-body");if(!t)throw Error("resp_modal_body not found");let r=window?.tabler?.Modal;if(!r)throw Error("tabler.Modal not found");return n=>{t.innerHTML=n,new r(e).show()}}catch(e){return console.error("Error setting up error modal",e),t}}(n),{worksheet:s,cellIdMap:a}=await y(r,t),o=await R(e),l={sheetOrder:["sqlpage"],name:"sqlpage",appVersion:"0.2.14",sheets:{sqlpage:s}};C&&console.log("sqlpage-spreadsheet: creating sheet",l),o.createWorkbook(l);let{update_link:u}=t;o.addEvent("CommandExecuted",({id:e,params:t})=>{u&&e===d.SetRangeValuesMutation.id&&function(e,t,r,n){let{cellValue:i}=e;if(i)for(let e in i){let s=i[e];for(let i in s){let a=s[i];if(!a)continue;let o=a.v;null==o&&a.p&&(o=a.p.body?.dataStream?.trimEnd());let l=Number.parseInt(e),u=Number.parseInt(i),c=n.get(l,u);I({update_link:t,x:u,y:l,value:o,customId:c,errorModal:r})}}}(t,u,i,a)})}const A=e=>e.object({update_link:e.optional(e.string()),sheet_name:e._default(e.string(),"SQLPage Data"),freeze_x:e._default(e.number().check(e.int(),e.nonnegative()),0),freeze_y:e._default(e.number().check(e.int(),e.nonnegative()),0),column_width:e._default(e.number().check(e.int(),e.nonnegative()),100),row_height:e._default(e.number().check(e.int(),e.nonnegative()),20),show_grid:e._default(e.boolean(),!0)}),v=e=>e.union([e.string(),e.number()]),T=e=>e.tuple([e.number().check(e.int(),e.nonnegative()),e.number().check(e.int(),e.nonnegative()),e.union([e.string(),e.number(),e.null()])],v(e));async function w(e){try{let t=e.dataset;if(!t)throw Error("Props not found");let r=JSON.parse(t?.cells||"[]");if(!Array.isArray(r))throw Error(`Invalid cells${t?.cells}`);let n=A(await p).parse(JSON.parse(t?.props||"{}"));S(e,n,r)}catch(e){alert(`Invalid properties passed to the spreadsheet component: ${e}`)}}const M=document.getElementsByClassName("sqlpage_spreadsheet"),O=M[M.length-1];if(!(O instanceof HTMLElement))throw Error("No spreadsheet elements found");w(O);
//# sourceMappingURL=spreadsheet_component.c250cbb3.js.map
