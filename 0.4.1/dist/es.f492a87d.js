function e(e,t,r,a){Object.defineProperty(e,t,{get:r,set:a,enumerable:!0,configurable:!0})}var t=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{}).parcelRequire26fc,r=t.register;r("86b1c",function(r,a){let n,i,s,l,u,o,c,h,m,f,g,d,N,_,C,E,p,A,b,y,R,S,O,T,V,I,M,x,v,U;e(r.exports,"ErrorType",function(){return q}),e(r.exports,"ERROR_TYPE_SET",function(){return W}),e(r.exports,"FunctionType",function(){return X}),e(r.exports,"operatorToken",function(){return K}),e(r.exports,"compareToken",function(){return Z}),e(r.exports,"matchToken",function(){return et}),e(r.exports,"normalizeSheetName",function(){return eu}),e(r.exports,"matchRefDrawToken",function(){return eo}),e(r.exports,"isReferenceString",function(){return ew}),e(r.exports,"SetArrayFormulaDataMutation",function(){return ej}),e(r.exports,"getAbsoluteRefTypeWitString",function(){return eY}),e(r.exports,"serializeRange",function(){return eG}),e(r.exports,"serializeRangeWithSheet",function(){return eq}),e(r.exports,"serializeRangeWithSpreadsheet",function(){return eW}),e(r.exports,"serializeRangeToRefString",function(){return eQ}),e(r.exports,"singleReferenceToGrid",function(){return eX}),e(r.exports,"deserializeRangeWithSheet",function(){return eZ}),e(r.exports,"isReferenceStringWithEffectiveColumn",function(){return eJ}),e(r.exports,"getRangeWithRefsString",function(){return e1}),e(r.exports,"isReferenceStrings",function(){return e2}),e(r.exports,"IDefinedNamesService",function(){return ta}),e(r.exports,"SetDefinedNameMutationFactory",function(){return tn}),e(r.exports,"SetDefinedNameMutation",function(){return ti}),e(r.exports,"RemoveDefinedNameMutation",function(){return ts}),e(r.exports,"SetFormulaCalculationStartMutation",function(){return to}),e(r.exports,"SetFormulaCalculationStopMutation",function(){return tc}),e(r.exports,"SetFormulaCalculationNotificationMutation",function(){return th}),e(r.exports,"SetFormulaCalculationResultMutation",function(){return tm}),e(r.exports,"SetFormulaDataMutation",function(){return tf}),e(r.exports,"SetOtherFormulaMutation",function(){return tg}),e(r.exports,"RemoveOtherFormulaMutation",function(){return td}),e(r.exports,"deserializeRangeWithSheetWithCache",function(){return tS}),e(r.exports,"sequenceNodeType",function(){return tT}),e(r.exports,"generateStringWithSequence",function(){return tV}),e(r.exports,"LexerTreeBuilder",function(){return tU}),e(r.exports,"FormulaDataModel",function(){return tk}),e(r.exports,"initSheetFormulaData",function(){return t$}),e(r.exports,"handleNumfmtInCell",function(){return ra}),e(r.exports,"stripErrorMargin",function(){return nN}),e(r.exports,"NullValueObject",function(){return nE}),e(r.exports,"FormulaExecuteStageType",function(){return n2}),e(r.exports,"FormulaExecutedStateType",function(){return n3}),e(r.exports,"IFunctionService",function(){return is}),e(r.exports,"FUNCTION_NAMES_MATH",function(){return i1}),e(r.exports,"FUNCTION_NAMES_TEXT",function(){return i2}),e(r.exports,"functionArray",function(){return lc}),e(r.exports,"FUNCTION_NAMES_COMPATIBILITY",function(){return uC}),e(r.exports,"functionCompatibility",function(){return uA}),e(r.exports,"functionCube",function(){return ub}),e(r.exports,"FUNCTION_NAMES_CUBE",function(){return uy}),e(r.exports,"CustomFunction",function(){return uS}),e(r.exports,"FUNCTION_NAMES_DATABASE",function(){return u$}),e(r.exports,"functionDatabase",function(){return uY}),e(r.exports,"FUNCTION_NAMES_DATE",function(){return uH}),e(r.exports,"functionDate",function(){return oL}),e(r.exports,"FUNCTION_NAMES_ENGINEERING",function(){return ow}),e(r.exports,"functionEngineering",function(){return cI}),e(r.exports,"FUNCTION_NAMES_FINANCIAL",function(){return cM}),e(r.exports,"functionFinancial",function(){return hY}),e(r.exports,"FUNCTION_NAMES_INFORMATION",function(){return hq}),e(r.exports,"functionInformation",function(){return me}),e(r.exports,"FUNCTION_NAMES_LOGICAL",function(){return mi}),e(r.exports,"functionLogical",function(){return mA}),e(r.exports,"FUNCTION_NAMES_LOOKUP",function(){return mU}),e(r.exports,"functionLookup",function(){return m2}),e(r.exports,"functionMath",function(){return gc}),e(r.exports,"functionMeta",function(){return gC}),e(r.exports,"FUNCTION_NAMES_STATISTICAL",function(){return gH}),e(r.exports,"functionStatistical",function(){return g4}),e(r.exports,"functionText",function(){return d5}),e(r.exports,"functionUniver",function(){return d4}),e(r.exports,"functionWeb",function(){return d6}),e(r.exports,"FUNCTION_NAMES_WEB",function(){return Nt}),e(r.exports,"IActiveDirtyManagerService",function(){return Nv}),e(r.exports,"UniverFormulaEnginePlugin",function(){return Nw});var D,P=t("7yNYd"),L=t("1mjSk"),w=t("k2g5B"),F=Object.defineProperty,j=(e,t,r)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,B=(e,t)=>F(e,"name",{value:t,configurable:!0}),k=(e,t,r)=>j(e,"symbol"!=typeof t?t+"":t,r),$=((n=$||{}).FALSE="FALSE",n.TRUE="TRUE",n),Y=((i=Y||{})[i.SUCCESS=0]="SUCCESS",i[i.ERROR=1]="ERROR",i),H=((s=H||{})[s.FRONT=0]="FRONT",s[s.BACK=1]="BACK",s);function G(e,t,r,a,n){for(let i=0,s=e.length;i<s;i++){let s=e[i];if(t!==s.unitId||r!==s.sheetId)continue;let{startRow:l,startColumn:u,endRow:o,endColumn:c}=s.range;if(a>=l&&a<=o&&n>=u&&n<=c)return!0}return!1}B(G,"isInDirtyRange");var q=((l=q||{}).DIV_BY_ZERO="#DIV/0!",l.NAME="#NAME?",l.VALUE="#VALUE!",l.NUM="#NUM!",l.NA="#N/A",l.CYCLE="#CYCLE!",l.REF="#REF!",l.SPILL="#SPILL!",l.CALC="#CALC!",l.ERROR="#ERROR!",l.CONNECT="#GETTING_DATA",l.NULL="#NULL!",l);let W=new Set(Object.values(q)),Q=[...new Set(Object.values(q).map(e=>e.length))];var X=((u=X||{})[u.Financial=0]="Financial",u[u.Date=1]="Date",u[u.Math=2]="Math",u[u.Statistical=3]="Statistical",u[u.Lookup=4]="Lookup",u[u.Database=5]="Database",u[u.Text=6]="Text",u[u.Logical=7]="Logical",u[u.Information=8]="Information",u[u.Engineering=9]="Engineering",u[u.Cube=10]="Cube",u[u.Compatibility=11]="Compatibility",u[u.Web=12]="Web",u[u.Array=13]="Array",u[u.Univer=14]="Univer",u[u.User=15]="User",u[u.DefinedName=16]="DefinedName",u),K=((o=K||{}).PLUS="+",o.MINUS="-",o.MULTIPLY="*",o.DIVIDED="/",o.CONCATENATE="&",o.POWER="^",o.EQUALS="=",o.NOT_EQUAL="<>",o.GREATER_THAN=">",o.GREATER_THAN_OR_EQUAL=">=",o.LESS_THAN="<",o.LESS_THAN_OR_EQUAL="<=",o),Z=((c=Z||{}).EQUALS="=",c.NOT_EQUAL="<>",c.GREATER_THAN=">",c.GREATER_THAN_OR_EQUAL=">=",c.LESS_THAN="<",c.LESS_THAN_OR_EQUAL="<=",c);let z=/* @__PURE__ */new Map([["<>",4],["<",4],[">=",4],["=",4],[">",4],["<=",4],["&",3],["+",2],["-",2],["/",1],["*",1],["^",0]]),J=new Set(z.keys()),ee=/* @__PURE__ */new Set(["=","<>",">",">=","<","<="]);var et=((h=et||{}).OPEN_BRACKET="(",h.CLOSE_BRACKET=")",h.COMMA=",",h.SINGLE_QUOTATION="'",h.DOUBLE_QUOTATION='"',h.OPEN_BRACES="{",h.CLOSE_BRACES="}",h.COLON=":",h.OPEN_SQUARE_BRACKET="[",h.CLOSE_SQUARE_BRACKET="]",h),er=((m=er||{}).PERCENTAGE="%",m.POUND="#",m);let ea=/* @__PURE__ */new Set(["%","#"]);var en=((f=en||{}).AT="@",f.MINUS="-",f.PLUS="+",f);let ei=[...Object.values(Z),...Object.values(K),...Object.values(et),...Object.values(er),...Object.values(en)];function es(e){return ei.includes(e)}function el(e){for(let t of ei)if(e.indexOf(t)>-1)return!0;return!1}function eu(e){return"'"===e[0]&&"'"===e[e.length-1]?e.substring(1,e.length-1):e}function eo(e){return es(e)&&e!==et.CLOSE_BRACES&&e!==et.CLOSE_BRACKET&&e!==et.SINGLE_QUOTATION&&e!==et.DOUBLE_QUOTATION||" "===e}B(es,"isFormulaLexerToken"),B(el,"includeFormulaLexerToken"),B(eu,"normalizeSheetName"),B(eo,"matchRefDrawToken");let ec=/* @__PURE__ */new Set([K.PLUS,K.MINUS,K.MULTIPLY,K.DIVIDED,K.CONCATENATE,K.POWER,K.EQUALS,K.NOT_EQUAL,K.GREATER_THAN,K.GREATER_THAN_OR_EQUAL,K.LESS_THAN,K.LESS_THAN_OR_EQUAL,et.OPEN_BRACKET,et.COMMA,et.COLON,et.OPEN_BRACES,et.OPEN_SQUARE_BRACKET]);function eh(e){return ec.has(e)}B(eh,"isTokenCannotBeAtEnd");let em=/* @__PURE__ */new Set([K.PLUS,K.MINUS,K.MULTIPLY,K.DIVIDED,K.CONCATENATE,K.POWER,K.EQUALS,K.NOT_EQUAL,K.GREATER_THAN,K.GREATER_THAN_OR_EQUAL,K.LESS_THAN,K.LESS_THAN_OR_EQUAL,et.OPEN_BRACKET,et.COMMA,et.COLON,et.OPEN_BRACES,et.OPEN_SQUARE_BRACKET,er.PERCENTAGE,er.POUND]);function ef(e){return em.has(e)}function eg(e){let t={};return Object.keys(e).forEach(r=>{let a=e[r];if(null==a)return!0;null==t[r]&&(t[r]={}),Object.keys(a).forEach(e=>{let n=a[e];t[r][e]=new P.ObjectMatrix(n)})}),t}function ed(e){let t={};return Object.keys(e).forEach(r=>{let a=e[r];if(null==a)return!0;null==t[r]&&(t[r]={}),Object.keys(a).forEach(e=>{let n=a[e];t[r][e]=n.getData()})}),t}B(ef,"isTokenCannotPrecedeSuffixToken"),B(eg,"convertUnitDataToRuntime"),B(ed,"convertRuntimeToUnitData");let eN='\\[([^\\[\\]\\/?:"<>|*\\\\]+)\\]',e_=new RegExp(eN),eC="\\s*?:\\s*?",eE="[A-Za-z]+",ep="[1-9][0-9]*",eA=`'?(${eN})?(((?![\\[\\]\\/?*\\\\]).)*!)?'?`,eb=`\\$?${eE}\\$?${ep}`,ey=RegExp(`^(${en.AT})?${eA}${eb}${eC}${eb}$`),eR=RegExp(`^${eA}\\s*?${eb}(${er.POUND})?$`),eS=RegExp(`^${eA}\\$?${ep}${eC}\\$?${ep}$`),eO=RegExp(`^${eA}\\$?${eE}${eC}\\$?${eE}$`),eT=RegExp(`^${eA}\\s*?\\$?${ep}$`),eV=RegExp(`^${eA}\\s*?\\$?${eE}$`),eI=RegExp("{.*?}","g");function eM(e){return eR.lastIndex=0,eR.test(e)}function ex(e){return ey.lastIndex=0,ey.test(e)}function ev(e){return eS.lastIndex=0,eS.test(e)}function eU(e){return eO.lastIndex=0,eO.test(e)}function eD(e){return eT.lastIndex=0,eT.test(e)}function eP(e){return eV.lastIndex=0,eV.test(e)}function eL(e){return eI.lastIndex=0,eI.test(e)}function ew(e){return eM(e)||ex(e)||ev(e)||eU(e)}B(eM,"regexTestSingeRange"),B(ex,"regexTestMultipleRange"),B(ev,"regexTestRow"),B(eU,"regexTestColumn"),B(eD,"regexTestSingleRow"),B(eP,"regexTestSingleColumn"),B(eL,"regexTestArrayValue"),B(ew,"isReferenceString");let eF={id:"formula.mutation.register-function",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},ej={id:"formula.mutation.set-array-formula-data",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B((e,t)=>!0,"handler")},eB=/[^0-9]/g,ek=/[^A-Za-z]/g;function e$(e){let t="$"===e[0],r=e.substring(1),a=r.indexOf("$")>-1;return(0,P.Tools).isStringNumber(r)&&t&&!a&&(t=!1,a=!0),t&&a?P.AbsoluteRefType.ALL:t?P.AbsoluteRefType.COLUMN:a?P.AbsoluteRefType.ROW:P.AbsoluteRefType.NONE}function eY(e){let t=e.split("!");t.length>1&&(e=t[t.length-1]);let r=e.split(":");return r.length>1?{startAbsoluteRefType:e$(r[0]),endAbsoluteRefType:e$(r[1])}:{startAbsoluteRefType:e$(r[0])}}function eH(e=P.AbsoluteRefType.NONE){let t="",r="";return e===P.AbsoluteRefType.ROW?t="$":e===P.AbsoluteRefType.COLUMN?r="$":e===P.AbsoluteRefType.ALL&&(t="$",r="$"),{rowAbsoluteString:t,columnAbsoluteString:r}}function eG(e){let{startColumn:t,startRow:r,endColumn:a,endRow:n,startAbsoluteRefType:i,endAbsoluteRefType:s,rangeType:l=P.RANGE_TYPE.NORMAL}=e,u=eH(i),o=eH(s);if(l===P.RANGE_TYPE.ROW||l===P.RANGE_TYPE.ALL){let e=`${u.rowAbsoluteString}${r+1}`,t=`${o.rowAbsoluteString}${n+1}`;return`${e}:${t}`}if(l===P.RANGE_TYPE.COLUMN){let e=`${u.columnAbsoluteString}${(0,P.Tools).chatAtABC(t)}`,r=`${o.columnAbsoluteString}${(0,P.Tools).chatAtABC(a)}`;return`${e}:${r}`}let c=`${u.columnAbsoluteString}${(0,P.Tools).chatAtABC(t)}${u.rowAbsoluteString}${r+1}`,h=`${o.columnAbsoluteString}${(0,P.Tools).chatAtABC(a)}${o.rowAbsoluteString}${n+1}`;return c===h?c:`${c}:${h}`}function eq(e,t){return e3(e)?`'${e}'!${eG(t)}`:`${e}!${eG(t)}`}function eW(e,t,r){return e3(e)||e3(t)?`'[${e}]${t}'!${eG(r)}`:`[${e}]${t}!${eG(r)}`}function eQ(e){let{unitId:t,sheetName:r,range:a}=e;return null!=t&&t.length>0&&null!=r&&r.length>0?eW(t,r,a):null!=r&&r.length>0?eq(r,a):eG(a)}function eX(e){return{row:Number.parseInt(e.replace(eB,""))-1,column:(0,P.Tools).ABCatNum(e.replace(ek,"")),absoluteRefType:e$(e)}}function eK(e){let t=e_.exec(e),r="";null!=t&&(r=(r=t[0].trim()).slice(1,r.length-1),e=e.replace(e_,""));let a=e.indexOf("!"),n="",i="";return a>-1?("'"===(n=e.substring(0,a))[0]&&"'"===n[n.length-1]&&(n=n.substring(1,n.length-1)),i=e.substring(a+1)):i=e,{refBody:i,sheetName:n,unitId:r}}function eZ(e){let{refBody:t,sheetName:r,unitId:a}=eK(e),n=t.indexOf(":");if(-1===n){let e=eX(t),n=e.row,i=e.column,s=e.absoluteRefType;return{unitId:a,sheetName:r,range:{startRow:n,startColumn:i,endRow:n,endColumn:i,startAbsoluteRefType:s,endAbsoluteRefType:s}}}let i=t.substring(0,n),s=t.substring(n+1),l=eX(i),u=eX(s),o=l.row>u.row?u.row:l.row,c=l.column>u.column?u.column:l.column,h=l.row>u.row?l.row:u.row,m=l.column>u.column?l.column:u.column,f=P.RANGE_TYPE.NORMAL;return Number.isNaN(o)&&Number.isNaN(h)?f=P.RANGE_TYPE.COLUMN:Number.isNaN(c)&&Number.isNaN(m)&&(f=P.RANGE_TYPE.ROW),{unitId:a,sheetName:r,range:{startRow:o,startColumn:c,endRow:h,endColumn:m,startAbsoluteRefType:l.absoluteRefType,endAbsoluteRefType:u.absoluteRefType,rangeType:f}}}B(e$,"getAbsoluteRefTypeWithSingleString"),B(eY,"getAbsoluteRefTypeWitString"),B(eH,"_getAbsoluteToken"),B(eG,"serializeRange"),B(eq,"serializeRangeWithSheet"),B(eW,"serializeRangeWithSpreadsheet"),B(eQ,"serializeRangeToRefString"),B(eX,"singleReferenceToGrid"),B(eK,"handleRefStringInfo"),B(eZ,"deserializeRangeWithSheet");let ez=["LOG10"];function eJ(e){let t=e0(e);if(!ew(t)||ez.includes(t.toUpperCase().trim()))return!1;let{range:r}=eZ(t);return!(r.endColumn>=16384)}function e0(e){let t=[],r=!1;for(let a=0,n=e.length;a<n;a++){let n=e[a];if(" "!==n||r){if(!r&&(n===en.AT||n===en.MINUS||n===en.PLUS))continue;t.push(n),r=!0}else t.push(n)}return t.join("")}function e1(e,t){let r=(null==e?void 0:e.split(","))||[];return""===e||0===r.length?[]:e2(e)?r.map(e=>{let r=eZ(e);return{unitId:r.unitId,sheetId:t(r.sheetName),range:r.range,sheetName:r.sheetName}}):[]}function e2(e){return((null==e?void 0:e.split(","))||[]).every(e=>eJ(e.trim()))}function e3(e){return 0!==e.length&&!!(el(e)||e5(e)||e4(e)||e6(e)||/[\s!$%^&*()+\-=\[\]{};':"\\|,.<>\/?]/.test(e))}function e5(e){let t=e.match(/[1-9][0-9]{0,6}/);return/^[A-Z]+[1-9][0-9]{0,6}$/.test(e)&&null!==t}function e4(e){return/^(R(-?[0-9]+)?C(-?[0-9]+)?|C(-?[0-9]+)?|R(-?[0-9]+)?)$/.test(e)}function e6(e){return!RegExp("^\\p{Letter}","u").test(e.charAt(0))}B(eJ,"isReferenceStringWithEffectiveColumn"),B(e0,"replaceRefPrefixString"),B(e1,"getRangeWithRefsString"),B(e2,"isReferenceStrings"),B(e3,"needsQuoting"),B(e5,"isA1Notation"),B(e4,"isR1C1Notation"),B(e6,"startsWithNonAlphabetic");var e9,e7=Object.defineProperty,e8=Object.getOwnPropertyDescriptor,te=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?e8(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&e7(t,r,i),i},"__decorateClass$n"),tt=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$n");let tr=(B(e9=class extends P.Disposable{constructor(e){super(),k(this,"_definedNameMap",{}),k(this,"_update$",new L.Subject),k(this,"update$",this._update$.asObservable()),k(this,"_currentRange",{unitId:"",sheetId:"",range:{startRow:0,endRow:0,startColumn:0,endColumn:0}}),k(this,"_currentRange$",new L.Subject),k(this,"currentRange$",this._currentRange$.asObservable()),k(this,"_focusRange$",new L.Subject),k(this,"focusRange$",this._focusRange$.asObservable()),this._univerInstanceService=e}dispose(){this._definedNameMap={}}getWorksheetByRef(e,t){var r;let{sheetName:a}=eK(t);return null==(r=this._univerInstanceService.getUnit(e))?void 0:r.getSheetBySheetName(a)}focusRange(e,t){let r=this.getValueById(e,t);null!=r&&this._focusRange$.next({...r,unitId:e})}setCurrentRange(e){this._currentRange=e,this._currentRange$.next(e)}getCurrentRange(){return this._currentRange}getCurrentRangeForString(){return eG(this._currentRange.range)}registerDefinedNames(e,t){this._definedNameMap[e]=t,this._update()}registerDefinedName(e,t){null==this._definedNameMap[e]&&(this._definedNameMap[e]={}),this._definedNameMap[e][t.id]=t,this._update()}removeDefinedName(e,t){var r;null==(r=this._definedNameMap[e])||delete r[t],this._update()}removeUnitDefinedName(e){delete this._definedNameMap[e],this._update()}getDefinedNameMap(e){return this._definedNameMap[e]}getValueByName(e,t){var r;let a=this._definedNameMap[e];return null==a?null:null==(r=Array.from(Object.values(a)).filter(e=>e.name===t))?void 0:r[0]}getValueById(e,t){var r;return null==(r=this._definedNameMap[e])?void 0:r[t]}hasDefinedName(e){return null!=this._definedNameMap[e]&&0!==(Array.from(Object.values(this._definedNameMap[e])).length||0)}_update(){this._update$.next(null)}},"DefinedNamesService"),e9);tr=te([tt(0,P.IUniverInstanceService)],tr);let ta=(0,P.createIdentifier)("univer.formula.defined-names.service"),tn=/* @__PURE__ */B((e,t)=>{let{unitId:r,id:a}=t;return{...e.get(ta).getValueById(r,a),unitId:r}},"SetDefinedNameMutationFactory"),ti={id:"formula.mutation.set-defined-name",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},ts={id:"formula.mutation.remove-defined-name",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tl={id:"formula.mutation.set-feature-calculation",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tu={id:"formula.mutation.remove-feature-calculation",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},to={id:"formula.mutation.set-formula-calculation-start",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tc={id:"formula.mutation.set-formula-calculation-stop",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},th={id:"formula.mutation.set-formula-calculation-notification",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tm={id:"formula.mutation.set-formula-calculation-result",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tf={id:"formula.mutation.set-formula-data",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B((e,t)=>!0,"handler")},tg={id:"formula.mutation.set-other-formula",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},td={id:"formula.mutation.remove-other-formula",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tN={id:"formula.mutation.set-super-table",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},t_={id:"formula.mutation.remove-super-table",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tC={id:"formula.mutation.set-super-table-option",type:P.CommandType.MUTATION,handler:/* @__PURE__ */B(()=>!0,"handler")},tE=class{constructor(e){k(this,"_cache"),this._cache=new P.LRUMap(e)}set(e,t){let r=this._hash(e);this._cache.set(r,t)}get(e){let t=this._hash(e);return this._cache.get(t)}clear(){this._cache.clear()}_hash(e){return e.length<=64?e:(0,P.hashAlgorithm)(e).toString()}};B(tE,"FormulaAstLRU");let tp="LR_1",tA="LO_1",tb="LAMBDA",ty=/* @__PURE__ */new Set(["RAND","RANDBETWEEN","NOW","TODAY"]),tR=new tE(1e5);function tS(e){let t=tR.get(e);if(t)return t;let r=eZ(e);return tR.set(e,r),eZ(e)}function tO(){tR.clear()}B(tS,"deserializeRangeWithSheetWithCache"),B(tO,"clearReferenceToRangeCache");var tT=((g=tT||{})[g.NORMAL=0]="NORMAL",g[g.NUMBER=1]="NUMBER",g[g.STRING=2]="STRING",g[g.FUNCTION=3]="FUNCTION",g[g.REFERENCE=4]="REFERENCE",g[g.ARRAY=5]="ARRAY",g[g.DEFINED_NAME=6]="DEFINED_NAME",g);function tV(e){let t="";for(let r of e)"string"==typeof r?t+=r:t+=r.token;return t}B(tV,"generateStringWithSequence");let tI=class e{constructor(){k(this,"_parent"),k(this,"_token","R_1"),k(this,"_children",[]),k(this,"_lambdaId"),k(this,"_functionDefinitionPrivacyVar"),k(this,"_lambdaParameter",""),k(this,"_startIndex",-1),k(this,"_endIndex",-1),k(this,"_definedNames",[])}dispose(){var e;this._children.forEach(e=>{"string"!=typeof e&&e.dispose()}),null==(e=this._functionDefinitionPrivacyVar)||e.clear(),this._parent=null}getDefinedNames(){return this._definedNames}getStartIndex(){return this._startIndex}getLambdaId(){return this._lambdaId}setLambdaId(e){this._lambdaId=e}getFunctionDefinitionPrivacyVar(){return this._functionDefinitionPrivacyVar}setLambdaPrivacyVar(e){this._functionDefinitionPrivacyVar=e}getLambdaParameter(){return this._lambdaParameter}setLambdaParameter(e){this._lambdaParameter=e}getParent(){return this._parent}setParent(e){this._parent=e}getChildren(){return this._children}setChildren(e){this._children=e}addChildren(e){this._children.push(e)}addChildrenFirst(e){this._children.unshift(e)}getToken(){return this._token}setToken(e){this._token=e}setIndex(e,t){this._startIndex=e,this._endIndex=t}setDefinedNames(e){this._definedNames=e}hasDefinedNames(){return this._definedNames.length>0}replaceChild(e,t){let r=this._getIndexInParent(e);null!=r&&(this.getChildren().splice(r,1,t),t.setParent(this))}changeToParent(e){let t=this.getParent();t&&t.removeChild(this),this.setParent(e),e.getChildren().push(this)}removeChild(e){let t=this._getIndexInParent(e);null!=t&&this.getChildren().splice(t,1)}serialize(){let t=this.getToken(),r=this.getChildren(),a=[],n=r.length;for(let t=0;t<n;t++){let n=r[t];n instanceof e?a.push(n.serialize()):a.push(n)}return{token:t,st:this._startIndex,ed:this._endIndex,children:a}}_getIndexInParent(e){let t=this.getChildren(),r=t.length;for(let a=0;a<r;a++)if(t[a]===e)return a}};B(tI,"LexerNode");let tM=new tE(1e5),tx=new tE(1e5),tv=class extends P.Disposable{constructor(){super(...arguments),k(this,"_currentLexerNode",new tI),k(this,"_upLevel",0),k(this,"_segment",""),k(this,"_bracketState",[]),k(this,"_squareBracketState",0),k(this,"_bracesState",0),k(this,"_singleQuotationState",0),k(this,"_doubleQuotationState",0),k(this,"_lambdaState",!1),k(this,"_colonState",!1),k(this,"_formulaErrorCount",0),k(this,"_tableBracketState",!1)}dispose(){this._resetTemp(),this._currentLexerNode.dispose(),tM.clear(),tx.clear()}getUpLevel(){return this._upLevel}isColonClose(){return!1===this._colonState}isColonOpen(){return!0===this._colonState}isDoubleQuotationClose(){return 0===this._doubleQuotationState}isLambdaOpen(){return!0===this._lambdaState}isLambdaClose(){return!1===this._lambdaState}isSingleQuotationClose(){return 0===this._singleQuotationState}isBracesClose(){return 0===this._bracesState}isBracketClose(){return 0===this._bracketState.length}isSquareBracketClose(){return 0===this._squareBracketState}getCurrentLexerNode(){return this._currentLexerNode}getFunctionAndParameter(e,t){let r=this._getCurrentParamIndex(e,t);if(null==r||r===q.VALUE)return;let a=r[0];if("string"==typeof a)return;let n=a.getParent(),i=a;for(;n;){let e=n.getToken();if("P_1"!==e&&!es(e)&&-1!==n.getStartIndex())return{functionName:e,paramIndex:n.getChildren().indexOf(i)};i=n,n=n.getParent()}}checkIfAddBracket(e){let t=0,r=e.length-1,a=e[r];for(;(a===et.CLOSE_BRACKET||" "===a)&&r>=0;)a===et.CLOSE_BRACKET&&t++,a=e[--r];let n=this._getCurrentParamIndex(e,e.length-2);if(null==n||n===q.VALUE)return 0;let i=n[0];if("string"==typeof i)return 0;let s=i.getParent(),l=0;for(n[1]===et.OPEN_BRACKET&&l++;s;){let e=s.getToken();"P_1"!==e&&e!==et.COLON&&-1!==s.getStartIndex()&&e.toUpperCase()!==tb&&(0===t?l+=1:t--),s=s.getParent()}return l}sequenceNodesBuilder(e){let t=tx.get(e);if(t)return[...t];let r=this._getSequenceArray(e);if(0===r.length)return;let a=this.getSequenceNode(r);return tx.set(e,[...a]),a}convertRefersToAbsolute(e,t,r){let a=this.sequenceNodesBuilder(e);if(null==a)return e;let n="";e.substring(0,1)===K.EQUALS&&(n=K.EQUALS);for(let e=0,n=a.length;e<n;e++){let i=a[e];if("string"!=typeof i&&i.nodeType===tT.REFERENCE){let{token:s,endIndex:l}=i,u=tS(s);if(null==u)continue;let{range:o,sheetName:c,unitId:h}=u,m=eQ({range:{...o,startAbsoluteRefType:t,endAbsoluteRefType:r},unitId:h,sheetName:c}),f=m.length-s.length;a[e]={...i,token:m,endIndex:l+f};for(let t=e+1;t<n;t++){let e=a[t];"string"!=typeof e&&(e.startIndex+=f,e.endIndex+=f)}}}return`${n}${tV(a)}`}moveFormulaRefOffset(e,t,r,a=!1){let n=this.sequenceNodesBuilder(e);if(null==n)return e;let i=[];for(let e=0,s=n.length;e<s;e++){let s=n[e];if("string"==typeof s||s.nodeType!==tT.REFERENCE){i.push(s);continue}let{token:l}=s,u=tS(l),{sheetName:o,unitId:c}=u,h=u.range;if(a||h.startAbsoluteRefType!==P.AbsoluteRefType.ALL||h.endAbsoluteRefType!==P.AbsoluteRefType.ALL)h=(0,P.moveRangeByOffset)(h,t,r,a);else{i.push(s);continue}let m="";m=(0,P.isValidRange)(h)?eQ({range:h,unitId:c,sheetName:o}):q.REF,i.push({...s,token:m})}return`=${tV(i)}`}_formulaSpellCheck(){if(0===this._currentLexerNode.getChildren().length)return!0;let e=this._currentLexerNode.getChildren()[0];return!!(e instanceof tI||J.has(e)||ea.has(e)||e===en.AT||e===et.COMMA||e===et.COLON||e===et.OPEN_BRACKET)}getSequenceNode(e){let t=[],r=!1;for(let a=0,n=e.length;a<n;a++){let i=e[a],s=e[a-1],{segment:l,currentString:u}=i;if(u===et.DOUBLE_QUOTATION&&(r=!0),(""!==l||0===a)&&a!==n-1){t.push(u);continue}let o=(null==s?void 0:s.segment)||"",c=a-o.length,h=a-1,m=a-1;if(a===n-1&&this._isLastMergeString(u)&&(o+=u,h+=1),""===o||z.has(o)){t.push(u);continue}let f=o.trim(),g=e0(f);!0===r&&f[f.length-1]===et.DOUBLE_QUOTATION&&f[0]!==et.OPEN_BRACES?(r=!1,this._processPushSequenceNode(t,tT.STRING,o,c,h,m)):eM(g)&&eJ(g)?this._processPushSequenceNode(t,tT.REFERENCE,o,c,h,m):(0,P.Tools).isStringNumber(f)?this._processPushSequenceNode(t,tT.NUMBER,o,c,h,m):f.length>0&&this._processPushSequenceNode(t,tT.FUNCTION,o,c,h,m),a===n-1&&this._isLastMergeString(u)||t.push(u)}return this._mergeSequenceNodeReference(t)}_processPushSequenceNode(e,t,r,a,n,i){this._pushSequenceNode(e,{nodeType:t,token:r,startIndex:a,endIndex:n},i)}_getCurrentParamIndex(e,t){return this._nodeMaker(e,void 0,t)}_isLastMergeString(e){return e===et.DOUBLE_QUOTATION||(0,P.Tools).isStringNumber(e)||!es(e)}_mergeSequenceNodeReference(e){let t=[],r=e.length,a=0;for(;a<r;){let r=e[a];if("string"==typeof r){let n=e[a-1];if(r.trim()===et.CLOSE_BRACES&&null!=n&&"string"!=typeof n&&n.nodeType===tT.FUNCTION&&n.token.trim().substring(0,1)===et.OPEN_BRACES){n.nodeType=tT.ARRAY,n.token+=r,n.endIndex+=r.length,a++;continue}t.push(r)}else{let n=e[a+1],i=e[a+2];n===et.COLON&&"string"!=typeof r&&null!=i&&"string"!=typeof i&&eJ((r.token+n+i.token).trim())&&(r.nodeType=tT.REFERENCE,r.token+=n+i.token,r.endIndex=i.endIndex,a+=2),t.push(r)}a++}return this._minusSplitSequenceNode(t)}_minusSplitSequenceNode(e){let t=[];for(let r of e){if("string"!=typeof r){let e=r.token.match(/^(\s*([-@+]\s*)+)(.*)$/);if(e){let a=e[1],n=e[3];if(eJ(n.trim())){let e=a.length,i=r.startIndex,s=r.startIndex+e-1,l={nodeType:tT.NORMAL,token:a,startIndex:i,endIndex:s},u={nodeType:tT.REFERENCE,token:n,startIndex:s+1,endIndex:r.endIndex};t.push(l),t.push(u);continue}}}t.push(r)}return t}_pushSequenceNode(e,t,r){let a=r-t.startIndex+1;e.splice(e.length-a,a,t)}nodeMakerTest(e){return this._nodeMaker(e)}treeBuilder(e,t=!0,r,a){if(!0===t){let t=tM.get(e),r=null==a?void 0:a(e);if(t&&!r)return t}this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1");let n=[],i=this._nodeMaker(e,n);if(i===q.VALUE||0===n.length)return i;let s=!1,l="",u=[];if(r){let{hasDefinedName:e,sequenceString:t,definedNames:a}=r(n);s=e,l=t,u=a}if(s&&(this._resetCurrentLexerNode(),this._currentLexerNode.setToken("R_1"),(i=this._nodeMaker(`=${l}`))===q.VALUE))return i;let o=this._getTopNode(this._currentLexerNode);if(o&&(this._currentLexerNode=o),t){if(!this._suffixExpressionHandler(this._currentLexerNode))return q.VALUE;tM.set(e,this._currentLexerNode)}return s&&this._currentLexerNode.setDefinedNames(u),this._currentLexerNode}_suffixExpressionHandler(e){var t;let r=e.getChildren();if(!r)return!1;let a=r.length,n=[],i=[],s=!0;for(let e=0;e<a;e++){let a=r[e];if(a instanceof tI)s=this._suffixExpressionHandler(a),n.push(a);else{let s=a.trim();if(""===s)continue;if(J.has(s)){if(s===K.PLUS&&this._deletePlusForPreNode(r[e-1]))continue;if(s!==K.PLUS&&s!==K.MINUS&&this._deletePlusForPreNode(r[e-1]))return!1;for(;i.length>0;){let e=null==(t=i[i.length-1])?void 0:t.trim();if(!e||e===et.OPEN_BRACKET)break;let r=z.get(e),a=z.get(s);if(!r||!a)break;if(a>=r)n.push(i.pop());else break}i.push(a)}else if(s===et.OPEN_BRACKET)i.push(a);else if(s===et.CLOSE_BRACKET)this._processSuffixExpressionCloseBracket(n,i,r,e);else{if(this._checkCloseBracket(r[e-1]))return!1;n.push(a)}}}return!!s&&this._processSuffixExpressionRemain(n,i,e)}_processSuffixExpressionRemain(e,t,r){let a=e.length,n=e[a-1];for(;t.length>0;){let r=t.pop();if(!(n instanceof tI)&&(r===et.OPEN_BRACKET||r===et.CLOSE_BRACKET))return!1;e.push(r)}return r.setChildren(e),!0}_processSuffixExpressionCloseBracket(e,t,r,a){var n;if(this._checkOpenBracket(r[a-1])||this._checkOperator(r[a-1]))return!1;for(;t.length>0;){let r=null==(n=t[t.length-1])?void 0:n.trim();if(!r)break;if(r===et.OPEN_BRACKET){t.pop();break}e.push(t.pop())}}_checkCloseBracket(e){return e===et.CLOSE_BRACKET||e instanceof tI}_checkOpenBracket(e){return e===et.OPEN_BRACKET}_checkOperator(e){return null!=e&&!(e instanceof tI)&&J.has(e)}_deletePlusForPreNode(e){if(null==e)return!0;if(!(e instanceof tI)){let t=e.trim();if(J.has(t)||t===et.OPEN_BRACKET)return!0}return!1}_resetCurrentLexerNode(){this._currentLexerNode=new tI}_resetSegment(){this._segment=""}_openBracket(e=0){this._bracketState.push(e)}_closeBracket(){this._bracketState.pop()}_openSquareBracket(){this._squareBracketState+=1}_closeSquareBracket(){this._squareBracketState-=1}_getCurrentBracket(){let e=this._bracketState;return e[e.length-1]}_changeCurrentBracket(e){let t=this._bracketState;t[t.length-1]=e}_openBraces(){this._bracesState+=1}_closeBraces(){this._bracesState-=1}_openSingleQuotation(){this._singleQuotationState+=1}_closeSingleQuotation(){this._singleQuotationState-=1}_openDoubleQuotation(){this._doubleQuotationState+=1}_closeDoubleQuotation(){this._doubleQuotationState-=1}_openLambda(){this._lambdaState=!0}_closeLambda(){this._lambdaState=!1}_openColon(e){this._upLevel=e,this._colonState=!0}_closeColon(){this._upLevel=0,this._colonState=!1}_isTableBracket(){return this._tableBracketState}_openTableBracket(){this._tableBracketState=!0}_closeTableBracket(){this._tableBracketState=!1}_formalErrorOccurred(){this._formulaErrorCount+=1}_hasFormalError(){return this._formulaErrorCount>0}_getLastChildCurrentLexerNode(){let e=this._currentLexerNode.getChildren();if(e&&e.length>0){let t=e[e.length-1];if(t instanceof tI)return t}return!1}_getLastChildCurrent(){let e=this._currentLexerNode.getChildren();return!!e&&e.length>0&&e[e.length-1]}_setParentCurrentLexerNode(){let e=this._currentLexerNode.getParent();return!!e&&(this._currentLexerNode=e,!0)}_setAncestorCurrentLexerNode(){var e,t,r,a,n,i;let s=null==(e=this._currentLexerNode)?void 0:e.getParent(),l=!1;if(s&&"L_1"===s.getToken()){if(null!=(t=null==s?void 0:s.getParent())&&t.getParent()){let e=null==(a=null==(r=this._currentLexerNode.getParent())?void 0:r.getParent())?void 0:a.getParent();e&&(this._currentLexerNode=e),l=!0}}else if(null!=s&&s.getParent()){let e=null==(n=this._currentLexerNode.getParent())?void 0:n.getParent();e&&(this._currentLexerNode=e),l=!0}for(let e=0;e<this._upLevel;e++){let e=null==(i=this._currentLexerNode)?void 0:i.getParent();e&&(this._currentLexerNode=e),l=!!this._currentLexerNode}return l}_segmentCount(){return this._segment.trim().length}_pushSegment(e){this._segment+=e}_pushNodeToChildren(e,t=!1){let r=e;if(""!==r){let e=this._currentLexerNode.getChildren();if(!(r instanceof tI)&&this.isColonOpen()){let e=new tI;e.setToken(r),e.setParent(this._currentLexerNode),r=e}t?e.unshift(r):e.push(r)}this.isColonOpen()&&(this._setAncestorCurrentLexerNode(),this._closeColon())}_setCurrentLexerNode(e,t=!1){this._pushNodeToChildren(e,t),e.setParent(this._currentLexerNode),this._currentLexerNode=e}_newAndPushCurrentLexerNode(e,t,r=!1){let a=new tI;a.setToken(e),a.setIndex(t-e.length,t-1),this._setCurrentLexerNode(a,r)}_getTopNode(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}_removeLastChild(){this._currentLexerNode.getChildren().splice(-1)}_formulaErrorLastTokenCheck(e,t){let r=this._findPreviousToken(e,t)||"",a=e.length-1===t;if(!a&&this._isOperatorToken(r)||a&&eh(r))return!0;if(ea.has(r)){let r=this._findSecondLastNonSpaceToken(e,t);if(null==r||ef(r))return!0}return!1}_findPreviousToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r--}}_findSecondLastNonSpaceToken(e,t){let r=t,a=0;for(;r>=0;){let t=e[r];if(" "!==t&&2==++a)return t;r--}return null}_findNextToken(e,t){let r=t;for(;r>=0;){let t=e[r];if(" "!==t)return t;r++}}_unexpectedEndingTokenExcludeOperator(e){return e===et.OPEN_BRACKET||e===et.COMMA||e===K.EQUALS||""===e}_unexpectedEndingToken(e){return!!(this._isOperatorToken(e)||this._unexpectedEndingTokenExcludeOperator(e))}_isOperatorToken(e){return!!J.has(e)}_getSequenceArray(e){let t=[];return this._nodeMaker(e,t),t}_resetTemp(){this._currentLexerNode=new tI,this._upLevel=0,this._segment="",this._bracketState=[],this._bracesState=0,this._singleQuotationState=0,this._doubleQuotationState=0,this._lambdaState=!1,this._colonState=!1,this._formulaErrorCount=0}_checkErrorState(){return!!(this._bracketState.length>0||this._bracesState>0||this._singleQuotationState>0||this._doubleQuotationState>0||this._hasFormalError())}_checkSimilarErrorToken(e,t,r){let a=t;if(e!==er.POUND)return!0;let n=r[++a];for(;" "===n;)n=r[++a];return!!es(n)}_checkIfErrorObject(e,t){return!!this._findErrorObject(e,t)}_findErrorObject(e,t){for(let r=0;r<Q.length;r++){let a=Q[r],n=t.slice(e,e+a).join("").toUpperCase();if(W.has(n))return n}}_nodeMaker(e,t,r){let a=e.replace(/\r\n$/,"").replace(/\r/g," ").replace(/\n/g," ");a.substring(0,1)===K.EQUALS&&(a=a.substring(1));let n=a.split(""),i=n.length,s=0;for(this._resetTemp(),this._formulaErrorLastTokenCheck(n,i-1)&&this._formalErrorOccurred();s<i;){let e=n[s];if(r===s)return[this._currentLexerNode,e];if(e===er.POUND&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()&&this._checkIfErrorObject(s,n)){let e=this._findErrorObject(s,n);if(null==e)return q.VALUE;this._pushNodeToChildren(e);for(let r=0;r<e.length;r++){let e=n[s];this._pushSegment(e),this._addSequenceArray(t,e,s),s++}this._resetSegment();continue}if(e===et.OPEN_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._segmentCount()>0||this.isLambdaOpen()){this.isLambdaClose()&&(this._newAndPushCurrentLexerNode(this._segment,s),this._resetSegment()),this._openBracket(1),this._closeLambda();let r=n[s+1];if(r&&r===et.CLOSE_BRACKET){if(!this._setParentCurrentLexerNode()&&s!==i-1)return q.VALUE;this._addSequenceArray(t,e,s),s++,this._addSequenceArray(t,r,s),s++,this._closeBracket();continue}r&&this._newAndPushCurrentLexerNode("P_1",s)}else this._pushNodeToChildren(e),this._openBracket(0),this._resetSegment()}else if(e===et.CLOSE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){this._formulaErrorLastTokenCheck(n,s-1)&&this._formalErrorOccurred(),this._pushNodeToChildren(this._segment),this._resetSegment();let t=this._getCurrentBracket();if(0===t)this._pushNodeToChildren(e);else{if(1!==t)return q.VALUE;let e=n[s+1];if(e&&e===et.OPEN_BRACKET){if(!this._setParentCurrentLexerNode()&&s!==i-1)return q.VALUE;this._newAndPushCurrentLexerNode("L_1",s,!0),this._openLambda()}else if(!this._setAncestorCurrentLexerNode()&&s!==i-1)return q.VALUE}this._closeBracket()}else if(e===et.OPEN_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()){if(this._pushSegment(e),this._openBraces(),!this._formulaSpellCheck())return q.VALUE}else if(e===et.CLOSE_BRACES&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._pushSegment(e),this._pushNodeToChildren(this._segment),this._resetSegment(),this._closeBraces();else if(e===et.OPEN_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._segment.length>0&&this._openTableBracket(),this._pushSegment(e),this._openSquareBracket();else if(e===et.CLOSE_SQUARE_BRACKET&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose())this._closeSquareBracket(),this.isSquareBracketClose()?(this._pushSegment(e),this._isTableBracket()&&(this._pushNodeToChildren(this._segment),this._resetSegment()),this._closeTableBracket()):this._pushSegment(e);else if(e===et.DOUBLE_QUOTATION&&this.isSingleQuotationClose()&&this.isSquareBracketClose()){if(this.isDoubleQuotationClose())this._openDoubleQuotation();else{let e=n[s+1];e&&e===et.DOUBLE_QUOTATION?s++:this._closeDoubleQuotation()}this._pushSegment(e)}else if(e===et.SINGLE_QUOTATION&&this.isDoubleQuotationClose()){if(this.isSingleQuotationClose())this._openSingleQuotation();else{let e=n[s+1];e&&e===et.SINGLE_QUOTATION?s++:this._closeSingleQuotation()}this._pushSegment(e)}else if(e===et.COMMA&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){this._formulaErrorLastTokenCheck(n,s-1)&&this._formalErrorOccurred();let e=this._getCurrentBracket();if(1===e||null==e){if(this._pushNodeToChildren(this._segment),this._resetSegment(),!this._setParentCurrentLexerNode()&&s!==i-1&&null!=e)return q.VALUE;this._newAndPushCurrentLexerNode("P_1",s)}else{let e=new tI;e.setToken("CUBE");let t=new tI;t.setToken("P_1"),t.changeToParent(e);let r=this._currentLexerNode.getParent();if(!r||r.getToken()!==et.COLON)return q.VALUE;{let a=r.getParent();if(!a)return q.VALUE;r.changeToParent(t),a.setChildren([]),e.changeToParent(a)}this._changeCurrentBracket(1),this._pushNodeToChildren(this._segment),this._resetSegment(),this._currentLexerNode=e,this._newAndPushCurrentLexerNode("P_1",s)}}else if(e===et.COLON&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isBracesClose()&&this.isSquareBracketClose()){let t=new tI;t.setToken(e);let r=new tI;r.setToken("P_1"),r.setParent(t);let a=new tI;a.setToken("P_1"),a.setParent(t),t.getChildren().push(r,a);let n=t,i=0;if(this._segmentCount()>0){let e,a,s=0,l=this._segment.trim(),u=l[0],o=l[1];if(u===en.MINUS&&((e=new tI).setToken(en.MINUS),s++),(u===en.AT||o===en.AT)&&((a=new tI).setToken(en.AT),e&&(e.addChildren(a),a.setParent(e)),s++),s>0&&(this._segment=l.slice(s)),i=s,a){if(a.addChildren(t),t.setParent(a),a.getParent()){let e=a.getParent();e&&(n=e)}else n=a}else e&&(n=e,e.addChildren(t),t.setParent(e));let c=new tI;c.setToken(this._segment),c.setParent(r),r.getChildren().push(c),this._resetSegment()}else{let e=this._getLastChildCurrentLexerNode();e&&e.changeToParent(r)}this._setCurrentLexerNode(n),this._currentLexerNode=a,this._openColon(i)}else if(ea.has(e)&&this._checkSimilarErrorToken(e,s,n)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){this._pushNodeToChildren(this._segment);let t=new tI;t.setToken(e);let r=this._getLastChildCurrent();r instanceof tI?r.changeToParent(t):!1!==r&&(t.getChildren().push(r),this._removeLastChild()),this._pushNodeToChildren(t),t.setParent(this._currentLexerNode),this._resetSegment()}else if(J.has(e)&&this.isSingleQuotationClose()&&this.isDoubleQuotationClose()&&this.isSquareBracketClose()&&this.isBracesClose()){let r=this._segment.trim();if(e===K.MINUS&&""===r){let r=this._findPreviousToken(n,s-1)||"",a=this._findNextToken(n,s+1)||"";if(this._unexpectedEndingTokenExcludeOperator(r)&&this._isOperatorToken(a)){this._pushNodeToChildren("0"),this._pushNodeToChildren(K.MINUS),this._addSequenceArray(t,e,s),this._resetSegment(),s++;continue}if(this._unexpectedEndingToken(r)){if(a===K.PLUS){this._pushSegment(K.MINUS),this._addSequenceArray(t,e,s),this._addSequenceArray(t,K.PLUS,s+1),s+=2;continue}this._pushSegment(K.MINUS),this._addSequenceArray(t,e,s),s++;continue}}else if(this._segment.length>0&&this._isScientificNotation(n,s,e)){this._pushSegment(e),this._addSequenceArray(t,e,s),s++;continue}else this._segment.length>0&&""===r?r=this._segment:(this._pushNodeToChildren(this._segment),r="");if(e===K.LESS_THAN||e===K.GREATER_THAN){let a=n[s+1];if(a&&J.has(e+a)){this._pushNodeToChildren(r+e+a),this._resetSegment(),this._addSequenceArray(t,e,s),s++,this._addSequenceArray(t,a,s),s++;continue}this._pushNodeToChildren(r+e)}else this._pushNodeToChildren(r+e);this._resetSegment()}else this._pushSegment(e);this._addSequenceArray(t,e,s),s++}if(this._pushNodeToChildren(this._segment),this._checkErrorState())return q.VALUE}_isScientificNotation(e,t,r){let a=e[t-2];if(a&&Number.isNaN(Number(a))||!(r===K.MINUS||r===K.PLUS))return!1;let n=e[t+1];if(n&&Number.isNaN(Number(n)))return!1;let i=e[t-1];return i&&"E"===i.toUpperCase()}_addSequenceArray(e,t,r){null==e||e.push({segment:this._segment,currentString:t,cur:r,currentLexerNode:this._currentLexerNode})}};B(tv,"LexerTreeBuilder");let tU=tv;function tD(e,t,r,a,n,i,s){let l=(null==s?void 0:s.f)||"",u=(null==s?void 0:s.si)||"",o=(0,P.isFormulaString)(l),c=(0,P.isFormulaId)(u),h=e.getValue(n,i),m=(null==h?void 0:h.f)||"",f=(null==h?void 0:h.si)||"";function g(){var e;if((0,P.isFormulaString)(m)&&(0,P.isFormulaId)(f)){let t=null==(e=r.get(f))?void 0:e.f;t?a.set(f,t):a.set(f,m)}}B(g,"clearFormulaData"),o&&c?(f!==u&&g(),e.setValue(n,i,{f:l,si:u}),r.set(u,{f:l,r:n,c:i}),t.setValue(n,i,{f:l,si:u})):o&&!c?(m!==l&&g(),e.setValue(n,i,{f:l}),t.setValue(n,i,{f:l})):!o&&c?(f!==u&&g(),e.setValue(n,i,{f:"",si:u})):!o&&!c&&e.getValue(n,i)&&(g(),e.realDeleteValue(n,i),t.setValue(n,i,null))}function tP(e,t,r,a){let n=null==e?void 0:e.getValue(r,a);if(null==n)return!0;let i=[];e.forValue((e,t,s)=>{e===r&&t===a||(0,P.Rectangle).intersects(s,n)&&i.push(s)});let{startRow:s,startColumn:l,endRow:u,endColumn:o}=n;for(let e=s;e<=u;e++)for(let r=l;r<=o;r++){let a=!1,n=(0,P.cellToRange)(e,r);i.some(e=>!!(0,P.Rectangle).contains(e,n)&&(a=!0,!0)),a||t.realDeleteValue(e,r)}}B(tD,"updateFormulaDataByCellValue"),B(tP,"clearArrayFormulaCellDataByCell");var tL,tw=Object.defineProperty,tF=Object.getOwnPropertyDescriptor,tj=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?tF(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&tw(t,r,i),i},"__decorateClass$m"),tB=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$m");let tk=(B(tL=class extends P.Disposable{constructor(e,t){super(),k(this,"_formulaData",{}),k(this,"_arrayFormulaRange",{}),k(this,"_arrayFormulaCellData",{}),this._univerInstanceService=e,this._lexerTreeBuilder=t,this.initFormulaData()}dispose(){super.dispose(),this._formulaData={},this._arrayFormulaRange={},this._arrayFormulaCellData={}}clearPreviousArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{var a,n,i,s;let l=r[e],u=null==(n=null==(a=this._arrayFormulaRange)?void 0:a[t])?void 0:n[e];if(null==u)return!0;let o=new P.ObjectMatrix(u),c=new P.ObjectMatrix;(null==(i=this._arrayFormulaCellData[t])?void 0:i[e])!=null&&(c=new P.ObjectMatrix(null==(s=this._arrayFormulaCellData[t])?void 0:s[e])),l.forValue((e,t)=>{let r=o.getValue(e,t);if(null==r)return!0;let{startRow:a,startColumn:n,endRow:i,endColumn:s}=r;for(let e=a;e<=i;e++)for(let t=n;t<=s;t++)c.setValue(e,t,null);o.realDeleteValue(e,t)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=c.getData())})})}mergeArrayFormulaCellData(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;null==this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t]={}),null==this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t]={}),Object.keys(r).forEach(e=>{var a,n;let i=r[e],s=new P.ObjectMatrix(null==(a=this._arrayFormulaRange[t])?void 0:a[e]),l=new P.ObjectMatrix(null==(n=this._arrayFormulaCellData[t])?void 0:n[e]);i.forValue((e,t)=>{let r=null==s?void 0:s.getValue(e,t);if(null==r)return!0;let{startRow:a,startColumn:n,endRow:i,endColumn:u}=r;for(let e=a;e<=i;e++)for(let t=n;t<=u;t++)l.setValue(e,t,null)}),i.forValue((e,t,r)=>{l.setValue(e,t,r)}),this._arrayFormulaCellData[t]&&(this._arrayFormulaCellData[t][e]=l.getData())})})}getFormulaData(){return this._formulaData}setFormulaData(e){this._formulaData=e}getArrayFormulaRange(){return this._arrayFormulaRange}setArrayFormulaRange(e){this._arrayFormulaRange=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}mergeArrayFormulaRange(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;this._arrayFormulaRange[t]||(this._arrayFormulaRange[t]={}),Object.keys(r).forEach(e=>{var a;let n=new P.ObjectMatrix(r[e]),i=new P.ObjectMatrix(null==(a=this._arrayFormulaRange[t])?void 0:a[e]);n.forValue((e,t,r)=>{i.setValue(e,t,r)}),this._arrayFormulaRange[t]&&(this._arrayFormulaRange[t][e]=i.getData())})})}mergeFormulaData(e){Object.keys(e).forEach(t=>{let r=e[t];if(void 0!==r){if(null===r){delete this._formulaData[t];return}this._formulaData[t]||(this._formulaData[t]={}),Object.keys(r).forEach(e=>{var a,n;let i=r[e];if(void 0===i)return;if(null===i){null==(a=this._formulaData[t])||delete a[e];return}let s=new P.ObjectMatrix(i),l=new P.ObjectMatrix((null==(n=this._formulaData[t])?void 0:n[e])||{});s.forValue((e,t,r)=>{null==r?l.realDeleteValue(e,t):l.setValue(e,t,r)}),this._formulaData[t][e]=l.clone()})}})}deleteArrayFormulaRange(e,t,r,a){var n;let i=null==(n=this._arrayFormulaRange[e])?void 0:n[t];if(null==i)return;let s=new P.ObjectMatrix(i);s.getValue(r,a)&&(s.realDeleteValue(r,a),this._arrayFormulaRange[e]&&(this._arrayFormulaRange[e][t]=s.getData()))}initFormulaData(){if(0===this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET).length)return;let e=this._univerInstanceService.getCurrentUnitForType(P.UniverInstanceType.UNIVER_SHEET),t=e.getUnitId();this._formulaData[t]={},e.getSheets().forEach(e=>{let r=e.getCellMatrix(),a=e.getSheetId();t$(this._formulaData,t,a,r)})}getCalculateData(){let e=this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET),t={},r={};for(let a of e){let e=a.getUnitId(),n=a.getSheets(),i={},s={};for(let e of n){let t=e.getSheetId(),r=e.getConfig();i[t]={cellData:new P.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},s[e.getName()]=e.getSheetId()}t[e]=i,r[e]=s}return{allUnitData:t,unitSheetNameMap:r}}updateFormulaData(e,t,r){let a=new P.ObjectMatrix(r),n=this.getFormulaIdMap(e,t),i=/* @__PURE__ */new Map,s=this._formulaData;null==s[e]&&(s[e]={});let l=s[e];null==l[t]&&(l[t]={});let u=new P.ObjectMatrix(l[t]||{}),o=new P.ObjectMatrix;return a.forValue((e,t,r)=>{tD(u,o,n,i,e,t,r)}),u.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"";if((0,P.isFormulaId)(s)){let l=n.get(s),c=i.get(s);if(l&&!(0,P.isFormulaString)(a)){let r=l.f,a=t-l.c,n=e-l.r;u.setValue(e,t,{f:r,si:s,x:a,y:n}),o.setValue(e,t,{f:r,si:s,x:a,y:n})}else if("string"==typeof c){let a=(null==r?void 0:r.x)||0,n=(null==r?void 0:r.y)||0,l=this._lexerTreeBuilder.moveFormulaRefOffset(c,a,n);i.set(s,{r:e,c:t,f:l}),u.setValue(e,t,{f:l,si:s}),o.setValue(e,t,{f:l,si:s})}else if("object"==typeof c){let r=t-c.c,a=e-c.r;u.setValue(e,t,{f:c.f,si:s,x:r,y:a}),o.setValue(e,t,{f:c.f,si:s,x:r,y:a})}}}),o.clone()}updateArrayFormulaRange(e,t,r){var a;let n=null==(a=this._arrayFormulaRange[e])?void 0:a[t];if(!n)return;let i=new P.ObjectMatrix(n);new(0,P.ObjectMatrix)(r).forValue((e,t,r)=>{i.realDeleteValue(e,t)})}updateArrayFormulaCellData(e,t,r){var a,n;let i=null==(a=this._arrayFormulaRange[e])?void 0:a[t];if(!i)return;let s=new P.ObjectMatrix(i),l=null==(n=this._arrayFormulaCellData[e])?void 0:n[t];if(!l)return;let u=new P.ObjectMatrix(l);new(0,P.ObjectMatrix)(r).forValue((e,t,r)=>{tP(s,u,e,t)})}getFormulaItemBySId(e,t,r){let a=this._formulaData;if(null==a[r])return null;let n=a[r];if((null==n?void 0:n[t])==null)return null;let i=new P.ObjectMatrix(n[t]||{}),s=null;return i.forValue((t,r,a)=>{if(null==a)return!0;let{f:n,si:i,x:l=0,y:u=0}=a;if(i===e&&n.length>0&&0===l&&0===u)return s=a,!1}),s}getFormulaDataItem(e,t,r,a){var n,i,s,l;return null==(l=null==(s=null==(i=null==(n=this._formulaData)?void 0:n[a])?void 0:i[r])?void 0:s[e])?void 0:l[t]}getFormulaIdMap(e,t){let r=/* @__PURE__ */new Map,a=this._formulaData;if(null==a[e])return r;let n=a[e];return(null==n?void 0:n[t])==null||new(0,P.ObjectMatrix)(n[t]||{}).forValue((e,t,a)=>{let n=(null==a?void 0:a.f)||"",i=(null==a?void 0:a.si)||"",s=(null==a?void 0:a.x)||0,l=(null==a?void 0:a.y)||0;(0,P.isFormulaString)(n)&&(0,P.isFormulaId)(i)&&0===s&&0===l&&r.set(i,{f:n,r:e,c:t})}),r}getFormulaStringByCell(e,t,r,a){let n=this.getFormulaDataItem(e,t,r,a);if(null==n)return null;let{f:i,si:s,x:l=0,y:u=0}=n;if(null!=s&&(0!==l||0!==u)){let e="";if(i.length>0)e=i;else{let t=this.getFormulaItemBySId(s,r,a);if(null==t||0===t.f.length)return null;e=t.f}return this._lexerTreeBuilder.moveFormulaRefOffset(e,l,u)}return(0,P.isFormulaString)(i)?i:null}},"FormulaDataModel"),tL);function t$(e,t,r,a){let n=/* @__PURE__ */new Map,i=new P.ObjectMatrix;a.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"",l=(0,P.isFormulaString)(a),u=(0,P.isFormulaId)(s);l&&u?(i.setValue(e,t,{f:a,si:s}),n.set(s,{f:a,r:e,c:t})):l&&!u?i.setValue(e,t,{f:a}):!l&&u&&i.setValue(e,t,{f:"",si:s})}),i.forValue((e,t,r)=>{let a=(null==r?void 0:r.f)||"",s=(null==r?void 0:r.si)||"";if((0,P.isFormulaId)(s)&&!(0,P.isFormulaString)(a)){let r=n.get(s);if(r){let a=r.f,n=t-r.c,l=e-r.r;i.setValue(e,t,{f:a,si:s,x:n,y:l})}else i.realDeleteValue(e,t)}}),e[t]||(e[t]={});let s=i.clone();return e[t][r]=s,{[t]:{[r]:s}}}tk=tj([tB(0,P.IUniverInstanceService),tB(1,(0,P.Inject)(tU))],tk),B(t$,"initSheetFormulaData");let tY=(B(tK=class{constructor(e,t){this.low=e,this.high=t}clone(){return new tK(this.low,this.high)}get max(){return this.clone()}less_than(e){return this.low<e.low||this.low===e.low&&this.high<e.high}equal_to(e){return this.low===e.low&&this.high===e.high}intersect(e){return!this.not_intersect(e)}not_intersect(e){return this.high<e.low||e.high<this.low}merge(e){return new tK(void 0===this.low?e.low:this.low<e.low?this.low:e.low,void 0===this.high?e.high:this.high>e.high?this.high:e.high)}output(){return[this.low,this.high]}static comparable_max(e,t){return e.merge(t)}static comparable_less_than(e,t){return e<t}},"Interval"),tK),tH=class{constructor(e,t,r=null,a=null,n=null,i=1){if(this.left=r,this.right=a,this.parent=n,this.color=i,this.item={key:e,value:t},e&&e instanceof Array&&2===e.length&&!Number.isNaN(e[0])&&!Number.isNaN(e[1])){let[t,r]=e;t>r&&([t,r]=[r,t]),this.item.key=new tY(t,r)}this.max=this.item.key?this.item.key.max:void 0}isNil(){return void 0===this.item.key&&void 0===this.item.value&&null===this.left&&null===this.right&&1===this.color}_value_less_than(e){return this.item.value&&e.item.value&&this.item.value.less_than?this.item.value.less_than(e.item.value):this.item.value<e.item.value}less_than(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.less_than(e.item.key):this.item.key.less_than(e.item.key)||this.item.key.equal_to(e.item.key)&&this._value_less_than(e)}_value_equal(e){return this.item.value&&e.item.value&&this.item.value.equal_to?this.item.value.equal_to(e.item.value):this.item.value===e.item.value}equal_to(e){return this.item.value===this.item.key&&e.item.value===e.item.key?this.item.key.equal_to(e.item.key):this.item.key.equal_to(e.item.key)&&this._value_equal(e)}intersect(e){return this.item.key.intersect(e.item.key)}copy_data(e){this.item.key=e.item.key,this.item.value=e.item.value}update_max(){if(this.max=this.item.key?this.item.key.max:void 0,this.right&&this.right.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.right.max)}if(this.left&&this.left.max){let e=this.item.key.constructor.comparable_max;this.max=e(this.max,this.left.max)}}not_intersect_left_subtree(e){return(0,this.item.key.constructor.comparable_less_than)(void 0!==this.left.max.high?this.left.max.high:this.left.max,e.item.key.low)}not_intersect_right_subtree(e){let t=this.item.key.constructor.comparable_less_than,r=void 0!==this.right.max.low?this.right.max.low:this.right.item.key.low;return t(e.item.key.high,r)}};B(tH,"Node");let tG=class e{constructor(){this.root=null,this.nil_node=new tH}get size(){let e=0;return this.tree_walk(this.root,()=>e++),e}get keys(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.key.output?t.item.key.output():t.item.key)),e}get values(){let e=[];return this.tree_walk(this.root,t=>e.push(t.item.value)),e}get items(){let e=[];return this.tree_walk(this.root,t=>e.push({key:t.item.key.output?t.item.key.output():t.item.key,value:t.item.value})),e}isEmpty(){return null==this.root||this.root===this.nil_node}clear(){this.root=null}insert(e,t=e){if(void 0===e)return;let r=new tH(e,t,this.nil_node,this.nil_node,null,0);return this.tree_insert(r),this.recalc_max(r),r}exist(e,t=e){let r=new tH(e,t);return!!this.tree_search(this.root,r)}remove(e,t=e){let r=new tH(e,t),a=this.tree_search(this.root,r);return a&&this.tree_delete(a),a}search(e,t=(e,t)=>e===t?t.output():e){let r=new tH(e),a=[];return this.tree_search_interval(this.root,r,a),a.map(e=>t(e.item.value,e.item.key))}intersect_any(e){let t=new tH(e);return this.tree_find_any_interval(this.root,t)}forEach(e){this.tree_walk(this.root,t=>e(t.item.key,t.item.value))}map(t){let r=new e;return this.tree_walk(this.root,e=>r.insert(e.item.key,t(e.item.value,e.item.key))),r}*iterate(e,t=(e,t)=>e===t?t.output():e){let r;for(e?r=this.tree_search_nearest_forward(this.root,new tH(e)):this.root&&(r=this.local_minimum(this.root));r;)yield t(r.item.value,r.item.key),r=this.tree_successor(r)}recalc_max(e){let t=e;for(;null!=t.parent;)t.parent.update_max(),t=t.parent}tree_insert(e){let t=this.root,r=null;if(null==this.root||this.root===this.nil_node)this.root=e;else{for(;t!==this.nil_node;)r=t,t=e.less_than(t)?t.left:t.right;e.parent=r,e.less_than(r)?r.left=e:r.right=e}this.insert_fixup(e)}insert_fixup(e){let t,r;for(t=e;t!==this.root&&0===t.parent.color;)t.parent===t.parent.parent.left?0===(r=t.parent.parent.right).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.right&&(t=t.parent,this.rotate_left(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_right(t.parent.parent)):0===(r=t.parent.parent.left).color?(t.parent.color=1,r.color=1,t.parent.parent.color=0,t=t.parent.parent):(t===t.parent.left&&(t=t.parent,this.rotate_right(t)),t.parent.color=1,t.parent.parent.color=0,this.rotate_left(t.parent.parent));this.root.color=1}tree_delete(e){let t,r;(r=(t=e.left===this.nil_node||e.right===this.nil_node?e:this.tree_successor(e)).left!==this.nil_node?t.left:t.right).parent=t.parent,t===this.root?this.root=r:(t===t.parent.left?t.parent.left=r:t.parent.right=r,t.parent.update_max()),this.recalc_max(r),t!==e&&(e.copy_data(t),e.update_max(),this.recalc_max(e)),1===t.color&&this.delete_fixup(r)}delete_fixup(e){let t=e,r;for(;t!==this.root&&null!=t.parent&&1===t.color;)t===t.parent.left?(0===(r=t.parent.right).color&&(r.color=1,t.parent.color=0,this.rotate_left(t.parent),r=t.parent.right),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.right.color&&(r.color=0,r.left.color=1,this.rotate_right(r),r=t.parent.right),r.color=t.parent.color,t.parent.color=1,r.right.color=1,this.rotate_left(t.parent),t=this.root)):(0===(r=t.parent.left).color&&(r.color=1,t.parent.color=0,this.rotate_right(t.parent),r=t.parent.left),1===r.left.color&&1===r.right.color?(r.color=0,t=t.parent):(1===r.left.color&&(r.color=0,r.right.color=1,this.rotate_left(r),r=t.parent.left),r.color=t.parent.color,t.parent.color=1,r.left.color=1,this.rotate_right(t.parent),t=this.root));t.color=1}tree_search(e,t){if(!(null==e||e===this.nil_node))return t.equal_to(e)?e:t.less_than(e)?this.tree_search(e.left,t):this.tree_search(e.right,t)}tree_search_nearest_forward(e,t){let r,a=e;for(;a&&a!==this.nil_node;)a.less_than(t)?a.intersect(t)?(r=a,a=a.left):a=a.right:((!r||a.less_than(r))&&(r=a),a=a.left);return r||null}tree_search_interval(e,t,r){null==e||e===this.nil_node||(e.left===this.nil_node||e.not_intersect_left_subtree(t)||this.tree_search_interval(e.left,t,r),e.intersect(t)&&r.push(e),e.right===this.nil_node||e.not_intersect_right_subtree(t)||this.tree_search_interval(e.right,t,r))}tree_find_any_interval(e,t){let r=!1;return null==e||e===this.nil_node||(e.left===this.nil_node||e.not_intersect_left_subtree(t)||(r=this.tree_find_any_interval(e.left,t)),r||(r=e.intersect(t)),r||e.right===this.nil_node||e.not_intersect_right_subtree(t)||(r=this.tree_find_any_interval(e.right,t))),r}local_minimum(e){let t=e;for(;null!=t.left&&t.left!==this.nil_node;)t=t.left;return t}local_maximum(e){let t=e;for(;null!=t.right&&t.right!==this.nil_node;)t=t.right;return t}tree_successor(e){let t,r,a;if(e.right!==this.nil_node)t=this.local_minimum(e.right);else{for(r=e,a=e.parent;null!=a&&a.right===r;)r=a,a=a.parent;t=a}return t}rotate_left(e){let t=e.right;e.right=t.left,t.left!==this.nil_node&&(t.left.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,null!=e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}rotate_right(e){let t=e.left;e.left=t.right,t.right!==this.nil_node&&(t.right.parent=e),t.parent=e.parent,e===this.root?this.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.right=e,e.parent=t,null!==e&&e!==this.nil_node&&e.update_max(),null!=(t=e.parent)&&t!==this.nil_node&&t.update_max()}tree_walk(e,t){null!=e&&e!==this.nil_node&&(this.tree_walk(e.left,t),t(e),this.tree_walk(e.right,t))}testRedBlackProperty(){let e=!0;return this.tree_walk(this.root,function(t){0===t.color&&(1===t.left.color&&1===t.right.color||(e=!1))}),e}testBlackHeightProperty(e){let t=0,r=0;if(1===e.color&&t++,(r=e.left!==this.nil_node?this.testBlackHeightProperty(e.left):1)!==(e.right!==this.nil_node?this.testBlackHeightProperty(e.right):1))throw Error("Red-black height property violated");return t+r}};B(tG,"IntervalTree");let tq=class{constructor(){k(this,"_cache",/* @__PURE__ */new Map),k(this,"_continueBuildingCache",/* @__PURE__ */new Map)}set(e,t,r,a,n){if(!this.shouldContinueBuildingCache(e,t,r,n))return;let i=this._cache.get(e);null==i&&(i=/* @__PURE__ */new Map,this._cache.set(e,i));let s=i.get(t);null==s&&(s=/* @__PURE__ */new Map,i.set(t,s));let l=s.get(r);null==l&&(l=/* @__PURE__ */new Map,s.set(r,l));let u=l.get(a);null==u&&(u=/* @__PURE__ */new Set,l.set(a,u)),u.add(n)}getCellValuePositions(e,t,r){var a,n;return null==(n=null==(a=this._cache.get(e))?void 0:a.get(t))?void 0:n.get(r)}getCellPositions(e,t,r,a,n){var i,s,l;let u=null==(l=null==(s=null==(i=this._cache.get(e))?void 0:i.get(t))?void 0:s.get(r))?void 0:l.get(a);return u&&[...u].filter(e=>n.some(([t,r])=>e>=t&&e<=r))}setContinueBuildingCache(e,t,r,a,n){if(-1===r||-1===a||-1===n)return;let i=this._continueBuildingCache.get(e);null==i&&(i=/* @__PURE__ */new Map,this._continueBuildingCache.set(e,i));let s=i.get(t);null==s&&(s=/* @__PURE__ */new Map,i.set(t,s));let l=s.get(r);if(null==l){(l=new tG).insert([a,n]),s.set(r,l);return}this._handleNewInterval(l,a,n)}shouldContinueBuildingCache(e,t,r,a){var n,i;let s=null==(i=null==(n=this._continueBuildingCache.get(e))?void 0:n.get(t))?void 0:i.get(r);return!s||0===s.search([a,a]).length}canUseCache(e,t,r,a,n){var i,s;let l=null==(s=null==(i=this._continueBuildingCache.get(e))?void 0:i.get(t))?void 0:s.get(r);if(-1===r||-1===a||-1===n||!l)return{rowsInCache:[],rowsNotInCache:[]};let u=l.search([a,n]);if(0===u.length)return{rowsInCache:[],rowsNotInCache:[]};u.sort((e,t)=>e[0]-t[0]);let o=[],c=[],h=a;for(let e of u){let[t,r]=e;if(h>=t){if(n<=r){o.push([h,n]);break}o.push([h,r]),h=r+1}else{if(n>r){o.push([t,r]),c.push([h,t-1]),h=r+1;continue}o.push([t,n]),c.push([h,t-1])}}return{rowsInCache:o,rowsNotInCache:c}}clear(){this._cache.clear(),this._continueBuildingCache.clear()}_handleNewInterval(e,t,r){let a=e.search([t,r]);if(0===a.length){let n=[t-1<0?0:t-1,r+1];if(0===(a=e.search(n)).length){e.insert([t,r]);return}}let n=t,i=r;for(let t of a)n=Math.min(n,t[0]),i=Math.max(i,t[1]),e.remove(t);e.insert([n,i])}};B(tq,"InvertedIndexCache");let tW=new tq,tQ="engine-formula.config",tX={};var tK,tZ,tz=Object.defineProperty,tJ=Object.getOwnPropertyDescriptor,t0=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?tJ(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&tz(t,r,i),i},"__decorateClass$l"),t1=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$l");let t2=(B(tZ=class extends P.Disposable{constructor(e,t){super(),k(this,"_unitData",{}),k(this,"_unitStylesData",{}),k(this,"_arrayFormulaCellData",{}),k(this,"_arrayFormulaRange",{}),k(this,"_formulaData",{}),k(this,"_sheetNameMap",{}),k(this,"_forceCalculate",!1),k(this,"_clearDependencyTreeCache",{}),k(this,"_dirtyRanges",[]),k(this,"_dirtyNameMap",{}),k(this,"_dirtyDefinedNameMap",{}),k(this,"_dirtyUnitFeatureMap",{}),k(this,"_dirtyUnitOtherFormulaMap",{}),k(this,"_excludedCell"),k(this,"_sheetIdToNameMap",{}),k(this,"_executeUnitId",""),k(this,"_executeSubUnitId",""),this._univerInstanceService=e,this._localeService=t}dispose(){this._unitData={},this._unitStylesData={},this._formulaData={},this._arrayFormulaCellData={},this._arrayFormulaRange={},this._sheetNameMap={},this._dirtyRanges=[],this._dirtyNameMap={},this._dirtyDefinedNameMap={},this._dirtyUnitFeatureMap={},this._excludedCell={},this._sheetIdToNameMap={},this._dirtyUnitOtherFormulaMap={}}getExecuteUnitId(){return this._executeUnitId}getExecuteSubUnitId(){return this._executeSubUnitId}setExecuteUnitId(e){this._executeUnitId=e}setExecuteSubUnitId(e){this._executeSubUnitId=e}getExcludedRange(){return this._excludedCell}getUnitData(){return this._unitData}getUnitStylesData(){return this._unitStylesData}getFormulaData(){return this._formulaData}getArrayFormulaCellData(){return this._arrayFormulaCellData}getArrayFormulaRange(){return this._arrayFormulaRange}getSheetNameMap(){return this._sheetNameMap}isForceCalculate(){return this._forceCalculate}getDirtyRanges(){return this._dirtyRanges}getDirtyNameMap(){return this._dirtyNameMap}getDirtyDefinedNameMap(){return this._dirtyDefinedNameMap}getDirtyUnitFeatureMap(){return this._dirtyUnitFeatureMap}getDirtyUnitOtherFormulaMap(){return this._dirtyUnitOtherFormulaMap}getSheetName(e,t){return null==this._sheetIdToNameMap[e]?"":this._sheetIdToNameMap[e][t]||""}getClearDependencyTreeCache(){return this._clearDependencyTreeCache}getLocale(){return this._localeService.getCurrentLocale()}getSheetsInfo(){let{id:e,sheetOrder:t}=this._univerInstanceService.getCurrentUnitForType(P.UniverInstanceType.UNIVER_SHEET).getSnapshot();return{sheetOrder:t,sheetNameMap:this._sheetIdToNameMap[e]}}load(e){if(e.allUnitData&&e.unitSheetNameMap&&e.unitStylesData)this._unitData=e.allUnitData,this._unitStylesData=e.unitStylesData,this._sheetNameMap=e.unitSheetNameMap;else{let{allUnitData:e,unitSheetNameMap:t,unitStylesData:r}=this._loadSheetData();this._unitData=e,this._unitStylesData=r,this._sheetNameMap=t}this._formulaData=e.formulaData,this._arrayFormulaCellData=eg(e.arrayFormulaCellData),this._arrayFormulaRange=e.arrayFormulaRange,this._forceCalculate=e.forceCalculate,this._clearDependencyTreeCache=e.clearDependencyTreeCache||{},this._dirtyRanges=e.dirtyRanges,this._dirtyNameMap=e.dirtyNameMap,this._dirtyDefinedNameMap=e.dirtyDefinedNameMap,this._dirtyUnitFeatureMap=e.dirtyUnitFeatureMap,this._dirtyUnitOtherFormulaMap=e.dirtyUnitOtherFormulaMap,this._excludedCell=e.excludedCell,this._mergeNameMap(this._sheetNameMap,this._dirtyNameMap)}getDirtyData(){return{forceCalculation:this._forceCalculate,dirtyRanges:this._dirtyRanges,dirtyNameMap:this._dirtyNameMap,dirtyDefinedNameMap:this._dirtyDefinedNameMap,dirtyUnitFeatureMap:this._dirtyUnitFeatureMap,dirtyUnitOtherFormulaMap:this._dirtyUnitOtherFormulaMap,clearDependencyTreeCache:this._clearDependencyTreeCache}}loadDirtyRangesAndExcludedCell(e,t){this._dirtyRanges=e,this._excludedCell=t,this._dirtyNameMap={}}registerUnitData(e){this._unitData=e}registerFormulaData(e){this._formulaData=e}registerSheetNameMap(e){this._sheetNameMap=e}_mergeNameMap(e,t){Object.keys(t).forEach(r=>{t[r]&&Object.keys(t[r]).forEach(a=>{null==e[r]&&(e[r]={}),e[r][t[r][a]]=a})}),this._sheetIdToNameMap={},Object.keys(e).forEach(t=>{Object.keys(e[t]).forEach(r=>{null==this._sheetIdToNameMap[t]&&(this._sheetIdToNameMap[t]={}),this._sheetIdToNameMap[t][e[t][r]]=r})})}_loadSheetData(){let e=this._univerInstanceService.getAllUnitsForType(P.UniverInstanceType.UNIVER_SHEET),t=this._univerInstanceService.getCurrentUnitForType(P.UniverInstanceType.UNIVER_SHEET),r=null==t?void 0:t.getActiveSheet();this._executeUnitId=null==t?void 0:t.getUnitId(),this._executeSubUnitId=null==r?void 0:r.getSheetId();let a={},n={},i={};for(let t of e){let e=t.getUnitId(),r=t.getSheets(),s={},l={};for(let e of r){let t=e.getSheetId(),r=e.getConfig();s[t]={cellData:new P.ObjectMatrix(r.cellData),rowCount:r.rowCount,columnCount:r.columnCount,rowData:r.rowData,columnData:r.columnData,defaultRowHeight:r.defaultRowHeight,defaultColumnWidth:r.defaultColumnWidth},l[e.getName()]=e.getSheetId()}a[e]=s,n[e]=t.getStyles(),i[e]=l}return{allUnitData:a,unitStylesData:n,unitSheetNameMap:i}}},"FormulaCurrentConfigService"),tZ);t2=t0([t1(0,P.IUniverInstanceService),t1(1,(0,P.Inject)(P.LocaleService))],t2);let t3=(0,P.createIdentifier)("univer.formula.current-data.service");var t5,t4=Object.defineProperty,t6=Object.getOwnPropertyDescriptor,t9=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?t6(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&t4(t,r,i),i},"__decorateClass$k"),t7=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$k");let t8=(B(t5=class extends P.Disposable{constructor(e,t,r){super(),this._definedNamesService=e,this._lexerTreeBuilder=t,this._formulaCurrentConfigService=r}treeBuilder(e,t=!0){return this._lexerTreeBuilder.treeBuilder(e,t,this._injectDefinedName.bind(this),this._simpleCheckDefinedName.bind(this))}_simpleCheckDefinedName(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++){let r=a[t];if(e.indexOf(r)>-1)return!0}}return!1}_checkDefinedNameDirty(e){let t=this._formulaCurrentConfigService.getDirtyDefinedNameMap(),r=this._formulaCurrentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++)if(a[t]===e)return!0}return!1}_injectDefinedName(e){let t=this._formulaCurrentConfigService.getExecuteUnitId();if(null==t)return{sequenceString:"",hasDefinedName:!1,definedNames:[]};let r=this._lexerTreeBuilder.getSequenceNode(e),a="",n=!1,i=[];for(let e=0,s=r.length;e<s;e++){let s=r[e];if("string"==typeof s){a+=s;continue}let{nodeType:l,token:u}=s;if(l===tT.REFERENCE||l===tT.FUNCTION){let e=this._definedNamesService.getValueByName(t,u);if(e){let t=e.formulaOrRefString;t.substring(0,1)===K.EQUALS&&(t=t.substring(1)),a+=t,i.push(e.name),n=!0}else this._checkDefinedNameDirty(u)?(a+=q.NAME,n=!0,i.push(u)):a+=u}else a+=u}return{sequenceString:a,hasDefinedName:n,definedNames:i}}},"Lexer"),t5);function re(e,t,r,a,n){var i;for(let s of Object.keys(n)){let l=n[s],u=null==(i=null==l?void 0:l[a])?void 0:i[r];if(null==u)continue;let o=u.getValue(e,t);if(null!=o)return o}}t8=t9([t7(0,ta),t7(1,(0,P.Inject)(tU)),t7(2,t3)],t8),B(re,"getRuntimeFeatureCell");let rt=["$","","","","","","","","","","","","","","","","","","","","","","","","","",""],rr={currency:2,date:4,datetime:5,error:11,fraction:7,general:0,grouped:11,number:1,percent:6,scientific:8,text:9,time:5,unknown:11};function ra(e,t,r){var a,n;if(null==e||null==t)return t;let i=(null==r?void 0:r.getStyleByCell(e))||e.s,s=(null==r?void 0:r.getStyleByCell(t))||t.s;if(null==i||null==s||"object"!=typeof i||"object"!=typeof s)return t;let l=null==(a=null==i?void 0:i.n)?void 0:a.pattern,u=null==(n=null==s?void 0:s.n)?void 0:n.pattern;return null==l||null==u||(s.n.pattern=l||u),t}B(ra,"handleNumfmtInCell");let rn=new tE(1e5);function ri(e){let t=rn.get(e);if(void 0!==t)return t;let r=rl(e);return rn.set(e,r),r}function rs(){rn.clear()}function rl(e){return ru(e)?3:rr[(0,P.numfmt).getInfo(e).type||"unknown"]}function ru(e){return!!rt.find(t=>e.includes(t))&&e.startsWith("_(")}function ro(e,t,r){if(""===e)return t;if(""===t)return e;let a=ri(e),n=ri(t);return r===K.PLUS||r===K.MINUS?4===a&&4===n||11===a&&11===n?"":t:r===K.MULTIPLY||r===K.DIVIDED?6===a&&6===n||7===a&&7===n||8===a&&8===n||9===a&&9===n?t:"":e||t}B(ri,"getNumberFormatType"),B(rs,"clearNumberFormatTypeCache"),B(rl,"getNumberFormatTypeRaw"),B(ru,"isAccounting"),B(ro,"comparePatternPriority");let rc=/* @__PURE__ */new Map([[P.LocaleType.EN_US,"$"],[P.LocaleType.RU_RU,""],[P.LocaleType.VI_VN,""],[P.LocaleType.ZH_CN,""],[P.LocaleType.ZH_TW,"NT$"]]);function rh(e){return rc.get(e)||"$"}function rm(e,t=2){let r=t;t>127&&(r=127);let a="";return r>0&&(a=`.${"0".repeat(r)}`),`"${rh(e)}"#,##0${a}_);[Red]("${rh(e)}"#,##0${a})`}function rf(e,t,r=2){return(0,P.numfmt).format(rm(e,r),t)}B(rh,"getCurrencySymbol"),B(rm,"getCurrencyFormat"),B(rf,"applyCurrencyFormat");let rg=new tE(1e5);function rd(e){let t=e;t.startsWith('"')&&t.endsWith('"')&&(t=t.slice(1,-1));let r=rg.get(t);if(r)return{isNumberPattern:!0,value:r.value,pattern:r.pattern};let a=(0,P.numfmt).parseNumber(t);if(a)return rN(t,a.v,a.z);let n=(0,P.numfmt).parseDate(t);if(n)return rN(t,n.v,n.z);let i=(0,P.numfmt).parseTime(t);return i?rN(t,i.v,i.z):{isNumberPattern:!1}}function rN(e,t,r){return rg.set(e,{value:t,pattern:r}),{isNumberPattern:!0,value:t,pattern:r}}function r_(){rg.clear()}B(rd,"stringIsNumberPattern"),B(rN,"setNumberPatternCache"),B(r_,"clearStringToNumberPatternCache");let rC=class{constructor(){k(this,"pattern","")}dispose(){}getPattern(){return this.pattern}setPattern(e){this.pattern=e}isError(){return!1}isAsyncObject(){return!1}isAsyncArrayObject(){return!1}isReferenceObject(){return!1}isArray(){return!1}isValueObject(){return!1}isEqualType(e){return!1}};B(rC,"ObjectClassType");let rE=rC,rp=class extends rE{constructor(e){super(),this._rawValue=e}isValueObject(){return!0}toUnitRange(){return{range:{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1},sheetId:"",unitId:""}}getValue(){return 0}getArrayValue(){return[]}setValue(e){}setArrayValue(e){}isCube(){return!1}isString(){return!1}isNumber(){return!1}isBoolean(){return!1}isLambda(){return!1}isError(){return!1}isNull(){return!1}sum(){return rR.create(q.VALUE)}max(){return rR.create(q.VALUE)}min(){return rR.create(q.VALUE)}count(){return rR.create(q.VALUE)}countA(){return rR.create(q.VALUE)}countBlank(){return rR.create(q.VALUE)}getNegative(){return rR.create(q.VALUE)}getReciprocal(){return rR.create(q.VALUE)}plus(e){return rR.create(q.VALUE)}minus(e){return rR.create(q.VALUE)}multiply(e){return rR.create(q.VALUE)}divided(e){return rR.create(q.VALUE)}mod(e){return rR.create(q.VALUE)}map(e){return rR.create(q.NAME)}mapValue(e){return rR.create(q.NAME)}compare(e,t,r=!1){return rR.create(q.NAME)}isEqual(e){return this.compare(e,Z.EQUALS)}isNotEqual(e){return this.compare(e,Z.NOT_EQUAL)}isGreaterThanOrEqual(e){return this.compare(e,Z.GREATER_THAN_OR_EQUAL)}isLessThanOrEqual(e){return this.compare(e,Z.LESS_THAN_OR_EQUAL)}isLessThan(e){return this.compare(e,Z.LESS_THAN)}isGreaterThan(e){return this.compare(e,Z.GREATER_THAN)}concatenateFront(e){return rR.create(q.NAME)}concatenateBack(e){return rR.create(q.NAME)}plusBy(e){return rR.create(q.VALUE)}minusBy(e){return rR.create(q.VALUE)}multiplyBy(e){return rR.create(q.VALUE)}dividedBy(e){return rR.create(q.VALUE)}modInverse(e){return rR.create(q.VALUE)}compareBy(e,t){return rR.create(q.NAME)}concatenate(e,t=H.FRONT){let r=this.getValue().toString();if("string"==typeof e)t===H.FRONT?r=e+r:r+=e;else if("number"==typeof e)t===H.FRONT?r=e.toString()+r:r+=e.toString();else if("boolean"==typeof e){let a=e?"TRUE":"FALSE";t===H.FRONT?r=a+r:r+=a}return r}pow(e){return rR.create(q.VALUE)}powInverse(e){return rR.create(q.VALUE)}sqrt(){return rR.create(q.VALUE)}cbrt(){return rR.create(q.VALUE)}cos(){return rR.create(q.VALUE)}cosh(){return rR.create(q.VALUE)}acos(){return rR.create(q.VALUE)}acosh(){return rR.create(q.VALUE)}sin(){return rR.create(q.VALUE)}sinh(){return rR.create(q.VALUE)}asin(){return rR.create(q.VALUE)}asinh(){return rR.create(q.VALUE)}tan(){return rR.create(q.VALUE)}tanh(){return rR.create(q.VALUE)}atan(){return rR.create(q.VALUE)}atan2(e){return rR.create(q.VALUE)}atan2Inverse(e){return rR.create(q.VALUE)}atanh(){return rR.create(q.VALUE)}mean(){return this}median(){return this}var(){return this}std(){return this}log(){return rR.create(q.VALUE)}log10(){return rR.create(q.VALUE)}exp(){return rR.create(q.VALUE)}abs(){return rR.create(q.VALUE)}round(e){return rR.create(q.VALUE)}roundInverse(e){return rR.create(q.VALUE)}floor(e){return rR.create(q.VALUE)}floorInverse(e){return rR.create(q.VALUE)}ceil(e){return rR.create(q.VALUE)}ceilInverse(e){return rR.create(q.VALUE)}convertToNumberObjectValue(){return rR.create(q.VALUE)}convertToBooleanObjectValue(){return rR.create(q.VALUE)}};B(rp,"BaseValueObject");let rA=rp,rb=new tE(1e3),ry=class e extends rA{constructor(e,t=""){super(e),this._errorType=e,this._errorContent=t}static create(t,r=""){let a=`${t}-${r}`,n=rb.get(a);if(n)return n;let i=new e(t,r);return rb.set(a,i),i}getValue(){return this._errorType}getErrorType(){return this._errorType}getErrorContent(){return this._errorContent}isEqualType(e){return e.getErrorType()===this.getErrorType()}isError(){return!0}};B(ry,"ErrorValueObject");let rR=ry;function rS(e){let t;switch(e){case Z.EQUALS:t=Z.EQUALS;break;case Z.GREATER_THAN:t=Z.LESS_THAN;break;case Z.GREATER_THAN_OR_EQUAL:t=Z.LESS_THAN_OR_EQUAL;break;case Z.LESS_THAN:t=Z.GREATER_THAN;break;case Z.LESS_THAN_OR_EQUAL:t=Z.GREATER_THAN_OR_EQUAL;break;case Z.NOT_EQUAL:t=Z.NOT_EQUAL}return t}B(rS,"reverseCompareOperator");var rO=((d=rO||{})[d.MIN=0]="MIN",d[d.MAX=1]="MAX",d),rT=((N=rT||{})[N.NORMAL=0]="NORMAL",N[N.MIN=1]="MIN",N[N.MAX=2]="MAX",N);function rV(){return Intl&&Intl.Collator?new Intl.Collator(void 0,{numeric:!1}).compare:(e,t)=>e.localeCompare(t)}function rI(e){return e.indexOf("*")>-1||e.indexOf("?")>-1}function rM(e,t){let r=rU(t).replace(/~?[*?]/g,e=>e.startsWith("~")?`\\${e.substring(1)}`:"*"===e?".*":"?"===e?".":e);return RegExp(`^${r}$`).test(e)}function rx(e){return e.replace(/~?[*?]/g,e=>e.startsWith("~")?e.substring(1):" ")}function rv(e,t,r){let a=!1;switch(r){case Z.EQUALS:a=rM(e,t);break;case Z.NOT_EQUAL:a=!rM(e,t);break;case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:a=rM(e,t)||e>rx(t);break;case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:a=e<rx(t)}return a}function rU(e){return e.replace(/[.+^${}()|[\]\\]/g,"\\$&")}function rD(e){switch(e){case 1:return 2;case 0:default:return 0;case -1:return 1}}function rP(e){return -2===e?1:0}B(rV,"getCompare"),B(rI,"isWildcard"),B(rM,"isMatchWildcard"),B(rx,"replaceWildcard"),B(rv,"compareWithWildcard"),B(rU,"escapeRegExp"),B(rD,"getMatchModeValue"),B(rP,"getSearchModeValue");/*!
 *  decimal.js v10.4.3
 *  An arbitrary-precision Decimal type for JavaScript.
 *  https://github.com/MikeMcl/decimal.js
 *  Copyright (c) 2022 Michael Mclaughlin <M8ch88l@gmail.com>
 *  MIT Licence
 */var rL,rw,rF="0123456789abcdef",rj="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rB="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rk={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-9e15,maxE:9e15,crypto:!1},r$=!0,rY="[DecimalError] ",rH=rY+"Invalid argument: ",rG=rY+"Precision limit exceeded",rq=rY+"crypto unavailable",rW="[object Decimal]",rQ=Math.floor,rX=Math.pow,rK=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,rZ=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,rz=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,rJ=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,r0=rj.length-1,r1=rB.length-1,r2={toStringTag:rW};function r3(e){var t,r,a,n=e.length-1,i="",s=e[0];if(n>0){for(i+=s,t=1;t<n;t++)(r=7-(a=e[t]+"").length)&&(i+=ai(r)),i+=a;(r=7-(a=(s=e[t])+"").length)&&(i+=ai(r))}else if(0===s)return"0";for(;s%10==0;)s/=10;return i+s}function r5(e,t,r){if(e!==~~e||e<t||e>r)throw Error(rH+e)}function r4(e,t,r,a){var n,i,s,l;for(i=e[0];i>=10;i/=10)--t;return--t<0?(t+=7,n=0):(n=Math.ceil((t+1)/7),t%=7),i=rX(10,7-t),l=e[n]%i|0,null==a?t<3?(0==t?l=l/100|0:1==t&&(l=l/10|0),s=r<4&&99999==l||r>3&&49999==l||5e4==l||0==l):s=(r<4&&l+1==i||r>3&&l+1==i/2)&&(e[n+1]/i/100|0)==rX(10,t-2)-1||(l==i/2||0==l)&&(e[n+1]/i/100|0)==0:t<4?(0==t?l=l/1e3|0:1==t?l=l/100|0:2==t&&(l=l/10|0),s=(a||r<4)&&9999==l||!a&&r>3&&4999==l):s=((a||r<4)&&l+1==i||!a&&r>3&&l+1==i/2)&&(e[n+1]/i/1e3|0)==rX(10,t-3)-1,s}function r6(e,t,r){for(var a,n,i=[0],s=0,l=e.length;s<l;){for(n=i.length;n--;)i[n]*=t;for(i[0]+=rF.indexOf(e.charAt(s++)),a=0;a<i.length;a++)i[a]>r-1&&(void 0===i[a+1]&&(i[a+1]=0),i[a+1]+=i[a]/r|0,i[a]%=r)}return i.reverse()}function r9(e,t){var r,a,n;if(t.isZero())return t;(a=t.d.length)<32?n=(1/aN(4,r=Math.ceil(a/3))).toString():(r=16,n="2.3283064365386962890625e-10"),e.precision+=r,t=ad(e,1,t.times(n),new e(1));for(var i=r;i--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=r,t}r2.absoluteValue=r2.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),r8(e)},r2.ceil=function(){return r8(new this.constructor(this),this.e+1,2)},r2.clampedTo=r2.clamp=function(e,t){var r=this.constructor;if(e=new r(e),t=new r(t),!e.s||!t.s)return new r(NaN);if(e.gt(t))throw Error(rH+t);return 0>this.cmp(e)?e:this.cmp(t)>0?t:new r(this)},r2.comparedTo=r2.cmp=function(e){var t,r,a,n,i=this.d,s=(e=new this.constructor(e)).d,l=this.s,u=e.s;if(!i||!s)return l&&u?l!==u?l:i===s?0:!i^l<0?1:-1:NaN;if(!i[0]||!s[0])return i[0]?l:s[0]?-u:0;if(l!==u)return l;if(this.e!==e.e)return this.e>e.e^l<0?1:-1;for(a=i.length,n=s.length,t=0,r=a<n?a:n;t<r;++t)if(i[t]!==s[t])return i[t]>s[t]^l<0?1:-1;return a===n?0:a>n^l<0?1:-1},r2.cosine=r2.cos=function(){var e,t,r=this,a=r.constructor;return r.d?r.d[0]?(e=a.precision,t=a.rounding,a.precision=e+Math.max(r.e,r.sd())+7,a.rounding=1,r=r9(a,a_(a,r)),a.precision=e,a.rounding=t,r8(2==rw||3==rw?r.neg():r,e,t,!0)):new a(1):new a(NaN)},r2.cubeRoot=r2.cbrt=function(){var e,t,r,a,n,i,s,l,u,o,c=this.constructor;if(!this.isFinite()||this.isZero())return new c(this);for(r$=!1,(i=this.s*rX(this.s*this,1/3))&&Math.abs(i)!=1/0?a=new c(i.toString()):(r=r3(this.d),(i=((e=this.e)-r.length+1)%3)&&(r+=1==i||-2==i?"0":"00"),i=rX(r,1/3),e=rQ((e+1)/3)-(e%3==(e<0?-1:2)),(a=new c(r=i==1/0?"5e"+e:(r=i.toExponential()).slice(0,r.indexOf("e")+1)+e)).s=this.s),s=(e=c.precision)+3;;)if(a=r7((o=(u=(l=a).times(l).times(l)).plus(this)).plus(this).times(l),o.plus(u),s+2,1),r3(l.d).slice(0,s)===(r=r3(a.d)).slice(0,s)){if("9999"!=(r=r.slice(s-3,s+1))&&(n||"4999"!=r)){+r&&(+r.slice(1)||"5"!=r.charAt(0))||(r8(a,e+1,1),t=!a.times(a).times(a).eq(this));break}if(!n&&(r8(l,e+1,0),l.times(l).times(l).eq(this))){a=l;break}s+=4,n=1}return r$=!0,r8(a,e,c.rounding,t)},r2.decimalPlaces=r2.dp=function(){var e,t=this.d,r=NaN;if(t){if(r=((e=t.length-1)-rQ(this.e/7))*7,e=t[e])for(;e%10==0;e/=10)r--;r<0&&(r=0)}return r},r2.dividedBy=r2.div=function(e){return r7(this,new this.constructor(e))},r2.dividedToIntegerBy=r2.divToInt=function(e){var t=this.constructor;return r8(r7(this,new t(e),0,1,1),t.precision,t.rounding)},r2.equals=r2.eq=function(e){return 0===this.cmp(e)},r2.floor=function(){return r8(new this.constructor(this),this.e+1,3)},r2.greaterThan=r2.gt=function(e){return this.cmp(e)>0},r2.greaterThanOrEqualTo=r2.gte=function(e){var t=this.cmp(e);return 1==t||0===t},r2.hyperbolicCosine=r2.cosh=function(){var e,t,r,a,n,i=this,s=i.constructor,l=new s(1);if(!i.isFinite())return new s(i.s?1/0:NaN);if(i.isZero())return l;r=s.precision,a=s.rounding,s.precision=r+Math.max(i.e,i.sd())+4,s.rounding=1,(n=i.d.length)<32?t=(1/aN(4,e=Math.ceil(n/3))).toString():(e=16,t="2.3283064365386962890625e-10"),i=ad(s,1,i.times(t),new s(1),!0);for(var u,o=e,c=new s(8);o--;)u=i.times(i),i=l.minus(u.times(c.minus(u.times(c))));return r8(i,s.precision=r,s.rounding=a,!0)},r2.hyperbolicSine=r2.sinh=function(){var e,t,r,a,n=this,i=n.constructor;if(!n.isFinite()||n.isZero())return new i(n);if(t=i.precision,r=i.rounding,i.precision=t+Math.max(n.e,n.sd())+4,i.rounding=1,(a=n.d.length)<3)n=ad(i,2,n,n,!0);else{e=(e=1.4*Math.sqrt(a))>16?16:0|e,n=ad(i,2,n=n.times(1/aN(5,e)),n,!0);for(var s,l=new i(5),u=new i(16),o=new i(20);e--;)s=n.times(n),n=n.times(l.plus(s.times(u.times(s).plus(o))))}return i.precision=t,i.rounding=r,r8(n,t,r,!0)},r2.hyperbolicTangent=r2.tanh=function(){var e,t,r=this.constructor;return this.isFinite()?this.isZero()?new r(this):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,r7(this.sinh(),this.cosh(),r.precision=e,r.rounding=t)):new r(this.s)},r2.inverseCosine=r2.acos=function(){var e,t=this,r=t.constructor,a=t.abs().cmp(1),n=r.precision,i=r.rounding;return -1!==a?0===a?t.isNeg()?aa(r,n,i):new r(0):new r(NaN):t.isZero()?aa(r,n+4,i).times(.5):(r.precision=n+6,r.rounding=1,t=t.asin(),e=aa(r,n+4,i).times(.5),r.precision=n,r.rounding=i,e.minus(t))},r2.inverseHyperbolicCosine=r2.acosh=function(){var e,t,r=this,a=r.constructor;return r.lte(1)?new a(r.eq(1)?0:NaN):r.isFinite()?(e=a.precision,t=a.rounding,a.precision=e+Math.max(Math.abs(r.e),r.sd())+4,a.rounding=1,r$=!1,r=r.times(r).minus(1).sqrt().plus(r),r$=!0,a.precision=e,a.rounding=t,r.ln()):new a(r)},r2.inverseHyperbolicSine=r2.asinh=function(){var e,t,r=this,a=r.constructor;return!r.isFinite()||r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+2*Math.max(Math.abs(r.e),r.sd())+6,a.rounding=1,r$=!1,r=r.times(r).plus(1).sqrt().plus(r),r$=!0,a.precision=e,a.rounding=t,r.ln())},r2.inverseHyperbolicTangent=r2.atanh=function(){var e,t,r,a,n=this,i=n.constructor;return n.isFinite()?n.e>=0?new i(n.abs().eq(1)?n.s/0:n.isZero()?n:NaN):(e=i.precision,t=i.rounding,Math.max(a=n.sd(),e)<-(2*n.e)-1?r8(new i(n),e,t,!0):(i.precision=r=a-n.e,n=r7(n.plus(1),new i(1).minus(n),r+e,1),i.precision=e+4,i.rounding=1,n=n.ln(),i.precision=e,i.rounding=t,n.times(.5))):new i(NaN)},r2.inverseSine=r2.asin=function(){var e,t,r,a,n=this,i=n.constructor;return n.isZero()?new i(n):(t=n.abs().cmp(1),r=i.precision,a=i.rounding,-1!==t?0===t?((e=aa(i,r+4,a).times(.5)).s=n.s,e):new i(NaN):(i.precision=r+6,i.rounding=1,n=n.div(new i(1).minus(n.times(n)).sqrt().plus(1)).atan(),i.precision=r,i.rounding=a,n.times(2)))},r2.inverseTangent=r2.atan=function(){var e,t,r,a,n,i,s,l,u,o=this,c=o.constructor,h=c.precision,m=c.rounding;if(o.isFinite()){if(o.isZero())return new c(o);if(o.abs().eq(1)&&h+4<=r1)return(s=aa(c,h+4,m).times(.25)).s=o.s,s}else{if(!o.s)return new c(NaN);if(h+4<=r1)return(s=aa(c,h+4,m).times(.5)).s=o.s,s}for(c.precision=l=h+10,c.rounding=1,e=r=Math.min(28,l/7+2|0);e;--e)o=o.div(o.times(o).plus(1).sqrt().plus(1));for(r$=!1,t=Math.ceil(l/7),a=1,u=o.times(o),s=new c(o),n=o;-1!==e;)if(n=n.times(u),i=s.minus(n.div(a+=2)),n=n.times(u),void 0!==(s=i.plus(n.div(a+=2))).d[t])for(e=t;s.d[e]===i.d[e]&&e--;);return r&&(s=s.times(2<<r-1)),r$=!0,r8(s,c.precision=h,c.rounding=m,!0)},r2.isFinite=function(){return!!this.d},r2.isInteger=r2.isInt=function(){return!!this.d&&rQ(this.e/7)>this.d.length-2},r2.isNaN=function(){return!this.s},r2.isNegative=r2.isNeg=function(){return this.s<0},r2.isPositive=r2.isPos=function(){return this.s>0},r2.isZero=function(){return!!this.d&&0===this.d[0]},r2.lessThan=r2.lt=function(e){return 0>this.cmp(e)},r2.lessThanOrEqualTo=r2.lte=function(e){return 1>this.cmp(e)},r2.logarithm=r2.log=function(e){var t,r,a,n,i,s,l,u=this.constructor,o=u.precision,c=u.rounding;if(null==e)e=new u(10),t=!0;else{if(r=(e=new u(e)).d,e.s<0||!r||!r[0]||e.eq(1))return new u(NaN);t=e.eq(10)}if(r=this.d,this.s<0||!r||!r[0]||this.eq(1))return new u(r&&!r[0]?-1/0:1!=this.s?NaN:r?0:1/0);if(t){if(r.length>1)n=!0;else{for(a=r[0];a%10==0;)a/=10;n=1!==a}}if(r$=!1,r4((l=r7(ac(this,s=o+5),t?ar(u,s+10):ac(e,s),s,1)).d,a=o,c))do if(s+=10,l=r7(ac(this,s),t?ar(u,s+10):ac(e,s),s,1),!n){+r3(l.d).slice(a+1,a+15)+1==1e14&&(l=r8(l,o+1,0));break}while(r4(l.d,a+=10,c))return r$=!0,r8(l,o,c)},r2.minus=r2.sub=function(e){var t,r,a,n,i,s,l,u,o,c,h,m,f=this.constructor;if(e=new f(e),!this.d||!e.d)return this.s&&e.s?this.d?e.s=-e.s:e=new f(e.d||this.s!==e.s?this:NaN):e=new f(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.plus(e);if(o=this.d,m=e.d,l=f.precision,u=f.rounding,!o[0]||!m[0]){if(m[0])e.s=-e.s;else{if(!o[0])return new f(3===u?-0:0);e=new f(this)}return r$?r8(e,l,u):e}if(r=rQ(e.e/7),c=rQ(this.e/7),o=o.slice(),i=c-r){for((h=i<0)?(t=o,i=-i,s=m.length):(t=m,r=c,s=o.length),i>(a=Math.max(Math.ceil(l/7),s)+2)&&(i=a,t.length=1),t.reverse(),a=i;a--;)t.push(0);t.reverse()}else{for((h=(a=o.length)<(s=m.length))&&(s=a),a=0;a<s;a++)if(o[a]!=m[a]){h=o[a]<m[a];break}i=0}for(h&&(t=o,o=m,m=t,e.s=-e.s),s=o.length,a=m.length-s;a>0;--a)o[s++]=0;for(a=m.length;a>i;){if(o[--a]<m[a]){for(n=a;n&&0===o[--n];)o[n]=1e7-1;--o[n],o[a]+=1e7}o[a]-=m[a]}for(;0===o[--s];)o.pop();for(;0===o[0];o.shift())--r;return o[0]?(e.d=o,e.e=at(o,r),r$?r8(e,l,u):e):new f(3===u?-0:0)},r2.modulo=r2.mod=function(e){var t,r=this.constructor;return e=new r(e),this.d&&e.s&&(!e.d||e.d[0])?e.d&&(!this.d||this.d[0])?(r$=!1,9==r.modulo?(t=r7(this,e.abs(),0,3,1),t.s*=e.s):t=r7(this,e,0,r.modulo,1),t=t.times(e),r$=!0,this.minus(t)):r8(new r(this),r.precision,r.rounding):new r(NaN)},r2.naturalExponential=r2.exp=function(){return ao(this)},r2.naturalLogarithm=r2.ln=function(){return ac(this)},r2.negated=r2.neg=function(){var e=new this.constructor(this);return e.s=-e.s,r8(e)},r2.plus=r2.add=function(e){var t,r,a,n,i,s,l,u,o,c,h=this.constructor;if(e=new h(e),!this.d||!e.d)return this.s&&e.s?this.d||(e=new h(e.d||this.s===e.s?this:NaN)):e=new h(NaN),e;if(this.s!=e.s)return e.s=-e.s,this.minus(e);if(o=this.d,c=e.d,l=h.precision,u=h.rounding,!o[0]||!c[0])return c[0]||(e=new h(this)),r$?r8(e,l,u):e;if(i=rQ(this.e/7),a=rQ(e.e/7),o=o.slice(),n=i-a){for(n<0?(r=o,n=-n,s=c.length):(r=c,a=i,s=o.length),n>(s=(i=Math.ceil(l/7))>s?i+1:s+1)&&(n=s,r.length=1),r.reverse();n--;)r.push(0);r.reverse()}for((s=o.length)-(n=c.length)<0&&(n=s,r=c,c=o,o=r),t=0;n;)t=(o[--n]=o[n]+c[n]+t)/1e7|0,o[n]%=1e7;for(t&&(o.unshift(t),++a),s=o.length;0==o[--s];)o.pop();return e.d=o,e.e=at(o,a),r$?r8(e,l,u):e},r2.precision=r2.sd=function(e){var t;if(void 0!==e&&!!e!==e&&1!==e&&0!==e)throw Error(rH+e);return this.d?(t=an(this.d),e&&this.e+1>t&&(t=this.e+1)):t=NaN,t},r2.round=function(){var e=this.constructor;return r8(new e(this),this.e+1,e.rounding)},r2.sine=r2.sin=function(){var e,t,r=this,a=r.constructor;return r.isFinite()?r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+Math.max(r.e,r.sd())+7,a.rounding=1,r=ag(a,a_(a,r)),a.precision=e,a.rounding=t,r8(rw>2?r.neg():r,e,t,!0)):new a(NaN)},r2.squareRoot=r2.sqrt=function(){var e,t,r,a,n,i,s=this.d,l=this.e,u=this.s,o=this.constructor;if(1!==u||!s||!s[0])return new o(!u||u<0&&(!s||s[0])?NaN:s?this:1/0);for(r$=!1,0==(u=Math.sqrt(+this))||u==1/0?(((t=r3(s)).length+l)%2==0&&(t+="0"),u=Math.sqrt(t),l=rQ((l+1)/2)-(l<0||l%2),a=new o(t=u==1/0?"5e"+l:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+l)):a=new o(u.toString()),r=(l=o.precision)+3;;)if(a=(i=a).plus(r7(this,i,r+2,1)).times(.5),r3(i.d).slice(0,r)===(t=r3(a.d)).slice(0,r)){if("9999"!=(t=t.slice(r-3,r+1))&&(n||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(r8(a,l+1,1),e=!a.times(a).eq(this));break}if(!n&&(r8(i,l+1,0),i.times(i).eq(this))){a=i;break}r+=4,n=1}return r$=!0,r8(a,l,o.rounding,e)},r2.tangent=r2.tan=function(){var e,t,r=this,a=r.constructor;return r.isFinite()?r.isZero()?new a(r):(e=a.precision,t=a.rounding,a.precision=e+10,a.rounding=1,(r=r.sin()).s=1,r=r7(r,new a(1).minus(r.times(r)).sqrt(),e+10,0),a.precision=e,a.rounding=t,r8(2==rw||4==rw?r.neg():r,e,t,!0)):new a(NaN)},r2.times=r2.mul=function(e){var t,r,a,n,i,s,l,u,o,c=this.constructor,h=this.d,m=(e=new c(e)).d;if(e.s*=this.s,!h||!h[0]||!m||!m[0])return new c(e.s&&(!h||h[0]||m)&&(!m||m[0]||h)?h&&m?0*e.s:e.s/0:NaN);for(r=rQ(this.e/7)+rQ(e.e/7),(u=h.length)<(o=m.length)&&(i=h,h=m,m=i,s=u,u=o,o=s),i=[],a=s=u+o;a--;)i.push(0);for(a=o;--a>=0;){for(t=0,n=u+a;n>a;)l=i[n]+m[a]*h[n-a-1]+t,i[n--]=l%1e7|0,t=l/1e7|0;i[n]=(i[n]+t)%1e7|0}for(;!i[--s];)i.pop();return t?++r:i.shift(),e.d=i,e.e=at(i,r),r$?r8(e,c.precision,c.rounding):e},r2.toBinary=function(e,t){return aC(this,2,e,t)},r2.toDecimalPlaces=r2.toDP=function(e,t){var r=this,a=r.constructor;return r=new a(r),void 0===e?r:(r5(e,0,1e9),void 0===t?t=a.rounding:r5(t,0,8),r8(r,e+r.e+1,t))},r2.toExponential=function(e,t){var r,a=this,n=a.constructor;return void 0===e?r=ae(a,!0):(r5(e,0,1e9),void 0===t?t=n.rounding:r5(t,0,8),r=ae(a=r8(new n(a),e+1,t),!0,e+1)),a.isNeg()&&!a.isZero()?"-"+r:r},r2.toFixed=function(e,t){var r,a,n=this.constructor;return void 0===e?r=ae(this):(r5(e,0,1e9),void 0===t?t=n.rounding:r5(t,0,8),r=ae(a=r8(new n(this),e+this.e+1,t),!1,e+a.e+1)),this.isNeg()&&!this.isZero()?"-"+r:r},r2.toFraction=function(e){var t,r,a,n,i,s,l,u,o,c,h,m,f=this.d,g=this.constructor;if(!f)return new g(this);if(o=r=new g(1),a=u=new g(0),s=(i=(t=new g(a)).e=an(f)-this.e-1)%7,t.d[0]=rX(10,s<0?7+s:s),null==e)e=i>0?t:o;else{if(!(l=new g(e)).isInt()||l.lt(o))throw Error(rH+l);e=l.gt(t)?i>0?t:o:l}for(r$=!1,l=new g(r3(f)),c=g.precision,g.precision=i=14*f.length;h=r7(l,t,0,1,1),1!=(n=r.plus(h.times(a))).cmp(e);)r=a,a=n,n=o,o=u.plus(h.times(n)),u=n,n=t,t=l.minus(h.times(n)),l=n;return n=r7(e.minus(r),a,0,1,1),u=u.plus(n.times(o)),r=r.plus(n.times(a)),u.s=o.s=this.s,m=1>r7(o,a,i,1).minus(this).abs().cmp(r7(u,r,i,1).minus(this).abs())?[o,a]:[u,r],g.precision=c,r$=!0,m},r2.toHexadecimal=r2.toHex=function(e,t){return aC(this,16,e,t)},r2.toNearest=function(e,t){var r=this,a=r.constructor;if(r=new a(r),null==e){if(!r.d)return r;e=new a(1),t=a.rounding}else{if(e=new a(e),void 0===t?t=a.rounding:r5(t,0,8),!r.d)return e.s?r:e;if(!e.d)return e.s&&(e.s=r.s),e}return e.d[0]?(r$=!1,r=r7(r,e,0,t,1).times(e),r$=!0,r8(r)):(e.s=r.s,r=e),r},r2.toNumber=function(){return+this},r2.toOctal=function(e,t){return aC(this,8,e,t)},r2.toPower=r2.pow=function(e){var t,r,a,n,i,s,l=this,u=l.constructor,o=+(e=new u(e));if(!l.d||!e.d||!l.d[0]||!e.d[0])return new u(rX(+l,o));if((l=new u(l)).eq(1))return l;if(a=u.precision,i=u.rounding,e.eq(1))return r8(l,a,i);if((t=rQ(e.e/7))>=e.d.length-1&&(r=o<0?-o:o)<=0x1fffffffffffff)return n=as(u,l,r,a),e.s<0?new u(1).div(n):r8(n,a,i);if((s=l.s)<0){if(t<e.d.length-1)return new u(NaN);if(1&e.d[t]||(s=1),0==l.e&&1==l.d[0]&&1==l.d.length)return l.s=s,l}return(t=0!=(r=rX(+l,o))&&isFinite(r)?new u(r+"").e:rQ(o*(Math.log("0."+r3(l.d))/Math.LN10+l.e+1)))>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(r$=!1,u.rounding=l.s=1,r=Math.min(12,(t+"").length),(n=ao(e.times(ac(l,a+r)),a)).d&&r4((n=r8(n,a+5,1)).d,a,i)&&(t=a+10,+r3((n=r8(ao(e.times(ac(l,t+r)),t),t+5,1)).d).slice(a+1,a+15)+1==1e14&&(n=r8(n,a+1,0))),n.s=s,r$=!0,u.rounding=i,r8(n,a,i))},r2.toPrecision=function(e,t){var r,a=this,n=a.constructor;return void 0===e?r=ae(a,a.e<=n.toExpNeg||a.e>=n.toExpPos):(r5(e,1,1e9),void 0===t?t=n.rounding:r5(t,0,8),r=ae(a=r8(new n(a),e,t),e<=a.e||a.e<=n.toExpNeg,e)),a.isNeg()&&!a.isZero()?"-"+r:r},r2.toSignificantDigits=r2.toSD=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(r5(e,1,1e9),void 0===t?t=r.rounding:r5(t,0,8)),r8(new r(this),e,t)},r2.toString=function(){var e=this.constructor,t=ae(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()&&!this.isZero()?"-"+t:t},r2.truncated=r2.trunc=function(){return r8(new this.constructor(this),this.e+1,1)},r2.valueOf=r2.toJSON=function(){var e=this.constructor,t=ae(this,this.e<=e.toExpNeg||this.e>=e.toExpPos);return this.isNeg()?"-"+t:t},B(r3,"digitsToString"),B(r5,"checkInt32"),B(r4,"checkRoundingDigits"),B(r6,"convertBase"),B(r9,"cosine");var r7=function(){function e(e,t,r){var a,n=0,i=e.length;for(e=e.slice();i--;)a=e[i]*t+n,e[i]=a%r|0,n=a/r|0;return n&&e.unshift(n),e}function t(e,t,r,a){var n,i;if(r!=a)i=r>a?1:-1;else for(n=i=0;n<r;n++)if(e[n]!=t[n]){i=e[n]>t[n]?1:-1;break}return i}function r(e,t,r,a){for(var n=0;r--;)e[r]-=n,n=e[r]<t[r]?1:0,e[r]=n*a+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return B(e,"multiplyInteger"),B(t,"compare"),B(r,"subtract"),function(a,n,i,s,l,u){var o,c,h,m,f,g,d,N,_,C,E,p,A,b,y,R,S,O,T,V,I=a.constructor,M=a.s==n.s?1:-1,x=a.d,v=n.d;if(!x||!x[0]||!v||!v[0])return new I(a.s&&n.s&&(x?!v||x[0]!=v[0]:v)?x&&0==x[0]||!v?0*M:M/0:NaN);for(u?(f=1,c=a.e-n.e):(u=1e7,f=7,c=rQ(a.e/f)-rQ(n.e/f)),T=v.length,S=x.length,C=(_=new I(M)).d=[],h=0;v[h]==(x[h]||0);h++);if(v[h]>(x[h]||0)&&c--,null==i?(b=i=I.precision,s=I.rounding):b=l?i+(a.e-n.e)+1:i,b<0)C.push(1),g=!0;else{if(b=b/f+2|0,h=0,1==T){for(m=0,v=v[0],b++;(h<S||m)&&b--;h++)y=m*u+(x[h]||0),C[h]=y/v|0,m=y%v|0;g=m||h<S}else{for((m=u/(v[0]+1)|0)>1&&(v=e(v,m,u),x=e(x,m,u),T=v.length,S=x.length),R=T,p=(E=x.slice(0,T)).length;p<T;)E[p++]=0;(V=v.slice()).unshift(0),O=v[0],v[1]>=u/2&&++O;do m=0,(o=t(v,E,T,p))<0?(A=E[0],T!=p&&(A=A*u+(E[1]||0)),(m=A/O|0)>1?(m>=u&&(m=u-1),N=(d=e(v,m,u)).length,p=E.length,1==(o=t(d,E,N,p))&&(m--,r(d,T<N?V:v,N,u))):(0==m&&(o=m=1),d=v.slice()),(N=d.length)<p&&d.unshift(0),r(E,d,p,u),-1==o&&(p=E.length,(o=t(v,E,T,p))<1&&(m++,r(E,T<p?V:v,p,u))),p=E.length):0===o&&(m++,E=[0]),C[h++]=m,o&&E[0]?E[p++]=x[R]||0:(E=[x[R]],p=1);while((R++<S||void 0!==E[0])&&b--)g=void 0!==E[0]}C[0]||C.shift()}if(1==f)_.e=c,rL=g;else{for(h=1,m=C[0];m>=10;m/=10)h++;_.e=h+c*f-1,r8(_,l?i+_.e+1:i,s,g)}return _}}();function r8(e,t,r,a){var n,i,s,l,u,o,c,h,m,f=e.constructor;e:if(null!=t){if(!(h=e.d))return e;for(n=1,l=h[0];l>=10;l/=10)n++;if((i=t-n)<0)i+=7,s=t,u=(c=h[m=0])/rX(10,n-s-1)%10|0;else if((m=Math.ceil((i+1)/7))>=(l=h.length)){if(a){for(;l++<=m;)h.push(0);c=u=0,n=1,i%=7,s=i-7+1}else break e}else{for(c=l=h[m],n=1;l>=10;l/=10)n++;i%=7,u=(s=i-7+n)<0?0:c/rX(10,n-s-1)%10|0}if(a=a||t<0||void 0!==h[m+1]||(s<0?c:c%rX(10,n-s-1)),o=r<4?(u||a)&&(0==r||r==(e.s<0?3:2)):u>5||5==u&&(4==r||a||6==r&&(i>0?s>0?c/rX(10,n-s):0:h[m-1])%10&1||r==(e.s<0?8:7)),t<1||!h[0])return h.length=0,o?(t-=e.e+1,h[0]=rX(10,(7-t%7)%7),e.e=-t||0):h[0]=e.e=0,e;if(0==i?(h.length=m,l=1,m--):(h.length=m+1,l=rX(10,7-i),h[m]=s>0?(c/rX(10,n-s)%rX(10,s)|0)*l:0),o)for(;;)if(0==m){for(i=1,s=h[0];s>=10;s/=10)i++;for(s=h[0]+=l,l=1;s>=10;s/=10)l++;i!=l&&(e.e++,1e7==h[0]&&(h[0]=1));break}else{if(h[m]+=l,1e7!=h[m])break;h[m--]=0,l=1}for(i=h.length;0===h[--i];)h.pop()}return r$&&(e.e>f.maxE?(e.d=null,e.e=NaN):e.e<f.minE&&(e.e=0,e.d=[0])),e}function ae(e,t,r){if(!e.isFinite())return ah(e);var a,n=e.e,i=r3(e.d),s=i.length;return t?(r&&(a=r-s)>0?i=i.charAt(0)+"."+i.slice(1)+ai(a):s>1&&(i=i.charAt(0)+"."+i.slice(1)),i=i+(e.e<0?"e":"e+")+e.e):n<0?(i="0."+ai(-n-1)+i,r&&(a=r-s)>0&&(i+=ai(a))):n>=s?(i+=ai(n+1-s),r&&(a=r-n-1)>0&&(i=i+"."+ai(a))):((a=n+1)<s&&(i=i.slice(0,a)+"."+i.slice(a)),r&&(a=r-s)>0&&(n+1===s&&(i+="."),i+=ai(a))),i}function at(e,t){var r=e[0];for(t*=7;r>=10;r/=10)t++;return t}function ar(e,t,r){if(t>r0)throw r$=!0,r&&(e.precision=r),Error(rG);return r8(new e(rj),t,1,!0)}function aa(e,t,r){if(t>r1)throw Error(rG);return r8(new e(rB),t,r,!0)}function an(e){var t=e.length-1,r=7*t+1;if(t=e[t]){for(;t%10==0;t/=10)r--;for(t=e[0];t>=10;t/=10)r++}return r}function ai(e){for(var t="";e--;)t+="0";return t}function as(e,t,r,a){var n,i=new e(1),s=Math.ceil(a/7+4);for(r$=!1;;){if(r%2&&aE((i=i.times(t)).d,s)&&(n=!0),0===(r=rQ(r/2))){r=i.d.length-1,n&&0===i.d[r]&&++i.d[r];break}aE((t=t.times(t)).d,s)}return r$=!0,i}function al(e){return 1&e.d[e.d.length-1]}function au(e,t,r){for(var a,n=new e(t[0]),i=0;++i<t.length;)if((a=new e(t[i])).s)n[r](a)&&(n=a);else{n=a;break}return n}function ao(e,t){var r,a,n,i,s,l,u,o=0,c=0,h=0,m=e.constructor,f=m.rounding,g=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(null==t?(r$=!1,u=g):u=t,l=new m(.03125);e.e>-2;)e=e.times(l),h+=5;for(u+=a=Math.log(rX(2,h))/Math.LN10*2+5|0,r=i=s=new m(1),m.precision=u;;){if(i=r8(i.times(e),u,1),r=r.times(++c),r3((l=s.plus(r7(i,r,u,1))).d).slice(0,u)===r3(s.d).slice(0,u)){for(n=h;n--;)s=r8(s.times(s),u,1);if(null!=t)return m.precision=g,s;if(!(o<3&&r4(s.d,u-a,f,o)))return r8(s,m.precision=g,f,r$=!0);m.precision=u+=10,r=i=l=new m(1),c=0,o++}s=l}}function ac(e,t){var r,a,n,i,s,l,u,o,c,h,m,f=1,g=e,d=g.d,N=g.constructor,_=N.rounding,C=N.precision;if(g.s<0||!d||!d[0]||!g.e&&1==d[0]&&1==d.length)return new N(d&&!d[0]?-1/0:1!=g.s?NaN:d?0:g);if(null==t?(r$=!1,c=C):c=t,N.precision=c+=10,a=(r=r3(d)).charAt(0),!(15e14>Math.abs(i=g.e)))return o=ar(N,c+2,C).times(i+""),g=ac(new N(a+"."+r.slice(1)),c-10).plus(o),N.precision=C,null==t?r8(g,C,_,r$=!0):g;for(;a<7&&1!=a||1==a&&r.charAt(1)>3;)a=(r=r3((g=g.times(e)).d)).charAt(0),f++;for(i=g.e,a>1?(g=new N("0."+r),i++):g=new N(a+"."+r.slice(1)),h=g,u=s=g=r7(g.minus(1),g.plus(1),c,1),m=r8(g.times(g),c,1),n=3;;){if(s=r8(s.times(m),c,1),r3((o=u.plus(r7(s,new N(n),c,1))).d).slice(0,c)===r3(u.d).slice(0,c)){if(u=u.times(2),0!==i&&(u=u.plus(ar(N,c+2,C).times(i+""))),u=r7(u,new N(f),c,1),null!=t)return N.precision=C,u;if(!r4(u.d,c-10,_,l))return r8(u,N.precision=C,_,r$=!0);N.precision=c+=10,o=s=g=r7(h.minus(1),h.plus(1),c,1),m=r8(g.times(g),c,1),n=l=1}u=o,n+=2}}function ah(e){return String(e.s*e.s/0)}function am(e,t){var r,a,n;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(a=t.search(/e/i))>0?(r<0&&(r=a),r+=+t.slice(a+1),t=t.substring(0,a)):r<0&&(r=t.length),a=0;48===t.charCodeAt(a);a++);for(n=t.length;48===t.charCodeAt(n-1);--n);if(t=t.slice(a,n)){if(n-=a,e.e=r=r-a-1,e.d=[],a=(r+1)%7,r<0&&(a+=7),a<n){for(a&&e.d.push(+t.slice(0,a)),n-=7;a<n;)e.d.push(+t.slice(a,a+=7));a=7-(t=t.slice(a)).length}else a-=n;for(;a--;)t+="0";e.d.push(+t),r$&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function af(e,t){var r,a,n,i,s,l,u,o,c;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),rJ.test(t))return am(e,t)}else if("Infinity"===t||"NaN"===t)return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(rZ.test(t))r=16,t=t.toLowerCase();else if(rK.test(t))r=2;else if(rz.test(t))r=8;else throw Error(rH+t);for((i=t.search(/p/i))>0?(u=+t.slice(i+1),t=t.substring(2,i)):t=t.slice(2),s=(i=t.indexOf("."))>=0,a=e.constructor,s&&(i=(l=(t=t.replace(".","")).length)-i,n=as(a,new a(r),i,2*i)),i=c=(o=r6(t,r,1e7)).length-1;0===o[i];--i)o.pop();return i<0?new a(0*e.s):(e.e=at(o,c),e.d=o,r$=!1,s&&(e=r7(e,n,4*l)),u&&(e=e.times(54>Math.abs(u)?rX(2,u):a9.pow(2,u))),r$=!0,e)}function ag(e,t){var r,a=t.d.length;if(a<3)return t.isZero()?t:ad(e,2,t,t);r=(r=1.4*Math.sqrt(a))>16?16:0|r,t=ad(e,2,t=t.times(1/aN(5,r)),t);for(var n,i=new e(5),s=new e(16),l=new e(20);r--;)n=t.times(t),t=t.times(i.plus(n.times(s.times(n).minus(l))));return t}function ad(e,t,r,a,n){var i,s,l,u,o=e.precision,c=Math.ceil(o/7);for(r$=!1,u=r.times(r),l=new e(a);;){if(s=r7(l.times(u),new e(t++*t++),o,1),l=n?a.plus(s):a.minus(s),a=r7(s.times(u),new e(t++*t++),o,1),void 0!==(s=l.plus(a)).d[c]){for(i=c;s.d[i]===l.d[i]&&i--;);if(-1==i)break}i=l,l=a,a=s,s=i}return r$=!0,s.d.length=c+1,s}function aN(e,t){for(var r=e;--t;)r*=e;return r}function a_(e,t){var r,a=t.s<0,n=aa(e,e.precision,1),i=n.times(.5);if((t=t.abs()).lte(i))return rw=a?4:1,t;if((r=t.divToInt(n)).isZero())rw=a?3:2;else{if((t=t.minus(r.times(n))).lte(i))return rw=al(r)?a?2:3:a?4:1,t;rw=al(r)?a?1:4:a?3:2}return t.minus(n).abs()}function aC(e,t,r,a){var n,i,s,l,u,o,c,h,m,f=e.constructor,g=void 0!==r;if(g?(r5(r,1,1e9),void 0===a?a=f.rounding:r5(a,0,8)):(r=f.precision,a=f.rounding),e.isFinite()){for(s=(c=ae(e)).indexOf("."),g?(n=2,16==t?r=4*r-3:8==t&&(r=3*r-2)):n=t,s>=0&&(c=c.replace(".",""),(m=new f(1)).e=c.length-s,m.d=r6(ae(m),10,n),m.e=m.d.length),i=u=(h=r6(c,10,n)).length;0==h[--u];)h.pop();if(h[0]){if(s<0?i--:((e=new f(e)).d=h,e.e=i,h=(e=r7(e,m,r,a,0,n)).d,i=e.e,o=rL),s=h[r],l=n/2,o=o||void 0!==h[r+1],o=a<4?(void 0!==s||o)&&(0===a||a===(e.s<0?3:2)):s>l||s===l&&(4===a||o||6===a&&1&h[r-1]||a===(e.s<0?8:7)),h.length=r,o)for(;++h[--r]>n-1;)h[r]=0,r||(++i,h.unshift(1));for(u=h.length;!h[u-1];--u);for(s=0,c="";s<u;s++)c+=rF.charAt(h[s]);if(g){if(u>1){if(16==t||8==t){for(s=16==t?4:3,--u;u%s;u++)c+="0";for(u=(h=r6(c,n,t)).length;!h[u-1];--u);for(s=1,c="1.";s<u;s++)c+=rF.charAt(h[s])}else c=c.charAt(0)+"."+c.slice(1)}c=c+(i<0?"p":"p+")+i}else if(i<0){for(;++i;)c="0"+c;c="0."+c}else if(++i>u)for(i-=u;i--;)c+="0";else i<u&&(c=c.slice(0,i)+"."+c.slice(i))}else c=g?"0p+0":"0";c=(16==t?"0x":2==t?"0b":8==t?"0o":"")+c}else c=ah(e);return e.s<0?"-"+c:c}function aE(e,t){if(e.length>t)return e.length=t,!0}function ap(e){return new this(e).abs()}function aA(e){return new this(e).acos()}function ab(e){return new this(e).acosh()}function ay(e,t){return new this(e).plus(t)}function aR(e){return new this(e).asin()}function aS(e){return new this(e).asinh()}function aO(e){return new this(e).atan()}function aT(e){return new this(e).atanh()}function aV(e,t){e=new this(e),t=new this(t);var r,a=this.precision,n=this.rounding,i=a+4;return e.s&&t.s?e.d||t.d?!t.d||e.isZero()?(r=t.s<0?aa(this,a,n):new this(0)).s=e.s:!e.d||t.isZero()?(r=aa(this,i,1).times(.5)).s=e.s:t.s<0?(this.precision=i,this.rounding=1,r=this.atan(r7(e,t,i,1)),t=aa(this,i,1),this.precision=a,this.rounding=n,r=e.s<0?r.minus(t):r.plus(t)):r=this.atan(r7(e,t,i,1)):(r=aa(this,i,1).times(t.s>0?.25:.75)).s=e.s:r=new this(NaN),r}function aI(e){return new this(e).cbrt()}function aM(e){return r8(e=new this(e),e.e+1,2)}function ax(e,t,r){return new this(e).clamp(t,r)}function av(e){if(!e||"object"!=typeof e)throw Error(rY+"Object expected");var t,r,a,n=!0===e.defaults,i=["precision",1,1e9,"rounding",0,8,"toExpNeg",-9e15,0,"toExpPos",0,9e15,"maxE",0,9e15,"minE",-9e15,0,"modulo",0,9];for(t=0;t<i.length;t+=3)if(r=i[t],n&&(this[r]=rk[r]),void 0!==(a=e[r])){if(rQ(a)===a&&a>=i[t+1]&&a<=i[t+2])this[r]=a;else throw Error(rH+r+": "+a)}if(r="crypto",n&&(this[r]=rk[r]),void 0!==(a=e[r])){if(!0===a||!1===a||0===a||1===a){if(a){if("u">typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[r]=!0;else throw Error(rq)}else this[r]=!1}else throw Error(rH+r+": "+a)}return this}function aU(e){return new this(e).cos()}function aD(e){return new this(e).cosh()}function aP(e){var t,r,a;function n(e){var t,r,a;if(!(this instanceof n))return new n(e);if(this.constructor=n,aB(e)){this.s=e.s,r$?!e.d||e.e>n.maxE?(this.e=NaN,this.d=null):e.e<n.minE?(this.e=0,this.d=[0]):(this.e=e.e,this.d=e.d.slice()):(this.e=e.e,this.d=e.d?e.d.slice():e.d);return}if("number"==(a=typeof e)){if(0===e){this.s=1/e<0?-1:1,this.e=0,this.d=[0];return}if(e<0?(e=-e,this.s=-1):this.s=1,e===~~e&&e<1e7){for(t=0,r=e;r>=10;r/=10)t++;r$?t>n.maxE?(this.e=NaN,this.d=null):t<n.minE?(this.e=0,this.d=[0]):(this.e=t,this.d=[e]):(this.e=t,this.d=[e]);return}if(0*e!=0){e||(this.s=NaN),this.e=NaN,this.d=null;return}return am(this,e.toString())}if("string"!==a)throw Error(rH+e);return 45===(r=e.charCodeAt(0))?(e=e.slice(1),this.s=-1):(43===r&&(e=e.slice(1)),this.s=1),rJ.test(e)?am(this,e):af(this,e)}if(B(n,"Decimal"),n.prototype=r2,n.ROUND_UP=0,n.ROUND_DOWN=1,n.ROUND_CEIL=2,n.ROUND_FLOOR=3,n.ROUND_HALF_UP=4,n.ROUND_HALF_DOWN=5,n.ROUND_HALF_EVEN=6,n.ROUND_HALF_CEIL=7,n.ROUND_HALF_FLOOR=8,n.EUCLID=9,n.config=n.set=av,n.clone=aP,n.isDecimal=aB,n.abs=ap,n.acos=aA,n.acosh=ab,n.add=ay,n.asin=aR,n.asinh=aS,n.atan=aO,n.atanh=aT,n.atan2=aV,n.cbrt=aI,n.ceil=aM,n.clamp=ax,n.cos=aU,n.cosh=aD,n.div=aL,n.exp=aw,n.floor=aF,n.hypot=aj,n.ln=ak,n.log=a$,n.log10=aH,n.log2=aY,n.max=aG,n.min=aq,n.mod=aW,n.mul=aQ,n.pow=aX,n.random=aK,n.round=aZ,n.sign=az,n.sin=aJ,n.sinh=a0,n.sqrt=a1,n.sub=a2,n.sum=a3,n.tan=a5,n.tanh=a4,n.trunc=a6,void 0===e&&(e={}),e&&!0!==e.defaults)for(a=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<a.length;)e.hasOwnProperty(r=a[t++])||(e[r]=this[r]);return n.config(e),n}function aL(e,t){return new this(e).div(t)}function aw(e){return new this(e).exp()}function aF(e){return r8(e=new this(e),e.e+1,3)}function aj(){var e,t,r=new this(0);for(r$=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)r.d&&(r=r.plus(t.times(t)));else{if(t.s)return r$=!0,new this(1/0);r=t}return r$=!0,r.sqrt()}function aB(e){return e instanceof a9||e&&e.toStringTag===rW||!1}function ak(e){return new this(e).ln()}function a$(e,t){return new this(e).log(t)}function aY(e){return new this(e).log(2)}function aH(e){return new this(e).log(10)}function aG(){return au(this,arguments,"lt")}function aq(){return au(this,arguments,"gt")}function aW(e,t){return new this(e).mod(t)}function aQ(e,t){return new this(e).mul(t)}function aX(e,t){return new this(e).pow(t)}function aK(e){var t,r,a,n,i=0,s=new this(1),l=[];if(void 0===e?e=this.precision:r5(e,1,1e9),a=Math.ceil(e/7),this.crypto){if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(a));i<a;)(n=t[i])>=429e7?t[i]=crypto.getRandomValues(new Uint32Array(1))[0]:l[i++]=n%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(a*=4);i<a;)(n=t[i]+(t[i+1]<<8)+(t[i+2]<<16)+((127&t[i+3])<<24))>=214e7?crypto.randomBytes(4).copy(t,i):(l.push(n%1e7),i+=4);i=a/4}else throw Error(rq)}else for(;i<a;)l[i++]=1e7*Math.random()|0;for(a=l[--i],e%=7,a&&e&&(n=rX(10,7-e),l[i]=(a/n|0)*n);0===l[i];i--)l.pop();if(i<0)r=0,l=[0];else{for(r=-1;0===l[0];r-=7)l.shift();for(a=1,n=l[0];n>=10;n/=10)a++;a<7&&(r-=7-a)}return s.e=r,s.d=l,s}function aZ(e){return r8(e=new this(e),e.e+1,this.rounding)}function az(e){return(e=new this(e)).d?e.d[0]?e.s:0*e.s:e.s||NaN}function aJ(e){return new this(e).sin()}function a0(e){return new this(e).sinh()}function a1(e){return new this(e).sqrt()}function a2(e,t){return new this(e).sub(t)}function a3(){var e=0,t=arguments,r=new this(t[0]);for(r$=!1;r.s&&++e<t.length;)r=r.plus(t[e]);return r$=!0,r8(r,this.precision,this.rounding)}function a5(e){return new this(e).tan()}function a4(e){return new this(e).tanh()}function a6(e){return r8(e=new this(e),e.e+1,1)}B(r8,"finalise"),B(ae,"finiteToString"),B(at,"getBase10Exponent"),B(ar,"getLn10"),B(aa,"getPi"),B(an,"getPrecision"),B(ai,"getZeroString"),B(as,"intPow"),B(al,"isOdd"),B(au,"maxOrMin"),B(ao,"naturalExponential"),B(ac,"naturalLogarithm"),B(ah,"nonFiniteToString"),B(am,"parseDecimal"),B(af,"parseOther"),B(ag,"sine"),B(ad,"taylorSeries"),B(aN,"tinyPow"),B(a_,"toLessThanHalfPi"),B(aC,"toStringBinary"),B(aE,"truncate"),B(ap,"abs"),B(aA,"acos"),B(ab,"acosh"),B(ay,"add"),B(aR,"asin"),B(aS,"asinh"),B(aO,"atan"),B(aT,"atanh"),B(aV,"atan2"),B(aI,"cbrt"),B(aM,"ceil$1"),B(ax,"clamp"),B(av,"config"),B(aU,"cos"),B(aD,"cosh"),B(aP,"clone"),B(aL,"div"),B(aw,"exp"),B(aF,"floor$1"),B(aj,"hypot"),B(aB,"isDecimalInstance"),B(ak,"ln"),B(a$,"log"),B(aY,"log2"),B(aH,"log10"),B(aG,"max"),B(aq,"min"),B(aW,"mod$1"),B(aQ,"mul"),B(aX,"pow$1"),B(aK,"random"),B(aZ,"round$1"),B(az,"sign"),B(aJ,"sin"),B(a0,"sinh"),B(a1,"sqrt$1"),B(a2,"sub"),B(a3,"sum"),B(a5,"tan"),B(a4,"tanh"),B(a6,"trunc"),r2[Symbol.for("nodejs.util.inspect.custom")]=r2.toString,r2[Symbol.toStringTag]="Decimal";var a9=r2.constructor=aP(rk);function a7(e,t){let r=e+t;return Number.isSafeInteger(r)?r:new a9(e).add(t).toNumber()}function a8(e,t){let r=e-t;return Number.isSafeInteger(r)?r:new a9(e).sub(t).toNumber()}function ne(e,t){let r=e*t;return Number.isSafeInteger(r)?r:new a9(e).mul(t).toNumber()}function nt(e,t){let r=e/t;return Number.isSafeInteger(r)?r:new a9(e).div(t).toNumber()}function nr(e,t){let r=10**Math.trunc(t),a=ni(e,r);return Math.round(ne(e,r)+a)/r}function na(e,t){let r=10**Math.trunc(t),a=ni(e,r);return Math.floor(ne(e,r)+a)/r}function nn(e,t){let r=10**Math.trunc(t),a=ni(e,r);return Math.ceil(ne(e,r)-a)/r}function ni(e,t){return Number.EPSILON*Math.max(1,Math.abs(ne(e,t)))}function ns(e,t){return e-t*Math.floor(e/t)}function nl(e,t){return e**t}function nu(e){return Math.sqrt(e)}function no(e,t){return e===t}function nc(e,t){return e>t}function nh(e,t){return e>=t}function nm(e,t){return e<t}function nf(e,t){return e<=t}function ng(e,t=15){return Number.parseFloat(e.toPrecision(t))}function nd(e,t,r=Number.EPSILON){return Math.abs(e-t)<r}function nN(e,t=12,r=1e-10){let a=ng(e,t);return nd(e,a,r)?a:ng(e)}function n_(e){return e-Math.trunc(e)}rj=new a9(rj),rB=new a9(rB),B(a7,"plus"),B(a8,"minus"),B(ne,"multiply"),B(nt,"divide"),B(nr,"round"),B(na,"floor"),B(nn,"ceil"),B(ni,"baseEpsilon"),B(ns,"mod"),B(nl,"pow"),B(nu,"sqrt"),B(no,"equals"),B(nc,"greaterThan"),B(nh,"greaterThanOrEquals"),B(nm,"lessThan"),B(nf,"lessThanOrEquals"),B(ng,"strip"),B(nd,"withinErrorMargin"),B(nN,"stripErrorMargin"),B(n_,"getFractionalPart");let nC=class e extends rA{static create(){return this._instance=this._instance||new e(0),this._instance}isNull(){return!0}plus(e){return nR.create(0).plus(e)}minus(e){return nR.create(0).minus(e)}multiply(e){return nR.create(0).multiply(e)}divided(e){return nR.create(0).divided(e)}mod(e){return nR.create(0).mod(e)}compare(e,t){return e.isString()?nT.create("").compare(e,t):e.isBoolean()?nA.create(!1).compare(e,t):nR.create(0).compare(e,t)}concatenateFront(e){return e.isArray()?e.concatenateBack(nT.create("")):nT.create(this.concatenate(e.getValue(),H.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(nT.create("")):nT.create(this.concatenate(e.getValue(),H.BACK))}plusBy(e){return nR.create(0).plusBy(e)}minusBy(e){return nR.create(0).minusBy(e)}multiplyBy(e){return nR.create(0).multiplyBy(e)}dividedBy(e){return nR.create(0).dividedBy(e)}compareBy(e,t){return"string"==typeof e?nT.create("").compareBy(e,t):"boolean"==typeof e?nA.create(!1).compareBy(e,t):nR.create(0).compareBy(e,t)}pow(e){return nR.create(0).pow(e)}sqrt(){return nR.create(0).sqrt()}cbrt(){return nR.create(0).cbrt()}cos(){return nR.create(0).cos()}cosh(){return nR.create(0).cosh()}acos(){return nR.create(0).acos()}acosh(){return nR.create(0).acosh()}sin(){return nR.create(0).sin()}sinh(){return nR.create(0).sinh()}asin(){return nR.create(0).asin()}asinh(){return nR.create(0).asinh()}tan(){return nR.create(0).tan()}tanh(){return nR.create(0).tanh()}atan(){return nR.create(0).atan()}atan2(e){return nR.create(0).atan2(e)}atanh(){return nR.create(0).atanh()}log(){return rR.create(q.NUM)}log10(){return rR.create(q.NUM)}exp(){return nR.create(0).exp()}abs(){return nR.create(0).abs()}round(e){return nR.create(0).round(e)}floor(e){return nR.create(0).floor(e)}ceil(e){return nR.create(0).ceil(e)}convertToNumberObjectValue(){return nR.create(0)}convertToBooleanObjectValue(){return nA.create(!1)}};B(nC,"NullValueObject"),k(nC,"_instance");let nE=nC,np=class e extends rA{constructor(e){super(e),k(this,"_value",!1),this._value=e}static create(t){return t?(this._instanceTrue=this._instanceTrue||new e(!0),this._instanceTrue):(this._instanceFalse=this._instanceFalse||new e(!1),this._instanceFalse)}getValue(){return this._value}isBoolean(){return!0}getNegative(){let e=this.getValue(),t=0;return e&&(t=1),nR.create(-t)}getReciprocal(){return this.getValue()?nR.create(1):rR.create(q.DIV_BY_ZERO)}plus(e){return this._convertToNumber().plus(e)}minus(e){return this._convertToNumber().minus(e)}multiply(e){return this._convertToNumber().multiply(e)}divided(e){return this._convertToNumber().divided(e)}mod(e){return this._convertToNumber().mod(e)}compare(e,t){return e.isArray()?e.compare(this,rS(t)):e.isNull()?this._convertToNumber().compare(e,t):this.compareBy(e.getValue(),t)}compareBy(t,r){let a=!1;if("string"==typeof t||"number"==typeof t)a=this._compareString(r);else if("boolean"==typeof t){let e=nR.create(t?1:0);return this._convertToNumber().compare(e,r)}return e.create(a)}_compareString(e){switch(e){case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:return!0;case Z.EQUALS:case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:case Z.NOT_EQUAL:return!1}}concatenateFront(e){return this._convertToNumber().concatenateFront(e)}concatenateBack(e){return this._convertToNumber().concatenateBack(e)}_convertToNumber(){let e=this.getValue(),t=0;return e&&(t=1),nR.create(t)}pow(e){return this._convertToNumber().pow(e)}sqrt(){return this._convertToNumber().sqrt()}cbrt(){return this._convertToNumber().cbrt()}cos(){return this._convertToNumber().cos()}cosh(){return this._convertToNumber().cosh()}acos(){return this._convertToNumber().acos()}acosh(){return this._convertToNumber().acosh()}sin(){return this._convertToNumber().sin()}sinh(){return this._convertToNumber().sinh()}asin(){return this._convertToNumber().asin()}asinh(){return this._convertToNumber().asinh()}tan(){return this._convertToNumber().tan()}tanh(){return this._convertToNumber().tanh()}atan(){return this._convertToNumber().atan()}atan2(e){return this._convertToNumber().atan2(e)}atanh(){return this._convertToNumber().atanh()}log(){return this._convertToNumber().log()}log10(){return this._convertToNumber().log10()}exp(){return this._convertToNumber().exp()}abs(){return this._convertToNumber().abs()}round(e){return this._convertToNumber().round(e)}floor(e){return this._convertToNumber().floor(e)}ceil(e){return this._convertToNumber().ceil(e)}convertToNumberObjectValue(){return nM(this.getValue())}convertToBooleanObjectValue(){return this}};B(np,"BooleanValueObject"),k(np,"_instanceTrue"),k(np,"_instanceFalse");let nA=np,nb=new tE(2e5),ny=class e extends rA{constructor(e){super(e),k(this,"_value",0),this._value=Number(e)}static create(t,r=""){let a=`${t}-${r}`,n=nb.get(a);if(n)return n;let i=new e(t);return r&&i.setPattern(r),nb.set(a,i),i}getValue(){return this._value}setValue(e){this._value=e}isNumber(){return!0}getNegative(){return e.create(0).minus(this)}getReciprocal(){return e.create(1).divided(this)}plus(t){if(t.isArray())return t.plus(this);let r=this.plusBy(t.getValue());if(r.isError())return r;let a=ro(this.getPattern(),t.getPattern(),K.PLUS);return e.create(Number(r.getValue()),a)}equalZero(){return 0===this._value}minus(t){if(t.isArray()){let e=t.getNegative();return e.isError()?e:e.plus(this)}let r=this.minusBy(t.getValue());if(r.isError())return r;let a=ro(this.getPattern(),t.getPattern(),K.MINUS);return e.create(Number(r.getValue()),a)}multiply(t){if(t.isArray())return t.multiply(this);let r=this.multiplyBy(t.getValue());if(r.isError())return r;let a=ro(this.getPattern(),t.getPattern(),K.MULTIPLY);return e.create(Number(r.getValue()),a)}divided(t){if(t.isArray()){let e=t.getReciprocal();return e.isError()?e:e.multiply(this)}let r=this.dividedBy(t.getValue());if(r.isError())return r;let a=ro(this.getPattern(),t.getPattern(),K.DIVIDED);return e.create(Number(r.getValue()),a)}mod(t){if(t.isArray())return t.modInverse(this);let r=this.getValue(),a=t.getValue();if(t.isNull())return rR.create(q.DIV_BY_ZERO);if("string"==typeof a)return rR.create(q.VALUE);if("number"==typeof a){if(0===a)return rR.create(q.DIV_BY_ZERO);if(!Number.isFinite(r)||!Number.isFinite(a)||11259e8*Math.abs(a)<=Math.abs(r))return rR.create(q.NUM);let t=ns(r,a);return Number.isFinite(t)?e.create(t):rR.create(q.NUM)}if("boolean"==typeof a){let t=a?1:0;return 0===t?rR.create(q.DIV_BY_ZERO):e.create(ns(r,t))}return this}concatenateFront(e){return e.isArray()?e.concatenateBack(this):nT.create(this.concatenate(e.getValue(),H.FRONT))}concatenateBack(e){return e.isArray()?e.concatenateFront(this):nT.create(this.concatenate(e.getValue(),H.BACK))}compare(e,t){return e.isArray()?e.compare(this,rS(t)):this.compareBy(e.getValue(),t)}plusBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return rR.create(q.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let n=a7(r,a);return Number.isFinite(n)?e.create(n):rR.create(q.NUM)}minusBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return rR.create(q.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let n=a8(r,a);return Number.isFinite(n)?e.create(n):rR.create(q.NUM)}multiplyBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return rR.create(q.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let n=ne(r,a);return Number.isFinite(n)?e.create(n):rR.create(q.NUM)}dividedBy(t){let r=+this.getValue(),a=+t;if(Number.isNaN(r)||Number.isNaN(a))return rR.create(q.VALUE);if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);if(0===a)return rR.create(q.DIV_BY_ZERO);let n=nt(r,a);return Number.isFinite(n)?e.create(n):rR.create(q.NUM)}compareBy(e,t){let r=this.getValue(),a=!1;return"string"==typeof e?a=this._compareString(t):"number"==typeof e?a=this._compareNumber(r,e,t):"boolean"==typeof e&&(a=this._compareBoolean(t)),nA.create(a)}_compareString(e){switch(e){case Z.EQUALS:case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:return!1;case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:case Z.NOT_EQUAL:return!0}}_compareNumber(e,t,r){return Number.isFinite(e)&&Number.isFinite(t)?this._compareFiniteNumber(e,t,r):this._compareInfinity(e,t,r)}_compareFiniteNumber(e,t,r){switch(r){case Z.EQUALS:return no(e,t);case Z.GREATER_THAN:return nc(e,t);case Z.GREATER_THAN_OR_EQUAL:return nh(e,t);case Z.LESS_THAN:return nm(e,t);case Z.LESS_THAN_OR_EQUAL:return nf(e,t);case Z.NOT_EQUAL:return!no(e,t)}}_compareBoolean(e){switch(e){case Z.EQUALS:case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:return!1;case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:case Z.NOT_EQUAL:return!0}}pow(t){if(t.isArray())return t.powInverse(this);if(this.isError())return this;let r=this.getValue(),a=t;if(t.isString()&&(a=t.convertToNumberObjectValue()),a.isError())return a;let n=+a.getValue();if(Number.isNaN(n))return rR.create(q.VALUE);if(!Number.isFinite(r)||!Number.isFinite(n))return rR.create(q.NUM);if(0===r)return n<0?rR.create(q.DIV_BY_ZERO):0===n?rR.create(q.NUM):e.create(0);let i=nl(r,n);return Number.isFinite(i)?e.create(i):rR.create(q.NUM)}sqrt(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=nu(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}cbrt(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.cbrt(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}cos(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.cos(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}cosh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.cosh(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}acos(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.acos(t);return Number.isNaN(r)?rR.create(q.NUM):e.create(r)}acosh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.acosh(t);return Number.isNaN(r)?rR.create(q.NUM):e.create(r)}sin(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.sin(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}sinh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.sinh(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}asin(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.asin(t);return Number.isNaN(r)?rR.create(q.NUM):e.create(r)}asinh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.asinh(t);return Number.isNaN(r)?rR.create(q.NUM):e.create(r)}tan(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.tan(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}tanh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.tanh(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}atan(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.atan(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}atan2(t){if(t.isArray())return t.atan2Inverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return rR.create(q.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);if(0===r&&0===a)return rR.create(q.DIV_BY_ZERO);let t=Math.atan2(r,a);return Number.isFinite(t)?e.create(t):rR.create(q.NUM)}return"boolean"==typeof a?e.create(Math.atan2(r,a?1:0)):this}atanh(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.atanh(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}log(){let t=this.getValue();if("number"==typeof t&&t<=0||!Number.isFinite(t))return rR.create(q.NUM);let r=Math.log(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}log10(){let t=this.getValue();if("number"==typeof t&&t<=0||!Number.isFinite(t))return rR.create(q.NUM);let r=Math.log10(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}exp(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.exp(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}abs(){let t=this.getValue();if(!Number.isFinite(t))return rR.create(q.NUM);let r=Math.abs(t);return Number.isFinite(r)?e.create(r):rR.create(q.NUM)}round(t){if(t.isArray())return t.roundInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return rR.create(q.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let t=r<0?-nr(Math.abs(r),a):nr(r,a);return Number.isFinite(t)?e.create(t):rR.create(q.NUM)}return"boolean"==typeof a?e.create(nr(r,a?1:0)):this}floor(t){if(t.isArray())return t.floorInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return rR.create(q.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let t=r<0?-na(Math.abs(r),a):na(r,a);return Number.isFinite(t)?e.create(t):rR.create(q.NUM)}return"boolean"==typeof a?e.create(na(r,a?1:0)):this}ceil(t){if(t.isArray())return t.ceilInverse(this);let r=this.getValue(),a=t.getValue();if("string"==typeof a)return rR.create(q.VALUE);if("number"==typeof a){if(!Number.isFinite(r)||!Number.isFinite(a))return rR.create(q.NUM);let t=r<0?-nn(Math.abs(r),a):nn(r,a);return Number.isFinite(t)?e.create(t):rR.create(q.NUM)}return"boolean"==typeof a?e.create(nn(r,a?1:0)):this}convertToNumberObjectValue(){return this}convertToBooleanObjectValue(){return nV(!0)}_compareInfinity(e,t,r){let a=!1;switch(r){case Z.EQUALS:a=e===t;break;case Z.GREATER_THAN:a=e>t;break;case Z.GREATER_THAN_OR_EQUAL:a=e>=t;break;case Z.LESS_THAN:a=e<t;break;case Z.LESS_THAN_OR_EQUAL:a=e<=t;break;case Z.NOT_EQUAL:a=e!==t}return a}};B(ny,"NumberValueObject");let nR=ny,nS=new tE(2e5),nO=class e extends rA{constructor(e){super(e),k(this,"_value"),this._value=e}static create(t){let r=nS.get(t);if(r)return r;let a=new e(t);return nS.set(t,a),a}getValue(){return this._value}isString(){return!0}concatenateFront(t){return t.isArray()?t.concatenateBack(this):e.create(this.concatenate(t.getValue(),H.FRONT))}concatenateBack(t){return t.isArray()?t.concatenateFront(this):e.create(this.concatenate(t.getValue(),H.BACK))}plus(e){return this.convertToNumberObjectValue().plus(e)}minus(e){return this.convertToNumberObjectValue().minus(e)}multiply(e){return this.convertToNumberObjectValue().multiply(e)}divided(e){return this.convertToNumberObjectValue().divided(e)}compare(e,t,r){return e.isArray()?e.compare(this,rS(t),r):this.compareBy(e.getValue(),t,r)}compareBy(e,t,r=!1){let a=this.getValue(),n=!1;if("string"==typeof e){let i=e;if(r||(a=a.toLocaleLowerCase(),i=i.toLocaleLowerCase()),rI(i))return this._checkWildcard(i,t);n=this._compareString(a,i,t)}else"number"==typeof e?n=this._compareNumber(t):"boolean"==typeof e&&(n=this._compareBoolean(t));return nA.create(n)}_compareString(e,t,r){switch(r){case Z.EQUALS:return e===t;case Z.GREATER_THAN:return e>t;case Z.GREATER_THAN_OR_EQUAL:return e>=t;case Z.LESS_THAN:return e<t;case Z.LESS_THAN_OR_EQUAL:return e<=t;case Z.NOT_EQUAL:return e!==t}}_compareNumber(e){switch(e){case Z.NOT_EQUAL:case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:return!0;case Z.EQUALS:case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:return!1}}_compareBoolean(e){switch(e){case Z.EQUALS:case Z.GREATER_THAN:case Z.GREATER_THAN_OR_EQUAL:return!1;case Z.LESS_THAN:case Z.LESS_THAN_OR_EQUAL:case Z.NOT_EQUAL:return!0}}convertToNumberObjectValue(){return nM(this.getValue())}convertToBooleanObjectValue(){return nA.create(!0)}_checkWildcard(e,t){let r=rv(this.getValue().toLocaleLowerCase(),e,t);return nA.create(r)}};B(nO,"StringValueObject");let nT=nO;function nV(e){if("boolean"==typeof e)return nA.create(e);let t=!1;if("string"==typeof e){let r=e.toLocaleUpperCase();r===$.TRUE?t=!0:r===$.FALSE&&(t=!1)}else t=1===e;return nA.create(t)}function nI(e){let t=e.toString();return'"'===t.charAt(0)&&'"'===t.charAt(t.length-1)&&(t=(t=t.slice(1,-1)).replace(/""/g,'"')),nT.create(t)}function nM(e,t=""){if("boolean"==typeof e){let r=0;return e&&(r=1),nR.create(r,t)}return"number"==typeof e?Number.isFinite(e)?nR.create(e,t):rR.create(q.NUM):(0,P.isRealNum)(e)?nR.create(Number(e),t):rR.create(q.VALUE)}function nx(e){return""}function nv(e=[]){let t=[];for(let r=0;r<e.length;r++){let a=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<a.length;e++){let n=a[e];t[r][e]=nL.create(n)}}return t}function nU(e=[]){let t=[];for(let r=0;r<e.length;r++){let a=e[r];null==t[r]&&(t[r]=[]);for(let e=0;e<a.length;e++){let n=a[e];null==n?t[r][e]=null:n.isError()?t[r][e]=n.getErrorType():t[r][e]=n.getValue()}}return t}B(nV,"createBooleanValueObjectByRawValue"),B(nI,"createStringValueObjectByRawValue"),B(nM,"createNumberValueObjectByRawValue"),B(nx,"fromObjectToString"),B(nv,"transformToValueObject"),B(nU,"transformToValue");let nD=class e extends rA{constructor(e){super("string"==typeof e?e:nx()),k(this,"_values",[]),k(this,"_rowCount",-1),k(this,"_columnCount",-1),k(this,"_unitId",""),k(this,"_sheetId",""),k(this,"_currentRow",-1),k(this,"_currentColumn",-1),k(this,"_sliceCache",/* @__PURE__ */new Map),k(this,"_flattenCache"),k(this,"_defaultValue",null),k(this,"_flattenPosition"),this._values=this._formatValue(e)}static create(t){return new e(t)}static createByArray(t){return new e({calculateValueList:nv(t),rowCount:t.length,columnCount:t[0].length||0,unitId:"",sheetId:"",row:-1,column:-1})}dispose(){this._values.forEach(e=>{e.forEach(e=>{null==e||e.dispose()})}),this._values=[],this._clearCache()}clone(){return this.map(e=>e)}getRowCount(){return this._rowCount}setRowCount(e){this._rowCount=e}getColumnCount(){return this._columnCount}setColumnCount(e){this._columnCount=e}setCurrent(e,t){this._currentRow=e,this._currentColumn=t}setUnitId(e){this._unitId=e}getUnitId(){return this._unitId}setSheetId(e){this._sheetId=e}getSheetId(){return this._sheetId}getCurrentRow(){return this._currentRow}getCurrentColumn(){return this._currentColumn}getArrayValue(){return this._values}setArrayValue(e){this._clearCache(),this._values=e}isArray(){return!0}setDefaultValue(e){this._defaultValue=e}get(e,t){var r;return(null==(r=this._values[e])?void 0:r[t])||this._defaultValue}getRealValue(e,t){let r=this._values[e];if(null==r)return null;let a=r[t];return null==a?null:a}getValueOrDefault(e,t){return this.get(e,t)||this._defaultValue}set(e,t,r){if(e>=this._rowCount||t>=this._columnCount)throw Error("Exceeding array bounds.");this._clearCache(),this._values[e][t]=r}getRangePosition(){return{startRow:0,endRow:this.getRowCount()-1,startColumn:0,endColumn:this.getColumnCount()-1}}iterator(e){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=this.getArrayValue();for(let l=r;l<=a;l++)for(let r=n;r<=i;r++)if(!1===e((null==(t=s[l])?void 0:t[r])||this._defaultValue,l,r))return}iteratorReverse(e){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=this.getArrayValue();for(let l=a;l>=r;l--)for(let r=i;r>=n;r--)if(!1===e((null==(t=s[l])?void 0:t[r])||this._defaultValue,l,r))return}getLastTruePosition(){let e;return this.iteratorReverse((t,r,a)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:a},!1}),e}getFirstTruePosition(){let e;return this.iterator((t,r,a)=>{if(null!=t&&t.isBoolean()&&!0===t.getValue())return e={row:r,column:a},!1}),e}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nE.create()}getLastCell(){let{endRow:e,endColumn:t}=this.getRangePosition();return this.get(e,t)||this._defaultValue||nE.create()}pick(e){let t=this.pickRaw(e);return this._createNewArray(t,1,t[0].length)}pickRaw(e){let t=e.getRowCount(),r=e.getColumnCount();if(t!==this._rowCount||r!==this._columnCount)return[[nE.create()]];let a=[];a[0]=[];for(let n=0;n<t;n++)for(let t=0;t<r;t++){let r=e.get(n,t);if(!(null==r||r.isError())&&!0===r.getValue()){let e=this.get(n,t);a[0].push(e)}}return a}flatten(){if(null!=this._flattenCache)return this._flattenCache;let e=[];e[0]=[];for(let t=0;t<this._rowCount;t++)for(let r=0;r<this._columnCount;r++){let a=this.get(t,r);e[0].push(a)}let t=this._createNewArray(e,1,e[0].length);return t.setDefaultValue(this._defaultValue),this._flattenCache=t,t}flattenPosition(){if(null!=this._flattenPosition)return this._flattenPosition;let e=[],t=[],r=[],a=[],n=0;for(let i=0;i<this._rowCount;i++)for(let s=0;s<this._columnCount;s++){let l=this.get(i,s);if(null==l||l.isError()||l.isNull()){n++;continue}l.isString()?(e.push(l),r.push(n++)):(t.push(l),a.push(n++))}let i={stringArray:e,numberArray:t,stringPosition:r,numberPosition:a};return this._flattenPosition=i,i}slice(e,t){let r=0,a=this._rowCount,n=1,i=0,s=this._columnCount,l=1;if(null!=e&&(r=e[0]||0,a=e[1]||this._rowCount,n=e[2]||1),null!=t&&(i=t[0]||0,s=t[1]||this._columnCount,l=t[2]||1),r>=this._rowCount||i>=this._columnCount)return;let u=`${r}_${a}_${n}_${i}_${s}_${l}`,o=this._sliceCache.get(u);if(null!=o)return o;let c=[],h=this._values,m=0,f=0;for(let e=r;e<a;e+=n){f=0,null==c[m]&&(c[m]=[]);for(let t=i;t<s;t+=l){if(!h[e])return;let r=h[e][t]||this._defaultValue;null==r&&(r=nE.create()),c[m][f]=r,f++}m++}if(0===c.length||0===c[0].length)return;let g=n>1?-1:r+this._currentRow,d=l>1?-1:i+this._currentColumn,N=this._createNewArray(c,c.length,c[0].length,g,d);return N.setDefaultValue(this._defaultValue),this._sliceCache.set(u,N),N}sortByRow(e){let t=this._transposeArray(this._values);t.sort(this._sort(e)),this._clearCache(),this._values=this._transposeArray(t)}sortByColumn(e){this._clearCache(),this._values.sort(this._sort(e))}transpose(){let e=this._transposeArray(this._values),t=this._rowCount,r=this._columnCount,a=this._createNewArray(e,r,t);return a.setDefaultValue(this._defaultValue),a}orderSearch(e,t=rT.MIN,r=!1,a=!1){let n,i,s,l;let u=/* @__PURE__ */B((r,u,o)=>{let c;return null==r||((null==(c=!0===a?r.compare(e,Z.EQUALS):r.isEqual(e))?void 0:c.getValue())===!0?(n=r,s={row:u,column:o},!1):void(t===rT.MAX?!0===r.isGreaterThan(e).getValue()&&(null==i||!0===r.minus(e).abs().isLessThanOrEqual(i.minus(e).abs()).getValue())&&(i=r,l={row:u,column:o}):t===rT.MIN&&!0===r.isLessThan(e).getValue()&&(null==i||!0===r.minus(e).abs().isLessThanOrEqual(i.minus(e).abs()).getValue())&&(i=r,l={row:u,column:o})))},"_handleMatch");return(r?this.iteratorReverse((e,t,r)=>u(e,t,r)):this.iterator((e,t,r)=>u(e,t,r)),null!=n)?s:null!=i?l:void 0}binarySearch(e,t=rO.MIN,r=rT.MIN){if(e.isError())return;let{stringArray:a,stringPosition:n,numberArray:i,numberPosition:s}=this.flattenPosition();return e.isString()?this._binarySearch(e,a,n,t,r):this._binarySearch(e,i,s,t,r)}_binarySearch(e,t,r,a=rO.MIN,n=rT.MIN){let i=rV(),s=Number(e.getValue()),l=!Number.isNaN(s),u=0,o=t.length-1,c=-1,h=-1,m=-1;for(;u<=o;){let r;let n=Math.floor((u+o)/2),f=t[n];if(f.isNull())r=a===rO.MIN?1:-1;else{let t=f.getValue();if(l){let e=Number(t);r=Number.isNaN(e)?1:Math.sign(e-s)}else r=i(t.toString().toLocaleLowerCase(),e.getValue().toString().toLocaleLowerCase())}if(a===rO.MAX&&(r=-r),0===r){c=n;break}r<0?(h=n,u=n+1):(m=n,o=n-1)}return n===rT.NORMAL?-1!==c?r[c]:void 0:n===rT.MIN?-1!==c?r[c]:a===rO.MIN?r[h]:r[m]:n===rT.MAX?-1!==c?r[c]:a===rO.MIN?r[m]:r[h]:void 0}sum(){let e=nR.create(0);return this.iterator(t=>!!(null==t||t.isString()||t.isBoolean()||t.isNull())||(t.isError()?(e=t,!1):void(e=e.plus(t)))),e}max(){let e=nR.create(Number.NEGATIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isLessThan(t).getValue()&&(e=t)))),e}min(){let e=nR.create(Number.POSITIVE_INFINITY);return this.iterator(t=>null==t||(t.isError()?(e=t,!1):!!(t.isString()||t.isNull()||t.isBoolean())||void(e.isGreaterThan(t).getValue()&&(e=t)))),e}count(){let e=nR.create(0);return this.iterator(t=>{if(null==t||t.isError()||t.isString()||t.isNull()||t.isBoolean())return!0;e=e.plusBy(1)}),e}countA(){let e=nR.create(0);return this.iterator(t=>{if(null==t||t.isNull())return!0;e=e.plusBy(1)}),e}countBlank(){let e=nR.create(0);return this.iterator(t=>{(null==t||t.isNull()||""===t.getValue())&&(e=e.plusBy(1))}),e}getNegative(){return e.create("{0}").minus(this)}getReciprocal(){return e.create("{1}").divided(this)}plus(e){return this._batchOperator(e,1)}minus(e){return this._batchOperator(e,0)}multiply(e){return this._batchOperator(e,2)}divided(e){return this._batchOperator(e,3)}mod(e){return this._batchOperator(e,4)}modInverse(e){return this.map(t=>t.isError()?t:e.mod(t))}compare(e,t,r){return this._batchOperator(e,5,t,r)}concatenateFront(e){return this._batchOperator(e,6)}concatenateBack(e){return this._batchOperator(e,7)}map(e){let t=/* @__PURE__ */B((t,r,a)=>null==t?nE.create():t.isError()?t:e(t,r,a),"wrappedCallbackFn");return this.mapValue(t)}mapValue(e){var t;let r=this._rowCount,a=this._columnCount,n=[];for(let i=0;i<r;i++){let r=[];for(let n=0;n<a;n++){let a=null==(t=this._values)?void 0:t[i];if(null==a)r[n]=rR.create(q.VALUE);else{let t=a[n]||this._defaultValue;t?r[n]=e(t,i,n):r[n]=nE.create()}}n.push(r)}return this._createNewArray(n,r,a)}pow(e){return this._batchOperator(e,8)}powInverse(e){return this.map(t=>t.isError()?t:e.pow(t))}sqrt(){return this.map(e=>e.isError()?e:e.sqrt())}cbrt(){return this.map(e=>e.isError()?e:e.cbrt())}cos(){return this.map(e=>e.isError()?e:e.cos())}cosh(){return this.map(e=>e.isError()?e:e.cosh())}acos(){return this.map(e=>e.isError()?e:e.acos())}acosh(){return this.map(e=>e.isError()?e:e.acosh())}sin(){return this.map(e=>e.isError()?e:e.sin())}sinh(){return this.map(e=>e.isError()?e:e.sinh())}asin(){return this.map(e=>e.isError()?e:e.asin())}asinh(){return this.map(e=>e.isError()?e:e.asinh())}tan(){return this.map(e=>e.isError()?e:e.tan())}tanh(){return this.map(e=>e.isError()?e:e.tanh())}atan(){return this.map(e=>e.isError()?e:e.atan())}atanh(){return this.map(e=>e.isError()?e:e.atanh())}atan2(e){return this._batchOperator(e,12)}atan2Inverse(e){return this.map(t=>t.isError()?t:e.atan2(t))}mean(e=0){let t=this.sum(),r=this.count();return t.divided(0===e?r:r.minusBy(1))}median(){let e=this.flattenPosition().numberArray,t=this._createNewArray([e],1,e.length),r=t.getColumnCount();if(r<=1)return t.get(0,0)||nE.create();if(t.sortByRow(0),r%2==0){let e=t.get(0,r/2)||nE.create(),a=t.get(0,r/2-1)||nE.create();return e.plus(a).divided(nR.create(2))}return t.get(0,(r-1)/2)||nE.create()}var(t=0){let r=this.mean(),a=[[]];this.iterator(e=>{if(null==e||e.isError()||e.isString()||e.isBoolean()||e.isNull())return;let t=e.minus(r).pow(nR.create(2));t.isError()||a[0].push(t)});let{_unitId:n,_sheetId:i,_currentRow:s,_currentColumn:l}=this;return e.create({calculateValueList:a,rowCount:1,columnCount:a[0].length,unitId:n,sheetId:i,row:s,column:l}).mean(t)}std(e=0){let t=this.var(e);return t.isError()?t:t.sqrt()}log(){return this.map(e=>e.isError()?e:e.log())}log10(){return this.map(e=>e.isError()?e:e.log10())}exp(){return this.map(e=>e.isError()?e:e.exp())}abs(){return this.map(e=>e.isError()?e:e.abs())}round(e){return this._batchOperator(e,9)}roundInverse(e){return this.map(t=>t.isError()?t:e.round(t))}floor(e){return this._batchOperator(e,10)}floorInverse(e){return this.map(t=>t.isError()?t:e.floor(t))}ceil(e){return this._batchOperator(e,11)}ceilInverse(e){return this.map(t=>t.isError()?t:e.ceil(t))}toValue(){return nU(this._values)}_clearCache(){this._flattenCache=null,this._sliceCache.clear()}_sort(e){let t=rV();return(r,a)=>{let n=r[e],i=a[e];return null==n?1:null==i?-1:n.isError()&&n.isError()?0:n.isError()?1:i.isError()?-1:t(n.getValue(),i.getValue())}}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}_batchOperator(e,t,r,a){let n=[],i=this._rowCount,s=this._columnCount;if(e.isArray()){let l=e.getRowCount(),u=e.getColumnCount();if(i=Math.max(l,i),s=Math.max(u,s),1===l&&1===u){let t=e.getFirstCell();for(let e=0;e<s;e++)n.push(t)}else{if(1!==l||!(this._columnCount>1))return this._batchOperatorArray(e,t,r,a);let i=e.getArrayValue();for(let e=0;e<s;e++)n.push(i[0][e])}}else for(let t=0;t<s;t++)n.push(e);let l=[];for(let e=0;e<s;e++){let i=n[e];this._batchOperatorValue(i,e,l,t,r,a)}let u=this._createNewArray(l,i,s);return u.setDefaultValue(nA.create(!1)),u}_batchOperatorValue(e,t,r,a,n,i){let s=this._rowCount,l=this.getUnitId(),u=this.getSheetId(),o=this.getCurrentRow(),c=this.getCurrentColumn();if(5===a){let{rowsInCache:h,rowsNotInCache:m}=tW.canUseCache(l,u,t+c,o,o+s-1);if(h.length>0){if(n===Z.EQUALS){let a=tW.getCellPositions(l,u,t+c,e.getValue(),h);null!=a&&a.forEach(e=>{if(e<o||e>o+s-1)return;let a=e-o;null==r[a]&&(r[a]=[]),r[a][t]=nA.create(!0)})}else{let a=tW.getCellValuePositions(l,u,t+c);null!=a&&a.forEach((a,l)=>{let u,c=nE.create();W.has(l)?c=rR.create(l):"string"==typeof l?c=nT.create(l):"number"==typeof l?c=nR.create(l):"boolean"==typeof l&&(c=nA.create(l)),((u=c.isError()?c:e.isError()?e:c.compare(e,n,i)).isError()||!0===u.getValue())&&a.forEach(e=>{e>=o&&e<=o+s-1&&(null==r[e-o]&&(r[e-o]=[]),r[e-o][t]=u)})})}if(m.length>0)for(let s of m){let[h,m]=s;for(let s=h;s<=m;s++)this.__batchOperatorRowValue(e,t,r,a,s,l,u,o,c,n,i);tW.setContinueBuildingCache(l,u,t+c,h,m)}return}}for(let h=0;h<s;h++)this.__batchOperatorRowValue(e,t,r,a,h,l,u,o,c,n,i);tW.setContinueBuildingCache(l,u,t+c,o,o+s-1)}__batchOperatorRowValue(e,t,r,a,n,i,s,l,u,o,c){let h=this.getValueOrDefault(n,t);if(null==r[n]&&(r[n]=[]),h&&e){if(h.isError())r[n][t]=h;else if(e.isError())r[n][t]=e;else switch(a){case 1:r[n][t]=h.plus(e);break;case 0:r[n][t]=h.minus(e);break;case 2:r[n][t]=h.multiply(e);break;case 3:r[n][t]=h.divided(e);break;case 4:r[n][t]=h.mod(e);break;case 5:o?r[n][t]=h.compare(e,o,c):r[n][t]=rR.create(q.VALUE);break;case 6:r[n][t]=h.concatenateFront(e);break;case 7:r[n][t]=h.concatenateBack(e);break;case 8:r[n][t]=h.pow(e);break;case 9:r[n][t]=h.round(e);break;case 10:r[n][t]=h.floor(e);break;case 12:r[n][t]=h.atan2(e);break;case 11:r[n][t]=h.ceil(e)}}else r[n][t]=rR.create(q.NA);null!=h&&(h.isError()?tW.set(i,s,t+u,h.getErrorType(),n+l):tW.set(i,s,t+u,h.getValue(),n+l))}_batchOperatorArray(e,t,r,a){let n=e.getRowCount(),i=e.getColumnCount();n<this._rowCount&&(n=this._rowCount),i<this._columnCount&&(i=this._columnCount);let s=[],l=this._checkArrayCalculateType(this),u=this._checkArrayCalculateType(e);for(let o=0;o<n;o++){let n=[];for(let s=0;s<i;s++){let i,c;if(i=3===l?this.getValueOrDefault(0,0):1===l?this.getValueOrDefault(0,s):2===l?this.getValueOrDefault(o,0):this.getValueOrDefault(o,s),c=3===u?e.getValueOrDefault(0,0):1===u?e.getValueOrDefault(0,s):2===u?e.getValueOrDefault(o,0):e.getValueOrDefault(o,s),i&&c){if(i.isError())n[s]=i;else if(c.isError())n[s]=c;else switch(t){case 1:n[s]=i.plus(c);break;case 0:n[s]=i.minus(c);break;case 2:n[s]=i.multiply(c);break;case 3:n[s]=i.divided(c);break;case 4:n[s]=i.mod(c);break;case 5:r?n[s]=i.compare(c,r,a):n[s]=rR.create(q.VALUE);break;case 6:n[s]=i.concatenateFront(c);break;case 7:n[s]=i.concatenateBack(c);break;case 8:n[s]=i.pow(c);break;case 9:n[s]=i.round(c);break;case 12:n[s]=i.atan2(c);break;case 10:n[s]=i.floor(c);break;case 11:n[s]=i.ceil(c)}}else n[s]=rR.create(q.NA)}s.push(n)}return this._createNewArray(s,n,i)}_checkArrayCalculateType(e){return 1===e.getRowCount()&&1===e.getColumnCount()?3:1===e.getRowCount()?1:1===e.getColumnCount()?2:0}_formatValue(e){if("string"!=typeof e)return this._rowCount=e.rowCount,this._columnCount=e.columnCount,this._unitId=e.unitId,this._sheetId=e.sheetId,this._currentRow=e.row,this._currentColumn=e.column,e.calculateValueList;let t=(e=e.slice(1,-1)).split(";"),r=t.length,a=[],n=0;for(let e=0;e<r;e++){let r=t[e].split(","),i=r.length;n<i&&(n=i);let s=[];for(let e=0;e<i;e++){let t=r[e].trim();s.push(nL.create(t))}a.push(s)}return this._rowCount=r,this._columnCount=n,a}_createNewArray(t,r,a,n=-1,i=-1){(-1===this._currentColumn||-1===this._currentRow)&&(n=-1,i=-1);let s={calculateValueList:t,rowCount:r,columnCount:a,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:n,column:i};return e.create(s)}};B(nD,"ArrayValueObject");let nP=class{static create(e){if(null==e)return nE.create();if("boolean"==typeof e)return nA.create(e);if("string"==typeof e){let t=e.toLocaleUpperCase().trim();if(W.has(t))return rR.create(t);if(t===$.TRUE||t===$.FALSE)return nV(e);if((0,P.isRealNum)(e))return nR.create(Number(e));let{isNumberPattern:r,value:a,pattern:n}=rd(e);if(r)return nR.create(a,n);let i=e.replace(/\n/g,"").replace(/\r/g,"");return!nw(i)&&eL(i)?nD.create(i):nI(e)}return"number"==typeof e?nM(e):rR.create(q.VALUE)}};B(nP,"ValueObjectFactory");let nL=nP;function nw(e){let t=e.trim();return t.startsWith('"')&&t.endsWith('"')}function nF(e,t,r,a){let n=[];if(r.isArray()){let i=r.getRowCount(),s=r.getColumnCount();if(1===i&&1===s){let a=r.getFirstCell();for(let r=0;r<e;r++){let e=[];for(let r=0;r<t;r++)e.push(a);n.push(e)}}else if(1===i&&s>1)for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(0,n)||(null!=a?a:nE.create());e.push(t)}n.push(e)}else if(1===s&&i>1)for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(i,0)||(null!=a?a:nE.create());e.push(t)}n.push(e)}else for(let i=0;i<e;i++){let e=[];for(let n=0;n<t;n++){let t=r.getRealValue(i,n)||(null!=a?a:nE.create());e.push(t)}n.push(e)}}else for(let a=0;a<e;a++){let e=[];for(let a=0;a<t;a++)e.push(r);n.push(e)}return nj(n,e,t)}function nj(e,t,r,a="",n=""){return nD.create({calculateValueList:e,rowCount:t,columnCount:r,unitId:a,sheetId:n,row:-1,column:-1})}function nB(e){for(let t of[Z.EQUALS,Z.NOT_EQUAL,Z.GREATER_THAN_OR_EQUAL,Z.GREATER_THAN,Z.LESS_THAN_OR_EQUAL,Z.LESS_THAN])if(e.startsWith(t)){let r=e.substring(t.length);return[t,nL.create(r)]}return[Z.EQUALS,nL.create(e)]}function nk(e,t,r,a){if(!r){if(t.isString()){let[e,a]=nB(`${t.getValue()}`);r=e,t=a}else r=Z.EQUALS}return e.compare(t,r,a)}function n$(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t);return n.mapValue((e,t,r)=>{let a=i.get(t,r);return null!=e&&e.isError()?e:null!=a&&a.isError()?a:null!=e&&e.isBoolean()&&null!=a&&a.isBoolean()?nV(e.getValue()&&a.getValue()):nA.create(!1)})}function nY(e){let t=e.getValue(),r=0;return t&&(r=1),nR.create(r)}function nH(e){return!!e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()||(e.isReferenceObject()?!!(e.isCell()||1===e.getRowCount()&&1===e.getColumnCount()):!!(e.isString()||e.isNumber()||e.isBoolean()||e.isError()||e.isNull()))}function nG(e){let t=null==e?void 0:e.getPattern(),r={};if(t&&(r={s:{n:{pattern:t}}}),null==e)return{v:null,...r};if(e.isError())return{v:e.getErrorType(),t:P.CellValueType.STRING,...r};if(e.isValueObject()){let t=e.getValue();return e.isNumber()?{v:t,t:P.CellValueType.NUMBER,...r}:e.isBoolean()?{v:t?1:0,t:P.CellValueType.BOOLEAN,...r}:e.isString()?{v:t,t:P.CellValueType.STRING,...r}:e.isNull()?{v:null,...r}:{v:t,t:P.CellValueType.STRING,...r}}}function nq(e){let t=0,r=0;return e.forEach((e,a)=>{a%2==1&&(e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1)))}),{maxRowLength:t,maxColumnLength:r}}function nW(e,t,r,a){let n=t.getRowCount(),i=t.getColumnCount();for(let t=0;t<e.length;t++){if(t%2==1)continue;let s=e[t],l=s.getRowCount(),u=s.getColumnCount();if(l!==n||u!==i)return nF(r,a,rR.create(q.VALUE))}return null}function nQ(e,t,r,a=!1){let n=[];for(let i=0;i<e.length;i++){if(i%2==1)continue;let s=e[i];nF(t,r,e[i+1],rR.create(q.NA)).iterator((e,t,r)=>{if(!e)return;let i=nk(s,e),[,l]=nB(`${e.getValue()}`);if(a&&(i=nX(i,s,l)),void 0===n[t]&&(n[t]=[]),void 0===n[t][r]){n[t][r]=i;return}n[t][r]=n$(n[t][r],i)})}return n}function nX(e,t,r){return e.mapValue((e,a,n)=>{let i=t.get(a,n);return i&&nK(i,r)?e:null!=i&&i.isError()&&r.isError()&&i.getValue()===r.getValue()?nA.create(!0):nA.create(!1)})}function nK(e,t){if(e.isNumber()&&t.isNumber()||e.isBoolean()&&t.isBoolean())return!0;let r=e.isString()&&""===e.getValue(),a=t.isString()&&""===t.getValue();return!!((r||e.isNull())&&(a||t.isNull())||e.isString()&&!r&&t.isString()&&!a)}B(nw,"isStringWrappedByDoubleQuotes"),B(nF,"expandArrayValueObject"),B(nj,"createNewArray"),B(nB,"findCompareToken"),B(nk,"valueObjectCompare"),B(n$,"booleanObjectIntersection"),B(nY,"convertTonNumber"),B(nH,"isSingleValueObject"),B(nG,"objectValueToCellValue"),B(nq,"calculateMaxDimensions"),B(nW,"getErrorArray"),B(nQ,"getBooleanResults"),B(nX,"filterSameValueObjectResult"),B(nK,"isSameValueObjectType");var nZ,nz=Object.defineProperty,nJ=Object.getOwnPropertyDescriptor,n0=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?nJ(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&nz(t,r,i),i},"__decorateClass$j"),n1=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$j"),n2=((_=n2||{})[_.IDLE=0]="IDLE",_[_.START=1]="START",_[_.START_DEPENDENCY=2]="START_DEPENDENCY",_[_.START_CALCULATION=3]="START_CALCULATION",_[_.CURRENTLY_CALCULATING=4]="CURRENTLY_CALCULATING",_[_.START_DEPENDENCY_ARRAY_FORMULA=5]="START_DEPENDENCY_ARRAY_FORMULA",_[_.START_CALCULATION_ARRAY_FORMULA=6]="START_CALCULATION_ARRAY_FORMULA",_[_.CURRENTLY_CALCULATING_ARRAY_FORMULA=7]="CURRENTLY_CALCULATING_ARRAY_FORMULA",_[_.CALCULATION_COMPLETED=8]="CALCULATION_COMPLETED",_),n3=((C=n3||{})[C.INITIAL=0]="INITIAL",C[C.STOP_EXECUTION=1]="STOP_EXECUTION",C[C.NOT_EXECUTED=2]="NOT_EXECUTED",C[C.SUCCESS=3]="SUCCESS",C);let n5=(B(nZ=class extends P.Disposable{constructor(e){super(),k(this,"_formulaExecuteStage",0),k(this,"_stopState",!1),k(this,"_currentRow",-1),k(this,"_currentColumn",-1),k(this,"_currentRowCount",Number.NEGATIVE_INFINITY),k(this,"_currentColumnCount",Number.NEGATIVE_INFINITY),k(this,"_currentSubUnitId",""),k(this,"_currentUnitId",""),k(this,"_runtimeData",{}),k(this,"_runtimeOtherData",{}),k(this,"_unitArrayFormulaRange",{}),k(this,"_runtimeArrayFormulaCellData",{}),k(this,"_runtimeClearArrayFormulaCellData",{}),k(this,"_runtimeFeatureRange",{}),k(this,"_runtimeFeatureCellData",{}),k(this,"_functionsExecutedState",0),k(this,"_functionDefinitionPrivacyVar",/* @__PURE__ */new Map),k(this,"_totalFormulasToCalculate",0),k(this,"_completedFormulasCount",0),k(this,"_totalArrayFormulasToCalculate",0),k(this,"_completedArrayFormulasCount",0),k(this,"_formulaCycleIndex",0),k(this,"_isCycleDependency",!1),this._currentConfigService=e}get currentRow(){return this._currentRow}get currentColumn(){return this._currentColumn}get currentRowCount(){return this._currentRowCount}get currentColumnCount(){return this._currentColumnCount}get currentSubUnitId(){return this._currentSubUnitId}get currentUnitId(){return this._currentUnitId}dispose(){this.reset(),this._runtimeFeatureCellData={},this._runtimeFeatureRange={},this.clearReferenceAndNumberformatCache()}enableCycleDependency(){this._isCycleDependency=!0}disableCycleDependency(){this._isCycleDependency=!1}isCycleDependency(){return this._isCycleDependency}setFormulaCycleIndex(e){this._formulaCycleIndex=e}getFormulaCycleIndex(){return this._formulaCycleIndex}setTotalArrayFormulasToCalculate(e){this._totalArrayFormulasToCalculate=e}getTotalArrayFormulasToCalculate(){return this._totalArrayFormulasToCalculate}setCompletedArrayFormulasCount(e){this._completedArrayFormulasCount=e}getCompletedArrayFormulasCount(){return this._completedArrayFormulasCount}setTotalFormulasToCalculate(e){this._totalFormulasToCalculate=e}getTotalFormulasToCalculate(){return this._totalFormulasToCalculate}setCompletedFormulasCount(e){this._completedFormulasCount=e}getCompletedFormulasCount(){return this._completedFormulasCount}markedAsSuccessfullyExecuted(){this._functionsExecutedState=3}markedAsNoFunctionsExecuted(){this._functionsExecutedState=2}markedAsStopFunctionsExecuted(){this._functionsExecutedState=1}markedAsInitialFunctionsExecuted(){this._functionsExecutedState=0}stopExecution(){this._stopState=!0,this.setFormulaExecuteStage(0)}isStopExecution(){return this._stopState}setFormulaExecuteStage(e){this._formulaExecuteStage=e}getFormulaExecuteStage(){return this._formulaExecuteStage}reset(){this._formulaExecuteStage=0,this._runtimeData={},this._runtimeOtherData={},this._unitArrayFormulaRange={},this._runtimeArrayFormulaCellData={},this._runtimeClearArrayFormulaCellData={},this._functionDefinitionPrivacyVar.clear(),this.markedAsInitialFunctionsExecuted(),this._stopState=!1,this._isCycleDependency=!1,this._totalFormulasToCalculate=0,this._completedFormulasCount=0}clearReferenceAndNumberformatCache(){rs(),r_(),tO()}setCurrent(e,t,r,a,n,i){this._currentRow=e,this._currentColumn=t,this._currentRowCount=r,this._currentColumnCount=a,this._currentSubUnitId=n,this._currentUnitId=i}clearFunctionDefinitionPrivacyVar(){this._functionDefinitionPrivacyVar.clear()}registerFunctionDefinitionPrivacyVar(e,t){this._functionDefinitionPrivacyVar.set(e,t)}getFunctionDefinitionPrivacyVar(e){return this._functionDefinitionPrivacyVar.get(e)}setRuntimeOtherData(e,t){let r=this._currentSubUnitId,a=this._currentUnitId;void 0===this._runtimeOtherData[a]&&(this._runtimeOtherData[a]={});let n=this._runtimeOtherData[a];void 0===n[r]&&(n[r]={});let i=n[r],s=[];if(t.isReferenceObject()||t.isValueObject()&&t.isArray()){let{startRow:e,startColumn:r}=t.getRangePosition();t.iterator((t,a,n)=>{let i=nG(t),l=a-e;null==s[l]&&(s[l]=[]),s[l][n-r]=i})}else s=[[nG(t)]];i[e]=s}setRuntimeData(e){let t=this._currentRow,r=this._currentColumn,a=this._currentRowCount,n=this.currentColumnCount,i=this._currentSubUnitId,s=this._currentUnitId;null==this._runtimeData[s]&&(this._runtimeData[s]={});let l=this._runtimeData[s];null==l[i]&&(l[i]=new P.ObjectMatrix),null==this._unitArrayFormulaRange[s]&&(this._unitArrayFormulaRange[s]={});let u=this._unitArrayFormulaRange[s];(null===u[i]||void 0===u[i])&&(u[i]={});let o=new P.ObjectMatrix(u[i]);void 0===this._runtimeArrayFormulaCellData[s]&&(this._runtimeArrayFormulaCellData[s]={});let c=this._runtimeArrayFormulaCellData[s];null==c[i]&&(c[i]=new P.ObjectMatrix),void 0===this._runtimeClearArrayFormulaCellData[s]&&(this._runtimeClearArrayFormulaCellData[s]={});let h=this._runtimeClearArrayFormulaCellData[s];null==h[i]&&(h[i]=new P.ObjectMatrix);let m=l[i],f=c[i],g=h[i];if(e.isReferenceObject()||e.isValueObject()&&e.isArray()){let{startRow:l,startColumn:u,endRow:c,endColumn:h}=e.getRangePosition();if(l===c&&u===h){let a=nG(e.getFirstCell());m.setValue(t,r,a),g.setValue(t,r,a);return}let d={startRow:t,startColumn:r,endRow:c-l+t,endColumn:h-u+r};if(o.setValue(t,r,d),this._checkIfArrayFormulaRangeHasData(s,i,t,r,d)||this._checkIfArrayFormulaExceeded(a,n,d)){let a=nG(rR.create(q.SPILL));m.setValue(t,r,a),g.setValue(t,r,a);let n=this._currentConfigService.getUnitData();e.iterator((e,o,c)=>{var h,m;let g=o-l+t,d=c-u+r,N=null==(m=null==(h=n[s])?void 0:h[i])?void 0:m.cellData.getValue(g,d);if(o===l&&c===u)f.setValue(t,r,a);else if(null!=N)null==N.v&&(N.v=""),f.setValue(g,d,N);else{if(this._isInOtherArrayFormulaRange(s,i,t,r,g,d))return!0;f.setValue(g,d,{v:""})}})}else{let a=rR.create(q.SPILL);e.iterator((e,n,i)=>{let s=nG(e);if(n===l&&i===u){if(null!=e&&e.isError()&&e.isEqualType(a))return g.setValue(t,r,{}),m.setValue(t,r,{...nG(a)}),!1;m.setValue(t,r,{...s})}let o=n-l+t,c=i-u+r;f.setValue(o,c,s)})}}else{let a=nG(e);m.setValue(t,r,a),g.setValue(t,r,a)}}getUnitData(){return this._runtimeData}getUnitArrayFormula(){return this._unitArrayFormulaRange}getRuntimeOtherData(){return this._runtimeOtherData}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}getRuntimeClearArrayFormulaCellData(){return this._runtimeClearArrayFormulaCellData}getRuntimeFeatureRange(){return this._runtimeFeatureRange}setRuntimeFeatureRange(e,t){this._runtimeFeatureRange[e]=t}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e,t){this._runtimeFeatureCellData[e]=t}getAllRuntimeData(){return{unitData:this.getUnitData(),arrayFormulaRange:this.getUnitArrayFormula(),unitOtherData:this.getRuntimeOtherData(),functionsExecutedState:this._functionsExecutedState,arrayFormulaCellData:this.getRuntimeArrayFormulaCellData(),clearArrayFormulaCellData:this.getRuntimeClearArrayFormulaCellData(),runtimeFeatureRange:this.getRuntimeFeatureRange(),runtimeFeatureCellData:this.getRuntimeFeatureCellData()}}getRuntimeState(){return{totalFormulasToCalculate:this.getTotalFormulasToCalculate(),completedFormulasCount:this.getCompletedFormulasCount(),totalArrayFormulasToCalculate:this.getTotalArrayFormulasToCalculate(),completedArrayFormulasCount:this.getCompletedArrayFormulasCount(),stage:this.getFormulaExecuteStage(),formulaCycleIndex:this.getFormulaCycleIndex()}}_checkIfArrayFormulaRangeHasData(e,t,r,a,n){var i,s,l,u,o,c,h,m,f,g,d;let{startRow:N,startColumn:_,endRow:C,endColumn:E}=n,p=this._currentConfigService.getUnitData(),A=this._currentConfigService.getArrayFormulaCellData();null==(l=null==(s=null==(i=this._unitArrayFormulaRange[e])?void 0:i[t])?void 0:s[r])||l[a];for(let n=N;n<=C;n++)for(let i=_;i<=E;i++){if(n===r&&a===i)continue;let s=null==(c=null==(o=null==(u=this._runtimeData)?void 0:u[e])?void 0:o[t])?void 0:c.getValue(n,i);null==(m=null==(h=null==A?void 0:A[e])?void 0:h[t])||m.getValue(n,i);let l=null==(d=null==(g=null==(f=null==p?void 0:p[e])?void 0:f[t])?void 0:g.cellData)?void 0:d.getValue(n,i),N=this._getRuntimeFeatureCellValue(n,i,t,e);if(!(0,P.isNullCell)(s)||this._isInOtherArrayFormulaRange(e,t,r,a,n,i)||!(0,P.isNullCell)(l)||!(0,P.isNullCell)(N))return!0}return!1}_getRuntimeFeatureCellValue(e,t,r,a){return re(e,t,r,a,this._runtimeFeatureCellData)}_arrayCellHasData(e){return null!=e&&void 0!==e.v}_isInOtherArrayFormulaRange(e,t,r,a,n,i){var s;let l=null==(s=this._currentConfigService.getArrayFormulaRange()[e])?void 0:s[t];if(null==l)return!1;let u=!1;return new(0,P.ObjectMatrix)(l).forValue((s,l,o)=>{var c,h;if(s===r&&l===a)return;let m=this._isInArrayFormulaRange(o,n,i),f=null==(h=null==(c=this._runtimeData[e])?void 0:c[t])?void 0:h.getValue(s,l);m&&(null==f?void 0:f.v)!==q.SPILL&&(u=!0)}),u}_isInArrayFormulaRange(e,t,r){if(null==e)return!1;let{startRow:a,startColumn:n,endRow:i,endColumn:s}=e;return t>=a&&t<=i&&r>=n&&r<=s}_checkIfArrayFormulaExceeded(e,t,r){return r.endRow>=e||r.endColumn>=t}_isInDirtyRange(e,t,r,a){let n=this._currentConfigService.getDirtyRanges();return 0===n.length||G(n,e,t,r,a)}},"FormulaRuntimeService"),nZ);n5=n0([n1(0,t3)],n5);let n4=(0,P.createIdentifier)("univer.formula.runtime.service");var n6=((E=n6||{})[E.REFERENCE=1]="REFERENCE",E[E.VALUE=2]="VALUE",E[E.OPERATOR=3]="OPERATOR",E[E.FUNCTION=4]="FUNCTION",E[E.LAMBDA=5]="LAMBDA",E[E.LAMBDA_PARAMETER=6]="LAMBDA_PARAMETER",E[E.ERROR=7]="ERROR",E[E.BASE=8]="BASE",E[E.ROOT=9]="ROOT",E[E.UNION=10]="UNION",E[E.PREFIX=11]="PREFIX",E[E.SUFFIX=12]="SUFFIX",E[E.NULL=13]="NULL",E);let n9=/* @__PURE__ */new Map([[1,7],[2,9],[3,8],[4,6],[5,1],[6,2],[9,10],[10,3],[11,4],[12,5]]),n7=class{constructor(e){k(this,"_children",[]),k(this,"_definedNames",[]),k(this,"_parent"),k(this,"_valueObject"),k(this,"_calculateState",!1),k(this,"_async",!1),k(this,"_address",!1),k(this,"_isForcedCalculateFunction",!1),this._token=e}dispose(){var e;this._children.forEach(e=>{e.dispose()}),null==(e=this._valueObject)||e.dispose(),this._parent=null}get nodeType(){return n6.BASE}isAsync(){return this._async}isAddress(){return this._address}isForcedCalculateFunction(){return this._isForcedCalculateFunction}setAsync(){this._async=!0}setAddress(){this._address=!0}getParent(){return this._parent}setParent(e){this._parent=e,e.addChildren(this)}setForcedCalculateFunction(){this._isForcedCalculateFunction=!0}getChildren(){return this._children}addChildren(...e){this._children.push(...e)}getToken(){return this._token}setValue(e){this._valueObject=e}getValue(){return this._valueObject}isCalculated(){return this._calculateState}setCalculated(){this._calculateState=!0}execute(){}setNotEmpty(e=!0){}async executeAsync(){return Promise.resolve(Y.SUCCESS)}serialize(){let e=this.getToken(),t=this.getChildren(),r=[],a=t.length;for(let e=0;e<a;e++){let a=t[e];r.push(a.serialize())}let n={token:e,nodeType:this.nodeType};return a>0&&(n.children=r),n}hasDefinedName(e){return this._definedNames.includes(e)}setDefinedNames(e){this._definedNames=e}};B(n7,"BaseAstNode");let n8=n7,ie=class e extends n8{constructor(e){super(e),k(this,"_errorValueObject"),this._errorValueObject=rR.create(e)}get nodeType(){return n6.ERROR}static create(t){return new e(t)}getValue(){return this._errorValueObject}};B(ie,"ErrorNode");let it=class{get zIndex(){return 0}dispose(){}create(e,t,r){return new n8(e instanceof tI?e.getToken():e)}};B(it,"BaseAstNodeFactory");let ir=it,ia=class extends n8{get nodeType(){return n6.ROOT}execute(){let e=this.getChildren();if(e.length>1){this.setValue(rR.create(q.VALUE));return}let t=e[0];null==t?this.setValue(rR.create(q.VALUE)):this.setValue(t.getValue())}};B(ia,"AstRootNode");let ii=class extends ir{get zIndex(){return n9.get(n6.ROOT)||100}checkAndCreateNodeType(e){if(e instanceof tI&&"R_1"===e.getToken())return new ia("R_1")}};B(ii,"AstRootNodeFactory");let is=(0,P.createIdentifier)("univer.formula-function.service"),il=class extends P.Disposable{constructor(){super(...arguments),k(this,"_functionExecutors",/* @__PURE__ */new Map),k(this,"_functionDescriptions",/* @__PURE__ */new Map)}dispose(){this._functionExecutors.clear(),this._functionDescriptions.clear()}registerExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.set(r.name,r)}}getExecutors(){return this._functionExecutors}getExecutor(e){return this._functionExecutors.get(e)}hasExecutor(e){return this._functionExecutors.has(e)}unregisterExecutors(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionExecutors.delete(r)}}registerDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.set(r.functionName,r)}return(0,P.toDisposable)(()=>{for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r.functionName)}})}getDescriptions(){return this._functionDescriptions}getDescription(e){return this._functionDescriptions.get(e)}hasDescription(e){return this._functionDescriptions.has(e)}unregisterDescriptions(...e){for(let t=0;t<e.length;t++){let r=e[t];this._functionDescriptions.delete(r)}}};B(il,"FunctionService");var iu=((p=iu||{}).COMPARE="COMPARE",p.DIVIDED="DIVIDED",p.MINUS="MINUS",p.MULTIPLY="MULTIPLY",p.PLUS="PLUS",p.UNION="UNION",p.CUBE="CUBE",p),io=Object.defineProperty,ic=Object.getOwnPropertyDescriptor,ih=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ic(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&io(t,r,i),i},"__decorateClass$i"),im=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$i");let ig=class extends n8{constructor(e,t,r){super(t),this._accessor=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return n6.PREFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");this._operatorString===en.MINUS?(e.isReferenceObject()&&(e=e.toArrayValueObject()),t=this._functionExecutor.calculate(nR.create(0),e)):t=this._operatorString===en.AT?this._handlerAT(e):rR.create(q.VALUE),this.setValue(t)}_handlerAT(e){if(!e.isReferenceObject()||e.isCell())return rR.create(q.VALUE);let t=this._accessor.get(n4),r=t.currentRow||0,a=t.currentColumn||0,{startRow:n,startColumn:i,endRow:s,endColumn:l}=e.getRangePosition();return l!==i&&s!==n||n===s&&i===l?rR.create(q.VALUE):s===n&&a>=i&&a<=l?e.getCellByColumn(a):i===l&&r>=n&&r<=s?e.getCellByRow(r):e.isTable()?e.getCellByPosition(r):rR.create(q.VALUE)}};B(ig,"PrefixNode");let id=(B(iR=class extends ir{constructor(e,t){super(),this._functionService=e,this._injector=t}get zIndex(){return n9.get(n6.PREFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tI))return;let t=e.getToken(),r=t.trim();if('"'===r.charAt(0)&&'"'===r.charAt(r.length-1))return;let a="";if(r!==en.MINUS)return r===en.AT?new ig(this._injector,r):void 0;a=iu.MINUS;let n=this._functionService.getExecutor(a);return n?new ig(this._injector,r,n):(console.error(`No function ${t}`),ie.create(q.NAME))}},"PrefixNodeFactory"),iR);function iN(e,t,r){let a,n,i=e,s=i.slice(0,2),l=0;if(s[0]===en.MINUS){let e=t.getExecutor(iu.MINUS);a=new ig(r,en.MINUS,e),l++}return s[0]===en.AT&&(n=new ig(r,en.AT),a&&n.setParent(a),l++),l>0&&(i=i.slice(l)),{tokenTrim:i,minusPrefixNode:a,atPrefixNode:n}}id=ih([im(0,is),im(1,(0,P.Inject)(P.Injector))],id),RegExp(en.MINUS,"g"),RegExp(en.AT,"g"),B(iN,"prefixHandler");var i_=Object.defineProperty,iC=Object.getOwnPropertyDescriptor,iE=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?iC(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&i_(t,r,i),i},"__decorateClass$h"),ip=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$h");let iA=class extends n8{constructor(e,t,r,a,n){super(e),this._functionExecutor=t,this._currentConfigService=r,this._runtimeService=a,this._definedNamesService=n,this._functionExecutor.isAsync()&&this.setAsync(),this._functionExecutor.isAddress()&&this.setAddress(),this._functionExecutor.needsLocale&&this._setLocale(),this._functionExecutor.needsSheetsInfo&&this._setSheetsInfo()}get nodeType(){return n6.FUNCTION}async executeAsync(){let e;let t=[],r=this.getChildren(),a=r.length;this._compatibility();for(let e=0;e<a;e++){let a=r[e].getValue();null!=a&&(a.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?t.push(a.toArrayValueObject()):t.push(a))}let n=this._calculate(t);return e=n.isAsyncObject()||n.isAsyncArrayObject()?await n.getValue():n,this._setRefData(e),this.setValue(e),Promise.resolve(Y.SUCCESS)}execute(){let e=[],t=this.getChildren(),r=t.length;this._compatibility();for(let a=0;a<r;a++){let r=t[a].getValue();null!=r&&(r.isReferenceObject()&&!this._functionExecutor.needsReferenceObject?e.push(r.toArrayValueObject()):e.push(r))}let a=this._calculate(e);this._setRefData(a),this.setValue(a)}_compatibility(){this._lookupCompatibility()}_lookupCompatibility(){let e=this.getChildren(),t=e.length;if(!this._functionExecutor.needsExpandParams||3!==t)return;let r=e[1].getValue(),a=e[2].getValue();if(!(null!=r&&r.isReferenceObject())&&!(null!=a&&a.isReferenceObject()))return;let n=r.getRangeData(),i=a.getRangeData(),{startRow:s,startColumn:l,endRow:u,endColumn:o}=n,c=u-s+1,h=o-l+1,{startRow:m,startColumn:f,endRow:g,endColumn:d}=i,N=g-m+1,_=d-f+1;c!==N&&(i.endRow+=c-N),h!==_&&(i.endColumn+=h-_)}_calculate(e){var t;let r;let{minParams:a,maxParams:n}=this._functionExecutor;if(-1!==a&&-1!==n&&(e.length<a||e.length>n))return rR.create(q.NA);if(this._setRefInfo(),this._functionExecutor.isCustom()){let a=this._functionExecutor.calculateCustom(...e.map(e=>e.isArray()?e.toValue():e.getValue()));if("object"!=typeof a||null==a)r=nL.create(a);else{let e=nv(a);r=nD.create({calculateValueList:e,rowCount:e.length,columnCount:(null==(t=e[0])?void 0:t.length)||0,unitId:"",sheetId:"",row:-1,column:-1})}}else this._functionExecutor.isAddress()&&this._setDefinedNamesForFunction(),r=this._functionExecutor.calculate(...e);return r}_setDefinedNamesForFunction(){let e=this._currentConfigService.getExecuteUnitId();if(null==e)return;let t=this._definedNamesService.getDefinedNameMap(e);null!=t&&this._functionExecutor.setDefinedNames(t)}_setRefInfo(){let{currentUnitId:e,currentSubUnitId:t,currentRow:r,currentColumn:a}=this._runtimeService;this._functionExecutor.setRefInfo(e,t,r,a)}_setRefData(e){e.isReferenceObject()&&(e.setForcedSheetId(this._currentConfigService.getSheetNameMap()),e.setUnitData(this._currentConfigService.getUnitData()),e.setArrayFormulaCellData(this._currentConfigService.getArrayFormulaCellData()),e.setRuntimeData(this._runtimeService.getUnitData()),e.setRuntimeArrayFormulaCellData(this._runtimeService.getRuntimeArrayFormulaCellData()),e.setRuntimeFeatureCellData(this._runtimeService.getRuntimeFeatureCellData()))}_setLocale(){this._functionExecutor.setLocale(this._currentConfigService.getLocale())}_setSheetsInfo(){this._functionExecutor.setSheetsInfo(this._currentConfigService.getSheetsInfo())}};B(iA,"FunctionNode");let ib=class extends n8{constructor(e="Error"){super(e)}get nodeType(){return n6.FUNCTION}async executeAsync(){return this.setValue(rR.create(q.NAME)),Promise.resolve(Y.SUCCESS)}execute(){this.setValue(rR.create(q.NAME))}};B(ib,"ErrorFunctionNode");let iy=(B(iS=class extends ir{constructor(e,t,r,a,n){super(),this._functionService=e,this._currentConfigService=t,this._runtimeService=r,this._definedNamesService=a,this._injector=n}get zIndex(){return n9.get(n6.FUNCTION)||100}create(e){let t=this._functionService.getExecutor(e);return t?new iA(e,t,this._currentConfigService,this._runtimeService,this._definedNamesService):(console.error(`No function ${e}`),ie.create(q.NAME))}checkAndCreateNodeType(e){if("string"==typeof e)return;let{tokenTrim:t,minusPrefixNode:r,atPrefixNode:a}=iN(e.getToken().trim(),this._functionService,this._injector);if(!Number.isNaN(Number(t))&&!this._isParentUnionNode(e))return ie.create(q.VALUE);let n=t.toUpperCase();if(this._functionService.hasExecutor(n)){let e=this.create(n);return a?e.setParent(a):r&&e.setParent(r),e}}_isParentUnionNode(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken())===et.COLON}},"FunctionNodeFactory"),iS);iy=iE([ip(0,is),ip(1,t3),ip(2,n4),ip(3,ta),ip(4,(0,P.Inject)(P.Injector))],iy);var iR,iS,iO,iT=Object.defineProperty,iV=Object.getOwnPropertyDescriptor,iI=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?iV(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&iT(t,r,i),i},"__decorateClass$g"),iM=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$g");let ix=(B(iO=class extends P.Disposable{constructor(e){super(),this._runtimeService=e}async executeAsync(e){if(!e)return Promise.resolve(rR.create(q.VALUE));let t=e.node,r=e.refOffsetX,a=e.refOffsetY;await this._executeAsync(t,r,a);let n=t.getValue();return null==n?Promise.resolve(rR.create(q.VALUE)):Promise.resolve(n)}execute(e){if(!e)return rR.create(q.VALUE);let t=e.node,r=e.refOffsetX,a=e.refOffsetY;this._execute(t,r,a);let n=t.getValue();return null==n?rR.create(q.VALUE):n}executePreCalculateNode(e){return e.execute(),e.getValue()}checkAsyncNode(e){let t=[];this._checkAsyncNode(e,t);for(let e=0,r=t.length;e<r;e++)if(!0===t[e])return!0;return!1}_checkAsyncNode(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];t.push(a.isAsync()),this._checkAsyncNode(a,t)}}async _executeAsync(e,t=0,r=0){if(this._runtimeService.isStopExecution())return Promise.resolve(Y.ERROR);let a=e.getChildren(),n=a.length;for(let e=0;e<n;e++){let n=a[e];if(n.getToken().toUpperCase()===tb&&n.isEmptyParamFunction()){n.execute();continue}await this._executeAsync(n,t,r)}return e.nodeType===n6.REFERENCE&&e.setRefOffset(t,r),e.nodeType===n6.FUNCTION&&e.isAsync()?await e.executeAsync():e.execute(),Promise.resolve(Y.SUCCESS)}_execute(e,t=0,r=0){if(this._runtimeService.isStopExecution())return Y.ERROR;let a=e.getChildren(),n=a.length;for(let e=0;e<n;e++){let n=a[e];if(n.getToken().toUpperCase()===tb&&n.isEmptyParamFunction()){n.execute();continue}this._execute(n,t,r)}return e.nodeType===n6.REFERENCE&&e.setRefOffset(t,r),e.execute(),Y.SUCCESS}},"Interpreter"),iO);function iv(e){return e instanceof tI&&"L_1"===e.getToken()}function iU(e){return e instanceof tI&&e.getToken()===tA}function iD(e,t,r){let a=e.getChildren(),n=a.length,i=a[0];for(let e=0;e<n;e++){let n=a[e];if(!(iv(i)&&0!==e)){if(n instanceof tI)iD(n,t,r);else{let i=n.trim();if(r.has(i)){let n=new tI;n.setToken(tp),n.setLambdaId(t),n.setLambdaPrivacyVar(r),n.setLambdaParameter(i),a[e]=n}}}}}function iP(e){if(null===e)return 0;if(null!=e&&e.p){let t=null==e?void 0:e.p.body;if(null==t)return 0;let r=t.dataStream;return(0,P.BuildTextUtils).transform.getPlainText(r)}return(null==e?void 0:e.v)||0}ix=iI([iM(0,n4)],ix),B(iv,"isFirstChildParameter"),B(iU,"isChildRunTimeParameter"),B(iD,"updateLambdaStatement"),B(iP,"getCellValue");let iL=new tE(1e5),iw=class extends rE{constructor(e){super(),k(this,"_forcedSheetId",""),k(this,"_forcedSheetName",""),k(this,"_defaultSheetId",""),k(this,"_rangeData",{startColumn:-1,startRow:-1,endRow:-1,endColumn:-1}),k(this,"_unitData",{}),k(this,"_unitStylesData",{}),k(this,"_defaultUnitId",""),k(this,"_forcedUnitId",""),k(this,"_runtimeData",{}),k(this,"_arrayFormulaCellData",{}),k(this,"_runtimeArrayFormulaCellData",{}),k(this,"_runtimeFeatureCellData",{}),k(this,"_refOffsetX",0),k(this,"_refOffsetY",0),this._token=e}dispose(){this._unitData={},this._unitStylesData={},this._runtimeData={}}getToken(){return this._token}setToken(e){this._token=e}isExceedRange(){let{startRow:e,endRow:t,startColumn:r,endColumn:a}=this.getRangePosition();return e<0||r<0||t>=this.getActiveSheetRowCount()||a>=this.getActiveSheetColumnCount()}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}getRangePosition(){let{startRow:e,startColumn:t,endRow:r,endColumn:a}=(0,P.moveRangeByOffset)(this._rangeData,this._refOffsetX,this._refOffsetY);return Number.isNaN(e)&&(e=0),Number.isNaN(t)&&(t=0),Number.isNaN(r)&&(r=this.getActiveSheetRowCount()-1),Number.isNaN(a)&&(a=this.getActiveSheetColumnCount()-1),{...this._rangeData,startRow:e,endRow:r,startColumn:t,endColumn:a}}isReferenceObject(){return!0}iterator(e){let{startRow:t,endRow:r,startColumn:a,endColumn:n}=this.getRangePosition();if(this._checkIfWorksheetMiss())return e(rR.create(q.VALUE),t,a);let i=this._forcedUnitId||this._defaultUnitId,s=this._forcedSheetId||this._defaultSheetId;for(let l=t;l<=r;l++)for(let r=a;r<=n;r++){if(l<0||r<0)return e(rR.create(q.REF),l,r);let n=this.getCellData(l,r);if((0,P.isNullCell)(n)){e(null,l,r);continue}let u=this.getCellValueObject(n);if(l===t&&r===a){let e=this.getCellPattern(i,s,l,r);if(e&&u.isNumber()){let t=Number(u.getValue());u=nR.create(t,e)}}if(!1===e(u,l,r))return}}getFirstCell(){let{startRow:e,startColumn:t}=this.getRangePosition(),r=this.getCellData(e,t);if(!r)return nR.create(0);let a=this.getCellValueObject(r),n=this._forcedUnitId||this._defaultUnitId,i=this._forcedSheetId||this._defaultSheetId,s=this.getCellPattern(n,i,e,t);if(s&&a.isNumber()){let e=Number(a.getValue());a=nR.create(e,s)}return a}getRangeData(){return this._rangeData}setRangeData(e){this._rangeData=e}getUnitId(){return this._forcedUnitId&&this._forcedUnitId.length>0?this._forcedUnitId:this._defaultUnitId}getSheetId(){return this._forcedSheetId&&this._forcedSheetId.length>0?this._forcedSheetId:this._defaultSheetId}setForcedUnitIdDirect(e){e.length>0&&(this._forcedUnitId=e)}getForcedUnitId(){return this._forcedUnitId}setForcedSheetId(e){var t;this._forcedSheetId=null==(t=e[this.getUnitId()])?void 0:t[this._forcedSheetName]}setForcedSheetIdDirect(e){this._forcedSheetId=e}getForcedSheetId(){return this._forcedSheetId}setForcedSheetName(e){e.length>0&&(this._forcedSheetName=e)}getForcedSheetName(){return this._forcedSheetName}setDefaultSheetId(e){this._defaultSheetId=e}getDefaultSheetId(){return this._defaultSheetId}setDefaultUnitId(e){this._defaultUnitId=e}getDefaultUnitId(){return this._defaultUnitId}getUnitData(){return this._unitData}setUnitData(e){this._unitData=e}getUnitStylesData(){return this._unitStylesData}setUnitStylesData(e){this._unitStylesData=e}getRuntimeData(){return this._runtimeData}setRuntimeData(e){this._runtimeData=e}getArrayFormulaCellData(){return this._arrayFormulaCellData}setArrayFormulaCellData(e){this._arrayFormulaCellData=e}getRuntimeArrayFormulaCellData(){return this._runtimeArrayFormulaCellData}setRuntimeArrayFormulaCellData(e){this._runtimeArrayFormulaCellData=e}getRuntimeFeatureCellData(){return this._runtimeFeatureCellData}setRuntimeFeatureCellData(e){this._runtimeFeatureCellData=e}getActiveSheetRowCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowCount)||0}getActiveSheetColumnCount(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnCount)||0}getRowCount(){return this._rangeData.endRow-this._rangeData.startRow+1}getColumnCount(){return this._rangeData.endColumn-this._rangeData.startColumn+1}getRowData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.rowData)||{}}getColumnData(){var e;return(null==(e=this.getCurrentActiveSheetData())?void 0:e.columnData)||{}}isCell(){return!1}isColumn(){return!1}isRow(){return!1}isRange(){return!1}isTable(){return!1}unionBy(e){return rR.create(q.REF)}unionRange(e,t){return{startRow:-1,startColumn:-1,endRow:-1,endColumn:-1}}getCellValueObject(e){let t=iP(e);return W.has(t)?rR.create(t):e.t===P.CellValueType.NUMBER?nM(t,this._getPatternByCell(e)):e.t===P.CellValueType.STRING||e.t===P.CellValueType.FORCE_STRING?nT.create(t.toString()):e.t===P.CellValueType.BOOLEAN?nV(t):nL.create(t)}_getPatternByCell(e){var t;let r=this._unitStylesData[this.getUnitId()];if(!r)return"";let a=r.getStyleByCell(e);return(null==(t=null==a?void 0:a.n)?void 0:t.pattern)||""}getCellByRow(e){return this.getCellByPosition(e)}getCellByColumn(e){return this.getCellByPosition(void 0,e)}getCurrentActiveSheetData(){var e;return null==(e=this._unitData[this.getUnitId()])?void 0:e[this.getSheetId()]}getCurrentStylesData(){return this._unitStylesData[this.getUnitId()]}getCurrentRuntimeSheetData(){var e,t;return null==(t=null==(e=this._runtimeData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._arrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCurrentRuntimeActiveArrayFormulaCellData(){var e,t;return null==(t=null==(e=this._runtimeArrayFormulaCellData)?void 0:e[this.getUnitId()])?void 0:t[this.getSheetId()]}getCellData(e,t){let r=this.getCurrentActiveSheetData(),a=this.getCurrentRuntimeSheetData(),n=this.getCurrentActiveArrayFormulaCellData(),i=this.getCurrentRuntimeActiveArrayFormulaCellData();return(null==a?void 0:a.getValue(e,t))||(null==i?void 0:i.getValue(e,t))||this.getRuntimeFeatureCellValue(e,t)||(null==n?void 0:n.getValue(e,t))||(null==r?void 0:r.cellData.getValue(e,t))}getRuntimeFeatureCellValue(e,t){return re(e,t,this.getSheetId(),this.getUnitId(),this._runtimeFeatureCellData)}getCellByPosition(e,t){let r=e,a=t;r||(r=this._rangeData.startRow),a||(a=this._rangeData.startColumn);let n=this.getCellData(r,a);return n?this.getCellValueObject(n):rR.create(q.VALUE)}getCellPattern(e,t,r,a){var n,i,s,l;let u=this._unitStylesData[e];if(!u)return"";let o=null==(s=null==(i=null==(n=this._unitData[e])?void 0:n[t])?void 0:i.cellData)?void 0:s.getValue(r,a);if(!o)return"";let c=u.getStyleByCell(o);return(null==(l=null==c?void 0:c.n)?void 0:l.pattern)||""}toArrayValueObject(e=!0){var t;let{startRow:r,endRow:a,startColumn:n,endColumn:i}=this.getRangePosition(),s=`${this.getUnitId()}_${this.getSheetId()}_${r}_${a}_${n}_${i}`,l=iL.get(s);if(l&&e)return l;let u=a-r+1,o=i-n+1;if(u<0||o<0)return this._getBlankArrayValueObject();let c=Array(u);this.iterator((e,t,a)=>{let i=t-r,s=a-n;c[i]||(c[i]=Array(o)),null==e&&(e=nE.create()),c[i][s]=e});let h={calculateValueList:c,rowCount:c.length,columnCount:(null==(t=c[0])?void 0:t.length)||0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:r,column:n},m=nD.create(h);return e&&iL.set(s,m),m}toUnitRange(){return{range:this.getRangePosition(),sheetId:this.getSheetId(),unitId:this.getUnitId()}}_checkIfWorksheetMiss(){return(null==this._forcedSheetId||0===this._forcedSheetId.length)&&this._forcedSheetName.length>0}_getBlankArrayValueObject(){let e={calculateValueList:[],rowCount:0,columnCount:0,unitId:this.getUnitId(),sheetId:this.getSheetId(),row:0,column:0};return nD.create(e)}};B(iw,"BaseReferenceObject");let iF=iw,ij=class extends rE{constructor(e){super(),this._promise=e}isAsyncObject(){return!0}async getValue(){return this._promise}};B(ij,"AsyncObject");let iB=class extends rE{constructor(e){super(),this._promiseList=e}isAsyncArrayObject(){return!0}async getValue(){var e;let t=[];for(let e=0;e<this._promiseList.length;e++){let r=this._promiseList[e];null==t[e]&&(t[e]=[]);for(let a=0;a<r.length;a++){let n=r[a];n.isAsyncObject()?t[e][a]=await n.getValue():t[e][a]=n}}let r={calculateValueList:t,rowCount:t.length,columnCount:(null==(e=t[0])?void 0:e.length)||0,unitId:"",sheetId:"",row:0,column:0};return nD.create(r)}};function ik(e){let t=e;for(;null!=t&&t.getParent();)t=t.getParent();return t}function i$(e,t=0,r=0){return{node:e,refOffsetX:t,refOffsetY:r}}function iY(e){if(!e)return;if(e.getToken()!==tp)return e;let t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(!t)return;let a=t.get(r);return null==a&&e.getValue()?e:iY(a)}B(iB,"AsyncArrayObject"),B(ik,"getAstNodeTopParent"),B(i$,"generateExecuteAstNodeData"),B(iY,"getRootLexerHasValueNode");let iH=class e extends rA{constructor(e,t,r){super(0),k(this,"_lambdaPrivacyValueMap",/* @__PURE__ */new Map),this._lambdaNode=e,this._interpreter=t,this._lambdaPrivacyVarKeys=r,this._lambdaPrivacyValueMap.clear()}static create(t,r,a){return new e(t,r,a)}isLambda(){return!0}execute(...e){let t;let r=this._lambdaPrivacyVarKeys.length;if(e.length!==r)return rR.create(q.VALUE);if(this._setLambdaPrivacyValueMap(e),this._setLambdaNodeValue(this._lambdaNode),this._lambdaNode.setNotEmpty(!1),this._interpreter.checkAsyncNode(this._lambdaNode))t=new ij(this._interpreter.executeAsync(i$(this._lambdaNode)));else{let e=this._interpreter.execute(i$(this._lambdaNode));t=e.isReferenceObject()?e.toArrayValueObject():e}return this._lambdaNode.setNotEmpty(!0),t}_setLambdaNodeValue(e){let t=e.getChildren(),r=t.length;for(let e=0;e<r;e++){let r=t[e];if(r.getToken()===tp){let e=r.getLambdaParameter(),t=this._lambdaPrivacyValueMap.get(e);if(t)r.setValue(t);else{let t=iY(r.getCurrentLambdaPrivacyVar().get(e));null!=t&&r.setValue(t.getValue())}continue}this._setLambdaNodeValue(r)}}_setLambdaPrivacyValueMap(e){for(let t=0;t<e.length;t++){let r=e[t],a=this._lambdaPrivacyVarKeys[t];this._lambdaPrivacyValueMap.set(a,r)}}getLambdaPrivacyVarKeys(){return this._lambdaPrivacyVarKeys}};B(iH,"LambdaValueObjectObject");var iG=Object.defineProperty,iq=Object.getOwnPropertyDescriptor,iW=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?iq(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&iG(t,r,i),i},"__decorateClass$f"),iQ=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$f");let iX=class extends n8{constructor(e,t,r,a){super(e),k(this,"_isNotEmpty",!0),this._lambdaId=t,this._interpreter=r,this._lambdaPrivacyVarKeys=a}get nodeType(){return n6.LAMBDA}setNotEmpty(e=!1){this._isNotEmpty=e}isEmptyParamFunction(){return this.getChildren().length<2&&this._isNotEmpty}isFunctionParameter(){return null===this._lambdaId}getLambdaId(){return this._lambdaId}execute(){if(this.isEmptyParamFunction())this.setValue(iH.create(this,this._interpreter,this._lambdaPrivacyVarKeys));else{let e=this.getChildren(),t=e.length;this.setValue(e[t-1].getValue())}}};B(iX,"LambdaNode");let iK=(B(sS=class extends ir{constructor(e,t){super(),this._runtimeService=e,this._interpreter=t}get zIndex(){return n9.get(n6.LAMBDA)||100}create(e){let t=e.getChildren(),r=t[0],a=t.slice(1,-1),n=t[t.length-1];if(!(r instanceof tI&&n instanceof tI))return ie.create(q.NAME);if("L_1"===r.getToken()){let e=r.getChildren();if(a.length!==e.length)return ie.create(q.VALUE)}else a=t.slice(0,-1);let i=(0,P.Tools).generateRandomId(8),s=/* @__PURE__ */new Map;for(let e=0;e<a.length;e++){let t=a[e];if(!(t instanceof tI))return ie.create(q.VALUE);{let e=t.getChildren()[0];t.setToken(tA),s.set(e.trim(),void 0)}}return this._runtimeService.registerFunctionDefinitionPrivacyVar(i,s),this._updateLambdaStatement(n,i,s),new iX(e.getToken(),i,this._interpreter,[...s.keys()])}checkAndCreateNodeType(e){if(!(!(e instanceof tI)||e.getToken().trim().toUpperCase()!==tb))return this.create(e)}_updateLambdaStatement(e,t,r){iD(e,t,r)}},"LambdaNodeFactory"),sS);function iZ(e){if(!e)return;if(e.getToken()!==tp)return e;let t=e.getCurrentLambdaPrivacyVar(),r=e.getLambdaParameter();if(t)return iZ(t.get(r))}iK=iW([iQ(0,n4),iQ(1,(0,P.Inject)(ix))],iK),B(iZ,"getRootLexerNode");let iz=class extends n8{constructor(e,t,r){super(e),this._lambdaParameter=t,this._currentLambdaPrivacyVar=r}getLambdaParameter(){return this._lambdaParameter}getCurrentLambdaPrivacyVar(){return this._currentLambdaPrivacyVar}get nodeType(){return n6.LAMBDA_PARAMETER}execute(){let e=iZ(this._currentLambdaPrivacyVar.get(this._lambdaParameter));if(e)this.setValue(e.getValue());else{let e=this.getValue();(null==e||e.isError())&&this.setValue(rR.create(q.NAME))}}};B(iz,"LambdaParameterNode");let iJ=class extends ir{get zIndex(){return n9.get(n6.LAMBDA_PARAMETER)||100}create(e){let t=e.getFunctionDefinitionPrivacyVar(),r=e.getLambdaParameter();return t?new iz(e.getToken(),r,t):new ie(q.NAME)}checkAndCreateNodeType(e){if(!(!(e instanceof tI)||e.getToken().trim()!==tp))return this.create(e)}};B(iJ,"LambdaParameterNodeFactory");let i0=class extends n8{constructor(e){super(e),this._operatorString=e}get nodeType(){return n6.NULL}execute(){this.setValue(nE.create())}};B(i0,"NullNode");var i1=((A=i1||{}).ABS="ABS",A.ACOS="ACOS",A.ACOSH="ACOSH",A.ACOT="ACOT",A.ACOTH="ACOTH",A.AGGREGATE="AGGREGATE",A.ARABIC="ARABIC",A.ASIN="ASIN",A.ASINH="ASINH",A.ATAN="ATAN",A.ATAN2="ATAN2",A.ATANH="ATANH",A.BASE="BASE",A.CEILING="CEILING",A.CEILING_MATH="CEILING.MATH",A.CEILING_PRECISE="CEILING.PRECISE",A.COMBIN="COMBIN",A.COMBINA="COMBINA",A.COS="COS",A.COSH="COSH",A.COT="COT",A.COTH="COTH",A.CSC="CSC",A.CSCH="CSCH",A.DECIMAL="DECIMAL",A.DEGREES="DEGREES",A.EVEN="EVEN",A.EXP="EXP",A.FACT="FACT",A.FACTDOUBLE="FACTDOUBLE",A.FLOOR="FLOOR",A.FLOOR_MATH="FLOOR.MATH",A.FLOOR_PRECISE="FLOOR.PRECISE",A.GCD="GCD",A.INT="INT",A.ISO_CEILING="ISO.CEILING",A.LCM="LCM",A.LET="LET",A.LN="LN",A.LOG="LOG",A.LOG10="LOG10",A.MDETERM="MDETERM",A.MINVERSE="MINVERSE",A.MMULT="MMULT",A.MOD="MOD",A.MROUND="MROUND",A.MULTINOMIAL="MULTINOMIAL",A.MUNIT="MUNIT",A.ODD="ODD",A.PI="PI",A.POWER="POWER",A.PRODUCT="PRODUCT",A.QUOTIENT="QUOTIENT",A.RADIANS="RADIANS",A.RAND="RAND",A.RANDARRAY="RANDARRAY",A.RANDBETWEEN="RANDBETWEEN",A.ROMAN="ROMAN",A.ROUND="ROUND",A.ROUNDDOWN="ROUNDDOWN",A.ROUNDUP="ROUNDUP",A.SEC="SEC",A.SECH="SECH",A.SERIESSUM="SERIESSUM",A.SEQUENCE="SEQUENCE",A.SIGN="SIGN",A.SIN="SIN",A.SINH="SINH",A.SQRT="SQRT",A.SQRTPI="SQRTPI",A.SUBTOTAL="SUBTOTAL",A.SUM="SUM",A.SUMIF="SUMIF",A.SUMIFS="SUMIFS",A.SUMPRODUCT="SUMPRODUCT",A.SUMSQ="SUMSQ",A.SUMX2MY2="SUMX2MY2",A.SUMX2PY2="SUMX2PY2",A.SUMXMY2="SUMXMY2",A.TAN="TAN",A.TANH="TANH",A.TRUNC="TRUNC",A),i2=((b=i2||{}).ASC="ASC",b.ARRAYTOTEXT="ARRAYTOTEXT",b.BAHTTEXT="BAHTTEXT",b.CHAR="CHAR",b.CLEAN="CLEAN",b.CODE="CODE",b.CONCAT="CONCAT",b.CONCATENATE="CONCATENATE",b.DBCS="DBCS",b.DOLLAR="DOLLAR",b.EXACT="EXACT",b.FIND="FIND",b.FINDB="FINDB",b.FIXED="FIXED",b.LEFT="LEFT",b.LEFTB="LEFTB",b.LEN="LEN",b.LENB="LENB",b.LOWER="LOWER",b.MID="MID",b.MIDB="MIDB",b.NUMBERVALUE="NUMBERVALUE",b.PHONETIC="PHONETIC",b.PROPER="PROPER",b.REGEXEXTRACT="REGEXEXTRACT",b.REGEXMATCH="REGEXMATCH",b.REGEXREPLACE="REGEXREPLACE",b.REPLACE="REPLACE",b.REPLACEB="REPLACEB",b.REPT="REPT",b.RIGHT="RIGHT",b.RIGHTB="RIGHTB",b.SEARCH="SEARCH",b.SEARCHB="SEARCHB",b.SUBSTITUTE="SUBSTITUTE",b.T="T",b.TEXT="TEXT",b.TEXTAFTER="TEXTAFTER",b.TEXTBEFORE="TEXTBEFORE",b.TEXTJOIN="TEXTJOIN",b.TEXTSPLIT="TEXTSPLIT",b.TRIM="TRIM",b.UNICHAR="UNICHAR",b.UNICODE="UNICODE",b.UPPER="UPPER",b.VALUE="VALUE",b.VALUETOTEXT="VALUETOTEXT",b.CALL="CALL",b.EUROCONVERT="EUROCONVERT",b.REGISTER_ID="REGISTER.ID",b),i3=Object.defineProperty,i5=Object.getOwnPropertyDescriptor,i4=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?i5(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&i3(t,r,i),i},"__decorateClass$e"),i6=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$e");let i9=class extends n8{constructor(e,t){super(e),this._operatorString=e,this._functionExecutor=t}get nodeType(){return n6.OPERATOR}execute(){var e,t;let r=this.getChildren();this._functionExecutor.name===iu.COMPARE&&this._functionExecutor.setCompareType(this.getToken());let a=null==(e=r[0])?void 0:e.getValue(),n=null==(t=r[1])?void 0:t.getValue(),i=this.getToken();if((null==a||null==n)&&i!==K.MINUS&&i!==K.PLUS){this.setValue(rR.create(q.VALUE));return}null==a&&(a=nE.create()),null==n&&(n=nE.create()),a.isReferenceObject()&&(a=a.toArrayValueObject()),n.isReferenceObject()&&(n=n.toArrayValueObject()),this.setValue(this._functionExecutor.calculate(a,n))}};B(i9,"OperatorNode");let i7=(B(sO=class extends ir{constructor(e){super(),this._functionService=e}get zIndex(){return n9.get(n6.OPERATOR)||100}create(e){let t="";e===K.PLUS?t=iu.PLUS:e===K.MINUS?t=iu.MINUS:e===K.MULTIPLY?t=iu.MULTIPLY:e===K.DIVIDED?t=iu.DIVIDED:e===K.CONCATENATE?t=i2.CONCATENATE:e===K.POWER?t=i1.POWER:ee.has(e)&&(t=iu.COMPARE);let r=this._functionService.getExecutor(t);return r?new i9(e,r):(console.error(`No function ${e}`),ie.create(q.NAME))}checkAndCreateNodeType(e){if(e instanceof tI)return;let t=e.trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&J.has(t))return this.create(t)}},"OperatorNodeFactory"),sO);i7=i4([i6(0,is)],i7);let i8=class extends P.Disposable{constructor(){super(...arguments),k(this,"_tableMap",/* @__PURE__ */new Map),k(this,"_tableOptionMap",/* @__PURE__ */new Map)}dispose(){this._tableMap.clear(),this._tableOptionMap.clear()}remove(e,t){var r;null==(r=this._tableMap.get(e))||r.delete(t)}getTableMap(e){return this._tableMap.get(e)}getTableOptionMap(){return this._tableOptionMap}registerTable(e,t,r){var a;null==this._tableMap.get(e)&&this._tableMap.set(e,/* @__PURE__ */new Map),null==(a=this._tableMap.get(e))||a.set(t,r)}registerTableOptionMap(e,t){this._tableOptionMap.set(e,t)}};B(i8,"SuperTableService");let se=(0,P.createIdentifier)("univer.formula.super-table.service"),st=class extends iF{constructor(e,t,r){super(""),this.setRangeData(e),t&&this.setForcedSheetIdDirect(t),r&&this.setForcedUnitIdDirect(r)}isRange(){return!0}};B(st,"RangeReferenceObject");let sr=class extends iF{constructor(e){super(e);let t=tS(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName),this.setRangeData(t.range)}isCell(){return!0}unionBy(e){if(!e.isCell())return rR.create(q.REF);let t=this.unionRange(this.getRangeData(),e.getRangeData());return this._createRange(t)}unionRange(e,t){let r=e.startRow,a=e.startColumn,n=t.startRow,i=t.startColumn,s={startRow:-1,startColumn:-1,endRow:-1,endColumn:-1};return r>n?(s.startRow=n,s.endRow=r):(s.startRow=r,s.endRow=n),a>i?(s.startColumn=i,s.endColumn=a):(s.startColumn=a,s.endColumn=i),e.startAbsoluteRefType&&(s.startAbsoluteRefType=e.startAbsoluteRefType),t.startAbsoluteRefType&&(s.endAbsoluteRefType=t.startAbsoluteRefType),s}_createRange(e){let t=new st(e,this.getForcedSheetId(),this.getForcedUnitId());t.setUnitData(this.getUnitData()),t.setDefaultSheetId(this.getDefaultSheetId()),t.setDefaultUnitId(this.getDefaultUnitId()),t.setRuntimeData(this.getRuntimeData()),t.setUnitStylesData(this.getUnitStylesData()),t.setArrayFormulaCellData(this.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(this.getRuntimeArrayFormulaCellData()),t.setRuntimeFeatureCellData(this.getRuntimeFeatureCellData());let{x:r,y:a}=this.getRefOffset();t.setRefOffset(r,a);let n=this.getForcedSheetId();t.setForcedSheetName(this.getForcedSheetName()),null!=n&&t.setForcedSheetIdDirect(n);let i=this.getForcedUnitId();return i&&t.setForcedUnitIdDirect(i),t}};B(sr,"CellReferenceObject");let sa=class extends iF{constructor(e){super(e);let t=tS(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:t.range.startColumn,startRow:Number.NaN,endColumn:t.range.endColumn,endRow:Number.NaN,rangeType:P.RANGE_TYPE.COLUMN};this.setRangeData(r)}isColumn(){return!0}unionBy(e){if(!e.isColumn()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return rR.create(q.REF);let t=this.getRangeData(),r=e.getRangeData(),a=r.startColumn;if(a>=t.startColumn&&a<=t.endColumn)return this;let n=t.startColumn;return a>n?t.endColumn=a:(t.startColumn=a,t.endColumn=n),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=P.RANGE_TYPE.COLUMN,this.setToken(`${this.getToken()}${et.COLON}${e.getToken()}`),this}};B(sa,"ColumnReferenceObject");let sn=class extends iF{constructor(e){super(e);let t=tS(e);this.setForcedUnitIdDirect(t.unitId),this.setForcedSheetName(t.sheetName);let r={...t.range,startColumn:Number.NaN,startRow:t.range.startRow,endColumn:Number.NaN,endRow:t.range.endRow,rangeType:P.RANGE_TYPE.ROW};this.setRangeData(r)}isRow(){return!0}unionBy(e){if(!e.isRow()||void 0!==e.getForcedSheetName()&&""!==e.getForcedSheetName())return rR.create(q.REF);let t=this.getRangeData(),r=e.getRangeData(),a=r.startRow;if(a>=t.startRow&&a<=t.endRow)return this;let n=t.startRow;return a>n?t.endRow=a:(t.startRow=a,t.endRow=n),r.startAbsoluteRefType&&(t.endAbsoluteRefType=r.startAbsoluteRefType),t.rangeType=P.RANGE_TYPE.ROW,this.setToken(`${this.getToken()}${et.COLON}${e.getToken()}`),this}};B(sn,"RowReferenceObject");var si=Object.defineProperty,ss=Object.getOwnPropertyDescriptor,sl=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ss(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&si(t,r,i),i},"__decorateClass$d"),su=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$d");let so=class extends n8{constructor(e,t,r,a=!1){super(t),k(this,"_refOffsetX",0),k(this,"_refOffsetY",0),this._accessor=e,this._operatorString=t,this._referenceObject=r,this._isPrepareMerge=a}get nodeType(){return n6.REFERENCE}execute(){let e=this._accessor.get(t3),t=this._accessor.get(n4);this._referenceObject.setDefaultUnitId(t.currentUnitId),this._referenceObject.setDefaultSheetId(t.currentSubUnitId),this._referenceObject.setForcedSheetId(e.getSheetNameMap()),this._referenceObject.setUnitData(e.getUnitData()),this._referenceObject.setArrayFormulaCellData(e.getArrayFormulaCellData()),this._referenceObject.setRuntimeData(t.getUnitData()),this._referenceObject.setUnitStylesData(e.getUnitStylesData()),this._referenceObject.setRuntimeArrayFormulaCellData(t.getRuntimeArrayFormulaCellData()),this._referenceObject.setRuntimeFeatureCellData(t.getRuntimeFeatureCellData());let{x:r,y:a}=this.getRefOffset();this._referenceObject.setRefOffset(r,a),!this._isPrepareMerge&&this._referenceObject.isExceedRange()?this.setValue(rR.create(q.NAME)):this.setValue(this._referenceObject)}setRefOffset(e=0,t=0){this._refOffsetX=e,this._refOffsetY=t}getRefOffset(){return{x:this._refOffsetX,y:this._refOffsetY}}};B(so,"ReferenceNode");let sc=(B(sT=class extends ir{constructor(e,t,r,a){super(),this._superTableService=e,this._formulaRuntimeService=t,this._functionService=r,this._injector=a}get zIndex(){return n9.get(n6.REFERENCE)||100}checkAndCreateNodeType(e){var t,r;let a;let n=!1,i,s=!1;e instanceof tI?(n=!0,i=e.getToken().trim(),(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===et.COLON&&(s=!0)):i=e.trim();let{tokenTrim:l,minusPrefixNode:u,atPrefixNode:o}=iN(i,this._functionService,this._injector);if((n||'"'!==l.charAt(0)||'"'!==l.charAt(l.length-1))&&(eM(l)?a=new so(this._injector,l,new sr(l),s):n&&this._checkParentIsUnionOperator(e)&&(eD(l)?a=new so(this._injector,l,new sn(l),s):eP(l)&&(a=new so(this._injector,l,new sa(l),s))),a))return o?a.setParent(o):u&&a.setParent(u),a}_checkParentIsUnionOperator(e){var t,r;return(null==(r=null==(t=e.getParent())?void 0:t.getParent())?void 0:r.getToken().trim())===et.COLON}},"ReferenceNodeFactory"),sT);sc=sl([su(0,se),su(1,n4),su(2,is),su(3,(0,P.Inject)(P.Injector))],sc);var sh=Object.defineProperty,sm=Object.getOwnPropertyDescriptor,sf=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?sm(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&sh(t,r,i),i},"__decorateClass$c"),sg=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$c");let sd=class extends n8{constructor(e,t,r){super(t),this._accessor=e,this._operatorString=t,this._functionExecutor=r}get nodeType(){return n6.SUFFIX}execute(){let e=this.getChildren()[0].getValue(),t;if(null==e)throw Error("object is null");if(this._operatorString===er.PERCENTAGE){if(e.isReferenceObject()&&(e=e.toArrayValueObject()),(t=this._functionExecutor.calculate(e,nR.create(100))).isNumber()){let e=Number(t.getValue());t=nR.create(e,"0.00%")}}else t=this._operatorString===er.POUND?this._handlerPound(e):rR.create(q.VALUE);this.setValue(t)}_handlerPound(e){var t,r,a,n;if(!e.isReferenceObject()||!e.isCell())return rR.create(q.VALUE);let i=this._accessor.get(t3),s=this._accessor.get(t8),l=e.getRangePosition(),u=e.getUnitId(),o=e.getSheetId(),c=i.getFormulaData(),h=null==(n=null==(a=null==(r=null==(t=null==c?void 0:c[u])?void 0:t[o])?void 0:r[l.startRow])?void 0:a[l.startColumn])?void 0:n.f;return h&&s.treeBuilder(h),rR.create(q.VALUE)}};B(sd,"SuffixNode");let sN=(B(sV=class extends ir{constructor(e,t){super(),this._functionService=e,this._injector=t}get zIndex(){return n9.get(n6.SUFFIX)||100}checkAndCreateNodeType(e){if(!(e instanceof tI))return;let t=e.getToken().trim();if('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))return;let r="";if(t!==er.PERCENTAGE)return t===er.POUND?new sd(this._injector,t):void 0;r=iu.DIVIDED;let a=this._functionService.getExecutor(r);return a?new sd(this._injector,t,a):(console.error(`No function ${e}`),ie.create(q.NAME))}},"SuffixNodeFactory"),sV);sN=sf([sg(0,is),sg(1,(0,P.Inject)(P.Injector))],sN);var s_=Object.defineProperty,sC=Object.getOwnPropertyDescriptor,sE=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?sC(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&s_(t,r,i),i},"__decorateClass$b"),sp=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$b");let sA=class extends n8{constructor(e){super(e),this._operatorString=e}get nodeType(){return n6.UNION}execute(){let e;let t=this.getChildren(),r=t[0].getValue(),a=t[1].getValue();if(null==r||null==a)throw Error("leftNode and rightNode");e=this._operatorString===et.COLON?this._unionFunction(r,a):rR.create(q.NAME),this.setValue(e)}_unionFunction(e,t){return e.isError()||t.isError()||!e.isReferenceObject()||!t.isReferenceObject()?rR.create(q.REF):e.isCell()&&t.isCell()||e.isRow()&&t.isRow()||e.isColumn()&&t.isColumn()?e.unionBy(t):rR.create(q.NAME)}};B(sA,"UnionNode");let sb=(B(sI=class extends ir{constructor(e){super(),this._functionService=e}get zIndex(){return n9.get(n6.UNION)||100}create(e){return new sA(e)}checkAndCreateNodeType(e){if(!(e instanceof tI))return;let t=e.getToken().trim();if(!('"'===t.charAt(0)&&'"'===t.charAt(t.length-1))&&t===et.COLON)return this.create(t)}},"UnionNodeFactory"),sI);sb=sE([sp(0,is)],sb);let sy=class extends n8{constructor(e){super(e),this._operatorString=e}get nodeType(){return n6.VALUE}execute(){this.setValue(nL.create(this._operatorString))}};B(sy,"ValueNode");let sR=class extends ir{get zIndex(){return n9.get(n6.VALUE)||100}_checkValueNode(e){if(!Number.isNaN(Number(e)))return this.create(e);{let t=e.trim(),r=t.charAt(0),a=t.charAt(t.length-1);if(W.has(t)||'"'===r&&'"'===a||"{"===r&&"}"===a)return this.create(t);let n=t.toUpperCase();if(n===$.TRUE||n===$.FALSE)return this.create(n)}}create(e){return new sy(e)}checkAndCreateNodeType(e){if(!(e instanceof tI))return this._checkValueNode(e)}};B(sR,"ValueNodeFactory");var sS,sO,sT,sV,sI,sM,sx=Object.defineProperty,sv=Object.getOwnPropertyDescriptor,sU=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?sv(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&sx(t,r,i),i},"__decorateClass$a"),sD=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$a");let sP=(B(sM=class extends P.Disposable{constructor(e,t,r,a,n,i,s,l,u,o,c){super(),k(this,"_astNodeFactoryList",[]),k(this,"_refOffsetX",0),k(this,"_refOffsetY",0),this._runtimeService=e,this._astRootNodeFactory=t,this._functionNodeFactory=r,this._lambdaNodeFactory=a,this._lambdaParameterNodeFactory=n,this._operatorNodeFactory=i,this._prefixNodeFactory=s,this._referenceNodeFactory=l,this._suffixNodeFactory=u,this._unionNodeFactory=o,this._valueNodeFactory=c,this._initializeAstNode()}dispose(){this._astNodeFactoryList.forEach(e=>{e.dispose()}),this._astNodeFactoryList=[]}parse(e){let t=new ia("R_1"),r=this._parse(e,t);return e.hasDefinedNames()&&(null==r||r.setDefinedNames(e.getDefinedNames())),r}_lambdaParameterHandler(e,t){if(null==t.getLambdaId)return ie.create(q.VALUE);let r=t.getLambdaId(),a=new ia("R_1"),n=this._runtimeService.getFunctionDefinitionPrivacyVar(r);if(!n)return!1;let i=[...n.keys()],s=e.getChildren(),l=s.length;for(let e=0;e<l;e++){let t=s[e];if(!(t instanceof tI))return!1;{iD(t,r,n),this._parse(t,a);let s=a.getChildren()[e];null!=s&&n.set(i[e],s)}}return a.setParent(t),t}_changeLetToLambda(e){let t=e.getChildren(),r=t.length;if(r%2!=1||0===r)return;let a=new tI;a.setToken(tb);let n=new tI;n.setToken("L_1");let i=[...t];for(let e=0;e<r;e++){let t=i[e];if(!(t instanceof tI))return;e%2==0?t.changeToParent(a):t.changeToParent(n)}a.addChildrenFirst(n),n.setParent(a);let s=e.getParent();return null==s||s.replaceChild(e,a),a}_parse(e,t){let r=e.getChildren(),a=r.length,n=[],i=null,s=e.getToken().trim().toUpperCase();if("LET"===s){let r=this._changeLetToLambda(e);return null!=r?this._parse(r,t):ie.create(q.ERROR)}if("P_1"===s){if(i=t,0===a)return new i0("R_1").setParent(t),i}else{if("L_1"===s){let r=this._lambdaParameterHandler(e,t);return!1===r&&(r=ie.create(q.ERROR)),r}if(null==(i=this._checkAstNode(e)))return ie.create(q.NAME)}let l=r[0];for(let e=0;e<a;e++){let t=r[e];if(iv(l)){if(0!==e&&e!==a-1)continue}else if(iU(t)&&e!==a-1)continue;let s=null;if(t instanceof tI){if((s=this._parse(t,i))===i)continue}else s=this._checkAstNode(t);if(null==s)return ie.create(q.NAME);if(null==(s=ik(s)))return;switch(s.nodeType){case n6.FUNCTION:{let e=s.getToken().trim().toUpperCase();ty.has(e)&&s.setForcedCalculateFunction(),n.push(s);break}case n6.LAMBDA:case n6.LAMBDA_PARAMETER:n.push(s);break;case n6.OPERATOR:{let e=n.pop(),t=n.pop();t&&t.setParent(s),e&&e.setParent(s),n.push(s);break}case n6.REFERENCE:case n6.ROOT:case n6.UNION:case n6.VALUE:case n6.PREFIX:case n6.SUFFIX:n.push(s)}}let u=n.length;for(let e=0;e<u;e++)n[e].setParent(i);return i}_checkAstNode(e){let t=null,r=this._astNodeFactoryList.length;for(let a=0;a<r&&null==(t=this._astNodeFactoryList[a].checkAndCreateNodeType(e));a++);return null==t?new ib:t}_initializeAstNode(){this._astNodeFactoryList=[this._astRootNodeFactory,this._functionNodeFactory,this._lambdaNodeFactory,this._lambdaParameterNodeFactory,this._operatorNodeFactory,this._prefixNodeFactory,this._referenceNodeFactory,this._suffixNodeFactory,this._unionNodeFactory,this._valueNodeFactory].sort(P.sortRules)}},"AstTreeBuilder"),sM);sP=sU([sD(0,n4),sD(1,(0,P.Inject)(ii)),sD(2,(0,P.Inject)(iy)),sD(3,(0,P.Inject)(iK)),sD(4,(0,P.Inject)(iJ)),sD(5,(0,P.Inject)(i7)),sD(6,(0,P.Inject)(id)),sD(7,(0,P.Inject)(sc)),sD(8,(0,P.Inject)(sN)),sD(9,(0,P.Inject)(sb)),sD(10,(0,P.Inject)(sR))],sP);let sL=class extends P.Disposable{constructor(){super(...arguments),k(this,"_otherFormulaData",{}),k(this,"_featureFormulaData",{}),k(this,"_formulaData",{}),k(this,"_allTreeMap",/* @__PURE__ */new Map),k(this,"_dependencyRTreeCache",new P.RTree(!0)),k(this,"_dependencyTreeIdLast",0)}dispose(){this._otherFormulaData={},this._featureFormulaData={},this._formulaData={},this._dependencyRTreeCache.dispose(),this._restDependencyTreeId(),this._allTreeMap.clear()}getAllTree(){let e=[];return this._allTreeMap.forEach(t=>{t.resetState(),e.push(t)}),e}getTreeById(e){return this._allTreeMap.get(e)}buildDependencyTree(e,t=[]){let r=this.getAllTree();return 0===e.length?this._buildReverseDependency(r,t):(this._buildDependencyTree(r,e),this._buildReverseDependency(r,e)),r}searchDependency(e){return this._dependencyRTreeCache.bulkSearch(e)}_buildDependencyTree(e,t){let r=/* @__PURE__ */new Map;for(let e=0;e<t.length;e++){let a=t[e];r.set(a.treeId,a)}for(let t=0;t<e.length;t++){let a=e[t],n=a.toRTreeItem(),i=this._dependencyRTreeCache.search(n);for(let e=0;e<i.length;e++){let t=i[e],n=r.get(t);n&&a!==n&&!n.hasChildren(a.treeId)&&n.pushChildren(a)}}r.clear()}_buildReverseDependency(e,t){let r=/* @__PURE__ */new Map;for(let t=0;t<e.length;t++){let a=e[t];r.set(a.treeId,a)}for(let e=0;e<t.length;e++){let a=t[e],n=a.toRTreeItem(),i=this._dependencyRTreeCache.search(n);for(let e=0;e<i.length;e++){let t=i[e],n=r.get(t);n&&a!==n&&!n.hasChildren(a.treeId)&&n.pushChildren(a)}}r.clear()}clearDependencyForTree(e){if(null==e)return;let t=e.parents,r=e.children,a=this._allTreeMap;for(let r of t){let t=a.get(r);null==t||t.children.delete(e.treeId)}for(let t of r){let r=a.get(t);null==r||r.parents.delete(e.treeId)}e.dispose()}reset(){this._otherFormulaData={},this._featureFormulaData={},this._formulaData={},this._dependencyRTreeCache.clear(),this._allTreeMap.clear(),this._restDependencyTreeId()}addOtherFormulaDependency(e,t,r,a){this._otherFormulaData[e]||(this._otherFormulaData[e]={}),this._otherFormulaData[e][t]||(this._otherFormulaData[e][t]={}),this._otherFormulaData[e][t][r]=a.treeId,this._allTreeMap.set(a.treeId,a)}removeOtherFormulaDependency(e,t,r){this._otherFormulaData[e]&&this._otherFormulaData[e][t]&&r.forEach(r=>{let a=this._otherFormulaData[e][t][r];if(null==a)return;let n=this._allTreeMap.get(a);this._removeDependencyRTreeCache(n),this.clearDependencyForTree(n),delete this._otherFormulaData[e][t][r],this._removeAllTreeMap(a)})}getOtherFormulaDependency(e,t,r){var a,n;let i=null==(n=null==(a=this._otherFormulaData[e])?void 0:a[t])?void 0:n[r];return null==i&&(i=-1),this._allTreeMap.get(i)}hasOtherFormulaDependency(e,t,r){return null!=this.getOtherFormulaDependency(e,t,r)}clearOtherFormulaDependency(e,t){if(t&&this._otherFormulaData[e]&&this._otherFormulaData[e][t])this._removeDependencyRTreeCacheById(e,t),Object.values(this._otherFormulaData[e][t]).forEach(e=>{if(null==e)return;let t=this._allTreeMap.get(e);this.clearDependencyForTree(t),this._removeAllTreeMap(e)}),this._otherFormulaData[e][t]={};else if(this._otherFormulaData[e]){let t=this._otherFormulaData[e];Object.keys(t).forEach(r=>{null!=r&&(this._removeDependencyRTreeCacheById(e,r),Object.values(t[r]).forEach(e=>{if(null==e)return;let t=this._allTreeMap.get(e);this.clearDependencyForTree(t),this._removeAllTreeMap(e)}))}),this._otherFormulaData[e]=null}}addFeatureFormulaDependency(e,t,r,a){this._featureFormulaData[e]||(this._featureFormulaData[e]={}),this._featureFormulaData[e][t]||(this._featureFormulaData[e][t]={}),this._featureFormulaData[e][t][r]=a.treeId,this._allTreeMap.set(a.treeId,a)}removeFeatureFormulaDependency(e,t,r){this._featureFormulaData[e]&&this._featureFormulaData[e][t]&&r.forEach(r=>{let a=this._featureFormulaData[e][t][r];if(null==a)return;let n=this._allTreeMap.get(a);this._removeDependencyRTreeCache(n),this.clearDependencyForTree(n),delete this._featureFormulaData[e][t][r],this._removeAllTreeMap(a)})}clearFeatureFormulaDependency(e,t){if(t&&this._featureFormulaData[e]&&this._featureFormulaData[e][t])this._removeDependencyRTreeCacheById(e,t),Object.values(this._featureFormulaData[e][t]).forEach(e=>{if(null==e)return;let t=this._allTreeMap.get(e);this._removeDependencyRTreeCache(t),this.clearDependencyForTree(t),this._removeAllTreeMap(e)}),this._featureFormulaData[e][t]={};else if(this._featureFormulaData[e]){let t=this._featureFormulaData[e];Object.keys(t).forEach(r=>{null!=r&&(this._removeDependencyRTreeCacheById(e,r),Object.values(t[r]).forEach(e=>{if(null==e)return;let t=this._allTreeMap.get(e);this.clearDependencyForTree(t),this._removeAllTreeMap(e)}))}),this._featureFormulaData[e]=null}}getFeatureFormulaDependency(e,t,r){var a,n;let i=null==(n=null==(a=this._featureFormulaData[e])?void 0:a[t])?void 0:n[r];return null==i?null:this._allTreeMap.get(i)}addFormulaDependency(e,t,r,a,n){this._formulaData[e]||(this._formulaData[e]={}),this._formulaData[e][t]||(this._formulaData[e][t]=new P.ObjectMatrix),this._formulaData[e][t].setValue(r,a,n.treeId),this._allTreeMap.set(n.treeId,n)}removeFormulaDependency(e,t,r,a){if(this._formulaData[e]&&this._formulaData[e][t]){let n=this._formulaData[e][t].getValue(r,a);if(null==n)return;let i=this._allTreeMap.get(n);this._removeDependencyRTreeCache(i),this.clearDependencyForTree(i),this._formulaData[e][t].realDeleteValue(r,a),this._removeAllTreeMap(n)}}clearFormulaDependency(e,t){if(t&&this._formulaData[e]&&this._formulaData[e][t])this._removeDependencyRTreeCacheById(e,t),this._formulaData[e][t].forValue((e,t,r)=>{if(null==r)return!0;let a=this._allTreeMap.get(r);this.clearDependencyForTree(a),this._removeAllTreeMap(r)}),this._formulaData[e][t].reset();else if(this._formulaData[e]){let t=this._formulaData[e];Object.keys(t).forEach(r=>{null!=r&&(this._removeDependencyRTreeCacheById(e,r),t[r].forValue((e,t,r)=>{if(null==r)return!0;let a=this._allTreeMap.get(r);this.clearDependencyForTree(a),this._removeAllTreeMap(r)}))}),this._formulaData[e]=null}}clearDependencyAll(){this._otherFormulaData={},this._featureFormulaData={},this._formulaData={},this._dependencyRTreeCache.clear(),this._restDependencyTreeId()}getFormulaDependency(e,t,r,a){var n,i;let s=null==(i=null==(n=this._formulaData[e])?void 0:n[t])?void 0:i.getValue(r,a);return null==s?null:this._allTreeMap.get(s)}addDependencyRTreeCache(e){let t=[];for(let r=0;r<e.rangeList.length;r++){let{unitId:a,sheetId:n,range:i}=e.rangeList[r];t.push({unitId:a,sheetId:n,range:i,id:e.treeId})}this._dependencyRTreeCache.bulkInsert(t)}_restDependencyTreeId(){this._dependencyTreeIdLast=0}getLastTreeId(){let e=this._dependencyTreeIdLast;return this._dependencyTreeIdLast++,e}_removeDependencyRTreeCacheById(e,t){this._dependencyRTreeCache.removeById(e,t)}_removeDependencyRTreeCache(e){if(null==e)return;let t=[];for(let r=0;r<e.rangeList.length;r++){let{unitId:a,sheetId:n,range:i}=e.rangeList[r];t.push({unitId:a,sheetId:n,range:i,id:e.treeId})}this._dependencyRTreeCache.bulkRemove(t)}removeFormulaDependencyByDefinedName(e,t){this._formulaData[e]&&Object.values(this._formulaData[e]).forEach(e=>{e.forValue((r,a,n)=>{var i;let s=this._allTreeMap.get(n);null!=(i=null==s?void 0:s.nodeData)&&i.node.hasDefinedName(t)&&(this._removeDependencyRTreeCache(s),this.clearDependencyForTree(s),e.realDeleteValue(r,a))})})}openKdTree(){this._dependencyRTreeCache.openKdTree()}closeKdTree(){this._dependencyRTreeCache.closeKdTree()}_removeAllTreeMap(e){null!=e&&this._allTreeMap.delete(e)}};B(sL,"DependencyManagerService");let sw=(0,P.createIdentifier)("univer.formula.dependency-manager.service"),sF=class extends P.Disposable{constructor(){super(...arguments),k(this,"_referenceExecutorMap",/* @__PURE__ */new Map),k(this,"_onChanged$",new L.Subject),k(this,"onChanged$",this._onChanged$.asObservable())}dispose(){this._referenceExecutorMap.clear()}remove(e,t,r){r.forEach(r=>{var a,n;null==(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))||n.delete(r)}),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:r})}get(e,t,r){var a,n;return null==(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))?void 0:n.get(r)}has(e,t,r){var a,n;return!!(null!=(n=null==(a=this._referenceExecutorMap.get(e))?void 0:a.get(t))&&n.has(r))}register(e,t,r,a){let n=this._referenceExecutorMap.get(e);n||(n=/* @__PURE__ */new Map,this._referenceExecutorMap.set(e,n));let i=n.get(t);i||(i=/* @__PURE__ */new Map,n.set(t,i)),this._onChanged$.next({unitId:e,subUnitId:t,featureIds:[r]}),i.set(r,a)}getReferenceExecutorMap(){return this._referenceExecutorMap}};B(sF,"FeatureCalculationManagerService");let sj=(0,P.createIdentifier)("univer.formula.feature-calculation-manager.service"),sB=class extends P.Disposable{constructor(){super(...arguments),k(this,"_otherFormulaData",{})}dispose(){this._otherFormulaData={}}remove(e){var t,r,a;let{unitId:n,subUnitId:i,formulaId:s}=e;null==(a=null==(r=null==(t=this._otherFormulaData)?void 0:t[n])?void 0:r[i])||delete a[s]}get(e){var t,r;let{unitId:a,subUnitId:n,formulaId:i}=e;return null==(r=null==(t=this._otherFormulaData[a])?void 0:t[n])?void 0:r[i]}has(e){var t,r;let{unitId:a,subUnitId:n,formulaId:i}=e;return(null==(r=null==(t=this._otherFormulaData[a])?void 0:t[n])?void 0:r[i])!=null}register(e){let{unitId:t,subUnitId:r,formulaId:a,item:n}=e;this._otherFormulaData[t]||(this._otherFormulaData[t]={}),this._otherFormulaData[t][r]||(this._otherFormulaData[t][r]={}),this._otherFormulaData[t][r][a]=n}batchRegister(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let a=r[e];if(null==a)return!0;Object.keys(a).forEach(r=>{let n=a[r];if(null==n)return!0;this.register({unitId:t,subUnitId:e,formulaId:r,item:n})})})})}batchRemove(e){Object.keys(e).forEach(t=>{let r=e[t];if(null==r)return!0;Object.keys(r).forEach(e=>{let a=r[e];if(null==a)return!0;Object.keys(a).forEach(r=>{this.remove({unitId:t,subUnitId:e,formulaId:r})})})})}getOtherFormulaData(){return this._otherFormulaData}};B(sB,"OtherFormulaManagerService");let sk=(0,P.createIdentifier)("univer.formula.other-formula-manager.service"),s$=class{constructor(e){k(this,"treeId",-1),k(this,"nodeData"),k(this,"children",/* @__PURE__ */new Set),k(this,"parents",/* @__PURE__ */new Set),k(this,"formula",""),k(this,"row",-1),k(this,"column",-1),k(this,"rowCount",Number.NEGATIVE_INFINITY),k(this,"columnCount",Number.NEGATIVE_INFINITY),k(this,"subUnitId",""),k(this,"unitId",""),k(this,"rangeList",[]),k(this,"formulaId"),k(this,"featureId"),k(this,"isCache",!1),k(this,"getDirtyData"),k(this,"_state",0),this.treeId=e}toJson(){return{formula:this.formula,row:this.row,column:this.column,subUnitId:this.subUnitId,unitId:this.unitId,formulaId:this.formulaId,featureId:this.featureId}}dispose(){var e;this.children.clear(),this.rangeList=[],this.parents.clear(),null==(e=this.nodeData)||e.node.dispose(),this.nodeData=null}resetState(){this._state=0}setAdded(){this._state=1}isAdded(){return 1===this._state}setSkip(){this._state=2}isSkip(){return 2===this._state}inRangeData(e){let t=e.startRow,r=e.startColumn,a=e.endRow,n=e.endColumn;return!(this.row<t||this.row>a||this.column<r||this.column>n)}dependencySheetName(e){var t;if(0===this.rangeList.length||null==e)return!1;for(let r=0,a=this.rangeList.length;r<a;r++){let{unitId:a,sheetId:n}=this.rangeList[r];if((null==(t=e[a])?void 0:t[n])!=null)return!0}return!1}isExcludeRange(e){var t;if(0===this.rangeList.length)return!1;for(let r=0,a=this.rangeList.length;r<a;r++){let{unitId:a,sheetId:n,range:i}=this.rangeList[r],s=null==(t=null==e?void 0:e[a])?void 0:t[n],{startRow:l,endRow:u,startColumn:o,endColumn:c}=i;Number.isNaN(l)&&(l=0),Number.isNaN(o)&&(o=0),Number.isNaN(u)&&(u=Number.POSITIVE_INFINITY),Number.isNaN(c)&&(c=Number.POSITIVE_INFINITY);let h=!1;if(null==s||s.forValue((e,t)=>{if(e>=l&&e<=u&&t>=o&&t<=c)return h=!0,!1}),h)return!0}return!1}pushChildren(e){this.children.add(e.treeId),e._pushParent(this)}pushRangeList(e){this.rangeList.push(...e)}hasChildren(e){return this.children.has(e)}toRTreeItem(){return{unitId:this.unitId,sheetId:this.subUnitId,range:{startRow:this.row,startColumn:this.column,endRow:this.row,endColumn:this.column},id:this.treeId}}dependency(e){if(0===this.rangeList.length)return!1;for(let t=0,r=this.rangeList.length;t<r;t++){let r=this.rangeList[t],a=r.unitId,n=r.sheetId,i=r.range;if(e.unitId===a&&e.subUnitId===n&&e.inRangeData(i))return!0}return!1}_pushParent(e){this.parents.add(e.treeId)}};B(s$,"FormulaDependencyTree");var sY=Object.defineProperty,sH=Object.getOwnPropertyDescriptor,sG=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?sH(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&sY(t,r,i),i},"__decorateClass$9"),sq=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$9");function sW(e){return e.getLastTreeId()||0}B(sW,"generateRandomDependencyTreeId");let sQ=(B(s0=class extends P.Disposable{constructor(e,t,r,a,n,i,s,l){super(),k(this,"_formulaASTCache",new tE(1e5)),k(this,"_updateRangeFlattenCache",/* @__PURE__ */new Map),this._currentConfigService=e,this._runtimeService=t,this._otherFormulaManagerService=r,this._featureCalculationManagerService=a,this._interpreter=n,this._astTreeBuilder=i,this._lexer=s,this._dependencyManagerService=l}dispose(){this._formulaASTCache.clear()}async generate(){this._updateRangeFlatten();let e=this._currentConfigService.getFormulaData(),t=this._otherFormulaManagerService.getOtherFormulaData(),r=this._currentConfigService.getClearDependencyTreeCache();null!=r&&Object.keys(r).forEach(e=>{null!=e&&Object.keys(r[e]).forEach(t=>{null!=t&&(this._dependencyManagerService.clearOtherFormulaDependency(e,t),this._dependencyManagerService.clearFeatureFormulaDependency(e,t),this._dependencyManagerService.clearFormulaDependency(e,t))})});let a=this._currentConfigService.getUnitData(),n=await this._generateTreeList(e,t,a),i=this._getUpdateTreeListAndMakeDependency(n),s=this._calculateRunList(i);return this._dependencyFeatureCalculation(s)&&(s.forEach(e=>{e.resetState()}),s=this._calculateRunList(s)),this._checkIsCycleDependency(s)&&this._runtimeService.enableCycleDependency(),Promise.resolve(s)}_isCyclicUtil(e,t,r){let a=this._dependencyManagerService.getTreeById(e);if(null==a)return!1;if(!t.has(a.treeId)){for(let e of(t.add(a.treeId),r.add(a.treeId),a.children))if(!t.has(e)&&this._isCyclicUtil(e,t,r)||r.has(e))return!0}return r.delete(a.treeId),!1}_checkIsCycleDependency(e){let t=/* @__PURE__ */new Set,r=/* @__PURE__ */new Set;for(let a=0,n=e.length;a<n;a++){let n=e[a];if(!0===this._isCyclicUtil(n.treeId,t,r))return!0}return!1}async _generateTreeList(e,t,r){let a=Object.keys(e),n=Object.keys(t),i=[],s=/* @__PURE__ */new Map;this._currentConfigService.isForceCalculate()&&(this._dependencyManagerService.reset(),this._formulaASTCache.clear()),this._registerFormulas(a,e,r,i,s),this._registerOtherFormulas(t,n,i,s),this._registerFeatureFormulas(i);for(let e=0,t=i.length;e<t;e++){let t=i[e];this._runtimeService.setCurrent(t.row,t.column,t.rowCount,t.columnCount,t.subUnitId,t.unitId);let{unitId:r,formula:a,nodeData:n}=t;if(null==n)continue;let{refOffsetX:l,refOffsetY:u}=n,o=!1;if(0!==l||0!==u){let e=s.get(`${r}${a}`);e&&e.rangeList.length>0&&(t.pushRangeList(this._moveRangeList(e,l,u)),o=!0)}if(!o){let e=await this._getRangeListByNode(n);t.pushRangeList(e)}t.isCache||this._dependencyManagerService.addDependencyRTreeCache(t)}return s.clear(),i}_moveRangeList(e,t,r){let a=e.rangeList,n=[];for(let i=0,s=a.length;i<s;i++){let s=a[i],l={unitId:e.unitId,sheetId:e.subUnitId,range:(0,P.moveRangeByOffset)(s.range,t,r)};n.push(l)}return n}_registerFeatureFormulas(e){this._featureCalculationManagerService.getReferenceExecutorMap().forEach((t,r)=>{t.forEach((t,r)=>{t.forEach((t,r)=>{let a=this._dependencyManagerService.getFeatureFormulaDependency(t.unitId,t.subUnitId,r);if(a){a.isCache=!0;return}e.push(this._getFeatureFormulaTree(r,t))})})})}_getFeatureFormulaTree(e,t){let{unitId:r,subUnitId:a,dependencyRanges:n,getDirtyData:i}=t,s=new s$(sW(this._dependencyManagerService));return s.unitId=r,s.subUnitId=a,s.getDirtyData=i,s.featureId=e,s.rangeList=n,this._dependencyManagerService.addFeatureFormulaDependency(r,a,e,s),s}_registerOtherFormulas(e,t,r,a){for(let n of t){let t=e[n];if(null!=t)for(let e of Object.keys(t)){let i=t[e];if(null!=i)for(let t of Object.keys(i)){let s=this._dependencyManagerService.getOtherFormulaDependency(n,e,t),{f:l,x:u=0,y:o=0}=i[t];if(s){s.isCache=!0,0===u&&0===o&&a.set(`${n}${l}`,s);continue}let c=this._generateAstNode(n,l,u,o),h=new s$(sW(this._dependencyManagerService));h.nodeData=c,h.formula=l,h.unitId=n,h.subUnitId=e,h.formulaId=t,0===u&&0===o&&a.set(`${n}${l}`,h),this._dependencyManagerService.addOtherFormulaDependency(n,e,t,h),r.push(h)}}}}_registerFormulas(e,t,r,a,n){for(let i of e){let e=t[i];if(null!=e)for(let t of Object.keys(e))new(0,P.ObjectMatrix)(e[t]||{}).forValue((e,s,l)=>{if(null==l)return!0;let{f:u,x:o=0,y:c=0}=l,h=this._dependencyManagerService.getFormulaDependency(i,t,e,s);if(h)return h.isCache=!0,0===o&&0===c&&n.set(`${i}${u}`,h),!0;let m=this._generateAstNode(i,u,o,c),f=new s$(sW(this._dependencyManagerService)),g=r[i][t];f.nodeData=m,f.formula=u,f.unitId=i,f.subUnitId=t,f.row=e,f.column=s,f.rowCount=g.rowCount,f.columnCount=g.columnCount,0===o&&0===c&&n.set(`${i}${u}`,f),this._dependencyManagerService.addFormulaDependency(i,t,e,s,f),a.push(f)})}}_updateRangeFlatten(){let e=this._currentConfigService.isForceCalculate(),t=this._currentConfigService.getDirtyRanges();if(!e){this._updateRangeFlattenCache.clear();for(let e=0;e<t.length;e++){let r=t[e],a=r.range,n=r.sheetId,i=r.unitId;this._addFlattenCache(i,n,a)}}}_generateAstNode(e,t,r=0,a=0){let n=this._formulaASTCache.get(`${e}${t}`);if(n&&!this._isDirtyDefinedForNode(n))return i$(n,r,a);let i=this._lexer.treeBuilder(t);if(W.has(i))return{node:ie.create(i),refOffsetX:r,refOffsetY:a};if(null==(n=this._astTreeBuilder.parse(i)))throw Error("astNode is null");return this._formulaASTCache.set(`${e}${t}`,n),i$(n,r,a)}_addFlattenCache(e,t,r){let a=this._updateRangeFlattenCache.get(e);null==a&&(a=/* @__PURE__ */new Map,this._updateRangeFlattenCache.set(e,a));let n=a.get(t);null==n&&(n=[],a.set(t,n)),n.push(r)}_isPreCalculateNode(e){return e.nodeType===n6.UNION||e.nodeType===n6.PREFIX&&e.getToken()===en.AT||e.nodeType===n6.SUFFIX&&e.getToken()===er.POUND}_nodeTraversalRef(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];if(this._isPreCalculateNode(a)){t.push(a);continue}a.nodeType===n6.REFERENCE&&t.push(a),this._nodeTraversalRef(a,t)}}_nodeTraversalReferenceFunction(e,t){let r=e.getChildren(),a=r.length;for(let e=0;e<a;e++){let a=r[e];if(a.nodeType===n6.FUNCTION&&a.isAddress()){t.push(a);continue}this._nodeTraversalReferenceFunction(a,t)}}async _executeNode(e,t=0,r=0){let a={node:e,refOffsetX:t,refOffsetY:r};return this._interpreter.checkAsyncNode(e)?await this._interpreter.executeAsync(a):this._interpreter.execute(a)}async _getRangeListByNode(e){let t=[],r=[],a=e.refOffsetX,n=e.refOffsetY;this._nodeTraversalRef(e.node,t),this._nodeTraversalReferenceFunction(e.node,r);let i=[];for(let e=0,r=t.length;e<r;e++){let r=t[e],s=(await this._executeNode(r,a,n)).toUnitRange();i.push(s)}for(let e=0,t=r.length;e<t;e++){let t=r[e],s=(await this._executeNode(t,a,n)).toUnitRange();i.push(s)}return i}_isDirtyDefinedForNode(e){let t=this._currentConfigService.getDirtyDefinedNameMap(),r=this._currentConfigService.getExecuteUnitId();if(null!=r&&null!=t[r]){let a=Object.keys(t[r]);for(let t=0,r=a.length;t<r;t++){let r=a[t];if(e.hasDefinedName(r))return!0}}return!1}_getUpdateTreeListAndMakeDependency(e){let t=[],r=/* @__PURE__ */new Set,a=this._currentConfigService.isForceCalculate();this._dependencyManagerService.openKdTree();let n=this._dependencyManagerService.buildDependencyTree(e),i=this._currentConfigService.getDirtyRanges(),s=this._dependencyManagerService.searchDependency(i);for(let e=0,i=n.length;e<i;e++){let i=n[e];(a||i.dependencySheetName(this._currentConfigService.getDirtyNameMap())||s.has(i.treeId)&&!i.isExcludeRange(this._currentConfigService.getExcludedRange())||this._includeTree(i))&&!r.has(i)&&(t.push(i),r.add(i))}return this._dependencyManagerService.closeKdTree(),t}_dependencyFeatureCalculation(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();if(0===t.size)return;this._clearFeatureCalculationNode(e);let r=!1;return t.forEach((t,a)=>{t.forEach((t,a)=>{t.forEach((t,a)=>{let{unitId:n,subUnitId:i,getDirtyData:s}=t,l=s(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData()),u=this._convertDirtyRangesToUnitRange(l.dirtyRanges),o=this._intersectFeatureCalculation(u,e,{unitId:n,subUnitId:i,featureId:a});if(o.length>0){let s=this._getExistTreeList({unitId:n,subUnitId:i,featureId:a},e);null==s&&(s=this._getFeatureFormulaTree(a,t),e.push(s)),s.parents=/* @__PURE__ */new Set,o.forEach(e=>{e.hasChildren(s.treeId)||e.pushChildren(s)}),r=!0}})})}),r}_clearFeatureCalculationNode(e){let t=this._featureCalculationManagerService.getReferenceExecutorMap();e.forEach(e=>{var r,a,n,i;let s=/* @__PURE__ */new Set;for(let n of e.children){let i=this._dependencyManagerService.getTreeById(n);i&&(i.featureId&&null!=(a=null==(r=t.get(e.unitId))?void 0:r.get(e.subUnitId))&&a.has(i.featureId)||s.add(n))}e.children=s;let l=/* @__PURE__ */new Set;for(let r of e.parents){let a=this._dependencyManagerService.getTreeById(r);a&&(a.featureId&&null!=(i=null==(n=t.get(e.unitId))?void 0:n.get(e.subUnitId))&&i.has(a.featureId)||l.add(r))}e.parents=l})}_getExistTreeList(e,t){let{unitId:r,subUnitId:a,featureId:n}=e;for(let e=0,i=t.length;e<i;e++){let i=t[e];if(i.unitId===r&&i.subUnitId===a&&i.featureId===n)return i}}_convertDirtyRangesToUnitRange(e){let t=[];for(let r in e){let a=e[r];for(let e in a)for(let n of a[e])t.push({unitId:r,sheetId:e,range:n})}return t}_intersectFeatureCalculation(e,t,r){let a=[],n=this._dependencyManagerService.searchDependency(e);for(let e=0,i=t.length;e<i;e++){let i=t[e];(i.unitId!==r.unitId||i.subUnitId!==r.subUnitId||i.featureId!==r.featureId)&&n.has(i.treeId)&&a.push(i)}return a}_includeTreeFeature(e){var t,r;let a=e.unitId,n=e.subUnitId,i=e.featureId;if(null!=i){let e=this._currentConfigService.getDirtyUnitFeatureMap();if((null==(r=null==(t=null==e?void 0:e[a])?void 0:t[n])?void 0:r[i])!=null)return!0}return!1}_includeOtherFormula(e){var t,r;let a=e.unitId,n=e.subUnitId,i=e.formulaId;if(null!=i){let e=this._currentConfigService.getDirtyUnitOtherFormulaMap();if((null==(r=null==(t=null==e?void 0:e[a])?void 0:t[n])?void 0:r[i])!=null)return!0}return!1}_includeDefinedName(e){var t;let r=null==(t=e.nodeData)?void 0:t.node;return!!(null!=r&&this._isDirtyDefinedForNode(r))}_detectForcedRecalculationNode(e){var t;let r=null==(t=e.nodeData)?void 0:t.node;return null!=r&&this._detectForcedRecalculationNodeRecursion(r)}_detectForcedRecalculationNodeRecursion(e){if(e.isForcedCalculateFunction())return!0;let t=e.getChildren();for(let e=0,r=t.length;e<r;e++){let r=t[e];if(this._detectForcedRecalculationNodeRecursion(r))return!0}return!1}_includeTree(e){var t,r,a;let n=e.unitId,i=e.subUnitId;if(!0===this._detectForcedRecalculationNode(e)||!0===this._includeTreeFeature(e)||!0===this._includeOtherFormula(e)||!0===this._includeDefinedName(e))return!0;let s=null==(r=null==(t=this._currentConfigService.getExcludedRange())?void 0:t[n])?void 0:r[i],l=!1;if(null==s||s.forValue((t,r)=>{if(e.row===t&&e.column===r)return l=!0,!1}),l)return!1;if((null==(a=this._currentConfigService.getDirtyNameMap()[n])?void 0:a[i])!=null)return!0;if(!this._updateRangeFlattenCache.has(n))return!1;let u=this._updateRangeFlattenCache.get(n);if(!u.has(i))return!1;for(let t of u.get(i))if(e.inRangeData(t))return!0;return!1}_calculateRunList(e){let t=[],r=[];for(;e.length>0;){let a=e.pop();if(!(void 0===a||a.isSkip())){if(a.isAdded()){t.push(a),a.setSkip();continue}for(let e of(r.length=0,a.parents)){let t=this._dependencyManagerService.getTreeById(e);if(!t)throw Error("ParentDependencyTree object is null");t.isAdded()||a.isSkip()||r.push(t)}0===r.length?(t.push(a),a.setSkip()):(a.setAdded(),e.push(a,...r))}}return t.reverse()}},"FormulaDependencyGenerator"),s0);sQ=sG([sq(0,t3),sq(1,n4),sq(2,sk),sq(3,sj),sq(4,(0,P.Inject)(ix)),sq(5,(0,P.Inject)(sP)),sq(6,(0,P.Inject)(t8)),sq(7,sw)],sQ);var sX=Object.defineProperty,sK=Object.getOwnPropertyDescriptor,sZ=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?sK(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&sX(t,r,i),i},"__decorateClass$8"),sz=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$8");let sJ=(B(s1=class extends P.Disposable{constructor(e,t,r,a,n,i,s){super(),k(this,"_executionInProgressListener$",new L.Subject),k(this,"executionInProgressListener$",this._executionInProgressListener$.asObservable()),k(this,"_executionCompleteListener$",new L.Subject),k(this,"executionCompleteListener$",this._executionCompleteListener$.asObservable()),this._configService=e,this._lexer=t,this._currentConfigService=r,this._runtimeService=a,this._formulaDependencyGenerator=n,this._interpreter=i,this._astTreeBuilder=s}stopFormulaExecution(){this._runtimeService.stopExecution()}setRuntimeFeatureCellData(e,t){this._runtimeService.setRuntimeFeatureCellData(e,t)}setRuntimeFeatureRange(e,t){this._runtimeService.setRuntimeFeatureRange(e,t)}async execute(e){this._runtimeService.setFormulaExecuteStage(n2.START),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._currentConfigService.load(e),this._runtimeService.reset();let t=this._configService.getConfig("CYCLE_REFERENCE_COUNT")||1;for(let e=0;e<t&&(this._runtimeService.setFormulaCycleIndex(e),await this._execute(),iL.clear(),this._runtimeService.isCycleDependency());e++);this._runtimeService.setFormulaExecuteStage(n2.CALCULATION_COMPLETED),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData()),tW.clear()}async _execute(){let e=await this._apply();if(null==e)return;let{arrayFormulaRange:t,runtimeFeatureRange:r}=e,{dirtyRanges:a,excludedCell:n}=this._getArrayFormulaDirtyRangeAndExcludedRange(t,r);return null==a||0===a.length||(this._currentConfigService.loadDirtyRangesAndExcludedCell(a,n),await this._apply(!0)),!0}_getArrayFormulaDirtyRangeAndExcludedRange(e,t){let r=[],a={};return Object.keys(e).forEach(t=>{let n=e[t];if(null==n)return!0;Object.keys(n).forEach(e=>{let i=new P.ObjectMatrix(n[e]);if(null==i)return!0;let s=new P.ObjectMatrix;i.forValue((a,n,i)=>{s.setValue(a,n,!0),r.push({unitId:t,sheetId:e,range:i})}),null==a[t]&&(a[t]={}),a[t][e]=s})}),Object.keys(t).forEach(e=>{let a=t[e];Object.keys(a).forEach(e=>{let t=a[e];if(null==t)return!0;Object.keys(t).forEach(a=>{let n=t[a];if(null==n)return!0;for(let t of n)r.push({unitId:e,sheetId:a,range:t})})})}),{dirtyRanges:r,excludedCell:a}}async _apply(e=!1){e?this._runtimeService.setFormulaExecuteStage(n2.START_DEPENDENCY_ARRAY_FORMULA):this._runtimeService.setFormulaExecuteStage(n2.START_DEPENDENCY),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let t=await this._formulaDependencyGenerator.generate(),r=this._interpreter;e?(this._runtimeService.setFormulaExecuteStage(n2.START_CALCULATION_ARRAY_FORMULA),this._runtimeService.setTotalArrayFormulasToCalculate(t.length)):(this._runtimeService.setFormulaExecuteStage(n2.START_CALCULATION),this._runtimeService.setTotalFormulasToCalculate(t.length)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState());let a=[],n=this._configService.getConfig(tQ),i=(null==n?void 0:n.intervalCount)||500;for(let n=0,s=t.length;n<s;n++){let s;let l=t[n],u=l.nodeData,o=l.getDirtyData;if(n%i==0&&(await new Promise(e=>{let t=(0,P.requestImmediateMacroTask)(e);a.push(t)}),e?(this._runtimeService.setFormulaExecuteStage(n2.CURRENTLY_CALCULATING_ARRAY_FORMULA),this._runtimeService.setCompletedArrayFormulasCount(n+1)):(this._runtimeService.setFormulaExecuteStage(n2.CURRENTLY_CALCULATING),this._runtimeService.setCompletedFormulasCount(n+1)),this._executionInProgressListener$.next(this._runtimeService.getRuntimeState()),this._runtimeService.isStopExecution()||null==u&&null==o)){this._runtimeService.setFormulaExecuteStage(n2.IDLE),this._runtimeService.markedAsStopFunctionsExecuted(),this._executionCompleteListener$.next(this._runtimeService.getAllRuntimeData());return}if(this._runtimeService.setCurrent(l.row,l.column,l.rowCount,l.columnCount,l.subUnitId,l.unitId),null!=o&&null!=l.featureId){let{runtimeCellData:e,dirtyRanges:t}=o(this._currentConfigService.getDirtyData(),this._runtimeService.getAllRuntimeData());this._runtimeService.setRuntimeFeatureCellData(l.featureId,e),this._runtimeService.setRuntimeFeatureRange(l.featureId,t)}else null!=u&&(s=r.checkAsyncNode(u.node)?await r.executeAsync(u):r.execute(u),null!=l.formulaId?this._runtimeService.setRuntimeOtherData(l.formulaId,s):this._runtimeService.setRuntimeData(s))}return a.forEach(e=>e()),a=[],t.length>0?this._runtimeService.markedAsSuccessfullyExecuted():e||this._runtimeService.markedAsNoFunctionsExecuted(),this._runtimeService.clearReferenceAndNumberformatCache(),this._runtimeService.getAllRuntimeData()}calculate(e,t=!0){let r=this._lexer.treeBuilder(e,t);if(Object.values(q).includes(r))return ie.create(r);let a=this._astTreeBuilder.parse(r);null==a||a.serialize()}},"CalculateFormulaService"),s1);sJ=sZ([sz(0,P.IConfigService),sz(1,(0,P.Inject)(t8)),sz(2,t3),sz(3,n4),sz(4,(0,P.Inject)(sQ)),sz(5,(0,P.Inject)(ix)),sz(6,(0,P.Inject)(sP))],sJ);var s0,s1,s2,s3=Object.defineProperty,s5=Object.getOwnPropertyDescriptor,s4=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?s5(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&s3(t,r,i),i},"__decorateClass$7"),s6=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$7");let s9=(B(s2=class extends P.Disposable{constructor(e,t,r){super(),this._commandService=e,this._calculateFormulaService=t,this._formulaDataModel=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._initialExecuteFormulaListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tc.id)this._calculateFormulaService.stopFormulaExecution();else if(e.id===tf.id){let t=e.params.formulaData;this._formulaDataModel.mergeFormulaData(t)}else if(e.id===to.id){let t=e.params;this._calculate(t)}else if(e.id===ej.id){let t=e.params;if(null==t)return;let{arrayFormulaRange:r,arrayFormulaCellData:a}=t;this._formulaDataModel.setArrayFormulaRange(r),this._formulaDataModel.setArrayFormulaCellData(a)}}))}async _calculate(e){let{forceCalculation:t=!1,dirtyRanges:r=[],dirtyNameMap:a={},dirtyDefinedNameMap:n={},dirtyUnitFeatureMap:i={},dirtyUnitOtherFormulaMap:s={},clearDependencyTreeCache:l={}}=e;if(0===r.length&&0===Object.keys(a).length&&0===Object.keys(n).length&&0===Object.keys(i).length&&0===Object.keys(s).length&&!1===t)return;let u=this._formulaDataModel.getFormulaData(),o=this._formulaDataModel.getArrayFormulaCellData(),c=this._formulaDataModel.getArrayFormulaRange();this._calculateFormulaService.execute({formulaData:u,arrayFormulaCellData:o,arrayFormulaRange:c,forceCalculate:t,dirtyRanges:r,dirtyNameMap:a,dirtyDefinedNameMap:n,dirtyUnitFeatureMap:i,dirtyUnitOtherFormulaMap:s,clearDependencyTreeCache:l})}_initialExecuteFormulaListener(){this._calculateFormulaService.executionCompleteListener$.subscribe(e=>{let t=e.functionsExecutedState;switch(t){case n3.NOT_EXECUTED:case n3.STOP_EXECUTION:break;case n3.SUCCESS:this._applyResult(e);case n3.INITIAL:}this._commandService.executeCommand(th.id,{functionsExecutedState:t},{onlyLocal:!0})}),this._calculateFormulaService.executionInProgressListener$.subscribe(e=>{this._commandService.executeCommand(th.id,{stageInfo:e},{onlyLocal:!0})})}async _applyResult(e){let{unitData:t,unitOtherData:r,arrayFormulaRange:a,arrayFormulaCellData:n,clearArrayFormulaCellData:i}=e;if(!t){console.error("No sheetData from Formula Engine!");return}a&&(this._formulaDataModel.clearPreviousArrayFormulaCellData(i),this._formulaDataModel.mergeArrayFormulaCellData(n),this._formulaDataModel.mergeArrayFormulaRange(a),this._commandService.executeCommand(ej.id,{arrayFormulaRange:this._formulaDataModel.getArrayFormulaRange(),arrayFormulaCellData:this._formulaDataModel.getArrayFormulaCellData()},{onlyLocal:!0})),this._commandService.executeCommand(tm.id,{unitData:ed(t),unitOtherData:r},{onlyLocal:!0})}},"CalculateController"),s2);s9=s4([s6(0,P.ICommandService),s6(1,(0,P.Inject)(sJ)),s6(2,(0,P.Inject)(tk))],s9);var s7,s8=Object.defineProperty,le=Object.getOwnPropertyDescriptor,lt=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?le(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&s8(t,r,i),i},"__decorateClass$6"),lr=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$6");let la=(B(s7=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._definedNamesService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===ti.id){let t=e.params;if(null==t)return;let{id:r,unitId:a,name:n,formulaOrRefString:i,comment:s,hidden:l,localSheetId:u}=t;this._definedNamesService.registerDefinedName(a,{id:r,name:n.trim(),formulaOrRefString:i.trim(),comment:null==s?void 0:s.trim(),hidden:l,localSheetId:u})}else if(e.id===ts.id){let t=e.params;if(null==t)return;let{unitId:r,id:a}=t;this._definedNamesService.removeDefinedName(r,a)}}))}},"SetDefinedNameController"),s7);la=lt([lr(0,P.ICommandService),lr(1,ta)],la);let ln=/[\[\]]/g;function li(e,t){return ln.test(e)?t+Number(e.replace(ln,"")):Number(e)-1}function ls(e,t=0,r=0){let a=(e=e.toLocaleUpperCase()).split(/[RC]/),n=a[1],i=a[2];return{row:li(n,t),column:li(i,r),absoluteRefType:P.AbsoluteRefType.NONE}}function ll(e,t=0,r=0){let{refBody:a,sheetName:n,unitId:i}=eK(e),s=a.indexOf(":");if(-1===s){let e=ls(a,t,r),s=e.row,l=e.column,u=e.absoluteRefType;return{unitId:i,sheetName:n,range:{startRow:s,startColumn:l,endRow:s,endColumn:l,startAbsoluteRefType:u,endAbsoluteRefType:u}}}let l=a.substring(0,s),u=a.substring(s+1),o=ls(l,t,r),c=ls(u,t,r),h=o.row;return{unitId:i,sheetName:n,range:{startRow:h,startColumn:o.column,endRow:c.row,endColumn:c.column,startAbsoluteRefType:o.absoluteRefType,endAbsoluteRefType:c.absoluteRefType}}}function lu(e){let t=lo(e.startRow,e.startAbsoluteRefType,!0),r=lo(e.startColumn,e.startAbsoluteRefType,!1),a=lo(e.endRow,e.endAbsoluteRefType,!0),n=lo(e.endColumn,e.endAbsoluteRefType,!1);return t===a&&r===n?`R${t}C${r}`:`R${t}C${r}:R${a}C${n}`}function lo(e,t=P.AbsoluteRefType.ALL,r){switch(e+=1,t){case P.AbsoluteRefType.ALL:return`${e}`;case P.AbsoluteRefType.ROW:return r?`${e}`:`[${e}]`;case P.AbsoluteRefType.COLUMN:return r?`[${e}]`:`${e}`;case P.AbsoluteRefType.NONE:return`[${e}]`}}B(li,"handleR1C1"),B(ls,"singleReference"),B(ll,"deserializeRangeForR1C1"),B(lu,"serializeRangeToR1C1"),B(lo,"getR1C1Ref");let lc=[],lh=class{constructor(e){k(this,"_unitId"),k(this,"_subUnitId"),k(this,"_row",-1),k(this,"_column",-1),k(this,"_definedNames"),k(this,"_locale"),k(this,"_sheetOrder"),k(this,"_sheetNameMap"),k(this,"needsExpandParams",!1),k(this,"needsReferenceObject",!1),k(this,"needsLocale",!1),k(this,"needsSheetsInfo",!1),k(this,"minParams",-1),k(this,"maxParams",-1),this._name=e}get name(){return this._name}get unitId(){return this._unitId}get subUnitId(){return this._subUnitId}get row(){return this._row}get column(){return this._column}dispose(){}getDefinedName(e){var t;let r=this._definedNames;return null==r?null:null==(t=Array.from(Object.values(r)).filter(t=>t.name===e))?void 0:t[0]}setDefinedNames(e){this._definedNames=e}getLocale(){return this._locale}setLocale(e){this._locale=e}getSheetsInfo(){return{sheetOrder:this._sheetOrder,sheetNameMap:this._sheetNameMap}}setSheetsInfo({sheetOrder:e,sheetNameMap:t}){this._sheetOrder=e,this._sheetNameMap=t}isAsync(){return!1}isAddress(){return!1}isCustom(){return!1}setRefInfo(e,t,r,a){this._unitId=e,this._subUnitId=t,this._row=r,this._column=a}calculateCustom(...e){return null}calculate(...e){return rR.create(q.VALUE)}checkArrayType(e){return e.isReferenceObject()||e.isValueObject()&&e.isArray()}getIndexNumValue(e,t=1){let r=e;if(r.isArray()&&(r=r.getFirstCell()),r.isBoolean())return!1===r.getValue()?rR.create(q.VALUE):t;if(r.isString()){let e=Number(r.getValue());return Number.isNaN(e)?rR.create(q.REF):e}return r.isNumber()?r.getValue():rR.create(q.VALUE)}getZeroOrOneByOneDefault(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;e.isNumber()&&0===e.getValue()&&(t=0)}return t}getMatchTypeValue(e){if(null==e)return 1;let t=1;if(e.isArray()&&(e=e.getFirstCell()),e.isBoolean())!1===e.getValue()&&(t=0);else{if(e.isString())return;if(e.isNumber()){let r=e.getValue();r<=0&&(t=r)}}return t}binarySearch(e,t,r,a,n){let i;let s=t.binarySearch(e,a,n);return null==s?rR.create(q.NA):(i=1===r.getRowCount()?r.get(0,s)||nE.create():r.get(s,0)||nE.create()).isNull()?rR.create(q.NA):i}_getOneFirstByRaw(e){return 0===e.length?rR.create(q.NA):e[0][0]||rR.create(q.NA)}_getOneLastByRaw(e){return 0===e.length?rR.create(q.NA):e[e.length-1][e[0].length-1]||rR.create(q.NA)}equalSearch(e,t,r,a=!0){let n=r.pickRaw(t.isEqual(e));return a?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}fuzzySearch(e,t,r,a=!0){let n=r.pickRaw(t.compare(e,Z.EQUALS));return a?this._getOneFirstByRaw(n):this._getOneLastByRaw(n)}orderSearch(e,t,r,a=rT.MIN,n=!1){let i=t.orderSearch(e,a,n);if(null==i)return rR.create(q.NA);let s=r.get(i.row,i.column)||nE.create();return s.isNull()?rR.create(q.NA):s}binarySearchExpand(e,t,r,a=0,n,i){let s=t.binarySearch(e,n,i);return null==s?rR.create(q.NA):0===a?r.slice([s,s+1]):r.slice(void 0,[s,s+1])}equalSearchExpand(e,t,r,a=!0,n=0){let i;let s=t.isEqual(e);return null==(i=a?s.getFirstTruePosition():s.getLastTruePosition())?rR.create(q.NA):0===n?r.slice([i.row,i.row+1]):r.slice(void 0,[i.column,i.column+1])}fuzzySearchExpand(e,t,r,a=!0,n=0){let i;let s=t.compare(e,Z.EQUALS);return null==(i=a?s.getFirstTruePosition():s.getLastTruePosition())?rR.create(q.NA):0===n?r.slice([i.row,i.row+1]):r.slice(void 0,[i.column,i.column+1])}orderSearchExpand(e,t,r,a=rT.MIN,n=!1,i=0){let s=t.orderSearch(e,a,n);return null==s?rR.create(q.NA):0===i?r.slice([s.row,s.row+1]):r.slice(void 0,[s.column,s.column+1])}flattenArray(e,t=!0){let r=[];r[0]=[];for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean()||n.isNull())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){let e;if(n.iterator(a=>!!(null==a||a.isNull()||t&&(a.isString()||a.isBoolean()))||((a=this._includingLogicalValuesAndText(a)).isError()?(e=a,!1):void r[0].push(a))),null!=e&&e.isError())return e}else r[0].push(n)}return nj(r,1,r[0].length)}_includingLogicalValuesAndText(e){if(e.isBoolean()&&(e=nY(e)),e.isString()){let t=Number(e.getValue());e=nR.create(Number.isNaN(t)?0:t)}return e}createReferenceObject(e,t){let r;let a=e.getForcedUnitId(),n=e.getForcedSheetId()||"",i=eQ({unitId:a,sheetName:e.getForcedSheetName(),range:t});return r=eM(i)?new sr(i):eD(i)?new sn(i):eP(i)?new sa(i):new st(t,n,a),this._setReferenceDefault(e,r)}_setReferenceDefault(e,t){return null==this.unitId||null==this.subUnitId?rR.create(q.REF):(t.setDefaultUnitId(this.unitId),t.setDefaultSheetId(this.subUnitId),t.setUnitData(e.getUnitData()),t.setRuntimeData(e.getRuntimeData()),t.setArrayFormulaCellData(e.getArrayFormulaCellData()),t.setRuntimeArrayFormulaCellData(e.getRuntimeArrayFormulaCellData()),t)}};B(lh,"BaseFunction");let lm=lh;function lf(e){return/^[01]{1,10}$/.test(e)}function lg(e){return/^[0-7]{1,10}$/.test(e)}function ld(e){return/^[0-9A-Fa-f]{1,10}$/.test(e)}function lN(e){if(0===e)return 0;let t=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-946595344482036e-18,366839497852761e-18,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,15626441722e-18,-85238095915e-18,6529054439e-18,5059343495e-18,-991364156e-18,-227365122e-18,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18],r=e,a=!1;r<0&&(r=-r,a=!0);let n=2/(2+r),i=4*n-2,s=0,l=0,u;for(let e=t.length-1;e>0;e--)u=s,s=i*s-l+t[e],l=u;let o=n*Math.exp(-r*r+.5*(t[0]+i*s)-l);return a?o-1:1-o}function l_(e){return 1-lN(e)}function lC(e){if(e>=2)return -100;if(e<=0)return 100;let t=e<1?e:2-e,r=Math.sqrt(-2*Math.log(t/2)),a=-.70711*((2.30753+.27061*r)/(1+r*(.99229+.04481*r))-r);for(let e=0;e<2;e++){let e=l_(a)-t;a+=e/(1.1283791670955126*Math.exp(-a*a)-a*e)}return e<1?a:-a}function lE(e,t=1){let r=Math.floor(e);if(e<0)return Number.NaN;let a=1;for(;r>1&&Number.isFinite(a);)a*=r,r-=t;return a}function lp(e,t){let r=Math.min(e-t,t),a=1;for(let t=1;t<=r&&Number.isFinite(a);t++)a*=e-t+1,a/=t;return a}function lA(e,t){let r=Math.floor(e),a=Math.floor(t);for(;0!==a;){let e=a;a=r%a,r=e}return r}function lb(e,t){let r=lA(e,t);return 0===r?0:Math.abs(e*t)/r}function ly(e){let t=e.length;if(1===t)return e[0][0];if(2===t)return e[0][0]*e[1][1]-e[0][1]*e[1][0];let r=0;for(let a=0;a<t;a++)r+=(a%2==0?1:-1)*e[0][a]*ly(lS(e,0,a));return r}function lR(e){let t=ly(e);return 0===t?null:1===e.length?[[1/t]]:lO(e).map(e=>e.map(e=>e/t))}function lS(e,t,r){return e.filter((e,r)=>r!==t).map(e=>e.filter((e,t)=>t!==r))}function lO(e){let t=e.length,r=Array.from({length:t},()=>Array(t).fill(0));for(let a=0;a<t;a++)for(let n=0;n<t;n++){let t=(a+n)%2==0?1:-1;r[n][a]=t*ly(lS(e,a,n))}return r}(e=>{function t(e,t){let r=0;for(let a=0;a<e.length;++a)r=t*r+e[a];return r}function r(e,t,r,a,n){if(0===t)return r;if(1===t)return a;let i=2/e,s=r,l=a,u=a;for(let e=1;e<t;++e)u=l*e*i+n*s,s=l,l=u;return u}function a(e,t,a,n){return /* @__PURE__ */B(function(i,s){if(a){if(0===i)return 1===a?-1/0:1/0;if(i<0)return Number.NaN}if(0===s)return e(i);if(1===s)return t(i);if(s<0)return Number.NaN;let l=e(i),u=t(i);return r(i,0|s,l,u,n)},"bessel")}B(t,"_horner"),B(r,"_bessel_iter"),B(a,"_bessel_wrap"),e.besselj=/* @__PURE__ */(()=>{let e=[-184.9052456,77392.33017,-11214424.18,651619640.7,-0x31c78f292,0xd6759744e],a=[1,267.8532712,59272.64853,9494680.718,0x3d5d6d39,0xd675973ab],n=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],i=[-934935152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function s(r){let s=0,l=0,u=r*r;if(r<8)s=t(e,u)/t(a,u);else{let e=r-.785398164;s=Math.sqrt(.636619772/r)*(Math.cos(e)*t(n,u=64/u)-Math.sin(e)*t(i,u)*8/r)}return s}B(s,"bessel0");let l=[-30.16036606,15704.4826,-2972611.439,242396853.1,-0x1d6950b23,0x10d925ddd8],u=[1,376.9991397,99447.43394,18583304.74,0x891f618a,0x21b24bbb9a],o=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],c=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function h(e){let r=0,a=0,n=e*e,i=Math.abs(e)-2.356194491;return 8>Math.abs(e)?r=e*t(l,n)/t(u,n):(r=Math.sqrt(.636619772/Math.abs(e))*(Math.cos(i)*t(o,n=64/n)-Math.sin(i)*t(c,n)*8/Math.abs(e)),e<0&&(r=-r)),r}return B(h,"bessel1"),/* @__PURE__ */B(function e(t,a){let n=Math.round(a);if(!Number.isFinite(t))return Number.isNaN(t)?t:0;if(n<0)return(n%2?-1:1)*e(t,-n);if(t<0)return(n%2?-1:1)*e(-t,n);if(0===n)return s(t);if(1===n)return h(t);if(0===t)return 0;let i=0;if(t>n)i=r(t,n,s(t),h(t),-1);else{let e=2*Math.floor((n+Math.floor(Math.sqrt(40*n)))/2),r=!1,a=0,s=0,l=1,u=0,o=2/t;for(let t=e;t>0;t--)if(u=t*o*l-a,a=l,Math.abs(l=u)>1e10&&(l*=1e-10,a*=1e-10,i*=1e-10,s*=1e-10),r&&(s+=l),r=!r,t===n&&(i=a),e-t>100&&0===i)return Number.NaN;i/=s=2*s-l}return i},"besselj2")})(),e.bessely=(()=>{let r=[228.4622733,-86327.92757,10879881.29,-512359803.6,0x1a4fa4b91,-0xb04cc5cd],n=[1,226.1030244,47447.2647,7189466.438,745249964.8,0x954bf890d],i=[2093887211e-16,-2073370639e-15,2734510407e-14,-.001098628627,1],s=[-934945152e-16,7621095161e-16,-6911147651e-15,1430488765e-13,-.01562499995];function l(a){let l=0,u=a*a,o=a-.785398164;return a<8?t(r,u)/t(n,u)+.636619772*(0,e.besselj)(a,0)*Math.log(a):Math.sqrt(.636619772/a)*(Math.sin(o)*t(i,u=64/u)+Math.cos(o)*t(s,u)*8/a)}B(l,"bessel0");let u=[8511.937935,-4237922.726,734926455.1,-0xbffb0414e,127527439e4,-4900604943e3],o=[1,354.9632885,102042.605,22459040.02,0xde8afbbf,0x62d2b66f40,249958057e5],c=[-240337019e-15,2457520174e-15,-3516396496e-14,.00183105,1],h=[105787412e-15,-88228987e-14,8449199096e-15,-2002690873e-13,.04687499995];function m(r){let a=0,n=r*r,i=r-2.356194491;return r<8?r*t(u,n)/t(o,n)+.636619772*((0,e.besselj)(r,1)*Math.log(r)-1/r):Math.sqrt(.636619772/r)*(Math.sin(i)*t(c,n=64/n)+Math.cos(i)*t(h,n)*8/r)}return B(m,"bessel1"),a(l,m,1,-1)})(),e.besseli=/* @__PURE__ */(()=>{let e=[.0045813,.0360768,.2659732,1.2067492,3.0899424,3.5156229,1],r=[.00392377,-.01647633,.02635537,-.02057706,.00916281,-.00157565,.00225319,.01328592,.39894228];function a(a){return a<=3.75?t(e,a*a/14.0625):Math.exp(Math.abs(a))/Math.sqrt(Math.abs(a))*t(r,3.75/Math.abs(a))}B(a,"bessel0");let n=[32411e-8,.00301532,.02658733,.15084934,.51498869,.87890594,.5],i=[-.00420059,.01787654,-.02895312,.02282967,-.01031555,.00163801,-.00362018,-.03988024,.39894228];function s(e){return e<3.75?e*t(n,e*e/14.0625):(e<0?-1:1)*Math.exp(Math.abs(e))/Math.sqrt(Math.abs(e))*t(i,3.75/Math.abs(e))}return B(s,"bessel1"),/* @__PURE__ */B(function e(t,r){let n=Math.round(r);if(0===n)return a(t);if(1===n)return s(t);if(n<0)return Number.NaN;if(0===Math.abs(t))return 0;if(t===1/0)return 1/0;let i=0,l,u=2/Math.abs(t),o=0,c=1,h=0,m=2*Math.round((n+Math.round(Math.sqrt(40*n)))/2);for(l=m;l>0;l--)if(h=l*u*c+o,o=c,Math.abs(c=h)>1e10&&(c*=1e-10,o*=1e-10,i*=1e-10),l===n&&(i=o),m-l>100&&0===i)return Number.NaN;return i*=e(t,0)/c,t<0&&n%2?-i:i},"besseli2")})(),e.besselk=(()=>{let r=[74e-7,1075e-7,.00262698,.0348859,.23069756,.4227842,-.57721566],n=[53208e-8,-.0025154,.00587872,-.01062446,.02189568,-.07832358,1.25331414];function i(a){return a<=2?-Math.log(a/2)*(0,e.besseli)(a,0)+t(r,a*a/4):Math.exp(-a)/Math.sqrt(a)*t(n,2/a)}B(i,"bessel0");let s=[-4686e-8,-.00110404,-.01919402,-.18156897,-.67278579,.15443144,1],l=[-68245e-8,.00325614,-.00780353,.01504268,-.0365562,.23498619,1.25331414];function u(r){return r<=2?Math.log(r/2)*(0,e.besseli)(r,1)+1/r*t(s,r*r/4):Math.exp(-r)/Math.sqrt(r)*t(l,2/r)}return B(u,"bessel1"),a(i,u,2,1)})()})(d9||(d9={})),B(lf,"isValidBinaryNumber"),B(lg,"isValidOctalNumber"),B(ld,"isValidHexadecimalNumber"),B(lN,"erf"),B(l_,"erfc"),B(lC,"erfcINV"),B(lE,"calculateFactorial"),B(lp,"calculateCombin"),B(lA,"calculateGcd"),B(lb,"calculateLcm"),B(ly,"calculateMdeterm"),B(lR,"calculateMinverse"),B(lS,"minor"),B(lO,"adjoint");let lT=/* @__PURE__ */new Map([["I",1],["V",5],["X",10],["L",50],["C",100],["D",500],["M",1e3]]),lV=/* @__PURE__ */new Map([[1,"I"],[4,"IV"],[5,"V"],[9,"IX"],[10,"X"],[40,"XL"],[45,"VL"],[49,"IL"],[50,"L"],[90,"XC"],[95,"VC"],[99,"IC"],[100,"C"],[400,"CD"],[450,"LD"],[490,"XD"],[495,"VD"],[499,"ID"],[500,"D"],[900,"CM"],[950,"LM"],[990,"XM"],[995,"VM"],[999,"IM"],[1e3,"M"]]),lI=[[1,4,5,9,10,40,50,90,100,400,500,900,1e3,4e3],[1,4,5,9,10,40,45,50,90,95,100,400,450,500,900,950,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,500,900,950,990,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,500,900,950,990,995,1e3,4e3],[1,4,5,9,10,40,45,49,50,90,95,99,100,400,450,490,495,499,500,900,950,990,995,999,1e3,4e3]];function lM(e,t,r){return e<=0?0:e>=1?1:lU(e,t,r)}function lx(e,t,r){return e<=0||e>=1?0:1===t&&1===r?1:t<512&&r<512?e**(t-1)*(1-e)**(r-1)/lP(t,r):Math.exp((t-1)*Math.log(e)+(r-1)*Math.log(1-e)-lL(t,r))}function lv(e,t,r){let a,n,i;if(e<=0)return 0;if(e>=1)return 1;if(t>=1&&r>=1){let n=Math.sqrt(-2*Math.log(e<.5?e:1-e));a=(2.30753+.27061*n)/(1+n*(.99229+.04481*n))-n,e<.5&&(a=-a);let i=(a*a-3)/6,s=2/(1/(2*t-1)+1/(2*r-1)),l=a*Math.sqrt(i+s)/s-(1/(2*r-1)-1/(2*t-1))*(i+5/6-2/(3*s));a=t/(t+r*Math.exp(2*l))}else{let n=Math.exp(t*Math.log(t/(t+r)))/t,i=n+Math.exp(r*Math.log(r/(t+r)))/r;a=e<n/i?(t*i*e)**(1/t):1-(r*i*(1-e))**(1/r)}let s=-lL(t,r);for(let l=0;l<10&&!(0===a||1===a||(i=(lU(a,t,r)-e)/(n=Math.exp((t-1)*Math.log(a)+(r-1)*Math.log(1-a)+s)),(a-=n=i/(1-.5*Math.min(1,i*((t-1)/a-(r-1)/(1-a)))))<=0&&(a=.5*(a+n)),a>=1&&(a=.5*(a+n+1)),Math.abs(n)<1e-8*a&&l>0));l++);return a}function lU(e,t,r){let a=0===e||1===e?0:Math.exp(lw(t+r)-lw(t)-lw(r)+t*Math.log(e)+r*Math.log(1-e));return e<(t+1)/(t+r+2)?a*lD(e,t,r)/t:1-a*lD(1-e,r,t)/r}function lD(e,t,r){let a=1-(t+r)*e/(t+1);1e-8>Math.abs(a)&&(a=1e-8);let n=1,i=a=1/a;for(let s=1;s<=100;s++){let l=s*(r-s)*e/((t-1+2*s)*(t+2*s));if(1e-8>Math.abs(a=1+l*a)&&(a=1e-8),1e-8>Math.abs(n=1+l/n)&&(n=1e-8),i*=(a=1/a)*n,1e-8>Math.abs(a=1+(l=-(t+s)*(t+r+s)*e/((t+2*s)*(t+1+2*s)))*a)&&(a=1e-8),1e-8>Math.abs(n=1+l/n)&&(n=1e-8),i*=(a=1/a)*n,1e-8>Math.abs(a*n-1))break}return i}function lP(e,t){return e+t>170?Math.exp(lL(e,t)):lF(e)*lF(t)/lF(e+t)}function lL(e,t){return lw(e)+lw(t)-lw(e+t)}function lw(e){let t=[76.18009172947146,-86.50532032941678,24.01409824083091,-1.231739572450155,.001208650973866179,-5395239384953e-18],r=e,a=e+5.5;a-=(e+.5)*Math.log(a);let n=1.000000000190015;for(let e=0;e<6;e++)r+=1,n+=t[e]/r;return-a+Math.log(2.5066282746310007*n/e)}function lF(e){let t=[-1.716185138865495,24.76565080557592,-379.80425647094563,629.3311553128184,866.9662027904133,-31451.272968848367,-36144.413418691176,66456.14382024054],r=[-30.8402300119739,315.35062697960416,-1015.1563674902192,-3107.771671572311,22538.11842098015,4755.846277527881,-134659.9598649693,-115132.2596755535],a=0,n=e;if(e>171.6243769536076)return 1/0;if(n<=0){let e=n%1+36e-17;if(!e)return 1/0;a=(1&n?-1:1)*Math.PI/Math.sin(Math.PI*e),n=1-n}let i=n,s=0,l;l=n<1?n++:(n-=s=(0|n)-1)-1;let u=0,o=0;for(let e=0;e<8;++e)u=(u+t[e])*l,o=o*l+r[e];let c=u/o+1;if(i<n)c/=i;else if(i>n)for(let e=0;e<s;++e)c*=n,n++;return a&&(c=a/c),c}function lj(e,t,r){if(e<0)return 0;if(e>=t)return 1;if(r<0||r>1||t<=0)return Number.NaN;let a=0;for(let n=0;n<=e;n++)a+=lB(n,t,r);return a}function lB(e,t,r){return 0===r||1===r?t*r===e?1:0:lp(t,e)*r**e*(1-r)**(t-e)}function lk(e,t){return e<=0?0:lH(t/2,e/2)}function l$(e,t){return e<0?0:0===e&&2===t?.5:Math.exp((t/2-1)*Math.log(e)-e/2-t/2*Math.log(2)-lw(t/2))}function lY(e,t){return e<=0?0:e>=1?1/0:2*lG(e,t/2)}function lH(e,t){if(t<0||e<=0)return Number.NaN;let r=Math.min(-~(8.5*Math.log(e>=1?e:1/e)+.4*e+17),1e4),a=lw(e),n=Math.exp(-t+e*Math.log(t)-a),i=e,s=1/e,l=s;if(t<e+1){if(0===n)return 0;for(let e=1;e<=r;e++)s+=l*=t/++i;return s*n}if(0===n)return 1;let u=t+1-e,o=1/1e-30,c=1/u,h=c;for(let t=1;t<=r;t++){let r=-t*(t-e);u+=2,h*=(c=1/(c=r*c+u))*(o=u+r/o)}return 1-h*n}function lG(e,t){let r,a,n;if(e<=0)return 0;if(e>=1)return Math.max(100,t+100*Math.sqrt(t));if(t>1){let a=Math.sqrt(-2*Math.log(e<.5?e:1-e));r=(2.30753+.27061*a)/(1+a*(.99229+.04481*a))-a,e<.5&&(r=-r),r=Math.max(.001,t*(1-1/(9*t)-r/(3*Math.sqrt(t)))**3)}else{let a=1-t*(.253+.12*t);r=e<a?(e/a)**(1/t):1-Math.log(1-(e-a)/(1-a))}let i=lw(t);for(let s=0;s<12;s++){if(r<=0)return 0;if(a=lH(t,r)-e,0!==(n=t>1?Math.exp((t-1)*(Math.log(t-1)-1)-i)*Math.exp(-(r-(t-1))+(t-1)*(Math.log(r)-Math.log(t-1))):Math.exp(-r+(t-1)*Math.log(r)-i))&&(n=a/n/(1-.5*Math.min(1,a/n*((t-1)/r-1)))),(r-=n)<=0&&(r=.5*(r+n)),Math.abs(n)<1e-8*r)break}return r}function lq(e,t){let r=lv(2*Math.min(e,1-e),.5*t,.5);return r=Math.sqrt(t*(1-r)/r),e>.5?r:-r}function lW(e,t){return e<0?0:1-Math.exp(-t*e)}function lQ(e,t){return e<0?0:t*Math.exp(-t*e)}function lX(e,t,r){return e<0?0:lU(t*e/(t*e+r),t/2,r/2)}function lK(e,t,r){if(e<0)return 0;if(0===e&&t<2)return 1/0;if(0===e&&2===t)return 1;let a=1/lP(t/2,r/2);return(t/r)**(t/2)*e**(t/2-1)*(1+t/r*e)**(-(t+r)/2)*a}function lZ(e,t,r){return e<=0?0:e>=1?1/0:r/(t*(1/lv(e,t/2,r/2)-1))}function lz(e,t,r){let a=t.length,n=0,i=0;for(let e=0;e<a;e++)n+=t[e],i+=r[e];let s=n/a,l=i/a,u=0,o=0;for(let e=0;e<a;e++)u+=(t[e]-s)*(r[e]-l),o+=(r[e]-l)**2;if(0===o)return 1/0;let c=u/o;return s-c*l+c*e}function lJ(e,t,r){return .5*(1+lN((e-t)/Math.sqrt(2*r*r)))}function l0(e,t,r){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(r)-(e-t)**2/(2*r*r))}function l1(e,t,r){return -1.4142135623730951*r*lC(2*e)+t}function l2(e,t,r,a,n){let i=[],s=[],l=!0;for(let u=0;u<r;u++){let r=Math.floor(u/a),o=u%a,c=Math.floor(u/n),h=u%n,m=e.isArray()?e.get(r,o):e,f=t.isArray()?t.get(c,h):t;if(m.isError())return{isError:!0,errorObject:m,array1Values:i,array2Values:s,noCalculate:l};if(f.isError())return{isError:!0,errorObject:f,array1Values:i,array2Values:s,noCalculate:l};if(m.isNull()||f.isNull()||m.isBoolean()||f.isBoolean())continue;let g=m.getValue(),d=f.getValue();(0,P.isRealNum)(g)&&(0,P.isRealNum)(d)&&(i.push(+g),s.push(+d),l=!1)}return{isError:!1,errorObject:null,array1Values:i,array2Values:s,noCalculate:l}}function l3(e){let t=e;if(e.isArray()){let r=e.getRowCount(),a=e.getColumnCount();if(r>1||a>1)return rR.create(q.VALUE);t=e.get(0,0)}return t.isError(),t}function l5(...e){for(let t=0;t<e.length;t++){let r=l3(e[t]);if(r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}function l4(...e){for(let t=0;t<e.length;t++){let r=l3(e[t]);if(r.isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE)};e[t]=r}return{isError:!1,variants:e}}function l6(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return{isError:!0,errorObject:r};if(r.isNull())return{isError:!0,errorObject:rR.create(q.NA)};if((r=l3(e[t])).isError())return{isError:!0,errorObject:r};if(r.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE)};e[t]=r}return{isError:!1,variants:e}}function l9(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return{isError:!0,errorObject:r};e[t]=r}return{isError:!1,variants:e}}B(lM,"betaCDF"),B(lx,"betaPDF"),B(lv,"betaINV"),B(lU,"incompleteBetaFunction"),B(lD,"betaContinuedFraction"),B(lP,"betaFunction"),B(lL,"betaFunctionNaturalLogarithm"),B(lw,"logGamma"),B(lF,"gammaFunction"),B(lj,"binomialCDF"),B(lB,"binomialPDF"),B(lk,"chisquareCDF"),B(l$,"chisquarePDF"),B(lY,"chisquareINV"),B(lH,"lowRegGamma"),B(lG,"lowRegGammaInverse"),B(lq,"studentTINV"),B(lW,"exponentialCDF"),B(lQ,"exponentialPDF"),B(lX,"centralFCDF"),B(lK,"centralFPDF"),B(lZ,"centralFINV"),B(lz,"forecastLinear"),B(lJ,"normalCDF"),B(l0,"normalPDF"),B(l1,"normalINV"),B(l2,"getTwoArrayNumberValues"),B(l3,"checkVariantErrorIsArray"),B(l5,"checkVariantsErrorIsArray"),B(l4,"checkVariantsErrorIsArrayOrBoolean"),B(l6,"checkVariantsErrorIsNullorArrayOrBoolean"),B(l9,"checkVariantsErrorIsStringToNumber");let l7=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(1);i.isNull()&&(i=nR.create(0)),s.isNull()&&(s=nR.create(1));let l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.mapValue((e,t,r)=>{let a=c.get(t,r),n=h.get(t,r),i=m.get(t,r),s=f.get(t,r);return this._handleSignleObject(e,a,n,i,s)});return 1===l&&1===u?g.get(0,0):g}_handleSignleObject(e,t,r,a,n){let{isError:i,errorObject:s,variants:l}=l9(e,t,r,a,n);if(i)return s;let[u,o,c,h,m]=l,f=+u.getValue(),g=+o.getValue(),d=+c.getValue(),N=+h.getValue(),_=+m.getValue();if(g<=0||d<=0||f<=0||f>=1||N>=_)return rR.create(q.NUM);let C=lv(f,g,d)*(_-N)+N;return nR.create(C)}};B(l7,"BetaInv");let l8=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=nF(n,i,a,rR.create(q.NA)),c=s.mapValue((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r),i=o.get(t,r);return this._handleSignleObject(e,a,n,i)});return 1===n&&1===i?c.get(0,0):c}_handleSignleObject(e,t,r,a){let n;let{isError:i,errorObject:s,variants:l}=l9(e,t,r,a);if(i)return s;let[u,o,c,h]=l,m=Math.floor(+u.getValue()),f=Math.floor(+o.getValue()),g=+c.getValue(),d=+h.getValue();return m<0||m>f||g<0||g>1?rR.create(q.NUM):(n=d?lj(m,f,g):lB(m,f,g),nR.create(n))}};B(l8,"BinomDist");let ue=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=Math.floor(+s.getValue()),c=+l.getValue(),h=+u.getValue();if(o<0||c<=0||c>=1||h<=0||h>=1)return rR.create(q.NUM);let m=0;for(;m<=o&&!(lj(m,o,c)>=h);)m++;return nR.create(m)}};B(ue,"BinomInv");let ut=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=i.get(t,r);return this._handleSignleObject(e,a)});return 1===r&&1===a?s.get(0,0):s}_handleSignleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(l<0||u<1||u>1e10)return rR.create(q.NUM);let o=1-lk(l,u);return nR.create(o)}};B(ut,"ChisqDistRt");let ur=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=i.get(t,r);return this._handleSignleObject(e,a)});return 1===r&&1===a?s.get(0,0):s}_handleSignleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(l<0||l>1||u<1)return rR.create(q.NUM);let o=lY(1-l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(ur,"ChisqInvRt");let ua=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=e;if(e.isArray()&&1===r&&1===a&&(s=e.get(0,0)),s.isError())return s;let l=t;if(t.isArray()&&1===n&&1===i&&(l=t.get(0,0)),l.isError())return l;if(r*a==1||n*i==1)return s.isNull()||l.isNull()?rR.create(q.VALUE):rR.create(q.NA);if(r*a!=n*i)return rR.create(q.NA);let{isError:u,errorObject:o,array1Values:c,array2Values:h,noCalculate:m}=l2(e,t,r*a,a,i);return u?o:m?rR.create(q.DIV_BY_ZERO):this._getResult(c,h,r,a)}_getResult(e,t,r,a){let n=0;for(let r=0;r<e.length;r++){if(0===t[r])return rR.create(q.DIV_BY_ZERO);n+=(e[r]-t[r])**2/t[r]}let i=(r-1)*(a-1);1===r?i=a-1:1===a&&(i=r-1);let s=1-lk(n,i);return nR.create(s)}};B(ua,"ChisqTest");let un=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=l9(e,s.get(t,r),l.get(t,r));if(a)return n;let[u,o,c]=i,h=+u.getValue(),m=+o.getValue(),f=Math.floor(+c.getValue());if(h<=0||h>=1||m<=0||f<1)return rR.create(q.NUM);let g=Math.abs(l1(h/2,0,1)*m/Math.sqrt(f));return nR.create(g)});return 1===a&&1===n?u.get(0,0):u}};B(un,"ConfidenceNorm");let ui=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=e;if(e.isArray()&&1===r&&1===a&&(s=e.get(0,0)),s.isError())return s;let l=t;if(t.isArray()&&1===n&&1===i&&(l=t.get(0,0)),l.isError())return l;if((r*a==1||n*i==1)&&(s.isNull()||l.isNull()))return rR.create(q.VALUE);if(r*a!=n*i)return rR.create(q.NA);let{isError:u,errorObject:o,array1Values:c,array2Values:h,noCalculate:m}=l2(e,t,r*a,a,i);return u?o:m?rR.create(q.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(0===e.length)return rR.create(q.DIV_BY_ZERO);let r=e.length,a=0,n=0;for(let i=0;i<r;i++)a+=e[i],n+=t[i];let i=a/r,s=n/r,l=0;for(let a=0;a<r;a++)l+=(e[a]-i)*(t[a]-s);return nR.create(l/r)}};B(ui,"CovarianceP");let us=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let a;let{isError:n,errorObject:i,variants:s}=l9(e,t,r);if(n)return i;let[l,u,o]=s,c=+l.getValue(),h=+u.getValue(),m=+o.getValue();return c<0||h<=0?rR.create(q.NUM):(a=m?lW(c,h):lQ(c,h),nR.create(a))}};B(us,"ExponDist");let ul=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(o<0||c<1||c>1e10||h<1||h>1e10)return rR.create(q.NUM);let m=1-lX(o,c,h);return nR.create(m)}};B(ul,"FDistRt");let uu=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(o<0||o>1||c<1||c>1e10||h<1||h>1e10)return rR.create(q.NUM);let m=lZ(1-o,c,h);return Number.isNaN(m)||!Number.isFinite(m)?rR.create(q.NUM):nR.create(m)}};B(uu,"FInvRt");let uo=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variance:n,ns1:i}=this._getValues(e);if(r)return a;let{isError:s,errorObject:l,variance:u,ns1:o}=this._getValues(t);if(s)return l;let c=2*(1-lX(n/u,i,o));return c>1&&(c=2-c),nR.create(c)}_getValues(e){let t=0,r=0,a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(1===a&&1===n){let a=e.isArray()?e.get(0,0):e;return a.isError()?{isError:!0,errorObject:a,variance:t,ns1:r}:a.isNull()?{isError:!0,errorObject:rR.create(q.VALUE),variance:t,ns1:r}:{isError:!0,errorObject:rR.create(q.DIV_BY_ZERO),variance:t,ns1:r}}let i=[],s=0;for(let l=0;l<a;l++)for(let a=0;a<n;a++){let n=e.isArray()?e.get(l,a):e;if(n.isError())return{isError:!0,errorObject:n,variance:t,ns1:r};if(n.isNull()||n.isBoolean())continue;let u=n.getValue();(0,P.isRealNum)(u)&&(i.push(+u),s+=+u)}if(i.length<=1)return{isError:!0,errorObject:rR.create(q.DIV_BY_ZERO),variance:t,ns1:r};let l=s/i.length,u=0;for(let e=0;e<i.length;e++)u+=(i[e]-l)**2;return 0==(t=u/(r=i.length-1))?{isError:!0,errorObject:rR.create(q.DIV_BY_ZERO),variance:t,ns1:r}:{isError:!1,errorObject:null,variance:t,ns1:r}}};B(uo,"FTest");let uc=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=nF(n,i,a,rR.create(q.NA)),c=s.mapValue((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r),i=o.get(t,r);return this._handleSignleObject(e,a,n,i)});return 1===n&&1===i?c.get(0,0):c}_handleSignleObject(e,t,r,a){let n;let{isError:i,errorObject:s,variants:l}=l9(e,t,r,a);if(i)return s;let[u,o,c,h]=l,m=+u.getValue(),f=+o.getValue(),g=+c.getValue(),d=+h.getValue();return g<=0?rR.create(q.NUM):(n=d?lJ(m,f,g):l0(m,f,g),nR.create(n))}};B(uc,"NormDist");let uh=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=+l.getValue(),h=+u.getValue();if(o<=0||o>=1||h<=0)return rR.create(q.NUM);let m=l1(o,c,h);return nR.create(m)}};B(uh,"NormInv");let um=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=+n.getValue();if(i<=0||i>=1)return rR.create(q.NUM);let s=l1(i,0,1);return nR.create(s)}};B(um,"NormSInv");let uf=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std()}};B(uf,"StdevP");let ug=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.std(1)}};B(ug,"StdevS");let ud=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var()}};B(ud,"VarP");let uN=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e);return t.isError()?t:t.var(1)}};B(uN,"VarS");let u_=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(1);i.isNull()&&(i=nR.create(0)),s.isNull()&&(s=nR.create(1));let l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.mapValue((e,t,r)=>{let a=c.get(t,r),n=h.get(t,r),i=m.get(t,r),s=f.get(t,r);return this._handleSignleObject(e,a,n,i,s)});return 1===l&&1===u?g.get(0,0):g}_handleSignleObject(e,t,r,a,n){let{isError:i,errorObject:s,variants:l}=l9(e,t,r,a,n);if(i)return s;let[u,o,c,h,m]=l,f=+u.getValue(),g=+o.getValue(),d=+c.getValue(),N=+h.getValue(),_=+m.getValue();if(g<=0||d<=0||f<N||f>_||N===_)return rR.create(q.NUM);let C=lM((f-N)/(_-N),g,d);return nR.create(C)}};B(u_,"Betadist");var uC=((y=uC||{}).BETADIST="BETADIST",y.BETAINV="BETAINV",y.BINOMDIST="BINOMDIST",y.CHIDIST="CHIDIST",y.CHIINV="CHIINV",y.CHITEST="CHITEST",y.CONFIDENCE="CONFIDENCE",y.COVAR="COVAR",y.CRITBINOM="CRITBINOM",y.EXPONDIST="EXPONDIST",y.FDIST="FDIST",y.FINV="FINV",y.FTEST="FTEST",y.GAMMADIST="GAMMADIST",y.GAMMAINV="GAMMAINV",y.HYPGEOMDIST="HYPGEOMDIST",y.LOGINV="LOGINV",y.LOGNORMDIST="LOGNORMDIST",y.MODE="MODE",y.NEGBINOMDIST="NEGBINOMDIST",y.NORMDIST="NORMDIST",y.NORMINV="NORMINV",y.NORMSDIST="NORMSDIST",y.NORMSINV="NORMSINV",y.PERCENTILE="PERCENTILE",y.PERCENTRANK="PERCENTRANK",y.POISSON="POISSON",y.QUARTILE="QUARTILE",y.RANK="RANK",y.STDEV="STDEV",y.STDEVP="STDEVP",y.TDIST="TDIST",y.TINV="TINV",y.TTEST="TTEST",y.VAR="VAR",y.VARP="VARP",y.WEIBULL="WEIBULL",y.ZTEST="ZTEST",y);let uE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSignleObject(e));return 1===e.getRowCount()&&1===e.getColumnCount()?t.get(0,0):t}return this._handleSignleObject(e)}_handleSignleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=lJ(+n.getValue(),0,1);return nR.create(i)}};B(uE,"Normsdist");let up=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),l=null!=r?r:nR.create(0);l.isReferenceObject()&&(l=l.toArrayValueObject());let u=Math.max(a.isArray()?a.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,a,rR.create(q.NA)),h=nF(u,o,l,rR.create(q.NA)),m=c.map((t,r,a)=>{let l=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return rR.create(q.NA);if(n)return i;if(l.isError())return l;let u=+t.getValue(),o=+l.getValue();if(Number.isNaN(u)||Number.isNaN(o))return rR.create(q.VALUE);let c=s.sort((e,t)=>o?e-t:t-e).indexOf(u);return -1===c?rR.create(q.NA):nR.create(c+1)});return 1===u&&1===o?m.get(0,0):m}_checkRefReferenceObject(e){let t=!1,r=rR.create(q.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};B(up,"Rank");let uA=[[u_,uC.BETADIST],[l7,uC.BETAINV],[l8,uC.BINOMDIST],[ut,uC.CHIDIST],[ur,uC.CHIINV],[ua,uC.CHITEST],[un,uC.CONFIDENCE],[ui,uC.COVAR],[ue,uC.CRITBINOM],[us,uC.EXPONDIST],[ul,uC.FDIST],[uu,uC.FINV],[uo,uC.FTEST],[uc,uC.NORMDIST],[uh,uC.NORMINV],[uE,uC.NORMSDIST],[um,uC.NORMSINV],[up,uC.RANK],[ug,uC.STDEV],[uf,uC.STDEVP],[uN,uC.VAR],[ud,uC.VARP]],ub=[];var uy=((R=uy||{}).CUBEKPIMEMBER="CUBEKPIMEMBER",R.CUBEMEMBER="CUBEMEMBER",R.CUBEMEMBERPROPERTY="CUBEMEMBERPROPERTY",R.CUBERANKEDMEMBER="CUBERANKEDMEMBER",R.CUBESET="CUBESET",R.CUBESETCOUNT="CUBESETCOUNT",R.CUBEVALUE="CUBEVALUE",R);let uR=class extends lm{isCustom(){return!0}};B(uR,"CustomFunction");let uS=uR;function uO(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,databaseValues:t};let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:rR.create(q.VALUE),databaseValues:t};for(let n=0;n<r;n++){let r=[];for(let t=0;t<a;t++){let a=e.get(n,t);if(a.isNull()){r.push(null);continue}let i=`${a.getValue()}`;if(a.isBoolean()&&(i=i.toLocaleUpperCase()),a.isNumber()||(0,P.isRealNum)(i)){r.push(+i);continue}r.push(i)}t.push(r)}return{isError:!1,errorObject:null,databaseValues:t}}function uT(e,t){let r=-1;if(e.isError())return{isError:!0,errorObject:e,fieldIndex:r};let a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1;if(a>1||n>1)return{isError:!0,errorObject:rR.create(q.VALUE),fieldIndex:r};let i=e.isArray()?e.get(0,0):e,s=`${i.getValue()}`;if(i.isNull()?s=0:i.isBoolean()?s=i.getValue()?1:0:(i.isNumber()||(0,P.isRealNum)(s))&&(s=Math.floor(+s)),"number"==typeof s){if(s<1||s>t[0].length)return{isError:!0,errorObject:rR.create(q.VALUE),fieldIndex:r};r=s-1}else if(-1===(r=t[0].findIndex(e=>null!==e&&`${e}`.toLocaleLowerCase()===s.toLocaleLowerCase())))return{isError:!0,errorObject:rR.create(q.VALUE),fieldIndex:r};return{isError:!1,errorObject:null,fieldIndex:r}}function uV(e){let t=[];if(e.isError())return{isError:!0,errorObject:e,criteriaValues:t};let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1;if(r<2)return{isError:!0,errorObject:rR.create(q.VALUE),criteriaValues:t};for(let n=0;n<r;n++){let r=[];for(let t=0;t<a;t++){let a=e.get(n,t);if(a.isNull()){r.push(null);continue}let i=`${a.getValue()}`;if(a.isBoolean()){r.push(a.getValue()?1:0);continue}if(a.isNumber()||(0,P.isRealNum)(i)){r.push(+i);continue}r.push(i)}t.push(r)}return{isError:!1,errorObject:null,criteriaValues:t}}function uI(e,t,r){let a=e.length,n=e[0].length,i={},s=!1;for(let l=1;l<a;l++){let a=!0;for(let s=0;s<n;s++){let n=e[l][s];if(null===n)continue;let u=i[s];if(void 0===u){let r=e[0][s];u=t[0].findIndex(e=>null!==e&&null!==r&&`${e}`.toLocaleLowerCase()===`${r}`.toLocaleLowerCase()),i[s]=u}if(-1===u&&("string"==typeof n||0===n)){a=!1;break}if(u>-1){let e=t[r][u];if(null===e){a=!1;break}let[i,s]=nB(`${n}`);if(!nL.create(`${e}`).compare(s,i).getValue()){a=!1;break}}}if(a){s=!0;break}}return s}B(uO,"checkDatabase"),B(uT,"checkField"),B(uV,"checkCriteria"),B(uI,"isCriteriaMatch");let uM=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=0,f=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m+=t,f++)}return 0===f?rR.create(q.DIV_BY_ZERO):nR.create(m/f)}};B(uM,"Daverage");let ux=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=0;for(let e=1;e<i.length;e++)"number"==typeof i[e][u]&&uI(h,i,e)&&m++;return nR.create(m)}};B(ux,"Dcount");let uv=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=0;for(let e=1;e<i.length;e++)null!=i[e][u]&&uI(h,i,e)&&m++;return nR.create(m)}};B(uv,"Dcounta");let uU=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=0,f=0;for(let e=1;e<i.length;e++)null!=i[e][u]&&uI(h,i,e)&&(m++,f=e);return 0===m?rR.create(q.VALUE):m>1?rR.create(q.NUM):e.get(f,u)}};B(uU,"Dget");let uD=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=-1/0,f=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m=Math.max(m,t),f++)}return 0===f?nR.create(0):nR.create(m)}};B(uD,"Dmax");let uP=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=1/0,f=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m=Math.min(m,t),f++)}return 0===f?nR.create(0):nR.create(m)}};B(uP,"Dmin");let uL=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=1,f=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m*=t,f++)}return 0===f?nR.create(0):nR.create(m)}};B(uL,"Dproduct");let uw=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=[],f=0,g=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m.push(t),f+=t,g++)}if(g<=1)return rR.create(q.DIV_BY_ZERO);let d=f/g,N=0;for(let e=0;e<g;e++)N+=(m[e]-d)**2;let _=Math.sqrt(N/(g-1));return nR.create(_)}};B(uw,"Dstdev");let uF=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=[],f=0,g=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m.push(t),f+=t,g++)}if(0===g)return rR.create(q.DIV_BY_ZERO);let d=f/g,N=0;for(let e=0;e<g;e++)N+=(m[e]-d)**2;let _=Math.sqrt(N/g);return nR.create(_)}};B(uF,"Dstdevp");let uj=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m+=t)}return nR.create(m)}};B(uj,"Dsum");let uB=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=[],f=0,g=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m.push(t),f+=t,g++)}if(g<=1)return rR.create(q.DIV_BY_ZERO);let d=f/g,N=0;for(let e=0;e<g;e++)N+=(m[e]-d)**2;let _=N/(g-1);return nR.create(_)}};B(uB,"Dvar");let uk=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,databaseValues:i}=uO(e);if(a)return n;let{isError:s,errorObject:l,fieldIndex:u}=uT(t,i);if(s)return l;let{isError:o,errorObject:c,criteriaValues:h}=uV(r);if(o)return c;let m=[],f=0,g=0;for(let e=1;e<i.length;e++){let t=i[e][u];"number"==typeof t&&uI(h,i,e)&&(m.push(t),f+=t,g++)}if(0===g)return rR.create(q.DIV_BY_ZERO);let d=f/g,N=0;for(let e=0;e<g;e++)N+=(m[e]-d)**2;let _=N/g;return nR.create(_)}};B(uk,"Dvarp");var u$=((S=u$||{}).DAVERAGE="DAVERAGE",S.DCOUNT="DCOUNT",S.DCOUNTA="DCOUNTA",S.DGET="DGET",S.DMAX="DMAX",S.DMIN="DMIN",S.DPRODUCT="DPRODUCT",S.DSTDEV="DSTDEV",S.DSTDEVP="DSTDEVP",S.DSUM="DSUM",S.DVAR="DVAR",S.DVARP="DVARP",S);let uY=[[uM,u$.DAVERAGE],[ux,u$.DCOUNT],[uv,u$.DCOUNTA],[uU,u$.DGET],[uD,u$.DMAX],[uP,u$.DMIN],[uL,u$.DPRODUCT],[uw,u$.DSTDEV],[uF,u$.DSTDEVP],[uj,u$.DSUM],[uB,u$.DVAR],[uk,u$.DVARP]];var uH=((O=uH||{}).DATE="DATE",O.DATEDIF="DATEDIF",O.DATEVALUE="DATEVALUE",O.DAY="DAY",O.DAYS="DAYS",O.DAYS360="DAYS360",O.EDATE="EDATE",O.EOMONTH="EOMONTH",O.HOUR="HOUR",O.ISOWEEKNUM="ISOWEEKNUM",O.MINUTE="MINUTE",O.MONTH="MONTH",O.NETWORKDAYS="NETWORKDAYS",O.NETWORKDAYS_INTL="NETWORKDAYS.INTL",O.NOW="NOW",O.SECOND="SECOND",O.TIME="TIME",O.TIMEVALUE="TIMEVALUE",O.TODAY="TODAY",O.WEEKDAY="WEEKDAY",O.WEEKNUM="WEEKNUM",O.WORKDAY="WORKDAY",O.WORKDAY_INTL="WORKDAY.INTL",O.YEAR="YEAR",O.YEARFRAC="YEARFRAC",O);let uG="yyyy/mm/dd;@";function uq(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),a=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),n=(a-t.getTime())/864e5;return a>r.getTime()&&(n+=1),Math.floor(n)+1}function uW(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),a=(e.getTime()-t.getTime())/864e5;return e>r&&(a+=1),a+1}function uQ(e){let t=new Date(Date.UTC(1900,0,1)),r=new Date(Date.UTC(1900,1,28)),a=Math.floor(e)-1;return a>(r.getTime()-t.getTime())/864e5&&(a-=1),new Date(t.getTime()+864e5*a)}function uX(e){let t=new Date(Date.UTC(1900,0,1,0,0,0)),r=new Date(Date.UTC(1900,1,28,0,0,0)),a=e-1;return a>(r.getTime()-t.getTime())/864e5&&(a-=1),a<0&&(a=e),new Date(t.getTime()+864e5*a)}function uK(e){if(!/^\d{4}[-/](0?[1-9]|1[012])[-/](0?[1-9]|[12][0-9]|3[01])$/.test(e))return!1;let t=e.replace(/-/g,"/").replace(/T.+/,""),r=/* @__PURE__ */new Date(`${t}`);if(Number.isNaN(r.getTime()))return!1;let a=r.getFullYear(),n=(r.getMonth()+1).toString().padStart(2,"0"),i=r.getDate().toString().padStart(2,"0"),s=`${a}-${n}-${i}`;return e.replace(/\//g,"-").split("-").map(e=>e.padStart(2,"0")).join("-")===s}function uZ(e){return(0,P.numfmt).parseDate(e)}function uz(e){return(0,P.numfmt).parseValue(e)}function uJ(e){return(0,P.numfmt).parseTime(e)}function u0(e){return(0,P.numfmt).isDate(e)}B(uq,"excelDateSerial"),B(uW,"excelDateTimeSerial"),B(uQ,"excelSerialToDate"),B(uX,"excelSerialToDateTime"),B(uK,"isValidDateStr"),B(uZ,"parseFormattedDate"),B(uz,"parseFormattedValue"),B(uJ,"parseFormattedTime"),B(u0,"isDate");let u1={1:[6,0],2:[0,1],3:[1,2],4:[2,3],5:[3,4],6:[4,5],7:[5,6],11:[0],12:[1],13:[2],14:[3],15:[4],16:[5],17:[6]};function u2(e){return!!("string"==typeof e&&/^[0|1]{7}/.test(e)||u1[Number(e)])}function u3(e){if(!u2(e))return[];if("string"==typeof e&&/^[0|1]{7}/.test(e)){let t=[];for(let r=1;r<=e.length;r++)"1"==`${e[r-1]}`&&(r===e.length?t.push(0):t.push(r));return t}return u1[Number(e)]||[]}function u5(e,t,r=1,a){let n=u3(r),i=Math.floor(e),s=Math.floor(t),l=s>i?i:s,u=0,o=Math.abs(Math.floor(t)-Math.floor(e))+1;for(let e=0;e<o;e++){let t=l+e;if(a&&a.length>0&&a.some(e=>Math.floor(e)===t))continue;let r=u9(t);n.includes(r)||u++}return s>i?u:-u}function u4(e,t,r=1,a){let n=u3(r),i=Math.floor(e),s=i,l=Math.abs(t);for(let e=1;e<=l;e++){let r=t<0?i-e:i+e;if(r<0)return rR.create(q.NUM);if(a&&a.length>0&&a.some(e=>Math.floor(e)===r)){l++;continue}let u=u9(r);if(n.includes(u)){l++;continue}s=r}return s}function u6(e){if(e.isError())return e;let t=e.getValue();if(e.isString()){let e;if(uZ(`${t}`))e=uZ(`${t}`).v;else if(uJ(`${t}`))e=uJ(`${t}`).v;else{if(!(0,P.isRealNum)(t))return rR.create(q.VALUE);e=+t}return e instanceof Date&&(e=uW(e)),0>+e||+e>2958465?rR.create(q.NUM):+e}{let t=+e.getValue();return t<0||t>2958465?rR.create(q.NUM):t}}function u9(e){let t=60===Math.floor(e),r=uQ(e),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getTime(),n=new Date(Date.UTC(1900,1,28)).getTime();return!t&&a<=n&&(r=new Date(a-864e5)),new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate())).getUTCDay()}function u7(e,t,r){switch(r){case 0:return u8(e,t);case 1:return oe(e,t);case 2:return{days:Math.abs(t-e),yearDays:360};case 3:default:return{days:Math.abs(t-e),yearDays:365};case 4:return ot(e,t)}}function u8(e,t){let r=uQ(e),a=e>0?r.getUTCFullYear():1900,n=e>0?r.getUTCMonth()+1:1,i=e>0?r.getUTCDate():0,s=uQ(t),l=t>0?s.getUTCFullYear():1900,u=t>0?s.getUTCMonth()+1:1,o=t>0?s.getUTCDate():0;return 2===n?uQ(e+1).getUTCMonth()+1===3&&(i=30):31===i&&(i=30),31===o&&(i<30?(l=(s=uQ(t+1)).getUTCFullYear(),u=s.getUTCMonth()+1,o=s.getUTCDate()):o=30),{days:Math.abs((l-a)*360+(t>=e?30-i:-i)+(t>=e?o:o-30)+(t>=e?u-n-1:u-n+1)*30),yearDays:360}}function oe(e,t){let r,a;let n=uQ(e),i=e>0?n.getUTCFullYear():1900,s=uQ(t),l=t>0?s.getUTCFullYear():1900,u=Math.abs(t-e),o=Math.abs(l-i)+1;if(l<i){let e=new Date(Date.UTC(l,0,1)),t=new Date(Date.UTC(i,11,31));r=uq(e),a=uq(t),1900===l&&(r+=1)}else{let e=new Date(Date.UTC(i,0,1)),t=new Date(Date.UTC(l,11,31));r=uq(e),a=uq(t),1900===i&&(r+=1)}return{days:u,yearDays:(a-r+1)/o}}function ot(e,t){let r=uQ(e),a=e>0?r.getUTCFullYear():1900,n=e>0?r.getUTCMonth()+1:1,i=e>0?r.getUTCDate():0,s=uQ(t),l=t>0?s.getUTCFullYear():1900,u=t>0?s.getUTCMonth()+1:1,o=t>0?s.getUTCDate():0;return 31===i&&(i=30),31===o&&(o=30),{days:Math.abs((l-a)*360+(t>=e?30-i:-i)+(t>=e?o:o-30)+(t>=e?u-n-1:u-n+1)*30),yearDays:360}}function or(e){return e%4==0&&e%100!=0||e%400==0}function oa(e){return e%4==0&&e%100!=0||e%400==0||1900===e}B(u2,"isValidWeekend"),B(u3,"getWeekendArray"),B(u5,"countWorkingDays"),B(u4,"getDateSerialNumberByWorkingDays"),B(u6,"getDateSerialNumberByObject"),B(u9,"getWeekDayByDateSerialNumber"),B(u7,"getTwoDateDaysByBasis"),B(u8,"getDaysByNASD"),B(oe,"getDaysByActual"),B(ot,"getDaysByEuropean"),B(or,"isLeapYear"),B(oa,"isLeapYear1900");let on=[31,29,31,30,31,30,31,31,30,31,30,31],oi=[31,28,31,30,31,30,31,31,30,31,30,31];function os(e,t){return or(e)?on[t]:oi[t]}function ol(e){return oa(e)?366:365}function ou(e,t){switch(t){case 0:case 2:case 4:return 360;case 1:return ol(uQ(e).getUTCFullYear());case 3:return 365;default:return -1}}function oo(e,t,r){return os(e,t)===r}function oc(e,t){let r=e.getUTCFullYear(),a=e.getUTCMonth();return oo(r,a,e.getUTCDate())?(e.setUTCDate(1),e.setUTCMonth(e.getUTCMonth()+t),r=e.getUTCFullYear(),a=e.getUTCMonth(),e.setUTCDate(os(r,a))):e.setUTCMonth(e.getUTCMonth()+t),e}B(os,"getDaysInMonth"),B(ol,"getDaysInYear"),B(ou,"getNormalYearDaysByBasis"),B(oo,"lastDayOfMonth"),B(oc,"dateAddMonths");let oh=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e),s=nF(a,n,t),l=nF(a,n,r);return i.map((e,t,r)=>{let a=s.get(t,r)||nE.create(),n=l.get(t,r)||nE.create();if(e.isError())return e;if(a.isError())return a;if(n.isError())return n;if(e.isString()||a.isString()||n.isString())return rR.create(q.VALUE);let i=+e.getValue(),u=Math.floor(+a.getValue()),o=+n.getValue();if(i<0||i>9999)return rR.create(q.NUM);i>=0&&i<1899&&(i+=1900);let c=uq(new Date(i,u-1,o));return c<0?rR.create(q.NUM):nR.create(c,uG)})}};B(oh,"DateFunction");let om=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t,i=r;if(a.isArray()&&(a=a.get(0,0)),n.isArray()&&(n=n.get(0,0)),i.isArray()&&(i=i.get(0,0)),a.isError())return a;if(n.isError())return n;if(i.isError())return i;let s=u6(a);if("number"!=typeof s)return s;let l=u6(n);return"number"!=typeof l?l:l<s||!i.isString()?rR.create(q.NUM):this._getResultByUnit(s,l,i)}_getResultByUnit(e,t,r){let a=uQ(e),n=a.getUTCFullYear(),i=a.getUTCMonth()+1,s=a.getUTCDate(),l=uQ(t),u=l.getUTCFullYear(),o=l.getUTCMonth()+1,c=l.getUTCDate(),h=`${r.getValue()}`.toLocaleUpperCase(),m=0,f;switch(h){case"Y":m=u-n,(o<i||o===i&&c<s)&&(m-=1);break;case"M":m=(u-n)*12+o-i,c<s&&(m-=1);break;case"D":m=Math.floor(t)-Math.floor(e);break;case"MD":m=c-s,c<s&&(m+=os((f=new Date(Date.UTC(u,o-1,0))).getUTCFullYear(),f.getUTCMonth()));break;case"YM":m=o-i,(o<i||o===i&&c<s)&&(m+=12),c<s&&(m-=1);break;case"YD":f=new Date(Date.UTC(n,o-1,c)),(o<i||o===i&&c<s)&&(f=new Date(Date.UTC(n+1,o-1,c))),m=Math.floor(uq(f))-Math.floor(e);break;default:return rR.create(q.NUM)}return nR.create(m)}};B(om,"Datedif");let of=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=uz(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&u0(r))return e instanceof Date&&(e=uW(e)),nR.create(Math.trunc(+e))}}return rR.create(q.VALUE)}};B(of,"Datevalue");let og=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;let r=e.getValue();if(e.isString()){if(!uK(`${r}`))return rR.create(q.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return rR.create(q.NUM);if(0===r)return nR.create(0);t=uQ(r)}let a=t.getDate();return nR.create(a)}};B(og,"Day");let od=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t),s=n.map((e,t,r)=>{let a=i.get(t,r);if(e.isError())return e;if(a.isError())return a;let n=u6(e);if("number"!=typeof n)return n;let s=u6(a);if("number"!=typeof s)return s;let l=Math.floor(n)-Math.floor(s);return nR.create(l)});return 1===r&&1===a?s.get(0,0):s}};B(od,"Days");let oN=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:nA.create(!1);if(e.isError())return e;if(t.isError())return t;if(a.isError())return a;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,a,rR.create(q.NA)),o=s.map((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r);if(e.isError())return e;let i=u6(e);if("number"!=typeof i)return i;if(a.isError())return a;let s=u6(a);if("number"!=typeof s)return s;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let{days:o}=u7(i,s,+n.getValue()?4:0);return nR.create(s>=i?o:-o)});return 1===n&&1===i?o.get(0,0):o}};B(oN,"Days360");let o_=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t);return n.map((e,t,r)=>{let a=i.get(t,r)||nE.create();if(e.isError())return e;if(a.isError())return a;if(e.isString()||e.isBoolean()||a.isString()||a.isBoolean())return rR.create(q.VALUE);let n=+e.getValue();if(n<0)return rR.create(q.NUM);let s=Math.floor(+a.getValue()),l=uQ(n),u=uq(new Date(Date.UTC(l.getUTCFullYear(),l.getUTCMonth()+s,l.getUTCDate())));return nR.create(u,uG)})}};B(o_,"Edate");let oC=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e,a=t;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);r=r.get(0,0)}if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(r.isError())return r;if(a.isError())return a;let n=u6(r);if("number"!=typeof n)return n;if(a.isBoolean())return rR.create(q.VALUE);let i=uQ(n),s=n>0?i.getUTCFullYear():1900,l=n>0?i.getUTCMonth():0,u=Math.floor(+a.getValue());if(Number.isNaN(u))return rR.create(q.VALUE);let o=uq(new Date(Date.UTC(s,l+u+1,0)));return nR.create(o)}};B(oC,"Eomonth");let oE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=u6(e);if("number"!=typeof t)return t;if(0===t)return nR.create(0);let r=uX(t).getUTCHours();return nR.create(r)}};B(oE,"Hour");let op=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=u6(e);if("number"!=typeof t)return t;let r=uQ(t),a=t>0?r.getUTCFullYear():1900,n=new Date(Date.UTC(a,0,1)),i=uq(n),s=u9(i),l;t<(l=s<1?i+1:s<=4?i-(s-1):i+(11-s))&&(l=(s=u9(i=uq(n=new Date(Date.UTC(a-1,0,1)))))<1?i+1:s<=4?i-(s-1):i+(11-s));let u=Math.ceil((t-l+1)/7);return nR.create(u)}};B(op,"Isoweeknum");let oA=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=u6(e);if("number"!=typeof t)return t;if(0===t)return nR.create(0);let r=uX(t).getUTCMinutes();return nR.create(r)}};B(oA,"Minute");let ob=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!uK(`${r}`))return rR.create(q.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let r=+e.getValue();if(r<0)return rR.create(q.NUM);if(0===r)return nR.create(1);t=uQ(r)}let a=t.getUTCMonth()+1;return nR.create(a)}};B(ob,"Month");let oy=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(a.isError())return a;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);n=n.get(0,0)}if(n.isError())return n;if(null!=r&&r.isError())return r;if(a.isBoolean()||n.isBoolean())return rR.create(q.VALUE);let i=u6(a);if("number"!=typeof i)return i;let s=u6(n);if("number"!=typeof s)return s;if(r)return this._getResultByHolidays(i,s,r);let l=u5(i,s);return nR.create(l)}_getResultByHolidays(e,t,r){let a=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let n=0;n<e;n++)for(let e=0;e<t;e++){let t=r.get(n,e);if(t.isBoolean())return rR.create(q.VALUE);let i=u6(t);if("number"!=typeof i)return i;a.push(i)}}else{if(r.isBoolean())return rR.create(q.VALUE);let e=u6(r);if("number"!=typeof e)return e;a.push(e)}let n=u5(e,t,1,a);return nR.create(n)}};B(oy,"Networkdays");let oR=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",4)}calculate(e,t,r,a){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=a&&a.isError()?a:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,t,r,a)}_handleSingleObject(e,t,r,a){let n=e,i=t;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);n=n.get(0,0)}if(n.isError())return n;if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);i=i.get(0,0)}if(i.isError())return i;let s=1;if(r){if(s=r.getValue(),r.isBoolean()&&(s=+s),r.isString()&&!u2(s))return rR.create(q.VALUE);if(!u2(s))return rR.create(q.NUM)}if(n.isBoolean()||i.isBoolean())return rR.create(q.VALUE);let l=u6(n);if("number"!=typeof l)return l;let u=u6(i);if("number"!=typeof u)return u;if(a)return this._getResultByHolidays(l,u,s,a);let o=u5(l,u,s);return nR.create(o)}_getResultByHolidays(e,t,r,a){let n=[];if(null!=a&&a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=a.get(r,e);if(t.isBoolean())return rR.create(q.VALUE);let i=u6(t);if("number"!=typeof i)return i;n.push(i)}}else{if(a.isBoolean())return rR.create(q.VALUE);let e=u6(a);if("number"!=typeof e)return e;n.push(e)}let i=u5(e,t,r,n);return nR.create(i)}};B(oR,"NetworkdaysIntl");let oS=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){let e=/* @__PURE__ */new Date,t=uW(new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds())));return nR.create(t,"yyyy/mm/dd hh:mm")}};B(oS,"Now");let oO=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>e.isError()?e:this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=u6(e);if("number"!=typeof t)return t;if(0===t)return nR.create(0);let r=uX(t).getUTCSeconds();return nR.create(r)}};B(oO,"Second");let oT=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e),s=nF(a,n,t),l=nF(a,n,r);return i.map((e,t,r)=>this._calculateTime(e,s,l,t,r))}_calculateTime(e,t,r,a,n){let i=e,s=t.get(a,n)||nE.create(),l=r.get(a,n)||nE.create();if((i.isString()||i.isBoolean())&&(i=i.convertToNumberObjectValue()),(s.isString()||s.isBoolean())&&(s=s.convertToNumberObjectValue()),(l.isString()||l.isBoolean())&&(l=l.convertToNumberObjectValue()),i.isError())return i;if(s.isError())return s;if(l.isError())return l;let u=Math.floor(+i.getValue()),o=Math.floor(+s.getValue()),c=Math.floor(+l.getValue());if(u<0||o<0||c<0||u>32767||o>32767||c>32767)return rR.create(q.NUM);o+=Math.floor(c/60),c%=60,u+=Math.floor(o/60);let h=(3600*(u%=24)+60*(o%=60)+c)/86400;return nR.create(h,"h:mm A/P")}};B(oT,"Time");let oV=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isString()){let t=uz(`${e.getValue()}`);if(t){let{v:e,z:r}=t;if(r&&u0(r))return e instanceof Date&&(e=uW(e)),nR.create(n_(+e))}}return rR.create(q.VALUE)}};B(oV,"Timevalue");let oI=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){let e=uq(/* @__PURE__ */new Date);return nR.create(e,uG)}};B(oI,"Today");let oM=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2),k(this,"_returnTypeMap",{1:[1,2,3,4,5,6,7],2:[7,1,2,3,4,5,6],3:[6,0,1,2,3,4,5],11:[7,1,2,3,4,5,6],12:[6,7,1,2,3,4,5],13:[5,6,7,1,2,3,4],14:[4,5,6,7,1,2,3],15:[3,4,5,6,7,1,2],16:[2,3,4,5,6,7,1],17:[1,2,3,4,5,6,7]})}calculate(e,t){let r=null!=t?t:nR.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r);return this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(r.isError())return r;let a=u6(e);if("number"!=typeof a)return a;if(r.isString()&&(r=r.convertToNumberObjectValue()).isError())return r;let n=Math.floor(+r.getValue());if(!this._returnTypeMap[n])return rR.create(q.NUM);let i=u9(a),s=this._returnTypeMap[n][i];return nR.create(s)}};B(oM,"Weekday");let ox=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2),k(this,"_returnTypeMap",{1:0,2:1,11:1,12:2,13:3,14:4,15:5,16:6,17:0,21:4})}calculate(e,t){let r=e,a=null!=t?t:nR.create(1);if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);r=r.get(0,0)}if(r.isError())return r;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean())return rR.create(q.VALUE);let n=u6(r);if("number"!=typeof n)return n;if(a.isBoolean())return rR.create(q.VALUE);let i=Math.floor(+a.getValue());return Number.isNaN(i)?rR.create(q.VALUE):i in this._returnTypeMap?this._getResult(n,i):rR.create(q.NUM)}_getResult(e,t){let r=uQ(e),a=e>0?r.getUTCFullYear():1900,n=new Date(Date.UTC(a,0,1)),i=uq(n),s=u9(i),l;if(21===t)e<(l=s<1?i+1:s<=4?i-(s-1):i+(11-s))&&(l=(s=u9(i=uq(n=new Date(Date.UTC(a-1,0,1)))))<1?i+1:s<=4?i-(s-1):i+(11-s));else{let e=this._returnTypeMap[t];l=s<e?i-(s+7-e):i-(s-e)}let u=Math.ceil((e-l+1)/7);return nR.create(u)}};B(ox,"Weeknum");let ov=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=e,n=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(a.isError())return a;if(n.isArray()){let e=n.getRowCount(),t=n.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);n=n.get(0,0)}if(n.isError())return n;if(null!=r&&r.isError())return r;if(a.isBoolean()||n.isBoolean())return rR.create(q.VALUE);let i=u6(a);if("number"!=typeof i)return i;let s=+n.getValue();if(Number.isNaN(s))return rR.create(q.VALUE);if(r)return this._getResultByHolidays(i,s,r);let l=u4(i,s);return"number"!=typeof l?l:nR.create(l)}_getResultByHolidays(e,t,r){let a=[];if(null!=r&&r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();for(let n=0;n<e;n++)for(let e=0;e<t;e++){let t=r.get(n,e);if(t.isBoolean())return rR.create(q.VALUE);let i=u6(t);if("number"!=typeof i)return i;a.push(i)}}else{if(r.isBoolean())return rR.create(q.VALUE);let e=u6(r);if("number"!=typeof e)return e;a.push(e)}let n=u4(e,t,1,a);return"number"!=typeof n?n:nR.create(n)}};B(ov,"Workday");let oU=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",4)}calculate(e,t,r,a){return e.isError()?e:t.isError()?t:null!=r&&r.isError()?r:null!=a&&a.isError()?a:null!=r&&r.isArray()?r.map(r=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,t,r,a)}_handleSingleObject(e,t,r,a){let n=null!=r?r:nR.create(1),i=this._checkArrayError(e);if(i.isError())return i;let s=this._checkArrayError(t);if(s.isError())return s;if(i.isBoolean()||s.isBoolean())return rR.create(q.VALUE);let l=u6(e);if("number"!=typeof l)return l;let u=+t.getValue();if(Number.isNaN(u))return rR.create(q.VALUE);let o=n.getValue();if(n.isBoolean()&&(o=+o),n.isString()&&(!u2(o)||"1111111"===o))return rR.create(q.VALUE);if(!u2(o))return rR.create(q.NUM);if(a)return this._getResultByHolidays(l,u,o,a);let c=u4(l,u,o);return"number"!=typeof c?c:nR.create(c)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return rR.create(q.VALUE);t=t.get(0,0)}return t.isError(),t}_getResultByHolidays(e,t,r,a){let n=[];if(null!=a&&a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();for(let r=0;r<e;r++)for(let e=0;e<t;e++){let t=a.get(r,e);if(t.isBoolean())return rR.create(q.VALUE);let i=u6(t);if("number"!=typeof i)return i;n.push(i)}}else{if(a.isBoolean())return rR.create(q.VALUE);let e=u6(a);if("number"!=typeof e)return e;n.push(e)}let i=u4(e,t,r,n);return"number"!=typeof i?i:nR.create(i)}};B(oU,"WorkdayIntl");let oD=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t;if(e.isError())return e;let r=e.getValue();if(e.isString()){if(!uK(`${r}`))return rR.create(q.VALUE);t=/* @__PURE__ */new Date(`${r}`)}else{let e=+r;if(e<0)return rR.create(q.NUM);if(0===e)return nR.create(1900);t=uQ(e)}let a=t.getUTCFullYear();return nR.create(a)}};B(oD,"Year");let oP=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:nR.create(0),n=l3(e);if(n.isError())return n;let i=l3(t);if(i.isError())return i;if((a=l3(a)).isError())return a;if(n.isBoolean()||i.isBoolean()||a.isBoolean())return rR.create(q.VALUE);let s=u6(n);if("number"!=typeof s)return s;let l=u6(i);if("number"!=typeof l)return l;let u=Math.floor(+a.getValue());if(Number.isNaN(u))return rR.create(q.VALUE);if(u<0||u>4)return rR.create(q.NUM);let{days:o,yearDays:c}=u7(s,l,u);return nR.create(o/c)}};B(oP,"Yearfrac");let oL=[[oh,uH.DATE],[om,uH.DATEDIF],[of,uH.DATEVALUE],[og,uH.DAY],[od,uH.DAYS],[oN,uH.DAYS360],[o_,uH.EDATE],[oC,uH.EOMONTH],[oE,uH.HOUR],[op,uH.ISOWEEKNUM],[oA,uH.MINUTE],[ob,uH.MONTH],[oy,uH.NETWORKDAYS],[oR,uH.NETWORKDAYS_INTL],[oS,uH.NOW],[oO,uH.SECOND],[oT,uH.TIME],[oV,uH.TIMEVALUE],[oI,uH.TODAY],[oM,uH.WEEKDAY],[ox,uH.WEEKNUM],[ov,uH.WORKDAY],[oU,uH.WORKDAY_INTL],[oD,uH.YEAR],[oP,uH.YEARFRAC]];var ow=((T=ow||{}).BESSELI="BESSELI",T.BESSELJ="BESSELJ",T.BESSELK="BESSELK",T.BESSELY="BESSELY",T.BIN2DEC="BIN2DEC",T.BIN2HEX="BIN2HEX",T.BIN2OCT="BIN2OCT",T.BITAND="BITAND",T.BITLSHIFT="BITLSHIFT",T.BITOR="BITOR",T.BITRSHIFT="BITRSHIFT",T.BITXOR="BITXOR",T.COMPLEX="COMPLEX",T.CONVERT="CONVERT",T.DEC2BIN="DEC2BIN",T.DEC2HEX="DEC2HEX",T.DEC2OCT="DEC2OCT",T.DELTA="DELTA",T.ERF="ERF",T.ERF_PRECISE="ERF.PRECISE",T.ERFC="ERFC",T.ERFC_PRECISE="ERFC.PRECISE",T.GESTEP="GESTEP",T.HEX2BIN="HEX2BIN",T.HEX2DEC="HEX2DEC",T.HEX2OCT="HEX2OCT",T.IMABS="IMABS",T.IMAGINARY="IMAGINARY",T.IMARGUMENT="IMARGUMENT",T.IMCONJUGATE="IMCONJUGATE",T.IMCOS="IMCOS",T.IMCOSH="IMCOSH",T.IMCOT="IMCOT",T.IMCSC="IMCSC",T.IMCSCH="IMCSCH",T.IMDIV="IMDIV",T.IMEXP="IMEXP",T.IMLN="IMLN",T.IMLOG10="IMLOG10",T.IMLOG2="IMLOG2",T.IMPOWER="IMPOWER",T.IMPRODUCT="IMPRODUCT",T.IMREAL="IMREAL",T.IMSEC="IMSEC",T.IMSECH="IMSECH",T.IMSIN="IMSIN",T.IMSINH="IMSINH",T.IMSQRT="IMSQRT",T.IMSUB="IMSUB",T.IMSUM="IMSUM",T.IMTAN="IMTAN",T.OCT2BIN="OCT2BIN",T.OCT2DEC="OCT2DEC",T.OCT2HEX="OCT2HEX",T);let oF=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);let o=d9.besseli(l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(oF,"Besseli");let oj=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);let o=d9.besselj(l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(oj,"Besselj");let oB=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);let o=d9.besselk(l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(oB,"Besselk");let ok=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);let o=d9.bessely(l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(ok,"Bessely");let o$=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t;let{isError:r,errorObject:a,variants:n}=l4(e);if(r)return a;let[i]=n,s=`${i.getValue()}`;return lf(s)?(t=10===s.length&&"1"===s.substring(0,1)?Number.parseInt(s.substring(1),2)-512:Number.parseInt(s,2),nR.create(t)):rR.create(q.NUM)}};B(o$,"Bin2dec");let oY=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!lf(u))return rR.create(q.NUM);if(10===u.length&&"1"===u.substring(0,1))r=(0xfffffffe00+Number.parseInt(u.substring(1),2)).toString(16);else if(r=Number.parseInt(u,2).toString(16),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r.toLocaleUpperCase())}};B(oY,"Bin2hex");let oH=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!lf(u))return rR.create(q.NUM);if(10===u.length&&"1"===u.substring(0,1))r=(0x3ffffe00+Number.parseInt(u.substring(1),2)).toString(8);else if(r=Number.parseInt(u,2).toString(8),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(oH,"Bin2oct");let oG=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();return s<0||l<0||Math.floor(s)!==s||Math.floor(l)!==l||s>0xffffffffffff||l>0xffffffffffff?rR.create(q.NUM):nR.create(s&l)});return 1===r&&1===a?s.get(0,0):s}};B(oG,"Bitand");let oq=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();if(s<0||Math.floor(s)!==s||s>0xffffffffffff||Math.abs(l)>53)return rR.create(q.NUM);let u=Number((l=Math.trunc(l))>=0?BigInt(s)<<BigInt(l):BigInt(s)>>BigInt(-l));return u>0xffffffffffff?rR.create(q.NUM):nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(oq,"Bitlshift");let oW=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();if(s<0||l<0||Math.floor(s)!==s||Math.floor(l)!==l||s>0xffffffffffff||l>0xffffffffffff)return rR.create(q.NUM);let u=Number(BigInt(s)|BigInt(l));return nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(oW,"Bitor");let oQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();if(s<0||Math.floor(s)!==s||s>0xffffffffffff||Math.abs(l)>53)return rR.create(q.NUM);let u=Number((l=Math.trunc(l))>=0?BigInt(s)>>BigInt(l):BigInt(s)<<BigInt(-l));return u>0xffffffffffff?rR.create(q.NUM):nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(oQ,"Bitrshift");let oX=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=i.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();return s<0||l<0||Math.floor(s)!==s||Math.floor(l)!==l||s>0xffffffffffff||l>0xffffffffffff?rR.create(q.NUM):nR.create(s^l)});return 1===r&&1===a?s.get(0,0):s}};B(oX,"Bitxor"),a9.prototype.cos=function(){return new a9(Math.cos(this.toNumber()))};let oK=(B(d7=class{constructor(e){if(k(this,"_inumber",""),k(this,"_realNum",0),k(this,"_iNum",0),k(this,"_suffix",""),k(this,"_isError",!1),""===`${e}`.trim()){this._isError=!0;return}this._inumber=e,this._getImReal(),this._getImAginary(),this._getImSuffix()}static getComplex(e,t,r){let a;let n=new a9(e).toSignificantDigits(15).toNumber(),i=new a9(t).toSignificantDigits(15).toNumber(),s=""===r?"i":r;if(0===n&&0===i)a=0;else if(0===n)a=1===i?s:`${i}${s}`;else if(0===i)a=n;else{let e=1===i?s:`${i}${s}`;a=`${n}${i>0?"+":""}${e}`}return a}static createByComplexStr(e,t,r){let a=d7.getComplex(e,t,r);return new d7(a)}_getImReal(){if(0===this._inumber||"0"===this._inumber){this._realNum=0;return}let e=`${this._inumber}`;if(["i","+i","1i","+1i","-i","-1i","j","+j","1j","+1j","-j","-1j"].indexOf(e)>=0){this._realNum=0;return}let t=e.indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let a=e.substring(e.length-1,e.length),n="i"===a||"j"===a;if(t>=0||r>=0){if(!n){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,t):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._realNum=+e.substring(0,r)}else n?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._realNum=0:Number.isNaN(+e)?this._isError=!0:this._realNum=+e}_getImAginary(){if(this._isError)return;if(0===this._inumber||"0"===this._inumber){this._iNum=0;return}let e=`${this._inumber}`;if(["i","j"].indexOf(e)>=0){this._iNum=1;return}let t=(e=e.replace("+i","+1i").replace("-i","-1i").replace("+j","+1j").replace("-j","-1j")).indexOf("+"),r=e.indexOf("-");0===t&&(t=e.indexOf("+",1)),0===r&&(r=e.indexOf("-",1));let a=e.substring(e.length-1,e.length),n="i"===a||"j"===a;if(t>=0||r>=0){if(!n){this._isError=!0;return}t>=0?Number.isNaN(+e.substring(0,t))||Number.isNaN(+e.substring(t+1,e.length-1))?this._isError=!0:this._iNum=+e.substring(t+1,e.length-1):Number.isNaN(+e.substring(0,r))||Number.isNaN(+e.substring(r+1,e.length-1))?this._isError=!0:this._iNum=-+e.substring(r+1,e.length-1)}else n?Number.isNaN(+e.substring(0,e.length-1))?this._isError=!0:this._iNum=+e.substring(0,e.length-1):Number.isNaN(+e)?this._isError=!0:this._iNum=0}_getImSuffix(){let e=`${this._inumber}`,t=e.substring(e.length-1);this._suffix="i"===t||"j"===t?t:""}getRealNum(){return this._realNum}getINum(){return this._iNum}getSuffix(){return this._suffix}isError(){return this._isError}toString(){return d7.getComplex(this._realNum,this._iNum,this._suffix)}isDifferentSuffixes(e){let t=e.getSuffix();return""!==this._suffix&&""!==t&&this._suffix!==t}Abs(){return a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))).toSignificantDigits(16).toNumber()}Argument(){let e=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),t=a9.acos(new a9(this._realNum).div(e)).toSignificantDigits(16).toNumber();return this._iNum<0&&(t=-t),t}Conjugate(){return d7.getComplex(this._realNum,-this._iNum,this._suffix)}Cos(){if(this._iNum){let e=a9.cos(this._realNum).mul(a9.cosh(this._iNum)).toNumber(),t=a9.sin(this._realNum).mul(a9.sinh(this._iNum)).negated().toNumber();return d7.getComplex(e,t,this._suffix)}{let e=a9.cos(this._realNum).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Cosh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let e=a9.cosh(this._realNum).mul(a9.cos(this._iNum)).toNumber(),t=a9.sinh(this._realNum).mul(a9.sin(this._iNum)).toNumber();return d7.getComplex(e,t,this._suffix)}{let e=a9.cosh(this._realNum).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Cot(){if(this._iNum){let e=a9.cosh(2*this._iNum).sub(a9.cos(2*this._realNum)),t=a9.sin(2*this._realNum).div(e).toNumber(),r=a9.sinh(2*this._iNum).div(e).negated().toNumber();return d7.getComplex(t,r,this._suffix)}{let e=new a9(1).div(a9.tan(this._realNum)).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Csc(){if(this._iNum){let e=a9.cosh(2*this._iNum).sub(a9.cos(2*this._realNum)),t=a9.sin(this._realNum).mul(a9.cosh(this._iNum)).mul(2).div(e).toNumber(),r=a9.cos(this._realNum).mul(a9.sinh(this._iNum)).mul(-2).div(e).toNumber();return d7.getComplex(t,r,this._suffix)}{let e=new a9(1).div(a9.sin(this._realNum)).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Csch(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return d7.getComplex(0,0,this._suffix);if(this._iNum){let e=a9.cosh(2*this._realNum).sub(a9.cos(2*this._iNum)),t=a9.sinh(this._realNum).mul(a9.cos(this._iNum)).mul(2).div(e).toNumber(),r=a9.cosh(this._realNum).mul(a9.sin(this._iNum)).mul(-2).div(e).toNumber();return d7.getComplex(t,r,this._suffix)}{let e=new a9(1).div(a9.sinh(this._realNum)).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Div(e){let t=new a9(this._realNum),r=new a9(this._iNum),a=new a9(e.getRealNum()),n=new a9(e.getINum()),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),l=r.mul(a).sub(t.mul(n)).div(i).toNumber(),u=""===this._suffix?e.getSuffix():this._suffix;return d7.getComplex(s,l,u)}Exp(){if(!Number.isFinite(Math.exp(this._realNum)))return this._isError=!0,"";let e=a9.exp(this._realNum).mul(a9.cos(this._iNum)).toNumber(),t=a9.exp(this._realNum).mul(a9.sin(this._iNum)).toNumber();return d7.getComplex(e,t,this._suffix)}Ln(){let e=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),t=a9.ln(e).toNumber(),r=a9.acos(new a9(this._realNum).div(e)).toNumber();return d7.getComplex(t,r,this._suffix)}Log10(){let e=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),t=a9.ln(e),r=a9.acos(new a9(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=a9.ln(10),n=new a9(0),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),l=r.mul(a).sub(t.mul(n)).div(i).toNumber();return d7.getComplex(s,l,this._suffix)}Log2(){let e=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),t=a9.ln(e),r=a9.acos(new a9(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=a9.ln(2),n=new a9(0),i=a.mul(a).add(n.mul(n)),s=t.mul(a).add(r.mul(n)).div(i).toNumber(),l=r.mul(a).sub(t.mul(n)).div(i).toNumber();return d7.getComplex(s,l,this._suffix)}Power(e){if(0===this._realNum&&0===this._iNum)return e>0?d7.getComplex(this._realNum,this._iNum,this._suffix):(this._isError=!0,"");let t=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),r=a9.acos(new a9(this._realNum).div(t));this._iNum<0&&(r=r.negated()),t=a9.pow(t,e),r=r.mul(e);let a=a9.cos(r).mul(t).toNumber(),n=a9.sin(r).mul(t).toNumber();return Number.isFinite(a)&&Number.isFinite(n)?d7.getComplex(a,n,this._suffix):(this._isError=!0,"")}Product(e){let t=new a9(this._realNum),r=new a9(this._iNum),a=new a9(e.getRealNum()),n=new a9(e.getINum()),i=t.mul(a).sub(r.mul(n)).toNumber(),s=t.mul(n).add(r.mul(a)).toNumber(),l=""===this._suffix?e.getSuffix():this._suffix;return d7.getComplex(i,s,l)}Sec(){if(this._iNum){let e=a9.cosh(2*this._iNum).add(a9.cos(2*this._realNum)),t=a9.cos(this._realNum).mul(a9.cosh(this._iNum)).mul(2).div(e).toNumber(),r=a9.sin(this._realNum).mul(a9.sinh(this._iNum)).mul(2).div(e).toNumber();return d7.getComplex(t,r,this._suffix)}{let e=new a9(1).div(a9.cos(this._realNum)).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Sech(){if(!Number.isFinite(Math.sinh(2*this._realNum))||!Number.isFinite(Math.cosh(2*this._realNum)))return d7.getComplex(0,0,this._suffix);if(this._iNum){let e=a9.cosh(2*this._realNum).add(a9.cos(2*this._iNum)),t=a9.cosh(this._realNum).mul(a9.cos(this._iNum)).mul(2).div(e).toNumber(),r=a9.sinh(this._realNum).mul(a9.sin(this._iNum)).mul(-2).div(e).toNumber();return d7.getComplex(t,r,this._suffix)}{let e=new a9(1).div(a9.cosh(this._realNum)).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Sin(){if(this._iNum){let e=a9.sin(this._realNum).mul(a9.cosh(this._iNum)).toNumber(),t=a9.cos(this._realNum).mul(a9.sinh(this._iNum)).toNumber();return d7.getComplex(e,t,this._suffix)}{let e=a9.sin(this._realNum).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Sinh(){if(!Number.isFinite(Math.sinh(this._realNum))||!Number.isFinite(Math.cosh(this._realNum)))return this._isError=!0,"";if(this._iNum){let e=a9.sinh(this._realNum).mul(a9.cos(this._iNum)).toNumber(),t=a9.cosh(this._realNum).mul(a9.sin(this._iNum)).toNumber();return d7.getComplex(e,t,this._suffix)}{let e=a9.sinh(this._realNum).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}Sqrt(){let e=a9.sqrt(a9.pow(this._realNum,2).add(a9.pow(this._iNum,2))),t=a9.sqrt(e),r=a9.acos(new a9(this._realNum).div(e));this._iNum<0&&(r=r.negated());let a=t.mul(a9.cos(r.div(2).toNumber())).toNumber(),n=t.mul(a9.sin(r.div(2))).toNumber();return d7.getComplex(a,n,this._suffix)}Sub(e){let t=new a9(this._realNum),r=new a9(this._iNum),a=new a9(e.getRealNum()),n=new a9(e.getINum()),i=t.sub(a).toNumber(),s=r.sub(n).toNumber(),l=""===this._suffix?e.getSuffix():this._suffix;return d7.getComplex(i,s,l)}Sum(e){let t=new a9(this._realNum),r=new a9(this._iNum),a=new a9(e.getRealNum()),n=new a9(e.getINum()),i=t.add(a).toNumber(),s=r.add(n).toNumber(),l=""===this._suffix?e.getSuffix():this._suffix;return d7.getComplex(i,s,l)}Tan(){if(this._iNum){let e=a9.cos(2*this._realNum).add(a9.cosh(2*this._iNum)),t=a9.sin(2*this._realNum).div(e).toNumber(),r=a9.sinh(2*this._iNum).div(e).toNumber();return d7.getComplex(t,r,this._suffix)}{let e=a9.tan(this._realNum).toNumber();return d7.getComplex(e,this._iNum,this._suffix)}}},"Complex"),d7),oZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=l4(e,t,null!=r?r:nT.create("i"));if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=+l.getValue(),h=`${u.getValue()}`;if(Number.isNaN(o)||Number.isNaN(c)||"i"!==h&&"j"!==h)return rR.create(q.VALUE);let m=oK.getComplex(o,c,h);return"number"==typeof m?nR.create(m):nT.create(m)}};B(oZ,"Complex");let oz=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3),k(this,"_units",[["a.u. of action","?",null,"action",!1,!1,105457168181818e-48],["a.u. of charge","e",null,"electric_charge",!1,!1,160217653141414e-33],["a.u. of energy","Eh",null,"energy",!1,!1,435974417757576e-32],["a.u. of length","a?",null,"length",!1,!1,529177210818182e-25],["a.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["a.u. of time","?/Eh",null,"time",!1,!1,241888432650516e-31],["admiralty knot","admkn",null,"speed",!1,!0,.514773333],["ampere","A",null,"electric_current",!0,!1,1],["ampere per meter","A/m",null,"magnetic_field_intensity",!0,!1,1],["ngstrm","",["ang"],"length",!1,!0,1e-10],["are","ar",null,"area",!1,!0,100],["astronomical unit","ua",null,"length",!1,!1,149597870691667e-25],["bar","bar",null,"pressure",!1,!1,1e5],["barn","b",null,"area",!1,!1,1e-28],["becquerel","Bq",null,"radioactivity",!0,!1,1],["bit","bit",["b"],"information",!1,!0,1],["btu","BTU",["btu"],"energy",!1,!0,1055.05585262],["byte","byte",null,"information",!1,!0,8],["candela","cd",null,"luminous_intensity",!0,!1,1],["candela per square metre","cd/m?",null,"luminance",!0,!1,1],["centigrade","C",["cel"],"temperature",!0,!1,1],["cubic ngstrm","ang3",["ang^3"],"volume",!1,!0,1e-30],["cubic foot","ft3",["ft^3"],"volume",!1,!0,.028316846592],["cubic inch","in3",["in^3"],"volume",!1,!0,16387064e-12],["cubic light-year","ly3",["ly^3"],"volume",!1,!0,846786664623715e-61],["cubic metre","m3",["m^3"],"volume",!0,!0,1],["cubic mile","mi3",["mi^3"],"volume",!1,!0,4168181825.44058],["cubic nautical mile","Nmi3",["Nmi^3"],"volume",!1,!0,0x17a9e9bc0],["cubic Pica","Pica3",["Picapt3","Pica^3","Picapt^3"],"volume",!1,!0,758660370370369e-22],["cubic yard","yd3",["yd^3"],"volume",!1,!0,.764554857984],["cup","cup",null,"volume",!1,!0,2365882365e-13],["dalton","Da",["u"],"mass",!1,!1,166053886282828e-41],["day","d",["day"],"time",!1,!0,86400],["degree","",null,"angle",!1,!1,.0174532925199433],["dyne","dyn",["dy"],"force",!1,!0,1e-5],["electronvolt","eV",["ev"],"energy",!1,!0,1.60217656514141],["ell","ell",null,"length",!1,!0,1.143],["erg","erg",["e"],"energy",!1,!0,1e-7],["fahrenheit","F",["fah"],"temperature",!0,!1,1],["fluid ounce","oz",null,"volume",!1,!0,295735295625e-16],["foot","ft",null,"length",!1,!0,.3048],["foot-pound","flb",null,"energy",!1,!0,1.3558179483314],["gal","Gal",null,"acceleration",!1,!1,.01],["gallon","gal",null,"volume",!1,!0,.003785411784],["gauss","G",["ga"],"magnetic_flux_density",!1,!0,1],["grain","grain",null,"mass",!1,!0,647989e-10],["gram","g",null,"mass",!1,!0,.001],["gray","Gy",null,"absorbed_dose",!0,!1,1],["gross registered ton","GRT",["regton"],"volume",!1,!0,2.8316846592],["hectare","ha",null,"area",!1,!0,1e4],["henry","H",null,"inductance",!0,!1,1],["hertz","Hz",null,"frequency",!0,!1,1],["horsepower","HP",["h"],"power",!1,!0,745.69987158227],["horsepower-hour","HPh",["hh","hph"],"energy",!1,!0,2684519.538],["hour","h",["hr"],"time",!1,!0,3600],["imperial gallon (U.K.)","uk_gal",null,"volume",!1,!0,.00454609],["imperial hundredweight","lcwt",["uk_cwt","hweight"],"mass",!1,!0,50.802345],["imperial quart (U.K)","uk_qt",null,"volume",!1,!0,.0011365225],["imperial ton","brton",["uk_ton","LTON"],"mass",!1,!0,1016.046909],["inch","in",null,"length",!1,!0,.0254],["international acre","uk_acre",null,"area",!1,!0,4046.8564224],["IT calorie","cal",null,"energy",!1,!0,4.1868],["joule","J",null,"energy",!0,!0,1],["katal","kat",null,"catalytic_activity",!0,!1,1],["kelvin","K",["kel"],"temperature",!0,!0,1],["kilogram","kg",null,"mass",!0,!0,1],["knot","kn",null,"speed",!1,!0,.514444444444444],["light-year","ly",null,"length",!1,!0,0x219c7bf72246c0],["litre","L",["l","lt"],"volume",!1,!0,.001],["lumen","lm",null,"luminous_flux",!0,!1,1],["lux","lx",null,"illuminance",!0,!1,1],["maxwell","Mx",null,"magnetic_flux",!1,!1,1e-18],["measurement ton","MTON",null,"volume",!1,!0,1.13267386368],["meter per hour","m/h",["m/hr"],"speed",!1,!0,27777777777778e-17],["meter per second","m/s",["m/sec"],"speed",!0,!0,1],["meter per second squared","m?s??",null,"acceleration",!0,!1,1],["parsec","pc",["parsec"],"length",!1,!0,0x6da012f958ee1c],["meter squared per second","m?/s",null,"kinematic_viscosity",!0,!1,1],["metre","m",null,"length",!0,!0,1],["miles per hour","mph",null,"speed",!1,!0,.44704],["millimetre of mercury","mmHg",null,"pressure",!1,!1,133.322],["minute","?",null,"angle",!1,!1,290888208665722e-18],["minute","min",["mn"],"time",!1,!0,60],["modern teaspoon","tspm",null,"volume",!1,!0,5e-6],["mole","mol",null,"amount_of_substance",!0,!1,1],["morgen","Morgen",null,"area",!1,!0,2500],["n.u. of action","?",null,"action",!1,!1,105457168181818e-48],["n.u. of mass","m?",null,"mass",!1,!1,910938261616162e-45],["n.u. of speed","c?",null,"speed",!1,!1,0x11de784a],["n.u. of time","?/(me?c??)",null,"time",!1,!1,128808866778687e-35],["nautical mile","M",["Nmi"],"length",!1,!0,1852],["newton","N",null,"force",!0,!0,1],["rsted","Oe ",null,"magnetic_field_intensity",!1,!1,79.5774715459477],["ohm","",null,"electric_resistance",!0,!1,1],["ounce mass","ozm",null,"mass",!1,!0,.028349523125],["pascal","Pa",null,"pressure",!0,!1,1],["pascal second","Pa?s",null,"dynamic_viscosity",!0,!1,1],["pferdestrke","PS",null,"power",!1,!0,735.49875],["phot","ph",null,"illuminance",!1,!1,1e-4],["pica (1/6 inch)","pica",null,"length",!1,!0,35277777777778e-17],["pica (1/72 inch)","Pica",["Picapt"],"length",!1,!0,.00423333333333333],["poise","P",null,"dynamic_viscosity",!1,!1,.1],["pond","pond",null,"force",!1,!0,.00980665],["pound force","lbf",null,"force",!1,!0,4.4482216152605],["pound mass","lbm",null,"mass",!1,!0,.45359237],["quart","qt",null,"volume",!1,!0,946352946e-12],["radian","rad",null,"angle",!0,!1,1],["rankine","Rank",null,"temperature",!1,!0,1],["reaumur","Reau",null,"temperature",!1,!0,1],["second","?",null,"angle",!1,!1,484813681109536e-20],["second","s",["sec"],"time",!0,!0,1],["short hundredweight","cwt",["shweight"],"mass",!1,!0,45.359237],["siemens","S",null,"electrical_conductance",!0,!1,1],["sievert","Sv",null,"equivalent_dose",!0,!1,1],["slug","sg",null,"mass",!1,!0,14.59390294],["square ngstrm","ang2",["ang^2"],"area",!1,!0,1e-20],["square foot","ft2",["ft^2"],"area",!1,!0,.09290304],["square inch","in2",["in^2"],"area",!1,!0,64516e-8],["square light-year","ly2",["ly^2"],"area",!1,!0,895054210748189e17],["square meter","m?",null,"area",!0,!0,1],["square mile","mi2",["mi^2"],"area",!1,!0,2589988.110336],["square nautical mile","Nmi2",["Nmi^2"],"area",!1,!0,3429904],["square Pica","Pica2",["Picapt2","Pica^2","Picapt^2"],"area",!1,!0,1792111111111e-17],["square yard","yd2",["yd^2"],"area",!1,!0,.83612736],["statute mile","mi",null,"length",!1,!0,1609.344],["steradian","sr",null,"solid_angle",!0,!1,1],["stilb","sb",null,"luminance",!1,!1,1e-4],["stokes","St",null,"kinematic_viscosity",!1,!1,1e-4],["stone","stone",null,"mass",!1,!0,6.35029318],["tablespoon","tbs",null,"volume",!1,!0,147868e-10],["teaspoon","tsp",null,"volume",!1,!0,492892e-11],["tesla","T",null,"magnetic_flux_density",!0,!0,1],["thermodynamic calorie","c",null,"energy",!1,!0,4.184],["ton","ton",null,"mass",!1,!0,907.18474],["tonne","t",null,"mass",!1,!1,1e3],["U.K. pint","uk_pt",null,"volume",!1,!0,56826125e-11],["U.S. bushel","bushel",null,"volume",!1,!0,.03523907],["U.S. oil barrel","barrel",null,"volume",!1,!0,.158987295],["U.S. pint","pt",["us_pt"],"volume",!1,!0,473176473e-12],["U.S. survey mile","survey_mi",null,"length",!1,!0,1609.347219],["U.S. survey/statute acre","us_acre",null,"area",!1,!0,4046.87261],["volt","V",null,"voltage",!0,!1,1],["watt","W",null,"power",!0,!0,1],["watt-hour","Wh",["wh"],"energy",!1,!0,3600],["weber","Wb",null,"magnetic_flux",!0,!1,1],["yard","yd",null,"length",!1,!0,.9144],["year","yr",null,"time",!1,!0,0x1e187e0]]),k(this,"_binaryPrefixes",{Yi:["yobi",80,12089258196146292e8,"Yi","yotta"],Zi:["zebi",70,11805916207174113e5,"Zi","zetta"],Ei:["exbi",60,0x1000000000000000,"Ei","exa"],Pi:["pebi",50,0x4000000000000,"Pi","peta"],Ti:["tebi",40,0x10000000000,"Ti","tera"],Gi:["gibi",30,0x40000000,"Gi","giga"],Mi:["mebi",20,1048576,"Mi","mega"],ki:["kibi",10,1024,"ki","kilo"]}),k(this,"_unitPrefixes",{Y:["yotta",1e24,"Y"],Z:["zetta",1e21,"Z"],E:["exa",1e18,"E"],P:["peta",1e15,"P"],T:["tera",1e12,"T"],G:["giga",1e9,"G"],M:["mega",1e6,"M"],k:["kilo",1e3,"k"],h:["hecto",100,"h"],e:["dekao",10,"e"],d:["deci",.1,"d"],c:["centi",.01,"c"],m:["milli",.001,"m"],u:["micro",1e-6,"u"],n:["nano",1e-9,"n"],p:["pico",1e-12,"p"],f:["femto",1e-15,"f"],a:["atto",1e-18,"a"],z:["zepto",1e-21,"z"],y:["yocto",1e-24,"y"]})}calculate(e,t,r){let a;let{isError:n,errorObject:i,variants:s}=l4(e,t,r);if(n)return i;let[l,u,o]=s,c=+l.getValue(),h=`${u.getValue()}`,m=`${o.getValue()}`;if(Number.isNaN(c))return rR.create(q.VALUE);let f,g=1,d,N=1,{_from:_,_to:C}=this._lookupFromAndToUnits(h,m);if(f=_,d=C,null===f){let{_from:e,_fromMultiplier:t}=this._lookupFromPrefix(h);f=e,g=t}if(null===d){let{_to:e,_toMultiplier:t}=this._lookupToPrefix(m);d=e,N=t}return null===f||null===d||f[3]!==d[3]?rR.create(q.NA):(a="temperature"===f[3]?+(a=this._getTemperatureConversion(c,f[1],d[1])).toFixed(2):c*f[6]*g/(d[6]*N),nR.create(a))}_lookupFromAndToUnits(e,t){let r=null,a=null,n;for(let i=0;i<this._units.length;i++)n=null===this._units[i][2]?[]:this._units[i][2],(this._units[i][1]===e||n.indexOf(e)>=0)&&(r=this._units[i]),(this._units[i][1]===t||n.indexOf(t)>=0)&&(a=this._units[i]);return{_from:r,_to:a}}_lookupFromPrefix(e){let t=null,r=1,a=e,n,i=this._binaryPrefixes[e.substring(0,2)],s=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(s=["dekao",10,"da"]),i?(r=i[2],a=e.substring(2)):s&&(r=s[1],a=e.substring(s[2].length));for(let e=0;e<this._units.length;e++)n=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===a||n.indexOf(a)>=0)&&(t=this._units[e]);return{_from:t,_fromMultiplier:r}}_lookupToPrefix(e){let t=null,r=1,a=e,n,i=this._binaryPrefixes[e.substring(0,2)],s=this._unitPrefixes[e.substring(0,1)];"da"===e.substring(0,2)&&(s=["dekao",10,"da"]),i?(r=i[2],a=e.substring(2)):s&&(r=s[1],a=e.substring(s[2].length));for(let e=0;e<this._units.length;e++)n=null===this._units[e][2]?[]:this._units[e][2],(this._units[e][1]===a||n.indexOf(a)>=0)&&(t=this._units[e]);return{_to:t,_toMultiplier:r}}_getTemperatureConversion(e,t,r){switch(t){case"C":return this._centigradeConversion(e,r);case"F":return this._fahrenheitConversion(e,r);case"K":return this._kelvinConversion(e,r);case"Rank":return this._rankineConversion(e,r);case"Reau":return this._reaumurConversion(e,r);default:return e}}_centigradeConversion(e,t){switch(t){case"F":return 9*e/5+32;case"K":return e+273.15;case"Rank":return(e+273.15)*9/5;case"Reau":return 4*e/5;default:return e}}_fahrenheitConversion(e,t){switch(t){case"C":return(e-32)*5/9;case"K":return(e-32)*5/9+273.15;case"Rank":return e+459.67;case"Reau":return(e-32)*4/9;default:return e}}_kelvinConversion(e,t){switch(t){case"C":return e-273.15;case"F":return(e-273.15)*9/5+32;case"Rank":return 9*e/5;case"Reau":return(e-273.15)*4/5;default:return e}}_rankineConversion(e,t){switch(t){case"C":return(e-491.67)*5/9;case"F":return e-459.67;case"K":return 5*e/9;case"Reau":return(e-491.67)*4/9;default:return e}}_reaumurConversion(e,t){switch(t){case"C":return 5*e/4;case"F":return 9*e/4+32;case"K":return 5*e/4+273.15;case"Rank":return 9*e/4+491.67;default:return e}}};B(oz,"Convert");let oJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=Math.trunc(+l.getValue());if(Number.isNaN(u))return rR.create(q.VALUE);if(!/^-?[0-9]{1,3}$/.test(`${u}`)||u<-512||u>511)return rR.create(q.NUM);if(u<0){let e=(512+u).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=Number.parseInt(`${u}`,10).toString(2),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(oJ,"Dec2bin");let o0=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=Math.trunc(+l.getValue());if(Number.isNaN(u))return rR.create(q.VALUE);if(!/^-?[0-9]{1,12}$/.test(`${u}`)||u<-0x8000000000||u>0x7fffffffff)return rR.create(q.NUM);if(u<0)r=(0x10000000000+u).toString(16);else if(r=Number.parseInt(`${u}`,10).toString(16),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r.toLocaleUpperCase())}};B(o0,"Dec2hex");let o1=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=Math.trunc(+l.getValue());if(Number.isNaN(u))return rR.create(q.VALUE);if(!/^-?[0-9]{1,9}$/.test(`${u}`)||u<-0x20000000||u>0x1fffffff)return rR.create(q.NUM);if(u<0)r=(0x40000000+u).toString(8);else if(r=Number.parseInt(`${u}`,10).toString(8),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(o1,"Dec2oct");let o2=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,null!=t?t:nR.create(0));if(r)return a;let[i,s]=n,l=+i.getValue(),u=+s.getValue();return Number.isNaN(l)||Number.isNaN(u)?rR.create(q.VALUE):nR.create(l===u?1:0)}};B(o2,"Delta");let o3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(t){let{isError:a,errorObject:n,variants:i}=l4(e,t);if(a)return n;let[s,l]=i,u=+s.getValue(),o=+l.getValue();if(Number.isNaN(u)||Number.isNaN(o))return rR.create(q.VALUE);r=lN(o)-lN(u)}else{let{isError:t,errorObject:a,variants:n}=l4(e);if(t)return a;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return rR.create(q.VALUE);r=lN(s)}return nR.create(r)}};B(o3,"Erf");let o5=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return rR.create(q.VALUE);let s=lN(i);return nR.create(s)}};B(o5,"ErfPrecise");let o4=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return rR.create(q.VALUE);let s=l_(i);return nR.create(s)}};B(o4,"Erfc");let o6=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=+n.getValue();if(Number.isNaN(i))return rR.create(q.VALUE);let s=l_(i);return nR.create(s)}};B(o6,"ErfcPrecise");let o9=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){if(e.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,null!=t?t:nR.create(0));if(r)return a;let[i,s]=n,l=+i.getValue(),u=+s.getValue();return Number.isNaN(l)||Number.isNaN(u)?rR.create(q.VALUE):nR.create(l>=u?1:0)}};B(o9,"Gestep");let o7=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!ld(u))return rR.create(q.NUM);let o=10===u.length&&"F"===u.substring(0,1).toLocaleUpperCase(),c=o?Number.parseInt(u,16)-0x10000000000:Number.parseInt(u,16);if(c<-512||c>511)return rR.create(q.NUM);if(o){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(o7,"Hex2bin");let o8=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=`${n.getValue()}`;if(!ld(i))return rR.create(q.NUM);let s=Number.parseInt(i,16);return s>=0x8000000000&&(s-=0x10000000000),nR.create(s)}};B(o8,"Hex2dec");let ce=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!ld(u))return rR.create(q.NUM);let o=Number.parseInt(u,16);if(o>0x1fffffff&&o<0xffe0000000)return rR.create(q.NUM);if(o>=0xffe0000000)r=(o-0xffc0000000).toString(8);else if(r=o.toString(8),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(ce,"Hex2oct");let ct=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Abs();return nR.create(s)}};B(ct,"Imabs");let cr=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.getINum();return nR.create(s)}};B(cr,"Imaginary");let ca=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);if(0===i.getRealNum()&&0===i.getINum())return rR.create(q.DIV_BY_ZERO);let s=i.Argument();return nR.create(s)}};B(ca,"Imargument");let cn=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Conjugate();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cn,"Imconjugate");let ci=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Cos();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(ci,"Imcos");let cs=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Cosh();return i.isError()?rR.create(q.NUM):"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cs,"Imcosh");let cl=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Cot();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cl,"Imcot");let cu=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Csc();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cu,"Imcsc");let co=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Csch();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(co,"Imcsch");let cc=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=`${i.getValue()}`,u=`${s.getValue()}`,o=new oK(l),c=new oK(u);if(o.isError()||c.isError()||o.isDifferentSuffixes(c)||0===c.getRealNum()&&0===c.getINum())return rR.create(q.NUM);let h=o.Div(c);return"number"==typeof h||(0,P.isRealNum)(h)?nR.create(+h):nT.create(h)}};B(cc,"Imdiv");let ch=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Exp();return i.isError()?rR.create(q.NUM):"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(ch,"Imexp");let cm=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Ln();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cm,"Imln");let cf=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Log10();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cf,"Imlog10");let cg=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError()||0===i.getRealNum()&&0===i.getINum())return rR.create(q.NUM);let s=i.Log2();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cg,"Imlog2");let cd=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=new oK(`${i.getValue()}`);if(l.isError())return rR.create(q.NUM);let u=+s.getValue();if(Number.isNaN(u))return rR.create(q.VALUE);let o=l.Power(u);return l.isError()?rR.create(q.NUM):"number"==typeof o||(0,P.isRealNum)(o)?nR.create(+o):nT.create(o)}};B(cd,"Impower");let cN=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof rR)return t;let a=e[r];if(a.isArray()){let e=!1,r;if(a.iterator(a=>{if((t=this._handleSingleObject(a,t))instanceof rR)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(a,t)}return t instanceof rR?t:"number"==typeof t||(0,P.isRealNum)(t)?nR.create(+t):nT.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return rR.create(q.VALUE);let a=`${e.getValue()}`;if("number"==typeof t||t){let e=new oK(t),n=new oK(a);if(e.isError()||n.isError())return rR.create(q.NUM);if(e.isDifferentSuffixes(n))return rR.create(q.VALUE);r=e.Product(n)}else{let e=new oK(a);if(e.isError())return rR.create(q.NUM);r=e.toString()}return r}};B(cN,"Improduct");let c_=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.getRealNum();return nR.create(s)}};B(c_,"Imreal");let cC=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Sec();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cC,"Imsec");let cE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Sech();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cE,"Imsech");let cp=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Sin();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cp,"Imsin");let cA=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Sinh();return i.isError()?rR.create(q.NUM):"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cA,"Imsinh");let cb=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);if(0===i.getRealNum()&&0===i.getINum())return nR.create(0);let s=i.Sqrt();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cb,"Imsqrt");let cy=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=`${i.getValue()}`,u=`${s.getValue()}`,o=new oK(l),c=new oK(u);if(o.isError()||c.isError()||o.isDifferentSuffixes(c))return rR.create(q.NUM);let h=o.Sub(c);return"number"==typeof h||(0,P.isRealNum)(h)?nR.create(+h):nT.create(h)}};B(cy,"Imsub");let cR=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t="";for(let r=0;r<e.length;r++){if(t instanceof rR)return t;let a=e[r];if(a.isArray()){let e=!1,r;if(a.iterator(a=>{if((t=this._handleSingleObject(a,t))instanceof rR)return e=!0,r=t,!1}),e)return r}else t=this._handleSingleObject(a,t)}return t instanceof rR?t:"number"==typeof t||(0,P.isRealNum)(t)?nR.create(+t):nT.create(t)}_handleSingleObject(e,t){let r=t;if(e.isError())return e;if(e.isBoolean())return rR.create(q.VALUE);let a=`${e.getValue()}`;if("number"==typeof t||t){let e=new oK(t),n=new oK(a);if(e.isError()||n.isError())return rR.create(q.NUM);if(e.isDifferentSuffixes(n))return rR.create(q.VALUE);r=e.Sum(n)}else{let e=new oK(a);if(e.isError())return rR.create(q.NUM);r=e.toString()}return r}};B(cR,"Imsum");let cS=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=new oK(`${n.getValue()}`);if(i.isError())return rR.create(q.NUM);let s=i.Tan();return"number"==typeof s||(0,P.isRealNum)(s)?nR.create(+s):nT.create(s)}};B(cS,"Imtan");let cO=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!lg(u))return rR.create(q.NUM);let o=10===u.length&&"7"===u.substring(0,1),c=o?Number.parseInt(u,8)-0x40000000:Number.parseInt(u,8);if(c<-512||c>511)return rR.create(q.NUM);if(o){let e=(512+c).toString(2);r=`1${"0".repeat(9-e.length)}${e}`}else if(r=c.toString(2),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r)}};B(cO,"Oct2bin");let cT=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let{isError:t,errorObject:r,variants:a}=l4(e);if(t)return r;let[n]=a,i=`${n.getValue()}`;if(!lg(i))return rR.create(q.NUM);let s=Number.parseInt(i,8);return s>=0x20000000&&(s-=0x40000000),nR.create(s)}};B(cT,"Oct2dec");let cV=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r;if(e.isNull())return rR.create(q.NA);let a=0;if(t){let{isError:e,errorObject:r,variants:n}=l4(t);if(e)return r;let[i]=n;if(Number.isNaN(a=Math.floor(+i.getValue())))return rR.create(q.VALUE);if(a<0||a>10)return rR.create(q.NUM)}let{isError:n,errorObject:i,variants:s}=l4(e);if(n)return i;let[l]=s,u=`${l.getValue()}`;if(!lg(u))return rR.create(q.NUM);let o=Number.parseInt(u,8);if(o>=0x20000000)r=`ff${(o+0xc0000000).toString(16)}`;else if(r=o.toString(16),t){if(a<r.length)return rR.create(q.NUM);r="0".repeat(a-r.length)+r}return nT.create(r.toLocaleUpperCase())}};B(cV,"Oct2hex");let cI=[[oF,ow.BESSELI],[oj,ow.BESSELJ],[oB,ow.BESSELK],[ok,ow.BESSELY],[o$,ow.BIN2DEC],[oY,ow.BIN2HEX],[oH,ow.BIN2OCT],[oG,ow.BITAND],[oq,ow.BITLSHIFT],[oW,ow.BITOR],[oQ,ow.BITRSHIFT],[oX,ow.BITXOR],[oZ,ow.COMPLEX],[oz,ow.CONVERT],[oJ,ow.DEC2BIN],[o0,ow.DEC2HEX],[o1,ow.DEC2OCT],[o2,ow.DELTA],[o3,ow.ERF],[o5,ow.ERF_PRECISE],[o4,ow.ERFC],[o6,ow.ERFC_PRECISE],[o9,ow.GESTEP],[o7,ow.HEX2BIN],[o8,ow.HEX2DEC],[ce,ow.HEX2OCT],[ct,ow.IMABS],[cr,ow.IMAGINARY],[ca,ow.IMARGUMENT],[cn,ow.IMCONJUGATE],[ci,ow.IMCOS],[cs,ow.IMCOSH],[cl,ow.IMCOT],[cu,ow.IMCSC],[co,ow.IMCSCH],[cc,ow.IMDIV],[ch,ow.IMEXP],[cm,ow.IMLN],[cf,ow.IMLOG10],[cg,ow.IMLOG2],[cd,ow.IMPOWER],[cN,ow.IMPRODUCT],[c_,ow.IMREAL],[cC,ow.IMSEC],[cE,ow.IMSECH],[cp,ow.IMSIN],[cA,ow.IMSINH],[cb,ow.IMSQRT],[cy,ow.IMSUB],[cR,ow.IMSUM],[cS,ow.IMTAN],[cO,ow.OCT2BIN],[cT,ow.OCT2DEC],[cV,ow.OCT2HEX]];var cM=((V=cM||{}).ACCRINT="ACCRINT",V.ACCRINTM="ACCRINTM",V.AMORDEGRC="AMORDEGRC",V.AMORLINC="AMORLINC",V.COUPDAYBS="COUPDAYBS",V.COUPDAYS="COUPDAYS",V.COUPDAYSNC="COUPDAYSNC",V.COUPNCD="COUPNCD",V.COUPNUM="COUPNUM",V.COUPPCD="COUPPCD",V.CUMIPMT="CUMIPMT",V.CUMPRINC="CUMPRINC",V.DB="DB",V.DDB="DDB",V.DISC="DISC",V.DOLLARDE="DOLLARDE",V.DOLLARFR="DOLLARFR",V.DURATION="DURATION",V.EFFECT="EFFECT",V.FV="FV",V.FVSCHEDULE="FVSCHEDULE",V.INTRATE="INTRATE",V.IPMT="IPMT",V.IRR="IRR",V.ISPMT="ISPMT",V.MDURATION="MDURATION",V.MIRR="MIRR",V.NOMINAL="NOMINAL",V.NPER="NPER",V.NPV="NPV",V.ODDFPRICE="ODDFPRICE",V.ODDFYIELD="ODDFYIELD",V.ODDLPRICE="ODDLPRICE",V.ODDLYIELD="ODDLYIELD",V.PDURATION="PDURATION",V.PMT="PMT",V.PPMT="PPMT",V.PRICE="PRICE",V.PRICEDISC="PRICEDISC",V.PRICEMAT="PRICEMAT",V.PV="PV",V.RATE="RATE",V.RECEIVED="RECEIVED",V.RRI="RRI",V.SLN="SLN",V.SYD="SYD",V.TBILLEQ="TBILLEQ",V.TBILLPRICE="TBILLPRICE",V.TBILLYIELD="TBILLYIELD",V.VDB="VDB",V.XIRR="XIRR",V.XNPV="XNPV",V.YIELD="YIELD",V.YIELDDISC="YIELDDISC",V.YIELDMAT="YIELDMAT",V);function cx(e,t,r,a){let{days:n}=u7(cP(e,t,r),e,a);return n}function cv(e,t,r,a){let n;if(1===a){let a=cP(e,t,r),i=uQ(a),s=uq(i=oc(i,12/r));n=a<0&&1===r?365:s-a}else n=3===a?365/r:360/r;return n}function cU(e,t,r){let a=uQ(e),n=uQ(t);for(n.setUTCFullYear(a.getUTCFullYear()),n<a&&n.setUTCFullYear(n.getUTCFullYear()+1);n>a;)n=oc(n,-12/r);return uq(n=oc(n,12/r))}function cD(e,t,r){let a=0,n=uQ(e),i=uQ(t);for(;i>n;)i=oc(i,-12/r),a++;return a}function cP(e,t,r){let a=uQ(e),n=uQ(t);for(n.setUTCFullYear(a.getUTCFullYear()),n<a&&n.setUTCFullYear(n.getUTCFullYear()+1);n>a;)n=oc(n,-12/r);return uq(n)}function cL(e,t,r,a,n,i){let s=cx(e,t,n,i),l=cv(e,t,n,i),u=cD(e,t,n),o=(l-s)/l-1,c=a/n+1,h=100*r/n,m=0,f=0;for(let e=1;e<=u;e++){let t=e+o,r=h/c**t;m+=t*r,f+=r}let g=u+o,d=100/c**g;return(m+=g*d)/(f+=d)/n}function cw(e,t,r,a,n){let i;if(0===e)i=(r+a)/t;else{let s=(1+e)**t;i=1===n?(a*e/(s-1)+r*e/(1-1/s))/(1+e):a*e/(s-1)+r*e/(1-1/s)}return-i}function cF(e,t,r,a,n){let i;if(0===e)i=a+r*t;else{if(-1===e&&0===t)return Number.NaN;let s=(1+e)**t;i=1===n?a*s+r*(1+e)*(s-1)/e:a*s+r*(s-1)/e}return-i}function cj(e,t,r,a,n,i){let s=cw(e,r,a,n,i);return(1===t?1===i?0:-a:1===i?cF(e,t-2,s,a,1)-s:cF(e,t-1,s,a,0))*e}function cB(e,t){let r=0;for(let a=1;a<=t.length;a++)r+=t[a-1]/(1+e)**a;return r}function ck(e,t,r,a,n,i,s,l,u){let o=cH(r,a,u),c=cv(e,a,l,u);return o<c?c$(e,t,r,a,n,i,s,l,u,o,c):cY(e,t,r,a,n,i,s,l,u,c)}function c$(e,t,r,a,n,i,s,l,u,o,c){let h=0,m=cD(e,t,l),f=cH(e,a,u);h+=s/(1+i/l)**(m-1+f/c)+100*n/l*o/c/(1+i/l)**(f/c);for(let e=2;e<=m;e++)h+=100*n/l/(1+i/l)**(e-1+f/c);return h-100*n/l*cH(r,e,u)/c}function cY(e,t,r,a,n,i,s,l,u,o){let c,h=0,m=cD(a,t,l),f=cQ(a,e,12/l,!0);if(2===u||3===u){let t=cU(e,a,l);c=cH(e,t,u)}else{let{days:t}=u7(cP(e,a,l),e,u);c=o-t}h+=s/(1+i/l)**(m+f+c/o);let g=cD(r,a,l),d=a,N=0,_=0;for(let t=g;t>=1;t--){let a=cW(d,-12/l,!1),n=1===u?cH(a,d,u):o;N+=(t>1?n:cH(r,d,u))/n,_+=cH(r>a?r:a,e<d?e:d,u)/n,d=a}h+=100*n/l*N/(1+i/l)**(f+c/o);for(let e=1;e<=m;e++)h+=100*n/l/(1+i/l)**(e+f+c/o);return h-100*n/l*_}function cH(e,t,r){let{days:a}=u7(e,t,r);return e<t?a:0}function cG(e,t,r){let a=uQ(e),n=a.getUTCFullYear(),i=a.getUTCMonth(),s=a.getUTCDate(),l=oo(n,i,s),u=uQ(t),o=u.getUTCFullYear(),c=u.getUTCMonth(),h=u.getUTCDate(),m=oo(o,c,h);return!(s!==h&&!(l&&m)||Math.abs((o-n)*12+(c-i))%(12/r)!=0)}function cq(e,t,r){return cP(e,t,r)>=0}function cW(e,t,r){let a=uQ(e);if(a=oc(a,t),r){let e=os(a.getUTCFullYear(),a.getUTCMonth());a.setUTCDate(e)}return uq(a)}function cQ(e,t,r,a){let n=uQ(e),i=uQ(t),s=n.getUTCFullYear(),l=n.getUTCMonth(),u=n.getUTCDate(),o=i.getUTCFullYear(),c=i.getUTCMonth(),h=i.getUTCDate(),m=oo(s,l,u),f=!m&&1!==l&&u>28&&u<os(s,l)?oo(o,c,h):m,g=cW(t,0,f),d=+a-0+ +(t<g),N=cW(g,r,f);for(;!(r>0?N>=t:N<=t);)N=cW(N,r,f),d++;return d}function cX(e,t){let r=1,a=0,n=e,i;for(;r>1e-7&&a<500;){let e=(t(n+1e-7)-t(n-1e-7))/2e-7;i=n-t(n)/e,a++,r=Math.abs(i-n),n=i}return Number.isNaN(n)||Math.abs(n)===1/0||500===a?cK(e,t):n}function cK(e,t){let r,a;let n=Number.MAX_VALUE,i=e-.01<=-1?-1+1e-7:e-.01,s=e+.01>=n?n-1e-7:e+.01,l,u,o=0;if(e<=-1||e>=n)return rR.create(q.NUM);for(let e=0;e<60;e++){l=i<=-1?-1+1e-7:i,u=s>=n?n-1e-7:s;let r=t(l),a=t(u);if(r*a<=0)break;if(!(r*a>0)||(i=l+1.6*(l-u),s=u+1.6*(u-l),59===e))return rR.create(q.NUM)}let c=t(l),h=t(u);if(1e-7>Math.abs(c)||1e-7>Math.abs(h))return rR.create(q.NUM);do c*(r=t(a=l+(u-l)/2))<0?u=a:l=a,c=t(l),o++;while(Math.abs(r)>1e-7&&o<60)return a}function cZ(e,t,r,a,n,i,s){let l=cD(e,t,i),u=cv(e,t,i,s),o=cx(e,t,i,s);if(1===l)return(100*r/i+n)/(a/i*(u-o)/u+1)-100*r/i*o/u;let c=u-o,h=n/(1+a/i)**(l-1+c/u);for(let e=1;e<=l;e++)h+=100*r/i/(1+a/i)**(e-1+c/u);return h-100*r/i*o/u}function cz(e,t,r,a,n){let i=0,s=n/r;s>=1?(s=1,i=1===a?e:0):i=e*(1-s)**(a-1);let l=e*(1-s)**a,u=0;return(u=l<t?i-t:i-l)<0&&(u=0),u}B(cx,"calculateCoupdaybs"),B(cv,"calculateCoupdays"),B(cU,"calculateCoupncd"),B(cD,"calculateCoupnum"),B(cP,"calculateCouppcd"),B(cL,"calculateDuration"),B(cw,"calculatePMT"),B(cF,"calculateFV"),B(cj,"calculateIPMT"),B(cB,"calculateNpv"),B(ck,"calculateOddFPrice"),B(c$,"calculateOddShortFirstCoupon"),B(cY,"calculateOddLongFirstCoupon"),B(cH,"getPositiveDaysBetween"),B(cG,"validDaysBetweenIsWholeFrequencyByTwoDate"),B(cq,"validCouppcdIsGte0ByTwoDate"),B(cW,"getDateSerialNumberByMonths"),B(cQ,"getCouponsNumber"),B(cX,"getResultByGuessIterF"),B(cK,"guessIsNaNorInfinity"),B(cZ,"calculatePrice"),B(cz,"calculateDDB");let cJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",8)}calculate(e,t,r,a,n,i,s,l){let u=null!=s?s:nR.create(0),o=null!=l?l:nA.create(!0),{isError:c,errorObject:h,variants:m}=l4(e,t,r,a,n,i,u);if(c)return h;let[f,g,d,N,_,C,E]=m,p=u6(f);if("number"!=typeof p)return p;let A=u6(g);if("number"!=typeof A)return A;let b=u6(d);if("number"!=typeof b)return b;let y=+N.getValue(),R=+_.getValue(),S=Math.floor(+C.getValue()),O=Math.floor(+E.getValue()),T=+o.getValue();return Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T)?rR.create(q.VALUE):y<=0||R<=0||![1,2,4].includes(S)||O<0||O>4||Math.floor(p)>=Math.floor(b)?rR.create(q.NUM):this._getResult(p,A,b,y,R,S,O,T)}_getResult(e,t,r,a,n,i,s,l){let u=cP(e,t,i);if(u<=0)return nR.create(0);u=cP(r,t,i);let o=12/i,c=uQ(t),h=oo(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()),m=cW(t,-o,h);if(r>t&&l)for(m=t;m<r;)m=cW(m,o,h);let f=e>m?e:m,{days:g}=u7(f,r,s);if(u>=e){let{days:e}=u7(f,r,s?4:0);g=e}r<f&&(g=-g);let d=cv(m,t,i,s),N=g/d,_=m,C=e;for(;_>e;){C=_;let{days:t}=u7(f=e>(_=cW(_,-o,h))?e:_,C,s);if(0===s)g=C>=f||e<=_?t:-t,d=cv(_,C,i,s);else if(g=C<f?-t:t,3===s)d=365/i;else{let{days:e}=u7(_,C,s);d=C<_?-e:e}N+=e<=_?l?1:0:g/d}let E=n*a/i*N;return nR.create(E)}};B(cJ,"Accrint");let c0=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:l}=l4(e,t,r,a,null!=n?n:nR.create(0));if(i)return s;let[u,o,c,h,m]=l,f=u6(u);if("number"!=typeof f)return f;let g=u6(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return rR.create(q.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>Math.floor(g))return rR.create(q.NUM);if(Math.floor(f)===Math.floor(g))return nR.create(0);let{days:C,yearDays:E}=u7(f,g,_);return nR.create(N*d*C/E)}};B(c0,"Accrintm");let c1=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let{isError:l,errorObject:u,variants:o}=l4(e,t,r,a,n,i,null!=s?s:nR.create(0));if(l)return u;let[c,h,m,f,g,d,N]=o,_=u6(h);if("number"!=typeof _)return _;let C=u6(m);if("number"!=typeof C)return C;let E=+c.getValue(),p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue());return Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)?rR.create(q.VALUE):E<=0||p<0||E<p||Math.floor(_)>Math.floor(C)||A<0||b<=0||![0,1,3,4].includes(y)?rR.create(q.NUM):(A=A>1?Math.floor(A):Math.ceil(A),this._getResult(E,_,C,p,A,b,y))}_getResult(e,t,r,a,n,i,s){let l=e-a,u=e*i,{days:o,yearDays:c}=u7(t,r,s),h=o/c,m=Math.ceil(l/u-h);if(m<0)return nR.create(0);let f=u;return 0===n?f=u*h:n===m?f=l-u*(h+n-1):n>m&&(f=0),nR.create(f)}};B(c1,"Amorlinc");let c2=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return rR.create(q.NUM);let d=cx(h,m,f,g);return nR.create(d)}};B(c2,"Coupdaybs");let c3=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return rR.create(q.NUM);let d=cv(h,m,f,g);return nR.create(d)}};B(c3,"Coupdays");let c5=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return rR.create(q.NUM);let d=uQ(h),N=uQ(m);for(N.setUTCFullYear(d.getUTCFullYear()),N<d&&N.setUTCFullYear(N.getUTCFullYear()+1);N>d;)N.setUTCMonth(N.getUTCMonth()-12/f);N.setUTCMonth(N.getUTCMonth()+12/f);let{days:_}=u7(h,uq(N),g);return nR.create(_)}};B(c5,"Coupdaysnc");let c4=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return rR.create(q.NUM);let d=cU(h,m,f);return nR.create(d)}};B(c4,"Coupncd");let c6=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m)||0>cP(h,m,f))return rR.create(q.NUM);let d=cD(h,m,f);return nR.create(d)}};B(c6,"Coupnum");let c9=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l4(e,t,r,null!=a?a:nR.create(0));if(n)return i;let[l,u,o,c]=s,h=u6(l);if("number"!=typeof h)return h;let m=u6(u);if("number"!=typeof m)return m;let f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(Number.isNaN(f)||Number.isNaN(g))return rR.create(q.VALUE);if(![1,2,4].includes(f)||g<0||g>4||Math.floor(h)>=Math.floor(m))return rR.create(q.NUM);let d=cP(h,m,f);return d<0&&(d=0),nR.create(d)}};B(c9,"Couppcd");let c7=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let{isError:s,errorObject:l,variants:u}=l4(e,t,r,a,n,i);if(s)return l;let[o,c,h,m,f,g]=u,d=+o.getValue(),N=+c.getValue(),_=+h.getValue(),C=+m.getValue(),E=+f.getValue(),p=+g.getValue();return Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(C)||Number.isNaN(E)||Number.isNaN(p)?rR.create(q.VALUE):d<=0||N<=0||_<=0||C<1||E<1||C>E||C>N||E>N||![0,1].includes(p)?rR.create(q.NUM):Math.trunc(C)!==C&&Math.trunc(E)!==E&&Math.trunc(C)===Math.trunc(E)?nR.create(0):this._getResult(d,N,_,C,E,p)}_getResult(e,t,r,a,n,i){let s=cw(e,t,r,0,i),l=0,u=Math.ceil(a);1===u&&(0===i&&(l=-r),u++);let o=!1;for(let t=u;t<=n;t++){let a=1===i?cF(e,t-2,s,r,1):cF(e,t-1,s,r,0);if(0===a){o=!0;break}l+=1===i?a-s:a}return((l*=e)<s*(n-a+1)||o)&&(l=s*(n-a+1)),nR.create(l)}};B(c7,"Cumipmt");let c8=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let{isError:s,errorObject:l,variants:u}=l4(e,t,r,a,n,i);if(s)return l;let[o,c,h,m,f,g]=u,d=+o.getValue(),N=+c.getValue(),_=+h.getValue(),C=+m.getValue(),E=+f.getValue(),p=+g.getValue();return Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(C)||Number.isNaN(E)||Number.isNaN(p)?rR.create(q.VALUE):d<=0||N<=0||_<=0||C<1||E<1||C>E||![0,1].includes(p)?rR.create(q.NUM):Math.trunc(C)!==C&&Math.trunc(E)!==E&&Math.trunc(C)===Math.trunc(E)?nR.create(0):this._getResult(d,N,_,C,E,p)}_getResult(e,t,r,a,n,i){let s=cw(e,t,r,0,i),l=0,u=Math.ceil(a);1===u&&(l=0===i?s+r*e:s,u++);for(let t=u;t<=n;t++)l+=1===i?s-(cF(e,t-2,s,r,1)-s)*e:s-cF(e,t-1,s,r,0)*e;return nR.create(l)}};B(c8,"Cumprinc");let he=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5),k(this,"needsLocale",!0)}calculate(e,t,r,a,n){let i=null!=n?n:nR.create(12);i.isNull()&&(i=nR.create(12));let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,i.isArray()?i.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,i.isArray()?i.getColumnCount():1),u=nF(s,l,e,rR.create(q.NA)),o=nF(s,l,t,rR.create(q.NA)),c=nF(s,l,r,rR.create(q.NA)),h=nF(s,l,a,rR.create(q.NA)),m=nF(s,l,i,rR.create(q.NA)),f=u.map((e,t,r)=>{let a=o.get(t,r),{isError:n,errorObject:i,variants:s}=l9(e,a,c.get(t,r),h.get(t,r),m.get(t,r));if(n)return i;let[l,u,f,g,d]=s,N=+l.getValue(),_=+u.getValue(),C=+f.getValue(),E=+g.getValue(),p=Math.floor(+d.getValue());return N<0||_<0||C<=0||E<=0||Math.floor(E)>Math.floor(C)||p<1||p>12?rR.create(q.NUM):(E<1&&(E=1),E=Math.floor(E),this._getResult(N,_,C,E,p,t,r))});return 1===s&&1===l?f.get(0,0):f}_getResult(e,t,r,a,n,i,s){let l;let u=+(1-(t/e)**(1/r)).toFixed(3),o=e*u*n/12,c=o,h=0,m=a===r?r-1:a;for(let t=2;t<=m;t++)h=(e-c)*u,c+=h;return Number.isNaN(l=1===a?o:a===r?(e-c)*u:h)||!Number.isFinite(l)?rR.create(q.NUM):0===i&&0===s?nR.create(l,rm(this.getLocale())):nR.create(l)}};B(he,"Db");let ht=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5),k(this,"needsLocale",!0)}calculate(e,t,r,a,n){let i=null!=n?n:nR.create(2);i.isNull()&&(i=nR.create(2));let s=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,i.isArray()?i.getRowCount():1),l=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,i.isArray()?i.getColumnCount():1),u=nF(s,l,e,rR.create(q.NA)),o=nF(s,l,t,rR.create(q.NA)),c=nF(s,l,r,rR.create(q.NA)),h=nF(s,l,a,rR.create(q.NA)),m=nF(s,l,i,rR.create(q.NA)),f=u.map((e,t,r)=>{let a=o.get(t,r),{isError:n,errorObject:i,variants:s}=l9(e,a,c.get(t,r),h.get(t,r),m.get(t,r));if(n)return i;let[l,u,f,g,d]=s,N=+l.getValue(),_=+u.getValue(),C=+f.getValue(),E=+g.getValue(),p=+d.getValue();if(N<0||_<0||C<=0||E<=0||E>C||p<=0)return rR.create(q.NUM);let A=cz(N,_,C,E,p);return Number.isNaN(A)||!Number.isFinite(A)?rR.create(q.NUM):0===t&&0===r?nR.create(A,rm(this.getLocale())):nR.create(A)});return 1===s&&1===l?f.get(0,0):f}};B(ht,"Ddb");let hr=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:l}=l4(e,t,r,a,null!=n?n:nR.create(0));if(i)return s;let[u,o,c,h,m]=l,f=u6(u);if("number"!=typeof f)return f;let g=u6(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return rR.create(q.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>=Math.floor(g))return rR.create(q.NUM);let{days:C,yearDays:E}=u7(f,g,_);return nR.create((N-d)/N*(E/C))}};B(hr,"Disc");let ha=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);if(u>=0&&u<1)return rR.create(q.DIV_BY_ZERO);u=Number.parseInt(`${u}`,10);let o=Number.parseInt(`${l}`,10);o+=l%1*10**Math.ceil(Math.log(u)/Math.LN10)/u;let c=10**(Math.ceil(Math.log(u)/Math.LN2)+1);return o=Math.round(o*c)/c,nR.create(o)}};B(ha,"Dollarde");let hn=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(u<0)return rR.create(q.NUM);if(u>=0&&u<1)return rR.create(q.DIV_BY_ZERO);u=Number.parseInt(`${u}`,10);let o=Number.parseInt(`${l}`,10);return o+=l%1*10**-Math.ceil(Math.log(u)/Math.LN10)*u,nR.create(o)}};B(hn,"Dollarfr");let hi=class extends lm{constructor(){super(...arguments),k(this,"minParams",5),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:nR.create(0);s.isNull()&&(s=nR.create(0));let{isError:l,errorObject:u,variants:o}=l6(e,t,r,a,n,s);if(l)return u;let[c,h,m,f,g,d]=o,N=u6(c);if("number"!=typeof N)return N;let _=u6(h);if("number"!=typeof _)return _;let C=+m.getValue(),E=+f.getValue(),p=Math.floor(+g.getValue()),A=Math.floor(+d.getValue());if(Number.isNaN(C)||Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(A))return rR.create(q.VALUE);if(C<0||E<0||![1,2,4].includes(p)||A<0||A>4||Math.floor(N)>=Math.floor(_)||N<=0||_<=366)return rR.create(q.NUM);let b=cL(N,_,C,E,p,A);return nR.create(b)}};B(hi,"Duration");let hs=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(l<=0||u<1)return rR.create(q.NUM);u=Number.parseInt(`${u}`,10);let o=(1+l/u)**u-1;return nR.create(o)}};B(hs,"Effect");let hl=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5),k(this,"needsLocale",!0)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=l9(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[l,u,o,g,d]=s,N=+l.getValue(),_=+u.getValue(),C=cF(N,_,+o.getValue(),+g.getValue(),+d.getValue()?1:0);return Number.isNaN(C)||!Number.isFinite(C)?rR.create(q.NUM):0===t&&0===r?nR.create(C,rm(this.getLocale())):nR.create(C)});return 1===l&&1===u?g.get(0,0):g}};B(hl,"Fv");let hu=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e);if(r)return a;let[i]=n,s=+i.getValue();if(Number.isNaN(s))return rR.create(q.VALUE);let l=s;if(t.isArray()){let e=t.getArrayValue().flat();for(let t=0;t<e.length;t++){let r=e[t];if(r.isBoolean())return rR.create(q.VALUE);let a=+r.getValue();if(Number.isNaN(a))return rR.create(q.VALUE);l*=1+a}}else{if(t.isBoolean())return rR.create(q.VALUE);let e=+t.getValue();if(Number.isNaN(e))return rR.create(q.VALUE);l*=1+e}return nR.create(l)}};B(hu,"Fvschedule");let ho=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let{isError:i,errorObject:s,variants:l}=l4(e,t,r,a,null!=n?n:nR.create(0));if(i)return s;let[u,o,c,h,m]=l,f=u6(u);if("number"!=typeof f)return f;let g=u6(o);if("number"!=typeof g)return g;let d=+c.getValue(),N=+h.getValue(),_=Math.floor(+m.getValue());if(Number.isNaN(d)||Number.isNaN(N)||Number.isNaN(_))return rR.create(q.VALUE);if(d<=0||N<=0||_<0||_>4||Math.floor(f)>=Math.floor(g))return rR.create(q.NUM);let{days:C,yearDays:E}=u7(f,g,_);return nR.create((N-d)/d*(E/C))}};B(ho,"Intrate");let hc=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",6),k(this,"needsLocale",!0)}calculate(e,t,r,a,n,i){let s=null!=n?n:nR.create(0),l=null!=i?i:nR.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,e,rR.create(q.NA)),h=nF(u,o,t,rR.create(q.NA)),m=nF(u,o,r,rR.create(q.NA)),f=nF(u,o,a,rR.create(q.NA)),g=nF(u,o,s,rR.create(q.NA)),d=nF(u,o,l,rR.create(q.NA)),N=c.map((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),{isError:i,errorObject:s,variants:l}=l9(e,a,n,f.get(t,r),g.get(t,r),d.get(t,r));if(i)return s;let[u,o,c,N,_,C]=l,E=+u.getValue(),p=+o.getValue(),A=+c.getValue(),b=+N.getValue(),y=+_.getValue(),R=+C.getValue();if(p<1||Math.floor(p)>Math.ceil(A))return rR.create(q.NUM);let S=cj(E,p,A,b,y,R?1:0);return Number.isNaN(S)||!Number.isFinite(S)?rR.create(q.NUM):0===t&&0===r?nR.create(S,rm(this.getLocale())):nR.create(S)});return 1===u&&1===o?N.get(0,0):N}};B(hc,"Ipmt");let hh=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(.1);return r.isNull()&&(r=nR.create(.1)),r.isArray()?r.map((t,r,a)=>this._handleSingleObject(e,t,r,a)):this._handleSingleObject(e,r)}_handleSingleObject(e,t,r=0,a=0){if(e.isError())return e;if(t.isError())return t;if(e.isNull())return rR.create(q.VALUE);if(!e.isArray())return rR.create(q.NUM);let{_values:n,valuesHasError:i}=this._getValues(e);if(i)return rR.create(q.VALUE);let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()).isError())return s;let l=+s.getValue(),{positive:u,negative:o}=this._checkValues(n);if(!u||!o)return rR.create(q.NUM);let c=cX(l,e=>cB(e,n));return"number"!=typeof c?c:0===r&&0===a?nR.create(c,"0%"):nR.create(c)}_getValues(e){let t=[],r=!1;return e.iterator(e=>{if(e.isError())return r=!0,!1;if(e.isNull()||e.isBoolean())return!0;let a=+e.getValue();if(Number.isNaN(a))return!0;t.push(a)}),{_values:t,valuesHasError:r}}_checkValues(e){let t=!1,r=!1;for(let a=0;a<e.length;a++)e[a]>0&&(t=!0),e[a]<0&&(r=!0);return{positive:t,negative:r}}};B(hh,"Irr");let hm=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=nF(n,i,a,rR.create(q.NA)),c=s.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=l9(e,l.get(t,r),u.get(t,r),o.get(t,r));if(a)return n;let[s,c,h,m]=i,f=+s.getValue(),g=+c.getValue(),d=+h.getValue(),N=+m.getValue();return 0===d?rR.create(q.DIV_BY_ZERO):nR.create(N*f*(g/d-1))});return 1===n&&1===i?c.get(0,0):c}};B(hm,"Ispmt");let hf=class extends lm{constructor(){super(...arguments),k(this,"minParams",5),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:nR.create(0);s.isNull()&&(s=nR.create(0));let{isError:l,errorObject:u,variants:o}=l6(e,t,r,a,n,s);if(l)return u;let[c,h,m,f,g,d]=o,N=u6(c);if("number"!=typeof N)return N;let _=u6(h);if("number"!=typeof _)return _;let C=+m.getValue(),E=+f.getValue(),p=Math.floor(+g.getValue()),A=Math.floor(+d.getValue());if(Number.isNaN(C)||Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(A))return rR.create(q.VALUE);if(C<0||E<0||![1,2,4].includes(p)||A<0||A>4||Math.floor(N)>=Math.floor(_))return rR.create(q.NUM);let b=cL(N,_,C,E,p,A);return b/=1+E/p,nR.create(b)}};B(hf,"Mduration");let hg=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{_values:a,numberValues:n,positive:i,negative:s}=this._getValues(e),l=Math.max(t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),u=Math.max(t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),o=nF(l,u,t,rR.create(q.NA)),c=nF(l,u,r,rR.create(q.NA)),h=o.map((t,r,l)=>{let u=c.get(r,l);if(e.isError())return e;if(u.isError())return u;if(a.isError())return a;if(!i||!s)return rR.create(q.DIV_BY_ZERO);let o=+t.getValue(),h=+u.getValue();if(Number.isNaN(o)||Number.isNaN(h))return rR.create(q.VALUE);if(-1===h)return rR.create(q.DIV_BY_ZERO);let m=this._getResult(n,o,h);return 0===r&&0===l?nR.create(m,"0%"):nR.create(m)});return 1===l&&1===u?h.get(0,0):h}_getValues(e){let t=e,r=[],a=!1,n=!1;if(!e.isError()){if(e.isNull())t=rR.create(q.VALUE);else if(e.isArray()){let{numberValues:i,valuesHasError:s,errorObject:l,positive:u,negative:o}=this._checkValues(e);s&&(t=l),r=i,a=u,n=o}else t=rR.create(q.DIV_BY_ZERO)}return{_values:t,numberValues:r,positive:a,negative:n}}_checkValues(e){let t=[],r=!1,a=rR.create(q.VALUE),n=!1,i=!1;return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return!0;let s=+e.getValue();if(Number.isNaN(s))return!0;s>0&&(n=!0),s<0&&(i=!0),t.push(s)}),{numberValues:t,valuesHasError:r,errorObject:a,positive:n,negative:i}}_getResult(e,t,r){let a=e.length,n=[],i=[];for(let t=0;t<a;t++)e[t]>0?i.push(e[t]):e[t]<0&&n.push(e[t]);let s=this._npv(r,e,"positive"),l=this._npv(t,e,"negative"),u=-s*(1+r)**a,o=l*(1+t);return(u/o)**(1/(a-1))-1}_npv(e,t,r){let a=0;for(let n=1;n<=t.length;n++){let i=t[n-1];("positive"===r&&i>0||"negative"===r&&i<0)&&(a+=i/(1+e)**n)}return a}};B(hg,"Mirr");let hd=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(l<=0||u<1)return rR.create(q.NUM);u=Number.parseInt(`${u}`,10);let o=((l+1)**(1/u)-1)*u;return nR.create(o)}};B(hd,"Nominal");let hN=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.map((e,t,r)=>{let a;let n=c.get(t,r),{isError:i,errorObject:s,variants:l}=l9(e,n,h.get(t,r),m.get(t,r),f.get(t,r));if(i)return s;let[u,o,g,d,N]=l,_=+u.getValue(),C=+o.getValue(),E=+g.getValue(),p=+d.getValue(),A=+N.getValue();return(A=A?1:0,0===_&&0===C)?rR.create(q.DIV_BY_ZERO):Number.isNaN(a=0===_?-(E+p)/C:Math.log((C*(1+_*A)-p*_)/(E*_+C*(1+_*A)))/Math.log(1+_))||!Number.isFinite(a)?rR.create(q.NUM):nR.create(a)});return 1===l&&1===u?g.get(0,0):g}};B(hN,"Nper");let h_=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255),k(this,"needsLocale",!0)}calculate(e,...t){if(e.isError())return e;let{isError:r,errorObject:a,values:n}=this._getValues(t);return e.isArray()?e.map((e,t,i)=>this._handleSingleObject(e,r,a,n,t,i)):this._handleSingleObject(e,r,a,n)}_handleSingleObject(e,t,r,a,n=0,i=0){let s=e;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;if(t)return r;let l=cB(+e.getValue(),a);return Number.isNaN(l)||Math.abs(l)===1/0?rR.create(q.DIV_BY_ZERO):0===n&&0===i?nR.create(l,rm(this.getLocale())):nR.create(l)}_getValues(e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isError())return{isError:!0,errorObject:a};if(a.isArray()){let e=!1,r=rR.create(q.VALUE);if(a.iterator(a=>{if(a.isError())return e=!0,r=a,!1;if(a.isNull()||a.isBoolean())return!0;let n=+a.getValue();if(Number.isNaN(n))return!0;t.push(n)}),e)return{isError:e,errorObject:r}}else{let e=+a.getValue();if(Number.isNaN(e))return{isError:!0,errorObject:rR.create(q.VALUE)};t.push(e)}}return{isError:!1,values:t}}};B(h_,"Npv");let hC=class extends lm{constructor(){super(...arguments),k(this,"minParams",8),k(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,l,u){let o=null!=u?u:nR.create(0);o.isNull()&&(o=nR.create(0));let{isError:c,errorObject:h,variants:m}=l6(e,t,r,a,n,i,s,l,o);if(c)return h;let[f,g,d,N,_,C,E,p,A]=m,b=u6(f);if("number"!=typeof b)return b;let y=u6(g);if("number"!=typeof y)return y;let R=u6(d);if("number"!=typeof R)return R;let S=u6(N);if("number"!=typeof S)return S;let O=+_.getValue(),T=+C.getValue(),V=+E.getValue(),I=Math.floor(+p.getValue()),M=Math.floor(+A.getValue());if(Number.isNaN(O)||Number.isNaN(T)||Number.isNaN(V)||Number.isNaN(I)||Number.isNaN(M))return rR.create(q.VALUE);if(O<0||T<0||V<=0||![1,2,4].includes(I)||M<0||M>4||!this._validDate(y,S,b,R,I))return rR.create(q.NUM);let x=ck(b,y,R,S,O,T,V,I,M);return nR.create(x)}_validDate(e,t,r,a,n){return this._getDateCorrectOrder(e,t,r,a)&&cG(e,t,n)&&cq(a,e,n)}_getDateCorrectOrder(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(a)}};B(hC,"Oddfprice");let hE=class extends lm{constructor(){super(...arguments),k(this,"minParams",8),k(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,l,u){let o=null!=u?u:nR.create(0);o.isNull()&&(o=nR.create(0));let{isError:c,errorObject:h,variants:m}=l6(e,t,r,a,n,i,s,l,o);if(c)return h;let[f,g,d,N,_,C,E,p,A]=m,b=u6(f);if("number"!=typeof b)return b;let y=u6(g);if("number"!=typeof y)return y;let R=u6(d);if("number"!=typeof R)return R;let S=u6(N);if("number"!=typeof S)return S;let O=+_.getValue(),T=+C.getValue(),V=+E.getValue(),I=Math.floor(+p.getValue()),M=Math.floor(+A.getValue());return Number.isNaN(O)||Number.isNaN(T)||Number.isNaN(V)||Number.isNaN(I)||Number.isNaN(M)?rR.create(q.VALUE):O<0||T<=0||V<=0||![1,2,4].includes(I)||M<0||M>4||!this._validDate(y,S,b,R,I)?rR.create(q.NUM):this._getResult(b,y,R,S,O,T,V,I,M)}_validDate(e,t,r,a,n){return this._getDateCorrectOrder(e,t,r,a)&&cG(e,t,n)&&cq(a,e,n)}_getDateCorrectOrder(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&Math.floor(r)>Math.floor(a)}_getResult(e,t,r,a,n,i,s,l,u){let{days:o}=u7(e,t,u);function c(o){return i-ck(e,t,r,a,n,o,s,l,u)}B(c,"_iterF");let h=cX((n*o*100-(i-100))/((i-100)*.25*(1+2*o)+100*o),e=>c(e));return"number"!=typeof h?h:nR.create(h)}};B(hE,"Oddfyield");let hp=class extends lm{constructor(){super(...arguments),k(this,"minParams",7),k(this,"maxParams",8)}calculate(e,t,r,a,n,i,s,l){let u=null!=l?l:nR.create(0);u.isNull()&&(u=nR.create(0));let{isError:o,errorObject:c,variants:h}=l6(e,t,r,a,n,i,s,u);if(o)return c;let[m,f,g,d,N,_,C,E]=h,p=u6(m);if("number"!=typeof p)return p;let A=u6(f);if("number"!=typeof A)return A;let b=u6(g);if("number"!=typeof b)return b;let y=+d.getValue(),R=+N.getValue(),S=+_.getValue(),O=Math.floor(+C.getValue()),T=Math.floor(+E.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T))return rR.create(q.VALUE);if(y<0||R<0||S<=0||![1,2,4].includes(O)||T<0||T>4||!this._validDate(A,p,b,O))return rR.create(q.NUM);let V=this._getResult(p,A,b,y,R,S,O,T);return nR.create(V)}_validDate(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&cq(r,e,a)}_getResult(e,t,r,a,n,i,s,l){let u=this._getCoupDate(t,r,s),o=this._getFrac(r,e,u,s,l),c=this._getFrac(r,t,u,s,l),h=this._getFrac(e,t,u,s,l);return(i*s+100*a*(c-o*(1+n*h/s)))/(n*h+s)}_getCoupDate(e,t,r){let a=uQ(e),n=uQ(t);for(n.setUTCFullYear(a.getUTCFullYear()),n>a&&n.setUTCFullYear(n.getUTCFullYear()-1);n<a;)n.setUTCMonth(n.getUTCMonth()+12/r);return uq(n)}_getFrac(e,t,r,a,n){let i=uQ(e),s=uQ(t),l=uQ(r);for(l.setUTCFullYear(i.getUTCFullYear()),l<i&&l.setUTCFullYear(l.getUTCFullYear()+1);l>i;)l.setUTCMonth(l.getUTCMonth()-12/a);let u=uq(l);l.setUTCMonth(l.getUTCMonth()+12/a);let o=uq(l);if(o>=t){let{days:r}=u7(e,t,n);return r/cv(u,o,a,n)}let{days:c}=u7(e,o,n),h=c/cv(u,o,a,n),m=uQ(o),f=uQ(o);for(f.setUTCMonth(f.getUTCMonth()+12/a);f<s;)m.setUTCMonth(m.getUTCMonth()+12/a),f.setUTCMonth(f.getUTCMonth()+12/a),h+=1;u=uq(m),o=uq(f);let{days:g}=u7(u,t,n);return h+g/cv(u,o,a,n)}};B(hp,"Oddlprice");let hA=class extends lm{constructor(){super(...arguments),k(this,"minParams",8),k(this,"maxParams",9)}calculate(e,t,r,a,n,i,s,l){let u=null!=l?l:nR.create(0);u.isNull()&&(u=nR.create(0));let{isError:o,errorObject:c,variants:h}=l6(e,t,r,a,n,i,s,u);if(o)return c;let[m,f,g,d,N,_,C,E]=h,p=u6(m);if("number"!=typeof p)return p;let A=u6(f);if("number"!=typeof A)return A;let b=u6(g);if("number"!=typeof b)return b;let y=+d.getValue(),R=+N.getValue(),S=+_.getValue(),O=Math.floor(+C.getValue()),T=Math.floor(+E.getValue());if(Number.isNaN(y)||Number.isNaN(R)||Number.isNaN(S)||Number.isNaN(O)||Number.isNaN(T))return rR.create(q.VALUE);if(y<0||R<=0||S<=0||![1,2,4].includes(O)||T<0||T>4||!this._validDate(A,p,b,O))return rR.create(q.NUM);let V=this._getResult(p,A,b,y,R,S,O,T);return nR.create(V)}_validDate(e,t,r,a){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)&&cq(r,e,a)}_getResult(e,t,r,a,n,i,s,l){let u=this._getCoupDate(t,r,s),o=this._getFrac(r,e,u,s,l),c=this._getFrac(r,t,u,s,l),h=this._getFrac(e,t,u,s,l);return(s*(i-n)+100*a*(c-o))/(h*n+100*a*o*h/s)}_getCoupDate(e,t,r){let a=uQ(e),n=uQ(t);for(n.setUTCFullYear(a.getUTCFullYear()),n>a&&n.setUTCFullYear(n.getUTCFullYear()-1);n<a;)n.setUTCMonth(n.getUTCMonth()+12/r);return uq(n)}_getFrac(e,t,r,a,n){let i=uQ(e),s=uQ(t),l=uQ(r);for(l.setUTCFullYear(i.getUTCFullYear()),l<i&&l.setUTCFullYear(l.getUTCFullYear()+1);l>i;)l.setUTCMonth(l.getUTCMonth()-12/a);let u=uq(l);l.setUTCMonth(l.getUTCMonth()+12/a);let o=uq(l);if(o>=t){let{days:r}=u7(e,t,n);return r/cv(u,o,a,n)}let{days:c}=u7(e,o,n),h=c/cv(u,o,a,n),m=uQ(o),f=uQ(o);for(f.setUTCMonth(f.getUTCMonth()+12/a);f<s;)m.setUTCMonth(m.getUTCMonth()+12/a),f.setUTCMonth(f.getUTCMonth()+12/a),h+=1;u=uq(m),o=uq(f);let{days:g}=u7(u,t,n);return h+g/cv(u,o,a,n)}};B(hA,"Oddlyield");let hb=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=l9(e,s.get(t,r),l.get(t,r));if(a)return n;let[u,o,c]=i,h=+u.getValue(),m=+o.getValue(),f=+c.getValue();if(h<=-1)return rR.create(q.NUM);let g=(Math.log(f)-Math.log(m))/Math.log(1+h);return Number.isNaN(g)||!Number.isFinite(g)?rR.create(q.NUM):nR.create(g)});return 1===a&&1===n?u.get(0,0):u}};B(hb,"Pduration");let hy=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5),k(this,"needsLocale",!0)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=l9(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[l,u,o,g,d]=s,N=+l.getValue(),_=+u.getValue(),C=+o.getValue(),E=+g.getValue(),p=+d.getValue();if(N<=-1)return rR.create(q.NUM);let A=cw(N,_,C,E,p?1:0);return Number.isNaN(A)||!Number.isFinite(A)?rR.create(q.NUM):0===t&&0===r?nR.create(A,rm(this.getLocale())):nR.create(A)});return 1===l&&1===u?g.get(0,0):g}};B(hy,"Pmt");let hR=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",6),k(this,"needsLocale",!0)}calculate(e,t,r,a,n,i){let s=null!=n?n:nR.create(0),l=null!=i?i:nR.create(0),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,e,rR.create(q.NA)),h=nF(u,o,t,rR.create(q.NA)),m=nF(u,o,r,rR.create(q.NA)),f=nF(u,o,a,rR.create(q.NA)),g=nF(u,o,s,rR.create(q.NA)),d=nF(u,o,l,rR.create(q.NA)),N=c.map((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),{isError:i,errorObject:s,variants:l}=l9(e,a,n,f.get(t,r),g.get(t,r),d.get(t,r));if(i)return s;let[u,o,c,N,_,C]=l,E=+u.getValue(),p=+o.getValue(),A=+c.getValue(),b=+N.getValue(),y=+_.getValue(),R=+C.getValue();if(p<1||Math.floor(p)>Math.ceil(A)||p-A>=1)return rR.create(q.NUM);let S=cw(E,A,b,y,R?1:0)-cj(E,p,A,b,y,R?1:0);return Number.isNaN(S)||!Number.isFinite(S)?rR.create(q.NUM):0===t&&0===r?nR.create(S,rm(this.getLocale())):nR.create(S)});return 1===u&&1===o?N.get(0,0):N}};B(hR,"Ppmt");let hS=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let l=null!=s?s:nR.create(0);l.isNull()&&(l=nR.create(0));let{isError:u,errorObject:o,variants:c}=l6(e,t,r,a,n,i,l);if(u)return o;let[h,m,f,g,d,N,_]=c,C=u6(h);if("number"!=typeof C)return C;let E=u6(m);if("number"!=typeof E)return E;let p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue()),R=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)||Number.isNaN(R))return rR.create(q.VALUE);if(p<0||A<0||b<=0||![1,2,4].includes(y)||R<0||R>4||C>=E||!cq(C,E,y))return rR.create(q.NUM);let S=cZ(C,E,p,A,b,y,R);return nR.create(S)}};B(hS,"Price");let hO=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:nR.create(0);i.isNull()&&(i=nR.create(0));let{isError:s,errorObject:l,variants:u}=l6(e,t,r,a,i);if(s)return l;let[o,c,h,m,f]=u,g=u6(o);if("number"!=typeof g)return g;let d=u6(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),C=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(C))return rR.create(q.VALUE);if(N<=0||_<=0||C<0||C>4||g>=d)return rR.create(q.NUM);let{days:E,yearDays:p}=u7(g,d,C);return nR.create(_-N*_*E/p)}};B(hO,"Pricedisc");let hT=class extends lm{constructor(){super(...arguments),k(this,"minParams",5),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:nR.create(0);s.isNull()&&(s=nR.create(0));let{isError:l,errorObject:u,variants:o}=l6(e,t,r,a,n,s);if(l)return u;let[c,h,m,f,g,d]=o,N=u6(c);if("number"!=typeof N)return N;let _=u6(h);if("number"!=typeof _)return _;let C=u6(m);if("number"!=typeof C)return C;let E=+f.getValue(),p=+g.getValue(),A=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(A))return rR.create(q.VALUE);let b=this._getDateCorrectOrder(_,N,C);if(E<0||p<0||A<0||A>4||!b)return rR.create(q.NUM);let y=ou(N,A),{days:R}=u7(N,_,A),{days:S}=u7(C,_,A),{days:O}=u7(C,N,A);return nR.create((100+S/y*E*100)/(1+R/y*p)-O/y*E*100)}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}};B(hT,"Pricemat");let hV=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5),k(this,"needsLocale",!0)}calculate(e,t,r,a,n){let i=null!=a?a:nR.create(0),s=null!=n?n:nR.create(0),l=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,e,rR.create(q.NA)),c=nF(l,u,t,rR.create(q.NA)),h=nF(l,u,r,rR.create(q.NA)),m=nF(l,u,i,rR.create(q.NA)),f=nF(l,u,s,rR.create(q.NA)),g=o.map((e,t,r)=>{let a=c.get(t,r),{isError:n,errorObject:i,variants:s}=l9(e,a,h.get(t,r),m.get(t,r),f.get(t,r));if(n)return i;let[l,u,o,g,d]=s,N=+l.getValue(),_=+u.getValue(),C=+o.getValue(),E=+g.getValue(),p=+d.getValue();p=p?1:0;let A=0===N?-C*_-E:((1-(1+N)**_)/N*C*(1+N*p)-E)/(1+N)**_;return Number.isNaN(A)||!Number.isFinite(A)?rR.create(q.NUM):0===t&&0===r?nR.create(A,rm(this.getLocale())):nR.create(A)});return 1===l&&1===u?g.get(0,0):g}};B(hV,"Pv");let hI=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=a?a:nR.create(0),l=null!=n?n:nR.create(0),u=null!=i?i:nR.create(.1),o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1),h=nF(o,c,e,rR.create(q.NA)),m=nF(o,c,t,rR.create(q.NA)),f=nF(o,c,r,rR.create(q.NA)),g=nF(o,c,s,rR.create(q.NA)),d=nF(o,c,l,rR.create(q.NA)),N=nF(o,c,u,rR.create(q.NA)),_=h.map((e,t,r)=>{let a=m.get(t,r),n=f.get(t,r),{isError:i,errorObject:s,variants:l}=l9(e,a,n,g.get(t,r),d.get(t,r),N.get(t,r));if(i)return s;let[u,o,c,h,_,C]=l,E=+u.getValue(),p=+o.getValue(),A=+c.getValue(),b=+h.getValue(),y=+_.getValue(),R=+C.getValue();return y=y?1:0,E<=0||p>=0?rR.create(q.NUM):this._getResult(E,p,A,b,y,R,t,r)});return 1===o&&1===c?_.get(0,0):_}_getResult(e,t,r,a,n,i,s,l){let u=i;for(let i=0;i<20;i++){let i,s,l;if(u<=-1)return rR.create(q.NUM);if(1e-10>Math.abs(i=1e-10>Math.abs(u)?r*(1+e*u)+t*(1+u*n)*e+a:r*(s=(1+u)**e)+t*(1/u+n)*(s-1)+a))break;if(1e-10>Math.abs(u))l=r*e+t*n*e;else{s=(1+u)**e;let a=e*(1+u)**(e-1);l=r*a+t*(1/u+n)*a+-1/(u*u)*t*(s-1)}u-=i/l}return 0===s&&0===l?nR.create(u,"0%"):nR.create(u)}};B(hI,"Rate");let hM=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:nR.create(0);i.isNull()&&(i=nR.create(0));let{isError:s,errorObject:l,variants:u}=l6(e,t,r,a,i);if(s)return l;let[o,c,h,m,f]=u,g=u6(o);if("number"!=typeof g)return g;let d=u6(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),C=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(C))return rR.create(q.VALUE);if(N<=0||_<=0||C<0||C>4||g>=d)return rR.create(q.NUM);let{days:E,yearDays:p}=u7(g,d,C),A=N/(1-_*E/p);return A<0?rR.create(q.NUM):nR.create(A)}};B(hM,"Received");let hx=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",6)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.map((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=l9(e,s.get(t,r),l.get(t,r));if(a)return n;let[u,o,c]=i,h=+u.getValue(),m=+o.getValue(),f=+c.getValue();if(h<=0)return rR.create(q.NUM);if(0===m&&0===f)return nR.create(0);let g=(f/m)**(1/h)-1;return Number.isNaN(g)||!Number.isFinite(g)||f/m<0?rR.create(q.NUM):nR.create(g)});return 1===a&&1===n?u.get(0,0):u}};B(hx,"Rri");let hv=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3),k(this,"needsLocale",!0)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.map((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);if(a.isError())return a;if(n.isError())return n;let i=+e.getValue(),u=+a.getValue(),o=+n.getValue();if(Number.isNaN(i)||Number.isNaN(u)||Number.isNaN(o))return rR.create(q.VALUE);if(0===o)return rR.create(q.DIV_BY_ZERO);let c=(i-u)/o;return 0===t&&0===r?nR.create(c,rm(this.getLocale())):nR.create(c)});return 1===a&&1===n?u.get(0,0):u}};B(hv,"Sln");let hU=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4),k(this,"needsLocale",!0)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=nF(n,i,a,rR.create(q.NA)),c=s.map((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r),i=o.get(t,r);if(a.isError())return a;if(n.isError())return n;if(i.isError())return i;let s=+e.getValue(),c=+a.getValue(),h=+n.getValue(),m=+i.getValue();if(Number.isNaN(s)||Number.isNaN(c)||Number.isNaN(h)||Number.isNaN(m))return rR.create(q.VALUE);if(c<0||h<=0||m>h)return rR.create(q.NUM);let f=(s-c)*(h-m+1)*2/(h*(h+1));return 0===t&&0===r?nR.create(f,rm(this.getLocale())):nR.create(f)});return 1===n&&1===i?c.get(0,0):c}};B(hU,"Syd");let hD=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=l6(e,t,r);if(a)return n;let[s,l,u]=i,o=u6(s);if("number"!=typeof o)return o;let c=u6(l);if("number"!=typeof c)return c;let h=+u.getValue();if(Number.isNaN(h))return rR.create(q.VALUE);if(h<=0||o>=c)return rR.create(q.NUM);let m=Math.floor(c)-Math.floor(o);if(m>ol(uQ(o).getUTCFullYear()))return rR.create(q.NUM);let f=365*h/(360-h*m);if(m>182){let e=m/365;if(Number.isNaN(f=(-e+Math.sqrt(e*e-(2*e-1)*(1-100/(100*(1-h*m/360)))))/(e-.5)))return rR.create(q.NUM)}return f<0?rR.create(q.NUM):nR.create(f)}};B(hD,"Tbilleq");let hP=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3),k(this,"needsLocale",!0)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=l6(e,t,r);if(a)return n;let[s,l,u]=i,o=u6(s);if("number"!=typeof o)return o;let c=u6(l);if("number"!=typeof c)return c;let h=+u.getValue();if(Number.isNaN(h))return rR.create(q.VALUE);if(h<=0||o>=c)return rR.create(q.NUM);let m=Math.floor(c)-Math.floor(o);if(m>ol(uQ(o).getUTCFullYear()))return rR.create(q.NUM);let f=100*(1-h*m/360);return f<0?rR.create(q.NUM):nR.create(f,rm(this.getLocale()))}};B(hP,"Tbillprice");let hL=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=l6(e,t,r);if(a)return n;let[s,l,u]=i,o=u6(s);if("number"!=typeof o)return o;let c=u6(l);if("number"!=typeof c)return c;let h=+u.getValue();if(Number.isNaN(h))return rR.create(q.VALUE);if(h<=0||o>=c)return rR.create(q.NUM);let m=Math.floor(c)-Math.floor(o);return m>ol(uQ(o).getUTCFullYear())?rR.create(q.NUM):nR.create((100-h)/h*360/m)}};B(hL,"Tbillyield");let hw=class extends lm{constructor(){super(...arguments),k(this,"minParams",5),k(this,"maxParams",7),k(this,"needsLocale",!0)}calculate(e,t,r,a,n,i,s){let l=null!=i?i:nR.create(2);l.isNull()&&(l=nR.create(2));let u=null!=s?s:nA.create(!1);u.isNull()&&(u=nA.create(!1));let o=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1),c=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1),h=nF(o,c,e,rR.create(q.NA)),m=nF(o,c,t,rR.create(q.NA)),f=nF(o,c,r,rR.create(q.NA)),g=nF(o,c,a,rR.create(q.NA)),d=nF(o,c,n,rR.create(q.NA)),N=nF(o,c,l,rR.create(q.NA)),_=nF(o,c,u,rR.create(q.NA));return this._getResultArray(h,m,f,g,d,N,_,o,c)}_getResultArray(e,t,r,a,n,i,s,l,u){let o=e.map((e,l,u)=>{let o=t.get(l,u),c=r.get(l,u),h=a.get(l,u),{isError:m,errorObject:f,variants:g}=l9(e,o,c,h,n.get(l,u),i.get(l,u),s.get(l,u));if(m)return f;let[d,N,_,C,E,p,A]=g,b=+d.getValue(),y=+N.getValue(),R=+_.getValue(),S=+C.getValue(),O=+E.getValue(),T=+p.getValue(),V=+A.getValue();if(b<0||y<0||R<0||S<0||O<0||O>R||S>O||T<0)return rR.create(q.NUM);if(0===R&&0===S&&0===O)return rR.create(q.DIV_BY_ZERO);let I=this._getResult(b,y,R,S,O,T,V);return 0===l&&0===u?nR.create(I,rm(this.getLocale())):nR.create(I)});return 1===l&&1===u?o.get(0,0):o}_getResult(e,t,r,a,n,i,s){let l=Math.floor(a),u=Math.ceil(n),o=0;if(e<t){if(a>=1||s)return o;let r=Math.abs(e-t);return-(o=r*(n-a)>r?r:r*(n-a))}if(s)for(let s=l+1;s<=u;s++){let c=cz(e,t,r,s,i);s===l+1?c*=Math.min(n,l+1)-a:s===u&&(c*=n+1-u),o+=c}else{let s=e-this._getVdb(e,t,r,r,a,i);o=this._getVdb(s,t,r,r-a,n-a,i)}return o}_getVdb(e,t,r,a,n,i){let s=Math.ceil(n),l=0,u=e-t,o=0,c=0,h=!1;for(let m=1;m<=s;m++){if(h)c=o;else{let n=cz(e,t,r,m,i);(o=u/(a-(m-1)))>n?(c=o,h=!0):(c=n,u-=n)}m===s&&(c*=n+1-s),l+=c}return l}};B(hw,"Vdb");let hF=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull())return rR.create(q.NA);let{isError:a,errorObejct:n,_values:i,_dates:s}=this._checkErrors(e,t);if(a)return n;let l=null!=r?r:nR.create(.1);l.isNull()&&(l=nR.create(.1));let{isError:u,errorObject:o,variants:c}=l4(l);if(u)return o;let[h]=c,m=+h.getValue();if(Number.isNaN(m))return rR.create(q.VALUE);let{positive:f,negative:g}=this._checkValues(i);if(!f||!g||(null==i?void 0:i.length)!==(null==s?void 0:s.length)||m<0)return rR.create(q.NUM);let d=cX(m,e=>this._iterF(i,s,e));return"number"!=typeof d?d:nR.create(d)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:a,_values:n}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:a};let{isError:i,errorObejct:s,_dates:l}=this._checkErrorDates(t);return i?{isError:i,errorObejct:s}:{isError:!1,_values:n,_dates:l}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isBoolean())return r=!0,a=rR.create(q.VALUE),!1;let n=+e.getValue();if(Number.isNaN(n))return r=!0,a=rR.create(q.VALUE),!1;t.push(n)}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:rR.create(q.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:rR.create(q.VALUE)}:{isError:!0,errorObejct:rR.create(q.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);return e.iterator(e=>{if(null!=e&&e.isError())return r=!0,a=e,!1;if(null!=e&&e.isBoolean())return r=!0,a=rR.create(q.VALUE),!1;let n=+e.getValue();return Number.isNaN(n)?(r=!0,a=rR.create(q.VALUE),!1):n<0?(r=!0,a=rR.create(q.NUM),!1):void t.push(Math.floor(n))}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:rR.create(q.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:rR.create(q.VALUE)}:0>+t?{isError:!0,errorObejct:rR.create(q.NUM)}:{isError:!0,errorObejct:rR.create(q.NA)}}}_checkValues(e){let t=!1,r=!1;for(let a=0;a<e.length;a++)e[a]>0&&(t=!0),e[a]<0&&(r=!0);return{positive:t,negative:r}}_iterF(e,t,r){return e.reduce((e,a,n)=>e+a/(1+r)**((t[n]-t[0])/365),0)}};B(hF,"Xirr");let hj=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){if(e.isNull()||t.isNull()||r.isNull())return rR.create(q.NA);let{isError:a,errorObject:n,variants:i}=l4(e);if(a)return n;let[s]=i,l=+s.getValue();if(Number.isNaN(l))return rR.create(q.VALUE);let{isError:u,errorObejct:o,_values:c,_dates:h}=this._checkErrors(t,r);if(u)return o;if(l<0||c.length!==h.length)return rR.create(q.NUM);let m=0,f=h[0];for(let e=0;e<h.length;e++){let t=h[e];m+=c[e]/(1+l)**((t-f)/365)}return nR.create(m)}_checkErrors(e,t){if(e.isError())return{isError:!0,errorObejct:e};if(t.isError())return{isError:!0,errorObejct:t};let{isError:r,errorObejct:a,_values:n}=this._checkErrorValues(e);if(r)return{isError:r,errorObejct:a};let{isError:i,errorObejct:s,_dates:l}=this._checkErrorDates(t);return i?{isError:i,errorObejct:s}:{isError:!1,_values:n,_dates:l}}_checkErrorValues(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return r=!0,a=rR.create(q.VALUE),!1;let n=+e.getValue();if(Number.isNaN(n))return r=!0,a=rR.create(q.VALUE),!1;t.push(n)}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:rR.create(q.NA)}:{isError:r,_values:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:rR.create(q.VALUE)}:{isError:!0,errorObejct:rR.create(q.NA)}}}_checkErrorDates(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);return e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;if(e.isNull()||e.isBoolean())return r=!0,a=rR.create(q.VALUE),!1;let n=+e.getValue();return Number.isNaN(n)?(r=!0,a=rR.create(q.VALUE),!1):n<0?(r=!0,a=rR.create(q.NUM),!1):void t.push(Math.floor(n))}),r?{isError:r,errorObejct:a}:t.length<=1?{isError:!0,errorObejct:rR.create(q.NA)}:{isError:r,_dates:t}}{let t=e.getValue();return e.isNull()||e.isBoolean()||e.isString()&&!(0,P.isRealNum)(t)?{isError:!0,errorObejct:rR.create(q.VALUE)}:0>+t?{isError:!0,errorObejct:rR.create(q.NUM)}:{isError:!0,errorObejct:rR.create(q.NA)}}}};B(hj,"Xnpv");let hB=class extends lm{constructor(){super(...arguments),k(this,"minParams",6),k(this,"maxParams",7)}calculate(e,t,r,a,n,i,s){let l=null!=s?s:nR.create(0);l.isNull()&&(l=nR.create(0));let{isError:u,errorObject:o,variants:c}=l6(e,t,r,a,n,i,l);if(u)return o;let[h,m,f,g,d,N,_]=c,C=u6(h);if("number"!=typeof C)return C;let E=u6(m);if("number"!=typeof E)return E;let p=+f.getValue(),A=+g.getValue(),b=+d.getValue(),y=Math.floor(+N.getValue()),R=Math.floor(+_.getValue());if(Number.isNaN(p)||Number.isNaN(A)||Number.isNaN(b)||Number.isNaN(y)||Number.isNaN(R))return rR.create(q.VALUE);if(p<0||A<=0||b<=0||![1,2,4].includes(y)||R<0||R>4||C>=E||!cq(C,E,y))return rR.create(q.NUM);let S=this._getResult(C,E,p,A,b,y,R);return nR.create(S)}_getResult(e,t,r,a,n,i,s){if(cD(e,t,i)>1){let l=r||.01,u=cZ(e,t,r,l,n,i,s),o=u-a;for(let c=0;c<100&&Math.abs(o)>1e-7;c++)u=cZ(e,t,r,1.01*l,n,i,s),l+=-o/(u-a-o)*l*.01,o=cZ(e,t,r,l,n,i,s)-a;return l}let l=cx(e,t,i,s),u=cv(e,t,i,s),{days:o}=u7(e,t,s),c=a/100+l/u*r/i;return(n/100+r/i-c)/c*i*u/o}};B(hB,"Yield");let hk=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",5)}calculate(e,t,r,a,n){let i=null!=n?n:nR.create(0);i.isNull()&&(i=nR.create(0));let{isError:s,errorObject:l,variants:u}=l6(e,t,r,a,i);if(s)return l;let[o,c,h,m,f]=u,g=u6(o);if("number"!=typeof g)return g;let d=u6(c);if("number"!=typeof d)return d;let N=+h.getValue(),_=+m.getValue(),C=Math.floor(+f.getValue());if(Number.isNaN(N)||Number.isNaN(_)||Number.isNaN(C))return rR.create(q.VALUE);if(N<=0||_<=0||C<0||C>4||g>=d)return rR.create(q.NUM);let{days:E,yearDays:p}=u7(g,d,C);return nR.create((_/N-1)/(E/p))}};B(hk,"Yielddisc");let h$=class extends lm{constructor(){super(...arguments),k(this,"minParams",5),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=i?i:nR.create(0);s.isNull()&&(s=nR.create(0));let{isError:l,errorObject:u,variants:o}=l6(e,t,r,a,n,s);if(l)return u;let[c,h,m,f,g,d]=o,N=u6(c);if("number"!=typeof N)return N;let _=u6(h);if("number"!=typeof _)return _;let C=u6(m);if("number"!=typeof C)return C;let E=+f.getValue(),p=+g.getValue(),A=Math.floor(+d.getValue());if(Number.isNaN(E)||Number.isNaN(p)||Number.isNaN(A))return rR.create(q.VALUE);let b=this._getDateCorrectOrder(_,N,C);if(E<0||p<=0||A<0||A>4||!b)return rR.create(q.NUM);let y=ou(N,A),{days:R}=u7(N,_,A),{days:S}=u7(C,_,A),{days:O}=u7(C,N,A);return nR.create(((1+S/y*E)/(p/100+O/y*E)-1)/(R/y))}_getDateCorrectOrder(e,t,r){return Math.floor(e)>Math.floor(t)&&Math.floor(t)>Math.floor(r)}};B(h$,"Yieldmat");let hY=[[cJ,cM.ACCRINT],[c0,cM.ACCRINTM],[c1,cM.AMORLINC],[c2,cM.COUPDAYBS],[c3,cM.COUPDAYS],[c5,cM.COUPDAYSNC],[c4,cM.COUPNCD],[c6,cM.COUPNUM],[c9,cM.COUPPCD],[c7,cM.CUMIPMT],[c8,cM.CUMPRINC],[he,cM.DB],[ht,cM.DDB],[hr,cM.DISC],[ha,cM.DOLLARDE],[hn,cM.DOLLARFR],[hi,cM.DURATION],[hs,cM.EFFECT],[hl,cM.FV],[hu,cM.FVSCHEDULE],[ho,cM.INTRATE],[hc,cM.IPMT],[hh,cM.IRR],[hm,cM.ISPMT],[hf,cM.MDURATION],[hg,cM.MIRR],[hd,cM.NOMINAL],[hN,cM.NPER],[h_,cM.NPV],[hC,cM.ODDFPRICE],[hE,cM.ODDFYIELD],[hp,cM.ODDLPRICE],[hA,cM.ODDLYIELD],[hb,cM.PDURATION],[hy,cM.PMT],[hR,cM.PPMT],[hS,cM.PRICE],[hO,cM.PRICEDISC],[hT,cM.PRICEMAT],[hV,cM.PV],[hI,cM.RATE],[hM,cM.RECEIVED],[hx,cM.RRI],[hv,cM.SLN],[hU,cM.SYD],[hD,cM.TBILLEQ],[hP,cM.TBILLPRICE],[hL,cM.TBILLYIELD],[hw,cM.VDB],[hF,cM.XIRR],[hj,cM.XNPV],[hB,cM.YIELD],[hk,cM.YIELDDISC],[h$,cM.YIELDMAT]],hH=class extends lm{constructor(){super(...arguments),k(this,"needsReferenceObject",!0),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),r.isArray()){let e=r.getRowCount(),a=r.getColumnCount();if(1===e&&1===a){let e=r.get(0,0);return this._handleSingleObject(e,t)}return r.map(e=>e.isError()?e:this._handleSingleObject(e,t,!0))}return this._handleSingleObject(r,t)}_handleSingleObject(e,t,r=!1){let a,n=t;if(n.isError())return n;if(!n.isReferenceObject())return rR.create(q.NA);let{columnData:i,defaultColumnWidth:s}=n.getCurrentActiveSheetData(),l=(n=n.toArrayValueObject()).getCurrentRow(),u=n.getCurrentColumn();switch(n=n.getFirstCell(),`${e.getValue()}`.toLocaleLowerCase()){case"address":return nT.create(`$${(0,P.Tools).chatAtABC(u)}$${l+1}`);case"col":return nR.create(u+1);case"color":case"parentheses":return nR.create(0);case"contents":return n;case"filename":default:return rR.create(q.VALUE);case"format":return nT.create("G");case"prefix":return nT.create("");case"protect":return nR.create(1);case"row":return nR.create(l+1);case"type":return a="v",n.isNull()&&(a="b"),n.isString()&&(a="l"),nT.create(a);case"width":return this._getWidthResult(i,s,u,r)}}_getWidthResult(e,t,r,a){var n;let i=null==(n=e[r])?void 0:n.w;if(i||0===i||(i=t),a)return nR.create(i);let s=[[i,i===t]];return nD.createByArray(s)}};B(hH,"Cell");let hG=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1),k(this,"_errorTypeValueMap",/* @__PURE__ */new Map([[q.NULL,1],[q.DIV_BY_ZERO,2],[q.VALUE,3],[q.REF,4],[q.NAME,5],[q.NUM,6],[q.NA,7],[q.CONNECT,8],[q.CALC,14]]))}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e.getValue(),r=this._errorTypeValueMap.get(t);return r?nR.create(r):rR.create(q.NA)}};B(hG,"ErrorType");var hq=((I=hq||{}).CELL="CELL",I.ERROR_TYPE="ERROR.TYPE",I.INFO="INFO",I.ISBLANK="ISBLANK",I.ISERR="ISERR",I.ISERROR="ISERROR",I.ISEVEN="ISEVEN",I.ISFORMULA="ISFORMULA",I.ISLOGICAL="ISLOGICAL",I.ISNA="ISNA",I.ISNONTEXT="ISNONTEXT",I.ISNUMBER="ISNUMBER",I.ISODD="ISODD",I.ISOMITTED="ISOMITTED",I.ISREF="ISREF",I.ISTEXT="ISTEXT",I.N="N",I.NA="NA",I.SHEET="SHEET",I.SHEETS="SHEETS",I.TYPE="TYPE",I);let hW=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isNull()?nA.create(!0):e.isArray()?e.mapValue(e=>e.isNull()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(hW,"Isblank");let hQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.getValue()===q.NA?nA.create(!1):e.isError()?nA.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===q.NA?nA.create(!1):e.isError()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(hQ,"Iserr");let hX=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?nA.create(!0):e.isArray()?e.mapValue(e=>e.isError()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(hX,"Iserror");let hK=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return rR.create(q.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return rR.create(q.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?rR.create(q.VALUE):nA.create(r%2==0)}};B(hK,"Iseven");let hZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1),k(this,"needsReferenceObject",!0)}calculate(e){var t;if(e.isError())return e;if(!e.isReferenceObject())return rR.create(q.NA);let r=null==(t=e.getCurrentActiveSheetData())?void 0:t.cellData.getMatrix(),{startRow:a,startColumn:n}=e.getRangePosition(),i=e.toArrayValueObject(),s=i.mapValue((e,t,i)=>{var s;let l=null==(s=null==r?void 0:r[a+t])?void 0:s[n+i];return null!=l&&l.f||null!=l&&l.si?nA.create(!0):nA.create(!1)});return 1===i.getRowCount()&&1===i.getColumnCount()?s.get(0,0):s}};B(hZ,"Isformula");let hz=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isBoolean()?nA.create(!0):e.isArray()?e.mapValue(e=>e.isBoolean()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(hz,"Islogical");let hJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.getValue()===q.NA?nA.create(!0):e.isArray()?e.mapValue(e=>e.getValue()===q.NA?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(hJ,"Isna");let h0=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()||e.isString()?e.isArray()?e.mapValue(e=>e.isString()?nA.create(!1):nA.create(!0)):nA.create(!1):nA.create(!0)}};B(h0,"Isnontext");let h1=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isNumber()?nA.create(!0):e.isArray()?e.mapValue(e=>e.isNumber()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(h1,"Isnumber");let h2=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return rR.create(q.VALUE);t=t.get(0,0)}if(t.isError())return t;if(t.isBoolean())return rR.create(q.VALUE);let r=Math.trunc(+t.getValue());return Number.isNaN(r)?rR.create(q.VALUE):nA.create(r%2!=0)}};B(h2,"Isodd");let h3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1),k(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nA.create(!0):nA.create(!1)}};B(h3,"Isref");let h5=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isString()?nA.create(!0):e.isArray()?e.mapValue(e=>e.isString()?nA.create(!0):nA.create(!1)):nA.create(!1)}};B(h5,"Istext");let h4=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()&&(t=e.get(0,0)),t.isError())return t;if(t.isString())return nR.create(0);let r=+t.getValue();return nR.create(r)}};B(h4,"N");let h6=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){return rR.create(q.NA)}};B(h6,"Na");let h9=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",1),k(this,"needsReferenceObject",!0),k(this,"needsSheetsInfo",!0)}calculate(e){var t;if(null!=e&&e.isError())return e;let{sheetOrder:r,sheetNameMap:a}=this.getSheetsInfo();if(!e){let e=r.findIndex(e=>e===this.subUnitId);return nR.create(e+1)}if(e.isReferenceObject()){let t=e.getForcedSheetId(),a=e.getDefaultSheetId(),n=r.findIndex(e=>t?e===t:e===a);return nR.create(n+1)}if(e.isArray())return rR.create(q.NA);let n=`${e.getValue()}`.toLocaleLowerCase(),i=null==(t=Object.entries(a).find(([e,t])=>t.toLocaleLowerCase()===n))?void 0:t[0];if(!i)return rR.create(q.NA);let s=r.findIndex(e=>e===i);return nR.create(s+1)}};B(h9,"Sheet");let h7=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0),k(this,"needsSheetsInfo",!0)}calculate(){let{sheetOrder:e}=this.getSheetsInfo();return nR.create(e.length)}};B(h7,"Sheets");let h8=class extends lm{constructor(){super(...arguments),k(this,"needsReferenceObject",!0),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isReferenceObject()){let t=e.getRowCount(),r=e.getColumnCount();if(1!==t||1!==r)return nR.create(64);{let t=e.getFirstCell();if(t.isError())return nR.create(16);if(t.isBoolean())return nR.create(4);if(t.isString())return nR.create(2);if(t.isNumber()||t.isNull())return nR.create(1)}}else{if(e.isArray())return nR.create(64);if(e.isError())return nR.create(16);if(e.isBoolean())return nR.create(4);if(e.isString())return nR.create(2);if(e.isNumber()||e.isNull())return nR.create(1)}return nR.create(128)}};B(h8,"Type");let me=[[hH,hq.CELL],[hG,hq.ERROR_TYPE],[hW,hq.ISBLANK],[hQ,hq.ISERR],[hX,hq.ISERROR],[hK,hq.ISEVEN],[hZ,hq.ISFORMULA],[hz,hq.ISLOGICAL],[hJ,hq.ISNA],[h0,hq.ISNONTEXT],[h1,hq.ISNUMBER],[h2,hq.ISODD],[h3,hq.ISREF],[h5,hq.ISTEXT],[h4,hq.N],[h6,hq.NA],[h9,hq.SHEET],[h7,hq.SHEETS],[h8,hq.TYPE]],mt=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=!0,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t&&!!e.getValue(),r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(t=t&&!!n.getValue(),r=!1)}return r?rR.create(q.VALUE):nA.create(t)}};B(mt,"And");let mr=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2),k(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,a=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),a=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return rR.create(q.VALUE);let n=r.isArray()?r.getRowCount():1,i=r.isArray()?r.getColumnCount():1;r=nF(n,i,r);let s=[[]];for(let e=0;e<i;e++){let i=[];for(let t=0;t<n;t++){let a=r.get(t,e);i.push([a])}let l=nD.create({calculateValueList:i,rowCount:n,columnCount:1,unitId:"",sheetId:"",row:0,column:0});if(a){let{startRow:t,startColumn:r}=a.getRangePosition(),i={startRow:t,startColumn:r+e,endRow:t+n-1,endColumn:r+e};l=this.createReferenceObject(a,i)}let u=t.execute(l);if(u.isArray()){let e=u.getRowCount(),t=u.getColumnCount();if(e>1||t>1)return rR.create(q.CALC);u=u.get(0,0)}u.isNull()&&(u=nR.create(0)),s[0].push(u)}return 1===i?s[0][0]:nD.create({calculateValueList:s,rowCount:1,columnCount:i,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mr,"Bycol");let ma=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2),k(this,"needsReferenceObject",!0)}calculate(e,t){let r=e,a=null;if(e.isReferenceObject()&&(r=e.toArrayValueObject(),a=e),r.isError())return r;if(t.isError())return t;if(!(t.isValueObject()&&t.isLambda()&&1===t.getLambdaPrivacyVarKeys().length))return rR.create(q.VALUE);let n=r.isArray()?r.getRowCount():1,i=r.isArray()?r.getColumnCount():1;r=nF(n,i,r);let s=[];for(let e=0;e<n;e++){let n=[[]];for(let t=0;t<i;t++){let a=r.get(e,t);n[0].push(a)}let l=nD.create({calculateValueList:n,rowCount:1,columnCount:i,unitId:"",sheetId:"",row:0,column:0});if(a){let{startRow:t,startColumn:r}=a.getRangePosition(),n={startRow:t+e,startColumn:r,endRow:t+e,endColumn:r+i-1};l=this.createReferenceObject(a,n)}let u=t.execute(l);if(u.isArray()){let e=u.getRowCount(),t=u.getColumnCount();if(e>1||t>1)return rR.create(q.CALC);u=u.get(0,0)}u.isNull()&&(u=nR.create(0)),s.push([u])}return 1===n?s[0][0]:nD.create({calculateValueList:s,rowCount:n,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(ma,"Byrow");let mn=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){return nA.create(!1)}};B(mn,"False");var mi=((M=mi||{}).AND="AND",M.BYCOL="BYCOL",M.BYROW="BYROW",M.FALSE="FALSE",M.IF="IF",M.IFERROR="IFERROR",M.IFNA="IFNA",M.IFS="IFS",M.LAMBDA="LAMBDA",M.LET="LET",M.MAKEARRAY="MAKEARRAY",M.MAP="MAP",M.NOT="NOT",M.OR="OR",M.REDUCE="REDUCE",M.SCAN="SCAN",M.SWITCH="SWITCH",M.TRUE="TRUE",M.XOR="XOR",M);let ms=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r=nA.create(!1)){let a=this._getSingleValueObject(e);if(a.isError())return a;if(!a.isArray())return a.getValue()?t:r;let n=Math.max(a.isArray()?a.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),i=Math.max(a.isArray()?a.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),s=nF(n,i,a),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA));return s.map((e,t,r)=>{if(e.isNull())return rR.create(q.NA);{let a=l.get(t,r)||nE.create(),n=u.get(t,r)||nE.create();return this._calculateSingleCell(e,a,n)}})}_getSingleValueObject(e){return e.isArray()&&1===e.getRowCount()&&1===e.getColumnCount()?e.getFirstCell():e}_calculateSingleCell(e,t,r){return e.isNull()?rR.create(q.NA):e.getValue()?t.isNull()?rR.create(q.NA):t:r.isNull()?rR.create(q.NA):r}};B(ms,"If");let ml=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;if(!e.isArray())return e.isError()?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t);return n.iterator((e,t,r)=>{null!=e&&e.isError()&&n.set(t,r,i.get(t,r))}),n}};B(ml,"Iferror");let mu=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError()&&e.getErrorType()!==q.NA)return e;if(t.isError())return t;if(!e.isArray())return e.isError()&&e.getErrorType()===q.NA?t:e;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t);return n.iterator((e,t,r)=>{null!=e&&e.isError()&&e.getErrorType()===q.NA&&n.set(t,r,i.get(t,r))}),n}};B(mu,"Ifna");let mo=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255)}calculate(...e){if(e.length%2!=0)return rR.create(q.NA);for(let t=0;t<e.length;t++)if(e[t].isError())return e[t];let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),a=e.map(e=>nF(t,r,e,rR.create(q.NA))),n=a[0].map((e,t,r)=>{for(let e=0;e<a.length;e+=2){let n=a[e].get(t,r)||nE.create(),i=a[e+1].get(t,r)||nE.create();if(n.isNull())continue;if(n.isError())return n;let s=n.getValue();if(n.isString()){if("TRUE"===`${s}`.toLocaleUpperCase())return i;if("FALSE"===`${s}`.toLocaleUpperCase())continue;return rR.create(q.VALUE)}if(+s)return i.isNull()?rR.create(q.NA):i}return rR.create(q.NA)});return 1===t&&1===r?n.get(0,0):n}};B(mo,"Ifs");let mc=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){return rR.create(q.VALUE)}};B(mc,"Lambda");let mh=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",255)}calculate(...e){return rR.create(q.VALUE)}};B(mh,"Let");let mm=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(...e){let t=this.getIndexNumValue(e[0]);if("number"!=typeof t)return t;let r=this.getIndexNumValue(e[1]);if("number"!=typeof r)return r;if(!(e[2].isValueObject()&&e[2].isLambda()))return rR.create(q.VALUE);let a=e[2],n=[];for(let e=0;e<t;e++){null==n[e]&&(n[e]=[]);for(let t=0;t<r;t++){let r=a.execute(nR.create(e+1),nR.create(t+1));r.isArray()&&(r=r.get(0,0)),n[e][t]=r}}return new iB(n)}isAsync(){return!0}};B(mm,"Makearray");let mf=(B(d8=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255),k(this,"needsReferenceObject",!0)}calculate(...e){let t=[],r=null,a=0,n=0;for(let i=0;i<e.length;i++){let s=e[i],l=s;if(l.isReferenceObject()&&(l=s.toArrayValueObject()),l.isError())return l;if(i===e.length-1){if(!(s.isValueObject()&&s.isLambda()))return rR.create(q.VALUE);r=s}else t.push(s),a=Math.max(a,l.isArray()?l.getRowCount():1),n=Math.max(n,l.isArray()?l.getColumnCount():1)}let i=this._getResultArray(t,r,a,n);return i instanceof rR?i:1===a&&1===n?i[0][0]:nD.create({calculateValueList:i,rowCount:a,columnCount:n,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArray(e,t,r,a){let n=[];for(let i=0;i<r;i++){let r=[];for(let n=0;n<a;n++){let a=[],s=!1;for(let t=0;t<e.length;t++){let l=e[t],u=null;if(l.isReferenceObject()&&(u=l,l=l.toArrayValueObject()),!l.isArray()){if(0===i&&0===n){a.push(u||l);continue}r.push(rR.create(q.NA)),s=!0;break}let o=l.get(i,n);if(!o){r.push(rR.create(q.NA)),s=!0;break}if(u){let{startRow:e,startColumn:t}=u.getRangePosition(),r={startRow:e+i,startColumn:t+n,endRow:e+i,endColumn:t+n};o=this.createReferenceObject(u,r)}a.push(o)}if(s||0===a.length)continue;let l=t.execute(...a);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return rR.create(q.CALC);l=l.get(0,0)}l.isNull()&&(l=nR.create(0)),r.push(l)}n.push(r)}return n}},"Map"),d8),mg=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let t=+e.getValue();return Number.isNaN(t)?rR.create(q.VALUE):nA.create(!t)}};B(mg,"Not");let md=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=!1,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(t=t||!!e.getValue(),r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(t=t||!!n.getValue(),r=!1)}return r?new rR(q.VALUE):new nA(t)}};B(md,"Or");let mN=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a,n,i,s;return e.isReferenceObject()?(a=e.toArrayValueObject(),n=e):(a=e,n=null),t.isReferenceObject()?(i=t.toArrayValueObject(),s=t):(i=t,s=null),a.isArray()?a.mapValue(e=>this._handleSingleValueObject(e,i,r,n,s)):this._handleSingleValueObject(a,i,r,n,s)}_handleSingleValueObject(e,t,r,a,n){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return rR.create(q.VALUE);let i=t.isArray()?t.getRowCount():1,s=t.isArray()?t.getColumnCount():1,l=e;a&&(l=a);for(let e=0;e<i;e++)for(let a=0;a<s;a++){let i=t.isArray()?t.get(e,a):t;if(i.isError())return i;if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),s={startRow:t+e,startColumn:r+a,endRow:t+e,endColumn:r+a};i=this.createReferenceObject(n,s)}let s=r.execute(l,i);if(s.isError())return s;s.isNull()&&(s=nR.create(0)),l=s}return l.isReferenceObject()?l.toArrayValueObject():l}};B(mN,"Reduce");let m_=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e,n=null;e.isReferenceObject()&&(a=e.toArrayValueObject(),n=e);let i=t,s=null;if(t.isReferenceObject()&&(i=t.toArrayValueObject(),s=t),a.isError())return a;if(i.isError())return i;if(r.isError())return r;if(!(r.isValueObject()&&r.isLambda()&&2===r.getLambdaPrivacyVarKeys().length))return rR.create(q.VALUE);if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.CALC);a=a.get(0,0)}return this._getResult(a,i,r,n,s)}_getResult(e,t,r,a,n){let i=[],s=t.isArray()?t.getRowCount():1,l=t.isArray()?t.getColumnCount():1,u=e;a&&(u=a);for(let e=0;e<s;e++){let a=[];for(let i=0;i<l;i++){if(u.isError()){a.push(u);continue}let s=t.isArray()?t.get(e,i):t;if(s.isError()){u=s,a.push(s);continue}if(n){let{startRow:t,startColumn:r}=n.getRangePosition(),a={startRow:t+e,startColumn:r+i,endRow:t+e,endColumn:r+i};s=this.createReferenceObject(n,a)}let l=r.execute(u,s);if(l.isArray()){let e=l.getRowCount(),t=l.getColumnCount();if(e>1||t>1)return rR.create(q.CALC);l=l.get(0,0)}l.isNull()&&(l=nR.create(0)),u=l,a.push(l)}i.push(a)}return 1===s&&1===l?i[0][0]:nD.create({calculateValueList:i,rowCount:s,columnCount:l,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(m_,"Scan");let mC=class extends lm{constructor(){super(...arguments),k(this,"minParams",3)}calculate(e,...t){if(e.isError())return e;let r=t.length%2!=0,a=r?t[t.length-1]:nE.create();return e.isArray()||t.some(e=>e.isArray())?this._handleArrayInputs(e,t,a,r):this._handleNonArrayInputs(e,t,a,r)}_handleNonArrayInputs(e,t,r,a){for(let r=0;r<t.length-(a?1:0);r+=2){let a=t[r],n=t[r+1];if(!a.isNull()){if(a.isError())return a;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return n.isNull()?rR.create(q.NA):n}}return r.isNull()?rR.create(q.NA):r}_handleArrayInputs(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,...t.map(e=>e.isArray()?e.getRowCount():1),r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,...t.map(e=>e.isArray()?e.getColumnCount():1),r.isArray()?r.getColumnCount():1),s=nF(n,i,e),l=t.map(e=>nF(n,i,e,rR.create(q.NA))),u=nF(n,i,r,rR.create(q.NA));return s.map((e,t,r)=>{for(let n=0;n<l.length-(a?1:0);n+=2){let a=l[n].get(t,r)||nE.create(),i=l[n+1].get(t,r)||nE.create();if(!a.isNull()){if(a.isError()||e.isError())return a.isError()?a:e;if(`${e.getValue()}`.toLocaleLowerCase()===`${a.getValue()}`.toLocaleLowerCase())return i.isNull()?rR.create(q.NA):i}}let n=u.get(t,r)||nE.create();return n.isNull()?rR.create(q.NA):n})}};B(mC,"Switch");let mE=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){return nA.create(!0)}};B(mE,"True");let mp=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=0,r=!0,a=null;for(let n of e){if(n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null!=e&&e.isError())return a=e,!1;(null!=e&&e.isBoolean()||null!=e&&e.isNumber())&&(e.getValue()&&t++,r=!1)}),a)return a}else(n.isBoolean()||n.isNumber())&&(n.getValue()&&t++,r=!1)}return r?rR.create(q.VALUE):nA.create(t%2==1)}};B(mp,"Xor");let mA=[[mt,mi.AND],[mr,mi.BYCOL],[ma,mi.BYROW],[mn,mi.FALSE],[ms,mi.IF],[ml,mi.IFERROR],[mu,mi.IFNA],[mo,mi.IFS],[mc,mi.LAMBDA],[mh,mi.LET],[mm,mi.MAKEARRAY],[mf,mi.MAP],[mg,mi.NOT],[md,mi.OR],[mN,mi.REDUCE],[m_,mi.SCAN],[mC,mi.SWITCH],[mE,mi.TRUE],[mp,mi.XOR]],mb=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",5)}calculate(e,t,r,a,n){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;let i=null!=r?r:nR.create(1),s=null!=a?a:nA.create(!0),l=null!=n?n:nT.create(""),u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,e,rR.create(q.NA)),h=nF(u,o,t,rR.create(q.NA)),m=nF(u,o,i,rR.create(q.NA)),f=nF(u,o,s,rR.create(q.NA)),g=nF(u,o,l,rR.create(q.NA));return c.map((e,t,r)=>{let a=h.get(t,r)||rR.create(q.NA),n=m.get(t,r)||rR.create(q.NA),i=f.get(t,r)||rR.create(q.NA),s=g.get(t,r)||rR.create(q.NA);return e.isError()?e:a.isError()?a:n.isError()?n:i.isError()?i:s.isError()?s:this._calculateSingleCell(e,a,n,i,s)})}_calculateSingleCell(e,t,r,a,n){let i=Number.parseInt(`${Number(e.getValue())-1}`),s=Number.parseInt(`${Number(t.getValue())-1}`),l=Number.parseInt(`${Number(r.getValue())}`);if(Number.isNaN(i)||Number.isNaN(s)||Number.isNaN(l)||l<1||l>4)return rR.create(q.VALUE);let u=my(l),o=this.getZeroOrOneByOneDefault(a),c=`${n.getValue()}`,h=e3(c)?`'${c}'`:c,m={startRow:i,startColumn:s,endRow:i,endColumn:s,startAbsoluteRefType:u,endAbsoluteRefType:u},f=a&&!o?lu(m):eG(m);return nT.create(""!==h?`${h}!${f}`:f)}};function my(e){switch(e){case 1:default:return P.AbsoluteRefType.ALL;case 2:return P.AbsoluteRefType.ROW;case 3:return P.AbsoluteRefType.COLUMN;case 4:return P.AbsoluteRefType.NONE}}B(mb,"Address"),B(my,"transformAbsoluteRefType");let mR=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1),k(this,"needsReferenceObject",!0)}calculate(e){return e.isReferenceObject()?nR.create(1):rR.create(q.VALUE)}};B(mR,"Areas");let mS=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255),k(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,...t){let r=e;if(r.isError())return r;if(r.isReferenceObject()&&(r=r.toArrayValueObject()),!r.isArray()){let e=r.convertToNumberObjectValue();return e.isError()?e:t[Math.trunc(+e.getValue())-1]||rR.create(q.VALUE)}let a=r.isArray()?r.getRowCount():1,n=r.isArray()?r.getColumnCount():1;t.forEach((e,t)=>{e.isArray()?(a=Math.max(a,e.getRowCount()),n=Math.max(n,e.getColumnCount())):(a=Math.max(a,1),n=Math.max(n,1))});let i=nF(a,n,r,rR.create(q.NA)),s=t.map(e=>{let t=e;return t.isReferenceObject()&&(t=t.toArrayValueObject()),nF(a,n,t,rR.create(q.NA))});return i.map((e,t,r)=>{if(e.isError())return e;let a=e.convertToNumberObjectValue();if(a.isError())return a;let n=s[Math.trunc(+a.getValue())-1],i=(null==n?void 0:n.get(t,r))||rR.create(q.VALUE);return null!=i&&i.isNull()&&(i=nR.create(0)),i})}};B(mS,"Choose");let mO=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=[];for(let i=0;i<t.length;i++){let s=t[i];if(s.isArray()){let e=s.getRowCount(),t=s.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);s=s.get(0,0)}if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let l=Math.trunc(+s.getValue());if(0===l||Math.abs(l)>a)return rR.create(q.VALUE);let u=e;a>1&&(u=l<0?e.slice(void 0,[l+a,l+1+a]):e.slice(void 0,[l-1,l]));for(let t=0;t<r;t++)n[t]||(n[t]=[]),e.isArray()?n[t].push(u.get(t,0)):n[t].push(e)}return nD.create({calculateValueList:n,rowCount:n.length,columnCount:n[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mO,"Choosecols");let mT=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=e.isArray()?e.getRowCount():1,a=[];for(let n=0;n<t.length;n++){let i=t[n];if(i.isArray()){let e=i.getRowCount(),t=i.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);i=i.get(0,0)}if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=Math.trunc(+i.getValue());if(0===s||Math.abs(s)>r)return rR.create(q.VALUE);let l=e;r>1&&(l=s<0?e.slice([s+r,s+1+r]):e.slice([s-1,s])),e.isArray()?a.push(l.getArrayValue()[0]):a.push([e])}return nD.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mT,"Chooserows");let mV=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",1)}calculate(e){if(null==e)return nR.create(this.column+1);if(e.isError())return e;if(!e.isArray())return rR.create(q.NA);let t=e.getCurrentColumn(),r=e.getColumnCount(),a=[];for(let e=0;e<r;e++)a.push(nR.create(t+e+1));let n={calculateValueList:[a],rowCount:1,columnCount:r,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(n)}};B(mV,"Column");let mI=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nR.create(1);if(!e.isArray())return rR.create(q.NA);let t=e.getColumnCount();return nR.create(t)}};B(mI,"Columns");let mM=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:nR.create(0),n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nF(s,l,t,rR.create(q.NA)),o=nF(s,l,a,rR.create(q.NA));if(s>1||l>1)return u.mapValue((t,r,a)=>{let s=o.get(r,a);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let{isError:l,errorObject:u}=this._checkRowsColumns(t,s,n,i);return l?u:e.isArray()?rR.create(q.VALUE):e});if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let c=t.isArray()?t.get(0,0):t,h=a.isArray()?a.get(0,0):a,{isError:m,errorObject:f,rowsValue:g,columnsValue:d}=this._checkRowsColumns(c,h,n,i);return m?f:this._getResultArray(e,g,d,n,i)}_checkRowsColumns(e,t,r,a){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let n=Math.trunc(+e.getValue()),i=Math.trunc(+t.getValue());return Number.isNaN(n)||Number.isNaN(i)?{isError:!0,errorObject:rR.create(q.VALUE)}:Math.abs(n)>=r||Math.abs(i)>=a?{isError:!0,errorObject:rR.create(q.CALC)}:{isError:!1,rowsValue:n,columnsValue:i}}_getResultArray(e,t,r,a,n){let i;let s=t>=0?[t,a]:[0,a+t],l=r>=0?[r,n]:[0,n+r];return i=(i=0===t&&0===r?e:0===t?e.slice(void 0,l):0===r?e.slice(s,void 0):e.slice(s,l)).map(e=>e.isNull()?nR.create(0):e),a-t==1&&n-r==1?i.get(0,0):i}};B(mM,"Drop");let mx=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",4)}calculate(e,t,r,a){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t,l=null!=r?r:nR.create(i),u=null!=a?a:rR.create(q.NA);t.isNull()&&(s=nR.create(n)),l.isNull()&&(l=nR.create(i));let o=Math.max(s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),c=Math.max(s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),h=nF(o,c,s,rR.create(q.NA)),m=nF(o,c,l,rR.create(q.NA));if(o>1||c>1)return h.mapValue((t,r,a)=>{let s=m.get(r,a);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let{isError:l,errorObject:o}=this._checkRowsColumnsPadWith(t,s,u,n,i);return l?o:e.isArray()?e.get(0,0):e});if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let f=s.isArray()?s.get(0,0):s,g=l.isArray()?l.get(0,0):l,{isError:d,errorObject:N,rowsValue:_,columnsValue:C,padWithObject:E}=this._checkRowsColumnsPadWith(f,g,u,n,i);return d?N:this._getResultArray(e,_,C,E,n,i)}_checkRowsColumnsPadWith(e,t,r,a,n){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let i=Math.trunc(+e.getValue()),s=Math.trunc(+t.getValue());if(Number.isNaN(i)||Number.isNaN(s)||Math.abs(i)<a||Math.abs(s)<n)return{isError:!0,errorObject:rR.create(q.VALUE)};let l=r;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return{isError:!0,errorObject:rR.create(q.VALUE)};l=r.get(0,0)}return{isError:!1,rowsValue:i,columnsValue:s,padWithObject:l}}_getResultArray(e,t,r,a,n,i){let s=[];s=e.isArray()?e.map(e=>e.isNull()?nR.create(0):e).getArrayValue():[[e]];let l=Math.max(0,t-n),u=Math.max(0,r-i);for(let e=0;e<l;e++)s.push(Array(i).fill(a));for(let e=0;e<u;e++)s.forEach(e=>{e.push(a)});return 1===t&&1===r?s[0][0]:nD.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mx,"Expand");let mv=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:rR.create(q.CALC);if(e.isError())return e;if(t.isError())return t;let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t.isArray()?t.getRowCount():1,l=t.isArray()?t.getColumnCount():1;return s>1&&l>1||1===s&&l!==i||1===l&&s!==n?rR.create(q.VALUE):1===n&&1===i?this._getResultArrayByR1C1(e,t,a):1===s?l!==i?rR.create(q.VALUE):this._getResultArrayByR1(n,i,e,t,a):1===l?s!==n?rR.create(q.VALUE):this._getResultArrayByC1(n,i,e,t,a):a}_getResultArrayByR1C1(e,t,r){let a=e,n=t;return a.isArray()&&(a=a.get(0,0)),n.isArray()&&(n=n.get(0,0)),n.isString()&&(n=n.convertToNumberObjectValue()),n.isError()?n:+n.getValue()?a:r}_getResultArrayByR1(e,t,r,a,n){let i=[];for(let n=0;n<t;n++){let t=a.get(0,n);if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;if(+t.getValue())for(let t=0;t<e;t++){i[t]||(i[t]=[]);let e=r.get(t,n);i[t].push(e)}}return 0===i.length?n:nD.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getResultArrayByC1(e,t,r,a,n){let i=[];for(let n=0;n<e;n++){let e=a.get(n,0);if(e.isString()&&(e=e.convertToNumberObjectValue()),e.isError())return e;if(!+e.getValue())continue;let s=[];for(let e=0;e<t;e++){let t=r.get(n,e);s.push(t)}i.push(s)}return 0===i.length?n:nD.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mv,"Filter");var mU=((x=mU||{}).ADDRESS="ADDRESS",x.AREAS="AREAS",x.CHOOSE="CHOOSE",x.CHOOSECOLS="CHOOSECOLS",x.CHOOSEROWS="CHOOSEROWS",x.COLUMN="COLUMN",x.COLUMNS="COLUMNS",x.DROP="DROP",x.EXPAND="EXPAND",x.FILTER="FILTER",x.FORMULATEXT="FORMULATEXT",x.GETPIVOTDATA="GETPIVOTDATA",x.HLOOKUP="HLOOKUP",x.HSTACK="HSTACK",x.HYPERLINK="HYPERLINK",x.IMAGE="IMAGE",x.INDEX="INDEX",x.INDIRECT="INDIRECT",x.LOOKUP="LOOKUP",x.MATCH="MATCH",x.OFFSET="OFFSET",x.ROW="ROW",x.ROWS="ROWS",x.RTD="RTD",x.SORT="SORT",x.SORTBY="SORTBY",x.TAKE="TAKE",x.TOCOL="TOCOL",x.TOROW="TOROW",x.TRANSPOSE="TRANSPOSE",x.UNIQUE="UNIQUE",x.VLOOKUP="VLOOKUP",x.VSTACK="VSTACK",x.WRAPCOLS="WRAPCOLS",x.WRAPROWS="WRAPROWS",x.XLOOKUP="XLOOKUP",x.XMATCH="XMATCH",x);let mD=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return rR.create(q.REF);if(!t.isArray()||r.isError()||null!=a&&a.isError())return rR.create(q.NA);let n=this.getZeroOrOneByOneDefault(a);if(null==n)return rR.create(q.VALUE);let i=this.getIndexNumValue(r);if(i instanceof rR)return i;let s=t.slice([0,1]),l=t.slice([i-1,i]);return null==s||null==l?rR.create(q.REF):e.isArray()?e.map(e=>this._handleSingleObject(e,s,l,n)):this._handleSingleObject(e,s,l,n)}_handleSingleObject(e,t,r,a){return 0===a?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}};B(mD,"Hlookup");let mP=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getRowCount():1)),r=[];for(let a=0;a<e.length;a++){let n=e[a];if(n.isError())return n;let i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<t;e++){r[e]||(r[e]=[]);for(let t=0;t<s;t++){let a=n;n.isArray()&&(a=n.get(e,t)),e>i-1||!a?r[e].push(rR.create(q.NA)):r[e].push(a)}}}return nD.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mP,"Hstack");let mL=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",4),k(this,"needsReferenceObject",!0)}calculate(e,t,r,a){let n,i;if(e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;let s=0,l=0;if(e.isValueObject())s=1,l=1;else{if(!e.isReferenceObject())return rR.create(q.VALUE);let{startRow:t,endRow:r,startColumn:a,endColumn:n}=e.getRangePosition();s=r-t+1,l=n-a+1}1===s&&l>1&&null==r?(i=null!=t?t:nR.create(0),n=nR.create(0)):(n=null!=t?t:nR.create(0),i=null!=r?r:nR.create(0));let u=null!=a?a:nR.create(1);n.isReferenceObject()&&(n=n.toArrayValueObject()),i.isReferenceObject()&&(i=i.toArrayValueObject()),u.isReferenceObject()&&(u=u.toArrayValueObject());let o=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,u.isArray()?u.getRowCount():1),c=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,u.isArray()?u.getColumnCount():1);if(1===o&&1===c)return this._calculateSingleCell(e,n,i,u);{let t=nF(o,c,n,rR.create(q.NA)),r=nF(o,c,i,rR.create(q.NA)),a=nF(o,c,u,rR.create(q.NA));return t.map((t,n,i)=>{let s=r.get(n,i)||nE.create(),l=a.get(n,i)||nE.create(),u=this._calculateSingleCell(e,t,s,l);return u.isReferenceObject()?u.toArrayValueObject().getFirstCell():u})}}_calculateSingleCell(e,t,r,a){if(t.isError())return t;let n=this._getNumberValue(t);if(void 0===n||n<0)return rR.create(q.VALUE);if(r.isError())return r;let i=this._getNumberValue(r);if(void 0===i||i<0)return rR.create(q.VALUE);if(a.isError())return a;let s=this._getAreaNumberValue(a);return void 0===s||s<1?rR.create(q.VALUE):e.isReferenceObject()?this._getReferenceObject(e,n,i,s):e.isValueObject()&&1===n&&1===i?e:rR.create(q.REF)}_getNumberValue(e){if(null==e)return 0;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getAreaNumberValue(e){if(null==e)return 1;let t=0;if(e.isBoolean())!0===e.getValue()&&(t=1);else{if(e.isString())return;e.isNumber()?t=Math.floor(e.getValue()):e.isNull()&&(t=0)}return t}_getReferenceObject(e,t,r,a){let{startRow:n,endRow:i,startColumn:s,endColumn:l}=e.getRangePosition(),u=0,o=0,c=0,h=0;if(0===t?(u=n,o=i):u=o=n+t-1,0===r?(c=s,h=l):c=h=s+r-1,u>i||c>l)return rR.create(q.REF);let m={startRow:u,startColumn:c,endRow:o,endColumn:h};return this.createReferenceObject(e,m)}};B(mL,"Index");let mw=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}isAddress(){return!0}calculate(e,t){if(e.isError())return e;if(null!=t&&t.isError())return t;let r=this.getZeroOrOneByOneDefault(t);null==r&&(r=1);let a=e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();if(t>1||r>1)return e.map(()=>rR.create(q.VALUE));a=e.getFirstCell()}return this._handleSingleObject(a,r)}_handleSingleObject(e,t){let r=`${e.getValue()}`;if(""===r.trim())return rR.create(q.REF);let a=this._convertToDefinedName(r);if(0===t){let{range:e,sheetName:t,unitId:r}=ll(a),n=new st(e);return n.setForcedUnitIdDirect(r),n.setForcedSheetName(t),this._setDefault(n)}if(eM(a))return this._setDefault(new sr(a));if(ev(a))return this._setDefault(new sn(a));if(eU(a))return this._setDefault(new sa(a));let{range:n,sheetName:i,unitId:s}=tS(a);if(Number.isNaN(n.startRow)||n.endRow+1>1048576||Number.isNaN(n.startColumn)||n.endColumn+1>16384)return rR.create(q.REF);let l=new st(n);return l.setForcedUnitIdDirect(s),l.setForcedSheetName(i),this._setDefault(l)}_setDefault(e){return null==this.unitId||null==this.subUnitId?rR.create(q.REF):(e.setDefaultUnitId(this.unitId),e.setDefaultSheetId(this.subUnitId),e)}_convertToDefinedName(e){let t=this.getDefinedName(e);if(null==t)return e;let r=t.formulaOrRefString;return null==r?e:r.startsWith(K.EQUALS)?r.slice(1):r}};B(mw,"Indirect");let mF=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsExpandParams",!0)}calculate(e,t,r){return e.isError()?e:t.isError()?rR.create(q.REF):t.isArray()?null!=r&&r.isError()?r:1===t.getColumnCount()||1===t.getRowCount()?null==r||r.isArray()?this._handleVector(e,t,r):rR.create(q.REF):this._handleArray(e,t):rR.create(q.VALUE)}_handleVector(e,t,r){let a=r;if(null==a)a=t;else if(a.getRowCount()!==t.getRowCount()||a.getColumnCount()!==t.getColumnCount())return rR.create(q.REF);return e.isArray()?e.map(e=>this.binarySearch(e,t,a)):this.binarySearch(e,t,a)}_handleArray(e,t){let r,a;let n=t.getRowCount(),i=t.getColumnCount();return i>n?(r=t.slice([0,1]),a=t.slice([n-1,n])):(r=t.slice(void 0,[0,1]),a=t.slice(void 0,[i-1,i])),null==r||null==a?rR.create(q.VALUE):e.isArray()?e.map(e=>this.binarySearch(e,r,a)):this.binarySearch(e,r,a)}};B(mF,"Lookup");let mj=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return rR.create(q.REF);if(!t.isArray())return rR.create(q.VALUE);let a=t.getRowCount(),n=t.getColumnCount();if(1!==a&&1!==n||null!=r&&r.isError())return rR.create(q.NA);let i=this.getMatchTypeValue(r);return null==i?rR.create(q.VALUE):e.isArray()?e.map(e=>this._handleSingleObject(e,t,i)):this._handleSingleObject(e,t,i)}_handleSingleObject(e,t,r){let a=this._getSearchModeValue(r),n=t.orderSearch(e,a);if(null==n)return rR.create(q.NA);if(n instanceof rR)return n;let i=1===t.getRowCount()?n.column+1:n.row+1;return nR.create(i)}_getSearchModeValue(e){switch(e){case 1:return rT.MIN;case 0:return rT.NORMAL;case -1:return rT.MAX}}};B(mj,"Match");let mB=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",5),k(this,"needsReferenceObject",!0)}isAddress(){return!0}calculate(e,t,r,a,n){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;if(!e.isReferenceObject())return rR.create(q.VALUE);let i=e.getRowCount(),s=e.getColumnCount(),l=t;l.isReferenceObject()&&(l=l.toArrayValueObject());let u=r;u.isReferenceObject()&&(u=u.toArrayValueObject());let o=null!=a?a:nR.create(i);o.isReferenceObject()&&(o=o.toArrayValueObject()),o.isNull()&&(o=nR.create(i));let c=null!=n?n:nR.create(s);c.isReferenceObject()&&(c=c.toArrayValueObject()),c.isNull()&&(c=nR.create(s));let h=Math.max(l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1);if(1===h&&1===m)return l=l.isArray()?l.get(0,0):l,u=u.isArray()?u.get(0,0):u,o=o.isArray()?o.get(0,0):o,c=c.isArray()?c.get(0,0):c,this._handleSingleObject(e,l,u,o,c);let f=nF(h,m,l,rR.create(q.NA)),g=nF(h,m,u,rR.create(q.NA)),d=nF(h,m,o,rR.create(q.NA)),N=nF(h,m,c,rR.create(q.NA));return f.mapValue((t,r,a)=>{let n=g.get(r,a),i=d.get(r,a),s=N.get(r,a);return t.isError()?t:n.isError()?n:i.isError()?i:s.isError()?s:this._handleSingleObject(e,t,n,i,s,!0)})}_handleSingleObject(e,t,r,a,n,i=!1){let{startRow:s,startColumn:l}=e.getRangePosition(),u=t;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return u;let o=r;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;let c=+u.getValue(),h=+o.getValue();if("number"!=typeof c||"number"!=typeof h)return rR.create(q.VALUE);let m=s+c,f=l+h;if(m<0||f<0)return rR.create(q.REF);let g=this.getIndexNumValue(a),d=this.getIndexNumValue(n);if("number"!=typeof g||"number"!=typeof d)return rR.create(q.VALUE);if(0===g||0===d)return rR.create(q.REF);let N=g>0?m+g-1:m+g+1,_=d>0?f+d-1:f+d+1;return N<0||_<0?rR.create(q.REF):i?rR.create(q.VALUE):this.createReferenceObject(e,{startRow:m<N?m:N,startColumn:f<_?f:_,endRow:m>N?m:N,endColumn:f>_?f:_})}};B(mB,"Offset");let mk=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",1)}calculate(e){if(null==e)return nR.create(this.row+1);if(e.isError())return e;if(!e.isArray())return rR.create(q.NA);let t=e.getCurrentRow(),r=e.getRowCount(),a=[];for(let e=0;e<r;e++)a.push([nR.create(t+e+1)]);let n={calculateValueList:a,rowCount:r,columnCount:1,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(n)}};B(mk,"Row");let m$=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isString()||e.isNumber()||e.isBoolean())return nR.create(1);if(!e.isArray())return rR.create(q.NA);let t=e.getRowCount();return nR.create(t)}};B(m$,"Rows");let mY=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",4)}calculate(e,t,r,a){let n=null!=t?t:nR.create(1),i=null!=r?r:nR.create(1),s=null!=a?a:nA.create(!1);if(s.isArray()){let t=s.getRowCount(),r=s.getColumnCount();if(1===t&&1===r){let t=s.get(0,0);return this._handleSingleObject(e,n,i,t)}return s.map(t=>{let r=this._handleSingleObject(e,n,i,t);return r.isArray()?r.get(0,0):r})}return this._handleSingleObject(e,n,i,s)}_handleSingleObject(e,t,r,a){if(e.isError())return e;let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=this._checkArrayError(t);if(s.isError())return s;let l=Math.floor(+s.getValue());if(l<1)return rR.create(q.VALUE);let u=this._checkArrayError(r);if(u.isError())return u;let o=Math.floor(+u.getValue());if(-1!==o&&1!==o)return rR.create(q.VALUE);let c=a;if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError())return c;if(!e.isArray()||1===n&&1===i)return e;let h=+c.getValue();return this._getResult(e,l,o,h,n,i)}_checkArrayError(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return rR.create(q.VALUE);t=t.get(0,0)}return t.isString()&&(t=t.convertToNumberObjectValue()),t}_getResult(e,t,r,a,n,i){if(a){if(t>n)return rR.create(q.VALUE);let a=e.transpose().getArrayValue();return a.sort(this._sort(t-1,r)),nD.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}).transpose()}{if(t>i)return rR.create(q.VALUE);let a=e.getArrayValue();return a.sort(this._sort(t-1,r)),nD.create({calculateValueList:a,rowCount:a.length,columnCount:a[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}}_sort(e,t=1){let r=rV();return 1===t?this._sortAsc(e,r):this._sortDesc(e,r)}_sortAsc(e,t){return(r,a)=>{let n=r[e],i=a[e];if(null==n||n.isNull())return 1;if(null==i||i.isNull())return -1;if(n.isError()&&i.isError())return 0;if(n.isError())return 1;if(i.isError())return -1;let s=n.getValue(),l=i.getValue();return n.isBoolean()&&!0===s?1:i.isBoolean()&&!0===l?-1:n.isBoolean()&&!1===s?1:i.isBoolean()&&!1===l?-1:n.isNumber()&&i.isNumber()?+s-+l:t(s,l)}}_sortDesc(e,t){return(r,a)=>{let n=r[e],i=a[e];if(null==n||n.isNull())return 1;if(null==i||i.isNull())return -1;if(n.isError()&&i.isError())return 0;if(n.isError())return -1;if(i.isError())return 1;let s=n.getValue(),l=i.getValue();return n.isBoolean()&&!0===s?-1:i.isBoolean()&&!0===l?1:n.isBoolean()&&!1===s?-1:i.isBoolean()&&!1===l?1:n.isNumber()&&i.isNumber()?+l-+s:t(l,s)}}};B(mY,"Sort");let mH=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255)}calculate(e,...t){1===t.length&&t.push(nR.create(1));let r=this._getVariantsError(e,...t),{maxRowLength:a,maxColumnLength:n}=nq(t);if(r.isError()){let e=nF(a,n,r);return 1===a&&1===n?e.get(0,0):e}let i=t.map((e,t)=>t%2==0?e:nF(a,n,e,rR.create(q.NA))),s=this._getResultArray(e,i,a,n);return 1===a&&1===n?s[0][0]:nD.create({calculateValueList:s,rowCount:s.length,columnCount:s[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}_getVariantsError(e,...t){if(e.isError())return e;for(let e=0;e<t.length;e++){let r=t[e];if(r.isError())return r}if(t.length<2||t.length%2!=0)return rR.create(q.VALUE);let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t[0].isArray()?t[0].getRowCount():1,i=t[0].isArray()?t[0].getColumnCount():1;if((n>1||i>1)&&(n>1&&i>1||1===n&&i!==a||1===i&&n!==r))return rR.create(q.VALUE);for(let e=2;e<t.length;e++){if(e%2==1)continue;let r=t[e].isArray()?t[e].getRowCount():1,a=t[e].isArray()?t[e].getColumnCount():1;if(r!==n||a!==i)return rR.create(q.VALUE)}return nA.create(!0)}_getResultArray(e,t,r,a){let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=t[0].isArray()?t[0].getRowCount():1,l=t[0].isArray()?t[0].getColumnCount():1,u=[];for(let o=0;o<r;o++){u[o]=[];for(let c=0;c<a;c++){let{isError:h,errorObject:m,byArrays:f,sortOrders:g}=this._getByArraysAndSortOrders(t,o,c,l);if(h){u[o].push(m);continue}if(!e.isArray()||1===n&&1===i){u[o].push(e);continue}let d=e.getArrayValue();1===s&&1===l||(1===s?(d=d.concat(f),(d=this._transposeArray(d)).sort(this._sort(n,g)),d=this._transposeArray(d).slice(0,n)):1===l&&(d=(d=this._transposeArray(d)).concat(f),(d=this._transposeArray(d)).sort(this._sort(i,g)),d=d.map(e=>e.slice(0,i))));let N=nD.create({calculateValueList:d,rowCount:d.length,columnCount:d[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column});if(r>1||a>1){u[o].push(N.get(0,0));continue}u[o].push(N)}}return u}_getByArraysAndSortOrders(e,t,r,a){let n=[],i=[],s=!1,l=null;for(let u=0;u<e.length;u++){if(u%2==1)continue;let o=e[u],c=e[u+1].get(t,r);if(c.isString()&&(c=c.convertToNumberObjectValue()),c.isError()){s=!0,l=c;break}let h=Math.floor(+c.getValue());if(-1!==h&&1!==h){s=!0,l=rR.create(q.VALUE);break}if(i.push(h),o.isArray()){let e=o.getArrayValue();1===a&&(e=this._transposeArray(e)),n.push(e[0])}else n.push([o])}return{isError:s,errorObject:l,byArrays:n,sortOrders:i}}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}_sort(e,t){let r=rV();return(a,n)=>{let i=a[e],s=n[e],l=this._compare(i,s,t[0],r);if(0===l&&t.length>1)for(let u=1;u<t.length&&(i=a[e+u],s=n[e+u],0===(l=this._compare(i,s,t[u],r)));u++);return l}}_compare(e,t,r,a){return 1===r?this._asc(e,t,a):this._desc(e,t,a)}_asc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return 1;if(t.isError())return -1;let a=e.getValue(),n=t.getValue();return e.isBoolean()&&!0===a?1:t.isBoolean()&&!0===n?-1:e.isBoolean()&&!1===a?1:t.isBoolean()&&!1===n?-1:e.isNumber()&&t.isNumber()?+a-+n:r(a,n)}_desc(e,t,r){if(null==e||e.isNull())return 1;if(null==t||t.isNull())return -1;if(e.isError()&&t.isError())return 0;if(e.isError())return -1;if(t.isError())return 1;let a=e.getValue(),n=t.getValue();return e.isBoolean()&&!0===a?-1:t.isBoolean()&&!0===n?1:e.isBoolean()&&!1===a?-1:t.isBoolean()&&!1===n?1:e.isNumber()&&t.isNumber()?+n-+a:r(n,a)}};B(mH,"Sortby");let mG=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=t,s=null!=r?r:nR.create(n);t.isNull()&&(i=nR.create(a)),s.isNull()&&(s=nR.create(n));let l=Math.max(i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1),u=Math.max(i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1),o=nF(l,u,i,rR.create(q.NA)),c=nF(l,u,s,rR.create(q.NA));if(l>1||u>1)return o.mapValue((t,r,i)=>{let s=c.get(r,i);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let{isError:l,errorObject:u}=this._checkRowsColumns(t,s,a,n);return l?u:e.isArray()?rR.create(q.VALUE):e});if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let h=i.isArray()?i.get(0,0):i,m=s.isArray()?s.get(0,0):s,{isError:f,errorObject:g,rowsValue:d,columnsValue:N}=this._checkRowsColumns(h,m,a,n);return f?g:this._getResultArray(e,d,N,a,n)}_checkRowsColumns(e,t,r,a){if(e.isError())return{isError:!0,errorObject:e};if(t.isError())return{isError:!0,errorObject:t};let n=Math.trunc(+e.getValue()),i=Math.trunc(+t.getValue());return Number.isNaN(n)||Number.isNaN(i)?{isError:!0,errorObject:rR.create(q.VALUE)}:0===Math.abs(n)||0===Math.abs(i)?{isError:!0,errorObject:rR.create(q.CALC)}:(n>r&&(n=r),i>a&&(i=a),{isError:!1,rowsValue:n,columnsValue:i})}_getResultArray(e,t,r,a,n){let i;if(!e.isArray())return e;let s=t>=0?[0,t]:[a+t,a],l=r>=0?[0,r]:[n+r,n];return i=(i=t===a&&r===n?e:t===a?e.slice(void 0,l):r===n?e.slice(s,void 0):e.slice(s,l)).map(e=>e.isNull()?nR.create(0):e),1===t&&1===r?i.get(0,0):i}};B(mG,"Take");let mq=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nR.create(0),n=null!=r?r:nA.create(!1),i=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,a,rR.create(q.NA)),u=nF(i,s,n,rR.create(q.NA)),o=l.mapValue((t,r,a)=>{let n=u.get(r,a);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);if(t.isError())return t;if(n.isError())return n;let l=Math.trunc(+t.getValue()),o=+n.getValue();if(Number.isNaN(l)||l<0||l>3||Number.isNaN(o))return rR.create(q.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=o?this._getArrayValueByColumn(e,l):this._getArrayValueByRow(e,l)).length?rR.create(q.CALC):i>1||s>1||1===c.length?c[0]:nD.create({calculateValueList:c.map(e=>[e]),rowCount:c.length,columnCount:1,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===i&&1===s?o.get(0,0):o}_getArrayValueByColumn(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<a;i++)for(let a=0;a<r;a++){let r=e.get(a,i);this._isIgnore(r,t)||n.push(r.isNull()?nR.create(0):r)}return n}_getArrayValueByRow(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<r;i++)for(let r=0;r<a;r++){let a=e.get(i,r);this._isIgnore(a,t)||n.push(a.isNull()?nR.create(0):a)}return n}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}};B(mq,"Tocol");let mW=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nR.create(0),n=null!=r?r:nA.create(!1),i=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,a,rR.create(q.NA)),u=nF(i,s,n,rR.create(q.NA)),o=l.mapValue((t,r,a)=>{let n=u.get(r,a);if(e.isError())return e;if(t.isError())return t;if(n.isError())return n;let l=Math.trunc(+t.getValue()),o=+n.getValue();if(Number.isNaN(l)||l<0||l>3||Number.isNaN(o)||e.isNull())return rR.create(q.VALUE);if(!e.isArray())return e;let c=[];return 0===(c=o?this._getArrayValueByColumn(e,l):this._getArrayValueByRow(e,l)).length?rR.create(q.CALC):i>1||s>1||1===c.length?c[0]:nD.create({calculateValueList:[c],rowCount:1,columnCount:c.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===i&&1===s?o.get(0,0):o}_getArrayValueByColumn(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<a;i++)for(let a=0;a<r;a++){let r=e.get(a,i);this._isIgnore(r,t)||n.push(r.isNull()?nR.create(0):r)}return n}_getArrayValueByRow(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=[];for(let i=0;i<r;i++)for(let r=0;r<a;r++){let a=e.get(i,r);this._isIgnore(a,t)||n.push(a.isNull()?nR.create(0):a)}return n}_isIgnore(e,t){switch(t){case 0:default:return!1;case 1:return e.isNull();case 2:return e.isError();case 3:return e.isNull()||e.isError()}}};B(mW,"Torow");let mQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isError())return e;if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return 1===t&&1===r?e.get(0,0):e.transpose()}return e}};B(mQ,"Transpose");let mX=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nA.create(!1),n=null!=r?r:nA.create(!1),i=e.isArray()?e.getRowCount():1,s=e.isArray()?e.getColumnCount():1,l=Math.max(a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),u=Math.max(a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),o=nF(l,u,a,rR.create(q.NA)),c=nF(l,u,n,rR.create(q.NA)),h=o.map((t,r,a)=>{let n,o=t,h=c.get(r,a);if(e.isError())return e;if(o.isString()&&(o=o.convertToNumberObjectValue()),o.isError())return o;if(h.isString()&&(h=h.convertToNumberObjectValue()),h.isError())return h;let m=+o.getValue(),f=+h.getValue();return n=!m&&1===i||m&&1===s?e:this._getResult(e,m,f),(l>1||u>1)&&null!=n&&n.isArray()?n.get(0,0):n});return 1===l&&1===u?h.get(0,0):h}_getResult(e,t,r){let a=e.isArray()?e.getRowCount():1,n=e.isArray()?e.getColumnCount():1,i=e.getArrayValue(),s=a,l=n;t&&(i=this._transposeArray(i),s=n,l=a);let u=this._getRepeatRows(i,s,l);if(u.length>0){let e=[];u.forEach(t=>{t.forEach((t,a)=>{(0!==a||r)&&e.push(t)})}),i=i.filter((t,r)=>!e.includes(r))}return 0===i.length?rR.create(q.CALC):(t&&(i=this._transposeArray(i)),nD.create({calculateValueList:i,rowCount:i.length,columnCount:i[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}))}_getRepeatRows(e,t,r){let a=[];for(let n=0;n<r;n++)if(0===n){let r=Array(t).fill(null).map((t,r)=>({r:r,valueObject:e[r][n]}));a=this._getRepeatRowsByObjects(r)}else{if(0===a.length)break;let t=[];a.forEach(r=>{let a=r.map(t=>({r:t,valueObject:e[t][n]})),i=this._getRepeatRowsByObjects(a);t=t.concat(i)}),a=t}return a}_getRepeatRowsByObjects(e){let t=/* @__PURE__ */new Map;return e.forEach(e=>{let r=e.r,a=e.valueObject,n=a.getValue();if(a.isNull()?n=null:a.isString()&&(0,P.isRealNum)(n)&&(n=+n),t.has(n)){let e=t.get(n);e.push(r),t.set(n,e)}else t.set(n,[r])}),Array.from(t.values()).filter(e=>e.length>1)}_transposeArray(e){let t=e.length,r=e[0].length,a=[];for(let n=0;n<r;n++){a[n]=[];for(let r=0;r<t;r++)a[n][r]=e[r][n]}return a}};B(mX,"Unique");let mK=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return t;if(!t.isArray())return rR.create(q.VALUE);if(r.isError())return r;if(null!=a&&a.isError())return a;let n=null!=a?a:nA.create(!0);return nH(e)&&nH(n)&&r.isArray()?this._handleArrayColIndexNum(e,t,r,n):this._handleNonArrayColIndexNum(e,t,r,n)}_handleArrayColIndexNum(e,t,r,a){let n;let i=e.isArray()?e.getFirstCell():e,s=this.getZeroOrOneByOneDefault(a);if(null==s)return rR.create(q.VALUE);let l=[];return r.iterator((e,r,a)=>{if(null==e)return n=rR.create(q.VALUE),!1;let u=this._handleTableArray(i,t,e,s);if(u.isError())return n=u,!1;void 0===l[r]&&(l[r]=[]),l[r][a]=u}),n||nj(l,l.length,l[0].length,this.unitId||"",this.subUnitId||"")}_handleNonArrayColIndexNum(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e),l=nF(n,i,a);return s.map((e,a,n)=>{if(e.isError())return e;let i=l.get(a,n);if(null==i)return rR.create(q.VALUE);if(i.isError())return i;let s=this.getZeroOrOneByOneDefault(i);return null==s?rR.create(q.VALUE):this._handleTableArray(e,t,r,s)})}_handleTableArray(e,t,r,a){let n=this.getIndexNumValue(r);if(n instanceof rR)return n;if((n=Math.floor(n))<1)return rR.create(q.VALUE);let i=t.slice(void 0,[0,1]);if(null==i)return rR.create(q.VALUE);let s=t.slice(void 0,[n-1,n]);return null==s?rR.create(q.REF):this._handleSingleObject(e,i,s,a)}_handleSingleObject(e,t,r,a){return 0===a?this.equalSearch(e,t,r):this.binarySearch(e,t,r)}};B(mK,"Vlookup");let mZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=Math.max(...e.map(e=>e.isArray()?e.getColumnCount():1)),r=[];for(let a=0;a<e.length;a++){let n=e[a];if(n.isError())return n;let i=n.isArray()?n.getRowCount():1,s=n.isArray()?n.getColumnCount():1;for(let e=0;e<i;e++){let a=[];for(let r=0;r<t;r++){let t=n;n.isArray()&&(t=n.get(e,r)),r>s-1||!t?a.push(rR.create(q.NA)):a.push(t)}r.push(a)}}return nD.create({calculateValueList:r,rowCount:r.length,columnCount:r[0].length||0,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})}};B(mZ,"Vstack");let mz=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:rR.create(q.NA);a.isNull()&&(a=rR.create(q.NA));let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nF(s,l,t,rR.create(q.NA)),o=nF(s,l,a,rR.create(q.NA)),c=u.mapValue((t,r,a)=>{let u=o.get(r,a);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(n>1&&i>1||Number.isNaN(c))return rR.create(q.VALUE);if(c<1)return rR.create(q.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],m=this._getWrapArray(h,c,u);return s>1||l>1||1===m.length&&1===m[0].length?m[0][0]:nD.create({calculateValueList:m,rowCount:m.length,columnCount:m[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===l?c.get(0,0):c}_getWrapArray(e,t,r){let a=Math.ceil(e.length/t),n=a>1?t:e.length,i=[];for(let t=0;t<a;t++)for(let a=0;a<n;a++){i[a]||(i[a]=[]);let s=t*n+a;s<e.length?i[a].push(e[s].isNull()?nR.create(0):e[s]):i[a].push(r)}return i}};B(mz,"Wrapcols");let mJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:rR.create(q.NA);a.isNull()&&(a=rR.create(q.NA));let n=e.isArray()?e.getRowCount():1,i=e.isArray()?e.getColumnCount():1,s=Math.max(t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),l=Math.max(t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),u=nF(s,l,t,rR.create(q.NA)),o=nF(s,l,a,rR.create(q.NA)),c=u.mapValue((t,r,a)=>{let u=o.get(r,a);if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);if(t.isError())return t;let c=Math.trunc(+t.getValue());if(n>1&&i>1||Number.isNaN(c))return rR.create(q.VALUE);if(c<1)return rR.create(q.NUM);let h=e.isArray()?e.getArrayValue().flat():[e],m=this._getWrapArray(h,c,u);return s>1||l>1||1===m.length&&1===m[0].length?m[0][0]:nD.create({calculateValueList:m,rowCount:m.length,columnCount:m[0].length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column})});return 1===s&&1===l?c.get(0,0):c}_getWrapArray(e,t,r){let a=Math.ceil(e.length/t),n=a>1?t:e.length,i=[];for(let t=0;t<a;t++){let a=[];for(let i=0;i<n;i++){let s=t*n+i;s<e.length?a.push(e[s].isNull()?nR.create(0):e[s]):a.push(r)}i.push(a)}return i}};B(mJ,"Wraprows");let m0=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){if(e.isError())return e;if(t.isError()||r.isError())return rR.create(q.REF);if(!t.isArray()||!r.isArray())return rR.create(q.VALUE);let s=t.getRowCount(),l=t.getColumnCount(),u=r.getRowCount(),o=r.getColumnCount();if(1!==s&&1!==l||1===s&&l>1&&l!==o||1===l&&s>1&&s!==u)return rR.create(q.VALUE);if(null!=a&&a.isError()||null!=n&&n.isError()||null!=i&&i.isError())return rR.create(q.NA);let c=null!=a?a:rR.create(q.NA),h=this.getIndexNumValue(n||nR.create(0));if(h instanceof rR)return h;let m=this.getIndexNumValue(i||nR.create(1));return m instanceof rR?m:this._getResult(e,t,r,c,h,m,s,l,u,o)}_getResult(e,t,r,a,n,i,s,l,u,o){let c=e.isArray()?e.getRowCount():1,h=e.isArray()?e.getColumnCount():1;if(c>1||h>1){let l;return null==(l=1===s?r.slice([0,1]):r.slice(void 0,[0,1]))?rR.create(q.NA):e.map(e=>{let r=this._checkErrorCombination(n,i);if(r)return r;let s=this._handleSingleObject(e,t,l,n,i);return s.isError()?a:s})}let m=e.isArray()?e.get(0,0):e;if(l===o&&s===u){let e=this._checkErrorCombination(n,i);if(e)return e;let s=this._handleSingleObject(m,t,r,n,i);return s.isError()?a:s}let f=0;l===o&&(f=1);let g=this._handleExpandObject(m,t,r,n,i,f);return null==g?rR.create(q.NA):g}_handleExpandObject(e,t,r,a,n,i=0){if((2===n||-2===n)&&2!==a){let s=rP(n),l=rD(a);return this.binarySearchExpand(e,t,r,i,s,l)}return 2===a?this.fuzzySearchExpand(e,t,r,-1!==n,i):-1===a||1===a?this.orderSearchExpand(e,t,r,1===a?rT.MAX:rT.MIN,-1===n,i):this.equalSearchExpand(e,t,r,-1!==n,i)}_handleSingleObject(e,t,r,a,n){if((2===n||-2===n)&&2!==a){let i=rP(n),s=rD(a);return this.binarySearch(e,t,r,i,s)}return 2===a?this.fuzzySearch(e,t,r,-1!==n):-1===a||1===a?this.orderSearch(e,t,r,1===a?rT.MAX:rT.MIN,-1===n):this.equalSearch(e,t,r,-1!==n)}_checkErrorCombination(e,t){return 2===e&&(-2===t||2===t)?rR.create(q.VALUE):null}};B(m0,"Xlookup");let m1=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",4)}calculate(e,t,r,a){if(e.isError())return e;if(t.isError())return rR.create(q.REF);if(!t.isArray())return rR.create(q.VALUE);let n=t.getRowCount(),i=t.getColumnCount();if(1!==n&&1!==i)return rR.create(q.VALUE);if(null!=r&&r.isError()||null!=a&&a.isError())return rR.create(q.NA);let s=this.getIndexNumValue(r||nR.create(0));if(s instanceof rR)return s;let l=this.getIndexNumValue(a||nR.create(1));return l instanceof rR?l:e.isArray()?e.map(e=>this._handleSingleObject(e,t,s,l)):this._handleSingleObject(e,t,s,l)}_handleSingleObject(e,t,r,a){let n;if((2===a||-2===a)&&2!==r){let i=rP(a),s=rD(r);n=t.binarySearch(e,i,s)}else if(2===r){let r;let i=t.compare(e,Z.EQUALS);if(null==(r=-1!==a?i.getFirstTruePosition():i.getLastTruePosition()))return rR.create(q.NA);n=1===t.getRowCount()?r.column:r.row}else if(-1===r||1===r){let i=t.orderSearch(e,1===r?rT.MAX:rT.MIN,-1===a);if(null==i)return rR.create(q.NA);if(i instanceof rR)return i;n=1===t.getRowCount()?i.column:i.row}else{let r;let i=t.isEqual(e);if(null==(r=-1!==a?i.getFirstTruePosition():i.getLastTruePosition()))return rR.create(q.NA);n=1===t.getRowCount()?r.column:r.row}return null==n?rR.create(q.NA):nR.create(n+1)}};B(m1,"Xmatch");let m2=[[mb,mU.ADDRESS],[mR,mU.AREAS],[mS,mU.CHOOSE],[mO,mU.CHOOSECOLS],[mT,mU.CHOOSEROWS],[mV,mU.COLUMN],[mI,mU.COLUMNS],[mM,mU.DROP],[mx,mU.EXPAND],[mv,mU.FILTER],[mD,mU.HLOOKUP],[mP,mU.HSTACK],[mL,mU.INDEX],[mw,mU.INDIRECT],[mF,mU.LOOKUP],[mj,mU.MATCH],[mB,mU.OFFSET],[mk,mU.ROW],[m$,mU.ROWS],[mY,mU.SORT],[mH,mU.SORTBY],[mG,mU.TAKE],[mq,mU.TOCOL],[mW,mU.TOROW],[mQ,mU.TRANSPOSE],[mX,mU.UNIQUE],[mK,mU.VLOOKUP],[mZ,mU.VSTACK],[mz,mU.WRAPCOLS],[mJ,mU.WRAPROWS],[m0,mU.XLOOKUP],[m1,mU.XMATCH]],m3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.abs()}};B(m3,"Abs");let m5=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acos()}};B(m5,"Acos");let m4=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.acosh()}};B(m4,"Acosh");let m6=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:m9(e)):m9(t)}};function m9(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return rR.create(q.VALUE);let r=Math.atan(1/(t=Number(t)));return t<0&&(r+=Math.PI),Number.isNaN(r)?rR.create(q.VALUE):nR.create(r)}B(m6,"Acot"),B(m9,"acot");let m7=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.isArray()?t.map(e=>e.isError()?e:m8(e)):m8(t)}};function m8(e){let t=e.getValue();if(e.isBoolean()&&(t=t?1:0),!Number.isFinite(t))return rR.create(q.VALUE);if(1>=Math.abs(t=Number(t)))return rR.create(q.NUM);let r=.5*Math.log((t+1)/(t-1));return Number.isNaN(r)?rR.create(q.VALUE):nR.create(r)}B(m7,"Acoth"),B(m8,"acoth");let fe=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nR.create(0);if(e.isBoolean()||e.isNumber())return rR.create(q.VALUE);let t=e.getValue().toLocaleString().toLocaleUpperCase();if(t.length>255)return rR.create(q.VALUE);let r=t.startsWith("-");r&&(t=t.slice(1));let a=0;for(let e=0;e<t.length;e++){let r=lT.get(t[e])||0,n=lT.get(t[e+1])||0,i=lT.get(t[e+2])||0,s=lT.get(t[e+3])||0;if(!r||i>=n&&i>r||r===n&&r===i&&r===s||r===n/2)return rR.create(q.VALUE);r<n?a-=r:a+=r}return nR.create(r?-a:a)}};B(fe,"Arabic");let ft=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asin()}};B(ft,"Asin");let fr=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.asinh()}};B(fr,"Asinh");let fa=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atan()}};B(fa,"Atan");let fn=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e,a=t;return r.isString()&&(r=r.convertToNumberObjectValue()),r.isError()?r:(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:a.atan2(r))}};B(fn,"Atan2");let fi=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.atanh()}};B(fi,"Atanh");let fs=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=r?r:nR.create(0);if(e.isError())return e;if(t.isError())return t;if(a.isError())return a;let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,a,rR.create(q.NA)),o=s.map((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r);return this._handleSingleObject(e,a,n)});return 1===o.getRowCount()&&1===o.getColumnCount()?o.getArrayValue()[0][0]:o}_handleSingleObject(e,t,r){let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=t;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let i=r;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=Math.floor(+a.getValue()),l=Math.floor(+n.getValue()),u=Math.floor(+i.getValue());if(s<0||s>=0x20000000000000||l<2||l>36||u<0)return rR.create(q.NUM);let o=s.toString(l);return o.length<u&&(o=Array(u-o.length+1).join("0")+o),nT.create(o.toLocaleUpperCase())}};B(fs,"Base");let fl=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;let s=+a.getValue(),l=+n.getValue();if(s>0&&l<0)return rR.create(q.NUM);if(0===s||0===l)return nR.create(0);let u=nn(s/l,0)*l;return nR.create(u)});return 1===s.getRowCount()&&1===s.getColumnCount()?s.getArrayValue()[0][0]:s}};B(fl,"Ceiling");let fu=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nR.create(1),n=null!=r?r:nR.create(0);if(e.isError())return e;if(a.isError())return a;if(n.isError())return n;let i=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,e,rR.create(q.NA)),u=nF(i,s,a,rR.create(q.NA)),o=nF(i,s,n,rR.create(q.NA)),c=l.map((e,t,r)=>{let a=e,n=u.get(t,r),i=o.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;let s=+a.getValue(),l=+n.getValue(),c=+i.getValue();return 0===s||0===l?nR.create(0):this._getResult(s,l,c)});return 1===i&&1===s?c.get(0,0):c}_getResult(e,t,r){let a;return a=e<0&&0!==r?(t<0?nn(Math.abs(e)/Math.abs(t),0):-nn(Math.abs(e)/t,0))*t:(t<0?-nn(e/Math.abs(t),0):nn(e/t,0))*t,nR.create(a)}};B(fu,"CeilingMath");let fo=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),l=+a.getValue();if(0===i||0===l)return nR.create(0);let u=(l<0?-nn(i/Math.abs(l),0):nn(i/l,0))*l;return nR.create(u)});return 1===a&&1===n?l.get(0,0):l}};B(fo,"CeilingPrecise");let fc=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),n.isString()&&(n=n.convertToNumberObjectValue()),a.isError())return a;if(n.isError())return n;let s=Math.floor(+a.getValue()),l=Math.floor(+n.getValue());if(s<0||l<0||s<l)return rR.create(q.NUM);let u=lp(s,l);return Number.isNaN(u)||!Number.isFinite(u)?rR.create(q.NUM):nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(fc,"Combin");let fh=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=e,n=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),n.isString()&&(n=n.convertToNumberObjectValue()),a.isError())return a;if(n.isError())return n;let s=Math.floor(+a.getValue()),l=Math.floor(+n.getValue());if(s<0||l<0||0===s&&s<l)return rR.create(q.NUM);let u=lp(s+l-1,s-1);return Number.isNaN(u)||!Number.isFinite(u)?rR.create(q.NUM):nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(fh,"Combina");let fm=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cos()}};B(fm,"Cos");let ff=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.cosh()}};B(ff,"Cosh");let fg=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?rR.create(q.NUM):0===r?rR.create(q.DIV_BY_ZERO):t.tan().getReciprocal()}};B(fg,"Cot");let fd=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:0==+t.getValue()?rR.create(q.DIV_BY_ZERO):t.tanh().getReciprocal()}};B(fd,"Coth");let fN=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Math.abs(r)>=0x8000000?rR.create(q.NUM):0===r?rR.create(q.DIV_BY_ZERO):t.sin().getReciprocal()}};B(fN,"Csc");let f_=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return 0===r?rR.create(q.DIV_BY_ZERO):Number.isNaN(r)||Number.isFinite(Math.sinh(r))?t.sinh().getReciprocal():nR.create(0)}};B(f_,"Csch");let fC=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{if(e.isError())return e;let a=i.get(t,r);if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=`${e.getValue()}`,s=Math.floor(+a.getValue());if((0,P.isRealNum)(n)&&(0>+n||+n>=0x20000000000000||!Number.isInteger(+n))||"true"===n.toLocaleLowerCase()||"false"===n.toLocaleLowerCase()||s<2||s>36)return rR.create(q.NUM);if(""===n.replace(/\s/g,""))return nR.create(0);if(!this._isValidCharForRadix(n,s))return rR.create(q.NUM);let l=Number.parseInt(n,s);return Number.isNaN(l)?rR.create(q.NUM):nR.create(l)});return 1===r&&1===a?s.get(0,0):s}_isValidCharForRadix(e,t){for(let r of e){let e=r.toUpperCase().charCodeAt(0);if(t<=10&&!(e>=48&&e<48+t)||t>10&&!(e>=48&&e<58||e>=65&&e<65+t-10))return!1}return!0}};B(fC,"Decimal");let fE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return rR.create(q.VALUE);let a=180/Math.PI*r;return Number.isNaN(a)?rR.create(q.VALUE):nR.create(a)}};B(fE,"Degrees");let fp=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return rR.create(q.VALUE);let a=(r<0?-nn(Math.abs(r)/2,0):nn(r/2,0))*2;return Number.isNaN(a)?rR.create(q.VALUE):0===a?nR.create(0):nR.create(a)}};B(fp,"Even");let fA=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.exp()}};B(fA,"Exp");let fb=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=lE(Math.floor(+t.getValue()));return Number.isNaN(r)||!Number.isFinite(r)?rR.create(q.NUM):nR.create(r)}};B(fb,"Fact");let fy=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;if(e.isArray()){let r=e.getRowCount(),a=e.getColumnCount();if(r>1||a>1)return rR.create(q.VALUE);t=e.get(0,0)}return this._handleSingleObject(t)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=lE(Math.floor(+t.getValue()),2);return Number.isNaN(r)||!Number.isFinite(r)?rR.create(q.NUM):nR.create(r)}};B(fy,"Factdouble");let fR=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=i.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let s=+n.getValue(),l=+a.getValue();if(s>0&&l<0)return rR.create(q.NUM);if(0===s)return nR.create(0);if(0===l)return rR.create(q.DIV_BY_ZERO);let u=na(s/l,0)*l;return nR.create(u)});return 1===r&&1===a?s.get(0,0):s}};B(fR,"Floor");let fS=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nR.create(1),n=null!=r?r:nR.create(0),i=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,e,rR.create(q.NA)),u=nF(i,s,a,rR.create(q.NA)),o=nF(i,s,n,rR.create(q.NA)),c=l.map((e,t,r)=>{let a,n=e,i=u.get(t,r),s=o.get(t,r);if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return i;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return s;let l=+n.getValue(),c=+i.getValue(),h=+s.getValue();return 0===l||0===c?nR.create(0):(a=l<0&&0!==h?(c<0?na(Math.abs(l)/Math.abs(c),0):-na(Math.abs(l)/c,0))*c:(c<0?-na(l/Math.abs(c),0):na(l/c,0))*c,nR.create(a))});return 1===i&&1===s?c.get(0,0):c}};B(fS,"FloorMath");let fO=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(1);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),l=+a.getValue();if(0===i||0===l)return nR.create(0);let u=(l<0?-na(i/Math.abs(l),0):na(i/l,0))*l;return nR.create(u)});return 1===a&&1===n?l.get(0,0):l}};B(fO,"FloorPrecise");let fT=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=0;for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if(a.isArray()){let e=!1,r=rR.create(q.VALUE);if(a.iterator(a=>{if(null!=a&&a.isNull())return!0;let{isError:n,errorObject:i,number:s}=this._handleSingleObject(a);if(n)return e=!0,r=i,!1;t=lA(t,s)}),e)return r}else{let{isError:e,errorObject:r,number:n}=this._handleSingleObject(a);if(e)return r;t=lA(t,n)}}}return nR.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0||r>=0x20000000000000?{isError:!0,errorObject:rR.create(q.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};B(fT,"Gcd");let fV=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());return nR.create(r)}};B(fV,"Int");let fI=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=1,r=!0;for(let a=0;a<e.length;a++){let n=e[a];if(!n.isNull()){if(n.isArray()){let e=!1,a=rR.create(q.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:l}=this._handleSingleObject(n);if(i)return e=!0,a=s,!1;t=lb(t,l),r=!1}),e)return a}else{let{isError:e,errorObject:a,number:i}=this._handleSingleObject(n);if(e)return a;t=lb(t,i),r=!1}}}return r?nR.create(0):Number.isNaN(t)||!Number.isFinite(t)||t>=0x20000000000000?rR.create(q.VALUE):nR.create(t)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:rR.create(q.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};B(fI,"Lcm");let fM=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log()}};B(fM,"Ln");let fx=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(10);if(e.isError())return e;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),l=+a.getValue();if(i<=0||l<=0)return rR.create(q.NUM);let u=Math.log(l);if(0===u)return rR.create(q.DIV_BY_ZERO);let o=Math.log(i)/u;return nR.create(o)});return 1===a&&1===n?l.get(0,0):l}};B(fx,"Log");let fv=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.log10()}};B(fv,"Log10");let fU=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return rR.create(q.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}if(t!==r)return rR.create(q.VALUE);let n=ly(a);return nR.create(n)}};B(fU,"Mdeterm");let fD=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e.isArray()?e.getRowCount():1,r=e.isArray()?e.getColumnCount():1,a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return rR.create(q.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}if(t!==r)return rR.create(q.VALUE);let n=lR(a);return null===n?rR.create(q.NUM):nD.createByArray(n)}};B(fD,"Minverse");let fP=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;if(a!==n)return rR.create(q.VALUE);let s=this._getMatrix(e,r,a),l=this._getMatrix(t,n,i);if(s instanceof rR)return s;if(l instanceof rR)return l;let u=this._getResult(s,l,r,a,i);return nD.createByArray(u)}_getMatrix(e,t,r){let a=[];for(let n=0;n<t;n++){let t=[];for(let a=0;a<r;a++){let r=e.isArray()?e.get(n,a):e;if(r.isError())return r;if(r.isNull()||r.isBoolean())return rR.create(q.VALUE);if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let i=+r.getValue();t.push(i)}a.push(t)}return a}_getResult(e,t,r,a,n){let i=Array.from({length:r},()=>Array(n).fill(0));for(let s=0;s<r;s++)for(let r=0;r<n;r++){let n=0;for(let i=0;i<a;i++)n+=e[s][i]*t[i][r];i[s][r]=n}return i}};B(fP,"Mmult");let fL=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.mod(a)}};B(fL,"Mod");let fw=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);r=r.get(0,0)}if(r.isError())return r;let a=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean()||a.isBoolean())return rR.create(q.VALUE);let n=+r.getValue(),i=+a.getValue();if(Number.isNaN(n)||Number.isNaN(i))return rR.create(q.VALUE);if(0===i)return nR.create(0);if(n>0&&i<0||n<0&&i>0)return rR.create(q.NUM);let s=nr(n/i,0)*i;return nR.create(s)}};B(fw,"Mround");let fF=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=0,r=1;for(let a=0;a<e.length;a++){let n=e[a];if(!n.isNull()){if(n.isArray()){let e=!1,a=rR.create(q.VALUE);if(n.iterator(n=>{if(null!=n&&n.isNull())return!0;let{isError:i,errorObject:s,number:l}=this._handleSingleObject(n);return i?(e=!0,a=s,!1):(t+=l)>170?(e=!0,a=rR.create(q.NUM),!1):void(r*=lE(l))}),e)return a}else{let{isError:e,errorObject:a,number:i}=this._handleSingleObject(n);if(e)return a;if((t+=i)>170)return rR.create(q.NUM);r*=lE(i)}}}let a=lE(t)/r;return nR.create(a)}_handleSingleObject(e){if(e.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE),number:null};let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return{isError:!0,errorObject:t,number:null};let r=Math.floor(+t.getValue());return r<0?{isError:!0,errorObject:rR.create(q.NUM),number:null}:{isError:!1,errorObject:null,number:r}}};B(fF,"Multinomial");let fj=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount(),a=e.mapValue(e=>{let a=this._handleSingleObject(e);return a.isError()?a:t>1||r>1?a.get(0,0):a});return 1===t&&1===r?a.get(0,0):a}return this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=Math.floor(+t.getValue());if(r<=0)return rR.create(q.VALUE);let a=[];for(let e=0;e<r;e++){a[e]=[];for(let t=0;t<r;t++)a[e][t]=e===t?1:0}return nD.createByArray(a)}};B(fj,"Munit");let fB=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return rR.create(q.VALUE);let a=r<0?-nn(Math.abs(r),0):nn(r,0);return Number.isNaN(a)?rR.create(q.VALUE):(Math.abs(a)%2==0&&(r<0?a--:a++),nR.create(a))}};B(fB,"Odd");let fk=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){return nR.create(Math.PI)}};B(fk,"Pi");let f$=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.pow(a)}};B(f$,"Power");let fY=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(1);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=this._multiplyArray(a)),a.isError())return a;if((t=t.multiply(a)).isError())break}}return t}_multiplyArray(e){let t=nR.create(1);return e.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.multiply(e)))),t}};B(fY,"Product");let fH=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l4(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=+s.getValue();if(Number.isNaN(l)||Number.isNaN(u))return rR.create(q.VALUE);if(0===u)return rR.create(q.DIV_BY_ZERO);let o=Math.trunc(l/u);return nR.create(o)}};B(fH,"Quotient");let fG=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(!Number.isFinite(r))return rR.create(q.VALUE);let a=Math.PI/180*r;return Number.isNaN(a)?rR.create(q.VALUE):nR.create(a)}};B(fG,"Radians");let fq=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",0)}calculate(){return nR.create(Math.random())}};B(fq,"Rand");let fW=class extends lm{constructor(){super(...arguments),k(this,"minParams",0),k(this,"maxParams",5)}calculate(e,t,r,a,n){if(null!=e&&e.isError())return e;if(null!=t&&t.isError())return t;if(null!=r&&r.isError())return r;if(null!=a&&a.isError())return a;if(null!=n&&n.isError())return n;let i=null!=e?e:nR.create(1),s=null!=t?t:nR.create(1),l=null!=r?r:nR.create(0),u=null!=a?a:nR.create(1),o=null!=n?n:nR.create(0);return this._calculateResult(i,s,l,u,o)}_calculateResult(e,t,r,a,n){let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1);if(1===i&&1===s)return this._calculateSingleCell(e,t,r,a,n);let l=nF(i,s,e,rR.create(q.NA)),u=nF(i,s,t,rR.create(q.NA)),o=nF(i,s,r,rR.create(q.NA)),c=nF(i,s,a,rR.create(q.NA)),h=nF(i,s,n,rR.create(q.NA));return l.map((e,t,r)=>{let a=u.get(t,r),n=o.get(t,r),i=c.get(t,r),s=h.get(t,r),l=this._handleError(e,a,n,i,s);if(l.errorObject)return l.errorObject;let{minValue:m,maxValue:f,wholeNumberValue:g}=l,d;return g?(m=Math.ceil(m),d=Math.floor(Math.random()*((f=Math.floor(f))-m+1))+m):d=Math.random()*(f-m)+m,d<m||d>f?rR.create(q.VALUE):nR.create(d)})}_calculateSingleCell(e,t,r,a,n){let i=e;i.isArray()&&(i=i.get(0,0));let s=t;s.isArray()&&(s=s.get(0,0));let l=r;l.isArray()&&(l=l.get(0,0));let u=a;u.isArray()&&(u=u.get(0,0));let o=n;o.isArray()&&(o=o.get(0,0));let c=this._handleError(i,s,l,u,o);if(c.errorObject)return c.errorObject;let{rowsValue:h,columnsValue:m,minValue:f,maxValue:g,wholeNumberValue:d}=c;if(d&&(f=Math.ceil(f))>(g=Math.floor(g)))return rR.create(q.VALUE);let N=[];for(let e=0;e<h;e++){let e=[];for(let t=0;t<m;t++)d?e.push(Math.floor(Math.random()*(g-f+1))+f):e.push(Math.random()*(g-f)+f);N.push(e)}return 1===h&&1===m?nR.create(N[0][0]):nD.createByArray(N)}_handleError(e,t,r,a,n){let i=e;if(i.isString()&&(i=i.convertToNumberObjectValue()),i.isError())return{errorObject:i};let s=t;if(s.isString()&&(s=s.convertToNumberObjectValue()),s.isError())return{errorObject:s};let l=r;if(l.isString()&&(l=l.convertToNumberObjectValue()),l.isError())return{errorObject:l};let u=a;if(u.isString()&&(u=u.convertToNumberObjectValue()),u.isError())return{errorObject:u};let o=n;return o.isString()&&(o=o.convertToNumberObjectValue()),o.isError()?{errorObject:o}:this._getValue(i,s,l,u,o)}_getValue(e,t,r,a,n){let i=Math.floor(+e.getValue()),s=Math.floor(+t.getValue());if(0===i||0===s)return{errorObject:rR.create(q.CALC)};if(i<0||s<0)return{errorObject:rR.create(q.VALUE)};let l=+r.getValue(),u=+a.getValue(),o=+n.getValue();return l>u?{errorObject:rR.create(q.VALUE)}:!o||Number.isInteger(l)&&Number.isInteger(u)?{rowsValue:i,columnsValue:s,minValue:l,maxValue:u,wholeNumberValue:o}:{errorObject:rR.create(q.VALUE)}}};B(fW,"Randarray");let fQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isArray()){let e=r.getRowCount(),t=r.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);r=r.get(0,0)}if(r.isError())return r;let a=t;if(a.isArray()){let e=a.getRowCount(),t=a.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);a=a.get(0,0)}if(a.isError())return a;if(r.isBoolean()||a.isBoolean())return rR.create(q.VALUE);let n=+r.getValue(),i=+a.getValue();if(Number.isNaN(n)||Number.isNaN(i))return rR.create(q.VALUE);if(n>i)return rR.create(q.NUM);n=Math.ceil(n);let s=Math.floor(Math.random()*((i=Math.floor(i))-n+1))+n;return nR.create(s)}};B(fQ,"Randbetween");let fX=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(0),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(e);if(r)return a;let[i]=n,s=Math.floor(+i.getValue()),l=t;if(l.isString()&&(l=l.convertToNumberObjectValue()).isError())return l;let u=Math.floor(+l.getValue());if(l.isBoolean()&&(u=l.getValue()?0:4),s<0||s>3999||u<0||u>4)return rR.create(q.VALUE);let o=lI[u],c=o.length-1,h="";for(;s>0;){c=this._binarySearch(s,0,c,o);let e=o[c];s-=e,h+=lV.get(e)}return nT.create(h)}_binarySearch(e,t,r,a){let n=t,i=r;for(;i-n>1;){let t=Math.floor((n+i)/2),r=a[t];if(r===e)return t;r>e?i=t:n=t}return n!==i&&a[i]<=e?i:n}};B(fX,"Roman");let fK=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.round(a)}};B(fK,"Round");let fZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.floor(a)}};B(fZ,"Rounddown");let fz=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e;if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;let a=t;return a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()?a:r.ceil(a)}};B(fz,"Roundup");let fJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;return(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())?t:Math.abs(+t.getValue())>=0x8000000?rR.create(q.NUM):t.cos().getReciprocal()}};B(fJ,"Sec");let f0=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.map(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let t=e;if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();return Number.isFinite(Math.cosh(r))?Math.abs(r)>=0x8000000?rR.create(q.NUM):t.cosh().getReciprocal():nR.create(0)}};B(f0,"Sech");let f1=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",4)}calculate(e,t,r,a){let n=e,i=null!=t?t:nR.create(1),s=null!=r?r:nR.create(1),l=null!=a?a:nR.create(1);n.isNull()&&(n=nR.create(1)),i.isNull()&&(i=nR.create(1)),s.isNull()&&(s=nR.create(1)),l.isNull()&&(l=nR.create(1));let u=Math.max(n.isArray()?n.getRowCount():1,i.isArray()?i.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(n.isArray()?n.getColumnCount():1,i.isArray()?i.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,n,rR.create(q.NA)),h=nF(u,o,i,rR.create(q.NA)),m=nF(u,o,s,rR.create(q.NA)),f=nF(u,o,l,rR.create(q.NA)),g=c.mapValue((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),i=f.get(t,r);return e.isError()?e:a.isError()?a:n.isError()?n:i.isError()?i:this._getResult(e,a,n,i,u,o)});return 1===u&&1===o?g.get(0,0):g}_getResult(e,t,r,a,n,i){let{isError:s,errorObject:l,variants:u}=l9(e,t,r,a);if(s)return l;let[o,c,h,m]=u,f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue()),d=+h.getValue(),N=+m.getValue();if(f<0||g<0)return rR.create(q.VALUE);if(0===f||0===g)return rR.create(q.CALC);let _=[];for(let e=0;e<f;e++){_[e]=[];for(let t=0;t<g;t++)_[e][t]=d+(e*g+t)*N}return n>1||i>1?nR.create(_[0][0]):nD.createByArray(_)}};B(f1,"Sequence");let f2=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4)}calculate(e,t,r,a){if(e.isNull()||t.isNull()||r.isNull()||a.isNull())return rR.create(q.NA);let{isError:n,errorObject:i,variants:s}=l4(e,t,r);if(n)return i;let{isError:l,errorObject:u,variants:o}=l9(...s);if(l)return u;let[c,h,m]=o,f=+c.getValue(),g=+h.getValue(),d=+m.getValue(),N=[];if(a.isArray()){let e=!1,t=rR.create(q.VALUE);if(a.iterator(r=>{let{isError:a,errorObject:n,coefficientsObject:i}=this._handleSingleObject(r);if(a)return e=!0,t=n,!1;let s=+i.getValue();N.push(s)}),e)return t}else{let{isError:e,errorObject:t,coefficientsObject:r}=this._handleSingleObject(a);if(e)return t;let n=+r.getValue();N.push(n)}let _=0;for(let e=0;e<N.length;e++)_+=N[e]*f**(g+e*d);return Number.isNaN(_)||!Number.isFinite(_)?rR.create(q.NUM):nR.create(_)}_handleSingleObject(e){if(e.isError())return{isError:!0,errorObject:e,coefficientsObject:null};if(null!=e&&e.isBoolean())return{isError:!0,errorObject:rR.create(q.VALUE),coefficientsObject:null};let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?{isError:!0,errorObject:t,coefficientsObject:null}:{isError:!1,errorObject:null,coefficientsObject:t}}};B(f2,"Seriessum");let f3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=+n.getValue();return i>0?nR.create(1):i<0?nR.create(-1):nR.create(0)}};B(f3,"Sign");let f5=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sin()}};B(f5,"Sin");let f4=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sinh()}};B(f4,"Sinh");let f6=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.sqrt()}};B(f6,"Sqrt");let f9=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;if(t.isArray()){let e=t.getRowCount(),r=t.getColumnCount();if(e>1||r>1)return rR.create(q.VALUE);t=t.get(0,0)}if(t.isString()&&(t=t.convertToNumberObjectValue()),t.isError())return t;let r=+t.getValue();if(r<0)return rR.create(q.NUM);let a=Math.sqrt(r*Math.PI);return nR.create(a)}};B(f9,"Sqrtpi");let f7=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255),k(this,"needsReferenceObject",!0)}calculate(e,...t){if(e.isError())return e;if(e.isReferenceObject()){let r=[];return e.iterator((e,a,n)=>{null==r[a]&&(r[a]=[]),r[a][n]=this._handleSingleObject(e,...t)}),nj(r,r.length,r[0].length)}return this._handleSingleObject(e,...t)}_handleSingleObject(e,...t){let r;let a=this._getIndexNumValue(e);if(a instanceof rR)return a;switch(a){case 1:r=this._average(!1,...t);break;case 2:r=this._count(!1,...t);break;case 3:r=this._counta(!1,...t);break;case 4:r=this._max(!1,...t);break;case 5:r=this._min(!1,...t);break;case 6:r=this._product(!1,...t);break;case 7:r=this._stdev(!1,...t);break;case 8:r=this._stdevp(!1,...t);break;case 9:r=this._sum(!1,...t);break;case 10:r=this._var(!1,...t);break;case 11:r=this._varp(!1,...t);break;case 101:r=this._average(!0,...t);break;case 102:r=this._count(!0,...t);break;case 103:r=this._counta(!0,...t);break;case 104:r=this._max(!0,...t);break;case 105:r=this._min(!0,...t);break;case 106:r=this._product(!0,...t);break;case 107:r=this._stdev(!0,...t);break;case 108:r=this._stdevp(!0,...t);break;case 109:r=this._sum(!0,...t);break;case 110:r=this._var(!0,...t);break;case 111:r=this._varp(!0,...t);break;default:r=rR.create(q.VALUE)}return r}_getIndexNumValue(e){let t=e?Number(e.getValue()):0;if(Number.isNaN(t))return rR.create(q.VALUE);let r=Math.floor(t);return r>=1&&r<=11||r>=101&&r<=111?r:rR.create(q.VALUE)}_average(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.mean()}_count(e,...t){let r=nR.create(0);for(let a=0;a<t.length;a++){let n=t[a];if(!n.isReferenceObject())return rR.create(q.VALUE);let i=n.getRowData();n.iterator((t,a)=>{if(e&&this._isRowHidden(i,a))return!0;null!=t&&t.isNumber()&&(r=r.plusBy(1))})}return r}_counta(e,...t){let r=nR.create(0);for(let a=0;a<t.length;a++){let n=t[a];if(!n.isReferenceObject())return rR.create(q.VALUE);let i=n.getRowData();n.iterator((t,a)=>{if(e&&this._isRowHidden(i,a)||null==t||t.isNull())return!0;r=r.plusBy(1)})}return r}_max(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nR.create(0):r.max()}_min(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?nR.create(0):r.min()}_product(e,...t){let r=this._flattenRefArray(e,...t);if(r.isError())return r;if(this._isBlankArrayObject(r))return nR.create(0);let a=nR.create(1);return r.iterator(e=>{a=a.multiply(e)}),a}_stdev(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?rR.create(q.DIV_BY_ZERO):r.std(1)}_stdevp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?rR.create(q.DIV_BY_ZERO):r.std()}_sum(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:r.sum()}_var(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?rR.create(q.DIV_BY_ZERO):r.var(1)}_varp(e,...t){let r=this._flattenRefArray(e,...t);return r.isError()?r:this._isBlankArrayObject(r)?rR.create(q.DIV_BY_ZERO):r.var()}_flattenRefArray(e,...t){let r=[];r[0]=[];for(let a=0;a<t.length;a++){let n;let i=t[a];if(i.isError())return i;if(!i.isReferenceObject())return rR.create(q.VALUE);let s=i.getRowData();if(i.iterator((t,a)=>!!(e&&this._isRowHidden(s,a)||null==t||t.isNull()||t.isString()||t.isBoolean())||(t.isError()?(n=t,!1):void r[0].push(t))),null!=n&&n.isError())return n}return nj(r,1,r[0].length)}_isRowHidden(e,t){let r=e[t];return!!r&&r.hd===P.BooleanNumber.TRUE}_isBlankArrayObject(e){return 0===e.getArrayValue()[0].length}};B(f7,"Subtotal");let f8=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0);for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError()||(a.isArray()&&(a=a.sum()),a.isError()))return a;if((t=t.plus(a)).isError())break}return t}};B(f8,"Sum");let ge=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=t;if(t.isReferenceObject()&&(a=t.toArrayValueObject()),a.isArray()){let t=a.mapValue(t=>this._handleSingleObject(e,t,r));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,a,r)}_handleSingleObject(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;if(!e.isReferenceObject()||r&&!r.isReferenceObject())return rR.create(q.VALUE);let a=e.toArrayValueObject(),n=nk(a,t),[,i]=nB(`${t.getValue()}`);n=nX(n,a,i);let s=a.getRowCount(),l=a.getColumnCount(),u=a;if(r){let e=(u=r.toArrayValueObject()).getRowCount(),t=u.getColumnCount();if(s!==e||l!==t){let e=r.getRangeData();e.endRow=e.startRow+s-1,e.endColumn=e.startColumn+l-1,r.setRangeData(e),u=r.toArrayValueObject()}}return u.pick(n).sum()}};B(ge,"Sumif");let gt=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;if(!e.isArray()||t.length<2||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return rR.create(q.VALUE);let{maxRowLength:r,maxColumnLength:a}=nq(t),n=nW(t,e,r,a);if(n)return n;let i=nQ(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>e.pick(t).sum())),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(a)}};B(gt,"Sumifs");let gr=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return e;let r=this._initArray1(e);if(!(t.length>0))return r.sum();{let e=r.getRowCount(),a=r.getColumnCount(),n=this._getResultArrayByArray1(e,a,r);if(n instanceof rR)return n;for(let r=0;r<t.length;r++){if(t[r].isError())return t[r];let i=1,s=1;if(t[r].isArray()&&(i=t[r].getRowCount(),s=t[r].getColumnCount()),i!==e||s!==a)return rR.create(q.VALUE);for(let i=0;i<e;i++){let e=[];for(let s=0;s<a;s++){let a=t[r];if(t[r].isArray()&&(a=t[r].get(i,s)),a.isError())return a;let l=a.getValue();l&&(0,P.isRealNum)(l)?e.push(+l*n[i][s]):e.push(0)}n[i]=e}}let i=n.reduce((e,t)=>e.concat(t)).reduce((e,t)=>e+t,0);return nR.create(i)}}_initArray1(e){let t=e;return t.isArray()||(t=nD.create({calculateValueList:[[t]],rowCount:1,columnCount:1,unitId:"",sheetId:"",row:0,column:0})),t}_getResultArrayByArray1(e,t,r){let a=[];for(let n=0;n<e;n++){let e=[];for(let a=0;a<t;a++){let t=r.get(n,a);if(t.isError())return t;let i=t.getValue();i&&(0,P.isRealNum)(i)?e.push(+i):e.push(0)}a.push(e)}return a}};B(gr,"Sumproduct");let ga=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0),r=nR.create(2);for(let a=0;a<e.length;a++){let n=e[a];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()?n.iterator(e=>!!(null==e||e.isString()||e.isBoolean()||e.isNull())||(e.isError()?(t=e,!1):void(t=t.plus(e.pow(r))))):t=t.plus(n.pow(r)),t.isError())break}return t}};B(ga,"Sumsq");let gn=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return rR.create(q.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=nE.create(),i=[],s=[],l=0;return r.iterator((e,t,r)=>{let u=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==u||u.isString()||u.isBoolean()||u.isNull())return!0;if(null!=u&&u.isError())return n=u,!1;let o=+e.getValue(),c=+u.getValue();i.push(o),s.push(c),l+=o**2-c**2}),n.isError()?n:0===i.length||0===s.length?rR.create(q.DIV_BY_ZERO):nR.create(l)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return rR.create(q.VALUE);let n=+r.getValue(),i=+a.getValue();if(r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean())return rR.create(q.DIV_BY_ZERO);let s=n**2-i**2;return nR.create(s)}};B(gn,"Sumx2my2");let gi=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return rR.create(q.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=nE.create(),i=[],s=[],l=0;return r.iterator((e,t,r)=>{let u=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==u||u.isString()||u.isBoolean()||u.isNull())return!0;if(null!=u&&u.isError())return n=u,!1;let o=+e.getValue(),c=+u.getValue();i.push(o),s.push(c),l+=o**2+c**2}),n.isError()?n:0===i.length||0===s.length?rR.create(q.DIV_BY_ZERO):nR.create(l)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return rR.create(q.VALUE);let n=+r.getValue(),i=+a.getValue();if(r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean())return rR.create(q.DIV_BY_ZERO);let s=n**2+i**2;return nR.create(s)}};B(gi,"Sumx2py2");let gs=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=(e.isArray()?e.getRowCount():1)*(e.isArray()?e.getColumnCount():1);if(r!==(t.isArray()?t.getRowCount():1)*(t.isArray()?t.getColumnCount():1))return rR.create(q.NA);if(1===r)return this._calculateSingleCell(e,t);{let r=e.flatten(),a=t.flatten(),n=nE.create(),i=[],s=[],l=0;return r.iterator((e,t,r)=>{let u=a.get(t,r);if(null==e||e.isString()||e.isBoolean()||e.isNull())return!0;if(null!=e&&e.isError())return n=e,!1;if(null==u||u.isString()||u.isBoolean()||u.isNull())return!0;if(null!=u&&u.isError())return n=u,!1;let o=+e.getValue(),c=+u.getValue();i.push(o),s.push(c),l+=(o-c)**2}),n.isError()?n:0===i.length||0===s.length?rR.create(q.DIV_BY_ZERO):nR.create(l)}}_calculateSingleCell(e,t){let r=e;if(r.isArray()&&(r=r.get(0,0)),r.isError())return r;let a=t;if(a.isArray()&&(a=a.get(0,0)),a.isError())return a;if(r.isNull()||a.isNull())return rR.create(q.VALUE);let n=+r.getValue(),i=+a.getValue();return r.isString()&&!(0,P.isRealNum)(n)||r.isBoolean()||a.isString()&&!(0,P.isRealNum)(i)||a.isBoolean()?rR.create(q.DIV_BY_ZERO):nR.create((n-i)**2)}};B(gs,"Sumxmy2");let gl=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tan()}};B(gl,"Tan");let gu=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return t.isString()&&(t=t.convertToNumberObjectValue()),t.isError()?t:t.tanh()}};B(gu,"Tanh");let go=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(0),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.map((e,t,r)=>{let a=s.get(t,r),n=e;if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let i=+n.getValue(),l=+a.getValue(),u=10**Math.trunc(l),o=ni(i,u),c=Math.trunc(ne(i,u)+o)/u;return nR.create(c)});return 1===a&&1===n?l.get(0,0):l}};B(go,"Trunc");let gc=[[m3,i1.ABS],[m5,i1.ACOS],[m4,i1.ACOSH],[m6,i1.ACOT],[m7,i1.ACOTH],[fe,i1.ARABIC],[ft,i1.ASIN],[fr,i1.ASINH],[fa,i1.ATAN],[fn,i1.ATAN2],[fi,i1.ATANH],[fs,i1.BASE],[fl,i1.CEILING],[fu,i1.CEILING_MATH],[fo,i1.CEILING_PRECISE],[fc,i1.COMBIN],[fh,i1.COMBINA],[fm,i1.COS],[ff,i1.COSH],[fg,i1.COT],[fd,i1.COTH],[fN,i1.CSC],[f_,i1.CSCH],[fC,i1.DECIMAL],[fE,i1.DEGREES],[fp,i1.EVEN],[fA,i1.EXP],[fb,i1.FACT],[fy,i1.FACTDOUBLE],[fR,i1.FLOOR],[fS,i1.FLOOR_MATH],[fO,i1.FLOOR_PRECISE],[fT,i1.GCD],[fV,i1.INT],[fI,i1.LCM],[fM,i1.LN],[fx,i1.LOG],[fv,i1.LOG10],[fU,i1.MDETERM],[fD,i1.MINVERSE],[fP,i1.MMULT],[fL,i1.MOD],[fw,i1.MROUND],[fF,i1.MULTINOMIAL],[fj,i1.MUNIT],[fB,i1.ODD],[fk,i1.PI],[f$,i1.POWER],[fY,i1.PRODUCT],[fH,i1.QUOTIENT],[fG,i1.RADIANS],[fq,i1.RAND],[fW,i1.RANDARRAY],[fQ,i1.RANDBETWEEN],[fX,i1.ROMAN],[fK,i1.ROUND],[fZ,i1.ROUNDDOWN],[fz,i1.ROUNDUP],[fJ,i1.SEC],[f0,i1.SECH],[f2,i1.SERIESSUM],[f1,i1.SEQUENCE],[f3,i1.SIGN],[f5,i1.SIN],[f4,i1.SINH],[f6,i1.SQRT],[f9,i1.SQRTPI],[f7,i1.SUBTOTAL],[f8,i1.SUM],[ge,i1.SUMIF],[gt,i1.SUMIFS],[gr,i1.SUMPRODUCT],[ga,i1.SUMSQ],[gn,i1.SUMX2MY2],[gi,i1.SUMX2PY2],[gs,i1.SUMXMY2],[gl,i1.TAN],[gu,i1.TANH],[go,i1.TRUNC]],gh=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2),k(this,"_compareType",Z.EQUALS)}setCompareType(e){this._compareType=e}calculate(e,t){return e.isError()?e:t.isError()?t:e.compare(t,this._compareType)}};B(gh,"Compare");let gm=class e extends rA{constructor(e){super(""),k(this,"_values",[]),this._values=e}static create(t){return new e(t)}isCube(){return!0}sum(){let e=nR.create(0);return this._values.forEach(t=>{e.plus(t.sum())}),e}max(){let e=nR.create(Number.NEGATIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isLessThan(r)&&(e=r)}),e}min(){let e=nR.create(Number.POSITIVE_INFINITY);return this._values.forEach(t=>{let r=t.max();e.isGreaterThan(r)&&(e=r)}),e}count(){let e=nR.create(0);return this._values.forEach(t=>{e.plus(t.count())}),e}countA(){let e=nR.create(0);return this._values.forEach(t=>{e.plus(t.countA())}),e}countBlank(){let e=nR.create(0);return this._values.forEach(t=>{e.plus(t.countBlank())}),e}};B(gm,"CubeValueObject");let gf=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isError())return a;if(!a.isArray())return rR.create(q.VALUE);t.push(a)}return gm.create(t)}};B(gf,"Cube");let gg=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:t.isArray()||0!==t.getValue()?e.divided(t):rR.create(q.DIV_BY_ZERO)}};B(gg,"Divided");let gd=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.minus(t)}};B(gd,"Minus");let gN=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.multiply(t)}};B(gN,"Multiply");let g_=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){return e.isError()?e:t.isError()?t:e.plus(t)}};B(g_,"Plus");let gC=[[gh,iu.COMPARE],[gg,iu.DIVIDED],[gd,iu.MINUS],[gN,iu.MULTIPLY],[g_,iu.PLUS],[gf,iu.CUBE]],gE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0),r=nR.create(0);for(let a=0;a<e.length;a++){let n=e[a];if(n.isString()&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if((n=gp(n)).isError())return n;if(e[a]=n,(t=t.plus(n.sum())).isError())return t;r=r.plus(n.count())}else n.isNull()||(t=t.plus(n),r=r.plus(nR.create(1)))}if(0===r.getValue())return rR.create(q.NUM);let a=t.divided(r);if(a.isError())return a;let n=nR.create(0);for(let t=0;t<e.length;t++){let r=e[t];if(r.isString()&&(r=r.convertToNumberObjectValue()),r.isError())return r;if(r.isArray()){if((n=n.plus(r.minus(a).abs().sum())).isError())return n}else r.isNull()||(n=n.plus(r.minus(a).abs()))}return n.divided(r)}};function gp(e){let t=[];t[0]=[];let r=null;return e.iterator((e,a,n)=>{if(null!=e&&e.isError())return r=e,!1;null!=e&&e.isNumber()&&t[0].push(e)}),r||nj(t,1,t[0].length)}B(gE,"Avedev"),B(gp,"filterNumberValueObject");let gA=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0),r=nR.create(0);for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if((t=t.plus(n.sum())).isError())return t;r=r.plus(n.count())}else n.isNull()||(t=t.plus(n),r=r.plus(nR.create(1)))}return t.divided(r)}};B(gA,"Average");let gb=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0),r=nR.create(0);for(let a=0;a<e.length;a++){let n=e[a];if((n.isString()||n.isBoolean())&&(n=n.convertToNumberObjectValue()),n.isError())return n;if(n.isArray()){if(n.iterator(e=>{if(null==e||e.isNull())return!0;let a=e;if(a.isString()&&(a=a.convertToNumberObjectValue()).isError()&&(a=nR.create(0)),a.isBoolean()&&(a=a.convertToNumberObjectValue()),a.isError())return t=a,!1;t=t.plus(a),r=r.plus(nR.create(1))}),t.isError())return t}else n.isNull()||(t=t.plus(n),r=r.plus(nR.create(1)))}return t.divided(r)}};B(gb,"Averagea");let gy=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(null!=r&&r.isError())return r;let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject()),a.isArray()||(a=nj([[a]],1,1));let n=t;return n.isReferenceObject()&&(n=n.toArrayValueObject()),r&&!(null!=r&&r.isReferenceObject())?rR.create(q.NA):n.isArray()?n.map(e=>this._handleSingleObject(a,e,r)):this._handleSingleObject(a,n,r)}_handleSingleObject(e,t,r){let a=nk(e,t),[,n]=nB(`${t.getValue()}`);a=nX(a,e,n);let i=r?this._createRangeReferenceObject(r,e):e;if(!i)return rR.create(q.VALUE);if(i.isError())return i;i.isReferenceObject()&&(i=i.toArrayValueObject());let s=i.pick(a),l=s.sum(),u=s.count();return l.divided(u)}_createRangeReferenceObject(e,t){let r=e.getRowCount(),a=e.getColumnCount(),n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1;if(r===n&&a===i)return e;let{startRow:s,startColumn:l}=e.getRangePosition();return this.createReferenceObject(e,{startRow:s,startColumn:l,endRow:s+n-1,endColumn:l+i-1})}};B(gy,"Averageif");let gR=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return rR.create(q.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return rR.create(q.VALUE);let{maxRowLength:r,maxColumnLength:a}=nq(t),n=nW(t,e,r,a);if(n)return n;let i=nQ(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t),a=r.sum(),n=r.count();return a.divided(n)})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(a)}};B(gR,"Averageifs");let gS=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=n?n:nR.create(0),l=null!=i?i:nR.create(1);s.isNull()&&(s=nR.create(0)),l.isNull()&&(l=nR.create(1));let u=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1,s.isArray()?s.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1,s.isArray()?s.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,e,rR.create(q.NA)),h=nF(u,o,t,rR.create(q.NA)),m=nF(u,o,r,rR.create(q.NA)),f=nF(u,o,a,rR.create(q.NA)),g=nF(u,o,s,rR.create(q.NA)),d=nF(u,o,l,rR.create(q.NA)),N=c.mapValue((e,t,r)=>{let a=h.get(t,r),n=m.get(t,r),i=f.get(t,r),s=g.get(t,r),l=d.get(t,r);return this._handleSignleObject(e,a,n,i,s,l)});return 1===u&&1===o?N.get(0,0):N}_handleSignleObject(e,t,r,a,n,i){let s;let{isError:l,errorObject:u,variants:o}=l9(e,t,r,a,n,i);if(l)return u;let[c,h,m,f,g,d]=o,N=+c.getValue(),_=+h.getValue(),C=+m.getValue(),E=+f.getValue(),p=+g.getValue(),A=+d.getValue();return _<=0||C<=0||N<p||N>A||p===A?rR.create(q.NUM):(s=E?lM((N-p)/(A-p),_,C):lx((N-p)/(A-p),_,C)/(A-p),nR.create(s))}};B(gS,"BetaDist");let gO=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let n=null!=a?a:r;n.isNull()&&(n=r);let i=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,e,rR.create(q.NA)),u=nF(i,s,t,rR.create(q.NA)),o=nF(i,s,r,rR.create(q.NA)),c=nF(i,s,n,rR.create(q.NA)),h=l.mapValue((e,t,r)=>{let a=u.get(t,r),n=o.get(t,r),i=c.get(t,r);return this._handleSignleObject(e,a,n,i)});return 1===i&&1===s?h.get(0,0):h}_handleSignleObject(e,t,r,a){let{isError:n,errorObject:i,variants:s}=l9(e,t,r,a);if(n)return i;let[l,u,o,c]=s,h=Math.floor(+l.getValue()),m=+u.getValue(),f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue());if(h<0||m<0||m>1||f<0||f>h||g<0||g<f||g>h)return rR.create(q.NUM);let d=0;for(let e=f;e<=g;e++)d+=lB(e,h,m);return nR.create(d)}};B(gO,"BinomDistRange");let gT=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let a;let{isError:n,errorObject:i,variants:s}=l9(e,t,r);if(n)return i;let[l,u,o]=s,c=+l.getValue(),h=Math.floor(+u.getValue()),m=+o.getValue();return c<0||h<1||h>1e10?rR.create(q.NUM):(a=m?lk(c,h):l$(c,h),nR.create(a))}};B(gT,"ChisqDist");let gV=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=i.get(t,r);return this._handleSignleObject(e,a)});return 1===r&&1===a?s.get(0,0):s}_handleSignleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.floor(+s.getValue());if(l<0||l>1||u<1||u>1e10)return rR.create(q.NUM);let o=lY(l,u);return Number.isNaN(o)||!Number.isFinite(o)?rR.create(q.NUM):nR.create(o)}};B(gV,"ChisqInv");let gI=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let{isError:a,errorObject:n,variants:i}=l9(e,s.get(t,r),l.get(t,r));if(a)return n;let[u,o,c]=i,h=+u.getValue(),m=+o.getValue(),f=Math.floor(+c.getValue());if(h<=0||h>=1||m<=0||f<1)return rR.create(q.NUM);if(1===f)return rR.create(q.DIV_BY_ZERO);let g=Math.abs(lq(h/2,f-1)*m/Math.sqrt(f));return nR.create(g)});return 1===a&&1===n?u.get(0,0):u}};B(gI,"ConfidenceT");let gM=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=e;if(e.isArray()&&1===r&&1===a&&(s=e.get(0,0)),s.isError())return s;let l=t;if(t.isArray()&&1===n&&1===i&&(l=t.get(0,0)),l.isError())return l;if(r*a==1||n*i==1)return s.isNull()||l.isNull()?rR.create(q.VALUE):rR.create(q.DIV_BY_ZERO);if(r*a!=n*i)return rR.create(q.NA);let{isError:u,errorObject:o,array1Values:c,array2Values:h,noCalculate:m}=l2(e,t,r*a,a,i);return u?o:m?rR.create(q.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=e.length,a=0,n=0;for(let i=0;i<r;i++)a+=e[i],n+=t[i];let i=a/r,s=n/r,l=0,u=0,o=0;for(let a=0;a<r;a++){let r=e[a]-i,n=t[a]-s;l+=r*n,u+=r**2,o+=n**2}let c=Math.sqrt(u*o);return 0===c?rR.create(q.DIV_BY_ZERO):nR.create(l/c)}};B(gM,"Correl");let gx=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0);for(let r=0;r<e.length;r++){let a=e[r];a.isError()||(a.isArray()?t=t.plus(a.count()):a.isString()?a.convertToNumberObjectValue().isError()||(t=t.plus(nR.create(1))):a.isNull()||(t=t.plus(nR.create(1))))}return t}};B(gx,"Count");let gv=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(0);for(let r=0;r<e.length;r++){let a=e[r];if(a.isError()){t=t.plus(nR.create(1));continue}a.isArray()?(a=a.countA(),t=t.plus(a)):a.isNull()||(t=t.plus(nR.create(1)))}return t}};B(gv,"Counta");let gU=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:""===e.getValue()||e.isNull()?nR.create(1):e.isArray()?e.countBlank():nR.create(0)}};B(gU,"Countblank");let gD=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){return e.isError()||t.isError()?rR.create(q.NA):e.isArray()?t.isArray()?t.mapValue(t=>this._handleSingleObject(e,t)):this._handleSingleObject(e,t):rR.create(q.VALUE)}_handleSingleObject(e,t){let r=nk(e,t),[,a]=nB(`${t.getValue()}`);r=nX(r,e,a);let n=e.pick(r);return this._countA(n)}_countA(e){let t=nR.create(0);return e.iterator(e=>{if(null==e)return!0;t=t.plusBy(1)}),t}};B(gD,"Countif");let gP=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",255)}calculate(...e){if(e.length%2!=0||e.some((e,t)=>t%2==0&&!e.isArray()))return rR.create(q.VALUE);let{maxRowLength:t,maxColumnLength:r}=nq(e),a=nW(e,e[0],t,r);if(a)return a;let n=nQ(e,t,r,!0);return this._aggregateResults(n)}_aggregateResults(e){let t=e.map(e=>e.map(e=>gL(e))),r={calculateValueList:t,rowCount:t.length,columnCount:t[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(r)}};function gL(e){let t=0;return e.iterator(e=>{null!=e&&e.isBoolean()&&!0===e.getValue()&&t++}),nR.create(t)}B(gP,"Countifs"),B(gL,"countTrueValue");let gw=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=e;if(e.isArray()&&1===r&&1===a&&(s=e.get(0,0)),s.isError())return s;let l=t;if(t.isArray()&&1===n&&1===i&&(l=t.get(0,0)),l.isError())return l;if((r*a==1||n*i==1)&&(s.isNull()||l.isNull()))return rR.create(q.VALUE);if(r*a!=n*i)return rR.create(q.NA);let{isError:u,errorObject:o,array1Values:c,array2Values:h,noCalculate:m}=l2(e,t,r*a,a,i);return u?o:m?rR.create(q.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){if(e.length<=1)return rR.create(q.DIV_BY_ZERO);let r=e.length,a=0,n=0;for(let i=0;i<r;i++)a+=e[i],n+=t[i];let i=a/r,s=n/r,l=0;for(let a=0;a<r;a++)l+=(e[a]-i)*(t[a]-s);return nR.create(l/(r-1))}};B(gw,"CovarianceS");let gF=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=[],r=0,a=!0;for(let n=0;n<e.length;n++){let i=e[n];if(i.isArray()){let e=!1,n=rR.create(q.VALUE);if(i.iterator(i=>{let s=this._handleSingleObject(i);if(s.isError())return e=!0,n=s,!1;if(s.isNull())return!0;let l=s.getValue();t.push(l),r+=l,a=!1}),e)return n}else{let e=this._handleSingleObject(i);if(e.isError())return e;if(e.isNull())continue;let n=e.getValue();t.push(n),r+=n,a=!1}}if(a)return rR.create(q.NUM);let n=r/t.length,i=0;for(let e=0;e<t.length;e++)i+=(t[e]-n)**2;return nR.create(i)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull()||e.isBoolean())return nE.create();let t=e.getValue();return(0,P.isRealNum)(t)?nR.create(+t):nE.create()}};B(gF,"Devsq");let gj=class extends lm{constructor(){super(...arguments),k(this,"minParams",4),k(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=nF(n,i,a,rR.create(q.NA)),c=s.mapValue((e,t,r)=>{let a=l.get(t,r),n=u.get(t,r),i=o.get(t,r);return this._handleSignleObject(e,a,n,i)});return 1===n&&1===i?c.get(0,0):c}_handleSignleObject(e,t,r,a){let n;let{isError:i,errorObject:s,variants:l}=l9(e,t,r,a);if(i)return s;let[u,o,c,h]=l,m=+u.getValue(),f=Math.floor(+o.getValue()),g=Math.floor(+c.getValue()),d=+h.getValue();return m<0||f<1||f>1e10||g<1||g>1e10?rR.create(q.NUM):Number.isNaN(n=d?lX(m,f,g):lK(m,f,g))||!Number.isFinite(n)?rR.create(q.NUM):nR.create(n)}};B(gj,"FDist");let gB=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,t,rR.create(q.NA)),l=nF(a,n,r,rR.create(q.NA)),u=i.mapValue((e,t,r)=>{let a=s.get(t,r),n=l.get(t,r);return this._handleSignleObject(e,a,n)});return 1===a&&1===n?u.get(0,0):u}_handleSignleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=Math.floor(+l.getValue()),h=Math.floor(+u.getValue());if(o<0||o>1||c<1||c>1e10||h<1||h>1e10)return rR.create(q.NUM);let m=lZ(o,c,h);return Number.isNaN(m)||!Number.isFinite(m)?rR.create(q.NUM):nR.create(m)}};B(gB,"FInv");let gk=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=n.getValue();if(i<=-1||i>=1)return rR.create(q.NUM);let s=Math.log((1+i)/(1-i))/2;return nR.create(s)}};B(gk,"Fisher");let g$=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isArray()?e.mapValue(e=>this._handleSingleObject(e)):this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=+n.getValue(),s=Math.exp(2*i)-1,l=Math.exp(2*i)+1;return!Number.isFinite(s)&&s>0&&!Number.isFinite(l)&&l>0?nR.create(1):nR.create(s/l)}};B(g$,"Fisherinv");let gY=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let a=t.isArray()?t.getRowCount():1,n=t.isArray()?t.getColumnCount():1,i=r.isArray()?r.getRowCount():1,s=r.isArray()?r.getColumnCount():1,l=t;t.isArray()&&1===a&&1===n&&(l=t.get(0,0));let u=r;return r.isArray()&&1===i&&1===s&&(u=r.get(0,0)),e.isArray()?e.mapValue(e=>this._handleSignleObject(e,l,u,a,n,i,s)):this._handleSignleObject(e,l,u,a,n,i,s)}_handleSignleObject(e,t,r,a,n,i,s){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let l=e;if(e.isString()&&(l=e.convertToNumberObjectValue()),l.isError())return l;let u=+l.getValue();if((a*n==1||i*s==1)&&(t.isNull()||r.isNull()))return rR.create(q.VALUE);if(a*n!=i*s)return rR.create(q.NA);let{isError:o,errorObject:c,array1Values:h,array2Values:m,noCalculate:f}=l2(t,r,a*n,n,s);if(o)return c;if(f)return rR.create(q.DIV_BY_ZERO);let g=lz(u,h,m);return Number.isFinite(g)?nR.create(g):rR.create(q.DIV_BY_ZERO)}};B(gY,"Forecast");var gH=((v=gH||{}).AVEDEV="AVEDEV",v.AVERAGE="AVERAGE",v.AVERAGEA="AVERAGEA",v.AVERAGEIF="AVERAGEIF",v.AVERAGEIFS="AVERAGEIFS",v.BETA_DIST="BETA.DIST",v.BETA_INV="BETA.INV",v.BINOM_DIST="BINOM.DIST",v.BINOM_DIST_RANGE="BINOM.DIST.RANGE",v.BINOM_INV="BINOM.INV",v.CHISQ_DIST="CHISQ.DIST",v.CHISQ_DIST_RT="CHISQ.DIST.RT",v.CHISQ_INV="CHISQ.INV",v.CHISQ_INV_RT="CHISQ.INV.RT",v.CHISQ_TEST="CHISQ.TEST",v.CONFIDENCE_NORM="CONFIDENCE.NORM",v.CONFIDENCE_T="CONFIDENCE.T",v.CORREL="CORREL",v.COUNT="COUNT",v.COUNTA="COUNTA",v.COUNTBLANK="COUNTBLANK",v.COUNTIF="COUNTIF",v.COUNTIFS="COUNTIFS",v.COVARIANCE_P="COVARIANCE.P",v.COVARIANCE_S="COVARIANCE.S",v.DEVSQ="DEVSQ",v.EXPON_DIST="EXPON.DIST",v.F_DIST="F.DIST",v.F_DIST_RT="F.DIST.RT",v.F_INV="F.INV",v.F_INV_RT="F.INV.RT",v.F_TEST="F.TEST",v.FISHER="FISHER",v.FISHERINV="FISHERINV",v.FORECAST="FORECAST",v.FORECAST_ETS="FORECAST.ETS",v.FORECAST_ETS_CONFINT="FORECAST.ETS.CONFINT",v.FORECAST_ETS_SEASONALITY="FORECAST.ETS.SEASONALITY",v.FORECAST_ETS_STAT="FORECAST.ETS.STAT",v.FORECAST_LINEAR="FORECAST.LINEAR",v.FREQUENCY="FREQUENCY",v.GAMMA="GAMMA",v.GAMMA_DIST="GAMMA.DIST",v.GAMMA_INV="GAMMA.INV",v.GAMMALN="GAMMALN",v.GAMMALN_PRECISE="GAMMALN.PRECISE",v.GAUSS="GAUSS",v.GEOMEAN="GEOMEAN",v.GROWTH="GROWTH",v.HARMEAN="HARMEAN",v.HYPGEOM_DIST="HYPGEOM.DIST",v.INTERCEPT="INTERCEPT",v.KURT="KURT",v.LARGE="LARGE",v.LINEST="LINEST",v.LOGEST="LOGEST",v.LOGNORM_DIST="LOGNORM.DIST",v.LOGNORM_INV="LOGNORM.INV",v.MAX="MAX",v.MAXA="MAXA",v.MAXIFS="MAXIFS",v.MEDIAN="MEDIAN",v.MIN="MIN",v.MINA="MINA",v.MINIFS="MINIFS",v.MODE_MULT="MODE.MULT",v.MODE_SNGL="MODE.SNGL",v.NEGBINOM_DIST="NEGBINOM.DIST",v.NORM_DIST="NORM.DIST",v.NORM_INV="NORM.INV",v.NORM_S_DIST="NORM.S.DIST",v.NORM_S_INV="NORM.S.INV",v.PEARSON="PEARSON",v.PERCENTILE_EXC="PERCENTILE.EXC",v.PERCENTILE_INC="PERCENTILE.INC",v.PERCENTRANK_EXC="PERCENTRANK.EXC",v.PERCENTRANK_INC="PERCENTRANK.INC",v.PERMUT="PERMUT",v.PERMUTATIONA="PERMUTATIONA",v.PHI="PHI",v.POISSON_DIST="POISSON.DIST",v.PROB="PROB",v.QUARTILE_EXC="QUARTILE.EXC",v.QUARTILE_INC="QUARTILE.INC",v.RANK_AVG="RANK.AVG",v.RANK_EQ="RANK.EQ",v.RSQ="RSQ",v.SKEW="SKEW",v.SKEW_P="SKEW.P",v.SLOPE="SLOPE",v.SMALL="SMALL",v.STANDARDIZE="STANDARDIZE",v.STDEV_P="STDEV.P",v.STDEV_S="STDEV.S",v.STDEVA="STDEVA",v.STDEVPA="STDEVPA",v.STEYX="STEYX",v.T_DIST="T.DIST",v.T_DIST_2T="T.DIST.2T",v.T_DIST_RT="T.DIST.RT",v.T_INV="T.INV",v.T_INV_2T="T.INV.2T",v.T_TEST="T.TEST",v.TREND="TREND",v.TRIMMEAN="TRIMMEAN",v.VAR_P="VAR.P",v.VAR_S="VAR.S",v.VARA="VARA",v.VARPA="VARPA",v.WEIBULL_DIST="WEIBULL.DIST",v.Z_TEST="Z.TEST",v);let gG=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=e.isArray()?e.getRowCount():1,a=e.isArray()?e.getColumnCount():1,n=t.isArray()?t.getRowCount():1,i=t.isArray()?t.getColumnCount():1,s=e;if(e.isArray()&&1===r&&1===a&&(s=e.get(0,0)),s.isError())return s;let l=t;if(t.isArray()&&1===n&&1===i&&(l=t.get(0,0)),l.isError())return l;if(r*a==1||n*i==1)return e.isNull()||t.isNull()?rR.create(q.VALUE):rR.create(q.DIV_BY_ZERO);if(r*a!=n*i)return rR.create(q.NA);let{isError:u,errorObject:o,array1Values:c,array2Values:h,noCalculate:m}=l2(e,t,r*a,a,i);return u?o:m?rR.create(q.DIV_BY_ZERO):this._getResult(c,h)}_getResult(e,t){let r=lz(0,e,t);return Number.isFinite(r)?nR.create(r):rR.create(q.DIV_BY_ZERO)}};B(gG,"Intercept");let gq=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=a.max()),a.isError())return a;t=this._validator(t,a)}}return t.getValue()===Number.NEGATIVE_INFINITY?nR.create(0):t}_validator(e,t){let r=e.isLessThan(t),a=e;return r.getValue()&&(a=t),a}};B(gq,"Max");let gW=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(Number.NEGATIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(a.isArray()&&a.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nR.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,a)}}return t.getValue()===Number.NEGATIVE_INFINITY?nR.create(0):t}_validator(e,t){let r=e.isLessThan(t),a=e;return r.getValue()&&(a=t),a}};B(gW,"Maxa");let gQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return rR.create(q.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return rR.create(q.VALUE);let{maxRowLength:r,maxColumnLength:a}=nq(t),n=nW(t,e,r,a);if(n)return n;let i=nQ(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?nD.create("0"):r.max()})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(a)}};B(gQ,"Maxifs");let gX=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isArray()&&(a=a.min()),a.isError())return a;t=this._validator(t,a)}}return t.getValue()===Number.POSITIVE_INFINITY?nR.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),a=e;return r.getValue()&&(a=t),a}};B(gX,"Min");let gK=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=nR.create(Number.POSITIVE_INFINITY);for(let r=0;r<e.length;r++){let a=e[r];if(!a.isNull()){if((a.isString()||a.isBoolean())&&(a=a.convertToNumberObjectValue()),a.isError())return a;if(a.isArray()&&a.iterator(e=>{let r=e;if((null==r||r.isNull()||r.isString())&&(r=nR.create(0)),r.isBoolean()&&(r=r.convertToNumberObjectValue()),r.isError())return t=r,!1;t=this._validator(t,r)}),t.isError())return t;t=this._validator(t,a)}}return t.getValue()===Number.POSITIVE_INFINITY?nR.create(0):t}_validator(e,t){let r=e.isGreaterThan(t),a=e;return r.getValue()&&(a=t),a}};B(gK,"Mina");let gZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",255)}calculate(e,...t){if(e.isError())return rR.create(q.NA);if(!e.isArray()||t.length%2!=0||t.some((e,t)=>t%2==0&&!e.isArray()))return rR.create(q.VALUE);let{maxRowLength:r,maxColumnLength:a}=nq(t),n=nW(t,e,r,a);if(n)return n;let i=nQ(t,r,a,!0);return this._aggregateResults(e,i)}_aggregateResults(e,t){let r=t.map(t=>t.map(t=>{let r=e.pick(t);return 0===r.getColumnCount()?nD.create("0"):r.min()})),a={calculateValueList:r,rowCount:r.length,columnCount:r[0].length,unitId:this.unitId||"",sheetId:this.subUnitId||"",row:this.row,column:this.column};return nD.create(a)}};B(gZ,"Minifs");let gz=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.mapValue((e,t,r)=>{let a=i.get(t,r);return this._handleSignleObject(e,a)});return 1===r&&1===a?s.get(0,0):s}_handleSignleObject(e,t){let r;let{isError:a,errorObject:n,variants:i}=l9(e,t);if(a)return n;let[s,l]=i,u=+s.getValue();return r=+l.getValue()?lJ(u,0,1):l0(u,0,1),nR.create(r)}};B(gz,"NormSDist");let gJ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),l=null!=r?r:nR.create(0);l.isReferenceObject()&&(l=l.toArrayValueObject());let u=Math.max(a.isArray()?a.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,a,rR.create(q.NA)),h=nF(u,o,l,rR.create(q.NA)),m=c.map((t,r,a)=>{let l=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return rR.create(q.NA);if(n)return i;if(l.isError())return l;let u=+t.getValue(),o=+l.getValue();return Number.isNaN(u)||Number.isNaN(o)?rR.create(q.VALUE):this._getResult(u,o,s)});return 1===u&&1===o?m.get(0,0):m}_getResult(e,t,r){let a=r.sort((e,r)=>t?e-r:r-e),n=a.indexOf(e),i=[];for(;n>=0;){let t=n+1;i.push(t),n=a.indexOf(e,t)}if(0===i.length)return rR.create(q.NA);let s=i.reduce((e,t)=>e+t,0)/i.length;return nR.create(s)}_checkRefReferenceObject(e){let t=!1,r=rR.create(q.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};B(gJ,"RankAvg");let g0=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",3),k(this,"needsReferenceObject",!0)}calculate(e,t,r){let a=e;a.isReferenceObject()&&(a=a.toArrayValueObject());let{refHasError:n,refErrorObject:i,refNumbers:s}=this._checkRefReferenceObject(t),l=null!=r?r:nR.create(0);l.isReferenceObject()&&(l=l.toArrayValueObject());let u=Math.max(a.isArray()?a.getRowCount():1,l.isArray()?l.getRowCount():1),o=Math.max(a.isArray()?a.getColumnCount():1,l.isArray()?l.getColumnCount():1),c=nF(u,o,a,rR.create(q.NA)),h=nF(u,o,l,rR.create(q.NA)),m=c.map((t,r,a)=>{let l=h.get(r,a);if(!e.isReferenceObject()&&e.isNull())return rR.create(q.NA);if(n)return i;if(l.isError())return l;let u=+t.getValue(),o=+l.getValue();if(Number.isNaN(u)||Number.isNaN(o))return rR.create(q.VALUE);let c=s.sort((e,t)=>o?e-t:t-e).indexOf(u);return -1===c?rR.create(q.NA):nR.create(c+1)});return 1===u&&1===o?m.get(0,0):m}_checkRefReferenceObject(e){let t=!1,r=rR.create(q.NA),a=[];return e.isReferenceObject()?(e.toArrayValueObject().iterator(e=>{if(e.isError())return t=!0,r=e,!1;if(e.isNull()||e.isBoolean())return!0;let n=+e.getValue();if(Number.isNaN(n))return!0;a.push(n)}),{refHasError:t,refErrorObject:r,refNumbers:a}):{refHasError:!0,refErrorObject:r,refNumbers:a}}};B(g0,"RankEq");let g1=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std(1)}};B(g1,"Stdeva");let g2=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.std()}};B(g2,"Stdevpa");let g3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var(1)}};B(g3,"Vara");let g5=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=this.flattenArray(e,!1);return t.isError()?t:t.var()}};B(g5,"Varpa");let g4=[[gE,gH.AVEDEV],[gA,gH.AVERAGE],[gb,gH.AVERAGEA],[gy,gH.AVERAGEIF],[gR,gH.AVERAGEIFS],[gS,gH.BETA_DIST],[l7,gH.BETA_INV],[l8,gH.BINOM_DIST],[gO,gH.BINOM_DIST_RANGE],[ue,gH.BINOM_INV],[gT,gH.CHISQ_DIST],[ut,gH.CHISQ_DIST_RT],[gV,gH.CHISQ_INV],[ur,gH.CHISQ_INV_RT],[ua,gH.CHISQ_TEST],[un,gH.CONFIDENCE_NORM],[gI,gH.CONFIDENCE_T],[gM,gH.CORREL],[gx,gH.COUNT],[gv,gH.COUNTA],[gU,gH.COUNTBLANK],[gD,gH.COUNTIF],[gP,gH.COUNTIFS],[ui,gH.COVARIANCE_P],[gw,gH.COVARIANCE_S],[gF,gH.DEVSQ],[us,gH.EXPON_DIST],[gj,gH.F_DIST],[ul,gH.F_DIST_RT],[gB,gH.F_INV],[uu,gH.F_INV_RT],[uo,gH.F_TEST],[gk,gH.FISHER],[g$,gH.FISHERINV],[gY,gH.FORECAST],[gY,gH.FORECAST_LINEAR],[gG,gH.INTERCEPT],[gq,gH.MAX],[gW,gH.MAXA],[gQ,gH.MAXIFS],[gX,gH.MIN],[gK,gH.MINA],[gZ,gH.MINIFS],[uc,gH.NORM_DIST],[uh,gH.NORM_INV],[gz,gH.NORM_S_DIST],[um,gH.NORM_S_INV],[gJ,gH.RANK_AVG],[g0,gH.RANK_EQ],[uf,gH.STDEV_P],[ug,gH.STDEV_S],[g1,gH.STDEVA],[g2,gH.STDEVPA],[ud,gH.VAR_P],[uN,gH.VAR_S],[g3,gH.VARA],[g5,gH.VARPA]],g6=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(0);if(null!=t&&t.isNull()&&(r=nR.create(0)),r.isArray()){let t=r.mapValue(t=>this._handleSingleObject(e,t));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e,r)}_handleSingleObject(e,t){let r=this._checkArray(e);if(r.isError())return r;let{isError:a,errorObject:n,variants:i}=l9(t);if(a)return n;let[s]=i,l=+s.getValue(),u=e.isArray()?e.getRowCount():1,o=e.isArray()?e.getColumnCount():1,c="";for(let t=0;t<u;t++)for(let r=0;r<o;r++){let a=e.isArray()?e.get(t,r):e,n=`${a.getValue()}`;a.isNull()&&(n=""),a.isBoolean()&&(n=n.toLocaleUpperCase()),a.isString()&&l?c+=`"${n}"`:c+=n,t===u-1&&r===o-1||(l?r===o-1?c+=";":c+=",":c+=", ")}return l&&(c=`{${c}}`),c.length>32767?rR.create(q.CALC):nT.create(c)}_checkArray(e){if(e.isArray()){let t=e.getRowCount(),r=e.getColumnCount();return t>1||r>1?e:e.get(0,0)}return e}};B(g6,"Arraytotext");let g9=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString(),r="";for(let e=0;e<t.length;e++){let a=t.charCodeAt(e);12288===a?a=32:a>=65281&&a<=65374&&(a-=65248),r+=String.fromCharCode(a)}return nT.create(r)}};B(g9,"Asc");let g7=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=+n.getValue(),s=Math.abs(Number.parseInt(i.toString(),10)),l=Number.parseFloat((Math.abs(i)-s).toFixed(2)),u="";return u=0===s?0!==l?`${i<0?"":""}${this._convertNumberToThaiText(100*l)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`:"":0===l?`${i<0?"":""}${this._convertNumberToThaiText(s)}\u{E1A}\u{E32}\u{E17}\u{E16}\u{E49}\u{E27}\u{E19}`:`${i<0?"":""}${this._convertNumberToThaiText(s)}\u{E1A}\u{E32}\u{E17}${this._convertNumberToThaiText(100*l)}\u{E2A}\u{E15}\u{E32}\u{E07}\u{E04}\u{E4C}`,nT.create(u)}_convertNumberToThaiText(e){let t=["","","","","","",""],r=["","","","","","","","","",""],a=e.toString(),n=a.length,i="";for(let e=n;e>0;e--){let s=Number.parseInt(a.charAt(n-e),10),l=r[s],u=e>1?(e-1)%6:6;if(1===u&&2===s&&(l=""),1===s)switch(u){case 0:case 6:i+=e<n?"":l;break;case 1:break;default:i+=l}else if(0===s){0===u&&(i+=t[u]);continue}else i+=l;i+=t[u]}return i}};B(g7,"Bahttext");let g8=Object.values(P.DataStreamTreeTokenType).filter(e=>[(0,P.DataStreamTreeTokenType).TABLE_START,(0,P.DataStreamTreeTokenType).TABLE_ROW_START,(0,P.DataStreamTreeTokenType).TABLE_CELL_START,(0,P.DataStreamTreeTokenType).TABLE_CELL_END,(0,P.DataStreamTreeTokenType).TABLE_ROW_END,(0,P.DataStreamTreeTokenType).TABLE_END,(0,P.DataStreamTreeTokenType).CUSTOM_RANGE_START,(0,P.DataStreamTreeTokenType).CUSTOM_RANGE_END,(0,P.DataStreamTreeTokenType).CUSTOM_BLOCK].includes(e)),de=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=Math.floor(+n.getValue());if(i<=0)return rR.create(q.VALUE);let s=String.fromCharCode(i);return g8.some(e=>e===s)&&(s="\x01"),nT.create(s)}};B(de,"Char");let dt=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isBoolean()||e.isNumber())return e;if(e.isNull())return nT.create("");let t=`${e.getValue()}`.replace(/[\0-\x1F]/g,"");return nT.create(t)}};B(dt,"Clean");let dr=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let t=e.getValue().toLocaleString();if(e.isBoolean()&&(t=t.toLocaleUpperCase()),""===t)return rR.create(q.VALUE);let r=t.charCodeAt(0);return nR.create(r)}};B(dr,"Code");let da=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t="",r=null;for(let a of e)if(a.isArray()){if(a.iterator(e=>!!(null==e||e.isNull())||(e.isError()?(r=e,!1):void(e.isBoolean()?t+=`${e.getValue()}`.toLocaleUpperCase():(e.isString()||e.isNumber())&&(t+=e.getValue())))),r)return r}else a.isError()||a.isNull()||(t+=a.getValue());return nT.create(t)}};B(da,"Concat");let dn=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",255)}calculate(...e){let t=0,r=0;e.forEach(e=>{e.isArray()?(t=Math.max(t,e.getRowCount()),r=Math.max(r,e.getColumnCount())):(t=Math.max(t,1),r=Math.max(r,1))});let a=null;for(let n of e)a=nF(t,r,n,rR.create(q.NA)).mapValue((e,t,r)=>{let n=a&&a.get(t,r);if(null!=n&&n.isError())return n;if(e.isError())return e;let i=null==n?void 0:n.getValue(),s=null==e?void 0:e.getValue();null!=n&&n.isBoolean()&&(i=`${i}`.toLocaleUpperCase()),null!=e&&e.isBoolean()&&(s=`${s}`.toLocaleUpperCase());let l=null!=n&&n.isNull()?"":null!=i?i:"",u=null!=e&&e.isNull()?"":null!=s?s:"";return nT.create(`${l}${u}`)});return a||rR.create(q.VALUE)}};B(dn,"Concatenate");let di=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return nT.create("");let t=`${e.getValue()}`;e.isBoolean()&&(t=t.toLocaleUpperCase());let r="";for(let e=0;e<t.length;e++){let a=t.charCodeAt(e);a>=33&&a<=126?r+=String.fromCharCode(a+65248):32===a?r+="":r+=t.charAt(e)}return nT.create(r)}};B(di,"Dbcs");let ds=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2),k(this,"needsLocale",!0)}calculate(e,t){let r=null!=t?t:nR.create(2);r.isNull()&&(r=nR.create(2));let a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(e,t);if(r)return a;let[i,s]=n,l=+i.getValue(),u=Math.trunc(+s.getValue());if(u>127)return rR.create(q.VALUE);u<0&&(l=`${l}`.length<Math.abs(u)?0:l<0?-nr(Math.abs(l),u):nr(l,u),u=0);let o=rf(this.getLocale(),l,u);return nT.create(o)}};B(ds,"Dollar");let dl=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,nE.create()),i=nF(r,a,t,nE.create()),s=n.mapValue((e,t,r)=>{let a=i.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===r&&1===a?s.get(0,0):s}_handleSingleObject(e,t){if(e.isNull()||t.isNull()){let r=e.isNull()&&t.isNull();return nA.create(r)}let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let a=`${t.getValue()}`;t.isBoolean()&&(a=a.toLocaleUpperCase());let n=r===a;return nA.create(n)}};B(dl,"Exact");let du=/* @__PURE__ */B((e,t)=>(0,P.numfmt).format(e,t,{throws:!1}),"getFormatPreview"),dc=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nR.create(2);a.isNull()&&(a=nR.create(2));let n=null!=r?r:nA.create(!1);n.isNull()&&(n=nA.create(!1));let i=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,n.isArray()?n.getRowCount():1),s=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,n.isArray()?n.getColumnCount():1),l=nF(i,s,e,rR.create(q.NA)),u=nF(i,s,a,rR.create(q.NA)),o=nF(i,s,n,rR.create(q.NA)),c=l.mapValue((e,t,r)=>{let a=u.get(t,r),n=o.get(t,r);return e.isError()?e:a.isError()?a:n.isError()?n:this._handleSingleObject(e,a,n)});return 1===i&&1===s?c.get(0,0):c}_handleSingleObject(e,t,r){let{isError:a,errorObject:n,variants:i}=l9(e,t,r);if(a)return n;let[s,l,u]=i,o=+s.getValue(),c=Math.trunc(+l.getValue()),h=+u.getValue();if(c>127)return rR.create(q.VALUE);c<0&&(o=`${o}`.length<Math.abs(c)?0:o<0?-nr(Math.abs(o),c):nr(o,c),c=0);let m=h?"###0":"#,##0";c>0&&(m+=`.${"0".repeat(c)}`);let f=du(m,o);return nT.create(f)}};function dh(e){let t=0;for(let r=0;r<e.length;r++)t+=dm(e,r);return t}function dm(e,t,r="ltr"){return dN(e,t,r)>255?2:1}function df(e){return e>=55296&&e<=56319}function dg(e){return e>=56320&&e<=57343}function dd(e,t){return((1023&e)<<10)+(1023&t)+65536}function dN(e,t,r="ltr"){let a=e.charCodeAt(t);if("ltr"===r&&df(a)&&t+1<e.length){let r=e.charCodeAt(t+1);if(dg(r))return dd(a,r)}if("rtl"===r&&dg(a)&&t-1>=0){let r=e.charCodeAt(t-1);if(df(r))return dd(r,a)}return a}B(dc,"Fixed"),B(dh,"charLenByte"),B(dm,"getCharLenByteInText"),B(df,"highSurrogate"),B(dg,"lowSurrogate"),B(dd,"surrogatePair"),B(dN,"getCodePoint");let d_=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(1),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,nE.create()),s=nF(a,n,r,nE.create()),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let{isError:a,errorObject:n,variants:i}=l9(t);if(a)return n;let[s]=i,l=Math.floor(+s.getValue());if(l<0)return rR.create(q.VALUE);if(e.isNull()||0===l)return nT.create("");let u=0,o=0,c="";for(;o<l&&u<r.length;)o+=dm(r,u),c+=r.charAt(u),u++;return nT.create(c)}};B(d_,"Leftb");let dC=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return nR.create(0);if(e.isNumber()){let t=nN(e.getValue(),12,Number.EPSILON).toString();return nR.create(t.length)}if(e.isString()||e.isBoolean()||e.isNumber()){let t=e.getValue().toString();return nR.create(t.length)}return rR.create(q.VALUE)}};B(dC,"Len");let dE=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return nR.create(0);if(e.isString()||e.isBoolean()||e.isNumber()){let t=dh(`${e.getValue()}`);return nR.create(t)}return rR.create(q.VALUE)}};B(dE,"Lenb");let dp=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){return e.isError()?e:e.isArray()?e.mapValue(e=>this._handleSingleText(e)):this._handleSingleText(e)}_handleSingleText(e){if(e.isError())return e;if(e.isNull())return nT.create("");if(e.isString()||e.isBoolean()||e.isNumber()){let t=e.getValue().toString().toLowerCase();return nT.create(t)}return rR.create(q.VALUE)}};B(dp,"Lower");let dA=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){if(e.isError())return e;if(t.isError())return t;if(r.isError())return r;let a=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e),s=nF(a,n,t),l=nF(a,n,r);return i.map((e,t,r)=>this._handleSingleText(e,t,r,s,l))}_handleSingleText(e,t,r,a,n){let i=a.get(t,r)||nE.create(),s=n.get(t,r)||nE.create();if(i.isError())return i;if(s.isError())return s;let l=e.getValue();if(e.isNull()&&(l=""),e.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`,(i.isString()||i.isBoolean()||i.isNull())&&(i=i.convertToNumberObjectValue()),i.isError())return i;if((s.isString()||s.isBoolean()||s.isNull())&&(s=s.convertToNumberObjectValue()),s.isError())return s;let u=Math.floor(+i.getValue())-1,o=s.getValue();return u<0||o<0?rR.create(q.VALUE):nT.create(l.substring(u,u+o))}};B(dA,"Mid");let db=/* @__PURE__ */B(()=>[{type:4,from:48,to:57}],"numberRange"),dy=/* @__PURE__ */B(()=>[{type:7,value:95},{type:4,from:97,to:122},{type:4,from:65,to:90},{type:4,from:48,to:57}],"alphaNumericChars"),dR=/* @__PURE__ */B(()=>[{type:7,value:9},{type:7,value:10},{type:7,value:11},{type:7,value:12},{type:7,value:13},{type:7,value:32},{type:7,value:160},{type:7,value:5760},{type:4,from:8192,to:8202},{type:7,value:8232},{type:7,value:8233},{type:7,value:8239},{type:7,value:8287},{type:7,value:12288},{type:7,value:65279}],"whitespaceChars"),dS=/* @__PURE__ */B(()=>({type:3,set:dy(),not:!1}),"words"),dO=/* @__PURE__ */B(()=>({type:3,set:dy(),not:!0}),"notWords"),dT=/* @__PURE__ */B(()=>({type:3,set:db(),not:!1}),"ints"),dV=/* @__PURE__ */B(()=>({type:3,set:db(),not:!0}),"notInts"),dI=/* @__PURE__ */B(()=>({type:3,set:dR(),not:!1}),"whitespace"),dM=/* @__PURE__ */B(()=>({type:3,set:dR(),not:!0}),"notWhitespace"),dx=/* @__PURE__ */B(()=>({type:3,set:[{type:7,value:10},{type:7,value:13},{type:7,value:8232},{type:7,value:8233}],not:!0}),"anyChar");function dv(e){let t={type:0,stack:[]},r=t,a=t.stack,n=[],i=[],s=0,l=/* @__PURE__ */B(t=>{throw SyntaxError(`Invalid regular expression: /${e}/: Nothing to repeat at column ${t-1}`)},"throwError"),u=dD(e),o=0,c;for(;o<u.length;)switch(c=u[o++]){case"\\":if(o===u.length)throw SyntaxError(`Invalid regular expression: /${e}/: \\ at end of pattern`);switch(c=u[o++]){case"b":a.push({type:2,value:"b"});break;case"B":a.push({type:2,value:"B"});break;case"w":a.push(dS());break;case"W":a.push(dO());break;case"d":a.push(dT());break;case"D":a.push(dV());break;case"s":a.push(dI());break;case"S":a.push(dM());break;default:if(/\d/.test(c)){for(;/\d/.test(u[o])&&o<u.length;)c+=u[o++];let e=Number.parseInt(c,10);a.push({type:6,value:e}),i.push({reference:{type:6,value:e},stack:a,index:a.length-1})}else a.push({type:7,value:c.charCodeAt(0)})}break;case"^":a.push({type:2,value:"^"});break;case"$":a.push({type:2,value:"$"});break;case"[":{let t="^"===u[o];t&&o++;let r=dU(u.slice(o),e);o+=r[1],a.push({type:3,set:r[0],not:t});break}case".":a.push(dx());break;case"(":{let t={type:1,stack:[],remember:!0};if("?"===u[o]){let r=u[o+1];if(o+=2,"="===r)t.followedBy=!0;else if("!"===r)t.notFollowedBy=!0;else if(":"!==r)throw SyntaxError(`Invalid regular expression: /${e}/: Invalid group, character '${r}' after '?' at column ${o-1}`);t.remember=!1}else s+=1;a.push(t),n.push(r),r=t,a=t.stack;break}case")":if(0===n.length)throw SyntaxError(`Invalid regular expression: /${e}/: Unmatched ) at column ${o-1}`);a=(r=n.pop()).options?r.options[r.options.length-1]:r.stack;break;case"|":{r.options||(r.options=[r.stack],delete r.stack);let e=[];r.options.push(e),a=e;break}case"{":{let e=/^(\d+)(,(\d+)?)?\}/.exec(u.slice(o));if(e){0===a.length&&l(o);let t=Number.parseInt(e[1],10),r=e[2]?e[3]?Number.parseInt(e[3],10):1/0:t;o+=e[0].length,a.push({type:5,min:t,max:r,value:a.pop()})}else a.push({type:7,value:123});break}case"?":0===a.length&&l(o),a.push({type:5,min:0,max:1,value:a.pop()});break;case"+":0===a.length&&l(o),a.push({type:5,min:1,max:1/0,value:a.pop()});break;case"*":0===a.length&&l(o),a.push({type:5,min:0,max:1/0,value:a.pop()});break;default:a.push({type:7,value:c.charCodeAt(0)})}if(n.length>0)throw SyntaxError(`Invalid regular expression: /${e}/: Unterminated group`);return dP(i,s),t}function dU(e,t){let r;let a=[],n=/\\(?:(w)|(d)|(s)|(W)|(D)|(S))|((?:(?:\\)(.)|([^\]\\]))-(((?:\\)])|(((?:\\)?([^\]])))))|(\])|(?:\\)?([^])/g;for(;null!==(r=n.exec(e));){let e=null,[,t,i,s,l,u,o,c,h,m,f]=r;if(t||i||s||l||u||o?e=(()=>{let e={type:3,set:[],not:!1};return t?e=dS():i?e=dT():s?e=dI():l?e=dO():u?e=dV():o&&(e=dM()),e})():c&&f?e={type:4,from:(h||m).charCodeAt(0),to:f.charCodeAt(f.length-1)}:r[16]&&(e={type:7,value:r[16].charCodeAt(0)}),!e)return[a,n.lastIndex];a.push(e)}throw SyntaxError(`Invalid regular expression: /${t}/: Unterminated character class`)}function dD(e){return e.replace(/(\[\\b\])|(\\)?\\(?:u([A-F0-9]{4})|x([A-F0-9]{2})|c([@A-Z[\\\]^?])|([0tnvfr]))/g,(e,t,r,a,n,i,s)=>{if(r)return e;let l=String.fromCharCode(t?8:a?Number.parseInt(a,16):n?Number.parseInt(n,16):i?"@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^ ?".indexOf(i):({0:0,t:9,n:10,v:11,f:12,r:13})[s]);return/[[\]{}^$.|?*+()]/.test(l)?`\\${l}`:l})}function dP(e,t){for(let r of e.reverse()){let e=r.reference.value;if(t<e){r.reference.type=7;let t=e.toString();if(r.reference.value=Number.parseInt(t,8),!/^[0-7]+$/.test(t)){let e=0;for(;"8"!==t[e]&&"9"!==t[e]&&e<t.length;)e+=1;if(0===e?(r.reference.value=t.charCodeAt(0),e+=1):r.reference.value=Number.parseInt(t.slice(0,e),8),t.length>e){let a=r.stack.splice(r.index+1);for(let a of t.slice(e))r.stack.push({type:7,value:a.charCodeAt(0)});r.stack.push(...a)}}}}}function dL(e,t){if(!dw(e))return{isError:!0,regExp:null};try{let r=new RegExp(e,t?"ug":"u");return dF(r)?{isError:!1,regExp:r}:{isError:!0,regExp:null}}catch{return{isError:!0,regExp:null}}}function dw(e){return!(/\(\?<=.*?\)/g.test(e)&&!/\[.*?(\?<=.*?)\]/g.test(e)||/\(\?<!.*?\)/g.test(e)&&!/\[.*?(\?<!.*?)\]/g.test(e))}function dF(e,t){let r,a;"[object RegExp]"===Object.prototype.toString.call(e)?r=e.source:e&&"string"!=typeof e&&(r=`${e}`);try{a=dv(r)}catch{return!1}let n=0,i=/* @__PURE__ */B((e,t)=>{let r=t;if(5===e.type&&(r++,n++,r>1||n>25))return!1;if(e.options){for(let t of e.options)if(!i({stack:t},r))return!1}let a=e.stack||e.value&&e.value.stack;if(!a)return!0;for(let e of a)if(!i(e,r))return!1;return!0},"validateToken");return i(a,0)}B(dv,"tokenizer"),B(dU,"tokenizeClass"),B(dD,"strToChars"),B(dP,"processReferences"),B(dL,"handleRegExp"),B(dw,"isValidRegExp"),B(dF,"isSafeRegExp");let dj=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l5(e,t);if(r)return a;let[i,s]=n,l=i.getValue();i.isNull()&&(l=""),i.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;let u=s.getValue();s.isNull()&&(u=""),s.isBoolean()&&(u=u?"TRUE":"FALSE");let{isError:o,regExp:c}=dL(u=`${u}`,!1);if(o)return rR.create(q.REF);let h=l.match(c);if(null===h)return rR.create(q.NA);if(h.length>1){let e=h.slice(1).map(e=>nT.create(e));return e.length>1?nD.create({calculateValueList:[e],rowCount:1,columnCount:e.length,unitId:this.unitId,sheetId:this.subUnitId,row:this.row,column:this.column}):e[0]}return nT.create(h[0])}};B(dj,"Regexextract");let dB=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){let{isError:r,errorObject:a,variants:n}=l5(e,t);if(r)return a;let[i,s]=n,l=i.getValue();i.isNull()&&(l=""),i.isBoolean()&&(l=l?"TRUE":"FALSE"),l=`${l}`;let u=s.getValue();s.isNull()&&(u=""),s.isBoolean()&&(u=u?"TRUE":"FALSE");let{isError:o,regExp:c}=dL(u=`${u}`,!1);return o?rR.create(q.REF):null===l.match(c)?nA.create(!1):nA.create(!0)}};B(dB,"Regexmatch");let dk=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",3)}calculate(e,t,r){let{isError:a,errorObject:n,variants:i}=l5(e,t,r);if(a)return n;let[s,l,u]=i,o=s.getValue();s.isNull()&&(o=""),s.isBoolean()&&(o=o?"TRUE":"FALSE"),o=`${o}`;let c=l.getValue();l.isNull()&&(c=""),l.isBoolean()&&(c=c?"TRUE":"FALSE"),c=`${c}`;let h=u.getValue();u.isNull()&&(h=""),u.isBoolean()&&(h=h?"TRUE":"FALSE"),h=`${h}`;let{isError:m,regExp:f}=dL(c,!0);if(m)return rR.create(q.REF);let g=o.replace(f,h);return nT.create(g)}};B(dk,"Regexreplace");let d$=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",3)}calculate(e,t,r){let a=null!=t?t:nT.create("."),n=Math.max(e.isArray()?e.getRowCount():1,a.isArray()?a.getRowCount():1,null!=r&&r.isArray()?r.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,a.isArray()?a.getColumnCount():1,null!=r&&r.isArray()?r.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,a,rR.create(q.NA)),u=r?nF(n,i,r,rR.create(q.NA)):void 0,o=s.mapValue((e,t,a)=>{let n=l.get(t,a),i=r?u.get(t,a):void 0;return e.isError()?e:n.isError()?n:null!=i&&i.isError()?i:n.isNull()||null!=i&&i.isNull()?rR.create(q.VALUE):e.isNull()?nR.create(0):this._handleSingleObject(e,n,i)});return 1===n&&1===i?o.get(0,0):o}_handleSingleObject(e,t,r){let a,n=`${e.getValue()}`;n=n.replace(/\s+/g,"");let i=`${t.getValue()}`;if(t.isBoolean()&&(i=i.toLocaleUpperCase()),i=i.charAt(0),r&&(a=`${r.getValue()}`,r.isBoolean()&&(a=a.toLocaleUpperCase()),i===(a=a.charAt(0))))return rR.create(q.VALUE);if(""===n.trim())return nR.create(0);if(!n.match(/^\s*[+-]?\s*(?:(?:\d+(?:\.\d*)?)|(?:\.\d+))(?:[eE][+-]?\d+)?[ \t]*/))return rR.create(q.VALUE);let s=n.split(i);if(s.length>2)return rR.create(q.VALUE);let l=s[0].replace(/,/g,"");r&&(l=l.split(a).join(""));let u=0;if(1===s.length){","===i&&(l=l.replace(/\./g,""));let e=0;for(;l.endsWith("%");)l=l.slice(0,-1),e++;u=e>0?+l/100**e:+l}else{if(!(0,P.isRealNum)(l))return rR.create(q.VALUE);let e=s[1],t=0;for(;e.endsWith("%");)e=e.slice(0,-1),t++;let r=`${l}.${e}`;if(!(0,P.isRealNum)(r))return rR.create(q.VALUE);u=t>0?+r/100**t:+r}return Number.isNaN(u)?rR.create(q.VALUE):nR.create(u)}};B(d$,"Numbervalue");let dY=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError()||e.isNull()||e.isBoolean()||e.isNumber())return e;let t=e.getValue().toLocaleString().toLocaleLowerCase().replace(/(^|\b|\W|\d|_)[a-z]/g,e=>e.toLocaleUpperCase());return nT.create(t)}};B(dY,"Proper");let dH=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e,rR.create(q.NA)),i=nF(r,a,t,rR.create(q.NA)),s=n.map((e,t,r)=>{let a=i.get(t,r);if(e.isError())return e;let n=e.getValue();if(e.isNull()&&(n=""),e.isBoolean()&&(n=n?"TRUE":"FALSE"),n+="",a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let s=Math.floor(+a.getValue());if(s<0||s>32767/n.length)return rR.create(q.VALUE);let l=n.repeat(s);return nT.create(l)});return 1===r&&1===a?s.get(0,0):s}};B(dH,"Rept");let dG=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(1),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,nE.create()),s=nF(a,n,r,nE.create()),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let{isError:a,errorObject:n,variants:i}=l9(t);if(a)return n;let[s]=i,l=Math.floor(+s.getValue());if(l<0)return rR.create(q.VALUE);if(e.isNull()||0===l)return nT.create("");if(l>=r.length)return nT.create(r);let u=r.substring(r.length-l);return nT.create(u)}};B(dG,"Right");let dq=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(1),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,nE.create()),s=nF(a,n,r,nE.create()),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let r=`${e.getValue()}`;e.isBoolean()&&(r=r.toLocaleUpperCase());let{isError:a,errorObject:n,variants:i}=l9(t);if(a)return n;let[s]=i,l=Math.floor(+s.getValue());if(l<0)return rR.create(q.VALUE);if(e.isNull()||0===l)return nT.create("");let u=r.length-1,o=0,c="";for(;o<l&&u>=0;)o+=dm(r,u,"rtl"),c=r.charAt(u)+c,u--;return nT.create(c)}};B(dq,"Rightb");let dW=class extends lm{constructor(){super(...arguments),k(this,"minParams",3),k(this,"maxParams",4)}calculate(e,t,r,a){let n=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1,r.isArray()?r.getRowCount():1,null!=a&&a.isArray()?a.getRowCount():1),i=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1,r.isArray()?r.getColumnCount():1,null!=a&&a.isArray()?a.getColumnCount():1),s=nF(n,i,e,rR.create(q.NA)),l=nF(n,i,t,rR.create(q.NA)),u=nF(n,i,r,rR.create(q.NA)),o=a?nF(n,i,a,rR.create(q.NA)):void 0,c=s.mapValue((e,t,r)=>{let n=l.get(t,r),i=u.get(t,r),s=a?o.get(t,r):void 0;return e.isError()?e:n.isError()?n:i.isError()?i:null!=s&&s.isError()?s:null!=s&&s.isNull()||null!=s&&s.isBoolean()?rR.create(q.VALUE):(null!=s&&s.isString()&&(s=s.convertToNumberObjectValue()),null!=s&&s.isError()?s:this._handleSingleObject(e,n,i,s))});return 1===n&&1===i?c.get(0,0):c}_handleSingleObject(e,t,r,a){let n=this._getObjectString(e),i=this._getObjectString(t),s=this._getObjectString(r),l=a?Math.floor(+a.getValue()):void 0;if(a&&l<=0)return rR.create(q.VALUE);if(""===i)return nT.create(n);let u="",o=0;for(let e=0;e<n.length;e++){let t=n.substr(e,i.length);if(t===i||t.length===i.length&&t.trim()===i.trim()){if(++o===l){u=n.substr(0,e)+s+n.substr(e+i.length);break}void 0===l&&(u+=s),e+=i.length-1}else void 0===l&&(u+=n[e])}return l&&o<l&&(u=n),nT.create(u)}_getObjectString(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}};B(dW,"Substitute");let dQ=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){let t=e;return e.isArray()&&(t=e.get(0,0)),t.isError()?t:t.isNull()||t.isBoolean()||t.isNumber()?nT.create(""):t}};B(dQ,"T");let dX=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",2)}calculate(e,t){if(e.isError())return e;if(t.isError())return t;let r=Math.max(e.isArray()?e.getRowCount():1,t.isArray()?t.getRowCount():1),a=Math.max(e.isArray()?e.getColumnCount():1,t.isArray()?t.getColumnCount():1),n=nF(r,a,e),i=nF(r,a,t);return n.map((e,t,r)=>{if(e.isError())return e;let a=i.get(t,r)||nT.create(" ");if(a.isError())return a;if(a.isBoolean())return rR.create(q.VALUE);if(e.isBoolean())return e;let n=e.getValue();if(e.isNull()&&(n=0),e.isString()){if(!(0,P.isRealNum)(n))return e;n=Number(n)}a.isNull()&&(a=nT.create(" "));let s=`${a.getValue()}`,l=du(s,n);return nT.create(" "===s?l.trimEnd():l)})}};B(dX,"Text");let dK=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=!1,l=null!=r?r:nR.create(1);l.isNull()&&(s=!0,l=nR.create(1));let u=null!=a?a:nR.create(0),o=null!=n?n:nR.create(0),c=null!=i?i:rR.create(q.NA),h=Math.max(e.isArray()?e.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),f=nF(h,m,e,rR.create(q.NA)),g=nF(h,m,l,rR.create(q.NA)),d=nF(h,m,u,rR.create(q.NA)),N=nF(h,m,o,rR.create(q.NA)),_=nF(h,m,c,rR.create(q.NA)),C=this._getResultArray(f,t,g,d,N,_,s,!a);return 1===h&&1===m?C.get(0,0):C}_getResultArray(e,t,r,a,n,i,s,l){return e.map((e,u,o)=>{let c=r.get(u,o),h=a.get(u,o),m=n.get(u,o),f=i.get(u,o),g=this._checkVariantsError(e,c,h,m);if(g.isError())return g;let d=this._getStringValue(e),N=this._getDelimiterValue(t);if(N instanceof rR)return N;let _=this._getVariantsNumberFloorValue(c,h,m);if(_ instanceof rR)return _;let[C,E,p]=_;return 0===C||E<0||E>1||p<0||p>1?rR.create(q.VALUE):N.includes("")?C>0?nT.create(d):nT.create(""):!s&&Math.abs(C)>d.length?rR.create(q.VALUE):N.every(e=>e.length>d.length)?rR.create(q.NA):this._getResult(d,N,C,E,p,f,l)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nA.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;t.push(this._getStringValue(e))}),r)return a}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=Math.floor(+a.getValue());t.push(n)}return t}_getResult(e,t,r,a,n,i,s){let l=a?e.toLocaleLowerCase():e,u=a?t.map(e=>e.toLocaleLowerCase()):t,o=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=u.map(e=>({index:l.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;o=e.index,l=l.substr(0,e.index),h=e.length,c++}else{let e=u.map(e=>({index:l.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;o+=e.index+h,l=l.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&s)return rR.create(q.NA);if(!c||c<Math.abs(r))return n?r>0?nT.create(""):nT.create(e):i;let m=e.substr(o+h);return nT.create(m)}};B(dK,"Textafter");let dZ=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=!1,l=null!=r?r:nR.create(1);l.isNull()&&(s=!0,l=nR.create(1));let u=null!=a?a:nR.create(0),o=null!=n?n:nR.create(0),c=null!=i?i:rR.create(q.NA),h=Math.max(e.isArray()?e.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1,o.isArray()?o.getRowCount():1,c.isArray()?c.getRowCount():1),m=Math.max(e.isArray()?e.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1,o.isArray()?o.getColumnCount():1,c.isArray()?c.getColumnCount():1),f=nF(h,m,e,rR.create(q.NA)),g=nF(h,m,l,rR.create(q.NA)),d=nF(h,m,u,rR.create(q.NA)),N=nF(h,m,o,rR.create(q.NA)),_=nF(h,m,c,rR.create(q.NA)),C=this._getResultArray(f,t,g,d,N,_,s,!a);return 1===h&&1===m?C.get(0,0):C}_getResultArray(e,t,r,a,n,i,s,l){return e.map((e,u,o)=>{let c=r.get(u,o),h=a.get(u,o),m=n.get(u,o),f=i.get(u,o),g=this._checkVariantsError(e,c,h,m);if(g.isError())return g;let d=this._getStringValue(e),N=this._getDelimiterValue(t);if(N instanceof rR)return N;let _=this._getVariantsNumberFloorValue(c,h,m);if(_ instanceof rR)return _;let[C,E,p]=_;return 0===C||E<0||E>1||p<0||p>1?rR.create(q.VALUE):N.includes("")?C>0?nT.create(""):nT.create(d):!s&&Math.abs(C)>d.length?rR.create(q.VALUE):N.every(e=>e.length>d.length)?rR.create(q.NA):this._getResult(d,N,C,E,p,f,l)})}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nA.create(!0)}_getStringValue(e){let t=`${e.getValue()}`;return e.isNull()&&(t=""),e.isBoolean()&&(t=t.toLocaleUpperCase()),t}_getDelimiterValue(e){let t=[];if(e.isArray()){let r=!1,a=rR.create(q.VALUE);if(e.iterator(e=>{if(e.isError())return r=!0,a=e,!1;t.push(this._getStringValue(e))}),r)return a}else{if(e.isError())return e;t.push(this._getStringValue(e))}return t}_getVariantsNumberFloorValue(...e){let t=[];for(let r=0;r<e.length;r++){let a=e[r];if(a.isString()&&(a=a.convertToNumberObjectValue()),a.isError())return a;let n=Math.floor(+a.getValue());t.push(n)}return t}_getResult(e,t,r,a,n,i,s){let l=a?e.toLocaleLowerCase():e,u=a?t.map(e=>e.toLocaleLowerCase()):t,o=0,c=0,h=0;for(let e=0;e<Math.abs(r);e++)if(r<0){let e=u.map(e=>({index:l.lastIndexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>t.index-e.index)[0];if(!e)break;o=e.index,l=l.substr(0,e.index),c++}else{let e=u.map(e=>({index:l.indexOf(e),length:e.length})).filter(e=>-1!==e.index).sort((e,t)=>e.index-t.index)[0];if(!e)break;o+=e.index+h,l=l.substr(e.index+e.length),h=e.length,c++}if(c&&c<Math.abs(r)&&s)return rR.create(q.NA);if(!c||c<Math.abs(r))return n?r>0?nT.create(e):nT.create(""):i;let m=e.substr(0,o);return nT.create(m)}};B(dZ,"Textbefore");let dz=class extends lm{constructor(){super(...arguments),k(this,"minParams",2),k(this,"maxParams",6)}calculate(e,t,r,a,n,i){let s=null!=r?r:nT.create("\\s"),l=null!=a?a:nR.create(0),u=null!=n?n:nR.create(0),o=null!=i?i:nT.create(q.NA),{_variant:c,values:h}=this._getStringValues(t),{_variant:m,values:f}=this._getStringValues(s,!1);s=m;let g=Math.max(e.isArray()?e.getRowCount():1,l.isArray()?l.getRowCount():1,u.isArray()?u.getRowCount():1),d=Math.max(e.isArray()?e.getColumnCount():1,l.isArray()?l.getColumnCount():1,u.isArray()?u.getColumnCount():1),N=nF(g,d,e,rR.create(q.NA)),_=nF(g,d,l,rR.create(q.NA)),C=nF(g,d,u,rR.create(q.NA)),E=this._getResultArray(N,c,s,_,C,o,h,f);return 1===g&&1===d?E.get(0,0):E.map(e=>e.get(0,0))}_getStringValues(e,t=!0){let r=e,a=[];if(r.isArray())r.iterator(e=>{if(null!=e&&e.isError())return r=e,!1;if(null!=e&&e.isNull()&&t)return r=rR.create(q.VALUE),!1;let n=this._getRegExpStringValue(e);if(""===n)return r=rR.create(q.VALUE),!1;a.push(n)});else{r.isNull()&&t&&(r=rR.create(q.VALUE));let e=this._getRegExpStringValue(r);""===e&&(r=rR.create(q.VALUE)),a.push(e)}return{_variant:r,values:a}}_getResultArray(e,t,r,a,n,i,s,l){return e.map((e,u,o)=>{let c=a.get(u,o),h=n.get(u,o),m=this._checkVariantsError(e,t,r,c,h);if(m.isError())return m;if(e.isNull())return rR.create(q.VALUE);let f=i;if(f.isArray()){let e=f.getRowCount(),t=f.getColumnCount();if(e>1||t>1)return rR.create(q.VALUE);f=f.get(0,0)}let g=`${e.getValue()}`;if(e.isBoolean()&&(g=g.toLocaleUpperCase()),c.isString()&&(c=c.convertToNumberObjectValue()).isError())return c;let d=Math.floor(+c.getValue());if(h.isString()&&(h=h.convertToNumberObjectValue()).isError())return h;let N=Math.floor(+h.getValue());if(N<0||N>1)return rR.create(q.VALUE);let _=`${f.getValue()}`;return f.isBoolean()&&(_=_.toLocaleUpperCase()),this._getResult(g,s,l,d,N,_)})}_getResult(e,t,r,a,n,i){let s=RegExp(r.join("|"),`g${n?"i":""}`),l=RegExp(t.join("|"),`g${n?"i":""}`),u=e.split(s),o=1,c=u.map(e=>{let t=e.split(l);return a&&(t=t.filter(e=>""!==e)),o=Math.max(o,t.length),t});return c=c.map(e=>{let t=e;return t.length<o&&(t=t.concat(Array(o-t.length).fill(i))),t}),nD.createByArray(c)}_checkVariantsError(...e){for(let t=0;t<e.length;t++){let r=e[t];if(r.isError())return r}return nA.create(!0)}_getRegExpStringValue(e){let t=e.getValue();return e.isNull()&&(t="\\s"),e.isBoolean()&&(t=t?"TRUE":"FALSE"),t+="",this._escapeRegExp(t)}_escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};B(dz,"Textsplit");let dJ=Object.values(P.DataStreamTreeTokenType).filter(e=>[(0,P.DataStreamTreeTokenType).TABLE_START,(0,P.DataStreamTreeTokenType).TABLE_ROW_START,(0,P.DataStreamTreeTokenType).TABLE_CELL_START,(0,P.DataStreamTreeTokenType).TABLE_CELL_END,(0,P.DataStreamTreeTokenType).TABLE_ROW_END,(0,P.DataStreamTreeTokenType).TABLE_END,(0,P.DataStreamTreeTokenType).CUSTOM_RANGE_START,(0,P.DataStreamTreeTokenType).CUSTOM_RANGE_END,(0,P.DataStreamTreeTokenType).CUSTOM_BLOCK].includes(e)),d0=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){let{isError:t,errorObject:r,variants:a}=l9(e);if(t)return r;let[n]=a,i=Math.floor(+n.getValue());if(i<1||i>1114111)return rR.create(q.VALUE);if(1114111===i||1114110===i)return rR.create(q.NA);let s=String.fromCharCode(i);return dJ.some(e=>e===s)&&(s="\x01"),nT.create(s)}};B(d0,"Unichar");let d1=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isNull())return rR.create(q.VALUE);let t=e.getValue().toLocaleString();e.isBoolean()&&(t=t.toLocaleUpperCase());let r=t.charCodeAt(0);return nR.create(r)}};B(d1,"Unicode");let d2=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",1)}calculate(e){if(e.isArray()){let t=e.mapValue(e=>this._handleSingleObject(e));return 1===t.getRowCount()&&1===t.getColumnCount()?t.get(0,0):t}return this._handleSingleObject(e)}_handleSingleObject(e){if(e.isError())return e;if(e.isBoolean())return rR.create(q.VALUE);let t=e;if(e.isString()&&(t=t.convertToNumberObjectValue()).isError())return t;let r=+t.getValue();return nR.create(r)}};B(d2,"Value");let d3=class extends lm{constructor(){super(...arguments),k(this,"minParams",1),k(this,"maxParams",2)}calculate(e,t){let r=null!=t?t:nR.create(0),a=Math.max(e.isArray()?e.getRowCount():1,r.isArray()?r.getRowCount():1),n=Math.max(e.isArray()?e.getColumnCount():1,r.isArray()?r.getColumnCount():1),i=nF(a,n,e,rR.create(q.NA)),s=nF(a,n,r,rR.create(q.NA)),l=i.mapValue((e,t,r)=>{let a=s.get(t,r);return e.isError()?e:a.isError()?a:this._handleSingleObject(e,a)});return 1===a&&1===n?l.get(0,0):l}_handleSingleObject(e,t){let{isError:r,errorObject:a,variants:n}=l9(t);if(r)return a;let[i]=n,s=Math.floor(+i.getValue());if(s<0||s>1)return rR.create(q.VALUE);if(e.isNull())return nT.create("");if(e.isBoolean())return e;if(e.isNumber())return nR.create(e.getValue());let l=s?`"${e.getValue()}"`:`${e.getValue()}`;return nT.create(l)}};B(d3,"Valuetotext");let d5=[[g9,i2.ASC],[g6,i2.ARRAYTOTEXT],[g7,i2.BAHTTEXT],[de,i2.CHAR],[dt,i2.CLEAN],[dr,i2.CODE],[da,i2.CONCAT],[dn,i2.CONCATENATE],[di,i2.DBCS],[ds,i2.DOLLAR],[dl,i2.EXACT],[dc,i2.FIXED],[d_,i2.LEFTB],[dC,i2.LEN],[dE,i2.LENB],[dp,i2.LOWER],[dA,i2.MID],[dj,i2.REGEXEXTRACT],[dB,i2.REGEXMATCH],[dk,i2.REGEXREPLACE],[d$,i2.NUMBERVALUE],[dY,i2.PROPER],[dH,i2.REPT],[dG,i2.RIGHT],[dq,i2.RIGHTB],[dW,i2.SUBSTITUTE],[dQ,i2.T],[dX,i2.TEXT],[dK,i2.TEXTAFTER],[dZ,i2.TEXTBEFORE],[dz,i2.TEXTSPLIT],[d0,i2.UNICHAR],[d1,i2.UNICODE],[d2,i2.VALUE],[d3,i2.VALUETOTEXT]],d4=[],d6=[];var d9,d7,d8,Ne,Nt=((U=Nt||{}).ENCODEURL="ENCODEURL",U.FILTERXML="FILTERXML",U.WEBSERVICE="WEBSERVICE",U),Nr=Object.defineProperty,Na=Object.getOwnPropertyDescriptor,Nn=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?Na(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&Nr(t,r,i),i},"__decorateClass$5"),Ni=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$5");let Ns=(B(Ne=class extends P.Disposable{constructor(e,t,r,a){super(),this._commandService=e,this._functionService=t,this._configService=r,this._dataSyncPrimaryController=a,this._initialize()}_initialize(){this._registerCommands(),this._registerFunctions()}_registerCommands(){[tf,ej,to,tc,th,tm,ti,ts,tl,tu,tg,td,tN,t_,tC,eF].forEach(e=>{var t;this._commandService.registerCommand(e),null==(t=this._dataSyncPrimaryController)||t.registerSyncingMutations(e)})}_registerFunctions(){var e;let t=this._configService.getConfig(tQ),r=[...lc,...uA,...ub,...uY,...oL,...cI,...hY,...me,...mA,...m2,...gc,...gC,...g4,...d5,...d4,...d6].concat(null!=(e=null==t?void 0:t.function)?e:[]).map(e=>new e[0](e[1]));this._functionService.registerExecutors(...r)}},"FormulaController"),Ne);Ns=Nn([Ni(0,P.ICommandService),Ni(1,is),Ni(2,P.IConfigService),Ni(3,(0,P.Optional)(w.DataSyncPrimaryController))],Ns);var Nl,Nu=Object.defineProperty,No=Object.getOwnPropertyDescriptor,Nc=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?No(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&Nu(t,r,i),i},"__decorateClass$4"),Nh=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$4");let Nm=(B(Nl=class extends P.Disposable{constructor(e,t,r){super(),this._commandService=e,this._dependencyManagerService=t,this._featureCalculationManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener(),this._featureCalculationManagerServiceListener()}_featureCalculationManagerServiceListener(){this.disposeWithMe(this._featureCalculationManagerService.onChanged$.subscribe(e=>{let{unitId:t,subUnitId:r,featureIds:a}=e;this._dependencyManagerService.removeFeatureFormulaDependency(t,r,a)}))}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tu.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:a,subUnitId:n}=t;this._dependencyManagerService.removeFeatureFormulaDependency(a,n,r)}else if(e.id===tl.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:a}=t,{unitId:n,subUnitId:i}=a;this._dependencyManagerService.removeFeatureFormulaDependency(n,i,[r])}else if(e.id===td.id){let t=e.params;if(null==t)return;this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,t.formulaIdList)}else if(e.id===tg.id){let t=e.params;if(null==t)return;let r=t.formulaMap,a=[];Object.keys(r).forEach(e=>{a.push(e)}),this._dependencyManagerService.removeOtherFormulaDependency(t.unitId,t.subUnitId,a)}else if(e.id===tf.id){let t=e.params.formulaData;Object.keys(t).forEach(e=>{let r=t[e];if(void 0!==r){if(null===r){this._dependencyManagerService.clearFormulaDependency(e);return}Object.keys(r).forEach(t=>{let a=r[t];if(void 0!==a){if(null===a)return this._dependencyManagerService.clearFormulaDependency(e,t),!0;new(0,P.ObjectMatrix)(a).forValue((r,a)=>{this._dependencyManagerService.removeFormulaDependency(e,t,r,a)})}})}})}else e.id===ti.id&&this._handleSetDefinedName(e)}))}_handleSetDefinedName(e){let t=e.params;if(null==t)return;let{unitId:r,name:a}=t;this._dependencyManagerService.removeFormulaDependencyByDefinedName(r,a)}},"SetDependencyController"),Nl);Nm=Nc([Nh(0,P.ICommandService),Nh(1,sj),Nh(1,sw),Nh(2,sj)],Nm);var Nf,Ng=Object.defineProperty,Nd=Object.getOwnPropertyDescriptor,NN=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?Nd(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&Ng(t,r,i),i},"__decorateClass$3"),N_=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$3");let NC=(B(Nf=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._featureCalculationManagerService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tl.id){let t=e.params;if(null==t)return;let{featureId:r,calculationParam:a}=t,{unitId:n,subUnitId:i}=a;this._featureCalculationManagerService.register(n,i,r,a)}else if(e.id===tu.id){let t=e.params;if(null==t)return;let{featureIds:r,unitId:a,subUnitId:n}=t;this._featureCalculationManagerService.remove(a,n,r)}}))}},"SetFeatureCalculationController"),Nf);NC=NN([N_(0,P.ICommandService),N_(1,sj)],NC);var NE,Np=Object.defineProperty,NA=Object.getOwnPropertyDescriptor,Nb=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?NA(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&Np(t,r,i),i},"__decorateClass$2"),Ny=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$2");let NR=(B(NE=class extends P.Disposable{constructor(e,t,r){super(),this._commandService=e,this._otherFormulaManagerService=t,this._dependencyManagerService=r,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===tg.id){let t=e.params;if(null==t)return;let r={[t.unitId]:{[t.subUnitId]:t.formulaMap}};this._otherFormulaManagerService.batchRegister(r)}else if(e.id===td.id){let t=e.params;if(null==t)return;let r={};t.formulaIdList.forEach(e=>r[e]=!0);let a={[t.unitId]:{[t.subUnitId]:r}};this._otherFormulaManagerService.batchRemove(a)}}))}},"SetOtherFormulaController"),NE);NR=Nb([Ny(0,P.ICommandService),Ny(1,sk),Ny(2,sw)],NR);var NS,NO=Object.defineProperty,NT=Object.getOwnPropertyDescriptor,NV=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?NT(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&NO(t,r,i),i},"__decorateClass$1"),NI=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$1");let NM=(B(NS=class extends P.Disposable{constructor(e,t){super(),this._commandService=e,this._superTableService=t,this._initialize()}_initialize(){this._commandExecutedListener()}_commandExecutedListener(){this.disposeWithMe(this._commandService.onCommandExecuted(e=>{if(e.id===ti.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:a,reference:n}=t;this._superTableService.registerTable(r,a,n)}else if(e.id===ts.id){let t=e.params;if(null==t)return;let{unitId:r,tableName:a}=t;this._superTableService.remove(r,a)}else if(e.id===tC.id){let t=e.params;if(null==t)return;let{tableOption:r,tableOptionType:a}=t;this._superTableService.registerTableOptionMap(r,a)}}))}},"SetSuperTableController"),NS);NM=NV([NI(0,P.ICommandService),NI(1,se)],NM);let Nx=class extends P.Disposable{constructor(){super(...arguments),k(this,"_dirtyConversionMap",/* @__PURE__ */new Map)}dispose(){this._dirtyConversionMap.clear()}remove(e){this._dirtyConversionMap.delete(e)}get(e){return this._dirtyConversionMap.get(e)}has(e){return this._dirtyConversionMap.has(e)}register(e,t){this._dirtyConversionMap.set(e,t)}getDirtyConversionMap(){return this._dirtyConversionMap}};B(Nx,"ActiveDirtyManagerService");let Nv=(0,P.createIdentifier)("univer.formula.active-dirty-manager.service");var NU=Object.defineProperty,ND=Object.getOwnPropertyDescriptor,NP=/* @__PURE__ */B((e,t,r,a)=>{for(var n,i=a>1?void 0:a?ND(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&NU(t,r,i),i},"__decorateClass"),NL=/* @__PURE__ */B((e,t)=>(r,a)=>t(r,a,e),"__decorateParam");let Nw=(B(D=class extends P.Plugin{constructor(e=tX,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig(tQ,a)}onStarting(){this._initialize()}onReady(){var e;this._injector.get(Ns),this._injector.get(la),this._injector.get(NM),null!=(e=this._config)&&e.notExecuteFormula||(this._injector.get(NR),this._injector.get(NC),this._injector.get(Nm),this._injector.get(s9))}onRendered(){var e;null!=(e=this._config)&&e.notExecuteFormula||(this._injector.get(sJ),this._injector.get(sQ))}_initialize(){var e;let t=[[is,{useClass:il}],[ta,{useClass:tr}],[Nv,{useClass:Nx}],[se,{useClass:i8}],[tk],[tU],[Ns],[la],[NM]];null!=(e=this._config)&&e.notExecuteFormula||t.push([sJ],[sk,{useClass:sB}],[n4,{useClass:n5}],[t3,{useClass:t2}],[sw,{useClass:sL}],[sj,{useClass:sF}],[s9],[NR],[Nm],[NC],[sQ],[ix],[sP],[t8],[ii],[iy],[iK],[iJ],[i7],[id],[sc],[sN],[sb],[sR]),t.forEach(e=>this._injector.add(e))}},"UniverFormulaEnginePlugin"),k(D,"pluginName","UNIVER_ENGINE_FORMULA_PLUGIN"),D);Nw=NP([NL(1,(0,P.Inject)(P.Injector)),NL(2,P.IConfigService)],Nw)}),r("k2g5B",function(r,a){e(r.exports,"fromModule",function(){return x}),e(r.exports,"toModule",function(){return v}),e(r.exports,"IRPCChannelService",function(){return L}),e(r.exports,"DataSyncPrimaryController",function(){return G});var n,i=t("7yNYd"),s=t("lMvMU"),l=t("9z4na"),u=t("2jrJe"),o=t("5LPkb"),c=t("dBx9C"),h=t("hRiv7"),m=t("1O3Nt"),f=t("3yupB"),g=t("c3hg1"),d=Object.defineProperty,N=(e,t,r)=>t in e?d(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,_=(e,t)=>d(e,"name",{value:t,configurable:!0}),C=(e,t,r)=>N(e,"symbol"!=typeof t?t+"":t,r);let E={},p={};var A=Object.defineProperty,b=Object.getOwnPropertyDescriptor,y=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?b(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&A(t,r,i),i},"__decorateClass$3"),R=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$3");let S="rpc.remote-sync.service",O=(0,i.createIdentifier)(S),T=(_(F=class{constructor(e){this._commandService=e}async syncMutation(e){return this._commandService.syncExecuteCommand(e.mutationInfo.id,e.mutationInfo.params,{onlyLocal:!0,fromSync:!0})}},"RemoteSyncPrimaryService"),F);T=y([R(0,i.ICommandService)],T);let V="univer.remote-instance-service",I=(0,i.createIdentifier)(V),M=(_(j=class{constructor(e,t,r){this._univerInstanceService=e,this._commandService=t,this._logService=r}whenReady(){return Promise.resolve(!0)}async syncMutation(e){return this._applyMutation(e.mutationInfo)}async createInstance(e){let{type:t,snapshot:r}=e;try{if(t===i.UniverInstanceType.UNIVER_SHEET)return this._univerInstanceService.createUnit(i.UniverInstanceType.UNIVER_SHEET,r),!0;throw Error(`[WebWorkerRemoteInstanceService]: cannot create replica for document type: ${t}.`)}catch(e){throw e instanceof Error?e:TypeError(`${e}`)}}async disposeInstance(e){return this._univerInstanceService.disposeUnit(e.unitID)}_applyMutation(e){let{id:t,params:r}=e;return this._commandService.syncExecuteCommand(t,r,{onlyLocal:!0,fromSync:!0})}},"WebWorkerRemoteInstanceService"),j);function x(e){return new class{call(t,r){let a=e[t];if("function"==typeof a){let t=a.apply(e,[r]);return t instanceof Promise||(t=Promise.resolve(t)),t}throw Error(`[RPC]: method not found for ${t}!`)}subscribe(t,r){let a=e[t];if("function"==typeof a){let t=a.apply(e,r);return(0,h.isObservable)(t)?t:(0,f.of)(t)}throw Error(`[RPC]: observable method not found for ${t}!`)}}}function v(e){return new Proxy({},{get(t,r){if("dispose"!==r)return function(...t){return U(r)?e.subscribe(r,t[0]):e.call(r,t[0])}}})}function U(e){return e.endsWith("$")}M=y([R(0,i.IUniverInstanceService),R(1,i.ICommandService),R(2,i.ILogService)],M),_(x,"fromModule"),_(v,"toModule"),_(U,"propertyIsEventSource");let D=class extends i.RxDisposable{constructor(e){super(),C(this,"_initialized",new o.BehaviorSubject(!1)),C(this,"_lastRequestCounter",0),C(this,"_pendingRequests",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,u.takeUntil)(this.dispose$)).subscribe(e=>this._onMessage(e))}dispose(){this._pendingRequests.clear()}getChannel(e){let t=this;return{call:(r,a)=>t._disposed?Promise.reject():t._remoteCall(e,r,a),subscribe(r,a){if(t._disposed)throw Error("[ChannelClient]: client is disposed!");return t._remoteSubscribe(e,r,a)}}}_whenReady(){return(0,c.firstValueFrom)(this._initialized.pipe((0,s.filter)(e=>e),(0,l.take)(1)))}async _remoteCall(e,t,r){await this._whenReady();let a=++this._lastRequestCounter,n={seq:a,type:100,channelName:e,method:t,args:r},i=this;return new Promise((e,t)=>{this._pendingRequests.set(a,{handle(r){switch(r.type){case 201:i._pendingRequests.delete(a),e(r.data);break;case 202:i._pendingRequests.delete(a),t(r.data);break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(n)})}_remoteSubscribe(e,t,r){return new m.Observable(a=>{let n=-1;return this._whenReady().then(()=>{let i={seq:n=++this._lastRequestCounter,type:101,channelName:e,method:t,args:r};this._pendingRequests.set(n,{handle(e){switch(e.type){case 300:a.next(e.data);break;case 301:a.error(e.data);break;case 302:a.complete();break;default:throw Error("[ChannelClient]: unknown response type!")}}}),this._sendRequest(i)}),()=>{if(-1===n)return;let r={type:102,seq:n,channelName:e,method:t};this._sendRequest(r)}})}_sendRequest(e){this._protocol.send(e)}_onMessage(e){var t;switch(e.type){case 0:this._initialized.next(!0);break;case 201:case 202:case 300:case 302:case 301:null==(t=this._pendingRequests.get(e.seq))||t.handle(e)}}};_(D,"ChannelClient");let P=class extends i.RxDisposable{constructor(e){super(),C(this,"_channels",/* @__PURE__ */new Map),C(this,"_subscriptions",/* @__PURE__ */new Map),this._protocol=e,this._protocol.onMessage.pipe((0,u.takeUntil)(this.dispose$)).subscribe(e=>this._onRequest(e)),this._sendResponse({seq:-1,type:0})}dispose(){super.dispose(),this._subscriptions.clear(),this._channels.clear()}registerChannel(e,t){this._channels.set(e,t)}_onRequest(e){switch(e.type){case 100:this._onMethodCall(e);break;case 101:this._onSubscribe(e);break;case 102:this._onUnsubscribe(e)}}_onMethodCall(e){let t;let{channelName:r,method:a,args:n}=e,i=this._channels.get(r);try{if(!i)throw Error(`[ChannelServer]: Channel ${r} not found!`);t=i.call(a,n)}catch(e){t=Promise.reject(e)}t.then(t=>{this._sendResponse({seq:e.seq,type:201,data:t})}).catch(t=>{t instanceof Error?this._sendResponse({seq:e.seq,type:202,data:t.message}):this._sendResponse({seq:e.seq,type:202,data:String(t)})})}_onSubscribe(e){let{channelName:t,seq:r}=e,a=this._channels.get(t);try{if(!a)throw Error(`[ChannelServer]: Channel ${t} not found!`);let n=a.subscribe(e.method,e.args).subscribe({next:/* @__PURE__ */_(e=>{this._sendResponse({seq:r,type:300,data:e})},"next"),error:/* @__PURE__ */_(e=>{this._sendResponse({seq:r,type:301,data:e.message}),this._sendResponse({seq:r,type:302})},"error"),complete:/* @__PURE__ */_(()=>{this._sendResponse({seq:r,type:302})},"complete")});this._subscriptions.set(e.seq,n)}catch(t){t instanceof Error?this._sendResponse({seq:e.seq,type:301,data:t.message}):this._sendResponse({seq:e.seq,type:301,data:String(t)})}}_onUnsubscribe(e){let t=this._subscriptions.get(e.seq);t&&(t.unsubscribe(),this._subscriptions.delete(e.seq))}_sendResponse(e){this._protocol.send(e)}};_(P,"ChannelServer");let L=(0,i.createIdentifier)("IRPCChannelService"),w=class{constructor(e){C(this,"_client"),C(this,"_server"),this._client=new D(e),this._server=new P(e)}dispose(){this._client.dispose(),this._server.dispose()}requestChannel(e){return this._client.getChannel(e)}registerChannel(e,t){this._server.registerChannel(e,t)}};_(w,"ChannelService");var F,j,B,k=Object.defineProperty,$=Object.getOwnPropertyDescriptor,Y=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?$(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&k(t,r,i),i},"__decorateClass$2"),H=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$2");let G=(B=class extends i.RxDisposable{constructor(e,t,r,a,n){super(),C(this,"_remoteInstanceService"),C(this,"_syncingUnits",/* @__PURE__ */new Set),C(this,"_syncingMutations",/* @__PURE__ */new Set),this._injector=e,this._commandService=t,this._univerInstanceService=r,this._rpcChannelService=a,this._remoteSyncService=n,this._initRPCChannels(),this._init()}registerSyncingMutations(e){this._syncingMutations.add(e.id)}syncUnit(e){return this._syncingUnits.add(e),(0,i.toDisposable)(()=>this._syncingUnits.delete(e))}_initRPCChannels(){this._rpcChannelService.registerChannel(S,x(this._remoteSyncService)),this._injector.add([I,{useFactory:/* @__PURE__ */_(()=>v(this._rpcChannelService.requestChannel(V)),"useFactory")}]),this._remoteInstanceService=this._injector.get(I)}_init(){this._univerInstanceService.getTypeOfUnitAdded$(i.UniverInstanceType.UNIVER_SHEET).pipe((0,u.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.add(e.getUnitId()),this._remoteInstanceService.createInstance({unitID:e.getUnitId(),type:i.UniverInstanceType.UNIVER_SHEET,snapshot:e.getSnapshot()})}),this._univerInstanceService.getTypeOfUnitDisposed$(i.UniverInstanceType.UNIVER_SHEET).pipe((0,u.takeUntil)(this.dispose$)).subscribe(e=>{this._syncingUnits.delete(e.getUnitId()),this._remoteInstanceService.disposeInstance({unitID:e.getUnitId()})}),this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{let{type:r,params:a,id:n}=e,s=(null==a?void 0:a.unitId)||"";r===i.CommandType.MUTATION&&(!s||this._syncingUnits.has(s))&&!(null!=t&&t.fromSync)&&this._syncingMutations.has(n)&&this._remoteInstanceService.syncMutation({mutationInfo:e})}))}},_(B,"DataSyncPrimaryController"),B);G=Y([H(0,(0,i.Inject)(i.Injector)),H(1,i.ICommandService),H(2,i.IUniverInstanceService),H(3,L),H(4,O)],G);var q,W=Object.defineProperty,Q=Object.getOwnPropertyDescriptor,X=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?Q(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&W(t,r,i),i},"__decorateClass$1"),K=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam$1");let Z=(q=class extends i.Disposable{constructor(e,t,r,a){super(),C(this,"_remoteSyncService"),this._injector=e,this._remoteInstanceService=t,this._commandService=r,this._rpcChannelService=a,this._initRPCChannels(),this._init()}_initRPCChannels(){this._rpcChannelService.registerChannel(V,x(this._remoteInstanceService)),this._injector.add([O,{useFactory:/* @__PURE__ */_(()=>v(this._rpcChannelService.requestChannel(S)),"useFactory")}]),this._remoteSyncService=this._injector.get(O)}_init(){this.disposeWithMe(this._commandService.onCommandExecuted((e,t)=>{e.type!==i.CommandType.MUTATION||null!=t&&t.fromSync||this._remoteSyncService.syncMutation({mutationInfo:e})}))}},_(q,"DataSyncReplicaController"),q);function z(){return{send(e){postMessage(e)},onMessage:new(0,m.Observable)(e=>{let t=/* @__PURE__ */_(t=>{e.next(t.data)},"handler");return addEventListener("message",t),()=>removeEventListener("message",t)}).pipe((0,g.shareReplay)(1))}}function J(e){return{send(t){e.postMessage(t)},onMessage:new(0,m.Observable)(t=>{let r=/* @__PURE__ */_(e=>{t.next(e.data)},"handler");return e.addEventListener("message",r),()=>e.removeEventListener("message",r)}).pipe((0,g.shareReplay)(1))}}Z=X([K(0,(0,i.Inject)(i.Injector)),K(1,I),K(2,i.ICommandService),K(3,L)],Z),_(z,"createWebWorkerMessagePortOnWorker"),_(J,"createWebWorkerMessagePortOnMain");var ee,et=Object.defineProperty,er=Object.getOwnPropertyDescriptor,ea=/* @__PURE__ */_((e,t,r,a)=>{for(var n,i=a>1?void 0:a?er(t,r):t,s=e.length-1;s>=0;s--)(n=e[s])&&(i=(a?n(t,r,i):n(i))||i);return a&&i&&et(t,r,i),i},"__decorateClass"),en=/* @__PURE__ */_((e,t)=>(r,a)=>t(r,a,e),"__decorateParam");let ei=(ee=class extends i.Plugin{constructor(e=E,t,r){super(),C(this,"_internalWorker",null),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig("rpc.main-thread.config",a)}dispose(){super.dispose(),this._internalWorker&&(this._internalWorker.terminate(),this._internalWorker=null)}onStarting(){let{workerURL:e}=this._config;if(!e)throw Error("[UniverRPCMainThreadPlugin]: The workerURL is required for the RPC main thread plugin.");let t=e instanceof Worker?e:new Worker(e);this._internalWorker=e instanceof Worker?null:t;let r=J(t);[[L,{useFactory:/* @__PURE__ */_(()=>new w(r),"useFactory")}],[G],[O,{useClass:T}]].forEach(e=>this._injector.add(e)),this._injector.get(G)}},_(ee,"UniverRPCMainThreadPlugin"),C(ee,"pluginName","UNIVER_RPC_MAIN_THREAD_PLUGIN"),ee);ei=ea([en(1,(0,i.Inject)(i.Injector)),en(2,i.IConfigService)],ei);let es=(n=class extends i.Plugin{constructor(e=p,t,r){super(),this._config=e,this._injector=t,this._configService=r;let{...a}=this._config;this._configService.setConfig("rpc.worker-thread.config",a)}onStarting(){[[Z],[L,{useFactory:/* @__PURE__ */_(()=>new w(z()),"useFactory")}],[I,{useClass:M}]].forEach(e=>this._injector.add(e)),this._injector.get(Z)}},_(n,"UniverRPCWorkerThreadPlugin"),C(n,"pluginName","UNIVER_RPC_WORKER_THREAD_PLUGIN"),n);ea([en(1,(0,i.Inject)(i.Injector)),en(2,i.IConfigService)],es)}),r("2jrJe",function(r,a){e(r.exports,"takeUntil",function(){return u});var n=t("jSzwf"),i=t("iNetn"),s=t("b7gpN"),l=t("f1euv");function u(e){return(0,n.operate)(function(t,r){(0,s.innerFrom)(e).subscribe((0,i.createOperatorSubscriber)(r,function(){return r.complete()},l.noop)),r.closed||t.subscribe(r)})}}),r("dBx9C",function(r,a){e(r.exports,"firstValueFrom",function(){return s});var n=t("aXqMV"),i=t("lftZl");function s(e,t){var r="object"==typeof t;return new Promise(function(a,s){var l=new i.SafeSubscriber({next:function(e){a(e),l.unsubscribe()},error:s,complete:function(){r?a(t.defaultValue):s(new n.EmptyError)}});e.subscribe(l)})}}),r("hRiv7",function(r,a){e(r.exports,"isObservable",function(){return s});var n=t("1O3Nt"),i=t("3IQI0");function s(e){return!!e&&(e instanceof n.Observable||(0,i.isFunction)(e.lift)&&(0,i.isFunction)(e.subscribe))}}),r("c3hg1",function(r,a){e(r.exports,"shareReplay",function(){return s});var n=t("3rvNF"),i=t("8LCGH");function s(e,t,r){var a,s,l,u,o=!1;return e&&"object"==typeof e?(u=void 0===(a=e.bufferSize)?1/0:a,t=void 0===(s=e.windowTime)?1/0:s,o=void 0!==(l=e.refCount)&&l,r=e.scheduler):u=null!=e?e:1/0,(0,i.share)({connector:function(){return new n.ReplaySubject(u,t,r)},resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:o})}}),r("3rvNF",function(r,a){e(r.exports,"ReplaySubject",function(){return l});var n=t("1a7ft"),i=t("1mjSk"),s=t("O2Flc"),l=function(e){function t(t,r,a){void 0===t&&(t=1/0),void 0===r&&(r=1/0),void 0===a&&(a=s.dateTimestampProvider);var n=e.call(this)||this;return n._bufferSize=t,n._windowTime=r,n._timestampProvider=a,n._buffer=[],n._infiniteTimeWindow=!0,n._infiniteTimeWindow=r===1/0,n._bufferSize=Math.max(1,t),n._windowTime=Math.max(1,r),n}return(0,n.__extends)(t,e),t.prototype.next=function(t){var r=this.isStopped,a=this._buffer,n=this._infiniteTimeWindow,i=this._timestampProvider,s=this._windowTime;!r&&(a.push(t),n||a.push(i.now()+s)),this._trimBuffer(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){this._throwIfClosed(),this._trimBuffer();for(var t=this._innerSubscribe(e),r=this._infiniteTimeWindow,a=this._buffer.slice(),n=0;n<a.length&&!e.closed;n+=r?1:2)e.next(a[n]);return this._checkFinalizedStatuses(e),t},t.prototype._trimBuffer=function(){var e=this._bufferSize,t=this._timestampProvider,r=this._buffer,a=this._infiniteTimeWindow,n=(a?1:2)*e;if(e<1/0&&n<r.length&&r.splice(0,r.length-n),!a){for(var i=t.now(),s=0,l=1;l<r.length&&r[l]<=i;l+=2)s=l;s&&r.splice(0,s+1)}},t}(i.Subject)}),r("8LCGH",function(r,a){e(r.exports,"share",function(){return o});var n=t("1a7ft"),i=t("b7gpN"),s=t("1mjSk"),l=t("lftZl"),u=t("jSzwf");function o(e){void 0===e&&(e={});var t=e.connector,r=void 0===t?function(){return new s.Subject}:t,a=e.resetOnError,n=void 0===a||a,o=e.resetOnComplete,h=void 0===o||o,m=e.resetOnRefCountZero,f=void 0===m||m;return function(e){var t,a,s,o=0,m=!1,g=!1,d=function(){null==a||a.unsubscribe(),a=void 0},N=function(){d(),t=s=void 0,m=g=!1},_=function(){var e=t;N(),null==e||e.unsubscribe()};return(0,u.operate)(function(e,u){o++,g||m||d();var C=s=null!=s?s:r();u.add(function(){0!=--o||g||m||(a=c(_,f))}),C.subscribe(u),!t&&o>0&&(t=new l.SafeSubscriber({next:function(e){return C.next(e)},error:function(e){g=!0,d(),a=c(N,n,e),C.error(e)},complete:function(){m=!0,d(),a=c(N,h),C.complete()}}),(0,i.innerFrom)(e).subscribe(t))})(e)}}function c(e,t){for(var r=[],a=2;a<arguments.length;a++)r[a-2]=arguments[a];if(!0===t){e();return}if(!1!==t){var s=new l.SafeSubscriber({next:function(){s.unsubscribe(),e()}});return(0,i.innerFrom)(t.apply(void 0,(0,n.__spreadArray)([],(0,n.__read)(r)))).subscribe(s)}}});
//# sourceMappingURL=es.f492a87d.js.map
