{"mappings":"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","sources":["<anon>","node_modules/@univerjs/sheets-formula-ui/lib/es/index.js","node_modules/rxjs/dist/esm5/internal/operators/distinctUntilKeyChanged.js","node_modules/rxjs/src/internal/operators/distinctUntilKeyChanged.ts"],"sourcesContent":["\nfunction $parcel$interopDefault(a) {\n  return a && a.__esModule ? a.default : a;\n}\n\nfunction $parcel$export(e, n, v, s) {\n  Object.defineProperty(e, n, {get: v, set: s, enumerable: true, configurable: true});\n}\n\n      var $parcel$global =\n        typeof globalThis !== 'undefined'\n          ? globalThis\n          : typeof self !== 'undefined'\n          ? self\n          : typeof window !== 'undefined'\n          ? window\n          : typeof global !== 'undefined'\n          ? global\n          : {};\n  var parcelRequire = $parcel$global[\"parcelRequire26fc\"];\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"kRRWY\", function(module, exports) {\n\n$parcel$export(module.exports, \"RangeSelector\", function () { return $f3129b461bb1bc83$export$1081d70813d107d1; });\n$parcel$export(module.exports, \"UniverSheetsFormulaUIPlugin\", function () { return $f3129b461bb1bc83$export$bbd9acb515f542fd; });\n\nvar $7yNYd = parcelRequire(\"7yNYd\");\n\nvar $4XALk = parcelRequire(\"4XALk\");\n\nvar $86b1c = parcelRequire(\"86b1c\");\n\nvar $dLBA8 = parcelRequire(\"dLBA8\");\nvar $arCqp = parcelRequire(\"arCqp\");\nvar $8WNAB = parcelRequire(\"8WNAB\");\nvar $lMvMU = parcelRequire(\"lMvMU\");\nvar $hciHF = parcelRequire(\"hciHF\");\nvar $i54iF = parcelRequire(\"i54iF\");\nvar $1O3Nt = parcelRequire(\"1O3Nt\");\nvar $3yupB = parcelRequire(\"3yupB\");\nvar $1mjSk = parcelRequire(\"1mjSk\");\nvar $23cfA = parcelRequire(\"23cfA\");\nvar $gv2K9 = parcelRequire(\"gv2K9\");\n\nvar $g6Cit = parcelRequire(\"g6Cit\");\n\nvar $ejawP = parcelRequire(\"ejawP\");\n\nvar $bRzks = parcelRequire(\"bRzks\");\n\nvar $fL2Ug = parcelRequire(\"fL2Ug\");\n\nvar $5gqvu = parcelRequire(\"5gqvu\");\n\nvar $1UDbf = parcelRequire(\"1UDbf\");\n\nvar $3e0Iz = parcelRequire(\"3e0Iz\");\n\nvar $7AR1b = parcelRequire(\"7AR1b\");\n\nvar $gv2K9 = parcelRequire(\"gv2K9\");\nvar $f3129b461bb1bc83$var$__defProp = Object.defineProperty;\nvar $f3129b461bb1bc83$var$__defNormalProp = (obj, key, value)=>key in obj ? $f3129b461bb1bc83$var$__defProp(obj, key, {\n        enumerable: !0,\n        configurable: !0,\n        writable: !0,\n        value: value\n    }) : obj[key] = value;\nvar $f3129b461bb1bc83$var$__name = (target, value)=>$f3129b461bb1bc83$var$__defProp(target, \"name\", {\n        value: value,\n        configurable: !0\n    });\nvar $f3129b461bb1bc83$var$__publicField = (obj, key, value)=>$f3129b461bb1bc83$var$__defNormalProp(obj, typeof key != \"symbol\" ? key + \"\" : key, value);\nconst $f3129b461bb1bc83$export$9426163a6ae5dd94 = {\n    id: \"sheet.command.paste-formula\",\n    type: (0, $7yNYd.CommandType).COMMAND,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor)=>accessor.get((0, $7yNYd.ICommandService)).executeCommand((0, $4XALk.SheetPasteCommand).id, {\n            value: (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_FORMULA\n        }), \"handler\")\n}, $f3129b461bb1bc83$export$585b41d8b7a58a05 = {\n    id: \"formula-ui.operation.select-editor-formula\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((accessor, params)=>!0, \"handler\")\n};\nvar $f3129b461bb1bc83$var$__defProp$9 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$9 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$9 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$9(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$9(target, key, result), result;\n}, \"__decorateClass$9\"), $f3129b461bb1bc83$var$__decorateParam$9 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$9\");\nconst $f3129b461bb1bc83$export$714bd88a5dc429c5 = \"FORMULA_PROMPT_ACTIVATED\", $f3129b461bb1bc83$var$IFormulaPromptService = (0, $7yNYd.createIdentifier)(\"formula-ui.prompt-service\");\nvar $f3129b461bb1bc83$var$_a;\nlet $f3129b461bb1bc83$var$FormulaPromptService = ($f3129b461bb1bc83$var$_a = class {\n    constructor(_contextService){\n        $f3129b461bb1bc83$var$__publicField(this, \"_search$\", new (0, $1mjSk.Subject)());\n        $f3129b461bb1bc83$var$__publicField(this, \"_help$\", new (0, $1mjSk.Subject)());\n        $f3129b461bb1bc83$var$__publicField(this, \"_navigate$\", new (0, $1mjSk.Subject)());\n        $f3129b461bb1bc83$var$__publicField(this, \"_accept$\", new (0, $1mjSk.Subject)());\n        $f3129b461bb1bc83$var$__publicField(this, \"_acceptFormulaName$\", new (0, $1mjSk.Subject)());\n        $f3129b461bb1bc83$var$__publicField(this, \"search$\", this._search$.asObservable());\n        $f3129b461bb1bc83$var$__publicField(this, \"help$\", this._help$.asObservable());\n        $f3129b461bb1bc83$var$__publicField(this, \"navigate$\", this._navigate$.asObservable());\n        $f3129b461bb1bc83$var$__publicField(this, \"accept$\", this._accept$.asObservable());\n        $f3129b461bb1bc83$var$__publicField(this, \"acceptFormulaName$\", this._acceptFormulaName$.asObservable());\n        $f3129b461bb1bc83$var$__publicField(this, \"_searching\", !1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_helping\", !1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_sequenceNodes\", []);\n        $f3129b461bb1bc83$var$__publicField(this, \"_isLockedOnSelectionChangeRefString\", !1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_isLockedOnSelectionInsertRefString\", !1);\n        this._contextService = _contextService;\n    }\n    dispose() {\n        this._search$.complete(), this._help$.complete(), this._navigate$.complete(), this._accept$.complete(), this._acceptFormulaName$.complete(), this._sequenceNodes = [];\n    }\n    search(param) {\n        this._contextService.setContextValue($f3129b461bb1bc83$export$714bd88a5dc429c5, param.visible), this._searching = param.visible, this._search$.next(param);\n    }\n    isSearching() {\n        return this._searching;\n    }\n    help(param) {\n        this._helping = param.visible, this._help$.next(param);\n    }\n    isHelping() {\n        return this._helping;\n    }\n    navigate(param) {\n        this._navigate$.next(param);\n    }\n    accept(param) {\n        this._accept$.next(param);\n    }\n    acceptFormulaName(param) {\n        this._acceptFormulaName$.next(param);\n    }\n    getSequenceNodes() {\n        return [\n            ...this._sequenceNodes\n        ];\n    }\n    setSequenceNodes(nodes) {\n        this._sequenceNodes = nodes;\n    }\n    clearSequenceNodes() {\n        this._sequenceNodes = [];\n    }\n    getCurrentSequenceNode(strIndex) {\n        return this._sequenceNodes[this.getCurrentSequenceNodeIndex(strIndex)];\n    }\n    getCurrentSequenceNodeByIndex(nodeIndex) {\n        return this._sequenceNodes[nodeIndex];\n    }\n    /**\n   * Query the text coordinates in the sequenceNodes and determine the actual insertion index.\n   * @param strIndex\n   */ getCurrentSequenceNodeIndex(strIndex) {\n        let nodeIndex = 0;\n        const firstNode = this._sequenceNodes[0];\n        for(let i = 0, len = this._sequenceNodes.length; i < len; i++){\n            const node = this._sequenceNodes[i];\n            if (typeof node == \"string\") nodeIndex++;\n            else {\n                const { endIndex: endIndex } = node;\n                nodeIndex = endIndex;\n            }\n            if (strIndex <= nodeIndex) return typeof firstNode == \"string\" && strIndex !== 0 ? i + 1 : i;\n        }\n        return this._sequenceNodes.length;\n    }\n    /**\n   * Synchronize the reference text based on the changes of the selection.\n   * @param nodeIndex\n   * @param refString\n   */ updateSequenceRef(nodeIndex, refString) {\n        const node = this._sequenceNodes[nodeIndex];\n        if (typeof node == \"string\" || node.nodeType !== (0, $86b1c.sequenceNodeType).REFERENCE) return;\n        const difference = refString.length - node.token.length, newNode = {\n            ...node\n        };\n        newNode.token = refString, newNode.endIndex += difference, this._sequenceNodes[nodeIndex] = newNode;\n        for(let i = nodeIndex + 1, len = this._sequenceNodes.length; i < len; i++){\n            const node2 = this._sequenceNodes[i];\n            if (typeof node2 == \"string\") continue;\n            const newNode2 = {\n                ...node2\n            };\n            newNode2.startIndex += difference, newNode2.endIndex += difference, this._sequenceNodes[i] = newNode2;\n        }\n    }\n    /**\n   * When the cursor is on the right side of a formula token,\n   * you can add reference text to the formula by drawing a selection.\n   * @param index\n   * @param refString\n   */ insertSequenceRef(index, refString) {\n        const refStringCount = refString.length, nodeIndex = this.getCurrentSequenceNodeIndex(index);\n        this._sequenceNodes.splice(nodeIndex, 0, {\n            token: refString,\n            startIndex: index,\n            endIndex: index + refStringCount - 1,\n            nodeType: (0, $86b1c.sequenceNodeType).REFERENCE\n        });\n        for(let i = nodeIndex + 1, len = this._sequenceNodes.length; i < len; i++){\n            const node = this._sequenceNodes[i];\n            if (typeof node == \"string\") continue;\n            const newNode = {\n                ...node\n            };\n            newNode.startIndex += refStringCount, newNode.endIndex += refStringCount, this._sequenceNodes[i] = newNode;\n        }\n    }\n    /**\n   * Insert a string at the cursor position in the text corresponding to the sequenceNodes.\n   * @param index\n   * @param content\n   */ insertSequenceString(index, content) {\n        const nodeIndex = this.getCurrentSequenceNodeIndex(index), str = content.split(\"\");\n        this._sequenceNodes.splice(nodeIndex, 0, ...str);\n        const contentCount = str.length;\n        for(let i = nodeIndex + contentCount, len = this._sequenceNodes.length; i < len; i++){\n            const node = this._sequenceNodes[i];\n            if (typeof node == \"string\") continue;\n            const newNode = {\n                ...node\n            };\n            newNode.startIndex += contentCount, newNode.endIndex += contentCount, this._sequenceNodes[i] = newNode;\n        }\n    }\n    enableLockedSelectionChange() {\n        this._isLockedOnSelectionChangeRefString = !0;\n    }\n    disableLockedSelectionChange() {\n        this._isLockedOnSelectionChangeRefString = !1;\n    }\n    isLockedSelectionChange() {\n        return this._isLockedOnSelectionChangeRefString;\n    }\n    enableLockedSelectionInsert() {\n        this._isLockedOnSelectionInsertRefString = !0;\n    }\n    disableLockedSelectionInsert() {\n        this._isLockedOnSelectionInsertRefString = !1;\n    }\n    isLockedSelectionInsert() {\n        return this._isLockedOnSelectionInsertRefString;\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a, \"FormulaPromptService\"), $f3129b461bb1bc83$var$_a);\n$f3129b461bb1bc83$var$FormulaPromptService = $f3129b461bb1bc83$var$__decorateClass$9([\n    $f3129b461bb1bc83$var$__decorateParam$9(0, (0, $7yNYd.IContextService))\n], $f3129b461bb1bc83$var$FormulaPromptService);\nconst $f3129b461bb1bc83$export$d1f2080022e7b2d1 = {\n    id: \"formula-ui.operation.help-function\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor, params)=>(accessor.get($f3129b461bb1bc83$var$IFormulaPromptService).help(params), !0), \"handler\")\n}, $f3129b461bb1bc83$export$ed0c9b5405071c4d = {\n    id: \"formula-ui.operation.insert-function\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor, params)=>{\n        var _a11, _b;\n        const selectionManagerService = accessor.get((0, $ejawP.SheetsSelectionsService)), editorService = accessor.get((0, $g6Cit.IEditorService)), currentSelections = selectionManagerService.getCurrentSelections();\n        if (!currentSelections || !currentSelections.length) return !1;\n        const target = (0, $ejawP.getSheetCommandTarget)(accessor.get((0, $7yNYd.IUniverInstanceService)));\n        if (!target) return !1;\n        const { worksheet: worksheet, unitId: unitId, subUnitId: subUnitId } = target, cellMatrix = worksheet.getCellMatrix(), { value: value } = params, commandService = accessor.get((0, $7yNYd.ICommandService)), list = [];\n        let editRange = null, editRow = 0, editColumn = 0, editFormulaRangeString = \"\";\n        if (currentSelections.length === 1 && ($f3129b461bb1bc83$var$isSingleCell(currentSelections[0].range) || $f3129b461bb1bc83$var$isMultiRowsColumnsRange(currentSelections[0].range))) {\n            const { range: range, primary: primary } = currentSelections[0], row = (_a11 = primary == null ? void 0 : primary.actualRow) != null ? _a11 : range.startRow, column = (_b = primary == null ? void 0 : primary.actualColumn) != null ? _b : range.startColumn;\n            editRange = range, editRow = row, editColumn = column;\n            const refRange = $f3129b461bb1bc83$var$findRefRange(cellMatrix, row, column);\n            refRange && (editFormulaRangeString = (0, $86b1c.serializeRange)(refRange));\n        } else currentSelections.some((selection)=>{\n            var _a12, _b2;\n            const { range: range, primary: primary } = selection, row = (_a12 = primary == null ? void 0 : primary.actualRow) != null ? _a12 : range.startRow, column = (_b2 = primary == null ? void 0 : primary.actualColumn) != null ? _b2 : range.startColumn, refRange = $f3129b461bb1bc83$var$findRefRange(cellMatrix, row, column);\n            if (!refRange) return editRange = range, editRow = row, editColumn = column, !0;\n            const rangeString = (0, $86b1c.serializeRange)(refRange), formulaString = `=${value}(${rangeString})`;\n            return list.push({\n                range: range,\n                primary: {\n                    row: row,\n                    column: column\n                },\n                formula: formulaString\n            }), !1;\n        });\n        if (editRange) {\n            const destRange = (0, $ejawP.getCellAtRowCol)(editRow, editColumn, worksheet), resultRange = {\n                range: (0, $7yNYd.Rectangle).clone(editRange),\n                primary: {\n                    startRow: destRange.startRow,\n                    startColumn: destRange.startColumn,\n                    endRow: destRange.endRow,\n                    endColumn: destRange.endColumn,\n                    actualRow: editRow,\n                    actualColumn: editColumn,\n                    isMerged: destRange.isMerged,\n                    isMergedMainCell: destRange.startRow === editRow && destRange.startColumn === editColumn\n                }\n            }, setSelectionParams = {\n                unitId: unitId,\n                subUnitId: subUnitId,\n                selections: [\n                    resultRange\n                ]\n            };\n            await commandService.executeCommand((0, $ejawP.SetSelectionsOperation).id, setSelectionParams), setTimeout(()=>{\n                editorService.setFormula(`=${value}(${editFormulaRangeString}`);\n            }, 0);\n        }\n        return list.length === 0 ? !1 : commandService.executeCommand((0, $bRzks.InsertFunctionCommand).id, {\n            list: list\n        });\n    }, \"handler\")\n};\nfunction $f3129b461bb1bc83$var$findRefRange(cellMatrix, row, column) {\n    const startRow = $f3129b461bb1bc83$var$findStartRow(cellMatrix, row, column);\n    if (startRow !== row) return {\n        startRow: startRow,\n        endRow: row - 1,\n        startColumn: column,\n        endColumn: column\n    };\n    const startColumn = $f3129b461bb1bc83$var$findStartColumn(cellMatrix, row, column);\n    return startColumn !== column ? {\n        startRow: row,\n        endRow: row,\n        startColumn: startColumn,\n        endColumn: column - 1\n    } : null;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$findRefRange, \"findRefRange\");\nfunction $f3129b461bb1bc83$var$findStartRow(cellMatrix, row, column) {\n    let isFirstNumber = !1;\n    if (row === 0) return row;\n    for(let r2 = row - 1; r2 >= 0; r2--){\n        const cell = cellMatrix.getValue(r2, column);\n        if ($f3129b461bb1bc83$var$isNumberCell(cell) && !isFirstNumber) {\n            if (r2 === 0) return 0;\n            isFirstNumber = !0;\n        } else {\n            if (isFirstNumber && !$f3129b461bb1bc83$var$isNumberCell(cell)) return r2 + 1;\n            if (isFirstNumber && r2 === 0) return 0;\n        }\n    }\n    return row;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$findStartRow, \"findStartRow\");\nfunction $f3129b461bb1bc83$var$findStartColumn(cellMatrix, row, column) {\n    let isFirstNumber = !1;\n    if (column === 0) return column;\n    for(let c = column - 1; c >= 0; c--){\n        const cell = cellMatrix.getValue(row, c);\n        if ($f3129b461bb1bc83$var$isNumberCell(cell) && !isFirstNumber) {\n            if (c === 0) return 0;\n            isFirstNumber = !0;\n        } else {\n            if (isFirstNumber && !$f3129b461bb1bc83$var$isNumberCell(cell)) return c + 1;\n            if (isFirstNumber && c === 0) return 0;\n        }\n    }\n    return column;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$findStartColumn, \"findStartColumn\");\nfunction $f3129b461bb1bc83$var$isNumberCell(cell) {\n    if (cell != null && cell.p) {\n        const body = cell == null ? void 0 : cell.p.body;\n        if (body == null) return !1;\n        const data = body.dataStream, newDataStream = data.substring(data.length - 2, data.length) === (0, $7yNYd.DEFAULT_EMPTY_DOCUMENT_VALUE) ? data.substring(0, data.length - 2) : data;\n        return (0, $7yNYd.isRealNum)(newDataStream);\n    }\n    return cell && (cell.t === (0, $7yNYd.CellValueType).NUMBER || (0, $7yNYd.getCellValueType)(cell) === (0, $7yNYd.CellValueType).NUMBER);\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$isNumberCell, \"isNumberCell\");\nfunction $f3129b461bb1bc83$var$isSingleCell(range) {\n    return range.startRow === range.endRow && range.startColumn === range.endColumn;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$isSingleCell, \"isSingleCell\");\nfunction $f3129b461bb1bc83$var$isMultiRowsColumnsRange(range) {\n    return range.startRow !== range.endRow && range.startColumn !== range.endColumn;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$isMultiRowsColumnsRange, \"isMultiRowsColumnsRange\");\nconst $f3129b461bb1bc83$var$FORMULA_UI_PLUGIN_NAME = \"SHEET_FORMULA_UI_PLUGIN\", $f3129b461bb1bc83$var$MORE_FUNCTIONS_COMPONENT = `${$f3129b461bb1bc83$var$FORMULA_UI_PLUGIN_NAME}_MORE_FUNCTIONS_COMPONENT`, $f3129b461bb1bc83$export$c1b1be2f114a38f5 = {\n    id: \"formula-ui.operation.more-functions\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor)=>(accessor.get((0, $fL2Ug.ISidebarService)).open({\n            header: {\n                title: \"formula.insert.tooltip\"\n            },\n            children: {\n                label: $f3129b461bb1bc83$var$MORE_FUNCTIONS_COMPONENT\n            }\n        }), !0), \"handler\")\n}, $f3129b461bb1bc83$export$39056a97b2a0b835 = {\n    id: \"formula-ui.operation.change-ref-to-absolute\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor)=>!0, \"handler\")\n}, $f3129b461bb1bc83$export$2ab1570c3479c5b1 = {\n    id: \"formula-ui.operation.search-function\",\n    type: (0, $7yNYd.CommandType).OPERATION,\n    handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(async (accessor, params)=>(accessor.get($f3129b461bb1bc83$var$IFormulaPromptService).search(params), !0), \"handler\")\n};\nvar $f3129b461bb1bc83$var$jsxRuntime = {\n    exports: {}\n}, $f3129b461bb1bc83$var$reactJsxRuntime_production_min = {};\n/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */ var $f3129b461bb1bc83$var$f = (0, (/*@__PURE__*/$parcel$interopDefault($5gqvu))), $f3129b461bb1bc83$var$k = Symbol.for(\"react.element\"), $f3129b461bb1bc83$var$l = Symbol.for(\"react.fragment\"), $f3129b461bb1bc83$var$m = Object.prototype.hasOwnProperty, $f3129b461bb1bc83$var$n = $f3129b461bb1bc83$var$f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner, $f3129b461bb1bc83$var$p = {\n    key: !0,\n    ref: !0,\n    __self: !0,\n    __source: !0\n};\nfunction $f3129b461bb1bc83$var$q(c, a, g) {\n    var b, d = {}, e = null, h = null;\n    g !== void 0 && (e = \"\" + g), a.key !== void 0 && (e = \"\" + a.key), a.ref !== void 0 && (h = a.ref);\n    for(b in a)$f3129b461bb1bc83$var$m.call(a, b) && !$f3129b461bb1bc83$var$p.hasOwnProperty(b) && (d[b] = a[b]);\n    if (c && c.defaultProps) for(b in a = c.defaultProps, a)d[b] === void 0 && (d[b] = a[b]);\n    return {\n        $$typeof: $f3129b461bb1bc83$var$k,\n        type: c,\n        key: e,\n        ref: h,\n        props: d,\n        _owner: $f3129b461bb1bc83$var$n.current\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$q, \"q\");\n$f3129b461bb1bc83$var$reactJsxRuntime_production_min.Fragment = $f3129b461bb1bc83$var$l;\n$f3129b461bb1bc83$var$reactJsxRuntime_production_min.jsx = $f3129b461bb1bc83$var$q;\n$f3129b461bb1bc83$var$reactJsxRuntime_production_min.jsxs = $f3129b461bb1bc83$var$q;\n$f3129b461bb1bc83$var$jsxRuntime.exports = $f3129b461bb1bc83$var$reactJsxRuntime_production_min;\nvar $f3129b461bb1bc83$var$jsxRuntimeExports = $f3129b461bb1bc83$var$jsxRuntime.exports, $f3129b461bb1bc83$var$__assign = function() {\n    return $f3129b461bb1bc83$var$__assign = Object.assign || function(t) {\n        for(var s, i = 1, n2 = arguments.length; i < n2; i++){\n            s = arguments[i];\n            for(var p2 in s)Object.prototype.hasOwnProperty.call(s, p2) && (t[p2] = s[p2]);\n        }\n        return t;\n    }, $f3129b461bb1bc83$var$__assign.apply(this, arguments);\n}, $f3129b461bb1bc83$var$__rest = function(s, e) {\n    var t = {};\n    for(var p2 in s)Object.prototype.hasOwnProperty.call(s, p2) && e.indexOf(p2) < 0 && (t[p2] = s[p2]);\n    if (s != null && typeof Object.getOwnPropertySymbols == \"function\") for(var i = 0, p2 = Object.getOwnPropertySymbols(s); i < p2.length; i++)e.indexOf(p2[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p2[i]) && (t[p2[i]] = s[p2[i]]);\n    return t;\n}, $f3129b461bb1bc83$var$IconBase = (0, $5gqvu.forwardRef)(function(props, ref) {\n    var icon = props.icon, id = props.id, className = props.className, extend = props.extend, restProps = $f3129b461bb1bc83$var$__rest(props, [\n        \"icon\",\n        \"id\",\n        \"className\",\n        \"extend\"\n    ]), cls = \"univerjs-icon univerjs-icon-\".concat(id, \" \").concat(className || \"\").trim(), idSuffix = (0, $5gqvu.useRef)(\"_\".concat($f3129b461bb1bc83$var$generateShortUuid()));\n    return $f3129b461bb1bc83$var$render(icon, \"\".concat(id), {\n        defIds: icon.defIds,\n        idSuffix: idSuffix.current\n    }, $f3129b461bb1bc83$var$__assign({\n        ref: ref,\n        className: cls\n    }, restProps), extend);\n});\nfunction $f3129b461bb1bc83$var$render(node, id, runtimeProps, rootProps, extend) {\n    return (0, $5gqvu.createElement)(node.tag, $f3129b461bb1bc83$var$__assign($f3129b461bb1bc83$var$__assign({\n        key: id\n    }, $f3129b461bb1bc83$var$replaceRuntimeIdsAndExtInAttrs(node, runtimeProps, extend)), rootProps), ($f3129b461bb1bc83$var$replaceRuntimeIdsInDefs(node, runtimeProps).children || []).map(function(child, index) {\n        return $f3129b461bb1bc83$var$render(child, \"\".concat(id, \"-\").concat(node.tag, \"-\").concat(index), runtimeProps, void 0, extend);\n    }));\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$render, \"render\");\nfunction $f3129b461bb1bc83$var$replaceRuntimeIdsAndExtInAttrs(node, runtimeProps, extend) {\n    var attrs = $f3129b461bb1bc83$var$__assign({}, node.attrs);\n    extend != null && extend.colorChannel1 && attrs.fill === \"colorChannel1\" && (attrs.fill = extend.colorChannel1);\n    var defIds = runtimeProps.defIds;\n    return !defIds || defIds.length === 0 || (node.tag === \"use\" && attrs[\"xlink:href\"] && (attrs[\"xlink:href\"] = attrs[\"xlink:href\"] + runtimeProps.idSuffix), Object.entries(attrs).forEach(function(_a11) {\n        var key = _a11[0], value = _a11[1];\n        typeof value == \"string\" && (attrs[key] = value.replace(/url\\(#(.*)\\)/, \"url(#$1\".concat(runtimeProps.idSuffix, \")\")));\n    })), attrs;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$replaceRuntimeIdsAndExtInAttrs, \"replaceRuntimeIdsAndExtInAttrs\");\nfunction $f3129b461bb1bc83$var$replaceRuntimeIdsInDefs(node, runtimeProps) {\n    var _a11, defIds = runtimeProps.defIds;\n    return !defIds || defIds.length === 0 ? node : node.tag === \"defs\" && !((_a11 = node.children) === null || _a11 === void 0) && _a11.length ? $f3129b461bb1bc83$var$__assign($f3129b461bb1bc83$var$__assign({}, node), {\n        children: node.children.map(function(child) {\n            return typeof child.attrs.id == \"string\" && defIds && defIds.indexOf(child.attrs.id) > -1 ? $f3129b461bb1bc83$var$__assign($f3129b461bb1bc83$var$__assign({}, child), {\n                attrs: $f3129b461bb1bc83$var$__assign($f3129b461bb1bc83$var$__assign({}, child.attrs), {\n                    id: child.attrs.id + runtimeProps.idSuffix\n                })\n            }) : child;\n        })\n    }) : node;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$replaceRuntimeIdsInDefs, \"replaceRuntimeIdsInDefs\");\nfunction $f3129b461bb1bc83$var$generateShortUuid() {\n    return Math.random().toString(36).substring(2, 8);\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$generateShortUuid, \"generateShortUuid\");\n$f3129b461bb1bc83$var$IconBase.displayName = \"UniverIcon\";\nvar $f3129b461bb1bc83$var$element$6 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z\",\n                fillRule: \"evenodd\",\n                clipRule: \"evenodd\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$CheckMarkSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"check-mark-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$6\n    }));\n});\n$f3129b461bb1bc83$var$CheckMarkSingle.displayName = \"CheckMarkSingle\";\nvar $f3129b461bb1bc83$var$element$5 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$CloseSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"close-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$5\n    }));\n});\n$f3129b461bb1bc83$var$CloseSingle.displayName = \"CloseSingle\";\nvar $f3129b461bb1bc83$var$element$4 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M5.3313 1.4667C5.3313 1.13533 5.59993.866699 5.9313.866699H10.069C10.4004.866699 10.669 1.13533 10.669 1.4667 10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667zM1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443 14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443zM6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928 9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171 10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778 9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539 9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263 6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539 5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778 6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171z\"\n            }\n        },\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z\",\n                fillRule: \"evenodd\",\n                clipRule: \"evenodd\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$DeleteSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"delete-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$4\n    }));\n});\n$f3129b461bb1bc83$var$DeleteSingle.displayName = \"DeleteSingle\";\nvar $f3129b461bb1bc83$var$element$3 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M8.75 5.32495C8.75 5.73916 8.41421 6.07495 8 6.07495 7.58579 6.07495 7.25 5.73916 7.25 5.32495 7.25 4.91074 7.58579 4.57495 8 4.57495 8.41421 4.57495 8.75 4.91074 8.75 5.32495zM8.5999 7.52505C8.5999 7.19368 8.33127 6.92505 7.9999 6.92505 7.66853 6.92505 7.3999 7.19368 7.3999 7.52505V11.425C7.3999 11.7564 7.66853 12.025 7.9999 12.025 8.33127 12.025 8.5999 11.7564 8.5999 11.425V7.52505z\"\n            }\n        },\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M0.899902 8.00002C0.899902 4.0788 4.07868 0.900024 7.9999 0.900024C11.9211 0.900024 15.0999 4.0788 15.0999 8.00002C15.0999 11.9212 11.9211 15.1 7.9999 15.1C4.07868 15.1 0.899902 11.9212 0.899902 8.00002ZM7.9999 2.10002C4.74142 2.10002 2.0999 4.74154 2.0999 8.00002C2.0999 11.2585 4.74142 13.9 7.9999 13.9C11.2584 13.9 13.8999 11.2585 13.8999 8.00002C13.8999 4.74154 11.2584 2.10002 7.9999 2.10002Z\",\n                fillRule: \"evenodd\",\n                clipRule: \"evenodd\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$DetailsSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"details-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$3\n    }));\n});\n$f3129b461bb1bc83$var$DetailsSingle.displayName = \"DetailsSingle\";\nvar $f3129b461bb1bc83$var$element$2 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$IncreaseSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"increase-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$2\n    }));\n});\n$f3129b461bb1bc83$var$IncreaseSingle.displayName = \"IncreaseSingle\";\nvar $f3129b461bb1bc83$var$element$1 = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z\",\n                fillRule: \"evenodd\",\n                clipRule: \"evenodd\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$MoreSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"more-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element$1\n    }));\n});\n$f3129b461bb1bc83$var$MoreSingle.displayName = \"MoreSingle\";\nvar $f3129b461bb1bc83$var$element = {\n    tag: \"svg\",\n    attrs: {\n        fill: \"none\",\n        viewBox: \"0 0 16 16\",\n        width: \"1em\",\n        height: \"1em\"\n    },\n    children: [\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M12.6185 12.4423C12.5907 12.2749 12.7773 12.15 12.9343 12.2308L15.4242 13.5126C15.6102 13.6084 15.5544 13.8745 15.3439 13.8955L14.2456 14.184L13.4521 15.1286C13.3495 15.2939 13.085 15.2463 13.0534 15.0568L12.6185 12.4423Z\"\n            }\n        },\n        {\n            tag: \"path\",\n            attrs: {\n                fill: \"currentColor\",\n                d: \"M1 3.6C1 2.16406 2.16406 1 3.6 1H12.3C13.7359 1 14.9 2.16406 14.9 3.6V5.81156C14.9003 5.81881 14.9004 5.82609 14.9004 5.8334C14.9004 5.84071 14.9003 5.84799 14.9 5.85524V10.045C14.9003 10.0522 14.9004 10.0595 14.9004 10.0668C14.9004 10.3982 14.6318 10.6668 14.3004 10.6668H11.1668C10.8907 10.6668 10.6668 10.8907 10.6668 11.1668V14.3C10.6668 14.6314 10.3982 14.9 10.0668 14.9L10.05 14.8998L3.6 14.9C2.16406 14.9 1 13.7359 1 12.3V3.6ZM13.2 5.2334C13.4761 5.2334 13.7 5.00954 13.7 4.7334V3.6C13.7 2.8268 13.0732 2.2 12.3 2.2H11.1668C10.8907 2.2 10.6668 2.42386 10.6668 2.7V4.7334C10.6668 5.00954 10.8907 5.2334 11.1668 5.2334H13.2ZM10.6668 6.9334C10.6668 6.65726 10.8907 6.4334 11.1668 6.4334H13.2C13.4761 6.4334 13.7 6.65726 13.7 6.9334V8.9668C13.7 9.24294 13.4761 9.4668 13.2 9.4668H11.1668C10.8907 9.4668 10.6668 9.24294 10.6668 8.9668V6.9334ZM8.9668 5.2334C9.24294 5.2334 9.4668 5.00954 9.4668 4.7334V2.7C9.4668 2.42386 9.24294 2.2 8.9668 2.2H6.9334C6.65726 2.2 6.4334 2.42386 6.4334 2.7V4.7334C6.4334 5.00954 6.65726 5.2334 6.9334 5.2334L8.9668 5.2334ZM6.4334 6.9334C6.4334 6.65726 6.65726 6.4334 6.9334 6.4334L8.9668 6.4334C9.24294 6.4334 9.4668 6.65726 9.4668 6.9334V8.9668C9.4668 9.24294 9.24294 9.4668 8.9668 9.4668L6.9334 9.4668C6.65726 9.4668 6.4334 9.24294 6.4334 8.9668V6.9334ZM4.7334 5.2334C5.00954 5.2334 5.2334 5.00954 5.2334 4.7334V2.7C5.2334 2.42386 5.00954 2.2 4.7334 2.2H3.6C2.8268 2.2 2.2 2.8268 2.2 3.6V4.7334C2.2 5.00954 2.42386 5.2334 2.7 5.2334H4.7334ZM2.2 6.9334C2.2 6.65726 2.42386 6.4334 2.7 6.4334H4.7334C5.00954 6.4334 5.2334 6.65725 5.2334 6.9334V8.9668C5.2334 9.24294 5.00954 9.4668 4.7334 9.4668H2.7C2.42386 9.4668 2.2 9.24294 2.2 8.9668V6.9334ZM5.2334 11.1668C5.2334 10.8907 5.00954 10.6668 4.7334 10.6668H2.7C2.42386 10.6668 2.2 10.8907 2.2 11.1668V12.3C2.2 13.0732 2.8268 13.7 3.6 13.7H4.7334C5.00954 13.7 5.2334 13.4761 5.2334 13.2V11.1668ZM9.4668 11.1668C9.4668 10.8907 9.24294 10.6668 8.9668 10.6668H6.9334C6.65726 10.6668 6.4334 10.8907 6.4334 11.1668V13.2C6.4334 13.4761 6.65726 13.7 6.9334 13.7H8.9668C9.24294 13.7 9.4668 13.4761 9.4668 13.2V11.1668Z\",\n                fillRule: \"evenodd\",\n                clipRule: \"evenodd\"\n            }\n        }\n    ]\n}, $f3129b461bb1bc83$var$SelectRangeSingle = (0, $5gqvu.forwardRef)(function(props, ref) {\n    return (0, $5gqvu.createElement)($f3129b461bb1bc83$var$IconBase, Object.assign({}, props, {\n        id: \"select-range-single\",\n        ref: ref,\n        icon: $f3129b461bb1bc83$var$element\n    }));\n});\n$f3129b461bb1bc83$var$SelectRangeSingle.displayName = \"SelectRangeSingle\";\nfunction $f3129b461bb1bc83$var$r(e) {\n    var t, f2, n2 = \"\";\n    if (typeof e == \"string\" || typeof e == \"number\") n2 += e;\n    else if (typeof e == \"object\") {\n        if (Array.isArray(e)) {\n            var o = e.length;\n            for(t = 0; t < o; t++)e[t] && (f2 = $f3129b461bb1bc83$var$r(e[t])) && (n2 && (n2 += \" \"), n2 += f2);\n        } else for(f2 in e)e[f2] && (n2 && (n2 += \" \"), n2 += f2);\n    }\n    return n2;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$r, \"r\");\nfunction $f3129b461bb1bc83$var$clsx() {\n    for(var e, t, f2 = 0, n2 = \"\", o = arguments.length; f2 < o; f2++)(e = arguments[f2]) && (t = $f3129b461bb1bc83$var$r(e)) && (n2 && (n2 += \" \"), n2 += t);\n    return n2;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$clsx, \"clsx\");\nvar $f3129b461bb1bc83$var$__defProp$8 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$8 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$8 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$8(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$8(target, key, result), result;\n}, \"__decorateClass$8\"), $f3129b461bb1bc83$var$__decorateParam$8 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$8\"), $f3129b461bb1bc83$var$_a2;\nlet $f3129b461bb1bc83$export$c157cedf8ddabc0a = ($f3129b461bb1bc83$var$_a2 = class extends (0, $4XALk.BaseSelectionRenderService) {\n    constructor(_context, injector, themeService, shortcutService, sheetSkeletonManagerService, _refSelectionsService){\n        super(injector, themeService, shortcutService, sheetSkeletonManagerService);\n        $f3129b461bb1bc83$var$__publicField(this, \"_workbookSelections\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_eventDisposables\");\n        this._context = _context, this._refSelectionsService = _refSelectionsService, this._workbookSelections = this._refSelectionsService.getWorkbookSelections(this._context.unitId), this._initSelectionChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener(), this._setSelectionStyle($f3129b461bb1bc83$var$getDefaultRefSelectionStyle(this._themeService)), this._remainLastEnabled = !0;\n    }\n    getLocation() {\n        return this._skeleton.getLocation();\n    }\n    setRemainLastEnabled(enabled) {\n        this._remainLastEnabled = enabled;\n    }\n    /**\n   * This is set to true when you need to add a new selection.\n   * @param {boolean} enabled\n   * @memberof RefSelectionsRenderService\n   */ setSkipLastEnabled(enabled) {\n        this._skipLastEnabled = enabled;\n    }\n    clearLastSelection() {\n        const last = this._selectionControls[this._selectionControls.length - 1];\n        last && (last.dispose(), this._selectionControls.pop());\n    }\n    /**\n   * Call this method and user will be able to select on the canvas to update selections.\n   */ enableSelectionChanging() {\n        return this._disableSelectionChanging(), this._eventDisposables = this._initCanvasEventListeners(), (0, $7yNYd.toDisposable)(()=>this._disableSelectionChanging());\n    }\n    _disableSelectionChanging() {\n        var _a11;\n        (_a11 = this._eventDisposables) == null || _a11.dispose(), this._eventDisposables = null;\n    }\n    _initCanvasEventListeners() {\n        const sheetObject = this._getSheetObject(), { spreadsheetRowHeader: spreadsheetRowHeader, spreadsheetColumnHeader: spreadsheetColumnHeader, spreadsheet: spreadsheet, spreadsheetLeftTopPlaceholder: spreadsheetLeftTopPlaceholder } = sheetObject, { scene: scene } = this._context, listenerDisposables = new (0, $7yNYd.DisposableCollection)();\n        return listenerDisposables.add(spreadsheet == null ? void 0 : spreadsheet.onPointerDown$.subscribeEvent((evt, state)=>{\n            this._onPointerDown(evt, spreadsheet.zIndex + 1, (0, $7yNYd.RANGE_TYPE).NORMAL, this._getActiveViewport(evt)), evt.button !== 2 && state.stopPropagation();\n        })), listenerDisposables.add(spreadsheetRowHeader == null ? void 0 : spreadsheetRowHeader.onPointerDown$.subscribeEvent((evt, state)=>{\n            const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, { row: row } = (0, $4XALk.getCoordByOffset)(evt.offsetX, evt.offsetY, scene, skeleton);\n            (0, $4XALk.checkInHeaderRanges)(this._workbookSelections.getCurrentSelections(), row, (0, $7yNYd.RANGE_TYPE).ROW) || (this._onPointerDown(evt, (spreadsheet.zIndex || 1) + 1, (0, $7yNYd.RANGE_TYPE).ROW, this._getActiveViewport(evt), (0, $3e0Iz.ScrollTimerType).Y), evt.button !== 2 && state.stopPropagation());\n        })), listenerDisposables.add(spreadsheetColumnHeader == null ? void 0 : spreadsheetColumnHeader.onPointerDown$.subscribeEvent((evt, state)=>{\n            const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, { column: column } = (0, $4XALk.getCoordByOffset)(evt.offsetX, evt.offsetY, scene, skeleton);\n            (0, $4XALk.checkInHeaderRanges)(this._workbookSelections.getCurrentSelections(), column, (0, $7yNYd.RANGE_TYPE).COLUMN) || (this._onPointerDown(evt, (spreadsheet.zIndex || 1) + 1, (0, $7yNYd.RANGE_TYPE).COLUMN, this._getActiveViewport(evt), (0, $3e0Iz.ScrollTimerType).X), evt.button !== 2 && state.stopPropagation());\n        })), listenerDisposables.add(spreadsheetLeftTopPlaceholder == null ? void 0 : spreadsheetLeftTopPlaceholder.onPointerDown$.subscribeEvent((evt, state)=>{\n            this._reset();\n            const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, selectionWithStyle = (0, $4XALk.getAllSelection)(skeleton), selectionData = this.attachSelectionWithCoord(selectionWithStyle);\n            this._addSelectionControlBySelectionData(selectionData), this._selectionMoveStart$.next(this.getSelectionDataWithStyle());\n            const dispose = scene.onPointerUp$.subscribeEvent(()=>{\n                dispose.unsubscribe(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());\n            });\n            evt.button !== 2 && state.stopPropagation();\n        })), listenerDisposables;\n    }\n    /**\n   * Update selectionModel in this._workbookSelections by user action in spreadsheet area.\n   */ _initUserActionSyncListener() {\n        this.disposeWithMe(this.selectionMoveStart$.subscribe((selectionDataWithStyle)=>{\n            this._updateSelections(selectionDataWithStyle, (0, $ejawP.SelectionMoveType).MOVE_START);\n        })), this.disposeWithMe(this.selectionMoving$.subscribe((selectionDataWithStyle)=>{\n            this._updateSelections(selectionDataWithStyle, (0, $ejawP.SelectionMoveType).MOVING);\n        })), this.disposeWithMe(this.selectionMoveEnd$.subscribe((selectionDataWithStyle)=>{\n            this._updateSelections(selectionDataWithStyle, (0, $ejawP.SelectionMoveType).MOVE_END);\n        }));\n    }\n    _updateSelections(selectionDataWithStyleList, type) {\n        const sheetId = this._context.unit.getActiveSheet().getSheetId();\n        selectionDataWithStyleList.length !== 0 && this._workbookSelections.setSelections(sheetId, selectionDataWithStyleList.map((selectionDataWithStyle)=>(0, $ejawP.convertSelectionDataToRange)(selectionDataWithStyle)), type);\n    }\n    _initSelectionChangeListener() {\n        this.disposeWithMe((0, $i54iF.merge)(this._workbookSelections.selectionMoveEnd$, this._workbookSelections.selectionSet$).subscribe((selectionsWithStyles)=>{\n            this._reset();\n            for (const selectionWithStyle of selectionsWithStyles){\n                const selectionData = this.attachSelectionWithCoord(selectionWithStyle);\n                this._addSelectionControlBySelectionData(selectionData);\n            }\n        }));\n    }\n    _initSkeletonChangeListener() {\n        this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((param)=>{\n            if (!param) return;\n            const { skeleton: skeleton } = param, { scene: scene } = this._context, viewportMain = scene.getViewport((0, $3e0Iz.SHEET_VIEWPORT_KEY).VIEW_MAIN);\n            this._skeleton && this._skeleton.worksheet.getSheetId() !== skeleton.worksheet.getSheetId() && this._reset(), this._changeRuntime(skeleton, scene, viewportMain);\n            const currentSelections = this._workbookSelections.getCurrentSelections();\n            this._refreshSelectionControl(currentSelections || []);\n        }));\n    }\n    _refreshSelectionControl(selectionsData) {\n        const selections = selectionsData.map((selectionWithStyle)=>(0, $4XALk.attachSelectionWithCoord)(selectionWithStyle, this._skeleton));\n        this.updateControlForCurrentByRangeData(selections);\n    }\n    _getActiveViewport(evt) {\n        const sheetObject = this._getSheetObject();\n        return sheetObject == null ? void 0 : sheetObject.scene.getActiveViewportByCoord((0, $3e0Iz.Vector2).FromArray([\n            evt.offsetX,\n            evt.offsetY\n        ]));\n    }\n    _getSheetObject() {\n        return (0, $4XALk.getSheetObject)(this._context.unit, this._context);\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a2, \"RefSelectionsRenderService\"), $f3129b461bb1bc83$var$_a2);\n$f3129b461bb1bc83$export$c157cedf8ddabc0a = $f3129b461bb1bc83$var$__decorateClass$8([\n    $f3129b461bb1bc83$var$__decorateParam$8(1, (0, $7yNYd.Inject)((0, $7yNYd.Injector))),\n    $f3129b461bb1bc83$var$__decorateParam$8(2, (0, $7yNYd.Inject)((0, $7yNYd.ThemeService))),\n    $f3129b461bb1bc83$var$__decorateParam$8(3, (0, $fL2Ug.IShortcutService)),\n    $f3129b461bb1bc83$var$__decorateParam$8(4, (0, $7yNYd.Inject)((0, $4XALk.SheetSkeletonManagerService))),\n    $f3129b461bb1bc83$var$__decorateParam$8(5, (0, $ejawP.IRefSelectionsService))\n], $f3129b461bb1bc83$export$c157cedf8ddabc0a);\nfunction $f3129b461bb1bc83$var$getDefaultRefSelectionStyle(themeService) {\n    const style = (0, $ejawP.getNormalSelectionStyle)(themeService);\n    return style.hasAutoFill = !1, style.hasRowHeader = !1, style.hasColumnHeader = !1, style.widgets = {\n        tl: !0,\n        tc: !0,\n        tr: !0,\n        ml: !0,\n        mr: !0,\n        bl: !0,\n        bc: !0,\n        br: !0\n    }, style;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getDefaultRefSelectionStyle, \"getDefaultRefSelectionStyle\");\nconst $f3129b461bb1bc83$var$useEditorInput = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((unitId, rangeString, editor)=>{\n    const render2 = (0, $7yNYd.useDependency)((0, $3e0Iz.IRenderManagerService)).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with($f3129b461bb1bc83$export$c157cedf8ddabc0a);\n    (0, $5gqvu.useEffect)(()=>{\n        if (editor && refSelectionsRenderService) {\n            const d = editor.input$.subscribe((e)=>{\n                e.content === (0, $86b1c.matchToken).COMMA ? refSelectionsRenderService.setSkipLastEnabled(!0) : refSelectionsRenderService.setSkipLastEnabled(!1);\n            });\n            return ()=>{\n                d.unsubscribe();\n            };\n        }\n    }, [\n        editor,\n        refSelectionsRenderService\n    ]), (0, $5gqvu.useEffect)(()=>{\n        refSelectionsRenderService && (rangeString.endsWith((0, $86b1c.matchToken).COMMA) || refSelectionsRenderService.setSkipLastEnabled(!1));\n    }, [\n        rangeString,\n        refSelectionsRenderService\n    ]);\n}, \"useEditorInput\"), $f3129b461bb1bc83$var$useFormulaToken = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((text)=>{\n    const lexerTreeBuilder = (0, $7yNYd.useDependency)((0, $86b1c.LexerTreeBuilder)), [sequenceNodes, sequenceNodesSet] = (0, $5gqvu.useState)([]);\n    return (0, $5gqvu.useEffect)(()=>{\n        var _a11;\n        sequenceNodesSet((_a11 = lexerTreeBuilder.sequenceNodesBuilder(text)) != null ? _a11 : []);\n    }, [\n        text\n    ]), {\n        sequenceNodes: sequenceNodes,\n        sequenceNodesSet: sequenceNodesSet\n    };\n}, \"useFormulaToken\");\nfunction $f3129b461bb1bc83$var$useSheetHighlight(isNeed, unitId, subUnitId, refSelections) {\n    const univerInstanceService = (0, $7yNYd.useDependency)((0, $7yNYd.IUniverInstanceService)), themeService = (0, $7yNYd.useDependency)((0, $7yNYd.ThemeService)), refSelectionsService = (0, $7yNYd.useDependency)((0, $ejawP.IRefSelectionsService)), render2 = (0, $7yNYd.useDependency)((0, $3e0Iz.IRenderManagerService)).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with($f3129b461bb1bc83$export$c157cedf8ddabc0a), sheetSkeletonManagerService = render2 == null ? void 0 : render2.with((0, $4XALk.SheetSkeletonManagerService)), [ranges, rangesSet] = (0, $5gqvu.useState)([]);\n    (0, $5gqvu.useEffect)(()=>{\n        const workbook = univerInstanceService.getUnit(unitId), worksheet = workbook == null ? void 0 : workbook.getActiveSheet(), selectionWithStyle = [];\n        if (!workbook || !worksheet || !isNeed) {\n            rangesSet(selectionWithStyle);\n            return;\n        }\n        const currentSheetId = worksheet == null ? void 0 : worksheet.getSheetId(), getSheetIdByName = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((name)=>{\n            var _a11;\n            return (_a11 = workbook == null ? void 0 : workbook.getSheetBySheetName(name)) == null ? void 0 : _a11.getSheetId();\n        }, \"getSheetIdByName\");\n        for(let i = 0, len = refSelections.length; i < len; i++){\n            const refSelection = refSelections[i], { themeColor: themeColor, token: token, refIndex: refIndex } = refSelection, unitRangeName = (0, $86b1c.deserializeRangeWithSheet)(token), { unitId: refUnitId, sheetName: sheetName, range: rawRange } = unitRangeName;\n            if (refUnitId && unitId !== refUnitId) continue;\n            const refSheetId = getSheetIdByName(sheetName);\n            if (refSheetId && refSheetId !== currentSheetId) continue;\n            const range = (0, $ejawP.setEndForRange)(rawRange, worksheet.getRowCount(), worksheet.getColumnCount());\n            selectionWithStyle.push({\n                range: range,\n                primary: void 0,\n                style: $f3129b461bb1bc83$var$getFormulaRefSelectionStyle$1(themeService, themeColor, refIndex.toString())\n            });\n        }\n        rangesSet(selectionWithStyle);\n    }, [\n        unitId,\n        subUnitId,\n        refSelections,\n        isNeed\n    ]), (0, $5gqvu.useEffect)(()=>{\n        const skeleton = sheetSkeletonManagerService == null ? void 0 : sheetSkeletonManagerService.getCurrentSkeleton();\n        if (skeleton) {\n            const allControls = (refSelectionsRenderService == null ? void 0 : refSelectionsRenderService.getSelectionControls()) || [];\n            allControls.length === ranges.length ? allControls.forEach((control, index)=>{\n                const selection = ranges[index], primaryCell = skeleton.getCellByIndex(selection.range.startRow, selection.range.startColumn);\n                control.updateRange((0, $4XALk.attachRangeWithCoord)(skeleton, selection.range), primaryCell), control.updateStyle(selection.style);\n            }) : refSelectionsService.setSelections(ranges);\n        }\n    }, [\n        ranges,\n        sheetSkeletonManagerService\n    ]), (0, $5gqvu.useEffect)(()=>()=>{\n            refSelectionsService.setSelections([]);\n        }, []);\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$useSheetHighlight, \"useSheetHighlight\");\nfunction $f3129b461bb1bc83$var$useDocHight(editorId, sequenceNodes) {\n    const editorService = (0, $7yNYd.useDependency)((0, $g6Cit.IEditorService)), descriptionService = (0, $7yNYd.useDependency)((0, $bRzks.IDescriptionService)), colorMap = $f3129b461bb1bc83$var$useColor(), [ranges, rangesSet] = (0, $5gqvu.useState)([]);\n    return (0, $5gqvu.useEffect)(()=>{\n        const editor = editorService.getEditor(editorId);\n        if (!editor) return;\n        const data = editor.getDocumentData();\n        if (!data || !data.body) return;\n        const cloneBody = {\n            dataStream: \"\",\n            ...data.body\n        };\n        if (sequenceNodes == null || sequenceNodes.length === 0) cloneBody.textRuns = [], cloneBody.dataStream = `\\r\n`, rangesSet([]);\n        else {\n            const { textRuns: textRuns, refSelections: refSelections } = $f3129b461bb1bc83$var$buildTextRuns(descriptionService, colorMap, sequenceNodes);\n            cloneBody.textRuns = textRuns;\n            const text = sequenceNodes.reduce((pre, cur)=>typeof cur == \"string\" ? `${pre}${cur}` : `${pre}${cur.token}`, \"\");\n            cloneBody.dataStream = `${text}\\r\n`, rangesSet(refSelections);\n        }\n        const selection = editor.getSelectionRanges(), cloneData = {\n            ...data,\n            body: cloneBody\n        };\n        editor.setDocumentData(cloneData, selection);\n    }, [\n        editorId,\n        sequenceNodes,\n        colorMap\n    ]), ranges;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$useDocHight, \"useDocHight\");\nfunction $f3129b461bb1bc83$var$useColor() {\n    const style = (0, $7yNYd.useDependency)((0, $7yNYd.ThemeService)).getCurrentTheme();\n    return (0, $5gqvu.useMemo)(()=>{\n        const formulaRefColors = [\n            style.loopColor1,\n            style.loopColor2,\n            style.loopColor3,\n            style.loopColor4,\n            style.loopColor5,\n            style.loopColor6,\n            style.loopColor7,\n            style.loopColor8,\n            style.loopColor9,\n            style.loopColor10,\n            style.loopColor11,\n            style.loopColor12\n        ], numberColor = style.hyacinth700, stringColor = style.verdancy800;\n        return {\n            formulaRefColors: formulaRefColors,\n            numberColor: numberColor,\n            stringColor: stringColor\n        };\n    }, [\n        style\n    ]);\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$useColor, \"useColor\");\nfunction $f3129b461bb1bc83$var$buildTextRuns(descriptionService, colorMap, sequenceNodes) {\n    const { formulaRefColors: formulaRefColors, numberColor: numberColor, stringColor: stringColor } = colorMap, textRuns = [], refSelections = [], themeColorMap = /* @__PURE__ */ new Map();\n    let refColorIndex = 0;\n    for(let i = 0, len = sequenceNodes.length; i < len; i++){\n        const node = sequenceNodes[i];\n        if (typeof node == \"string\") {\n            const theLastItem = textRuns[textRuns.length - 1], start = theLastItem ? theLastItem.ed : 0, end = start + node.length;\n            textRuns.push({\n                st: start,\n                ed: end\n            });\n            continue;\n        }\n        if (descriptionService.hasDefinedNameDescription(node.token.trim())) continue;\n        const { startIndex: startIndex, endIndex: endIndex, nodeType: nodeType, token: token } = node;\n        let themeColor = \"\";\n        if (nodeType === (0, $86b1c.sequenceNodeType).REFERENCE) {\n            if (themeColorMap.has(token)) themeColor = themeColorMap.get(token);\n            else {\n                const colorIndex = refColorIndex % formulaRefColors.length;\n                themeColor = formulaRefColors[colorIndex], themeColorMap.set(token, themeColor), refColorIndex++;\n            }\n            refSelections.push({\n                refIndex: i,\n                themeColor: themeColor,\n                token: token\n            });\n        } else nodeType === (0, $86b1c.sequenceNodeType).NUMBER ? themeColor = numberColor : (nodeType === (0, $86b1c.sequenceNodeType).STRING || nodeType === (0, $86b1c.sequenceNodeType).ARRAY) && (themeColor = stringColor);\n        themeColor && themeColor.length > 0 && textRuns.push({\n            st: startIndex,\n            ed: endIndex + 1,\n            ts: {\n                cl: {\n                    rgb: themeColor\n                }\n            }\n        });\n    }\n    return {\n        textRuns: textRuns,\n        refSelections: refSelections\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$buildTextRuns, \"buildTextRuns\");\nfunction $f3129b461bb1bc83$var$getFormulaRefSelectionStyle$1(themeService, refColor, id) {\n    const style = themeService.getCurrentTheme(), fill = new (0, $7yNYd.ColorKit)(refColor).setAlpha(0.05).toRgbString();\n    return {\n        id: id,\n        strokeWidth: 1,\n        stroke: refColor,\n        fill: fill,\n        widgets: {\n            tl: !0,\n            tc: !0,\n            tr: !0,\n            ml: !0,\n            mr: !0,\n            bl: !0,\n            bc: !0,\n            br: !0\n        },\n        widgetSize: 6,\n        widgetStrokeWidth: 1,\n        widgetStroke: style.colorWhite,\n        hasAutoFill: !1,\n        hasRowHeader: !1,\n        hasColumnHeader: !1\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getFormulaRefSelectionStyle$1, \"getFormulaRefSelectionStyle$1\");\nconst $f3129b461bb1bc83$var$useRefactorEffect = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((isNeed, unitId, isOnlyOneRange)=>{\n    const renderManagerService = (0, $7yNYd.useDependency)((0, $3e0Iz.IRenderManagerService)), univerInstanceService = (0, $7yNYd.useDependency)((0, $7yNYd.IUniverInstanceService)), contextService = (0, $7yNYd.useDependency)((0, $7yNYd.IContextService)), editorBridgeService = (0, $7yNYd.useDependency)((0, $4XALk.IEditorBridgeService)), sheetsSelectionsService = (0, $7yNYd.useDependency)((0, $ejawP.SheetsSelectionsService)), contextMenuService = (0, $7yNYd.useDependency)((0, $fL2Ug.IContextMenuService)), render2 = renderManagerService.getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with($f3129b461bb1bc83$export$c157cedf8ddabc0a);\n    (0, $5gqvu.useEffect)(()=>{\n        if (isNeed) {\n            const d1 = refSelectionsRenderService == null ? void 0 : refSelectionsRenderService.enableSelectionChanging();\n            return contextService.setContextValue((0, $ejawP.DISABLE_NORMAL_SELECTIONS), !0), editorBridgeService.enableForceKeepVisible(), ()=>{\n                d1 == null || d1.dispose(), contextService.setContextValue((0, $ejawP.DISABLE_NORMAL_SELECTIONS), !1), editorBridgeService.disableForceKeepVisible();\n            };\n        }\n    }, [\n        isNeed\n    ]), (0, $5gqvu.useLayoutEffect)(()=>{\n        if (isNeed) {\n            const workbook = univerInstanceService.getCurrentUnitForType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET), sheet = workbook == null ? void 0 : workbook.getActiveSheet(), selections = [\n                ...sheetsSelectionsService.getCurrentSelections()\n            ];\n            return ()=>{\n                const workbook2 = univerInstanceService.getCurrentUnitForType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET), currentSheet = workbook2 == null ? void 0 : workbook2.getActiveSheet();\n                currentSheet && currentSheet === sheet && sheetsSelectionsService.setSelections(selections);\n            };\n        }\n    }, [\n        isNeed\n    ]), (0, $5gqvu.useEffect)(()=>{\n        if (isNeed) return contextMenuService.disable(), ()=>{\n            contextMenuService.enable();\n        };\n    }, [\n        isNeed\n    ]), (0, $5gqvu.useEffect)(()=>{\n        isNeed && (refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1));\n    }, [\n        isNeed\n    ]), (0, $5gqvu.useEffect)(()=>{\n        isOnlyOneRange ? refSelectionsRenderService == null || refSelectionsRenderService.setRemainLastEnabled(!1) : refSelectionsRenderService == null || refSelectionsRenderService.setRemainLastEnabled(!0);\n    }, [\n        isOnlyOneRange\n    ]);\n}, \"useRefactorEffect\"), $f3129b461bb1bc83$var$useResize = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((editor)=>{\n    const resize = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        if (editor) {\n            const { scene: scene, mainComponent: mainComponent } = editor.render, docSkeletonManagerService = editor.render.with((0, $7AR1b.DocSkeletonManagerService)), { width: width, height: height } = editor.getBoundingClientRect();\n            docSkeletonManagerService.getViewModel().getDataModel().updateDocumentDataPageSize(1 / 0), scene.transformByState({\n                width: width,\n                height: height\n            }), mainComponent == null || mainComponent.resize(width, height);\n        }\n    }, \"resize\"), checkScrollBar = (0, $5gqvu.useMemo)(()=>(0, $7yNYd.debounce)(()=>{\n            var _a11;\n            if (!editor) return;\n            const skeleton = editor.render.with((0, $7AR1b.DocSkeletonManagerService)).getSkeleton(), { scene: scene, mainComponent: mainComponent } = editor.render, viewportMain = scene.getViewport((0, $g6Cit.VIEWPORT_KEY).VIEW_MAIN), { actualWidth: actualWidth } = skeleton.getActualSize(), { width: width, height: height } = editor.getBoundingClientRect();\n            let scrollBar = viewportMain == null ? void 0 : viewportMain.getScrollBar();\n            const contentWidth = Math.max(actualWidth, width), contentHeight = height;\n            scene.transformByState({\n                width: contentWidth,\n                height: contentHeight\n            }), mainComponent == null || mainComponent.resize(contentWidth, contentHeight), actualWidth > width ? scrollBar == null ? viewportMain && new (0, $3e0Iz.ScrollBar)(viewportMain, {\n                barSize: 8,\n                enableVertical: !1\n            }) : viewportMain == null || viewportMain.resetCanvasSizeAndUpdateScroll() : (scrollBar = null, viewportMain == null || viewportMain.scrollToBarPos({\n                x: 0,\n                y: 0\n            }), (_a11 = viewportMain == null ? void 0 : viewportMain.getScrollBar()) == null || _a11.dispose());\n        }, 30), [\n        editor\n    ]);\n    return (0, $5gqvu.useEffect)(()=>{\n        if (editor) {\n            const time = setTimeout(()=>{\n                resize(), checkScrollBar();\n            }, 500);\n            return ()=>{\n                clearTimeout(time);\n            };\n        }\n    }, [\n        editor\n    ]), (0, $5gqvu.useEffect)(()=>{\n        if (editor) {\n            const d = editor.input$.subscribe(()=>{\n                checkScrollBar();\n            });\n            return ()=>{\n                d.unsubscribe();\n            };\n        }\n    }, [\n        editor\n    ]), {\n        resize: resize,\n        checkScrollBar: checkScrollBar\n    };\n}, \"useResize\"), $f3129b461bb1bc83$var$isComma = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((e)=>typeof e == \"string\" ? e === (0, $86b1c.matchToken).COMMA : !1, \"isComma\"), $f3129b461bb1bc83$var$isReference = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((e)=>{\n    if (typeof e == \"object\") return e.nodeType === (0, $86b1c.sequenceNodeType).REFERENCE;\n}, \"isReference\"), $f3129b461bb1bc83$var$filterReferenceNode = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((nodes)=>nodes.filter((node)=>$f3129b461bb1bc83$var$isComma(node) || $f3129b461bb1bc83$var$isReference(node)), \"filterReferenceNode\"), $f3129b461bb1bc83$var$rangePreProcess = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((range)=>{\n    if (range.endColumn < range.startColumn) {\n        const end = range.endColumn;\n        range.endColumn = range.startColumn, range.startColumn = end;\n    }\n    if (range.endRow < range.startRow) {\n        const end = range.endRow;\n        range.endRow = range.startRow, range.startRow = end;\n    }\n    return range;\n}, \"rangePreProcess\"), $f3129b461bb1bc83$var$sequenceNodeToText = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((sequenceNode)=>sequenceNode.map((item)=>typeof item == \"string\" ? item : item.token).join(\"\"), \"sequenceNodeToText\");\nfunction $f3129b461bb1bc83$var$getSheetNameById(univerInstanceService, unitId, sheetId) {\n    var _a11, _b;\n    return ((_b = (_a11 = univerInstanceService.getUnit(unitId)) == null ? void 0 : _a11.getSheetBySheetId(sheetId)) == null ? void 0 : _b.getName()) || \"\";\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getSheetNameById, \"getSheetNameById\");\nconst $f3129b461bb1bc83$var$unitRangesToText = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((ranges, isSupportAcrossSheet = !1)=>isSupportAcrossSheet ? ranges.map((item)=>item.sheetName !== \"\" ? (0, $86b1c.serializeRangeWithSheet)(item.sheetName, item.range) : (0, $86b1c.serializeRange)(item.range)) : ranges.map((item)=>(0, $86b1c.serializeRange)(item.range)), \"unitRangesToText\"), $f3129b461bb1bc83$var$useSheetSelectionChange = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((isNeed, unitId, _subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleRangeChange)=>{\n    const renderManagerService = (0, $7yNYd.useDependency)((0, $3e0Iz.IRenderManagerService)), univerInstanceService = (0, $7yNYd.useDependency)((0, $7yNYd.IUniverInstanceService)), isScalingRef = (0, $5gqvu.useRef)(!1), debounceReset = (0, $5gqvu.useMemo)(()=>(0, $7yNYd.debounce)(()=>{\n            isScalingRef.current = !1;\n        }, 300), []), setIsScaling = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        isScalingRef.current = !0, debounceReset();\n    }, \"setIsScaling\"), render2 = renderManagerService.getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with($f3129b461bb1bc83$export$c157cedf8ddabc0a), oldFilterReferenceNodes = (0, $5gqvu.useRef)([]), filterReferenceNodes = (0, $5gqvu.useMemo)(()=>{\n        const newFilterReferenceNodes = $f3129b461bb1bc83$var$filterReferenceNode(sequenceNodes), old = oldFilterReferenceNodes.current;\n        return newFilterReferenceNodes.length === old.length ? (old.splice(0), old.push(...newFilterReferenceNodes), old) : newFilterReferenceNodes;\n    }, [\n        sequenceNodes\n    ]);\n    oldFilterReferenceNodes.current = filterReferenceNodes, (0, $5gqvu.useEffect)(()=>{\n        if (isNeed && refSelectionsRenderService) {\n            let isFirst = !0;\n            const handleSelectionsChange = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((selections)=>{\n                var _a11;\n                if (isFirst) {\n                    isFirst = !1;\n                    return;\n                }\n                const cloneSelectionList = [\n                    ...selections\n                ], workbook = univerInstanceService.getUnit(unitId), currentSheetName = ((_a11 = workbook == null ? void 0 : workbook.getActiveSheet()) == null ? void 0 : _a11.getName()) || \"\", newSequenceNodes = filterReferenceNodes.map((node, index)=>{\n                    if (typeof node == \"string\") {\n                        if (!filterReferenceNodes[index - 1]) return null;\n                        const nextItem = filterReferenceNodes[index + 1];\n                        return $f3129b461bb1bc83$var$isComma(node) && ($f3129b461bb1bc83$var$isComma(nextItem) || index === filterReferenceNodes.length - 1) ? null : node;\n                    } else if (node.nodeType === (0, $86b1c.sequenceNodeType).REFERENCE) {\n                        const unitRange = (0, $86b1c.deserializeRangeWithSheet)(node.token);\n                        unitRange.unitId = unitRange.unitId === \"\" ? unitId : unitRange.unitId, unitRange.sheetName = unitRange.sheetName === \"\" ? currentSheetName : unitRange.sheetName;\n                        const { unitId: rangeUnitId, sheetName: rangeSubName } = unitRange;\n                        if (isOnlyOneRange && (rangeUnitId !== unitId || currentSheetName !== rangeSubName)) return null;\n                        if (rangeUnitId === unitId && currentSheetName === rangeSubName) {\n                            const currentSelection = cloneSelectionList.shift();\n                            if (currentSelection && $f3129b461bb1bc83$var$getSheetNameById(univerInstanceService, unitId, currentSelection.rangeWithCoord.sheetId || \"\") === rangeSubName) {\n                                const cloneNode = {\n                                    ...node\n                                };\n                                return $f3129b461bb1bc83$var$rangePreProcess(currentSelection.rangeWithCoord), isSupportAcrossSheet ? cloneNode.token = (0, $86b1c.serializeRangeWithSheet)(currentSheetName, currentSelection.rangeWithCoord) : cloneNode.token = (0, $86b1c.serializeRange)(currentSelection.rangeWithCoord), cloneNode;\n                            }\n                        }\n                        return node;\n                    }\n                    return null;\n                }).filter((e)=>!!e), theLast = $f3129b461bb1bc83$var$unitRangesToText(cloneSelectionList.map((e)=>{\n                    var _a12, _b, _c;\n                    return {\n                        range: e.rangeWithCoord,\n                        unitId: (_a12 = e.rangeWithCoord.unitId) != null ? _a12 : \"\",\n                        sheetName: $f3129b461bb1bc83$var$getSheetNameById(univerInstanceService, (_b = e.rangeWithCoord.unitId) != null ? _b : \"\", (_c = e.rangeWithCoord.sheetId) != null ? _c : \"\")\n                    };\n                }), isSupportAcrossSheet).join((0, $86b1c.matchToken).COMMA), thePre = $f3129b461bb1bc83$var$sequenceNodeToText(newSequenceNodes), result = `${thePre}${thePre && theLast ? (0, $86b1c.matchToken).COMMA : \"\"}${theLast}`, isScaling = isScalingRef.current;\n                handleRangeChange(result, isScaling ? -1 : result.length);\n            }, \"handleSelectionsChange\"), d1 = refSelectionsRenderService.selectionMoveEnd$.subscribe((selections)=>{\n                handleSelectionsChange(selections);\n            }), d2 = refSelectionsRenderService.selectionMoving$.pipe((0, $gv2K9.throttleTime)(50)).subscribe((selections)=>{\n                handleSelectionsChange(selections);\n            });\n            return ()=>{\n                d1.unsubscribe(), d2.unsubscribe();\n            };\n        }\n    }, [\n        isNeed,\n        filterReferenceNodes,\n        refSelectionsRenderService,\n        isSupportAcrossSheet,\n        isOnlyOneRange\n    ]), (0, $5gqvu.useEffect)(()=>{\n        if (isNeed && refSelectionsRenderService) {\n            const disposableCollection = new (0, $7yNYd.DisposableCollection)(), handleSequenceNodeReplace = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((token, index)=>{\n                var _a11;\n                let currentIndex = 0, offset = 0, isFinish = !1;\n                const workbook = univerInstanceService.getUnit(unitId), currentSheetName = ((_a11 = workbook == null ? void 0 : workbook.getActiveSheet()) == null ? void 0 : _a11.getName()) || \"\", newSequenceNodes = filterReferenceNodes.map((node)=>{\n                    if (typeof node == \"string\") return isFinish || (offset += node.length), node;\n                    if (node.nodeType === (0, $86b1c.sequenceNodeType).REFERENCE) {\n                        isFinish || (offset += node.token.length);\n                        const unitRange = (0, $86b1c.deserializeRangeWithSheet)(token);\n                        if (unitRange.unitId = unitRange.unitId === \"\" ? unitId : unitRange.unitId, unitRange.sheetName = unitRange.sheetName === \"\" ? currentSheetName : unitRange.sheetName, currentIndex === index) {\n                            isFinish = !0;\n                            const cloneNode = {\n                                ...node,\n                                token: token\n                            };\n                            return isSupportAcrossSheet ? cloneNode.token = (0, $86b1c.serializeRangeWithSheet)(unitRange.sheetName, unitRange.range) : cloneNode.token = (0, $86b1c.serializeRange)(unitRange.range), currentIndex++, cloneNode;\n                        }\n                        return currentIndex++, node;\n                    }\n                    return node;\n                }), result = $f3129b461bb1bc83$var$sequenceNodeToText(newSequenceNodes);\n                handleRangeChange(result, offset || -1);\n            }, \"handleSequenceNodeReplace\");\n            let time = 0;\n            const dispose = refSelectionsRenderService.selectionMoveEnd$.subscribe(()=>{\n                time = setTimeout(()=>{\n                    refSelectionsRenderService.getSelectionControls().forEach((control, index)=>{\n                        disposableCollection.add(control.selectionScaling$.subscribe((e)=>{\n                            const rangeText = (0, $86b1c.serializeRange)(e);\n                            handleSequenceNodeReplace(rangeText, index), setIsScaling();\n                        })), disposableCollection.add(control.selectionMoving$.pipe((0, $hciHF.map)((e)=>(0, $86b1c.serializeRange)(e)), (0, $arCqp.distinctUntilChanged)()).subscribe((rangeText)=>{\n                            handleSequenceNodeReplace(rangeText, index), setIsScaling();\n                        }));\n                    });\n                }, 30);\n            });\n            return ()=>{\n                dispose.unsubscribe(), disposableCollection.dispose(), clearTimeout(time);\n            };\n        }\n    }, [\n        isNeed,\n        refSelectionsRenderService,\n        filterReferenceNodes\n    ]);\n}, \"useSheetSelectionChange\"), $f3129b461bb1bc83$var$verifyRange = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((sequenceNodes)=>!sequenceNodes.some((item)=>{\n        if (typeof item == \"string\") {\n            if (item !== (0, $86b1c.matchToken).COMMA) return !0;\n        } else if (item.nodeType !== (0, $86b1c.sequenceNodeType).REFERENCE) return !0;\n        return !1;\n    }), \"verifyRange\"), $f3129b461bb1bc83$var$useVerify = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((onVerify, sequenceNodes)=>{\n    const isInitRender = (0, $5gqvu.useRef)(!0);\n    (0, $5gqvu.useEffect)(()=>{\n        const time = setTimeout(()=>{\n            isInitRender.current = !1;\n        }, 500);\n        return ()=>{\n            clearTimeout(time);\n        };\n    }), (0, $5gqvu.useEffect)(()=>{\n        if (!isInitRender.current && onVerify) {\n            const result = $f3129b461bb1bc83$var$verifyRange(sequenceNodes);\n            onVerify(result, $f3129b461bb1bc83$var$sequenceNodeToText(sequenceNodes));\n        }\n    }, [\n        sequenceNodes,\n        onVerify\n    ]);\n}, \"useVerify\"), $f3129b461bb1bc83$var$sheetRangeSelectorTextWrap = \"univer-sheet-range-selector-text-wrap\", $f3129b461bb1bc83$var$sheetRangeSelectorPlaceholder = \"univer-sheet-range-selector-placeholder\", $f3129b461bb1bc83$var$sheetRangeSelectorError = \"univer-sheet-range-selector-error\", $f3129b461bb1bc83$var$sheetRangeSelectorErrorWrap = \"univer-sheet-range-selector-error-wrap\", $f3129b461bb1bc83$var$sheetRangeSelectorText = \"univer-sheet-range-selector-text\", $f3129b461bb1bc83$var$sheetRangeSelectorActive = \"univer-sheet-range-selector-active\", $f3129b461bb1bc83$var$sheetRangeSelectorIcon = \"univer-sheet-range-selector-icon\", $f3129b461bb1bc83$var$sheetRangeSelectorDialogItem = \"univer-sheet-range-selector-dialog-item\", $f3129b461bb1bc83$var$sheetRangeSelectorDialogItemDelete = \"univer-sheet-range-selector-dialog-item-delete\", $f3129b461bb1bc83$var$styles$6 = {\n    sheetRangeSelectorTextWrap: $f3129b461bb1bc83$var$sheetRangeSelectorTextWrap,\n    sheetRangeSelectorPlaceholder: $f3129b461bb1bc83$var$sheetRangeSelectorPlaceholder,\n    sheetRangeSelectorError: $f3129b461bb1bc83$var$sheetRangeSelectorError,\n    sheetRangeSelectorErrorWrap: $f3129b461bb1bc83$var$sheetRangeSelectorErrorWrap,\n    sheetRangeSelectorText: $f3129b461bb1bc83$var$sheetRangeSelectorText,\n    sheetRangeSelectorActive: $f3129b461bb1bc83$var$sheetRangeSelectorActive,\n    sheetRangeSelectorIcon: $f3129b461bb1bc83$var$sheetRangeSelectorIcon,\n    sheetRangeSelectorDialogItem: $f3129b461bb1bc83$var$sheetRangeSelectorDialogItem,\n    sheetRangeSelectorDialogItemDelete: $f3129b461bb1bc83$var$sheetRangeSelectorDialogItemDelete\n}, $f3129b461bb1bc83$var$noopFunction = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{}, \"noopFunction\");\nfunction $f3129b461bb1bc83$export$1081d70813d107d1(props) {\n    const { initValue: initValue, unitId: unitId, subUnitId: subUnitId, errorText: errorText, placeholder: placeholder, actions: actions, onChange: onChange = $f3129b461bb1bc83$var$noopFunction, onVerify: onVerify = $f3129b461bb1bc83$var$noopFunction, onRangeSelectorDialogVisibleChange: onRangeSelectorDialogVisibleChange = $f3129b461bb1bc83$var$noopFunction, onBlur: onBlur = $f3129b461bb1bc83$var$noopFunction, isFocus: _isFocus = !0, isOnlyOneRange: isOnlyOneRange = !1, isSupportAcrossSheet: isSupportAcrossSheet = !1 } = props, editorService = (0, $7yNYd.useDependency)((0, $g6Cit.IEditorService)), localeService = (0, $7yNYd.useDependency)((0, $7yNYd.LocaleService)), commandService = (0, $7yNYd.useDependency)((0, $7yNYd.ICommandService)), lexerTreeBuilder = (0, $7yNYd.useDependency)((0, $86b1c.LexerTreeBuilder)), rangeSelectorWrapRef = (0, $5gqvu.useRef)(null), [rangeDialogVisible, rangeDialogVisibleSet] = (0, $5gqvu.useState)(!1), [isFocus, isFocusSet] = (0, $5gqvu.useState)(_isFocus), editorId = (0, $5gqvu.useMemo)(()=>(0, $7yNYd.createInternalEditorID)(`${(0, $4XALk.RANGE_SELECTOR_SYMBOLS)}-${(0, $7yNYd.generateRandomId)(4)}`), []), [editor, editorSet] = (0, $5gqvu.useState)(), containerRef = (0, $5gqvu.useRef)(null), [rangeString, rangeStringSet] = (0, $5gqvu.useState)(()=>typeof initValue == \"string\" ? initValue : $f3129b461bb1bc83$var$unitRangesToText(initValue, isSupportAcrossSheet).join((0, $86b1c.matchToken).COMMA));\n    actions && (actions.handleOutClick = (e, cb)=>{\n        if (rangeSelectorWrapRef.current) {\n            const isContain = rangeSelectorWrapRef.current.contains(e.target);\n            cb(isContain);\n        }\n    });\n    const ranges = (0, $5gqvu.useMemo)(()=>rangeString.split((0, $86b1c.matchToken).COMMA).filter((e)=>!!e).map((text)=>(0, $86b1c.deserializeRangeWithSheet)(text)), [\n        rangeString\n    ]), isError = (0, $5gqvu.useMemo)(()=>errorText !== void 0, [\n        errorText\n    ]), handleInputDebounce = (0, $5gqvu.useMemo)(()=>(0, $7yNYd.debounce)((text)=>{\n            const nodes = lexerTreeBuilder.sequenceNodesBuilder(text);\n            if (nodes) {\n                if ($f3129b461bb1bc83$var$verifyRange(nodes)) {\n                    const preNodes = nodes.map((node)=>{\n                        if (typeof node == \"string\") return node;\n                        if (node.nodeType === (0, $86b1c.sequenceNodeType).REFERENCE) {\n                            const unitRange = (0, $86b1c.deserializeRangeWithSheet)(node.token);\n                            unitRange.range = $f3129b461bb1bc83$var$rangePreProcess(unitRange.range), isSupportAcrossSheet || (unitRange.sheetName = \"\", unitRange.unitId = \"\"), node.token = $f3129b461bb1bc83$var$unitRangesToText([\n                                unitRange\n                            ], isSupportAcrossSheet)[0];\n                        }\n                        return node;\n                    }), result = $f3129b461bb1bc83$var$sequenceNodeToText(preNodes);\n                    onChange(result);\n                }\n            } else rangeStringSet(\"\");\n        }, 30), [\n        isSupportAcrossSheet\n    ]), handleConfirm = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((ranges2)=>{\n        const text = $f3129b461bb1bc83$var$unitRangesToText(ranges2, isSupportAcrossSheet).join((0, $86b1c.matchToken).COMMA);\n        rangeStringSet(text), onChange(text), rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1);\n    }, \"handleConfirm\"), handleClose = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1);\n    }, \"handleClose\"), handleOpenModal = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        isError || (rangeDialogVisibleSet(!0), onRangeSelectorDialogVisibleChange(!0));\n    }, \"handleOpenModal\"), focus = (0, $5gqvu.useMemo)(()=>{\n        let time = 0;\n        return ()=>{\n            clearTimeout(time), editor && (time = setTimeout(()=>{\n                editor.focus();\n            }, 30));\n        };\n    }, [\n        editor\n    ]), { checkScrollBar: checkScrollBar } = $f3129b461bb1bc83$var$useResize(editor), handleSheetSelectionChange = (0, $5gqvu.useMemo)(()=>(text, offset)=>{\n            rangeStringSet(text), onChange(text), focus(), offset !== -1 && setTimeout(()=>{\n                const range = {\n                    startOffset: offset,\n                    endOffset: offset\n                };\n                editor == null || editor.setSelectionRanges([\n                    range\n                ]);\n                const docBackScrollRenderController = editor == null ? void 0 : editor.render.with((0, $g6Cit.DocBackScrollRenderController));\n                docBackScrollRenderController == null || docBackScrollRenderController.scrollToRange({\n                    ...range,\n                    collapsed: !0\n                });\n            }, 50), checkScrollBar();\n        }, [\n        editor\n    ]), { sequenceNodes: sequenceNodes, sequenceNodesSet: sequenceNodesSet } = $f3129b461bb1bc83$var$useFormulaToken(rangeString), sheetHighlightRanges = $f3129b461bb1bc83$var$useDocHight(editorId, sequenceNodes);\n    return $f3129b461bb1bc83$var$useSheetHighlight(!rangeDialogVisible && isFocus, unitId, subUnitId, sheetHighlightRanges), $f3129b461bb1bc83$var$useSheetSelectionChange(!rangeDialogVisible && isFocus, unitId, subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleSheetSelectionChange), $f3129b461bb1bc83$var$useRefactorEffect(!rangeDialogVisible && isFocus, unitId, isOnlyOneRange), $f3129b461bb1bc83$var$useEditorInput(unitId, rangeString, editor), $f3129b461bb1bc83$var$useVerify(onVerify, sequenceNodes), (0, $5gqvu.useEffect)(()=>{\n        if (editor) {\n            const dispose = editor.input$.subscribe((e)=>{\n                var _a11, _b;\n                const text = ((_b = (_a11 = e.data.body) == null ? void 0 : _a11.dataStream) != null ? _b : \"\").replaceAll(/\\n|\\r/g, \"\").replaceAll(/,{2,}/g, \",\").replaceAll(/(^,)/g, \"\");\n                rangeStringSet(text), handleInputDebounce(text);\n            });\n            return ()=>{\n                dispose.unsubscribe();\n            };\n        }\n    }, [\n        editor\n    ]), (0, $5gqvu.useEffect)(()=>{\n        const d1 = commandService.beforeCommandExecuted((info)=>{\n            info.id === (0, $ejawP.SetWorksheetActiveOperation).id && !isSupportAcrossSheet && (isFocusSet(!1), onBlur(), sequenceNodesSet((pre)=>[\n                    ...pre\n                ]));\n        }), d2 = commandService.onCommandExecuted((info)=>{\n            info.id === (0, $4XALk.SetCellEditVisibleOperation).id && (rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1), isFocusSet(!1), onBlur());\n        });\n        return ()=>{\n            d1.dispose(), d2.dispose();\n        };\n    }, [\n        isSupportAcrossSheet\n    ]), (0, $5gqvu.useEffect)(()=>{\n        isFocusSet(_isFocus);\n    }, [\n        _isFocus\n    ]), (0, $5gqvu.useEffect)(()=>{\n        if (editor && rangeDialogVisible) {\n            editor.blur();\n            const d = editor.focus$.subscribe(()=>{\n                editor.blur();\n            });\n            return ()=>{\n                d.unsubscribe();\n            };\n        }\n    }, [\n        editor,\n        rangeDialogVisible\n    ]), (0, $5gqvu.useLayoutEffect)(()=>{\n        let dispose;\n        if (containerRef.current) {\n            dispose = editorService.register({\n                autofocus: !0,\n                editorUnitId: editorId,\n                isSingle: !0,\n                initialSnapshot: {\n                    id: editorId,\n                    body: {\n                        dataStream: `\\r\n`\n                    },\n                    documentStyle: {}\n                }\n            }, containerRef.current);\n            const editor2 = editorService.getEditor(editorId);\n            editorSet(editor2);\n        }\n        return ()=>{\n            dispose == null || dispose.dispose();\n        };\n    }, [\n        containerRef.current\n    ]), /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelector,\n        ref: rangeSelectorWrapRef,\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                className: $f3129b461bb1bc83$var$clsx($f3129b461bb1bc83$var$styles$6.sheetRangeSelectorTextWrap, {\n                    [$f3129b461bb1bc83$var$styles$6.sheetRangeSelectorActive]: isFocus && !isError,\n                    [$f3129b461bb1bc83$var$styles$6.sheetRangeSelectorError]: isError\n                }),\n                children: [\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorText,\n                        ref: containerRef\n                    }),\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Tooltip), {\n                        title: localeService.t(\"rangeSelector.buttonTooltip\"),\n                        placement: \"bottom\",\n                        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$SelectRangeSingle, {\n                            className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorIcon,\n                            onClick: handleOpenModal\n                        })\n                    }),\n                    errorText !== void 0 ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorErrorWrap,\n                        children: errorText\n                    }) : null,\n                    placeholder !== void 0 && !rangeString ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorPlaceholder,\n                        children: placeholder\n                    }) : null\n                ]\n            }),\n            rangeDialogVisible && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$RangeSelectorDialog, {\n                handleConfirm: handleConfirm,\n                handleClose: handleClose,\n                unitId: unitId,\n                subUnitId: subUnitId,\n                initValue: ranges,\n                visible: rangeDialogVisible,\n                isOnlyOneRange: isOnlyOneRange,\n                isSupportAcrossSheet: isSupportAcrossSheet\n            })\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$export$1081d70813d107d1, \"RangeSelector\");\nfunction $f3129b461bb1bc83$var$RangeSelectorDialog(props) {\n    const { handleConfirm: handleConfirm, handleClose: _handleClose, visible: visible, initValue: initValue, unitId: unitId, subUnitId: subUnitId, isOnlyOneRange: isOnlyOneRange, isSupportAcrossSheet: isSupportAcrossSheet } = props, localeService = (0, $7yNYd.useDependency)((0, $7yNYd.LocaleService)), descriptionService = (0, $7yNYd.useDependency)((0, $bRzks.IDescriptionService)), lexerTreeBuilder = (0, $7yNYd.useDependency)((0, $86b1c.LexerTreeBuilder)), render2 = (0, $7yNYd.useDependency)((0, $3e0Iz.IRenderManagerService)).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with($f3129b461bb1bc83$export$c157cedf8ddabc0a), [ranges, rangesSet] = (0, $5gqvu.useState)(()=>{\n        if (isOnlyOneRange) {\n            const firstRange = initValue[0];\n            return firstRange ? $f3129b461bb1bc83$var$unitRangesToText([\n                firstRange\n            ], isSupportAcrossSheet) : [\n                \"\"\n            ];\n        }\n        return $f3129b461bb1bc83$var$unitRangesToText(initValue, isSupportAcrossSheet);\n    }), [focusIndex, focusIndexSet] = (0, $5gqvu.useState)(()=>ranges.length - 1), colorMap = $f3129b461bb1bc83$var$useColor(), rangeText = (0, $5gqvu.useMemo)(()=>ranges.join((0, $86b1c.matchToken).COMMA), [\n        ranges\n    ]), { sequenceNodes: sequenceNodes, sequenceNodesSet: sequenceNodesSet } = $f3129b461bb1bc83$var$useFormulaToken(rangeText), refSelections = (0, $5gqvu.useMemo)(()=>$f3129b461bb1bc83$var$buildTextRuns(descriptionService, colorMap, sequenceNodes).refSelections, [\n        sequenceNodes\n    ]), handleClose = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        sequenceNodesSet([]), setTimeout(()=>{\n            _handleClose();\n        }, 30);\n    }, \"handleClose\"), handleRangeInput = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, value)=>{\n        value ? refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1) : refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0), rangesSet((v)=>{\n            const result = [\n                ...v\n            ];\n            return result[index] = value, result;\n        });\n    }, \"handleRangeInput\"), handleRangeRemove = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index)=>{\n        refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1), rangesSet((v)=>{\n            if (v.length === 1) return v;\n            const result = [];\n            return v.forEach((r2, i)=>{\n                index !== i && result.push(r2);\n            }), result;\n        });\n    }, \"handleRangeRemove\"), handleRangeAdd = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0), rangesSet((v)=>(v.push(\"\"), focusIndexSet(v.length - 1), [\n                ...v\n            ]));\n    }, \"handleRangeAdd\"), handleSheetSelectionChange = (0, $5gqvu.useCallback)((rangeText2)=>{\n        var _a11;\n        refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1);\n        const ranges2 = rangeText2.split((0, $86b1c.matchToken).COMMA).filter((e)=>!!e);\n        rangesSet(isOnlyOneRange ? [\n            (_a11 = ranges2[0]) != null ? _a11 : \"\"\n        ] : ranges2);\n    }, [\n        focusIndex,\n        isOnlyOneRange\n    ]);\n    return $f3129b461bb1bc83$var$useSheetHighlight(visible, unitId, subUnitId, refSelections), $f3129b461bb1bc83$var$useSheetSelectionChange(focusIndex >= 0, unitId, subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleSheetSelectionChange), $f3129b461bb1bc83$var$useRefactorEffect(focusIndex >= 0, unitId, isOnlyOneRange), (0, $5gqvu.useEffect)(()=>{\n        (ranges.length === 0 || ranges.length === 1 && !ranges[0]) && (refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0));\n    }, [\n        ranges\n    ]), /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Dialog), {\n        width: \"328px\",\n        visible: visible,\n        title: localeService.t(\"rangeSelector.title\"),\n        draggable: !0,\n        closeIcon: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$CloseSingle, {}),\n        footer: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"footer\", {\n            children: [\n                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Button), {\n                    onClick: handleClose,\n                    children: localeService.t(\"rangeSelector.cancel\")\n                }),\n                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Button), {\n                    style: {\n                        marginLeft: 10\n                    },\n                    onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>handleConfirm(ranges.filter((text)=>{\n                            const nodes = lexerTreeBuilder.sequenceNodesBuilder(text);\n                            return nodes && nodes.length === 1 && typeof nodes[0] != \"string\" && nodes[0].nodeType === (0, $86b1c.sequenceNodeType).REFERENCE;\n                        }).map((text)=>(0, $86b1c.deserializeRangeWithSheet)(text)).map((unitRange)=>({\n                                ...unitRange,\n                                range: $f3129b461bb1bc83$var$rangePreProcess(unitRange.range)\n                            }))), \"onClick\"),\n                    type: \"primary\",\n                    children: localeService.t(\"rangeSelector.confirm\")\n                })\n            ]\n        }),\n        onClose: handleClose,\n        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n            className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorDialog,\n            children: [\n                ranges.map((text, index)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorDialogItem,\n                        children: [\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Input), {\n                                affixWrapperStyle: {\n                                    width: \"100%\"\n                                },\n                                placeholder: localeService.t(\"rangeSelector.placeHolder\"),\n                                onFocus: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>focusIndexSet(index), \"onFocus\"),\n                                value: text,\n                                onChange: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((value)=>handleRangeInput(index, value), \"onChange\")\n                            }, `input_${index}`),\n                            ranges.length > 1 && !isOnlyOneRange && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$DeleteSingle, {\n                                className: $f3129b461bb1bc83$var$styles$6.sheetRangeSelectorDialogItemDelete,\n                                onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>handleRangeRemove(index), \"onClick\")\n                            })\n                        ]\n                    }, index)),\n                !isOnlyOneRange && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                    children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs((0, $1UDbf.Button), {\n                        type: \"link\",\n                        size: \"small\",\n                        onClick: handleRangeAdd,\n                        children: [\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$IncreaseSingle, {}),\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                                children: localeService.t(\"rangeSelector.addAnotherRange\")\n                            })\n                        ]\n                    })\n                })\n            ]\n        })\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$RangeSelectorDialog, \"RangeSelectorDialog\");\nconst $f3129b461bb1bc83$var$PLUGIN_CONFIG_KEY_BASE = \"sheets-formula.base.config\", $f3129b461bb1bc83$var$defaultPluginBaseConfig = {};\nfunction $f3129b461bb1bc83$var$whenEditorStandalone(contextService) {\n    return contextService.getContextValue((0, $7yNYd.FOCUSING_DOC)) && contextService.getContextValue((0, $7yNYd.FOCUSING_UNIVER_EDITOR)) && contextService.getContextValue((0, $7yNYd.FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE));\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$whenEditorStandalone, \"whenEditorStandalone\");\nfunction $f3129b461bb1bc83$var$extractFormulaError(cell, isArrayFormulaCell = !1) {\n    return !isArrayFormulaCell && !((0, $7yNYd.isFormulaString)(cell == null ? void 0 : cell.f) || (0, $7yNYd.isFormulaId)(cell == null ? void 0 : cell.si)) ? null : typeof (cell == null ? void 0 : cell.v) == \"string\" && (0, $86b1c.ERROR_TYPE_SET).has(cell.v) ? cell.v : null;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$extractFormulaError, \"extractFormulaError\");\nvar $f3129b461bb1bc83$var$__defProp$7 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$7 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$7 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$7(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$7(target, key, result), result;\n}, \"__decorateClass$7\"), $f3129b461bb1bc83$var$__decorateParam$7 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$7\");\nconst $f3129b461bb1bc83$var$ALERT_KEY = \"SHEET_FORMULA_ALERT\", $f3129b461bb1bc83$var$ErrorTypeToMessageMap = {\n    [(0, $86b1c.ErrorType).DIV_BY_ZERO]: \"divByZero\",\n    [(0, $86b1c.ErrorType).NAME]: \"name\",\n    [(0, $86b1c.ErrorType).VALUE]: \"value\",\n    [(0, $86b1c.ErrorType).NUM]: \"num\",\n    [(0, $86b1c.ErrorType).NA]: \"na\",\n    [(0, $86b1c.ErrorType).CYCLE]: \"cycle\",\n    [(0, $86b1c.ErrorType).REF]: \"ref\",\n    [(0, $86b1c.ErrorType).SPILL]: \"spill\",\n    [(0, $86b1c.ErrorType).CALC]: \"calc\",\n    [(0, $86b1c.ErrorType).ERROR]: \"error\",\n    [(0, $86b1c.ErrorType).CONNECT]: \"connect\",\n    [(0, $86b1c.ErrorType).NULL]: \"null\"\n};\nvar $f3129b461bb1bc83$var$_a3;\nlet $f3129b461bb1bc83$var$FormulaAlertRenderController = ($f3129b461bb1bc83$var$_a3 = class extends (0, $7yNYd.Disposable) {\n    constructor(_context, _hoverManagerService, _cellAlertManagerService, _localeService, _formulaDataModel, _zenZoneService){\n        super(), this._context = _context, this._hoverManagerService = _hoverManagerService, this._cellAlertManagerService = _cellAlertManagerService, this._localeService = _localeService, this._formulaDataModel = _formulaDataModel, this._zenZoneService = _zenZoneService, this._init();\n    }\n    _init() {\n        this._initCellAlertPopup(), this._initZenService();\n    }\n    _initCellAlertPopup() {\n        this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe((cellPos)=>{\n            var _a11, _b, _c, _d, _e;\n            if (cellPos) {\n                const worksheet = this._context.unit.getActiveSheet();\n                if (!worksheet) return;\n                const cellData = worksheet.getCell(cellPos.location.row, cellPos.location.col), arrayFormulaCellData = (_d = (_c = (_b = (_a11 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[cellPos.location.unitId]) == null ? void 0 : _b[cellPos.location.subUnitId]) == null ? void 0 : _c[cellPos.location.row]) == null ? void 0 : _d[cellPos.location.col];\n                if ((0, $7yNYd.isICellData)(cellData)) {\n                    const errorType = $f3129b461bb1bc83$var$extractFormulaError(cellData, !!arrayFormulaCellData);\n                    if (!errorType) return;\n                    const currentAlert = this._cellAlertManagerService.currentAlert.get($f3129b461bb1bc83$var$ALERT_KEY), currentLoc = (_e = currentAlert == null ? void 0 : currentAlert.alert) == null ? void 0 : _e.location;\n                    if (currentLoc && currentLoc.row === cellPos.location.row && currentLoc.col === cellPos.location.col && currentLoc.subUnitId === cellPos.location.subUnitId && currentLoc.unitId === cellPos.location.unitId) return;\n                    this._cellAlertManagerService.showAlert({\n                        type: (0, $4XALk.CellAlertType).ERROR,\n                        title: this._localeService.t(\"formula.error.title\"),\n                        message: this._localeService.t(`formula.error.${$f3129b461bb1bc83$var$ErrorTypeToMessageMap[errorType]}`),\n                        location: cellPos.location,\n                        width: 200,\n                        height: 74,\n                        key: $f3129b461bb1bc83$var$ALERT_KEY\n                    });\n                    return;\n                }\n            }\n            this._cellAlertManagerService.removeAlert($f3129b461bb1bc83$var$ALERT_KEY);\n        }));\n    }\n    _initZenService() {\n        this.disposeWithMe(this._zenZoneService.visible$.subscribe((visible)=>{\n            visible && this._cellAlertManagerService.removeAlert($f3129b461bb1bc83$var$ALERT_KEY);\n        }));\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a3, \"FormulaAlertRenderController\"), $f3129b461bb1bc83$var$_a3);\n$f3129b461bb1bc83$var$FormulaAlertRenderController = $f3129b461bb1bc83$var$__decorateClass$7([\n    $f3129b461bb1bc83$var$__decorateParam$7(1, (0, $7yNYd.Inject)((0, $4XALk.HoverManagerService))),\n    $f3129b461bb1bc83$var$__decorateParam$7(2, (0, $7yNYd.Inject)((0, $4XALk.CellAlertManagerService))),\n    $f3129b461bb1bc83$var$__decorateParam$7(3, (0, $7yNYd.Inject)((0, $7yNYd.LocaleService))),\n    $f3129b461bb1bc83$var$__decorateParam$7(4, (0, $7yNYd.Inject)((0, $86b1c.FormulaDataModel))),\n    $f3129b461bb1bc83$var$__decorateParam$7(5, (0, $fL2Ug.IZenZoneService))\n], $f3129b461bb1bc83$var$FormulaAlertRenderController);\nvar $f3129b461bb1bc83$var$__defProp$6 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$6 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$6 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$6(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$6(target, key, result), result;\n}, \"__decorateClass$6\"), $f3129b461bb1bc83$var$__decorateParam$6 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$6\"), $f3129b461bb1bc83$var$_a4;\nlet $f3129b461bb1bc83$var$FormulaAutoFillController = ($f3129b461bb1bc83$var$_a4 = class extends (0, $7yNYd.Disposable) {\n    constructor(_autoFillService, _lexerTreeBuilder){\n        super(), this._autoFillService = _autoFillService, this._lexerTreeBuilder = _lexerTreeBuilder, this._registerAutoFill();\n    }\n    _registerAutoFill() {\n        const formulaRule = {\n            type: (0, $4XALk.DATA_TYPE).FORMULA,\n            priority: 1001,\n            match: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((cellData)=>(0, $7yNYd.isFormulaString)(cellData == null ? void 0 : cellData.f) || (0, $7yNYd.isFormulaId)(cellData == null ? void 0 : cellData.si), \"match\"),\n            isContinue: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((prev, cur)=>prev.type === (0, $4XALk.DATA_TYPE).FORMULA, \"isContinue\"),\n            applyFunctions: {\n                [(0, $4XALk.APPLY_TYPE).COPY]: (dataWithIndex, len, direction, copyDataPiece)=>{\n                    const { data: data, index: index } = dataWithIndex;\n                    return this._fillCopyFormula(data, len, direction, index, copyDataPiece);\n                }\n            }\n        };\n        this._autoFillService.registerRule(formulaRule);\n    }\n    _fillCopyFormula(data, len, direction, index, copyDataPiece) {\n        var _a11, _b;\n        const step = $f3129b461bb1bc83$var$getDataLength(copyDataPiece), applyData = [], formulaIdMap = /* @__PURE__ */ new Map();\n        for(let i = 1; i <= len; i++){\n            const index2 = (i - 1) % data.length, d = (0, $7yNYd.Tools).deepClone(data[index2]);\n            if (d) {\n                const originalFormula = ((_a11 = data[index2]) == null ? void 0 : _a11.f) || \"\", originalFormulaId = ((_b = data[index2]) == null ? void 0 : _b.si) || \"\", checkFormula = (0, $7yNYd.isFormulaString)(originalFormula);\n                if ((0, $7yNYd.isFormulaId)(originalFormulaId)) d.si = originalFormulaId, d.f = null, d.v = null, d.p = null, d.t = null, direction === (0, $7yNYd.Direction).DOWN || direction === (0, $7yNYd.Direction).RIGHT ? applyData.push(d) : applyData.unshift(d);\n                else if (checkFormula) {\n                    let formulaId = formulaIdMap.get(index2);\n                    if (formulaId) d.si = formulaId, d.f = null, d.v = null, d.p = null, d.t = null;\n                    else {\n                        formulaId = (0, $7yNYd.Tools).generateRandomId(6), formulaIdMap.set(index2, formulaId);\n                        const { offsetX: offsetX, offsetY: offsetY } = $f3129b461bb1bc83$var$directionToOffset(step, direction), shiftedFormula = this._lexerTreeBuilder.moveFormulaRefOffset(originalFormula, offsetX, offsetY);\n                        d.si = formulaId, d.f = shiftedFormula, d.v = null, d.p = null, d.t = null;\n                    }\n                    direction === (0, $7yNYd.Direction).DOWN || direction === (0, $7yNYd.Direction).RIGHT ? applyData.push(d) : applyData.unshift(d);\n                }\n            }\n        }\n        return applyData;\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a4, \"FormulaAutoFillController\"), $f3129b461bb1bc83$var$_a4);\n$f3129b461bb1bc83$var$FormulaAutoFillController = $f3129b461bb1bc83$var$__decorateClass$6([\n    $f3129b461bb1bc83$var$__decorateParam$6(0, (0, $4XALk.IAutoFillService)),\n    $f3129b461bb1bc83$var$__decorateParam$6(1, (0, $7yNYd.Inject)((0, $86b1c.LexerTreeBuilder)))\n], $f3129b461bb1bc83$var$FormulaAutoFillController);\nfunction $f3129b461bb1bc83$var$directionToOffset(step, direction) {\n    let offsetX = 0, offsetY = 0;\n    switch(direction){\n        case (0, $7yNYd.Direction).UP:\n            offsetY = -step;\n            break;\n        case (0, $7yNYd.Direction).RIGHT:\n            offsetX = step;\n            break;\n        case (0, $7yNYd.Direction).DOWN:\n            offsetY = step;\n            break;\n        case (0, $7yNYd.Direction).LEFT:\n            offsetX = -step;\n            break;\n    }\n    return {\n        offsetX: offsetX,\n        offsetY: offsetY\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$directionToOffset, \"directionToOffset\");\nfunction $f3129b461bb1bc83$var$getDataLength(copyDataPiece) {\n    let length = 0;\n    for(const t in copyDataPiece)copyDataPiece[t].forEach((item)=>{\n        length += item.data.length;\n    });\n    return length;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getDataLength, \"getDataLength\");\nvar $f3129b461bb1bc83$var$__defProp$5 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$5 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$5 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$5(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$5(target, key, result), result;\n}, \"__decorateClass$5\"), $f3129b461bb1bc83$var$__decorateParam$5 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$5\");\nconst $f3129b461bb1bc83$var$DEFAULT_PASTE_FORMULA = \"default-paste-formula\";\nvar $f3129b461bb1bc83$var$_a5;\nlet $f3129b461bb1bc83$var$FormulaClipboardController = ($f3129b461bb1bc83$var$_a5 = class extends (0, $7yNYd.Disposable) {\n    constructor(_currentUniverSheet, _lexerTreeBuilder, _sheetClipboardService, _injector, _formulaDataModel){\n        super(), this._currentUniverSheet = _currentUniverSheet, this._lexerTreeBuilder = _lexerTreeBuilder, this._sheetClipboardService = _sheetClipboardService, this._injector = _injector, this._formulaDataModel = _formulaDataModel, this._initialize();\n    }\n    _initialize() {\n        this._registerClipboardHook();\n    }\n    _registerClipboardHook() {\n        this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteFormulaHook())), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteWithFormulaHook()));\n    }\n    _pasteFormulaHook() {\n        return {\n            id: (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_FORMULA,\n            priority: 10,\n            specialPasteInfo: {\n                label: \"specialPaste.formula\"\n            },\n            onPasteCells: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((pasteFrom, pasteTo, data, payload)=>this._onPasteCells(pasteFrom, pasteTo, data, payload, !0), \"onPasteCells\")\n        };\n    }\n    _pasteWithFormulaHook() {\n        return {\n            id: $f3129b461bb1bc83$var$DEFAULT_PASTE_FORMULA,\n            priority: 10,\n            onPasteCells: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((pasteFrom, pasteTo, data, payload)=>this._onPasteCells(pasteFrom, pasteTo, data, payload, !1), \"onPasteCells\")\n        };\n    }\n    _onPasteCells(pasteFrom, pasteTo, data, payload, isSpecialPaste) {\n        var _a11;\n        if ([\n            (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_FORMAT,\n            (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_COL_WIDTH\n        ].includes(payload.pasteType)) return {\n            undos: [],\n            redos: []\n        };\n        const workbook = this._currentUniverSheet.getCurrentUnitForType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET), unitId = pasteTo.unitId || workbook.getUnitId(), subUnitId = pasteTo.subUnitId || ((_a11 = workbook.getActiveSheet()) == null ? void 0 : _a11.getSheetId());\n        if (!unitId || !subUnitId) return {\n            undos: [],\n            redos: []\n        };\n        const pastedRange = pasteTo.range, matrix = data, copyInfo = {\n            copyType: payload.copyType || (0, $4XALk.COPY_TYPE).COPY,\n            copyRange: pasteFrom == null ? void 0 : pasteFrom.range,\n            pasteType: payload.pasteType\n        };\n        return this._injector.invoke((accessor)=>$f3129b461bb1bc83$var$getSetCellFormulaMutations(unitId, subUnitId, pastedRange, matrix, accessor, copyInfo, this._lexerTreeBuilder, this._formulaDataModel, isSpecialPaste, pasteFrom));\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a5, \"FormulaClipboardController\"), $f3129b461bb1bc83$var$_a5);\n$f3129b461bb1bc83$var$FormulaClipboardController = $f3129b461bb1bc83$var$__decorateClass$5([\n    $f3129b461bb1bc83$var$__decorateParam$5(0, (0, $7yNYd.IUniverInstanceService)),\n    $f3129b461bb1bc83$var$__decorateParam$5(1, (0, $7yNYd.Inject)((0, $86b1c.LexerTreeBuilder))),\n    $f3129b461bb1bc83$var$__decorateParam$5(2, (0, $4XALk.ISheetClipboardService)),\n    $f3129b461bb1bc83$var$__decorateParam$5(3, (0, $7yNYd.Inject)((0, $7yNYd.Injector))),\n    $f3129b461bb1bc83$var$__decorateParam$5(4, (0, $7yNYd.Inject)((0, $86b1c.FormulaDataModel)))\n], $f3129b461bb1bc83$var$FormulaClipboardController);\nfunction $f3129b461bb1bc83$var$getSetCellFormulaMutations(unitId, subUnitId, range, matrix, accessor, copyInfo, lexerTreeBuilder, formulaDataModel, isSpecialPaste = !1, pasteFrom) {\n    const redoMutationsInfo = [], undoMutationsInfo = [], valueMatrix = $f3129b461bb1bc83$var$getValueMatrix(unitId, subUnitId, range, matrix, copyInfo, lexerTreeBuilder, formulaDataModel, pasteFrom), setValuesMutation = {\n        unitId: unitId,\n        subUnitId: subUnitId,\n        cellValue: valueMatrix.getData()\n    };\n    redoMutationsInfo.push({\n        id: (0, $ejawP.SetRangeValuesMutation).id,\n        params: setValuesMutation\n    });\n    const undoSetValuesMutation = (0, $ejawP.SetRangeValuesUndoMutationFactory)(accessor, setValuesMutation);\n    return undoMutationsInfo.push({\n        id: (0, $ejawP.SetRangeValuesMutation).id,\n        params: undoSetValuesMutation\n    }), {\n        undos: undoMutationsInfo,\n        redos: redoMutationsInfo\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getSetCellFormulaMutations, \"getSetCellFormulaMutations\");\nfunction $f3129b461bb1bc83$var$getValueMatrix(unitId, subUnitId, range, matrix, copyInfo, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n    return pasteFrom ? copyInfo.pasteType === (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_VALUE ? $f3129b461bb1bc83$var$getSpecialPasteValueValueMatrix(unitId, subUnitId, range, matrix, formulaDataModel, pasteFrom) : copyInfo.pasteType === (0, $4XALk.PREDEFINED_HOOK_NAME).SPECIAL_PASTE_FORMULA ? $f3129b461bb1bc83$var$getSpecialPasteFormulaValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) : $f3129b461bb1bc83$var$getDefaultPasteValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) : $f3129b461bb1bc83$var$getValueMatrixOfPasteFromIsNull(unitId, subUnitId, range, matrix, formulaDataModel);\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getValueMatrix, \"getValueMatrix\");\nfunction $f3129b461bb1bc83$var$getValueMatrixOfPasteFromIsNull(unitId, subUnitId, range, matrix, formulaDataModel) {\n    var _a11, _b;\n    const valueMatrix = new (0, $7yNYd.ObjectMatrix)(), formulaData = (_b = (_a11 = formulaDataModel.getFormulaData()) == null ? void 0 : _a11[unitId]) == null ? void 0 : _b[subUnitId];\n    return matrix.forValue((row, col, value)=>{\n        var _a12;\n        const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n        (0, $7yNYd.isFormulaString)(value.v) ? (valueObject.v = null, valueObject.f = `${value.v}`, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject)) : (_a12 = formulaData == null ? void 0 : formulaData[toRow]) != null && _a12[toCol] && (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject));\n    }), valueMatrix;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getValueMatrixOfPasteFromIsNull, \"getValueMatrixOfPasteFromIsNull\");\nfunction $f3129b461bb1bc83$var$getSpecialPasteValueValueMatrix(unitId, subUnitId, range, matrix, formulaDataModel, pasteFrom) {\n    var _a11, _b, _c, _d;\n    const valueMatrix = new (0, $7yNYd.ObjectMatrix)(), arrayFormulaCellData = (_b = (_a11 = formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[pasteFrom.unitId]) == null ? void 0 : _b[pasteFrom.subUnitId], formulaData = (_d = (_c = formulaDataModel.getFormulaData()) == null ? void 0 : _c[unitId]) == null ? void 0 : _d[subUnitId];\n    return matrix.forValue((row, col, value)=>{\n        var _a12, _b2;\n        const fromRow = pasteFrom.range.rows[row % pasteFrom.range.rows.length], fromCol = pasteFrom.range.cols[col % pasteFrom.range.cols.length], toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n        if ((0, $7yNYd.isFormulaString)(value.f) || (0, $7yNYd.isFormulaId)(value.si)) valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        else if ((_a12 = arrayFormulaCellData == null ? void 0 : arrayFormulaCellData[fromRow]) != null && _a12[fromCol]) {\n            const cell = arrayFormulaCellData[fromRow][fromCol];\n            valueObject.v = cell.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        } else if ((_b2 = formulaData == null ? void 0 : formulaData[toRow]) != null && _b2[toCol]) {\n            if (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, value.p) {\n                const richText = $f3129b461bb1bc83$var$getCellRichText(value);\n                richText && (valueObject.v = richText);\n            }\n            valueMatrix.setValue(toRow, toCol, valueObject);\n        }\n    }), valueMatrix;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getSpecialPasteValueValueMatrix, \"getSpecialPasteValueValueMatrix\");\nfunction $f3129b461bb1bc83$var$getSpecialPasteFormulaValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n    const valueMatrix = new (0, $7yNYd.ObjectMatrix)(), formulaIdMap = /* @__PURE__ */ new Map();\n    return matrix.forValue((row, col, value)=>{\n        const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n        if ((0, $7yNYd.isFormulaId)(value.si)) {\n            if (pasteFrom.unitId !== unitId || pasteFrom.subUnitId !== subUnitId) {\n                const formulaString = formulaDataModel.getFormulaStringByCell(pasteFrom.range.rows[row % pasteFrom.range.rows.length], pasteFrom.range.cols[col % pasteFrom.range.cols.length], pasteFrom.subUnitId, pasteFrom.unitId), offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(formulaString || \"\", offsetX, offsetY);\n                valueObject.si = null, valueObject.f = shiftedFormula;\n            } else valueObject.si = value.si, valueObject.f = null;\n            valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        } else if ((0, $7yNYd.isFormulaString)(value.f)) {\n            const index = `${row % pasteFrom.range.rows.length}_${col % pasteFrom.range.cols.length}`;\n            let formulaId = formulaIdMap.get(index);\n            if (formulaId) valueObject.si = formulaId, valueObject.f = null;\n            else {\n                formulaId = (0, $7yNYd.Tools).generateRandomId(6), formulaIdMap.set(index, formulaId);\n                const offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(value.f || \"\", offsetX, offsetY);\n                valueObject.si = formulaId, valueObject.f = shiftedFormula;\n            }\n            valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        } else {\n            if (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, value.p) {\n                const richText = $f3129b461bb1bc83$var$getCellRichText(value);\n                richText && (valueObject.v = richText);\n            }\n            valueMatrix.setValue(toRow, toCol, valueObject);\n        }\n    }), valueMatrix;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getSpecialPasteFormulaValueMatrix, \"getSpecialPasteFormulaValueMatrix\");\nfunction $f3129b461bb1bc83$var$getDefaultPasteValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n    var _a11, _b;\n    const valueMatrix = new (0, $7yNYd.ObjectMatrix)(), formulaIdMap = /* @__PURE__ */ new Map(), formulaData = (_b = (_a11 = formulaDataModel.getFormulaData()) == null ? void 0 : _a11[unitId]) == null ? void 0 : _b[subUnitId];\n    return matrix.forValue((row, col, value)=>{\n        var _a12;\n        const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n        if ((0, $7yNYd.isFormulaId)(value.si)) {\n            if (pasteFrom.unitId !== unitId || pasteFrom.subUnitId !== subUnitId) {\n                const formulaString = formulaDataModel.getFormulaStringByCell(pasteFrom.range.rows[row % pasteFrom.range.rows.length], pasteFrom.range.cols[col % pasteFrom.range.cols.length], pasteFrom.subUnitId, pasteFrom.unitId), offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(formulaString || \"\", offsetX, offsetY);\n                valueObject.si = null, valueObject.f = shiftedFormula;\n            } else valueObject.si = value.si, valueObject.f = null;\n            valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        } else if ((0, $7yNYd.isFormulaString)(value.f)) {\n            const index = `${row % pasteFrom.range.rows.length}_${col % pasteFrom.range.cols.length}`;\n            let formulaId = formulaIdMap.get(index);\n            if (formulaId) valueObject.si = formulaId, valueObject.f = null;\n            else {\n                formulaId = (0, $7yNYd.Tools).generateRandomId(6), formulaIdMap.set(index, formulaId);\n                const offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(value.f || \"\", offsetX, offsetY);\n                valueObject.si = formulaId, valueObject.f = shiftedFormula;\n            }\n            valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n        } else (_a12 = formulaData == null ? void 0 : formulaData[toRow]) != null && _a12[toCol] && (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = value.p, valueMatrix.setValue(toRow, toCol, valueObject));\n    }), valueMatrix;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getDefaultPasteValueMatrix, \"getDefaultPasteValueMatrix\");\nfunction $f3129b461bb1bc83$var$getCellRichText(cell) {\n    if (cell != null && cell.p) {\n        const body = cell == null ? void 0 : cell.p.body;\n        if (body == null) return;\n        const data = body.dataStream;\n        return data.substring(data.length - 2, data.length) === (0, $7yNYd.DEFAULT_EMPTY_DOCUMENT_VALUE) ? data.substring(0, data.length - 2) : data;\n    }\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getCellRichText, \"getCellRichText\");\nvar $f3129b461bb1bc83$var$__defProp$4 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$4 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$4 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$4(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$4(target, key, result), result;\n}, \"__decorateClass$4\"), $f3129b461bb1bc83$var$__decorateParam$4 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$4\"), $f3129b461bb1bc83$var$_a6;\nlet $f3129b461bb1bc83$var$FormulaEditorShowController = ($f3129b461bb1bc83$var$_a6 = class extends (0, $7yNYd.Disposable) {\n    constructor(_context, _editorBridgeService, _formulaDataModel, _themeService, _renderManagerService, _sheetSkeletonManagerService, _commandService, _logService){\n        super();\n        $f3129b461bb1bc83$var$__publicField(this, \"_previousShape\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_skeleton\");\n        this._context = _context, this._editorBridgeService = _editorBridgeService, this._formulaDataModel = _formulaDataModel, this._themeService = _themeService, this._renderManagerService = _renderManagerService, this._sheetSkeletonManagerService = _sheetSkeletonManagerService, this._commandService = _commandService, this._logService = _logService, this._initSkeletonChangeListener(), this._initInterceptorEditorStart(), this._commandExecutedListener();\n    }\n    _initSkeletonChangeListener() {\n        this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((param)=>{\n            var _a11, _b;\n            if (param == null) this._logService.debug(\"[FormulaEditorShowController]: should not receive currentSkeleton$ as null!\");\n            else {\n                const { skeleton: skeleton } = param, prevSheetId = (_b = (_a11 = this._skeleton) == null ? void 0 : _a11.worksheet) == null ? void 0 : _b.getSheetId();\n                if (this._changeRuntime(skeleton), prevSheetId !== skeleton.worksheet.getSheetId()) this._removeArrayFormulaRangeShape();\n                else {\n                    const { unitId: unitId, sheetId: sheetId } = param;\n                    this._updateArrayFormulaRangeShape(unitId, sheetId);\n                }\n            }\n        }));\n    }\n    _changeRuntime(skeleton) {\n        this._skeleton = skeleton;\n    }\n    _initInterceptorEditorStart() {\n        this.disposeWithMe((0, $7yNYd.toDisposable)(this._editorBridgeService.interceptor.intercept(this._editorBridgeService.interceptor.getInterceptPoints().BEFORE_CELL_EDIT, {\n            handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((value, context, next)=>{\n                var _a11, _b, _c, _d;\n                const { row: row, col: col, unitId: unitId, subUnitId: subUnitId, worksheet: worksheet } = context, arrayFormulaMatrixRange = this._formulaDataModel.getArrayFormulaRange(), arrayFormulaMatrixCell = this._formulaDataModel.getArrayFormulaCellData();\n                if (this._removeArrayFormulaRangeShape(), value == null) return next(value);\n                let cellInfo = null;\n                const formulaString = this._formulaDataModel.getFormulaStringByCell(row, col, subUnitId, unitId);\n                if (formulaString !== null && (cellInfo = {\n                    f: formulaString\n                }), value.v != null && value.v !== \"\" && ((_c = (_b = (_a11 = arrayFormulaMatrixCell[unitId]) == null ? void 0 : _a11[subUnitId]) == null ? void 0 : _b[row]) == null ? void 0 : _c[col]) == null) return cellInfo ? {\n                    ...value,\n                    ...cellInfo\n                } : next(value);\n                const matrixRange = (_d = arrayFormulaMatrixRange == null ? void 0 : arrayFormulaMatrixRange[unitId]) == null ? void 0 : _d[subUnitId];\n                return matrixRange != null && (cellInfo = this._displayArrayFormulaRangeShape(matrixRange, row, col, unitId, subUnitId, worksheet, cellInfo)), cellInfo ? {\n                    ...value,\n                    ...cellInfo\n                } : next(value);\n            }, \"handler\")\n        })));\n    }\n    _commandExecutedListener() {\n        this.disposeWithMe(this._commandService.onCommandExecuted((command, options)=>{\n            (command.id === (0, $86b1c.SetFormulaCalculationResultMutation).id || command.id === (0, $86b1c.SetArrayFormulaDataMutation).id && options && options.remove) && this._removeArrayFormulaRangeShape();\n        })), this.disposeWithMe(this._commandService.beforeCommandExecuted((command)=>{\n            (0, $ejawP.SetWorksheetRowAutoHeightMutation).id === command.id && requestIdleCallback(()=>{\n                const params = command.params, { unitId: unitId, subUnitId: subUnitId, rowsAutoHeightInfo: rowsAutoHeightInfo } = params;\n                this._refreshArrayFormulaRangeShapeByRow(unitId, subUnitId, rowsAutoHeightInfo);\n            });\n        }));\n    }\n    _displayArrayFormulaRangeShape(matrixRange, row, col, unitId, subUnitId, worksheet, cellInfo) {\n        return new (0, $7yNYd.ObjectMatrix)(matrixRange).forValue((rowIndex, columnIndex, range)=>{\n            if (range == null) return !0;\n            const { startRow: startRow, startColumn: startColumn, endRow: endRow, endColumn: endColumn } = range;\n            if (rowIndex === row && columnIndex === col) return this._createArrayFormulaRangeShape(range, unitId), !1;\n            if (row >= startRow && row <= endRow && col >= startColumn && col <= endColumn) {\n                const mainCellValue = worksheet.getCell(startRow, startColumn);\n                if ((mainCellValue == null ? void 0 : mainCellValue.v) === (0, $86b1c.ErrorType).SPILL) return;\n                const formulaDataItem = this._formulaDataModel.getFormulaDataItem(rowIndex, columnIndex, subUnitId, unitId);\n                return formulaDataItem == null || formulaDataItem.f == null ? !0 : (cellInfo == null && (cellInfo = {\n                    f: formulaDataItem.f,\n                    isInArrayFormulaRange: !0\n                }), this._createArrayFormulaRangeShape(range, unitId), !1);\n            }\n        }), cellInfo;\n    }\n    _createArrayFormulaRangeShape(arrayRange, unitId) {\n        const styleSheet = this._themeService.getCurrentTheme(), fill = new (0, $7yNYd.ColorKit)(styleSheet.colorWhite).setAlpha(0).toString(), style = {\n            strokeWidth: 1,\n            stroke: styleSheet.hyacinth700,\n            fill: fill,\n            widgets: {},\n            hasAutoFill: !1,\n            hasRowHeader: !1,\n            hasColumnHeader: !1\n        }, renderUnit = this._renderManagerService.getRenderById(unitId);\n        if (!renderUnit) return;\n        const { scene: scene } = renderUnit, { rangeWithCoord: rangeWithCoord, primaryWithCoord: primaryWithCoord } = renderUnit.with((0, $4XALk.ISheetSelectionRenderService)).attachSelectionWithCoord({\n            range: arrayRange,\n            primary: null,\n            style: style\n        }), skeleton = this._sheetSkeletonManagerService.getCurrentSkeleton();\n        if (!scene || !skeleton) return;\n        const { rowHeaderWidth: rowHeaderWidth, columnHeaderHeight: columnHeaderHeight } = skeleton, control = new (0, $4XALk.SelectionShape)(scene, (0, $4XALk.SELECTION_SHAPE_DEPTH).FORMULA_EDITOR_SHOW, this._themeService, !1);\n        control.update(rangeWithCoord, rowHeaderWidth, columnHeaderHeight, style, primaryWithCoord), control.setEvent(!1), this._previousShape = control;\n    }\n    _removeArrayFormulaRangeShape() {\n        this._previousShape != null && (this._previousShape.dispose(), this._previousShape = null);\n    }\n    _refreshArrayFormulaRangeShape(unitId, _range) {\n        if (this._previousShape) {\n            const { startRow: startRow, endRow: endRow, startColumn: startColumn, endColumn: endColumn } = this._previousShape.getRange(), range = {\n                startRow: startRow,\n                endRow: endRow,\n                startColumn: startColumn,\n                endColumn: endColumn\n            };\n            this._removeArrayFormulaRangeShape(), this._createArrayFormulaRangeShape(range, unitId);\n        }\n    }\n    _checkCurrentSheet(unitId, subUnitId) {\n        const skeleton = this._sheetSkeletonManagerService.getCurrentSkeleton();\n        if (!skeleton) return !1;\n        const worksheet = skeleton.worksheet;\n        return worksheet ? worksheet.unitId === unitId && worksheet.getSheetId() === subUnitId : !1;\n    }\n    _updateArrayFormulaRangeShape(unitId, subUnitId) {\n        this._checkCurrentSheet(unitId, subUnitId) && this._previousShape && this._refreshArrayFormulaRangeShape(unitId);\n    }\n    _refreshArrayFormulaRangeShapeByRow(unitId, subUnitId, rowAutoHeightInfo) {\n        if (!this._checkCurrentSheet(unitId, subUnitId) || !this._previousShape) return;\n        const { startRow: shapeStartRow, endRow: shapeEndRow, startColumn: shapeStartColumn, endColumn: shapeEndColumn } = this._previousShape.getRange();\n        for(let i = 0; i < rowAutoHeightInfo.length; i++){\n            const { row: row } = rowAutoHeightInfo[i];\n            if (shapeStartRow >= row) {\n                const shapeRange = {\n                    startRow: shapeStartRow,\n                    endRow: shapeEndRow,\n                    startColumn: shapeStartColumn,\n                    endColumn: shapeEndColumn\n                };\n                this._refreshArrayFormulaRangeShape(unitId, shapeRange);\n                break;\n            }\n        }\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a6, \"FormulaEditorShowController\"), $f3129b461bb1bc83$var$_a6);\n$f3129b461bb1bc83$var$FormulaEditorShowController = $f3129b461bb1bc83$var$__decorateClass$4([\n    $f3129b461bb1bc83$var$__decorateParam$4(1, (0, $7yNYd.Inject)((0, $4XALk.IEditorBridgeService))),\n    $f3129b461bb1bc83$var$__decorateParam$4(2, (0, $7yNYd.Inject)((0, $86b1c.FormulaDataModel))),\n    $f3129b461bb1bc83$var$__decorateParam$4(3, (0, $7yNYd.Inject)((0, $7yNYd.ThemeService))),\n    $f3129b461bb1bc83$var$__decorateParam$4(4, (0, $3e0Iz.IRenderManagerService)),\n    $f3129b461bb1bc83$var$__decorateParam$4(5, (0, $7yNYd.Inject)((0, $4XALk.SheetSkeletonManagerService))),\n    $f3129b461bb1bc83$var$__decorateParam$4(6, (0, $7yNYd.ICommandService)),\n    $f3129b461bb1bc83$var$__decorateParam$4(7, (0, $7yNYd.ILogService))\n], $f3129b461bb1bc83$var$FormulaEditorShowController);\nvar $f3129b461bb1bc83$var$__defProp$3 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$3 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$3 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$3(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$3(target, key, result), result;\n}, \"__decorateClass$3\"), $f3129b461bb1bc83$var$__decorateParam$3 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$3\");\nconst $f3129b461bb1bc83$var$FORMULA_ERROR_MARK = {\n    tl: {\n        size: 6,\n        color: \"#409f11\"\n    }\n};\nvar $f3129b461bb1bc83$var$_a7;\nlet $f3129b461bb1bc83$var$FormulaRenderManagerController = ($f3129b461bb1bc83$var$_a7 = class extends (0, $7yNYd.RxDisposable) {\n    constructor(_sheetInterceptorService, _formulaDataModel){\n        super(), this._sheetInterceptorService = _sheetInterceptorService, this._formulaDataModel = _formulaDataModel, this.disposeWithMe(this._sheetInterceptorService.intercept((0, $ejawP.INTERCEPTOR_POINT).CELL_CONTENT, {\n            effect: (0, $7yNYd.InterceptorEffectEnum).Style,\n            handler: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((cell, pos, next)=>{\n                var _a11, _b, _c, _d;\n                const arrayFormulaCellData = (_d = (_c = (_b = (_a11 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[pos.unitId]) == null ? void 0 : _b[pos.subUnitId]) == null ? void 0 : _c[pos.row]) == null ? void 0 : _d[pos.col];\n                return $f3129b461bb1bc83$var$extractFormulaError(cell, !!arrayFormulaCellData) ? next({\n                    ...cell,\n                    markers: {\n                        ...cell == null ? void 0 : cell.markers,\n                        ...$f3129b461bb1bc83$var$FORMULA_ERROR_MARK\n                    }\n                }) : next(cell);\n            }, \"handler\"),\n            priority: 10\n        }));\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a7, \"FormulaRenderManagerController\"), $f3129b461bb1bc83$var$_a7);\n$f3129b461bb1bc83$var$FormulaRenderManagerController = $f3129b461bb1bc83$var$__decorateClass$3([\n    $f3129b461bb1bc83$var$__decorateParam$3(0, (0, $7yNYd.Inject)((0, $ejawP.SheetInterceptorService))),\n    $f3129b461bb1bc83$var$__decorateParam$3(1, (0, $7yNYd.Inject)((0, $86b1c.FormulaDataModel)))\n], $f3129b461bb1bc83$var$FormulaRenderManagerController);\nfunction $f3129b461bb1bc83$var$FormulaProgressBar() {\n    const triggerCalculationController = (0, $7yNYd.useDependency)((0, $bRzks.TriggerCalculationController)), commandService = (0, $7yNYd.useDependency)((0, $7yNYd.ICommandService)), progress = (0, $7yNYd.useObservable)(triggerCalculationController.progress$), terminateCalculation = (0, $5gqvu.useCallback)(()=>{\n        commandService.executeCommand((0, $86b1c.SetFormulaCalculationStopMutation).id);\n    }, [\n        commandService\n    ]), clearProgress = (0, $5gqvu.useCallback)(()=>{\n        triggerCalculationController.clearProgress();\n    }, [\n        triggerCalculationController\n    ]);\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $fL2Ug.ProgressBar), {\n        progress: progress,\n        onTerminate: terminateCalculation,\n        onClearProgress: clearProgress\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$FormulaProgressBar, \"FormulaProgressBar\");\nfunction $f3129b461bb1bc83$var$getFunctionTypeValues(enumObj, localeService) {\n    return Object.keys(enumObj).filter((key)=>isNaN(Number(key)) && key !== \"DefinedName\").map((key)=>({\n            label: localeService.t(`formula.functionType.${key.toLocaleLowerCase()}`),\n            value: `${enumObj[key]}`\n        }));\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getFunctionTypeValues, \"getFunctionTypeValues\");\nfunction $f3129b461bb1bc83$var$generateParam(param) {\n    if (!param.require && !param.repeat) return `[${param.name}]`;\n    if (param.require && !param.repeat) return param.name;\n    if (!param.require && param.repeat) return `[${param.name},...]`;\n    if (param.require && param.repeat) return `${param.name},...`;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$generateParam, \"generateParam\");\nconst $f3129b461bb1bc83$var$useResizeScrollObserver = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((callback, delay = 100)=>{\n    (0, $5gqvu.useEffect)(()=>{\n        let throttleTimeout = null;\n        const throttledCallback = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n            throttleTimeout === null && (throttleTimeout = window.setTimeout(()=>{\n                callback(), throttleTimeout = null;\n            }, delay));\n        }, \"throttledCallback\");\n        return window.addEventListener(\"scroll\", throttledCallback), window.addEventListener(\"resize\", throttledCallback), ()=>{\n            throttleTimeout !== null && clearTimeout(throttleTimeout), window.removeEventListener(\"scroll\", throttledCallback), window.removeEventListener(\"resize\", throttledCallback);\n        };\n    }, [\n        callback,\n        delay\n    ]);\n}, \"useResizeScrollObserver\"), $f3129b461bb1bc83$var$formulaHelpFunction = \"univer-formula-help-function\", $f3129b461bb1bc83$var$formulaHelpFunctionTitle = \"univer-formula-help-function-title\", $f3129b461bb1bc83$var$formulaHelpFunctionTitleIcons = \"univer-formula-help-function-title-icons\", $f3129b461bb1bc83$var$formulaHelpFunctionTitleIcon = \"univer-formula-help-function-title-icon\", $f3129b461bb1bc83$var$formulaHelpFunctionContent = \"univer-formula-help-function-content\", $f3129b461bb1bc83$var$formulaHelpFunctionContentInner = \"univer-formula-help-function-content-inner\", $f3129b461bb1bc83$var$formulaHelpFunctionContentParams = \"univer-formula-help-function-content-params\", $f3129b461bb1bc83$var$formulaHelpFunctionContentParamsTitle = \"univer-formula-help-function-content-params-title\", $f3129b461bb1bc83$var$formulaHelpFunctionContentParamsDetail = \"univer-formula-help-function-content-params-detail\", $f3129b461bb1bc83$var$formulaHelpFunctionActive = \"univer-formula-help-function-active\", $f3129b461bb1bc83$var$formulaHelpDecorator = \"univer-formula-help-decorator\", $f3129b461bb1bc83$var$formulaHelpParam = \"univer-formula-help-param\", $f3129b461bb1bc83$var$formulaHelpParamPrefix = \"univer-formula-help-param-prefix\", $f3129b461bb1bc83$var$formulaHelpParamItem = \"univer-formula-help-param-item\", $f3129b461bb1bc83$var$formulaHelpParamActive = \"univer-formula-help-param-active\", $f3129b461bb1bc83$var$styles$5 = {\n    formulaHelpFunction: $f3129b461bb1bc83$var$formulaHelpFunction,\n    formulaHelpFunctionTitle: $f3129b461bb1bc83$var$formulaHelpFunctionTitle,\n    formulaHelpFunctionTitleIcons: $f3129b461bb1bc83$var$formulaHelpFunctionTitleIcons,\n    formulaHelpFunctionTitleIcon: $f3129b461bb1bc83$var$formulaHelpFunctionTitleIcon,\n    formulaHelpFunctionContent: $f3129b461bb1bc83$var$formulaHelpFunctionContent,\n    formulaHelpFunctionContentInner: $f3129b461bb1bc83$var$formulaHelpFunctionContentInner,\n    formulaHelpFunctionContentParams: $f3129b461bb1bc83$var$formulaHelpFunctionContentParams,\n    formulaHelpFunctionContentParamsTitle: $f3129b461bb1bc83$var$formulaHelpFunctionContentParamsTitle,\n    formulaHelpFunctionContentParamsDetail: $f3129b461bb1bc83$var$formulaHelpFunctionContentParamsDetail,\n    formulaHelpFunctionActive: $f3129b461bb1bc83$var$formulaHelpFunctionActive,\n    formulaHelpDecorator: $f3129b461bb1bc83$var$formulaHelpDecorator,\n    formulaHelpParam: $f3129b461bb1bc83$var$formulaHelpParam,\n    formulaHelpParamPrefix: $f3129b461bb1bc83$var$formulaHelpParamPrefix,\n    formulaHelpParamItem: $f3129b461bb1bc83$var$formulaHelpParamItem,\n    formulaHelpParamActive: $f3129b461bb1bc83$var$formulaHelpParamActive\n};\nfunction $f3129b461bb1bc83$var$HelpFunction() {\n    const [visible, setVisible] = (0, $5gqvu.useState)(!1), [contentVisible, setContentVisible] = (0, $5gqvu.useState)(!0), [helpVisible, setHelpVisible] = (0, $5gqvu.useState)(!0), [paramIndex, setParamIndex] = (0, $5gqvu.useState)(0), [offset, setOffset] = (0, $5gqvu.useState)([\n        0,\n        0\n    ]), [decoratorPosition, setDecoratorPosition] = (0, $5gqvu.useState)({\n        left: 0,\n        top: 0\n    }), [functionInfo, setFunctionInfo] = (0, $5gqvu.useState)(null), promptService = (0, $7yNYd.useDependency)($f3129b461bb1bc83$var$IFormulaPromptService), localeService = (0, $7yNYd.useDependency)((0, $7yNYd.LocaleService)), required = localeService.t(\"formula.prompt.required\"), optional = localeService.t(\"formula.prompt.optional\"), univerInstanceService = (0, $7yNYd.useDependency)((0, $7yNYd.IUniverInstanceService)), editorService = (0, $7yNYd.useDependency)((0, $g6Cit.IEditorService)), sidebarService = (0, $7yNYd.useDependency)((0, $fL2Ug.ISidebarService)), injector = (0, $7yNYd.useInjector)();\n    $f3129b461bb1bc83$var$useResizeScrollObserver(updatePosition), (0, $5gqvu.useEffect)(()=>{\n        const subscription = promptService.help$.subscribe((params)=>{\n            const { visible: visible2, paramIndex: paramIndex2, functionInfo: functionInfo2 } = params;\n            if (!visible2) {\n                setVisible(visible2);\n                return;\n            }\n            const position = getPosition();\n            if (position == null) return;\n            const { left: left, top: top, height: height } = position;\n            functionInfo2.description === \"\" && functionInfo2.functionParameter.length === 0 || (setOffset([\n                left,\n                top + height\n            ]), setParamIndex(paramIndex2), setFunctionInfo(functionInfo2), setDecoratorPosition({\n                left: left,\n                top: top\n            }), setVisible(visible2));\n        }), sidebarSubscription = sidebarService.scrollEvent$.pipe((0, $gv2K9.throttleTime)(100)).subscribe(updatePosition);\n        return ()=>{\n            subscription == null || subscription.unsubscribe(), sidebarSubscription.unsubscribe();\n        };\n    }, []);\n    function updatePosition() {\n        if (!helpVisible) return;\n        const position = getPosition();\n        if (position == null) return;\n        const { left: left, top: top, height: height } = position;\n        setOffset([\n            left,\n            top + height\n        ]);\n    }\n    $f3129b461bb1bc83$var$__name(updatePosition, \"updatePosition\");\n    function getPosition() {\n        const documentDataModel = univerInstanceService.getCurrentUniverDocInstance();\n        if (!documentDataModel) return;\n        const editorUnitId = documentDataModel.getUnitId();\n        if (!editorService.isEditor(editorUnitId)) return;\n        const editor = editorService.getEditor(editorUnitId);\n        return editor == null ? void 0 : editor.getBoundingClientRect();\n    }\n    $f3129b461bb1bc83$var$__name(getPosition, \"getPosition\");\n    function handleSwitchActive(paramIndex2) {\n        setParamIndex(paramIndex2);\n    }\n    $f3129b461bb1bc83$var$__name(handleSwitchActive, \"handleSwitchActive\");\n    function handleClose() {\n        setHelpVisible(!helpVisible), injector.get((0, $fL2Ug.ILayoutService)).focus();\n    }\n    return $f3129b461bb1bc83$var$__name(handleClose, \"handleClose\"), /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$jsxRuntimeExports.Fragment, {\n        children: helpVisible ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Popup), {\n            visible: visible,\n            offset: offset,\n            children: functionInfo ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunction,\n                children: [\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionTitle,\n                        children: [\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$Help, {\n                                prefix: functionInfo.functionName,\n                                value: functionInfo.functionParameter,\n                                active: paramIndex,\n                                onClick: handleSwitchActive\n                            }),\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                                className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionTitleIcons,\n                                children: [\n                                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                                        className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionTitleIcon,\n                                        style: {\n                                            transform: contentVisible ? \"rotateZ(-90deg)\" : \"rotateZ(90deg)\"\n                                        },\n                                        onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>setContentVisible(!contentVisible), \"onClick\"),\n                                        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$MoreSingle, {})\n                                    }),\n                                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                                        className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionTitleIcon,\n                                        onClick: handleClose,\n                                        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$CloseSingle, {})\n                                    })\n                                ]\n                            })\n                        ]\n                    }),\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                        className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionContent,\n                        style: {\n                            height: contentVisible ? \"unset\" : 0,\n                            padding: contentVisible ? \"revert-layer\" : 0\n                        },\n                        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                            className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionContentInner,\n                            children: [\n                                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$Params, {\n                                    title: localeService.t(\"formula.prompt.helpExample\"),\n                                    value: `${functionInfo.functionName}(${functionInfo.functionParameter.map((item)=>item.example).join(\",\")})`\n                                }),\n                                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$Params, {\n                                    title: localeService.t(\"formula.prompt.helpAbstract\"),\n                                    value: functionInfo.description\n                                }),\n                                functionInfo && functionInfo.functionParameter && functionInfo.functionParameter.map((item, i)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$Params, {\n                                        className: paramIndex === i ? $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionActive : \"\",\n                                        title: item.name,\n                                        value: `${item.require ? required : optional} ${item.detail}`\n                                    }, i))\n                            ]\n                        })\n                    })\n                ]\n            }) : /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$jsxRuntimeExports.Fragment, {})\n        }) : visible ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n            className: $f3129b461bb1bc83$var$styles$5.formulaHelpDecorator,\n            onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>setHelpVisible(!helpVisible), \"onClick\"),\n            style: {\n                left: decoratorPosition.left - 24,\n                top: decoratorPosition.top\n            },\n            children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$DetailsSingle, {})\n        }) : /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$jsxRuntimeExports.Fragment, {})\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$HelpFunction, \"HelpFunction\");\nconst $f3129b461bb1bc83$var$Params = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((props)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionContentParams,\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: `${$f3129b461bb1bc83$var$styles$5.formulaHelpFunctionContentParamsTitle} ${props.className}`,\n                children: props.title\n            }),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionContentParamsDetail,\n                children: props.value\n            })\n        ]\n    }), \"Params\"), $f3129b461bb1bc83$var$Help = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((props)=>{\n    const { prefix: prefix, value: value, active: active, onClick: onClick } = props;\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$5.formulaHelpParam,\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"span\", {\n                className: $f3129b461bb1bc83$var$styles$5.formulaHelpParamPrefix,\n                children: [\n                    prefix,\n                    \"(\"\n                ]\n            }),\n            value && value.map((item, i)=>// TODO@Dushusir: more params needs to be active\n                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"span\", {\n                    className: $f3129b461bb1bc83$var$styles$5.formulaHelpParamItem,\n                    children: [\n                        /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                            className: active === i ? $f3129b461bb1bc83$var$styles$5.formulaHelpFunctionActive : $f3129b461bb1bc83$var$styles$5.formulaHelpParamActive,\n                            onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>onClick(i), \"onClick\"),\n                            children: $f3129b461bb1bc83$var$generateParam(item)\n                        }),\n                        i === value.length - 1 ? \"\" : \",\"\n                    ]\n                }, i)),\n            \")\"\n        ]\n    });\n}, \"Help\"), $f3129b461bb1bc83$var$formulaSearchFunction = \"univer-formula-search-function\", $f3129b461bb1bc83$var$formulaSearchFunctionItem = \"univer-formula-search-function-item\", $f3129b461bb1bc83$var$formulaSearchFunctionItemName = \"univer-formula-search-function-item-name\", $f3129b461bb1bc83$var$formulaSearchFunctionItemNameLight = \"univer-formula-search-function-item-name-light\", $f3129b461bb1bc83$var$formulaSearchFunctionItemDesc = \"univer-formula-search-function-item-desc\", $f3129b461bb1bc83$var$formulaSearchFunctionItemActive = \"univer-formula-search-function-item-active\", $f3129b461bb1bc83$var$styles$4 = {\n    formulaSearchFunction: $f3129b461bb1bc83$var$formulaSearchFunction,\n    formulaSearchFunctionItem: $f3129b461bb1bc83$var$formulaSearchFunctionItem,\n    formulaSearchFunctionItemName: $f3129b461bb1bc83$var$formulaSearchFunctionItemName,\n    formulaSearchFunctionItemNameLight: $f3129b461bb1bc83$var$formulaSearchFunctionItemNameLight,\n    formulaSearchFunctionItemDesc: $f3129b461bb1bc83$var$formulaSearchFunctionItemDesc,\n    formulaSearchFunctionItemActive: $f3129b461bb1bc83$var$formulaSearchFunctionItemActive\n};\nfunction $f3129b461bb1bc83$var$SearchFunction() {\n    const [visible, setVisible] = (0, $5gqvu.useState)(!1), [active, setActive] = (0, $5gqvu.useState)(0), [offset, setOffset] = (0, $5gqvu.useState)([\n        0,\n        0\n    ]), [searchList, setSearchList] = (0, $5gqvu.useState)([]), [searchText, setSearchText] = (0, $5gqvu.useState)(\"\"), ulRef = (0, $5gqvu.useRef)(null), promptService = (0, $7yNYd.useDependency)($f3129b461bb1bc83$var$IFormulaPromptService), univerInstanceService = (0, $7yNYd.useDependency)((0, $7yNYd.IUniverInstanceService)), editorService = (0, $7yNYd.useDependency)((0, $g6Cit.IEditorService));\n    (0, $5gqvu.useEffect)(()=>{\n        let updatedSearchList = [], updatedActive = 0;\n        const subscribeSearch = promptService.search$.subscribe((params)=>{\n            const { visible: visible2, searchText: searchText2, searchList: searchList2 } = params;\n            if (!visible2) {\n                setVisible(visible2);\n                return;\n            }\n            const position = getPosition();\n            if (position == null) return;\n            const { left: left, top: top, height: height } = position;\n            setSearchText(searchText2), setSearchList(searchList2), updatedSearchList = searchList2, setOffset([\n                left,\n                top + height\n            ]), setVisible(visible2), setActive(0), updatedActive = 0;\n        }), subscribeNavigate = promptService.navigate$.subscribe((params)=>{\n            const { direction: direction } = params;\n            if (direction === (0, $7yNYd.Direction).UP) {\n                let nextActive = updatedActive - 1;\n                nextActive = nextActive < 0 ? updatedSearchList.length - 1 : nextActive, setActive(nextActive), updatedActive = nextActive;\n            } else if (direction === (0, $7yNYd.Direction).DOWN) {\n                let nextActive = updatedActive + 1;\n                nextActive = nextActive >= updatedSearchList.length ? 0 : nextActive, setActive(nextActive), updatedActive = nextActive;\n            }\n            scrollToVisible(updatedActive);\n        }), subscribeAccept = promptService.accept$.subscribe((params)=>{\n            const functionName = updatedSearchList[updatedActive].name;\n            promptService.acceptFormulaName(functionName);\n        });\n        return ()=>{\n            subscribeSearch == null || subscribeSearch.unsubscribe(), subscribeNavigate == null || subscribeNavigate.unsubscribe(), subscribeAccept == null || subscribeAccept.unsubscribe();\n        };\n    }, []);\n    function getPosition() {\n        const editorUnitId = univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n        if (!editorService.isEditor(editorUnitId)) return;\n        const editor = editorService.getEditor(editorUnitId);\n        return editor == null ? void 0 : editor.getBoundingClientRect();\n    }\n    $f3129b461bb1bc83$var$__name(getPosition, \"getPosition\");\n    function handleLiMouseEnter(index) {\n        setActive(index);\n    }\n    $f3129b461bb1bc83$var$__name(handleLiMouseEnter, \"handleLiMouseEnter\");\n    function handleLiMouseLeave() {\n        setActive(-1);\n    }\n    $f3129b461bb1bc83$var$__name(handleLiMouseLeave, \"handleLiMouseLeave\");\n    function scrollToVisible(liIndex) {\n        var _a11;\n        const liElement = (_a11 = ulRef.current) == null ? void 0 : _a11.querySelectorAll(`.${$f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItem}`)[liIndex];\n        if (!liElement) return;\n        const ulElement = liElement.parentNode;\n        if (!ulElement) return;\n        const ulTop = ulElement.getBoundingClientRect().top, ulHeight = ulElement.offsetHeight, liRect = liElement.getBoundingClientRect(), liTop = liRect.top, liHeight = liRect.height;\n        if (liTop >= 0 && liTop > ulTop && liTop - ulTop + liHeight <= ulHeight) return;\n        const scrollTo = liElement.offsetTop - (ulHeight - liHeight) / 2;\n        ulElement.scrollTo({\n            top: scrollTo,\n            behavior: \"smooth\"\n        });\n    }\n    return $f3129b461bb1bc83$var$__name(scrollToVisible, \"scrollToVisible\"), searchList.length > 0 && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Popup), {\n        visible: visible,\n        offset: offset,\n        children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"ul\", {\n            className: $f3129b461bb1bc83$var$styles$4.formulaSearchFunction,\n            ref: ulRef,\n            children: searchList.map((item, index)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"li\", {\n                    className: active === index ? `${$f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItem} ${$f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItemActive}` : $f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItem,\n                    onMouseEnter: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>handleLiMouseEnter(index), \"onMouseEnter\"),\n                    onMouseLeave: handleLiMouseLeave,\n                    onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>promptService.acceptFormulaName(item.name), \"onClick\"),\n                    children: [\n                        /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"span\", {\n                            className: $f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItemName,\n                            children: [\n                                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                                    className: $f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItemNameLight,\n                                    children: item.name.substring(0, searchText.length)\n                                }),\n                                /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                                    children: item.name.slice(searchText.length)\n                                })\n                            ]\n                        }),\n                        /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                            className: $f3129b461bb1bc83$var$styles$4.formulaSearchFunctionItemDesc,\n                            children: item.desc\n                        })\n                    ]\n                }, index))\n        })\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$SearchFunction, \"SearchFunction\");\nfunction $f3129b461bb1bc83$var$RenderFormulaPromptContent() {\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs($f3129b461bb1bc83$var$jsxRuntimeExports.Fragment, {\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$SearchFunction, {}),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$HelpFunction, {})\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$RenderFormulaPromptContent, \"RenderFormulaPromptContent\");\nconst $f3129b461bb1bc83$var$formulaMoreFunctions = \"univer-formula-more-functions\", $f3129b461bb1bc83$var$formulaMoreFunctionsOperation = \"univer-formula-more-functions-operation\", $f3129b461bb1bc83$var$styles$3 = {\n    formulaMoreFunctions: $f3129b461bb1bc83$var$formulaMoreFunctions,\n    formulaMoreFunctionsOperation: $f3129b461bb1bc83$var$formulaMoreFunctionsOperation\n};\nfunction $f3129b461bb1bc83$var$FunctionHelp(props) {\n    const { prefix: prefix, value: value } = props;\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"span\", {\n                children: [\n                    prefix,\n                    \"(\"\n                ]\n            }),\n            value && value.map((item, i)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"span\", {\n                    children: [\n                        /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                            children: $f3129b461bb1bc83$var$generateParam(item)\n                        }),\n                        i === value.length - 1 ? \"\" : \",\"\n                    ]\n                }, i)),\n            \")\"\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$FunctionHelp, \"FunctionHelp\");\nconst $f3129b461bb1bc83$var$formulaFunctionParams = \"univer-formula-function-params\", $f3129b461bb1bc83$var$formulaFunctionParamsTitle = \"univer-formula-function-params-title\", $f3129b461bb1bc83$var$formulaFunctionParamsDetail = \"univer-formula-function-params-detail\", $f3129b461bb1bc83$var$styles$2 = {\n    formulaFunctionParams: $f3129b461bb1bc83$var$formulaFunctionParams,\n    formulaFunctionParamsTitle: $f3129b461bb1bc83$var$formulaFunctionParamsTitle,\n    formulaFunctionParamsDetail: $f3129b461bb1bc83$var$formulaFunctionParamsDetail\n};\nfunction $f3129b461bb1bc83$var$FunctionParams(props) {\n    const { className: className, value: value, title: title } = props;\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$2.formulaFunctionParams,\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: `${$f3129b461bb1bc83$var$styles$2.formulaFunctionParamsTitle} ${className}`,\n                children: title\n            }),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$2.formulaFunctionParamsDetail,\n                children: value\n            })\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$FunctionParams, \"FunctionParams\");\nconst $f3129b461bb1bc83$var$formulaInputParamsList = \"univer-formula-input-params-list\", $f3129b461bb1bc83$var$formulaInputParamsListItemName = \"univer-formula-input-params-list-item-name\", $f3129b461bb1bc83$var$formulaInputParamsListItemSelector = \"univer-formula-input-params-list-item-selector\", $f3129b461bb1bc83$var$styles$1 = {\n    formulaInputParamsList: $f3129b461bb1bc83$var$formulaInputParamsList,\n    formulaInputParamsListItemName: $f3129b461bb1bc83$var$formulaInputParamsListItemName,\n    formulaInputParamsListItemSelector: $f3129b461bb1bc83$var$formulaInputParamsListItemSelector\n};\nfunction $f3129b461bb1bc83$var$InputParams(props) {\n    const { functionInfo: functionInfo, onChange: onChange } = props;\n    if (!functionInfo) return null;\n    (0, $5gqvu.useState)([]);\n    const [functionParameter, setFunctionParameter] = (0, $5gqvu.useState)(functionInfo.functionParameter), [activeIndex, setActiveIndex] = (0, $5gqvu.useState)(-1);\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$1.formulaInputParams,\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$1.formulaInputParamsList,\n                children: functionParameter.map((item, i)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                        children: [\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                                className: $f3129b461bb1bc83$var$styles$1.formulaInputParamsListItemName,\n                                children: item.name\n                            }),\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                                className: $f3129b461bb1bc83$var$styles$1.formulaInputParamsListItemSelector\n                            })\n                        ]\n                    }, i))\n            }),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$1.formulaInputParamsInfo,\n                children: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionParams, {\n                    title: activeIndex === -1 ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionHelp, {\n                        prefix: functionInfo.functionName,\n                        value: functionParameter\n                    }) : functionParameter[activeIndex].name,\n                    value: activeIndex === -1 ? functionInfo.description : functionParameter[activeIndex].detail\n                })\n            })\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$InputParams, \"InputParams\");\nconst $f3129b461bb1bc83$var$formulaSelectFunctionSelect = \"univer-formula-select-function-select\", $f3129b461bb1bc83$var$formulaSelectFunctionResult = \"univer-formula-select-function-result\", $f3129b461bb1bc83$var$formulaSelectFunctionResultItem = \"univer-formula-select-function-result-item\", $f3129b461bb1bc83$var$formulaSelectFunctionResultItemNameLight = \"univer-formula-select-function-result-item-name-light\", $f3129b461bb1bc83$var$formulaSelectFunctionResultItemSelected = \"univer-formula-select-function-result-item-selected\", $f3129b461bb1bc83$var$formulaSelectFunctionResultItemActive = \"univer-formula-select-function-result-item-active\", $f3129b461bb1bc83$var$formulaSelectFunctionContent = \"univer-formula-select-function-content\", $f3129b461bb1bc83$var$styles = {\n    formulaSelectFunctionSelect: $f3129b461bb1bc83$var$formulaSelectFunctionSelect,\n    formulaSelectFunctionResult: $f3129b461bb1bc83$var$formulaSelectFunctionResult,\n    formulaSelectFunctionResultItem: $f3129b461bb1bc83$var$formulaSelectFunctionResultItem,\n    formulaSelectFunctionResultItemNameLight: $f3129b461bb1bc83$var$formulaSelectFunctionResultItemNameLight,\n    formulaSelectFunctionResultItemSelected: $f3129b461bb1bc83$var$formulaSelectFunctionResultItemSelected,\n    formulaSelectFunctionResultItemActive: $f3129b461bb1bc83$var$formulaSelectFunctionResultItemActive,\n    formulaSelectFunctionContent: $f3129b461bb1bc83$var$formulaSelectFunctionContent\n};\nfunction $f3129b461bb1bc83$var$SelectFunction(props) {\n    const { onChange: onChange } = props, allTypeValue = \"-1\", [searchText, setSearchText] = (0, $5gqvu.useState)(\"\"), [selectList, setSelectList] = (0, $5gqvu.useState)([]), [active, setActive] = (0, $5gqvu.useState)(0), [typeSelected, setTypeSelected] = (0, $5gqvu.useState)(allTypeValue), [nameSelected, setNameSelected] = (0, $5gqvu.useState)(0), [functionInfo, setFunctionInfo] = (0, $5gqvu.useState)(null), descriptionService = (0, $7yNYd.useDependency)((0, $bRzks.IDescriptionService)), localeService = (0, $7yNYd.useDependency)((0, $7yNYd.LocaleService)), sidebarService = (0, $7yNYd.useDependency)((0, $fL2Ug.ISidebarService)), sidebarOptions = (0, $7yNYd.useObservable)(sidebarService.sidebarOptions$), options = $f3129b461bb1bc83$var$getFunctionTypeValues((0, $86b1c.FunctionType), localeService);\n    options.unshift({\n        label: localeService.t(\"formula.moreFunctions.allFunctions\"),\n        value: allTypeValue\n    });\n    const required = localeService.t(\"formula.prompt.required\"), optional = localeService.t(\"formula.prompt.optional\");\n    (0, $5gqvu.useEffect)(()=>{\n        handleSelectChange(allTypeValue);\n    }, []), (0, $5gqvu.useEffect)(()=>{\n        setCurrentFunctionInfo(0);\n    }, [\n        selectList\n    ]), (0, $5gqvu.useEffect)(()=>{\n        sidebarOptions != null && sidebarOptions.visible && (setSearchText(\"\"), setSelectList([]), setActive(0), setTypeSelected(allTypeValue), setNameSelected(0), setFunctionInfo(null), handleSelectChange(allTypeValue));\n    }, [\n        sidebarOptions\n    ]);\n    const highlightSearchText = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((text)=>{\n        if (searchText.trim() === \"\") return text;\n        const regex = new RegExp(`(${searchText.toLocaleUpperCase()})`);\n        return text.split(regex).filter(Boolean).map((part, index)=>part.match(regex) ? /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItemNameLight,\n                children: part\n            }, index) : part);\n    }, \"highlightSearchText\"), setCurrentFunctionInfo = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((selectedIndex)=>{\n        if (selectList.length === 0) {\n            setFunctionInfo(null);\n            return;\n        }\n        setNameSelected(selectedIndex);\n        const functionInfo2 = descriptionService.getFunctionInfo(selectList[selectedIndex].name);\n        if (!functionInfo2) {\n            setFunctionInfo(null);\n            return;\n        }\n        setFunctionInfo(functionInfo2), onChange(functionInfo2);\n    }, \"setCurrentFunctionInfo\");\n    function handleSelectChange(value) {\n        setTypeSelected(value);\n        const selectList2 = descriptionService.getSearchListByType(+value);\n        setSelectList(selectList2);\n    }\n    $f3129b461bb1bc83$var$__name(handleSelectChange, \"handleSelectChange\");\n    function handleSearchInputChange(value) {\n        setSearchText(value);\n        const selectList2 = descriptionService.getSearchListByName(value);\n        setSelectList(selectList2);\n    }\n    $f3129b461bb1bc83$var$__name(handleSearchInputChange, \"handleSearchInputChange\");\n    function handleSelectListKeyDown(e) {\n        if (e.stopPropagation(), e.key === \"ArrowDown\") {\n            const nextActive = active + 1;\n            setActive(nextActive === selectList.length ? 0 : nextActive);\n        } else if (e.key === \"ArrowUp\") {\n            const nextActive = active - 1;\n            setActive(nextActive === -1 ? selectList.length - 1 : nextActive);\n        } else e.key === \"Enter\" && setCurrentFunctionInfo(active);\n    }\n    $f3129b461bb1bc83$var$__name(handleSelectListKeyDown, \"handleSelectListKeyDown\");\n    const handleLiMouseEnter = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index)=>{\n        setActive(index);\n    }, \"handleLiMouseEnter\"), handleLiMouseLeave = /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{\n        setActive(-1);\n    }, \"handleLiMouseLeave\");\n    return /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        children: [\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionSelect,\n                children: [\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Select), {\n                        value: typeSelected,\n                        options: options,\n                        onChange: handleSelectChange\n                    }),\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Input), {\n                        placeholder: localeService.t(\"formula.moreFunctions.searchFunctionPlaceholder\"),\n                        onKeyDown: handleSelectListKeyDown,\n                        value: searchText,\n                        onChange: handleSearchInputChange,\n                        size: \"large\",\n                        allowClear: !0\n                    })\n                ]\n            }),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"ul\", {\n                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionResult,\n                onKeyDown: handleSelectListKeyDown,\n                tabIndex: -1,\n                children: selectList.map(({ name: name }, index)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"li\", {\n                        className: active === index ? `${$f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItem} ${$f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItemActive}` : $f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItem,\n                        onMouseEnter: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>handleLiMouseEnter(index), \"onMouseEnter\"),\n                        onMouseLeave: handleLiMouseLeave,\n                        onClick: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>setCurrentFunctionInfo(index), \"onClick\"),\n                        children: [\n                            nameSelected === index && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$CheckMarkSingle, {\n                                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItemSelected\n                            }),\n                            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx(\"span\", {\n                                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionResultItemName,\n                                children: highlightSearchText(name)\n                            })\n                        ]\n                    }, index))\n            }),\n            functionInfo && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                className: $f3129b461bb1bc83$var$styles.formulaSelectFunctionContent,\n                children: [\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionParams, {\n                        title: functionInfo.functionName,\n                        value: functionInfo.description\n                    }),\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionParams, {\n                        title: localeService.t(\"formula.moreFunctions.syntax\"),\n                        value: /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionHelp, {\n                            prefix: functionInfo.functionName,\n                            value: functionInfo.functionParameter\n                        })\n                    }),\n                    /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionParams, {\n                        title: localeService.t(\"formula.prompt.helpExample\"),\n                        value: `${functionInfo.functionName}(${functionInfo.functionParameter.map((item)=>item.example).join(\",\")})`\n                    }),\n                    functionInfo.functionParameter && functionInfo.functionParameter.map((item, i)=>/* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$FunctionParams, {\n                            title: item.name,\n                            value: `${item.require ? required : optional} ${item.detail}`\n                        }, i))\n                ]\n            })\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$SelectFunction, \"SelectFunction\");\nfunction $f3129b461bb1bc83$var$MoreFunctions() {\n    const workbook = (0, $4XALk.useActiveWorkbook)(), [selectFunction, setSelectFunction] = (0, $5gqvu.useState)(!0), [inputParams, setInputParams] = (0, $5gqvu.useState)(!1), [functionInfo, setFunctionInfo] = (0, $5gqvu.useState)(null), localeService = (0, $7yNYd.useDependency)((0, $7yNYd.LocaleService)), editorService = (0, $7yNYd.useDependency)((0, $g6Cit.IEditorService));\n    function handleClickNextPrev() {\n        setSelectFunction(!selectFunction), setInputParams(!inputParams);\n    }\n    $f3129b461bb1bc83$var$__name(handleClickNextPrev, \"handleClickNextPrev\");\n    function handleConfirm() {\n        editorService.setFormula(`=${functionInfo == null ? void 0 : functionInfo.functionName}(`);\n    }\n    return $f3129b461bb1bc83$var$__name(handleConfirm, \"handleConfirm\"), /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n        className: $f3129b461bb1bc83$var$styles$3.formulaMoreFunctions,\n        children: [\n            selectFunction && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$SelectFunction, {\n                onChange: setFunctionInfo\n            }),\n            inputParams && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx($f3129b461bb1bc83$var$InputParams, {\n                functionInfo: functionInfo,\n                onChange: /* @__PURE__ */ $f3129b461bb1bc83$var$__name(()=>{}, \"onChange\")\n            }),\n            /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsxs(\"div\", {\n                className: $f3129b461bb1bc83$var$styles$3.formulaMoreFunctionsOperation,\n                children: [\n                    inputParams && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Button), {\n                        type: \"primary\",\n                        size: \"small\",\n                        onClick: handleClickNextPrev,\n                        children: localeService.t(\"formula.moreFunctions.next\")\n                    }),\n                    inputParams && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Button), {\n                        size: \"small\",\n                        onClick: handleClickNextPrev,\n                        children: localeService.t(\"formula.moreFunctions.prev\")\n                    }),\n                    selectFunction && !!workbook && /* @__PURE__ */ $f3129b461bb1bc83$var$jsxRuntimeExports.jsx((0, $1UDbf.Button), {\n                        type: \"primary\",\n                        size: \"small\",\n                        onClick: handleConfirm,\n                        children: localeService.t(\"formula.moreFunctions.confirm\")\n                    })\n                ]\n            })\n        ]\n    });\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$MoreFunctions, \"MoreFunctions\");\nfunction $f3129b461bb1bc83$var$InsertFunctionMenuItemFactory(accessor) {\n    return {\n        id: $f3129b461bb1bc83$export$ed0c9b5405071c4d.id,\n        icon: \"FunctionSingle\",\n        tooltip: \"formula.insert.tooltip\",\n        type: (0, $fL2Ug.MenuItemType).SELECTOR,\n        selections: [\n            {\n                label: \"SUM\",\n                value: \"SUM\",\n                icon: \"SumSingle\"\n            },\n            {\n                label: \"AVERAGE\",\n                value: \"AVERAGE\",\n                icon: \"AvgSingle\"\n            },\n            {\n                label: \"COUNT\",\n                value: \"COUNT\",\n                icon: \"CntSingle\"\n            },\n            {\n                label: \"MAX\",\n                value: \"MAX\",\n                icon: \"MaxSingle\"\n            },\n            {\n                label: \"MIN\",\n                value: \"MIN\",\n                icon: \"MinSingle\"\n            }\n        ],\n        hidden$: (0, $fL2Ug.getMenuHiddenObservable)(accessor, (0, $7yNYd.UniverInstanceType).UNIVER_SHEET),\n        disabled$: (0, $4XALk.getCurrentRangeDisable$)(accessor, {\n            workbookTypes: [\n                (0, $ejawP.WorkbookEditablePermission)\n            ],\n            worksheetTypes: [\n                (0, $ejawP.WorksheetEditPermission),\n                (0, $ejawP.WorksheetSetCellValuePermission)\n            ],\n            rangeTypes: [\n                (0, $ejawP.RangeProtectionPermissionEditPoint)\n            ]\n        })\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$InsertFunctionMenuItemFactory, \"InsertFunctionMenuItemFactory\");\nfunction $f3129b461bb1bc83$var$MoreFunctionsMenuItemFactory(accessor) {\n    return {\n        id: $f3129b461bb1bc83$export$c1b1be2f114a38f5.id,\n        title: \"formula.insert.more\",\n        type: (0, $fL2Ug.MenuItemType).BUTTON\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$MoreFunctionsMenuItemFactory, \"MoreFunctionsMenuItemFactory\");\nfunction $f3129b461bb1bc83$var$menuClipboardDisabledObservable(injector) {\n    return injector.get((0, $7yNYd.IUniverInstanceService)).getCurrentTypeOfUnit$((0, $7yNYd.UniverInstanceType).UNIVER_SHEET).pipe((0, $23cfA.switchMap)((workbook)=>workbook ? injector.get((0, $fL2Ug.IClipboardInterfaceService)) ? new (0, $1O3Nt.Observable)((subscriber)=>subscriber.next(!injector.get((0, $fL2Ug.IClipboardInterfaceService)).supportClipboard)) : (0, $3yupB.of)(!0) : (0, $3yupB.of)(!0)));\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$menuClipboardDisabledObservable, \"menuClipboardDisabledObservable\");\nfunction $f3129b461bb1bc83$var$PasteFormulaMenuItemFactory(accessor) {\n    return {\n        id: $f3129b461bb1bc83$export$9426163a6ae5dd94.id,\n        type: (0, $fL2Ug.MenuItemType).BUTTON,\n        title: \"formula.operation.pasteFormula\",\n        disabled$: $f3129b461bb1bc83$var$menuClipboardDisabledObservable(accessor).pipe((0, $dLBA8.combineLatestWith)((0, $4XALk.getCurrentRangeDisable$)(accessor, {\n            workbookTypes: [\n                (0, $ejawP.WorkbookEditablePermission)\n            ],\n            rangeTypes: [\n                (0, $ejawP.RangeProtectionPermissionEditPoint)\n            ],\n            worksheetTypes: [\n                (0, $ejawP.WorksheetSetCellValuePermission),\n                (0, $ejawP.WorksheetEditPermission)\n            ]\n        })), (0, $hciHF.map)(([d1, d2])=>d1 || d2))\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$PasteFormulaMenuItemFactory, \"PasteFormulaMenuItemFactory\");\nconst $f3129b461bb1bc83$var$menuSchema = {\n    [(0, $fL2Ug.RibbonStartGroup).FORMULAS_INSERT]: {\n        [$f3129b461bb1bc83$export$ed0c9b5405071c4d.id]: {\n            order: 1,\n            menuItemFactory: $f3129b461bb1bc83$var$InsertFunctionMenuItemFactory,\n            [$f3129b461bb1bc83$export$c1b1be2f114a38f5.id]: {\n                order: 1,\n                menuItemFactory: $f3129b461bb1bc83$var$MoreFunctionsMenuItemFactory\n            }\n        }\n    },\n    [(0, $4XALk.PASTE_SPECIAL_MENU_ID)]: {\n        [$f3129b461bb1bc83$export$9426163a6ae5dd94.id]: {\n            order: 4,\n            menuItemFactory: $f3129b461bb1bc83$var$PasteFormulaMenuItemFactory\n        }\n    }\n}, $f3129b461bb1bc83$var$META_KEY_CTRL_AND_SHIFT = \"meta_key_ctrl_And_Shift\", $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST = [\n    (0, $fL2Ug.KeyCode).ARROW_DOWN,\n    (0, $fL2Ug.KeyCode).ARROW_UP,\n    (0, $fL2Ug.KeyCode).ARROW_LEFT,\n    (0, $fL2Ug.KeyCode).ARROW_RIGHT\n], $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_LIST = [\n    ...$f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST,\n    (0, $fL2Ug.KeyCode).ENTER,\n    (0, $fL2Ug.KeyCode).TAB,\n    (0, $fL2Ug.KeyCode).ESC\n];\nfunction $f3129b461bb1bc83$var$promptSelectionShortcutItem() {\n    const shortcutList = [];\n    for (const keycode of $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_LIST)shortcutList.push({\n        id: $f3129b461bb1bc83$export$585b41d8b7a58a05.id,\n        binding: keycode,\n        preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>(0, $4XALk.whenFormulaEditorActivated)(contextService), \"preconditions\"),\n        staticParameters: {\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode\n        }\n    });\n    return shortcutList;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$promptSelectionShortcutItem, \"promptSelectionShortcutItem\");\nfunction $f3129b461bb1bc83$var$promptSelectionShortcutItemShift() {\n    const shortcutList = [];\n    for (const keycode of $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST)shortcutList.push({\n        id: $f3129b461bb1bc83$export$585b41d8b7a58a05.id,\n        binding: keycode | (0, $fL2Ug.MetaKeys).SHIFT,\n        preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>(0, $4XALk.whenFormulaEditorActivated)(contextService), \"preconditions\"),\n        staticParameters: {\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            metaKey: (0, $fL2Ug.MetaKeys).SHIFT\n        }\n    });\n    return shortcutList;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$promptSelectionShortcutItemShift, \"promptSelectionShortcutItemShift\");\nfunction $f3129b461bb1bc83$var$promptSelectionShortcutItemCtrl() {\n    const shortcutList = [];\n    for (const keycode of $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST)shortcutList.push({\n        id: $f3129b461bb1bc83$export$585b41d8b7a58a05.id,\n        binding: keycode | (0, $fL2Ug.MetaKeys).CTRL_COMMAND,\n        preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>(0, $4XALk.whenFormulaEditorActivated)(contextService), \"preconditions\"),\n        staticParameters: {\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            metaKey: (0, $fL2Ug.MetaKeys).CTRL_COMMAND\n        }\n    });\n    return shortcutList;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$promptSelectionShortcutItemCtrl, \"promptSelectionShortcutItemCtrl\");\nfunction $f3129b461bb1bc83$var$promptSelectionShortcutItemCtrlAndShift() {\n    const shortcutList = [];\n    for (const keycode of $f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST)shortcutList.push({\n        id: $f3129b461bb1bc83$export$585b41d8b7a58a05.id,\n        binding: keycode | (0, $fL2Ug.MetaKeys).SHIFT | (0, $fL2Ug.MetaKeys).CTRL_COMMAND,\n        preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>(0, $4XALk.whenFormulaEditorActivated)(contextService), \"preconditions\"),\n        staticParameters: {\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            metaKey: $f3129b461bb1bc83$var$META_KEY_CTRL_AND_SHIFT\n        }\n    });\n    return shortcutList;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$promptSelectionShortcutItemCtrlAndShift, \"promptSelectionShortcutItemCtrlAndShift\");\nconst $f3129b461bb1bc83$var$ChangeRefToAbsoluteShortcut = {\n    id: $f3129b461bb1bc83$export$39056a97b2a0b835.id,\n    binding: (0, $fL2Ug.KeyCode).F4,\n    preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>(0, $4XALk.whenFormulaEditorActivated)(contextService), \"preconditions\")\n};\nfunction $f3129b461bb1bc83$var$singleEditorPromptSelectionShortcutItem() {\n    const shortcutList = [];\n    for (const keycode of [\n        (0, $fL2Ug.KeyCode).ENTER,\n        (0, $fL2Ug.KeyCode).TAB,\n        (0, $fL2Ug.KeyCode).ARROW_DOWN,\n        (0, $fL2Ug.KeyCode).ARROW_UP\n    ])shortcutList.push({\n        id: $f3129b461bb1bc83$export$585b41d8b7a58a05.id,\n        binding: keycode,\n        preconditions: /* @__PURE__ */ $f3129b461bb1bc83$var$__name((contextService)=>$f3129b461bb1bc83$var$whenEditorStandalone(contextService), \"preconditions\"),\n        staticParameters: {\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            isSingleEditor: !0\n        }\n    });\n    return shortcutList;\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$singleEditorPromptSelectionShortcutItem, \"singleEditorPromptSelectionShortcutItem\");\nvar $f3129b461bb1bc83$var$__defProp$2 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$2 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$2 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$2(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$2(target, key, result), result;\n}, \"__decorateClass$2\"), $f3129b461bb1bc83$var$__decorateParam$2 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$2\"), $f3129b461bb1bc83$var$_a8;\nlet $f3129b461bb1bc83$var$FormulaUIController = ($f3129b461bb1bc83$var$_a8 = class extends (0, $7yNYd.Disposable) {\n    constructor(_injector, _menuManagerService, _commandService, _shortcutService, _uiPartsService, _renderManagerService, _componentManager){\n        super(), this._injector = _injector, this._menuManagerService = _menuManagerService, this._commandService = _commandService, this._shortcutService = _shortcutService, this._uiPartsService = _uiPartsService, this._renderManagerService = _renderManagerService, this._componentManager = _componentManager, this._initialize();\n    }\n    _initialize() {\n        this._registerCommands(), this._registerMenus(), this._registerShortcuts(), this._registerComponents(), this._registerRenderModules();\n    }\n    _registerMenus() {\n        this._menuManagerService.mergeMenu($f3129b461bb1bc83$var$menuSchema);\n    }\n    _registerCommands() {\n        [\n            $f3129b461bb1bc83$export$9426163a6ae5dd94,\n            $f3129b461bb1bc83$export$ed0c9b5405071c4d,\n            $f3129b461bb1bc83$export$c1b1be2f114a38f5,\n            $f3129b461bb1bc83$export$2ab1570c3479c5b1,\n            $f3129b461bb1bc83$export$d1f2080022e7b2d1,\n            $f3129b461bb1bc83$export$585b41d8b7a58a05,\n            $f3129b461bb1bc83$export$39056a97b2a0b835\n        ].forEach((command)=>this.disposeWithMe(this._commandService.registerCommand(command)));\n    }\n    _registerShortcuts() {\n        [\n            ...$f3129b461bb1bc83$var$promptSelectionShortcutItem(),\n            ...$f3129b461bb1bc83$var$promptSelectionShortcutItemShift(),\n            ...$f3129b461bb1bc83$var$promptSelectionShortcutItemCtrl(),\n            ...$f3129b461bb1bc83$var$promptSelectionShortcutItemCtrlAndShift(),\n            ...$f3129b461bb1bc83$var$singleEditorPromptSelectionShortcutItem(),\n            $f3129b461bb1bc83$var$ChangeRefToAbsoluteShortcut\n        ].forEach((item)=>{\n            this.disposeWithMe(this._shortcutService.registerShortcut(item));\n        });\n    }\n    _registerComponents() {\n        this.disposeWithMe(this._uiPartsService.registerComponent((0, $fL2Ug.BuiltInUIPart).CONTENT, ()=>(0, $7yNYd.connectInjector)($f3129b461bb1bc83$var$RenderFormulaPromptContent, this._injector))), this.disposeWithMe(this._uiPartsService.registerComponent((0, $4XALk.SheetsUIPart).FORMULA_AUX, ()=>(0, $7yNYd.connectInjector)($f3129b461bb1bc83$var$FormulaProgressBar, this._injector))), this._componentManager.register($f3129b461bb1bc83$var$MORE_FUNCTIONS_COMPONENT, $f3129b461bb1bc83$var$MoreFunctions);\n    }\n    _registerRenderModules() {\n        this.disposeWithMe(this._renderManagerService.registerRenderModule((0, $7yNYd.UniverInstanceType).UNIVER_SHEET, [\n            $f3129b461bb1bc83$var$FormulaEditorShowController\n        ]));\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a8, \"FormulaUIController\"), $f3129b461bb1bc83$var$_a8);\n$f3129b461bb1bc83$var$FormulaUIController = $f3129b461bb1bc83$var$__decorateClass$2([\n    $f3129b461bb1bc83$var$__decorateParam$2(0, (0, $7yNYd.Inject)((0, $7yNYd.Injector))),\n    $f3129b461bb1bc83$var$__decorateParam$2(1, (0, $fL2Ug.IMenuManagerService)),\n    $f3129b461bb1bc83$var$__decorateParam$2(2, (0, $7yNYd.ICommandService)),\n    $f3129b461bb1bc83$var$__decorateParam$2(3, (0, $fL2Ug.IShortcutService)),\n    $f3129b461bb1bc83$var$__decorateParam$2(4, (0, $fL2Ug.IUIPartsService)),\n    $f3129b461bb1bc83$var$__decorateParam$2(5, (0, $3e0Iz.IRenderManagerService)),\n    $f3129b461bb1bc83$var$__decorateParam$2(6, (0, $7yNYd.Inject)((0, $fL2Ug.ComponentManager)))\n], $f3129b461bb1bc83$var$FormulaUIController);\nfunction $f3129b461bb1bc83$var$getFormulaRefSelectionStyle(themeService, refColor, id) {\n    const style = themeService.getCurrentTheme(), fill = new (0, $7yNYd.ColorKit)(refColor).setAlpha(0.05).toRgbString();\n    return {\n        id: id,\n        strokeWidth: 1,\n        stroke: refColor,\n        fill: fill,\n        widgets: {\n            tl: !0,\n            tc: !0,\n            tr: !0,\n            ml: !0,\n            mr: !0,\n            bl: !0,\n            bc: !0,\n            br: !0\n        },\n        widgetSize: 6,\n        widgetStrokeWidth: 1,\n        widgetStroke: style.colorWhite,\n        hasAutoFill: !1,\n        hasRowHeader: !1,\n        hasColumnHeader: !1\n    };\n}\n$f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$getFormulaRefSelectionStyle, \"getFormulaRefSelectionStyle\");\nvar $f3129b461bb1bc83$var$__defProp$1 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc$1 = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__decorateClass$1 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc$1(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp$1(target, key, result), result;\n}, \"__decorateClass$1\"), $f3129b461bb1bc83$var$__decorateParam$1 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam$1\");\nconst $f3129b461bb1bc83$var$sheetEditorUnitIds = [\n    (0, $7yNYd.DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY),\n    (0, $7yNYd.DOCS_NORMAL_EDITOR_UNIT_ID_KEY)\n];\nvar $f3129b461bb1bc83$var$_a9;\nlet $f3129b461bb1bc83$var$PromptController = ($f3129b461bb1bc83$var$_a9 = class extends (0, $7yNYd.Disposable) {\n    constructor(_commandService, _contextService, _editorBridgeService, _formulaPromptService, _lexerTreeBuilder, _renderManagerService, _themeService, _sheetsSelectionsService, _refSelectionsService, _univerInstanceService, _descriptionService, _docSelectionManagerService, _contextMenuService, _editorService, _layoutService){\n        super();\n        $f3129b461bb1bc83$var$__publicField(this, \"_listenInputCache\", /* @__PURE__ */ new Set());\n        $f3129b461bb1bc83$var$__publicField(this, \"_formulaRefColors\", []);\n        $f3129b461bb1bc83$var$__publicField(this, \"_previousSequenceNodes\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_previousRangesCount\", 0);\n        $f3129b461bb1bc83$var$__publicField(this, \"_previousInsertRefStringIndex\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_currentInsertRefStringIndex\", -1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_arrowMoveActionState\", 0);\n        $f3129b461bb1bc83$var$__publicField(this, \"_isSelectionMovingRefSelections\", []);\n        $f3129b461bb1bc83$var$__publicField(this, \"_stringColor\", \"\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_numberColor\", \"\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_insertSelections\", []);\n        $f3129b461bb1bc83$var$__publicField(this, \"_inputPanelState\", 0);\n        $f3129b461bb1bc83$var$__publicField(this, \"_userCursorMove\", !1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_previousEditorUnitId\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_existsSequenceNode\", !1);\n        $f3129b461bb1bc83$var$__publicField(this, \"_currentlyWorkingRefRenderer\", null);\n        $f3129b461bb1bc83$var$__publicField(this, \"_selectionsChangeDisposables\");\n        $f3129b461bb1bc83$var$__publicField(this, \"_isSelectingMode\", !1);\n        this._commandService = _commandService, this._contextService = _contextService, this._editorBridgeService = _editorBridgeService, this._formulaPromptService = _formulaPromptService, this._lexerTreeBuilder = _lexerTreeBuilder, this._renderManagerService = _renderManagerService, this._themeService = _themeService, this._sheetsSelectionsService = _sheetsSelectionsService, this._refSelectionsService = _refSelectionsService, this._univerInstanceService = _univerInstanceService, this._descriptionService = _descriptionService, this._docSelectionManagerService = _docSelectionManagerService, this._contextMenuService = _contextMenuService, this._editorService = _editorService, this._layoutService = _layoutService, this._initialize();\n    }\n    // TODO@wzhudev: selection render service would be a render unit, we we cannot\n    // easily access it here.\n    get _selectionRenderService() {\n        return this._renderManagerService.getRenderById(this._univerInstanceService.getCurrentUnitForType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET).getUnitId()).with($f3129b461bb1bc83$export$c157cedf8ddabc0a);\n    }\n    /**\n   * For multiple sheet instances.\n   */ get _allSelectionRenderServices() {\n        return this._renderManagerService.getAllRenderersOfType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET).map((renderer)=>renderer.with($f3129b461bb1bc83$export$c157cedf8ddabc0a));\n    }\n    dispose() {\n        this._formulaRefColors = [], this._resetTemp();\n    }\n    _resetTemp() {\n        this._previousSequenceNodes = null, this._previousInsertRefStringIndex = null, this._isSelectionMovingRefSelections = [], this._previousRangesCount = 0, this._currentInsertRefStringIndex = -1;\n    }\n    _initialize() {\n        this._initialCursorSync(), this._initAcceptFormula(), this._initialFormulaTheme(), this._initSelectionsEndListener(), this._closeRangePromptWhenEditorInvisible(), this._initialEditorInputChange(), this._commandExecutedListener(), this._cursorStateListener(), this._inputFormulaListener(), this._userMouseListener(), this._initialChangeEditor();\n    }\n    _initialFormulaTheme() {\n        const style = this._themeService.getCurrentTheme();\n        this._formulaRefColors = [\n            style.loopColor1,\n            style.loopColor2,\n            style.loopColor3,\n            style.loopColor4,\n            style.loopColor5,\n            style.loopColor6,\n            style.loopColor7,\n            style.loopColor8,\n            style.loopColor9,\n            style.loopColor10,\n            style.loopColor11,\n            style.loopColor12\n        ], this._numberColor = style.hyacinth700, this._stringColor = style.verdancy800;\n    }\n    _initialCursorSync() {\n        this.disposeWithMe(this._docSelectionManagerService.textSelection$.pipe((0, $lMvMU.filter)((item)=>!(0, $4XALk.isRangeSelector)(item.unitId))).subscribe((params)=>{\n            var _a11;\n            if ((params == null ? void 0 : params.unitId) == null) return;\n            const editor = this._editorService.getEditor(params.unitId);\n            if (!editor || editor.onlyInputContent() || editor.isSheetEditor() && !this._isFormulaEditorActivated() || editor.params.scrollBar) return;\n            const onlyInputRange = editor.onlyInputRange();\n            (_a11 = params == null ? void 0 : params.options) != null && _a11.fromSelection || (this._quitSelectingMode(), this._contextSwitch(), this._checkShouldEnterSelectingMode(onlyInputRange), !this._formulaPromptService.isLockedSelectionChange() && (this._highlightFormula(), !onlyInputRange && this._changeFunctionPanelState()));\n        }));\n    }\n    _initialEditorInputChange() {\n        const arrows = [\n            (0, $fL2Ug.KeyCode).ARROW_DOWN,\n            (0, $fL2Ug.KeyCode).ARROW_UP,\n            (0, $fL2Ug.KeyCode).ARROW_LEFT,\n            (0, $fL2Ug.KeyCode).ARROW_RIGHT,\n            (0, $fL2Ug.KeyCode).CTRL,\n            (0, $fL2Ug.KeyCode).SHIFT\n        ];\n        this._univerInstanceService.getCurrentTypeOfUnit$((0, $7yNYd.UniverInstanceType).UNIVER_DOC).subscribe((documentDataModel)=>{\n            var _a11;\n            const unitId = documentDataModel == null ? void 0 : documentDataModel.getUnitId();\n            if (unitId == null || (0, $4XALk.isRangeSelector)(unitId) || this._listenInputCache.has(unitId) || this._editorService.getEditor(unitId) == null) return;\n            const docSelectionRenderService = (_a11 = this._renderManagerService.getRenderById(unitId)) == null ? void 0 : _a11.with((0, $g6Cit.DocSelectionRenderService));\n            docSelectionRenderService && this.disposeWithMe(docSelectionRenderService.onInputBefore$.subscribe((param)=>{\n                this._previousSequenceNodes = null, this._previousInsertRefStringIndex = null, this._selectionRenderService.setSkipLastEnabled(!0);\n                const event = param == null ? void 0 : param.event;\n                event && (arrows.includes(event.which) ? this._inputPanelState = 2 : (this._arrowMoveActionState !== 1 && (this._arrowMoveActionState = 2), this._inputPanelState = 1), event.which !== (0, $fL2Ug.KeyCode).F4 && (this._userCursorMove = !1));\n            })), this._listenInputCache.add(unitId);\n        });\n    }\n    _closeRangePromptWhenEditorInvisible() {\n        this.disposeWithMe(this._editorBridgeService.afterVisible$.pipe((0, $8WNAB.distinctUntilKeyChanged)(\"visible\")).subscribe((visibleParam)=>{\n            visibleParam.visible || this._closeRangePrompt();\n        })), this.disposeWithMe(this._contextService.subscribeContextValue$((0, $7yNYd.FORMULA_EDITOR_ACTIVATED)).pipe((0, $arCqp.distinctUntilChanged)()).subscribe((activated)=>{\n            activated || this._closeRangePrompt();\n        }));\n    }\n    _initialChangeEditor() {\n        this.disposeWithMe(this._univerInstanceService.getCurrentTypeOfUnit$((0, $7yNYd.UniverInstanceType).UNIVER_DOC).subscribe((documentDataModel)=>{\n            if (documentDataModel == null) return;\n            const editorId = documentDataModel.getUnitId();\n            (0, $4XALk.isRangeSelector)(editorId) || !this._editorService.isEditor(editorId) || this._previousEditorUnitId === editorId || this._editorService.isSheetEditor(editorId) || (this._closeRangePrompt(editorId), this._previousEditorUnitId = editorId);\n        })), this.disposeWithMe(this._editorService.closeRangePrompt$.subscribe(()=>{\n            (!this._editorService.getSpreadsheetFocusState() || !this._formulaPromptService.isLockedSelectionInsert()) && this._closeRangePrompt();\n        }));\n    }\n    _closeRangePrompt(editorId) {\n        this._insertSelections = [], this._refSelectionsService.clear(), editorId && this._editorService.isSheetEditor(editorId) && this._updateEditorModel(`\\r\n`, []), this._contextService.setContextValue((0, $7yNYd.FOCUSING_EDITOR_INPUT_FORMULA), !1), this._contextService.setContextValue((0, $ejawP.DISABLE_NORMAL_SELECTIONS), !1), this._contextService.setContextValue((0, $fL2Ug.UNI_DISABLE_CHANGING_FOCUS_KEY), !1), this._quitSelectingMode(), this._resetTemp(), this._hideFunctionPanel();\n    }\n    _initSelectionsEndListener() {\n        const d = new (0, $7yNYd.DisposableCollection)();\n        this.disposeWithMe(this._refSelectionsService.selectionMoveEnd$.subscribe((selections)=>{\n            if (d.dispose(), selections.length === 0) return;\n            this._allSelectionRenderServices.map((s)=>s.getSelectionControls()).flat().forEach((c)=>{\n                c.disableHelperSelection(), d.add(c.selectionMoving$.subscribe((toRange)=>this._onSelectionControlChange(toRange, c))), d.add(c.selectionScaling$.subscribe((toRange)=>this._onSelectionControlChange(toRange, c))), d.add(c.selectionMoved$.subscribe(()=>this._formulaPromptService.disableLockedSelectionChange())), d.add(c.selectionScaled$.subscribe(()=>this._formulaPromptService.disableLockedSelectionChange()));\n            });\n        }));\n    }\n    /**\n   * For interaction with mouse & keyboard shortcuts on spreadsheet. Not in formula editor.\n   */ _updateSelecting(selectionsWithStyles, performInsertion = !1) {\n        if (selectionsWithStyles.length !== 0 && !(this._editorService.selectionChangingState() && !this._formulaPromptService.isLockedSelectionInsert()) && (this._insertControlSelections(selectionsWithStyles), performInsertion)) {\n            const currentSelection = selectionsWithStyles[selectionsWithStyles.length - 1];\n            this._insertControlSelectionReplace(currentSelection);\n        }\n    }\n    _enableRefSelectionsRenderService() {\n        const d = this._selectionsChangeDisposables = new (0, $7yNYd.DisposableCollection)();\n        this._allSelectionRenderServices.forEach((renderer)=>{\n            d.add(renderer.enableSelectionChanging()), d.add(renderer.selectionMoving$.subscribe((selections)=>{\n                this._updateSelecting(selections.map((s)=>(0, $ejawP.convertSelectionDataToRange)(s)));\n            })), d.add(renderer.selectionMoveStart$.subscribe((selections)=>{\n                const performInsertion = this._checkClearingLastSelection(renderer);\n                this._currentlyWorkingRefRenderer = renderer, this._updateSelecting(selections.map((s)=>(0, $ejawP.convertSelectionDataToRange)(s)), performInsertion);\n            }));\n        });\n    }\n    _checkClearingLastSelection(renderer) {\n        return this._currentlyWorkingRefRenderer && this._currentlyWorkingRefRenderer !== renderer ? (this._currentlyWorkingRefRenderer.clearLastSelection(), !1) : !0;\n    }\n    _disposeSelectionsChangeListeners() {\n        var _a11;\n        (_a11 = this._selectionsChangeDisposables) == null || _a11.dispose(), this._selectionsChangeDisposables = null;\n    }\n    _insertControlSelections(selections) {\n        const currentSelection = selections[selections.length - 1];\n        if (this._resetSequenceNodes(selections.length), (selections.length === this._previousRangesCount || this._previousRangesCount === 0) && this._previousSequenceNodes != null) this._insertControlSelectionReplace(currentSelection);\n        else {\n            let insertNodes = this._formulaPromptService.getSequenceNodes();\n            const char = this._getCurrentChar();\n            insertNodes.length === 0 && this._currentInsertRefStringIndex > 0 && (this._currentInsertRefStringIndex = -1), this._previousInsertRefStringIndex = this._currentInsertRefStringIndex, !(0, $86b1c.matchRefDrawToken)(char) && this._focusIsOnlyRange(selections.length) && (this._formulaPromptService.insertSequenceString(this._currentInsertRefStringIndex, (0, $86b1c.matchToken).COMMA), insertNodes = this._formulaPromptService.getSequenceNodes(), this._previousInsertRefStringIndex += 1), this._previousSequenceNodes = (0, $7yNYd.Tools).deepClone(insertNodes), this._formulaPromptService.setSequenceNodes(insertNodes);\n            const refString = this._generateRefString(currentSelection);\n            this._formulaPromptService.insertSequenceRef(this._previousInsertRefStringIndex, refString), this._selectionRenderService.setSkipLastEnabled(!1);\n        }\n        this._arrowMoveActionState = 2, this._previousRangesCount = selections.length;\n    }\n    _initAcceptFormula() {\n        this.disposeWithMe(this._formulaPromptService.acceptFormulaName$.subscribe((formulaString)=>{\n            const activeRange = this._docSelectionManagerService.getActiveTextRange();\n            if (activeRange == null) {\n                this._hideFunctionPanel();\n                return;\n            }\n            const { startOffset: startOffset } = activeRange, lastSequenceNodes = this._formulaPromptService.getSequenceNodes(), nodeIndex = this._formulaPromptService.getCurrentSequenceNodeIndex(startOffset - 2), node = lastSequenceNodes[nodeIndex];\n            if (node == null || typeof node == \"string\") {\n                this._hideFunctionPanel();\n                return;\n            }\n            const difference = formulaString.length - node.token.length, newNode = {\n                ...node\n            };\n            newNode.token = formulaString, newNode.endIndex += difference, lastSequenceNodes[nodeIndex] = newNode;\n            const isDefinedName = this._descriptionService.hasDefinedNameDescription(formulaString), isFormulaDefinedName = this._descriptionService.isFormulaDefinedName(formulaString), formulaStringCount = formulaString.length + 1, mustAddBracket = !isDefinedName || isFormulaDefinedName;\n            mustAddBracket && lastSequenceNodes.splice(nodeIndex + 1, 0, (0, $86b1c.matchToken).OPEN_BRACKET);\n            for(let i = nodeIndex + 2, len = lastSequenceNodes.length; i < len; i++){\n                const node2 = lastSequenceNodes[i];\n                if (typeof node2 == \"string\") continue;\n                const newNode2 = {\n                    ...node2\n                };\n                newNode2.startIndex += formulaStringCount, newNode2.endIndex += formulaStringCount, lastSequenceNodes[i] = newNode2;\n            }\n            let selectionIndex = newNode.endIndex + 1;\n            mustAddBracket && (selectionIndex += 1), this._syncToEditor(lastSequenceNodes, selectionIndex, void 0, !0, !1);\n        }));\n    }\n    _changeFunctionPanelState() {\n        const activeRange = this._docSelectionManagerService.getActiveTextRange();\n        if (activeRange == null) {\n            this._hideFunctionPanel();\n            return;\n        }\n        const { startOffset: startOffset } = activeRange, currentSequenceNode = this._formulaPromptService.getCurrentSequenceNode(startOffset - 2);\n        if (currentSequenceNode == null) {\n            this._hideFunctionPanel();\n            return;\n        }\n        if (typeof currentSequenceNode != \"string\" && currentSequenceNode.nodeType === (0, $86b1c.sequenceNodeType).FUNCTION && !this._descriptionService.hasDefinedNameDescription(currentSequenceNode.token.trim())) {\n            const token = currentSequenceNode.token.toUpperCase();\n            if (this._inputPanelState === 1) {\n                const searchList = this._descriptionService.getSearchListByNameFirstLetter(token);\n                if (this._hideFunctionPanel(), searchList == null || searchList.length === 0) return;\n                this._commandService.executeCommand($f3129b461bb1bc83$export$2ab1570c3479c5b1.id, {\n                    visible: !0,\n                    searchText: token,\n                    searchList: searchList\n                });\n            } else this._changeHelpFunctionPanelState(token, -1);\n            return;\n        }\n        const config = this._getCurrentBodyDataStreamAndOffset(), functionAndParameter = this._lexerTreeBuilder.getFunctionAndParameter((config == null ? void 0 : config.dataStream) || \"\", startOffset - 1 + ((config == null ? void 0 : config.offset) || 0));\n        if (!functionAndParameter) {\n            this._hideFunctionPanel();\n            return;\n        }\n        const { functionName: functionName, paramIndex: paramIndex } = functionAndParameter;\n        this._changeHelpFunctionPanelState(functionName.toUpperCase(), paramIndex);\n    }\n    _changeHelpFunctionPanelState(token, paramIndex) {\n        const functionInfo = this._descriptionService.getFunctionInfo(token);\n        this._hideFunctionPanel(), functionInfo != null && this._commandService.executeCommand($f3129b461bb1bc83$export$d1f2080022e7b2d1.id, {\n            visible: !0,\n            paramIndex: paramIndex,\n            functionInfo: functionInfo\n        });\n    }\n    _hideFunctionPanel() {\n        this._commandService.executeCommand($f3129b461bb1bc83$export$2ab1570c3479c5b1.id, {\n            visible: !1,\n            searchText: \"\"\n        }), this._commandService.executeCommand($f3129b461bb1bc83$export$d1f2080022e7b2d1.id, {\n            visible: !1,\n            paramIndex: -1\n        });\n    }\n    _checkShouldEnterSelectingMode(isOnlyInputRangeEditor = !1) {\n        if (isOnlyInputRangeEditor) {\n            this._enterSelectingMode();\n            return;\n        }\n        const char = this._getCurrentChar(), dataStream = this._getCurrentDataStream();\n        (dataStream == null ? void 0 : dataStream.substring(0, 1)) === \"=\" && char && (0, $86b1c.matchRefDrawToken)(char) ? this._enterSelectingMode() : this._quitSelectingMode();\n    }\n    /**\n   *\n   * @returns Return the character under the current cursor in the editor.\n   */ _getCurrentChar() {\n        const activeRange = this._docSelectionManagerService.getActiveTextRange();\n        if (activeRange == null) return;\n        const { startOffset: startOffset } = activeRange, config = this._getCurrentBodyDataStreamAndOffset();\n        return config == null || startOffset == null ? void 0 : config.dataStream[startOffset - 1 + config.offset];\n    }\n    _getCurrentDataStream() {\n        const config = this._getCurrentBodyDataStreamAndOffset();\n        return config == null ? void 0 : config.dataStream;\n    }\n    _enterSelectingMode() {\n        this._isSelectingMode || (this._editorBridgeService.enableForceKeepVisible(), this._contextMenuService.disable(), this._formulaPromptService.enableLockedSelectionInsert(), this._selectionRenderService.setRemainLastEnabled(!0), this._enableRefSelectionsRenderService(), this._currentlyWorkingRefRenderer = null, this._arrowMoveActionState !== 1 && (this._arrowMoveActionState = 2), this._isSelectingMode = !0);\n    }\n    /**\n   * Disable the ref string generation mode. In the ref string generation mode,\n   * users can select a certain area using the mouse and arrow keys, and convert the area into a ref string.\n   */ _quitSelectingMode() {\n        this._isSelectingMode && (this._editorBridgeService.disableForceKeepVisible(), this._contextMenuService.enable(), this._formulaPromptService.disableLockedSelectionInsert(), this._currentInsertRefStringIndex = -1, this._disposeSelectionsChangeListeners(), this._arrowMoveActionState === 2 && (this._arrowMoveActionState = 4), this._isSelectingMode = !1);\n    }\n    _getCurrentBodyDataStreamAndOffset() {\n        var _a11, _b;\n        const documentModel = this._univerInstanceService.getCurrentUniverDocInstance();\n        if (!(documentModel != null && documentModel.getBody())) return;\n        const unitId = documentModel.getUnitId(), editor = this._editorService.getEditor(unitId), dataStream = (_b = (_a11 = documentModel.getBody()) == null ? void 0 : _a11.dataStream) != null ? _b : \"\";\n        return !editor || !editor.onlyInputRange() ? {\n            dataStream: dataStream,\n            offset: 0\n        } : {\n            dataStream: (0, $86b1c.compareToken).EQUALS + dataStream,\n            offset: 1\n        };\n    }\n    _getFormulaAndCellEditorBody(unitIds) {\n        return unitIds.map((unitId)=>{\n            const dataModel = this._univerInstanceService.getUniverDocInstance(unitId);\n            return dataModel == null ? void 0 : dataModel.getBody();\n        });\n    }\n    _editorModelUnitIds() {\n        const unitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n        return this._editorService.isEditor(unitId) && !this._editorService.isSheetEditor(unitId) ? [\n            unitId\n        ] : $f3129b461bb1bc83$var$sheetEditorUnitIds;\n    }\n    /**\n   * Detect whether the user's input content is a formula. If it is a formula,\n   * serialize the current input content into a sequenceNode;\n   * otherwise, close the formula panel.\n   * @param currentInputValue The text content entered by the user in the editor.\n   */ _contextSwitch() {\n        const config = this._getCurrentBodyDataStreamAndOffset();\n        if (config && (0, $7yNYd.isFormulaString)(config.dataStream)) {\n            this._contextService.setContextValue((0, $7yNYd.FOCUSING_EDITOR_INPUT_FORMULA), !0), this._contextService.setContextValue((0, $ejawP.DISABLE_NORMAL_SELECTIONS), !0), this._contextService.setContextValue((0, $fL2Ug.UNI_DISABLE_CHANGING_FOCUS_KEY), !0);\n            const lastSequenceNodes = this._lexerTreeBuilder.sequenceNodesBuilder(config.dataStream) || [];\n            this._formulaPromptService.setSequenceNodes(lastSequenceNodes);\n            const activeRange = this._docSelectionManagerService.getActiveTextRange();\n            if (activeRange == null) return;\n            const { startOffset: startOffset } = activeRange;\n            this._currentInsertRefStringIndex = startOffset - 1 + config.offset;\n            return;\n        }\n        this._contextService.setContextValue((0, $7yNYd.FOCUSING_EDITOR_INPUT_FORMULA), !1), this._contextService.setContextValue((0, $ejawP.DISABLE_NORMAL_SELECTIONS), !1), this._contextService.setContextValue((0, $fL2Ug.UNI_DISABLE_CHANGING_FOCUS_KEY), !1), this._formulaPromptService.disableLockedSelectionChange(), this._formulaPromptService.disableLockedSelectionInsert(), this._formulaPromptService.clearSequenceNodes(), this._hideFunctionPanel();\n    }\n    _getContextState() {\n        return this._contextService.getContextValue((0, $7yNYd.FOCUSING_EDITOR_INPUT_FORMULA));\n    }\n    /**\n   * Highlight cell editor and formula bar editor.\n   */ _highlightFormula() {\n        if (this._getContextState() === !1) return;\n        const sequenceNodes = this._formulaPromptService.getSequenceNodes(), unitIds = this._editorModelUnitIds(), bodyList = this._getFormulaAndCellEditorBody(unitIds).filter((b)=>!!b);\n        if (this._refSelectionsService.clear(), sequenceNodes == null || sequenceNodes.length === 0) this._existsSequenceNode = !1, bodyList.forEach((body)=>body.textRuns = []);\n        else {\n            this._existsSequenceNode = !0;\n            const { textRuns: textRuns, refSelections: refSelections } = this._buildTextRuns(sequenceNodes);\n            bodyList.forEach((body)=>body.textRuns = textRuns), this._allSelectionRenderServices.forEach((r2)=>this._refreshSelectionForReference(r2, refSelections));\n        }\n        this._refreshFormulaAndCellEditor(unitIds);\n    }\n    /**\n   * :\n   * #\n   * Generate styles for formula text, highlighting references, text, numbers, and arrays.\n   */ _buildTextRuns(sequenceNodes) {\n        var _a11;\n        const textRuns = [], refSelections = [], themeColorMap = /* @__PURE__ */ new Map();\n        let refColorIndex = 0;\n        const offset = ((_a11 = this._getCurrentBodyDataStreamAndOffset()) == null ? void 0 : _a11.offset) || 0;\n        for(let i = 0, len = sequenceNodes.length; i < len; i++){\n            const node = sequenceNodes[i];\n            if (typeof node == \"string\" || this._descriptionService.hasDefinedNameDescription(node.token.trim())) continue;\n            const { startIndex: startIndex, endIndex: endIndex, nodeType: nodeType, token: token } = node;\n            let themeColor = \"\";\n            if (nodeType === (0, $86b1c.sequenceNodeType).REFERENCE) {\n                if (themeColorMap.has(token)) themeColor = themeColorMap.get(token);\n                else {\n                    const colorIndex = refColorIndex % this._formulaRefColors.length;\n                    themeColor = this._formulaRefColors[colorIndex], themeColorMap.set(token, themeColor), refColorIndex++;\n                }\n                refSelections.push({\n                    refIndex: i,\n                    themeColor: themeColor,\n                    token: token\n                });\n            } else nodeType === (0, $86b1c.sequenceNodeType).NUMBER ? themeColor = this._numberColor : nodeType === (0, $86b1c.sequenceNodeType).STRING ? themeColor = this._stringColor : nodeType === (0, $86b1c.sequenceNodeType).ARRAY && (themeColor = this._stringColor);\n            themeColor && themeColor.length > 0 && textRuns.push({\n                st: startIndex + 1 - offset,\n                ed: endIndex + 2 - offset,\n                ts: {\n                    cl: {\n                        rgb: themeColor\n                    }\n                }\n            });\n        }\n        return {\n            textRuns: textRuns,\n            refSelections: refSelections\n        };\n    }\n    _exceedCurrentRange(range, rowCount, columnCount) {\n        const { startRow: startRow, startColumn: startColumn } = range;\n        return startRow > rowCount - 1 || startColumn > columnCount - 1;\n    }\n    /**\n   * Draw the referenced selection text based on the style and token.\n   * @param refSelections\n   */ _refreshSelectionForReference(refSelectionRenderService, refSelections) {\n        const { unitId: unitId, sheetId: sheetId } = this._editorBridgeService.getEditCellState(), { unitId: selfUnitId, sheetId: selfSheetId } = this._getCurrentUnitIdAndSheetId(), isSelfSheet = sheetId === selfSheetId, worksheet = this._univerInstanceService.getUniverSheetInstance(unitId).getSheetBySheetId(sheetId);\n        let lastRange = null;\n        const selectionWithStyle = [];\n        for(let i = 0, len = refSelections.length; i < len; i++){\n            const refSelection = refSelections[i], { themeColor: themeColor, token: token, refIndex: refIndex } = refSelection, gridRange = (0, $86b1c.deserializeRangeWithSheet)(token), { unitId: refUnitId, sheetName: sheetName, range: rawRange } = gridRange, range = (0, $ejawP.setEndForRange)(rawRange, worksheet.getRowCount(), worksheet.getColumnCount());\n            if (refUnitId != null && refUnitId.length > 0 && unitId !== refUnitId) continue;\n            const refSheetId = this._getSheetIdByName(unitId, sheetName.trim());\n            if (!isSelfSheet && refSheetId !== selfSheetId || isSelfSheet && sheetName.length !== 0 && refSheetId !== sheetId || this._exceedCurrentRange(range, worksheet.getRowCount(), worksheet.getColumnCount())) continue;\n            const lastRangeCopy = this._getPrimary(range, themeColor, refIndex);\n            if (lastRangeCopy) {\n                lastRange = lastRangeCopy;\n                continue;\n            }\n            const primary = (0, $ejawP.getPrimaryForRange)(range, worksheet);\n            !(0, $7yNYd.Rectangle).equals(primary, range) && range.startRow === range.endRow && range.startColumn === range.endColumn && (range.startRow = primary.startRow, range.endRow = primary.endRow, range.startColumn = primary.startColumn, range.endColumn = primary.endColumn), selectionWithStyle.push({\n                range: range,\n                primary: primary,\n                style: $f3129b461bb1bc83$var$getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString())\n            });\n        }\n        lastRange && selectionWithStyle.push(lastRange), selectionWithStyle.length && this._refSelectionsService.addSelections(unitId, sheetId, selectionWithStyle);\n    }\n    _getPrimary(range, themeColor, refIndex) {\n        var _a11;\n        const primary = (_a11 = this._insertSelections.find((selection)=>{\n            const { startRow: startRow, startColumn: startColumn, endRow: endRow, endColumn: endColumn } = selection.range;\n            return startRow === range.startRow && startColumn === range.startColumn && endRow === range.endRow && endColumn === range.endColumn || startRow === range.startRow && startColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn;\n        })) == null ? void 0 : _a11.primary;\n        if (primary == null) return;\n        const { isMerged: isMerged, isMergedMainCell: isMergedMainCell, startRow: mergeStartRow, endRow: mergeEndRow, startColumn: mergeStartColumn, endColumn: mergeEndColumn } = primary;\n        return (isMerged || isMergedMainCell) && mergeStartRow === range.startRow && mergeStartColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn && (range.endRow = mergeEndRow, range.endColumn = mergeEndColumn), {\n            range: range,\n            primary: primary,\n            style: $f3129b461bb1bc83$var$getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString())\n        };\n    }\n    _getSheetIdByName(unitId, sheetName) {\n        var _a11;\n        const workbook = this._univerInstanceService.getUniverSheetInstance(unitId);\n        return (_a11 = workbook == null ? void 0 : workbook.getSheetBySheetName((0, $86b1c.normalizeSheetName)(sheetName))) == null ? void 0 : _a11.getSheetId();\n    }\n    _getSheetNameById(unitId, sheetId) {\n        var _a11;\n        const workbook = this._univerInstanceService.getUniverSheetInstance(unitId);\n        return ((_a11 = workbook == null ? void 0 : workbook.getSheetBySheetId(sheetId)) == null ? void 0 : _a11.getName()) || \"\";\n    }\n    _getCurrentUnitIdAndSheetId() {\n        var _a11, _b;\n        const workbook = this._univerInstanceService.getCurrentUnitForType((0, $7yNYd.UniverInstanceType).UNIVER_SHEET), worksheet = workbook.getActiveSheet(), skeleton = (_b = (_a11 = this._renderManagerService.getRenderById(workbook.getUnitId())) == null ? void 0 : _a11.with((0, $4XALk.SheetSkeletonManagerService))) == null ? void 0 : _b.getCurrentSkeleton();\n        return {\n            unitId: workbook.getUnitId(),\n            sheetId: (worksheet == null ? void 0 : worksheet.getSheetId()) || \"\",\n            skeleton: skeleton\n        };\n    }\n    // FIXME@Jocs: this internal implementations should be exposed to callers.\n    // This method should be moved to EditorService.\n    _getEditorOpenedForSheet() {\n        const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId(), editor = this._editorService.getEditor(editorUnitId);\n        return editor ? {\n            openUnitId: editor.getOpenForSheetUnitId(),\n            openSheetId: editor.getOpenForSheetSubUnitId()\n        } : {\n            openUnitId: null,\n            openSheetId: null\n        };\n    }\n    /**\n   * Convert the selection range to a ref string for the formula engine, such as A1:B1\n   * @param currentSelection\n   */ _generateRefString(currentSelection) {\n        let refUnitId = \"\", refSheetName = \"\";\n        const { unitId: unitId, sheetId: sheetId } = currentSelection.range, { openUnitId: openUnitId, openSheetId: openSheetId } = this._getEditorOpenedForSheet();\n        unitId !== openUnitId && unitId && (refUnitId = unitId), sheetId !== openSheetId && unitId && sheetId && (refSheetName = this._getSheetNameById(unitId, sheetId));\n        const { range: range, primary: primary } = currentSelection;\n        let { startRow: startRow, endRow: endRow, startColumn: startColumn, endColumn: endColumn } = range;\n        const { startAbsoluteRefType: startAbsoluteRefType, endAbsoluteRefType: endAbsoluteRefType, rangeType: rangeType } = range;\n        if (primary) {\n            const { isMerged: isMerged, isMergedMainCell: isMergedMainCell, startRow: mergeStartRow, endRow: mergeEndRow, startColumn: mergeStartColumn, endColumn: mergeEndColumn } = primary;\n            (isMerged || isMergedMainCell) && mergeStartRow === startRow && mergeStartColumn === startColumn && mergeEndRow === endRow && mergeEndColumn === endColumn && (startRow = mergeStartRow, startColumn = mergeStartColumn, endRow = mergeStartRow, endColumn = mergeStartColumn);\n        }\n        return (0, $86b1c.serializeRangeToRefString)({\n            sheetName: refSheetName,\n            unitId: refUnitId,\n            range: {\n                startRow: startRow,\n                endRow: endRow,\n                startColumn: startColumn,\n                endColumn: endColumn,\n                rangeType: rangeType,\n                startAbsoluteRefType: startAbsoluteRefType,\n                endAbsoluteRefType: endAbsoluteRefType\n            }\n        });\n    }\n    /**\n   * Update Editor formula text in prompt editor by current selection in spreadsheet.\n   * Restore the sequenceNode generated by the lexer to the text in the editor, and set the cursor position.\n   *\n   * @param sequenceNodes\n   * @param textSelectionOffset\n   */ // eslint-disable-next-line max-lines-per-function\n    _syncToEditor(sequenceNodes, textSelectionOffset, editorUnitId, canUndo = !0, fromSelection = !0) {\n        let dataStream = (0, $86b1c.generateStringWithSequence)(sequenceNodes);\n        const { textRuns: textRuns, refSelections: refSelections } = this._buildTextRuns(sequenceNodes);\n        this._isSelectionMovingRefSelections = refSelections, this._allSelectionRenderServices.forEach((r2)=>this._updateRefSelectionStyle(r2, this._isSelectionMovingRefSelections));\n        const activeRange = this._docSelectionManagerService.getActiveTextRange();\n        if (activeRange == null) return;\n        this._currentInsertRefStringIndex = textSelectionOffset, editorUnitId == null && (editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId()), this._fitEditorSize();\n        const editor = this._editorService.getEditor(editorUnitId);\n        editor != null && editor.isSingleChoice() ? (dataStream = dataStream.split(\",\")[0], this._selectionRenderService.setSingleSelectionEnabled(!0)) : this._selectionRenderService.setSingleSelectionEnabled(!1);\n        let formulaString = dataStream, offset = 1;\n        (!editor || !editor.onlyInputRange()) && (formulaString = `${(0, $86b1c.compareToken).EQUALS}${dataStream}`, offset = 0);\n        const { collapsed: collapsed, style: style } = activeRange;\n        canUndo ? (this._commandService.executeCommand((0, $g6Cit.ReplaceContentCommand).id, {\n            unitId: editorUnitId,\n            body: {\n                dataStream: formulaString,\n                textRuns: textRuns\n            },\n            textRanges: [\n                {\n                    startOffset: textSelectionOffset + 1 - offset,\n                    endOffset: textSelectionOffset + 1 - offset,\n                    collapsed: collapsed,\n                    style: style\n                }\n            ],\n            segmentId: null,\n            options: {\n                fromSelection: fromSelection\n            }\n        }), this._docSelectionManagerService.replaceTextRanges([\n            {\n                startOffset: textSelectionOffset + 1 - offset,\n                endOffset: textSelectionOffset + 1 - offset,\n                style: style\n            }\n        ], !0, {\n            fromSelection: fromSelection\n        })) : (this._updateEditorModel(`${formulaString}\\r\n`, textRuns), this._docSelectionManagerService.replaceTextRanges([\n            {\n                startOffset: textSelectionOffset + 1 - offset,\n                endOffset: textSelectionOffset + 1 - offset,\n                style: style\n            }\n        ], !0, {\n            fromSelection: fromSelection\n        })), this._layoutService.focus();\n    }\n    _fitEditorSize() {\n        const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n        this._editorService.isEditor(editorUnitId) && !this._editorService.isSheetEditor(editorUnitId) || this._commandService.executeCommand((0, $fL2Ug.SetEditorResizeOperation).id, {\n            unitId: editorUnitId\n        });\n    }\n    /**\n   * Update the editor's model value to facilitate formula updates.\n   * @param dataStream\n   * @param textRuns\n   */ _updateEditorModel(dataStream, textRuns) {\n        var _a11;\n        const documentDataModel = this._univerInstanceService.getCurrentUniverDocInstance(), editorUnitId = documentDataModel.getUnitId();\n        if (!this._editorService.isEditor(editorUnitId)) return;\n        const docViewModel = (_a11 = this._renderManagerService.getRenderById(editorUnitId)) == null ? void 0 : _a11.with((0, $7AR1b.DocSkeletonManagerService)).getViewModel();\n        if (docViewModel == null || documentDataModel == null) return;\n        const snapshot = documentDataModel == null ? void 0 : documentDataModel.getSnapshot();\n        if (snapshot == null) return;\n        const newBody = {\n            dataStream: dataStream,\n            textRuns: textRuns\n        };\n        snapshot.body = newBody, docViewModel.reset(documentDataModel);\n    }\n    _insertControlSelectionReplace(currentSelection) {\n        this._previousSequenceNodes == null && (this._previousSequenceNodes = this._formulaPromptService.getSequenceNodes()), this._previousInsertRefStringIndex == null && (this._previousInsertRefStringIndex = this._currentInsertRefStringIndex);\n        const insertNodes = (0, $7yNYd.Tools).deepClone(this._previousSequenceNodes);\n        if (insertNodes == null) return;\n        const refString = this._generateRefString(currentSelection);\n        this._formulaPromptService.setSequenceNodes(insertNodes), this._formulaPromptService.insertSequenceRef(this._previousInsertRefStringIndex, refString), this._syncToEditor(insertNodes, this._previousInsertRefStringIndex + refString.length);\n        const selectionDatas = this._selectionRenderService.getSelectionDataWithStyle();\n        this._insertSelections = [], selectionDatas.forEach((currentSelection2)=>{\n            const range = (0, $ejawP.convertSelectionDataToRange)(currentSelection2);\n            this._insertSelections.push(range);\n        });\n    }\n    /**\n   * pro/issues/450\n   * In range selection mode, certain measures are implemented to ensure that the selection behavior is processed correctly.\n   */ _focusIsOnlyRange(selectionCount) {\n        const currentEditor = this._editorService.getFocusEditor();\n        return !currentEditor || !currentEditor.onlyInputRange() || this._existsSequenceNode || selectionCount > 1 || this._previousSequenceNodes != null && this._previousSequenceNodes.length > 0 ? !0 : (this._previousInsertRefStringIndex != null && (this._previousInsertRefStringIndex += 1), !1);\n    }\n    /**\n   * pro/issues/450\n   * In range selection mode, certain measures are implemented to ensure that the selection behavior is processed correctly.\n   */ _resetSequenceNodes(selectionCount) {\n        const currentEditor = this._editorService.getFocusEditor();\n        currentEditor && currentEditor.onlyInputRange() && (selectionCount > 1 || this._existsSequenceNode && (this._formulaPromptService.clearSequenceNodes(), this._previousRangesCount = 0, this._existsSequenceNode = !1));\n    }\n    // FIXME: @wzhudev: this method could be merged with `_refreshSelectionForReference`.\n    _updateRefSelectionStyle(refSelectionRenderService, refSelections) {\n        const controls = refSelectionRenderService.getSelectionControls(), [unitId, sheetId] = refSelectionRenderService.getLocation(), matchedControls = /* @__PURE__ */ new Set();\n        for(let i = 0, len = refSelections.length; i < len; i++){\n            const refSelection = refSelections[i], { refIndex: refIndex, themeColor: themeColor, token: token } = refSelection, rangeWithSheet = (0, $86b1c.deserializeRangeWithSheet)(token), { unitId: refUnitId, sheetName: sheetName, range: range } = rangeWithSheet;\n            if (!refUnitId && refUnitId.length > 0 && unitId !== refUnitId) continue;\n            const refSheetId = this._getSheetIdByName(unitId, sheetName.trim());\n            if (refSheetId && refSheetId !== sheetId) continue;\n            const control = controls.find((c)=>{\n                const { startRow: startRow, startColumn: startColumn, endRow: endRow, endColumn: endColumn, rangeType: rangeType } = c.getRange();\n                return rangeType === (0, $7yNYd.RANGE_TYPE).COLUMN && startColumn === range.startColumn && endColumn === range.endColumn || rangeType === (0, $7yNYd.RANGE_TYPE).ROW && startRow === range.startRow && endRow === range.endRow || startRow === range.startRow && startColumn === range.startColumn && endRow === range.endRow && endColumn === range.endColumn || startRow === range.startRow && startColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn;\n            });\n            if (control) {\n                const style = $f3129b461bb1bc83$var$getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString());\n                control.updateStyle(style), matchedControls.add(control);\n            }\n        }\n    }\n    _onSelectionControlChange(toRange, selectionControl) {\n        var _a11;\n        const { skeleton: skeleton } = this._getCurrentUnitIdAndSheetId();\n        this._formulaPromptService.enableLockedSelectionChange();\n        const id = (_a11 = selectionControl.currentStyle) == null ? void 0 : _a11.id;\n        if (!id || !(0, $7yNYd.Tools).isStringNumber(id)) return;\n        let { startRow: startRow, endRow: endRow, startColumn: startColumn, endColumn: endColumn } = toRange;\n        const primary = skeleton ? skeleton.worksheet.getCellInfoInMergeData(startRow, startColumn) : {\n            actualRow: startRow,\n            actualColumn: startColumn,\n            isMergedMainCell: !1,\n            isMerged: !1,\n            endRow: startRow,\n            endColumn: startColumn,\n            startRow: startRow,\n            startColumn: startColumn\n        };\n        if (primary) {\n            const { isMerged: isMerged, isMergedMainCell: isMergedMainCell, startRow: mergeStartRow, endRow: mergeEndRow, startColumn: mergeStartColumn, endColumn: mergeEndColumn } = primary;\n            (isMerged || isMergedMainCell) && mergeStartRow === startRow && mergeStartColumn === startColumn && mergeEndRow === endRow && mergeEndColumn === endColumn && (startRow = mergeStartRow, startColumn = mergeStartColumn, endRow = mergeStartRow, endColumn = mergeStartColumn);\n        }\n        const nodeIndex = Number(id), currentNode = this._formulaPromptService.getCurrentSequenceNodeByIndex(nodeIndex);\n        if (!currentNode) return;\n        let refType = {\n            startAbsoluteRefType: (0, $7yNYd.AbsoluteRefType).NONE\n        };\n        if (typeof currentNode != \"string\") {\n            const token = currentNode.token;\n            refType = (0, $86b1c.getAbsoluteRefTypeWitString)(token), refType.endAbsoluteRefType == null && (refType.endAbsoluteRefType = refType.startAbsoluteRefType);\n        }\n        const unitId = skeleton == null ? void 0 : skeleton.worksheet.getUnitId(), sheetId = skeleton == null ? void 0 : skeleton.worksheet.getSheetId(), refString = this._generateRefString({\n            range: {\n                startRow: Math.min(startRow, endRow),\n                endRow: Math.max(startRow, endRow),\n                startColumn: Math.min(startColumn, endColumn),\n                endColumn: Math.max(startColumn, endColumn),\n                ...refType,\n                sheetId: sheetId,\n                unitId: unitId\n            },\n            primary: primary,\n            style: null\n        });\n        this._formulaPromptService.updateSequenceRef(nodeIndex, refString);\n        const sequenceNodes = this._formulaPromptService.getSequenceNodes(), node = sequenceNodes[nodeIndex];\n        typeof node != \"string\" && (this._syncToEditor(sequenceNodes, node.endIndex + 1), selectionControl.update(toRange, void 0, void 0, void 0, this._selectionRenderService.attachPrimaryWithCoord(primary)));\n    }\n    _refreshFormulaAndCellEditor(unitIds) {\n        var _a11;\n        for (const unitId of unitIds){\n            const editorObject = (0, $4XALk.getEditorObject)(unitId, this._renderManagerService), documentComponent = editorObject == null ? void 0 : editorObject.document;\n            documentComponent != null && ((_a11 = documentComponent.getSkeleton()) == null || _a11.calculate(), documentComponent.makeDirty());\n        }\n    }\n    _cursorStateListener() {\n        const editorObject = this._getEditorObject();\n        if (editorObject == null) return;\n        const { mainComponent: documentComponent } = editorObject;\n        documentComponent && this.disposeWithMe(documentComponent.onPointerDown$.subscribeEvent(()=>{\n            this._arrowMoveActionState = 1, this._inputPanelState = 3;\n        }));\n    }\n    _pressEnter(params) {\n        const { keycode: keycode, isSingleEditor: isSingleEditor = !1 } = params;\n        if (this._formulaPromptService.isSearching()) {\n            this._formulaPromptService.accept(!0);\n            return;\n        }\n        isSingleEditor !== !0 && this._editorBridgeService.changeVisible({\n            visible: !1,\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            unitId: \"\"\n        });\n    }\n    _pressTab(params) {\n        const { keycode: keycode, isSingleEditor: isSingleEditor = !1 } = params;\n        if (this._formulaPromptService.isSearching()) {\n            this._formulaPromptService.accept(!0);\n            return;\n        }\n        isSingleEditor !== !0 && this._editorBridgeService.changeVisible({\n            visible: !1,\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            unitId: \"\"\n        });\n    }\n    _pressEsc(params) {\n        const { keycode: keycode } = params, focusEditor = this._editorService.getFocusEditor();\n        (!focusEditor || (focusEditor == null ? void 0 : focusEditor.isSheetEditor()) === !0) && this._editorBridgeService.changeVisible({\n            visible: !1,\n            eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n            keycode: keycode,\n            unitId: \"\"\n        });\n    }\n    _pressArrowKey(params) {\n        const { keycode: keycode, metaKey: metaKey } = params;\n        let direction = (0, $7yNYd.Direction).DOWN;\n        keycode === (0, $fL2Ug.KeyCode).ARROW_DOWN ? direction = (0, $7yNYd.Direction).DOWN : keycode === (0, $fL2Ug.KeyCode).ARROW_UP ? direction = (0, $7yNYd.Direction).UP : keycode === (0, $fL2Ug.KeyCode).ARROW_LEFT ? direction = (0, $7yNYd.Direction).LEFT : keycode === (0, $fL2Ug.KeyCode).ARROW_RIGHT && (direction = (0, $7yNYd.Direction).RIGHT), metaKey === (0, $fL2Ug.MetaKeys).CTRL_COMMAND ? this._commandService.executeCommand((0, $4XALk.MoveSelectionCommand).id, {\n            direction: direction,\n            jumpOver: (0, $4XALk.JumpOver).moveGap\n        }) : metaKey === (0, $fL2Ug.MetaKeys).SHIFT ? this._commandService.executeCommand((0, $4XALk.ExpandSelectionCommand).id, {\n            direction: direction\n        }) : metaKey === $f3129b461bb1bc83$var$META_KEY_CTRL_AND_SHIFT ? this._commandService.executeCommand((0, $4XALk.ExpandSelectionCommand).id, {\n            direction: direction,\n            jumpOver: (0, $4XALk.JumpOver).moveGap\n        }) : this._commandService.executeCommand((0, $4XALk.MoveSelectionCommand).id, {\n            direction: direction\n        });\n    }\n    // eslint-disable-next-line max-lines-per-function\n    _commandExecutedListener() {\n        const updateCommandList = [\n            $f3129b461bb1bc83$export$585b41d8b7a58a05.id\n        ];\n        this.disposeWithMe(this._commandService.onCommandExecuted((command)=>{\n            if (command.id === $f3129b461bb1bc83$export$39056a97b2a0b835.id) this._changeRefString();\n            else if (updateCommandList.includes(command.id)) {\n                const params = command.params, { keycode: keycode, isSingleEditor: isSingleEditor = !1 } = params;\n                if (keycode === (0, $fL2Ug.KeyCode).ENTER) {\n                    this._pressEnter(params);\n                    return;\n                }\n                if (keycode === (0, $fL2Ug.KeyCode).TAB) {\n                    this._pressTab(params);\n                    return;\n                }\n                if (keycode === (0, $fL2Ug.KeyCode).ESC) {\n                    this._pressEsc(params);\n                    return;\n                }\n                if (this._formulaPromptService.isSearching()) {\n                    if (keycode === (0, $fL2Ug.KeyCode).ARROW_DOWN) {\n                        this._formulaPromptService.navigate({\n                            direction: (0, $7yNYd.Direction).DOWN\n                        });\n                        return;\n                    }\n                    if (keycode === (0, $fL2Ug.KeyCode).ARROW_UP) {\n                        this._formulaPromptService.navigate({\n                            direction: (0, $7yNYd.Direction).UP\n                        });\n                        return;\n                    }\n                }\n                if (isSingleEditor === !0) return;\n                if (this._arrowMoveActionState === 1) {\n                    this._moveInEditor(keycode);\n                    return;\n                }\n                if (this._arrowMoveActionState === 4) {\n                    this._editorBridgeService.changeVisible({\n                        visible: !1,\n                        eventType: (0, $3e0Iz.DeviceInputEventType).Keyboard,\n                        keycode: keycode,\n                        unitId: \"\"\n                    });\n                    return;\n                }\n                if (this._arrowMoveActionState === 2 && (this._arrowMoveActionState = 3), this._refSelectionsService.getCurrentSelections().length === 0) {\n                    const selectionData = this._sheetsSelectionsService.getCurrentLastSelection();\n                    if (selectionData != null) {\n                        const selectionDataNew = (0, $7yNYd.Tools).deepClone(selectionData);\n                        this._refSelectionsService.addSelections([\n                            selectionDataNew\n                        ]);\n                    }\n                }\n                this._pressArrowKey(params);\n                const selectionWithStyles = this._refSelectionsService.getCurrentSelections(), currentSelection = selectionWithStyles[selectionWithStyles.length - 1];\n                this._insertControlSelectionReplace(currentSelection), this._highlightFormula();\n            }\n        }));\n    }\n    _moveInEditor(keycode) {\n        if (keycode == null) return;\n        let direction = (0, $7yNYd.Direction).LEFT;\n        keycode === (0, $fL2Ug.KeyCode).ARROW_DOWN ? direction = (0, $7yNYd.Direction).DOWN : keycode === (0, $fL2Ug.KeyCode).ARROW_UP ? direction = (0, $7yNYd.Direction).UP : keycode === (0, $fL2Ug.KeyCode).ARROW_RIGHT && (direction = (0, $7yNYd.Direction).RIGHT), this._commandService.executeCommand((0, $g6Cit.MoveCursorOperation).id, {\n            direction: direction\n        });\n    }\n    _userMouseListener() {\n        const editorObject = this._getEditorObject();\n        if (editorObject == null) return;\n        const { mainComponent: documentComponent } = editorObject;\n        documentComponent && this.disposeWithMe(documentComponent == null ? void 0 : documentComponent.onPointerDown$.subscribeEvent(()=>{\n            this._userCursorMove = !0;\n        }));\n    }\n    _inputFormulaListener() {\n        this.disposeWithMe(this._editorService.inputFormula$.subscribe((param)=>{\n            const { formulaString: formulaString, editorUnitId: editorUnitId } = param;\n            if (formulaString.substring(0, 1) !== (0, $86b1c.compareToken).EQUALS) return;\n            const { unitId: unitId } = this._getCurrentUnitIdAndSheetId();\n            this._editorBridgeService.isVisible().visible === !1 && this._editorBridgeService.changeVisible({\n                visible: !0,\n                eventType: (0, $3e0Iz.DeviceInputEventType).Dblclick,\n                unitId: unitId\n            });\n            const lastSequenceNodes = this._lexerTreeBuilder.sequenceNodesBuilder(formulaString) || [];\n            this._formulaPromptService.setSequenceNodes(lastSequenceNodes), this._syncToEditor(lastSequenceNodes, formulaString.length - 1, editorUnitId, !0, !1);\n        }));\n    }\n    /**\n   * Absolute range, triggered by F4\n   */ _changeRefString() {\n        const activeRange = this._docSelectionManagerService.getActiveTextRange();\n        if (activeRange == null) return;\n        const { startOffset: startOffset } = activeRange, strIndex = startOffset - 2, nodeIndex = this._formulaPromptService.getCurrentSequenceNodeIndex(strIndex), node = this._formulaPromptService.getCurrentSequenceNodeByIndex(nodeIndex);\n        if (node == null || typeof node == \"string\" || node.nodeType !== (0, $86b1c.sequenceNodeType).REFERENCE) return;\n        const tokenArray = node.token.split(\"!\");\n        let token = node.token;\n        tokenArray.length > 1 && (token = tokenArray[tokenArray.length - 1]);\n        let unitIDAndSheetName = \"\";\n        for(let i = 0, len = tokenArray.length; i < len - 1; i++)unitIDAndSheetName += tokenArray[i];\n        let finalToken = token;\n        if (token.indexOf((0, $86b1c.matchToken).COLON) > -1) {\n            if (!this._userCursorMove) finalToken = this._changeRangeRef(token);\n            else {\n                const refStringSplit = token.split((0, $86b1c.matchToken).COLON), prefix = refStringSplit[0], suffix = refStringSplit[1];\n                strIndex - node.startIndex <= prefix.length ? finalToken = this._changeSingleRef(prefix) + (0, $86b1c.matchToken).COLON + suffix : finalToken = prefix + (0, $86b1c.matchToken).COLON + this._changeSingleRef(suffix);\n            }\n        } else finalToken = this._changeSingleRef(token);\n        finalToken = unitIDAndSheetName + finalToken;\n        const difference = finalToken.length - node.token.length;\n        this._formulaPromptService.updateSequenceRef(nodeIndex, finalToken), this._syncToEditor(this._formulaPromptService.getSequenceNodes(), strIndex + difference + 1);\n    }\n    _changeRangeRef(token) {\n        const range = (0, $86b1c.deserializeRangeWithSheet)(token).range;\n        let resultToken = \"\";\n        return range.startAbsoluteRefType === (0, $7yNYd.AbsoluteRefType).NONE || range.startAbsoluteRefType == null ? (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ALL, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ALL) : (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).NONE, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).NONE), resultToken = (0, $86b1c.serializeRange)(range), resultToken;\n    }\n    _changeSingleRef(token) {\n        const range = (0, $86b1c.deserializeRangeWithSheet)(token).range, type = range.startAbsoluteRefType;\n        let resultToken = \"\";\n        return type === (0, $7yNYd.AbsoluteRefType).NONE || type == null ? (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ALL, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ALL) : type === (0, $7yNYd.AbsoluteRefType).ALL ? (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ROW, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).ROW) : type === (0, $7yNYd.AbsoluteRefType).ROW ? (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).COLUMN, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).COLUMN) : (range.startAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).NONE, range.endAbsoluteRefType = (0, $7yNYd.AbsoluteRefType).NONE), resultToken = (0, $86b1c.serializeRange)(range), resultToken;\n    }\n    _getEditorObject() {\n        const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId(), editor = this._editorService.getEditor(editorUnitId);\n        return editor == null ? void 0 : editor.render;\n    }\n    _isFormulaEditorActivated() {\n        return this._editorBridgeService.isVisible().visible === !0 || this._contextService.getContextValue((0, $7yNYd.FORMULA_EDITOR_ACTIVATED));\n    }\n    _isSheetOrFormulaEditor(editor) {\n        return editor.isSheetEditor() || editor.isFormulaEditor();\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a9, \"PromptController\"), $f3129b461bb1bc83$var$_a9);\n$f3129b461bb1bc83$var$PromptController = $f3129b461bb1bc83$var$__decorateClass$1([\n    $f3129b461bb1bc83$var$__decorateParam$1(0, (0, $7yNYd.ICommandService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(1, (0, $7yNYd.IContextService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(2, (0, $7yNYd.Inject)((0, $4XALk.IEditorBridgeService))),\n    $f3129b461bb1bc83$var$__decorateParam$1(3, (0, $7yNYd.Inject)($f3129b461bb1bc83$var$IFormulaPromptService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(4, (0, $7yNYd.Inject)((0, $86b1c.LexerTreeBuilder))),\n    $f3129b461bb1bc83$var$__decorateParam$1(5, (0, $3e0Iz.IRenderManagerService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(6, (0, $7yNYd.Inject)((0, $7yNYd.ThemeService))),\n    $f3129b461bb1bc83$var$__decorateParam$1(7, (0, $7yNYd.Inject)((0, $ejawP.SheetsSelectionsService))),\n    $f3129b461bb1bc83$var$__decorateParam$1(8, (0, $ejawP.IRefSelectionsService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(9, (0, $7yNYd.IUniverInstanceService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(10, (0, $7yNYd.Inject)((0, $bRzks.IDescriptionService))),\n    $f3129b461bb1bc83$var$__decorateParam$1(11, (0, $7yNYd.Inject)((0, $7AR1b.DocSelectionManagerService))),\n    $f3129b461bb1bc83$var$__decorateParam$1(12, (0, $fL2Ug.IContextMenuService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(13, (0, $g6Cit.IEditorService)),\n    $f3129b461bb1bc83$var$__decorateParam$1(14, (0, $fL2Ug.ILayoutService))\n], $f3129b461bb1bc83$var$PromptController);\nvar $f3129b461bb1bc83$var$__defProp2 = Object.defineProperty, $f3129b461bb1bc83$var$__getOwnPropDesc = Object.getOwnPropertyDescriptor, $f3129b461bb1bc83$var$__defNormalProp2 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((obj, key, value)=>key in obj ? $f3129b461bb1bc83$var$__defProp2(obj, key, {\n        enumerable: !0,\n        configurable: !0,\n        writable: !0,\n        value: value\n    }) : obj[key] = value, \"__defNormalProp\"), $f3129b461bb1bc83$var$__decorateClass = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((decorators, target, key, kind)=>{\n    for(var result = kind > 1 ? void 0 : kind ? $f3129b461bb1bc83$var$__getOwnPropDesc(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)(decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n    return kind && result && $f3129b461bb1bc83$var$__defProp2(target, key, result), result;\n}, \"__decorateClass\"), $f3129b461bb1bc83$var$__decorateParam = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((index, decorator)=>(target, key)=>decorator(target, key, index), \"__decorateParam\"), $f3129b461bb1bc83$var$__publicField2 = /* @__PURE__ */ $f3129b461bb1bc83$var$__name((obj, key, value)=>$f3129b461bb1bc83$var$__defNormalProp2(obj, typeof key != \"symbol\" ? key + \"\" : key, value), \"__publicField\"), $f3129b461bb1bc83$var$_a10;\nlet $f3129b461bb1bc83$export$bbd9acb515f542fd = ($f3129b461bb1bc83$var$_a10 = class extends (0, $7yNYd.Plugin) {\n    constructor(_config = $f3129b461bb1bc83$var$defaultPluginBaseConfig, _injector, _renderManagerService, _configService){\n        super(), this._config = _config, this._injector = _injector, this._renderManagerService = _renderManagerService, this._configService = _configService;\n        const { menu: menu, ...rest } = this._config;\n        menu && this._configService.setConfig(\"menu\", menu, {\n            merge: !0\n        }), this._configService.setConfig($f3129b461bb1bc83$var$PLUGIN_CONFIG_KEY_BASE, rest);\n    }\n    onStarting() {\n        const j = this._injector;\n        [\n            [\n                $f3129b461bb1bc83$var$IFormulaPromptService,\n                {\n                    useClass: $f3129b461bb1bc83$var$FormulaPromptService\n                }\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaUIController\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaAutoFillController\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaClipboardController\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaEditorShowController\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaRenderManagerController\n            ],\n            [\n                $f3129b461bb1bc83$var$PromptController\n            ]\n        ].forEach((dependency)=>j.add(dependency));\n    }\n    onReady() {\n        this._injector.get($f3129b461bb1bc83$var$FormulaUIController);\n    }\n    onRendered() {\n        [\n            [\n                $f3129b461bb1bc83$export$c157cedf8ddabc0a\n            ],\n            [\n                $f3129b461bb1bc83$var$FormulaAlertRenderController\n            ]\n        ].forEach((dep)=>{\n            this.disposeWithMe(this._renderManagerService.registerRenderModule((0, $7yNYd.UniverInstanceType).UNIVER_SHEET, dep));\n        }), this._injector.get($f3129b461bb1bc83$var$FormulaClipboardController), this._injector.get($f3129b461bb1bc83$var$FormulaRenderManagerController), this._injector.get((0, $fL2Ug.ComponentManager)).register((0, $4XALk.RANGE_SELECTOR_COMPONENT_KEY), $f3129b461bb1bc83$export$1081d70813d107d1);\n    }\n    onSteady() {\n        this._injector.get($f3129b461bb1bc83$var$FormulaAutoFillController), this._injector.get($f3129b461bb1bc83$var$PromptController);\n    }\n}, $f3129b461bb1bc83$var$__name($f3129b461bb1bc83$var$_a10, \"UniverSheetsFormulaUIPlugin\"), $f3129b461bb1bc83$var$_a10);\n$f3129b461bb1bc83$var$__publicField2($f3129b461bb1bc83$export$bbd9acb515f542fd, \"pluginName\", $f3129b461bb1bc83$var$FORMULA_UI_PLUGIN_NAME);\n$f3129b461bb1bc83$var$__publicField2($f3129b461bb1bc83$export$bbd9acb515f542fd, \"type\", (0, $7yNYd.UniverInstanceType).UNIVER_SHEET);\n$f3129b461bb1bc83$export$bbd9acb515f542fd = $f3129b461bb1bc83$var$__decorateClass([\n    (0, $7yNYd.DependentOn)((0, $86b1c.UniverFormulaEnginePlugin), (0, $bRzks.UniverSheetsFormulaPlugin)),\n    $f3129b461bb1bc83$var$__decorateParam(1, (0, $7yNYd.Inject)((0, $7yNYd.Injector))),\n    $f3129b461bb1bc83$var$__decorateParam(2, (0, $3e0Iz.IRenderManagerService)),\n    $f3129b461bb1bc83$var$__decorateParam(3, (0, $7yNYd.IConfigService))\n], $f3129b461bb1bc83$export$bbd9acb515f542fd);\n\n});\nparcelRegister(\"8WNAB\", function(module, exports) {\n\n$parcel$export(module.exports, \"distinctUntilKeyChanged\", function () { return $683a34e6c5504d12$export$571da16e28367bde; });\n\nvar $arCqp = parcelRequire(\"arCqp\");\nfunction $683a34e6c5504d12$export$571da16e28367bde(key, compare) {\n    return (0, $arCqp.distinctUntilChanged)(function(x, y) {\n        return compare ? compare(x[key], y[key]) : x[key] === y[key];\n    });\n}\n\n});\n\n\n\n//# sourceMappingURL=es.75595260.js.map\n","var __defProp = Object.defineProperty;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value;\nvar __name = (target, value) => __defProp(target, \"name\", { value, configurable: !0 });\nvar __publicField = (obj, key, value) => __defNormalProp(obj, typeof key != \"symbol\" ? key + \"\" : key, value);\nimport { CommandType, ICommandService, createIdentifier, IContextService, IUniverInstanceService, Rectangle, DEFAULT_EMPTY_DOCUMENT_VALUE, isRealNum, CellValueType, getCellValueType, toDisposable, DisposableCollection, RANGE_TYPE, Inject, Injector, ThemeService, useDependency, ColorKit, UniverInstanceType, debounce, LocaleService, createInternalEditorID, generateRandomId, isFormulaString, isFormulaId, FOCUSING_DOC, FOCUSING_UNIVER_EDITOR, FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE, Disposable, isICellData, Tools, Direction, ObjectMatrix, ILogService, RxDisposable, InterceptorEffectEnum, useObservable, useInjector, connectInjector, FORMULA_EDITOR_ACTIVATED, FOCUSING_EDITOR_INPUT_FORMULA, AbsoluteRefType, DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY, DOCS_NORMAL_EDITOR_UNIT_ID_KEY, Plugin, DependentOn, IConfigService } from \"@univerjs/core\";\nimport { SheetPasteCommand, PREDEFINED_HOOK_NAME, BaseSelectionRenderService, getCoordByOffset, checkInHeaderRanges, getAllSelection, attachSelectionWithCoord, getSheetObject, SheetSkeletonManagerService, attachRangeWithCoord, IEditorBridgeService, RANGE_SELECTOR_SYMBOLS, SetCellEditVisibleOperation, CellAlertType, HoverManagerService, CellAlertManagerService, DATA_TYPE, APPLY_TYPE, IAutoFillService, COPY_TYPE, ISheetClipboardService, ISheetSelectionRenderService, SelectionShape, SELECTION_SHAPE_DEPTH, useActiveWorkbook, getCurrentRangeDisable$, PASTE_SPECIAL_MENU_ID, whenFormulaEditorActivated, SheetsUIPart, isRangeSelector, getEditorObject, MoveSelectionCommand, JumpOver, ExpandSelectionCommand, RANGE_SELECTOR_COMPONENT_KEY } from \"@univerjs/sheets-ui\";\nimport { sequenceNodeType, serializeRange, matchToken, LexerTreeBuilder, deserializeRangeWithSheet, serializeRangeWithSheet, ERROR_TYPE_SET, ErrorType, FormulaDataModel, SetFormulaCalculationResultMutation, SetArrayFormulaDataMutation, SetFormulaCalculationStopMutation, FunctionType, matchRefDrawToken, compareToken, normalizeSheetName, serializeRangeToRefString, generateStringWithSequence, getAbsoluteRefTypeWitString, UniverFormulaEnginePlugin } from \"@univerjs/engine-formula\";\nimport { Subject, merge, map, distinctUntilChanged, throttleTime as throttleTime$1, combineLatestWith, switchMap, of, Observable, filter, distinctUntilKeyChanged } from \"rxjs\";\nimport { IEditorService, VIEWPORT_KEY, DocBackScrollRenderController, DocSelectionRenderService, ReplaceContentCommand, MoveCursorOperation } from \"@univerjs/docs-ui\";\nimport { SheetsSelectionsService, getSheetCommandTarget, getCellAtRowCol, SetSelectionsOperation, SelectionMoveType, convertSelectionDataToRange, getNormalSelectionStyle, IRefSelectionsService, setEndForRange, DISABLE_NORMAL_SELECTIONS, SetWorksheetActiveOperation, SetRangeValuesMutation, SetRangeValuesUndoMutationFactory, SetWorksheetRowAutoHeightMutation, INTERCEPTOR_POINT, SheetInterceptorService, WorkbookEditablePermission, WorksheetEditPermission, WorksheetSetCellValuePermission, RangeProtectionPermissionEditPoint, getPrimaryForRange } from \"@univerjs/sheets\";\nimport { InsertFunctionCommand, IDescriptionService, TriggerCalculationController, UniverSheetsFormulaPlugin } from \"@univerjs/sheets-formula\";\nimport { ISidebarService, IShortcutService, IContextMenuService, IZenZoneService, ProgressBar, ILayoutService, MenuItemType, getMenuHiddenObservable, IClipboardInterfaceService, RibbonStartGroup, KeyCode, MetaKeys, BuiltInUIPart, ComponentManager, IMenuManagerService, IUIPartsService, UNI_DISABLE_CHANGING_FOCUS_KEY, SetEditorResizeOperation } from \"@univerjs/ui\";\nimport require$$0, { forwardRef, useRef, createElement, useEffect, useState, useMemo, useLayoutEffect, useCallback } from \"react\";\nimport { Tooltip, Dialog, Button, Input, Popup, Select } from \"@univerjs/design\";\nimport { ScrollTimerType, SHEET_VIEWPORT_KEY, Vector2, IRenderManagerService, ScrollBar, DeviceInputEventType } from \"@univerjs/engine-render\";\nimport { DocSkeletonManagerService, DocSelectionManagerService } from \"@univerjs/docs\";\nimport { throttleTime } from \"rxjs/operators\";\nconst SheetOnlyPasteFormulaCommand = {\n  id: \"sheet.command.paste-formula\",\n  type: CommandType.COMMAND,\n  handler: /* @__PURE__ */ __name(async (accessor) => accessor.get(ICommandService).executeCommand(SheetPasteCommand.id, {\n    value: PREDEFINED_HOOK_NAME.SPECIAL_PASTE_FORMULA\n  }), \"handler\")\n}, SelectEditorFormulaOperation = {\n  id: \"formula-ui.operation.select-editor-formula\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name((accessor, params) => !0, \"handler\")\n};\nvar __defProp$9 = Object.defineProperty, __getOwnPropDesc$9 = Object.getOwnPropertyDescriptor, __decorateClass$9 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$9(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$9(target, key, result), result;\n}, \"__decorateClass$9\"), __decorateParam$9 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$9\");\nconst FORMULA_PROMPT_ACTIVATED = \"FORMULA_PROMPT_ACTIVATED\", IFormulaPromptService = createIdentifier(\"formula-ui.prompt-service\");\nvar _a;\nlet FormulaPromptService = (_a = class {\n  constructor(_contextService) {\n    __publicField(this, \"_search$\", new Subject());\n    __publicField(this, \"_help$\", new Subject());\n    __publicField(this, \"_navigate$\", new Subject());\n    __publicField(this, \"_accept$\", new Subject());\n    __publicField(this, \"_acceptFormulaName$\", new Subject());\n    __publicField(this, \"search$\", this._search$.asObservable());\n    __publicField(this, \"help$\", this._help$.asObservable());\n    __publicField(this, \"navigate$\", this._navigate$.asObservable());\n    __publicField(this, \"accept$\", this._accept$.asObservable());\n    __publicField(this, \"acceptFormulaName$\", this._acceptFormulaName$.asObservable());\n    __publicField(this, \"_searching\", !1);\n    __publicField(this, \"_helping\", !1);\n    __publicField(this, \"_sequenceNodes\", []);\n    __publicField(this, \"_isLockedOnSelectionChangeRefString\", !1);\n    __publicField(this, \"_isLockedOnSelectionInsertRefString\", !1);\n    this._contextService = _contextService;\n  }\n  dispose() {\n    this._search$.complete(), this._help$.complete(), this._navigate$.complete(), this._accept$.complete(), this._acceptFormulaName$.complete(), this._sequenceNodes = [];\n  }\n  search(param) {\n    this._contextService.setContextValue(FORMULA_PROMPT_ACTIVATED, param.visible), this._searching = param.visible, this._search$.next(param);\n  }\n  isSearching() {\n    return this._searching;\n  }\n  help(param) {\n    this._helping = param.visible, this._help$.next(param);\n  }\n  isHelping() {\n    return this._helping;\n  }\n  navigate(param) {\n    this._navigate$.next(param);\n  }\n  accept(param) {\n    this._accept$.next(param);\n  }\n  acceptFormulaName(param) {\n    this._acceptFormulaName$.next(param);\n  }\n  getSequenceNodes() {\n    return [...this._sequenceNodes];\n  }\n  setSequenceNodes(nodes) {\n    this._sequenceNodes = nodes;\n  }\n  clearSequenceNodes() {\n    this._sequenceNodes = [];\n  }\n  getCurrentSequenceNode(strIndex) {\n    return this._sequenceNodes[this.getCurrentSequenceNodeIndex(strIndex)];\n  }\n  getCurrentSequenceNodeByIndex(nodeIndex) {\n    return this._sequenceNodes[nodeIndex];\n  }\n  /**\n   * Query the text coordinates in the sequenceNodes and determine the actual insertion index.\n   * @param strIndex\n   */\n  getCurrentSequenceNodeIndex(strIndex) {\n    let nodeIndex = 0;\n    const firstNode = this._sequenceNodes[0];\n    for (let i = 0, len = this._sequenceNodes.length; i < len; i++) {\n      const node = this._sequenceNodes[i];\n      if (typeof node == \"string\")\n        nodeIndex++;\n      else {\n        const { endIndex } = node;\n        nodeIndex = endIndex;\n      }\n      if (strIndex <= nodeIndex)\n        return typeof firstNode == \"string\" && strIndex !== 0 ? i + 1 : i;\n    }\n    return this._sequenceNodes.length;\n  }\n  /**\n   * Synchronize the reference text based on the changes of the selection.\n   * @param nodeIndex\n   * @param refString\n   */\n  updateSequenceRef(nodeIndex, refString) {\n    const node = this._sequenceNodes[nodeIndex];\n    if (typeof node == \"string\" || node.nodeType !== sequenceNodeType.REFERENCE)\n      return;\n    const difference = refString.length - node.token.length, newNode = { ...node };\n    newNode.token = refString, newNode.endIndex += difference, this._sequenceNodes[nodeIndex] = newNode;\n    for (let i = nodeIndex + 1, len = this._sequenceNodes.length; i < len; i++) {\n      const node2 = this._sequenceNodes[i];\n      if (typeof node2 == \"string\")\n        continue;\n      const newNode2 = { ...node2 };\n      newNode2.startIndex += difference, newNode2.endIndex += difference, this._sequenceNodes[i] = newNode2;\n    }\n  }\n  /**\n   * When the cursor is on the right side of a formula token,\n   * you can add reference text to the formula by drawing a selection.\n   * @param index\n   * @param refString\n   */\n  insertSequenceRef(index, refString) {\n    const refStringCount = refString.length, nodeIndex = this.getCurrentSequenceNodeIndex(index);\n    this._sequenceNodes.splice(nodeIndex, 0, {\n      token: refString,\n      startIndex: index,\n      endIndex: index + refStringCount - 1,\n      nodeType: sequenceNodeType.REFERENCE\n    });\n    for (let i = nodeIndex + 1, len = this._sequenceNodes.length; i < len; i++) {\n      const node = this._sequenceNodes[i];\n      if (typeof node == \"string\")\n        continue;\n      const newNode = { ...node };\n      newNode.startIndex += refStringCount, newNode.endIndex += refStringCount, this._sequenceNodes[i] = newNode;\n    }\n  }\n  /**\n   * Insert a string at the cursor position in the text corresponding to the sequenceNodes.\n   * @param index\n   * @param content\n   */\n  insertSequenceString(index, content) {\n    const nodeIndex = this.getCurrentSequenceNodeIndex(index), str = content.split(\"\");\n    this._sequenceNodes.splice(nodeIndex, 0, ...str);\n    const contentCount = str.length;\n    for (let i = nodeIndex + contentCount, len = this._sequenceNodes.length; i < len; i++) {\n      const node = this._sequenceNodes[i];\n      if (typeof node == \"string\")\n        continue;\n      const newNode = { ...node };\n      newNode.startIndex += contentCount, newNode.endIndex += contentCount, this._sequenceNodes[i] = newNode;\n    }\n  }\n  enableLockedSelectionChange() {\n    this._isLockedOnSelectionChangeRefString = !0;\n  }\n  disableLockedSelectionChange() {\n    this._isLockedOnSelectionChangeRefString = !1;\n  }\n  isLockedSelectionChange() {\n    return this._isLockedOnSelectionChangeRefString;\n  }\n  enableLockedSelectionInsert() {\n    this._isLockedOnSelectionInsertRefString = !0;\n  }\n  disableLockedSelectionInsert() {\n    this._isLockedOnSelectionInsertRefString = !1;\n  }\n  isLockedSelectionInsert() {\n    return this._isLockedOnSelectionInsertRefString;\n  }\n}, __name(_a, \"FormulaPromptService\"), _a);\nFormulaPromptService = __decorateClass$9([\n  __decorateParam$9(0, IContextService)\n], FormulaPromptService);\nconst HelpFunctionOperation = {\n  id: \"formula-ui.operation.help-function\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name(async (accessor, params) => (accessor.get(IFormulaPromptService).help(params), !0), \"handler\")\n}, InsertFunctionOperation = {\n  id: \"formula-ui.operation.insert-function\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name(async (accessor, params) => {\n    var _a11, _b;\n    const selectionManagerService = accessor.get(SheetsSelectionsService), editorService = accessor.get(IEditorService), currentSelections = selectionManagerService.getCurrentSelections();\n    if (!currentSelections || !currentSelections.length)\n      return !1;\n    const target = getSheetCommandTarget(accessor.get(IUniverInstanceService));\n    if (!target) return !1;\n    const { worksheet, unitId, subUnitId } = target, cellMatrix = worksheet.getCellMatrix(), { value } = params, commandService = accessor.get(ICommandService), list = [];\n    let editRange = null, editRow = 0, editColumn = 0, editFormulaRangeString = \"\";\n    if (currentSelections.length === 1 && (isSingleCell(currentSelections[0].range) || isMultiRowsColumnsRange(currentSelections[0].range))) {\n      const { range, primary } = currentSelections[0], row = (_a11 = primary == null ? void 0 : primary.actualRow) != null ? _a11 : range.startRow, column = (_b = primary == null ? void 0 : primary.actualColumn) != null ? _b : range.startColumn;\n      editRange = range, editRow = row, editColumn = column;\n      const refRange = findRefRange(cellMatrix, row, column);\n      refRange && (editFormulaRangeString = serializeRange(refRange));\n    } else\n      currentSelections.some((selection) => {\n        var _a12, _b2;\n        const { range, primary } = selection, row = (_a12 = primary == null ? void 0 : primary.actualRow) != null ? _a12 : range.startRow, column = (_b2 = primary == null ? void 0 : primary.actualColumn) != null ? _b2 : range.startColumn, refRange = findRefRange(cellMatrix, row, column);\n        if (!refRange)\n          return editRange = range, editRow = row, editColumn = column, !0;\n        const rangeString = serializeRange(refRange), formulaString = `=${value}(${rangeString})`;\n        return list.push({\n          range,\n          primary: {\n            row,\n            column\n          },\n          formula: formulaString\n        }), !1;\n      });\n    if (editRange) {\n      const destRange = getCellAtRowCol(editRow, editColumn, worksheet), resultRange = {\n        range: Rectangle.clone(editRange),\n        primary: {\n          startRow: destRange.startRow,\n          startColumn: destRange.startColumn,\n          endRow: destRange.endRow,\n          endColumn: destRange.endColumn,\n          actualRow: editRow,\n          actualColumn: editColumn,\n          isMerged: destRange.isMerged,\n          isMergedMainCell: destRange.startRow === editRow && destRange.startColumn === editColumn\n        }\n      }, setSelectionParams = {\n        unitId,\n        subUnitId,\n        selections: [resultRange]\n      };\n      await commandService.executeCommand(SetSelectionsOperation.id, setSelectionParams), setTimeout(() => {\n        editorService.setFormula(`=${value}(${editFormulaRangeString}`);\n      }, 0);\n    }\n    return list.length === 0 ? !1 : commandService.executeCommand(InsertFunctionCommand.id, {\n      list\n    });\n  }, \"handler\")\n};\nfunction findRefRange(cellMatrix, row, column) {\n  const startRow = findStartRow(cellMatrix, row, column);\n  if (startRow !== row)\n    return {\n      startRow,\n      endRow: row - 1,\n      startColumn: column,\n      endColumn: column\n    };\n  const startColumn = findStartColumn(cellMatrix, row, column);\n  return startColumn !== column ? {\n    startRow: row,\n    endRow: row,\n    startColumn,\n    endColumn: column - 1\n  } : null;\n}\n__name(findRefRange, \"findRefRange\");\nfunction findStartRow(cellMatrix, row, column) {\n  let isFirstNumber = !1;\n  if (row === 0) return row;\n  for (let r2 = row - 1; r2 >= 0; r2--) {\n    const cell = cellMatrix.getValue(r2, column);\n    if (isNumberCell(cell) && !isFirstNumber) {\n      if (r2 === 0) return 0;\n      isFirstNumber = !0;\n    } else {\n      if (isFirstNumber && !isNumberCell(cell))\n        return r2 + 1;\n      if (isFirstNumber && r2 === 0)\n        return 0;\n    }\n  }\n  return row;\n}\n__name(findStartRow, \"findStartRow\");\nfunction findStartColumn(cellMatrix, row, column) {\n  let isFirstNumber = !1;\n  if (column === 0) return column;\n  for (let c = column - 1; c >= 0; c--) {\n    const cell = cellMatrix.getValue(row, c);\n    if (isNumberCell(cell) && !isFirstNumber) {\n      if (c === 0) return 0;\n      isFirstNumber = !0;\n    } else {\n      if (isFirstNumber && !isNumberCell(cell))\n        return c + 1;\n      if (isFirstNumber && c === 0)\n        return 0;\n    }\n  }\n  return column;\n}\n__name(findStartColumn, \"findStartColumn\");\nfunction isNumberCell(cell) {\n  if (cell != null && cell.p) {\n    const body = cell == null ? void 0 : cell.p.body;\n    if (body == null)\n      return !1;\n    const data = body.dataStream, newDataStream = data.substring(data.length - 2, data.length) === DEFAULT_EMPTY_DOCUMENT_VALUE ? data.substring(0, data.length - 2) : data;\n    return isRealNum(newDataStream);\n  }\n  return cell && (cell.t === CellValueType.NUMBER || getCellValueType(cell) === CellValueType.NUMBER);\n}\n__name(isNumberCell, \"isNumberCell\");\nfunction isSingleCell(range) {\n  return range.startRow === range.endRow && range.startColumn === range.endColumn;\n}\n__name(isSingleCell, \"isSingleCell\");\nfunction isMultiRowsColumnsRange(range) {\n  return range.startRow !== range.endRow && range.startColumn !== range.endColumn;\n}\n__name(isMultiRowsColumnsRange, \"isMultiRowsColumnsRange\");\nconst FORMULA_UI_PLUGIN_NAME = \"SHEET_FORMULA_UI_PLUGIN\", MORE_FUNCTIONS_COMPONENT = `${FORMULA_UI_PLUGIN_NAME}_MORE_FUNCTIONS_COMPONENT`, MoreFunctionsOperation = {\n  id: \"formula-ui.operation.more-functions\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name(async (accessor) => (accessor.get(ISidebarService).open({\n    header: { title: \"formula.insert.tooltip\" },\n    children: { label: MORE_FUNCTIONS_COMPONENT }\n  }), !0), \"handler\")\n}, ReferenceAbsoluteOperation = {\n  id: \"formula-ui.operation.change-ref-to-absolute\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name(async (accessor) => !0, \"handler\")\n}, SearchFunctionOperation = {\n  id: \"formula-ui.operation.search-function\",\n  type: CommandType.OPERATION,\n  handler: /* @__PURE__ */ __name(async (accessor, params) => (accessor.get(IFormulaPromptService).search(params), !0), \"handler\")\n};\nvar jsxRuntime = { exports: {} }, reactJsxRuntime_production_min = {};\n/**\n * @license React\n * react-jsx-runtime.production.min.js\n *\n * Copyright (c) Facebook, Inc. and its affiliates.\n *\n * This source code is licensed under the MIT license found in the\n * LICENSE file in the root directory of this source tree.\n */\nvar f = require$$0, k = Symbol.for(\"react.element\"), l = Symbol.for(\"react.fragment\"), m = Object.prototype.hasOwnProperty, n = f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner, p = { key: !0, ref: !0, __self: !0, __source: !0 };\nfunction q(c, a, g) {\n  var b, d = {}, e = null, h = null;\n  g !== void 0 && (e = \"\" + g), a.key !== void 0 && (e = \"\" + a.key), a.ref !== void 0 && (h = a.ref);\n  for (b in a) m.call(a, b) && !p.hasOwnProperty(b) && (d[b] = a[b]);\n  if (c && c.defaultProps) for (b in a = c.defaultProps, a) d[b] === void 0 && (d[b] = a[b]);\n  return { $$typeof: k, type: c, key: e, ref: h, props: d, _owner: n.current };\n}\n__name(q, \"q\");\nreactJsxRuntime_production_min.Fragment = l;\nreactJsxRuntime_production_min.jsx = q;\nreactJsxRuntime_production_min.jsxs = q;\njsxRuntime.exports = reactJsxRuntime_production_min;\nvar jsxRuntimeExports = jsxRuntime.exports, __assign = function() {\n  return __assign = Object.assign || function(t) {\n    for (var s, i = 1, n2 = arguments.length; i < n2; i++) {\n      s = arguments[i];\n      for (var p2 in s) Object.prototype.hasOwnProperty.call(s, p2) && (t[p2] = s[p2]);\n    }\n    return t;\n  }, __assign.apply(this, arguments);\n}, __rest = function(s, e) {\n  var t = {};\n  for (var p2 in s) Object.prototype.hasOwnProperty.call(s, p2) && e.indexOf(p2) < 0 && (t[p2] = s[p2]);\n  if (s != null && typeof Object.getOwnPropertySymbols == \"function\")\n    for (var i = 0, p2 = Object.getOwnPropertySymbols(s); i < p2.length; i++)\n      e.indexOf(p2[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p2[i]) && (t[p2[i]] = s[p2[i]]);\n  return t;\n}, IconBase = forwardRef(function(props, ref) {\n  var icon = props.icon, id = props.id, className = props.className, extend = props.extend, restProps = __rest(props, [\"icon\", \"id\", \"className\", \"extend\"]), cls = \"univerjs-icon univerjs-icon-\".concat(id, \" \").concat(className || \"\").trim(), idSuffix = useRef(\"_\".concat(generateShortUuid()));\n  return render(icon, \"\".concat(id), { defIds: icon.defIds, idSuffix: idSuffix.current }, __assign({ ref, className: cls }, restProps), extend);\n});\nfunction render(node, id, runtimeProps, rootProps, extend) {\n  return createElement(node.tag, __assign(__assign({ key: id }, replaceRuntimeIdsAndExtInAttrs(node, runtimeProps, extend)), rootProps), (replaceRuntimeIdsInDefs(node, runtimeProps).children || []).map(function(child, index) {\n    return render(child, \"\".concat(id, \"-\").concat(node.tag, \"-\").concat(index), runtimeProps, void 0, extend);\n  }));\n}\n__name(render, \"render\");\nfunction replaceRuntimeIdsAndExtInAttrs(node, runtimeProps, extend) {\n  var attrs = __assign({}, node.attrs);\n  extend != null && extend.colorChannel1 && attrs.fill === \"colorChannel1\" && (attrs.fill = extend.colorChannel1);\n  var defIds = runtimeProps.defIds;\n  return !defIds || defIds.length === 0 || (node.tag === \"use\" && attrs[\"xlink:href\"] && (attrs[\"xlink:href\"] = attrs[\"xlink:href\"] + runtimeProps.idSuffix), Object.entries(attrs).forEach(function(_a11) {\n    var key = _a11[0], value = _a11[1];\n    typeof value == \"string\" && (attrs[key] = value.replace(/url\\(#(.*)\\)/, \"url(#$1\".concat(runtimeProps.idSuffix, \")\")));\n  })), attrs;\n}\n__name(replaceRuntimeIdsAndExtInAttrs, \"replaceRuntimeIdsAndExtInAttrs\");\nfunction replaceRuntimeIdsInDefs(node, runtimeProps) {\n  var _a11, defIds = runtimeProps.defIds;\n  return !defIds || defIds.length === 0 ? node : node.tag === \"defs\" && (!((_a11 = node.children) === null || _a11 === void 0) && _a11.length) ? __assign(__assign({}, node), { children: node.children.map(function(child) {\n    return typeof child.attrs.id == \"string\" && defIds && defIds.indexOf(child.attrs.id) > -1 ? __assign(__assign({}, child), { attrs: __assign(__assign({}, child.attrs), { id: child.attrs.id + runtimeProps.idSuffix }) }) : child;\n  }) }) : node;\n}\n__name(replaceRuntimeIdsInDefs, \"replaceRuntimeIdsInDefs\");\nfunction generateShortUuid() {\n  return Math.random().toString(36).substring(2, 8);\n}\n__name(generateShortUuid, \"generateShortUuid\");\nIconBase.displayName = \"UniverIcon\";\nvar element$6 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M14.1544 3.75557C14.3887 3.98988 14.3887 4.36978 14.1544 4.6041L6.51409 12.2444C6.40157 12.3569 6.24896 12.4201 6.08983 12.4201C5.9307 12.4201 5.77808 12.3569 5.66556 12.2444L1.84541 8.42425C1.6111 8.18993 1.6111 7.81003 1.84541 7.57572C2.07973 7.34141 2.45963 7.34141 2.69394 7.57572L6.08983 10.9716L13.3059 3.75557C13.5402 3.52126 13.9201 3.52126 14.1544 3.75557Z\", fillRule: \"evenodd\", clipRule: \"evenodd\" } }] }, CheckMarkSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"check-mark-single\",\n    ref,\n    icon: element$6\n  }));\n});\nCheckMarkSingle.displayName = \"CheckMarkSingle\";\nvar element$5 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M3.71274 2.86421C3.47843 2.6299 3.09853 2.6299 2.86421 2.86421C2.6299 3.09853 2.6299 3.47843 2.86421 3.71274L7.15154 8.00007L2.86421 12.2874C2.6299 12.5217 2.6299 12.9016 2.86421 13.1359C3.09853 13.3702 3.47843 13.3702 3.71274 13.1359L8.00007 8.84859L12.2874 13.1359C12.5217 13.3702 12.9016 13.3702 13.1359 13.1359C13.3702 12.9016 13.3702 12.5217 13.1359 12.2874L8.84859 8.00007L13.1359 3.71274C13.3702 3.47843 13.3702 3.09853 13.1359 2.86421C12.9016 2.6299 12.5217 2.6299 12.2874 2.86421L8.00007 7.15154L3.71274 2.86421Z\" } }] }, CloseSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"close-single\",\n    ref,\n    icon: element$5\n  }));\n});\nCloseSingle.displayName = \"CloseSingle\";\nvar element$4 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M5.3313 1.4667C5.3313 1.13533 5.59993.866699 5.9313.866699H10.069C10.4004.866699 10.669 1.13533 10.669 1.4667 10.669 1.79807 10.4004 2.0667 10.069 2.0667H5.9313C5.59993 2.0667 5.3313 1.79807 5.3313 1.4667zM1.09985 3.64443C1.09985 3.31306 1.36848 3.04443 1.69985 3.04443H14.2999C14.6312 3.04443 14.8999 3.31306 14.8999 3.64443 14.8999 3.9758 14.6312 4.24443 14.2999 4.24443H1.69985C1.36848 4.24443 1.09985 3.9758 1.09985 3.64443zM6.12398 8.30171C6.35829 8.0674 6.73819 8.0674 6.97251 8.30171L8.00007 9.32928 9.02764 8.30171C9.26195 8.0674 9.64185 8.0674 9.87617 8.30171 10.1105 8.53603 10.1105 8.91593 9.87617 9.15024L8.8486 10.1778 9.87617 11.2054C10.1105 11.4397 10.1105 11.8196 9.87617 12.0539 9.64185 12.2882 9.26195 12.2882 9.02764 12.0539L8.00007 11.0263 6.97251 12.0539C6.73819 12.2882 6.35829 12.2882 6.12398 12.0539 5.88966 11.8196 5.88966 11.4397 6.12398 11.2054L7.15154 10.1778 6.12398 9.15024C5.88966 8.91593 5.88966 8.53603 6.12398 8.30171z\" } }, { tag: \"path\", attrs: { fill: \"currentColor\", d: \"M4.75332 5.22217C3.86966 5.22217 3.15332 5.93851 3.15332 6.82217V12.5331C3.15332 13.9691 4.31738 15.1332 5.75332 15.1332H10.2465C11.6825 15.1332 12.8465 13.9691 12.8465 12.5331V6.82217C12.8465 5.93851 12.1302 5.22217 11.2465 5.22217H4.75332ZM4.35332 6.82217C4.35332 6.60125 4.53241 6.42217 4.75332 6.42217H11.2465C11.4674 6.42217 11.6465 6.60125 11.6465 6.82217V12.5331C11.6465 13.3063 11.0197 13.9332 10.2465 13.9332H5.75332C4.98012 13.9332 4.35332 13.3063 4.35332 12.5331V6.82217Z\", fillRule: \"evenodd\", clipRule: \"evenodd\" } }] }, DeleteSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"delete-single\",\n    ref,\n    icon: element$4\n  }));\n});\nDeleteSingle.displayName = \"DeleteSingle\";\nvar element$3 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M8.75 5.32495C8.75 5.73916 8.41421 6.07495 8 6.07495 7.58579 6.07495 7.25 5.73916 7.25 5.32495 7.25 4.91074 7.58579 4.57495 8 4.57495 8.41421 4.57495 8.75 4.91074 8.75 5.32495zM8.5999 7.52505C8.5999 7.19368 8.33127 6.92505 7.9999 6.92505 7.66853 6.92505 7.3999 7.19368 7.3999 7.52505V11.425C7.3999 11.7564 7.66853 12.025 7.9999 12.025 8.33127 12.025 8.5999 11.7564 8.5999 11.425V7.52505z\" } }, { tag: \"path\", attrs: { fill: \"currentColor\", d: \"M0.899902 8.00002C0.899902 4.0788 4.07868 0.900024 7.9999 0.900024C11.9211 0.900024 15.0999 4.0788 15.0999 8.00002C15.0999 11.9212 11.9211 15.1 7.9999 15.1C4.07868 15.1 0.899902 11.9212 0.899902 8.00002ZM7.9999 2.10002C4.74142 2.10002 2.0999 4.74154 2.0999 8.00002C2.0999 11.2585 4.74142 13.9 7.9999 13.9C11.2584 13.9 13.8999 11.2585 13.8999 8.00002C13.8999 4.74154 11.2584 2.10002 7.9999 2.10002Z\", fillRule: \"evenodd\", clipRule: \"evenodd\" } }] }, DetailsSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"details-single\",\n    ref,\n    icon: element$3\n  }));\n});\nDetailsSingle.displayName = \"DetailsSingle\";\nvar element$2 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M8.6 1.99991C8.60001 1.66854 8.33138 1.39991 8.00001 1.3999C7.66864 1.3999 7.40001 1.66853 7.4 1.9999L7.39996 7.3999H1.9999C1.66853 7.3999 1.3999 7.66853 1.3999 7.9999C1.3999 8.33127 1.66853 8.5999 1.9999 8.5999H7.39995L7.3999 13.9999C7.3999 14.3313 7.66853 14.5999 7.9999 14.5999C8.33127 14.5999 8.5999 14.3313 8.5999 13.9999L8.59995 8.5999H13.9999C14.3313 8.5999 14.5999 8.33127 14.5999 7.9999C14.5999 7.66853 14.3313 7.3999 13.9999 7.3999H8.59996L8.6 1.99991Z\" } }] }, IncreaseSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"increase-single\",\n    ref,\n    icon: element$2\n  }));\n});\nIncreaseSingle.displayName = \"IncreaseSingle\";\nvar element$1 = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M5.90913 3.57564C6.14345 3.34132 6.52335 3.34132 6.75766 3.57564L10.7577 7.57564C10.992 7.80995 10.992 8.18985 10.7577 8.42417L6.75766 12.4242C6.52335 12.6585 6.14345 12.6585 5.90913 12.4242C5.67482 12.1899 5.67482 11.81 5.90913 11.5756L9.48487 7.9999L5.90913 4.42417C5.67482 4.18985 5.67482 3.80995 5.90913 3.57564Z\", fillRule: \"evenodd\", clipRule: \"evenodd\" } }] }, MoreSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"more-single\",\n    ref,\n    icon: element$1\n  }));\n});\nMoreSingle.displayName = \"MoreSingle\";\nvar element = { tag: \"svg\", attrs: { fill: \"none\", viewBox: \"0 0 16 16\", width: \"1em\", height: \"1em\" }, children: [{ tag: \"path\", attrs: { fill: \"currentColor\", d: \"M12.6185 12.4423C12.5907 12.2749 12.7773 12.15 12.9343 12.2308L15.4242 13.5126C15.6102 13.6084 15.5544 13.8745 15.3439 13.8955L14.2456 14.184L13.4521 15.1286C13.3495 15.2939 13.085 15.2463 13.0534 15.0568L12.6185 12.4423Z\" } }, { tag: \"path\", attrs: { fill: \"currentColor\", d: \"M1 3.6C1 2.16406 2.16406 1 3.6 1H12.3C13.7359 1 14.9 2.16406 14.9 3.6V5.81156C14.9003 5.81881 14.9004 5.82609 14.9004 5.8334C14.9004 5.84071 14.9003 5.84799 14.9 5.85524V10.045C14.9003 10.0522 14.9004 10.0595 14.9004 10.0668C14.9004 10.3982 14.6318 10.6668 14.3004 10.6668H11.1668C10.8907 10.6668 10.6668 10.8907 10.6668 11.1668V14.3C10.6668 14.6314 10.3982 14.9 10.0668 14.9L10.05 14.8998L3.6 14.9C2.16406 14.9 1 13.7359 1 12.3V3.6ZM13.2 5.2334C13.4761 5.2334 13.7 5.00954 13.7 4.7334V3.6C13.7 2.8268 13.0732 2.2 12.3 2.2H11.1668C10.8907 2.2 10.6668 2.42386 10.6668 2.7V4.7334C10.6668 5.00954 10.8907 5.2334 11.1668 5.2334H13.2ZM10.6668 6.9334C10.6668 6.65726 10.8907 6.4334 11.1668 6.4334H13.2C13.4761 6.4334 13.7 6.65726 13.7 6.9334V8.9668C13.7 9.24294 13.4761 9.4668 13.2 9.4668H11.1668C10.8907 9.4668 10.6668 9.24294 10.6668 8.9668V6.9334ZM8.9668 5.2334C9.24294 5.2334 9.4668 5.00954 9.4668 4.7334V2.7C9.4668 2.42386 9.24294 2.2 8.9668 2.2H6.9334C6.65726 2.2 6.4334 2.42386 6.4334 2.7V4.7334C6.4334 5.00954 6.65726 5.2334 6.9334 5.2334L8.9668 5.2334ZM6.4334 6.9334C6.4334 6.65726 6.65726 6.4334 6.9334 6.4334L8.9668 6.4334C9.24294 6.4334 9.4668 6.65726 9.4668 6.9334V8.9668C9.4668 9.24294 9.24294 9.4668 8.9668 9.4668L6.9334 9.4668C6.65726 9.4668 6.4334 9.24294 6.4334 8.9668V6.9334ZM4.7334 5.2334C5.00954 5.2334 5.2334 5.00954 5.2334 4.7334V2.7C5.2334 2.42386 5.00954 2.2 4.7334 2.2H3.6C2.8268 2.2 2.2 2.8268 2.2 3.6V4.7334C2.2 5.00954 2.42386 5.2334 2.7 5.2334H4.7334ZM2.2 6.9334C2.2 6.65726 2.42386 6.4334 2.7 6.4334H4.7334C5.00954 6.4334 5.2334 6.65725 5.2334 6.9334V8.9668C5.2334 9.24294 5.00954 9.4668 4.7334 9.4668H2.7C2.42386 9.4668 2.2 9.24294 2.2 8.9668V6.9334ZM5.2334 11.1668C5.2334 10.8907 5.00954 10.6668 4.7334 10.6668H2.7C2.42386 10.6668 2.2 10.8907 2.2 11.1668V12.3C2.2 13.0732 2.8268 13.7 3.6 13.7H4.7334C5.00954 13.7 5.2334 13.4761 5.2334 13.2V11.1668ZM9.4668 11.1668C9.4668 10.8907 9.24294 10.6668 8.9668 10.6668H6.9334C6.65726 10.6668 6.4334 10.8907 6.4334 11.1668V13.2C6.4334 13.4761 6.65726 13.7 6.9334 13.7H8.9668C9.24294 13.7 9.4668 13.4761 9.4668 13.2V11.1668Z\", fillRule: \"evenodd\", clipRule: \"evenodd\" } }] }, SelectRangeSingle = forwardRef(function(props, ref) {\n  return createElement(IconBase, Object.assign({}, props, {\n    id: \"select-range-single\",\n    ref,\n    icon: element\n  }));\n});\nSelectRangeSingle.displayName = \"SelectRangeSingle\";\nfunction r(e) {\n  var t, f2, n2 = \"\";\n  if (typeof e == \"string\" || typeof e == \"number\") n2 += e;\n  else if (typeof e == \"object\") if (Array.isArray(e)) {\n    var o = e.length;\n    for (t = 0; t < o; t++) e[t] && (f2 = r(e[t])) && (n2 && (n2 += \" \"), n2 += f2);\n  } else for (f2 in e) e[f2] && (n2 && (n2 += \" \"), n2 += f2);\n  return n2;\n}\n__name(r, \"r\");\nfunction clsx() {\n  for (var e, t, f2 = 0, n2 = \"\", o = arguments.length; f2 < o; f2++) (e = arguments[f2]) && (t = r(e)) && (n2 && (n2 += \" \"), n2 += t);\n  return n2;\n}\n__name(clsx, \"clsx\");\nvar __defProp$8 = Object.defineProperty, __getOwnPropDesc$8 = Object.getOwnPropertyDescriptor, __decorateClass$8 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$8(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$8(target, key, result), result;\n}, \"__decorateClass$8\"), __decorateParam$8 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$8\"), _a2;\nlet RefSelectionsRenderService = (_a2 = class extends BaseSelectionRenderService {\n  constructor(_context, injector, themeService, shortcutService, sheetSkeletonManagerService, _refSelectionsService) {\n    super(\n      injector,\n      themeService,\n      shortcutService,\n      sheetSkeletonManagerService\n    );\n    __publicField(this, \"_workbookSelections\");\n    __publicField(this, \"_eventDisposables\");\n    this._context = _context, this._refSelectionsService = _refSelectionsService, this._workbookSelections = this._refSelectionsService.getWorkbookSelections(this._context.unitId), this._initSelectionChangeListener(), this._initSkeletonChangeListener(), this._initUserActionSyncListener(), this._setSelectionStyle(getDefaultRefSelectionStyle(this._themeService)), this._remainLastEnabled = !0;\n  }\n  getLocation() {\n    return this._skeleton.getLocation();\n  }\n  setRemainLastEnabled(enabled) {\n    this._remainLastEnabled = enabled;\n  }\n  /**\n   * This is set to true when you need to add a new selection.\n   * @param {boolean} enabled\n   * @memberof RefSelectionsRenderService\n   */\n  setSkipLastEnabled(enabled) {\n    this._skipLastEnabled = enabled;\n  }\n  clearLastSelection() {\n    const last = this._selectionControls[this._selectionControls.length - 1];\n    last && (last.dispose(), this._selectionControls.pop());\n  }\n  /**\n   * Call this method and user will be able to select on the canvas to update selections.\n   */\n  enableSelectionChanging() {\n    return this._disableSelectionChanging(), this._eventDisposables = this._initCanvasEventListeners(), toDisposable(() => this._disableSelectionChanging());\n  }\n  _disableSelectionChanging() {\n    var _a11;\n    (_a11 = this._eventDisposables) == null || _a11.dispose(), this._eventDisposables = null;\n  }\n  _initCanvasEventListeners() {\n    const sheetObject = this._getSheetObject(), { spreadsheetRowHeader, spreadsheetColumnHeader, spreadsheet, spreadsheetLeftTopPlaceholder } = sheetObject, { scene } = this._context, listenerDisposables = new DisposableCollection();\n    return listenerDisposables.add(spreadsheet == null ? void 0 : spreadsheet.onPointerDown$.subscribeEvent((evt, state) => {\n      this._onPointerDown(evt, spreadsheet.zIndex + 1, RANGE_TYPE.NORMAL, this._getActiveViewport(evt)), evt.button !== 2 && state.stopPropagation();\n    })), listenerDisposables.add(\n      spreadsheetRowHeader == null ? void 0 : spreadsheetRowHeader.onPointerDown$.subscribeEvent((evt, state) => {\n        const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, { row } = getCoordByOffset(evt.offsetX, evt.offsetY, scene, skeleton);\n        checkInHeaderRanges(this._workbookSelections.getCurrentSelections(), row, RANGE_TYPE.ROW) || (this._onPointerDown(evt, (spreadsheet.zIndex || 1) + 1, RANGE_TYPE.ROW, this._getActiveViewport(evt), ScrollTimerType.Y), evt.button !== 2 && state.stopPropagation());\n      })\n    ), listenerDisposables.add(spreadsheetColumnHeader == null ? void 0 : spreadsheetColumnHeader.onPointerDown$.subscribeEvent((evt, state) => {\n      const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, { column } = getCoordByOffset(evt.offsetX, evt.offsetY, scene, skeleton);\n      checkInHeaderRanges(this._workbookSelections.getCurrentSelections(), column, RANGE_TYPE.COLUMN) || (this._onPointerDown(evt, (spreadsheet.zIndex || 1) + 1, RANGE_TYPE.COLUMN, this._getActiveViewport(evt), ScrollTimerType.X), evt.button !== 2 && state.stopPropagation());\n    })), listenerDisposables.add(spreadsheetLeftTopPlaceholder == null ? void 0 : spreadsheetLeftTopPlaceholder.onPointerDown$.subscribeEvent((evt, state) => {\n      this._reset();\n      const skeleton = this._sheetSkeletonManagerService.getCurrent().skeleton, selectionWithStyle = getAllSelection(skeleton), selectionData = this.attachSelectionWithCoord(selectionWithStyle);\n      this._addSelectionControlBySelectionData(selectionData), this._selectionMoveStart$.next(this.getSelectionDataWithStyle());\n      const dispose = scene.onPointerUp$.subscribeEvent(() => {\n        dispose.unsubscribe(), this._selectionMoveEnd$.next(this.getSelectionDataWithStyle());\n      });\n      evt.button !== 2 && state.stopPropagation();\n    })), listenerDisposables;\n  }\n  /**\n   * Update selectionModel in this._workbookSelections by user action in spreadsheet area.\n   */\n  _initUserActionSyncListener() {\n    this.disposeWithMe(this.selectionMoveStart$.subscribe((selectionDataWithStyle) => {\n      this._updateSelections(selectionDataWithStyle, SelectionMoveType.MOVE_START);\n    })), this.disposeWithMe(this.selectionMoving$.subscribe((selectionDataWithStyle) => {\n      this._updateSelections(selectionDataWithStyle, SelectionMoveType.MOVING);\n    })), this.disposeWithMe(this.selectionMoveEnd$.subscribe((selectionDataWithStyle) => {\n      this._updateSelections(selectionDataWithStyle, SelectionMoveType.MOVE_END);\n    }));\n  }\n  _updateSelections(selectionDataWithStyleList, type) {\n    const sheetId = this._context.unit.getActiveSheet().getSheetId();\n    selectionDataWithStyleList.length !== 0 && this._workbookSelections.setSelections(\n      sheetId,\n      selectionDataWithStyleList.map((selectionDataWithStyle) => convertSelectionDataToRange(selectionDataWithStyle)),\n      type\n    );\n  }\n  _initSelectionChangeListener() {\n    this.disposeWithMe(merge(this._workbookSelections.selectionMoveEnd$, this._workbookSelections.selectionSet$).subscribe((selectionsWithStyles) => {\n      this._reset();\n      for (const selectionWithStyle of selectionsWithStyles) {\n        const selectionData = this.attachSelectionWithCoord(selectionWithStyle);\n        this._addSelectionControlBySelectionData(selectionData);\n      }\n    }));\n  }\n  _initSkeletonChangeListener() {\n    this.disposeWithMe(this._sheetSkeletonManagerService.currentSkeleton$.subscribe((param) => {\n      if (!param)\n        return;\n      const { skeleton } = param, { scene } = this._context, viewportMain = scene.getViewport(SHEET_VIEWPORT_KEY.VIEW_MAIN);\n      this._skeleton && this._skeleton.worksheet.getSheetId() !== skeleton.worksheet.getSheetId() && this._reset(), this._changeRuntime(skeleton, scene, viewportMain);\n      const currentSelections = this._workbookSelections.getCurrentSelections();\n      this._refreshSelectionControl(currentSelections || []);\n    }));\n  }\n  _refreshSelectionControl(selectionsData) {\n    const selections = selectionsData.map((selectionWithStyle) => attachSelectionWithCoord(selectionWithStyle, this._skeleton));\n    this.updateControlForCurrentByRangeData(selections);\n  }\n  _getActiveViewport(evt) {\n    const sheetObject = this._getSheetObject();\n    return sheetObject == null ? void 0 : sheetObject.scene.getActiveViewportByCoord(Vector2.FromArray([evt.offsetX, evt.offsetY]));\n  }\n  _getSheetObject() {\n    return getSheetObject(this._context.unit, this._context);\n  }\n}, __name(_a2, \"RefSelectionsRenderService\"), _a2);\nRefSelectionsRenderService = __decorateClass$8([\n  __decorateParam$8(1, Inject(Injector)),\n  __decorateParam$8(2, Inject(ThemeService)),\n  __decorateParam$8(3, IShortcutService),\n  __decorateParam$8(4, Inject(SheetSkeletonManagerService)),\n  __decorateParam$8(5, IRefSelectionsService)\n], RefSelectionsRenderService);\nfunction getDefaultRefSelectionStyle(themeService) {\n  const style = getNormalSelectionStyle(themeService);\n  return style.hasAutoFill = !1, style.hasRowHeader = !1, style.hasColumnHeader = !1, style.widgets = { tl: !0, tc: !0, tr: !0, ml: !0, mr: !0, bl: !0, bc: !0, br: !0 }, style;\n}\n__name(getDefaultRefSelectionStyle, \"getDefaultRefSelectionStyle\");\nconst useEditorInput = /* @__PURE__ */ __name((unitId, rangeString, editor) => {\n  const render2 = useDependency(IRenderManagerService).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with(RefSelectionsRenderService);\n  useEffect(() => {\n    if (editor && refSelectionsRenderService) {\n      const d = editor.input$.subscribe((e) => {\n        e.content === matchToken.COMMA ? refSelectionsRenderService.setSkipLastEnabled(!0) : refSelectionsRenderService.setSkipLastEnabled(!1);\n      });\n      return () => {\n        d.unsubscribe();\n      };\n    }\n  }, [editor, refSelectionsRenderService]), useEffect(() => {\n    refSelectionsRenderService && (rangeString.endsWith(matchToken.COMMA) || refSelectionsRenderService.setSkipLastEnabled(!1));\n  }, [rangeString, refSelectionsRenderService]);\n}, \"useEditorInput\"), useFormulaToken = /* @__PURE__ */ __name((text) => {\n  const lexerTreeBuilder = useDependency(LexerTreeBuilder), [sequenceNodes, sequenceNodesSet] = useState([]);\n  return useEffect(() => {\n    var _a11;\n    sequenceNodesSet((_a11 = lexerTreeBuilder.sequenceNodesBuilder(text)) != null ? _a11 : []);\n  }, [text]), {\n    sequenceNodes,\n    sequenceNodesSet\n  };\n}, \"useFormulaToken\");\nfunction useSheetHighlight(isNeed, unitId, subUnitId, refSelections) {\n  const univerInstanceService = useDependency(IUniverInstanceService), themeService = useDependency(ThemeService), refSelectionsService = useDependency(IRefSelectionsService), render2 = useDependency(IRenderManagerService).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with(RefSelectionsRenderService), sheetSkeletonManagerService = render2 == null ? void 0 : render2.with(SheetSkeletonManagerService), [ranges, rangesSet] = useState([]);\n  useEffect(() => {\n    const workbook = univerInstanceService.getUnit(unitId), worksheet = workbook == null ? void 0 : workbook.getActiveSheet(), selectionWithStyle = [];\n    if (!workbook || !worksheet || !isNeed) {\n      rangesSet(selectionWithStyle);\n      return;\n    }\n    const currentSheetId = worksheet == null ? void 0 : worksheet.getSheetId(), getSheetIdByName = /* @__PURE__ */ __name((name) => {\n      var _a11;\n      return (_a11 = workbook == null ? void 0 : workbook.getSheetBySheetName(name)) == null ? void 0 : _a11.getSheetId();\n    }, \"getSheetIdByName\");\n    for (let i = 0, len = refSelections.length; i < len; i++) {\n      const refSelection = refSelections[i], { themeColor, token, refIndex } = refSelection, unitRangeName = deserializeRangeWithSheet(token), { unitId: refUnitId, sheetName, range: rawRange } = unitRangeName;\n      if (refUnitId && unitId !== refUnitId)\n        continue;\n      const refSheetId = getSheetIdByName(sheetName);\n      if (refSheetId && refSheetId !== currentSheetId)\n        continue;\n      const range = setEndForRange(rawRange, worksheet.getRowCount(), worksheet.getColumnCount());\n      selectionWithStyle.push({\n        range,\n        primary: void 0,\n        style: getFormulaRefSelectionStyle$1(themeService, themeColor, refIndex.toString())\n      });\n    }\n    rangesSet(selectionWithStyle);\n  }, [unitId, subUnitId, refSelections, isNeed]), useEffect(() => {\n    const skeleton = sheetSkeletonManagerService == null ? void 0 : sheetSkeletonManagerService.getCurrentSkeleton();\n    if (skeleton) {\n      const allControls = (refSelectionsRenderService == null ? void 0 : refSelectionsRenderService.getSelectionControls()) || [];\n      allControls.length === ranges.length ? allControls.forEach((control, index) => {\n        const selection = ranges[index], primaryCell = skeleton.getCellByIndex(selection.range.startRow, selection.range.startColumn);\n        control.updateRange(attachRangeWithCoord(skeleton, selection.range), primaryCell), control.updateStyle(selection.style);\n      }) : refSelectionsService.setSelections(ranges);\n    }\n  }, [ranges, sheetSkeletonManagerService]), useEffect(() => () => {\n    refSelectionsService.setSelections([]);\n  }, []);\n}\n__name(useSheetHighlight, \"useSheetHighlight\");\nfunction useDocHight(editorId, sequenceNodes) {\n  const editorService = useDependency(IEditorService), descriptionService = useDependency(IDescriptionService), colorMap = useColor(), [ranges, rangesSet] = useState([]);\n  return useEffect(() => {\n    const editor = editorService.getEditor(editorId);\n    if (!editor)\n      return;\n    const data = editor.getDocumentData();\n    if (!data || !data.body)\n      return;\n    const cloneBody = { dataStream: \"\", ...data.body };\n    if (sequenceNodes == null || sequenceNodes.length === 0)\n      cloneBody.textRuns = [], cloneBody.dataStream = `\\r\n`, rangesSet([]);\n    else {\n      const { textRuns, refSelections } = buildTextRuns(descriptionService, colorMap, sequenceNodes);\n      cloneBody.textRuns = textRuns;\n      const text = sequenceNodes.reduce((pre, cur) => typeof cur == \"string\" ? `${pre}${cur}` : `${pre}${cur.token}`, \"\");\n      cloneBody.dataStream = `${text}\\r\n`, rangesSet(refSelections);\n    }\n    const selection = editor.getSelectionRanges(), cloneData = { ...data, body: cloneBody };\n    editor.setDocumentData(cloneData, selection);\n  }, [editorId, sequenceNodes, colorMap]), ranges;\n}\n__name(useDocHight, \"useDocHight\");\nfunction useColor() {\n  const style = useDependency(ThemeService).getCurrentTheme();\n  return useMemo(() => {\n    const formulaRefColors = [\n      style.loopColor1,\n      style.loopColor2,\n      style.loopColor3,\n      style.loopColor4,\n      style.loopColor5,\n      style.loopColor6,\n      style.loopColor7,\n      style.loopColor8,\n      style.loopColor9,\n      style.loopColor10,\n      style.loopColor11,\n      style.loopColor12\n    ], numberColor = style.hyacinth700, stringColor = style.verdancy800;\n    return { formulaRefColors, numberColor, stringColor };\n  }, [style]);\n}\n__name(useColor, \"useColor\");\nfunction buildTextRuns(descriptionService, colorMap, sequenceNodes) {\n  const { formulaRefColors, numberColor, stringColor } = colorMap, textRuns = [], refSelections = [], themeColorMap = /* @__PURE__ */ new Map();\n  let refColorIndex = 0;\n  for (let i = 0, len = sequenceNodes.length; i < len; i++) {\n    const node = sequenceNodes[i];\n    if (typeof node == \"string\") {\n      const theLastItem = textRuns[textRuns.length - 1], start = theLastItem ? theLastItem.ed : 0, end = start + node.length;\n      textRuns.push({\n        st: start,\n        ed: end\n      });\n      continue;\n    }\n    if (descriptionService.hasDefinedNameDescription(node.token.trim()))\n      continue;\n    const { startIndex, endIndex, nodeType, token } = node;\n    let themeColor = \"\";\n    if (nodeType === sequenceNodeType.REFERENCE) {\n      if (themeColorMap.has(token))\n        themeColor = themeColorMap.get(token);\n      else {\n        const colorIndex = refColorIndex % formulaRefColors.length;\n        themeColor = formulaRefColors[colorIndex], themeColorMap.set(token, themeColor), refColorIndex++;\n      }\n      refSelections.push({\n        refIndex: i,\n        themeColor,\n        token\n      });\n    } else nodeType === sequenceNodeType.NUMBER ? themeColor = numberColor : (nodeType === sequenceNodeType.STRING || nodeType === sequenceNodeType.ARRAY) && (themeColor = stringColor);\n    themeColor && themeColor.length > 0 && textRuns.push({\n      st: startIndex,\n      ed: endIndex + 1,\n      ts: {\n        cl: {\n          rgb: themeColor\n        }\n      }\n    });\n  }\n  return { textRuns, refSelections };\n}\n__name(buildTextRuns, \"buildTextRuns\");\nfunction getFormulaRefSelectionStyle$1(themeService, refColor, id) {\n  const style = themeService.getCurrentTheme(), fill = new ColorKit(refColor).setAlpha(0.05).toRgbString();\n  return {\n    id,\n    strokeWidth: 1,\n    stroke: refColor,\n    fill,\n    widgets: { tl: !0, tc: !0, tr: !0, ml: !0, mr: !0, bl: !0, bc: !0, br: !0 },\n    widgetSize: 6,\n    widgetStrokeWidth: 1,\n    widgetStroke: style.colorWhite,\n    hasAutoFill: !1,\n    hasRowHeader: !1,\n    hasColumnHeader: !1\n  };\n}\n__name(getFormulaRefSelectionStyle$1, \"getFormulaRefSelectionStyle$1\");\nconst useRefactorEffect = /* @__PURE__ */ __name((isNeed, unitId, isOnlyOneRange) => {\n  const renderManagerService = useDependency(IRenderManagerService), univerInstanceService = useDependency(IUniverInstanceService), contextService = useDependency(IContextService), editorBridgeService = useDependency(IEditorBridgeService), sheetsSelectionsService = useDependency(SheetsSelectionsService), contextMenuService = useDependency(IContextMenuService), render2 = renderManagerService.getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with(RefSelectionsRenderService);\n  useEffect(() => {\n    if (isNeed) {\n      const d1 = refSelectionsRenderService == null ? void 0 : refSelectionsRenderService.enableSelectionChanging();\n      return contextService.setContextValue(DISABLE_NORMAL_SELECTIONS, !0), editorBridgeService.enableForceKeepVisible(), () => {\n        d1 == null || d1.dispose(), contextService.setContextValue(DISABLE_NORMAL_SELECTIONS, !1), editorBridgeService.disableForceKeepVisible();\n      };\n    }\n  }, [isNeed]), useLayoutEffect(() => {\n    if (isNeed) {\n      const workbook = univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_SHEET), sheet = workbook == null ? void 0 : workbook.getActiveSheet(), selections = [...sheetsSelectionsService.getCurrentSelections()];\n      return () => {\n        const workbook2 = univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_SHEET), currentSheet = workbook2 == null ? void 0 : workbook2.getActiveSheet();\n        currentSheet && currentSheet === sheet && sheetsSelectionsService.setSelections(selections);\n      };\n    }\n  }, [isNeed]), useEffect(() => {\n    if (isNeed)\n      return contextMenuService.disable(), () => {\n        contextMenuService.enable();\n      };\n  }, [isNeed]), useEffect(() => {\n    isNeed && (refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1));\n  }, [isNeed]), useEffect(() => {\n    isOnlyOneRange ? refSelectionsRenderService == null || refSelectionsRenderService.setRemainLastEnabled(!1) : refSelectionsRenderService == null || refSelectionsRenderService.setRemainLastEnabled(!0);\n  }, [isOnlyOneRange]);\n}, \"useRefactorEffect\"), useResize = /* @__PURE__ */ __name((editor) => {\n  const resize = /* @__PURE__ */ __name(() => {\n    if (editor) {\n      const { scene, mainComponent } = editor.render, docSkeletonManagerService = editor.render.with(DocSkeletonManagerService), { width, height } = editor.getBoundingClientRect();\n      docSkeletonManagerService.getViewModel().getDataModel().updateDocumentDataPageSize(1 / 0), scene.transformByState({\n        width,\n        height\n      }), mainComponent == null || mainComponent.resize(width, height);\n    }\n  }, \"resize\"), checkScrollBar = useMemo(() => debounce(() => {\n    var _a11;\n    if (!editor)\n      return;\n    const skeleton = editor.render.with(DocSkeletonManagerService).getSkeleton(), { scene, mainComponent } = editor.render, viewportMain = scene.getViewport(VIEWPORT_KEY.VIEW_MAIN), { actualWidth } = skeleton.getActualSize(), { width, height } = editor.getBoundingClientRect();\n    let scrollBar = viewportMain == null ? void 0 : viewportMain.getScrollBar();\n    const contentWidth = Math.max(actualWidth, width), contentHeight = height;\n    scene.transformByState({\n      width: contentWidth,\n      height: contentHeight\n    }), mainComponent == null || mainComponent.resize(contentWidth, contentHeight), actualWidth > width ? scrollBar == null ? viewportMain && new ScrollBar(viewportMain, { barSize: 8, enableVertical: !1 }) : viewportMain == null || viewportMain.resetCanvasSizeAndUpdateScroll() : (scrollBar = null, viewportMain == null || viewportMain.scrollToBarPos({ x: 0, y: 0 }), (_a11 = viewportMain == null ? void 0 : viewportMain.getScrollBar()) == null || _a11.dispose());\n  }, 30), [editor]);\n  return useEffect(() => {\n    if (editor) {\n      const time = setTimeout(() => {\n        resize(), checkScrollBar();\n      }, 500);\n      return () => {\n        clearTimeout(time);\n      };\n    }\n  }, [editor]), useEffect(() => {\n    if (editor) {\n      const d = editor.input$.subscribe(() => {\n        checkScrollBar();\n      });\n      return () => {\n        d.unsubscribe();\n      };\n    }\n  }, [editor]), { resize, checkScrollBar };\n}, \"useResize\"), isComma = /* @__PURE__ */ __name((e) => typeof e == \"string\" ? e === matchToken.COMMA : !1, \"isComma\"), isReference = /* @__PURE__ */ __name((e) => {\n  if (typeof e == \"object\")\n    return e.nodeType === sequenceNodeType.REFERENCE;\n}, \"isReference\"), filterReferenceNode = /* @__PURE__ */ __name((nodes) => nodes.filter((node) => isComma(node) || isReference(node)), \"filterReferenceNode\"), rangePreProcess = /* @__PURE__ */ __name((range) => {\n  if (range.endColumn < range.startColumn) {\n    const end = range.endColumn;\n    range.endColumn = range.startColumn, range.startColumn = end;\n  }\n  if (range.endRow < range.startRow) {\n    const end = range.endRow;\n    range.endRow = range.startRow, range.startRow = end;\n  }\n  return range;\n}, \"rangePreProcess\"), sequenceNodeToText = /* @__PURE__ */ __name((sequenceNode) => sequenceNode.map((item) => typeof item == \"string\" ? item : item.token).join(\"\"), \"sequenceNodeToText\");\nfunction getSheetNameById(univerInstanceService, unitId, sheetId) {\n  var _a11, _b;\n  return ((_b = (_a11 = univerInstanceService.getUnit(unitId)) == null ? void 0 : _a11.getSheetBySheetId(sheetId)) == null ? void 0 : _b.getName()) || \"\";\n}\n__name(getSheetNameById, \"getSheetNameById\");\nconst unitRangesToText = /* @__PURE__ */ __name((ranges, isSupportAcrossSheet = !1) => isSupportAcrossSheet ? ranges.map((item) => item.sheetName !== \"\" ? serializeRangeWithSheet(item.sheetName, item.range) : serializeRange(item.range)) : ranges.map((item) => serializeRange(item.range)), \"unitRangesToText\"), useSheetSelectionChange = /* @__PURE__ */ __name((isNeed, unitId, _subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleRangeChange) => {\n  const renderManagerService = useDependency(IRenderManagerService), univerInstanceService = useDependency(IUniverInstanceService), isScalingRef = useRef(!1), debounceReset = useMemo(() => debounce(() => {\n    isScalingRef.current = !1;\n  }, 300), []), setIsScaling = /* @__PURE__ */ __name(() => {\n    isScalingRef.current = !0, debounceReset();\n  }, \"setIsScaling\"), render2 = renderManagerService.getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with(RefSelectionsRenderService), oldFilterReferenceNodes = useRef([]), filterReferenceNodes = useMemo(() => {\n    const newFilterReferenceNodes = filterReferenceNode(sequenceNodes), old = oldFilterReferenceNodes.current;\n    return newFilterReferenceNodes.length === old.length ? (old.splice(0), old.push(...newFilterReferenceNodes), old) : newFilterReferenceNodes;\n  }, [sequenceNodes]);\n  oldFilterReferenceNodes.current = filterReferenceNodes, useEffect(() => {\n    if (isNeed && refSelectionsRenderService) {\n      let isFirst = !0;\n      const handleSelectionsChange = /* @__PURE__ */ __name((selections) => {\n        var _a11;\n        if (isFirst) {\n          isFirst = !1;\n          return;\n        }\n        const cloneSelectionList = [...selections], workbook = univerInstanceService.getUnit(unitId), currentSheetName = ((_a11 = workbook == null ? void 0 : workbook.getActiveSheet()) == null ? void 0 : _a11.getName()) || \"\", newSequenceNodes = filterReferenceNodes.map((node, index) => {\n          if (typeof node == \"string\") {\n            if (!filterReferenceNodes[index - 1])\n              return null;\n            const nextItem = filterReferenceNodes[index + 1];\n            return isComma(node) && (isComma(nextItem) || index === filterReferenceNodes.length - 1) ? null : node;\n          } else if (node.nodeType === sequenceNodeType.REFERENCE) {\n            const unitRange = deserializeRangeWithSheet(node.token);\n            unitRange.unitId = unitRange.unitId === \"\" ? unitId : unitRange.unitId, unitRange.sheetName = unitRange.sheetName === \"\" ? currentSheetName : unitRange.sheetName;\n            const { unitId: rangeUnitId, sheetName: rangeSubName } = unitRange;\n            if (isOnlyOneRange && (rangeUnitId !== unitId || currentSheetName !== rangeSubName))\n              return null;\n            if (rangeUnitId === unitId && currentSheetName === rangeSubName) {\n              const currentSelection = cloneSelectionList.shift();\n              if (currentSelection && getSheetNameById(univerInstanceService, unitId, currentSelection.rangeWithCoord.sheetId || \"\") === rangeSubName) {\n                const cloneNode = { ...node };\n                return rangePreProcess(currentSelection.rangeWithCoord), isSupportAcrossSheet ? cloneNode.token = serializeRangeWithSheet(currentSheetName, currentSelection.rangeWithCoord) : cloneNode.token = serializeRange(currentSelection.rangeWithCoord), cloneNode;\n              }\n            }\n            return node;\n          }\n          return null;\n        }).filter((e) => !!e), theLast = unitRangesToText(\n          cloneSelectionList.map((e) => {\n            var _a12, _b, _c;\n            return {\n              range: e.rangeWithCoord,\n              unitId: (_a12 = e.rangeWithCoord.unitId) != null ? _a12 : \"\",\n              sheetName: getSheetNameById(univerInstanceService, (_b = e.rangeWithCoord.unitId) != null ? _b : \"\", (_c = e.rangeWithCoord.sheetId) != null ? _c : \"\")\n            };\n          }),\n          isSupportAcrossSheet\n        ).join(matchToken.COMMA), thePre = sequenceNodeToText(newSequenceNodes), result = `${thePre}${thePre && theLast ? matchToken.COMMA : \"\"}${theLast}`, isScaling = isScalingRef.current;\n        handleRangeChange(result, isScaling ? -1 : result.length);\n      }, \"handleSelectionsChange\"), d1 = refSelectionsRenderService.selectionMoveEnd$.subscribe((selections) => {\n        handleSelectionsChange(selections);\n      }), d2 = refSelectionsRenderService.selectionMoving$.pipe(throttleTime(50)).subscribe((selections) => {\n        handleSelectionsChange(selections);\n      });\n      return () => {\n        d1.unsubscribe(), d2.unsubscribe();\n      };\n    }\n  }, [isNeed, filterReferenceNodes, refSelectionsRenderService, isSupportAcrossSheet, isOnlyOneRange]), useEffect(() => {\n    if (isNeed && refSelectionsRenderService) {\n      const disposableCollection = new DisposableCollection(), handleSequenceNodeReplace = /* @__PURE__ */ __name((token, index) => {\n        var _a11;\n        let currentIndex = 0, offset = 0, isFinish = !1;\n        const workbook = univerInstanceService.getUnit(unitId), currentSheetName = ((_a11 = workbook == null ? void 0 : workbook.getActiveSheet()) == null ? void 0 : _a11.getName()) || \"\", newSequenceNodes = filterReferenceNodes.map((node) => {\n          if (typeof node == \"string\")\n            return isFinish || (offset += node.length), node;\n          if (node.nodeType === sequenceNodeType.REFERENCE) {\n            isFinish || (offset += node.token.length);\n            const unitRange = deserializeRangeWithSheet(token);\n            if (unitRange.unitId = unitRange.unitId === \"\" ? unitId : unitRange.unitId, unitRange.sheetName = unitRange.sheetName === \"\" ? currentSheetName : unitRange.sheetName, currentIndex === index) {\n              isFinish = !0;\n              const cloneNode = { ...node, token };\n              return isSupportAcrossSheet ? cloneNode.token = serializeRangeWithSheet(unitRange.sheetName, unitRange.range) : cloneNode.token = serializeRange(unitRange.range), currentIndex++, cloneNode;\n            }\n            return currentIndex++, node;\n          }\n          return node;\n        }), result = sequenceNodeToText(newSequenceNodes);\n        handleRangeChange(result, offset || -1);\n      }, \"handleSequenceNodeReplace\");\n      let time = 0;\n      const dispose = refSelectionsRenderService.selectionMoveEnd$.subscribe(() => {\n        time = setTimeout(() => {\n          refSelectionsRenderService.getSelectionControls().forEach((control, index) => {\n            disposableCollection.add(control.selectionScaling$.subscribe((e) => {\n              const rangeText = serializeRange(e);\n              handleSequenceNodeReplace(rangeText, index), setIsScaling();\n            })), disposableCollection.add(control.selectionMoving$.pipe(map((e) => serializeRange(e)), distinctUntilChanged()).subscribe((rangeText) => {\n              handleSequenceNodeReplace(rangeText, index), setIsScaling();\n            }));\n          });\n        }, 30);\n      });\n      return () => {\n        dispose.unsubscribe(), disposableCollection.dispose(), clearTimeout(time);\n      };\n    }\n  }, [isNeed, refSelectionsRenderService, filterReferenceNodes]);\n}, \"useSheetSelectionChange\"), verifyRange = /* @__PURE__ */ __name((sequenceNodes) => !sequenceNodes.some((item) => {\n  if (typeof item == \"string\") {\n    if (item !== matchToken.COMMA)\n      return !0;\n  } else if (item.nodeType !== sequenceNodeType.REFERENCE)\n    return !0;\n  return !1;\n}), \"verifyRange\"), useVerify = /* @__PURE__ */ __name((onVerify, sequenceNodes) => {\n  const isInitRender = useRef(!0);\n  useEffect(() => {\n    const time = setTimeout(() => {\n      isInitRender.current = !1;\n    }, 500);\n    return () => {\n      clearTimeout(time);\n    };\n  }), useEffect(() => {\n    if (!isInitRender.current && onVerify) {\n      const result = verifyRange(sequenceNodes);\n      onVerify(result, sequenceNodeToText(sequenceNodes));\n    }\n  }, [sequenceNodes, onVerify]);\n}, \"useVerify\"), sheetRangeSelectorTextWrap = \"univer-sheet-range-selector-text-wrap\", sheetRangeSelectorPlaceholder = \"univer-sheet-range-selector-placeholder\", sheetRangeSelectorError = \"univer-sheet-range-selector-error\", sheetRangeSelectorErrorWrap = \"univer-sheet-range-selector-error-wrap\", sheetRangeSelectorText = \"univer-sheet-range-selector-text\", sheetRangeSelectorActive = \"univer-sheet-range-selector-active\", sheetRangeSelectorIcon = \"univer-sheet-range-selector-icon\", sheetRangeSelectorDialogItem = \"univer-sheet-range-selector-dialog-item\", sheetRangeSelectorDialogItemDelete = \"univer-sheet-range-selector-dialog-item-delete\", styles$6 = {\n  sheetRangeSelectorTextWrap,\n  sheetRangeSelectorPlaceholder,\n  sheetRangeSelectorError,\n  sheetRangeSelectorErrorWrap,\n  sheetRangeSelectorText,\n  sheetRangeSelectorActive,\n  sheetRangeSelectorIcon,\n  sheetRangeSelectorDialogItem,\n  sheetRangeSelectorDialogItemDelete\n}, noopFunction = /* @__PURE__ */ __name(() => {\n}, \"noopFunction\");\nfunction RangeSelector(props) {\n  const {\n    initValue,\n    unitId,\n    subUnitId,\n    errorText,\n    placeholder,\n    actions,\n    onChange = noopFunction,\n    onVerify = noopFunction,\n    onRangeSelectorDialogVisibleChange = noopFunction,\n    onBlur = noopFunction,\n    isFocus: _isFocus = !0,\n    isOnlyOneRange = !1,\n    isSupportAcrossSheet = !1\n  } = props, editorService = useDependency(IEditorService), localeService = useDependency(LocaleService), commandService = useDependency(ICommandService), lexerTreeBuilder = useDependency(LexerTreeBuilder), rangeSelectorWrapRef = useRef(null), [rangeDialogVisible, rangeDialogVisibleSet] = useState(!1), [isFocus, isFocusSet] = useState(_isFocus), editorId = useMemo(() => createInternalEditorID(`${RANGE_SELECTOR_SYMBOLS}-${generateRandomId(4)}`), []), [editor, editorSet] = useState(), containerRef = useRef(null), [rangeString, rangeStringSet] = useState(() => typeof initValue == \"string\" ? initValue : unitRangesToText(initValue, isSupportAcrossSheet).join(matchToken.COMMA));\n  actions && (actions.handleOutClick = (e, cb) => {\n    if (rangeSelectorWrapRef.current) {\n      const isContain = rangeSelectorWrapRef.current.contains(e.target);\n      cb(isContain);\n    }\n  });\n  const ranges = useMemo(() => rangeString.split(matchToken.COMMA).filter((e) => !!e).map((text) => deserializeRangeWithSheet(text)), [rangeString]), isError = useMemo(() => errorText !== void 0, [errorText]), handleInputDebounce = useMemo(() => debounce((text) => {\n    const nodes = lexerTreeBuilder.sequenceNodesBuilder(text);\n    if (nodes) {\n      if (verifyRange(nodes)) {\n        const preNodes = nodes.map((node) => {\n          if (typeof node == \"string\")\n            return node;\n          if (node.nodeType === sequenceNodeType.REFERENCE) {\n            const unitRange = deserializeRangeWithSheet(node.token);\n            unitRange.range = rangePreProcess(unitRange.range), isSupportAcrossSheet || (unitRange.sheetName = \"\", unitRange.unitId = \"\"), node.token = unitRangesToText([unitRange], isSupportAcrossSheet)[0];\n          }\n          return node;\n        }), result = sequenceNodeToText(preNodes);\n        onChange(result);\n      }\n    } else\n      rangeStringSet(\"\");\n  }, 30), [isSupportAcrossSheet]), handleConfirm = /* @__PURE__ */ __name((ranges2) => {\n    const text = unitRangesToText(ranges2, isSupportAcrossSheet).join(matchToken.COMMA);\n    rangeStringSet(text), onChange(text), rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1);\n  }, \"handleConfirm\"), handleClose = /* @__PURE__ */ __name(() => {\n    rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1);\n  }, \"handleClose\"), handleOpenModal = /* @__PURE__ */ __name(() => {\n    isError || (rangeDialogVisibleSet(!0), onRangeSelectorDialogVisibleChange(!0));\n  }, \"handleOpenModal\"), focus = useMemo(() => {\n    let time = 0;\n    return () => {\n      clearTimeout(time), editor && (time = setTimeout(() => {\n        editor.focus();\n      }, 30));\n    };\n  }, [editor]), { checkScrollBar } = useResize(editor), handleSheetSelectionChange = useMemo(() => (text, offset) => {\n    rangeStringSet(text), onChange(text), focus(), offset !== -1 && setTimeout(() => {\n      const range = { startOffset: offset, endOffset: offset };\n      editor == null || editor.setSelectionRanges([range]);\n      const docBackScrollRenderController = editor == null ? void 0 : editor.render.with(DocBackScrollRenderController);\n      docBackScrollRenderController == null || docBackScrollRenderController.scrollToRange({ ...range, collapsed: !0 });\n    }, 50), checkScrollBar();\n  }, [editor]), { sequenceNodes, sequenceNodesSet } = useFormulaToken(rangeString), sheetHighlightRanges = useDocHight(editorId, sequenceNodes);\n  return useSheetHighlight(!rangeDialogVisible && isFocus, unitId, subUnitId, sheetHighlightRanges), useSheetSelectionChange(!rangeDialogVisible && isFocus, unitId, subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleSheetSelectionChange), useRefactorEffect(!rangeDialogVisible && isFocus, unitId, isOnlyOneRange), useEditorInput(unitId, rangeString, editor), useVerify(onVerify, sequenceNodes), useEffect(() => {\n    if (editor) {\n      const dispose = editor.input$.subscribe((e) => {\n        var _a11, _b;\n        const text = ((_b = (_a11 = e.data.body) == null ? void 0 : _a11.dataStream) != null ? _b : \"\").replaceAll(/\\n|\\r/g, \"\").replaceAll(/,{2,}/g, \",\").replaceAll(/(^,)/g, \"\");\n        rangeStringSet(text), handleInputDebounce(text);\n      });\n      return () => {\n        dispose.unsubscribe();\n      };\n    }\n  }, [editor]), useEffect(() => {\n    const d1 = commandService.beforeCommandExecuted((info) => {\n      info.id === SetWorksheetActiveOperation.id && !isSupportAcrossSheet && (isFocusSet(!1), onBlur(), sequenceNodesSet((pre) => [...pre]));\n    }), d2 = commandService.onCommandExecuted((info) => {\n      info.id === SetCellEditVisibleOperation.id && (rangeDialogVisibleSet(!1), onRangeSelectorDialogVisibleChange(!1), isFocusSet(!1), onBlur());\n    });\n    return () => {\n      d1.dispose(), d2.dispose();\n    };\n  }, [isSupportAcrossSheet]), useEffect(() => {\n    isFocusSet(_isFocus);\n  }, [_isFocus]), useEffect(() => {\n    if (editor && rangeDialogVisible) {\n      editor.blur();\n      const d = editor.focus$.subscribe(() => {\n        editor.blur();\n      });\n      return () => {\n        d.unsubscribe();\n      };\n    }\n  }, [editor, rangeDialogVisible]), useLayoutEffect(() => {\n    let dispose;\n    if (containerRef.current) {\n      dispose = editorService.register({\n        autofocus: !0,\n        editorUnitId: editorId,\n        isSingle: !0,\n        initialSnapshot: {\n          id: editorId,\n          body: { dataStream: `\\r\n` },\n          documentStyle: {}\n        }\n      }, containerRef.current);\n      const editor2 = editorService.getEditor(editorId);\n      editorSet(editor2);\n    }\n    return () => {\n      dispose == null || dispose.dispose();\n    };\n  }, [containerRef.current]), /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$6.sheetRangeSelector, ref: rangeSelectorWrapRef, children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\n      \"div\",\n      {\n        className: clsx(styles$6.sheetRangeSelectorTextWrap, {\n          [styles$6.sheetRangeSelectorActive]: isFocus && !isError,\n          [styles$6.sheetRangeSelectorError]: isError\n        }),\n        children: [\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$6.sheetRangeSelectorText, ref: containerRef }),\n          /* @__PURE__ */ jsxRuntimeExports.jsx(Tooltip, { title: localeService.t(\"rangeSelector.buttonTooltip\"), placement: \"bottom\", children: /* @__PURE__ */ jsxRuntimeExports.jsx(SelectRangeSingle, { className: styles$6.sheetRangeSelectorIcon, onClick: handleOpenModal }) }),\n          errorText !== void 0 ? /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$6.sheetRangeSelectorErrorWrap, children: errorText }) : null,\n          placeholder !== void 0 && !rangeString ? /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$6.sheetRangeSelectorPlaceholder, children: placeholder }) : null\n        ]\n      }\n    ),\n    rangeDialogVisible && /* @__PURE__ */ jsxRuntimeExports.jsx(\n      RangeSelectorDialog,\n      {\n        handleConfirm,\n        handleClose,\n        unitId,\n        subUnitId,\n        initValue: ranges,\n        visible: rangeDialogVisible,\n        isOnlyOneRange,\n        isSupportAcrossSheet\n      }\n    )\n  ] });\n}\n__name(RangeSelector, \"RangeSelector\");\nfunction RangeSelectorDialog(props) {\n  const { handleConfirm, handleClose: _handleClose, visible, initValue, unitId, subUnitId, isOnlyOneRange, isSupportAcrossSheet } = props, localeService = useDependency(LocaleService), descriptionService = useDependency(IDescriptionService), lexerTreeBuilder = useDependency(LexerTreeBuilder), render2 = useDependency(IRenderManagerService).getRenderById(unitId), refSelectionsRenderService = render2 == null ? void 0 : render2.with(RefSelectionsRenderService), [ranges, rangesSet] = useState(() => {\n    if (isOnlyOneRange) {\n      const firstRange = initValue[0];\n      return firstRange ? unitRangesToText([firstRange], isSupportAcrossSheet) : [\"\"];\n    }\n    return unitRangesToText(initValue, isSupportAcrossSheet);\n  }), [focusIndex, focusIndexSet] = useState(() => ranges.length - 1), colorMap = useColor(), rangeText = useMemo(() => ranges.join(matchToken.COMMA), [ranges]), { sequenceNodes, sequenceNodesSet } = useFormulaToken(rangeText), refSelections = useMemo(() => buildTextRuns(descriptionService, colorMap, sequenceNodes).refSelections, [sequenceNodes]), handleClose = /* @__PURE__ */ __name(() => {\n    sequenceNodesSet([]), setTimeout(() => {\n      _handleClose();\n    }, 30);\n  }, \"handleClose\"), handleRangeInput = /* @__PURE__ */ __name((index, value) => {\n    value ? refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1) : refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0), rangesSet((v) => {\n      const result = [...v];\n      return result[index] = value, result;\n    });\n  }, \"handleRangeInput\"), handleRangeRemove = /* @__PURE__ */ __name((index) => {\n    refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1), rangesSet((v) => {\n      if (v.length === 1)\n        return v;\n      const result = [];\n      return v.forEach((r2, i) => {\n        index !== i && result.push(r2);\n      }), result;\n    });\n  }, \"handleRangeRemove\"), handleRangeAdd = /* @__PURE__ */ __name(() => {\n    refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0), rangesSet((v) => (v.push(\"\"), focusIndexSet(v.length - 1), [...v]));\n  }, \"handleRangeAdd\"), handleSheetSelectionChange = useCallback((rangeText2) => {\n    var _a11;\n    refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!1);\n    const ranges2 = rangeText2.split(matchToken.COMMA).filter((e) => !!e);\n    rangesSet(isOnlyOneRange ? [(_a11 = ranges2[0]) != null ? _a11 : \"\"] : ranges2);\n  }, [focusIndex, isOnlyOneRange]);\n  return useSheetHighlight(visible, unitId, subUnitId, refSelections), useSheetSelectionChange(focusIndex >= 0, unitId, subUnitId, sequenceNodes, isSupportAcrossSheet, isOnlyOneRange, handleSheetSelectionChange), useRefactorEffect(focusIndex >= 0, unitId, isOnlyOneRange), useEffect(() => {\n    (ranges.length === 0 || ranges.length === 1 && !ranges[0]) && (refSelectionsRenderService == null || refSelectionsRenderService.setSkipLastEnabled(!0));\n  }, [ranges]), /* @__PURE__ */ jsxRuntimeExports.jsx(\n    Dialog,\n    {\n      width: \"328px\",\n      visible,\n      title: localeService.t(\"rangeSelector.title\"),\n      draggable: !0,\n      closeIcon: /* @__PURE__ */ jsxRuntimeExports.jsx(CloseSingle, {}),\n      footer: /* @__PURE__ */ jsxRuntimeExports.jsxs(\"footer\", { children: [\n        /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { onClick: handleClose, children: localeService.t(\"rangeSelector.cancel\") }),\n        /* @__PURE__ */ jsxRuntimeExports.jsx(\n          Button,\n          {\n            style: { marginLeft: 10 },\n            onClick: /* @__PURE__ */ __name(() => handleConfirm(ranges.filter((text) => {\n              const nodes = lexerTreeBuilder.sequenceNodesBuilder(text);\n              return nodes && nodes.length === 1 && typeof nodes[0] != \"string\" && nodes[0].nodeType === sequenceNodeType.REFERENCE;\n            }).map((text) => deserializeRangeWithSheet(text)).map((unitRange) => ({ ...unitRange, range: rangePreProcess(unitRange.range) }))), \"onClick\"),\n            type: \"primary\",\n            children: localeService.t(\"rangeSelector.confirm\")\n          }\n        )\n      ] }),\n      onClose: handleClose,\n      children: /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$6.sheetRangeSelectorDialog, children: [\n        ranges.map((text, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$6.sheetRangeSelectorDialogItem, children: [\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\n            Input,\n            {\n              affixWrapperStyle: { width: \"100%\" },\n              placeholder: localeService.t(\"rangeSelector.placeHolder\"),\n              onFocus: /* @__PURE__ */ __name(() => focusIndexSet(index), \"onFocus\"),\n              value: text,\n              onChange: /* @__PURE__ */ __name((value) => handleRangeInput(index, value), \"onChange\")\n            },\n            `input_${index}`\n          ),\n          ranges.length > 1 && !isOnlyOneRange && /* @__PURE__ */ jsxRuntimeExports.jsx(DeleteSingle, { className: styles$6.sheetRangeSelectorDialogItemDelete, onClick: /* @__PURE__ */ __name(() => handleRangeRemove(index), \"onClick\") })\n        ] }, index)),\n        !isOnlyOneRange && /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { children: /* @__PURE__ */ jsxRuntimeExports.jsxs(Button, { type: \"link\", size: \"small\", onClick: handleRangeAdd, children: [\n          /* @__PURE__ */ jsxRuntimeExports.jsx(IncreaseSingle, {}),\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { children: localeService.t(\"rangeSelector.addAnotherRange\") })\n        ] }) })\n      ] })\n    }\n  );\n}\n__name(RangeSelectorDialog, \"RangeSelectorDialog\");\nconst PLUGIN_CONFIG_KEY_BASE = \"sheets-formula.base.config\", defaultPluginBaseConfig = {};\nfunction whenEditorStandalone(contextService) {\n  return contextService.getContextValue(FOCUSING_DOC) && contextService.getContextValue(FOCUSING_UNIVER_EDITOR) && contextService.getContextValue(FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE);\n}\n__name(whenEditorStandalone, \"whenEditorStandalone\");\nfunction extractFormulaError(cell, isArrayFormulaCell = !1) {\n  return !isArrayFormulaCell && !(isFormulaString(cell == null ? void 0 : cell.f) || isFormulaId(cell == null ? void 0 : cell.si)) ? null : typeof (cell == null ? void 0 : cell.v) == \"string\" && ERROR_TYPE_SET.has(cell.v) ? cell.v : null;\n}\n__name(extractFormulaError, \"extractFormulaError\");\nvar __defProp$7 = Object.defineProperty, __getOwnPropDesc$7 = Object.getOwnPropertyDescriptor, __decorateClass$7 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$7(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$7(target, key, result), result;\n}, \"__decorateClass$7\"), __decorateParam$7 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$7\");\nconst ALERT_KEY = \"SHEET_FORMULA_ALERT\", ErrorTypeToMessageMap = {\n  [ErrorType.DIV_BY_ZERO]: \"divByZero\",\n  [ErrorType.NAME]: \"name\",\n  [ErrorType.VALUE]: \"value\",\n  [ErrorType.NUM]: \"num\",\n  [ErrorType.NA]: \"na\",\n  [ErrorType.CYCLE]: \"cycle\",\n  [ErrorType.REF]: \"ref\",\n  [ErrorType.SPILL]: \"spill\",\n  [ErrorType.CALC]: \"calc\",\n  [ErrorType.ERROR]: \"error\",\n  [ErrorType.CONNECT]: \"connect\",\n  [ErrorType.NULL]: \"null\"\n};\nvar _a3;\nlet FormulaAlertRenderController = (_a3 = class extends Disposable {\n  constructor(_context, _hoverManagerService, _cellAlertManagerService, _localeService, _formulaDataModel, _zenZoneService) {\n    super(), this._context = _context, this._hoverManagerService = _hoverManagerService, this._cellAlertManagerService = _cellAlertManagerService, this._localeService = _localeService, this._formulaDataModel = _formulaDataModel, this._zenZoneService = _zenZoneService, this._init();\n  }\n  _init() {\n    this._initCellAlertPopup(), this._initZenService();\n  }\n  _initCellAlertPopup() {\n    this.disposeWithMe(this._hoverManagerService.currentCell$.subscribe((cellPos) => {\n      var _a11, _b, _c, _d, _e;\n      if (cellPos) {\n        const worksheet = this._context.unit.getActiveSheet();\n        if (!worksheet) return;\n        const cellData = worksheet.getCell(cellPos.location.row, cellPos.location.col), arrayFormulaCellData = (_d = (_c = (_b = (_a11 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[cellPos.location.unitId]) == null ? void 0 : _b[cellPos.location.subUnitId]) == null ? void 0 : _c[cellPos.location.row]) == null ? void 0 : _d[cellPos.location.col];\n        if (isICellData(cellData)) {\n          const errorType = extractFormulaError(cellData, !!arrayFormulaCellData);\n          if (!errorType)\n            return;\n          const currentAlert = this._cellAlertManagerService.currentAlert.get(ALERT_KEY), currentLoc = (_e = currentAlert == null ? void 0 : currentAlert.alert) == null ? void 0 : _e.location;\n          if (currentLoc && currentLoc.row === cellPos.location.row && currentLoc.col === cellPos.location.col && currentLoc.subUnitId === cellPos.location.subUnitId && currentLoc.unitId === cellPos.location.unitId)\n            return;\n          this._cellAlertManagerService.showAlert({\n            type: CellAlertType.ERROR,\n            title: this._localeService.t(\"formula.error.title\"),\n            message: this._localeService.t(`formula.error.${ErrorTypeToMessageMap[errorType]}`),\n            location: cellPos.location,\n            width: 200,\n            height: 74,\n            key: ALERT_KEY\n          });\n          return;\n        }\n      }\n      this._cellAlertManagerService.removeAlert(ALERT_KEY);\n    }));\n  }\n  _initZenService() {\n    this.disposeWithMe(this._zenZoneService.visible$.subscribe((visible) => {\n      visible && this._cellAlertManagerService.removeAlert(ALERT_KEY);\n    }));\n  }\n}, __name(_a3, \"FormulaAlertRenderController\"), _a3);\nFormulaAlertRenderController = __decorateClass$7([\n  __decorateParam$7(1, Inject(HoverManagerService)),\n  __decorateParam$7(2, Inject(CellAlertManagerService)),\n  __decorateParam$7(3, Inject(LocaleService)),\n  __decorateParam$7(4, Inject(FormulaDataModel)),\n  __decorateParam$7(5, IZenZoneService)\n], FormulaAlertRenderController);\nvar __defProp$6 = Object.defineProperty, __getOwnPropDesc$6 = Object.getOwnPropertyDescriptor, __decorateClass$6 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$6(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$6(target, key, result), result;\n}, \"__decorateClass$6\"), __decorateParam$6 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$6\"), _a4;\nlet FormulaAutoFillController = (_a4 = class extends Disposable {\n  constructor(_autoFillService, _lexerTreeBuilder) {\n    super(), this._autoFillService = _autoFillService, this._lexerTreeBuilder = _lexerTreeBuilder, this._registerAutoFill();\n  }\n  _registerAutoFill() {\n    const formulaRule = {\n      type: DATA_TYPE.FORMULA,\n      priority: 1001,\n      match: /* @__PURE__ */ __name((cellData) => isFormulaString(cellData == null ? void 0 : cellData.f) || isFormulaId(cellData == null ? void 0 : cellData.si), \"match\"),\n      isContinue: /* @__PURE__ */ __name((prev, cur) => prev.type === DATA_TYPE.FORMULA, \"isContinue\"),\n      applyFunctions: {\n        [APPLY_TYPE.COPY]: (dataWithIndex, len, direction, copyDataPiece) => {\n          const { data, index } = dataWithIndex;\n          return this._fillCopyFormula(data, len, direction, index, copyDataPiece);\n        }\n      }\n    };\n    this._autoFillService.registerRule(formulaRule);\n  }\n  _fillCopyFormula(data, len, direction, index, copyDataPiece) {\n    var _a11, _b;\n    const step = getDataLength(copyDataPiece), applyData = [], formulaIdMap = /* @__PURE__ */ new Map();\n    for (let i = 1; i <= len; i++) {\n      const index2 = (i - 1) % data.length, d = Tools.deepClone(data[index2]);\n      if (d) {\n        const originalFormula = ((_a11 = data[index2]) == null ? void 0 : _a11.f) || \"\", originalFormulaId = ((_b = data[index2]) == null ? void 0 : _b.si) || \"\", checkFormula = isFormulaString(originalFormula);\n        if (isFormulaId(originalFormulaId))\n          d.si = originalFormulaId, d.f = null, d.v = null, d.p = null, d.t = null, direction === Direction.DOWN || direction === Direction.RIGHT ? applyData.push(d) : applyData.unshift(d);\n        else if (checkFormula) {\n          let formulaId = formulaIdMap.get(index2);\n          if (formulaId)\n            d.si = formulaId, d.f = null, d.v = null, d.p = null, d.t = null;\n          else {\n            formulaId = Tools.generateRandomId(6), formulaIdMap.set(index2, formulaId);\n            const { offsetX, offsetY } = directionToOffset(step, direction), shiftedFormula = this._lexerTreeBuilder.moveFormulaRefOffset(\n              originalFormula,\n              offsetX,\n              offsetY\n            );\n            d.si = formulaId, d.f = shiftedFormula, d.v = null, d.p = null, d.t = null;\n          }\n          direction === Direction.DOWN || direction === Direction.RIGHT ? applyData.push(d) : applyData.unshift(d);\n        }\n      }\n    }\n    return applyData;\n  }\n}, __name(_a4, \"FormulaAutoFillController\"), _a4);\nFormulaAutoFillController = __decorateClass$6([\n  __decorateParam$6(0, IAutoFillService),\n  __decorateParam$6(1, Inject(LexerTreeBuilder))\n], FormulaAutoFillController);\nfunction directionToOffset(step, direction) {\n  let offsetX = 0, offsetY = 0;\n  switch (direction) {\n    case Direction.UP:\n      offsetY = -step;\n      break;\n    case Direction.RIGHT:\n      offsetX = step;\n      break;\n    case Direction.DOWN:\n      offsetY = step;\n      break;\n    case Direction.LEFT:\n      offsetX = -step;\n      break;\n  }\n  return { offsetX, offsetY };\n}\n__name(directionToOffset, \"directionToOffset\");\nfunction getDataLength(copyDataPiece) {\n  let length = 0;\n  for (const t in copyDataPiece)\n    copyDataPiece[t].forEach((item) => {\n      length += item.data.length;\n    });\n  return length;\n}\n__name(getDataLength, \"getDataLength\");\nvar __defProp$5 = Object.defineProperty, __getOwnPropDesc$5 = Object.getOwnPropertyDescriptor, __decorateClass$5 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$5(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$5(target, key, result), result;\n}, \"__decorateClass$5\"), __decorateParam$5 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$5\");\nconst DEFAULT_PASTE_FORMULA = \"default-paste-formula\";\nvar _a5;\nlet FormulaClipboardController = (_a5 = class extends Disposable {\n  constructor(_currentUniverSheet, _lexerTreeBuilder, _sheetClipboardService, _injector, _formulaDataModel) {\n    super(), this._currentUniverSheet = _currentUniverSheet, this._lexerTreeBuilder = _lexerTreeBuilder, this._sheetClipboardService = _sheetClipboardService, this._injector = _injector, this._formulaDataModel = _formulaDataModel, this._initialize();\n  }\n  _initialize() {\n    this._registerClipboardHook();\n  }\n  _registerClipboardHook() {\n    this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteFormulaHook())), this.disposeWithMe(this._sheetClipboardService.addClipboardHook(this._pasteWithFormulaHook()));\n  }\n  _pasteFormulaHook() {\n    return {\n      id: PREDEFINED_HOOK_NAME.SPECIAL_PASTE_FORMULA,\n      priority: 10,\n      specialPasteInfo: { label: \"specialPaste.formula\" },\n      onPasteCells: /* @__PURE__ */ __name((pasteFrom, pasteTo, data, payload) => this._onPasteCells(pasteFrom, pasteTo, data, payload, !0), \"onPasteCells\")\n    };\n  }\n  _pasteWithFormulaHook() {\n    return {\n      id: DEFAULT_PASTE_FORMULA,\n      priority: 10,\n      onPasteCells: /* @__PURE__ */ __name((pasteFrom, pasteTo, data, payload) => this._onPasteCells(pasteFrom, pasteTo, data, payload, !1), \"onPasteCells\")\n    };\n  }\n  _onPasteCells(pasteFrom, pasteTo, data, payload, isSpecialPaste) {\n    var _a11;\n    if ([PREDEFINED_HOOK_NAME.SPECIAL_PASTE_FORMAT, PREDEFINED_HOOK_NAME.SPECIAL_PASTE_COL_WIDTH].includes(payload.pasteType))\n      return {\n        undos: [],\n        redos: []\n      };\n    const workbook = this._currentUniverSheet.getCurrentUnitForType(UniverInstanceType.UNIVER_SHEET), unitId = pasteTo.unitId || workbook.getUnitId(), subUnitId = pasteTo.subUnitId || ((_a11 = workbook.getActiveSheet()) == null ? void 0 : _a11.getSheetId());\n    if (!unitId || !subUnitId)\n      return {\n        undos: [],\n        redos: []\n      };\n    const pastedRange = pasteTo.range, matrix = data, copyInfo = {\n      copyType: payload.copyType || COPY_TYPE.COPY,\n      copyRange: pasteFrom == null ? void 0 : pasteFrom.range,\n      pasteType: payload.pasteType\n    };\n    return this._injector.invoke((accessor) => getSetCellFormulaMutations(\n      unitId,\n      subUnitId,\n      pastedRange,\n      matrix,\n      accessor,\n      copyInfo,\n      this._lexerTreeBuilder,\n      this._formulaDataModel,\n      isSpecialPaste,\n      pasteFrom\n    ));\n  }\n}, __name(_a5, \"FormulaClipboardController\"), _a5);\nFormulaClipboardController = __decorateClass$5([\n  __decorateParam$5(0, IUniverInstanceService),\n  __decorateParam$5(1, Inject(LexerTreeBuilder)),\n  __decorateParam$5(2, ISheetClipboardService),\n  __decorateParam$5(3, Inject(Injector)),\n  __decorateParam$5(4, Inject(FormulaDataModel))\n], FormulaClipboardController);\nfunction getSetCellFormulaMutations(unitId, subUnitId, range, matrix, accessor, copyInfo, lexerTreeBuilder, formulaDataModel, isSpecialPaste = !1, pasteFrom) {\n  const redoMutationsInfo = [], undoMutationsInfo = [], valueMatrix = getValueMatrix(unitId, subUnitId, range, matrix, copyInfo, lexerTreeBuilder, formulaDataModel, pasteFrom), setValuesMutation = {\n    unitId,\n    subUnitId,\n    cellValue: valueMatrix.getData()\n  };\n  redoMutationsInfo.push({\n    id: SetRangeValuesMutation.id,\n    params: setValuesMutation\n  });\n  const undoSetValuesMutation = SetRangeValuesUndoMutationFactory(\n    accessor,\n    setValuesMutation\n  );\n  return undoMutationsInfo.push({\n    id: SetRangeValuesMutation.id,\n    params: undoSetValuesMutation\n  }), {\n    undos: undoMutationsInfo,\n    redos: redoMutationsInfo\n  };\n}\n__name(getSetCellFormulaMutations, \"getSetCellFormulaMutations\");\nfunction getValueMatrix(unitId, subUnitId, range, matrix, copyInfo, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n  return pasteFrom ? copyInfo.pasteType === PREDEFINED_HOOK_NAME.SPECIAL_PASTE_VALUE ? getSpecialPasteValueValueMatrix(unitId, subUnitId, range, matrix, formulaDataModel, pasteFrom) : copyInfo.pasteType === PREDEFINED_HOOK_NAME.SPECIAL_PASTE_FORMULA ? getSpecialPasteFormulaValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) : getDefaultPasteValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) : getValueMatrixOfPasteFromIsNull(unitId, subUnitId, range, matrix, formulaDataModel);\n}\n__name(getValueMatrix, \"getValueMatrix\");\nfunction getValueMatrixOfPasteFromIsNull(unitId, subUnitId, range, matrix, formulaDataModel) {\n  var _a11, _b;\n  const valueMatrix = new ObjectMatrix(), formulaData = (_b = (_a11 = formulaDataModel.getFormulaData()) == null ? void 0 : _a11[unitId]) == null ? void 0 : _b[subUnitId];\n  return matrix.forValue((row, col, value) => {\n    var _a12;\n    const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n    isFormulaString(value.v) ? (valueObject.v = null, valueObject.f = `${value.v}`, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject)) : (_a12 = formulaData == null ? void 0 : formulaData[toRow]) != null && _a12[toCol] && (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject));\n  }), valueMatrix;\n}\n__name(getValueMatrixOfPasteFromIsNull, \"getValueMatrixOfPasteFromIsNull\");\nfunction getSpecialPasteValueValueMatrix(unitId, subUnitId, range, matrix, formulaDataModel, pasteFrom) {\n  var _a11, _b, _c, _d;\n  const valueMatrix = new ObjectMatrix(), arrayFormulaCellData = (_b = (_a11 = formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[pasteFrom.unitId]) == null ? void 0 : _b[pasteFrom.subUnitId], formulaData = (_d = (_c = formulaDataModel.getFormulaData()) == null ? void 0 : _c[unitId]) == null ? void 0 : _d[subUnitId];\n  return matrix.forValue((row, col, value) => {\n    var _a12, _b2;\n    const fromRow = pasteFrom.range.rows[row % pasteFrom.range.rows.length], fromCol = pasteFrom.range.cols[col % pasteFrom.range.cols.length], toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n    if (isFormulaString(value.f) || isFormulaId(value.si))\n      valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    else if ((_a12 = arrayFormulaCellData == null ? void 0 : arrayFormulaCellData[fromRow]) != null && _a12[fromCol]) {\n      const cell = arrayFormulaCellData[fromRow][fromCol];\n      valueObject.v = cell.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    } else if ((_b2 = formulaData == null ? void 0 : formulaData[toRow]) != null && _b2[toCol]) {\n      if (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, value.p) {\n        const richText = getCellRichText(value);\n        richText && (valueObject.v = richText);\n      }\n      valueMatrix.setValue(toRow, toCol, valueObject);\n    }\n  }), valueMatrix;\n}\n__name(getSpecialPasteValueValueMatrix, \"getSpecialPasteValueValueMatrix\");\nfunction getSpecialPasteFormulaValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n  const valueMatrix = new ObjectMatrix(), formulaIdMap = /* @__PURE__ */ new Map();\n  return matrix.forValue((row, col, value) => {\n    const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n    if (isFormulaId(value.si)) {\n      if (pasteFrom.unitId !== unitId || pasteFrom.subUnitId !== subUnitId) {\n        const formulaString = formulaDataModel.getFormulaStringByCell(\n          pasteFrom.range.rows[row % pasteFrom.range.rows.length],\n          pasteFrom.range.cols[col % pasteFrom.range.cols.length],\n          pasteFrom.subUnitId,\n          pasteFrom.unitId\n        ), offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(formulaString || \"\", offsetX, offsetY);\n        valueObject.si = null, valueObject.f = shiftedFormula;\n      } else\n        valueObject.si = value.si, valueObject.f = null;\n      valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    } else if (isFormulaString(value.f)) {\n      const index = `${row % pasteFrom.range.rows.length}_${col % pasteFrom.range.cols.length}`;\n      let formulaId = formulaIdMap.get(index);\n      if (formulaId)\n        valueObject.si = formulaId, valueObject.f = null;\n      else {\n        formulaId = Tools.generateRandomId(6), formulaIdMap.set(index, formulaId);\n        const offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(value.f || \"\", offsetX, offsetY);\n        valueObject.si = formulaId, valueObject.f = shiftedFormula;\n      }\n      valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    } else {\n      if (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = null, value.p) {\n        const richText = getCellRichText(value);\n        richText && (valueObject.v = richText);\n      }\n      valueMatrix.setValue(toRow, toCol, valueObject);\n    }\n  }), valueMatrix;\n}\n__name(getSpecialPasteFormulaValueMatrix, \"getSpecialPasteFormulaValueMatrix\");\nfunction getDefaultPasteValueMatrix(unitId, subUnitId, range, matrix, lexerTreeBuilder, formulaDataModel, pasteFrom) {\n  var _a11, _b;\n  const valueMatrix = new ObjectMatrix(), formulaIdMap = /* @__PURE__ */ new Map(), formulaData = (_b = (_a11 = formulaDataModel.getFormulaData()) == null ? void 0 : _a11[unitId]) == null ? void 0 : _b[subUnitId];\n  return matrix.forValue((row, col, value) => {\n    var _a12;\n    const toRow = range.rows[row], toCol = range.cols[col], valueObject = {};\n    if (isFormulaId(value.si)) {\n      if (pasteFrom.unitId !== unitId || pasteFrom.subUnitId !== subUnitId) {\n        const formulaString = formulaDataModel.getFormulaStringByCell(\n          pasteFrom.range.rows[row % pasteFrom.range.rows.length],\n          pasteFrom.range.cols[col % pasteFrom.range.cols.length],\n          pasteFrom.subUnitId,\n          pasteFrom.unitId\n        ), offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(formulaString || \"\", offsetX, offsetY);\n        valueObject.si = null, valueObject.f = shiftedFormula;\n      } else\n        valueObject.si = value.si, valueObject.f = null;\n      valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    } else if (isFormulaString(value.f)) {\n      const index = `${row % pasteFrom.range.rows.length}_${col % pasteFrom.range.cols.length}`;\n      let formulaId = formulaIdMap.get(index);\n      if (formulaId)\n        valueObject.si = formulaId, valueObject.f = null;\n      else {\n        formulaId = Tools.generateRandomId(6), formulaIdMap.set(index, formulaId);\n        const offsetX = range.cols[col] - pasteFrom.range.cols[col % pasteFrom.range.cols.length], offsetY = range.rows[row] - pasteFrom.range.rows[row % pasteFrom.range.rows.length], shiftedFormula = lexerTreeBuilder.moveFormulaRefOffset(value.f || \"\", offsetX, offsetY);\n        valueObject.si = formulaId, valueObject.f = shiftedFormula;\n      }\n      valueObject.v = null, valueObject.p = null, valueMatrix.setValue(toRow, toCol, valueObject);\n    } else (_a12 = formulaData == null ? void 0 : formulaData[toRow]) != null && _a12[toCol] && (valueObject.v = value.v, valueObject.f = null, valueObject.si = null, valueObject.p = value.p, valueMatrix.setValue(toRow, toCol, valueObject));\n  }), valueMatrix;\n}\n__name(getDefaultPasteValueMatrix, \"getDefaultPasteValueMatrix\");\nfunction getCellRichText(cell) {\n  if (cell != null && cell.p) {\n    const body = cell == null ? void 0 : cell.p.body;\n    if (body == null)\n      return;\n    const data = body.dataStream;\n    return data.substring(data.length - 2, data.length) === DEFAULT_EMPTY_DOCUMENT_VALUE ? data.substring(0, data.length - 2) : data;\n  }\n}\n__name(getCellRichText, \"getCellRichText\");\nvar __defProp$4 = Object.defineProperty, __getOwnPropDesc$4 = Object.getOwnPropertyDescriptor, __decorateClass$4 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$4(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$4(target, key, result), result;\n}, \"__decorateClass$4\"), __decorateParam$4 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$4\"), _a6;\nlet FormulaEditorShowController = (_a6 = class extends Disposable {\n  constructor(_context, _editorBridgeService, _formulaDataModel, _themeService, _renderManagerService, _sheetSkeletonManagerService, _commandService, _logService) {\n    super();\n    __publicField(this, \"_previousShape\");\n    __publicField(this, \"_skeleton\");\n    this._context = _context, this._editorBridgeService = _editorBridgeService, this._formulaDataModel = _formulaDataModel, this._themeService = _themeService, this._renderManagerService = _renderManagerService, this._sheetSkeletonManagerService = _sheetSkeletonManagerService, this._commandService = _commandService, this._logService = _logService, this._initSkeletonChangeListener(), this._initInterceptorEditorStart(), this._commandExecutedListener();\n  }\n  _initSkeletonChangeListener() {\n    this.disposeWithMe(\n      this._sheetSkeletonManagerService.currentSkeleton$.subscribe((param) => {\n        var _a11, _b;\n        if (param == null)\n          this._logService.debug(\"[FormulaEditorShowController]: should not receive currentSkeleton$ as null!\");\n        else {\n          const { skeleton } = param, prevSheetId = (_b = (_a11 = this._skeleton) == null ? void 0 : _a11.worksheet) == null ? void 0 : _b.getSheetId();\n          if (this._changeRuntime(skeleton), prevSheetId !== skeleton.worksheet.getSheetId())\n            this._removeArrayFormulaRangeShape();\n          else {\n            const { unitId, sheetId } = param;\n            this._updateArrayFormulaRangeShape(unitId, sheetId);\n          }\n        }\n      })\n    );\n  }\n  _changeRuntime(skeleton) {\n    this._skeleton = skeleton;\n  }\n  _initInterceptorEditorStart() {\n    this.disposeWithMe(\n      toDisposable(\n        this._editorBridgeService.interceptor.intercept(\n          this._editorBridgeService.interceptor.getInterceptPoints().BEFORE_CELL_EDIT,\n          {\n            handler: /* @__PURE__ */ __name((value, context, next) => {\n              var _a11, _b, _c, _d;\n              const { row, col, unitId, subUnitId, worksheet } = context, arrayFormulaMatrixRange = this._formulaDataModel.getArrayFormulaRange(), arrayFormulaMatrixCell = this._formulaDataModel.getArrayFormulaCellData();\n              if (this._removeArrayFormulaRangeShape(), value == null)\n                return next(value);\n              let cellInfo = null;\n              const formulaString = this._formulaDataModel.getFormulaStringByCell(row, col, subUnitId, unitId);\n              if (formulaString !== null && (cellInfo = { f: formulaString }), value.v != null && value.v !== \"\" && ((_c = (_b = (_a11 = arrayFormulaMatrixCell[unitId]) == null ? void 0 : _a11[subUnitId]) == null ? void 0 : _b[row]) == null ? void 0 : _c[col]) == null)\n                return cellInfo ? { ...value, ...cellInfo } : next(value);\n              const matrixRange = (_d = arrayFormulaMatrixRange == null ? void 0 : arrayFormulaMatrixRange[unitId]) == null ? void 0 : _d[subUnitId];\n              return matrixRange != null && (cellInfo = this._displayArrayFormulaRangeShape(matrixRange, row, col, unitId, subUnitId, worksheet, cellInfo)), cellInfo ? { ...value, ...cellInfo } : next(value);\n            }, \"handler\")\n          }\n        )\n      )\n    );\n  }\n  _commandExecutedListener() {\n    this.disposeWithMe(this._commandService.onCommandExecuted((command, options) => {\n      (command.id === SetFormulaCalculationResultMutation.id || command.id === SetArrayFormulaDataMutation.id && options && options.remove) && this._removeArrayFormulaRangeShape();\n    })), this.disposeWithMe(\n      this._commandService.beforeCommandExecuted((command) => {\n        SetWorksheetRowAutoHeightMutation.id === command.id && requestIdleCallback(() => {\n          const params = command.params, { unitId, subUnitId, rowsAutoHeightInfo } = params;\n          this._refreshArrayFormulaRangeShapeByRow(unitId, subUnitId, rowsAutoHeightInfo);\n        });\n      })\n    );\n  }\n  _displayArrayFormulaRangeShape(matrixRange, row, col, unitId, subUnitId, worksheet, cellInfo) {\n    return new ObjectMatrix(matrixRange).forValue((rowIndex, columnIndex, range) => {\n      if (range == null)\n        return !0;\n      const { startRow, startColumn, endRow, endColumn } = range;\n      if (rowIndex === row && columnIndex === col)\n        return this._createArrayFormulaRangeShape(range, unitId), !1;\n      if (row >= startRow && row <= endRow && col >= startColumn && col <= endColumn) {\n        const mainCellValue = worksheet.getCell(startRow, startColumn);\n        if ((mainCellValue == null ? void 0 : mainCellValue.v) === ErrorType.SPILL)\n          return;\n        const formulaDataItem = this._formulaDataModel.getFormulaDataItem(\n          rowIndex,\n          columnIndex,\n          subUnitId,\n          unitId\n        );\n        return formulaDataItem == null || formulaDataItem.f == null ? !0 : (cellInfo == null && (cellInfo = {\n          f: formulaDataItem.f,\n          isInArrayFormulaRange: !0\n        }), this._createArrayFormulaRangeShape(range, unitId), !1);\n      }\n    }), cellInfo;\n  }\n  _createArrayFormulaRangeShape(arrayRange, unitId) {\n    const styleSheet = this._themeService.getCurrentTheme(), fill = new ColorKit(styleSheet.colorWhite).setAlpha(0).toString(), style = {\n      strokeWidth: 1,\n      stroke: styleSheet.hyacinth700,\n      fill,\n      widgets: {},\n      hasAutoFill: !1,\n      hasRowHeader: !1,\n      hasColumnHeader: !1\n    }, renderUnit = this._renderManagerService.getRenderById(unitId);\n    if (!renderUnit) return;\n    const { scene } = renderUnit, { rangeWithCoord, primaryWithCoord } = renderUnit.with(ISheetSelectionRenderService).attachSelectionWithCoord({\n      range: arrayRange,\n      primary: null,\n      style\n    }), skeleton = this._sheetSkeletonManagerService.getCurrentSkeleton();\n    if (!scene || !skeleton) return;\n    const { rowHeaderWidth, columnHeaderHeight } = skeleton, control = new SelectionShape(scene, SELECTION_SHAPE_DEPTH.FORMULA_EDITOR_SHOW, this._themeService, !1);\n    control.update(rangeWithCoord, rowHeaderWidth, columnHeaderHeight, style, primaryWithCoord), control.setEvent(!1), this._previousShape = control;\n  }\n  _removeArrayFormulaRangeShape() {\n    this._previousShape != null && (this._previousShape.dispose(), this._previousShape = null);\n  }\n  _refreshArrayFormulaRangeShape(unitId, _range) {\n    if (this._previousShape) {\n      const { startRow, endRow, startColumn, endColumn } = this._previousShape.getRange(), range = { startRow, endRow, startColumn, endColumn };\n      this._removeArrayFormulaRangeShape(), this._createArrayFormulaRangeShape(range, unitId);\n    }\n  }\n  _checkCurrentSheet(unitId, subUnitId) {\n    const skeleton = this._sheetSkeletonManagerService.getCurrentSkeleton();\n    if (!skeleton) return !1;\n    const worksheet = skeleton.worksheet;\n    return worksheet ? worksheet.unitId === unitId && worksheet.getSheetId() === subUnitId : !1;\n  }\n  _updateArrayFormulaRangeShape(unitId, subUnitId) {\n    this._checkCurrentSheet(unitId, subUnitId) && this._previousShape && this._refreshArrayFormulaRangeShape(unitId);\n  }\n  _refreshArrayFormulaRangeShapeByRow(unitId, subUnitId, rowAutoHeightInfo) {\n    if (!this._checkCurrentSheet(unitId, subUnitId) || !this._previousShape) return;\n    const { startRow: shapeStartRow, endRow: shapeEndRow, startColumn: shapeStartColumn, endColumn: shapeEndColumn } = this._previousShape.getRange();\n    for (let i = 0; i < rowAutoHeightInfo.length; i++) {\n      const { row } = rowAutoHeightInfo[i];\n      if (shapeStartRow >= row) {\n        const shapeRange = {\n          startRow: shapeStartRow,\n          endRow: shapeEndRow,\n          startColumn: shapeStartColumn,\n          endColumn: shapeEndColumn\n        };\n        this._refreshArrayFormulaRangeShape(unitId, shapeRange);\n        break;\n      }\n    }\n  }\n}, __name(_a6, \"FormulaEditorShowController\"), _a6);\nFormulaEditorShowController = __decorateClass$4([\n  __decorateParam$4(1, Inject(IEditorBridgeService)),\n  __decorateParam$4(2, Inject(FormulaDataModel)),\n  __decorateParam$4(3, Inject(ThemeService)),\n  __decorateParam$4(4, IRenderManagerService),\n  __decorateParam$4(5, Inject(SheetSkeletonManagerService)),\n  __decorateParam$4(6, ICommandService),\n  __decorateParam$4(7, ILogService)\n], FormulaEditorShowController);\nvar __defProp$3 = Object.defineProperty, __getOwnPropDesc$3 = Object.getOwnPropertyDescriptor, __decorateClass$3 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$3(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$3(target, key, result), result;\n}, \"__decorateClass$3\"), __decorateParam$3 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$3\");\nconst FORMULA_ERROR_MARK = {\n  tl: {\n    size: 6,\n    color: \"#409f11\"\n  }\n};\nvar _a7;\nlet FormulaRenderManagerController = (_a7 = class extends RxDisposable {\n  constructor(_sheetInterceptorService, _formulaDataModel) {\n    super(), this._sheetInterceptorService = _sheetInterceptorService, this._formulaDataModel = _formulaDataModel, this.disposeWithMe(this._sheetInterceptorService.intercept(\n      INTERCEPTOR_POINT.CELL_CONTENT,\n      {\n        effect: InterceptorEffectEnum.Style,\n        handler: /* @__PURE__ */ __name((cell, pos, next) => {\n          var _a11, _b, _c, _d;\n          const arrayFormulaCellData = (_d = (_c = (_b = (_a11 = this._formulaDataModel.getArrayFormulaCellData()) == null ? void 0 : _a11[pos.unitId]) == null ? void 0 : _b[pos.subUnitId]) == null ? void 0 : _c[pos.row]) == null ? void 0 : _d[pos.col];\n          return extractFormulaError(cell, !!arrayFormulaCellData) ? next({\n            ...cell,\n            markers: {\n              ...cell == null ? void 0 : cell.markers,\n              ...FORMULA_ERROR_MARK\n            }\n          }) : next(cell);\n        }, \"handler\"),\n        priority: 10\n      }\n    ));\n  }\n}, __name(_a7, \"FormulaRenderManagerController\"), _a7);\nFormulaRenderManagerController = __decorateClass$3([\n  __decorateParam$3(0, Inject(SheetInterceptorService)),\n  __decorateParam$3(1, Inject(FormulaDataModel))\n], FormulaRenderManagerController);\nfunction FormulaProgressBar() {\n  const triggerCalculationController = useDependency(TriggerCalculationController), commandService = useDependency(ICommandService), progress = useObservable(triggerCalculationController.progress$), terminateCalculation = useCallback(() => {\n    commandService.executeCommand(SetFormulaCalculationStopMutation.id);\n  }, [commandService]), clearProgress = useCallback(() => {\n    triggerCalculationController.clearProgress();\n  }, [triggerCalculationController]);\n  return /* @__PURE__ */ jsxRuntimeExports.jsx(ProgressBar, { progress, onTerminate: terminateCalculation, onClearProgress: clearProgress });\n}\n__name(FormulaProgressBar, \"FormulaProgressBar\");\nfunction getFunctionTypeValues(enumObj, localeService) {\n  return Object.keys(enumObj).filter((key) => isNaN(Number(key)) && key !== \"DefinedName\").map((key) => ({\n    label: localeService.t(`formula.functionType.${key.toLocaleLowerCase()}`),\n    value: `${enumObj[key]}`\n  }));\n}\n__name(getFunctionTypeValues, \"getFunctionTypeValues\");\nfunction generateParam(param) {\n  if (!param.require && !param.repeat)\n    return `[${param.name}]`;\n  if (param.require && !param.repeat)\n    return param.name;\n  if (!param.require && param.repeat)\n    return `[${param.name},...]`;\n  if (param.require && param.repeat)\n    return `${param.name},...`;\n}\n__name(generateParam, \"generateParam\");\nconst useResizeScrollObserver = /* @__PURE__ */ __name((callback, delay = 100) => {\n  useEffect(() => {\n    let throttleTimeout = null;\n    const throttledCallback = /* @__PURE__ */ __name(() => {\n      throttleTimeout === null && (throttleTimeout = window.setTimeout(() => {\n        callback(), throttleTimeout = null;\n      }, delay));\n    }, \"throttledCallback\");\n    return window.addEventListener(\"scroll\", throttledCallback), window.addEventListener(\"resize\", throttledCallback), () => {\n      throttleTimeout !== null && clearTimeout(throttleTimeout), window.removeEventListener(\"scroll\", throttledCallback), window.removeEventListener(\"resize\", throttledCallback);\n    };\n  }, [callback, delay]);\n}, \"useResizeScrollObserver\"), formulaHelpFunction = \"univer-formula-help-function\", formulaHelpFunctionTitle = \"univer-formula-help-function-title\", formulaHelpFunctionTitleIcons = \"univer-formula-help-function-title-icons\", formulaHelpFunctionTitleIcon = \"univer-formula-help-function-title-icon\", formulaHelpFunctionContent = \"univer-formula-help-function-content\", formulaHelpFunctionContentInner = \"univer-formula-help-function-content-inner\", formulaHelpFunctionContentParams = \"univer-formula-help-function-content-params\", formulaHelpFunctionContentParamsTitle = \"univer-formula-help-function-content-params-title\", formulaHelpFunctionContentParamsDetail = \"univer-formula-help-function-content-params-detail\", formulaHelpFunctionActive = \"univer-formula-help-function-active\", formulaHelpDecorator = \"univer-formula-help-decorator\", formulaHelpParam = \"univer-formula-help-param\", formulaHelpParamPrefix = \"univer-formula-help-param-prefix\", formulaHelpParamItem = \"univer-formula-help-param-item\", formulaHelpParamActive = \"univer-formula-help-param-active\", styles$5 = {\n  formulaHelpFunction,\n  formulaHelpFunctionTitle,\n  formulaHelpFunctionTitleIcons,\n  formulaHelpFunctionTitleIcon,\n  formulaHelpFunctionContent,\n  formulaHelpFunctionContentInner,\n  formulaHelpFunctionContentParams,\n  formulaHelpFunctionContentParamsTitle,\n  formulaHelpFunctionContentParamsDetail,\n  formulaHelpFunctionActive,\n  formulaHelpDecorator,\n  formulaHelpParam,\n  formulaHelpParamPrefix,\n  formulaHelpParamItem,\n  formulaHelpParamActive\n};\nfunction HelpFunction() {\n  const [visible, setVisible] = useState(!1), [contentVisible, setContentVisible] = useState(!0), [helpVisible, setHelpVisible] = useState(!0), [paramIndex, setParamIndex] = useState(0), [offset, setOffset] = useState([0, 0]), [decoratorPosition, setDecoratorPosition] = useState({ left: 0, top: 0 }), [functionInfo, setFunctionInfo] = useState(null), promptService = useDependency(IFormulaPromptService), localeService = useDependency(LocaleService), required = localeService.t(\"formula.prompt.required\"), optional = localeService.t(\"formula.prompt.optional\"), univerInstanceService = useDependency(IUniverInstanceService), editorService = useDependency(IEditorService), sidebarService = useDependency(ISidebarService), injector = useInjector();\n  useResizeScrollObserver(updatePosition), useEffect(() => {\n    const subscription = promptService.help$.subscribe((params) => {\n      const { visible: visible2, paramIndex: paramIndex2, functionInfo: functionInfo2 } = params;\n      if (!visible2) {\n        setVisible(visible2);\n        return;\n      }\n      const position = getPosition();\n      if (position == null)\n        return;\n      const { left, top, height } = position;\n      functionInfo2.description === \"\" && functionInfo2.functionParameter.length === 0 || (setOffset([left, top + height]), setParamIndex(paramIndex2), setFunctionInfo(functionInfo2), setDecoratorPosition({ left, top }), setVisible(visible2));\n    }), sidebarSubscription = sidebarService.scrollEvent$.pipe(throttleTime$1(100)).subscribe(updatePosition);\n    return () => {\n      subscription == null || subscription.unsubscribe(), sidebarSubscription.unsubscribe();\n    };\n  }, []);\n  function updatePosition() {\n    if (!helpVisible)\n      return;\n    const position = getPosition();\n    if (position == null)\n      return;\n    const { left, top, height } = position;\n    setOffset([left, top + height]);\n  }\n  __name(updatePosition, \"updatePosition\");\n  function getPosition() {\n    const documentDataModel = univerInstanceService.getCurrentUniverDocInstance();\n    if (!documentDataModel)\n      return;\n    const editorUnitId = documentDataModel.getUnitId();\n    if (!editorService.isEditor(editorUnitId))\n      return;\n    const editor = editorService.getEditor(editorUnitId);\n    return editor == null ? void 0 : editor.getBoundingClientRect();\n  }\n  __name(getPosition, \"getPosition\");\n  function handleSwitchActive(paramIndex2) {\n    setParamIndex(paramIndex2);\n  }\n  __name(handleSwitchActive, \"handleSwitchActive\");\n  function handleClose() {\n    setHelpVisible(!helpVisible), injector.get(ILayoutService).focus();\n  }\n  return __name(handleClose, \"handleClose\"), /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, { children: helpVisible ? /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { visible, offset, children: functionInfo ? /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpFunction, children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpFunctionTitle, children: [\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\n        Help,\n        {\n          prefix: functionInfo.functionName,\n          value: functionInfo.functionParameter,\n          active: paramIndex,\n          onClick: handleSwitchActive\n        }\n      ),\n      /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpFunctionTitleIcons, children: [\n        /* @__PURE__ */ jsxRuntimeExports.jsx(\n          \"div\",\n          {\n            className: styles$5.formulaHelpFunctionTitleIcon,\n            style: { transform: contentVisible ? \"rotateZ(-90deg)\" : \"rotateZ(90deg)\" },\n            onClick: /* @__PURE__ */ __name(() => setContentVisible(!contentVisible), \"onClick\"),\n            children: /* @__PURE__ */ jsxRuntimeExports.jsx(MoreSingle, {})\n          }\n        ),\n        /* @__PURE__ */ jsxRuntimeExports.jsx(\n          \"div\",\n          {\n            className: styles$5.formulaHelpFunctionTitleIcon,\n            onClick: handleClose,\n            children: /* @__PURE__ */ jsxRuntimeExports.jsx(CloseSingle, {})\n          }\n        )\n      ] })\n    ] }),\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\n      \"div\",\n      {\n        className: styles$5.formulaHelpFunctionContent,\n        style: {\n          height: contentVisible ? \"unset\" : 0,\n          padding: contentVisible ? \"revert-layer\" : 0\n        },\n        children: /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpFunctionContentInner, children: [\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\n            Params,\n            {\n              title: localeService.t(\"formula.prompt.helpExample\"),\n              value: `${functionInfo.functionName}(${functionInfo.functionParameter.map((item) => item.example).join(\",\")})`\n            }\n          ),\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\n            Params,\n            {\n              title: localeService.t(\"formula.prompt.helpAbstract\"),\n              value: functionInfo.description\n            }\n          ),\n          functionInfo && functionInfo.functionParameter && functionInfo.functionParameter.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(\n            Params,\n            {\n              className: paramIndex === i ? styles$5.formulaHelpFunctionActive : \"\",\n              title: item.name,\n              value: `${item.require ? required : optional} ${item.detail}`\n            },\n            i\n          ))\n        ] })\n      }\n    )\n  ] }) : /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, {}) }) : visible ? /* @__PURE__ */ jsxRuntimeExports.jsx(\n    \"div\",\n    {\n      className: styles$5.formulaHelpDecorator,\n      onClick: /* @__PURE__ */ __name(() => setHelpVisible(!helpVisible), \"onClick\"),\n      style: { left: decoratorPosition.left - 24, top: decoratorPosition.top },\n      children: /* @__PURE__ */ jsxRuntimeExports.jsx(DetailsSingle, {})\n    }\n  ) : /* @__PURE__ */ jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment, {}) });\n}\n__name(HelpFunction, \"HelpFunction\");\nconst Params = /* @__PURE__ */ __name((props) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpFunctionContentParams, children: [\n  /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: `${styles$5.formulaHelpFunctionContentParamsTitle} ${props.className}`, children: props.title }),\n  /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$5.formulaHelpFunctionContentParamsDetail, children: props.value })\n] }), \"Params\"), Help = /* @__PURE__ */ __name((props) => {\n  const { prefix, value, active, onClick } = props;\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$5.formulaHelpParam, children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\"span\", { className: styles$5.formulaHelpParamPrefix, children: [\n      prefix,\n      \"(\"\n    ] }),\n    value && value.map((item, i) => (\n      // TODO@Dushusir: more params needs to be active\n      /* @__PURE__ */ jsxRuntimeExports.jsxs(\"span\", { className: styles$5.formulaHelpParamItem, children: [\n        /* @__PURE__ */ jsxRuntimeExports.jsx(\n          \"span\",\n          {\n            className: active === i ? styles$5.formulaHelpFunctionActive : styles$5.formulaHelpParamActive,\n            onClick: /* @__PURE__ */ __name(() => onClick(i), \"onClick\"),\n            children: generateParam(item)\n          }\n        ),\n        i === value.length - 1 ? \"\" : \",\"\n      ] }, i)\n    )),\n    \")\"\n  ] });\n}, \"Help\"), formulaSearchFunction = \"univer-formula-search-function\", formulaSearchFunctionItem = \"univer-formula-search-function-item\", formulaSearchFunctionItemName = \"univer-formula-search-function-item-name\", formulaSearchFunctionItemNameLight = \"univer-formula-search-function-item-name-light\", formulaSearchFunctionItemDesc = \"univer-formula-search-function-item-desc\", formulaSearchFunctionItemActive = \"univer-formula-search-function-item-active\", styles$4 = {\n  formulaSearchFunction,\n  formulaSearchFunctionItem,\n  formulaSearchFunctionItemName,\n  formulaSearchFunctionItemNameLight,\n  formulaSearchFunctionItemDesc,\n  formulaSearchFunctionItemActive\n};\nfunction SearchFunction() {\n  const [visible, setVisible] = useState(!1), [active, setActive] = useState(0), [offset, setOffset] = useState([0, 0]), [searchList, setSearchList] = useState([]), [searchText, setSearchText] = useState(\"\"), ulRef = useRef(null), promptService = useDependency(IFormulaPromptService), univerInstanceService = useDependency(IUniverInstanceService), editorService = useDependency(IEditorService);\n  useEffect(() => {\n    let updatedSearchList = [], updatedActive = 0;\n    const subscribeSearch = promptService.search$.subscribe((params) => {\n      const { visible: visible2, searchText: searchText2, searchList: searchList2 } = params;\n      if (!visible2) {\n        setVisible(visible2);\n        return;\n      }\n      const position = getPosition();\n      if (position == null)\n        return;\n      const { left, top, height } = position;\n      setSearchText(searchText2), setSearchList(searchList2), updatedSearchList = searchList2, setOffset([left, top + height]), setVisible(visible2), setActive(0), updatedActive = 0;\n    }), subscribeNavigate = promptService.navigate$.subscribe((params) => {\n      const { direction } = params;\n      if (direction === Direction.UP) {\n        let nextActive = updatedActive - 1;\n        nextActive = nextActive < 0 ? updatedSearchList.length - 1 : nextActive, setActive(nextActive), updatedActive = nextActive;\n      } else if (direction === Direction.DOWN) {\n        let nextActive = updatedActive + 1;\n        nextActive = nextActive >= updatedSearchList.length ? 0 : nextActive, setActive(nextActive), updatedActive = nextActive;\n      }\n      scrollToVisible(updatedActive);\n    }), subscribeAccept = promptService.accept$.subscribe((params) => {\n      const functionName = updatedSearchList[updatedActive].name;\n      promptService.acceptFormulaName(functionName);\n    });\n    return () => {\n      subscribeSearch == null || subscribeSearch.unsubscribe(), subscribeNavigate == null || subscribeNavigate.unsubscribe(), subscribeAccept == null || subscribeAccept.unsubscribe();\n    };\n  }, []);\n  function getPosition() {\n    const editorUnitId = univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n    if (!editorService.isEditor(editorUnitId))\n      return;\n    const editor = editorService.getEditor(editorUnitId);\n    return editor == null ? void 0 : editor.getBoundingClientRect();\n  }\n  __name(getPosition, \"getPosition\");\n  function handleLiMouseEnter(index) {\n    setActive(index);\n  }\n  __name(handleLiMouseEnter, \"handleLiMouseEnter\");\n  function handleLiMouseLeave() {\n    setActive(-1);\n  }\n  __name(handleLiMouseLeave, \"handleLiMouseLeave\");\n  function scrollToVisible(liIndex) {\n    var _a11;\n    const liElement = (_a11 = ulRef.current) == null ? void 0 : _a11.querySelectorAll(`.${styles$4.formulaSearchFunctionItem}`)[liIndex];\n    if (!liElement) return;\n    const ulElement = liElement.parentNode;\n    if (!ulElement) return;\n    const ulTop = ulElement.getBoundingClientRect().top, ulHeight = ulElement.offsetHeight, liRect = liElement.getBoundingClientRect(), liTop = liRect.top, liHeight = liRect.height;\n    if (liTop >= 0 && liTop > ulTop && liTop - ulTop + liHeight <= ulHeight)\n      return;\n    const scrollTo = liElement.offsetTop - (ulHeight - liHeight) / 2;\n    ulElement.scrollTo({\n      top: scrollTo,\n      behavior: \"smooth\"\n    });\n  }\n  return __name(scrollToVisible, \"scrollToVisible\"), searchList.length > 0 && /* @__PURE__ */ jsxRuntimeExports.jsx(Popup, { visible, offset, children: /* @__PURE__ */ jsxRuntimeExports.jsx(\"ul\", { className: styles$4.formulaSearchFunction, ref: ulRef, children: searchList.map((item, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\n    \"li\",\n    {\n      className: active === index ? `${styles$4.formulaSearchFunctionItem} ${styles$4.formulaSearchFunctionItemActive}` : styles$4.formulaSearchFunctionItem,\n      onMouseEnter: /* @__PURE__ */ __name(() => handleLiMouseEnter(index), \"onMouseEnter\"),\n      onMouseLeave: handleLiMouseLeave,\n      onClick: /* @__PURE__ */ __name(() => promptService.acceptFormulaName(item.name), \"onClick\"),\n      children: [\n        /* @__PURE__ */ jsxRuntimeExports.jsxs(\"span\", { className: styles$4.formulaSearchFunctionItemName, children: [\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { className: styles$4.formulaSearchFunctionItemNameLight, children: item.name.substring(0, searchText.length) }),\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { children: item.name.slice(searchText.length) })\n        ] }),\n        /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { className: styles$4.formulaSearchFunctionItemDesc, children: item.desc })\n      ]\n    },\n    index\n  )) }) });\n}\n__name(SearchFunction, \"SearchFunction\");\nfunction RenderFormulaPromptContent() {\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment, { children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsx(SearchFunction, {}),\n    /* @__PURE__ */ jsxRuntimeExports.jsx(HelpFunction, {})\n  ] });\n}\n__name(RenderFormulaPromptContent, \"RenderFormulaPromptContent\");\nconst formulaMoreFunctions = \"univer-formula-more-functions\", formulaMoreFunctionsOperation = \"univer-formula-more-functions-operation\", styles$3 = {\n  formulaMoreFunctions,\n  formulaMoreFunctionsOperation\n};\nfunction FunctionHelp(props) {\n  const { prefix, value } = props;\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\"span\", { children: [\n      prefix,\n      \"(\"\n    ] }),\n    value && value.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\"span\", { children: [\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { children: generateParam(item) }),\n      i === value.length - 1 ? \"\" : \",\"\n    ] }, i)),\n    \")\"\n  ] });\n}\n__name(FunctionHelp, \"FunctionHelp\");\nconst formulaFunctionParams = \"univer-formula-function-params\", formulaFunctionParamsTitle = \"univer-formula-function-params-title\", formulaFunctionParamsDetail = \"univer-formula-function-params-detail\", styles$2 = {\n  formulaFunctionParams,\n  formulaFunctionParamsTitle,\n  formulaFunctionParamsDetail\n};\nfunction FunctionParams(props) {\n  const { className, value, title } = props;\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$2.formulaFunctionParams, children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: `${styles$2.formulaFunctionParamsTitle} ${className}`, children: title }),\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$2.formulaFunctionParamsDetail, children: value })\n  ] });\n}\n__name(FunctionParams, \"FunctionParams\");\nconst formulaInputParamsList = \"univer-formula-input-params-list\", formulaInputParamsListItemName = \"univer-formula-input-params-list-item-name\", formulaInputParamsListItemSelector = \"univer-formula-input-params-list-item-selector\", styles$1 = {\n  formulaInputParamsList,\n  formulaInputParamsListItemName,\n  formulaInputParamsListItemSelector\n};\nfunction InputParams(props) {\n  const { functionInfo, onChange } = props;\n  if (!functionInfo) return null;\n  useState([]);\n  const [functionParameter, setFunctionParameter] = useState(functionInfo.functionParameter), [activeIndex, setActiveIndex] = useState(-1);\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$1.formulaInputParams, children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$1.formulaInputParamsList, children: functionParameter.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { children: [\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$1.formulaInputParamsListItemName, children: item.name }),\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$1.formulaInputParamsListItemSelector })\n    ] }, i)) }),\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\"div\", { className: styles$1.formulaInputParamsInfo, children: /* @__PURE__ */ jsxRuntimeExports.jsx(\n      FunctionParams,\n      {\n        title: activeIndex === -1 ? /* @__PURE__ */ jsxRuntimeExports.jsx(FunctionHelp, { prefix: functionInfo.functionName, value: functionParameter }) : functionParameter[activeIndex].name,\n        value: activeIndex === -1 ? functionInfo.description : functionParameter[activeIndex].detail\n      }\n    ) })\n  ] });\n}\n__name(InputParams, \"InputParams\");\nconst formulaSelectFunctionSelect = \"univer-formula-select-function-select\", formulaSelectFunctionResult = \"univer-formula-select-function-result\", formulaSelectFunctionResultItem = \"univer-formula-select-function-result-item\", formulaSelectFunctionResultItemNameLight = \"univer-formula-select-function-result-item-name-light\", formulaSelectFunctionResultItemSelected = \"univer-formula-select-function-result-item-selected\", formulaSelectFunctionResultItemActive = \"univer-formula-select-function-result-item-active\", formulaSelectFunctionContent = \"univer-formula-select-function-content\", styles = {\n  formulaSelectFunctionSelect,\n  formulaSelectFunctionResult,\n  formulaSelectFunctionResultItem,\n  formulaSelectFunctionResultItemNameLight,\n  formulaSelectFunctionResultItemSelected,\n  formulaSelectFunctionResultItemActive,\n  formulaSelectFunctionContent\n};\nfunction SelectFunction(props) {\n  const { onChange } = props, allTypeValue = \"-1\", [searchText, setSearchText] = useState(\"\"), [selectList, setSelectList] = useState([]), [active, setActive] = useState(0), [typeSelected, setTypeSelected] = useState(allTypeValue), [nameSelected, setNameSelected] = useState(0), [functionInfo, setFunctionInfo] = useState(null), descriptionService = useDependency(IDescriptionService), localeService = useDependency(LocaleService), sidebarService = useDependency(ISidebarService), sidebarOptions = useObservable(sidebarService.sidebarOptions$), options = getFunctionTypeValues(FunctionType, localeService);\n  options.unshift({\n    label: localeService.t(\"formula.moreFunctions.allFunctions\"),\n    value: allTypeValue\n  });\n  const required = localeService.t(\"formula.prompt.required\"), optional = localeService.t(\"formula.prompt.optional\");\n  useEffect(() => {\n    handleSelectChange(allTypeValue);\n  }, []), useEffect(() => {\n    setCurrentFunctionInfo(0);\n  }, [selectList]), useEffect(() => {\n    sidebarOptions != null && sidebarOptions.visible && (setSearchText(\"\"), setSelectList([]), setActive(0), setTypeSelected(allTypeValue), setNameSelected(0), setFunctionInfo(null), handleSelectChange(allTypeValue));\n  }, [sidebarOptions]);\n  const highlightSearchText = /* @__PURE__ */ __name((text) => {\n    if (searchText.trim() === \"\") return text;\n    const regex = new RegExp(`(${searchText.toLocaleUpperCase()})`);\n    return text.split(regex).filter(Boolean).map((part, index) => part.match(regex) ? /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { className: styles.formulaSelectFunctionResultItemNameLight, children: part }, index) : part);\n  }, \"highlightSearchText\"), setCurrentFunctionInfo = /* @__PURE__ */ __name((selectedIndex) => {\n    if (selectList.length === 0) {\n      setFunctionInfo(null);\n      return;\n    }\n    setNameSelected(selectedIndex);\n    const functionInfo2 = descriptionService.getFunctionInfo(selectList[selectedIndex].name);\n    if (!functionInfo2) {\n      setFunctionInfo(null);\n      return;\n    }\n    setFunctionInfo(functionInfo2), onChange(functionInfo2);\n  }, \"setCurrentFunctionInfo\");\n  function handleSelectChange(value) {\n    setTypeSelected(value);\n    const selectList2 = descriptionService.getSearchListByType(+value);\n    setSelectList(selectList2);\n  }\n  __name(handleSelectChange, \"handleSelectChange\");\n  function handleSearchInputChange(value) {\n    setSearchText(value);\n    const selectList2 = descriptionService.getSearchListByName(value);\n    setSelectList(selectList2);\n  }\n  __name(handleSearchInputChange, \"handleSearchInputChange\");\n  function handleSelectListKeyDown(e) {\n    if (e.stopPropagation(), e.key === \"ArrowDown\") {\n      const nextActive = active + 1;\n      setActive(nextActive === selectList.length ? 0 : nextActive);\n    } else if (e.key === \"ArrowUp\") {\n      const nextActive = active - 1;\n      setActive(nextActive === -1 ? selectList.length - 1 : nextActive);\n    } else e.key === \"Enter\" && setCurrentFunctionInfo(active);\n  }\n  __name(handleSelectListKeyDown, \"handleSelectListKeyDown\");\n  const handleLiMouseEnter = /* @__PURE__ */ __name((index) => {\n    setActive(index);\n  }, \"handleLiMouseEnter\"), handleLiMouseLeave = /* @__PURE__ */ __name(() => {\n    setActive(-1);\n  }, \"handleLiMouseLeave\");\n  return /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { children: [\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles.formulaSelectFunctionSelect, children: [\n      /* @__PURE__ */ jsxRuntimeExports.jsx(Select, { value: typeSelected, options, onChange: handleSelectChange }),\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\n        Input,\n        {\n          placeholder: localeService.t(\"formula.moreFunctions.searchFunctionPlaceholder\"),\n          onKeyDown: handleSelectListKeyDown,\n          value: searchText,\n          onChange: handleSearchInputChange,\n          size: \"large\",\n          allowClear: !0\n        }\n      )\n    ] }),\n    /* @__PURE__ */ jsxRuntimeExports.jsx(\"ul\", { className: styles.formulaSelectFunctionResult, onKeyDown: handleSelectListKeyDown, tabIndex: -1, children: selectList.map(({ name }, index) => /* @__PURE__ */ jsxRuntimeExports.jsxs(\n      \"li\",\n      {\n        className: active === index ? `${styles.formulaSelectFunctionResultItem} ${styles.formulaSelectFunctionResultItemActive}` : styles.formulaSelectFunctionResultItem,\n        onMouseEnter: /* @__PURE__ */ __name(() => handleLiMouseEnter(index), \"onMouseEnter\"),\n        onMouseLeave: handleLiMouseLeave,\n        onClick: /* @__PURE__ */ __name(() => setCurrentFunctionInfo(index), \"onClick\"),\n        children: [\n          nameSelected === index && /* @__PURE__ */ jsxRuntimeExports.jsx(CheckMarkSingle, { className: styles.formulaSelectFunctionResultItemSelected }),\n          /* @__PURE__ */ jsxRuntimeExports.jsx(\"span\", { className: styles.formulaSelectFunctionResultItemName, children: highlightSearchText(name) })\n        ]\n      },\n      index\n    )) }),\n    functionInfo && /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles.formulaSelectFunctionContent, children: [\n      /* @__PURE__ */ jsxRuntimeExports.jsx(FunctionParams, { title: functionInfo.functionName, value: functionInfo.description }),\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\n        FunctionParams,\n        {\n          title: localeService.t(\"formula.moreFunctions.syntax\"),\n          value: /* @__PURE__ */ jsxRuntimeExports.jsx(FunctionHelp, { prefix: functionInfo.functionName, value: functionInfo.functionParameter })\n        }\n      ),\n      /* @__PURE__ */ jsxRuntimeExports.jsx(\n        FunctionParams,\n        {\n          title: localeService.t(\"formula.prompt.helpExample\"),\n          value: `${functionInfo.functionName}(${functionInfo.functionParameter.map((item) => item.example).join(\",\")})`\n        }\n      ),\n      functionInfo.functionParameter && functionInfo.functionParameter.map((item, i) => /* @__PURE__ */ jsxRuntimeExports.jsx(\n        FunctionParams,\n        {\n          title: item.name,\n          value: `${item.require ? required : optional} ${item.detail}`\n        },\n        i\n      ))\n    ] })\n  ] });\n}\n__name(SelectFunction, \"SelectFunction\");\nfunction MoreFunctions() {\n  const workbook = useActiveWorkbook(), [selectFunction, setSelectFunction] = useState(!0), [inputParams, setInputParams] = useState(!1), [functionInfo, setFunctionInfo] = useState(null), localeService = useDependency(LocaleService), editorService = useDependency(IEditorService);\n  function handleClickNextPrev() {\n    setSelectFunction(!selectFunction), setInputParams(!inputParams);\n  }\n  __name(handleClickNextPrev, \"handleClickNextPrev\");\n  function handleConfirm() {\n    editorService.setFormula(`=${functionInfo == null ? void 0 : functionInfo.functionName}(`);\n  }\n  return __name(handleConfirm, \"handleConfirm\"), /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$3.formulaMoreFunctions, children: [\n    selectFunction && /* @__PURE__ */ jsxRuntimeExports.jsx(SelectFunction, { onChange: setFunctionInfo }),\n    inputParams && /* @__PURE__ */ jsxRuntimeExports.jsx(InputParams, { functionInfo, onChange: /* @__PURE__ */ __name(() => {\n    }, \"onChange\") }),\n    /* @__PURE__ */ jsxRuntimeExports.jsxs(\"div\", { className: styles$3.formulaMoreFunctionsOperation, children: [\n      inputParams && /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: \"primary\", size: \"small\", onClick: handleClickNextPrev, children: localeService.t(\"formula.moreFunctions.next\") }),\n      inputParams && /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { size: \"small\", onClick: handleClickNextPrev, children: localeService.t(\"formula.moreFunctions.prev\") }),\n      selectFunction && !!workbook && /* @__PURE__ */ jsxRuntimeExports.jsx(Button, { type: \"primary\", size: \"small\", onClick: handleConfirm, children: localeService.t(\"formula.moreFunctions.confirm\") })\n    ] })\n  ] });\n}\n__name(MoreFunctions, \"MoreFunctions\");\nfunction InsertFunctionMenuItemFactory(accessor) {\n  return {\n    id: InsertFunctionOperation.id,\n    icon: \"FunctionSingle\",\n    tooltip: \"formula.insert.tooltip\",\n    type: MenuItemType.SELECTOR,\n    selections: [\n      {\n        label: \"SUM\",\n        value: \"SUM\",\n        icon: \"SumSingle\"\n      },\n      {\n        label: \"AVERAGE\",\n        value: \"AVERAGE\",\n        icon: \"AvgSingle\"\n      },\n      {\n        label: \"COUNT\",\n        value: \"COUNT\",\n        icon: \"CntSingle\"\n      },\n      {\n        label: \"MAX\",\n        value: \"MAX\",\n        icon: \"MaxSingle\"\n      },\n      {\n        label: \"MIN\",\n        value: \"MIN\",\n        icon: \"MinSingle\"\n      }\n    ],\n    hidden$: getMenuHiddenObservable(accessor, UniverInstanceType.UNIVER_SHEET),\n    disabled$: getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], worksheetTypes: [WorksheetEditPermission, WorksheetSetCellValuePermission], rangeTypes: [RangeProtectionPermissionEditPoint] })\n  };\n}\n__name(InsertFunctionMenuItemFactory, \"InsertFunctionMenuItemFactory\");\nfunction MoreFunctionsMenuItemFactory(accessor) {\n  return {\n    id: MoreFunctionsOperation.id,\n    title: \"formula.insert.more\",\n    type: MenuItemType.BUTTON\n  };\n}\n__name(MoreFunctionsMenuItemFactory, \"MoreFunctionsMenuItemFactory\");\nfunction menuClipboardDisabledObservable(injector) {\n  return injector.get(IUniverInstanceService).getCurrentTypeOfUnit$(UniverInstanceType.UNIVER_SHEET).pipe(\n    switchMap((workbook) => workbook ? injector.get(IClipboardInterfaceService) ? new Observable((subscriber) => subscriber.next(!injector.get(IClipboardInterfaceService).supportClipboard)) : of(!0) : of(!0))\n  );\n}\n__name(menuClipboardDisabledObservable, \"menuClipboardDisabledObservable\");\nfunction PasteFormulaMenuItemFactory(accessor) {\n  return {\n    id: SheetOnlyPasteFormulaCommand.id,\n    type: MenuItemType.BUTTON,\n    title: \"formula.operation.pasteFormula\",\n    disabled$: menuClipboardDisabledObservable(accessor).pipe(\n      combineLatestWith(getCurrentRangeDisable$(accessor, { workbookTypes: [WorkbookEditablePermission], rangeTypes: [RangeProtectionPermissionEditPoint], worksheetTypes: [WorksheetSetCellValuePermission, WorksheetEditPermission] })),\n      map(([d1, d2]) => d1 || d2)\n    )\n  };\n}\n__name(PasteFormulaMenuItemFactory, \"PasteFormulaMenuItemFactory\");\nconst menuSchema = {\n  [RibbonStartGroup.FORMULAS_INSERT]: {\n    [InsertFunctionOperation.id]: {\n      order: 1,\n      menuItemFactory: InsertFunctionMenuItemFactory,\n      [MoreFunctionsOperation.id]: {\n        order: 1,\n        menuItemFactory: MoreFunctionsMenuItemFactory\n      }\n    }\n  },\n  [PASTE_SPECIAL_MENU_ID]: {\n    [SheetOnlyPasteFormulaCommand.id]: {\n      order: 4,\n      menuItemFactory: PasteFormulaMenuItemFactory\n    }\n  }\n}, META_KEY_CTRL_AND_SHIFT = \"meta_key_ctrl_And_Shift\", PROMPT_SELECTION_KEYCODE_ARROW_LIST = [\n  KeyCode.ARROW_DOWN,\n  KeyCode.ARROW_UP,\n  KeyCode.ARROW_LEFT,\n  KeyCode.ARROW_RIGHT\n], PROMPT_SELECTION_KEYCODE_LIST = [...PROMPT_SELECTION_KEYCODE_ARROW_LIST, KeyCode.ENTER, KeyCode.TAB, KeyCode.ESC];\nfunction promptSelectionShortcutItem() {\n  const shortcutList = [];\n  for (const keycode of PROMPT_SELECTION_KEYCODE_LIST)\n    shortcutList.push({\n      id: SelectEditorFormulaOperation.id,\n      binding: keycode,\n      preconditions: /* @__PURE__ */ __name((contextService) => whenFormulaEditorActivated(contextService), \"preconditions\"),\n      staticParameters: {\n        eventType: DeviceInputEventType.Keyboard,\n        keycode\n      }\n    });\n  return shortcutList;\n}\n__name(promptSelectionShortcutItem, \"promptSelectionShortcutItem\");\nfunction promptSelectionShortcutItemShift() {\n  const shortcutList = [];\n  for (const keycode of PROMPT_SELECTION_KEYCODE_ARROW_LIST)\n    shortcutList.push({\n      id: SelectEditorFormulaOperation.id,\n      binding: keycode | MetaKeys.SHIFT,\n      preconditions: /* @__PURE__ */ __name((contextService) => whenFormulaEditorActivated(contextService), \"preconditions\"),\n      staticParameters: {\n        eventType: DeviceInputEventType.Keyboard,\n        keycode,\n        metaKey: MetaKeys.SHIFT\n      }\n    });\n  return shortcutList;\n}\n__name(promptSelectionShortcutItemShift, \"promptSelectionShortcutItemShift\");\nfunction promptSelectionShortcutItemCtrl() {\n  const shortcutList = [];\n  for (const keycode of PROMPT_SELECTION_KEYCODE_ARROW_LIST)\n    shortcutList.push({\n      id: SelectEditorFormulaOperation.id,\n      binding: keycode | MetaKeys.CTRL_COMMAND,\n      preconditions: /* @__PURE__ */ __name((contextService) => whenFormulaEditorActivated(contextService), \"preconditions\"),\n      staticParameters: {\n        eventType: DeviceInputEventType.Keyboard,\n        keycode,\n        metaKey: MetaKeys.CTRL_COMMAND\n      }\n    });\n  return shortcutList;\n}\n__name(promptSelectionShortcutItemCtrl, \"promptSelectionShortcutItemCtrl\");\nfunction promptSelectionShortcutItemCtrlAndShift() {\n  const shortcutList = [];\n  for (const keycode of PROMPT_SELECTION_KEYCODE_ARROW_LIST)\n    shortcutList.push({\n      id: SelectEditorFormulaOperation.id,\n      binding: keycode | MetaKeys.SHIFT | MetaKeys.CTRL_COMMAND,\n      preconditions: /* @__PURE__ */ __name((contextService) => whenFormulaEditorActivated(contextService), \"preconditions\"),\n      staticParameters: {\n        eventType: DeviceInputEventType.Keyboard,\n        keycode,\n        metaKey: META_KEY_CTRL_AND_SHIFT\n      }\n    });\n  return shortcutList;\n}\n__name(promptSelectionShortcutItemCtrlAndShift, \"promptSelectionShortcutItemCtrlAndShift\");\nconst ChangeRefToAbsoluteShortcut = {\n  id: ReferenceAbsoluteOperation.id,\n  binding: KeyCode.F4,\n  preconditions: /* @__PURE__ */ __name((contextService) => whenFormulaEditorActivated(contextService), \"preconditions\")\n};\nfunction singleEditorPromptSelectionShortcutItem() {\n  const shortcutList = [];\n  for (const keycode of [KeyCode.ENTER, KeyCode.TAB, KeyCode.ARROW_DOWN, KeyCode.ARROW_UP])\n    shortcutList.push({\n      id: SelectEditorFormulaOperation.id,\n      binding: keycode,\n      preconditions: /* @__PURE__ */ __name((contextService) => whenEditorStandalone(contextService), \"preconditions\"),\n      staticParameters: {\n        eventType: DeviceInputEventType.Keyboard,\n        keycode,\n        isSingleEditor: !0\n      }\n    });\n  return shortcutList;\n}\n__name(singleEditorPromptSelectionShortcutItem, \"singleEditorPromptSelectionShortcutItem\");\nvar __defProp$2 = Object.defineProperty, __getOwnPropDesc$2 = Object.getOwnPropertyDescriptor, __decorateClass$2 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$2(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$2(target, key, result), result;\n}, \"__decorateClass$2\"), __decorateParam$2 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$2\"), _a8;\nlet FormulaUIController = (_a8 = class extends Disposable {\n  constructor(_injector, _menuManagerService, _commandService, _shortcutService, _uiPartsService, _renderManagerService, _componentManager) {\n    super(), this._injector = _injector, this._menuManagerService = _menuManagerService, this._commandService = _commandService, this._shortcutService = _shortcutService, this._uiPartsService = _uiPartsService, this._renderManagerService = _renderManagerService, this._componentManager = _componentManager, this._initialize();\n  }\n  _initialize() {\n    this._registerCommands(), this._registerMenus(), this._registerShortcuts(), this._registerComponents(), this._registerRenderModules();\n  }\n  _registerMenus() {\n    this._menuManagerService.mergeMenu(menuSchema);\n  }\n  _registerCommands() {\n    [\n      SheetOnlyPasteFormulaCommand,\n      InsertFunctionOperation,\n      MoreFunctionsOperation,\n      SearchFunctionOperation,\n      HelpFunctionOperation,\n      SelectEditorFormulaOperation,\n      ReferenceAbsoluteOperation\n    ].forEach((command) => this.disposeWithMe(this._commandService.registerCommand(command)));\n  }\n  _registerShortcuts() {\n    [\n      ...promptSelectionShortcutItem(),\n      ...promptSelectionShortcutItemShift(),\n      ...promptSelectionShortcutItemCtrl(),\n      ...promptSelectionShortcutItemCtrlAndShift(),\n      ...singleEditorPromptSelectionShortcutItem(),\n      ChangeRefToAbsoluteShortcut\n    ].forEach((item) => {\n      this.disposeWithMe(this._shortcutService.registerShortcut(item));\n    });\n  }\n  _registerComponents() {\n    this.disposeWithMe(this._uiPartsService.registerComponent(BuiltInUIPart.CONTENT, () => connectInjector(RenderFormulaPromptContent, this._injector))), this.disposeWithMe(this._uiPartsService.registerComponent(SheetsUIPart.FORMULA_AUX, () => connectInjector(FormulaProgressBar, this._injector))), this._componentManager.register(MORE_FUNCTIONS_COMPONENT, MoreFunctions);\n  }\n  _registerRenderModules() {\n    this.disposeWithMe(this._renderManagerService.registerRenderModule(UniverInstanceType.UNIVER_SHEET, [FormulaEditorShowController]));\n  }\n}, __name(_a8, \"FormulaUIController\"), _a8);\nFormulaUIController = __decorateClass$2([\n  __decorateParam$2(0, Inject(Injector)),\n  __decorateParam$2(1, IMenuManagerService),\n  __decorateParam$2(2, ICommandService),\n  __decorateParam$2(3, IShortcutService),\n  __decorateParam$2(4, IUIPartsService),\n  __decorateParam$2(5, IRenderManagerService),\n  __decorateParam$2(6, Inject(ComponentManager))\n], FormulaUIController);\nfunction getFormulaRefSelectionStyle(themeService, refColor, id) {\n  const style = themeService.getCurrentTheme(), fill = new ColorKit(refColor).setAlpha(0.05).toRgbString();\n  return {\n    id,\n    strokeWidth: 1,\n    stroke: refColor,\n    fill,\n    widgets: { tl: !0, tc: !0, tr: !0, ml: !0, mr: !0, bl: !0, bc: !0, br: !0 },\n    widgetSize: 6,\n    widgetStrokeWidth: 1,\n    widgetStroke: style.colorWhite,\n    hasAutoFill: !1,\n    hasRowHeader: !1,\n    hasColumnHeader: !1\n  };\n}\n__name(getFormulaRefSelectionStyle, \"getFormulaRefSelectionStyle\");\nvar __defProp$1 = Object.defineProperty, __getOwnPropDesc$1 = Object.getOwnPropertyDescriptor, __decorateClass$1 = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc$1(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp$1(target, key, result), result;\n}, \"__decorateClass$1\"), __decorateParam$1 = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam$1\");\nconst sheetEditorUnitIds = [DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY, DOCS_NORMAL_EDITOR_UNIT_ID_KEY];\nvar _a9;\nlet PromptController = (_a9 = class extends Disposable {\n  constructor(_commandService, _contextService, _editorBridgeService, _formulaPromptService, _lexerTreeBuilder, _renderManagerService, _themeService, _sheetsSelectionsService, _refSelectionsService, _univerInstanceService, _descriptionService, _docSelectionManagerService, _contextMenuService, _editorService, _layoutService) {\n    super();\n    __publicField(this, \"_listenInputCache\", /* @__PURE__ */ new Set());\n    __publicField(this, \"_formulaRefColors\", []);\n    __publicField(this, \"_previousSequenceNodes\");\n    __publicField(this, \"_previousRangesCount\", 0);\n    __publicField(this, \"_previousInsertRefStringIndex\");\n    __publicField(this, \"_currentInsertRefStringIndex\", -1);\n    __publicField(this, \"_arrowMoveActionState\", 0);\n    __publicField(this, \"_isSelectionMovingRefSelections\", []);\n    __publicField(this, \"_stringColor\", \"\");\n    __publicField(this, \"_numberColor\", \"\");\n    __publicField(this, \"_insertSelections\", []);\n    __publicField(this, \"_inputPanelState\", 0);\n    __publicField(this, \"_userCursorMove\", !1);\n    __publicField(this, \"_previousEditorUnitId\");\n    __publicField(this, \"_existsSequenceNode\", !1);\n    __publicField(this, \"_currentlyWorkingRefRenderer\", null);\n    __publicField(this, \"_selectionsChangeDisposables\");\n    __publicField(this, \"_isSelectingMode\", !1);\n    this._commandService = _commandService, this._contextService = _contextService, this._editorBridgeService = _editorBridgeService, this._formulaPromptService = _formulaPromptService, this._lexerTreeBuilder = _lexerTreeBuilder, this._renderManagerService = _renderManagerService, this._themeService = _themeService, this._sheetsSelectionsService = _sheetsSelectionsService, this._refSelectionsService = _refSelectionsService, this._univerInstanceService = _univerInstanceService, this._descriptionService = _descriptionService, this._docSelectionManagerService = _docSelectionManagerService, this._contextMenuService = _contextMenuService, this._editorService = _editorService, this._layoutService = _layoutService, this._initialize();\n  }\n  // TODO@wzhudev: selection render service would be a render unit, we we cannot\n  // easily access it here.\n  get _selectionRenderService() {\n    return this._renderManagerService.getRenderById(\n      this._univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_SHEET).getUnitId()\n    ).with(RefSelectionsRenderService);\n  }\n  /**\n   * For multiple sheet instances.\n   */\n  get _allSelectionRenderServices() {\n    return this._renderManagerService.getAllRenderersOfType(UniverInstanceType.UNIVER_SHEET).map((renderer) => renderer.with(RefSelectionsRenderService));\n  }\n  dispose() {\n    this._formulaRefColors = [], this._resetTemp();\n  }\n  _resetTemp() {\n    this._previousSequenceNodes = null, this._previousInsertRefStringIndex = null, this._isSelectionMovingRefSelections = [], this._previousRangesCount = 0, this._currentInsertRefStringIndex = -1;\n  }\n  _initialize() {\n    this._initialCursorSync(), this._initAcceptFormula(), this._initialFormulaTheme(), this._initSelectionsEndListener(), this._closeRangePromptWhenEditorInvisible(), this._initialEditorInputChange(), this._commandExecutedListener(), this._cursorStateListener(), this._inputFormulaListener(), this._userMouseListener(), this._initialChangeEditor();\n  }\n  _initialFormulaTheme() {\n    const style = this._themeService.getCurrentTheme();\n    this._formulaRefColors = [\n      style.loopColor1,\n      style.loopColor2,\n      style.loopColor3,\n      style.loopColor4,\n      style.loopColor5,\n      style.loopColor6,\n      style.loopColor7,\n      style.loopColor8,\n      style.loopColor9,\n      style.loopColor10,\n      style.loopColor11,\n      style.loopColor12\n    ], this._numberColor = style.hyacinth700, this._stringColor = style.verdancy800;\n  }\n  _initialCursorSync() {\n    this.disposeWithMe(\n      this._docSelectionManagerService.textSelection$.pipe(\n        filter((item) => !isRangeSelector(item.unitId))\n      ).subscribe((params) => {\n        var _a11;\n        if ((params == null ? void 0 : params.unitId) == null)\n          return;\n        const editor = this._editorService.getEditor(params.unitId);\n        if (!editor || editor.onlyInputContent() || editor.isSheetEditor() && !this._isFormulaEditorActivated() || editor.params.scrollBar)\n          return;\n        const onlyInputRange = editor.onlyInputRange();\n        (_a11 = params == null ? void 0 : params.options) != null && _a11.fromSelection || (this._quitSelectingMode(), this._contextSwitch(), this._checkShouldEnterSelectingMode(onlyInputRange), !this._formulaPromptService.isLockedSelectionChange() && (this._highlightFormula(), !onlyInputRange && this._changeFunctionPanelState()));\n      })\n    );\n  }\n  _initialEditorInputChange() {\n    const arrows = [KeyCode.ARROW_DOWN, KeyCode.ARROW_UP, KeyCode.ARROW_LEFT, KeyCode.ARROW_RIGHT, KeyCode.CTRL, KeyCode.SHIFT];\n    this._univerInstanceService.getCurrentTypeOfUnit$(UniverInstanceType.UNIVER_DOC).subscribe((documentDataModel) => {\n      var _a11;\n      const unitId = documentDataModel == null ? void 0 : documentDataModel.getUnitId();\n      if (unitId == null || isRangeSelector(unitId) || this._listenInputCache.has(unitId) || this._editorService.getEditor(unitId) == null)\n        return;\n      const docSelectionRenderService = (_a11 = this._renderManagerService.getRenderById(unitId)) == null ? void 0 : _a11.with(DocSelectionRenderService);\n      docSelectionRenderService && this.disposeWithMe(\n        docSelectionRenderService.onInputBefore$.subscribe((param) => {\n          this._previousSequenceNodes = null, this._previousInsertRefStringIndex = null, this._selectionRenderService.setSkipLastEnabled(!0);\n          const event = param == null ? void 0 : param.event;\n          event && (arrows.includes(event.which) ? this._inputPanelState = 2 : (this._arrowMoveActionState !== 1 && (this._arrowMoveActionState = 2), this._inputPanelState = 1), event.which !== KeyCode.F4 && (this._userCursorMove = !1));\n        })\n      ), this._listenInputCache.add(unitId);\n    });\n  }\n  _closeRangePromptWhenEditorInvisible() {\n    this.disposeWithMe(\n      this._editorBridgeService.afterVisible$.pipe(distinctUntilKeyChanged(\"visible\")).subscribe((visibleParam) => {\n        visibleParam.visible || this._closeRangePrompt();\n      })\n    ), this.disposeWithMe(this._contextService.subscribeContextValue$(FORMULA_EDITOR_ACTIVATED).pipe(distinctUntilChanged()).subscribe((activated) => {\n      activated || this._closeRangePrompt();\n    }));\n  }\n  _initialChangeEditor() {\n    this.disposeWithMe(\n      this._univerInstanceService.getCurrentTypeOfUnit$(UniverInstanceType.UNIVER_DOC).subscribe((documentDataModel) => {\n        if (documentDataModel == null)\n          return;\n        const editorId = documentDataModel.getUnitId();\n        isRangeSelector(editorId) || !this._editorService.isEditor(editorId) || this._previousEditorUnitId === editorId || this._editorService.isSheetEditor(editorId) || (this._closeRangePrompt(editorId), this._previousEditorUnitId = editorId);\n      })\n    ), this.disposeWithMe(\n      this._editorService.closeRangePrompt$.subscribe(() => {\n        (!this._editorService.getSpreadsheetFocusState() || !this._formulaPromptService.isLockedSelectionInsert()) && this._closeRangePrompt();\n      })\n    );\n  }\n  _closeRangePrompt(editorId) {\n    this._insertSelections = [], this._refSelectionsService.clear(), editorId && this._editorService.isSheetEditor(editorId) && this._updateEditorModel(`\\r\n`, []), this._contextService.setContextValue(FOCUSING_EDITOR_INPUT_FORMULA, !1), this._contextService.setContextValue(DISABLE_NORMAL_SELECTIONS, !1), this._contextService.setContextValue(UNI_DISABLE_CHANGING_FOCUS_KEY, !1), this._quitSelectingMode(), this._resetTemp(), this._hideFunctionPanel();\n  }\n  _initSelectionsEndListener() {\n    const d = new DisposableCollection();\n    this.disposeWithMe(this._refSelectionsService.selectionMoveEnd$.subscribe((selections) => {\n      if (d.dispose(), selections.length === 0) return;\n      this._allSelectionRenderServices.map((s) => s.getSelectionControls()).flat().forEach((c) => {\n        c.disableHelperSelection(), d.add(c.selectionMoving$.subscribe((toRange) => this._onSelectionControlChange(toRange, c))), d.add(c.selectionScaling$.subscribe((toRange) => this._onSelectionControlChange(toRange, c))), d.add(c.selectionMoved$.subscribe(() => this._formulaPromptService.disableLockedSelectionChange())), d.add(c.selectionScaled$.subscribe(() => this._formulaPromptService.disableLockedSelectionChange()));\n      });\n    }));\n  }\n  /**\n   * For interaction with mouse & keyboard shortcuts on spreadsheet. Not in formula editor.\n   */\n  _updateSelecting(selectionsWithStyles, performInsertion = !1) {\n    if (selectionsWithStyles.length !== 0 && !(this._editorService.selectionChangingState() && !this._formulaPromptService.isLockedSelectionInsert()) && (this._insertControlSelections(selectionsWithStyles), performInsertion)) {\n      const currentSelection = selectionsWithStyles[selectionsWithStyles.length - 1];\n      this._insertControlSelectionReplace(currentSelection);\n    }\n  }\n  _enableRefSelectionsRenderService() {\n    const d = this._selectionsChangeDisposables = new DisposableCollection();\n    this._allSelectionRenderServices.forEach((renderer) => {\n      d.add(renderer.enableSelectionChanging()), d.add(renderer.selectionMoving$.subscribe((selections) => {\n        this._updateSelecting(selections.map((s) => convertSelectionDataToRange(s)));\n      })), d.add(renderer.selectionMoveStart$.subscribe((selections) => {\n        const performInsertion = this._checkClearingLastSelection(renderer);\n        this._currentlyWorkingRefRenderer = renderer, this._updateSelecting(selections.map((s) => convertSelectionDataToRange(s)), performInsertion);\n      }));\n    });\n  }\n  _checkClearingLastSelection(renderer) {\n    return this._currentlyWorkingRefRenderer && this._currentlyWorkingRefRenderer !== renderer ? (this._currentlyWorkingRefRenderer.clearLastSelection(), !1) : !0;\n  }\n  _disposeSelectionsChangeListeners() {\n    var _a11;\n    (_a11 = this._selectionsChangeDisposables) == null || _a11.dispose(), this._selectionsChangeDisposables = null;\n  }\n  _insertControlSelections(selections) {\n    const currentSelection = selections[selections.length - 1];\n    if (this._resetSequenceNodes(selections.length), (selections.length === this._previousRangesCount || this._previousRangesCount === 0) && this._previousSequenceNodes != null)\n      this._insertControlSelectionReplace(currentSelection);\n    else {\n      let insertNodes = this._formulaPromptService.getSequenceNodes();\n      const char = this._getCurrentChar();\n      insertNodes.length === 0 && this._currentInsertRefStringIndex > 0 && (this._currentInsertRefStringIndex = -1), this._previousInsertRefStringIndex = this._currentInsertRefStringIndex, !matchRefDrawToken(char) && this._focusIsOnlyRange(selections.length) && (this._formulaPromptService.insertSequenceString(this._currentInsertRefStringIndex, matchToken.COMMA), insertNodes = this._formulaPromptService.getSequenceNodes(), this._previousInsertRefStringIndex += 1), this._previousSequenceNodes = Tools.deepClone(insertNodes), this._formulaPromptService.setSequenceNodes(insertNodes);\n      const refString = this._generateRefString(currentSelection);\n      this._formulaPromptService.insertSequenceRef(this._previousInsertRefStringIndex, refString), this._selectionRenderService.setSkipLastEnabled(!1);\n    }\n    this._arrowMoveActionState = 2, this._previousRangesCount = selections.length;\n  }\n  _initAcceptFormula() {\n    this.disposeWithMe(\n      this._formulaPromptService.acceptFormulaName$.subscribe((formulaString) => {\n        const activeRange = this._docSelectionManagerService.getActiveTextRange();\n        if (activeRange == null) {\n          this._hideFunctionPanel();\n          return;\n        }\n        const { startOffset } = activeRange, lastSequenceNodes = this._formulaPromptService.getSequenceNodes(), nodeIndex = this._formulaPromptService.getCurrentSequenceNodeIndex(startOffset - 2), node = lastSequenceNodes[nodeIndex];\n        if (node == null || typeof node == \"string\") {\n          this._hideFunctionPanel();\n          return;\n        }\n        const difference = formulaString.length - node.token.length, newNode = { ...node };\n        newNode.token = formulaString, newNode.endIndex += difference, lastSequenceNodes[nodeIndex] = newNode;\n        const isDefinedName = this._descriptionService.hasDefinedNameDescription(formulaString), isFormulaDefinedName = this._descriptionService.isFormulaDefinedName(formulaString), formulaStringCount = formulaString.length + 1, mustAddBracket = !isDefinedName || isFormulaDefinedName;\n        mustAddBracket && lastSequenceNodes.splice(nodeIndex + 1, 0, matchToken.OPEN_BRACKET);\n        for (let i = nodeIndex + 2, len = lastSequenceNodes.length; i < len; i++) {\n          const node2 = lastSequenceNodes[i];\n          if (typeof node2 == \"string\")\n            continue;\n          const newNode2 = { ...node2 };\n          newNode2.startIndex += formulaStringCount, newNode2.endIndex += formulaStringCount, lastSequenceNodes[i] = newNode2;\n        }\n        let selectionIndex = newNode.endIndex + 1;\n        mustAddBracket && (selectionIndex += 1), this._syncToEditor(lastSequenceNodes, selectionIndex, void 0, !0, !1);\n      })\n    );\n  }\n  _changeFunctionPanelState() {\n    const activeRange = this._docSelectionManagerService.getActiveTextRange();\n    if (activeRange == null) {\n      this._hideFunctionPanel();\n      return;\n    }\n    const { startOffset } = activeRange, currentSequenceNode = this._formulaPromptService.getCurrentSequenceNode(startOffset - 2);\n    if (currentSequenceNode == null) {\n      this._hideFunctionPanel();\n      return;\n    }\n    if (typeof currentSequenceNode != \"string\" && currentSequenceNode.nodeType === sequenceNodeType.FUNCTION && !this._descriptionService.hasDefinedNameDescription(currentSequenceNode.token.trim())) {\n      const token = currentSequenceNode.token.toUpperCase();\n      if (this._inputPanelState === 1) {\n        const searchList = this._descriptionService.getSearchListByNameFirstLetter(token);\n        if (this._hideFunctionPanel(), searchList == null || searchList.length === 0)\n          return;\n        this._commandService.executeCommand(SearchFunctionOperation.id, {\n          visible: !0,\n          searchText: token,\n          searchList\n        });\n      } else\n        this._changeHelpFunctionPanelState(token, -1);\n      return;\n    }\n    const config = this._getCurrentBodyDataStreamAndOffset(), functionAndParameter = this._lexerTreeBuilder.getFunctionAndParameter((config == null ? void 0 : config.dataStream) || \"\", startOffset - 1 + ((config == null ? void 0 : config.offset) || 0));\n    if (!functionAndParameter) {\n      this._hideFunctionPanel();\n      return;\n    }\n    const { functionName, paramIndex } = functionAndParameter;\n    this._changeHelpFunctionPanelState(functionName.toUpperCase(), paramIndex);\n  }\n  _changeHelpFunctionPanelState(token, paramIndex) {\n    const functionInfo = this._descriptionService.getFunctionInfo(token);\n    this._hideFunctionPanel(), functionInfo != null && this._commandService.executeCommand(HelpFunctionOperation.id, {\n      visible: !0,\n      paramIndex,\n      functionInfo\n    });\n  }\n  _hideFunctionPanel() {\n    this._commandService.executeCommand(SearchFunctionOperation.id, {\n      visible: !1,\n      searchText: \"\"\n    }), this._commandService.executeCommand(HelpFunctionOperation.id, {\n      visible: !1,\n      paramIndex: -1\n    });\n  }\n  _checkShouldEnterSelectingMode(isOnlyInputRangeEditor = !1) {\n    if (isOnlyInputRangeEditor) {\n      this._enterSelectingMode();\n      return;\n    }\n    const char = this._getCurrentChar(), dataStream = this._getCurrentDataStream();\n    (dataStream == null ? void 0 : dataStream.substring(0, 1)) === \"=\" && char && matchRefDrawToken(char) ? this._enterSelectingMode() : this._quitSelectingMode();\n  }\n  /**\n   *\n   * @returns Return the character under the current cursor in the editor.\n   */\n  _getCurrentChar() {\n    const activeRange = this._docSelectionManagerService.getActiveTextRange();\n    if (activeRange == null)\n      return;\n    const { startOffset } = activeRange, config = this._getCurrentBodyDataStreamAndOffset();\n    return config == null || startOffset == null ? void 0 : config.dataStream[startOffset - 1 + config.offset];\n  }\n  _getCurrentDataStream() {\n    const config = this._getCurrentBodyDataStreamAndOffset();\n    return config == null ? void 0 : config.dataStream;\n  }\n  _enterSelectingMode() {\n    this._isSelectingMode || (this._editorBridgeService.enableForceKeepVisible(), this._contextMenuService.disable(), this._formulaPromptService.enableLockedSelectionInsert(), this._selectionRenderService.setRemainLastEnabled(!0), this._enableRefSelectionsRenderService(), this._currentlyWorkingRefRenderer = null, this._arrowMoveActionState !== 1 && (this._arrowMoveActionState = 2), this._isSelectingMode = !0);\n  }\n  /**\n   * Disable the ref string generation mode. In the ref string generation mode,\n   * users can select a certain area using the mouse and arrow keys, and convert the area into a ref string.\n   */\n  _quitSelectingMode() {\n    this._isSelectingMode && (this._editorBridgeService.disableForceKeepVisible(), this._contextMenuService.enable(), this._formulaPromptService.disableLockedSelectionInsert(), this._currentInsertRefStringIndex = -1, this._disposeSelectionsChangeListeners(), this._arrowMoveActionState === 2 && (this._arrowMoveActionState = 4), this._isSelectingMode = !1);\n  }\n  _getCurrentBodyDataStreamAndOffset() {\n    var _a11, _b;\n    const documentModel = this._univerInstanceService.getCurrentUniverDocInstance();\n    if (!(documentModel != null && documentModel.getBody()))\n      return;\n    const unitId = documentModel.getUnitId(), editor = this._editorService.getEditor(unitId), dataStream = (_b = (_a11 = documentModel.getBody()) == null ? void 0 : _a11.dataStream) != null ? _b : \"\";\n    return !editor || !editor.onlyInputRange() ? { dataStream, offset: 0 } : { dataStream: compareToken.EQUALS + dataStream, offset: 1 };\n  }\n  _getFormulaAndCellEditorBody(unitIds) {\n    return unitIds.map((unitId) => {\n      const dataModel = this._univerInstanceService.getUniverDocInstance(unitId);\n      return dataModel == null ? void 0 : dataModel.getBody();\n    });\n  }\n  _editorModelUnitIds() {\n    const unitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n    return this._editorService.isEditor(unitId) && !this._editorService.isSheetEditor(unitId) ? [unitId] : sheetEditorUnitIds;\n  }\n  /**\n   * Detect whether the user's input content is a formula. If it is a formula,\n   * serialize the current input content into a sequenceNode;\n   * otherwise, close the formula panel.\n   * @param currentInputValue The text content entered by the user in the editor.\n   */\n  _contextSwitch() {\n    const config = this._getCurrentBodyDataStreamAndOffset();\n    if (config && isFormulaString(config.dataStream)) {\n      this._contextService.setContextValue(FOCUSING_EDITOR_INPUT_FORMULA, !0), this._contextService.setContextValue(DISABLE_NORMAL_SELECTIONS, !0), this._contextService.setContextValue(UNI_DISABLE_CHANGING_FOCUS_KEY, !0);\n      const lastSequenceNodes = this._lexerTreeBuilder.sequenceNodesBuilder(config.dataStream) || [];\n      this._formulaPromptService.setSequenceNodes(lastSequenceNodes);\n      const activeRange = this._docSelectionManagerService.getActiveTextRange();\n      if (activeRange == null)\n        return;\n      const { startOffset } = activeRange;\n      this._currentInsertRefStringIndex = startOffset - 1 + config.offset;\n      return;\n    }\n    this._contextService.setContextValue(FOCUSING_EDITOR_INPUT_FORMULA, !1), this._contextService.setContextValue(DISABLE_NORMAL_SELECTIONS, !1), this._contextService.setContextValue(UNI_DISABLE_CHANGING_FOCUS_KEY, !1), this._formulaPromptService.disableLockedSelectionChange(), this._formulaPromptService.disableLockedSelectionInsert(), this._formulaPromptService.clearSequenceNodes(), this._hideFunctionPanel();\n  }\n  _getContextState() {\n    return this._contextService.getContextValue(FOCUSING_EDITOR_INPUT_FORMULA);\n  }\n  /**\n   * Highlight cell editor and formula bar editor.\n   */\n  _highlightFormula() {\n    if (this._getContextState() === !1)\n      return;\n    const sequenceNodes = this._formulaPromptService.getSequenceNodes(), unitIds = this._editorModelUnitIds(), bodyList = this._getFormulaAndCellEditorBody(unitIds).filter((b) => !!b);\n    if (this._refSelectionsService.clear(), sequenceNodes == null || sequenceNodes.length === 0)\n      this._existsSequenceNode = !1, bodyList.forEach((body) => body.textRuns = []);\n    else {\n      this._existsSequenceNode = !0;\n      const { textRuns, refSelections } = this._buildTextRuns(sequenceNodes);\n      bodyList.forEach((body) => body.textRuns = textRuns), this._allSelectionRenderServices.forEach((r2) => this._refreshSelectionForReference(r2, refSelections));\n    }\n    this._refreshFormulaAndCellEditor(unitIds);\n  }\n  /**\n   * :\n   * #\n   * Generate styles for formula text, highlighting references, text, numbers, and arrays.\n   */\n  _buildTextRuns(sequenceNodes) {\n    var _a11;\n    const textRuns = [], refSelections = [], themeColorMap = /* @__PURE__ */ new Map();\n    let refColorIndex = 0;\n    const offset = ((_a11 = this._getCurrentBodyDataStreamAndOffset()) == null ? void 0 : _a11.offset) || 0;\n    for (let i = 0, len = sequenceNodes.length; i < len; i++) {\n      const node = sequenceNodes[i];\n      if (typeof node == \"string\" || this._descriptionService.hasDefinedNameDescription(node.token.trim()))\n        continue;\n      const { startIndex, endIndex, nodeType, token } = node;\n      let themeColor = \"\";\n      if (nodeType === sequenceNodeType.REFERENCE) {\n        if (themeColorMap.has(token))\n          themeColor = themeColorMap.get(token);\n        else {\n          const colorIndex = refColorIndex % this._formulaRefColors.length;\n          themeColor = this._formulaRefColors[colorIndex], themeColorMap.set(token, themeColor), refColorIndex++;\n        }\n        refSelections.push({\n          refIndex: i,\n          themeColor,\n          token\n        });\n      } else nodeType === sequenceNodeType.NUMBER ? themeColor = this._numberColor : nodeType === sequenceNodeType.STRING ? themeColor = this._stringColor : nodeType === sequenceNodeType.ARRAY && (themeColor = this._stringColor);\n      themeColor && themeColor.length > 0 && textRuns.push({\n        st: startIndex + 1 - offset,\n        ed: endIndex + 2 - offset,\n        ts: {\n          cl: {\n            rgb: themeColor\n          }\n        }\n      });\n    }\n    return { textRuns, refSelections };\n  }\n  _exceedCurrentRange(range, rowCount, columnCount) {\n    const { startRow, startColumn } = range;\n    return startRow > rowCount - 1 || startColumn > columnCount - 1;\n  }\n  /**\n   * Draw the referenced selection text based on the style and token.\n   * @param refSelections\n   */\n  _refreshSelectionForReference(refSelectionRenderService, refSelections) {\n    const { unitId, sheetId } = this._editorBridgeService.getEditCellState(), { unitId: selfUnitId, sheetId: selfSheetId } = this._getCurrentUnitIdAndSheetId(), isSelfSheet = sheetId === selfSheetId, worksheet = this._univerInstanceService.getUniverSheetInstance(unitId).getSheetBySheetId(sheetId);\n    let lastRange = null;\n    const selectionWithStyle = [];\n    for (let i = 0, len = refSelections.length; i < len; i++) {\n      const refSelection = refSelections[i], { themeColor, token, refIndex } = refSelection, gridRange = deserializeRangeWithSheet(token), { unitId: refUnitId, sheetName, range: rawRange } = gridRange, range = setEndForRange(rawRange, worksheet.getRowCount(), worksheet.getColumnCount());\n      if (refUnitId != null && refUnitId.length > 0 && unitId !== refUnitId)\n        continue;\n      const refSheetId = this._getSheetIdByName(unitId, sheetName.trim());\n      if (!isSelfSheet && refSheetId !== selfSheetId || isSelfSheet && sheetName.length !== 0 && refSheetId !== sheetId || this._exceedCurrentRange(range, worksheet.getRowCount(), worksheet.getColumnCount()))\n        continue;\n      const lastRangeCopy = this._getPrimary(range, themeColor, refIndex);\n      if (lastRangeCopy) {\n        lastRange = lastRangeCopy;\n        continue;\n      }\n      const primary = getPrimaryForRange(range, worksheet);\n      !Rectangle.equals(primary, range) && range.startRow === range.endRow && range.startColumn === range.endColumn && (range.startRow = primary.startRow, range.endRow = primary.endRow, range.startColumn = primary.startColumn, range.endColumn = primary.endColumn), selectionWithStyle.push({\n        range,\n        primary,\n        style: getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString())\n      });\n    }\n    lastRange && selectionWithStyle.push(lastRange), selectionWithStyle.length && this._refSelectionsService.addSelections(unitId, sheetId, selectionWithStyle);\n  }\n  _getPrimary(range, themeColor, refIndex) {\n    var _a11;\n    const primary = (_a11 = this._insertSelections.find((selection) => {\n      const { startRow, startColumn, endRow, endColumn } = selection.range;\n      return startRow === range.startRow && startColumn === range.startColumn && endRow === range.endRow && endColumn === range.endColumn || startRow === range.startRow && startColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn;\n    })) == null ? void 0 : _a11.primary;\n    if (primary == null)\n      return;\n    const {\n      isMerged,\n      isMergedMainCell,\n      startRow: mergeStartRow,\n      endRow: mergeEndRow,\n      startColumn: mergeStartColumn,\n      endColumn: mergeEndColumn\n    } = primary;\n    return (isMerged || isMergedMainCell) && mergeStartRow === range.startRow && mergeStartColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn && (range.endRow = mergeEndRow, range.endColumn = mergeEndColumn), {\n      range,\n      primary,\n      style: getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString())\n    };\n  }\n  _getSheetIdByName(unitId, sheetName) {\n    var _a11;\n    const workbook = this._univerInstanceService.getUniverSheetInstance(unitId);\n    return (_a11 = workbook == null ? void 0 : workbook.getSheetBySheetName(normalizeSheetName(sheetName))) == null ? void 0 : _a11.getSheetId();\n  }\n  _getSheetNameById(unitId, sheetId) {\n    var _a11;\n    const workbook = this._univerInstanceService.getUniverSheetInstance(unitId);\n    return ((_a11 = workbook == null ? void 0 : workbook.getSheetBySheetId(sheetId)) == null ? void 0 : _a11.getName()) || \"\";\n  }\n  _getCurrentUnitIdAndSheetId() {\n    var _a11, _b;\n    const workbook = this._univerInstanceService.getCurrentUnitForType(UniverInstanceType.UNIVER_SHEET), worksheet = workbook.getActiveSheet(), skeleton = (_b = (_a11 = this._renderManagerService.getRenderById(workbook.getUnitId())) == null ? void 0 : _a11.with(SheetSkeletonManagerService)) == null ? void 0 : _b.getCurrentSkeleton();\n    return {\n      unitId: workbook.getUnitId(),\n      sheetId: (worksheet == null ? void 0 : worksheet.getSheetId()) || \"\",\n      skeleton\n    };\n  }\n  // FIXME@Jocs: this internal implementations should be exposed to callers.\n  // This method should be moved to EditorService.\n  _getEditorOpenedForSheet() {\n    const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId(), editor = this._editorService.getEditor(editorUnitId);\n    return editor ? {\n      openUnitId: editor.getOpenForSheetUnitId(),\n      openSheetId: editor.getOpenForSheetSubUnitId()\n    } : {\n      openUnitId: null,\n      openSheetId: null\n    };\n  }\n  /**\n   * Convert the selection range to a ref string for the formula engine, such as A1:B1\n   * @param currentSelection\n   */\n  _generateRefString(currentSelection) {\n    let refUnitId = \"\", refSheetName = \"\";\n    const { unitId, sheetId } = currentSelection.range, { openUnitId, openSheetId } = this._getEditorOpenedForSheet();\n    unitId !== openUnitId && unitId && (refUnitId = unitId), sheetId !== openSheetId && unitId && sheetId && (refSheetName = this._getSheetNameById(unitId, sheetId));\n    const { range, primary } = currentSelection;\n    let { startRow, endRow, startColumn, endColumn } = range;\n    const { startAbsoluteRefType, endAbsoluteRefType, rangeType } = range;\n    if (primary) {\n      const {\n        isMerged,\n        isMergedMainCell,\n        startRow: mergeStartRow,\n        endRow: mergeEndRow,\n        startColumn: mergeStartColumn,\n        endColumn: mergeEndColumn\n      } = primary;\n      (isMerged || isMergedMainCell) && mergeStartRow === startRow && mergeStartColumn === startColumn && mergeEndRow === endRow && mergeEndColumn === endColumn && (startRow = mergeStartRow, startColumn = mergeStartColumn, endRow = mergeStartRow, endColumn = mergeStartColumn);\n    }\n    return serializeRangeToRefString({\n      sheetName: refSheetName,\n      unitId: refUnitId,\n      range: {\n        startRow,\n        endRow,\n        startColumn,\n        endColumn,\n        rangeType,\n        startAbsoluteRefType,\n        endAbsoluteRefType\n      }\n    });\n  }\n  /**\n   * Update Editor formula text in prompt editor by current selection in spreadsheet.\n   * Restore the sequenceNode generated by the lexer to the text in the editor, and set the cursor position.\n   *\n   * @param sequenceNodes\n   * @param textSelectionOffset\n   */\n  // eslint-disable-next-line max-lines-per-function\n  _syncToEditor(sequenceNodes, textSelectionOffset, editorUnitId, canUndo = !0, fromSelection = !0) {\n    let dataStream = generateStringWithSequence(sequenceNodes);\n    const { textRuns, refSelections } = this._buildTextRuns(sequenceNodes);\n    this._isSelectionMovingRefSelections = refSelections, this._allSelectionRenderServices.forEach((r2) => this._updateRefSelectionStyle(r2, this._isSelectionMovingRefSelections));\n    const activeRange = this._docSelectionManagerService.getActiveTextRange();\n    if (activeRange == null)\n      return;\n    this._currentInsertRefStringIndex = textSelectionOffset, editorUnitId == null && (editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId()), this._fitEditorSize();\n    const editor = this._editorService.getEditor(editorUnitId);\n    editor != null && editor.isSingleChoice() ? (dataStream = dataStream.split(\",\")[0], this._selectionRenderService.setSingleSelectionEnabled(!0)) : this._selectionRenderService.setSingleSelectionEnabled(!1);\n    let formulaString = dataStream, offset = 1;\n    (!editor || !editor.onlyInputRange()) && (formulaString = `${compareToken.EQUALS}${dataStream}`, offset = 0);\n    const { collapsed, style } = activeRange;\n    canUndo ? (this._commandService.executeCommand(ReplaceContentCommand.id, {\n      unitId: editorUnitId,\n      body: {\n        dataStream: formulaString,\n        textRuns\n      },\n      textRanges: [\n        {\n          startOffset: textSelectionOffset + 1 - offset,\n          endOffset: textSelectionOffset + 1 - offset,\n          collapsed,\n          style\n        }\n      ],\n      segmentId: null,\n      options: { fromSelection }\n    }), this._docSelectionManagerService.replaceTextRanges([\n      {\n        startOffset: textSelectionOffset + 1 - offset,\n        endOffset: textSelectionOffset + 1 - offset,\n        style\n      }\n    ], !0, { fromSelection })) : (this._updateEditorModel(`${formulaString}\\r\n`, textRuns), this._docSelectionManagerService.replaceTextRanges([\n      {\n        startOffset: textSelectionOffset + 1 - offset,\n        endOffset: textSelectionOffset + 1 - offset,\n        style\n      }\n    ], !0, { fromSelection })), this._layoutService.focus();\n  }\n  _fitEditorSize() {\n    const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId();\n    this._editorService.isEditor(editorUnitId) && !this._editorService.isSheetEditor(editorUnitId) || this._commandService.executeCommand(SetEditorResizeOperation.id, {\n      unitId: editorUnitId\n    });\n  }\n  /**\n   * Update the editor's model value to facilitate formula updates.\n   * @param dataStream\n   * @param textRuns\n   */\n  _updateEditorModel(dataStream, textRuns) {\n    var _a11;\n    const documentDataModel = this._univerInstanceService.getCurrentUniverDocInstance(), editorUnitId = documentDataModel.getUnitId();\n    if (!this._editorService.isEditor(editorUnitId))\n      return;\n    const docViewModel = (_a11 = this._renderManagerService.getRenderById(editorUnitId)) == null ? void 0 : _a11.with(DocSkeletonManagerService).getViewModel();\n    if (docViewModel == null || documentDataModel == null)\n      return;\n    const snapshot = documentDataModel == null ? void 0 : documentDataModel.getSnapshot();\n    if (snapshot == null)\n      return;\n    const newBody = {\n      dataStream,\n      textRuns\n    };\n    snapshot.body = newBody, docViewModel.reset(documentDataModel);\n  }\n  _insertControlSelectionReplace(currentSelection) {\n    this._previousSequenceNodes == null && (this._previousSequenceNodes = this._formulaPromptService.getSequenceNodes()), this._previousInsertRefStringIndex == null && (this._previousInsertRefStringIndex = this._currentInsertRefStringIndex);\n    const insertNodes = Tools.deepClone(this._previousSequenceNodes);\n    if (insertNodes == null)\n      return;\n    const refString = this._generateRefString(currentSelection);\n    this._formulaPromptService.setSequenceNodes(insertNodes), this._formulaPromptService.insertSequenceRef(this._previousInsertRefStringIndex, refString), this._syncToEditor(insertNodes, this._previousInsertRefStringIndex + refString.length);\n    const selectionDatas = this._selectionRenderService.getSelectionDataWithStyle();\n    this._insertSelections = [], selectionDatas.forEach((currentSelection2) => {\n      const range = convertSelectionDataToRange(currentSelection2);\n      this._insertSelections.push(range);\n    });\n  }\n  /**\n   * pro/issues/450\n   * In range selection mode, certain measures are implemented to ensure that the selection behavior is processed correctly.\n   */\n  _focusIsOnlyRange(selectionCount) {\n    const currentEditor = this._editorService.getFocusEditor();\n    return !currentEditor || !currentEditor.onlyInputRange() || this._existsSequenceNode || selectionCount > 1 || this._previousSequenceNodes != null && this._previousSequenceNodes.length > 0 ? !0 : (this._previousInsertRefStringIndex != null && (this._previousInsertRefStringIndex += 1), !1);\n  }\n  /**\n   * pro/issues/450\n   * In range selection mode, certain measures are implemented to ensure that the selection behavior is processed correctly.\n   */\n  _resetSequenceNodes(selectionCount) {\n    const currentEditor = this._editorService.getFocusEditor();\n    currentEditor && currentEditor.onlyInputRange() && (selectionCount > 1 || this._existsSequenceNode && (this._formulaPromptService.clearSequenceNodes(), this._previousRangesCount = 0, this._existsSequenceNode = !1));\n  }\n  // FIXME: @wzhudev: this method could be merged with `_refreshSelectionForReference`.\n  _updateRefSelectionStyle(refSelectionRenderService, refSelections) {\n    const controls = refSelectionRenderService.getSelectionControls(), [unitId, sheetId] = refSelectionRenderService.getLocation(), matchedControls = /* @__PURE__ */ new Set();\n    for (let i = 0, len = refSelections.length; i < len; i++) {\n      const refSelection = refSelections[i], { refIndex, themeColor, token } = refSelection, rangeWithSheet = deserializeRangeWithSheet(token), { unitId: refUnitId, sheetName, range } = rangeWithSheet;\n      if (!refUnitId && refUnitId.length > 0 && unitId !== refUnitId)\n        continue;\n      const refSheetId = this._getSheetIdByName(unitId, sheetName.trim());\n      if (refSheetId && refSheetId !== sheetId)\n        continue;\n      const control = controls.find((c) => {\n        const { startRow, startColumn, endRow, endColumn, rangeType } = c.getRange();\n        return rangeType === RANGE_TYPE.COLUMN && startColumn === range.startColumn && endColumn === range.endColumn || rangeType === RANGE_TYPE.ROW && startRow === range.startRow && endRow === range.endRow || startRow === range.startRow && startColumn === range.startColumn && endRow === range.endRow && endColumn === range.endColumn || startRow === range.startRow && startColumn === range.startColumn && range.startRow === range.endRow && range.startColumn === range.endColumn;\n      });\n      if (control) {\n        const style = getFormulaRefSelectionStyle(this._themeService, themeColor, refIndex.toString());\n        control.updateStyle(style), matchedControls.add(control);\n      }\n    }\n  }\n  _onSelectionControlChange(toRange, selectionControl) {\n    var _a11;\n    const { skeleton } = this._getCurrentUnitIdAndSheetId();\n    this._formulaPromptService.enableLockedSelectionChange();\n    const id = (_a11 = selectionControl.currentStyle) == null ? void 0 : _a11.id;\n    if (!id || !Tools.isStringNumber(id))\n      return;\n    let { startRow, endRow, startColumn, endColumn } = toRange;\n    const primary = skeleton ? skeleton.worksheet.getCellInfoInMergeData(startRow, startColumn) : {\n      actualRow: startRow,\n      actualColumn: startColumn,\n      isMergedMainCell: !1,\n      isMerged: !1,\n      endRow: startRow,\n      endColumn: startColumn,\n      startRow,\n      startColumn\n    };\n    if (primary) {\n      const {\n        isMerged,\n        isMergedMainCell,\n        startRow: mergeStartRow,\n        endRow: mergeEndRow,\n        startColumn: mergeStartColumn,\n        endColumn: mergeEndColumn\n      } = primary;\n      (isMerged || isMergedMainCell) && mergeStartRow === startRow && mergeStartColumn === startColumn && mergeEndRow === endRow && mergeEndColumn === endColumn && (startRow = mergeStartRow, startColumn = mergeStartColumn, endRow = mergeStartRow, endColumn = mergeStartColumn);\n    }\n    const nodeIndex = Number(id), currentNode = this._formulaPromptService.getCurrentSequenceNodeByIndex(nodeIndex);\n    if (!currentNode)\n      return;\n    let refType = { startAbsoluteRefType: AbsoluteRefType.NONE };\n    if (typeof currentNode != \"string\") {\n      const token = currentNode.token;\n      refType = getAbsoluteRefTypeWitString(token), refType.endAbsoluteRefType == null && (refType.endAbsoluteRefType = refType.startAbsoluteRefType);\n    }\n    const unitId = skeleton == null ? void 0 : skeleton.worksheet.getUnitId(), sheetId = skeleton == null ? void 0 : skeleton.worksheet.getSheetId(), refString = this._generateRefString({\n      range: {\n        startRow: Math.min(startRow, endRow),\n        endRow: Math.max(startRow, endRow),\n        startColumn: Math.min(startColumn, endColumn),\n        endColumn: Math.max(startColumn, endColumn),\n        ...refType,\n        sheetId,\n        unitId\n      },\n      primary,\n      style: null\n    });\n    this._formulaPromptService.updateSequenceRef(nodeIndex, refString);\n    const sequenceNodes = this._formulaPromptService.getSequenceNodes(), node = sequenceNodes[nodeIndex];\n    typeof node != \"string\" && (this._syncToEditor(sequenceNodes, node.endIndex + 1), selectionControl.update(toRange, void 0, void 0, void 0, this._selectionRenderService.attachPrimaryWithCoord(primary)));\n  }\n  _refreshFormulaAndCellEditor(unitIds) {\n    var _a11;\n    for (const unitId of unitIds) {\n      const editorObject = getEditorObject(unitId, this._renderManagerService), documentComponent = editorObject == null ? void 0 : editorObject.document;\n      documentComponent != null && ((_a11 = documentComponent.getSkeleton()) == null || _a11.calculate(), documentComponent.makeDirty());\n    }\n  }\n  _cursorStateListener() {\n    const editorObject = this._getEditorObject();\n    if (editorObject == null)\n      return;\n    const { mainComponent: documentComponent } = editorObject;\n    documentComponent && this.disposeWithMe(documentComponent.onPointerDown$.subscribeEvent(() => {\n      this._arrowMoveActionState = 1, this._inputPanelState = 3;\n    }));\n  }\n  _pressEnter(params) {\n    const { keycode, isSingleEditor = !1 } = params;\n    if (this._formulaPromptService.isSearching()) {\n      this._formulaPromptService.accept(!0);\n      return;\n    }\n    isSingleEditor !== !0 && this._editorBridgeService.changeVisible({\n      visible: !1,\n      eventType: DeviceInputEventType.Keyboard,\n      keycode,\n      unitId: \"\"\n    });\n  }\n  _pressTab(params) {\n    const { keycode, isSingleEditor = !1 } = params;\n    if (this._formulaPromptService.isSearching()) {\n      this._formulaPromptService.accept(!0);\n      return;\n    }\n    isSingleEditor !== !0 && this._editorBridgeService.changeVisible({\n      visible: !1,\n      eventType: DeviceInputEventType.Keyboard,\n      keycode,\n      unitId: \"\"\n    });\n  }\n  _pressEsc(params) {\n    const { keycode } = params, focusEditor = this._editorService.getFocusEditor();\n    (!focusEditor || (focusEditor == null ? void 0 : focusEditor.isSheetEditor()) === !0) && this._editorBridgeService.changeVisible({\n      visible: !1,\n      eventType: DeviceInputEventType.Keyboard,\n      keycode,\n      unitId: \"\"\n    });\n  }\n  _pressArrowKey(params) {\n    const { keycode, metaKey } = params;\n    let direction = Direction.DOWN;\n    keycode === KeyCode.ARROW_DOWN ? direction = Direction.DOWN : keycode === KeyCode.ARROW_UP ? direction = Direction.UP : keycode === KeyCode.ARROW_LEFT ? direction = Direction.LEFT : keycode === KeyCode.ARROW_RIGHT && (direction = Direction.RIGHT), metaKey === MetaKeys.CTRL_COMMAND ? this._commandService.executeCommand(MoveSelectionCommand.id, {\n      direction,\n      jumpOver: JumpOver.moveGap\n    }) : metaKey === MetaKeys.SHIFT ? this._commandService.executeCommand(ExpandSelectionCommand.id, {\n      direction\n    }) : metaKey === META_KEY_CTRL_AND_SHIFT ? this._commandService.executeCommand(ExpandSelectionCommand.id, {\n      direction,\n      jumpOver: JumpOver.moveGap\n    }) : this._commandService.executeCommand(MoveSelectionCommand.id, {\n      direction\n    });\n  }\n  // eslint-disable-next-line max-lines-per-function\n  _commandExecutedListener() {\n    const updateCommandList = [SelectEditorFormulaOperation.id];\n    this.disposeWithMe(\n      this._commandService.onCommandExecuted((command) => {\n        if (command.id === ReferenceAbsoluteOperation.id)\n          this._changeRefString();\n        else if (updateCommandList.includes(command.id)) {\n          const params = command.params, { keycode, isSingleEditor = !1 } = params;\n          if (keycode === KeyCode.ENTER) {\n            this._pressEnter(params);\n            return;\n          }\n          if (keycode === KeyCode.TAB) {\n            this._pressTab(params);\n            return;\n          }\n          if (keycode === KeyCode.ESC) {\n            this._pressEsc(params);\n            return;\n          }\n          if (this._formulaPromptService.isSearching()) {\n            if (keycode === KeyCode.ARROW_DOWN) {\n              this._formulaPromptService.navigate({ direction: Direction.DOWN });\n              return;\n            }\n            if (keycode === KeyCode.ARROW_UP) {\n              this._formulaPromptService.navigate({ direction: Direction.UP });\n              return;\n            }\n          }\n          if (isSingleEditor === !0)\n            return;\n          if (this._arrowMoveActionState === 1) {\n            this._moveInEditor(keycode);\n            return;\n          }\n          if (this._arrowMoveActionState === 4) {\n            this._editorBridgeService.changeVisible({\n              visible: !1,\n              eventType: DeviceInputEventType.Keyboard,\n              keycode,\n              unitId: \"\"\n            });\n            return;\n          }\n          if (this._arrowMoveActionState === 2 && (this._arrowMoveActionState = 3), this._refSelectionsService.getCurrentSelections().length === 0) {\n            const selectionData = this._sheetsSelectionsService.getCurrentLastSelection();\n            if (selectionData != null) {\n              const selectionDataNew = Tools.deepClone(selectionData);\n              this._refSelectionsService.addSelections([selectionDataNew]);\n            }\n          }\n          this._pressArrowKey(params);\n          const selectionWithStyles = this._refSelectionsService.getCurrentSelections(), currentSelection = selectionWithStyles[selectionWithStyles.length - 1];\n          this._insertControlSelectionReplace(currentSelection), this._highlightFormula();\n        }\n      })\n    );\n  }\n  _moveInEditor(keycode) {\n    if (keycode == null)\n      return;\n    let direction = Direction.LEFT;\n    keycode === KeyCode.ARROW_DOWN ? direction = Direction.DOWN : keycode === KeyCode.ARROW_UP ? direction = Direction.UP : keycode === KeyCode.ARROW_RIGHT && (direction = Direction.RIGHT), this._commandService.executeCommand(MoveCursorOperation.id, {\n      direction\n    });\n  }\n  _userMouseListener() {\n    const editorObject = this._getEditorObject();\n    if (editorObject == null)\n      return;\n    const { mainComponent: documentComponent } = editorObject;\n    documentComponent && this.disposeWithMe(documentComponent == null ? void 0 : documentComponent.onPointerDown$.subscribeEvent(() => {\n      this._userCursorMove = !0;\n    }));\n  }\n  _inputFormulaListener() {\n    this.disposeWithMe(\n      this._editorService.inputFormula$.subscribe((param) => {\n        const { formulaString, editorUnitId } = param;\n        if (formulaString.substring(0, 1) !== compareToken.EQUALS)\n          return;\n        const { unitId } = this._getCurrentUnitIdAndSheetId();\n        this._editorBridgeService.isVisible().visible === !1 && this._editorBridgeService.changeVisible({\n          visible: !0,\n          eventType: DeviceInputEventType.Dblclick,\n          unitId\n        });\n        const lastSequenceNodes = this._lexerTreeBuilder.sequenceNodesBuilder(formulaString) || [];\n        this._formulaPromptService.setSequenceNodes(lastSequenceNodes), this._syncToEditor(lastSequenceNodes, formulaString.length - 1, editorUnitId, !0, !1);\n      })\n    );\n  }\n  /**\n   * Absolute range, triggered by F4\n   */\n  _changeRefString() {\n    const activeRange = this._docSelectionManagerService.getActiveTextRange();\n    if (activeRange == null)\n      return;\n    const { startOffset } = activeRange, strIndex = startOffset - 2, nodeIndex = this._formulaPromptService.getCurrentSequenceNodeIndex(strIndex), node = this._formulaPromptService.getCurrentSequenceNodeByIndex(nodeIndex);\n    if (node == null || typeof node == \"string\" || node.nodeType !== sequenceNodeType.REFERENCE)\n      return;\n    const tokenArray = node.token.split(\"!\");\n    let token = node.token;\n    tokenArray.length > 1 && (token = tokenArray[tokenArray.length - 1]);\n    let unitIDAndSheetName = \"\";\n    for (let i = 0, len = tokenArray.length; i < len - 1; i++)\n      unitIDAndSheetName += tokenArray[i];\n    let finalToken = token;\n    if (token.indexOf(matchToken.COLON) > -1)\n      if (!this._userCursorMove)\n        finalToken = this._changeRangeRef(token);\n      else {\n        const refStringSplit = token.split(matchToken.COLON), prefix = refStringSplit[0], suffix = refStringSplit[1];\n        strIndex - node.startIndex <= prefix.length ? finalToken = this._changeSingleRef(prefix) + matchToken.COLON + suffix : finalToken = prefix + matchToken.COLON + this._changeSingleRef(suffix);\n      }\n    else\n      finalToken = this._changeSingleRef(token);\n    finalToken = unitIDAndSheetName + finalToken;\n    const difference = finalToken.length - node.token.length;\n    this._formulaPromptService.updateSequenceRef(nodeIndex, finalToken), this._syncToEditor(this._formulaPromptService.getSequenceNodes(), strIndex + difference + 1);\n  }\n  _changeRangeRef(token) {\n    const range = deserializeRangeWithSheet(token).range;\n    let resultToken = \"\";\n    return range.startAbsoluteRefType === AbsoluteRefType.NONE || range.startAbsoluteRefType == null ? (range.startAbsoluteRefType = AbsoluteRefType.ALL, range.endAbsoluteRefType = AbsoluteRefType.ALL) : (range.startAbsoluteRefType = AbsoluteRefType.NONE, range.endAbsoluteRefType = AbsoluteRefType.NONE), resultToken = serializeRange(range), resultToken;\n  }\n  _changeSingleRef(token) {\n    const range = deserializeRangeWithSheet(token).range, type = range.startAbsoluteRefType;\n    let resultToken = \"\";\n    return type === AbsoluteRefType.NONE || type == null ? (range.startAbsoluteRefType = AbsoluteRefType.ALL, range.endAbsoluteRefType = AbsoluteRefType.ALL) : type === AbsoluteRefType.ALL ? (range.startAbsoluteRefType = AbsoluteRefType.ROW, range.endAbsoluteRefType = AbsoluteRefType.ROW) : type === AbsoluteRefType.ROW ? (range.startAbsoluteRefType = AbsoluteRefType.COLUMN, range.endAbsoluteRefType = AbsoluteRefType.COLUMN) : (range.startAbsoluteRefType = AbsoluteRefType.NONE, range.endAbsoluteRefType = AbsoluteRefType.NONE), resultToken = serializeRange(range), resultToken;\n  }\n  _getEditorObject() {\n    const editorUnitId = this._univerInstanceService.getCurrentUniverDocInstance().getUnitId(), editor = this._editorService.getEditor(editorUnitId);\n    return editor == null ? void 0 : editor.render;\n  }\n  _isFormulaEditorActivated() {\n    return this._editorBridgeService.isVisible().visible === !0 || this._contextService.getContextValue(FORMULA_EDITOR_ACTIVATED);\n  }\n  _isSheetOrFormulaEditor(editor) {\n    return editor.isSheetEditor() || editor.isFormulaEditor();\n  }\n}, __name(_a9, \"PromptController\"), _a9);\nPromptController = __decorateClass$1([\n  __decorateParam$1(0, ICommandService),\n  __decorateParam$1(1, IContextService),\n  __decorateParam$1(2, Inject(IEditorBridgeService)),\n  __decorateParam$1(3, Inject(IFormulaPromptService)),\n  __decorateParam$1(4, Inject(LexerTreeBuilder)),\n  __decorateParam$1(5, IRenderManagerService),\n  __decorateParam$1(6, Inject(ThemeService)),\n  __decorateParam$1(7, Inject(SheetsSelectionsService)),\n  __decorateParam$1(8, IRefSelectionsService),\n  __decorateParam$1(9, IUniverInstanceService),\n  __decorateParam$1(10, Inject(IDescriptionService)),\n  __decorateParam$1(11, Inject(DocSelectionManagerService)),\n  __decorateParam$1(12, IContextMenuService),\n  __decorateParam$1(13, IEditorService),\n  __decorateParam$1(14, ILayoutService)\n], PromptController);\nvar __defProp2 = Object.defineProperty, __getOwnPropDesc = Object.getOwnPropertyDescriptor, __defNormalProp2 = /* @__PURE__ */ __name((obj, key, value) => key in obj ? __defProp2(obj, key, { enumerable: !0, configurable: !0, writable: !0, value }) : obj[key] = value, \"__defNormalProp\"), __decorateClass = /* @__PURE__ */ __name((decorators, target, key, kind) => {\n  for (var result = kind > 1 ? void 0 : kind ? __getOwnPropDesc(target, key) : target, i = decorators.length - 1, decorator; i >= 0; i--)\n    (decorator = decorators[i]) && (result = (kind ? decorator(target, key, result) : decorator(result)) || result);\n  return kind && result && __defProp2(target, key, result), result;\n}, \"__decorateClass\"), __decorateParam = /* @__PURE__ */ __name((index, decorator) => (target, key) => decorator(target, key, index), \"__decorateParam\"), __publicField2 = /* @__PURE__ */ __name((obj, key, value) => __defNormalProp2(obj, typeof key != \"symbol\" ? key + \"\" : key, value), \"__publicField\"), _a10;\nlet UniverSheetsFormulaUIPlugin = (_a10 = class extends Plugin {\n  constructor(_config = defaultPluginBaseConfig, _injector, _renderManagerService, _configService) {\n    super(), this._config = _config, this._injector = _injector, this._renderManagerService = _renderManagerService, this._configService = _configService;\n    const { menu, ...rest } = this._config;\n    menu && this._configService.setConfig(\"menu\", menu, { merge: !0 }), this._configService.setConfig(PLUGIN_CONFIG_KEY_BASE, rest);\n  }\n  onStarting() {\n    const j = this._injector;\n    [\n      [IFormulaPromptService, { useClass: FormulaPromptService }],\n      [FormulaUIController],\n      [FormulaAutoFillController],\n      [FormulaClipboardController],\n      [FormulaEditorShowController],\n      [FormulaRenderManagerController],\n      [PromptController]\n    ].forEach((dependency) => j.add(dependency));\n  }\n  onReady() {\n    this._injector.get(FormulaUIController);\n  }\n  onRendered() {\n    [\n      [RefSelectionsRenderService],\n      [FormulaAlertRenderController]\n    ].forEach((dep) => {\n      this.disposeWithMe(this._renderManagerService.registerRenderModule(UniverInstanceType.UNIVER_SHEET, dep));\n    }), this._injector.get(FormulaClipboardController), this._injector.get(FormulaRenderManagerController), this._injector.get(ComponentManager).register(RANGE_SELECTOR_COMPONENT_KEY, RangeSelector);\n  }\n  onSteady() {\n    this._injector.get(FormulaAutoFillController), this._injector.get(PromptController);\n  }\n}, __name(_a10, \"UniverSheetsFormulaUIPlugin\"), _a10);\n__publicField2(UniverSheetsFormulaUIPlugin, \"pluginName\", FORMULA_UI_PLUGIN_NAME);\n__publicField2(UniverSheetsFormulaUIPlugin, \"type\", UniverInstanceType.UNIVER_SHEET);\nUniverSheetsFormulaUIPlugin = __decorateClass([\n  DependentOn(UniverFormulaEnginePlugin, UniverSheetsFormulaPlugin),\n  __decorateParam(1, Inject(Injector)),\n  __decorateParam(2, IRenderManagerService),\n  __decorateParam(3, IConfigService)\n], UniverSheetsFormulaUIPlugin);\nexport {\n  FORMULA_PROMPT_ACTIVATED,\n  HelpFunctionOperation,\n  InsertFunctionOperation,\n  MoreFunctionsOperation,\n  RangeSelector,\n  RefSelectionsRenderService,\n  ReferenceAbsoluteOperation,\n  SearchFunctionOperation,\n  SelectEditorFormulaOperation,\n  SheetOnlyPasteFormulaCommand,\n  UniverSheetsFormulaUIPlugin\n};\n","import { distinctUntilChanged } from './distinctUntilChanged';\nexport function distinctUntilKeyChanged(key, compare) {\n    return distinctUntilChanged(function (x, y) { return compare ? compare(x[key], y[key]) : x[key] === y[key]; });\n}\n//# sourceMappingURL=distinctUntilKeyChanged.js.map","import { distinctUntilChanged } from './distinctUntilChanged';\nimport { MonoTypeOperatorFunction } from '../types';\n\n/* tslint:disable:max-line-length */\nexport function distinctUntilKeyChanged<T>(key: keyof T): MonoTypeOperatorFunction<T>;\nexport function distinctUntilKeyChanged<T, K extends keyof T>(key: K, compare: (x: T[K], y: T[K]) => boolean): MonoTypeOperatorFunction<T>;\n/* tslint:enable:max-line-length */\n\n/**\n * Returns an Observable that emits all items emitted by the source Observable that are distinct by comparison from the previous item,\n * using a property accessed by using the key provided to check if the two items are distinct.\n *\n * If a comparator function is provided, then it will be called for each item to test for whether or not that value should be emitted.\n *\n * If a comparator function is not provided, an equality check is used by default.\n *\n * ## Examples\n *\n * An example comparing the name of persons\n *\n * ```ts\n * import { of, distinctUntilKeyChanged } from 'rxjs';\n *\n * of(\n *   { age: 4, name: 'Foo' },\n *   { age: 7, name: 'Bar' },\n *   { age: 5, name: 'Foo' },\n *   { age: 6, name: 'Foo' }\n * ).pipe(\n *   distinctUntilKeyChanged('name')\n * )\n * .subscribe(x => console.log(x));\n *\n * // displays:\n * // { age: 4, name: 'Foo' }\n * // { age: 7, name: 'Bar' }\n * // { age: 5, name: 'Foo' }\n * ```\n *\n * An example comparing the first letters of the name\n *\n * ```ts\n * import { of, distinctUntilKeyChanged } from 'rxjs';\n *\n * of(\n *   { age: 4, name: 'Foo1' },\n *   { age: 7, name: 'Bar' },\n *   { age: 5, name: 'Foo2' },\n *   { age: 6, name: 'Foo3' }\n * ).pipe(\n *   distinctUntilKeyChanged('name', (x, y) => x.substring(0, 3) === y.substring(0, 3))\n * )\n * .subscribe(x => console.log(x));\n *\n * // displays:\n * // { age: 4, name: 'Foo1' }\n * // { age: 7, name: 'Bar' }\n * // { age: 5, name: 'Foo2' }\n * ```\n *\n * @see {@link distinct}\n * @see {@link distinctUntilChanged}\n *\n * @param {string} key String key for object property lookup on each item.\n * @param {function} [compare] Optional comparison function called to test if an item is distinct from the previous item in the source.\n * @return A function that returns an Observable that emits items from the\n * source Observable with distinct values based on the key specified.\n */\nexport function distinctUntilKeyChanged<T, K extends keyof T>(key: K, compare?: (x: T[K], y: T[K]) => boolean): MonoTypeOperatorFunction<T> {\n  return distinctUntilChanged((x: T, y: T) => compare ? compare(x[key], y[key]) : x[key] === y[key]);\n}\n"],"names":["$parcel$export","e","n","v","s","Object","defineProperty","get","set","enumerable","configurable","parcelRequire","$parcel$global","globalThis","self","window","global","parcelRegister","register","module","exports","$f3129b461bb1bc83$export$1081d70813d107d1","$f3129b461bb1bc83$export$bbd9acb515f542fd","$7yNYd","$4XALk","$86b1c","$dLBA8","$arCqp","$8WNAB","$lMvMU","$hciHF","$i54iF","$1O3Nt","$3yupB","$1mjSk","$23cfA","$gv2K9","$g6Cit","$ejawP","$bRzks","$fL2Ug","$5gqvu","$1UDbf","$3e0Iz","$7AR1b","$f3129b461bb1bc83$var$__defProp","$f3129b461bb1bc83$var$__defNormalProp","obj","key","value","writable","$f3129b461bb1bc83$var$__name","target","$f3129b461bb1bc83$var$__publicField","$f3129b461bb1bc83$export$9426163a6ae5dd94","id","type","CommandType","COMMAND","handler","accessor","ICommandService","executeCommand","SheetPasteCommand","PREDEFINED_HOOK_NAME","SPECIAL_PASTE_FORMULA","$f3129b461bb1bc83$export$585b41d8b7a58a05","OPERATION","params","$f3129b461bb1bc83$var$__defProp$9","$f3129b461bb1bc83$var$__getOwnPropDesc$9","getOwnPropertyDescriptor","$f3129b461bb1bc83$var$__decorateClass$9","decorators","kind","decorator","result","i","length","$f3129b461bb1bc83$var$__decorateParam$9","index","$f3129b461bb1bc83$var$IFormulaPromptService","createIdentifier","$f3129b461bb1bc83$var$FormulaPromptService","$f3129b461bb1bc83$var$_a","constructor","_contextService","Subject","_search$","asObservable","_help$","_navigate$","_accept$","_acceptFormulaName$","dispose","complete","_sequenceNodes","search","param","setContextValue","visible","_searching","next","isSearching","help","_helping","isHelping","navigate","accept","acceptFormulaName","getSequenceNodes","setSequenceNodes","nodes","clearSequenceNodes","getCurrentSequenceNode","strIndex","getCurrentSequenceNodeIndex","getCurrentSequenceNodeByIndex","nodeIndex","firstNode","len","node","endIndex","updateSequenceRef","refString","nodeType","sequenceNodeType","REFERENCE","difference","token","newNode","node2","newNode2","startIndex","insertSequenceRef","refStringCount","splice","insertSequenceString","content","str","split","contentCount","enableLockedSelectionChange","_isLockedOnSelectionChangeRefString","disableLockedSelectionChange","isLockedSelectionChange","enableLockedSelectionInsert","_isLockedOnSelectionInsertRefString","disableLockedSelectionInsert","isLockedSelectionInsert","IContextService","$f3129b461bb1bc83$export$d1f2080022e7b2d1","$f3129b461bb1bc83$export$ed0c9b5405071c4d","_a11","_b","selectionManagerService","SheetsSelectionsService","editorService","IEditorService","currentSelections","getCurrentSelections","getSheetCommandTarget","IUniverInstanceService","worksheet","unitId","subUnitId","cellMatrix","getCellMatrix","commandService","list","editRange","editRow","editColumn","editFormulaRangeString","$f3129b461bb1bc83$var$isSingleCell","range","$f3129b461bb1bc83$var$isMultiRowsColumnsRange","primary","row","actualRow","startRow","column","actualColumn","startColumn","refRange","$f3129b461bb1bc83$var$findRefRange","serializeRange","some","selection","_a12","_b2","rangeString","formulaString","push","formula","destRange","getCellAtRowCol","resultRange","Rectangle","clone","endRow","endColumn","isMerged","isMergedMainCell","SetSelectionsOperation","selections","setTimeout","setFormula","InsertFunctionCommand","$f3129b461bb1bc83$var$findStartRow","$f3129b461bb1bc83$var$findStartColumn","isFirstNumber","r2","cell","getValue","$f3129b461bb1bc83$var$isNumberCell","c","p","body","data","dataStream","newDataStream","substring","DEFAULT_EMPTY_DOCUMENT_VALUE","isRealNum","t","CellValueType","NUMBER","getCellValueType","$f3129b461bb1bc83$var$FORMULA_UI_PLUGIN_NAME","$f3129b461bb1bc83$var$MORE_FUNCTIONS_COMPONENT","$f3129b461bb1bc83$export$c1b1be2f114a38f5","ISidebarService","open","header","title","children","label","$f3129b461bb1bc83$export$39056a97b2a0b835","$f3129b461bb1bc83$export$2ab1570c3479c5b1","$f3129b461bb1bc83$var$jsxRuntime","$f3129b461bb1bc83$var$reactJsxRuntime_production_min","$f3129b461bb1bc83$var$f","a","__esModule","default","$f3129b461bb1bc83$var$k","Symbol","for","$f3129b461bb1bc83$var$l","$f3129b461bb1bc83$var$m","prototype","hasOwnProperty","$f3129b461bb1bc83$var$n","__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED","ReactCurrentOwner","$f3129b461bb1bc83$var$p","ref","__self","__source","$f3129b461bb1bc83$var$q","g","b","d","h","call","defaultProps","$$typeof","props","_owner","current","Fragment","jsx","jsxs","$f3129b461bb1bc83$var$jsxRuntimeExports","$f3129b461bb1bc83$var$__assign","assign","n2","arguments","p2","apply","$f3129b461bb1bc83$var$__rest","indexOf","getOwnPropertySymbols","propertyIsEnumerable","$f3129b461bb1bc83$var$IconBase","forwardRef","icon","className","extend","restProps","cls","concat","trim","idSuffix","useRef","$f3129b461bb1bc83$var$generateShortUuid","$f3129b461bb1bc83$var$render","defIds","runtimeProps","rootProps","createElement","tag","$f3129b461bb1bc83$var$replaceRuntimeIdsAndExtInAttrs","$f3129b461bb1bc83$var$replaceRuntimeIdsInDefs","map","child","attrs","colorChannel1","fill","entries","forEach","replace","Math","random","toString","displayName","$f3129b461bb1bc83$var$element$6","viewBox","width","height","fillRule","clipRule","$f3129b461bb1bc83$var$CheckMarkSingle","$f3129b461bb1bc83$var$element$5","$f3129b461bb1bc83$var$CloseSingle","$f3129b461bb1bc83$var$element$4","$f3129b461bb1bc83$var$DeleteSingle","$f3129b461bb1bc83$var$element$3","$f3129b461bb1bc83$var$DetailsSingle","$f3129b461bb1bc83$var$element$2","$f3129b461bb1bc83$var$IncreaseSingle","$f3129b461bb1bc83$var$element$1","$f3129b461bb1bc83$var$MoreSingle","$f3129b461bb1bc83$var$element","$f3129b461bb1bc83$var$SelectRangeSingle","$f3129b461bb1bc83$var$r","f2","Array","isArray","o","$f3129b461bb1bc83$var$clsx","$f3129b461bb1bc83$var$_a2","$f3129b461bb1bc83$var$__defProp$8","$f3129b461bb1bc83$var$__getOwnPropDesc$8","$f3129b461bb1bc83$var$__decorateClass$8","$f3129b461bb1bc83$var$__decorateParam$8","$f3129b461bb1bc83$export$c157cedf8ddabc0a","BaseSelectionRenderService","_context","injector","themeService","shortcutService","sheetSkeletonManagerService","_refSelectionsService","_workbookSelections","getWorkbookSelections","_initSelectionChangeListener","_initSkeletonChangeListener","_initUserActionSyncListener","_setSelectionStyle","$f3129b461bb1bc83$var$getDefaultRefSelectionStyle","_themeService","_remainLastEnabled","getLocation","_skeleton","setRemainLastEnabled","enabled","setSkipLastEnabled","_skipLastEnabled","clearLastSelection","last","_selectionControls","pop","enableSelectionChanging","_disableSelectionChanging","_eventDisposables","_initCanvasEventListeners","toDisposable","spreadsheetRowHeader","spreadsheetColumnHeader","spreadsheet","spreadsheetLeftTopPlaceholder","_getSheetObject","scene","listenerDisposables","DisposableCollection","add","onPointerDown$","subscribeEvent","evt","state","_onPointerDown","zIndex","RANGE_TYPE","NORMAL","_getActiveViewport","button","stopPropagation","skeleton","_sheetSkeletonManagerService","getCurrent","getCoordByOffset","offsetX","offsetY","checkInHeaderRanges","ROW","ScrollTimerType","Y","COLUMN","X","_reset","selectionWithStyle","getAllSelection","selectionData","attachSelectionWithCoord","_addSelectionControlBySelectionData","_selectionMoveStart$","getSelectionDataWithStyle","onPointerUp$","unsubscribe","_selectionMoveEnd$","disposeWithMe","selectionMoveStart$","subscribe","selectionDataWithStyle","_updateSelections","SelectionMoveType","MOVE_START","selectionMoving$","MOVING","selectionMoveEnd$","MOVE_END","selectionDataWithStyleList","sheetId","unit","getActiveSheet","getSheetId","setSelections","convertSelectionDataToRange","merge","selectionSet$","selectionsWithStyles","currentSkeleton$","viewportMain","getViewport","SHEET_VIEWPORT_KEY","VIEW_MAIN","_changeRuntime","_refreshSelectionControl","selectionsData","updateControlForCurrentByRangeData","sheetObject","getActiveViewportByCoord","Vector2","FromArray","getSheetObject","style","getNormalSelectionStyle","hasAutoFill","hasRowHeader","hasColumnHeader","widgets","tl","tc","tr","ml","mr","bl","bc","br","Inject","Injector","ThemeService","IShortcutService","SheetSkeletonManagerService","IRefSelectionsService","$f3129b461bb1bc83$var$useEditorInput","editor","render2","useDependency","IRenderManagerService","getRenderById","refSelectionsRenderService","with","useEffect","input$","matchToken","COMMA","endsWith","$f3129b461bb1bc83$var$useFormulaToken","text","lexerTreeBuilder","LexerTreeBuilder","sequenceNodes","sequenceNodesSet","useState","sequenceNodesBuilder","$f3129b461bb1bc83$var$useSheetHighlight","isNeed","refSelections","univerInstanceService","refSelectionsService","ranges","rangesSet","workbook","getUnit","currentSheetId","getSheetIdByName","name","getSheetBySheetName","themeColor","refIndex","refUnitId","sheetName","rawRange","deserializeRangeWithSheet","refSheetId","setEndForRange","getRowCount","getColumnCount","$f3129b461bb1bc83$var$getFormulaRefSelectionStyle$1","getCurrentSkeleton","allControls","getSelectionControls","control","primaryCell","getCellByIndex","updateRange","attachRangeWithCoord","updateStyle","$f3129b461bb1bc83$var$useDocHight","editorId","descriptionService","IDescriptionService","colorMap","$f3129b461bb1bc83$var$useColor","getEditor","getDocumentData","cloneBody","textRuns","$f3129b461bb1bc83$var$buildTextRuns","reduce","pre","cur","getSelectionRanges","cloneData","setDocumentData","getCurrentTheme","useMemo","formulaRefColors","loopColor1","loopColor2","loopColor3","loopColor4","loopColor5","loopColor6","loopColor7","loopColor8","loopColor9","loopColor10","loopColor11","loopColor12","numberColor","hyacinth700","stringColor","verdancy800","themeColorMap","Map","refColorIndex","theLastItem","start","ed","end","st","hasDefinedNameDescription","has","colorIndex","STRING","ARRAY","ts","cl","rgb","refColor","ColorKit","setAlpha","toRgbString","strokeWidth","stroke","widgetSize","widgetStrokeWidth","widgetStroke","colorWhite","$f3129b461bb1bc83$var$useRefactorEffect","isOnlyOneRange","renderManagerService","contextService","editorBridgeService","IEditorBridgeService","sheetsSelectionsService","contextMenuService","IContextMenuService","d1","DISABLE_NORMAL_SELECTIONS","enableForceKeepVisible","disableForceKeepVisible","useLayoutEffect","getCurrentUnitForType","UniverInstanceType","UNIVER_SHEET","sheet","workbook2","currentSheet","disable","enable","$f3129b461bb1bc83$var$useResize","resize","mainComponent","render","docSkeletonManagerService","DocSkeletonManagerService","getBoundingClientRect","getViewModel","getDataModel","updateDocumentDataPageSize","transformByState","checkScrollBar","debounce","getSkeleton","VIEWPORT_KEY","actualWidth","getActualSize","scrollBar","getScrollBar","contentWidth","max","ScrollBar","barSize","enableVertical","resetCanvasSizeAndUpdateScroll","scrollToBarPos","x","y","time","clearTimeout","$f3129b461bb1bc83$var$isComma","$f3129b461bb1bc83$var$isReference","$f3129b461bb1bc83$var$filterReferenceNode","filter","$f3129b461bb1bc83$var$rangePreProcess","$f3129b461bb1bc83$var$sequenceNodeToText","sequenceNode","item","join","$f3129b461bb1bc83$var$getSheetNameById","getSheetBySheetId","getName","$f3129b461bb1bc83$var$unitRangesToText","isSupportAcrossSheet","serializeRangeWithSheet","$f3129b461bb1bc83$var$useSheetSelectionChange","_subUnitId","handleRangeChange","isScalingRef","debounceReset","setIsScaling","oldFilterReferenceNodes","filterReferenceNodes","newFilterReferenceNodes","old","isFirst","handleSelectionsChange","cloneSelectionList","currentSheetName","newSequenceNodes","nextItem","unitRange","rangeUnitId","rangeSubName","currentSelection","shift","rangeWithCoord","cloneNode","theLast","_c","thePre","isScaling","d2","pipe","throttleTime","disposableCollection","handleSequenceNodeReplace","currentIndex","offset","isFinish","selectionScaling$","distinctUntilChanged","rangeText","$f3129b461bb1bc83$var$verifyRange","$f3129b461bb1bc83$var$useVerify","onVerify","isInitRender","$f3129b461bb1bc83$var$styles$6","sheetRangeSelectorTextWrap","sheetRangeSelectorPlaceholder","sheetRangeSelectorError","sheetRangeSelectorErrorWrap","sheetRangeSelectorText","sheetRangeSelectorActive","sheetRangeSelectorIcon","sheetRangeSelectorDialogItem","sheetRangeSelectorDialogItemDelete","$f3129b461bb1bc83$var$noopFunction","initValue","errorText","placeholder","actions","onChange","onRangeSelectorDialogVisibleChange","onBlur","isFocus","_isFocus","localeService","LocaleService","rangeSelectorWrapRef","rangeDialogVisible","rangeDialogVisibleSet","isFocusSet","createInternalEditorID","RANGE_SELECTOR_SYMBOLS","generateRandomId","editorSet","containerRef","rangeStringSet","handleOutClick","cb","contains","isError","handleInputDebounce","handleConfirm","ranges2","handleClose","handleOpenModal","focus","handleSheetSelectionChange","startOffset","endOffset","setSelectionRanges","docBackScrollRenderController","DocBackScrollRenderController","scrollToRange","collapsed","replaceAll","beforeCommandExecuted","info","SetWorksheetActiveOperation","onCommandExecuted","SetCellEditVisibleOperation","blur","focus$","autofocus","editorUnitId","isSingle","initialSnapshot","documentStyle","sheetRangeSelector","Tooltip","placement","onClick","$f3129b461bb1bc83$var$RangeSelectorDialog","_handleClose","firstRange","focusIndex","focusIndexSet","handleRangeInput","handleRangeRemove","handleRangeAdd","useCallback","rangeText2","Dialog","draggable","closeIcon","footer","Button","marginLeft","onClose","sheetRangeSelectorDialog","Input","affixWrapperStyle","onFocus","size","$f3129b461bb1bc83$var$defaultPluginBaseConfig","$f3129b461bb1bc83$var$whenEditorStandalone","getContextValue","FOCUSING_DOC","FOCUSING_UNIVER_EDITOR","FOCUSING_UNIVER_EDITOR_STANDALONE_SINGLE_MODE","$f3129b461bb1bc83$var$extractFormulaError","isArrayFormulaCell","isFormulaString","f","isFormulaId","si","ERROR_TYPE_SET","$f3129b461bb1bc83$var$__defProp$7","$f3129b461bb1bc83$var$__getOwnPropDesc$7","$f3129b461bb1bc83$var$__decorateClass$7","$f3129b461bb1bc83$var$__decorateParam$7","$f3129b461bb1bc83$var$ALERT_KEY","$f3129b461bb1bc83$var$ErrorTypeToMessageMap","ErrorType","DIV_BY_ZERO","NAME","VALUE","NUM","NA","CYCLE","REF","SPILL","CALC","ERROR","CONNECT","NULL","$f3129b461bb1bc83$var$FormulaAlertRenderController","$f3129b461bb1bc83$var$_a3","Disposable","_hoverManagerService","_cellAlertManagerService","_localeService","_formulaDataModel","_zenZoneService","_init","_initCellAlertPopup","_initZenService","currentCell$","cellPos","_d","_e","cellData","getCell","location","col","arrayFormulaCellData","getArrayFormulaCellData","isICellData","errorType","currentAlert","currentLoc","alert","showAlert","CellAlertType","message","removeAlert","visible$","HoverManagerService","CellAlertManagerService","FormulaDataModel","IZenZoneService","$f3129b461bb1bc83$var$_a4","$f3129b461bb1bc83$var$__defProp$6","$f3129b461bb1bc83$var$__getOwnPropDesc$6","$f3129b461bb1bc83$var$__decorateClass$6","$f3129b461bb1bc83$var$__decorateParam$6","$f3129b461bb1bc83$var$FormulaAutoFillController","_autoFillService","_lexerTreeBuilder","_registerAutoFill","formulaRule","DATA_TYPE","FORMULA","priority","match","isContinue","prev","applyFunctions","APPLY_TYPE","COPY","dataWithIndex","direction","copyDataPiece","_fillCopyFormula","registerRule","step","$f3129b461bb1bc83$var$getDataLength","applyData","formulaIdMap","index2","Tools","deepClone","originalFormula","originalFormulaId","checkFormula","Direction","DOWN","RIGHT","unshift","formulaId","$f3129b461bb1bc83$var$directionToOffset","shiftedFormula","moveFormulaRefOffset","UP","LEFT","IAutoFillService","$f3129b461bb1bc83$var$__defProp$5","$f3129b461bb1bc83$var$__getOwnPropDesc$5","$f3129b461bb1bc83$var$__decorateClass$5","$f3129b461bb1bc83$var$__decorateParam$5","$f3129b461bb1bc83$var$FormulaClipboardController","$f3129b461bb1bc83$var$_a5","_currentUniverSheet","_sheetClipboardService","_injector","_initialize","_registerClipboardHook","addClipboardHook","_pasteFormulaHook","_pasteWithFormulaHook","specialPasteInfo","onPasteCells","pasteFrom","pasteTo","payload","_onPasteCells","isSpecialPaste","SPECIAL_PASTE_FORMAT","SPECIAL_PASTE_COL_WIDTH","includes","pasteType","undos","redos","getUnitId","pastedRange","copyInfo","copyType","COPY_TYPE","copyRange","invoke","$f3129b461bb1bc83$var$getSetCellFormulaMutations","matrix","formulaDataModel","redoMutationsInfo","undoMutationsInfo","valueMatrix","$f3129b461bb1bc83$var$getValueMatrix","setValuesMutation","cellValue","getData","SetRangeValuesMutation","undoSetValuesMutation","SetRangeValuesUndoMutationFactory","SPECIAL_PASTE_VALUE","$f3129b461bb1bc83$var$getSpecialPasteValueValueMatrix","$f3129b461bb1bc83$var$getSpecialPasteFormulaValueMatrix","$f3129b461bb1bc83$var$getDefaultPasteValueMatrix","$f3129b461bb1bc83$var$getValueMatrixOfPasteFromIsNull","ObjectMatrix","formulaData","getFormulaData","forValue","toRow","rows","toCol","cols","valueObject","setValue","fromRow","fromCol","richText","$f3129b461bb1bc83$var$getCellRichText","getFormulaStringByCell","ISheetClipboardService","$f3129b461bb1bc83$var$_a6","$f3129b461bb1bc83$var$__defProp$4","$f3129b461bb1bc83$var$__getOwnPropDesc$4","$f3129b461bb1bc83$var$__decorateClass$4","$f3129b461bb1bc83$var$__decorateParam$4","$f3129b461bb1bc83$var$FormulaEditorShowController","_editorBridgeService","_renderManagerService","_commandService","_logService","_initInterceptorEditorStart","_commandExecutedListener","debug","prevSheetId","_removeArrayFormulaRangeShape","_updateArrayFormulaRangeShape","interceptor","intercept","getInterceptPoints","BEFORE_CELL_EDIT","context","arrayFormulaMatrixRange","getArrayFormulaRange","arrayFormulaMatrixCell","cellInfo","matrixRange","_displayArrayFormulaRangeShape","command","options","SetFormulaCalculationResultMutation","SetArrayFormulaDataMutation","remove","SetWorksheetRowAutoHeightMutation","requestIdleCallback","rowsAutoHeightInfo","_refreshArrayFormulaRangeShapeByRow","rowIndex","columnIndex","_createArrayFormulaRangeShape","mainCellValue","formulaDataItem","getFormulaDataItem","isInArrayFormulaRange","arrayRange","styleSheet","renderUnit","primaryWithCoord","ISheetSelectionRenderService","rowHeaderWidth","columnHeaderHeight","SelectionShape","SELECTION_SHAPE_DEPTH","FORMULA_EDITOR_SHOW","update","setEvent","_previousShape","_refreshArrayFormulaRangeShape","_range","getRange","_checkCurrentSheet","rowAutoHeightInfo","shapeStartRow","shapeEndRow","shapeStartColumn","shapeEndColumn","shapeRange","ILogService","$f3129b461bb1bc83$var$__defProp$3","$f3129b461bb1bc83$var$__getOwnPropDesc$3","$f3129b461bb1bc83$var$__decorateClass$3","$f3129b461bb1bc83$var$__decorateParam$3","$f3129b461bb1bc83$var$FORMULA_ERROR_MARK","color","$f3129b461bb1bc83$var$FormulaRenderManagerController","$f3129b461bb1bc83$var$_a7","RxDisposable","_sheetInterceptorService","INTERCEPTOR_POINT","CELL_CONTENT","effect","InterceptorEffectEnum","Style","pos","markers","$f3129b461bb1bc83$var$FormulaProgressBar","triggerCalculationController","TriggerCalculationController","progress","useObservable","progress$","terminateCalculation","SetFormulaCalculationStopMutation","clearProgress","ProgressBar","onTerminate","onClearProgress","$f3129b461bb1bc83$var$getFunctionTypeValues","enumObj","keys","isNaN","Number","toLocaleLowerCase","$f3129b461bb1bc83$var$generateParam","require","repeat","SheetInterceptorService","$f3129b461bb1bc83$var$useResizeScrollObserver","callback","delay","throttleTimeout","throttledCallback","addEventListener","removeEventListener","$f3129b461bb1bc83$var$styles$5","formulaHelpFunction","formulaHelpFunctionTitle","formulaHelpFunctionTitleIcons","formulaHelpFunctionTitleIcon","formulaHelpFunctionContent","formulaHelpFunctionContentInner","formulaHelpFunctionContentParams","formulaHelpFunctionContentParamsTitle","formulaHelpFunctionContentParamsDetail","formulaHelpFunctionActive","formulaHelpDecorator","formulaHelpParam","formulaHelpParamPrefix","formulaHelpParamItem","formulaHelpParamActive","$f3129b461bb1bc83$var$HelpFunction","setVisible","contentVisible","setContentVisible","helpVisible","setHelpVisible","paramIndex","setParamIndex","setOffset","decoratorPosition","setDecoratorPosition","left","top","functionInfo","setFunctionInfo","promptService","required","optional","sidebarService","useInjector","updatePosition","position","getPosition","documentDataModel","getCurrentUniverDocInstance","isEditor","handleSwitchActive","paramIndex2","ILayoutService","subscription","help$","visible2","functionInfo2","description","functionParameter","sidebarSubscription","scrollEvent$","Popup","$f3129b461bb1bc83$var$Help","prefix","functionName","active","transform","padding","$f3129b461bb1bc83$var$Params","example","detail","$f3129b461bb1bc83$var$styles$4","formulaSearchFunction","formulaSearchFunctionItem","formulaSearchFunctionItemName","formulaSearchFunctionItemNameLight","formulaSearchFunctionItemDesc","formulaSearchFunctionItemActive","$f3129b461bb1bc83$var$SearchFunction","setActive","searchList","setSearchList","searchText","setSearchText","ulRef","handleLiMouseEnter","handleLiMouseLeave","scrollToVisible","liIndex","liElement","querySelectorAll","ulElement","parentNode","ulTop","ulHeight","offsetHeight","liRect","liTop","liHeight","scrollTo","offsetTop","behavior","updatedSearchList","updatedActive","subscribeSearch","search$","searchText2","searchList2","subscribeNavigate","navigate$","nextActive","subscribeAccept","accept$","onMouseEnter","onMouseLeave","slice","desc","$f3129b461bb1bc83$var$RenderFormulaPromptContent","$f3129b461bb1bc83$var$FunctionHelp","$f3129b461bb1bc83$var$FunctionParams","$f3129b461bb1bc83$var$styles$1","formulaInputParamsList","formulaInputParamsListItemName","formulaInputParamsListItemSelector","$f3129b461bb1bc83$var$InputParams","setFunctionParameter","activeIndex","setActiveIndex","formulaInputParams","formulaInputParamsInfo","$f3129b461bb1bc83$var$styles","formulaSelectFunctionSelect","formulaSelectFunctionResult","formulaSelectFunctionResultItem","formulaSelectFunctionResultItemNameLight","formulaSelectFunctionResultItemSelected","formulaSelectFunctionResultItemActive","formulaSelectFunctionContent","$f3129b461bb1bc83$var$SelectFunction","selectList","setSelectList","typeSelected","setTypeSelected","nameSelected","setNameSelected","sidebarOptions","sidebarOptions$","FunctionType","handleSelectChange","setCurrentFunctionInfo","highlightSearchText","regex","RegExp","toLocaleUpperCase","Boolean","part","selectedIndex","getFunctionInfo","getSearchListByType","handleSearchInputChange","getSearchListByName","handleSelectListKeyDown","Select","onKeyDown","allowClear","tabIndex","formulaSelectFunctionResultItemName","$f3129b461bb1bc83$var$MoreFunctions","useActiveWorkbook","selectFunction","setSelectFunction","inputParams","setInputParams","handleClickNextPrev","$f3129b461bb1bc83$var$InsertFunctionMenuItemFactory","tooltip","MenuItemType","SELECTOR","hidden$","getMenuHiddenObservable","disabled$","getCurrentRangeDisable$","workbookTypes","WorkbookEditablePermission","worksheetTypes","WorksheetEditPermission","WorksheetSetCellValuePermission","rangeTypes","RangeProtectionPermissionEditPoint","$f3129b461bb1bc83$var$MoreFunctionsMenuItemFactory","BUTTON","$f3129b461bb1bc83$var$menuClipboardDisabledObservable","getCurrentTypeOfUnit$","switchMap","IClipboardInterfaceService","Observable","subscriber","supportClipboard","of","$f3129b461bb1bc83$var$PasteFormulaMenuItemFactory","combineLatestWith","$f3129b461bb1bc83$var$menuSchema","RibbonStartGroup","FORMULAS_INSERT","order","menuItemFactory","PASTE_SPECIAL_MENU_ID","$f3129b461bb1bc83$var$META_KEY_CTRL_AND_SHIFT","$f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_ARROW_LIST","KeyCode","ARROW_DOWN","ARROW_UP","ARROW_LEFT","ARROW_RIGHT","$f3129b461bb1bc83$var$PROMPT_SELECTION_KEYCODE_LIST","ENTER","TAB","ESC","$f3129b461bb1bc83$var$promptSelectionShortcutItem","shortcutList","keycode","binding","preconditions","whenFormulaEditorActivated","staticParameters","eventType","DeviceInputEventType","Keyboard","$f3129b461bb1bc83$var$promptSelectionShortcutItemShift","MetaKeys","SHIFT","metaKey","$f3129b461bb1bc83$var$promptSelectionShortcutItemCtrl","CTRL_COMMAND","$f3129b461bb1bc83$var$promptSelectionShortcutItemCtrlAndShift","$f3129b461bb1bc83$var$ChangeRefToAbsoluteShortcut","F4","$f3129b461bb1bc83$var$singleEditorPromptSelectionShortcutItem","isSingleEditor","$f3129b461bb1bc83$var$_a8","$f3129b461bb1bc83$var$__defProp$2","$f3129b461bb1bc83$var$__getOwnPropDesc$2","$f3129b461bb1bc83$var$__decorateClass$2","$f3129b461bb1bc83$var$__decorateParam$2","$f3129b461bb1bc83$var$FormulaUIController","_menuManagerService","_shortcutService","_uiPartsService","_componentManager","_registerCommands","_registerMenus","_registerShortcuts","_registerComponents","_registerRenderModules","mergeMenu","registerCommand","registerShortcut","registerComponent","BuiltInUIPart","CONTENT","connectInjector","SheetsUIPart","FORMULA_AUX","registerRenderModule","$f3129b461bb1bc83$var$getFormulaRefSelectionStyle","IMenuManagerService","IUIPartsService","ComponentManager","$f3129b461bb1bc83$var$__defProp$1","$f3129b461bb1bc83$var$__getOwnPropDesc$1","$f3129b461bb1bc83$var$__decorateClass$1","$f3129b461bb1bc83$var$__decorateParam$1","$f3129b461bb1bc83$var$sheetEditorUnitIds","DOCS_FORMULA_BAR_EDITOR_UNIT_ID_KEY","DOCS_NORMAL_EDITOR_UNIT_ID_KEY","$f3129b461bb1bc83$var$PromptController","$f3129b461bb1bc83$var$_a9","_formulaPromptService","_sheetsSelectionsService","_univerInstanceService","_descriptionService","_docSelectionManagerService","_contextMenuService","_editorService","_layoutService","Set","_selectionRenderService","_allSelectionRenderServices","getAllRenderersOfType","renderer","_formulaRefColors","_resetTemp","_previousSequenceNodes","_previousInsertRefStringIndex","_isSelectionMovingRefSelections","_previousRangesCount","_currentInsertRefStringIndex","_initialCursorSync","_initAcceptFormula","_initialFormulaTheme","_initSelectionsEndListener","_closeRangePromptWhenEditorInvisible","_initialEditorInputChange","_cursorStateListener","_inputFormulaListener","_userMouseListener","_initialChangeEditor","_numberColor","_stringColor","textSelection$","isRangeSelector","onlyInputContent","isSheetEditor","_isFormulaEditorActivated","onlyInputRange","fromSelection","_quitSelectingMode","_contextSwitch","_checkShouldEnterSelectingMode","_highlightFormula","_changeFunctionPanelState","arrows","CTRL","UNIVER_DOC","_listenInputCache","docSelectionRenderService","DocSelectionRenderService","onInputBefore$","event","which","_inputPanelState","_arrowMoveActionState","_userCursorMove","afterVisible$","distinctUntilKeyChanged","visibleParam","_closeRangePrompt","subscribeContextValue$","FORMULA_EDITOR_ACTIVATED","activated","_previousEditorUnitId","closeRangePrompt$","getSpreadsheetFocusState","_insertSelections","clear","_updateEditorModel","FOCUSING_EDITOR_INPUT_FORMULA","UNI_DISABLE_CHANGING_FOCUS_KEY","_hideFunctionPanel","flat","disableHelperSelection","toRange","_onSelectionControlChange","selectionMoved$","selectionScaled$","_updateSelecting","performInsertion","selectionChangingState","_insertControlSelections","_insertControlSelectionReplace","_enableRefSelectionsRenderService","_selectionsChangeDisposables","_checkClearingLastSelection","_currentlyWorkingRefRenderer","_disposeSelectionsChangeListeners","_resetSequenceNodes","insertNodes","char","_getCurrentChar","matchRefDrawToken","_focusIsOnlyRange","_generateRefString","acceptFormulaName$","activeRange","getActiveTextRange","lastSequenceNodes","isDefinedName","isFormulaDefinedName","formulaStringCount","mustAddBracket","OPEN_BRACKET","selectionIndex","_syncToEditor","currentSequenceNode","FUNCTION","toUpperCase","getSearchListByNameFirstLetter","_changeHelpFunctionPanelState","config","_getCurrentBodyDataStreamAndOffset","functionAndParameter","getFunctionAndParameter","isOnlyInputRangeEditor","_enterSelectingMode","_getCurrentDataStream","_isSelectingMode","documentModel","getBody","compareToken","EQUALS","_getFormulaAndCellEditorBody","unitIds","dataModel","getUniverDocInstance","_editorModelUnitIds","_getContextState","bodyList","_existsSequenceNode","_buildTextRuns","_refreshSelectionForReference","_refreshFormulaAndCellEditor","_exceedCurrentRange","rowCount","columnCount","refSelectionRenderService","getEditCellState","selfUnitId","selfSheetId","_getCurrentUnitIdAndSheetId","isSelfSheet","getUniverSheetInstance","lastRange","_getSheetIdByName","lastRangeCopy","_getPrimary","getPrimaryForRange","equals","addSelections","find","mergeStartRow","mergeEndRow","mergeStartColumn","mergeEndColumn","normalizeSheetName","_getSheetNameById","_getEditorOpenedForSheet","openUnitId","getOpenForSheetUnitId","openSheetId","getOpenForSheetSubUnitId","refSheetName","startAbsoluteRefType","endAbsoluteRefType","rangeType","serializeRangeToRefString","textSelectionOffset","canUndo","generateStringWithSequence","_updateRefSelectionStyle","_fitEditorSize","isSingleChoice","setSingleSelectionEnabled","ReplaceContentCommand","textRanges","segmentId","replaceTextRanges","SetEditorResizeOperation","docViewModel","snapshot","getSnapshot","reset","selectionDatas","currentSelection2","selectionCount","currentEditor","getFocusEditor","controls","matchedControls","selectionControl","currentStyle","isStringNumber","getCellInfoInMergeData","currentNode","refType","AbsoluteRefType","NONE","getAbsoluteRefTypeWitString","min","attachPrimaryWithCoord","editorObject","getEditorObject","documentComponent","document","calculate","makeDirty","_getEditorObject","_pressEnter","changeVisible","_pressTab","_pressEsc","focusEditor","_pressArrowKey","MoveSelectionCommand","jumpOver","JumpOver","moveGap","ExpandSelectionCommand","updateCommandList","_changeRefString","_moveInEditor","getCurrentLastSelection","selectionDataNew","selectionWithStyles","MoveCursorOperation","inputFormula$","isVisible","Dblclick","tokenArray","unitIDAndSheetName","finalToken","COLON","refStringSplit","suffix","_changeSingleRef","_changeRangeRef","ALL","_isSheetOrFormulaEditor","isFormulaEditor","DocSelectionManagerService","$f3129b461bb1bc83$var$_a10","$f3129b461bb1bc83$var$__defProp2","$f3129b461bb1bc83$var$__getOwnPropDesc","$f3129b461bb1bc83$var$__defNormalProp2","$f3129b461bb1bc83$var$__decorateClass","$f3129b461bb1bc83$var$__decorateParam","$f3129b461bb1bc83$var$__publicField2","Plugin","_config","_configService","menu","rest","setConfig","onStarting","j","useClass","dependency","onReady","onRendered","dep","RANGE_SELECTOR_COMPONENT_KEY","onSteady","DependentOn","UniverFormulaEnginePlugin","UniverSheetsFormulaPlugin","IConfigService","$683a34e6c5504d12$export$571da16e28367bde","compare"],"version":3,"file":"es.75595260.js.map"}